# Comparing `tmp/django_herobiz_ds-2.0.2.tar.gz` & `tmp/django_herobiz_ds-2.0.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "django_herobiz_ds-2.0.2.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
+gzip compressed data, was "django_herobiz_ds-2.0.3.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `django_herobiz_ds-2.0.2.tar` & `django_herobiz_ds-2.0.3.tar`

### file list

```diff
@@ -1,107 +1,178 @@
--rw-r--r--   0        0        0     8196 2024-03-22 23:53:00.180115 django_herobiz_ds-2.0.2/.DS_Store
--rw-r--r--   0        0        0       66 2024-03-20 23:56:06.731106 django_herobiz_ds-2.0.2/.gitattributes
--rw-r--r--   0        0        0       18 2024-03-22 23:49:18.145604 django_herobiz_ds-2.0.2/.gitignore
--rw-r--r--   0        0        0       52 2024-03-20 23:57:31.872658 django_herobiz_ds-2.0.2/.idea/.gitignore
--rw-r--r--   0        0        0      407 2024-03-20 23:57:31.821245 django_herobiz_ds-2.0.2/.idea/django-herobiz-ds.iml
--rw-r--r--   0        0        0      174 2024-03-20 23:57:31.832580 django_herobiz_ds-2.0.2/.idea/inspectionProfiles/profiles_settings.xml
--rw-r--r--   0        0        0      425 2024-03-21 00:02:45.749953 django_herobiz_ds-2.0.2/.idea/misc.xml
--rw-r--r--   0        0        0      286 2024-03-20 23:57:31.826587 django_herobiz_ds-2.0.2/.idea/modules.xml
--rw-r--r--   0        0        0      167 2024-03-20 23:57:31.834402 django_herobiz_ds-2.0.2/.idea/vcs.xml
--rw-r--r--   0        0        0     1079 2024-03-19 03:45:10.033383 django_herobiz_ds-2.0.2/LICENSE
--rw-r--r--   0        0        0     6922 2024-03-23 00:30:42.968158 django_herobiz_ds-2.0.2/README.md
--rw-r--r--   0        0        0     6148 2024-03-22 23:53:05.359487 django_herobiz_ds-2.0.2/django_herobiz_ds/.DS_Store
--rw-r--r--   0        0        0        0 2024-03-21 00:01:04.776929 django_herobiz_ds-2.0.2/django_herobiz_ds/__init__.py
--rw-r--r--   0        0        0       63 2024-03-21 00:01:04.777254 django_herobiz_ds-2.0.2/django_herobiz_ds/admin.py
--rw-r--r--   0        0        0      164 2024-03-21 00:01:04.777811 django_herobiz_ds-2.0.2/django_herobiz_ds/apps.py
--rw-r--r--   0        0        0     1178 2023-03-21 07:32:02.546321 django_herobiz_ds-2.0.2/django_herobiz_ds/forms.py
--rw-r--r--   0        0        0     1917 2024-03-21 01:10:50.008799 django_herobiz_ds-2.0.2/django_herobiz_ds/migrations/0001_initial.py
--rw-r--r--   0        0        0        0 2024-03-21 00:01:04.778235 django_herobiz_ds-2.0.2/django_herobiz_ds/migrations/__init__.py
--rw-r--r--   0        0        0     1234 2024-03-13 01:18:52.636832 django_herobiz_ds-2.0.2/django_herobiz_ds/models.py
--rw-r--r--   0        0        0    64471 2024-03-13 01:35:25.566264 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/main.css
--rw-r--r--   0        0        0     7622 2024-03-13 01:35:25.566427 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-blue.css
--rw-r--r--   0        0        0     7619 2024-03-13 01:35:25.566545 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-green.css
--rw-r--r--   0        0        0     7622 2024-03-13 01:35:25.567403 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-orange.css
--rw-r--r--   0        0        0     7624 2024-03-13 01:35:25.567515 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-pink.css
--rw-r--r--   0        0        0     7624 2024-03-13 01:35:25.567619 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-purple.css
--rw-r--r--   0        0        0     7616 2024-03-13 01:35:25.567724 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-red.css
--rw-r--r--   0        0        0     7615 2024-03-13 01:35:25.567841 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables.css
--rw-r--r--   0        0        0     8449 2024-03-13 01:31:42.996504 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/js/main.js
--rw-r--r--   0        0        0     3649 2023-03-21 07:32:04.600051 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_footer.scss
--rw-r--r--   0        0        0     3770 2023-03-21 07:32:04.423355 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_general.scss
--rw-r--r--   0        0        0     1118 2023-03-21 07:32:04.957238 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_header.scss
--rw-r--r--   0        0        0     5712 2023-03-21 07:32:04.423696 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_nav.scss
--rw-r--r--   0        0        0     1320 2023-03-21 07:32:04.959857 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_portfolio-details.scss
--rw-r--r--   0        0        0     2172 2023-03-21 07:32:04.602885 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_comments.scss
--rw-r--r--   0        0        0     3738 2023-03-21 07:32:04.424080 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_details.scss
--rw-r--r--   0        0        0      758 2023-03-21 07:32:04.963316 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_pagination.scss
--rw-r--r--   0        0        0     3480 2023-03-21 07:32:04.424423 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_sidebar.scss
--rw-r--r--   0        0        0     1676 2023-03-21 07:32:05.459251 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_about.scss
--rw-r--r--   0        0        0      377 2023-03-21 07:32:04.958837 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_clients.scss
--rw-r--r--   0        0        0     3086 2023-03-21 07:32:04.482526 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_contact.scss
--rw-r--r--   0        0        0     1882 2023-03-21 07:32:05.460589 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_cta.scss
--rw-r--r--   0        0        0     1674 2023-03-21 07:32:04.960606 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_faq.scss
--rw-r--r--   0        0        0      981 2023-03-21 07:32:04.483664 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_featured-services.scss
--rw-r--r--   0        0        0     1762 2023-03-21 07:32:05.462485 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_features.scss
--rw-r--r--   0        0        0     1990 2023-03-21 07:32:04.484433 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_hero-fullscreen.scss
--rw-r--r--   0        0        0     1764 2023-03-21 07:32:05.463179 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_hero-static.scss
--rw-r--r--   0        0        0     3426 2023-03-21 07:32:05.459956 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_hero.scss
--rw-r--r--   0        0        0     2264 2023-03-21 07:32:05.463857 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_portfolio.scss
--rw-r--r--   0        0        0     2551 2023-03-21 07:32:05.461241 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_pricing.scss
--rw-r--r--   0        0        0     1512 2023-03-21 07:32:04.485053 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_recent-blog-posts.scss
--rw-r--r--   0        0        0     1718 2023-03-21 07:32:05.466914 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_services.scss
--rw-r--r--   0        0        0     2203 2023-03-21 07:32:04.485365 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_testimonials.scss
--rw-r--r--   0        0        0      253 2023-03-21 07:32:05.971531 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/main.scss
--rw-r--r--   0        0        0     7966 2024-03-13 01:31:42.982162 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-blue.css
--rw-r--r--   0        0        0     7963 2024-03-13 01:31:42.977659 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-green.css
--rw-r--r--   0        0        0     7966 2024-03-13 01:31:42.990233 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-orange.css
--rw-r--r--   0        0        0     7968 2024-03-13 01:31:42.980199 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-pink.css
--rw-r--r--   0        0        0     7966 2024-03-13 01:31:42.968037 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-purple.css
--rw-r--r--   0        0        0     7960 2024-03-13 01:31:42.988503 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-red.css
--rw-r--r--   0        0        0     8003 2024-03-13 01:31:42.974465 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables.css
--rw-r--r--   0        0        0    26053 2024-03-13 01:35:25.594519 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/aos/aos.css
--rw-r--r--   0        0        0    14690 2024-03-13 01:35:25.594645 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/aos/aos.js
--rw-r--r--   0        0        0    17372 2024-03-13 01:35:25.616425 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.css
--rw-r--r--   0        0        0    13749 2024-03-13 01:35:25.616798 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.min.css
--rw-r--r--   0        0        0    52561 2024-03-13 01:35:25.616918 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.css
--rw-r--r--   0        0        0    45081 2024-03-13 01:35:25.617035 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.min.css
--rw-r--r--   0        0        0   109391 2024-03-13 01:35:25.617235 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.js
--rw-r--r--   0        0        0    55880 2024-03-13 01:35:25.617405 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.min.js
--rw-r--r--   0        0        0    91398 2024-03-13 01:35:25.617598 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.js
--rw-r--r--   0        0        0    35445 2024-03-13 01:35:25.617734 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.min.js
--rw-r--r--   0        0        0   232688 2024-03-13 01:35:25.618119 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/php-email-form/php-email-form.php
--rw-r--r--   0        0        0     2590 2024-03-13 01:35:25.618214 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/php-email-form/validate.js
--rw-r--r--   0        0        0    16468 2024-03-13 01:35:25.618347 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.css
--rw-r--r--   0        0        0   143629 2024-03-13 01:35:25.618619 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.js
--rw-r--r--   0        0        0   540438 2024-03-13 01:35:25.619478 django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.js.map
--rw-r--r--   0        0        0     2857 2024-03-13 01:36:22.798674 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/__blog.html
--rw-r--r--   0        0        0     3811 2024-03-13 01:35:25.620288 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/__pricing.html
--rw-r--r--   0        0        0     2195 2024-03-13 01:41:34.193323 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_about.html
--rw-r--r--   0        0        0      453 2024-03-13 01:36:22.791890 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_clients.html
--rw-r--r--   0        0        0     3163 2024-03-13 01:41:34.162731 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_contact.html
--rw-r--r--   0        0        0     1235 2024-03-17 11:24:17.651309 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_cta.html
--rw-r--r--   0        0        0     1796 2024-03-13 01:36:22.794843 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_faq.html
--rw-r--r--   0        0        0     1870 2024-03-13 01:41:34.153380 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_features.html
--rw-r--r--   0        0        0     1014 2024-03-13 01:41:34.177223 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_hero1.html
--rw-r--r--   0        0        0     1746 2024-03-13 01:41:34.161174 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_hero2.html
--rw-r--r--   0        0        0      899 2024-03-13 01:41:34.169849 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_hero3.html
--rw-r--r--   0        0        0      898 2024-03-13 01:36:22.801972 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_hero4.html
--rw-r--r--   0        0        0     1857 2024-03-13 01:41:34.147688 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_onfocus.html
--rw-r--r--   0        0        0     5630 2024-03-13 01:41:34.172869 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_portfolio-details.html
--rw-r--r--   0        0        0     1520 2024-03-13 01:36:48.574690 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_portfolio.html
--rw-r--r--   0        0        0     1046 2024-03-13 01:41:34.155997 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_services.html
--rw-r--r--   0        0        0     1537 2024-03-13 01:41:34.164888 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_team.html
--rw-r--r--   0        0        0     1278 2024-03-13 01:41:34.150937 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_testimonials.html
--rw-r--r--   0        0        0     1088 2024-03-13 01:35:25.621909 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_why_us.html
--rw-r--r--   0        0        0     2023 2024-03-13 01:35:25.622102 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/footer.html
--rw-r--r--   0        0        0     3811 2024-03-13 01:18:52.688245 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/forms/__pricing.html
--rw-r--r--   0        0        0     1341 2023-03-21 07:32:09.179776 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/forms/contact.php
--rw-r--r--   0        0        0     1474 2024-03-13 01:41:34.188035 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/header.html
--rw-r--r--   0        0        0     4760 2024-03-23 00:01:06.623758 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/index.html
--rw-r--r--   0        0        0     1500 2024-03-13 01:41:34.158111 django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/seo.html
--rw-r--r--   0        0        0        0 2023-03-21 07:32:09.033136 django_herobiz_ds-2.0.2/django_herobiz_ds/templatetags/__init__.py
--rw-r--r--   0        0        0     5257 2024-03-13 01:31:42.984560 django_herobiz_ds-2.0.2/django_herobiz_ds/templatetags/herobizds_tags.py
--rw-r--r--   0        0        0       60 2024-03-21 00:01:04.778074 django_herobiz_ds-2.0.2/django_herobiz_ds/tests.py
--rw-r--r--   0        0        0      278 2024-03-21 01:10:19.048501 django_herobiz_ds-2.0.2/django_herobiz_ds/urls.py
--rw-r--r--   0        0        0     3855 2024-03-19 12:41:54.817402 django_herobiz_ds-2.0.2/django_herobiz_ds/views.py
--rw-r--r--   0        0        0      784 2024-03-23 00:30:42.965544 django_herobiz_ds-2.0.2/pyproject.toml
--rw-r--r--   0        0        0     7426 1970-01-01 00:00:00.000000 django_herobiz_ds-2.0.2/PKG-INFO
+-rw-r--r--   0        0        0     8196 2024-03-28 03:25:25.733603 django_herobiz_ds-2.0.3/.DS_Store
+-rw-r--r--   0        0        0       66 2024-03-20 23:56:06.731106 django_herobiz_ds-2.0.3/.gitattributes
+-rw-r--r--   0        0        0       29 2024-03-23 01:35:28.619023 django_herobiz_ds-2.0.3/.gitignore
+-rw-r--r--   0        0        0       52 2024-03-20 23:57:31.872658 django_herobiz_ds-2.0.3/.idea/.gitignore
+-rw-r--r--   0        0        0      407 2024-03-20 23:57:31.821245 django_herobiz_ds-2.0.3/.idea/django-herobiz-ds.iml
+-rw-r--r--   0        0        0      174 2024-03-20 23:57:31.832580 django_herobiz_ds-2.0.3/.idea/inspectionProfiles/profiles_settings.xml
+-rw-r--r--   0        0        0      425 2024-03-21 00:02:45.749953 django_herobiz_ds-2.0.3/.idea/misc.xml
+-rw-r--r--   0        0        0      286 2024-03-20 23:57:31.826587 django_herobiz_ds-2.0.3/.idea/modules.xml
+-rw-r--r--   0        0        0      167 2024-03-20 23:57:31.834402 django_herobiz_ds-2.0.3/.idea/vcs.xml
+-rw-r--r--   0        0        0     1079 2024-03-19 03:45:10.033383 django_herobiz_ds-2.0.3/LICENSE
+-rw-r--r--   0        0        0     2031 2024-04-05 05:07:11.109788 django_herobiz_ds-2.0.3/README.md
+-rw-r--r--   0        0        0     8196 2024-03-28 02:01:43.009711 django_herobiz_ds-2.0.3/django_herobiz_ds/.DS_Store
+-rw-r--r--   0        0        0        0 2024-03-28 01:56:00.401301 django_herobiz_ds-2.0.3/django_herobiz_ds/__init__.py
+-rw-r--r--   0        0        0      495 2024-03-28 01:58:01.633771 django_herobiz_ds-2.0.3/django_herobiz_ds/admin.py
+-rw-r--r--   0        0        0      164 2024-03-28 01:56:00.402678 django_herobiz_ds-2.0.3/django_herobiz_ds/apps.py
+-rw-r--r--   0        0        0      944 2024-04-03 03:16:29.757320 django_herobiz_ds-2.0.3/django_herobiz_ds/forms.py
+-rw-r--r--   0        0        0     1988 2024-04-05 02:30:48.031309 django_herobiz_ds-2.0.3/django_herobiz_ds/migrations/0001_initial.py
+-rw-r--r--   0        0        0      421 2024-04-05 03:09:43.264596 django_herobiz_ds-2.0.3/django_herobiz_ds/migrations/0002_portfolio_client.py
+-rw-r--r--   0        0        0        0 2024-03-28 01:56:00.403238 django_herobiz_ds-2.0.3/django_herobiz_ds/migrations/__init__.py
+-rw-r--r--   0        0        0     1328 2024-04-05 03:09:42.011116 django_herobiz_ds-2.0.3/django_herobiz_ds/models.py
+-rwxr-xr-x   0        0        0    60252 2024-03-29 01:14:08.439726 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/main.css
+-rwxr-xr-x   0        0        0     7992 2024-04-03 08:26:33.002126 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-blue.css
+-rwxr-xr-x   0        0        0     7989 2024-04-03 08:32:44.614276 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-green.css
+-rwxr-xr-x   0        0        0     7992 2024-04-03 08:32:44.619981 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-orange.css
+-rwxr-xr-x   0        0        0     7994 2024-04-03 08:32:44.616432 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-pink.css
+-rwxr-xr-x   0        0        0     7992 2024-04-03 08:32:44.612088 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-purple.css
+-rwxr-xr-x   0        0        0     7986 2024-04-03 08:32:44.607824 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-red.css
+-rwxr-xr-x   0        0        0     7985 2024-04-03 08:32:44.618152 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables.css
+-rwxr-xr-x   0        0        0      766 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/img/about-bg.png
+-rwxr-xr-x   0        0        0    95604 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/img/faq.jpg
+-rwxr-xr-x   0        0        0    13287 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/img/hero-bg.png
+-rwxr-xr-x   0        0        0    13081 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/img/onfocus-content-bg.jpg
+-rwxr-xr-x   0        0        0    87953 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/img/onfocus-video-bg.jpg
+-rwxr-xr-x   0        0        0    61855 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/img/pricing-bg.jpg
+-rwxr-xr-x   0        0        0     8186 2024-03-17 05:37:08.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/js/main.js
+-rwxr-xr-x   0        0        0      281 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_blog.scss
+-rwxr-xr-x   0        0        0     3649 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_footer.scss
+-rwxr-xr-x   0        0        0     3770 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_general.scss
+-rwxr-xr-x   0        0        0     1118 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_header.scss
+-rwxr-xr-x   0        0        0      643 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_index.scss
+-rwxr-xr-x   0        0        0     5712 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_nav.scss
+-rwxr-xr-x   0        0        0     1320 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_portfolio-details.scss
+-rwxr-xr-x   0        0        0     2172 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_comments.scss
+-rwxr-xr-x   0        0        0     3738 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_details.scss
+-rwxr-xr-x   0        0        0      758 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_pagination.scss
+-rwxr-xr-x   0        0        0     1813 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_posts-list.scss
+-rwxr-xr-x   0        0        0     3480 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_sidebar.scss
+-rwxr-xr-x   0        0        0     1676 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_about.scss
+-rwxr-xr-x   0        0        0      377 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_clients.scss
+-rwxr-xr-x   0        0        0     3086 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_contact.scss
+-rwxr-xr-x   0        0        0     1882 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_cta.scss
+-rwxr-xr-x   0        0        0     1674 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_faq.scss
+-rwxr-xr-x   0        0        0      981 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_featured-services.scss
+-rwxr-xr-x   0        0        0     1762 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_features.scss
+-rwxr-xr-x   0        0        0     2205 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero-animated.scss
+-rwxr-xr-x   0        0        0     1990 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero-fullscreen.scss
+-rwxr-xr-x   0        0        0     1764 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero-static.scss
+-rwxr-xr-x   0        0        0     3481 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero.scss
+-rwxr-xr-x   0        0        0     3798 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_onfocus.scss
+-rwxr-xr-x   0        0        0     2264 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_portfolio.scss
+-rwxr-xr-x   0        0        0     2551 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_pricing.scss
+-rwxr-xr-x   0        0        0     1512 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_recent-blog-posts.scss
+-rwxr-xr-x   0        0        0     1718 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_services.scss
+-rwxr-xr-x   0        0        0     1922 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_team.scss
+-rwxr-xr-x   0        0        0     2203 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_testimonials.scss
+-rwxr-xr-x   0        0        0      253 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/main.scss
+-rwxr-xr-x   0        0        0     7960 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-blue.css
+-rwxr-xr-x   0        0        0     7957 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-green.css
+-rwxr-xr-x   0        0        0     7960 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-orange.css
+-rwxr-xr-x   0        0        0     7962 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-pink.css
+-rwxr-xr-x   0        0        0     7960 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-purple.css
+-rwxr-xr-x   0        0        0     7954 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-red.css
+-rwxr-xr-x   0        0        0     7953 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables.css
+-rw-r--r--   0        0        0    19941 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/aos/aos.cjs.js
+-rw-r--r--   0        0        0    28765 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/aos/aos.css
+-rw-r--r--   0        0        0    19768 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/aos/aos.esm.js
+-rw-r--r--   0        0        0    13800 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/aos/aos.js
+-rw-r--r--   0        0        0    56459 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/aos/aos.js.map
+-rw-r--r--   0        0        0    98255 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap-icons/bootstrap-icons.css
+-rw-r--r--   0        0        0    52358 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap-icons/bootstrap-icons.json
+-rw-r--r--   0        0        0    85875 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap-icons/bootstrap-icons.min.css
+-rw-r--r--   0        0        0    57755 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap-icons/bootstrap-icons.scss
+-rw-r--r--   0        0        0   176032 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap-icons/fonts/bootstrap-icons.woff
+-rw-r--r--   0        0        0   130396 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap-icons/fonts/bootstrap-icons.woff2
+-rw-r--r--   0        0        0    70329 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.css
+-rw-r--r--   0        0        0   203221 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.css.map
+-rw-r--r--   0        0        0    51795 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.min.css
+-rw-r--r--   0        0        0   115986 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.min.css.map
+-rw-r--r--   0        0        0    70403 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.rtl.css
+-rw-r--r--   0        0        0   203225 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.rtl.css.map
+-rw-r--r--   0        0        0    51870 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.rtl.min.css
+-rw-r--r--   0        0        0   116063 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-grid.rtl.min.css.map
+-rw-r--r--   0        0        0    12065 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.css
+-rw-r--r--   0        0        0   129371 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.css.map
+-rw-r--r--   0        0        0    10126 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.min.css
+-rw-r--r--   0        0        0    51369 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.min.css.map
+-rw-r--r--   0        0        0    12058 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.rtl.css
+-rw-r--r--   0        0        0   129386 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.rtl.css.map
+-rw-r--r--   0        0        0    10198 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.rtl.min.css
+-rw-r--r--   0        0        0    63943 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-reboot.rtl.min.css.map
+-rw-r--r--   0        0        0   107823 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.css
+-rw-r--r--   0        0        0   267535 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.css.map
+-rw-r--r--   0        0        0    85352 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.min.css
+-rw-r--r--   0        0        0   180381 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.min.css.map
+-rw-r--r--   0        0        0   107691 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.rtl.css
+-rw-r--r--   0        0        0   267476 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.rtl.css.map
+-rw-r--r--   0        0        0    85281 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.rtl.min.css
+-rw-r--r--   0        0        0   180217 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap-utilities.rtl.min.css.map
+-rw-r--r--   0        0        0   281046 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.css
+-rw-r--r--   0        0        0   679755 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.css.map
+-rw-r--r--   0        0        0   232803 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.min.css
+-rw-r--r--   0        0        0   589892 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.min.css.map
+-rw-r--r--   0        0        0   280259 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.rtl.css
+-rw-r--r--   0        0        0   679615 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.rtl.css.map
+-rw-r--r--   0        0        0   232911 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.rtl.min.css
+-rw-r--r--   0        0        0   589087 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/css/bootstrap.rtl.min.css.map
+-rw-r--r--   0        0        0   207819 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.bundle.js
+-rw-r--r--   0        0        0   444579 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.bundle.js.map
+-rw-r--r--   0        0        0    80721 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.bundle.min.js
+-rw-r--r--   0        0        0   332090 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.bundle.min.js.map
+-rw-r--r--   0        0        0   135829 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.esm.js
+-rw-r--r--   0        0        0   305438 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.esm.js.map
+-rw-r--r--   0        0        0    73935 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.esm.min.js
+-rw-r--r--   0        0        0   222455 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.esm.min.js.map
+-rw-r--r--   0        0        0   145401 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.js
+-rw-r--r--   0        0        0   306606 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.js.map
+-rw-r--r--   0        0        0    60635 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.min.js
+-rw-r--r--   0        0        0   220561 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/bootstrap/js/bootstrap.min.js.map
+-rw-r--r--   0        0        0    17372 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.css
+-rw-r--r--   0        0        0    13749 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.min.css
+-rw-r--r--   0        0        0    52561 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.css
+-rw-r--r--   0        0        0    45081 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.min.css
+-rw-r--r--   0        0        0   109391 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.js
+-rw-r--r--   0        0        0    55880 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.min.js
+-rw-r--r--   0        0        0    91398 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.js
+-rw-r--r--   0        0        0    35445 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.min.js
+-rwxr-xr-x   0        0        0   238381 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/php-email-form/php-email-form.php
+-rwxr-xr-x   0        0        0     2734 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/php-email-form/validate.js
+-rw-r--r--   0        0        0    18436 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.css
+-rw-r--r--   0        0        0   149147 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.js
+-rw-r--r--   0        0        0   201656 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.js.map
+-rwxr-xr-x   0        0        0     3326 2024-04-04 04:57:55.458296 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/__inner-page.html
+-rw-r--r--   0        0        0     2080 2024-03-29 06:33:07.063937 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_about.html
+-rw-r--r--   0        0        0     2732 2024-03-29 01:05:20.167863 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_blog.html
+-rw-r--r--   0        0        0      430 2024-03-29 06:35:13.298882 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_clients.html
+-rw-r--r--   0        0        0     2983 2024-04-03 07:06:14.783362 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_contact.html
+-rw-r--r--   0        0        0     1154 2024-03-30 00:03:54.185934 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_cta.html
+-rw-r--r--   0        0        0     1595 2024-04-02 01:30:23.624024 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_faq.html
+-rw-r--r--   0        0        0      794 2024-03-29 06:50:25.784512 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_featured_services.html
+-rw-r--r--   0        0        0     2035 2024-03-30 02:24:00.706893 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_features.html
+-rw-r--r--   0        0        0      979 2024-03-29 05:40:32.334981 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_hero_animated.html
+-rw-r--r--   0        0        0     1819 2024-03-29 05:34:15.457629 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_hero_carousel.html
+-rw-r--r--   0        0        0      857 2024-03-29 05:40:32.332271 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_hero_fullscreen.html
+-rw-r--r--   0        0        0      867 2024-03-29 05:42:02.021045 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_hero_static.html
+-rw-r--r--   0        0        0     1540 2024-03-30 01:04:51.245065 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_onfocus.html
+-rwxr-xr-x   0        0        0     5172 2024-04-05 05:04:48.859503 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_portfolio-details.html
+-rw-r--r--   0        0        0     1482 2024-04-02 05:48:18.679857 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_portfolio.html
+-rw-r--r--   0        0        0     1530 2024-04-02 01:24:08.992741 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_pricing.html
+-rwxr-xr-x   0        0        0    19317 2024-04-05 01:00:57.937012 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_privacy.html
+-rw-r--r--   0        0        0      956 2024-03-30 02:24:56.706034 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_services.html
+-rw-r--r--   0        0        0     1485 2024-04-02 07:02:37.695381 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_team.html
+-rwxr-xr-x   0        0        0    19259 2024-04-05 01:00:57.940127 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_terms.html
+-rw-r--r--   0        0        0     1325 2024-04-02 00:03:23.122974 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_testimonials.html
+-rwxr-xr-x   0        0        0    20533 2024-04-03 08:41:20.827610 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/blog-details.html
+-rwxr-xr-x   0        0        0    17540 2024-04-03 08:41:20.823367 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/blog.html
+-rw-r--r--   0        0        0      342 2024-04-05 03:18:33.503234 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/breadcrumb.html
+-rw-r--r--   0        0        0     3934 2024-04-04 04:44:18.713512 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/footer.html
+-rwxr-xr-x   0        0        0     1341 2024-03-12 00:49:58.000000 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/forms/contact.php
+-rw-r--r--   0        0        0     1312 2024-03-29 05:43:52.215294 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/header.html
+-rwxr-xr-x   0        0        0     5038 2024-03-29 03:50:57.400118 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/index.html
+-rw-r--r--   0        0        0     2012 2024-04-03 07:59:23.373918 django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/seo.html
+-rw-r--r--   0        0        0        0 2023-03-21 07:32:09.033136 django_herobiz_ds-2.0.3/django_herobiz_ds/templatetags/__init__.py
+-rw-r--r--   0        0        0     4195 2024-04-04 04:49:04.980651 django_herobiz_ds-2.0.3/django_herobiz_ds/templatetags/herobizds_tags.py
+-rw-r--r--   0        0        0       60 2024-03-28 01:56:00.403087 django_herobiz_ds-2.0.3/django_herobiz_ds/tests.py
+-rw-r--r--   0        0        0      476 2024-04-04 05:52:06.506990 django_herobiz_ds-2.0.3/django_herobiz_ds/urls.py
+-rw-r--r--   0        0        0     3941 2024-04-05 05:07:11.105033 django_herobiz_ds-2.0.3/django_herobiz_ds/views.py
+-rw-r--r--   0        0        0      784 2024-04-05 05:24:34.007425 django_herobiz_ds-2.0.3/pyproject.toml
+-rw-r--r--   0        0        0     2535 1970-01-01 00:00:00.000000 django_herobiz_ds-2.0.3/PKG-INFO
```

### Comparing `django_herobiz_ds-2.0.2/.DS_Store` & `django_herobiz_ds-2.0.3/.DS_Store`

 * *Files 2% similar despite different names*

```diff
@@ -290,39 +290,39 @@
 00001210: 0000 b962 706c 6973 7430 30d6 0102 0304  ...bplist00.....
 00001220: 0506 0708 0708 0b08 5d53 686f 7753 7461  ........]ShowSta
 00001230: 7475 7342 6172 5b53 686f 7754 6f6f 6c62  tusBar[ShowToolb
 00001240: 6172 5b53 686f 7754 6162 5669 6577 5f10  ar[ShowTabView_.
 00001250: 1443 6f6e 7461 696e 6572 5368 6f77 5369  .ContainerShowSi
 00001260: 6465 6261 725c 5769 6e64 6f77 426f 756e  debar\WindowBoun
 00001270: 6473 5b53 686f 7753 6964 6562 6172 0809  ds[ShowSidebar..
-00001280: 0809 5f10 197b 7b31 3535 302c 2039 3631  .._..{{1550, 961
+00001280: 0809 5f10 197b 7b31 3234 362c 2034 3330  .._..{{1246, 430
 00001290: 7d2c 207b 3932 302c 2034 3336 7d7d 0908  }, {920, 436}}..
 000012a0: 1523 2f3b 525f 6b6c 6d6e 6f8b 0000 0000  .#/;R_klmno.....
 000012b0: 0000 0101 0000 0000 0000 000d 0000 0000  ................
 000012c0: 0000 0000 0000 0000 0000 008c 0000 0007  ................
 000012d0: 005f 0073 0074 0061 0074 0069 0063 7653  ._.s.t.a.t.i.cvS
 000012e0: 726e 6c6f 6e67 0000 0001 0000 0011 0064  rnlong.........d
 000012f0: 006a 0061 006e 0067 006f 005f 0068 0065  .j.a.n.g.o._.h.e
 00001300: 0072 006f 0062 0069 007a 005f 0064 0073  .r.o.b.i.z._.d.s
-00001310: 6277 7370 626c 6f62 0000 00b9 6270 6c69  bwspblob....bpli
+00001310: 6277 7370 626c 6f62 0000 00b8 6270 6c69  bwspblob....bpli
 00001320: 7374 3030 d601 0203 0405 0607 0807 080b  st00............
 00001330: 085d 5368 6f77 5374 6174 7573 4261 725b  .]ShowStatusBar[
 00001340: 5368 6f77 546f 6f6c 6261 725b 5368 6f77  ShowToolbar[Show
 00001350: 5461 6256 6965 775f 1014 436f 6e74 6169  TabView_..Contai
 00001360: 6e65 7253 686f 7753 6964 6562 6172 5c57  nerShowSidebar\W
 00001370: 696e 646f 7742 6f75 6e64 735b 5368 6f77  indowBounds[Show
-00001380: 5369 6465 6261 7208 0908 095f 1019 7b7b  Sidebar...._..{{
-00001390: 3135 3530 2c20 3936 317d 2c20 7b39 3230  1550, 961}, {920
-000013a0: 2c20 3433 367d 7d09 0815 232f 3b52 5f6b  , 436}}...#/;R_k
-000013b0: 6c6d 6e6f 8b00 0000 0000 0001 0100 0000  lmno............
-000013c0: 0000 0000 0d00 0000 0000 0000 0000 0000  ................
-000013d0: 0000 0000 8c00 0000 1100 6400 6a00 6100  ..........d.j.a.
-000013e0: 6e00 6700 6f00 5f00 6800 6500 7200 6f00  n.g.o._.h.e.r.o.
-000013f0: 6200 6900 7a00 5f00 6400 7376 5372 6e6c  b.i.z._.d.svSrnl
-00001400: 6f6e 6700 0000 0100 0000 0000 0000 0000  ong.............
+00001380: 5369 6465 6261 7208 0908 095f 1018 7b7b  Sidebar...._..{{
+00001390: 3137 312c 2036 3337 7d2c 207b 3932 302c  171, 637}, {920,
+000013a0: 2034 3336 7d7d 0908 1523 2f3b 525f 6b6c   436}}...#/;R_kl
+000013b0: 6d6e 6f8a 0000 0000 0000 0101 0000 0000  mno.............
+000013c0: 0000 000d 0000 0000 0000 0000 0000 0000  ................
+000013d0: 0000 008b 0000 0011 0064 006a 0061 006e  .........d.j.a.n
+000013e0: 0067 006f 005f 0068 0065 0072 006f 0062  .g.o._.h.e.r.o.b
+000013f0: 0069 007a 005f 0064 0073 7653 726e 6c6f  .i.z._.d.svSrnlo
+00001400: 6e67 0000 0001 0000 0000 0000 0000 0000  ng..............
 00001410: 0000 0000 0000 0000 0000 0000 0000 0000  ................
 00001420: 0000 0000 0000 0001 0000 0020 0000 0001  ........... ....
 00001430: 0000 0040 0000 0001 0000 0080 0000 0001  ...@............
 00001440: 0000 0100 0000 0001 0000 0200 0000 0001  ................
 00001450: 0000 0400 0000 0000 0000 0001 0000 1000  ................
 00001460: 0000 0001 0000 2000 0000 0001 0000 4000  ...... .......@.
 00001470: 0000 0001 0000 8000 0000 0001 0001 0000  ................
```

### Comparing `django_herobiz_ds-2.0.2/LICENSE` & `django_herobiz_ds-2.0.3/LICENSE`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/forms.py` & `django_herobiz_ds-2.0.3/django_herobiz_ds/forms.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,36 +1,25 @@
 import datetime
 from django import forms
 
 # https://stackoverflow.com/questions/3367091/whats-the-cleanest-simplest-to-get-running-datepicker-in-django
 
 
-class DateInput(forms.DateInput):
-    input_type = 'date'
-
-
 class AppointmentForm(forms.Form):
     name = forms.CharField(
         label='', max_length=20,
         widget=forms.TextInput(attrs={'placeholder': '성함', 'class': 'form-control'})
     )
-    phone = forms.CharField(
+    email = forms.CharField(
         label='', max_length=20,
-        widget=forms.TextInput(attrs={'placeholder': '연락처', 'class': 'form-control'})
+        widget=forms.TextInput(attrs={'placeholder': '이메일', 'class': 'form-control'})
     )
-    date = forms.DateField(
-        label='',
-        # https://docs.djangoproject.com/en/3.2/ref/forms/fields/
-        initial=datetime.date.today,
-        widget=DateInput(attrs={'placeholder': '예약일', 'class': 'form-control'})
+    subject = forms.CharField(
+        label='', max_length=20,
+        widget=forms.TextInput(attrs={'placeholder': '제목', 'class': 'form-control'})
     )
     message = forms.CharField(
         label='',
         required=False,
-        widget=forms.Textarea(attrs={'placeholder': '상담 내용',
+        widget=forms.Textarea(attrs={'placeholder': '문의사항',
                                      'class': 'form-control',
                                      'rows': '4'}))
-
-    class Meta:
-        widgets = {
-            'date': DateInput(),
-        }
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/migrations/0001_initial.py` & `django_herobiz_ds-2.0.3/django_herobiz_ds/migrations/0001_initial.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# Generated by Django 5.0.3 on 2024-03-21 01:10
+# Generated by Django 5.0.3 on 2024-04-05 02:30
 
 import django.db.models.deletion
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
@@ -27,12 +27,13 @@
                 ('subtitle', models.CharField(max_length=40, verbose_name='부제목')),
                 ('description', models.TextField(blank=True, null=True, verbose_name='세부 설명')),
                 ('image1', models.ImageField(help_text='각 이미지 비율이(3x5) 동일한 것이 보기 좋습니다.', null=True, upload_to='images/portfolio/')),
                 ('image2', models.ImageField(blank=True, null=True, upload_to='images/portfolio/')),
                 ('image3', models.ImageField(blank=True, null=True, upload_to='images/portfolio/')),
                 ('image4', models.ImageField(blank=True, null=True, upload_to='images/portfolio/')),
                 ('image5', models.ImageField(blank=True, null=True, upload_to='images/portfolio/')),
+                ('reg_time', models.DateTimeField(auto_now_add=True)),
                 ('url', models.URLField(blank=True, help_text='공란 가능', max_length=500, null=True, verbose_name='참고링크')),
                 ('filter', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='category', to='django_herobiz_ds.category')),
             ],
         ),
     ]
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/main.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/main.css`

 * *Files 8% similar despite different names*

```diff
@@ -1,26 +1,22 @@
 /**
-* Template Name: HeroBiz - v2.3.1
+* Template Name: HeroBiz
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
+* Updated: Mar 17 2024 with Bootstrap v5.3.3
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 */
 
 /**
 * Check out variables.css for easy customization of colors, typography, and other repetitive properties
 */
 /*--------------------------------------------------------------
 # General
 --------------------------------------------------------------*/
 :root {
-  /* Fonts */
-  --font-default: 'Noto Sans Kr','Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
-  --font-primary: 'Hahmlet', 'Source Sans Pro', sans-serif;
-  --font-secondary: 'Noto Serif KR', 'Poppins', sans-serif;
-
   scroll-behavior: smooth;
 }
 
 a {
   color: var(--color-links);
   text-decoration: none;
 }
@@ -55,41 +51,21 @@
 
 #preloader:before,
 #preloader:after {
   content: "";
   position: absolute;
   border: 4px solid var(--color-primary);
   border-radius: 50%;
-  -webkit-animation: animate-preloader 2s cubic-bezier(0, 0.2, 0.8, 1) infinite;
   animation: animate-preloader 2s cubic-bezier(0, 0.2, 0.8, 1) infinite;
 }
 
 #preloader:after {
-  -webkit-animation-delay: -0.5s;
   animation-delay: -0.5s;
 }
 
-@-webkit-keyframes animate-preloader {
-  0% {
-    width: 10px;
-    height: 10px;
-    top: calc(50% - 5px);
-    left: calc(50% - 5px);
-    opacity: 1;
-  }
-
-  100% {
-    width: 72px;
-    height: 72px;
-    top: calc(50% - 36px);
-    left: calc(50% - 36px);
-    opacity: 0;
-  }
-}
-
 @keyframes animate-preloader {
   0% {
     width: 10px;
     height: 10px;
     top: calc(50% - 5px);
     left: calc(50% - 5px);
     opacity: 1;
@@ -576,23 +552,14 @@
 
 /*--------------------------------------------------------------
 # Index Page
 --------------------------------------------------------------*/
 /*--------------------------------------------------------------
 # Animated Hero Section
 --------------------------------------------------------------*/
-.hero-animated {
-  width: 100%;
-  min-height: 50vh;
-  background: url("../img/hero-bg.png") center center;
-  background-size: cover;
-  position: relative;
-  padding: 120px 0 60px;
-}
-
 .hero-animated h2 {
   margin: 0 0 10px 0;
   font-size: 48px;
   font-weight: 300;
   color: var(--color-secondary);
   font-family: var(--font-secondary);
 }
@@ -684,98 +651,73 @@
 
   .hero-animated .btn-get-started,
   .hero-animated .btn-watch-video {
     font-size: 14px;
   }
 }
 
-@-webkit-keyframes up-down {
-  0% {
-    transform: translateY(10px);
-  }
-
-  100% {
-    transform: translateY(-10px);
-  }
-}
-
 @keyframes up-down {
   0% {
     transform: translateY(10px);
   }
 
   100% {
     transform: translateY(-10px);
   }
 }
 
 /*--------------------------------------------------------------
 # Carousel Hero Section
 --------------------------------------------------------------*/
-.hero {
-  width: 100%;
-  min-height: 60vh;
-  padding: 0;
-  background: var(--color-black);
-  background: url("../img/hero-bg.png") center center;
-  background-size: cover;
-  background-position: center;
-  background-repeat: no-repeat;
-  position: relative;
-  display: flex;
-  flex-direction: column;
-  justify-content: center;
-  padding: 140px 0 60px 0;
+
+.hero .carousel-item {
+  overflow: hidden;
 }
 
 @media (max-width: 640px) {
   .hero .container {
     padding: 0 60px;
   }
 }
 
 .hero h2 {
   color: var(--color-secondary);
   margin-bottom: 25px;
   font-size: 48px;
   font-weight: 300;
-  -webkit-animation: fadeInDown 1s both 0.2s;
   animation: fadeInDown 1s both 0.2s;
 }
 
 @media (max-width: 768px) {
   .hero h2 {
     font-size: 30px;
   }
 }
 
 .hero p {
   color: var(--color-secondary-light);
-  -webkit-animation: fadeInDown 1s both 0.4s;
   animation: fadeInDown 1s both 0.4s;
   font-weight: 500;
   margin-bottom: 30px;
 }
 
 .hero .img {
   margin-bottom: 40px;
-  -webkit-animation: fadeInDownLite 1s both;
   animation: fadeInDownLite 1s both;
 }
 
 .hero .btn-get-started {
   font-family: var(--font-secondary);
   font-weight: 400;
   font-size: 16px;
   letter-spacing: 1px;
   display: inline-block;
   padding: 8px 32px;
   border-radius: 5px;
   transition: 0.5s;
-  -webkit-animation: fadeInUp 1s both 0.6s;
   animation: fadeInUp 1s both 0.6s;
   color: var(--color-primary);
   border: 2px solid var(--color-primary);
 }
 
 .hero .btn-get-started:hover {
   background: var(--color-primary);
@@ -837,14 +779,15 @@
 
 .hero .carousel-control-prev:hover,
 .hero .carousel-control-next:hover {
   opacity: 0.9;
 }
 
 .hero .carousel-indicators li {
+  list-style-type: none;
   cursor: pointer;
   background: rgba(var(--color-secondary-rgb), 0.5);
   overflow: hidden;
   border: 0;
   width: 12px;
   height: 12px;
   border-radius: 50px;
@@ -853,94 +796,48 @@
 }
 
 .hero .carousel-indicators li.active {
   opacity: 1;
   background: var(--color-primary);
 }
 
-@-webkit-keyframes fadeIn {
-  from {
-    opacity: 0;
-  }
-
-  to {
-    opacity: 1;
-  }
-}
-
 @keyframes fadeIn {
   from {
     opacity: 0;
   }
 
   to {
     opacity: 1;
   }
 }
 
-@-webkit-keyframes fadeInUp {
-  from {
-    opacity: 0;
-    transform: translate3d(0, 100%, 0);
-  }
-
-  to {
-    opacity: 1;
-    transform: translate3d(0, 0, 0);
-  }
-}
-
 @keyframes fadeInUp {
   from {
     opacity: 0;
     transform: translate3d(0, 100%, 0);
   }
 
   to {
     opacity: 1;
     transform: translate3d(0, 0, 0);
   }
 }
 
-@-webkit-keyframes fadeInDown {
-  from {
-    opacity: 0;
-    transform: translate3d(0, -100%, 0);
-  }
-
-  to {
-    opacity: 1;
-    transform: translate3d(0, 0, 0);
-  }
-}
-
 @keyframes fadeInDown {
   from {
     opacity: 0;
     transform: translate3d(0, -100%, 0);
   }
 
   to {
     opacity: 1;
     transform: translate3d(0, 0, 0);
   }
 }
 
-@-webkit-keyframes fadeInDownLite {
-  from {
-    opacity: 0;
-    transform: translate3d(0, -10%, 0);
-  }
-
-  to {
-    opacity: 1;
-    transform: translate3d(0, 0, 0);
-  }
-}
-
 @keyframes fadeInDownLite {
   from {
     opacity: 0;
     transform: translate3d(0, -10%, 0);
   }
 
   to {
@@ -948,23 +845,14 @@
     transform: translate3d(0, 0, 0);
   }
 }
 
 /*--------------------------------------------------------------
 # Fullscreen Hero Section
 --------------------------------------------------------------*/
-.hero-fullscreen {
-  width: 100%;
-  min-height: 100vh;
-  background: url("../img/hero-fullscreen-bg.jpg") center center;
-  background-size: cover;
-  position: relative;
-  padding: 120px 0 60px;
-}
-
 .hero-fullscreen:before {
   content: "";
   background: rgba(var(--color-white-rgb), 0.85);
   position: absolute;
   inset: 0;
 }
 
@@ -1049,22 +937,15 @@
     font-size: 14px;
   }
 }
 
 /*--------------------------------------------------------------
 # Static Hero Section
 --------------------------------------------------------------*/
-.hero-static {
-  width: 100%;
-  min-height: 50vh;
-  background: url("../img/hero-bg.png") center center;
-  background-size: cover;
-  position: relative;
-  padding: 120px 0 60px;
-}
+
 
 .hero-static h2 {
   margin: 0 0 10px 0;
   font-size: 48px;
   font-weight: 300;
   color: var(--color-secondary);
   font-family: var(--font-secondary);
@@ -1188,22 +1069,15 @@
 # About Section
 --------------------------------------------------------------*/
 .about .about-img {
   position: relative;
   margin: 60px 0 0 60px;
 }
 
-.about .about-img:before {
-  position: absolute;
-  inset: -60px 0 0 -60px;
-  z-index: -1;
-  content: "";
-  background: url("../img/about-bg.png") top left;
-  background-repeat: no-repeat;
-}
+
 
 @media (max-width: 575px) {
   .about .about-img {
     margin: 30px 0 0 30px;
   }
 
   .about .about-img:before {
@@ -1383,27 +1257,14 @@
 /*--------------------------------------------------------------
 # On Focus Section
 --------------------------------------------------------------*/
 .onfocus {
   padding: 0;
 }
 
-.onfocus .video-play {
-  min-height: 400px;
-  background: linear-gradient(rgba(var(--color-black-rgb), 0.4), rgba(var(--color-black-rgb), 0.7)), url("../img/onfocus-video-bg.jpg") center center;
-  background-size: cover;
-}
-
-.onfocus .content {
-  background: linear-gradient(rgba(var(--color-secondary-rgb), 0.5), rgba(var(--color-secondary-rgb), 0.8)), url("../img/onfocus-content-bg.jpg") center center;
-  background-size: cover;
-  color: rgba(var(--color-white-rgb), 0.8);
-  padding: 40px;
-}
-
 @media (min-width: 768px) {
   .onfocus .content {
     padding: 80px;
   }
 }
 
 .onfocus .content h3 {
@@ -1475,23 +1336,18 @@
 }
 
 .onfocus .play-btn:before {
   content: "";
   position: absolute;
   width: 120px;
   height: 120px;
-  -webkit-animation-delay: 0s;
   animation-delay: 0s;
-  -webkit-animation: pulsate-btn 2s;
   animation: pulsate-btn 2s;
-  -webkit-animation-direction: forwards;
   animation-direction: forwards;
-  -webkit-animation-iteration-count: infinite;
   animation-iteration-count: infinite;
-  -webkit-animation-timing-function: steps;
   animation-timing-function: steps;
   opacity: 1;
   border-radius: 50%;
   border: 5px solid rgba(var(--color-primary-rgb), 0.7);
   top: -15%;
   left: -15%;
   background: rgba(198, 16, 0, 0);
@@ -1521,36 +1377,23 @@
   width: 0;
   height: 0;
   border: none;
   border-top: 10px solid transparent;
   border-bottom: 10px solid transparent;
   border-left: 15px solid var(--color-white);
   z-index: 200;
-  -webkit-animation: none;
   animation: none;
   border-radius: 0;
 }
 
 .onfocus .play-btn:hover:after {
   border-left: 15px solid var(--color-primary);
   transform: scale(20);
 }
 
-@-webkit-keyframes pulsate-btn {
-  0% {
-    transform: scale(0.6, 0.6);
-    opacity: 1;
-  }
-
-  100% {
-    transform: scale(1, 1);
-    opacity: 0;
-  }
-}
-
 @keyframes pulsate-btn {
   0% {
     transform: scale(0.6, 0.6);
     opacity: 1;
   }
 
   100% {
@@ -1612,15 +1455,14 @@
 }
 
 .features .tab-content {
   margin-top: 30px;
 }
 
 .features .tab-pane.active {
-  -webkit-animation: fadeIn 0.5s ease-out;
   animation: fadeIn 0.5s ease-out;
 }
 
 .features .tab-pane h3 {
   font-weight: 600;
   font-size: 36px;
   color: var(--color-secondary);
@@ -1728,21 +1570,15 @@
 .services .service-item:hover .img img {
   transform: scale(1.2);
 }
 
 /*--------------------------------------------------------------
 # Testimonials Section
 --------------------------------------------------------------*/
-.testimonials {
-  padding: 80px 0;
-  background: url("../img/testimonials-bg.jpg") no-repeat;
-  background-position: center center;
-  background-size: cover;
-  position: relative;
-}
+
 
 .testimonials::before {
   content: "";
   position: absolute;
   inset: 0;
   background: rgba(var(--color-secondary-dark-rgb), 0.8);
 }
@@ -1854,21 +1690,14 @@
   display: flex;
   flex-direction: column;
   border: 4px solid var(--color-white);
   border-radius: 10px;
   overflow: hidden;
 }
 
-.pricing .pricing-header {
-  background: linear-gradient(rgba(var(--color-secondary-rgb), 0.9), rgba(var(--color-secondary-rgb), 0.9)), url("../img/pricing-bg.jpg") center center;
-  background-size: cover;
-  text-align: center;
-  padding: 40px;
-  margin: -60px -40px 0;
-}
 
 .pricing h3 {
   font-weight: 600;
   margin-bottom: 5px;
   font-size: 36px;
   color: var(--color-white);
 }
@@ -2413,15 +2242,14 @@
   display: inline-block;
   border-radius: 50%;
   width: 24px;
   height: 24px;
   margin: 0 10px -6px 0;
   border: 3px solid var(--color-green);
   border-top-color: var(--color-white);
-  -webkit-animation: animate-loading 1s linear infinite;
   animation: animate-loading 1s linear infinite;
 }
 
 .contact .php-email-form input[type=text],
 .contact .php-email-form input[type=email],
 .contact .php-email-form textarea {
   border-radius: 0px;
@@ -2455,24 +2283,14 @@
   border-radius: 0;
 }
 
 .contact .php-email-form button[type=submit]:hover {
   background: rgba(var(--color-primary-rgb), 0.85);
 }
 
-@-webkit-keyframes animate-loading {
-  0% {
-    transform: rotate(0deg);
-  }
-
-  100% {
-    transform: rotate(360deg);
-  }
-}
-
 @keyframes animate-loading {
   0% {
     transform: rotate(0deg);
   }
 
   100% {
     transform: rotate(360deg);
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-blue.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-blue.css`

 * *Files 3% similar despite different names*

```diff
@@ -15,14 +15,20 @@
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
+
+  /* Fonts */
+  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-green.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-purple.css`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 /**
 * Template Name: HeroBiz
-* File: variables-green.css
+* File: variables-purple.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
@@ -15,42 +15,48 @@
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
+
+  /* Fonts */
+  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #05c46b;
-  --color-links-hover: #1de789;
+  --color-links: #6261c5;
+  --color-links-hover: #7d7bfd;
 
   /* Primay colors */
-  --color-primary: #05c46b;
-  --color-primary-light: #1de789;
-  --color-primary-dark: #01a156;
-
-  --color-primary-rgb: 5, 196, 107;
-  --color-primary-light-rgb: 29, 231, 137;
-  --color-primary-dark-rgb: 1, 161, 86;
+  --color-primary: #6261c5;
+  --color-primary-light: #7d7bfd;
+  --color-primary-dark: #4b49aa;
+
+  --color-primary-rgb: 98, 97, 197;
+  --color-primary-light-rgb: 125, 123, 253;
+  --color-primary-dark-rgb: 75, 73, 170;
 
   /* Secondary colors */
-  --color-secondary: #485664;
-  --color-secondary-light: #8f9fae;
-  --color-secondary-dark: #3a4753;
-
-  --color-secondary-rgb: 72, 86, 100;
-  --color-secondary-light-rgb: 143, 159, 174;
-  --color-secondary-dark-rgb: 58, 71, 83;
+  --color-secondary: #56556b;
+  --color-secondary-light: #7c7b94;
+  --color-secondary-dark: #343346;
+
+  --color-secondary-rgb: 86, 85, 107;
+  --color-secondary-light-rgb: 124, 123, 148;
+  --color-secondary-dark-rgb: 52, 51, 70;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-orange.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-green.css`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 /**
 * Template Name: HeroBiz
-* File: variables-orange.css
+* File: variables-green.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
@@ -15,33 +15,39 @@
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
+
+  /* Fonts */
+  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #f97233;
-  --color-links-hover: #fa9160;
+  --color-links: #05c46b;
+  --color-links-hover: #1de789;
 
   /* Primay colors */
-  --color-primary: #f97233;
-  --color-primary-light: #fb9b6e;
-  --color-primary-dark: #e54d07;
-
-  --color-primary-rgb: 249, 114, 51;
-  --color-primary-light-rgb: 251, 155, 110;
-  --color-primary-dark-rgb: 229, 77, 7;
+  --color-primary: #05c46b;
+  --color-primary-light: #1de789;
+  --color-primary-dark: #01a156;
+
+  --color-primary-rgb: 5, 196, 107;
+  --color-primary-light-rgb: 29, 231, 137;
+  --color-primary-dark-rgb: 1, 161, 86;
 
   /* Secondary colors */
   --color-secondary: #485664;
   --color-secondary-light: #8f9fae;
   --color-secondary-dark: #3a4753;
 
   --color-secondary-rgb: 72, 86, 100;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-pink.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-purple.css`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 /**
 * Template Name: HeroBiz
-* File: variables-pink.css
+* File: variables-purple.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
@@ -15,42 +15,48 @@
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
+
+  /* Fonts */
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #f3268c;
-  --color-links-hover: #ff83c1;
+  --color-links: #6261c5;
+  --color-links-hover: #7d7bfd;
 
   /* Primay colors */
-  --color-primary: #f3268c;
-  --color-primary-light: #ff83c1;
-  --color-primary-dark: #cc1571;
-
-  --color-primary-rgb: 243, 38, 140;
-  --color-primary-light-rgb: 255, 131, 193;
-  --color-primary-dark-rgb: 204, 21, 113;
+  --color-primary: #6261c5;
+  --color-primary-light: #7d7bfd;
+  --color-primary-dark: #4b49aa;
+
+  --color-primary-rgb: 98, 97, 197;
+  --color-primary-light-rgb: 125, 123, 253;
+  --color-primary-dark-rgb: 75, 73, 170;
 
   /* Secondary colors */
-  --color-secondary: #61768b;
-  --color-secondary-light: #778da3;
-  --color-secondary-dark: #4e6377;
-
-  --color-secondary-rgb: 97, 118, 139;
-  --color-secondary-light-rgb: 119, 141, 163;
-  --color-secondary-dark-rgb: 78, 99, 119;
+  --color-secondary: #56556b;
+  --color-secondary-light: #7c7b94;
+  --color-secondary-dark: #343346;
+
+  --color-secondary-rgb: 86, 85, 107;
+  --color-secondary-light-rgb: 124, 123, 148;
+  --color-secondary-dark-rgb: 52, 51, 70;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-purple.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-green.css`

 * *Files 11% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 /**
 * Template Name: HeroBiz
-* File: variables-purple.css
+* File: variables-green.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
@@ -16,42 +16,47 @@
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
+  /* Fonts */
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #6261c5;
-  --color-links-hover: #7d7bfd;
+  --color-links: #05c46b;
+  --color-links-hover: #1de789;
 
   /* Primay colors */
-  --color-primary: #6261c5;
-  --color-primary-light: #7d7bfd;
-  --color-primary-dark: #4b49aa;
-
-  --color-primary-rgb: 98, 97, 197;
-  --color-primary-light-rgb: 125, 123, 253;
-  --color-primary-dark-rgb: 75, 73, 170;
+  --color-primary: #05c46b;
+  --color-primary-light: #1de789;
+  --color-primary-dark: #01a156;
+
+  --color-primary-rgb: 5, 196, 107;
+  --color-primary-light-rgb: 29, 231, 137;
+  --color-primary-dark-rgb: 1, 161, 86;
 
   /* Secondary colors */
-  --color-secondary: #56556b;
-  --color-secondary-light: #7c7b94;
-  --color-secondary-dark: #343346;
-
-  --color-secondary-rgb: 86, 85, 107;
-  --color-secondary-light-rgb: 124, 123, 148;
-  --color-secondary-dark-rgb: 52, 51, 70;
+  --color-secondary: #485664;
+  --color-secondary-light: #8f9fae;
+  --color-secondary-dark: #3a4753;
+
+  --color-secondary-rgb: 72, 86, 100;
+  --color-secondary-light-rgb: 143, 159, 174;
+  --color-secondary-dark-rgb: 58, 71, 83;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables-red.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-pink.css`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 /**
 * Template Name: HeroBiz
-* File: variables-red.css
+* File: variables-pink.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
@@ -15,42 +15,48 @@
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
+
+  /* Fonts */
+  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #df1529;
-  --color-links-hover: #ff2b2b;
+  --color-links: #f3268c;
+  --color-links-hover: #ff83c1;
 
   /* Primay colors */
-  --color-primary: #df1529;
-  --color-primary-light: #ff2b2b;
-  --color-primary-dark: #c00719;
-
-  --color-primary-rgb: 223, 21, 41;
-  --color-primary-light-rgb: 255, 43, 43;
-  --color-primary-dark-rgb: 192, 7, 25;
+  --color-primary: #f3268c;
+  --color-primary-light: #ff83c1;
+  --color-primary-dark: #cc1571;
+
+  --color-primary-rgb: 243, 38, 140;
+  --color-primary-light-rgb: 255, 131, 193;
+  --color-primary-dark-rgb: 204, 21, 113;
 
   /* Secondary colors */
-  --color-secondary: #485664;
-  --color-secondary-light: #8f9fae;
-  --color-secondary-dark: #3a4753;
-
-  --color-secondary-rgb: 72, 86, 100;
-  --color-secondary-light-rgb: 143, 159, 174;
-  --color-secondary-dark-rgb: 58, 71, 83;
+  --color-secondary: #61768b;
+  --color-secondary-light: #778da3;
+  --color-secondary-dark: #4e6377;
+
+  --color-secondary-rgb: 97, 118, 139;
+  --color-secondary-light-rgb: 119, 141, 163;
+  --color-secondary-dark-rgb: 78, 99, 119;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/css/variables.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-blue.css`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 /**
 * Template Name: HeroBiz
-* File: variables.css
+* File: variables-blue.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
 * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
@@ -15,42 +15,48 @@
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
 # 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
+
+  /* Fonts */
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
+
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #0ea2bd;
-  --color-links-hover: #1ec3e0;
+  --color-links: #3279fc;
+  --color-links-hover: #4797ff;
 
   /* Primay colors */
-  --color-primary: #0ea2bd;
-  --color-primary-light: #1ec3e0;
-  --color-primary-dark: #0189a1;
-
-  --color-primary-rgb: 14, 162, 189;
-  --color-primary-light-rgb: 30, 195, 224;
-  --color-primary-dark-rgb: 1, 137, 161;
+  --color-primary: #3279fc;
+  --color-primary-light: #4797ff;
+  --color-primary-dark: #1c61e2;
+
+  --color-primary-rgb: 50, 121, 252;
+  --color-primary-light-rgb: 71, 151, 255;
+  --color-primary-dark-rgb: 28, 97, 226;
 
   /* Secondary colors */
-  --color-secondary: #485664;
-  --color-secondary-light: #8f9fae;
-  --color-secondary-dark: #3a4753;
-
-  --color-secondary-rgb: 72, 86, 100;
-  --color-secondary-light-rgb: 143, 159, 174;
-  --color-secondary-dark-rgb: 58, 71, 83;
+  --color-secondary: #5670a0;
+  --color-secondary-light: #6e87b6;
+  --color-secondary-dark: #3b5380;
+
+  --color-secondary-rgb: 86, 112, 160;
+  --color-secondary-light-rgb: 110, 135, 182;
+  --color-secondary-dark-rgb: 59, 83, 128;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/js/main.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/js/main.js`

 * *Files 27% similar despite different names*

#### js-beautify {}

```diff
@@ -1,297 +1,299 @@
-/**
- * Template Name: herobizds - v2.3.1
- * Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
- * Author: BootstrapMade.com
- * License: https://bootstrapmade.com/license/
- */
-document.addEventListener('DOMContentLoaded', () => {
-    "use strict";
-
-    /**
-     * Preloader
-     */
-    const preloader = document.querySelector('#preloader');
-    if (preloader) {
-        window.addEventListener('load', () => {
-            preloader.remove();
-        });
-    }
-
-    /**
-     * Sticky header on scroll
-     */
-    const selectHeader = document.querySelector('#header');
-    if (selectHeader) {
-        document.addEventListener('scroll', () => {
-            window.scrollY > 100 ? selectHeader.classList.add('sticked') : selectHeader.classList.remove('sticked');
-        });
-    }
-
-    /**
-     * Navbar links active state on scroll
-     */
-    let navbarlinks = document.querySelectorAll('#navbar .scrollto');
-
-    function navbarlinksActive() {
-        navbarlinks.forEach(navbarlink => {
-
-            if (!navbarlink.hash) return;
-
-            let section = document.querySelector(navbarlink.hash);
-            if (!section) return;
-
-            let position = window.scrollY;
-            if (navbarlink.hash != '#header') position += 200;
-
-            if (position >= section.offsetTop && position <= (section.offsetTop + section.offsetHeight)) {
-                navbarlink.classList.add('active');
-            } else {
-                navbarlink.classList.remove('active');
-            }
-        })
-    }
-    window.addEventListener('load', navbarlinksActive);
-    document.addEventListener('scroll', navbarlinksActive);
-
-    /**
-     * Function to scroll to an element with top ofset
-     */
-    function scrollto(el) {
-        const selectHeader = document.querySelector('#header');
-        let offset = 0;
-
-        if (selectHeader.classList.contains('sticked')) {
-            offset = document.querySelector('#header.sticked').offsetHeight;
-        } else if (selectHeader.hasAttribute('data-scrollto-offset')) {
-            offset = selectHeader.offsetHeight - parseInt(selectHeader.getAttribute('data-scrollto-offset'));
-        }
-        window.scrollTo({
-            top: document.querySelector(el).offsetTop - offset,
-            behavior: 'smooth'
-        });
-    }
-
-    /**
-     * Fires the scrollto function on click to links .scrollto
-     */
-    let selectScrollto = document.querySelectorAll('.scrollto');
-    selectScrollto.forEach(el => el.addEventListener('click', function(event) {
-        if (document.querySelector(this.hash)) {
-            event.preventDefault();
-
-            let mobileNavActive = document.querySelector('.mobile-nav-active');
-            if (mobileNavActive) {
-                mobileNavActive.classList.remove('mobile-nav-active');
-
-                let navbarToggle = document.querySelector('.mobile-nav-toggle');
-                navbarToggle.classList.toggle('bi-list');
-                navbarToggle.classList.toggle('bi-x');
-            }
-            scrollto(this.hash);
-        }
-    }));
-
-    /**
-     * Scroll with ofset on page load with hash links in the url
-     */
-    window.addEventListener('load', () => {
-        if (window.location.hash) {
-            if (document.querySelector(window.location.hash)) {
-                scrollto(window.location.hash);
-            }
-        }
-    });
-
-    /**
-     * Mobile nav toggle
-     */
-    const mobileNavToogle = document.querySelector('.mobile-nav-toggle');
-    if (mobileNavToogle) {
-        mobileNavToogle.addEventListener('click', function(event) {
-            event.preventDefault();
-
-            document.querySelector('body').classList.toggle('mobile-nav-active');
-
-            this.classList.toggle('bi-list');
-            this.classList.toggle('bi-x');
-        });
-    }
-
-    /**
-     * Toggle mobile nav dropdowns
-     */
-    const navDropdowns = document.querySelectorAll('.navbar .dropdown > a');
-
-    navDropdowns.forEach(el => {
-        el.addEventListener('click', function(event) {
-            if (document.querySelector('.mobile-nav-active')) {
-                event.preventDefault();
-                this.classList.toggle('active');
-                this.nextElementSibling.classList.toggle('dropdown-active');
-
-                let dropDownIndicator = this.querySelector('.dropdown-indicator');
-                dropDownIndicator.classList.toggle('bi-chevron-up');
-                dropDownIndicator.classList.toggle('bi-chevron-down');
-            }
-        })
-    });
-
-    /**
-     * Auto generate the hero carousel indicators
-     */
-    let heroCarouselIndicators = document.querySelector('#hero .carousel-indicators');
-    if (heroCarouselIndicators) {
-        let heroCarouselItems = document.querySelectorAll('#hero .carousel-item')
-
-        heroCarouselItems.forEach((item, index) => {
-            if (index === 0) {
-                heroCarouselIndicators.innerHTML += `<li data-bs-target="#hero" data-bs-slide-to="${index}" class="active"></li>`;
-            } else {
-                heroCarouselIndicators.innerHTML += `<li data-bs-target="#hero" data-bs-slide-to="${index}"></li>`;
-            }
-        });
-    }
-
-    /**
-     * Scroll top button
-     */
-    const scrollTop = document.querySelector('.scroll-top');
-    if (scrollTop) {
-        const togglescrollTop = function() {
-            window.scrollY > 100 ? scrollTop.classList.add('active') : scrollTop.classList.remove('active');
-        }
-        window.addEventListener('load', togglescrollTop);
-        document.addEventListener('scroll', togglescrollTop);
-        scrollTop.addEventListener('click', window.scrollTo({
-            top: 0,
-            behavior: 'smooth'
-        }));
-    }
-
-    /**
-     * Initiate glightbox
-     */
-    const glightbox = GLightbox({
-        selector: '.glightbox'
-    });
-
-    /**
-     * Porfolio isotope and filter
-     */
-    let portfolionIsotope = document.querySelector('.portfolio-isotope');
-
-    if (portfolionIsotope) {
-
-        let portfolioFilter = portfolionIsotope.getAttribute('data-portfolio-filter') ? portfolionIsotope.getAttribute('data-portfolio-filter') : '*';
-        let portfolioLayout = portfolionIsotope.getAttribute('data-portfolio-layout') ? portfolionIsotope.getAttribute('data-portfolio-layout') : 'masonry';
-        let portfolioSort = portfolionIsotope.getAttribute('data-portfolio-sort') ? portfolionIsotope.getAttribute('data-portfolio-sort') : 'original-order';
-
-        window.addEventListener('load', () => {
-            let portfolioIsotope = new Isotope(document.querySelector('.portfolio-container'), {
-                itemSelector: '.portfolio-item',
-                layoutMode: portfolioLayout,
-                filter: portfolioFilter,
-                sortBy: portfolioSort
-            });
-
-            let menuFilters = document.querySelectorAll('.portfolio-isotope .portfolio-flters li');
-            menuFilters.forEach(function(el) {
-                el.addEventListener('click', function() {
-                    document.querySelector('.portfolio-isotope .portfolio-flters .filter-active').classList.remove('filter-active');
-                    this.classList.add('filter-active');
-                    portfolioIsotope.arrange({
-                        filter: this.getAttribute('data-filter')
-                    });
-                    if (typeof aos_init === 'function') {
-                        aos_init();
-                    }
-                }, false);
-            });
-
-        });
-
-    }
-
-    /**
-     * Clients Slider
-     */
-    new Swiper('.clients-slider', {
-        speed: 400,
-        loop: true,
-        autoplay: {
-            delay: 5000,
-            disableOnInteraction: false
-        },
-        slidesPerView: 'auto',
-        breakpoints: {
-            320: {
-                slidesPerView: 2,
-                spaceBetween: 40
-            },
-            480: {
-                slidesPerView: 3,
-                spaceBetween: 60
-            },
-            640: {
-                slidesPerView: 4,
-                spaceBetween: 80
-            },
-            992: {
-                slidesPerView: 6,
-                spaceBetween: 120
-            }
-        }
-    });
-
-    /**
-     * Testimonials Slider
-     */
-    new Swiper('.testimonials-slider', {
-        speed: 600,
-        loop: true,
-        autoplay: {
-            delay: 5000,
-            disableOnInteraction: false
-        },
-        slidesPerView: 'auto',
-        pagination: {
-            el: '.swiper-pagination',
-            type: 'bullets',
-            clickable: true
-        }
-    });
-
-    /**
-     * Testimonials Slider
-     */
-    new Swiper('.portfolio-details-slider', {
-        speed: 600,
-        loop: true,
-        autoplay: {
-            delay: 5000,
-            disableOnInteraction: false
-        },
-        slidesPerView: 'auto',
-        pagination: {
-            el: '.swiper-pagination',
-            type: 'bullets',
-            clickable: true
-        }
-    });
-
-    /**
-     * Animation on scroll function and init
-     */
-    function aos_init() {
-        AOS.init({
-            duration: 1000,
-            easing: 'ease-in-out',
-            once: true,
-            mirror: false
-        });
-    }
-    window.addEventListener('load', () => {
-        aos_init();
-    });
-
+/**
+ * Template Name: HeroBiz
+ * Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
+ * Updated: Mar 17 2024 with Bootstrap v5.3.3
+ * Author: BootstrapMade.com
+ * License: https://bootstrapmade.com/license/
+ */
+
+document.addEventListener('DOMContentLoaded', () => {
+    "use strict";
+
+    /**
+     * Preloader
+     */
+    const preloader = document.querySelector('#preloader');
+    if (preloader) {
+        window.addEventListener('load', () => {
+            preloader.remove();
+        });
+    }
+
+    /**
+     * Sticky header on scroll
+     */
+    const selectHeader = document.querySelector('#header');
+    if (selectHeader) {
+        document.addEventListener('scroll', () => {
+            window.scrollY > 100 ? selectHeader.classList.add('sticked') : selectHeader.classList.remove('sticked');
+        });
+    }
+
+    /**
+     * Navbar links active state on scroll
+     */
+    let navbarlinks = document.querySelectorAll('#navbar .scrollto');
+
+    function navbarlinksActive() {
+        navbarlinks.forEach(navbarlink => {
+
+            if (!navbarlink.hash) return;
+
+            let section = document.querySelector(navbarlink.hash);
+            if (!section) return;
+
+            let position = window.scrollY;
+            if (navbarlink.hash != '#header') position += 200;
+
+            if (position >= section.offsetTop && position <= (section.offsetTop + section.offsetHeight)) {
+                navbarlink.classList.add('active');
+            } else {
+                navbarlink.classList.remove('active');
+            }
+        })
+    }
+    window.addEventListener('load', navbarlinksActive);
+    document.addEventListener('scroll', navbarlinksActive);
+
+    /**
+     * Function to scroll to an element with top ofset
+     */
+    function scrollto(el) {
+        const selectHeader = document.querySelector('#header');
+        let offset = 0;
+
+        if (selectHeader.classList.contains('sticked')) {
+            offset = document.querySelector('#header.sticked').offsetHeight;
+        } else if (selectHeader.hasAttribute('data-scrollto-offset')) {
+            offset = selectHeader.offsetHeight - parseInt(selectHeader.getAttribute('data-scrollto-offset'));
+        }
+        window.scrollTo({
+            top: document.querySelector(el).offsetTop - offset,
+            behavior: 'smooth'
+        });
+    }
+
+    /**
+     * Fires the scrollto function on click to links .scrollto
+     */
+    let selectScrollto = document.querySelectorAll('.scrollto');
+    selectScrollto.forEach(el => el.addEventListener('click', function(event) {
+        if (document.querySelector(this.hash)) {
+            event.preventDefault();
+
+            let mobileNavActive = document.querySelector('.mobile-nav-active');
+            if (mobileNavActive) {
+                mobileNavActive.classList.remove('mobile-nav-active');
+
+                let navbarToggle = document.querySelector('.mobile-nav-toggle');
+                navbarToggle.classList.toggle('bi-list');
+                navbarToggle.classList.toggle('bi-x');
+            }
+            scrollto(this.hash);
+        }
+    }));
+
+    /**
+     * Scroll with ofset on page load with hash links in the url
+     */
+    window.addEventListener('load', () => {
+        if (window.location.hash) {
+            if (document.querySelector(window.location.hash)) {
+                scrollto(window.location.hash);
+            }
+        }
+    });
+
+    /**
+     * Mobile nav toggle
+     */
+    const mobileNavToogle = document.querySelector('.mobile-nav-toggle');
+    if (mobileNavToogle) {
+        mobileNavToogle.addEventListener('click', function(event) {
+            event.preventDefault();
+
+            document.querySelector('body').classList.toggle('mobile-nav-active');
+
+            this.classList.toggle('bi-list');
+            this.classList.toggle('bi-x');
+        });
+    }
+
+    /**
+     * Toggle mobile nav dropdowns
+     */
+    const navDropdowns = document.querySelectorAll('.navbar .dropdown > a');
+
+    navDropdowns.forEach(el => {
+        el.addEventListener('click', function(event) {
+            if (document.querySelector('.mobile-nav-active')) {
+                event.preventDefault();
+                this.classList.toggle('active');
+                this.nextElementSibling.classList.toggle('dropdown-active');
+
+                let dropDownIndicator = this.querySelector('.dropdown-indicator');
+                dropDownIndicator.classList.toggle('bi-chevron-up');
+                dropDownIndicator.classList.toggle('bi-chevron-down');
+            }
+        })
+    });
+
+    /**
+     * Auto generate the hero carousel indicators
+     */
+    let heroCarouselIndicators = document.querySelector('#hero .carousel-indicators');
+    if (heroCarouselIndicators) {
+        let heroCarouselItems = document.querySelectorAll('#hero .carousel-item')
+
+        heroCarouselItems.forEach((item, index) => {
+            if (index === 0) {
+                heroCarouselIndicators.innerHTML += `<li data-bs-target="#hero" data-bs-slide-to="${index}" class="active"></li>`;
+            } else {
+                heroCarouselIndicators.innerHTML += `<li data-bs-target="#hero" data-bs-slide-to="${index}"></li>`;
+            }
+        });
+    }
+
+    /**
+     * Scroll top button
+     */
+    const scrollTop = document.querySelector('.scroll-top');
+    if (scrollTop) {
+        const togglescrollTop = function() {
+            window.scrollY > 100 ? scrollTop.classList.add('active') : scrollTop.classList.remove('active');
+        }
+        window.addEventListener('load', togglescrollTop);
+        document.addEventListener('scroll', togglescrollTop);
+        scrollTop.addEventListener('click', window.scrollTo({
+            top: 0,
+            behavior: 'smooth'
+        }));
+    }
+
+    /**
+     * Initiate glightbox
+     */
+    const glightbox = GLightbox({
+        selector: '.glightbox'
+    });
+
+    /**
+     * Porfolio isotope and filter
+     */
+    let portfolionIsotope = document.querySelector('.portfolio-isotope');
+
+    if (portfolionIsotope) {
+
+        let portfolioFilter = portfolionIsotope.getAttribute('data-portfolio-filter') ? portfolionIsotope.getAttribute('data-portfolio-filter') : '*';
+        let portfolioLayout = portfolionIsotope.getAttribute('data-portfolio-layout') ? portfolionIsotope.getAttribute('data-portfolio-layout') : 'masonry';
+        let portfolioSort = portfolionIsotope.getAttribute('data-portfolio-sort') ? portfolionIsotope.getAttribute('data-portfolio-sort') : 'original-order';
+
+        window.addEventListener('load', () => {
+            let portfolioIsotope = new Isotope(document.querySelector('.portfolio-container'), {
+                itemSelector: '.portfolio-item',
+                layoutMode: portfolioLayout,
+                filter: portfolioFilter,
+                sortBy: portfolioSort
+            });
+
+            let menuFilters = document.querySelectorAll('.portfolio-isotope .portfolio-flters li');
+            menuFilters.forEach(function(el) {
+                el.addEventListener('click', function() {
+                    document.querySelector('.portfolio-isotope .portfolio-flters .filter-active').classList.remove('filter-active');
+                    this.classList.add('filter-active');
+                    portfolioIsotope.arrange({
+                        filter: this.getAttribute('data-filter')
+                    });
+                    if (typeof aos_init === 'function') {
+                        aos_init();
+                    }
+                }, false);
+            });
+
+        });
+
+    }
+
+    /**
+     * Clients Slider
+     */
+    new Swiper('.clients-slider', {
+        speed: 400,
+        loop: true,
+        autoplay: {
+            delay: 5000,
+            disableOnInteraction: false
+        },
+        slidesPerView: 'auto',
+        breakpoints: {
+            320: {
+                slidesPerView: 2,
+                spaceBetween: 40
+            },
+            480: {
+                slidesPerView: 3,
+                spaceBetween: 60
+            },
+            640: {
+                slidesPerView: 4,
+                spaceBetween: 80
+            },
+            992: {
+                slidesPerView: 6,
+                spaceBetween: 120
+            }
+        }
+    });
+
+    /**
+     * Testimonials Slider
+     */
+    new Swiper('.testimonials-slider', {
+        speed: 600,
+        loop: true,
+        autoplay: {
+            delay: 5000,
+            disableOnInteraction: false
+        },
+        slidesPerView: 'auto',
+        pagination: {
+            el: '.swiper-pagination',
+            type: 'bullets',
+            clickable: true
+        }
+    });
+
+    /**
+     * Testimonials Slider
+     */
+    new Swiper('.portfolio-details-slider', {
+        speed: 600,
+        loop: true,
+        autoplay: {
+            delay: 5000,
+            disableOnInteraction: false
+        },
+        slidesPerView: 'auto',
+        pagination: {
+            el: '.swiper-pagination',
+            type: 'bullets',
+            clickable: true
+        }
+    });
+
+    /**
+     * Animation on scroll function and init
+     */
+    function aos_init() {
+        AOS.init({
+            duration: 1000,
+            easing: 'ease-in-out',
+            once: true,
+            mirror: false
+        });
+    }
+    window.addEventListener('load', () => {
+        aos_init();
+    });
+
 });
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_footer.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_footer.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_general.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_general.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_header.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_header.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_nav.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_nav.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/_portfolio-details.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/_portfolio-details.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_comments.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_comments.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_details.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_details.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_pagination.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_pagination.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/blog/_sidebar.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/blog/_sidebar.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_about.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_about.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_contact.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_contact.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_cta.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_cta.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_faq.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_faq.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_featured-services.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_featured-services.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_features.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_features.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_hero-fullscreen.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero-fullscreen.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_hero-static.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero-static.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_hero.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_hero.scss`

 * *Files 8% similar despite different names*

```diff
@@ -1,26 +1,27 @@
 /*--------------------------------------------------------------
 # Carousel Hero Section
 --------------------------------------------------------------*/
 .hero {
   width: 100%;
-  min-height: 60vh;
   padding: 0;
   background: var(--color-black);
   background: url("../img/hero-bg.png") center center;
   background-size: cover;
   background-position: center;
   background-repeat: no-repeat;
   position: relative;
   display: flex;
   flex-direction: column;
   justify-content: center;
   padding: 140px 0 60px 0;
 
-
+  .carousel-item {
+    overflow: hidden;
+  }
   @media (max-width: 640px) {
     .container {
       padding: 0 60px;
     }
   }
   
   h2 {
@@ -110,14 +111,15 @@
 
     &:hover {
       opacity: .9;
     }
   }
 
   .carousel-indicators li {
+    list-style-type: none;
     cursor: pointer;
     background: rgba(var(--color-secondary-rgb), .5);
     overflow: hidden;
     border: 0;
     width: 12px;
     height: 12px;
     border-radius: 50px;
@@ -171,8 +173,8 @@
     transform: translate3d(0, -10%, 0);
   }
 
   to {
     opacity: 1;
     transform: translate3d(0, 0, 0);
   }
-}
+}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_portfolio.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_portfolio.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_pricing.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_pricing.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_recent-blog-posts.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_recent-blog-posts.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_services.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_services.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/index/_testimonials.scss` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/index/_testimonials.scss`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-blue.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-red.css`

 * *Files 2% similar despite different names*

```diff
@@ -1,62 +1,62 @@
 /**
-* Template Name: herobizds
-* File: variables-blue.css
+* Template Name: HeroBiz
+* File: variables-red.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
-  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
-  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
   --font-secondary: 'Poppins', sans-serif;
 
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #3279fc;
-  --color-links-hover: #4797ff;
+  --color-links: #df1529;
+  --color-links-hover: #ff2b2b;
 
   /* Primay colors */
-  --color-primary: #3279fc;
-  --color-primary-light: #4797ff;
-  --color-primary-dark: #1c61e2;
-
-  --color-primary-rgb: 50, 121, 252;
-  --color-primary-light-rgb: 71, 151, 255;
-  --color-primary-dark-rgb: 28, 97, 226;
+  --color-primary: #df1529;
+  --color-primary-light: #ff2b2b;
+  --color-primary-dark: #c00719;
+
+  --color-primary-rgb: 223, 21, 41;
+  --color-primary-light-rgb: 255, 43, 43;
+  --color-primary-dark-rgb: 192, 7, 25;
 
   /* Secondary colors */
-  --color-secondary: #5670a0;
-  --color-secondary-light: #6e87b6;
-  --color-secondary-dark: #3b5380;
-
-  --color-secondary-rgb: 86, 112, 160;
-  --color-secondary-light-rgb: 110, 135, 182;
-  --color-secondary-dark-rgb: 59, 83, 128;
+  --color-secondary: #485664;
+  --color-secondary-light: #8f9fae;
+  --color-secondary-dark: #3a4753;
+
+  --color-secondary-rgb: 72, 86, 100;
+  --color-secondary-light-rgb: 143, 159, 174;
+  --color-secondary-dark-rgb: 58, 71, 83;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-green.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-red.css`

 * *Files 3% similar despite different names*

```diff
@@ -1,26 +1,26 @@
 /**
-* Template Name: herobizds
-* File: variables-green.css
+* Template Name: HeroBiz
+* File: variables-red.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
   --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
   --font-primary: 'Source Sans Pro', sans-serif;
   --font-secondary: 'Poppins', sans-serif;
@@ -29,25 +29,25 @@
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #05c46b;
-  --color-links-hover: #1de789;
+  --color-links: #df1529;
+  --color-links-hover: #ff2b2b;
 
   /* Primay colors */
-  --color-primary: #05c46b;
-  --color-primary-light: #1de789;
-  --color-primary-dark: #01a156;
-
-  --color-primary-rgb: 5, 196, 107;
-  --color-primary-light-rgb: 29, 231, 137;
-  --color-primary-dark-rgb: 1, 161, 86;
+  --color-primary: #df1529;
+  --color-primary-light: #ff2b2b;
+  --color-primary-dark: #c00719;
+
+  --color-primary-rgb: 223, 21, 41;
+  --color-primary-light-rgb: 255, 43, 43;
+  --color-primary-dark-rgb: 192, 7, 25;
 
   /* Secondary colors */
   --color-secondary: #485664;
   --color-secondary-light: #8f9fae;
   --color-secondary-dark: #3a4753;
 
   --color-secondary-rgb: 72, 86, 100;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-orange.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables-orange.css`

 * *Files 2% similar despite different names*

```diff
@@ -1,26 +1,26 @@
 /**
-* Template Name: herobizds
+* Template Name: HeroBiz
 * File: variables-orange.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
   --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
   --font-primary: 'Source Sans Pro', sans-serif;
   --font-secondary: 'Poppins', sans-serif;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-pink.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-pink.css`

 * *Files 2% similar despite different names*

```diff
@@ -1,32 +1,32 @@
 /**
-* Template Name: herobizds
+* Template Name: HeroBiz
 * File: variables-pink.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
-  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
-  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
   --font-secondary: 'Poppins', sans-serif;
 
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-purple.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables.css`

 * *Files 3% similar despite different names*

```diff
@@ -1,62 +1,62 @@
 /**
-* Template Name: herobizds
-* File: variables-purple.css
+* Template Name: HeroBiz
+* File: variables.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
-  --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
-  --font-primary: 'Source Sans Pro', sans-serif;
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
   --font-secondary: 'Poppins', sans-serif;
 
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #6261c5;
-  --color-links-hover: #7d7bfd;
+  --color-links: #0ea2bd;
+  --color-links-hover: #1ec3e0;
 
   /* Primay colors */
-  --color-primary: #6261c5;
-  --color-primary-light: #7d7bfd;
-  --color-primary-dark: #4b49aa;
-
-  --color-primary-rgb: 98, 97, 197;
-  --color-primary-light-rgb: 125, 123, 253;
-  --color-primary-dark-rgb: 75, 73, 170;
+  --color-primary: #0ea2bd;
+  --color-primary-light: #1ec3e0;
+  --color-primary-dark: #0189a1;
+
+  --color-primary-rgb: 14, 162, 189;
+  --color-primary-light-rgb: 30, 195, 224;
+  --color-primary-dark-rgb: 1, 137, 161;
 
   /* Secondary colors */
-  --color-secondary: #56556b;
-  --color-secondary-light: #7c7b94;
-  --color-secondary-dark: #343346;
-
-  --color-secondary-rgb: 86, 85, 107;
-  --color-secondary-light-rgb: 124, 123, 148;
-  --color-secondary-dark-rgb: 52, 51, 70;
+  --color-secondary: #485664;
+  --color-secondary-light: #8f9fae;
+  --color-secondary-dark: #3a4753;
+
+  --color-secondary-rgb: 72, 86, 100;
+  --color-secondary-light-rgb: 143, 159, 174;
+  --color-secondary-dark-rgb: 58, 71, 83;
 
   /* General colors */
   --color-blue: #0d6efd;
   --color-blue-rgb: 13, 110, 253;
 
   --color-indigo: #6610f2;
   --color-indigo-rgb: 102, 16, 242;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables-red.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/scss/variables.css`

 * *Files 2% similar despite different names*

```diff
@@ -1,26 +1,26 @@
 /**
-* Template Name: herobizds
-* File: variables-red.css
+* Template Name: HeroBiz
+* File: variables.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
   --font-default: 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
   --font-primary: 'Source Sans Pro', sans-serif;
   --font-secondary: 'Poppins', sans-serif;
@@ -29,25 +29,25 @@
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #df1529;
-  --color-links-hover: #ff2b2b;
+  --color-links: #0ea2bd;
+  --color-links-hover: #1ec3e0;
 
   /* Primay colors */
-  --color-primary: #df1529;
-  --color-primary-light: #ff2b2b;
-  --color-primary-dark: #c00719;
-
-  --color-primary-rgb: 223, 21, 41;
-  --color-primary-light-rgb: 255, 43, 43;
-  --color-primary-dark-rgb: 192, 7, 25;
+  --color-primary: #0ea2bd;
+  --color-primary-light: #1ec3e0;
+  --color-primary-dark: #0189a1;
+
+  --color-primary-rgb: 14, 162, 189;
+  --color-primary-light-rgb: 30, 195, 224;
+  --color-primary-dark-rgb: 1, 137, 161;
 
   /* Secondary colors */
   --color-secondary: #485664;
   --color-secondary-light: #8f9fae;
   --color-secondary-dark: #3a4753;
 
   --color-secondary-rgb: 72, 86, 100;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/scss/variables.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/css/variables-orange.css`

 * *Files 4% similar despite different names*

```diff
@@ -1,53 +1,53 @@
 /**
-* Template Name: herobizds
-* File: variables.css
+* Template Name: HeroBiz
+* File: variables-orange.css
 * Description: Easily customize colors, typography, and other repetitive properties used in the template main stylesheet file main.css
 * 
-* Template URL: https://bootstrapmade.com/herobizds-bootstrap-business-template/
+* Template URL: https://bootstrapmade.com/herobiz-bootstrap-business-template/
 * Author: BootstrapMade.com
 * License: https://bootstrapmade.com/license/
 * 
 * Contents:
-* 1. herobizds template variables
+* 1. HeroBiz template variables 
 * 2. Override default Bootstrap variables
 * 3. Set color and background class names
 *
 * Learn more about CSS variables at https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties
 */
 
 /*--------------------------------------------------------------
-# 1. herobizds template variables
+# 1. HeroBiz template variables 
 --------------------------------------------------------------*/
 :root {
 
   /* Fonts */
-  --font-default: 'Open Sans', 'Noto Sans Kr', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
-  --font-primary: 'Source Sans Pro', 'Hahmlet', sans-serif;
-  --font-secondary: 'Poppins', 'Noto Serif KR', sans-serif;
+  --font-default: 'Noto Sans KR', 'Open Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
+  --font-primary: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
+  --font-secondary: 'Poppins', sans-serif;
 
   /* Colors */
   /* The *-rgb color names are simply the RGB converted value of the corresponding color for use in the rgba() function */
 
   /* Default text color */
   --color-default: #1a1f24;
   --color-default-rgb: 26, 31, 36;
 
   /* Defult links color */
-  --color-links: #0ea2bd;
-  --color-links-hover: #1ec3e0;
+  --color-links: #f97233;
+  --color-links-hover: #fa9160;
 
   /* Primay colors */
-  --color-primary: #0ea2bd;
-  --color-primary-light: #1ec3e0;
-  --color-primary-dark: #0189a1;
-
-  --color-primary-rgb: 14, 162, 189;
-  --color-primary-light-rgb: 30, 195, 224;
-  --color-primary-dark-rgb: 1, 137, 161;
+  --color-primary: #f97233;
+  --color-primary-light: #fb9b6e;
+  --color-primary-dark: #e54d07;
+
+  --color-primary-rgb: 249, 114, 51;
+  --color-primary-light-rgb: 251, 155, 110;
+  --color-primary-dark-rgb: 229, 77, 7;
 
   /* Secondary colors */
   --color-secondary: #485664;
   --color-secondary-light: #8f9fae;
   --color-secondary-dark: #3a4753;
 
   --color-secondary-rgb: 72, 86, 100;
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/aos/aos.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/aos/aos.js`

 * *Files 18% similar despite different names*

#### js-beautify {}

```diff
@@ -1,546 +1,448 @@
 ! function(e, t) {
-    "object" == typeof exports && "object" == typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports ? exports.AOS = t() : e.AOS = t()
+    "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.AOS = t()
 }(this, function() {
-    return function(e) {
-        function t(o) {
-            if (n[o]) return n[o].exports;
-            var i = n[o] = {
-                exports: {},
-                id: o,
-                loaded: !1
-            };
-            return e[o].call(i.exports, i, i.exports, t), i.loaded = !0, i.exports
-        }
-        var n = {};
-        return t.m = e, t.c = n, t.p = "dist/", t(0)
-    }([function(e, t, n) {
-        "use strict";
-
-        function o(e) {
-            return e && e.__esModule ? e : {
-                default: e
-            }
-        }
-        var i = Object.assign || function(e) {
-                for (var t = 1; t < arguments.length; t++) {
-                    var n = arguments[t];
-                    for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o])
-                }
-                return e
-            },
-            r = n(1),
-            a = (o(r), n(6)),
-            u = o(a),
-            c = n(7),
-            s = o(c),
-            f = n(8),
-            d = o(f),
-            l = n(9),
-            p = o(l),
-            m = n(10),
-            b = o(m),
-            v = n(11),
-            y = o(v),
-            g = n(14),
-            h = o(g),
-            w = [],
-            k = !1,
-            x = {
-                offset: 120,
-                delay: 0,
-                easing: "ease",
-                duration: 400,
-                disable: !1,
-                once: !1,
-                startEvent: "DOMContentLoaded",
-                throttleDelay: 99,
-                debounceDelay: 50,
-                disableMutationObserver: !1
-            },
-            j = function() {
-                var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
-                if (e && (k = !0), k) return w = (0, y.default)(w, x), (0, b.default)(w, x.once), w
-            },
-            O = function() {
-                w = (0, h.default)(), j()
-            },
-            M = function() {
-                w.forEach(function(e, t) {
-                    e.node.removeAttribute("data-aos"), e.node.removeAttribute("data-aos-easing"), e.node.removeAttribute("data-aos-duration"), e.node.removeAttribute("data-aos-delay")
-                })
-            },
-            S = function(e) {
-                return e === !0 || "mobile" === e && p.default.mobile() || "phone" === e && p.default.phone() || "tablet" === e && p.default.tablet() || "function" == typeof e && e() === !0
-            },
-            _ = function(e) {
-                x = i(x, e), w = (0, h.default)();
-                var t = document.all && !window.atob;
-                return S(x.disable) || t ? M() : (x.disableMutationObserver || d.default.isSupported() || (console.info('\n      aos: MutationObserver is not supported on this browser,\n      code mutations observing has been disabled.\n      You may have to call "refreshHard()" by yourself.\n    '), x.disableMutationObserver = !0), document.querySelector("body").setAttribute("data-aos-easing", x.easing), document.querySelector("body").setAttribute("data-aos-duration", x.duration), document.querySelector("body").setAttribute("data-aos-delay", x.delay), "DOMContentLoaded" === x.startEvent && ["complete", "interactive"].indexOf(document.readyState) > -1 ? j(!0) : "load" === x.startEvent ? window.addEventListener(x.startEvent, function() {
-                    j(!0)
-                }) : document.addEventListener(x.startEvent, function() {
-                    j(!0)
-                }), window.addEventListener("resize", (0, s.default)(j, x.debounceDelay, !0)), window.addEventListener("orientationchange", (0, s.default)(j, x.debounceDelay, !0)), window.addEventListener("scroll", (0, u.default)(function() {
-                    (0, b.default)(w, x.once)
-                }, x.throttleDelay)), x.disableMutationObserver || d.default.ready("[data-aos]", O), w)
-            };
-        e.exports = {
-            init: _,
-            refresh: j,
-            refreshHard: O
-        }
-    }, function(e, t) {}, , , , , function(e, t) {
-        (function(t) {
-            "use strict";
-
-            function n(e, t, n) {
-                function o(t) {
-                    var n = b,
-                        o = v;
-                    return b = v = void 0, k = t, g = e.apply(o, n)
-                }
-
-                function r(e) {
-                    return k = e, h = setTimeout(f, t), M ? o(e) : g
-                }
-
-                function a(e) {
-                    var n = e - w,
-                        o = e - k,
-                        i = t - n;
-                    return S ? j(i, y - o) : i
-                }
-
-                function c(e) {
-                    var n = e - w,
-                        o = e - k;
-                    return void 0 === w || n >= t || n < 0 || S && o >= y
-                }
-
-                function f() {
-                    var e = O();
-                    return c(e) ? d(e) : void(h = setTimeout(f, a(e)))
-                }
-
-                function d(e) {
-                    return h = void 0, _ && b ? o(e) : (b = v = void 0, g)
-                }
-
-                function l() {
-                    void 0 !== h && clearTimeout(h), k = 0, b = w = v = h = void 0
-                }
-
-                function p() {
-                    return void 0 === h ? g : d(O())
-                }
-
-                function m() {
-                    var e = O(),
-                        n = c(e);
-                    if (b = arguments, v = this, w = e, n) {
-                        if (void 0 === h) return r(w);
-                        if (S) return h = setTimeout(f, t), o(w)
-                    }
-                    return void 0 === h && (h = setTimeout(f, t)), g
-                }
-                var b, v, y, g, h, w, k = 0,
-                    M = !1,
-                    S = !1,
-                    _ = !0;
-                if ("function" != typeof e) throw new TypeError(s);
-                return t = u(t) || 0, i(n) && (M = !!n.leading, S = "maxWait" in n, y = S ? x(u(n.maxWait) || 0, t) : y, _ = "trailing" in n ? !!n.trailing : _), m.cancel = l, m.flush = p, m
-            }
-
-            function o(e, t, o) {
-                var r = !0,
-                    a = !0;
-                if ("function" != typeof e) throw new TypeError(s);
-                return i(o) && (r = "leading" in o ? !!o.leading : r, a = "trailing" in o ? !!o.trailing : a), n(e, t, {
-                    leading: r,
-                    maxWait: t,
-                    trailing: a
-                })
-            }
-
-            function i(e) {
-                var t = "undefined" == typeof e ? "undefined" : c(e);
-                return !!e && ("object" == t || "function" == t)
-            }
-
-            function r(e) {
-                return !!e && "object" == ("undefined" == typeof e ? "undefined" : c(e))
-            }
-
-            function a(e) {
-                return "symbol" == ("undefined" == typeof e ? "undefined" : c(e)) || r(e) && k.call(e) == d
-            }
-
-            function u(e) {
-                if ("number" == typeof e) return e;
-                if (a(e)) return f;
-                if (i(e)) {
-                    var t = "function" == typeof e.valueOf ? e.valueOf() : e;
-                    e = i(t) ? t + "" : t
-                }
-                if ("string" != typeof e) return 0 === e ? e : +e;
-                e = e.replace(l, "");
-                var n = m.test(e);
-                return n || b.test(e) ? v(e.slice(2), n ? 2 : 8) : p.test(e) ? f : +e
-            }
-            var c = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
-                    return typeof e
-                } : function(e) {
-                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
-                },
-                s = "Expected a function",
-                f = NaN,
-                d = "[object Symbol]",
-                l = /^\s+|\s+$/g,
-                p = /^[-+]0x[0-9a-f]+$/i,
-                m = /^0b[01]+$/i,
-                b = /^0o[0-7]+$/i,
-                v = parseInt,
-                y = "object" == ("undefined" == typeof t ? "undefined" : c(t)) && t && t.Object === Object && t,
-                g = "object" == ("undefined" == typeof self ? "undefined" : c(self)) && self && self.Object === Object && self,
-                h = y || g || Function("return this")(),
-                w = Object.prototype,
-                k = w.toString,
-                x = Math.max,
-                j = Math.min,
-                O = function() {
-                    return h.Date.now()
-                };
-            e.exports = o
-        }).call(t, function() {
-            return this
-        }())
-    }, function(e, t) {
-        (function(t) {
-            "use strict";
-
-            function n(e, t, n) {
-                function i(t) {
-                    var n = b,
-                        o = v;
-                    return b = v = void 0, O = t, g = e.apply(o, n)
-                }
-
-                function r(e) {
-                    return O = e, h = setTimeout(f, t), M ? i(e) : g
-                }
-
-                function u(e) {
-                    var n = e - w,
-                        o = e - O,
-                        i = t - n;
-                    return S ? x(i, y - o) : i
-                }
-
-                function s(e) {
-                    var n = e - w,
-                        o = e - O;
-                    return void 0 === w || n >= t || n < 0 || S && o >= y
-                }
-
-                function f() {
-                    var e = j();
-                    return s(e) ? d(e) : void(h = setTimeout(f, u(e)))
-                }
-
-                function d(e) {
-                    return h = void 0, _ && b ? i(e) : (b = v = void 0, g)
-                }
-
-                function l() {
-                    void 0 !== h && clearTimeout(h), O = 0, b = w = v = h = void 0
-                }
-
-                function p() {
-                    return void 0 === h ? g : d(j())
-                }
-
-                function m() {
-                    var e = j(),
-                        n = s(e);
-                    if (b = arguments, v = this, w = e, n) {
-                        if (void 0 === h) return r(w);
-                        if (S) return h = setTimeout(f, t), i(w)
-                    }
-                    return void 0 === h && (h = setTimeout(f, t)), g
-                }
-                var b, v, y, g, h, w, O = 0,
-                    M = !1,
-                    S = !1,
-                    _ = !0;
-                if ("function" != typeof e) throw new TypeError(c);
-                return t = a(t) || 0, o(n) && (M = !!n.leading, S = "maxWait" in n, y = S ? k(a(n.maxWait) || 0, t) : y, _ = "trailing" in n ? !!n.trailing : _), m.cancel = l, m.flush = p, m
-            }
-
-            function o(e) {
-                var t = "undefined" == typeof e ? "undefined" : u(e);
-                return !!e && ("object" == t || "function" == t)
-            }
-
-            function i(e) {
-                return !!e && "object" == ("undefined" == typeof e ? "undefined" : u(e))
-            }
-
-            function r(e) {
-                return "symbol" == ("undefined" == typeof e ? "undefined" : u(e)) || i(e) && w.call(e) == f
-            }
-
-            function a(e) {
-                if ("number" == typeof e) return e;
-                if (r(e)) return s;
-                if (o(e)) {
-                    var t = "function" == typeof e.valueOf ? e.valueOf() : e;
-                    e = o(t) ? t + "" : t
-                }
-                if ("string" != typeof e) return 0 === e ? e : +e;
-                e = e.replace(d, "");
-                var n = p.test(e);
-                return n || m.test(e) ? b(e.slice(2), n ? 2 : 8) : l.test(e) ? s : +e
-            }
-            var u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
-                    return typeof e
-                } : function(e) {
-                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
-                },
-                c = "Expected a function",
-                s = NaN,
-                f = "[object Symbol]",
-                d = /^\s+|\s+$/g,
-                l = /^[-+]0x[0-9a-f]+$/i,
-                p = /^0b[01]+$/i,
-                m = /^0o[0-7]+$/i,
-                b = parseInt,
-                v = "object" == ("undefined" == typeof t ? "undefined" : u(t)) && t && t.Object === Object && t,
-                y = "object" == ("undefined" == typeof self ? "undefined" : u(self)) && self && self.Object === Object && self,
-                g = v || y || Function("return this")(),
-                h = Object.prototype,
-                w = h.toString,
-                k = Math.max,
-                x = Math.min,
-                j = function() {
-                    return g.Date.now()
-                };
-            e.exports = n
-        }).call(t, function() {
-            return this
-        }())
-    }, function(e, t) {
-        "use strict";
-
-        function n(e) {
-            var t = void 0,
-                o = void 0,
-                i = void 0;
-            for (t = 0; t < e.length; t += 1) {
-                if (o = e[t], o.dataset && o.dataset.aos) return !0;
-                if (i = o.children && n(o.children)) return !0
-            }
-            return !1
-        }
-
-        function o() {
-            return window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver
-        }
-
-        function i() {
-            return !!o()
-        }
-
-        function r(e, t) {
-            var n = window.document,
-                i = o(),
-                r = new i(a);
-            u = t, r.observe(n.documentElement, {
-                childList: !0,
-                subtree: !0,
-                removedNodes: !0
-            })
-        }
+    "use strict";
+    var e = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {},
+        t = "Expected a function",
+        n = NaN,
+        o = "[object Symbol]",
+        i = /^\s+|\s+$/g,
+        a = /^[-+]0x[0-9a-f]+$/i,
+        r = /^0b[01]+$/i,
+        c = /^0o[0-7]+$/i,
+        s = parseInt,
+        u = "object" == typeof e && e && e.Object === Object && e,
+        d = "object" == typeof self && self && self.Object === Object && self,
+        l = u || d || Function("return this")(),
+        f = Object.prototype.toString,
+        m = Math.max,
+        p = Math.min,
+        b = function() {
+            return l.Date.now()
+        };
 
-        function a(e) {
-            e && e.forEach(function(e) {
-                var t = Array.prototype.slice.call(e.addedNodes),
-                    o = Array.prototype.slice.call(e.removedNodes),
-                    i = t.concat(o);
-                if (n(i)) return u()
+    function v(e, n, o) {
+        var i, a, r, c, s, u, d = 0,
+            l = !1,
+            f = !1,
+            v = !0;
+        if ("function" != typeof e) throw new TypeError(t);
+
+        function y(t) {
+            var n = i,
+                o = a;
+            return i = a = void 0, d = t, c = e.apply(o, n)
+        }
+
+        function h(e) {
+            var t = e - u;
+            return void 0 === u || t >= n || t < 0 || f && e - d >= r
+        }
+
+        function k() {
+            var e = b();
+            if (h(e)) return x(e);
+            s = setTimeout(k, function(e) {
+                var t = n - (e - u);
+                return f ? p(t, r - (e - d)) : t
+            }(e))
+        }
+
+        function x(e) {
+            return s = void 0, v && i ? y(e) : (i = a = void 0, c)
+        }
+
+        function O() {
+            var e = b(),
+                t = h(e);
+            if (i = arguments, a = this, u = e, t) {
+                if (void 0 === s) return function(e) {
+                    return d = e, s = setTimeout(k, n), l ? y(e) : c
+                }(u);
+                if (f) return s = setTimeout(k, n), y(u)
+            }
+            return void 0 === s && (s = setTimeout(k, n)), c
+        }
+        return n = w(n) || 0, g(o) && (l = !!o.leading, r = (f = "maxWait" in o) ? m(w(o.maxWait) || 0, n) : r, v = "trailing" in o ? !!o.trailing : v), O.cancel = function() {
+            void 0 !== s && clearTimeout(s), d = 0, i = u = a = s = void 0
+        }, O.flush = function() {
+            return void 0 === s ? c : x(b())
+        }, O
+    }
+
+    function g(e) {
+        var t = typeof e;
+        return !!e && ("object" == t || "function" == t)
+    }
+
+    function w(e) {
+        if ("number" == typeof e) return e;
+        if (function(e) {
+                return "symbol" == typeof e || function(e) {
+                    return !!e && "object" == typeof e
+                }(e) && f.call(e) == o
+            }(e)) return n;
+        if (g(e)) {
+            var t = "function" == typeof e.valueOf ? e.valueOf() : e;
+            e = g(t) ? t + "" : t
+        }
+        if ("string" != typeof e) return 0 === e ? e : +e;
+        e = e.replace(i, "");
+        var u = r.test(e);
+        return u || c.test(e) ? s(e.slice(2), u ? 2 : 8) : a.test(e) ? n : +e
+    }
+    var y = function(e, n, o) {
+            var i = !0,
+                a = !0;
+            if ("function" != typeof e) throw new TypeError(t);
+            return g(o) && (i = "leading" in o ? !!o.leading : i, a = "trailing" in o ? !!o.trailing : a), v(e, n, {
+                leading: i,
+                maxWait: n,
+                trailing: a
             })
-        }
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var u = function() {};
-        t.default = {
-            isSupported: i,
-            ready: r
-        }
-    }, function(e, t) {
-        "use strict";
-
-        function n(e, t) {
-            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
-        }
+        },
+        h = "Expected a function",
+        k = NaN,
+        x = "[object Symbol]",
+        O = /^\s+|\s+$/g,
+        j = /^[-+]0x[0-9a-f]+$/i,
+        E = /^0b[01]+$/i,
+        N = /^0o[0-7]+$/i,
+        z = parseInt,
+        C = "object" == typeof e && e && e.Object === Object && e,
+        A = "object" == typeof self && self && self.Object === Object && self,
+        q = C || A || Function("return this")(),
+        L = Object.prototype.toString,
+        T = Math.max,
+        M = Math.min,
+        S = function() {
+            return q.Date.now()
+        };
 
-        function o() {
-            return navigator.userAgent || navigator.vendor || window.opera || ""
-        }
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var i = function() {
-                function e(e, t) {
-                    for (var n = 0; n < t.length; n++) {
-                        var o = t[n];
-                        o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o)
-                    }
-                }
-                return function(t, n, o) {
-                    return n && e(t.prototype, n), o && e(t, o), t
-                }
-            }(),
-            r = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,
-            a = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,
-            u = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,
-            c = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,
-            s = function() {
-                function e() {
-                    n(this, e)
-                }
-                return i(e, [{
-                    key: "phone",
-                    value: function() {
-                        var e = o();
-                        return !(!r.test(e) && !a.test(e.substr(0, 4)))
-                    }
-                }, {
-                    key: "mobile",
-                    value: function() {
-                        var e = o();
-                        return !(!u.test(e) && !c.test(e.substr(0, 4)))
+    function D(e) {
+        var t = typeof e;
+        return !!e && ("object" == t || "function" == t)
+    }
+
+    function H(e) {
+        if ("number" == typeof e) return e;
+        if (function(e) {
+                return "symbol" == typeof e || function(e) {
+                    return !!e && "object" == typeof e
+                }(e) && L.call(e) == x
+            }(e)) return k;
+        if (D(e)) {
+            var t = "function" == typeof e.valueOf ? e.valueOf() : e;
+            e = D(t) ? t + "" : t
+        }
+        if ("string" != typeof e) return 0 === e ? e : +e;
+        e = e.replace(O, "");
+        var n = E.test(e);
+        return n || N.test(e) ? z(e.slice(2), n ? 2 : 8) : j.test(e) ? k : +e
+    }
+    var $ = function(e, t, n) {
+            var o, i, a, r, c, s, u = 0,
+                d = !1,
+                l = !1,
+                f = !0;
+            if ("function" != typeof e) throw new TypeError(h);
+
+            function m(t) {
+                var n = o,
+                    a = i;
+                return o = i = void 0, u = t, r = e.apply(a, n)
+            }
+
+            function p(e) {
+                var n = e - s;
+                return void 0 === s || n >= t || n < 0 || l && e - u >= a
+            }
+
+            function b() {
+                var e = S();
+                if (p(e)) return v(e);
+                c = setTimeout(b, function(e) {
+                    var n = t - (e - s);
+                    return l ? M(n, a - (e - u)) : n
+                }(e))
+            }
+
+            function v(e) {
+                return c = void 0, f && o ? m(e) : (o = i = void 0, r)
+            }
+
+            function g() {
+                var e = S(),
+                    n = p(e);
+                if (o = arguments, i = this, s = e, n) {
+                    if (void 0 === c) return function(e) {
+                        return u = e, c = setTimeout(b, t), d ? m(e) : r
+                    }(s);
+                    if (l) return c = setTimeout(b, t), m(s)
+                }
+                return void 0 === c && (c = setTimeout(b, t)), r
+            }
+            return t = H(t) || 0, D(n) && (d = !!n.leading, a = (l = "maxWait" in n) ? T(H(n.maxWait) || 0, t) : a, f = "trailing" in n ? !!n.trailing : f), g.cancel = function() {
+                void 0 !== c && clearTimeout(c), u = 0, o = s = i = c = void 0
+            }, g.flush = function() {
+                return void 0 === c ? r : v(S())
+            }, g
+        },
+        W = function() {};
+
+    function P(e) {
+        e && e.forEach(function(e) {
+            var t = Array.prototype.slice.call(e.addedNodes),
+                n = Array.prototype.slice.call(e.removedNodes);
+            if (function e(t) {
+                    var n = void 0,
+                        o = void 0;
+                    for (n = 0; n < t.length; n += 1) {
+                        if ((o = t[n]).dataset && o.dataset.aos) return !0;
+                        if (o.children && e(o.children)) return !0
                     }
-                }, {
-                    key: "tablet",
-                    value: function() {
-                        return this.mobile() && !this.phone()
-                    }
-                }]), e
-            }();
-        t.default = new s
-    }, function(e, t) {
-        "use strict";
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var n = function(e, t, n) {
-                var o = e.node.getAttribute("data-aos-once");
-                t > e.position ? e.node.classList.add("aos-animate") : "undefined" != typeof o && ("false" === o || !n && "true" !== o) && e.node.classList.remove("aos-animate")
+                    return !1
+                }(t.concat(n))) return W()
+        })
+    }
+
+    function Y() {
+        return window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver
+    }
+    var _ = {
+            isSupported: function() {
+                return !!Y()
             },
-            o = function(e, t) {
-                var o = window.pageYOffset,
-                    i = window.innerHeight;
-                e.forEach(function(e, r) {
-                    n(e, i + o, t)
+            ready: function(e, t) {
+                var n = window.document,
+                    o = new(Y())(P);
+                W = t, o.observe(n.documentElement, {
+                    childList: !0,
+                    subtree: !0,
+                    removedNodes: !0
                 })
-            };
-        t.default = o
-    }, function(e, t, n) {
-        "use strict";
-
-        function o(e) {
-            return e && e.__esModule ? e : {
-                default: e
-            }
-        }
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var i = n(12),
-            r = o(i),
-            a = function(e, t) {
-                return e.forEach(function(e, n) {
-                    e.node.classList.add("aos-init"), e.position = (0, r.default)(e.node, t.offset)
-                }), e
-            };
-        t.default = a
-    }, function(e, t, n) {
-        "use strict";
-
-        function o(e) {
-            return e && e.__esModule ? e : {
-                default: e
             }
-        }
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var i = n(13),
-            r = o(i),
-            a = function(e, t) {
-                var n = 0,
-                    o = 0,
-                    i = window.innerHeight,
-                    a = {
-                        offset: e.getAttribute("data-aos-offset"),
-                        anchor: e.getAttribute("data-aos-anchor"),
-                        anchorPlacement: e.getAttribute("data-aos-anchor-placement")
-                    };
-                switch (a.offset && !isNaN(a.offset) && (o = parseInt(a.offset)), a.anchor && document.querySelectorAll(a.anchor) && (e = document.querySelectorAll(a.anchor)[0]), n = (0, r.default)(e).top, a.anchorPlacement) {
-                    case "top-bottom":
-                        break;
-                    case "center-bottom":
-                        n += e.offsetHeight / 2;
-                        break;
-                    case "bottom-bottom":
-                        n += e.offsetHeight;
-                        break;
-                    case "top-center":
-                        n += i / 2;
-                        break;
-                    case "bottom-center":
-                        n += i / 2 + e.offsetHeight;
-                        break;
-                    case "center-center":
-                        n += i / 2 + e.offsetHeight / 2;
-                        break;
-                    case "top-top":
-                        n += i;
-                        break;
-                    case "bottom-top":
-                        n += e.offsetHeight + i;
-                        break;
-                    case "center-top":
-                        n += e.offsetHeight / 2 + i
-                }
-                return a.anchorPlacement || a.offset || isNaN(t) || (o = t), n + o
-            };
-        t.default = a
-    }, function(e, t) {
-        "use strict";
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var n = function(e) {
+        },
+        B = function(e, t) {
+            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
+        },
+        F = function() {
+            function e(e, t) {
+                for (var n = 0; n < t.length; n++) {
+                    var o = t[n];
+                    o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o)
+                }
+            }
+            return function(t, n, o) {
+                return n && e(t.prototype, n), o && e(t, o), t
+            }
+        }(),
+        I = Object.assign || function(e) {
+            for (var t = 1; t < arguments.length; t++) {
+                var n = arguments[t];
+                for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o])
+            }
+            return e
+        },
+        K = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,
+        G = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,
+        J = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,
+        Q = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i;
+
+    function R() {
+        return navigator.userAgent || navigator.vendor || window.opera || ""
+    }
+    var U = new(function() {
+            function e() {
+                B(this, e)
+            }
+            return F(e, [{
+                key: "phone",
+                value: function() {
+                    var e = R();
+                    return !(!K.test(e) && !G.test(e.substr(0, 4)))
+                }
+            }, {
+                key: "mobile",
+                value: function() {
+                    var e = R();
+                    return !(!J.test(e) && !Q.test(e.substr(0, 4)))
+                }
+            }, {
+                key: "tablet",
+                value: function() {
+                    return this.mobile() && !this.phone()
+                }
+            }, {
+                key: "ie11",
+                value: function() {
+                    return "-ms-scroll-limit" in document.documentElement.style && "-ms-ime-align" in document.documentElement.style
+                }
+            }]), e
+        }()),
+        V = function(e, t) {
+            var n = void 0;
+            return U.ie11() ? (n = document.createEvent("CustomEvent")).initCustomEvent(e, !0, !0, {
+                detail: t
+            }) : n = new CustomEvent(e, {
+                detail: t
+            }), document.dispatchEvent(n)
+        },
+        X = function(e) {
+            return e.forEach(function(e, t) {
+                return function(e, t) {
+                    var n = e.options,
+                        o = e.position,
+                        i = e.node,
+                        a = (e.data, function() {
+                            e.animated && (function(e, t) {
+                                t && t.forEach(function(t) {
+                                    return e.classList.remove(t)
+                                })
+                            }(i, n.animatedClassNames), V("aos:out", i), e.options.id && V("aos:in:" + e.options.id, i), e.animated = !1)
+                        });
+                    n.mirror && t >= o.out && !n.once ? a() : t >= o.in ? e.animated || (function(e, t) {
+                        t && t.forEach(function(t) {
+                            return e.classList.add(t)
+                        })
+                    }(i, n.animatedClassNames), V("aos:in", i), e.options.id && V("aos:in:" + e.options.id, i), e.animated = !0) : e.animated && !n.once && a()
+                }(e, window.pageYOffset)
+            })
+        },
+        Z = function(e) {
             for (var t = 0, n = 0; e && !isNaN(e.offsetLeft) && !isNaN(e.offsetTop);) t += e.offsetLeft - ("BODY" != e.tagName ? e.scrollLeft : 0), n += e.offsetTop - ("BODY" != e.tagName ? e.scrollTop : 0), e = e.offsetParent;
             return {
                 top: n,
                 left: t
             }
-        };
-        t.default = n
-    }, function(e, t) {
-        "use strict";
-        Object.defineProperty(t, "__esModule", {
-            value: !0
-        });
-        var n = function(e) {
-            return e = e || document.querySelectorAll("[data-aos]"), Array.prototype.map.call(e, function(e) {
+        },
+        ee = function(e, t, n) {
+            var o = e.getAttribute("data-aos-" + t);
+            if (void 0 !== o) {
+                if ("true" === o) return !0;
+                if ("false" === o) return !1
+            }
+            return o || n
+        },
+        te = function(e, t) {
+            return e.forEach(function(e, n) {
+                var o = ee(e.node, "mirror", t.mirror),
+                    i = ee(e.node, "once", t.once),
+                    a = ee(e.node, "id"),
+                    r = t.useClassNames && e.node.getAttribute("data-aos"),
+                    c = [t.animatedClassName].concat(r ? r.split(" ") : []).filter(function(e) {
+                        return "string" == typeof e
+                    });
+                t.initClassName && e.node.classList.add(t.initClassName), e.position = {
+                    in: function(e, t, n) {
+                        var o = window.innerHeight,
+                            i = ee(e, "anchor"),
+                            a = ee(e, "anchor-placement"),
+                            r = Number(ee(e, "offset", a ? 0 : t)),
+                            c = a || n,
+                            s = e;
+                        i && document.querySelectorAll(i) && (s = document.querySelectorAll(i)[0]);
+                        var u = Z(s).top - o;
+                        switch (c) {
+                            case "top-bottom":
+                                break;
+                            case "center-bottom":
+                                u += s.offsetHeight / 2;
+                                break;
+                            case "bottom-bottom":
+                                u += s.offsetHeight;
+                                break;
+                            case "top-center":
+                                u += o / 2;
+                                break;
+                            case "center-center":
+                                u += o / 2 + s.offsetHeight / 2;
+                                break;
+                            case "bottom-center":
+                                u += o / 2 + s.offsetHeight;
+                                break;
+                            case "top-top":
+                                u += o;
+                                break;
+                            case "bottom-top":
+                                u += o + s.offsetHeight;
+                                break;
+                            case "center-top":
+                                u += o + s.offsetHeight / 2
+                        }
+                        return u + r
+                    }(e.node, t.offset, t.anchorPlacement),
+                    out: o && function(e, t) {
+                        window.innerHeight;
+                        var n = ee(e, "anchor"),
+                            o = ee(e, "offset", t),
+                            i = e;
+                        return n && document.querySelectorAll(n) && (i = document.querySelectorAll(n)[0]), Z(i).top + i.offsetHeight - o
+                    }(e.node, t.offset)
+                }, e.options = {
+                    once: i,
+                    mirror: o,
+                    animatedClassNames: c,
+                    id: a
+                }
+            }), e
+        },
+        ne = function() {
+            var e = document.querySelectorAll("[data-aos]");
+            return Array.prototype.map.call(e, function(e) {
                 return {
                     node: e
                 }
             })
+        },
+        oe = [],
+        ie = !1,
+        ae = {
+            offset: 120,
+            delay: 0,
+            easing: "ease",
+            duration: 400,
+            disable: !1,
+            once: !1,
+            mirror: !1,
+            anchorPlacement: "top-bottom",
+            startEvent: "DOMContentLoaded",
+            animatedClassName: "aos-animate",
+            initClassName: "aos-init",
+            useClassNames: !1,
+            disableMutationObserver: !1,
+            throttleDelay: 99,
+            debounceDelay: 50
+        },
+        re = function() {
+            return document.all && !window.atob
+        },
+        ce = function() {
+            arguments.length > 0 && void 0 !== arguments[0] && arguments[0] && (ie = !0), ie && (oe = te(oe, ae), X(oe), window.addEventListener("scroll", y(function() {
+                X(oe, ae.once)
+            }, ae.throttleDelay)))
+        },
+        se = function() {
+            if (oe = ne(), de(ae.disable) || re()) return ue();
+            ce()
+        },
+        ue = function() {
+            oe.forEach(function(e, t) {
+                e.node.removeAttribute("data-aos"), e.node.removeAttribute("data-aos-easing"), e.node.removeAttribute("data-aos-duration"), e.node.removeAttribute("data-aos-delay"), ae.initClassName && e.node.classList.remove(ae.initClassName), ae.animatedClassName && e.node.classList.remove(ae.animatedClassName)
+            })
+        },
+        de = function(e) {
+            return !0 === e || "mobile" === e && U.mobile() || "phone" === e && U.phone() || "tablet" === e && U.tablet() || "function" == typeof e && !0 === e()
         };
-        t.default = n
-    }])
+    return {
+        init: function(e) {
+            return ae = I(ae, e), oe = ne(), ae.disableMutationObserver || _.isSupported() || (console.info('\n      aos: MutationObserver is not supported on this browser,\n      code mutations observing has been disabled.\n      You may have to call "refreshHard()" by yourself.\n    '), ae.disableMutationObserver = !0), ae.disableMutationObserver || _.ready("[data-aos]", se), de(ae.disable) || re() ? ue() : (document.querySelector("body").setAttribute("data-aos-easing", ae.easing), document.querySelector("body").setAttribute("data-aos-duration", ae.duration), document.querySelector("body").setAttribute("data-aos-delay", ae.delay), -1 === ["DOMContentLoaded", "load"].indexOf(ae.startEvent) ? document.addEventListener(ae.startEvent, function() {
+                ce(!0)
+            }) : window.addEventListener("load", function() {
+                ce(!0)
+            }), "DOMContentLoaded" === ae.startEvent && ["complete", "interactive"].indexOf(document.readyState) > -1 && ce(!0), window.addEventListener("resize", $(ce, ae.debounceDelay, !0)), window.addEventListener("orientationchange", $(ce, ae.debounceDelay, !0)), oe)
+        },
+        refresh: ce,
+        refreshHard: se
+    }
 });
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.css`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.min.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/glightbox.min.css`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.css`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.min.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/css/plyr.min.css`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.js`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.min.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/glightbox/js/glightbox.min.js`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.js`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.min.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/isotope-layout/isotope.pkgd.min.js`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/php-email-form/php-email-form.php` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/php-email-form/php-email-form.php`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 00000000: 3c3f 7068 700d 0a2f 2a2a 0d0a 202a 2050  <?php../**.. * P
 00000010: 4850 2045 6d61 696c 2046 6f72 6d0d 0a20  HP Email Form.. 
-00000020: 2a20 5665 7273 696f 6e3a 2033 2e35 0d0a  * Version: 3.5..
+00000020: 2a20 5665 7273 696f 6e3a 2033 2e37 0d0a  * Version: 3.7..
 00000030: 202a 2057 6562 7369 7465 3a20 6874 7470   * Website: http
 00000040: 733a 2f2f 626f 6f74 7374 7261 706d 6164  s://bootstrapmad
 00000050: 652e 636f 6d2f 7068 702d 656d 6169 6c2d  e.com/php-email-
 00000060: 666f 726d 2f0d 0a20 2a20 436f 7079 7269  form/.. * Copyri
 00000070: 6768 743a 2042 6f6f 7473 7472 6170 4d61  ght: BootstrapMa
 00000080: 6465 2e63 6f6d 0d0a 202a 2f0d 0a0d 0a69  de.com.. */....i
 00000090: 6620 2820 7665 7273 696f 6e5f 636f 6d70  f ( version_comp
@@ -91,14453 +91,14809 @@
 000005a0: 775c 2e2f 272c 2727 2c20 245f 5345 5256  w\./','', $_SERV
 000005b0: 4552 5b27 5345 5256 4552 5f4e 414d 4527  ER['SERVER_NAME'
 000005c0: 5d29 3b0d 0a20 207d 0d0a 0d0a 2020 7075  ]);..  }....  pu
 000005d0: 626c 6963 2066 756e 6374 696f 6e20 6164  blic function ad
 000005e0: 645f 6d65 7373 6167 6528 2463 6f6e 7465  d_message($conte
 000005f0: 6e74 2c20 246c 6162 656c 203d 2027 272c  nt, $label = '',
 00000600: 2024 6c65 6e67 7468 5f63 6865 636b 203d   $length_check =
-00000610: 2066 616c 7365 2920 7b0d 0a20 2020 2024   false) {..    $
-00000620: 6d65 7373 6167 6520 3d20 6669 6c74 6572  message = filter
-00000630: 5f76 6172 2824 636f 6e74 656e 742c 2046  _var($content, F
-00000640: 494c 5445 525f 5341 4e49 5449 5a45 5f46  ILTER_SANITIZE_F
-00000650: 554c 4c5f 5350 4543 4941 4c5f 4348 4152  ULL_SPECIAL_CHAR
-00000660: 5329 202e 2027 3c62 723e 273b 0d0a 2020  S) . '<br>';..  
-00000670: 2020 6966 2820 246c 656e 6774 685f 6368    if( $length_ch
-00000680: 6563 6b20 2920 7b0d 0a20 2020 2020 2069  eck ) {..      i
-00000690: 6628 2073 7472 6c65 6e28 246d 6573 7361  f( strlen($messa
-000006a0: 6765 2920 3c20 246c 656e 6774 685f 6368  ge) < $length_ch
-000006b0: 6563 6b20 2b20 3420 2920 7b0d 0a20 2020  eck + 4 ) {..   
-000006c0: 2020 2020 2024 7468 6973 2d3e 6572 726f       $this->erro
-000006d0: 7220 2e3d 2020 246c 6162 656c 202e 2027  r .=  $label . '
-000006e0: 2027 202e 2024 7468 6973 2d3e 6572 726f   ' . $this->erro
-000006f0: 725f 6d73 675b 2773 686f 7274 275d 202e  r_msg['short'] .
-00000700: 2027 3c62 723e 273b 0d0a 2020 2020 2020   '<br>';..      
-00000710: 2020 7265 7475 726e 3b0d 0a20 2020 2020    return;..     
-00000720: 207d 0d0a 2020 2020 7d0d 0a20 2020 2024   }..    }..    $
-00000730: 7468 6973 2d3e 6d65 7373 6167 6520 2e3d  this->message .=
-00000740: 2021 656d 7074 7928 2024 6c61 6265 6c20   !empty( $label 
-00000750: 2920 3f20 273c 7374 726f 6e67 3e27 202e  ) ? '<strong>' .
-00000760: 2024 6c61 6265 6c20 2e20 273a 3c2f 7374   $label . ':</st
-00000770: 726f 6e67 3e20 2720 2e20 246d 6573 7361  rong> ' . $messa
-00000780: 6765 203a 2024 6d65 7373 6167 653b 0d0a  ge : $message;..
-00000790: 2020 7d0d 0a0d 0a20 2070 7562 6c69 6320    }....  public 
-000007a0: 6675 6e63 7469 6f6e 206f 7074 696f 6e28  function option(
-000007b0: 246e 616d 652c 2024 7661 6c29 207b 0d0a  $name, $val) {..
-000007c0: 2020 2020 2474 6869 732d 3e6f 7074 696f      $this->optio
-000007d0: 6e73 5b24 6e61 6d65 5d20 3d20 2476 616c  ns[$name] = $val
-000007e0: 3b0d 0a20 207d 0d0a 0d0a 2020 7075 626c  ;..  }....  publ
-000007f0: 6963 2066 756e 6374 696f 6e20 6164 645f  ic function add_
-00000800: 6174 7461 6368 6d65 6e74 2824 6e61 6d65  attachment($name
-00000810: 2c20 246d 6178 5f73 697a 6520 3d20 3230  , $max_size = 20
-00000820: 2c20 2461 6c6c 6f77 6564 5f65 7865 6e73  , $allowed_exens
-00000830: 696f 6e73 203d 205b 276a 7065 6727 2c27  ions = ['jpeg','
-00000840: 6a70 6727 2c27 706e 6727 2c27 7064 6627  jpg','png','pdf'
-00000850: 2c27 646f 6327 2c27 646f 6378 275d 2029  ,'doc','docx'] )
-00000860: 207b 0d0a 2020 2020 6966 2820 2165 6d70   {..    if( !emp
-00000870: 7479 2824 5f46 494c 4553 5b24 6e61 6d65  ty($_FILES[$name
-00000880: 5d5b 276e 616d 6527 5d29 2029 207b 0d0a  ]['name']) ) {..
-00000890: 2020 2020 2020 2466 696c 655f 6578 656e        $file_exen
-000008a0: 7369 6f6e 203d 2073 7472 746f 6c6f 7765  sion = strtolowe
-000008b0: 7228 7061 7468 696e 666f 2824 5f46 494c  r(pathinfo($_FIL
-000008c0: 4553 5b24 6e61 6d65 5d5b 276e 616d 6527  ES[$name]['name'
-000008d0: 5d2c 2050 4154 4849 4e46 4f5f 4558 5445  ], PATHINFO_EXTE
-000008e0: 4e53 494f 4e29 293b 0d0a 2020 2020 2020  NSION));..      
-000008f0: 6966 2820 2120 696e 5f61 7272 6179 2824  if( ! in_array($
-00000900: 6669 6c65 5f65 7865 6e73 696f 6e2c 2024  file_exension, $
-00000910: 616c 6c6f 7765 645f 6578 656e 7369 6f6e  allowed_exension
-00000920: 7329 2029 207b 0d0a 2020 2020 2020 2020  s) ) {..        
-00000930: 6469 6528 2027 2827 202e 246e 616d 6520  die( '(' .$name 
-00000940: 2e20 2729 2027 202e 2024 7468 6973 2d3e  . ') ' . $this->
-00000950: 6572 726f 725f 6d73 675b 2769 6e76 616c  error_msg['inval
-00000960: 6964 5f61 7474 6163 686d 656e 745f 6578  id_attachment_ex
-00000970: 7465 6e73 696f 6e27 5d20 2e20 2220 2e22  tension'] . " ."
-00000980: 202e 2069 6d70 6c6f 6465 2822 2c20 2e22   . implode(", ."
-00000990: 2c20 2461 6c6c 6f77 6564 5f65 7865 6e73  , $allowed_exens
-000009a0: 696f 6e73 2920 293b 0d0a 2020 2020 2020  ions) );..      
-000009b0: 7d0d 0a20 200d 0a20 2020 2020 2069 6628  }..  ..      if(
-000009c0: 2024 5f46 494c 4553 5b24 6e61 6d65 5d5b   $_FILES[$name][
-000009d0: 2773 697a 6527 5d20 3e20 2831 3032 3420  'size'] > (1024 
-000009e0: 2a20 3130 3234 202a 2024 6d61 785f 7369  * 1024 * $max_si
-000009f0: 7a65 2920 2920 7b0d 0a20 2020 2020 2020  ze) ) {..       
-00000a00: 2064 6965 2820 2728 2720 2e24 6e61 6d65   die( '(' .$name
-00000a10: 202e 2027 2920 2720 2e20 2474 6869 732d   . ') ' . $this-
-00000a20: 3e65 7272 6f72 5f6d 7367 5b27 696e 7661  >error_msg['inva
-00000a30: 6c69 645f 6174 7461 6368 6d65 6e74 5f73  lid_attachment_s
-00000a40: 697a 6527 5d20 2e20 2220 246d 6178 5f73  ize'] . " $max_s
-00000a50: 697a 6520 4d42 2229 3b0d 0a20 2020 2020  ize MB");..     
-00000a60: 207d 0d0a 0d0a 2020 2020 2020 2474 6869   }....      $thi
-00000a70: 732d 3e61 7474 6163 686d 656e 7473 5b5d  s->attachments[]
-00000a80: 203d 205b 0d0a 2020 2020 2020 2020 2770   = [..        'p
-00000a90: 6174 6827 203d 3e20 245f 4649 4c45 535b  ath' => $_FILES[
-00000aa0: 246e 616d 655d 5b27 746d 705f 6e61 6d65  $name]['tmp_name
-00000ab0: 275d 2c20 0d0a 2020 2020 2020 2020 276e  '], ..        'n
-00000ac0: 616d 6527 3d3e 2020 245f 4649 4c45 535b  ame'=>  $_FILES[
-00000ad0: 246e 616d 655d 5b27 6e61 6d65 275d 0d0a  $name]['name']..
-00000ae0: 2020 2020 2020 5d3b 0d0a 2020 2020 7d0d        ];..    }.
-00000af0: 0a20 207d 0d0a 0d0a 2020 7075 626c 6963  .  }....  public
-00000b00: 2066 756e 6374 696f 6e20 7365 6e64 2829   function send()
-00000b10: 207b 0d0a 0d0a 2020 2020 6966 2820 2165   {....    if( !e
-00000b20: 6d70 7479 2874 7269 6d28 2474 6869 732d  mpty(trim($this-
-00000b30: 3e68 6f6e 6579 706f 7429 2920 2920 7b0d  >honeypot)) ) {.
-00000b40: 0a20 2020 2020 2072 6574 7572 6e20 274f  .      return 'O
-00000b50: 4b27 3b0d 0a20 2020 207d 0d0a 0d0a 2020  K';..    }....  
-00000b60: 2020 6966 2820 2474 6869 732d 3e72 6563    if( $this->rec
-00000b70: 6170 7463 6861 5f73 6563 7265 745f 6b65  aptcha_secret_ke
-00000b80: 7920 2920 7b0d 0a0d 0a20 2020 2020 2069  y ) {....      i
-00000b90: 6628 2120 245f 504f 5354 5b27 7265 6361  f(! $_POST['reca
-00000ba0: 7074 6368 612d 7265 7370 6f6e 7365 275d  ptcha-response']
-00000bb0: 2920 7b0d 0a20 2020 2020 2020 2072 6574  ) {..        ret
-00000bc0: 7572 6e20 274e 6f20 7265 4361 7074 6368  urn 'No reCaptch
-00000bd0: 6120 7265 7370 6f6e 7365 2070 726f 7669  a response provi
-00000be0: 6465 6421 273b 0d0a 2020 2020 2020 7d0d  ded!';..      }.
-00000bf0: 0a0d 0a20 2020 2020 2024 7265 6361 7074  ...      $recapt
-00000c00: 6368 615f 6f70 7469 6f6e 7320 3d20 5b0d  cha_options = [.
-00000c10: 0a20 2020 2020 2020 2027 6874 7470 2720  .        'http' 
-00000c20: 3d3e 205b 0d0a 2020 2020 2020 2020 2020  => [..          
-00000c30: 2768 6561 6465 7227 2020 3d3e 2022 436f  'header'  => "Co
-00000c40: 6e74 656e 742d 7479 7065 3a20 6170 706c  ntent-type: appl
-00000c50: 6963 6174 696f 6e2f 782d 7777 772d 666f  ication/x-www-fo
-00000c60: 726d 2d75 726c 656e 636f 6465 645c 725c  rm-urlencoded\r\
-00000c70: 6e22 2c0d 0a20 2020 2020 2020 2020 2027  n",..          '
-00000c80: 6d65 7468 6f64 2720 203d 3e20 2750 4f53  method'  => 'POS
-00000c90: 5427 2c0d 0a20 2020 2020 2020 2020 2027  T',..          '
-00000ca0: 636f 6e74 656e 7427 203d 3e20 6874 7470  content' => http
-00000cb0: 5f62 7569 6c64 5f71 7565 7279 285b 0d0a  _build_query([..
-00000cc0: 2020 2020 2020 2020 2020 2020 2773 6563              'sec
-00000cd0: 7265 7427 203d 3e20 2474 6869 732d 3e72  ret' => $this->r
-00000ce0: 6563 6170 7463 6861 5f73 6563 7265 745f  ecaptcha_secret_
-00000cf0: 6b65 792c 0d0a 2020 2020 2020 2020 2020  key,..          
-00000d00: 2020 2772 6573 706f 6e73 6527 203d 3e20    'response' => 
-00000d10: 245f 504f 5354 5b27 7265 6361 7074 6368  $_POST['recaptch
-00000d20: 612d 7265 7370 6f6e 7365 275d 0d0a 2020  a-response']..  
-00000d30: 2020 2020 2020 2020 5d29 0d0a 2020 2020          ])..    
-00000d40: 2020 2020 5d0d 0a20 2020 2020 205d 3b0d      ]..      ];.
-00000d50: 0a0d 0a20 2020 2020 2024 7265 6361 7074  ...      $recapt
-00000d60: 6863 615f 636f 6e74 6578 7420 3d20 7374  hca_context = st
-00000d70: 7265 616d 5f63 6f6e 7465 7874 5f63 7265  ream_context_cre
-00000d80: 6174 6528 2472 6563 6170 7463 6861 5f6f  ate($recaptcha_o
-00000d90: 7074 696f 6e73 293b 0d0a 2020 2020 2020  ptions);..      
-00000da0: 2472 6563 6170 7468 6361 5f72 6573 706f  $recapthca_respo
-00000db0: 6e73 6520 3d20 6669 6c65 5f67 6574 5f63  nse = file_get_c
-00000dc0: 6f6e 7465 6e74 7328 2768 7474 7073 3a2f  ontents('https:/
-00000dd0: 2f77 7777 2e67 6f6f 676c 652e 636f 6d2f  /www.google.com/
-00000de0: 7265 6361 7074 6368 612f 6170 692f 7369  recaptcha/api/si
-00000df0: 7465 7665 7269 6679 272c 2066 616c 7365  teverify', false
-00000e00: 2c20 2472 6563 6170 7468 6361 5f63 6f6e  , $recapthca_con
-00000e10: 7465 7874 293b 0d0a 2020 2020 2020 2472  text);..      $r
-00000e20: 6563 6170 7468 6361 5f72 6573 706f 6e73  ecapthca_respons
-00000e30: 655f 6b65 7973 203d 206a 736f 6e5f 6465  e_keys = json_de
-00000e40: 636f 6465 2824 7265 6361 7074 6863 615f  code($recapthca_
-00000e50: 7265 7370 6f6e 7365 2c74 7275 6529 3b0d  response,true);.
-00000e60: 0a0d 0a20 2020 2020 2069 6628 2021 2024  ...      if( ! $
-00000e70: 7265 6361 7074 6863 615f 7265 7370 6f6e  recapthca_respon
-00000e80: 7365 5f6b 6579 735b 2773 7563 6365 7373  se_keys['success
-00000e90: 275d 2029 207b 0d0a 2020 2020 2020 2020  '] ) {..        
-00000ea0: 7265 7475 726e 2027 4661 696c 6564 2074  return 'Failed t
-00000eb0: 6f20 7661 6c69 6461 7465 2074 6865 2072  o validate the r
-00000ec0: 6543 6170 7463 6861 2127 3b0d 0a20 2020  eCaptcha!';..   
-00000ed0: 2020 207d 0d0a 2020 2020 7d0d 0a0d 0a20     }..    }.... 
-00000ee0: 2020 2069 6628 2024 7468 6973 2d3e 616a     if( $this->aj
-00000ef0: 6178 2029 207b 0d0a 2020 2020 2020 6966  ax ) {..      if
-00000f00: 2820 2169 7373 6574 2824 5f53 4552 5645  ( !isset($_SERVE
-00000f10: 525b 2748 5454 505f 585f 5245 5155 4553  R['HTTP_X_REQUES
-00000f20: 5445 445f 5749 5448 275d 2920 2626 2073  TED_WITH']) && s
-00000f30: 7472 746f 6c6f 7765 7228 245f 5345 5256  trtolower($_SERV
-00000f40: 4552 5b27 4854 5450 5f58 5f52 4551 5545  ER['HTTP_X_REQUE
-00000f50: 5354 4544 5f57 4954 4827 5d29 2021 3d20  STED_WITH']) != 
-00000f60: 2778 6d6c 6874 7470 7265 7175 6573 7427  'xmlhttprequest'
-00000f70: 2920 7b0d 0a20 2020 2020 2020 2072 6574  ) {..        ret
-00000f80: 7572 6e20 2474 6869 732d 3e65 7272 6f72  urn $this->error
-00000f90: 5f6d 7367 5b27 616a 6178 5f65 7272 6f72  _msg['ajax_error
-00000fa0: 275d 3b0d 0a20 2020 2020 207d 0d0a 2020  '];..      }..  
-00000fb0: 2020 7d0d 0a0d 0a20 2020 2024 746f 203d    }....    $to =
-00000fc0: 2066 696c 7465 725f 7661 7228 2024 7468   filter_var( $th
-00000fd0: 6973 2d3e 746f 2c20 4649 4c54 4552 5f56  is->to, FILTER_V
-00000fe0: 414c 4944 4154 455f 454d 4149 4c29 3b0d  ALIDATE_EMAIL);.
-00000ff0: 0a20 2020 2024 6672 6f6d 5f6e 616d 6520  .    $from_name 
-00001000: 3d20 6669 6c74 6572 5f76 6172 2820 2474  = filter_var( $t
-00001010: 6869 732d 3e66 726f 6d5f 6e61 6d65 2c20  his->from_name, 
-00001020: 4649 4c54 4552 5f53 414e 4954 495a 455f  FILTER_SANITIZE_
-00001030: 4655 4c4c 5f53 5045 4349 414c 5f43 4841  FULL_SPECIAL_CHA
-00001040: 5253 293b 0d0a 2020 2020 2466 726f 6d5f  RS);..    $from_
-00001050: 656d 6169 6c20 3d20 6669 6c74 6572 5f76  email = filter_v
-00001060: 6172 2820 2474 6869 732d 3e66 726f 6d5f  ar( $this->from_
-00001070: 656d 6169 6c2c 2046 494c 5445 525f 5641  email, FILTER_VA
-00001080: 4c49 4441 5445 5f45 4d41 494c 293b 0d0a  LIDATE_EMAIL);..
-00001090: 2020 2020 2473 7562 6a65 6374 203d 2066      $subject = f
-000010a0: 696c 7465 725f 7661 7228 2024 7468 6973  ilter_var( $this
-000010b0: 2d3e 7375 626a 6563 742c 2046 494c 5445  ->subject, FILTE
-000010c0: 525f 5341 4e49 5449 5a45 5f46 554c 4c5f  R_SANITIZE_FULL_
-000010d0: 5350 4543 4941 4c5f 4348 4152 532c 2046  SPECIAL_CHARS, F
-000010e0: 494c 5445 525f 464c 4147 5f4e 4f5f 454e  ILTER_FLAG_NO_EN
-000010f0: 434f 4445 5f51 554f 5445 5329 3b0d 0a20  CODE_QUOTES);.. 
-00001100: 2020 2024 6d65 7373 6167 6520 3d20 6e6c     $message = nl
-00001110: 3262 7228 2474 6869 732d 3e6d 6573 7361  2br($this->messa
-00001120: 6765 293b 0d0a 0d0a 2020 2020 6966 2820  ge);....    if( 
-00001130: 2120 2474 6f20 7c7c 206d 6435 2824 746f  ! $to || md5($to
-00001140: 2920 3d3d 2027 3439 3663 3037 3431 3638  ) == '496c074168
-00001150: 3263 6534 6463 3763 3766 3733 6361 3466  2ce4dc7c7f73ca4f
-00001160: 6538 6463 3565 2729 200d 0a20 2020 2020  e8dc5e') ..     
-00001170: 2024 7468 6973 2d3e 6572 726f 7220 2e3d   $this->error .=
-00001180: 2024 7468 6973 2d3e 6572 726f 725f 6d73   $this->error_ms
-00001190: 675b 2769 6e76 616c 6964 5f74 6f5f 656d  g['invalid_to_em
-000011a0: 6169 6c27 5d20 2e20 273c 6272 3e27 3b0d  ail'] . '<br>';.
-000011b0: 0a0d 0a20 2020 2069 6628 2021 2024 6672  ...    if( ! $fr
-000011c0: 6f6d 5f6e 616d 6520 2920 0d0a 2020 2020  om_name ) ..    
-000011d0: 2020 2474 6869 732d 3e65 7272 6f72 202e    $this->error .
-000011e0: 3d20 2474 6869 732d 3e65 7272 6f72 5f6d  = $this->error_m
-000011f0: 7367 5b27 696e 7661 6c69 645f 6672 6f6d  sg['invalid_from
-00001200: 5f6e 616d 6527 5d20 2e20 273c 6272 3e27  _name'] . '<br>'
-00001210: 3b0d 0a0d 0a20 2020 2069 6628 2021 2024  ;....    if( ! $
-00001220: 6672 6f6d 5f65 6d61 696c 2029 200d 0a20  from_email ) .. 
-00001230: 2020 2020 2024 7468 6973 2d3e 6572 726f       $this->erro
-00001240: 7220 2e3d 2024 7468 6973 2d3e 6572 726f  r .= $this->erro
-00001250: 725f 6d73 675b 2769 6e76 616c 6964 5f66  r_msg['invalid_f
-00001260: 726f 6d5f 656d 6169 6c27 5d20 2e20 273c  rom_email'] . '<
-00001270: 6272 3e27 3b0d 0a0d 0a20 2020 2069 6628  br>';....    if(
-00001280: 2021 2024 7375 626a 6563 7420 2920 0d0a   ! $subject ) ..
-00001290: 2020 2020 2020 2474 6869 732d 3e65 7272        $this->err
-000012a0: 6f72 202e 3d20 2474 6869 732d 3e65 7272  or .= $this->err
-000012b0: 6f72 5f6d 7367 5b27 696e 7661 6c69 645f  or_msg['invalid_
-000012c0: 7375 626a 6563 7427 5d20 2e20 273c 6272  subject'] . '<br
-000012d0: 3e27 3b0d 0a0d 0a20 2020 2069 6628 2069  >';....    if( i
-000012e0: 735f 6172 7261 7928 2024 7468 6973 2d3e  s_array( $this->
-000012f0: 736d 7470 2920 2920 7b0d 0a20 2020 2020  smtp) ) {..     
-00001300: 2069 6628 2021 6973 7365 7428 2024 7468   if( !isset( $th
-00001310: 6973 2d3e 736d 7470 5b27 686f 7374 275d  is->smtp['host']
-00001320: 2029 2029 0d0a 2020 2020 2020 2020 2474   ) )..        $t
-00001330: 6869 732d 3e65 7272 6f72 202e 3d20 2753  his->error .= 'S
-00001340: 4d54 5020 686f 7374 2069 7320 656d 7074  MTP host is empt
-00001350: 7921 2720 2e20 273c 6272 3e27 3b0d 0a0d  y!' . '<br>';...
-00001360: 0a20 2020 2020 2069 6628 2021 6973 7365  .      if( !isse
-00001370: 7428 2024 7468 6973 2d3e 736d 7470 5b27  t( $this->smtp['
-00001380: 7573 6572 6e61 6d65 275d 2029 2029 207b  username'] ) ) {
-00001390: 0d0a 2020 2020 2020 2020 2474 6869 732d  ..        $this-
-000013a0: 3e65 7272 6f72 202e 3d20 2753 4d54 5020  >error .= 'SMTP 
-000013b0: 7573 6572 6e61 6d65 2069 7320 656d 7074  username is empt
-000013c0: 7921 2720 2e20 273c 6272 3e27 3b0d 0a20  y!' . '<br>';.. 
-000013d0: 2020 2020 207d 0d0a 2020 2020 2020 6966       }..      if
-000013e0: 2820 2169 7373 6574 2820 2474 6869 732d  ( !isset( $this-
-000013f0: 3e73 6d74 705b 2770 6173 7377 6f72 6427  >smtp['password'
-00001400: 5d20 2920 290d 0a20 2020 2020 2020 2024  ] ) )..        $
-00001410: 7468 6973 2d3e 6572 726f 7220 2e3d 2027  this->error .= '
-00001420: 534d 5450 2070 6173 7377 6f72 6420 6973  SMTP password is
-00001430: 2065 6d70 7479 2127 202e 2027 3c62 723e   empty!' . '<br>
-00001440: 273b 0d0a 2020 2020 0d0a 2020 2020 2020  ';..    ..      
-00001450: 6966 2820 2169 7373 6574 2820 2474 6869  if( !isset( $thi
-00001460: 732d 3e73 6d74 705b 2770 6f72 7427 5d20  s->smtp['port'] 
-00001470: 2920 290d 0a20 2020 2020 2020 2024 7468  ) )..        $th
-00001480: 6973 2d3e 736d 7470 5b27 706f 7274 275d  is->smtp['port']
-00001490: 203d 2035 3837 3b0d 0a20 2020 2020 200d   = 587;..      .
-000014a0: 0a20 2020 2020 2069 6628 2021 6973 7365  .      if( !isse
-000014b0: 7428 2024 7468 6973 2d3e 736d 7470 5b27  t( $this->smtp['
-000014c0: 656e 6372 7970 7469 6f6e 275d 2029 2029  encryption'] ) )
-000014d0: 0d0a 2020 2020 2020 2020 2474 6869 732d  ..        $this-
-000014e0: 3e73 6d74 705b 2765 6e63 7279 7074 696f  >smtp['encryptio
-000014f0: 6e27 5d20 3d20 2774 6c73 273b 0d0a 0d0a  n'] = 'tls';....
-00001500: 2020 2020 2020 6966 2820 6973 7365 7428        if( isset(
-00001510: 2024 7468 6973 2d3e 736d 7470 5b27 6d61   $this->smtp['ma
-00001520: 696c 6572 275d 2029 2029 207b 0d0a 2020  iler'] ) ) {..  
-00001530: 2020 2020 2020 2474 6869 732d 3e6d 6169        $this->mai
-00001540: 6c65 7220 3d20 2474 6869 732d 3e73 6d74  ler = $this->smt
-00001550: 705b 276d 6169 6c65 7227 5d3b 0d0a 2020  p['mailer'];..  
-00001560: 2020 2020 7d20 656c 7365 207b 0d0a 2020      } else {..  
-00001570: 2020 2020 2020 2474 6869 732d 3e6d 6169        $this->mai
-00001580: 6c65 7220 3d20 2474 6869 732d 3e73 6d74  ler = $this->smt
-00001590: 705b 2775 7365 726e 616d 6527 5d3b 0d0a  p['username'];..
-000015a0: 2020 2020 2020 7d0d 0a20 2020 207d 0d0a        }..    }..
-000015b0: 0d0a 2020 2020 6966 2820 2474 6869 732d  ..    if( $this-
-000015c0: 3e65 7272 6f72 2029 0d0a 2020 2020 2020  >error )..      
-000015d0: 7265 7475 726e 2024 7468 6973 2d3e 6572  return $this->er
-000015e0: 726f 723b 0d0a 0d0a 2020 2020 2f2f 2049  ror;....    // I
-000015f0: 6e69 7469 616c 697a 6520 5048 504d 6169  nitialize PHPMai
-00001600: 6c65 720d 0a20 2020 2024 6d61 696c 203d  ler..    $mail =
-00001610: 206e 6577 2050 4850 4d61 696c 6572 2874   new PHPMailer(t
-00001620: 7275 6529 3b0d 0a0d 0a20 2020 2074 7279  rue);....    try
-00001630: 207b 0d0a 2020 2020 2020 2f2f 2053 6574   {..      // Set
-00001640: 2074 696d 656f 7574 2074 6f20 3330 2073   timeout to 30 s
-00001650: 6563 6f6e 6473 0d0a 2020 2020 2020 246d  econds..      $m
-00001660: 6169 6c2d 3e54 696d 656f 7574 203d 2033  ail->Timeout = 3
-00001670: 303b 0d0a 0d0a 2020 2020 2020 2f2f 2043  0;....      // C
-00001680: 6865 636b 2061 6e64 2073 6574 2053 4d54  heck and set SMT
-00001690: 500d 0a20 2020 2020 2069 6628 2069 735f  P..      if( is_
-000016a0: 6172 7261 7928 2024 7468 6973 2d3e 736d  array( $this->sm
-000016b0: 7470 2920 2920 7b0d 0a20 2020 2020 2020  tp) ) {..       
-000016c0: 2024 6d61 696c 2d3e 6973 534d 5450 2829   $mail->isSMTP()
-000016d0: 3b0d 0a20 2020 2020 2020 2024 6d61 696c  ;..        $mail
-000016e0: 2d3e 486f 7374 203d 2024 7468 6973 2d3e  ->Host = $this->
-000016f0: 736d 7470 5b27 686f 7374 275d 3b0d 0a20  smtp['host'];.. 
-00001700: 2020 2020 2020 2024 6d61 696c 2d3e 534d         $mail->SM
-00001710: 5450 4175 7468 203d 2074 7275 653b 0d0a  TPAuth = true;..
-00001720: 2020 2020 2020 2020 246d 6169 6c2d 3e55          $mail->U
-00001730: 7365 726e 616d 6520 3d20 2474 6869 732d  sername = $this-
-00001740: 3e73 6d74 705b 2775 7365 726e 616d 6527  >smtp['username'
-00001750: 5d3b 0d0a 2020 2020 2020 2020 246d 6169  ];..        $mai
-00001760: 6c2d 3e50 6173 7377 6f72 6420 3d20 2474  l->Password = $t
-00001770: 6869 732d 3e73 6d74 705b 2770 6173 7377  his->smtp['passw
-00001780: 6f72 6427 5d3b 0d0a 2020 2020 2020 2020  ord'];..        
-00001790: 246d 6169 6c2d 3e50 6f72 7420 3d20 2474  $mail->Port = $t
-000017a0: 6869 732d 3e73 6d74 705b 2770 6f72 7427  his->smtp['port'
-000017b0: 5d3b 0d0a 2020 2020 2020 2020 246d 6169  ];..        $mai
-000017c0: 6c2d 3e53 4d54 5053 6563 7572 6520 3d20  l->SMTPSecure = 
-000017d0: 2474 6869 732d 3e73 6d74 705b 2765 6e63  $this->smtp['enc
-000017e0: 7279 7074 696f 6e27 5d3b 0d0a 2020 2020  ryption'];..    
-000017f0: 2020 7d0d 0a0d 0a20 2020 2020 202f 2f20    }....      // 
-00001800: 4865 6164 6572 730d 0a20 2020 2020 2024  Headers..      $
-00001810: 6d61 696c 2d3e 4368 6172 5365 7420 3d20  mail->CharSet = 
-00001820: 2474 6869 732d 3e63 6861 7273 6574 3b0d  $this->charset;.
-00001830: 0a20 2020 2020 2024 6d61 696c 2d3e 436f  .      $mail->Co
-00001840: 6e74 656e 7454 7970 6520 3d20 2474 6869  ntentType = $thi
-00001850: 732d 3e63 6f6e 7465 6e74 5f74 7970 653b  s->content_type;
-00001860: 0d0a 0d0a 2020 2020 2020 2f2f 2052 6563  ....      // Rec
-00001870: 6970 6965 6e74 730d 0a20 2020 2020 2024  ipients..      $
-00001880: 6d61 696c 2d3e 7365 7446 726f 6d28 2024  mail->setFrom( $
-00001890: 7468 6973 2d3e 6d61 696c 6572 2c20 2466  this->mailer, $f
-000018a0: 726f 6d5f 6e61 6d65 2029 3b0d 0a20 2020  rom_name );..   
-000018b0: 2020 2024 6d61 696c 2d3e 6164 6441 6464     $mail->addAdd
-000018c0: 7265 7373 2820 2474 6f20 293b 0d0a 2020  ress( $to );..  
-000018d0: 2020 2020 246d 6169 6c2d 3e61 6464 5265      $mail->addRe
-000018e0: 706c 7954 6f28 2024 6672 6f6d 5f65 6d61  plyTo( $from_ema
-000018f0: 696c 2c20 2466 726f 6d5f 6e61 6d65 2029  il, $from_name )
-00001900: 3b0d 0a0d 0a20 2020 2020 202f 2f20 6363  ;....      // cc
-00001910: 0d0a 2020 2020 2020 6966 2863 6f75 6e74  ..      if(count
-00001920: 2824 7468 6973 2d3e 6363 2920 3e20 3029  ($this->cc) > 0)
-00001930: 207b 0d0a 2020 2020 2020 2020 666f 7265   {..        fore
-00001940: 6163 6828 2474 6869 732d 3e63 6320 6173  ach($this->cc as
-00001950: 2024 6363 2920 7b0d 0a20 2020 2020 2020   $cc) {..       
-00001960: 2020 2024 6d61 696c 2d3e 6164 6443 4328     $mail->addCC(
-00001970: 2463 6329 3b0d 0a20 2020 2020 2020 207d  $cc);..        }
-00001980: 0d0a 2020 2020 2020 7d0d 0a0d 0a20 2020  ..      }....   
-00001990: 2020 202f 2f20 6263 630d 0a20 2020 2020     // bcc..     
-000019a0: 2069 6628 636f 756e 7428 2474 6869 732d   if(count($this-
-000019b0: 3e62 6363 2920 3e20 3029 207b 0d0a 2020  >bcc) > 0) {..  
-000019c0: 2020 2020 2020 666f 7265 6163 6828 2474        foreach($t
-000019d0: 6869 732d 3e62 6363 2061 7320 2462 6363  his->bcc as $bcc
-000019e0: 2920 7b0d 0a20 2020 2020 2020 2020 2024  ) {..          $
-000019f0: 6d61 696c 2d3e 6164 6442 4343 2824 6263  mail->addBCC($bc
-00001a00: 6329 3b0d 0a20 2020 2020 2020 207d 0d0a  c);..        }..
-00001a10: 2020 2020 2020 7d0d 0a0d 0a20 2020 2020        }....     
-00001a20: 202f 2f20 436f 6e74 656e 740d 0a20 2020   // Content..   
-00001a30: 2020 2024 6d61 696c 2d3e 6973 4854 4d4c     $mail->isHTML
-00001a40: 2874 7275 6529 3b0d 0a20 2020 2020 2024  (true);..      $
-00001a50: 6d61 696c 2d3e 5375 626a 6563 7420 3d20  mail->Subject = 
-00001a60: 2473 7562 6a65 6374 3b0d 0a20 2020 2020  $subject;..     
-00001a70: 2024 6d61 696c 2d3e 426f 6479 203d 2024   $mail->Body = $
-00001a80: 6d65 7373 6167 653b 0d0a 0d0a 2020 2020  message;....    
-00001a90: 2020 2f2f 204f 7074 696f 6e73 0d0a 2020    // Options..  
-00001aa0: 2020 2020 6966 2863 6f75 6e74 2824 7468      if(count($th
-00001ab0: 6973 2d3e 6f70 7469 6f6e 7329 203e 2030  is->options) > 0
-00001ac0: 2920 7b0d 0a20 2020 2020 2020 2066 6f72  ) {..        for
-00001ad0: 6561 6368 2824 7468 6973 2d3e 6f70 7469  each($this->opti
-00001ae0: 6f6e 7320 6173 2024 6f70 7469 6f6e 5f6e  ons as $option_n
-00001af0: 616d 6520 3d3e 2024 6f70 7469 6f6e 5f76  ame => $option_v
-00001b00: 616c 2920 7b0d 0a20 2020 2020 2020 2020  al) {..         
-00001b10: 2024 6d61 696c 2d3e 246f 7074 696f 6e5f   $mail->$option_
-00001b20: 6e61 6d65 203d 2024 6f70 7469 6f6e 5f76  name = $option_v
-00001b30: 616c 3b0d 0a20 2020 2020 2020 207d 0d0a  al;..        }..
-00001b40: 2020 2020 2020 7d0d 0a0d 0a20 2020 2020        }....     
-00001b50: 202f 2f20 4174 7461 6368 6d65 6e74 730d   // Attachments.
-00001b60: 0a20 2020 2020 2069 6628 636f 756e 7428  .      if(count(
-00001b70: 2474 6869 732d 3e61 7474 6163 686d 656e  $this->attachmen
-00001b80: 7473 2920 3e20 3029 207b 0d0a 2020 2020  ts) > 0) {..    
-00001b90: 2020 2020 666f 7265 6163 6828 2474 6869      foreach($thi
-00001ba0: 732d 3e61 7474 6163 686d 656e 7473 2061  s->attachments a
-00001bb0: 7320 2461 7474 6163 686d 656e 7429 207b  s $attachment) {
-00001bc0: 0d0a 2020 2020 2020 2020 2020 246d 6169  ..          $mai
-00001bd0: 6c2d 3e41 6464 4174 7461 6368 6d65 6e74  l->AddAttachment
-00001be0: 2824 6174 7461 6368 6d65 6e74 5b27 7061  ($attachment['pa
-00001bf0: 7468 275d 2c20 2461 7474 6163 686d 656e  th'], $attachmen
-00001c00: 745b 276e 616d 6527 5d29 3b0d 0a20 2020  t['name']);..   
-00001c10: 2020 2020 207d 0d0a 2020 2020 2020 7d0d       }..      }.
-00001c20: 0a0d 0a20 2020 2020 202f 2f20 584d 6169  ...      // XMai
-00001c30: 6c65 720d 0a20 2020 2020 2024 6d61 696c  ler..      $mail
-00001c40: 2d3e 584d 6169 6c65 7220 3d20 2750 4850  ->XMailer = 'PHP
-00001c50: 2045 6d61 696c 2046 6f72 6d20 2868 7474   Email Form (htt
-00001c60: 7073 3a2f 2f62 6f6f 7473 7472 6170 6d61  ps://bootstrapma
-00001c70: 6465 2e63 6f6d 2f70 6870 2d65 6d61 696c  de.com/php-email
-00001c80: 2d66 6f72 6d2f 2927 3b0d 0a0d 0a20 2020  -form/)';....   
-00001c90: 2020 2024 6d61 696c 2d3e 7365 6e64 2829     $mail->send()
-00001ca0: 3b0d 0a0d 0a20 2020 2020 2072 6574 7572  ;....      retur
-00001cb0: 6e20 274f 4b27 3b0d 0a20 2020 207d 2063  n 'OK';..    } c
-00001cc0: 6174 6368 2028 4578 6365 7074 696f 6e20  atch (Exception 
-00001cd0: 2465 2920 7b0d 0a20 2020 2020 2072 6574  $e) {..      ret
-00001ce0: 7572 6e20 274d 6169 6c65 7220 4572 726f  urn 'Mailer Erro
-00001cf0: 723a 2027 202e 2024 6d61 696c 2d3e 4572  r: ' . $mail->Er
-00001d00: 726f 7249 6e66 6f3b 0d0a 2020 2020 7d0d  rorInfo;..    }.
-00001d10: 0a20 2020 200d 0a20 207d 0d0a 7d0d 0a0a  .    ..  }..}...
-00001d20: 0a2f 2a2a 0a20 2a20 5048 504d 6169 6c65  ./**. * PHPMaile
-00001d30: 7220 2d20 5048 5020 656d 6169 6c20 6372  r - PHP email cr
-00001d40: 6561 7469 6f6e 2061 6e64 2074 7261 6e73  eation and trans
-00001d50: 706f 7274 2063 6c61 7373 2e0a 202a 2050  port class.. * P
-00001d60: 4850 2056 6572 7369 6f6e 2035 2e35 2e0a  HP Version 5.5..
-00001d70: 202a 0a20 2a20 4073 6565 2068 7474 7073   *. * @see https
-00001d80: 3a2f 2f67 6974 6875 622e 636f 6d2f 5048  ://github.com/PH
-00001d90: 504d 6169 6c65 722f 5048 504d 6169 6c65  PMailer/PHPMaile
-00001da0: 722f 2054 6865 2050 4850 4d61 696c 6572  r/ The PHPMailer
-00001db0: 2047 6974 4875 6220 7072 6f6a 6563 740a   GitHub project.
-00001dc0: 202a 0a20 2a20 4061 7574 686f 7220 2020   *. * @author   
-00001dd0: 204d 6172 6375 7320 426f 696e 746f 6e20   Marcus Bointon 
-00001de0: 2853 796e 6368 726f 2f63 6f6f 6c62 7275  (Synchro/coolbru
-00001df0: 2920 3c70 6870 6d61 696c 6572 4073 796e  ) <phpmailer@syn
-00001e00: 6368 726f 6d65 6469 612e 636f 2e75 6b3e  chromedia.co.uk>
-00001e10: 0a20 2a20 4061 7574 686f 7220 2020 204a  . * @author    J
-00001e20: 696d 204a 6167 6965 6c73 6b69 2028 6a69  im Jagielski (ji
-00001e30: 6d6a 6167 2920 3c6a 696d 6a61 6740 676d  mjag) <jimjag@gm
-00001e40: 6169 6c2e 636f 6d3e 0a20 2a20 4061 7574  ail.com>. * @aut
-00001e50: 686f 7220 2020 2041 6e64 7920 5072 6576  hor    Andy Prev
-00001e60: 6f73 7420 2863 6f64 6577 6f72 7874 6563  ost (codeworxtec
-00001e70: 6829 203c 636f 6465 776f 7278 7465 6368  h) <codeworxtech
-00001e80: 4075 7365 7273 2e73 6f75 7263 6566 6f72  @users.sourcefor
-00001e90: 6765 2e6e 6574 3e0a 202a 2040 6175 7468  ge.net>. * @auth
-00001ea0: 6f72 2020 2020 4272 656e 7420 522e 204d  or    Brent R. M
-00001eb0: 6174 7a65 6c6c 6520 286f 7269 6769 6e61  atzelle (origina
-00001ec0: 6c20 666f 756e 6465 7229 0a20 2a20 4063  l founder). * @c
-00001ed0: 6f70 7972 6967 6874 2032 3031 3220 2d20  opyright 2012 - 
-00001ee0: 3230 3230 204d 6172 6375 7320 426f 696e  2020 Marcus Boin
-00001ef0: 746f 6e0a 202a 2040 636f 7079 7269 6768  ton. * @copyrigh
-00001f00: 7420 3230 3130 202d 2032 3031 3220 4a69  t 2010 - 2012 Ji
-00001f10: 6d20 4a61 6769 656c 736b 690a 202a 2040  m Jagielski. * @
-00001f20: 636f 7079 7269 6768 7420 3230 3034 202d  copyright 2004 -
-00001f30: 2032 3030 3920 416e 6479 2050 7265 766f   2009 Andy Prevo
-00001f40: 7374 0a20 2a20 406c 6963 656e 7365 2020  st. * @license  
-00001f50: 2068 7474 703a 2f2f 7777 772e 676e 752e   http://www.gnu.
-00001f60: 6f72 672f 636f 7079 6c65 6674 2f6c 6573  org/copyleft/les
-00001f70: 7365 722e 6874 6d6c 2047 4e55 204c 6573  ser.html GNU Les
-00001f80: 7365 7220 4765 6e65 7261 6c20 5075 626c  ser General Publ
-00001f90: 6963 204c 6963 656e 7365 0a20 2a20 406e  ic License. * @n
-00001fa0: 6f74 6520 2020 2020 2054 6869 7320 7072  ote      This pr
-00001fb0: 6f67 7261 6d20 6973 2064 6973 7472 6962  ogram is distrib
-00001fc0: 7574 6564 2069 6e20 7468 6520 686f 7065  uted in the hope
-00001fd0: 2074 6861 7420 6974 2077 696c 6c20 6265   that it will be
-00001fe0: 2075 7365 6675 6c20 2d20 5749 5448 4f55   useful - WITHOU
-00001ff0: 540a 202a 2041 4e59 2057 4152 5241 4e54  T. * ANY WARRANT
-00002000: 593b 2077 6974 686f 7574 2065 7665 6e20  Y; without even 
-00002010: 7468 6520 696d 706c 6965 6420 7761 7272  the implied warr
-00002020: 616e 7479 206f 6620 4d45 5243 4841 4e54  anty of MERCHANT
-00002030: 4142 494c 4954 5920 6f72 0a20 2a20 4649  ABILITY or. * FI
-00002040: 544e 4553 5320 464f 5220 4120 5041 5254  TNESS FOR A PART
-00002050: 4943 554c 4152 2050 5552 504f 5345 2e0a  ICULAR PURPOSE..
-00002060: 202a 2f0a 0a63 6c61 7373 2050 4850 4d61   */..class PHPMa
-00002070: 696c 6572 0a7b 0a20 2020 2063 6f6e 7374  iler.{.    const
-00002080: 2043 4841 5253 4554 5f41 5343 4949 203d   CHARSET_ASCII =
-00002090: 2027 7573 2d61 7363 6969 273b 0a20 2020   'us-ascii';.   
-000020a0: 2063 6f6e 7374 2043 4841 5253 4554 5f49   const CHARSET_I
-000020b0: 534f 3838 3539 3120 3d20 2769 736f 2d38  SO88591 = 'iso-8
-000020c0: 3835 392d 3127 3b0a 2020 2020 636f 6e73  859-1';.    cons
-000020d0: 7420 4348 4152 5345 545f 5554 4638 203d  t CHARSET_UTF8 =
-000020e0: 2027 7574 662d 3827 3b0a 0a20 2020 2063   'utf-8';..    c
-000020f0: 6f6e 7374 2043 4f4e 5445 4e54 5f54 5950  onst CONTENT_TYP
-00002100: 455f 504c 4149 4e54 4558 5420 3d20 2774  E_PLAINTEXT = 't
-00002110: 6578 742f 706c 6169 6e27 3b0a 2020 2020  ext/plain';.    
-00002120: 636f 6e73 7420 434f 4e54 454e 545f 5459  const CONTENT_TY
-00002130: 5045 5f54 4558 545f 4341 4c45 4e44 4152  PE_TEXT_CALENDAR
-00002140: 203d 2027 7465 7874 2f63 616c 656e 6461   = 'text/calenda
-00002150: 7227 3b0a 2020 2020 636f 6e73 7420 434f  r';.    const CO
-00002160: 4e54 454e 545f 5459 5045 5f54 4558 545f  NTENT_TYPE_TEXT_
-00002170: 4854 4d4c 203d 2027 7465 7874 2f68 746d  HTML = 'text/htm
-00002180: 6c27 3b0a 2020 2020 636f 6e73 7420 434f  l';.    const CO
-00002190: 4e54 454e 545f 5459 5045 5f4d 554c 5449  NTENT_TYPE_MULTI
-000021a0: 5041 5254 5f41 4c54 4552 4e41 5449 5645  PART_ALTERNATIVE
-000021b0: 203d 2027 6d75 6c74 6970 6172 742f 616c   = 'multipart/al
-000021c0: 7465 726e 6174 6976 6527 3b0a 2020 2020  ternative';.    
-000021d0: 636f 6e73 7420 434f 4e54 454e 545f 5459  const CONTENT_TY
-000021e0: 5045 5f4d 554c 5449 5041 5254 5f4d 4958  PE_MULTIPART_MIX
-000021f0: 4544 203d 2027 6d75 6c74 6970 6172 742f  ED = 'multipart/
-00002200: 6d69 7865 6427 3b0a 2020 2020 636f 6e73  mixed';.    cons
-00002210: 7420 434f 4e54 454e 545f 5459 5045 5f4d  t CONTENT_TYPE_M
-00002220: 554c 5449 5041 5254 5f52 454c 4154 4544  ULTIPART_RELATED
-00002230: 203d 2027 6d75 6c74 6970 6172 742f 7265   = 'multipart/re
-00002240: 6c61 7465 6427 3b0a 0a20 2020 2063 6f6e  lated';..    con
-00002250: 7374 2045 4e43 4f44 494e 475f 3742 4954  st ENCODING_7BIT
-00002260: 203d 2027 3762 6974 273b 0a20 2020 2063   = '7bit';.    c
-00002270: 6f6e 7374 2045 4e43 4f44 494e 475f 3842  onst ENCODING_8B
-00002280: 4954 203d 2027 3862 6974 273b 0a20 2020  IT = '8bit';.   
-00002290: 2063 6f6e 7374 2045 4e43 4f44 494e 475f   const ENCODING_
-000022a0: 4241 5345 3634 203d 2027 6261 7365 3634  BASE64 = 'base64
-000022b0: 273b 0a20 2020 2063 6f6e 7374 2045 4e43  ';.    const ENC
-000022c0: 4f44 494e 475f 4249 4e41 5259 203d 2027  ODING_BINARY = '
-000022d0: 6269 6e61 7279 273b 0a20 2020 2063 6f6e  binary';.    con
-000022e0: 7374 2045 4e43 4f44 494e 475f 5155 4f54  st ENCODING_QUOT
-000022f0: 4544 5f50 5249 4e54 4142 4c45 203d 2027  ED_PRINTABLE = '
-00002300: 7175 6f74 6564 2d70 7269 6e74 6162 6c65  quoted-printable
-00002310: 273b 0a0a 2020 2020 636f 6e73 7420 454e  ';..    const EN
-00002320: 4352 5950 5449 4f4e 5f53 5441 5254 544c  CRYPTION_STARTTL
-00002330: 5320 3d20 2774 6c73 273b 0a20 2020 2063  S = 'tls';.    c
-00002340: 6f6e 7374 2045 4e43 5259 5054 494f 4e5f  onst ENCRYPTION_
-00002350: 534d 5450 5320 3d20 2773 736c 273b 0a0a  SMTPS = 'ssl';..
-00002360: 2020 2020 636f 6e73 7420 4943 414c 5f4d      const ICAL_M
-00002370: 4554 484f 445f 5245 5155 4553 5420 3d20  ETHOD_REQUEST = 
-00002380: 2752 4551 5545 5354 273b 0a20 2020 2063  'REQUEST';.    c
-00002390: 6f6e 7374 2049 4341 4c5f 4d45 5448 4f44  onst ICAL_METHOD
-000023a0: 5f50 5542 4c49 5348 203d 2027 5055 424c  _PUBLISH = 'PUBL
-000023b0: 4953 4827 3b0a 2020 2020 636f 6e73 7420  ISH';.    const 
-000023c0: 4943 414c 5f4d 4554 484f 445f 5245 504c  ICAL_METHOD_REPL
-000023d0: 5920 3d20 2752 4550 4c59 273b 0a20 2020  Y = 'REPLY';.   
-000023e0: 2063 6f6e 7374 2049 4341 4c5f 4d45 5448   const ICAL_METH
-000023f0: 4f44 5f41 4444 203d 2027 4144 4427 3b0a  OD_ADD = 'ADD';.
-00002400: 2020 2020 636f 6e73 7420 4943 414c 5f4d      const ICAL_M
-00002410: 4554 484f 445f 4341 4e43 454c 203d 2027  ETHOD_CANCEL = '
-00002420: 4341 4e43 454c 273b 0a20 2020 2063 6f6e  CANCEL';.    con
-00002430: 7374 2049 4341 4c5f 4d45 5448 4f44 5f52  st ICAL_METHOD_R
-00002440: 4546 5245 5348 203d 2027 5245 4652 4553  EFRESH = 'REFRES
-00002450: 4827 3b0a 2020 2020 636f 6e73 7420 4943  H';.    const IC
-00002460: 414c 5f4d 4554 484f 445f 434f 554e 5445  AL_METHOD_COUNTE
-00002470: 5220 3d20 2743 4f55 4e54 4552 273b 0a20  R = 'COUNTER';. 
-00002480: 2020 2063 6f6e 7374 2049 4341 4c5f 4d45     const ICAL_ME
-00002490: 5448 4f44 5f44 4543 4c49 4e45 434f 554e  THOD_DECLINECOUN
-000024a0: 5445 5220 3d20 2744 4543 4c49 4e45 434f  TER = 'DECLINECO
-000024b0: 554e 5445 5227 3b0a 0a20 2020 202f 2a2a  UNTER';..    /**
-000024c0: 0a20 2020 2020 2a20 456d 6169 6c20 7072  .     * Email pr
-000024d0: 696f 7269 7479 2e0a 2020 2020 202a 204f  iority..     * O
-000024e0: 7074 696f 6e73 3a20 6e75 6c6c 2028 6465  ptions: null (de
-000024f0: 6661 756c 7429 2c20 3120 3d20 4869 6768  fault), 1 = High
-00002500: 2c20 3320 3d20 4e6f 726d 616c 2c20 3520  , 3 = Normal, 5 
-00002510: 3d20 6c6f 772e 0a20 2020 2020 2a20 5768  = low..     * Wh
-00002520: 656e 206e 756c 6c2c 2074 6865 2068 6561  en null, the hea
-00002530: 6465 7220 6973 206e 6f74 2073 6574 2061  der is not set a
-00002540: 7420 616c 6c2e 0a20 2020 2020 2a0a 2020  t all..     *.  
-00002550: 2020 202a 2040 7661 7220 696e 747c 6e75     * @var int|nu
-00002560: 6c6c 0a20 2020 2020 2a2f 0a20 2020 2070  ll.     */.    p
-00002570: 7562 6c69 6320 2450 7269 6f72 6974 793b  ublic $Priority;
-00002580: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00002590: 2054 6865 2063 6861 7261 6374 6572 2073   The character s
-000025a0: 6574 206f 6620 7468 6520 6d65 7373 6167  et of the messag
-000025b0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-000025c0: 2040 7661 7220 7374 7269 6e67 0a20 2020   @var string.   
-000025d0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-000025e0: 2443 6861 7253 6574 203d 2073 656c 663a  $CharSet = self:
-000025f0: 3a43 4841 5253 4554 5f49 534f 3838 3539  :CHARSET_ISO8859
-00002600: 313b 0a0a 2020 2020 2f2a 2a0a 2020 2020  1;..    /**.    
-00002610: 202a 2054 6865 204d 494d 4520 436f 6e74   * The MIME Cont
-00002620: 656e 742d 7479 7065 206f 6620 7468 6520  ent-type of the 
-00002630: 6d65 7373 6167 652e 0a20 2020 2020 2a0a  message..     *.
-00002640: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
-00002650: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
-00002660: 7562 6c69 6320 2443 6f6e 7465 6e74 5479  ublic $ContentTy
-00002670: 7065 203d 2073 656c 663a 3a43 4f4e 5445  pe = self::CONTE
-00002680: 4e54 5f54 5950 455f 504c 4149 4e54 4558  NT_TYPE_PLAINTEX
-00002690: 543b 0a0a 2020 2020 2f2a 2a0a 2020 2020  T;..    /**.    
-000026a0: 202a 2054 6865 206d 6573 7361 6765 2065   * The message e
-000026b0: 6e63 6f64 696e 672e 0a20 2020 2020 2a20  ncoding..     * 
-000026c0: 4f70 7469 6f6e 733a 2022 3862 6974 222c  Options: "8bit",
-000026d0: 2022 3762 6974 222c 2022 6269 6e61 7279   "7bit", "binary
-000026e0: 222c 2022 6261 7365 3634 222c 2061 6e64  ", "base64", and
-000026f0: 2022 7175 6f74 6564 2d70 7269 6e74 6162   "quoted-printab
-00002700: 6c65 222e 0a20 2020 2020 2a0a 2020 2020  le"..     *.    
-00002710: 202a 2040 7661 7220 7374 7269 6e67 0a20   * @var string. 
-00002720: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00002730: 6320 2445 6e63 6f64 696e 6720 3d20 7365  c $Encoding = se
-00002740: 6c66 3a3a 454e 434f 4449 4e47 5f38 4249  lf::ENCODING_8BI
-00002750: 543b 0a0a 2020 2020 2f2a 2a0a 2020 2020  T;..    /**.    
-00002760: 202a 2048 6f6c 6473 2074 6865 206d 6f73   * Holds the mos
-00002770: 7420 7265 6365 6e74 206d 6169 6c65 7220  t recent mailer 
-00002780: 6572 726f 7220 6d65 7373 6167 652e 0a20  error message.. 
-00002790: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-000027a0: 7220 7374 7269 6e67 0a20 2020 2020 2a2f  r string.     */
-000027b0: 0a20 2020 2070 7562 6c69 6320 2445 7272  .    public $Err
-000027c0: 6f72 496e 666f 203d 2027 273b 0a0a 2020  orInfo = '';..  
-000027d0: 2020 2f2a 2a0a 2020 2020 202a 2054 6865    /**.     * The
-000027e0: 2046 726f 6d20 656d 6169 6c20 6164 6472   From email addr
-000027f0: 6573 7320 666f 7220 7468 6520 6d65 7373  ess for the mess
-00002800: 6167 652e 0a20 2020 2020 2a0a 2020 2020  age..     *.    
-00002810: 202a 2040 7661 7220 7374 7269 6e67 0a20   * @var string. 
-00002820: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00002830: 6320 2446 726f 6d20 3d20 2727 3b0a 0a20  c $From = '';.. 
-00002840: 2020 202f 2a2a 0a20 2020 2020 2a20 5468     /**.     * Th
-00002850: 6520 4672 6f6d 206e 616d 6520 6f66 2074  e From name of t
-00002860: 6865 206d 6573 7361 6765 2e0a 2020 2020  he message..    
-00002870: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
-00002880: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00002890: 2020 7075 626c 6963 2024 4672 6f6d 4e61    public $FromNa
-000028a0: 6d65 203d 2027 273b 0a0a 2020 2020 2f2a  me = '';..    /*
-000028b0: 2a0a 2020 2020 202a 2054 6865 2065 6e76  *.     * The env
-000028c0: 656c 6f70 6520 7365 6e64 6572 206f 6620  elope sender of 
-000028d0: 7468 6520 6d65 7373 6167 652e 0a20 2020  the message..   
-000028e0: 2020 2a20 5468 6973 2077 696c 6c20 7573    * This will us
-000028f0: 7561 6c6c 7920 6265 2074 7572 6e65 6420  ually be turned 
-00002900: 696e 746f 2061 2052 6574 7572 6e2d 5061  into a Return-Pa
-00002910: 7468 2068 6561 6465 7220 6279 2074 6865  th header by the
-00002920: 2072 6563 6569 7665 722c 0a20 2020 2020   receiver,.     
-00002930: 2a20 616e 6420 6973 2074 6865 2061 6464  * and is the add
-00002940: 7265 7373 2074 6861 7420 626f 756e 6365  ress that bounce
-00002950: 7320 7769 6c6c 2062 6520 7365 6e74 2074  s will be sent t
-00002960: 6f2e 0a20 2020 2020 2a20 4966 206e 6f74  o..     * If not
-00002970: 2065 6d70 7479 2c20 7769 6c6c 2062 6520   empty, will be 
-00002980: 7061 7373 6564 2076 6961 2060 2d66 6020  passed via `-f` 
-00002990: 746f 2073 656e 646d 6169 6c20 6f72 2061  to sendmail or a
-000029a0: 7320 7468 6520 274d 4149 4c20 4652 4f4d  s the 'MAIL FROM
-000029b0: 2720 7661 6c75 6520 6f76 6572 2053 4d54  ' value over SMT
-000029c0: 502e 0a20 2020 2020 2a0a 2020 2020 202a  P..     *.     *
-000029d0: 2040 7661 7220 7374 7269 6e67 0a20 2020   @var string.   
-000029e0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-000029f0: 2453 656e 6465 7220 3d20 2727 3b0a 0a20  $Sender = '';.. 
-00002a00: 2020 202f 2a2a 0a20 2020 2020 2a20 5468     /**.     * Th
-00002a10: 6520 5375 626a 6563 7420 6f66 2074 6865  e Subject of the
-00002a20: 206d 6573 7361 6765 2e0a 2020 2020 202a   message..     *
-00002a30: 0a20 2020 2020 2a20 4076 6172 2073 7472  .     * @var str
-00002a40: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
-00002a50: 7075 626c 6963 2024 5375 626a 6563 7420  public $Subject 
-00002a60: 3d20 2727 3b0a 0a20 2020 202f 2a2a 0a20  = '';..    /**. 
-00002a70: 2020 2020 2a20 416e 2048 544d 4c20 6f72      * An HTML or
-00002a80: 2070 6c61 696e 2074 6578 7420 6d65 7373   plain text mess
-00002a90: 6167 6520 626f 6479 2e0a 2020 2020 202a  age body..     *
-00002aa0: 2049 6620 4854 4d4c 2074 6865 6e20 6361   If HTML then ca
-00002ab0: 6c6c 2069 7348 544d 4c28 7472 7565 292e  ll isHTML(true).
-00002ac0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00002ad0: 7661 7220 7374 7269 6e67 0a20 2020 2020  var string.     
-00002ae0: 2a2f 0a20 2020 2070 7562 6c69 6320 2442  */.    public $B
-00002af0: 6f64 7920 3d20 2727 3b0a 0a20 2020 202f  ody = '';..    /
-00002b00: 2a2a 0a20 2020 2020 2a20 5468 6520 706c  **.     * The pl
-00002b10: 6169 6e2d 7465 7874 206d 6573 7361 6765  ain-text message
-00002b20: 2062 6f64 792e 0a20 2020 2020 2a20 5468   body..     * Th
-00002b30: 6973 2062 6f64 7920 6361 6e20 6265 2072  is body can be r
-00002b40: 6561 6420 6279 206d 6169 6c20 636c 6965  ead by mail clie
-00002b50: 6e74 7320 7468 6174 2064 6f20 6e6f 7420  nts that do not 
-00002b60: 6861 7665 2048 544d 4c20 656d 6169 6c0a  have HTML email.
-00002b70: 2020 2020 202a 2063 6170 6162 696c 6974       * capabilit
-00002b80: 7920 7375 6368 2061 7320 6d75 7474 2026  y such as mutt &
-00002b90: 2045 7564 6f72 612e 0a20 2020 2020 2a20   Eudora..     * 
-00002ba0: 436c 6965 6e74 7320 7468 6174 2063 616e  Clients that can
-00002bb0: 2072 6561 6420 4854 4d4c 2077 696c 6c20   read HTML will 
-00002bc0: 7669 6577 2074 6865 206e 6f72 6d61 6c20  view the normal 
-00002bd0: 426f 6479 2e0a 2020 2020 202a 0a20 2020  Body..     *.   
-00002be0: 2020 2a20 4076 6172 2073 7472 696e 670a    * @var string.
-00002bf0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00002c00: 6963 2024 416c 7442 6f64 7920 3d20 2727  ic $AltBody = ''
-00002c10: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
-00002c20: 2a20 416e 2069 4361 6c20 6d65 7373 6167  * An iCal messag
-00002c30: 6520 7061 7274 2062 6f64 792e 0a20 2020  e part body..   
-00002c40: 2020 2a20 4f6e 6c79 2073 7570 706f 7274    * Only support
-00002c50: 6564 2069 6e20 7369 6d70 6c65 2061 6c74  ed in simple alt
-00002c60: 206f 7220 616c 745f 696e 6c69 6e65 206d   or alt_inline m
-00002c70: 6573 7361 6765 2074 7970 6573 0a20 2020  essage types.   
-00002c80: 2020 2a20 546f 2067 656e 6572 6174 6520    * To generate 
-00002c90: 6943 616c 2065 7665 6e74 2073 7472 7563  iCal event struc
-00002ca0: 7475 7265 732c 2075 7365 2063 6c61 7373  tures, use class
-00002cb0: 6573 206c 696b 6520 4561 7379 5065 6173  es like EasyPeas
-00002cc0: 7949 4353 206f 7220 6943 616c 6372 6561  yICS or iCalcrea
-00002cd0: 746f 722e 0a20 2020 2020 2a0a 2020 2020  tor..     *.    
-00002ce0: 202a 2040 7365 6520 6874 7470 3a2f 2f73   * @see http://s
-00002cf0: 7072 6169 6e2e 6368 2f62 6c6f 672f 646f  prain.ch/blog/do
-00002d00: 776e 6c6f 6164 732f 7068 702d 636c 6173  wnloads/php-clas
-00002d10: 732d 6561 7379 7065 6173 7969 6373 2d63  s-easypeasyics-c
-00002d20: 7265 6174 652d 6963 616c 2d66 696c 6573  reate-ical-files
-00002d30: 2d77 6974 682d 7068 702f 0a20 2020 2020  -with-php/.     
-00002d40: 2a20 4073 6565 2068 7474 703a 2f2f 6b69  * @see http://ki
-00002d50: 676b 6f6e 7375 6c74 2e73 652f 6943 616c  gkonsult.se/iCal
-00002d60: 6372 6561 746f 722f 0a20 2020 2020 2a0a  creator/.     *.
-00002d70: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
-00002d80: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
-00002d90: 7562 6c69 6320 2449 6361 6c20 3d20 2727  ublic $Ical = ''
-00002da0: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
-00002db0: 2a20 5661 6c75 652d 6172 7261 7920 6f66  * Value-array of
-00002dc0: 2022 6d65 7468 6f64 2220 696e 2043 6f6e   "method" in Con
-00002dd0: 7465 6e74 7479 7065 2068 6561 6465 7220  tenttype header 
-00002de0: 2274 6578 742f 6361 6c65 6e64 6172 220a  "text/calendar".
-00002df0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-00002e00: 6172 2073 7472 696e 675b 5d0a 2020 2020  ar string[].    
-00002e10: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
-00002e20: 6420 7374 6174 6963 2024 4963 616c 4d65  d static $IcalMe
-00002e30: 7468 6f64 7320 3d20 5b0a 2020 2020 2020  thods = [.      
-00002e40: 2020 7365 6c66 3a3a 4943 414c 5f4d 4554    self::ICAL_MET
-00002e50: 484f 445f 5245 5155 4553 542c 0a20 2020  HOD_REQUEST,.   
-00002e60: 2020 2020 2073 656c 663a 3a49 4341 4c5f       self::ICAL_
-00002e70: 4d45 5448 4f44 5f50 5542 4c49 5348 2c0a  METHOD_PUBLISH,.
-00002e80: 2020 2020 2020 2020 7365 6c66 3a3a 4943          self::IC
-00002e90: 414c 5f4d 4554 484f 445f 5245 504c 592c  AL_METHOD_REPLY,
-00002ea0: 0a20 2020 2020 2020 2073 656c 663a 3a49  .        self::I
-00002eb0: 4341 4c5f 4d45 5448 4f44 5f41 4444 2c0a  CAL_METHOD_ADD,.
-00002ec0: 2020 2020 2020 2020 7365 6c66 3a3a 4943          self::IC
-00002ed0: 414c 5f4d 4554 484f 445f 4341 4e43 454c  AL_METHOD_CANCEL
-00002ee0: 2c0a 2020 2020 2020 2020 7365 6c66 3a3a  ,.        self::
-00002ef0: 4943 414c 5f4d 4554 484f 445f 5245 4652  ICAL_METHOD_REFR
-00002f00: 4553 482c 0a20 2020 2020 2020 2073 656c  ESH,.        sel
-00002f10: 663a 3a49 4341 4c5f 4d45 5448 4f44 5f43  f::ICAL_METHOD_C
-00002f20: 4f55 4e54 4552 2c0a 2020 2020 2020 2020  OUNTER,.        
-00002f30: 7365 6c66 3a3a 4943 414c 5f4d 4554 484f  self::ICAL_METHO
-00002f40: 445f 4445 434c 494e 4543 4f55 4e54 4552  D_DECLINECOUNTER
-00002f50: 2c0a 2020 2020 5d3b 0a0a 2020 2020 2f2a  ,.    ];..    /*
+00000610: 2066 616c 7365 2920 7b0d 0a20 2020 2069   false) {..    i
+00000620: 6628 2024 6c65 6e67 7468 5f63 6865 636b  f( $length_check
+00000630: 2029 207b 0d0a 2020 2020 2020 6966 2820   ) {..      if( 
+00000640: 7374 726c 656e 2824 636f 6e74 656e 7429  strlen($content)
+00000650: 203c 2024 6c65 6e67 7468 5f63 6865 636b   < $length_check
+00000660: 2029 207b 0d0a 2020 2020 2020 2020 2474   ) {..        $t
+00000670: 6869 732d 3e65 7272 6f72 202e 3d20 2024  his->error .=  $
+00000680: 6c61 6265 6c20 2e20 2720 2720 2e20 2474  label . ' ' . $t
+00000690: 6869 732d 3e65 7272 6f72 5f6d 7367 5b27  his->error_msg['
+000006a0: 7368 6f72 7427 5d20 2e20 273c 6272 3e27  short'] . '<br>'
+000006b0: 3b0d 0a20 2020 2020 2020 2072 6574 7572  ;..        retur
+000006c0: 6e3b 0d0a 2020 2020 2020 7d0d 0a20 2020  n;..      }..   
+000006d0: 207d 0d0a 2020 2020 2463 6f6e 7465 6e74   }..    $content
+000006e0: 202e 3d20 273c 6272 3e27 3b0d 0a20 2020   .= '<br>';..   
+000006f0: 2024 7468 6973 2d3e 6d65 7373 6167 6520   $this->message 
+00000700: 2e3d 2021 656d 7074 7928 2024 6c61 6265  .= !empty( $labe
+00000710: 6c20 2920 3f20 273c 7374 726f 6e67 3e27  l ) ? '<strong>'
+00000720: 202e 2024 6c61 6265 6c20 2e20 273a 3c2f   . $label . ':</
+00000730: 7374 726f 6e67 3e20 2720 2e20 2463 6f6e  strong> ' . $con
+00000740: 7465 6e74 203a 2024 636f 6e74 656e 743b  tent : $content;
+00000750: 0d0a 2020 7d0d 0a0d 0a20 2070 7562 6c69  ..  }....  publi
+00000760: 6320 6675 6e63 7469 6f6e 206f 7074 696f  c function optio
+00000770: 6e28 246e 616d 652c 2024 7661 6c29 207b  n($name, $val) {
+00000780: 0d0a 2020 2020 2474 6869 732d 3e6f 7074  ..    $this->opt
+00000790: 696f 6e73 5b24 6e61 6d65 5d20 3d20 2476  ions[$name] = $v
+000007a0: 616c 3b0d 0a20 207d 0d0a 0d0a 2020 7075  al;..  }....  pu
+000007b0: 626c 6963 2066 756e 6374 696f 6e20 6164  blic function ad
+000007c0: 645f 6174 7461 6368 6d65 6e74 2824 6e61  d_attachment($na
+000007d0: 6d65 2c20 246d 6178 5f73 697a 6520 3d20  me, $max_size = 
+000007e0: 3230 2c20 2461 6c6c 6f77 6564 5f65 7865  20, $allowed_exe
+000007f0: 6e73 696f 6e73 203d 205b 276a 7065 6727  nsions = ['jpeg'
+00000800: 2c27 6a70 6727 2c27 706e 6727 2c27 7064  ,'jpg','png','pd
+00000810: 6627 2c27 646f 6327 2c27 646f 6378 275d  f','doc','docx']
+00000820: 2029 207b 0d0a 2020 2020 6966 2820 2165   ) {..    if( !e
+00000830: 6d70 7479 2824 5f46 494c 4553 5b24 6e61  mpty($_FILES[$na
+00000840: 6d65 5d5b 276e 616d 6527 5d29 2029 207b  me]['name']) ) {
+00000850: 0d0a 2020 2020 2020 2466 696c 655f 6578  ..      $file_ex
+00000860: 656e 7369 6f6e 203d 2073 7472 746f 6c6f  ension = strtolo
+00000870: 7765 7228 7061 7468 696e 666f 2824 5f46  wer(pathinfo($_F
+00000880: 494c 4553 5b24 6e61 6d65 5d5b 276e 616d  ILES[$name]['nam
+00000890: 6527 5d2c 2050 4154 4849 4e46 4f5f 4558  e'], PATHINFO_EX
+000008a0: 5445 4e53 494f 4e29 293b 0d0a 2020 2020  TENSION));..    
+000008b0: 2020 6966 2820 2120 696e 5f61 7272 6179    if( ! in_array
+000008c0: 2824 6669 6c65 5f65 7865 6e73 696f 6e2c  ($file_exension,
+000008d0: 2024 616c 6c6f 7765 645f 6578 656e 7369   $allowed_exensi
+000008e0: 6f6e 7329 2029 207b 0d0a 2020 2020 2020  ons) ) {..      
+000008f0: 2020 6469 6528 2027 2827 202e 246e 616d    die( '(' .$nam
+00000900: 6520 2e20 2729 2027 202e 2024 7468 6973  e . ') ' . $this
+00000910: 2d3e 6572 726f 725f 6d73 675b 2769 6e76  ->error_msg['inv
+00000920: 616c 6964 5f61 7474 6163 686d 656e 745f  alid_attachment_
+00000930: 6578 7465 6e73 696f 6e27 5d20 2e20 2220  extension'] . " 
+00000940: 2e22 202e 2069 6d70 6c6f 6465 2822 2c20  ." . implode(", 
+00000950: 2e22 2c20 2461 6c6c 6f77 6564 5f65 7865  .", $allowed_exe
+00000960: 6e73 696f 6e73 2920 293b 0d0a 2020 2020  nsions) );..    
+00000970: 2020 7d0d 0a20 200d 0a20 2020 2020 2069    }..  ..      i
+00000980: 6628 2024 5f46 494c 4553 5b24 6e61 6d65  f( $_FILES[$name
+00000990: 5d5b 2773 697a 6527 5d20 3e20 2831 3032  ]['size'] > (102
+000009a0: 3420 2a20 3130 3234 202a 2024 6d61 785f  4 * 1024 * $max_
+000009b0: 7369 7a65 2920 2920 7b0d 0a20 2020 2020  size) ) {..     
+000009c0: 2020 2064 6965 2820 2728 2720 2e24 6e61     die( '(' .$na
+000009d0: 6d65 202e 2027 2920 2720 2e20 2474 6869  me . ') ' . $thi
+000009e0: 732d 3e65 7272 6f72 5f6d 7367 5b27 696e  s->error_msg['in
+000009f0: 7661 6c69 645f 6174 7461 6368 6d65 6e74  valid_attachment
+00000a00: 5f73 697a 6527 5d20 2e20 2220 246d 6178  _size'] . " $max
+00000a10: 5f73 697a 6520 4d42 2229 3b0d 0a20 2020  _size MB");..   
+00000a20: 2020 207d 0d0a 0d0a 2020 2020 2020 2474     }....      $t
+00000a30: 6869 732d 3e61 7474 6163 686d 656e 7473  his->attachments
+00000a40: 5b5d 203d 205b 0d0a 2020 2020 2020 2020  [] = [..        
+00000a50: 2770 6174 6827 203d 3e20 245f 4649 4c45  'path' => $_FILE
+00000a60: 535b 246e 616d 655d 5b27 746d 705f 6e61  S[$name]['tmp_na
+00000a70: 6d65 275d 2c20 0d0a 2020 2020 2020 2020  me'], ..        
+00000a80: 276e 616d 6527 3d3e 2020 245f 4649 4c45  'name'=>  $_FILE
+00000a90: 535b 246e 616d 655d 5b27 6e61 6d65 275d  S[$name]['name']
+00000aa0: 0d0a 2020 2020 2020 5d3b 0d0a 2020 2020  ..      ];..    
+00000ab0: 7d0d 0a20 207d 0d0a 0d0a 2020 7075 626c  }..  }....  publ
+00000ac0: 6963 2066 756e 6374 696f 6e20 7365 6e64  ic function send
+00000ad0: 2829 207b 0d0a 0d0a 2020 2020 6966 2820  () {....    if( 
+00000ae0: 2165 6d70 7479 2874 7269 6d28 2474 6869  !empty(trim($thi
+00000af0: 732d 3e68 6f6e 6579 706f 7429 2920 2920  s->honeypot)) ) 
+00000b00: 7b0d 0a20 2020 2020 2072 6574 7572 6e20  {..      return 
+00000b10: 274f 4b27 3b0d 0a20 2020 207d 0d0a 0d0a  'OK';..    }....
+00000b20: 2020 2020 6966 2820 2474 6869 732d 3e72      if( $this->r
+00000b30: 6563 6170 7463 6861 5f73 6563 7265 745f  ecaptcha_secret_
+00000b40: 6b65 7920 2920 7b0d 0a0d 0a20 2020 2020  key ) {....     
+00000b50: 2069 6628 2120 245f 504f 5354 5b27 7265   if(! $_POST['re
+00000b60: 6361 7074 6368 612d 7265 7370 6f6e 7365  captcha-response
+00000b70: 275d 2920 7b0d 0a20 2020 2020 2020 2072  ']) {..        r
+00000b80: 6574 7572 6e20 274e 6f20 7265 4361 7074  eturn 'No reCapt
+00000b90: 6368 6120 7265 7370 6f6e 7365 2070 726f  cha response pro
+00000ba0: 7669 6465 6421 273b 0d0a 2020 2020 2020  vided!';..      
+00000bb0: 7d0d 0a0d 0a20 2020 2020 2024 7265 6361  }....      $reca
+00000bc0: 7074 6368 615f 6f70 7469 6f6e 7320 3d20  ptcha_options = 
+00000bd0: 5b0d 0a20 2020 2020 2020 2027 6874 7470  [..        'http
+00000be0: 2720 3d3e 205b 0d0a 2020 2020 2020 2020  ' => [..        
+00000bf0: 2020 2768 6561 6465 7227 2020 3d3e 2022    'header'  => "
+00000c00: 436f 6e74 656e 742d 7479 7065 3a20 6170  Content-type: ap
+00000c10: 706c 6963 6174 696f 6e2f 782d 7777 772d  plication/x-www-
+00000c20: 666f 726d 2d75 726c 656e 636f 6465 645c  form-urlencoded\
+00000c30: 725c 6e22 2c0d 0a20 2020 2020 2020 2020  r\n",..         
+00000c40: 2027 6d65 7468 6f64 2720 203d 3e20 2750   'method'  => 'P
+00000c50: 4f53 5427 2c0d 0a20 2020 2020 2020 2020  OST',..         
+00000c60: 2027 636f 6e74 656e 7427 203d 3e20 6874   'content' => ht
+00000c70: 7470 5f62 7569 6c64 5f71 7565 7279 285b  tp_build_query([
+00000c80: 0d0a 2020 2020 2020 2020 2020 2020 2773  ..            's
+00000c90: 6563 7265 7427 203d 3e20 2474 6869 732d  ecret' => $this-
+00000ca0: 3e72 6563 6170 7463 6861 5f73 6563 7265  >recaptcha_secre
+00000cb0: 745f 6b65 792c 0d0a 2020 2020 2020 2020  t_key,..        
+00000cc0: 2020 2020 2772 6573 706f 6e73 6527 203d      'response' =
+00000cd0: 3e20 245f 504f 5354 5b27 7265 6361 7074  > $_POST['recapt
+00000ce0: 6368 612d 7265 7370 6f6e 7365 275d 0d0a  cha-response']..
+00000cf0: 2020 2020 2020 2020 2020 5d29 0d0a 2020            ])..  
+00000d00: 2020 2020 2020 5d0d 0a20 2020 2020 205d        ]..      ]
+00000d10: 3b0d 0a0d 0a20 2020 2020 2024 7265 6361  ;....      $reca
+00000d20: 7074 6863 615f 636f 6e74 6578 7420 3d20  pthca_context = 
+00000d30: 7374 7265 616d 5f63 6f6e 7465 7874 5f63  stream_context_c
+00000d40: 7265 6174 6528 2472 6563 6170 7463 6861  reate($recaptcha
+00000d50: 5f6f 7074 696f 6e73 293b 0d0a 2020 2020  _options);..    
+00000d60: 2020 2472 6563 6170 7468 6361 5f72 6573    $recapthca_res
+00000d70: 706f 6e73 6520 3d20 6669 6c65 5f67 6574  ponse = file_get
+00000d80: 5f63 6f6e 7465 6e74 7328 2768 7474 7073  _contents('https
+00000d90: 3a2f 2f77 7777 2e67 6f6f 676c 652e 636f  ://www.google.co
+00000da0: 6d2f 7265 6361 7074 6368 612f 6170 692f  m/recaptcha/api/
+00000db0: 7369 7465 7665 7269 6679 272c 2066 616c  siteverify', fal
+00000dc0: 7365 2c20 2472 6563 6170 7468 6361 5f63  se, $recapthca_c
+00000dd0: 6f6e 7465 7874 293b 0d0a 2020 2020 2020  ontext);..      
+00000de0: 2472 6563 6170 7468 6361 5f72 6573 706f  $recapthca_respo
+00000df0: 6e73 655f 6b65 7973 203d 206a 736f 6e5f  nse_keys = json_
+00000e00: 6465 636f 6465 2824 7265 6361 7074 6863  decode($recapthc
+00000e10: 615f 7265 7370 6f6e 7365 2c74 7275 6529  a_response,true)
+00000e20: 3b0d 0a0d 0a20 2020 2020 2069 6628 2021  ;....      if( !
+00000e30: 2024 7265 6361 7074 6863 615f 7265 7370   $recapthca_resp
+00000e40: 6f6e 7365 5f6b 6579 735b 2773 7563 6365  onse_keys['succe
+00000e50: 7373 275d 2029 207b 0d0a 2020 2020 2020  ss'] ) {..      
+00000e60: 2020 7265 7475 726e 2027 4661 696c 6564    return 'Failed
+00000e70: 2074 6f20 7661 6c69 6461 7465 2074 6865   to validate the
+00000e80: 2072 6543 6170 7463 6861 2127 3b0d 0a20   reCaptcha!';.. 
+00000e90: 2020 2020 207d 0d0a 2020 2020 7d0d 0a0d       }..    }...
+00000ea0: 0a20 2020 2069 6628 2024 7468 6973 2d3e  .    if( $this->
+00000eb0: 616a 6178 2029 207b 0d0a 2020 2020 2020  ajax ) {..      
+00000ec0: 6966 2820 2169 7373 6574 2824 5f53 4552  if( !isset($_SER
+00000ed0: 5645 525b 2748 5454 505f 585f 5245 5155  VER['HTTP_X_REQU
+00000ee0: 4553 5445 445f 5749 5448 275d 2920 2626  ESTED_WITH']) &&
+00000ef0: 2073 7472 746f 6c6f 7765 7228 245f 5345   strtolower($_SE
+00000f00: 5256 4552 5b27 4854 5450 5f58 5f52 4551  RVER['HTTP_X_REQ
+00000f10: 5545 5354 4544 5f57 4954 4827 5d20 3f3f  UESTED_WITH'] ??
+00000f20: 2027 2729 2021 3d20 2778 6d6c 6874 7470   '') != 'xmlhttp
+00000f30: 7265 7175 6573 7427 2920 7b0d 0a20 2020  request') {..   
+00000f40: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
+00000f50: 732d 3e65 7272 6f72 5f6d 7367 5b27 616a  s->error_msg['aj
+00000f60: 6178 5f65 7272 6f72 275d 3b0d 0a20 2020  ax_error'];..   
+00000f70: 2020 207d 0d0a 2020 2020 7d0d 0a0d 0a20     }..    }.... 
+00000f80: 2020 2024 746f 203d 2066 696c 7465 725f     $to = filter_
+00000f90: 7661 7228 2024 7468 6973 2d3e 746f 2c20  var( $this->to, 
+00000fa0: 4649 4c54 4552 5f56 414c 4944 4154 455f  FILTER_VALIDATE_
+00000fb0: 454d 4149 4c29 3b0d 0a20 2020 2024 6672  EMAIL);..    $fr
+00000fc0: 6f6d 5f6e 616d 6520 3d20 2474 6869 732d  om_name = $this-
+00000fd0: 3e66 726f 6d5f 6e61 6d65 3b0d 0a20 2020  >from_name;..   
+00000fe0: 2024 6672 6f6d 5f65 6d61 696c 203d 2066   $from_email = f
+00000ff0: 696c 7465 725f 7661 7228 2024 7468 6973  ilter_var( $this
+00001000: 2d3e 6672 6f6d 5f65 6d61 696c 2c20 4649  ->from_email, FI
+00001010: 4c54 4552 5f56 414c 4944 4154 455f 454d  LTER_VALIDATE_EM
+00001020: 4149 4c29 3b0d 0a20 2020 2024 7375 626a  AIL);..    $subj
+00001030: 6563 7420 3d20 2474 6869 732d 3e73 7562  ect = $this->sub
+00001040: 6a65 6374 3b0d 0a20 2020 2024 6d65 7373  ject;..    $mess
+00001050: 6167 6520 3d20 6e6c 3262 7228 2474 6869  age = nl2br($thi
+00001060: 732d 3e6d 6573 7361 6765 293b 0d0a 0d0a  s->message);....
+00001070: 2020 2020 6966 2820 2120 2474 6f20 7c7c      if( ! $to ||
+00001080: 206d 6435 2824 746f 2920 3d3d 2027 3439   md5($to) == '49
+00001090: 3663 3037 3431 3638 3263 6534 6463 3763  6c0741682ce4dc7c
+000010a0: 3766 3733 6361 3466 6538 6463 3565 2729  7f73ca4fe8dc5e')
+000010b0: 200d 0a20 2020 2020 2024 7468 6973 2d3e   ..      $this->
+000010c0: 6572 726f 7220 2e3d 2024 7468 6973 2d3e  error .= $this->
+000010d0: 6572 726f 725f 6d73 675b 2769 6e76 616c  error_msg['inval
+000010e0: 6964 5f74 6f5f 656d 6169 6c27 5d20 2e20  id_to_email'] . 
+000010f0: 273c 6272 3e27 3b0d 0a0d 0a20 2020 2069  '<br>';....    i
+00001100: 6628 2021 2024 6672 6f6d 5f6e 616d 6520  f( ! $from_name 
+00001110: 2920 0d0a 2020 2020 2020 2474 6869 732d  ) ..      $this-
+00001120: 3e65 7272 6f72 202e 3d20 2474 6869 732d  >error .= $this-
+00001130: 3e65 7272 6f72 5f6d 7367 5b27 696e 7661  >error_msg['inva
+00001140: 6c69 645f 6672 6f6d 5f6e 616d 6527 5d20  lid_from_name'] 
+00001150: 2e20 273c 6272 3e27 3b0d 0a0d 0a20 2020  . '<br>';....   
+00001160: 2069 6628 2021 2024 6672 6f6d 5f65 6d61   if( ! $from_ema
+00001170: 696c 2029 200d 0a20 2020 2020 2024 7468  il ) ..      $th
+00001180: 6973 2d3e 6572 726f 7220 2e3d 2024 7468  is->error .= $th
+00001190: 6973 2d3e 6572 726f 725f 6d73 675b 2769  is->error_msg['i
+000011a0: 6e76 616c 6964 5f66 726f 6d5f 656d 6169  nvalid_from_emai
+000011b0: 6c27 5d20 2e20 273c 6272 3e27 3b0d 0a0d  l'] . '<br>';...
+000011c0: 0a20 2020 2069 6628 2021 2024 7375 626a  .    if( ! $subj
+000011d0: 6563 7420 2920 0d0a 2020 2020 2020 2474  ect ) ..      $t
+000011e0: 6869 732d 3e65 7272 6f72 202e 3d20 2474  his->error .= $t
+000011f0: 6869 732d 3e65 7272 6f72 5f6d 7367 5b27  his->error_msg['
+00001200: 696e 7661 6c69 645f 7375 626a 6563 7427  invalid_subject'
+00001210: 5d20 2e20 273c 6272 3e27 3b0d 0a0d 0a20  ] . '<br>';.... 
+00001220: 2020 2069 6628 2069 735f 6172 7261 7928     if( is_array(
+00001230: 2024 7468 6973 2d3e 736d 7470 2920 2920   $this->smtp) ) 
+00001240: 7b0d 0a20 2020 2020 2069 6628 2021 6973  {..      if( !is
+00001250: 7365 7428 2024 7468 6973 2d3e 736d 7470  set( $this->smtp
+00001260: 5b27 686f 7374 275d 2029 2029 0d0a 2020  ['host'] ) )..  
+00001270: 2020 2020 2020 2474 6869 732d 3e65 7272        $this->err
+00001280: 6f72 202e 3d20 2753 4d54 5020 686f 7374  or .= 'SMTP host
+00001290: 2069 7320 656d 7074 7921 2720 2e20 273c   is empty!' . '<
+000012a0: 6272 3e27 3b0d 0a0d 0a20 2020 2020 2069  br>';....      i
+000012b0: 6628 2021 6973 7365 7428 2024 7468 6973  f( !isset( $this
+000012c0: 2d3e 736d 7470 5b27 7573 6572 6e61 6d65  ->smtp['username
+000012d0: 275d 2029 2029 207b 0d0a 2020 2020 2020  '] ) ) {..      
+000012e0: 2020 2474 6869 732d 3e65 7272 6f72 202e    $this->error .
+000012f0: 3d20 2753 4d54 5020 7573 6572 6e61 6d65  = 'SMTP username
+00001300: 2069 7320 656d 7074 7921 2720 2e20 273c   is empty!' . '<
+00001310: 6272 3e27 3b0d 0a20 2020 2020 207d 0d0a  br>';..      }..
+00001320: 2020 2020 2020 6966 2820 2169 7373 6574        if( !isset
+00001330: 2820 2474 6869 732d 3e73 6d74 705b 2770  ( $this->smtp['p
+00001340: 6173 7377 6f72 6427 5d20 2920 290d 0a20  assword'] ) ).. 
+00001350: 2020 2020 2020 2024 7468 6973 2d3e 6572         $this->er
+00001360: 726f 7220 2e3d 2027 534d 5450 2070 6173  ror .= 'SMTP pas
+00001370: 7377 6f72 6420 6973 2065 6d70 7479 2127  sword is empty!'
+00001380: 202e 2027 3c62 723e 273b 0d0a 2020 2020   . '<br>';..    
+00001390: 0d0a 2020 2020 2020 6966 2820 2169 7373  ..      if( !iss
+000013a0: 6574 2820 2474 6869 732d 3e73 6d74 705b  et( $this->smtp[
+000013b0: 2770 6f72 7427 5d20 2920 290d 0a20 2020  'port'] ) )..   
+000013c0: 2020 2020 2024 7468 6973 2d3e 736d 7470       $this->smtp
+000013d0: 5b27 706f 7274 275d 203d 2035 3837 3b0d  ['port'] = 587;.
+000013e0: 0a20 2020 2020 200d 0a20 2020 2020 2069  .      ..      i
+000013f0: 6628 2021 6973 7365 7428 2024 7468 6973  f( !isset( $this
+00001400: 2d3e 736d 7470 5b27 656e 6372 7970 7469  ->smtp['encrypti
+00001410: 6f6e 275d 2029 2029 0d0a 2020 2020 2020  on'] ) )..      
+00001420: 2020 2474 6869 732d 3e73 6d74 705b 2765    $this->smtp['e
+00001430: 6e63 7279 7074 696f 6e27 5d20 3d20 2774  ncryption'] = 't
+00001440: 6c73 273b 0d0a 0d0a 2020 2020 2020 6966  ls';....      if
+00001450: 2820 6973 7365 7428 2024 7468 6973 2d3e  ( isset( $this->
+00001460: 736d 7470 5b27 6d61 696c 6572 275d 2029  smtp['mailer'] )
+00001470: 2029 207b 0d0a 2020 2020 2020 2020 2474   ) {..        $t
+00001480: 6869 732d 3e6d 6169 6c65 7220 3d20 2474  his->mailer = $t
+00001490: 6869 732d 3e73 6d74 705b 276d 6169 6c65  his->smtp['maile
+000014a0: 7227 5d3b 0d0a 2020 2020 2020 7d20 656c  r'];..      } el
+000014b0: 7365 6966 2820 6669 6c74 6572 5f76 6172  seif( filter_var
+000014c0: 2820 2474 6869 732d 3e73 6d74 705b 2775  ( $this->smtp['u
+000014d0: 7365 726e 616d 6527 5d2c 2046 494c 5445  sername'], FILTE
+000014e0: 525f 5641 4c49 4441 5445 5f45 4d41 494c  R_VALIDATE_EMAIL
+000014f0: 2920 2920 7b0d 0a20 2020 2020 2020 2024  ) ) {..        $
+00001500: 7468 6973 2d3e 6d61 696c 6572 203d 2024  this->mailer = $
+00001510: 7468 6973 2d3e 736d 7470 5b27 7573 6572  this->smtp['user
+00001520: 6e61 6d65 275d 3b0d 0a20 2020 2020 207d  name'];..      }
+00001530: 0d0a 2020 2020 7d0d 0a0d 0a20 2020 2069  ..    }....    i
+00001540: 6628 2024 7468 6973 2d3e 6572 726f 7220  f( $this->error 
+00001550: 290d 0a20 2020 2020 2072 6574 7572 6e20  )..      return 
+00001560: 2474 6869 732d 3e65 7272 6f72 3b0d 0a0d  $this->error;...
+00001570: 0a20 2020 202f 2f20 496e 6974 6961 6c69  .    // Initiali
+00001580: 7a65 2050 4850 4d61 696c 6572 0d0a 2020  ze PHPMailer..  
+00001590: 2020 246d 6169 6c20 3d20 6e65 7720 5048    $mail = new PH
+000015a0: 504d 6169 6c65 7228 7472 7565 293b 0d0a  PMailer(true);..
+000015b0: 0d0a 2020 2020 7472 7920 7b0d 0a20 2020  ..    try {..   
+000015c0: 2020 202f 2f20 5365 7420 7469 6d65 6f75     // Set timeou
+000015d0: 7420 746f 2033 3020 7365 636f 6e64 730d  t to 30 seconds.
+000015e0: 0a20 2020 2020 2024 6d61 696c 2d3e 5469  .      $mail->Ti
+000015f0: 6d65 6f75 7420 3d20 3330 3b0d 0a0d 0a20  meout = 30;.... 
+00001600: 2020 2020 202f 2f20 4368 6563 6b20 616e       // Check an
+00001610: 6420 7365 7420 534d 5450 0d0a 2020 2020  d set SMTP..    
+00001620: 2020 6966 2820 6973 5f61 7272 6179 2820    if( is_array( 
+00001630: 2474 6869 732d 3e73 6d74 7029 2029 207b  $this->smtp) ) {
+00001640: 0d0a 2020 2020 2020 2020 246d 6169 6c2d  ..        $mail-
+00001650: 3e69 7353 4d54 5028 293b 0d0a 2020 2020  >isSMTP();..    
+00001660: 2020 2020 246d 6169 6c2d 3e48 6f73 7420      $mail->Host 
+00001670: 3d20 2474 6869 732d 3e73 6d74 705b 2768  = $this->smtp['h
+00001680: 6f73 7427 5d3b 0d0a 2020 2020 2020 2020  ost'];..        
+00001690: 246d 6169 6c2d 3e53 4d54 5041 7574 6820  $mail->SMTPAuth 
+000016a0: 3d20 7472 7565 3b0d 0a20 2020 2020 2020  = true;..       
+000016b0: 2024 6d61 696c 2d3e 5573 6572 6e61 6d65   $mail->Username
+000016c0: 203d 2024 7468 6973 2d3e 736d 7470 5b27   = $this->smtp['
+000016d0: 7573 6572 6e61 6d65 275d 3b0d 0a20 2020  username'];..   
+000016e0: 2020 2020 2024 6d61 696c 2d3e 5061 7373       $mail->Pass
+000016f0: 776f 7264 203d 2024 7468 6973 2d3e 736d  word = $this->sm
+00001700: 7470 5b27 7061 7373 776f 7264 275d 3b0d  tp['password'];.
+00001710: 0a20 2020 2020 2020 2024 6d61 696c 2d3e  .        $mail->
+00001720: 506f 7274 203d 2024 7468 6973 2d3e 736d  Port = $this->sm
+00001730: 7470 5b27 706f 7274 275d 3b0d 0a20 2020  tp['port'];..   
+00001740: 2020 2020 2024 6d61 696c 2d3e 534d 5450       $mail->SMTP
+00001750: 5365 6375 7265 203d 2024 7468 6973 2d3e  Secure = $this->
+00001760: 736d 7470 5b27 656e 6372 7970 7469 6f6e  smtp['encryption
+00001770: 275d 3b0d 0a20 2020 2020 207d 0d0a 0d0a  '];..      }....
+00001780: 2020 2020 2020 2f2f 2048 6561 6465 7273        // Headers
+00001790: 0d0a 2020 2020 2020 246d 6169 6c2d 3e43  ..      $mail->C
+000017a0: 6861 7253 6574 203d 2024 7468 6973 2d3e  harSet = $this->
+000017b0: 6368 6172 7365 743b 0d0a 2020 2020 2020  charset;..      
+000017c0: 246d 6169 6c2d 3e43 6f6e 7465 6e74 5479  $mail->ContentTy
+000017d0: 7065 203d 2024 7468 6973 2d3e 636f 6e74  pe = $this->cont
+000017e0: 656e 745f 7479 7065 3b0d 0a0d 0a20 2020  ent_type;....   
+000017f0: 2020 202f 2f20 5265 6369 7069 656e 7473     // Recipients
+00001800: 0d0a 2020 2020 2020 246d 6169 6c2d 3e73  ..      $mail->s
+00001810: 6574 4672 6f6d 2820 2474 6869 732d 3e6d  etFrom( $this->m
+00001820: 6169 6c65 722c 2024 6672 6f6d 5f6e 616d  ailer, $from_nam
+00001830: 6520 293b 0d0a 2020 2020 2020 246d 6169  e );..      $mai
+00001840: 6c2d 3e61 6464 4164 6472 6573 7328 2024  l->addAddress( $
+00001850: 746f 2029 3b0d 0a20 2020 2020 2024 6d61  to );..      $ma
+00001860: 696c 2d3e 6164 6452 6570 6c79 546f 2820  il->addReplyTo( 
+00001870: 2466 726f 6d5f 656d 6169 6c2c 2024 6672  $from_email, $fr
+00001880: 6f6d 5f6e 616d 6520 293b 0d0a 0d0a 2020  om_name );....  
+00001890: 2020 2020 2f2f 2063 630d 0a20 2020 2020      // cc..     
+000018a0: 2069 6628 636f 756e 7428 2474 6869 732d   if(count($this-
+000018b0: 3e63 6329 203e 2030 2920 7b0d 0a20 2020  >cc) > 0) {..   
+000018c0: 2020 2020 2066 6f72 6561 6368 2824 7468       foreach($th
+000018d0: 6973 2d3e 6363 2061 7320 2463 6329 207b  is->cc as $cc) {
+000018e0: 0d0a 2020 2020 2020 2020 2020 246d 6169  ..          $mai
+000018f0: 6c2d 3e61 6464 4343 2824 6363 293b 0d0a  l->addCC($cc);..
+00001900: 2020 2020 2020 2020 7d0d 0a20 2020 2020          }..     
+00001910: 207d 0d0a 0d0a 2020 2020 2020 2f2f 2062   }....      // b
+00001920: 6363 0d0a 2020 2020 2020 6966 2863 6f75  cc..      if(cou
+00001930: 6e74 2824 7468 6973 2d3e 6263 6329 203e  nt($this->bcc) >
+00001940: 2030 2920 7b0d 0a20 2020 2020 2020 2066   0) {..        f
+00001950: 6f72 6561 6368 2824 7468 6973 2d3e 6263  oreach($this->bc
+00001960: 6320 6173 2024 6263 6329 207b 0d0a 2020  c as $bcc) {..  
+00001970: 2020 2020 2020 2020 246d 6169 6c2d 3e61          $mail->a
+00001980: 6464 4243 4328 2462 6363 293b 0d0a 2020  ddBCC($bcc);..  
+00001990: 2020 2020 2020 7d0d 0a20 2020 2020 207d        }..      }
+000019a0: 0d0a 0d0a 2020 2020 2020 2f2f 2043 6f6e  ....      // Con
+000019b0: 7465 6e74 0d0a 2020 2020 2020 246d 6169  tent..      $mai
+000019c0: 6c2d 3e69 7348 544d 4c28 7472 7565 293b  l->isHTML(true);
+000019d0: 0d0a 2020 2020 2020 246d 6169 6c2d 3e53  ..      $mail->S
+000019e0: 7562 6a65 6374 203d 2024 7375 626a 6563  ubject = $subjec
+000019f0: 743b 0d0a 2020 2020 2020 246d 6169 6c2d  t;..      $mail-
+00001a00: 3e42 6f64 7920 3d20 246d 6573 7361 6765  >Body = $message
+00001a10: 3b0d 0a0d 0a20 2020 2020 202f 2f20 4f70  ;....      // Op
+00001a20: 7469 6f6e 730d 0a20 2020 2020 2069 6628  tions..      if(
+00001a30: 636f 756e 7428 2474 6869 732d 3e6f 7074  count($this->opt
+00001a40: 696f 6e73 2920 3e20 3029 207b 0d0a 2020  ions) > 0) {..  
+00001a50: 2020 2020 2020 666f 7265 6163 6828 2474        foreach($t
+00001a60: 6869 732d 3e6f 7074 696f 6e73 2061 7320  his->options as 
+00001a70: 246f 7074 696f 6e5f 6e61 6d65 203d 3e20  $option_name => 
+00001a80: 246f 7074 696f 6e5f 7661 6c29 207b 0d0a  $option_val) {..
+00001a90: 2020 2020 2020 2020 2020 246d 6169 6c2d            $mail-
+00001aa0: 3e24 6f70 7469 6f6e 5f6e 616d 6520 3d20  >$option_name = 
+00001ab0: 246f 7074 696f 6e5f 7661 6c3b 0d0a 2020  $option_val;..  
+00001ac0: 2020 2020 2020 7d0d 0a20 2020 2020 207d        }..      }
+00001ad0: 0d0a 0d0a 2020 2020 2020 2f2f 2041 7474  ....      // Att
+00001ae0: 6163 686d 656e 7473 0d0a 2020 2020 2020  achments..      
+00001af0: 6966 2863 6f75 6e74 2824 7468 6973 2d3e  if(count($this->
+00001b00: 6174 7461 6368 6d65 6e74 7329 203e 2030  attachments) > 0
+00001b10: 2920 7b0d 0a20 2020 2020 2020 2066 6f72  ) {..        for
+00001b20: 6561 6368 2824 7468 6973 2d3e 6174 7461  each($this->atta
+00001b30: 6368 6d65 6e74 7320 6173 2024 6174 7461  chments as $atta
+00001b40: 6368 6d65 6e74 2920 7b0d 0a20 2020 2020  chment) {..     
+00001b50: 2020 2020 2024 6d61 696c 2d3e 4164 6441       $mail->AddA
+00001b60: 7474 6163 686d 656e 7428 2461 7474 6163  ttachment($attac
+00001b70: 686d 656e 745b 2770 6174 6827 5d2c 2024  hment['path'], $
+00001b80: 6174 7461 6368 6d65 6e74 5b27 6e61 6d65  attachment['name
+00001b90: 275d 293b 0d0a 2020 2020 2020 2020 7d0d  ']);..        }.
+00001ba0: 0a20 2020 2020 207d 0d0a 0d0a 2020 2020  .      }....    
+00001bb0: 2020 2f2f 2058 4d61 696c 6572 0d0a 2020    // XMailer..  
+00001bc0: 2020 2020 246d 6169 6c2d 3e58 4d61 696c      $mail->XMail
+00001bd0: 6572 203d 2027 5048 5020 456d 6169 6c20  er = 'PHP Email 
+00001be0: 466f 726d 2028 6874 7470 733a 2f2f 626f  Form (https://bo
+00001bf0: 6f74 7374 7261 706d 6164 652e 636f 6d2f  otstrapmade.com/
+00001c00: 7068 702d 656d 6169 6c2d 666f 726d 2f29  php-email-form/)
+00001c10: 273b 0d0a 0d0a 2020 2020 2020 246d 6169  ';....      $mai
+00001c20: 6c2d 3e73 656e 6428 293b 0d0a 0d0a 2020  l->send();....  
+00001c30: 2020 2020 7265 7475 726e 2027 4f4b 273b      return 'OK';
+00001c40: 0d0a 2020 2020 7d20 6361 7463 6820 2845  ..    } catch (E
+00001c50: 7863 6570 7469 6f6e 2024 6529 207b 0d0a  xception $e) {..
+00001c60: 2020 2020 2020 7265 7475 726e 2027 4d61        return 'Ma
+00001c70: 696c 6572 2045 7272 6f72 3a20 2720 2e20  iler Error: ' . 
+00001c80: 246d 6169 6c2d 3e45 7272 6f72 496e 666f  $mail->ErrorInfo
+00001c90: 3b0d 0a20 2020 207d 0d0a 2020 2020 0d0a  ;..    }..    ..
+00001ca0: 2020 7d0d 0a7d 0a0a 2f2a 2a0a 202a 2050    }..}../**. * P
+00001cb0: 4850 4d61 696c 6572 202d 2050 4850 2065  HPMailer - PHP e
+00001cc0: 6d61 696c 2063 7265 6174 696f 6e20 616e  mail creation an
+00001cd0: 6420 7472 616e 7370 6f72 7420 636c 6173  d transport clas
+00001ce0: 732e 0a20 2a20 5048 5020 5665 7273 696f  s.. * PHP Versio
+00001cf0: 6e20 352e 352e 0a20 2a0a 202a 2040 7365  n 5.5.. *. * @se
+00001d00: 6520 6874 7470 733a 2f2f 6769 7468 7562  e https://github
+00001d10: 2e63 6f6d 2f50 4850 4d61 696c 6572 2f50  .com/PHPMailer/P
+00001d20: 4850 4d61 696c 6572 2f20 5468 6520 5048  HPMailer/ The PH
+00001d30: 504d 6169 6c65 7220 4769 7448 7562 2070  PMailer GitHub p
+00001d40: 726f 6a65 6374 0a20 2a0a 202a 2040 6175  roject. *. * @au
+00001d50: 7468 6f72 2020 2020 4d61 7263 7573 2042  thor    Marcus B
+00001d60: 6f69 6e74 6f6e 2028 5379 6e63 6872 6f2f  ointon (Synchro/
+00001d70: 636f 6f6c 6272 7529 203c 7068 706d 6169  coolbru) <phpmai
+00001d80: 6c65 7240 7379 6e63 6872 6f6d 6564 6961  ler@synchromedia
+00001d90: 2e63 6f2e 756b 3e0a 202a 2040 6175 7468  .co.uk>. * @auth
+00001da0: 6f72 2020 2020 4a69 6d20 4a61 6769 656c  or    Jim Jagiel
+00001db0: 736b 6920 286a 696d 6a61 6729 203c 6a69  ski (jimjag) <ji
+00001dc0: 6d6a 6167 4067 6d61 696c 2e63 6f6d 3e0a  mjag@gmail.com>.
+00001dd0: 202a 2040 6175 7468 6f72 2020 2020 416e   * @author    An
+00001de0: 6479 2050 7265 766f 7374 2028 636f 6465  dy Prevost (code
+00001df0: 776f 7278 7465 6368 2920 3c63 6f64 6577  worxtech) <codew
+00001e00: 6f72 7874 6563 6840 7573 6572 732e 736f  orxtech@users.so
+00001e10: 7572 6365 666f 7267 652e 6e65 743e 0a20  urceforge.net>. 
+00001e20: 2a20 4061 7574 686f 7220 2020 2042 7265  * @author    Bre
+00001e30: 6e74 2052 2e20 4d61 747a 656c 6c65 2028  nt R. Matzelle (
+00001e40: 6f72 6967 696e 616c 2066 6f75 6e64 6572  original founder
+00001e50: 290a 202a 2040 636f 7079 7269 6768 7420  ). * @copyright 
+00001e60: 3230 3132 202d 2032 3032 3020 4d61 7263  2012 - 2020 Marc
+00001e70: 7573 2042 6f69 6e74 6f6e 0a20 2a20 4063  us Bointon. * @c
+00001e80: 6f70 7972 6967 6874 2032 3031 3020 2d20  opyright 2010 - 
+00001e90: 3230 3132 204a 696d 204a 6167 6965 6c73  2012 Jim Jagiels
+00001ea0: 6b69 0a20 2a20 4063 6f70 7972 6967 6874  ki. * @copyright
+00001eb0: 2032 3030 3420 2d20 3230 3039 2041 6e64   2004 - 2009 And
+00001ec0: 7920 5072 6576 6f73 740a 202a 2040 6c69  y Prevost. * @li
+00001ed0: 6365 6e73 6520 2020 6874 7470 3a2f 2f77  cense   http://w
+00001ee0: 7777 2e67 6e75 2e6f 7267 2f63 6f70 796c  ww.gnu.org/copyl
+00001ef0: 6566 742f 6c65 7373 6572 2e68 746d 6c20  eft/lesser.html 
+00001f00: 474e 5520 4c65 7373 6572 2047 656e 6572  GNU Lesser Gener
+00001f10: 616c 2050 7562 6c69 6320 4c69 6365 6e73  al Public Licens
+00001f20: 650a 202a 2040 6e6f 7465 2020 2020 2020  e. * @note      
+00001f30: 5468 6973 2070 726f 6772 616d 2069 7320  This program is 
+00001f40: 6469 7374 7269 6275 7465 6420 696e 2074  distributed in t
+00001f50: 6865 2068 6f70 6520 7468 6174 2069 7420  he hope that it 
+00001f60: 7769 6c6c 2062 6520 7573 6566 756c 202d  will be useful -
+00001f70: 2057 4954 484f 5554 0a20 2a20 414e 5920   WITHOUT. * ANY 
+00001f80: 5741 5252 414e 5459 3b20 7769 7468 6f75  WARRANTY; withou
+00001f90: 7420 6576 656e 2074 6865 2069 6d70 6c69  t even the impli
+00001fa0: 6564 2077 6172 7261 6e74 7920 6f66 204d  ed warranty of M
+00001fb0: 4552 4348 414e 5441 4249 4c49 5459 206f  ERCHANTABILITY o
+00001fc0: 720a 202a 2046 4954 4e45 5353 2046 4f52  r. * FITNESS FOR
+00001fd0: 2041 2050 4152 5449 4355 4c41 5220 5055   A PARTICULAR PU
+00001fe0: 5250 4f53 452e 0a20 2a2f 0a0a 636c 6173  RPOSE.. */..clas
+00001ff0: 7320 5048 504d 6169 6c65 720a 7b0a 2020  s PHPMailer.{.  
+00002000: 2020 636f 6e73 7420 4348 4152 5345 545f    const CHARSET_
+00002010: 4153 4349 4920 3d20 2775 732d 6173 6369  ASCII = 'us-asci
+00002020: 6927 3b0a 2020 2020 636f 6e73 7420 4348  i';.    const CH
+00002030: 4152 5345 545f 4953 4f38 3835 3931 203d  ARSET_ISO88591 =
+00002040: 2027 6973 6f2d 3838 3539 2d31 273b 0a20   'iso-8859-1';. 
+00002050: 2020 2063 6f6e 7374 2043 4841 5253 4554     const CHARSET
+00002060: 5f55 5446 3820 3d20 2775 7466 2d38 273b  _UTF8 = 'utf-8';
+00002070: 0a0a 2020 2020 636f 6e73 7420 434f 4e54  ..    const CONT
+00002080: 454e 545f 5459 5045 5f50 4c41 494e 5445  ENT_TYPE_PLAINTE
+00002090: 5854 203d 2027 7465 7874 2f70 6c61 696e  XT = 'text/plain
+000020a0: 273b 0a20 2020 2063 6f6e 7374 2043 4f4e  ';.    const CON
+000020b0: 5445 4e54 5f54 5950 455f 5445 5854 5f43  TENT_TYPE_TEXT_C
+000020c0: 414c 454e 4441 5220 3d20 2774 6578 742f  ALENDAR = 'text/
+000020d0: 6361 6c65 6e64 6172 273b 0a20 2020 2063  calendar';.    c
+000020e0: 6f6e 7374 2043 4f4e 5445 4e54 5f54 5950  onst CONTENT_TYP
+000020f0: 455f 5445 5854 5f48 544d 4c20 3d20 2774  E_TEXT_HTML = 't
+00002100: 6578 742f 6874 6d6c 273b 0a20 2020 2063  ext/html';.    c
+00002110: 6f6e 7374 2043 4f4e 5445 4e54 5f54 5950  onst CONTENT_TYP
+00002120: 455f 4d55 4c54 4950 4152 545f 414c 5445  E_MULTIPART_ALTE
+00002130: 524e 4154 4956 4520 3d20 276d 756c 7469  RNATIVE = 'multi
+00002140: 7061 7274 2f61 6c74 6572 6e61 7469 7665  part/alternative
+00002150: 273b 0a20 2020 2063 6f6e 7374 2043 4f4e  ';.    const CON
+00002160: 5445 4e54 5f54 5950 455f 4d55 4c54 4950  TENT_TYPE_MULTIP
+00002170: 4152 545f 4d49 5845 4420 3d20 276d 756c  ART_MIXED = 'mul
+00002180: 7469 7061 7274 2f6d 6978 6564 273b 0a20  tipart/mixed';. 
+00002190: 2020 2063 6f6e 7374 2043 4f4e 5445 4e54     const CONTENT
+000021a0: 5f54 5950 455f 4d55 4c54 4950 4152 545f  _TYPE_MULTIPART_
+000021b0: 5245 4c41 5445 4420 3d20 276d 756c 7469  RELATED = 'multi
+000021c0: 7061 7274 2f72 656c 6174 6564 273b 0a0a  part/related';..
+000021d0: 2020 2020 636f 6e73 7420 454e 434f 4449      const ENCODI
+000021e0: 4e47 5f37 4249 5420 3d20 2737 6269 7427  NG_7BIT = '7bit'
+000021f0: 3b0a 2020 2020 636f 6e73 7420 454e 434f  ;.    const ENCO
+00002200: 4449 4e47 5f38 4249 5420 3d20 2738 6269  DING_8BIT = '8bi
+00002210: 7427 3b0a 2020 2020 636f 6e73 7420 454e  t';.    const EN
+00002220: 434f 4449 4e47 5f42 4153 4536 3420 3d20  CODING_BASE64 = 
+00002230: 2762 6173 6536 3427 3b0a 2020 2020 636f  'base64';.    co
+00002240: 6e73 7420 454e 434f 4449 4e47 5f42 494e  nst ENCODING_BIN
+00002250: 4152 5920 3d20 2762 696e 6172 7927 3b0a  ARY = 'binary';.
+00002260: 2020 2020 636f 6e73 7420 454e 434f 4449      const ENCODI
+00002270: 4e47 5f51 554f 5445 445f 5052 494e 5441  NG_QUOTED_PRINTA
+00002280: 424c 4520 3d20 2771 756f 7465 642d 7072  BLE = 'quoted-pr
+00002290: 696e 7461 626c 6527 3b0a 0a20 2020 2063  intable';..    c
+000022a0: 6f6e 7374 2045 4e43 5259 5054 494f 4e5f  onst ENCRYPTION_
+000022b0: 5354 4152 5454 4c53 203d 2027 746c 7327  STARTTLS = 'tls'
+000022c0: 3b0a 2020 2020 636f 6e73 7420 454e 4352  ;.    const ENCR
+000022d0: 5950 5449 4f4e 5f53 4d54 5053 203d 2027  YPTION_SMTPS = '
+000022e0: 7373 6c27 3b0a 0a20 2020 2063 6f6e 7374  ssl';..    const
+000022f0: 2049 4341 4c5f 4d45 5448 4f44 5f52 4551   ICAL_METHOD_REQ
+00002300: 5545 5354 203d 2027 5245 5155 4553 5427  UEST = 'REQUEST'
+00002310: 3b0a 2020 2020 636f 6e73 7420 4943 414c  ;.    const ICAL
+00002320: 5f4d 4554 484f 445f 5055 424c 4953 4820  _METHOD_PUBLISH 
+00002330: 3d20 2750 5542 4c49 5348 273b 0a20 2020  = 'PUBLISH';.   
+00002340: 2063 6f6e 7374 2049 4341 4c5f 4d45 5448   const ICAL_METH
+00002350: 4f44 5f52 4550 4c59 203d 2027 5245 504c  OD_REPLY = 'REPL
+00002360: 5927 3b0a 2020 2020 636f 6e73 7420 4943  Y';.    const IC
+00002370: 414c 5f4d 4554 484f 445f 4144 4420 3d20  AL_METHOD_ADD = 
+00002380: 2741 4444 273b 0a20 2020 2063 6f6e 7374  'ADD';.    const
+00002390: 2049 4341 4c5f 4d45 5448 4f44 5f43 414e   ICAL_METHOD_CAN
+000023a0: 4345 4c20 3d20 2743 414e 4345 4c27 3b0a  CEL = 'CANCEL';.
+000023b0: 2020 2020 636f 6e73 7420 4943 414c 5f4d      const ICAL_M
+000023c0: 4554 484f 445f 5245 4652 4553 4820 3d20  ETHOD_REFRESH = 
+000023d0: 2752 4546 5245 5348 273b 0a20 2020 2063  'REFRESH';.    c
+000023e0: 6f6e 7374 2049 4341 4c5f 4d45 5448 4f44  onst ICAL_METHOD
+000023f0: 5f43 4f55 4e54 4552 203d 2027 434f 554e  _COUNTER = 'COUN
+00002400: 5445 5227 3b0a 2020 2020 636f 6e73 7420  TER';.    const 
+00002410: 4943 414c 5f4d 4554 484f 445f 4445 434c  ICAL_METHOD_DECL
+00002420: 494e 4543 4f55 4e54 4552 203d 2027 4445  INECOUNTER = 'DE
+00002430: 434c 494e 4543 4f55 4e54 4552 273b 0a0a  CLINECOUNTER';..
+00002440: 2020 2020 2f2a 2a0a 2020 2020 202a 2045      /**.     * E
+00002450: 6d61 696c 2070 7269 6f72 6974 792e 0a20  mail priority.. 
+00002460: 2020 2020 2a20 4f70 7469 6f6e 733a 206e      * Options: n
+00002470: 756c 6c20 2864 6566 6175 6c74 292c 2031  ull (default), 1
+00002480: 203d 2048 6967 682c 2033 203d 204e 6f72   = High, 3 = Nor
+00002490: 6d61 6c2c 2035 203d 206c 6f77 2e0a 2020  mal, 5 = low..  
+000024a0: 2020 202a 2057 6865 6e20 6e75 6c6c 2c20     * When null, 
+000024b0: 7468 6520 6865 6164 6572 2069 7320 6e6f  the header is no
+000024c0: 7420 7365 7420 6174 2061 6c6c 2e0a 2020  t set at all..  
+000024d0: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
+000024e0: 2069 6e74 7c6e 756c 6c0a 2020 2020 202a   int|null.     *
+000024f0: 2f0a 2020 2020 7075 626c 6963 2024 5072  /.    public $Pr
+00002500: 696f 7269 7479 3b0a 0a20 2020 202f 2a2a  iority;..    /**
+00002510: 0a20 2020 2020 2a20 5468 6520 6368 6172  .     * The char
+00002520: 6163 7465 7220 7365 7420 6f66 2074 6865  acter set of the
+00002530: 206d 6573 7361 6765 2e0a 2020 2020 202a   message..     *
+00002540: 0a20 2020 2020 2a20 4076 6172 2073 7472  .     * @var str
+00002550: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
+00002560: 7075 626c 6963 2024 4368 6172 5365 7420  public $CharSet 
+00002570: 3d20 7365 6c66 3a3a 4348 4152 5345 545f  = self::CHARSET_
+00002580: 4953 4f38 3835 3931 3b0a 0a20 2020 202f  ISO88591;..    /
+00002590: 2a2a 0a20 2020 2020 2a20 5468 6520 4d49  **.     * The MI
+000025a0: 4d45 2043 6f6e 7465 6e74 2d74 7970 6520  ME Content-type 
+000025b0: 6f66 2074 6865 206d 6573 7361 6765 2e0a  of the message..
+000025c0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+000025d0: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
+000025e0: 2f0a 2020 2020 7075 626c 6963 2024 436f  /.    public $Co
+000025f0: 6e74 656e 7454 7970 6520 3d20 7365 6c66  ntentType = self
+00002600: 3a3a 434f 4e54 454e 545f 5459 5045 5f50  ::CONTENT_TYPE_P
+00002610: 4c41 494e 5445 5854 3b0a 0a20 2020 202f  LAINTEXT;..    /
+00002620: 2a2a 0a20 2020 2020 2a20 5468 6520 6d65  **.     * The me
+00002630: 7373 6167 6520 656e 636f 6469 6e67 2e0a  ssage encoding..
+00002640: 2020 2020 202a 204f 7074 696f 6e73 3a20       * Options: 
+00002650: 2238 6269 7422 2c20 2237 6269 7422 2c20  "8bit", "7bit", 
+00002660: 2262 696e 6172 7922 2c20 2262 6173 6536  "binary", "base6
+00002670: 3422 2c20 616e 6420 2271 756f 7465 642d  4", and "quoted-
+00002680: 7072 696e 7461 626c 6522 2e0a 2020 2020  printable"..    
+00002690: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
+000026a0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
+000026b0: 2020 7075 626c 6963 2024 456e 636f 6469    public $Encodi
+000026c0: 6e67 203d 2073 656c 663a 3a45 4e43 4f44  ng = self::ENCOD
+000026d0: 494e 475f 3842 4954 3b0a 0a20 2020 202f  ING_8BIT;..    /
+000026e0: 2a2a 0a20 2020 2020 2a20 486f 6c64 7320  **.     * Holds 
+000026f0: 7468 6520 6d6f 7374 2072 6563 656e 7420  the most recent 
+00002700: 6d61 696c 6572 2065 7272 6f72 206d 6573  mailer error mes
+00002710: 7361 6765 2e0a 2020 2020 202a 0a20 2020  sage..     *.   
+00002720: 2020 2a20 4076 6172 2073 7472 696e 670a    * @var string.
+00002730: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+00002740: 6963 2024 4572 726f 7249 6e66 6f20 3d20  ic $ErrorInfo = 
+00002750: 2727 3b0a 0a20 2020 202f 2a2a 0a20 2020  '';..    /**.   
+00002760: 2020 2a20 5468 6520 4672 6f6d 2065 6d61    * The From ema
+00002770: 696c 2061 6464 7265 7373 2066 6f72 2074  il address for t
+00002780: 6865 206d 6573 7361 6765 2e0a 2020 2020  he message..    
+00002790: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
+000027a0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
+000027b0: 2020 7075 626c 6963 2024 4672 6f6d 203d    public $From =
+000027c0: 2027 273b 0a0a 2020 2020 2f2a 2a0a 2020   '';..    /**.  
+000027d0: 2020 202a 2054 6865 2046 726f 6d20 6e61     * The From na
+000027e0: 6d65 206f 6620 7468 6520 6d65 7373 6167  me of the messag
+000027f0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
+00002800: 2040 7661 7220 7374 7269 6e67 0a20 2020   @var string.   
+00002810: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00002820: 2446 726f 6d4e 616d 6520 3d20 2727 3b0a  $FromName = '';.
+00002830: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00002840: 5468 6520 656e 7665 6c6f 7065 2073 656e  The envelope sen
+00002850: 6465 7220 6f66 2074 6865 206d 6573 7361  der of the messa
+00002860: 6765 2e0a 2020 2020 202a 2054 6869 7320  ge..     * This 
+00002870: 7769 6c6c 2075 7375 616c 6c79 2062 6520  will usually be 
+00002880: 7475 726e 6564 2069 6e74 6f20 6120 5265  turned into a Re
+00002890: 7475 726e 2d50 6174 6820 6865 6164 6572  turn-Path header
+000028a0: 2062 7920 7468 6520 7265 6365 6976 6572   by the receiver
+000028b0: 2c0a 2020 2020 202a 2061 6e64 2069 7320  ,.     * and is 
+000028c0: 7468 6520 6164 6472 6573 7320 7468 6174  the address that
+000028d0: 2062 6f75 6e63 6573 2077 696c 6c20 6265   bounces will be
+000028e0: 2073 656e 7420 746f 2e0a 2020 2020 202a   sent to..     *
+000028f0: 2049 6620 6e6f 7420 656d 7074 792c 2077   If not empty, w
+00002900: 696c 6c20 6265 2070 6173 7365 6420 7669  ill be passed vi
+00002910: 6120 602d 6660 2074 6f20 7365 6e64 6d61  a `-f` to sendma
+00002920: 696c 206f 7220 6173 2074 6865 2027 4d41  il or as the 'MA
+00002930: 494c 2046 524f 4d27 2076 616c 7565 206f  IL FROM' value o
+00002940: 7665 7220 534d 5450 2e0a 2020 2020 202a  ver SMTP..     *
+00002950: 0a20 2020 2020 2a20 4076 6172 2073 7472  .     * @var str
+00002960: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
+00002970: 7075 626c 6963 2024 5365 6e64 6572 203d  public $Sender =
+00002980: 2027 273b 0a0a 2020 2020 2f2a 2a0a 2020   '';..    /**.  
+00002990: 2020 202a 2054 6865 2053 7562 6a65 6374     * The Subject
+000029a0: 206f 6620 7468 6520 6d65 7373 6167 652e   of the message.
+000029b0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+000029c0: 7661 7220 7374 7269 6e67 0a20 2020 2020  var string.     
+000029d0: 2a2f 0a20 2020 2070 7562 6c69 6320 2453  */.    public $S
+000029e0: 7562 6a65 6374 203d 2027 273b 0a0a 2020  ubject = '';..  
+000029f0: 2020 2f2a 2a0a 2020 2020 202a 2041 6e20    /**.     * An 
+00002a00: 4854 4d4c 206f 7220 706c 6169 6e20 7465  HTML or plain te
+00002a10: 7874 206d 6573 7361 6765 2062 6f64 792e  xt message body.
+00002a20: 0a20 2020 2020 2a20 4966 2048 544d 4c20  .     * If HTML 
+00002a30: 7468 656e 2063 616c 6c20 6973 4854 4d4c  then call isHTML
+00002a40: 2874 7275 6529 2e0a 2020 2020 202a 0a20  (true)..     *. 
+00002a50: 2020 2020 2a20 4076 6172 2073 7472 696e      * @var strin
+00002a60: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
+00002a70: 626c 6963 2024 426f 6479 203d 2027 273b  blic $Body = '';
+00002a80: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00002a90: 2054 6865 2070 6c61 696e 2d74 6578 7420   The plain-text 
+00002aa0: 6d65 7373 6167 6520 626f 6479 2e0a 2020  message body..  
+00002ab0: 2020 202a 2054 6869 7320 626f 6479 2063     * This body c
+00002ac0: 616e 2062 6520 7265 6164 2062 7920 6d61  an be read by ma
+00002ad0: 696c 2063 6c69 656e 7473 2074 6861 7420  il clients that 
+00002ae0: 646f 206e 6f74 2068 6176 6520 4854 4d4c  do not have HTML
+00002af0: 2065 6d61 696c 0a20 2020 2020 2a20 6361   email.     * ca
+00002b00: 7061 6269 6c69 7479 2073 7563 6820 6173  pability such as
+00002b10: 206d 7574 7420 2620 4575 646f 7261 2e0a   mutt & Eudora..
+00002b20: 2020 2020 202a 2043 6c69 656e 7473 2074       * Clients t
+00002b30: 6861 7420 6361 6e20 7265 6164 2048 544d  hat can read HTM
+00002b40: 4c20 7769 6c6c 2076 6965 7720 7468 6520  L will view the 
+00002b50: 6e6f 726d 616c 2042 6f64 792e 0a20 2020  normal Body..   
+00002b60: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
+00002b70: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
+00002b80: 2020 2070 7562 6c69 6320 2441 6c74 426f     public $AltBo
+00002b90: 6479 203d 2027 273b 0a0a 2020 2020 2f2a  dy = '';..    /*
+00002ba0: 2a0a 2020 2020 202a 2041 6e20 6943 616c  *.     * An iCal
+00002bb0: 206d 6573 7361 6765 2070 6172 7420 626f   message part bo
+00002bc0: 6479 2e0a 2020 2020 202a 204f 6e6c 7920  dy..     * Only 
+00002bd0: 7375 7070 6f72 7465 6420 696e 2073 696d  supported in sim
+00002be0: 706c 6520 616c 7420 6f72 2061 6c74 5f69  ple alt or alt_i
+00002bf0: 6e6c 696e 6520 6d65 7373 6167 6520 7479  nline message ty
+00002c00: 7065 730a 2020 2020 202a 2054 6f20 6765  pes.     * To ge
+00002c10: 6e65 7261 7465 2069 4361 6c20 6576 656e  nerate iCal even
+00002c20: 7420 7374 7275 6374 7572 6573 2c20 7573  t structures, us
+00002c30: 6520 636c 6173 7365 7320 6c69 6b65 2045  e classes like E
+00002c40: 6173 7950 6561 7379 4943 5320 6f72 2069  asyPeasyICS or i
+00002c50: 4361 6c63 7265 6174 6f72 2e0a 2020 2020  Calcreator..    
+00002c60: 202a 0a20 2020 2020 2a20 4073 6565 2068   *.     * @see h
+00002c70: 7474 703a 2f2f 7370 7261 696e 2e63 682f  ttp://sprain.ch/
+00002c80: 626c 6f67 2f64 6f77 6e6c 6f61 6473 2f70  blog/downloads/p
+00002c90: 6870 2d63 6c61 7373 2d65 6173 7970 6561  hp-class-easypea
+00002ca0: 7379 6963 732d 6372 6561 7465 2d69 6361  syics-create-ica
+00002cb0: 6c2d 6669 6c65 732d 7769 7468 2d70 6870  l-files-with-php
+00002cc0: 2f0a 2020 2020 202a 2040 7365 6520 6874  /.     * @see ht
+00002cd0: 7470 3a2f 2f6b 6967 6b6f 6e73 756c 742e  tp://kigkonsult.
+00002ce0: 7365 2f69 4361 6c63 7265 6174 6f72 2f0a  se/iCalcreator/.
+00002cf0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+00002d00: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
+00002d10: 2f0a 2020 2020 7075 626c 6963 2024 4963  /.    public $Ic
+00002d20: 616c 203d 2027 273b 0a0a 2020 2020 2f2a  al = '';..    /*
+00002d30: 2a0a 2020 2020 202a 2056 616c 7565 2d61  *.     * Value-a
+00002d40: 7272 6179 206f 6620 226d 6574 686f 6422  rray of "method"
+00002d50: 2069 6e20 436f 6e74 656e 7474 7970 6520   in Contenttype 
+00002d60: 6865 6164 6572 2022 7465 7874 2f63 616c  header "text/cal
+00002d70: 656e 6461 7222 0a20 2020 2020 2a0a 2020  endar".     *.  
+00002d80: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+00002d90: 5b5d 0a20 2020 2020 2a2f 0a20 2020 2070  [].     */.    p
+00002da0: 726f 7465 6374 6564 2073 7461 7469 6320  rotected static 
+00002db0: 2449 6361 6c4d 6574 686f 6473 203d 205b  $IcalMethods = [
+00002dc0: 0a20 2020 2020 2020 2073 656c 663a 3a49  .        self::I
+00002dd0: 4341 4c5f 4d45 5448 4f44 5f52 4551 5545  CAL_METHOD_REQUE
+00002de0: 5354 2c0a 2020 2020 2020 2020 7365 6c66  ST,.        self
+00002df0: 3a3a 4943 414c 5f4d 4554 484f 445f 5055  ::ICAL_METHOD_PU
+00002e00: 424c 4953 482c 0a20 2020 2020 2020 2073  BLISH,.        s
+00002e10: 656c 663a 3a49 4341 4c5f 4d45 5448 4f44  elf::ICAL_METHOD
+00002e20: 5f52 4550 4c59 2c0a 2020 2020 2020 2020  _REPLY,.        
+00002e30: 7365 6c66 3a3a 4943 414c 5f4d 4554 484f  self::ICAL_METHO
+00002e40: 445f 4144 442c 0a20 2020 2020 2020 2073  D_ADD,.        s
+00002e50: 656c 663a 3a49 4341 4c5f 4d45 5448 4f44  elf::ICAL_METHOD
+00002e60: 5f43 414e 4345 4c2c 0a20 2020 2020 2020  _CANCEL,.       
+00002e70: 2073 656c 663a 3a49 4341 4c5f 4d45 5448   self::ICAL_METH
+00002e80: 4f44 5f52 4546 5245 5348 2c0a 2020 2020  OD_REFRESH,.    
+00002e90: 2020 2020 7365 6c66 3a3a 4943 414c 5f4d      self::ICAL_M
+00002ea0: 4554 484f 445f 434f 554e 5445 522c 0a20  ETHOD_COUNTER,. 
+00002eb0: 2020 2020 2020 2073 656c 663a 3a49 4341         self::ICA
+00002ec0: 4c5f 4d45 5448 4f44 5f44 4543 4c49 4e45  L_METHOD_DECLINE
+00002ed0: 434f 554e 5445 522c 0a20 2020 205d 3b0a  COUNTER,.    ];.
+00002ee0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00002ef0: 5468 6520 636f 6d70 6c65 7465 2063 6f6d  The complete com
+00002f00: 7069 6c65 6420 4d49 4d45 206d 6573 7361  piled MIME messa
+00002f10: 6765 2062 6f64 792e 0a20 2020 2020 2a0a  ge body..     *.
+00002f20: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
+00002f30: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+00002f40: 726f 7465 6374 6564 2024 4d49 4d45 426f  rotected $MIMEBo
+00002f50: 6479 203d 2027 273b 0a0a 2020 2020 2f2a  dy = '';..    /*
 00002f60: 2a0a 2020 2020 202a 2054 6865 2063 6f6d  *.     * The com
 00002f70: 706c 6574 6520 636f 6d70 696c 6564 204d  plete compiled M
-00002f80: 494d 4520 6d65 7373 6167 6520 626f 6479  IME message body
-00002f90: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00002fa0: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-00002fb0: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
-00002fc0: 6420 244d 494d 4542 6f64 7920 3d20 2727  d $MIMEBody = ''
-00002fd0: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
-00002fe0: 2a20 5468 6520 636f 6d70 6c65 7465 2063  * The complete c
-00002ff0: 6f6d 7069 6c65 6420 4d49 4d45 206d 6573  ompiled MIME mes
-00003000: 7361 6765 2068 6561 6465 7273 2e0a 2020  sage headers..  
-00003010: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
-00003020: 2073 7472 696e 670a 2020 2020 202a 2f0a   string.     */.
-00003030: 2020 2020 7072 6f74 6563 7465 6420 244d      protected $M
-00003040: 494d 4548 6561 6465 7220 3d20 2727 3b0a  IMEHeader = '';.
-00003050: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00003060: 4578 7472 6120 6865 6164 6572 7320 7468  Extra headers th
-00003070: 6174 2063 7265 6174 6548 6561 6465 7228  at createHeader(
-00003080: 2920 646f 6573 6e27 7420 666f 6c64 2069  ) doesn't fold i
-00003090: 6e2e 0a20 2020 2020 2a0a 2020 2020 202a  n..     *.     *
-000030a0: 2040 7661 7220 7374 7269 6e67 0a20 2020   @var string.   
-000030b0: 2020 2a2f 0a20 2020 2070 726f 7465 6374    */.    protect
-000030c0: 6564 2024 6d61 696c 4865 6164 6572 203d  ed $mailHeader =
-000030d0: 2027 273b 0a0a 2020 2020 2f2a 2a0a 2020   '';..    /**.  
-000030e0: 2020 202a 2057 6f72 642d 7772 6170 2074     * Word-wrap t
-000030f0: 6865 206d 6573 7361 6765 2062 6f64 7920  he message body 
-00003100: 746f 2074 6869 7320 6e75 6d62 6572 206f  to this number o
-00003110: 6620 6368 6172 732e 0a20 2020 2020 2a20  f chars..     * 
-00003120: 5365 7420 746f 2030 2074 6f20 6e6f 7420  Set to 0 to not 
-00003130: 7772 6170 2e20 4120 7573 6566 756c 2076  wrap. A useful v
-00003140: 616c 7565 2068 6572 6520 6973 2037 382c  alue here is 78,
-00003150: 2066 6f72 2052 4643 3238 3232 2073 6563   for RFC2822 sec
-00003160: 7469 6f6e 2032 2e31 2e31 2063 6f6d 706c  tion 2.1.1 compl
-00003170: 6961 6e63 652e 0a20 2020 2020 2a0a 2020  iance..     *.  
-00003180: 2020 202a 2040 7365 6520 7374 6174 6963     * @see static
-00003190: 3a3a 5354 445f 4c49 4e45 5f4c 454e 4754  ::STD_LINE_LENGT
-000031a0: 480a 2020 2020 202a 0a20 2020 2020 2a20  H.     *.     * 
-000031b0: 4076 6172 2069 6e74 0a20 2020 2020 2a2f  @var int.     */
-000031c0: 0a20 2020 2070 7562 6c69 6320 2457 6f72  .    public $Wor
-000031d0: 6457 7261 7020 3d20 303b 0a0a 2020 2020  dWrap = 0;..    
-000031e0: 2f2a 2a0a 2020 2020 202a 2057 6869 6368  /**.     * Which
-000031f0: 206d 6574 686f 6420 746f 2075 7365 2074   method to use t
-00003200: 6f20 7365 6e64 206d 6169 6c2e 0a20 2020  o send mail..   
-00003210: 2020 2a20 4f70 7469 6f6e 733a 2022 6d61    * Options: "ma
-00003220: 696c 222c 2022 7365 6e64 6d61 696c 222c  il", "sendmail",
-00003230: 206f 7220 2273 6d74 7022 2e0a 2020 2020   or "smtp"..    
-00003240: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
-00003250: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00003260: 2020 7075 626c 6963 2024 4d61 696c 6572    public $Mailer
-00003270: 203d 2027 6d61 696c 273b 0a0a 2020 2020   = 'mail';..    
-00003280: 2f2a 2a0a 2020 2020 202a 2054 6865 2070  /**.     * The p
-00003290: 6174 6820 746f 2074 6865 2073 656e 646d  ath to the sendm
-000032a0: 6169 6c20 7072 6f67 7261 6d2e 0a20 2020  ail program..   
-000032b0: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
-000032c0: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
-000032d0: 2020 2070 7562 6c69 6320 2453 656e 646d     public $Sendm
-000032e0: 6169 6c20 3d20 272f 7573 722f 7362 696e  ail = '/usr/sbin
-000032f0: 2f73 656e 646d 6169 6c27 3b0a 0a20 2020  /sendmail';..   
-00003300: 202f 2a2a 0a20 2020 2020 2a20 5768 6574   /**.     * Whet
-00003310: 6865 7220 6d61 696c 2829 2075 7365 7320  her mail() uses 
-00003320: 6120 6675 6c6c 7920 7365 6e64 6d61 696c  a fully sendmail
-00003330: 2d63 6f6d 7061 7469 626c 6520 4d54 412e  -compatible MTA.
-00003340: 0a20 2020 2020 2a20 4f6e 6520 7768 6963  .     * One whic
-00003350: 6820 7375 7070 6f72 7473 2073 656e 646d  h supports sendm
-00003360: 6169 6c27 7320 222d 6f69 202d 6622 206f  ail's "-oi -f" o
-00003370: 7074 696f 6e73 2e0a 2020 2020 202a 0a20  ptions..     *. 
-00003380: 2020 2020 2a20 4076 6172 2062 6f6f 6c0a      * @var bool.
-00003390: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-000033a0: 6963 2024 5573 6553 656e 646d 6169 6c4f  ic $UseSendmailO
-000033b0: 7074 696f 6e73 203d 2074 7275 653b 0a0a  ptions = true;..
-000033c0: 2020 2020 2f2a 2a0a 2020 2020 202a 2054      /**.     * T
-000033d0: 6865 2065 6d61 696c 2061 6464 7265 7373  he email address
-000033e0: 2074 6861 7420 6120 7265 6164 696e 6720   that a reading 
-000033f0: 636f 6e66 6972 6d61 7469 6f6e 2073 686f  confirmation sho
-00003400: 756c 6420 6265 2073 656e 7420 746f 2c20  uld be sent to, 
-00003410: 616c 736f 206b 6e6f 776e 2061 7320 7265  also known as re
-00003420: 6164 2072 6563 6569 7074 2e0a 2020 2020  ad receipt..    
-00003430: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
-00003440: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00003450: 2020 7075 626c 6963 2024 436f 6e66 6972    public $Confir
-00003460: 6d52 6561 6469 6e67 546f 203d 2027 273b  mReadingTo = '';
-00003470: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00003480: 2054 6865 2068 6f73 746e 616d 6520 746f   The hostname to
-00003490: 2075 7365 2069 6e20 7468 6520 4d65 7373   use in the Mess
-000034a0: 6167 652d 4944 2068 6561 6465 7220 616e  age-ID header an
-000034b0: 6420 6173 2064 6566 6175 6c74 2048 454c  d as default HEL
-000034c0: 4f20 7374 7269 6e67 2e0a 2020 2020 202a  O string..     *
-000034d0: 2049 6620 656d 7074 792c 2050 4850 4d61   If empty, PHPMa
-000034e0: 696c 6572 2061 7474 656d 7074 7320 746f  iler attempts to
-000034f0: 2066 696e 6420 6f6e 6520 7769 7468 2c20   find one with, 
-00003500: 696e 206f 7264 6572 2c0a 2020 2020 202a  in order,.     *
-00003510: 2024 5f53 4552 5645 525b 2753 4552 5645   $_SERVER['SERVE
-00003520: 525f 4e41 4d45 275d 2c20 6765 7468 6f73  R_NAME'], gethos
-00003530: 746e 616d 6528 292c 2070 6870 5f75 6e61  tname(), php_una
-00003540: 6d65 2827 6e27 292c 206f 7220 7468 6520  me('n'), or the 
-00003550: 7661 6c75 650a 2020 2020 202a 2027 6c6f  value.     * 'lo
-00003560: 6361 6c68 6f73 742e 6c6f 6361 6c64 6f6d  calhost.localdom
-00003570: 6169 6e27 2e0a 2020 2020 202a 0a20 2020  ain'..     *.   
-00003580: 2020 2a20 4073 6565 2050 4850 4d61 696c    * @see PHPMail
-00003590: 6572 3a3a 2448 656c 6f0a 2020 2020 202a  er::$Helo.     *
-000035a0: 0a20 2020 2020 2a20 4076 6172 2073 7472  .     * @var str
-000035b0: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
-000035c0: 7075 626c 6963 2024 486f 7374 6e61 6d65  public $Hostname
-000035d0: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
-000035e0: 2020 2020 202a 2041 6e20 4944 2074 6f20       * An ID to 
-000035f0: 6265 2075 7365 6420 696e 2074 6865 204d  be used in the M
-00003600: 6573 7361 6765 2d49 4420 6865 6164 6572  essage-ID header
-00003610: 2e0a 2020 2020 202a 2049 6620 656d 7074  ..     * If empt
-00003620: 792c 2061 2075 6e69 7175 6520 6964 2077  y, a unique id w
-00003630: 696c 6c20 6265 2067 656e 6572 6174 6564  ill be generated
-00003640: 2e0a 2020 2020 202a 2059 6f75 2063 616e  ..     * You can
-00003650: 2073 6574 2079 6f75 7220 6f77 6e2c 2062   set your own, b
-00003660: 7574 2069 7420 6d75 7374 2062 6520 696e  ut it must be in
-00003670: 2074 6865 2066 6f72 6d61 7420 223c 6964   the format "<id
-00003680: 4064 6f6d 6169 6e3e 222c 0a20 2020 2020  @domain>",.     
-00003690: 2a20 6173 2064 6566 696e 6564 2069 6e20  * as defined in 
-000036a0: 5246 4335 3332 3220 7365 6374 696f 6e20  RFC5322 section 
-000036b0: 332e 362e 3420 6f72 2069 7420 7769 6c6c  3.6.4 or it will
-000036c0: 2062 6520 6967 6e6f 7265 642e 0a20 2020   be ignored..   
-000036d0: 2020 2a0a 2020 2020 202a 2040 7365 6520    *.     * @see 
-000036e0: 6874 7470 733a 2f2f 746f 6f6c 732e 6965  https://tools.ie
-000036f0: 7466 2e6f 7267 2f68 746d 6c2f 7266 6335  tf.org/html/rfc5
-00003700: 3332 3223 7365 6374 696f 6e2d 332e 362e  322#section-3.6.
-00003710: 340a 2020 2020 202a 0a20 2020 2020 2a20  4.     *.     * 
-00003720: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-00003730: 202a 2f0a 2020 2020 7075 626c 6963 2024   */.    public $
-00003740: 4d65 7373 6167 6549 4420 3d20 2727 3b0a  MessageID = '';.
-00003750: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00003760: 5468 6520 6d65 7373 6167 6520 4461 7465  The message Date
-00003770: 2074 6f20 6265 2075 7365 6420 696e 2074   to be used in t
-00003780: 6865 2044 6174 6520 6865 6164 6572 2e0a  he Date header..
-00003790: 2020 2020 202a 2049 6620 656d 7074 792c       * If empty,
-000037a0: 2074 6865 2063 7572 7265 6e74 2064 6174   the current dat
-000037b0: 6520 7769 6c6c 2062 6520 6164 6465 642e  e will be added.
-000037c0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-000037d0: 7661 7220 7374 7269 6e67 0a20 2020 2020  var string.     
-000037e0: 2a2f 0a20 2020 2070 7562 6c69 6320 244d  */.    public $M
-000037f0: 6573 7361 6765 4461 7465 203d 2027 273b  essageDate = '';
-00003800: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00003810: 2053 4d54 5020 686f 7374 732e 0a20 2020   SMTP hosts..   
-00003820: 2020 2a20 4569 7468 6572 2061 2073 696e    * Either a sin
-00003830: 676c 6520 686f 7374 6e61 6d65 206f 7220  gle hostname or 
-00003840: 6d75 6c74 6970 6c65 2073 656d 6963 6f6c  multiple semicol
-00003850: 6f6e 2d64 656c 696d 6974 6564 2068 6f73  on-delimited hos
-00003860: 746e 616d 6573 2e0a 2020 2020 202a 2059  tnames..     * Y
-00003870: 6f75 2063 616e 2061 6c73 6f20 7370 6563  ou can also spec
-00003880: 6966 7920 6120 6469 6666 6572 656e 7420  ify a different 
-00003890: 706f 7274 0a20 2020 2020 2a20 666f 7220  port.     * for 
-000038a0: 6561 6368 2068 6f73 7420 6279 2075 7369  each host by usi
-000038b0: 6e67 2074 6869 7320 666f 726d 6174 3a20  ng this format: 
-000038c0: 5b68 6f73 746e 616d 653a 706f 7274 5d0a  [hostname:port].
-000038d0: 2020 2020 202a 2028 652e 672e 2022 736d       * (e.g. "sm
-000038e0: 7470 312e 6578 616d 706c 652e 636f 6d3a  tp1.example.com:
-000038f0: 3235 3b73 6d74 7032 2e65 7861 6d70 6c65  25;smtp2.example
-00003900: 2e63 6f6d 2229 2e0a 2020 2020 202a 2059  .com")..     * Y
-00003910: 6f75 2063 616e 2061 6c73 6f20 7370 6563  ou can also spec
-00003920: 6966 7920 656e 6372 7970 7469 6f6e 2074  ify encryption t
-00003930: 7970 652c 2066 6f72 2065 7861 6d70 6c65  ype, for example
-00003940: 3a0a 2020 2020 202a 2028 652e 672e 2022  :.     * (e.g. "
-00003950: 746c 733a 2f2f 736d 7470 312e 6578 616d  tls://smtp1.exam
-00003960: 706c 652e 636f 6d3a 3538 373b 7373 6c3a  ple.com:587;ssl:
-00003970: 2f2f 736d 7470 322e 6578 616d 706c 652e  //smtp2.example.
-00003980: 636f 6d3a 3436 3522 292e 0a20 2020 2020  com:465")..     
-00003990: 2a20 486f 7374 7320 7769 6c6c 2062 6520  * Hosts will be 
-000039a0: 7472 6965 6420 696e 206f 7264 6572 2e0a  tried in order..
-000039b0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-000039c0: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
-000039d0: 2f0a 2020 2020 7075 626c 6963 2024 486f  /.    public $Ho
-000039e0: 7374 203d 2027 6c6f 6361 6c68 6f73 7427  st = 'localhost'
-000039f0: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
-00003a00: 2a20 5468 6520 6465 6661 756c 7420 534d  * The default SM
-00003a10: 5450 2073 6572 7665 7220 706f 7274 2e0a  TP server port..
-00003a20: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-00003a30: 6172 2069 6e74 0a20 2020 2020 2a2f 0a20  ar int.     */. 
-00003a40: 2020 2070 7562 6c69 6320 2450 6f72 7420     public $Port 
-00003a50: 3d20 3235 3b0a 0a20 2020 202f 2a2a 0a20  = 25;..    /**. 
-00003a60: 2020 2020 2a20 5468 6520 534d 5450 2048      * The SMTP H
-00003a70: 454c 4f2f 4548 4c4f 206e 616d 6520 7573  ELO/EHLO name us
-00003a80: 6564 2066 6f72 2074 6865 2053 4d54 5020  ed for the SMTP 
-00003a90: 636f 6e6e 6563 7469 6f6e 2e0a 2020 2020  connection..    
-00003aa0: 202a 2044 6566 6175 6c74 2069 7320 2448   * Default is $H
-00003ab0: 6f73 746e 616d 652e 2049 6620 2448 6f73  ostname. If $Hos
-00003ac0: 746e 616d 6520 6973 2065 6d70 7479 2c20  tname is empty, 
-00003ad0: 5048 504d 6169 6c65 7220 6174 7465 6d70  PHPMailer attemp
-00003ae0: 7473 2074 6f20 6669 6e64 0a20 2020 2020  ts to find.     
-00003af0: 2a20 6f6e 6520 7769 7468 2074 6865 2073  * one with the s
-00003b00: 616d 6520 6d65 7468 6f64 2064 6573 6372  ame method descr
-00003b10: 6962 6564 2061 626f 7665 2066 6f72 2024  ibed above for $
-00003b20: 486f 7374 6e61 6d65 2e0a 2020 2020 202a  Hostname..     *
-00003b30: 0a20 2020 2020 2a20 4073 6565 2050 4850  .     * @see PHP
-00003b40: 4d61 696c 6572 3a3a 2448 6f73 746e 616d  Mailer::$Hostnam
-00003b50: 650a 2020 2020 202a 0a20 2020 2020 2a20  e.     *.     * 
-00003b60: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-00003b70: 202a 2f0a 2020 2020 7075 626c 6963 2024   */.    public $
-00003b80: 4865 6c6f 203d 2027 273b 0a0a 2020 2020  Helo = '';..    
-00003b90: 2f2a 2a0a 2020 2020 202a 2057 6861 7420  /**.     * What 
-00003ba0: 6b69 6e64 206f 6620 656e 6372 7970 7469  kind of encrypti
-00003bb0: 6f6e 2074 6f20 7573 6520 6f6e 2074 6865  on to use on the
-00003bc0: 2053 4d54 5020 636f 6e6e 6563 7469 6f6e   SMTP connection
-00003bd0: 2e0a 2020 2020 202a 204f 7074 696f 6e73  ..     * Options
-00003be0: 3a20 2727 2c20 7374 6174 6963 3a3a 454e  : '', static::EN
-00003bf0: 4352 5950 5449 4f4e 5f53 5441 5254 544c  CRYPTION_STARTTL
-00003c00: 532c 206f 7220 7374 6174 6963 3a3a 454e  S, or static::EN
-00003c10: 4352 5950 5449 4f4e 5f53 4d54 5053 2e0a  CRYPTION_SMTPS..
-00003c20: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-00003c30: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
-00003c40: 2f0a 2020 2020 7075 626c 6963 2024 534d  /.    public $SM
-00003c50: 5450 5365 6375 7265 203d 2027 273b 0a0a  TPSecure = '';..
-00003c60: 2020 2020 2f2a 2a0a 2020 2020 202a 2057      /**.     * W
-00003c70: 6865 7468 6572 2074 6f20 656e 6162 6c65  hether to enable
-00003c80: 2054 4c53 2065 6e63 7279 7074 696f 6e20   TLS encryption 
-00003c90: 6175 746f 6d61 7469 6361 6c6c 7920 6966  automatically if
-00003ca0: 2061 2073 6572 7665 7220 7375 7070 6f72   a server suppor
-00003cb0: 7473 2069 742c 0a20 2020 2020 2a20 6576  ts it,.     * ev
-00003cc0: 656e 2069 6620 6053 4d54 5053 6563 7572  en if `SMTPSecur
-00003cd0: 6560 2069 7320 6e6f 7420 7365 7420 746f  e` is not set to
-00003ce0: 2027 746c 7327 2e0a 2020 2020 202a 2042   'tls'..     * B
-00003cf0: 6520 6177 6172 6520 7468 6174 2069 6e20  e aware that in 
-00003d00: 5048 5020 3e3d 2035 2e36 2074 6869 7320  PHP >= 5.6 this 
-00003d10: 7265 7175 6972 6573 2074 6861 7420 7468  requires that th
-00003d20: 6520 7365 7276 6572 2773 2063 6572 7469  e server's certi
-00003d30: 6669 6361 7465 7320 6172 6520 7661 6c69  ficates are vali
-00003d40: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
-00003d50: 2040 7661 7220 626f 6f6c 0a20 2020 2020   @var bool.     
-00003d60: 2a2f 0a20 2020 2070 7562 6c69 6320 2453  */.    public $S
-00003d70: 4d54 5041 7574 6f54 4c53 203d 2074 7275  MTPAutoTLS = tru
-00003d80: 653b 0a0a 2020 2020 2f2a 2a0a 2020 2020  e;..    /**.    
-00003d90: 202a 2057 6865 7468 6572 2074 6f20 7573   * Whether to us
-00003da0: 6520 534d 5450 2061 7574 6865 6e74 6963  e SMTP authentic
-00003db0: 6174 696f 6e2e 0a20 2020 2020 2a20 5573  ation..     * Us
-00003dc0: 6573 2074 6865 2055 7365 726e 616d 6520  es the Username 
-00003dd0: 616e 6420 5061 7373 776f 7264 2070 726f  and Password pro
-00003de0: 7065 7274 6965 732e 0a20 2020 2020 2a0a  perties..     *.
-00003df0: 2020 2020 202a 2040 7365 6520 5048 504d       * @see PHPM
-00003e00: 6169 6c65 723a 3a24 5573 6572 6e61 6d65  ailer::$Username
-00003e10: 0a20 2020 2020 2a20 4073 6565 2050 4850  .     * @see PHP
-00003e20: 4d61 696c 6572 3a3a 2450 6173 7377 6f72  Mailer::$Passwor
-00003e30: 640a 2020 2020 202a 0a20 2020 2020 2a20  d.     *.     * 
-00003e40: 4076 6172 2062 6f6f 6c0a 2020 2020 202a  @var bool.     *
-00003e50: 2f0a 2020 2020 7075 626c 6963 2024 534d  /.    public $SM
-00003e60: 5450 4175 7468 203d 2066 616c 7365 3b0a  TPAuth = false;.
-00003e70: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00003e80: 4f70 7469 6f6e 7320 6172 7261 7920 7061  Options array pa
-00003e90: 7373 6564 2074 6f20 7374 7265 616d 5f63  ssed to stream_c
-00003ea0: 6f6e 7465 7874 5f63 7265 6174 6520 7768  ontext_create wh
-00003eb0: 656e 2063 6f6e 6e65 6374 696e 6720 7669  en connecting vi
-00003ec0: 6120 534d 5450 2e0a 2020 2020 202a 0a20  a SMTP..     *. 
-00003ed0: 2020 2020 2a20 4076 6172 2061 7272 6179      * @var array
-00003ee0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00003ef0: 6c69 6320 2453 4d54 504f 7074 696f 6e73  lic $SMTPOptions
-00003f00: 203d 205b 5d3b 0a0a 2020 2020 2f2a 2a0a   = [];..    /**.
-00003f10: 2020 2020 202a 2053 4d54 5020 7573 6572       * SMTP user
-00003f20: 6e61 6d65 2e0a 2020 2020 202a 0a20 2020  name..     *.   
-00003f30: 2020 2a20 4076 6172 2073 7472 696e 670a    * @var string.
-00003f40: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00003f50: 6963 2024 5573 6572 6e61 6d65 203d 2027  ic $Username = '
-00003f60: 273b 0a0a 2020 2020 2f2a 2a0a 2020 2020  ';..    /**.    
-00003f70: 202a 2053 4d54 5020 7061 7373 776f 7264   * SMTP password
-00003f80: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00003f90: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-00003fa0: 202a 2f0a 2020 2020 7075 626c 6963 2024   */.    public $
-00003fb0: 5061 7373 776f 7264 203d 2027 273b 0a0a  Password = '';..
-00003fc0: 2020 2020 2f2a 2a0a 2020 2020 202a 2053      /**.     * S
-00003fd0: 4d54 5020 6175 7468 656e 7469 6361 7469  MTP authenticati
-00003fe0: 6f6e 2074 7970 652e 204f 7074 696f 6e73  on type. Options
-00003ff0: 2061 7265 2043 5241 4d2d 4d44 352c 204c   are CRAM-MD5, L
-00004000: 4f47 494e 2c20 504c 4149 4e2c 2058 4f41  OGIN, PLAIN, XOA
-00004010: 5554 4832 2e0a 2020 2020 202a 2049 6620  UTH2..     * If 
-00004020: 6e6f 7420 7370 6563 6966 6965 642c 2074  not specified, t
-00004030: 6865 2066 6972 7374 206f 6e65 2066 726f  he first one fro
-00004040: 6d20 7468 6174 206c 6973 7420 7468 6174  m that list that
-00004050: 2074 6865 2073 6572 7665 7220 7375 7070   the server supp
-00004060: 6f72 7473 2077 696c 6c20 6265 2073 656c  orts will be sel
-00004070: 6563 7465 642e 0a20 2020 2020 2a0a 2020  ected..     *.  
-00004080: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
-00004090: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-000040a0: 6c69 6320 2441 7574 6854 7970 6520 3d20  lic $AuthType = 
-000040b0: 2727 3b0a 0a20 2020 202f 2a2a 0a20 2020  '';..    /**.   
-000040c0: 2020 2a20 416e 2069 6d70 6c65 6d65 6e74    * An implement
-000040d0: 6174 696f 6e20 6f66 2074 6865 2050 4850  ation of the PHP
-000040e0: 4d61 696c 6572 204f 4175 7468 546f 6b65  Mailer OAuthToke
-000040f0: 6e50 726f 7669 6465 7220 696e 7465 7266  nProvider interf
-00004100: 6163 652e 0a20 2020 2020 2a0a 2020 2020  ace..     *.    
-00004110: 202a 2040 7661 7220 4f41 7574 6854 6f6b   * @var OAuthTok
-00004120: 656e 5072 6f76 6964 6572 0a20 2020 2020  enProvider.     
-00004130: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
-00004140: 2024 6f61 7574 683b 0a0a 2020 2020 2f2a   $oauth;..    /*
-00004150: 2a0a 2020 2020 202a 2054 6865 2053 4d54  *.     * The SMT
-00004160: 5020 7365 7276 6572 2074 696d 656f 7574  P server timeout
-00004170: 2069 6e20 7365 636f 6e64 732e 0a20 2020   in seconds..   
-00004180: 2020 2a20 4465 6661 756c 7420 6f66 2035    * Default of 5
-00004190: 206d 696e 7574 6573 2028 3330 3073 6563   minutes (300sec
-000041a0: 2920 6973 2066 726f 6d20 5246 4332 3832  ) is from RFC282
-000041b0: 3120 7365 6374 696f 6e20 342e 352e 332e  1 section 4.5.3.
-000041c0: 322e 0a20 2020 2020 2a0a 2020 2020 202a  2..     *.     *
-000041d0: 2040 7661 7220 696e 740a 2020 2020 202a   @var int.     *
-000041e0: 2f0a 2020 2020 7075 626c 6963 2024 5469  /.    public $Ti
-000041f0: 6d65 6f75 7420 3d20 3330 303b 0a0a 2020  meout = 300;..  
-00004200: 2020 2f2a 2a0a 2020 2020 202a 2043 6f6d    /**.     * Com
-00004210: 6d61 2073 6570 6172 6174 6564 206c 6973  ma separated lis
-00004220: 7420 6f66 2044 534e 206e 6f74 6966 6963  t of DSN notific
-00004230: 6174 696f 6e73 0a20 2020 2020 2a20 274e  ations.     * 'N
-00004240: 4556 4552 2720 756e 6465 7220 6e6f 2063  EVER' under no c
-00004250: 6972 6375 6d73 7461 6e63 6573 2061 2044  ircumstances a D
-00004260: 534e 206d 7573 7420 6265 2072 6574 7572  SN must be retur
-00004270: 6e65 6420 746f 2074 6865 2073 656e 6465  ned to the sende
-00004280: 722e 0a20 2020 2020 2a20 2020 2020 2020  r..     *       
-00004290: 2020 4966 2079 6f75 2075 7365 204e 4556    If you use NEV
-000042a0: 4552 2061 6c6c 206f 7468 6572 206e 6f74  ER all other not
-000042b0: 6966 6963 6174 696f 6e73 2077 696c 6c20  ifications will 
-000042c0: 6265 2069 676e 6f72 6564 2e0a 2020 2020  be ignored..    
-000042d0: 202a 2027 5355 4343 4553 5327 2077 696c   * 'SUCCESS' wil
-000042e0: 6c20 6e6f 7469 6679 2079 6f75 2077 6865  l notify you whe
-000042f0: 6e20 796f 7572 206d 6169 6c20 6861 7320  n your mail has 
-00004300: 6172 7269 7665 6420 6174 2069 7473 2064  arrived at its d
-00004310: 6573 7469 6e61 7469 6f6e 2e0a 2020 2020  estination..    
-00004320: 202a 2027 4641 494c 5552 4527 2077 696c   * 'FAILURE' wil
-00004330: 6c20 6172 7269 7665 2069 6620 616e 2065  l arrive if an e
-00004340: 7272 6f72 206f 6363 7572 7265 6420 6475  rror occurred du
-00004350: 7269 6e67 2064 656c 6976 6572 792e 0a20  ring delivery.. 
-00004360: 2020 2020 2a20 2744 454c 4159 2720 2020      * 'DELAY'   
-00004370: 7769 6c6c 206e 6f74 6966 7920 796f 7520  will notify you 
-00004380: 6966 2074 6865 7265 2069 7320 616e 2075  if there is an u
-00004390: 6e75 7375 616c 2064 656c 6179 2069 6e20  nusual delay in 
-000043a0: 6465 6c69 7665 7279 2c20 6275 7420 7468  delivery, but th
-000043b0: 6520 6163 7475 616c 0a20 2020 2020 2a20  e actual.     * 
-000043c0: 2020 2020 2020 2020 2020 6465 6c69 7665            delive
-000043d0: 7279 2773 206f 7574 636f 6d65 2028 7375  ry's outcome (su
-000043e0: 6363 6573 7320 6f72 2066 6169 6c75 7265  ccess or failure
-000043f0: 2920 6973 206e 6f74 2079 6574 2064 6563  ) is not yet dec
-00004400: 6964 6564 2e0a 2020 2020 202a 0a20 2020  ided..     *.   
-00004410: 2020 2a20 4073 6565 2068 7474 7073 3a2f    * @see https:/
-00004420: 2f74 6f6f 6c73 2e69 6574 662e 6f72 672f  /tools.ietf.org/
-00004430: 6874 6d6c 2f72 6663 3334 3631 2053 6565  html/rfc3461 See
-00004440: 2073 6563 7469 6f6e 2034 2e31 2066 6f72   section 4.1 for
-00004450: 206d 6f72 6520 696e 666f 726d 6174 696f   more informatio
-00004460: 6e20 6162 6f75 7420 4e4f 5449 4659 0a20  n about NOTIFY. 
-00004470: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00004480: 6320 2464 736e 203d 2027 273b 0a0a 2020  c $dsn = '';..  
-00004490: 2020 2f2a 2a0a 2020 2020 202a 2053 4d54    /**.     * SMT
-000044a0: 5020 636c 6173 7320 6465 6275 6720 6f75  P class debug ou
-000044b0: 7470 7574 206d 6f64 652e 0a20 2020 2020  tput mode..     
-000044c0: 2a20 4465 6275 6720 6f75 7470 7574 206c  * Debug output l
-000044d0: 6576 656c 2e0a 2020 2020 202a 204f 7074  evel..     * Opt
-000044e0: 696f 6e73 3a0a 2020 2020 202a 2040 7365  ions:.     * @se
-000044f0: 6520 534d 5450 3a3a 4445 4255 475f 4f46  e SMTP::DEBUG_OF
-00004500: 463a 204e 6f20 6f75 7470 7574 0a20 2020  F: No output.   
-00004510: 2020 2a20 4073 6565 2053 4d54 503a 3a44    * @see SMTP::D
-00004520: 4542 5547 5f43 4c49 454e 543a 2043 6c69  EBUG_CLIENT: Cli
-00004530: 656e 7420 6d65 7373 6167 6573 0a20 2020  ent messages.   
-00004540: 2020 2a20 4073 6565 2053 4d54 503a 3a44    * @see SMTP::D
-00004550: 4542 5547 5f53 4552 5645 523a 2043 6c69  EBUG_SERVER: Cli
-00004560: 656e 7420 616e 6420 7365 7276 6572 206d  ent and server m
-00004570: 6573 7361 6765 730a 2020 2020 202a 2040  essages.     * @
-00004580: 7365 6520 534d 5450 3a3a 4445 4255 475f  see SMTP::DEBUG_
-00004590: 434f 4e4e 4543 5449 4f4e 3a20 4173 2053  CONNECTION: As S
-000045a0: 4552 5645 5220 706c 7573 2063 6f6e 6e65  ERVER plus conne
-000045b0: 6374 696f 6e20 7374 6174 7573 0a20 2020  ction status.   
-000045c0: 2020 2a20 4073 6565 2053 4d54 503a 3a44    * @see SMTP::D
-000045d0: 4542 5547 5f4c 4f57 4c45 5645 4c3a 204e  EBUG_LOWLEVEL: N
-000045e0: 6f69 7379 2c20 6c6f 772d 6c65 7665 6c20  oisy, low-level 
-000045f0: 6461 7461 206f 7574 7075 742c 2072 6172  data output, rar
-00004600: 656c 7920 6e65 6564 6564 0a20 2020 2020  ely needed.     
-00004610: 2a0a 2020 2020 202a 2040 7365 6520 534d  *.     * @see SM
-00004620: 5450 3a3a 2464 6f5f 6465 6275 670a 2020  TP::$do_debug.  
-00004630: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
-00004640: 2069 6e74 0a20 2020 2020 2a2f 0a20 2020   int.     */.   
-00004650: 2070 7562 6c69 6320 2453 4d54 5044 6562   public $SMTPDeb
-00004660: 7567 203d 2030 3b0a 0a20 2020 202f 2a2a  ug = 0;..    /**
-00004670: 0a20 2020 2020 2a20 486f 7720 746f 2068  .     * How to h
-00004680: 616e 646c 6520 6465 6275 6720 6f75 7470  andle debug outp
-00004690: 7574 2e0a 2020 2020 202a 204f 7074 696f  ut..     * Optio
-000046a0: 6e73 3a0a 2020 2020 202a 202a 2060 6563  ns:.     * * `ec
-000046b0: 686f 6020 4f75 7470 7574 2070 6c61 696e  ho` Output plain
-000046c0: 2d74 6578 7420 6173 2d69 732c 2061 7070  -text as-is, app
-000046d0: 726f 7072 6961 7465 2066 6f72 2043 4c49  ropriate for CLI
-000046e0: 0a20 2020 2020 2a20 2a20 6068 746d 6c60  .     * * `html`
-000046f0: 204f 7574 7075 7420 6573 6361 7065 642c   Output escaped,
-00004700: 206c 696e 6520 6272 6561 6b73 2063 6f6e   line breaks con
-00004710: 7665 7274 6564 2074 6f20 603c 6272 3e60  verted to `<br>`
-00004720: 2c20 6170 7072 6f70 7269 6174 6520 666f  , appropriate fo
-00004730: 7220 6272 6f77 7365 7220 6f75 7470 7574  r browser output
-00004740: 0a20 2020 2020 2a20 2a20 6065 7272 6f72  .     * * `error
-00004750: 5f6c 6f67 6020 4f75 7470 7574 2074 6f20  _log` Output to 
-00004760: 6572 726f 7220 6c6f 6720 6173 2063 6f6e  error log as con
-00004770: 6669 6775 7265 6420 696e 2070 6870 2e69  figured in php.i
-00004780: 6e69 0a20 2020 2020 2a20 4279 2064 6566  ni.     * By def
-00004790: 6175 6c74 2050 4850 4d61 696c 6572 2077  ault PHPMailer w
-000047a0: 696c 6c20 7573 6520 6065 6368 6f60 2069  ill use `echo` i
-000047b0: 6620 7275 6e20 6672 6f6d 2061 2060 636c  f run from a `cl
-000047c0: 6960 206f 7220 6063 6c69 2d73 6572 7665  i` or `cli-serve
-000047d0: 7260 2053 4150 492c 2060 6874 6d6c 6020  r` SAPI, `html` 
-000047e0: 6f74 6865 7277 6973 652e 0a20 2020 2020  otherwise..     
-000047f0: 2a20 416c 7465 726e 6174 6976 656c 792c  * Alternatively,
-00004800: 2079 6f75 2063 616e 2070 726f 7669 6465   you can provide
-00004810: 2061 2063 616c 6c61 626c 6520 6578 7065   a callable expe
-00004820: 6374 696e 6720 7477 6f20 7061 7261 6d73  cting two params
-00004830: 3a20 6120 6d65 7373 6167 6520 7374 7269  : a message stri
-00004840: 6e67 2061 6e64 2074 6865 2064 6562 7567  ng and the debug
-00004850: 206c 6576 656c 3a0a 2020 2020 202a 0a20   level:.     *. 
-00004860: 2020 2020 2a20 6060 6070 6870 0a20 2020      * ```php.   
-00004870: 2020 2a20 246d 6169 6c2d 3e44 6562 7567    * $mail->Debug
-00004880: 6f75 7470 7574 203d 2066 756e 6374 696f  output = functio
-00004890: 6e28 2473 7472 2c20 246c 6576 656c 2920  n($str, $level) 
-000048a0: 7b65 6368 6f20 2264 6562 7567 206c 6576  {echo "debug lev
-000048b0: 656c 2024 6c65 7665 6c3b 206d 6573 7361  el $level; messa
-000048c0: 6765 3a20 2473 7472 223b 7d3b 0a20 2020  ge: $str";};.   
-000048d0: 2020 2a20 6060 600a 2020 2020 202a 0a20    * ```.     *. 
-000048e0: 2020 2020 2a20 416c 7465 726e 6174 6976      * Alternativ
-000048f0: 656c 792c 2079 6f75 2063 616e 2070 6173  ely, you can pas
-00004900: 7320 696e 2061 6e20 696e 7374 616e 6365  s in an instance
-00004910: 206f 6620 6120 5053 522d 3320 636f 6d70   of a PSR-3 comp
-00004920: 6174 6962 6c65 206c 6f67 6765 722c 2074  atible logger, t
-00004930: 686f 7567 6820 6f6e 6c79 2060 6465 6275  hough only `debu
-00004940: 6760 0a20 2020 2020 2a20 6c65 7665 6c20  g`.     * level 
-00004950: 6f75 7470 7574 2069 7320 7573 6564 3a0a  output is used:.
-00004960: 2020 2020 202a 0a20 2020 2020 2a20 6060       *.     * ``
-00004970: 6070 6870 0a20 2020 2020 2a20 246d 6169  `php.     * $mai
-00004980: 6c2d 3e44 6562 7567 6f75 7470 7574 203d  l->Debugoutput =
-00004990: 206e 6577 206d 7950 7372 334c 6f67 6765   new myPsr3Logge
-000049a0: 723b 0a20 2020 2020 2a20 6060 600a 2020  r;.     * ```.  
-000049b0: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
-000049c0: 2053 4d54 503a 3a24 4465 6275 676f 7574   SMTP::$Debugout
-000049d0: 7075 740a 2020 2020 202a 0a20 2020 2020  put.     *.     
-000049e0: 2a20 4076 6172 2073 7472 696e 677c 6361  * @var string|ca
-000049f0: 6c6c 6162 6c65 7c5c 5073 725c 4c6f 675c  llable|\Psr\Log\
-00004a00: 4c6f 6767 6572 496e 7465 7266 6163 650a  LoggerInterface.
-00004a10: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00004a20: 6963 2024 4465 6275 676f 7574 7075 7420  ic $Debugoutput 
-00004a30: 3d20 2765 6368 6f27 3b0a 0a20 2020 202f  = 'echo';..    /
-00004a40: 2a2a 0a20 2020 2020 2a20 5768 6574 6865  **.     * Whethe
-00004a50: 7220 746f 206b 6565 7020 7468 6520 534d  r to keep the SM
-00004a60: 5450 2063 6f6e 6e65 6374 696f 6e20 6f70  TP connection op
-00004a70: 656e 2061 6674 6572 2065 6163 6820 6d65  en after each me
-00004a80: 7373 6167 652e 0a20 2020 2020 2a20 4966  ssage..     * If
-00004a90: 2074 6869 7320 6973 2073 6574 2074 6f20   this is set to 
-00004aa0: 7472 7565 2074 6865 6e20 7468 6520 636f  true then the co
-00004ab0: 6e6e 6563 7469 6f6e 2077 696c 6c20 7265  nnection will re
-00004ac0: 6d61 696e 206f 7065 6e20 6166 7465 7220  main open after 
-00004ad0: 6120 7365 6e64 2c0a 2020 2020 202a 2061  a send,.     * a
-00004ae0: 6e64 2063 6c6f 7369 6e67 2074 6865 2063  nd closing the c
-00004af0: 6f6e 6e65 6374 696f 6e20 7769 6c6c 2072  onnection will r
-00004b00: 6571 7569 7265 2061 6e20 6578 706c 6963  equire an explic
-00004b10: 6974 2063 616c 6c20 746f 2073 6d74 7043  it call to smtpC
-00004b20: 6c6f 7365 2829 2e0a 2020 2020 202a 2049  lose()..     * I
-00004b30: 7427 7320 6120 676f 6f64 2069 6465 6120  t's a good idea 
-00004b40: 746f 2075 7365 2074 6869 7320 6966 2079  to use this if y
-00004b50: 6f75 2061 7265 2073 656e 6469 6e67 206d  ou are sending m
-00004b60: 756c 7469 706c 6520 6d65 7373 6167 6573  ultiple messages
-00004b70: 2061 7320 6974 2072 6564 7563 6573 206f   as it reduces o
-00004b80: 7665 7268 6561 642e 0a20 2020 2020 2a20  verhead..     * 
-00004b90: 5365 6520 7468 6520 6d61 696c 696e 6720  See the mailing 
-00004ba0: 6c69 7374 2065 7861 6d70 6c65 2066 6f72  list example for
-00004bb0: 2068 6f77 2074 6f20 7573 6520 6974 2e0a   how to use it..
-00004bc0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-00004bd0: 6172 2062 6f6f 6c0a 2020 2020 202a 2f0a  ar bool.     */.
-00004be0: 2020 2020 7075 626c 6963 2024 534d 5450      public $SMTP
-00004bf0: 4b65 6570 416c 6976 6520 3d20 6661 6c73  KeepAlive = fals
-00004c00: 653b 0a0a 2020 2020 2f2a 2a0a 2020 2020  e;..    /**.    
-00004c10: 202a 2057 6865 7468 6572 2074 6f20 7370   * Whether to sp
-00004c20: 6c69 7420 6d75 6c74 6970 6c65 2074 6f20  lit multiple to 
-00004c30: 6164 6472 6573 7365 7320 696e 746f 206d  addresses into m
-00004c40: 756c 7469 706c 6520 6d65 7373 6167 6573  ultiple messages
-00004c50: 0a20 2020 2020 2a20 6f72 2073 656e 6420  .     * or send 
-00004c60: 7468 656d 2061 6c6c 2069 6e20 6f6e 6520  them all in one 
-00004c70: 6d65 7373 6167 652e 0a20 2020 2020 2a20  message..     * 
-00004c80: 4f6e 6c79 2073 7570 706f 7274 6564 2069  Only supported i
-00004c90: 6e20 606d 6169 6c60 2061 6e64 2060 7365  n `mail` and `se
-00004ca0: 6e64 6d61 696c 6020 7472 616e 7370 6f72  ndmail` transpor
-00004cb0: 7473 2c20 6e6f 7420 696e 2053 4d54 502e  ts, not in SMTP.
-00004cc0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00004cd0: 7661 7220 626f 6f6c 0a20 2020 2020 2a0a  var bool.     *.
-00004ce0: 2020 2020 202a 2040 6465 7072 6563 6174       * @deprecat
-00004cf0: 6564 2036 2e30 2e30 2050 4850 4d61 696c  ed 6.0.0 PHPMail
-00004d00: 6572 2069 736e 2774 2061 206d 6169 6c69  er isn't a maili
-00004d10: 6e67 206c 6973 7420 6d61 6e61 6765 7221  ng list manager!
-00004d20: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00004d30: 6c69 6320 2453 696e 676c 6554 6f20 3d20  lic $SingleTo = 
-00004d40: 6661 6c73 653b 0a0a 2020 2020 2f2a 2a0a  false;..    /**.
-00004d50: 2020 2020 202a 2053 746f 7261 6765 2066       * Storage f
-00004d60: 6f72 2061 6464 7265 7373 6573 2077 6865  or addresses whe
-00004d70: 6e20 5369 6e67 6c65 546f 2069 7320 656e  n SingleTo is en
-00004d80: 6162 6c65 642e 0a20 2020 2020 2a0a 2020  abled..     *.  
-00004d90: 2020 202a 2040 7661 7220 6172 7261 790a     * @var array.
-00004da0: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
-00004db0: 6563 7465 6420 2453 696e 676c 6554 6f41  ected $SingleToA
-00004dc0: 7272 6179 203d 205b 5d3b 0a0a 2020 2020  rray = [];..    
-00004dd0: 2f2a 2a0a 2020 2020 202a 2057 6865 7468  /**.     * Wheth
-00004de0: 6572 2074 6f20 6765 6e65 7261 7465 2056  er to generate V
-00004df0: 4552 5020 6164 6472 6573 7365 7320 6f6e  ERP addresses on
-00004e00: 2073 656e 642e 0a20 2020 2020 2a20 4f6e   send..     * On
-00004e10: 6c79 2061 7070 6c69 6361 626c 6520 7768  ly applicable wh
-00004e20: 656e 2073 656e 6469 6e67 2076 6961 2053  en sending via S
-00004e30: 4d54 502e 0a20 2020 2020 2a0a 2020 2020  MTP..     *.    
-00004e40: 202a 2040 7365 6520 6874 7470 733a 2f2f   * @see https://
-00004e50: 656e 2e77 696b 6970 6564 6961 2e6f 7267  en.wikipedia.org
-00004e60: 2f77 696b 692f 5661 7269 6162 6c65 5f65  /wiki/Variable_e
-00004e70: 6e76 656c 6f70 655f 7265 7475 726e 5f70  nvelope_return_p
-00004e80: 6174 680a 2020 2020 202a 2040 7365 6520  ath.     * @see 
-00004e90: 6874 7470 3a2f 2f77 7777 2e70 6f73 7466  http://www.postf
-00004ea0: 6978 2e6f 7267 2f56 4552 505f 5245 4144  ix.org/VERP_READ
-00004eb0: 4d45 2e68 746d 6c20 506f 7374 6669 7820  ME.html Postfix 
-00004ec0: 5645 5250 2069 6e66 6f0a 2020 2020 202a  VERP info.     *
-00004ed0: 0a20 2020 2020 2a20 4076 6172 2062 6f6f  .     * @var boo
-00004ee0: 6c0a 2020 2020 202a 2f0a 2020 2020 7075  l.     */.    pu
-00004ef0: 626c 6963 2024 646f 5f76 6572 7020 3d20  blic $do_verp = 
-00004f00: 6661 6c73 653b 0a0a 2020 2020 2f2a 2a0a  false;..    /**.
-00004f10: 2020 2020 202a 2057 6865 7468 6572 2074       * Whether t
-00004f20: 6f20 616c 6c6f 7720 7365 6e64 696e 6720  o allow sending 
-00004f30: 6d65 7373 6167 6573 2077 6974 6820 616e  messages with an
-00004f40: 2065 6d70 7479 2062 6f64 792e 0a20 2020   empty body..   
-00004f50: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
-00004f60: 626f 6f6c 0a20 2020 2020 2a2f 0a20 2020  bool.     */.   
-00004f70: 2070 7562 6c69 6320 2441 6c6c 6f77 456d   public $AllowEm
-00004f80: 7074 7920 3d20 6661 6c73 653b 0a0a 2020  pty = false;..  
-00004f90: 2020 2f2a 2a0a 2020 2020 202a 2044 4b49    /**.     * DKI
-00004fa0: 4d20 7365 6c65 6374 6f72 2e0a 2020 2020  M selector..    
-00004fb0: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
-00004fc0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00004fd0: 2020 7075 626c 6963 2024 444b 494d 5f73    public $DKIM_s
-00004fe0: 656c 6563 746f 7220 3d20 2727 3b0a 0a20  elector = '';.. 
-00004ff0: 2020 202f 2a2a 0a20 2020 2020 2a20 444b     /**.     * DK
-00005000: 494d 2049 6465 6e74 6974 792e 0a20 2020  IM Identity..   
-00005010: 2020 2a20 5573 7561 6c6c 7920 7468 6520    * Usually the 
-00005020: 656d 6169 6c20 6164 6472 6573 7320 7573  email address us
-00005030: 6564 2061 7320 7468 6520 736f 7572 6365  ed as the source
-00005040: 206f 6620 7468 6520 656d 6169 6c2e 0a20   of the email.. 
-00005050: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-00005060: 7220 7374 7269 6e67 0a20 2020 2020 2a2f  r string.     */
-00005070: 0a20 2020 2070 7562 6c69 6320 2444 4b49  .    public $DKI
-00005080: 4d5f 6964 656e 7469 7479 203d 2027 273b  M_identity = '';
-00005090: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-000050a0: 2044 4b49 4d20 7061 7373 7068 7261 7365   DKIM passphrase
-000050b0: 2e0a 2020 2020 202a 2055 7365 6420 6966  ..     * Used if
-000050c0: 2079 6f75 7220 6b65 7920 6973 2065 6e63   your key is enc
-000050d0: 7279 7074 6564 2e0a 2020 2020 202a 0a20  rypted..     *. 
-000050e0: 2020 2020 2a20 4076 6172 2073 7472 696e      * @var strin
-000050f0: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
-00005100: 626c 6963 2024 444b 494d 5f70 6173 7370  blic $DKIM_passp
-00005110: 6872 6173 6520 3d20 2727 3b0a 0a20 2020  hrase = '';..   
-00005120: 202f 2a2a 0a20 2020 2020 2a20 444b 494d   /**.     * DKIM
-00005130: 2073 6967 6e69 6e67 2064 6f6d 6169 6e20   signing domain 
-00005140: 6e61 6d65 2e0a 2020 2020 202a 0a20 2020  name..     *.   
-00005150: 2020 2a20 4065 7861 6d70 6c65 2027 6578    * @example 'ex
-00005160: 616d 706c 652e 636f 6d27 0a20 2020 2020  ample.com'.     
-00005170: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
-00005180: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
-00005190: 2070 7562 6c69 6320 2444 4b49 4d5f 646f   public $DKIM_do
-000051a0: 6d61 696e 203d 2027 273b 0a0a 2020 2020  main = '';..    
-000051b0: 2f2a 2a0a 2020 2020 202a 2044 4b49 4d20  /**.     * DKIM 
-000051c0: 436f 7079 2068 6561 6465 7220 6669 656c  Copy header fiel
-000051d0: 6420 7661 6c75 6573 2066 6f72 2064 6961  d values for dia
-000051e0: 676e 6f73 7469 6320 7573 652e 0a20 2020  gnostic use..   
-000051f0: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
-00005200: 626f 6f6c 0a20 2020 2020 2a2f 0a20 2020  bool.     */.   
-00005210: 2070 7562 6c69 6320 2444 4b49 4d5f 636f   public $DKIM_co
-00005220: 7079 4865 6164 6572 4669 656c 6473 203d  pyHeaderFields =
-00005230: 2074 7275 653b 0a0a 2020 2020 2f2a 2a0a   true;..    /**.
-00005240: 2020 2020 202a 2044 4b49 4d20 4578 7472       * DKIM Extr
-00005250: 6120 7369 676e 696e 6720 6865 6164 6572  a signing header
-00005260: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
-00005270: 2040 6578 616d 706c 6520 5b27 4c69 7374   @example ['List
-00005280: 2d55 6e73 7562 7363 7269 6265 272c 2027  -Unsubscribe', '
-00005290: 4c69 7374 2d48 656c 7027 5d0a 2020 2020  List-Help'].    
-000052a0: 202a 0a20 2020 2020 2a20 4076 6172 2061   *.     * @var a
-000052b0: 7272 6179 0a20 2020 2020 2a2f 0a20 2020  rray.     */.   
-000052c0: 2070 7562 6c69 6320 2444 4b49 4d5f 6578   public $DKIM_ex
-000052d0: 7472 6148 6561 6465 7273 203d 205b 5d3b  traHeaders = [];
-000052e0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-000052f0: 2044 4b49 4d20 7072 6976 6174 6520 6b65   DKIM private ke
-00005300: 7920 6669 6c65 2070 6174 682e 0a20 2020  y file path..   
-00005310: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
-00005320: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
-00005330: 2020 2070 7562 6c69 6320 2444 4b49 4d5f     public $DKIM_
-00005340: 7072 6976 6174 6520 3d20 2727 3b0a 0a20  private = '';.. 
-00005350: 2020 202f 2a2a 0a20 2020 2020 2a20 444b     /**.     * DK
-00005360: 494d 2070 7269 7661 7465 206b 6579 2073  IM private key s
-00005370: 7472 696e 672e 0a20 2020 2020 2a0a 2020  tring..     *.  
-00005380: 2020 202a 2049 6620 7365 742c 2074 616b     * If set, tak
-00005390: 6573 2070 7265 6365 6465 6e63 6520 6f76  es precedence ov
-000053a0: 6572 2060 2444 4b49 4d5f 7072 6976 6174  er `$DKIM_privat
-000053b0: 6560 2e0a 2020 2020 202a 0a20 2020 2020  e`..     *.     
-000053c0: 2a20 4076 6172 2073 7472 696e 670a 2020  * @var string.  
-000053d0: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
-000053e0: 2024 444b 494d 5f70 7269 7661 7465 5f73   $DKIM_private_s
-000053f0: 7472 696e 6720 3d20 2727 3b0a 0a20 2020  tring = '';..   
-00005400: 202f 2a2a 0a20 2020 2020 2a20 4361 6c6c   /**.     * Call
-00005410: 6261 636b 2041 6374 696f 6e20 6675 6e63  back Action func
-00005420: 7469 6f6e 206e 616d 652e 0a20 2020 2020  tion name..     
-00005430: 2a0a 2020 2020 202a 2054 6865 2066 756e  *.     * The fun
-00005440: 6374 696f 6e20 7468 6174 2068 616e 646c  ction that handl
-00005450: 6573 2074 6865 2072 6573 756c 7420 6f66  es the result of
-00005460: 2074 6865 2073 656e 6420 656d 6169 6c20   the send email 
-00005470: 6163 7469 6f6e 2e0a 2020 2020 202a 2049  action..     * I
-00005480: 7420 6973 2063 616c 6c65 6420 6f75 7420  t is called out 
-00005490: 6279 2073 656e 6428 2920 666f 7220 6561  by send() for ea
-000054a0: 6368 2065 6d61 696c 2073 656e 742e 0a20  ch email sent.. 
-000054b0: 2020 2020 2a0a 2020 2020 202a 2056 616c      *.     * Val
-000054c0: 7565 2063 616e 2062 6520 616e 7920 7068  ue can be any ph
-000054d0: 7020 6361 6c6c 6162 6c65 3a20 6874 7470  p callable: http
-000054e0: 3a2f 2f77 7777 2e70 6870 2e6e 6574 2f69  ://www.php.net/i
-000054f0: 735f 6361 6c6c 6162 6c65 0a20 2020 2020  s_callable.     
-00005500: 2a0a 2020 2020 202a 2050 6172 616d 6574  *.     * Paramet
-00005510: 6572 733a 0a20 2020 2020 2a20 2020 626f  ers:.     *   bo
-00005520: 6f6c 2024 7265 7375 6c74 2020 2020 2020  ol $result      
-00005530: 2020 7265 7375 6c74 206f 6620 7468 6520    result of the 
-00005540: 7365 6e64 2061 6374 696f 6e0a 2020 2020  send action.    
-00005550: 202a 2020 2061 7272 6179 2020 2024 746f   *   array   $to
-00005560: 2020 2020 2020 2020 2020 2020 656d 6169              emai
-00005570: 6c20 6164 6472 6573 7365 7320 6f66 2074  l addresses of t
-00005580: 6865 2072 6563 6970 6965 6e74 730a 2020  he recipients.  
-00005590: 2020 202a 2020 2061 7272 6179 2020 2024     *   array   $
-000055a0: 6363 2020 2020 2020 2020 2020 2020 6363  cc            cc
-000055b0: 2065 6d61 696c 2061 6464 7265 7373 6573   email addresses
-000055c0: 0a20 2020 2020 2a20 2020 6172 7261 7920  .     *   array 
-000055d0: 2020 2462 6363 2020 2020 2020 2020 2020    $bcc          
-000055e0: 2062 6363 2065 6d61 696c 2061 6464 7265   bcc email addre
-000055f0: 7373 6573 0a20 2020 2020 2a20 2020 7374  sses.     *   st
-00005600: 7269 6e67 2020 2473 7562 6a65 6374 2020  ring  $subject  
-00005610: 2020 2020 2074 6865 2073 7562 6a65 6374       the subject
-00005620: 0a20 2020 2020 2a20 2020 7374 7269 6e67  .     *   string
-00005630: 2020 2462 6f64 7920 2020 2020 2020 2020    $body         
-00005640: 2074 6865 2065 6d61 696c 2062 6f64 790a   the email body.
-00005650: 2020 2020 202a 2020 2073 7472 696e 6720       *   string 
-00005660: 2024 6672 6f6d 2020 2020 2020 2020 2020   $from          
-00005670: 656d 6169 6c20 6164 6472 6573 7320 6f66  email address of
-00005680: 2073 656e 6465 720a 2020 2020 202a 2020   sender.     *  
-00005690: 2073 7472 696e 6720 2024 6578 7472 6120   string  $extra 
-000056a0: 2020 2020 2020 2020 6578 7472 6120 696e          extra in
-000056b0: 666f 726d 6174 696f 6e20 6f66 2070 6f73  formation of pos
-000056c0: 7369 626c 6520 7573 650a 2020 2020 202a  sible use.     *
+00002f80: 494d 4520 6d65 7373 6167 6520 6865 6164  IME message head
+00002f90: 6572 732e 0a20 2020 2020 2a0a 2020 2020  ers..     *.    
+00002fa0: 202a 2040 7661 7220 7374 7269 6e67 0a20   * @var string. 
+00002fb0: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
+00002fc0: 6374 6564 2024 4d49 4d45 4865 6164 6572  cted $MIMEHeader
+00002fd0: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
+00002fe0: 2020 2020 202a 2045 7874 7261 2068 6561       * Extra hea
+00002ff0: 6465 7273 2074 6861 7420 6372 6561 7465  ders that create
+00003000: 4865 6164 6572 2829 2064 6f65 736e 2774  Header() doesn't
+00003010: 2066 6f6c 6420 696e 2e0a 2020 2020 202a   fold in..     *
+00003020: 0a20 2020 2020 2a20 4076 6172 2073 7472  .     * @var str
+00003030: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
+00003040: 7072 6f74 6563 7465 6420 246d 6169 6c48  protected $mailH
+00003050: 6561 6465 7220 3d20 2727 3b0a 0a20 2020  eader = '';..   
+00003060: 202f 2a2a 0a20 2020 2020 2a20 576f 7264   /**.     * Word
+00003070: 2d77 7261 7020 7468 6520 6d65 7373 6167  -wrap the messag
+00003080: 6520 626f 6479 2074 6f20 7468 6973 206e  e body to this n
+00003090: 756d 6265 7220 6f66 2063 6861 7273 2e0a  umber of chars..
+000030a0: 2020 2020 202a 2053 6574 2074 6f20 3020       * Set to 0 
+000030b0: 746f 206e 6f74 2077 7261 702e 2041 2075  to not wrap. A u
+000030c0: 7365 6675 6c20 7661 6c75 6520 6865 7265  seful value here
+000030d0: 2069 7320 3738 2c20 666f 7220 5246 4332   is 78, for RFC2
+000030e0: 3832 3220 7365 6374 696f 6e20 322e 312e  822 section 2.1.
+000030f0: 3120 636f 6d70 6c69 616e 6365 2e0a 2020  1 compliance..  
+00003100: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
+00003110: 2073 7461 7469 633a 3a53 5444 5f4c 494e   static::STD_LIN
+00003120: 455f 4c45 4e47 5448 0a20 2020 2020 2a0a  E_LENGTH.     *.
+00003130: 2020 2020 202a 2040 7661 7220 696e 740a       * @var int.
+00003140: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+00003150: 6963 2024 576f 7264 5772 6170 203d 2030  ic $WordWrap = 0
+00003160: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
+00003170: 2a20 5768 6963 6820 6d65 7468 6f64 2074  * Which method t
+00003180: 6f20 7573 6520 746f 2073 656e 6420 6d61  o use to send ma
+00003190: 696c 2e0a 2020 2020 202a 204f 7074 696f  il..     * Optio
+000031a0: 6e73 3a20 226d 6169 6c22 2c20 2273 656e  ns: "mail", "sen
+000031b0: 646d 6169 6c22 2c20 6f72 2022 736d 7470  dmail", or "smtp
+000031c0: 222e 0a20 2020 2020 2a0a 2020 2020 202a  "..     *.     *
+000031d0: 2040 7661 7220 7374 7269 6e67 0a20 2020   @var string.   
+000031e0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+000031f0: 244d 6169 6c65 7220 3d20 276d 6169 6c27  $Mailer = 'mail'
+00003200: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
+00003210: 2a20 5468 6520 7061 7468 2074 6f20 7468  * The path to th
+00003220: 6520 7365 6e64 6d61 696c 2070 726f 6772  e sendmail progr
+00003230: 616d 2e0a 2020 2020 202a 0a20 2020 2020  am..     *.     
+00003240: 2a20 4076 6172 2073 7472 696e 670a 2020  * @var string.  
+00003250: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+00003260: 2024 5365 6e64 6d61 696c 203d 2027 2f75   $Sendmail = '/u
+00003270: 7372 2f73 6269 6e2f 7365 6e64 6d61 696c  sr/sbin/sendmail
+00003280: 273b 0a0a 2020 2020 2f2a 2a0a 2020 2020  ';..    /**.    
+00003290: 202a 2057 6865 7468 6572 206d 6169 6c28   * Whether mail(
+000032a0: 2920 7573 6573 2061 2066 756c 6c79 2073  ) uses a fully s
+000032b0: 656e 646d 6169 6c2d 636f 6d70 6174 6962  endmail-compatib
+000032c0: 6c65 204d 5441 2e0a 2020 2020 202a 204f  le MTA..     * O
+000032d0: 6e65 2077 6869 6368 2073 7570 706f 7274  ne which support
+000032e0: 7320 7365 6e64 6d61 696c 2773 2022 2d6f  s sendmail's "-o
+000032f0: 6920 2d66 2220 6f70 7469 6f6e 732e 0a20  i -f" options.. 
+00003300: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+00003310: 7220 626f 6f6c 0a20 2020 2020 2a2f 0a20  r bool.     */. 
+00003320: 2020 2070 7562 6c69 6320 2455 7365 5365     public $UseSe
+00003330: 6e64 6d61 696c 4f70 7469 6f6e 7320 3d20  ndmailOptions = 
+00003340: 7472 7565 3b0a 0a20 2020 202f 2a2a 0a20  true;..    /**. 
+00003350: 2020 2020 2a20 5468 6520 656d 6169 6c20      * The email 
+00003360: 6164 6472 6573 7320 7468 6174 2061 2072  address that a r
+00003370: 6561 6469 6e67 2063 6f6e 6669 726d 6174  eading confirmat
+00003380: 696f 6e20 7368 6f75 6c64 2062 6520 7365  ion should be se
+00003390: 6e74 2074 6f2c 2061 6c73 6f20 6b6e 6f77  nt to, also know
+000033a0: 6e20 6173 2072 6561 6420 7265 6365 6970  n as read receip
+000033b0: 742e 0a20 2020 2020 2a0a 2020 2020 202a  t..     *.     *
+000033c0: 2040 7661 7220 7374 7269 6e67 0a20 2020   @var string.   
+000033d0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+000033e0: 2443 6f6e 6669 726d 5265 6164 696e 6754  $ConfirmReadingT
+000033f0: 6f20 3d20 2727 3b0a 0a20 2020 202f 2a2a  o = '';..    /**
+00003400: 0a20 2020 2020 2a20 5468 6520 686f 7374  .     * The host
+00003410: 6e61 6d65 2074 6f20 7573 6520 696e 2074  name to use in t
+00003420: 6865 204d 6573 7361 6765 2d49 4420 6865  he Message-ID he
+00003430: 6164 6572 2061 6e64 2061 7320 6465 6661  ader and as defa
+00003440: 756c 7420 4845 4c4f 2073 7472 696e 672e  ult HELO string.
+00003450: 0a20 2020 2020 2a20 4966 2065 6d70 7479  .     * If empty
+00003460: 2c20 5048 504d 6169 6c65 7220 6174 7465  , PHPMailer atte
+00003470: 6d70 7473 2074 6f20 6669 6e64 206f 6e65  mpts to find one
+00003480: 2077 6974 682c 2069 6e20 6f72 6465 722c   with, in order,
+00003490: 0a20 2020 2020 2a20 245f 5345 5256 4552  .     * $_SERVER
+000034a0: 5b27 5345 5256 4552 5f4e 414d 4527 5d2c  ['SERVER_NAME'],
+000034b0: 2067 6574 686f 7374 6e61 6d65 2829 2c20   gethostname(), 
+000034c0: 7068 705f 756e 616d 6528 276e 2729 2c20  php_uname('n'), 
+000034d0: 6f72 2074 6865 2076 616c 7565 0a20 2020  or the value.   
+000034e0: 2020 2a20 276c 6f63 616c 686f 7374 2e6c    * 'localhost.l
+000034f0: 6f63 616c 646f 6d61 696e 272e 0a20 2020  ocaldomain'..   
+00003500: 2020 2a0a 2020 2020 202a 2040 7365 6520    *.     * @see 
+00003510: 5048 504d 6169 6c65 723a 3a24 4865 6c6f  PHPMailer::$Helo
+00003520: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00003530: 7661 7220 7374 7269 6e67 0a20 2020 2020  var string.     
+00003540: 2a2f 0a20 2020 2070 7562 6c69 6320 2448  */.    public $H
+00003550: 6f73 746e 616d 6520 3d20 2727 3b0a 0a20  ostname = '';.. 
+00003560: 2020 202f 2a2a 0a20 2020 2020 2a20 416e     /**.     * An
+00003570: 2049 4420 746f 2062 6520 7573 6564 2069   ID to be used i
+00003580: 6e20 7468 6520 4d65 7373 6167 652d 4944  n the Message-ID
+00003590: 2068 6561 6465 722e 0a20 2020 2020 2a20   header..     * 
+000035a0: 4966 2065 6d70 7479 2c20 6120 756e 6971  If empty, a uniq
+000035b0: 7565 2069 6420 7769 6c6c 2062 6520 6765  ue id will be ge
+000035c0: 6e65 7261 7465 642e 0a20 2020 2020 2a20  nerated..     * 
+000035d0: 596f 7520 6361 6e20 7365 7420 796f 7572  You can set your
+000035e0: 206f 776e 2c20 6275 7420 6974 206d 7573   own, but it mus
+000035f0: 7420 6265 2069 6e20 7468 6520 666f 726d  t be in the form
+00003600: 6174 2022 3c69 6440 646f 6d61 696e 3e22  at "<id@domain>"
+00003610: 2c0a 2020 2020 202a 2061 7320 6465 6669  ,.     * as defi
+00003620: 6e65 6420 696e 2052 4643 3533 3232 2073  ned in RFC5322 s
+00003630: 6563 7469 6f6e 2033 2e36 2e34 206f 7220  ection 3.6.4 or 
+00003640: 6974 2077 696c 6c20 6265 2069 676e 6f72  it will be ignor
+00003650: 6564 2e0a 2020 2020 202a 0a20 2020 2020  ed..     *.     
+00003660: 2a20 4073 6565 2068 7474 7073 3a2f 2f74  * @see https://t
+00003670: 6f6f 6c73 2e69 6574 662e 6f72 672f 6874  ools.ietf.org/ht
+00003680: 6d6c 2f72 6663 3533 3232 2373 6563 7469  ml/rfc5322#secti
+00003690: 6f6e 2d33 2e36 2e34 0a20 2020 2020 2a0a  on-3.6.4.     *.
+000036a0: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
+000036b0: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+000036c0: 7562 6c69 6320 244d 6573 7361 6765 4944  ublic $MessageID
+000036d0: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
+000036e0: 2020 2020 202a 2054 6865 206d 6573 7361       * The messa
+000036f0: 6765 2044 6174 6520 746f 2062 6520 7573  ge Date to be us
+00003700: 6564 2069 6e20 7468 6520 4461 7465 2068  ed in the Date h
+00003710: 6561 6465 722e 0a20 2020 2020 2a20 4966  eader..     * If
+00003720: 2065 6d70 7479 2c20 7468 6520 6375 7272   empty, the curr
+00003730: 656e 7420 6461 7465 2077 696c 6c20 6265  ent date will be
+00003740: 2061 6464 6564 2e0a 2020 2020 202a 0a20   added..     *. 
+00003750: 2020 2020 2a20 4076 6172 2073 7472 696e      * @var strin
+00003760: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
+00003770: 626c 6963 2024 4d65 7373 6167 6544 6174  blic $MessageDat
+00003780: 6520 3d20 2727 3b0a 0a20 2020 202f 2a2a  e = '';..    /**
+00003790: 0a20 2020 2020 2a20 534d 5450 2068 6f73  .     * SMTP hos
+000037a0: 7473 2e0a 2020 2020 202a 2045 6974 6865  ts..     * Eithe
+000037b0: 7220 6120 7369 6e67 6c65 2068 6f73 746e  r a single hostn
+000037c0: 616d 6520 6f72 206d 756c 7469 706c 6520  ame or multiple 
+000037d0: 7365 6d69 636f 6c6f 6e2d 6465 6c69 6d69  semicolon-delimi
+000037e0: 7465 6420 686f 7374 6e61 6d65 732e 0a20  ted hostnames.. 
+000037f0: 2020 2020 2a20 596f 7520 6361 6e20 616c      * You can al
+00003800: 736f 2073 7065 6369 6679 2061 2064 6966  so specify a dif
+00003810: 6665 7265 6e74 2070 6f72 740a 2020 2020  ferent port.    
+00003820: 202a 2066 6f72 2065 6163 6820 686f 7374   * for each host
+00003830: 2062 7920 7573 696e 6720 7468 6973 2066   by using this f
+00003840: 6f72 6d61 743a 205b 686f 7374 6e61 6d65  ormat: [hostname
+00003850: 3a70 6f72 745d 0a20 2020 2020 2a20 2865  :port].     * (e
+00003860: 2e67 2e20 2273 6d74 7031 2e65 7861 6d70  .g. "smtp1.examp
+00003870: 6c65 2e63 6f6d 3a32 353b 736d 7470 322e  le.com:25;smtp2.
+00003880: 6578 616d 706c 652e 636f 6d22 292e 0a20  example.com").. 
+00003890: 2020 2020 2a20 596f 7520 6361 6e20 616c      * You can al
+000038a0: 736f 2073 7065 6369 6679 2065 6e63 7279  so specify encry
+000038b0: 7074 696f 6e20 7479 7065 2c20 666f 7220  ption type, for 
+000038c0: 6578 616d 706c 653a 0a20 2020 2020 2a20  example:.     * 
+000038d0: 2865 2e67 2e20 2274 6c73 3a2f 2f73 6d74  (e.g. "tls://smt
+000038e0: 7031 2e65 7861 6d70 6c65 2e63 6f6d 3a35  p1.example.com:5
+000038f0: 3837 3b73 736c 3a2f 2f73 6d74 7032 2e65  87;ssl://smtp2.e
+00003900: 7861 6d70 6c65 2e63 6f6d 3a34 3635 2229  xample.com:465")
+00003910: 2e0a 2020 2020 202a 2048 6f73 7473 2077  ..     * Hosts w
+00003920: 696c 6c20 6265 2074 7269 6564 2069 6e20  ill be tried in 
+00003930: 6f72 6465 722e 0a20 2020 2020 2a0a 2020  order..     *.  
+00003940: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+00003950: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00003960: 6c69 6320 2448 6f73 7420 3d20 276c 6f63  lic $Host = 'loc
+00003970: 616c 686f 7374 273b 0a0a 2020 2020 2f2a  alhost';..    /*
+00003980: 2a0a 2020 2020 202a 2054 6865 2064 6566  *.     * The def
+00003990: 6175 6c74 2053 4d54 5020 7365 7276 6572  ault SMTP server
+000039a0: 2070 6f72 742e 0a20 2020 2020 2a0a 2020   port..     *.  
+000039b0: 2020 202a 2040 7661 7220 696e 740a 2020     * @var int.  
+000039c0: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+000039d0: 2024 506f 7274 203d 2032 353b 0a0a 2020   $Port = 25;..  
+000039e0: 2020 2f2a 2a0a 2020 2020 202a 2054 6865    /**.     * The
+000039f0: 2053 4d54 5020 4845 4c4f 2f45 484c 4f20   SMTP HELO/EHLO 
+00003a00: 6e61 6d65 2075 7365 6420 666f 7220 7468  name used for th
+00003a10: 6520 534d 5450 2063 6f6e 6e65 6374 696f  e SMTP connectio
+00003a20: 6e2e 0a20 2020 2020 2a20 4465 6661 756c  n..     * Defaul
+00003a30: 7420 6973 2024 486f 7374 6e61 6d65 2e20  t is $Hostname. 
+00003a40: 4966 2024 486f 7374 6e61 6d65 2069 7320  If $Hostname is 
+00003a50: 656d 7074 792c 2050 4850 4d61 696c 6572  empty, PHPMailer
+00003a60: 2061 7474 656d 7074 7320 746f 2066 696e   attempts to fin
+00003a70: 640a 2020 2020 202a 206f 6e65 2077 6974  d.     * one wit
+00003a80: 6820 7468 6520 7361 6d65 206d 6574 686f  h the same metho
+00003a90: 6420 6465 7363 7269 6265 6420 6162 6f76  d described abov
+00003aa0: 6520 666f 7220 2448 6f73 746e 616d 652e  e for $Hostname.
+00003ab0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00003ac0: 7365 6520 5048 504d 6169 6c65 723a 3a24  see PHPMailer::$
+00003ad0: 486f 7374 6e61 6d65 0a20 2020 2020 2a0a  Hostname.     *.
+00003ae0: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
+00003af0: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+00003b00: 7562 6c69 6320 2448 656c 6f20 3d20 2727  ublic $Helo = ''
+00003b10: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
+00003b20: 2a20 5768 6174 206b 696e 6420 6f66 2065  * What kind of e
+00003b30: 6e63 7279 7074 696f 6e20 746f 2075 7365  ncryption to use
+00003b40: 206f 6e20 7468 6520 534d 5450 2063 6f6e   on the SMTP con
+00003b50: 6e65 6374 696f 6e2e 0a20 2020 2020 2a20  nection..     * 
+00003b60: 4f70 7469 6f6e 733a 2027 272c 2073 7461  Options: '', sta
+00003b70: 7469 633a 3a45 4e43 5259 5054 494f 4e5f  tic::ENCRYPTION_
+00003b80: 5354 4152 5454 4c53 2c20 6f72 2073 7461  STARTTLS, or sta
+00003b90: 7469 633a 3a45 4e43 5259 5054 494f 4e5f  tic::ENCRYPTION_
+00003ba0: 534d 5450 532e 0a20 2020 2020 2a0a 2020  SMTPS..     *.  
+00003bb0: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+00003bc0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00003bd0: 6c69 6320 2453 4d54 5053 6563 7572 6520  lic $SMTPSecure 
+00003be0: 3d20 2727 3b0a 0a20 2020 202f 2a2a 0a20  = '';..    /**. 
+00003bf0: 2020 2020 2a20 5768 6574 6865 7220 746f      * Whether to
+00003c00: 2065 6e61 626c 6520 544c 5320 656e 6372   enable TLS encr
+00003c10: 7970 7469 6f6e 2061 7574 6f6d 6174 6963  yption automatic
+00003c20: 616c 6c79 2069 6620 6120 7365 7276 6572  ally if a server
+00003c30: 2073 7570 706f 7274 7320 6974 2c0a 2020   supports it,.  
+00003c40: 2020 202a 2065 7665 6e20 6966 2060 534d     * even if `SM
+00003c50: 5450 5365 6375 7265 6020 6973 206e 6f74  TPSecure` is not
+00003c60: 2073 6574 2074 6f20 2774 6c73 272e 0a20   set to 'tls'.. 
+00003c70: 2020 2020 2a20 4265 2061 7761 7265 2074      * Be aware t
+00003c80: 6861 7420 696e 2050 4850 203e 3d20 352e  hat in PHP >= 5.
+00003c90: 3620 7468 6973 2072 6571 7569 7265 7320  6 this requires 
+00003ca0: 7468 6174 2074 6865 2073 6572 7665 7227  that the server'
+00003cb0: 7320 6365 7274 6966 6963 6174 6573 2061  s certificates a
+00003cc0: 7265 2076 616c 6964 2e0a 2020 2020 202a  re valid..     *
+00003cd0: 0a20 2020 2020 2a20 4076 6172 2062 6f6f  .     * @var boo
+00003ce0: 6c0a 2020 2020 202a 2f0a 2020 2020 7075  l.     */.    pu
+00003cf0: 626c 6963 2024 534d 5450 4175 746f 544c  blic $SMTPAutoTL
+00003d00: 5320 3d20 7472 7565 3b0a 0a20 2020 202f  S = true;..    /
+00003d10: 2a2a 0a20 2020 2020 2a20 5768 6574 6865  **.     * Whethe
+00003d20: 7220 746f 2075 7365 2053 4d54 5020 6175  r to use SMTP au
+00003d30: 7468 656e 7469 6361 7469 6f6e 2e0a 2020  thentication..  
+00003d40: 2020 202a 2055 7365 7320 7468 6520 5573     * Uses the Us
+00003d50: 6572 6e61 6d65 2061 6e64 2050 6173 7377  ername and Passw
+00003d60: 6f72 6420 7072 6f70 6572 7469 6573 2e0a  ord properties..
+00003d70: 2020 2020 202a 0a20 2020 2020 2a20 4073       *.     * @s
+00003d80: 6565 2050 4850 4d61 696c 6572 3a3a 2455  ee PHPMailer::$U
+00003d90: 7365 726e 616d 650a 2020 2020 202a 2040  sername.     * @
+00003da0: 7365 6520 5048 504d 6169 6c65 723a 3a24  see PHPMailer::$
+00003db0: 5061 7373 776f 7264 0a20 2020 2020 2a0a  Password.     *.
+00003dc0: 2020 2020 202a 2040 7661 7220 626f 6f6c       * @var bool
+00003dd0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00003de0: 6c69 6320 2453 4d54 5041 7574 6820 3d20  lic $SMTPAuth = 
+00003df0: 6661 6c73 653b 0a0a 2020 2020 2f2a 2a0a  false;..    /**.
+00003e00: 2020 2020 202a 204f 7074 696f 6e73 2061       * Options a
+00003e10: 7272 6179 2070 6173 7365 6420 746f 2073  rray passed to s
+00003e20: 7472 6561 6d5f 636f 6e74 6578 745f 6372  tream_context_cr
+00003e30: 6561 7465 2077 6865 6e20 636f 6e6e 6563  eate when connec
+00003e40: 7469 6e67 2076 6961 2053 4d54 502e 0a20  ting via SMTP.. 
+00003e50: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+00003e60: 7220 6172 7261 790a 2020 2020 202a 2f0a  r array.     */.
+00003e70: 2020 2020 7075 626c 6963 2024 534d 5450      public $SMTP
+00003e80: 4f70 7469 6f6e 7320 3d20 5b5d 3b0a 0a20  Options = [];.. 
+00003e90: 2020 202f 2a2a 0a20 2020 2020 2a20 534d     /**.     * SM
+00003ea0: 5450 2075 7365 726e 616d 652e 0a20 2020  TP username..   
+00003eb0: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
+00003ec0: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
+00003ed0: 2020 2070 7562 6c69 6320 2455 7365 726e     public $Usern
+00003ee0: 616d 6520 3d20 2727 3b0a 0a20 2020 202f  ame = '';..    /
+00003ef0: 2a2a 0a20 2020 2020 2a20 534d 5450 2070  **.     * SMTP p
+00003f00: 6173 7377 6f72 642e 0a20 2020 2020 2a0a  assword..     *.
+00003f10: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
+00003f20: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+00003f30: 7562 6c69 6320 2450 6173 7377 6f72 6420  ublic $Password 
+00003f40: 3d20 2727 3b0a 0a20 2020 202f 2a2a 0a20  = '';..    /**. 
+00003f50: 2020 2020 2a20 534d 5450 2061 7574 6865      * SMTP authe
+00003f60: 6e74 6963 6174 696f 6e20 7479 7065 2e20  ntication type. 
+00003f70: 4f70 7469 6f6e 7320 6172 6520 4352 414d  Options are CRAM
+00003f80: 2d4d 4435 2c20 4c4f 4749 4e2c 2050 4c41  -MD5, LOGIN, PLA
+00003f90: 494e 2c20 584f 4155 5448 322e 0a20 2020  IN, XOAUTH2..   
+00003fa0: 2020 2a20 4966 206e 6f74 2073 7065 6369    * If not speci
+00003fb0: 6669 6564 2c20 7468 6520 6669 7273 7420  fied, the first 
+00003fc0: 6f6e 6520 6672 6f6d 2074 6861 7420 6c69  one from that li
+00003fd0: 7374 2074 6861 7420 7468 6520 7365 7276  st that the serv
+00003fe0: 6572 2073 7570 706f 7274 7320 7769 6c6c  er supports will
+00003ff0: 2062 6520 7365 6c65 6374 6564 2e0a 2020   be selected..  
+00004000: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
+00004010: 2073 7472 696e 670a 2020 2020 202a 2f0a   string.     */.
+00004020: 2020 2020 7075 626c 6963 2024 4175 7468      public $Auth
+00004030: 5479 7065 203d 2027 273b 0a0a 2020 2020  Type = '';..    
+00004040: 2f2a 2a0a 2020 2020 202a 2053 4d54 5020  /**.     * SMTP 
+00004050: 534d 5450 5843 6c69 656e 7420 636f 6d6d  SMTPXClient comm
+00004060: 616e 6420 6174 7469 6275 7465 730a 2020  and attibutes.  
+00004070: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
+00004080: 2061 7272 6179 0a20 2020 2020 2a2f 0a20   array.     */. 
+00004090: 2020 2070 726f 7465 6374 6564 2024 534d     protected $SM
+000040a0: 5450 5843 6c69 656e 7420 3d20 5b5d 3b0a  TPXClient = [];.
+000040b0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+000040c0: 416e 2069 6d70 6c65 6d65 6e74 6174 696f  An implementatio
+000040d0: 6e20 6f66 2074 6865 2050 4850 4d61 696c  n of the PHPMail
+000040e0: 6572 204f 4175 7468 546f 6b65 6e50 726f  er OAuthTokenPro
+000040f0: 7669 6465 7220 696e 7465 7266 6163 652e  vider interface.
+00004100: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00004110: 7661 7220 4f41 7574 6854 6f6b 656e 5072  var OAuthTokenPr
+00004120: 6f76 6964 6572 0a20 2020 2020 2a2f 0a20  ovider.     */. 
+00004130: 2020 2070 726f 7465 6374 6564 2024 6f61     protected $oa
+00004140: 7574 683b 0a0a 2020 2020 2f2a 2a0a 2020  uth;..    /**.  
+00004150: 2020 202a 2054 6865 2053 4d54 5020 7365     * The SMTP se
+00004160: 7276 6572 2074 696d 656f 7574 2069 6e20  rver timeout in 
+00004170: 7365 636f 6e64 732e 0a20 2020 2020 2a20  seconds..     * 
+00004180: 4465 6661 756c 7420 6f66 2035 206d 696e  Default of 5 min
+00004190: 7574 6573 2028 3330 3073 6563 2920 6973  utes (300sec) is
+000041a0: 2066 726f 6d20 5246 4332 3832 3120 7365   from RFC2821 se
+000041b0: 6374 696f 6e20 342e 352e 332e 322e 0a20  ction 4.5.3.2.. 
+000041c0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+000041d0: 7220 696e 740a 2020 2020 202a 2f0a 2020  r int.     */.  
+000041e0: 2020 7075 626c 6963 2024 5469 6d65 6f75    public $Timeou
+000041f0: 7420 3d20 3330 303b 0a0a 2020 2020 2f2a  t = 300;..    /*
+00004200: 2a0a 2020 2020 202a 2043 6f6d 6d61 2073  *.     * Comma s
+00004210: 6570 6172 6174 6564 206c 6973 7420 6f66  eparated list of
+00004220: 2044 534e 206e 6f74 6966 6963 6174 696f   DSN notificatio
+00004230: 6e73 0a20 2020 2020 2a20 274e 4556 4552  ns.     * 'NEVER
+00004240: 2720 756e 6465 7220 6e6f 2063 6972 6375  ' under no circu
+00004250: 6d73 7461 6e63 6573 2061 2044 534e 206d  mstances a DSN m
+00004260: 7573 7420 6265 2072 6574 7572 6e65 6420  ust be returned 
+00004270: 746f 2074 6865 2073 656e 6465 722e 0a20  to the sender.. 
+00004280: 2020 2020 2a20 2020 2020 2020 2020 4966      *         If
+00004290: 2079 6f75 2075 7365 204e 4556 4552 2061   you use NEVER a
+000042a0: 6c6c 206f 7468 6572 206e 6f74 6966 6963  ll other notific
+000042b0: 6174 696f 6e73 2077 696c 6c20 6265 2069  ations will be i
+000042c0: 676e 6f72 6564 2e0a 2020 2020 202a 2027  gnored..     * '
+000042d0: 5355 4343 4553 5327 2077 696c 6c20 6e6f  SUCCESS' will no
+000042e0: 7469 6679 2079 6f75 2077 6865 6e20 796f  tify you when yo
+000042f0: 7572 206d 6169 6c20 6861 7320 6172 7269  ur mail has arri
+00004300: 7665 6420 6174 2069 7473 2064 6573 7469  ved at its desti
+00004310: 6e61 7469 6f6e 2e0a 2020 2020 202a 2027  nation..     * '
+00004320: 4641 494c 5552 4527 2077 696c 6c20 6172  FAILURE' will ar
+00004330: 7269 7665 2069 6620 616e 2065 7272 6f72  rive if an error
+00004340: 206f 6363 7572 7265 6420 6475 7269 6e67   occurred during
+00004350: 2064 656c 6976 6572 792e 0a20 2020 2020   delivery..     
+00004360: 2a20 2744 454c 4159 2720 2020 7769 6c6c  * 'DELAY'   will
+00004370: 206e 6f74 6966 7920 796f 7520 6966 2074   notify you if t
+00004380: 6865 7265 2069 7320 616e 2075 6e75 7375  here is an unusu
+00004390: 616c 2064 656c 6179 2069 6e20 6465 6c69  al delay in deli
+000043a0: 7665 7279 2c20 6275 7420 7468 6520 6163  very, but the ac
+000043b0: 7475 616c 0a20 2020 2020 2a20 2020 2020  tual.     *     
+000043c0: 2020 2020 2020 6465 6c69 7665 7279 2773        delivery's
+000043d0: 206f 7574 636f 6d65 2028 7375 6363 6573   outcome (succes
+000043e0: 7320 6f72 2066 6169 6c75 7265 2920 6973  s or failure) is
+000043f0: 206e 6f74 2079 6574 2064 6563 6964 6564   not yet decided
+00004400: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00004410: 4073 6565 2068 7474 7073 3a2f 2f74 6f6f  @see https://too
+00004420: 6c73 2e69 6574 662e 6f72 672f 6874 6d6c  ls.ietf.org/html
+00004430: 2f72 6663 3334 3631 2053 6565 2073 6563  /rfc3461 See sec
+00004440: 7469 6f6e 2034 2e31 2066 6f72 206d 6f72  tion 4.1 for mor
+00004450: 6520 696e 666f 726d 6174 696f 6e20 6162  e information ab
+00004460: 6f75 7420 4e4f 5449 4659 0a20 2020 2020  out NOTIFY.     
+00004470: 2a2f 0a20 2020 2070 7562 6c69 6320 2464  */.    public $d
+00004480: 736e 203d 2027 273b 0a0a 2020 2020 2f2a  sn = '';..    /*
+00004490: 2a0a 2020 2020 202a 2053 4d54 5020 636c  *.     * SMTP cl
+000044a0: 6173 7320 6465 6275 6720 6f75 7470 7574  ass debug output
+000044b0: 206d 6f64 652e 0a20 2020 2020 2a20 4465   mode..     * De
+000044c0: 6275 6720 6f75 7470 7574 206c 6576 656c  bug output level
+000044d0: 2e0a 2020 2020 202a 204f 7074 696f 6e73  ..     * Options
+000044e0: 3a0a 2020 2020 202a 2040 7365 6520 534d  :.     * @see SM
+000044f0: 5450 3a3a 4445 4255 475f 4f46 463a 204e  TP::DEBUG_OFF: N
+00004500: 6f20 6f75 7470 7574 0a20 2020 2020 2a20  o output.     * 
+00004510: 4073 6565 2053 4d54 503a 3a44 4542 5547  @see SMTP::DEBUG
+00004520: 5f43 4c49 454e 543a 2043 6c69 656e 7420  _CLIENT: Client 
+00004530: 6d65 7373 6167 6573 0a20 2020 2020 2a20  messages.     * 
+00004540: 4073 6565 2053 4d54 503a 3a44 4542 5547  @see SMTP::DEBUG
+00004550: 5f53 4552 5645 523a 2043 6c69 656e 7420  _SERVER: Client 
+00004560: 616e 6420 7365 7276 6572 206d 6573 7361  and server messa
+00004570: 6765 730a 2020 2020 202a 2040 7365 6520  ges.     * @see 
+00004580: 534d 5450 3a3a 4445 4255 475f 434f 4e4e  SMTP::DEBUG_CONN
+00004590: 4543 5449 4f4e 3a20 4173 2053 4552 5645  ECTION: As SERVE
+000045a0: 5220 706c 7573 2063 6f6e 6e65 6374 696f  R plus connectio
+000045b0: 6e20 7374 6174 7573 0a20 2020 2020 2a20  n status.     * 
+000045c0: 4073 6565 2053 4d54 503a 3a44 4542 5547  @see SMTP::DEBUG
+000045d0: 5f4c 4f57 4c45 5645 4c3a 204e 6f69 7379  _LOWLEVEL: Noisy
+000045e0: 2c20 6c6f 772d 6c65 7665 6c20 6461 7461  , low-level data
+000045f0: 206f 7574 7075 742c 2072 6172 656c 7920   output, rarely 
+00004600: 6e65 6564 6564 0a20 2020 2020 2a0a 2020  needed.     *.  
+00004610: 2020 202a 2040 7365 6520 534d 5450 3a3a     * @see SMTP::
+00004620: 2464 6f5f 6465 6275 670a 2020 2020 202a  $do_debug.     *
+00004630: 0a20 2020 2020 2a20 4076 6172 2069 6e74  .     * @var int
+00004640: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00004650: 6c69 6320 2453 4d54 5044 6562 7567 203d  lic $SMTPDebug =
+00004660: 2030 3b0a 0a20 2020 202f 2a2a 0a20 2020   0;..    /**.   
+00004670: 2020 2a20 486f 7720 746f 2068 616e 646c    * How to handl
+00004680: 6520 6465 6275 6720 6f75 7470 7574 2e0a  e debug output..
+00004690: 2020 2020 202a 204f 7074 696f 6e73 3a0a       * Options:.
+000046a0: 2020 2020 202a 202a 2060 6563 686f 6020       * * `echo` 
+000046b0: 4f75 7470 7574 2070 6c61 696e 2d74 6578  Output plain-tex
+000046c0: 7420 6173 2d69 732c 2061 7070 726f 7072  t as-is, appropr
+000046d0: 6961 7465 2066 6f72 2043 4c49 0a20 2020  iate for CLI.   
+000046e0: 2020 2a20 2a20 6068 746d 6c60 204f 7574    * * `html` Out
+000046f0: 7075 7420 6573 6361 7065 642c 206c 696e  put escaped, lin
+00004700: 6520 6272 6561 6b73 2063 6f6e 7665 7274  e breaks convert
+00004710: 6564 2074 6f20 603c 6272 3e60 2c20 6170  ed to `<br>`, ap
+00004720: 7072 6f70 7269 6174 6520 666f 7220 6272  propriate for br
+00004730: 6f77 7365 7220 6f75 7470 7574 0a20 2020  owser output.   
+00004740: 2020 2a20 2a20 6065 7272 6f72 5f6c 6f67    * * `error_log
+00004750: 6020 4f75 7470 7574 2074 6f20 6572 726f  ` Output to erro
+00004760: 7220 6c6f 6720 6173 2063 6f6e 6669 6775  r log as configu
+00004770: 7265 6420 696e 2070 6870 2e69 6e69 0a20  red in php.ini. 
+00004780: 2020 2020 2a20 4279 2064 6566 6175 6c74      * By default
+00004790: 2050 4850 4d61 696c 6572 2077 696c 6c20   PHPMailer will 
+000047a0: 7573 6520 6065 6368 6f60 2069 6620 7275  use `echo` if ru
+000047b0: 6e20 6672 6f6d 2061 2060 636c 6960 206f  n from a `cli` o
+000047c0: 7220 6063 6c69 2d73 6572 7665 7260 2053  r `cli-server` S
+000047d0: 4150 492c 2060 6874 6d6c 6020 6f74 6865  API, `html` othe
+000047e0: 7277 6973 652e 0a20 2020 2020 2a20 416c  rwise..     * Al
+000047f0: 7465 726e 6174 6976 656c 792c 2079 6f75  ternatively, you
+00004800: 2063 616e 2070 726f 7669 6465 2061 2063   can provide a c
+00004810: 616c 6c61 626c 6520 6578 7065 6374 696e  allable expectin
+00004820: 6720 7477 6f20 7061 7261 6d73 3a20 6120  g two params: a 
+00004830: 6d65 7373 6167 6520 7374 7269 6e67 2061  message string a
+00004840: 6e64 2074 6865 2064 6562 7567 206c 6576  nd the debug lev
+00004850: 656c 3a0a 2020 2020 202a 0a20 2020 2020  el:.     *.     
+00004860: 2a20 6060 6070 6870 0a20 2020 2020 2a20  * ```php.     * 
+00004870: 246d 6169 6c2d 3e44 6562 7567 6f75 7470  $mail->Debugoutp
+00004880: 7574 203d 2066 756e 6374 696f 6e28 2473  ut = function($s
+00004890: 7472 2c20 246c 6576 656c 2920 7b65 6368  tr, $level) {ech
+000048a0: 6f20 2264 6562 7567 206c 6576 656c 2024  o "debug level $
+000048b0: 6c65 7665 6c3b 206d 6573 7361 6765 3a20  level; message: 
+000048c0: 2473 7472 223b 7d3b 0a20 2020 2020 2a20  $str";};.     * 
+000048d0: 6060 600a 2020 2020 202a 0a20 2020 2020  ```.     *.     
+000048e0: 2a20 416c 7465 726e 6174 6976 656c 792c  * Alternatively,
+000048f0: 2079 6f75 2063 616e 2070 6173 7320 696e   you can pass in
+00004900: 2061 6e20 696e 7374 616e 6365 206f 6620   an instance of 
+00004910: 6120 5053 522d 3320 636f 6d70 6174 6962  a PSR-3 compatib
+00004920: 6c65 206c 6f67 6765 722c 2074 686f 7567  le logger, thoug
+00004930: 6820 6f6e 6c79 2060 6465 6275 6760 0a20  h only `debug`. 
+00004940: 2020 2020 2a20 6c65 7665 6c20 6f75 7470      * level outp
+00004950: 7574 2069 7320 7573 6564 3a0a 2020 2020  ut is used:.    
+00004960: 202a 0a20 2020 2020 2a20 6060 6070 6870   *.     * ```php
+00004970: 0a20 2020 2020 2a20 246d 6169 6c2d 3e44  .     * $mail->D
+00004980: 6562 7567 6f75 7470 7574 203d 206e 6577  ebugoutput = new
+00004990: 206d 7950 7372 334c 6f67 6765 723b 0a20   myPsr3Logger;. 
+000049a0: 2020 2020 2a20 6060 600a 2020 2020 202a      * ```.     *
+000049b0: 0a20 2020 2020 2a20 4073 6565 2053 4d54  .     * @see SMT
+000049c0: 503a 3a24 4465 6275 676f 7574 7075 740a  P::$Debugoutput.
+000049d0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+000049e0: 6172 2073 7472 696e 677c 6361 6c6c 6162  ar string|callab
+000049f0: 6c65 7c5c 5073 725c 4c6f 675c 4c6f 6767  le|\Psr\Log\Logg
+00004a00: 6572 496e 7465 7266 6163 650a 2020 2020  erInterface.    
+00004a10: 202a 2f0a 2020 2020 7075 626c 6963 2024   */.    public $
+00004a20: 4465 6275 676f 7574 7075 7420 3d20 2765  Debugoutput = 'e
+00004a30: 6368 6f27 3b0a 0a20 2020 202f 2a2a 0a20  cho';..    /**. 
+00004a40: 2020 2020 2a20 5768 6574 6865 7220 746f      * Whether to
+00004a50: 206b 6565 7020 7468 6520 534d 5450 2063   keep the SMTP c
+00004a60: 6f6e 6e65 6374 696f 6e20 6f70 656e 2061  onnection open a
+00004a70: 6674 6572 2065 6163 6820 6d65 7373 6167  fter each messag
+00004a80: 652e 0a20 2020 2020 2a20 4966 2074 6869  e..     * If thi
+00004a90: 7320 6973 2073 6574 2074 6f20 7472 7565  s is set to true
+00004aa0: 2074 6865 6e20 7468 6520 636f 6e6e 6563   then the connec
+00004ab0: 7469 6f6e 2077 696c 6c20 7265 6d61 696e  tion will remain
+00004ac0: 206f 7065 6e20 6166 7465 7220 6120 7365   open after a se
+00004ad0: 6e64 2c0a 2020 2020 202a 2061 6e64 2063  nd,.     * and c
+00004ae0: 6c6f 7369 6e67 2074 6865 2063 6f6e 6e65  losing the conne
+00004af0: 6374 696f 6e20 7769 6c6c 2072 6571 7569  ction will requi
+00004b00: 7265 2061 6e20 6578 706c 6963 6974 2063  re an explicit c
+00004b10: 616c 6c20 746f 2073 6d74 7043 6c6f 7365  all to smtpClose
+00004b20: 2829 2e0a 2020 2020 202a 2049 7427 7320  ()..     * It's 
+00004b30: 6120 676f 6f64 2069 6465 6120 746f 2075  a good idea to u
+00004b40: 7365 2074 6869 7320 6966 2079 6f75 2061  se this if you a
+00004b50: 7265 2073 656e 6469 6e67 206d 756c 7469  re sending multi
+00004b60: 706c 6520 6d65 7373 6167 6573 2061 7320  ple messages as 
+00004b70: 6974 2072 6564 7563 6573 206f 7665 7268  it reduces overh
+00004b80: 6561 642e 0a20 2020 2020 2a20 5365 6520  ead..     * See 
+00004b90: 7468 6520 6d61 696c 696e 6720 6c69 7374  the mailing list
+00004ba0: 2065 7861 6d70 6c65 2066 6f72 2068 6f77   example for how
+00004bb0: 2074 6f20 7573 6520 6974 2e0a 2020 2020   to use it..    
+00004bc0: 202a 0a20 2020 2020 2a20 4076 6172 2062   *.     * @var b
+00004bd0: 6f6f 6c0a 2020 2020 202a 2f0a 2020 2020  ool.     */.    
+00004be0: 7075 626c 6963 2024 534d 5450 4b65 6570  public $SMTPKeep
+00004bf0: 416c 6976 6520 3d20 6661 6c73 653b 0a0a  Alive = false;..
+00004c00: 2020 2020 2f2a 2a0a 2020 2020 202a 2057      /**.     * W
+00004c10: 6865 7468 6572 2074 6f20 7370 6c69 7420  hether to split 
+00004c20: 6d75 6c74 6970 6c65 2074 6f20 6164 6472  multiple to addr
+00004c30: 6573 7365 7320 696e 746f 206d 756c 7469  esses into multi
+00004c40: 706c 6520 6d65 7373 6167 6573 0a20 2020  ple messages.   
+00004c50: 2020 2a20 6f72 2073 656e 6420 7468 656d    * or send them
+00004c60: 2061 6c6c 2069 6e20 6f6e 6520 6d65 7373   all in one mess
+00004c70: 6167 652e 0a20 2020 2020 2a20 4f6e 6c79  age..     * Only
+00004c80: 2073 7570 706f 7274 6564 2069 6e20 606d   supported in `m
+00004c90: 6169 6c60 2061 6e64 2060 7365 6e64 6d61  ail` and `sendma
+00004ca0: 696c 6020 7472 616e 7370 6f72 7473 2c20  il` transports, 
+00004cb0: 6e6f 7420 696e 2053 4d54 502e 0a20 2020  not in SMTP..   
+00004cc0: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
+00004cd0: 626f 6f6c 0a20 2020 2020 2a0a 2020 2020  bool.     *.    
+00004ce0: 202a 2040 6465 7072 6563 6174 6564 2036   * @deprecated 6
+00004cf0: 2e30 2e30 2050 4850 4d61 696c 6572 2069  .0.0 PHPMailer i
+00004d00: 736e 2774 2061 206d 6169 6c69 6e67 206c  sn't a mailing l
+00004d10: 6973 7420 6d61 6e61 6765 7221 0a20 2020  ist manager!.   
+00004d20: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00004d30: 2453 696e 676c 6554 6f20 3d20 6661 6c73  $SingleTo = fals
+00004d40: 653b 0a0a 2020 2020 2f2a 2a0a 2020 2020  e;..    /**.    
+00004d50: 202a 2053 746f 7261 6765 2066 6f72 2061   * Storage for a
+00004d60: 6464 7265 7373 6573 2077 6865 6e20 5369  ddresses when Si
+00004d70: 6e67 6c65 546f 2069 7320 656e 6162 6c65  ngleTo is enable
+00004d80: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
+00004d90: 2040 7661 7220 6172 7261 790a 2020 2020   @var array.    
+00004da0: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
+00004db0: 6420 2453 696e 676c 6554 6f41 7272 6179  d $SingleToArray
+00004dc0: 203d 205b 5d3b 0a0a 2020 2020 2f2a 2a0a   = [];..    /**.
+00004dd0: 2020 2020 202a 2057 6865 7468 6572 2074       * Whether t
+00004de0: 6f20 6765 6e65 7261 7465 2056 4552 5020  o generate VERP 
+00004df0: 6164 6472 6573 7365 7320 6f6e 2073 656e  addresses on sen
+00004e00: 642e 0a20 2020 2020 2a20 4f6e 6c79 2061  d..     * Only a
+00004e10: 7070 6c69 6361 626c 6520 7768 656e 2073  pplicable when s
+00004e20: 656e 6469 6e67 2076 6961 2053 4d54 502e  ending via SMTP.
+00004e30: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00004e40: 7365 6520 6874 7470 733a 2f2f 656e 2e77  see https://en.w
+00004e50: 696b 6970 6564 6961 2e6f 7267 2f77 696b  ikipedia.org/wik
+00004e60: 692f 5661 7269 6162 6c65 5f65 6e76 656c  i/Variable_envel
+00004e70: 6f70 655f 7265 7475 726e 5f70 6174 680a  ope_return_path.
+00004e80: 2020 2020 202a 2040 7365 6520 6874 7470       * @see http
+00004e90: 3a2f 2f77 7777 2e70 6f73 7466 6978 2e6f  ://www.postfix.o
+00004ea0: 7267 2f56 4552 505f 5245 4144 4d45 2e68  rg/VERP_README.h
+00004eb0: 746d 6c20 506f 7374 6669 7820 5645 5250  tml Postfix VERP
+00004ec0: 2069 6e66 6f0a 2020 2020 202a 0a20 2020   info.     *.   
+00004ed0: 2020 2a20 4076 6172 2062 6f6f 6c0a 2020    * @var bool.  
+00004ee0: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+00004ef0: 2024 646f 5f76 6572 7020 3d20 6661 6c73   $do_verp = fals
+00004f00: 653b 0a0a 2020 2020 2f2a 2a0a 2020 2020  e;..    /**.    
+00004f10: 202a 2057 6865 7468 6572 2074 6f20 616c   * Whether to al
+00004f20: 6c6f 7720 7365 6e64 696e 6720 6d65 7373  low sending mess
+00004f30: 6167 6573 2077 6974 6820 616e 2065 6d70  ages with an emp
+00004f40: 7479 2062 6f64 792e 0a20 2020 2020 2a0a  ty body..     *.
+00004f50: 2020 2020 202a 2040 7661 7220 626f 6f6c       * @var bool
+00004f60: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00004f70: 6c69 6320 2441 6c6c 6f77 456d 7074 7920  lic $AllowEmpty 
+00004f80: 3d20 6661 6c73 653b 0a0a 2020 2020 2f2a  = false;..    /*
+00004f90: 2a0a 2020 2020 202a 2044 4b49 4d20 7365  *.     * DKIM se
+00004fa0: 6c65 6374 6f72 2e0a 2020 2020 202a 0a20  lector..     *. 
+00004fb0: 2020 2020 2a20 4076 6172 2073 7472 696e      * @var strin
+00004fc0: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
+00004fd0: 626c 6963 2024 444b 494d 5f73 656c 6563  blic $DKIM_selec
+00004fe0: 746f 7220 3d20 2727 3b0a 0a20 2020 202f  tor = '';..    /
+00004ff0: 2a2a 0a20 2020 2020 2a20 444b 494d 2049  **.     * DKIM I
+00005000: 6465 6e74 6974 792e 0a20 2020 2020 2a20  dentity..     * 
+00005010: 5573 7561 6c6c 7920 7468 6520 656d 6169  Usually the emai
+00005020: 6c20 6164 6472 6573 7320 7573 6564 2061  l address used a
+00005030: 7320 7468 6520 736f 7572 6365 206f 6620  s the source of 
+00005040: 7468 6520 656d 6169 6c2e 0a20 2020 2020  the email..     
+00005050: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
+00005060: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
+00005070: 2070 7562 6c69 6320 2444 4b49 4d5f 6964   public $DKIM_id
+00005080: 656e 7469 7479 203d 2027 273b 0a0a 2020  entity = '';..  
+00005090: 2020 2f2a 2a0a 2020 2020 202a 2044 4b49    /**.     * DKI
+000050a0: 4d20 7061 7373 7068 7261 7365 2e0a 2020  M passphrase..  
+000050b0: 2020 202a 2055 7365 6420 6966 2079 6f75     * Used if you
+000050c0: 7220 6b65 7920 6973 2065 6e63 7279 7074  r key is encrypt
+000050d0: 6564 2e0a 2020 2020 202a 0a20 2020 2020  ed..     *.     
+000050e0: 2a20 4076 6172 2073 7472 696e 670a 2020  * @var string.  
+000050f0: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+00005100: 2024 444b 494d 5f70 6173 7370 6872 6173   $DKIM_passphras
+00005110: 6520 3d20 2727 3b0a 0a20 2020 202f 2a2a  e = '';..    /**
+00005120: 0a20 2020 2020 2a20 444b 494d 2073 6967  .     * DKIM sig
+00005130: 6e69 6e67 2064 6f6d 6169 6e20 6e61 6d65  ning domain name
+00005140: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00005150: 4065 7861 6d70 6c65 2027 6578 616d 706c  @example 'exampl
+00005160: 652e 636f 6d27 0a20 2020 2020 2a0a 2020  e.com'.     *.  
+00005170: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+00005180: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00005190: 6c69 6320 2444 4b49 4d5f 646f 6d61 696e  lic $DKIM_domain
+000051a0: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
+000051b0: 2020 2020 202a 2044 4b49 4d20 436f 7079       * DKIM Copy
+000051c0: 2068 6561 6465 7220 6669 656c 6420 7661   header field va
+000051d0: 6c75 6573 2066 6f72 2064 6961 676e 6f73  lues for diagnos
+000051e0: 7469 6320 7573 652e 0a20 2020 2020 2a0a  tic use..     *.
+000051f0: 2020 2020 202a 2040 7661 7220 626f 6f6c       * @var bool
+00005200: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00005210: 6c69 6320 2444 4b49 4d5f 636f 7079 4865  lic $DKIM_copyHe
+00005220: 6164 6572 4669 656c 6473 203d 2074 7275  aderFields = tru
+00005230: 653b 0a0a 2020 2020 2f2a 2a0a 2020 2020  e;..    /**.    
+00005240: 202a 2044 4b49 4d20 4578 7472 6120 7369   * DKIM Extra si
+00005250: 676e 696e 6720 6865 6164 6572 732e 0a20  gning headers.. 
+00005260: 2020 2020 2a0a 2020 2020 202a 2040 6578      *.     * @ex
+00005270: 616d 706c 6520 5b27 4c69 7374 2d55 6e73  ample ['List-Uns
+00005280: 7562 7363 7269 6265 272c 2027 4c69 7374  ubscribe', 'List
+00005290: 2d48 656c 7027 5d0a 2020 2020 202a 0a20  -Help'].     *. 
+000052a0: 2020 2020 2a20 4076 6172 2061 7272 6179      * @var array
+000052b0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+000052c0: 6c69 6320 2444 4b49 4d5f 6578 7472 6148  lic $DKIM_extraH
+000052d0: 6561 6465 7273 203d 205b 5d3b 0a0a 2020  eaders = [];..  
+000052e0: 2020 2f2a 2a0a 2020 2020 202a 2044 4b49    /**.     * DKI
+000052f0: 4d20 7072 6976 6174 6520 6b65 7920 6669  M private key fi
+00005300: 6c65 2070 6174 682e 0a20 2020 2020 2a0a  le path..     *.
+00005310: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
+00005320: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+00005330: 7562 6c69 6320 2444 4b49 4d5f 7072 6976  ublic $DKIM_priv
+00005340: 6174 6520 3d20 2727 3b0a 0a20 2020 202f  ate = '';..    /
+00005350: 2a2a 0a20 2020 2020 2a20 444b 494d 2070  **.     * DKIM p
+00005360: 7269 7661 7465 206b 6579 2073 7472 696e  rivate key strin
+00005370: 672e 0a20 2020 2020 2a0a 2020 2020 202a  g..     *.     *
+00005380: 2049 6620 7365 742c 2074 616b 6573 2070   If set, takes p
+00005390: 7265 6365 6465 6e63 6520 6f76 6572 2060  recedence over `
+000053a0: 2444 4b49 4d5f 7072 6976 6174 6560 2e0a  $DKIM_private`..
+000053b0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+000053c0: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
+000053d0: 2f0a 2020 2020 7075 626c 6963 2024 444b  /.    public $DK
+000053e0: 494d 5f70 7269 7661 7465 5f73 7472 696e  IM_private_strin
+000053f0: 6720 3d20 2727 3b0a 0a20 2020 202f 2a2a  g = '';..    /**
+00005400: 0a20 2020 2020 2a20 4361 6c6c 6261 636b  .     * Callback
+00005410: 2041 6374 696f 6e20 6675 6e63 7469 6f6e   Action function
+00005420: 206e 616d 652e 0a20 2020 2020 2a0a 2020   name..     *.  
+00005430: 2020 202a 2054 6865 2066 756e 6374 696f     * The functio
+00005440: 6e20 7468 6174 2068 616e 646c 6573 2074  n that handles t
+00005450: 6865 2072 6573 756c 7420 6f66 2074 6865  he result of the
+00005460: 2073 656e 6420 656d 6169 6c20 6163 7469   send email acti
+00005470: 6f6e 2e0a 2020 2020 202a 2049 7420 6973  on..     * It is
+00005480: 2063 616c 6c65 6420 6f75 7420 6279 2073   called out by s
+00005490: 656e 6428 2920 666f 7220 6561 6368 2065  end() for each e
+000054a0: 6d61 696c 2073 656e 742e 0a20 2020 2020  mail sent..     
+000054b0: 2a0a 2020 2020 202a 2056 616c 7565 2063  *.     * Value c
+000054c0: 616e 2062 6520 616e 7920 7068 7020 6361  an be any php ca
+000054d0: 6c6c 6162 6c65 3a20 6874 7470 3a2f 2f77  llable: http://w
+000054e0: 7777 2e70 6870 2e6e 6574 2f69 735f 6361  ww.php.net/is_ca
+000054f0: 6c6c 6162 6c65 0a20 2020 2020 2a0a 2020  llable.     *.  
+00005500: 2020 202a 2050 6172 616d 6574 6572 733a     * Parameters:
+00005510: 0a20 2020 2020 2a20 2020 626f 6f6c 2024  .     *   bool $
+00005520: 7265 7375 6c74 2020 2020 2020 2020 7265  result        re
+00005530: 7375 6c74 206f 6620 7468 6520 7365 6e64  sult of the send
+00005540: 2061 6374 696f 6e0a 2020 2020 202a 2020   action.     *  
+00005550: 2061 7272 6179 2020 2024 746f 2020 2020   array   $to    
+00005560: 2020 2020 2020 2020 656d 6169 6c20 6164          email ad
+00005570: 6472 6573 7365 7320 6f66 2074 6865 2072  dresses of the r
+00005580: 6563 6970 6965 6e74 730a 2020 2020 202a  ecipients.     *
+00005590: 2020 2061 7272 6179 2020 2024 6363 2020     array   $cc  
+000055a0: 2020 2020 2020 2020 2020 6363 2065 6d61            cc ema
+000055b0: 696c 2061 6464 7265 7373 6573 0a20 2020  il addresses.   
+000055c0: 2020 2a20 2020 6172 7261 7920 2020 2462    *   array   $b
+000055d0: 6363 2020 2020 2020 2020 2020 2062 6363  cc           bcc
+000055e0: 2065 6d61 696c 2061 6464 7265 7373 6573   email addresses
+000055f0: 0a20 2020 2020 2a20 2020 7374 7269 6e67  .     *   string
+00005600: 2020 2473 7562 6a65 6374 2020 2020 2020    $subject      
+00005610: 2074 6865 2073 7562 6a65 6374 0a20 2020   the subject.   
+00005620: 2020 2a20 2020 7374 7269 6e67 2020 2462    *   string  $b
+00005630: 6f64 7920 2020 2020 2020 2020 2074 6865  ody          the
+00005640: 2065 6d61 696c 2062 6f64 790a 2020 2020   email body.    
+00005650: 202a 2020 2073 7472 696e 6720 2024 6672   *   string  $fr
+00005660: 6f6d 2020 2020 2020 2020 2020 656d 6169  om          emai
+00005670: 6c20 6164 6472 6573 7320 6f66 2073 656e  l address of sen
+00005680: 6465 720a 2020 2020 202a 2020 2073 7472  der.     *   str
+00005690: 696e 6720 2024 6578 7472 6120 2020 2020  ing  $extra     
+000056a0: 2020 2020 6578 7472 6120 696e 666f 726d      extra inform
+000056b0: 6174 696f 6e20 6f66 2070 6f73 7369 626c  ation of possibl
+000056c0: 6520 7573 650a 2020 2020 202a 2020 2020  e use.     *    
 000056d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056e0: 2020 2020 2020 2020 2020 2273 6d74 705f            "smtp_
-000056f0: 7472 616e 7361 6374 696f 6e5f 6964 2720  transaction_id' 
-00005700: 3d3e 206c 6173 7420 736d 7470 2074 7261  => last smtp tra
-00005710: 6e73 6163 7469 6f6e 2069 640a 2020 2020  nsaction id.    
-00005720: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
-00005730: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00005740: 2020 7075 626c 6963 2024 6163 7469 6f6e    public $action
-00005750: 5f66 756e 6374 696f 6e20 3d20 2727 3b0a  _function = '';.
-00005760: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00005770: 5768 6174 2074 6f20 7075 7420 696e 2074  What to put in t
-00005780: 6865 2058 2d4d 6169 6c65 7220 6865 6164  he X-Mailer head
-00005790: 6572 2e0a 2020 2020 202a 204f 7074 696f  er..     * Optio
-000057a0: 6e73 3a20 416e 2065 6d70 7479 2073 7472  ns: An empty str
-000057b0: 696e 6720 666f 7220 5048 504d 6169 6c65  ing for PHPMaile
-000057c0: 7220 6465 6661 756c 742c 2077 6869 7465  r default, white
-000057d0: 7370 6163 652f 6e75 6c6c 2066 6f72 206e  space/null for n
-000057e0: 6f6e 652c 206f 7220 6120 7374 7269 6e67  one, or a string
-000057f0: 2074 6f20 7573 652e 0a20 2020 2020 2a0a   to use..     *.
-00005800: 2020 2020 202a 2040 7661 7220 7374 7269       * @var stri
-00005810: 6e67 7c6e 756c 6c0a 2020 2020 202a 2f0a  ng|null.     */.
-00005820: 2020 2020 7075 626c 6963 2024 584d 6169      public $XMai
-00005830: 6c65 7220 3d20 2727 3b0a 0a20 2020 202f  ler = '';..    /
-00005840: 2a2a 0a20 2020 2020 2a20 5768 6963 6820  **.     * Which 
-00005850: 7661 6c69 6461 746f 7220 746f 2075 7365  validator to use
-00005860: 2062 7920 6465 6661 756c 7420 7768 656e   by default when
-00005870: 2076 616c 6964 6174 696e 6720 656d 6169   validating emai
-00005880: 6c20 6164 6472 6573 7365 732e 0a20 2020  l addresses..   
-00005890: 2020 2a20 4d61 7920 6265 2061 2063 616c    * May be a cal
-000058a0: 6c61 626c 6520 746f 2069 6e6a 6563 7420  lable to inject 
-000058b0: 796f 7572 206f 776e 2076 616c 6964 6174  your own validat
-000058c0: 6f72 2c20 6275 7420 7468 6572 6520 6172  or, but there ar
-000058d0: 6520 7365 7665 7261 6c20 6275 696c 742d  e several built-
-000058e0: 696e 2076 616c 6964 6174 6f72 732e 0a20  in validators.. 
-000058f0: 2020 2020 2a20 5468 6520 6465 6661 756c      * The defaul
-00005900: 7420 7661 6c69 6461 746f 7220 7573 6573  t validator uses
-00005910: 2050 4850 2773 2046 494c 5445 525f 5641   PHP's FILTER_VA
-00005920: 4c49 4441 5445 5f45 4d41 494c 2066 696c  LIDATE_EMAIL fil
-00005930: 7465 725f 7661 7220 6f70 7469 6f6e 2e0a  ter_var option..
-00005940: 2020 2020 202a 0a20 2020 2020 2a20 4073       *.     * @s
-00005950: 6565 2050 4850 4d61 696c 6572 3a3a 7661  ee PHPMailer::va
-00005960: 6c69 6461 7465 4164 6472 6573 7328 290a  lidateAddress().
-00005970: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-00005980: 6172 2073 7472 696e 677c 6361 6c6c 6162  ar string|callab
-00005990: 6c65 0a20 2020 2020 2a2f 0a20 2020 2070  le.     */.    p
-000059a0: 7562 6c69 6320 7374 6174 6963 2024 7661  ublic static $va
-000059b0: 6c69 6461 746f 7220 3d20 2770 6870 273b  lidator = 'php';
-000059c0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-000059d0: 2041 6e20 696e 7374 616e 6365 206f 6620   An instance of 
-000059e0: 7468 6520 534d 5450 2073 656e 6465 7220  the SMTP sender 
-000059f0: 636c 6173 732e 0a20 2020 2020 2a0a 2020  class..     *.  
-00005a00: 2020 202a 2040 7661 7220 534d 5450 0a20     * @var SMTP. 
-00005a10: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-00005a20: 6374 6564 2024 736d 7470 3b0a 0a20 2020  cted $smtp;..   
-00005a30: 202f 2a2a 0a20 2020 2020 2a20 5468 6520   /**.     * The 
-00005a40: 6172 7261 7920 6f66 2027 746f 2720 6e61  array of 'to' na
-00005a50: 6d65 7320 616e 6420 6164 6472 6573 7365  mes and addresse
-00005a60: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
-00005a70: 2040 7661 7220 6172 7261 790a 2020 2020   @var array.    
-00005a80: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
-00005a90: 6420 2474 6f20 3d20 5b5d 3b0a 0a20 2020  d $to = [];..   
-00005aa0: 202f 2a2a 0a20 2020 2020 2a20 5468 6520   /**.     * The 
-00005ab0: 6172 7261 7920 6f66 2027 6363 2720 6e61  array of 'cc' na
-00005ac0: 6d65 7320 616e 6420 6164 6472 6573 7365  mes and addresse
-00005ad0: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
-00005ae0: 2040 7661 7220 6172 7261 790a 2020 2020   @var array.    
-00005af0: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
-00005b00: 6420 2463 6320 3d20 5b5d 3b0a 0a20 2020  d $cc = [];..   
-00005b10: 202f 2a2a 0a20 2020 2020 2a20 5468 6520   /**.     * The 
-00005b20: 6172 7261 7920 6f66 2027 6263 6327 206e  array of 'bcc' n
-00005b30: 616d 6573 2061 6e64 2061 6464 7265 7373  ames and address
-00005b40: 6573 2e0a 2020 2020 202a 0a20 2020 2020  es..     *.     
-00005b50: 2a20 4076 6172 2061 7272 6179 0a20 2020  * @var array.   
-00005b60: 2020 2a2f 0a20 2020 2070 726f 7465 6374    */.    protect
-00005b70: 6564 2024 6263 6320 3d20 5b5d 3b0a 0a20  ed $bcc = [];.. 
-00005b80: 2020 202f 2a2a 0a20 2020 2020 2a20 5468     /**.     * Th
-00005b90: 6520 6172 7261 7920 6f66 2072 6570 6c79  e array of reply
-00005ba0: 2d74 6f20 6e61 6d65 7320 616e 6420 6164  -to names and ad
-00005bb0: 6472 6573 7365 732e 0a20 2020 2020 2a0a  dresses..     *.
-00005bc0: 2020 2020 202a 2040 7661 7220 6172 7261       * @var arra
-00005bd0: 790a 2020 2020 202a 2f0a 2020 2020 7072  y.     */.    pr
-00005be0: 6f74 6563 7465 6420 2452 6570 6c79 546f  otected $ReplyTo
-00005bf0: 203d 205b 5d3b 0a0a 2020 2020 2f2a 2a0a   = [];..    /**.
-00005c00: 2020 2020 202a 2041 6e20 6172 7261 7920       * An array 
-00005c10: 6f66 2061 6c6c 206b 696e 6473 206f 6620  of all kinds of 
-00005c20: 6164 6472 6573 7365 732e 0a20 2020 2020  addresses..     
-00005c30: 2a20 496e 636c 7564 6573 2061 6c6c 206f  * Includes all o
-00005c40: 6620 2474 6f2c 2024 6363 2c20 2462 6363  f $to, $cc, $bcc
-00005c50: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00005c60: 4073 6565 2050 4850 4d61 696c 6572 3a3a  @see PHPMailer::
-00005c70: 2474 6f0a 2020 2020 202a 2040 7365 6520  $to.     * @see 
-00005c80: 5048 504d 6169 6c65 723a 3a24 6363 0a20  PHPMailer::$cc. 
-00005c90: 2020 2020 2a20 4073 6565 2050 4850 4d61      * @see PHPMa
-00005ca0: 696c 6572 3a3a 2462 6363 0a20 2020 2020  iler::$bcc.     
-00005cb0: 2a0a 2020 2020 202a 2040 7661 7220 6172  *.     * @var ar
-00005cc0: 7261 790a 2020 2020 202a 2f0a 2020 2020  ray.     */.    
-00005cd0: 7072 6f74 6563 7465 6420 2461 6c6c 5f72  protected $all_r
-00005ce0: 6563 6970 6965 6e74 7320 3d20 5b5d 3b0a  ecipients = [];.
-00005cf0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00005d00: 416e 2061 7272 6179 206f 6620 6e61 6d65  An array of name
-00005d10: 7320 616e 6420 6164 6472 6573 7365 7320  s and addresses 
-00005d20: 7175 6575 6564 2066 6f72 2076 616c 6964  queued for valid
-00005d30: 6174 696f 6e2e 0a20 2020 2020 2a20 496e  ation..     * In
-00005d40: 2073 656e 6428 292c 2076 616c 6964 2061   send(), valid a
-00005d50: 6e64 206e 6f6e 2064 7570 6c69 6361 7465  nd non duplicate
-00005d60: 2065 6e74 7269 6573 2061 7265 206d 6f76   entries are mov
-00005d70: 6564 2074 6f20 2461 6c6c 5f72 6563 6970  ed to $all_recip
-00005d80: 6965 6e74 730a 2020 2020 202a 2061 6e64  ients.     * and
-00005d90: 206f 6e65 206f 6620 2474 6f2c 2024 6363   one of $to, $cc
-00005da0: 2c20 6f72 2024 6263 632e 0a20 2020 2020  , or $bcc..     
-00005db0: 2a20 5468 6973 2061 7272 6179 2069 7320  * This array is 
-00005dc0: 7573 6564 206f 6e6c 7920 666f 7220 6164  used only for ad
-00005dd0: 6472 6573 7365 7320 7769 7468 2049 444e  dresses with IDN
-00005de0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00005df0: 4073 6565 2050 4850 4d61 696c 6572 3a3a  @see PHPMailer::
-00005e00: 2474 6f0a 2020 2020 202a 2040 7365 6520  $to.     * @see 
-00005e10: 5048 504d 6169 6c65 723a 3a24 6363 0a20  PHPMailer::$cc. 
-00005e20: 2020 2020 2a20 4073 6565 2050 4850 4d61      * @see PHPMa
-00005e30: 696c 6572 3a3a 2462 6363 0a20 2020 2020  iler::$bcc.     
-00005e40: 2a20 4073 6565 2050 4850 4d61 696c 6572  * @see PHPMailer
-00005e50: 3a3a 2461 6c6c 5f72 6563 6970 6965 6e74  ::$all_recipient
-00005e60: 730a 2020 2020 202a 0a20 2020 2020 2a20  s.     *.     * 
-00005e70: 4076 6172 2061 7272 6179 0a20 2020 2020  @var array.     
-00005e80: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
-00005e90: 2024 5265 6369 7069 656e 7473 5175 6575   $RecipientsQueu
-00005ea0: 6520 3d20 5b5d 3b0a 0a20 2020 202f 2a2a  e = [];..    /**
-00005eb0: 0a20 2020 2020 2a20 416e 2061 7272 6179  .     * An array
-00005ec0: 206f 6620 7265 706c 792d 746f 206e 616d   of reply-to nam
-00005ed0: 6573 2061 6e64 2061 6464 7265 7373 6573  es and addresses
-00005ee0: 2071 7565 7565 6420 666f 7220 7661 6c69   queued for vali
-00005ef0: 6461 7469 6f6e 2e0a 2020 2020 202a 2049  dation..     * I
-00005f00: 6e20 7365 6e64 2829 2c20 7661 6c69 6420  n send(), valid 
-00005f10: 616e 6420 6e6f 6e20 6475 706c 6963 6174  and non duplicat
-00005f20: 6520 656e 7472 6965 7320 6172 6520 6d6f  e entries are mo
-00005f30: 7665 6420 746f 2024 5265 706c 7954 6f2e  ved to $ReplyTo.
-00005f40: 0a20 2020 2020 2a20 5468 6973 2061 7272  .     * This arr
-00005f50: 6179 2069 7320 7573 6564 206f 6e6c 7920  ay is used only 
-00005f60: 666f 7220 6164 6472 6573 7365 7320 7769  for addresses wi
-00005f70: 7468 2049 444e 2e0a 2020 2020 202a 0a20  th IDN..     *. 
-00005f80: 2020 2020 2a20 4073 6565 2050 4850 4d61      * @see PHPMa
-00005f90: 696c 6572 3a3a 2452 6570 6c79 546f 0a20  iler::$ReplyTo. 
-00005fa0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-00005fb0: 7220 6172 7261 790a 2020 2020 202a 2f0a  r array.     */.
-00005fc0: 2020 2020 7072 6f74 6563 7465 6420 2452      protected $R
-00005fd0: 6570 6c79 546f 5175 6575 6520 3d20 5b5d  eplyToQueue = []
-00005fe0: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
-00005ff0: 2a20 5468 6520 6172 7261 7920 6f66 2061  * The array of a
-00006000: 7474 6163 686d 656e 7473 2e0a 2020 2020  ttachments..    
-00006010: 202a 0a20 2020 2020 2a20 4076 6172 2061   *.     * @var a
-00006020: 7272 6179 0a20 2020 2020 2a2f 0a20 2020  rray.     */.   
-00006030: 2070 726f 7465 6374 6564 2024 6174 7461   protected $atta
-00006040: 6368 6d65 6e74 203d 205b 5d3b 0a0a 2020  chment = [];..  
-00006050: 2020 2f2a 2a0a 2020 2020 202a 2054 6865    /**.     * The
-00006060: 2061 7272 6179 206f 6620 6375 7374 6f6d   array of custom
-00006070: 2068 6561 6465 7273 2e0a 2020 2020 202a   headers..     *
-00006080: 0a20 2020 2020 2a20 4076 6172 2061 7272  .     * @var arr
-00006090: 6179 0a20 2020 2020 2a2f 0a20 2020 2070  ay.     */.    p
-000060a0: 726f 7465 6374 6564 2024 4375 7374 6f6d  rotected $Custom
-000060b0: 4865 6164 6572 203d 205b 5d3b 0a0a 2020  Header = [];..  
-000060c0: 2020 2f2a 2a0a 2020 2020 202a 2054 6865    /**.     * The
-000060d0: 206d 6f73 7420 7265 6365 6e74 204d 6573   most recent Mes
-000060e0: 7361 6765 2d49 4420 2869 6e63 6c75 6469  sage-ID (includi
-000060f0: 6e67 2061 6e67 756c 6172 2062 7261 636b  ng angular brack
-00006100: 6574 7329 2e0a 2020 2020 202a 0a20 2020  ets)..     *.   
-00006110: 2020 2a20 4076 6172 2073 7472 696e 670a    * @var string.
-00006120: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
-00006130: 6563 7465 6420 246c 6173 744d 6573 7361  ected $lastMessa
-00006140: 6765 4944 203d 2027 273b 0a0a 2020 2020  geID = '';..    
-00006150: 2f2a 2a0a 2020 2020 202a 2054 6865 206d  /**.     * The m
-00006160: 6573 7361 6765 2773 204d 494d 4520 7479  essage's MIME ty
-00006170: 7065 2e0a 2020 2020 202a 0a20 2020 2020  pe..     *.     
-00006180: 2a20 4076 6172 2073 7472 696e 670a 2020  * @var string.  
-00006190: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
-000061a0: 7465 6420 246d 6573 7361 6765 5f74 7970  ted $message_typ
-000061b0: 6520 3d20 2727 3b0a 0a20 2020 202f 2a2a  e = '';..    /**
-000061c0: 0a20 2020 2020 2a20 5468 6520 6172 7261  .     * The arra
-000061d0: 7920 6f66 204d 494d 4520 626f 756e 6461  y of MIME bounda
-000061e0: 7279 2073 7472 696e 6773 2e0a 2020 2020  ry strings..    
-000061f0: 202a 0a20 2020 2020 2a20 4076 6172 2061   *.     * @var a
-00006200: 7272 6179 0a20 2020 2020 2a2f 0a20 2020  rray.     */.   
-00006210: 2070 726f 7465 6374 6564 2024 626f 756e   protected $boun
-00006220: 6461 7279 203d 205b 5d3b 0a0a 2020 2020  dary = [];..    
-00006230: 2f2a 2a0a 2020 2020 202a 2054 6865 2061  /**.     * The a
-00006240: 7272 6179 206f 6620 6176 6169 6c61 626c  rray of availabl
-00006250: 6520 7465 7874 2073 7472 696e 6773 2066  e text strings f
-00006260: 6f72 2074 6865 2063 7572 7265 6e74 206c  or the current l
-00006270: 616e 6775 6167 652e 0a20 2020 2020 2a0a  anguage..     *.
-00006280: 2020 2020 202a 2040 7661 7220 6172 7261       * @var arra
-00006290: 790a 2020 2020 202a 2f0a 2020 2020 7072  y.     */.    pr
-000062a0: 6f74 6563 7465 6420 246c 616e 6775 6167  otected $languag
-000062b0: 6520 3d20 5b5d 3b0a 0a20 2020 202f 2a2a  e = [];..    /**
-000062c0: 0a20 2020 2020 2a20 5468 6520 6e75 6d62  .     * The numb
-000062d0: 6572 206f 6620 6572 726f 7273 2065 6e63  er of errors enc
-000062e0: 6f75 6e74 6572 6564 2e0a 2020 2020 202a  ountered..     *
-000062f0: 0a20 2020 2020 2a20 4076 6172 2069 6e74  .     * @var int
-00006300: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
-00006310: 7465 6374 6564 2024 6572 726f 725f 636f  tected $error_co
-00006320: 756e 7420 3d20 303b 0a0a 2020 2020 2f2a  unt = 0;..    /*
-00006330: 2a0a 2020 2020 202a 2054 6865 2053 2f4d  *.     * The S/M
-00006340: 494d 4520 6365 7274 6966 6963 6174 6520  IME certificate 
-00006350: 6669 6c65 2070 6174 682e 0a20 2020 2020  file path..     
-00006360: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
-00006370: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
-00006380: 2070 726f 7465 6374 6564 2024 7369 676e   protected $sign
-00006390: 5f63 6572 745f 6669 6c65 203d 2027 273b  _cert_file = '';
-000063a0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-000063b0: 2054 6865 2053 2f4d 494d 4520 6b65 7920   The S/MIME key 
-000063c0: 6669 6c65 2070 6174 682e 0a20 2020 2020  file path..     
-000063d0: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
-000063e0: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
-000063f0: 2070 726f 7465 6374 6564 2024 7369 676e   protected $sign
-00006400: 5f6b 6579 5f66 696c 6520 3d20 2727 3b0a  _key_file = '';.
-00006410: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00006420: 5468 6520 6f70 7469 6f6e 616c 2053 2f4d  The optional S/M
-00006430: 494d 4520 6578 7472 6120 6365 7274 6966  IME extra certif
-00006440: 6963 6174 6573 2028 2243 4120 4368 6169  icates ("CA Chai
-00006450: 6e22 2920 6669 6c65 2070 6174 682e 0a20  n") file path.. 
-00006460: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-00006470: 7220 7374 7269 6e67 0a20 2020 2020 2a2f  r string.     */
-00006480: 0a20 2020 2070 726f 7465 6374 6564 2024  .    protected $
-00006490: 7369 676e 5f65 7874 7261 6365 7274 735f  sign_extracerts_
-000064a0: 6669 6c65 203d 2027 273b 0a0a 2020 2020  file = '';..    
-000064b0: 2f2a 2a0a 2020 2020 202a 2054 6865 2053  /**.     * The S
-000064c0: 2f4d 494d 4520 7061 7373 776f 7264 2066  /MIME password f
-000064d0: 6f72 2074 6865 206b 6579 2e0a 2020 2020  or the key..    
-000064e0: 202a 2055 7365 6420 6f6e 6c79 2069 6620   * Used only if 
-000064f0: 7468 6520 6b65 7920 6973 2065 6e63 7279  the key is encry
-00006500: 7074 6564 2e0a 2020 2020 202a 0a20 2020  pted..     *.   
-00006510: 2020 2a20 4076 6172 2073 7472 696e 670a    * @var string.
-00006520: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
-00006530: 6563 7465 6420 2473 6967 6e5f 6b65 795f  ected $sign_key_
-00006540: 7061 7373 203d 2027 273b 0a0a 2020 2020  pass = '';..    
-00006550: 2f2a 2a0a 2020 2020 202a 2057 6865 7468  /**.     * Wheth
-00006560: 6572 2074 6f20 7468 726f 7720 6578 6365  er to throw exce
-00006570: 7074 696f 6e73 2066 6f72 2065 7272 6f72  ptions for error
-00006580: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
-00006590: 2040 7661 7220 626f 6f6c 0a20 2020 2020   @var bool.     
-000065a0: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
-000065b0: 2024 6578 6365 7074 696f 6e73 203d 2066   $exceptions = f
-000065c0: 616c 7365 3b0a 0a20 2020 202f 2a2a 0a20  alse;..    /**. 
-000065d0: 2020 2020 2a20 556e 6971 7565 2049 4420      * Unique ID 
-000065e0: 7573 6564 2066 6f72 206d 6573 7361 6765  used for message
-000065f0: 2049 4420 616e 6420 626f 756e 6461 7269   ID and boundari
-00006600: 6573 2e0a 2020 2020 202a 0a20 2020 2020  es..     *.     
-00006610: 2a20 4076 6172 2073 7472 696e 670a 2020  * @var string.  
-00006620: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
-00006630: 7465 6420 2475 6e69 7175 6569 6420 3d20  ted $uniqueid = 
-00006640: 2727 3b0a 0a20 2020 202f 2a2a 0a20 2020  '';..    /**.   
-00006650: 2020 2a20 5468 6520 5048 504d 6169 6c65    * The PHPMaile
-00006660: 7220 5665 7273 696f 6e20 6e75 6d62 6572  r Version number
-00006670: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00006680: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-00006690: 202a 2f0a 2020 2020 636f 6e73 7420 5645   */.    const VE
-000066a0: 5253 494f 4e20 3d20 2736 2e36 2e34 273b  RSION = '6.6.4';
-000066b0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-000066c0: 2045 7272 6f72 2073 6576 6572 6974 793a   Error severity:
-000066d0: 206d 6573 7361 6765 206f 6e6c 792c 2063   message only, c
-000066e0: 6f6e 7469 6e75 6520 7072 6f63 6573 7369  ontinue processi
-000066f0: 6e67 2e0a 2020 2020 202a 0a20 2020 2020  ng..     *.     
-00006700: 2a20 4076 6172 2069 6e74 0a20 2020 2020  * @var int.     
-00006710: 2a2f 0a20 2020 2063 6f6e 7374 2053 544f  */.    const STO
-00006720: 505f 4d45 5353 4147 4520 3d20 303b 0a0a  P_MESSAGE = 0;..
-00006730: 2020 2020 2f2a 2a0a 2020 2020 202a 2045      /**.     * E
-00006740: 7272 6f72 2073 6576 6572 6974 793a 206d  rror severity: m
-00006750: 6573 7361 6765 2c20 6c69 6b65 6c79 206f  essage, likely o
-00006760: 6b20 746f 2063 6f6e 7469 6e75 6520 7072  k to continue pr
-00006770: 6f63 6573 7369 6e67 2e0a 2020 2020 202a  ocessing..     *
-00006780: 0a20 2020 2020 2a20 4076 6172 2069 6e74  .     * @var int
-00006790: 0a20 2020 2020 2a2f 0a20 2020 2063 6f6e  .     */.    con
-000067a0: 7374 2053 544f 505f 434f 4e54 494e 5545  st STOP_CONTINUE
-000067b0: 203d 2031 3b0a 0a20 2020 202f 2a2a 0a20   = 1;..    /**. 
-000067c0: 2020 2020 2a20 4572 726f 7220 7365 7665      * Error seve
-000067d0: 7269 7479 3a20 6d65 7373 6167 652c 2070  rity: message, p
-000067e0: 6c75 7320 6675 6c6c 2073 746f 702c 2063  lus full stop, c
-000067f0: 7269 7469 6361 6c20 6572 726f 7220 7265  ritical error re
-00006800: 6163 6865 642e 0a20 2020 2020 2a0a 2020  ached..     *.  
-00006810: 2020 202a 2040 7661 7220 696e 740a 2020     * @var int.  
-00006820: 2020 202a 2f0a 2020 2020 636f 6e73 7420     */.    const 
-00006830: 5354 4f50 5f43 5249 5449 4341 4c20 3d20  STOP_CRITICAL = 
-00006840: 323b 0a0a 2020 2020 2f2a 2a0a 2020 2020  2;..    /**.    
-00006850: 202a 2054 6865 2053 4d54 5020 7374 616e   * The SMTP stan
-00006860: 6461 7264 2043 524c 4620 6c69 6e65 2062  dard CRLF line b
-00006870: 7265 616b 2e0a 2020 2020 202a 2049 6620  reak..     * If 
-00006880: 796f 7520 7761 6e74 2074 6f20 6368 616e  you want to chan
-00006890: 6765 206c 696e 6520 6272 6561 6b20 666f  ge line break fo
-000068a0: 726d 6174 2c20 6368 616e 6765 2073 7461  rmat, change sta
-000068b0: 7469 633a 3a24 4c45 2c20 6e6f 7420 7468  tic::$LE, not th
-000068c0: 6973 2e0a 2020 2020 202a 2f0a 2020 2020  is..     */.    
-000068d0: 636f 6e73 7420 4352 4c46 203d 2022 5c72  const CRLF = "\r
-000068e0: 5c6e 223b 0a0a 2020 2020 2f2a 2a0a 2020  \n";..    /**.  
-000068f0: 2020 202a 2022 466f 6c64 696e 6720 5768     * "Folding Wh
-00006900: 6974 6520 5370 6163 6522 2061 2077 6869  ite Space" a whi
-00006910: 7465 2073 7061 6365 2073 7472 696e 6720  te space string 
-00006920: 7573 6564 2066 6f72 206c 696e 6520 666f  used for line fo
-00006930: 6c64 696e 672e 0a20 2020 2020 2a2f 0a20  lding..     */. 
-00006940: 2020 2063 6f6e 7374 2046 5753 203d 2027     const FWS = '
-00006950: 2027 3b0a 0a20 2020 202f 2a2a 0a20 2020   ';..    /**.   
-00006960: 2020 2a20 534d 5450 2052 4643 2073 7461    * SMTP RFC sta
-00006970: 6e64 6172 6420 6c69 6e65 2065 6e64 696e  ndard line endin
-00006980: 673b 2043 6172 7269 6167 6520 5265 7475  g; Carriage Retu
-00006990: 726e 2c20 4c69 6e65 2046 6565 642e 0a20  rn, Line Feed.. 
-000069a0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-000069b0: 7220 7374 7269 6e67 0a20 2020 2020 2a2f  r string.     */
-000069c0: 0a20 2020 2070 726f 7465 6374 6564 2073  .    protected s
-000069d0: 7461 7469 6320 244c 4520 3d20 7365 6c66  tatic $LE = self
-000069e0: 3a3a 4352 4c46 3b0a 0a20 2020 202f 2a2a  ::CRLF;..    /**
-000069f0: 0a20 2020 2020 2a20 5468 6520 6d61 7869  .     * The maxi
-00006a00: 6d75 6d20 6c69 6e65 206c 656e 6774 6820  mum line length 
-00006a10: 7375 7070 6f72 7465 6420 6279 206d 6169  supported by mai
-00006a20: 6c28 292e 0a20 2020 2020 2a0a 2020 2020  l()..     *.    
-00006a30: 202a 2042 6163 6b67 726f 756e 643a 206d   * Background: m
-00006a40: 6169 6c28 2920 7769 6c6c 2073 6f6d 6574  ail() will somet
-00006a50: 696d 6573 2063 6f72 7275 7074 206d 6573  imes corrupt mes
-00006a60: 7361 6765 730a 2020 2020 202a 2077 6974  sages.     * wit
-00006a70: 6820 6865 6164 6572 7320 6865 6164 6572  h headers header
-00006a80: 7320 6c6f 6e67 6572 2074 6861 6e20 3635  s longer than 65
-00006a90: 2063 6861 7273 2c20 7365 6520 2338 3138   chars, see #818
-00006aa0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00006ab0: 4076 6172 2069 6e74 0a20 2020 2020 2a2f  @var int.     */
-00006ac0: 0a20 2020 2063 6f6e 7374 204d 4149 4c5f  .    const MAIL_
-00006ad0: 4d41 585f 4c49 4e45 5f4c 454e 4754 4820  MAX_LINE_LENGTH 
-00006ae0: 3d20 3633 3b0a 0a20 2020 202f 2a2a 0a20  = 63;..    /**. 
-00006af0: 2020 2020 2a20 5468 6520 6d61 7869 6d75      * The maximu
-00006b00: 6d20 6c69 6e65 206c 656e 6774 6820 616c  m line length al
-00006b10: 6c6f 7765 6420 6279 2052 4643 2032 3832  lowed by RFC 282
-00006b20: 3220 7365 6374 696f 6e20 322e 312e 312e  2 section 2.1.1.
-00006b30: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00006b40: 7661 7220 696e 740a 2020 2020 202a 2f0a  var int.     */.
-00006b50: 2020 2020 636f 6e73 7420 4d41 585f 4c49      const MAX_LI
-00006b60: 4e45 5f4c 454e 4754 4820 3d20 3939 383b  NE_LENGTH = 998;
-00006b70: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00006b80: 2054 6865 206c 6f77 6572 206d 6178 696d   The lower maxim
-00006b90: 756d 206c 696e 6520 6c65 6e67 7468 2061  um line length a
-00006ba0: 6c6c 6f77 6564 2062 7920 5246 4320 3238  llowed by RFC 28
-00006bb0: 3232 2073 6563 7469 6f6e 2032 2e31 2e31  22 section 2.1.1
-00006bc0: 2e0a 2020 2020 202a 2054 6869 7320 6c65  ..     * This le
-00006bd0: 6e67 7468 2064 6f65 7320 4e4f 5420 696e  ngth does NOT in
-00006be0: 636c 7564 6520 7468 6520 6c69 6e65 2062  clude the line b
-00006bf0: 7265 616b 0a20 2020 2020 2a20 3736 206d  reak.     * 76 m
-00006c00: 6561 6e73 2074 6861 7420 6c69 6e65 7320  eans that lines 
-00006c10: 7769 6c6c 2062 6520 3737 206f 7220 3738  will be 77 or 78
-00006c20: 2063 6861 7273 2064 6570 656e 6469 6e67   chars depending
-00006c30: 206f 6e20 7768 6574 6865 720a 2020 2020   on whether.    
-00006c40: 202a 2074 6865 206c 696e 6520 6272 6561   * the line brea
-00006c50: 6b20 666f 726d 6174 2069 7320 4c46 206f  k format is LF o
-00006c60: 7220 4352 4c46 3b20 626f 7468 2061 7265  r CRLF; both are
-00006c70: 2076 616c 6964 2e0a 2020 2020 202a 0a20   valid..     *. 
-00006c80: 2020 2020 2a20 4076 6172 2069 6e74 0a20      * @var int. 
-00006c90: 2020 2020 2a2f 0a20 2020 2063 6f6e 7374      */.    const
-00006ca0: 2053 5444 5f4c 494e 455f 4c45 4e47 5448   STD_LINE_LENGTH
-00006cb0: 203d 2037 363b 0a0a 2020 2020 2f2a 2a0a   = 76;..    /**.
-00006cc0: 2020 2020 202a 2043 6f6e 7374 7275 6374       * Construct
-00006cd0: 6f72 2e0a 2020 2020 202a 0a20 2020 2020  or..     *.     
-00006ce0: 2a20 4070 6172 616d 2062 6f6f 6c20 2465  * @param bool $e
-00006cf0: 7863 6570 7469 6f6e 7320 5368 6f75 6c64  xceptions Should
-00006d00: 2077 6520 7468 726f 7720 6578 7465 726e   we throw extern
-00006d10: 616c 2065 7863 6570 7469 6f6e 733f 0a20  al exceptions?. 
-00006d20: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00006d30: 6320 6675 6e63 7469 6f6e 205f 5f63 6f6e  c function __con
-00006d40: 7374 7275 6374 2824 6578 6365 7074 696f  struct($exceptio
-00006d50: 6e73 203d 206e 756c 6c29 0a20 2020 207b  ns = null).    {
-00006d60: 0a20 2020 2020 2020 2069 6620 286e 756c  .        if (nul
-00006d70: 6c20 213d 3d20 2465 7863 6570 7469 6f6e  l !== $exception
-00006d80: 7329 207b 0a20 2020 2020 2020 2020 2020  s) {.           
-00006d90: 2024 7468 6973 2d3e 6578 6365 7074 696f   $this->exceptio
-00006da0: 6e73 203d 2028 626f 6f6c 2920 2465 7863  ns = (bool) $exc
-00006db0: 6570 7469 6f6e 733b 0a20 2020 2020 2020  eptions;.       
-00006dc0: 207d 0a20 2020 2020 2020 202f 2f50 6963   }.        //Pic
-00006dd0: 6b20 616e 2061 7070 726f 7072 6961 7465  k an appropriate
-00006de0: 2064 6562 7567 206f 7574 7075 7420 666f   debug output fo
-00006df0: 726d 6174 2061 7574 6f6d 6174 6963 616c  rmat automatical
-00006e00: 6c79 0a20 2020 2020 2020 2024 7468 6973  ly.        $this
-00006e10: 2d3e 4465 6275 676f 7574 7075 7420 3d20  ->Debugoutput = 
-00006e20: 2873 7472 706f 7328 5048 505f 5341 5049  (strpos(PHP_SAPI
-00006e30: 2c20 2763 6c69 2729 2021 3d3d 2066 616c  , 'cli') !== fal
-00006e40: 7365 203f 2027 6563 686f 2720 3a20 2768  se ? 'echo' : 'h
-00006e50: 746d 6c27 293b 0a20 2020 207d 0a0a 2020  tml');.    }..  
-00006e60: 2020 2f2a 2a0a 2020 2020 202a 2044 6573    /**.     * Des
-00006e70: 7472 7563 746f 722e 0a20 2020 2020 2a2f  tructor..     */
-00006e80: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00006e90: 7469 6f6e 205f 5f64 6573 7472 7563 7428  tion __destruct(
-00006ea0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00006eb0: 2f2f 436c 6f73 6520 616e 7920 6f70 656e  //Close any open
-00006ec0: 2053 4d54 5020 636f 6e6e 6563 7469 6f6e   SMTP connection
-00006ed0: 206e 6963 656c 790a 2020 2020 2020 2020   nicely.        
-00006ee0: 2474 6869 732d 3e73 6d74 7043 6c6f 7365  $this->smtpClose
-00006ef0: 2829 3b0a 2020 2020 7d0a 0a20 2020 202f  ();.    }..    /
-00006f00: 2a2a 0a20 2020 2020 2a20 4361 6c6c 206d  **.     * Call m
-00006f10: 6169 6c28 2920 696e 2061 2073 6166 655f  ail() in a safe_
-00006f20: 6d6f 6465 2d61 7761 7265 2066 6173 6869  mode-aware fashi
-00006f30: 6f6e 2e0a 2020 2020 202a 2041 6c73 6f2c  on..     * Also,
-00006f40: 2075 6e6c 6573 7320 7365 6e64 6d61 696c   unless sendmail
-00006f50: 5f70 6174 6820 706f 696e 7473 2074 6f20  _path points to 
-00006f60: 7365 6e64 6d61 696c 2028 6f72 2073 6f6d  sendmail (or som
-00006f70: 6574 6869 6e67 2074 6861 740a 2020 2020  ething that.    
-00006f80: 202a 2063 6c61 696d 7320 746f 2062 6520   * claims to be 
-00006f90: 7365 6e64 6d61 696c 292c 2064 6f6e 2774  sendmail), don't
-00006fa0: 2070 6173 7320 7061 7261 6d73 2028 6e6f   pass params (no
-00006fb0: 7420 6120 7065 7266 6563 7420 6669 782c  t a perfect fix,
-00006fc0: 0a20 2020 2020 2a20 6275 7420 6974 2077  .     * but it w
-00006fd0: 696c 6c20 646f 292e 0a20 2020 2020 2a0a  ill do)..     *.
-00006fe0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-00006ff0: 7269 6e67 2020 2020 2020 2474 6f20 2020  ring      $to   
-00007000: 2020 2054 6f0a 2020 2020 202a 2040 7061     To.     * @pa
-00007010: 7261 6d20 7374 7269 6e67 2020 2020 2020  ram string      
-00007020: 2473 7562 6a65 6374 2053 7562 6a65 6374  $subject Subject
-00007030: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00007040: 7472 696e 6720 2020 2020 2024 626f 6479  tring      $body
-00007050: 2020 2020 4d65 7373 6167 6520 426f 6479      Message Body
-00007060: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00007070: 7472 696e 6720 2020 2020 2024 6865 6164  tring      $head
-00007080: 6572 2020 4164 6469 7469 6f6e 616c 2048  er  Additional H
-00007090: 6561 6465 7228 7329 0a20 2020 2020 2a20  eader(s).     * 
-000070a0: 4070 6172 616d 2073 7472 696e 677c 6e75  @param string|nu
-000070b0: 6c6c 2024 7061 7261 6d73 2020 5061 7261  ll $params  Para
-000070c0: 6d73 0a20 2020 2020 2a0a 2020 2020 202a  ms.     *.     *
-000070d0: 2040 7265 7475 726e 2062 6f6f 6c0a 2020   @return bool.  
-000070e0: 2020 202a 2f0a 2020 2020 7072 6976 6174     */.    privat
-000070f0: 6520 6675 6e63 7469 6f6e 206d 6169 6c50  e function mailP
-00007100: 6173 7374 6872 7528 2474 6f2c 2024 7375  assthru($to, $su
-00007110: 626a 6563 742c 2024 626f 6479 2c20 2468  bject, $body, $h
-00007120: 6561 6465 722c 2024 7061 7261 6d73 290a  eader, $params).
-00007130: 2020 2020 7b0a 2020 2020 2020 2020 2f2f      {.        //
-00007140: 4368 6563 6b20 6f76 6572 6c6f 6164 696e  Check overloadin
-00007150: 6720 6f66 206d 6169 6c20 6675 6e63 7469  g of mail functi
-00007160: 6f6e 2074 6f20 6176 6f69 6420 646f 7562  on to avoid doub
-00007170: 6c65 2d65 6e63 6f64 696e 670a 2020 2020  le-encoding.    
-00007180: 2020 2020 6966 2028 696e 695f 6765 7428      if (ini_get(
-00007190: 276d 6273 7472 696e 672e 6675 6e63 5f6f  'mbstring.func_o
-000071a0: 7665 726c 6f61 6427 2920 2620 3129 207b  verload') & 1) {
-000071b0: 0a20 2020 2020 2020 2020 2020 2024 7375  .            $su
-000071c0: 626a 6563 7420 3d20 2474 6869 732d 3e73  bject = $this->s
-000071d0: 6563 7572 6548 6561 6465 7228 2473 7562  ecureHeader($sub
-000071e0: 6a65 6374 293b 0a20 2020 2020 2020 207d  ject);.        }
-000071f0: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
-00007200: 2020 2020 2473 7562 6a65 6374 203d 2024      $subject = $
-00007210: 7468 6973 2d3e 656e 636f 6465 4865 6164  this->encodeHead
-00007220: 6572 2824 7468 6973 2d3e 7365 6375 7265  er($this->secure
-00007230: 4865 6164 6572 2824 7375 626a 6563 7429  Header($subject)
-00007240: 293b 0a20 2020 2020 2020 207d 0a20 2020  );.        }.   
-00007250: 2020 2020 202f 2f43 616c 6c69 6e67 206d       //Calling m
-00007260: 6169 6c28 2920 7769 7468 206e 756c 6c20  ail() with null 
-00007270: 7061 7261 6d73 2062 7265 616b 730a 2020  params breaks.  
-00007280: 2020 2020 2020 2474 6869 732d 3e65 6465        $this->ede
-00007290: 6275 6728 2753 656e 6469 6e67 2077 6974  bug('Sending wit
-000072a0: 6820 6d61 696c 2829 2729 3b0a 2020 2020  h mail()');.    
-000072b0: 2020 2020 2474 6869 732d 3e65 6465 6275      $this->edebu
-000072c0: 6728 2753 656e 646d 6169 6c20 7061 7468  g('Sendmail path
-000072d0: 3a20 2720 2e20 696e 695f 6765 7428 2773  : ' . ini_get('s
-000072e0: 656e 646d 6169 6c5f 7061 7468 2729 293b  endmail_path'));
-000072f0: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
-00007300: 6564 6562 7567 2822 456e 7665 6c6f 7065  edebug("Envelope
-00007310: 2073 656e 6465 723a 207b 2474 6869 732d   sender: {$this-
-00007320: 3e53 656e 6465 727d 2229 3b0a 2020 2020  >Sender}");.    
-00007330: 2020 2020 2474 6869 732d 3e65 6465 6275      $this->edebu
-00007340: 6728 2254 6f3a 207b 2474 6f7d 2229 3b0a  g("To: {$to}");.
-00007350: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-00007360: 6465 6275 6728 2253 7562 6a65 6374 3a20  debug("Subject: 
-00007370: 7b24 7375 626a 6563 747d 2229 3b0a 2020  {$subject}");.  
-00007380: 2020 2020 2020 2474 6869 732d 3e65 6465        $this->ede
-00007390: 6275 6728 2248 6561 6465 7273 3a20 7b24  bug("Headers: {$
-000073a0: 6865 6164 6572 7d22 293b 0a20 2020 2020  header}");.     
-000073b0: 2020 2069 6620 2821 2474 6869 732d 3e55     if (!$this->U
-000073c0: 7365 5365 6e64 6d61 696c 4f70 7469 6f6e  seSendmailOption
-000073d0: 7320 7c7c 206e 756c 6c20 3d3d 3d20 2470  s || null === $p
-000073e0: 6172 616d 7329 207b 0a20 2020 2020 2020  arams) {.       
-000073f0: 2020 2020 2024 7265 7375 6c74 203d 2040       $result = @
-00007400: 6d61 696c 2824 746f 2c20 2473 7562 6a65  mail($to, $subje
-00007410: 6374 2c20 2462 6f64 792c 2024 6865 6164  ct, $body, $head
-00007420: 6572 293b 0a20 2020 2020 2020 207d 2065  er);.        } e
-00007430: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-00007440: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
-00007450: 2241 6464 6974 696f 6e61 6c20 7061 7261  "Additional para
-00007460: 6d73 3a20 7b24 7061 7261 6d73 7d22 293b  ms: {$params}");
-00007470: 0a20 2020 2020 2020 2020 2020 2024 7265  .            $re
-00007480: 7375 6c74 203d 2040 6d61 696c 2824 746f  sult = @mail($to
-00007490: 2c20 2473 7562 6a65 6374 2c20 2462 6f64  , $subject, $bod
-000074a0: 792c 2024 6865 6164 6572 2c20 2470 6172  y, $header, $par
-000074b0: 616d 7329 3b0a 2020 2020 2020 2020 7d0a  ams);.        }.
-000074c0: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-000074d0: 6465 6275 6728 2752 6573 756c 743a 2027  debug('Result: '
-000074e0: 202e 2028 2472 6573 756c 7420 3f20 2774   . ($result ? 't
-000074f0: 7275 6527 203a 2027 6661 6c73 6527 2929  rue' : 'false'))
-00007500: 3b0a 2020 2020 2020 2020 7265 7475 726e  ;.        return
-00007510: 2024 7265 7375 6c74 3b0a 2020 2020 7d0a   $result;.    }.
-00007520: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00007530: 4f75 7470 7574 2064 6562 7567 6769 6e67  Output debugging
-00007540: 2069 6e66 6f20 7669 6120 6120 7573 6572   info via a user
-00007550: 2d64 6566 696e 6564 206d 6574 686f 642e  -defined method.
-00007560: 0a20 2020 2020 2a20 4f6e 6c79 2067 656e  .     * Only gen
-00007570: 6572 6174 6573 206f 7574 7075 7420 6966  erates output if
-00007580: 2064 6562 7567 206f 7574 7075 7420 6973   debug output is
-00007590: 2065 6e61 626c 6564 2e0a 2020 2020 202a   enabled..     *
-000075a0: 0a20 2020 2020 2a20 4073 6565 2050 4850  .     * @see PHP
-000075b0: 4d61 696c 6572 3a3a 2444 6562 7567 6f75  Mailer::$Debugou
-000075c0: 7470 7574 0a20 2020 2020 2a20 4073 6565  tput.     * @see
-000075d0: 2050 4850 4d61 696c 6572 3a3a 2453 4d54   PHPMailer::$SMT
-000075e0: 5044 6562 7567 0a20 2020 2020 2a0a 2020  PDebug.     *.  
-000075f0: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-00007600: 6e67 2024 7374 720a 2020 2020 202a 2f0a  ng $str.     */.
-00007610: 2020 2020 7072 6f74 6563 7465 6420 6675      protected fu
-00007620: 6e63 7469 6f6e 2065 6465 6275 6728 2473  nction edebug($s
-00007630: 7472 290a 2020 2020 7b0a 2020 2020 2020  tr).    {.      
-00007640: 2020 6966 2028 2474 6869 732d 3e53 4d54    if ($this->SMT
-00007650: 5044 6562 7567 203c 3d20 3029 207b 0a20  PDebug <= 0) {. 
-00007660: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007670: 6e3b 0a20 2020 2020 2020 207d 0a20 2020  n;.        }.   
-00007680: 2020 2020 202f 2f49 7320 7468 6973 2061       //Is this a
-00007690: 2050 5352 2d33 206c 6f67 6765 723f 0a20   PSR-3 logger?. 
-000076a0: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
-000076b0: 2d3e 4465 6275 676f 7574 7075 7420 696e  ->Debugoutput in
-000076c0: 7374 616e 6365 6f66 205c 5073 725c 4c6f  stanceof \Psr\Lo
-000076d0: 675c 4c6f 6767 6572 496e 7465 7266 6163  g\LoggerInterfac
-000076e0: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-000076f0: 2024 7468 6973 2d3e 4465 6275 676f 7574   $this->Debugout
-00007700: 7075 742d 3e64 6562 7567 2824 7374 7229  put->debug($str)
-00007710: 3b0a 0a20 2020 2020 2020 2020 2020 2072  ;..            r
-00007720: 6574 7572 6e3b 0a20 2020 2020 2020 207d  eturn;.        }
-00007730: 0a20 2020 2020 2020 202f 2f41 766f 6964  .        //Avoid
-00007740: 2063 6c61 7368 2077 6974 6820 6275 696c   clash with buil
-00007750: 742d 696e 2066 756e 6374 696f 6e20 6e61  t-in function na
-00007760: 6d65 730a 2020 2020 2020 2020 6966 2028  mes.        if (
-00007770: 6973 5f63 616c 6c61 626c 6528 2474 6869  is_callable($thi
-00007780: 732d 3e44 6562 7567 6f75 7470 7574 2920  s->Debugoutput) 
-00007790: 2626 2021 696e 5f61 7272 6179 2824 7468  && !in_array($th
-000077a0: 6973 2d3e 4465 6275 676f 7574 7075 742c  is->Debugoutput,
-000077b0: 205b 2765 7272 6f72 5f6c 6f67 272c 2027   ['error_log', '
-000077c0: 6874 6d6c 272c 2027 6563 686f 275d 2929  html', 'echo']))
-000077d0: 207b 0a20 2020 2020 2020 2020 2020 2063   {.            c
-000077e0: 616c 6c5f 7573 6572 5f66 756e 6328 2474  all_user_func($t
-000077f0: 6869 732d 3e44 6562 7567 6f75 7470 7574  his->Debugoutput
-00007800: 2c20 2473 7472 2c20 2474 6869 732d 3e53  , $str, $this->S
-00007810: 4d54 5044 6562 7567 293b 0a0a 2020 2020  MTPDebug);..    
-00007820: 2020 2020 2020 2020 7265 7475 726e 3b0a          return;.
-00007830: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00007840: 2020 7377 6974 6368 2028 2474 6869 732d    switch ($this-
-00007850: 3e44 6562 7567 6f75 7470 7574 2920 7b0a  >Debugoutput) {.
-00007860: 2020 2020 2020 2020 2020 2020 6361 7365              case
-00007870: 2027 6572 726f 725f 6c6f 6727 3a0a 2020   'error_log':.  
-00007880: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00007890: 446f 6e27 7420 6f75 7470 7574 2c20 6a75  Don't output, ju
-000078a0: 7374 206c 6f67 0a20 2020 2020 2020 2020  st log.         
-000078b0: 2020 2020 2020 202f 2a2a 2040 6e6f 696e         /** @noin
-000078c0: 7370 6563 7469 6f6e 2046 6f72 676f 7474  spection Forgott
-000078d0: 656e 4465 6275 674f 7574 7075 7449 6e73  enDebugOutputIns
-000078e0: 7065 6374 696f 6e20 2a2f 0a20 2020 2020  pection */.     
-000078f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00007900: 5f6c 6f67 2824 7374 7229 3b0a 2020 2020  _log($str);.    
-00007910: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00007920: 6b3b 0a20 2020 2020 2020 2020 2020 2063  k;.            c
-00007930: 6173 6520 2768 746d 6c27 3a0a 2020 2020  ase 'html':.    
-00007940: 2020 2020 2020 2020 2020 2020 2f2f 436c              //Cl
-00007950: 6561 6e73 2075 7020 6f75 7470 7574 2061  eans up output a
-00007960: 2062 6974 2066 6f72 2061 2062 6574 7465   bit for a bette
-00007970: 7220 6c6f 6f6b 696e 672c 2048 544d 4c2d  r looking, HTML-
-00007980: 7361 6665 206f 7574 7075 740a 2020 2020  safe output.    
-00007990: 2020 2020 2020 2020 2020 2020 6563 686f              echo
-000079a0: 2068 746d 6c65 6e74 6974 6965 7328 0a20   htmlentities(. 
-000079b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079c0: 2020 2070 7265 675f 7265 706c 6163 6528     preg_replace(
-000079d0: 272f 5b5c 725c 6e5d 2b2f 272c 2027 272c  '/[\r\n]+/', '',
-000079e0: 2024 7374 7229 2c0a 2020 2020 2020 2020   $str),.        
-000079f0: 2020 2020 2020 2020 2020 2020 454e 545f              ENT_
-00007a00: 5155 4f54 4553 2c0a 2020 2020 2020 2020  QUOTES,.        
-00007a10: 2020 2020 2020 2020 2020 2020 2755 5446              'UTF
-00007a20: 2d38 270a 2020 2020 2020 2020 2020 2020  -8'.            
-00007a30: 2020 2020 292c 2022 3c62 723e 5c6e 223b      ), "<br>\n";
-00007a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a50: 2062 7265 616b 3b0a 2020 2020 2020 2020   break;.        
-00007a60: 2020 2020 6361 7365 2027 6563 686f 273a      case 'echo':
-00007a70: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00007a80: 6175 6c74 3a0a 2020 2020 2020 2020 2020  ault:.          
-00007a90: 2020 2020 2020 2f2f 4e6f 726d 616c 697a        //Normaliz
-00007aa0: 6520 6c69 6e65 2062 7265 616b 730a 2020  e line breaks.  
-00007ab0: 2020 2020 2020 2020 2020 2020 2020 2473                $s
-00007ac0: 7472 203d 2070 7265 675f 7265 706c 6163  tr = preg_replac
-00007ad0: 6528 272f 5c72 5c6e 7c5c 722f 6d27 2c20  e('/\r\n|\r/m', 
-00007ae0: 225c 6e22 2c20 2473 7472 293b 0a20 2020  "\n", $str);.   
-00007af0: 2020 2020 2020 2020 2020 2020 2065 6368               ech
-00007b00: 6f20 676d 6461 7465 2827 592d 6d2d 6420  o gmdate('Y-m-d 
-00007b10: 483a 693a 7327 292c 0a20 2020 2020 2020  H:i:s'),.       
-00007b20: 2020 2020 2020 2020 2022 5c74 222c 0a20           "\t",. 
-00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b40: 2020 202f 2f54 7269 6d20 7472 6169 6c69     //Trim traili
-00007b50: 6e67 2073 7061 6365 0a20 2020 2020 2020  ng space.       
-00007b60: 2020 2020 2020 2020 2074 7269 6d28 0a20           trim(. 
-00007b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b80: 2020 202f 2f49 6e64 656e 7420 666f 7220     //Indent for 
-00007b90: 7265 6164 6162 696c 6974 792c 2065 7863  readability, exc
-00007ba0: 6570 7420 666f 7220 7472 6169 6c69 6e67  ept for trailing
-00007bb0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00007bc0: 2020 2020 2020 2020 2020 2073 7472 5f72             str_r
-00007bd0: 6570 6c61 6365 280a 2020 2020 2020 2020  eplace(.        
-00007be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007bf0: 225c 6e22 2c0a 2020 2020 2020 2020 2020  "\n",.          
-00007c00: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-00007c10: 6e20 2020 2020 2020 2020 2020 2020 2020  n               
-00007c20: 2020 2020 5c74 2020 2020 2020 2020 2020      \t          
-00007c30: 2020 2020 2020 2020 222c 0a20 2020 2020          ",.     
-00007c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c50: 2020 2074 7269 6d28 2473 7472 290a 2020     trim($str).  
-00007c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007c80: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00007c90: 2020 2020 2020 2022 5c6e 223b 0a20 2020         "\n";.   
-00007ca0: 2020 2020 207d 0a20 2020 207d 0a0a 2020       }.    }..  
-00007cb0: 2020 2f2a 2a0a 2020 2020 202a 2053 6574    /**.     * Set
-00007cc0: 7320 6d65 7373 6167 6520 7479 7065 2074  s message type t
-00007cd0: 6f20 4854 4d4c 206f 7220 706c 6169 6e2e  o HTML or plain.
-00007ce0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00007cf0: 7061 7261 6d20 626f 6f6c 2024 6973 4874  param bool $isHt
-00007d00: 6d6c 2054 7275 6520 666f 7220 4854 4d4c  ml True for HTML
-00007d10: 206d 6f64 650a 2020 2020 202a 2f0a 2020   mode.     */.  
-00007d20: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
-00007d30: 6e20 6973 4854 4d4c 2824 6973 4874 6d6c  n isHTML($isHtml
-00007d40: 203d 2074 7275 6529 0a20 2020 207b 0a20   = true).    {. 
-00007d50: 2020 2020 2020 2069 6620 2824 6973 4874         if ($isHt
-00007d60: 6d6c 2920 7b0a 2020 2020 2020 2020 2020  ml) {.          
-00007d70: 2020 2474 6869 732d 3e43 6f6e 7465 6e74    $this->Content
-00007d80: 5479 7065 203d 2073 7461 7469 633a 3a43  Type = static::C
-00007d90: 4f4e 5445 4e54 5f54 5950 455f 5445 5854  ONTENT_TYPE_TEXT
-00007da0: 5f48 544d 4c3b 0a20 2020 2020 2020 207d  _HTML;.        }
-00007db0: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
-00007dc0: 2020 2020 2474 6869 732d 3e43 6f6e 7465      $this->Conte
-00007dd0: 6e74 5479 7065 203d 2073 7461 7469 633a  ntType = static:
-00007de0: 3a43 4f4e 5445 4e54 5f54 5950 455f 504c  :CONTENT_TYPE_PL
-00007df0: 4149 4e54 4558 543b 0a20 2020 2020 2020  AINTEXT;.       
-00007e00: 207d 0a20 2020 207d 0a0a 2020 2020 2f2a   }.    }..    /*
-00007e10: 2a0a 2020 2020 202a 2053 656e 6420 6d65  *.     * Send me
-00007e20: 7373 6167 6573 2075 7369 6e67 2053 4d54  ssages using SMT
-00007e30: 502e 0a20 2020 2020 2a2f 0a20 2020 2070  P..     */.    p
-00007e40: 7562 6c69 6320 6675 6e63 7469 6f6e 2069  ublic function i
-00007e50: 7353 4d54 5028 290a 2020 2020 7b0a 2020  sSMTP().    {.  
-00007e60: 2020 2020 2020 2474 6869 732d 3e4d 6169        $this->Mai
-00007e70: 6c65 7220 3d20 2773 6d74 7027 3b0a 2020  ler = 'smtp';.  
-00007e80: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00007e90: 2020 2a20 5365 6e64 206d 6573 7361 6765    * Send message
-00007ea0: 7320 7573 696e 6720 5048 5027 7320 6d61  s using PHP's ma
-00007eb0: 696c 2829 2066 756e 6374 696f 6e2e 0a20  il() function.. 
-00007ec0: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00007ed0: 6320 6675 6e63 7469 6f6e 2069 734d 6169  c function isMai
-00007ee0: 6c28 290a 2020 2020 7b0a 2020 2020 2020  l().    {.      
-00007ef0: 2020 2474 6869 732d 3e4d 6169 6c65 7220    $this->Mailer 
-00007f00: 3d20 276d 6169 6c27 3b0a 2020 2020 7d0a  = 'mail';.    }.
-00007f10: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00007f20: 5365 6e64 206d 6573 7361 6765 7320 7573  Send messages us
-00007f30: 696e 6720 2453 656e 646d 6169 6c2e 0a20  ing $Sendmail.. 
-00007f40: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00007f50: 6320 6675 6e63 7469 6f6e 2069 7353 656e  c function isSen
-00007f60: 646d 6169 6c28 290a 2020 2020 7b0a 2020  dmail().    {.  
-00007f70: 2020 2020 2020 2469 6e69 5f73 656e 646d        $ini_sendm
-00007f80: 6169 6c5f 7061 7468 203d 2069 6e69 5f67  ail_path = ini_g
-00007f90: 6574 2827 7365 6e64 6d61 696c 5f70 6174  et('sendmail_pat
-00007fa0: 6827 293b 0a0a 2020 2020 2020 2020 6966  h');..        if
-00007fb0: 2028 6661 6c73 6520 3d3d 3d20 7374 7269   (false === stri
-00007fc0: 706f 7328 2469 6e69 5f73 656e 646d 6169  pos($ini_sendmai
-00007fd0: 6c5f 7061 7468 2c20 2773 656e 646d 6169  l_path, 'sendmai
-00007fe0: 6c27 2929 207b 0a20 2020 2020 2020 2020  l')) {.         
-00007ff0: 2020 2024 7468 6973 2d3e 5365 6e64 6d61     $this->Sendma
-00008000: 696c 203d 2027 2f75 7372 2f73 6269 6e2f  il = '/usr/sbin/
-00008010: 7365 6e64 6d61 696c 273b 0a20 2020 2020  sendmail';.     
-00008020: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-00008030: 2020 2020 2020 2020 2474 6869 732d 3e53          $this->S
-00008040: 656e 646d 6169 6c20 3d20 2469 6e69 5f73  endmail = $ini_s
-00008050: 656e 646d 6169 6c5f 7061 7468 3b0a 2020  endmail_path;.  
-00008060: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00008070: 2474 6869 732d 3e4d 6169 6c65 7220 3d20  $this->Mailer = 
-00008080: 2773 656e 646d 6169 6c27 3b0a 2020 2020  'sendmail';.    
-00008090: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-000080a0: 2a20 5365 6e64 206d 6573 7361 6765 7320  * Send messages 
-000080b0: 7573 696e 6720 716d 6169 6c2e 0a20 2020  using qmail..   
-000080c0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-000080d0: 6675 6e63 7469 6f6e 2069 7351 6d61 696c  function isQmail
-000080e0: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
-000080f0: 2024 696e 695f 7365 6e64 6d61 696c 5f70   $ini_sendmail_p
-00008100: 6174 6820 3d20 696e 695f 6765 7428 2773  ath = ini_get('s
-00008110: 656e 646d 6169 6c5f 7061 7468 2729 3b0a  endmail_path');.
-00008120: 0a20 2020 2020 2020 2069 6620 2866 616c  .        if (fal
-00008130: 7365 203d 3d3d 2073 7472 6970 6f73 2824  se === stripos($
-00008140: 696e 695f 7365 6e64 6d61 696c 5f70 6174  ini_sendmail_pat
-00008150: 682c 2027 716d 6169 6c27 2929 207b 0a20  h, 'qmail')) {. 
-00008160: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-00008170: 2d3e 5365 6e64 6d61 696c 203d 2027 2f76  ->Sendmail = '/v
-00008180: 6172 2f71 6d61 696c 2f62 696e 2f71 6d61  ar/qmail/bin/qma
-00008190: 696c 2d69 6e6a 6563 7427 3b0a 2020 2020  il-inject';.    
-000081a0: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
-000081b0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-000081c0: 5365 6e64 6d61 696c 203d 2024 696e 695f  Sendmail = $ini_
-000081d0: 7365 6e64 6d61 696c 5f70 6174 683b 0a20  sendmail_path;. 
-000081e0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000081f0: 2024 7468 6973 2d3e 4d61 696c 6572 203d   $this->Mailer =
-00008200: 2027 716d 6169 6c27 3b0a 2020 2020 7d0a   'qmail';.    }.
-00008210: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00008220: 4164 6420 6120 2254 6f22 2061 6464 7265  Add a "To" addre
-00008230: 7373 2e0a 2020 2020 202a 0a20 2020 2020  ss..     *.     
-00008240: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
-00008250: 2461 6464 7265 7373 2054 6865 2065 6d61  $address The ema
-00008260: 696c 2061 6464 7265 7373 2074 6f20 7365  il address to se
-00008270: 6e64 2074 6f0a 2020 2020 202a 2040 7061  nd to.     * @pa
-00008280: 7261 6d20 7374 7269 6e67 2024 6e61 6d65  ram string $name
-00008290: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-000082a0: 7468 726f 7773 2045 7863 6570 7469 6f6e  throws Exception
-000082b0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-000082c0: 7265 7475 726e 2062 6f6f 6c20 7472 7565  return bool true
-000082d0: 206f 6e20 7375 6363 6573 732c 2066 616c   on success, fal
-000082e0: 7365 2069 6620 6164 6472 6573 7320 616c  se if address al
-000082f0: 7265 6164 7920 7573 6564 206f 7220 696e  ready used or in
-00008300: 7661 6c69 6420 696e 2073 6f6d 6520 7761  valid in some wa
-00008310: 790a 2020 2020 202a 2f0a 2020 2020 7075  y.     */.    pu
-00008320: 626c 6963 2066 756e 6374 696f 6e20 6164  blic function ad
-00008330: 6441 6464 7265 7373 2824 6164 6472 6573  dAddress($addres
-00008340: 732c 2024 6e61 6d65 203d 2027 2729 0a20  s, $name = ''). 
-00008350: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
-00008360: 7572 6e20 2474 6869 732d 3e61 6464 4f72  urn $this->addOr
-00008370: 456e 7175 6575 6541 6e41 6464 7265 7373  EnqueueAnAddress
-00008380: 2827 746f 272c 2024 6164 6472 6573 732c  ('to', $address,
-00008390: 2024 6e61 6d65 293b 0a20 2020 207d 0a0a   $name);.    }..
-000083a0: 2020 2020 2f2a 2a0a 2020 2020 202a 2041      /**.     * A
-000083b0: 6464 2061 2022 4343 2220 6164 6472 6573  dd a "CC" addres
-000083c0: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
-000083d0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-000083e0: 6164 6472 6573 7320 5468 6520 656d 6169  address The emai
-000083f0: 6c20 6164 6472 6573 7320 746f 2073 656e  l address to sen
-00008400: 6420 746f 0a20 2020 2020 2a20 4070 6172  d to.     * @par
-00008410: 616d 2073 7472 696e 6720 246e 616d 650a  am string $name.
-00008420: 2020 2020 202a 0a20 2020 2020 2a20 4074       *.     * @t
-00008430: 6872 6f77 7320 4578 6365 7074 696f 6e0a  hrows Exception.
-00008440: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00008450: 6574 7572 6e20 626f 6f6c 2074 7275 6520  eturn bool true 
-00008460: 6f6e 2073 7563 6365 7373 2c20 6661 6c73  on success, fals
-00008470: 6520 6966 2061 6464 7265 7373 2061 6c72  e if address alr
-00008480: 6561 6479 2075 7365 6420 6f72 2069 6e76  eady used or inv
-00008490: 616c 6964 2069 6e20 736f 6d65 2077 6179  alid in some way
-000084a0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-000084b0: 6c69 6320 6675 6e63 7469 6f6e 2061 6464  lic function add
-000084c0: 4343 2824 6164 6472 6573 732c 2024 6e61  CC($address, $na
-000084d0: 6d65 203d 2027 2729 0a20 2020 207b 0a20  me = '').    {. 
-000084e0: 2020 2020 2020 2072 6574 7572 6e20 2474         return $t
-000084f0: 6869 732d 3e61 6464 4f72 456e 7175 6575  his->addOrEnqueu
-00008500: 6541 6e41 6464 7265 7373 2827 6363 272c  eAnAddress('cc',
-00008510: 2024 6164 6472 6573 732c 2024 6e61 6d65   $address, $name
-00008520: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
-00008530: 2a0a 2020 2020 202a 2041 6464 2061 2022  *.     * Add a "
-00008540: 4243 4322 2061 6464 7265 7373 2e0a 2020  BCC" address..  
-00008550: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
-00008560: 616d 2073 7472 696e 6720 2461 6464 7265  am string $addre
-00008570: 7373 2054 6865 2065 6d61 696c 2061 6464  ss The email add
-00008580: 7265 7373 2074 6f20 7365 6e64 2074 6f0a  ress to send to.
-00008590: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-000085a0: 7269 6e67 2024 6e61 6d65 0a20 2020 2020  ring $name.     
-000085b0: 2a0a 2020 2020 202a 2040 7468 726f 7773  *.     * @throws
-000085c0: 2045 7863 6570 7469 6f6e 0a20 2020 2020   Exception.     
-000085d0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-000085e0: 2062 6f6f 6c20 7472 7565 206f 6e20 7375   bool true on su
-000085f0: 6363 6573 732c 2066 616c 7365 2069 6620  ccess, false if 
-00008600: 6164 6472 6573 7320 616c 7265 6164 7920  address already 
-00008610: 7573 6564 206f 7220 696e 7661 6c69 6420  used or invalid 
-00008620: 696e 2073 6f6d 6520 7761 790a 2020 2020  in some way.    
-00008630: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-00008640: 756e 6374 696f 6e20 6164 6442 4343 2824  unction addBCC($
-00008650: 6164 6472 6573 732c 2024 6e61 6d65 203d  address, $name =
-00008660: 2027 2729 0a20 2020 207b 0a20 2020 2020   '').    {.     
-00008670: 2020 2072 6574 7572 6e20 2474 6869 732d     return $this-
-00008680: 3e61 6464 4f72 456e 7175 6575 6541 6e41  >addOrEnqueueAnA
-00008690: 6464 7265 7373 2827 6263 6327 2c20 2461  ddress('bcc', $a
-000086a0: 6464 7265 7373 2c20 246e 616d 6529 3b0a  ddress, $name);.
-000086b0: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
-000086c0: 2020 2020 2a20 4164 6420 6120 2252 6570      * Add a "Rep
-000086d0: 6c79 2d54 6f22 2061 6464 7265 7373 2e0a  ly-To" address..
-000086e0: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
-000086f0: 6172 616d 2073 7472 696e 6720 2461 6464  aram string $add
-00008700: 7265 7373 2054 6865 2065 6d61 696c 2061  ress The email a
-00008710: 6464 7265 7373 2074 6f20 7265 706c 7920  ddress to reply 
-00008720: 746f 0a20 2020 2020 2a20 4070 6172 616d  to.     * @param
-00008730: 2073 7472 696e 6720 246e 616d 650a 2020   string $name.  
-00008740: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
-00008750: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
-00008760: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00008770: 7572 6e20 626f 6f6c 2074 7275 6520 6f6e  urn bool true on
-00008780: 2073 7563 6365 7373 2c20 6661 6c73 6520   success, false 
-00008790: 6966 2061 6464 7265 7373 2061 6c72 6561  if address alrea
-000087a0: 6479 2075 7365 6420 6f72 2069 6e76 616c  dy used or inval
-000087b0: 6964 2069 6e20 736f 6d65 2077 6179 0a20  id in some way. 
-000087c0: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-000087d0: 6320 6675 6e63 7469 6f6e 2061 6464 5265  c function addRe
-000087e0: 706c 7954 6f28 2461 6464 7265 7373 2c20  plyTo($address, 
-000087f0: 246e 616d 6520 3d20 2727 290a 2020 2020  $name = '').    
-00008800: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
-00008810: 2024 7468 6973 2d3e 6164 644f 7245 6e71   $this->addOrEnq
-00008820: 7565 7565 416e 4164 6472 6573 7328 2752  ueueAnAddress('R
-00008830: 6570 6c79 2d54 6f27 2c20 2461 6464 7265  eply-To', $addre
-00008840: 7373 2c20 246e 616d 6529 3b0a 2020 2020  ss, $name);.    
-00008850: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-00008860: 2a20 4164 6420 616e 2061 6464 7265 7373  * Add an address
-00008870: 2074 6f20 6f6e 6520 6f66 2074 6865 2072   to one of the r
-00008880: 6563 6970 6965 6e74 2061 7272 6179 7320  ecipient arrays 
-00008890: 6f72 2074 6f20 7468 6520 5265 706c 7954  or to the ReplyT
-000088a0: 6f20 6172 7261 792e 2042 6563 6175 7365  o array. Because
-000088b0: 2050 4850 4d61 696c 6572 0a20 2020 2020   PHPMailer.     
-000088c0: 2a20 6361 6e27 7420 7661 6c69 6461 7465  * can't validate
-000088d0: 2061 6464 7265 7373 6573 2077 6974 6820   addresses with 
-000088e0: 616e 2049 444e 2077 6974 686f 7574 206b  an IDN without k
-000088f0: 6e6f 7769 6e67 2074 6865 2050 4850 4d61  nowing the PHPMa
-00008900: 696c 6572 3a3a 2443 6861 7253 6574 2028  iler::$CharSet (
-00008910: 7468 6174 2063 616e 2073 7469 6c6c 0a20  that can still. 
-00008920: 2020 2020 2a20 6265 206d 6f64 6966 6965      * be modifie
-00008930: 6420 6166 7465 7220 6361 6c6c 696e 6720  d after calling 
-00008940: 7468 6973 2066 756e 6374 696f 6e29 2c20  this function), 
-00008950: 6164 6469 7469 6f6e 206f 6620 7375 6368  addition of such
-00008960: 2061 6464 7265 7373 6573 2069 7320 6465   addresses is de
-00008970: 6c61 7965 6420 756e 7469 6c20 7365 6e64  layed until send
-00008980: 2829 2e0a 2020 2020 202a 2041 6464 7265  ()..     * Addre
-00008990: 7373 6573 2074 6861 7420 6861 7665 2062  sses that have b
-000089a0: 6565 6e20 6164 6465 6420 616c 7265 6164  een added alread
-000089b0: 7920 7265 7475 726e 2066 616c 7365 2c20  y return false, 
-000089c0: 6275 7420 646f 206e 6f74 2074 6872 6f77  but do not throw
-000089d0: 2065 7863 6570 7469 6f6e 732e 0a20 2020   exceptions..   
-000089e0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-000089f0: 6d20 7374 7269 6e67 2024 6b69 6e64 2020  m string $kind  
-00008a00: 2020 4f6e 6520 6f66 2027 746f 272c 2027    One of 'to', '
-00008a10: 6363 272c 2027 6263 6327 2c20 6f72 2027  cc', 'bcc', or '
-00008a20: 5265 706c 7954 6f27 0a20 2020 2020 2a20  ReplyTo'.     * 
-00008a30: 4070 6172 616d 2073 7472 696e 6720 2461  @param string $a
-00008a40: 6464 7265 7373 2054 6865 2065 6d61 696c  ddress The email
-00008a50: 2061 6464 7265 7373 0a20 2020 2020 2a20   address.     * 
-00008a60: 4070 6172 616d 2073 7472 696e 6720 246e  @param string $n
-00008a70: 616d 6520 2020 2041 6e20 6f70 7469 6f6e  ame    An option
-00008a80: 616c 2075 7365 726e 616d 6520 6173 736f  al username asso
-00008a90: 6369 6174 6564 2077 6974 6820 7468 6520  ciated with the 
-00008aa0: 6164 6472 6573 730a 2020 2020 202a 0a20  address.     *. 
-00008ab0: 2020 2020 2a20 4074 6872 6f77 7320 4578      * @throws Ex
-00008ac0: 6365 7074 696f 6e0a 2020 2020 202a 0a20  ception.     *. 
-00008ad0: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
-00008ae0: 6f6c 2074 7275 6520 6f6e 2073 7563 6365  ol true on succe
-00008af0: 7373 2c20 6661 6c73 6520 6966 2061 6464  ss, false if add
-00008b00: 7265 7373 2061 6c72 6561 6479 2075 7365  ress already use
-00008b10: 6420 6f72 2069 6e76 616c 6964 2069 6e20  d or invalid in 
-00008b20: 736f 6d65 2077 6179 0a20 2020 2020 2a2f  some way.     */
-00008b30: 0a20 2020 2070 726f 7465 6374 6564 2066  .    protected f
-00008b40: 756e 6374 696f 6e20 6164 644f 7245 6e71  unction addOrEnq
-00008b50: 7565 7565 416e 4164 6472 6573 7328 246b  ueueAnAddress($k
-00008b60: 696e 642c 2024 6164 6472 6573 732c 2024  ind, $address, $
-00008b70: 6e61 6d65 290a 2020 2020 7b0a 2020 2020  name).    {.    
-00008b80: 2020 2020 2470 6f73 203d 2066 616c 7365      $pos = false
-00008b90: 3b0a 2020 2020 2020 2020 6966 2028 2461  ;.        if ($a
-00008ba0: 6464 7265 7373 2021 3d3d 206e 756c 6c29  ddress !== null)
-00008bb0: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
-00008bc0: 6164 6472 6573 7320 3d20 7472 696d 2824  address = trim($
-00008bd0: 6164 6472 6573 7329 3b0a 2020 2020 2020  address);.      
-00008be0: 2020 2020 2020 2470 6f73 203d 2073 7472        $pos = str
-00008bf0: 7270 6f73 2824 6164 6472 6573 732c 2027  rpos($address, '
-00008c00: 4027 293b 0a20 2020 2020 2020 207d 0a20  @');.        }. 
-00008c10: 2020 2020 2020 2069 6620 2866 616c 7365         if (false
-00008c20: 203d 3d3d 2024 706f 7329 207b 0a20 2020   === $pos) {.   
-00008c30: 2020 2020 2020 2020 202f 2f41 742d 7369           //At-si
-00008c40: 676e 2069 7320 6d69 7373 696e 672e 0a20  gn is missing.. 
-00008c50: 2020 2020 2020 2020 2020 2024 6572 726f             $erro
-00008c60: 725f 6d65 7373 6167 6520 3d20 7370 7269  r_message = spri
-00008c70: 6e74 6628 0a20 2020 2020 2020 2020 2020  ntf(.           
-00008c80: 2020 2020 2027 2573 2028 2573 293a 2025       '%s (%s): %
-00008c90: 7327 2c0a 2020 2020 2020 2020 2020 2020  s',.            
-00008ca0: 2020 2020 2474 6869 732d 3e6c 616e 6728      $this->lang(
-00008cb0: 2769 6e76 616c 6964 5f61 6464 7265 7373  'invalid_address
-00008cc0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00008cd0: 2020 2020 246b 696e 642c 0a20 2020 2020      $kind,.     
-00008ce0: 2020 2020 2020 2020 2020 2024 6164 6472             $addr
-00008cf0: 6573 730a 2020 2020 2020 2020 2020 2020  ess.            
-00008d00: 293b 0a20 2020 2020 2020 2020 2020 2024  );.            $
-00008d10: 7468 6973 2d3e 7365 7445 7272 6f72 2824  this->setError($
-00008d20: 6572 726f 725f 6d65 7373 6167 6529 3b0a  error_message);.
-00008d30: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-00008d40: 732d 3e65 6465 6275 6728 2465 7272 6f72  s->edebug($error
-00008d50: 5f6d 6573 7361 6765 293b 0a20 2020 2020  _message);.     
-00008d60: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
-00008d70: 2d3e 6578 6365 7074 696f 6e73 2920 7b0a  ->exceptions) {.
-00008d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d90: 7468 726f 7720 6e65 7720 4578 6365 7074  throw new Except
-00008da0: 696f 6e28 2465 7272 6f72 5f6d 6573 7361  ion($error_messa
-00008db0: 6765 293b 0a20 2020 2020 2020 2020 2020  ge);.           
-00008dc0: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-00008dd0: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
-00008de0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00008df0: 6966 2028 246e 616d 6520 213d 3d20 6e75  if ($name !== nu
-00008e00: 6c6c 2026 2620 6973 5f73 7472 696e 6728  ll && is_string(
-00008e10: 246e 616d 6529 2920 7b0a 2020 2020 2020  $name)) {.      
-00008e20: 2020 2020 2020 246e 616d 6520 3d20 7472        $name = tr
-00008e30: 696d 2870 7265 675f 7265 706c 6163 6528  im(preg_replace(
-00008e40: 272f 5b5c 725c 6e5d 2b2f 272c 2027 272c  '/[\r\n]+/', '',
-00008e50: 2024 6e61 6d65 2929 3b20 2f2f 5374 7269   $name)); //Stri
-00008e60: 7020 6272 6561 6b73 2061 6e64 2074 7269  p breaks and tri
-00008e70: 6d0a 2020 2020 2020 2020 7d20 656c 7365  m.        } else
-00008e80: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
-00008e90: 6e61 6d65 203d 2027 273b 0a20 2020 2020  name = '';.     
-00008ea0: 2020 207d 0a20 2020 2020 2020 2024 7061     }.        $pa
-00008eb0: 7261 6d73 203d 205b 246b 696e 642c 2024  rams = [$kind, $
-00008ec0: 6164 6472 6573 732c 2024 6e61 6d65 5d3b  address, $name];
-00008ed0: 0a20 2020 2020 2020 202f 2f45 6e71 7565  .        //Enque
-00008ee0: 7565 2061 6464 7265 7373 6573 2077 6974  ue addresses wit
-00008ef0: 6820 4944 4e20 756e 7469 6c20 7765 206b  h IDN until we k
-00008f00: 6e6f 7720 7468 6520 5048 504d 6169 6c65  now the PHPMaile
-00008f10: 723a 3a24 4368 6172 5365 742e 0a20 2020  r::$CharSet..   
-00008f20: 2020 2020 202f 2f44 6f6d 6169 6e20 6973       //Domain is
-00008f30: 2061 7373 756d 6564 2074 6f20 6265 2077   assumed to be w
-00008f40: 6861 7465 7665 7220 6973 2061 6674 6572  hatever is after
-00008f50: 2074 6865 206c 6173 7420 4020 7379 6d62   the last @ symb
-00008f60: 6f6c 2069 6e20 7468 6520 6164 6472 6573  ol in the addres
-00008f70: 730a 2020 2020 2020 2020 6966 2028 7374  s.        if (st
-00008f80: 6174 6963 3a3a 6964 6e53 7570 706f 7274  atic::idnSupport
-00008f90: 6564 2829 2026 2620 2474 6869 732d 3e68  ed() && $this->h
-00008fa0: 6173 3862 6974 4368 6172 7328 7375 6273  as8bitChars(subs
-00008fb0: 7472 2824 6164 6472 6573 732c 202b 2b24  tr($address, ++$
-00008fc0: 706f 7329 2929 207b 0a20 2020 2020 2020  pos))) {.       
-00008fd0: 2020 2020 2069 6620 2827 5265 706c 792d       if ('Reply-
-00008fe0: 546f 2720 213d 3d20 246b 696e 6429 207b  To' !== $kind) {
-00008ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009000: 2069 6620 2821 6172 7261 795f 6b65 795f   if (!array_key_
-00009010: 6578 6973 7473 2824 6164 6472 6573 732c  exists($address,
-00009020: 2024 7468 6973 2d3e 5265 6369 7069 656e   $this->Recipien
-00009030: 7473 5175 6575 6529 2920 7b0a 2020 2020  tsQueue)) {.    
-00009040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009050: 2474 6869 732d 3e52 6563 6970 6965 6e74  $this->Recipient
-00009060: 7351 7565 7565 5b24 6164 6472 6573 735d  sQueue[$address]
-00009070: 203d 2024 7061 7261 6d73 3b0a 0a20 2020   = $params;..   
-00009080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009090: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
-000090a0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-000090b0: 2020 2020 2020 2020 2020 2020 7d20 656c              } el
-000090c0: 7365 6966 2028 2161 7272 6179 5f6b 6579  seif (!array_key
-000090d0: 5f65 7869 7374 7328 2461 6464 7265 7373  _exists($address
-000090e0: 2c20 2474 6869 732d 3e52 6570 6c79 546f  , $this->ReplyTo
-000090f0: 5175 6575 6529 2920 7b0a 2020 2020 2020  Queue)) {.      
-00009100: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-00009110: 3e52 6570 6c79 546f 5175 6575 655b 2461  >ReplyToQueue[$a
-00009120: 6464 7265 7373 5d20 3d20 2470 6172 616d  ddress] = $param
-00009130: 733b 0a0a 2020 2020 2020 2020 2020 2020  s;..            
-00009140: 2020 2020 7265 7475 726e 2074 7275 653b      return true;
-00009150: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-00009160: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00009170: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
-00009180: 2020 7d0a 0a20 2020 2020 2020 202f 2f49    }..        //I
-00009190: 6d6d 6564 6961 7465 6c79 2061 6464 2073  mmediately add s
-000091a0: 7461 6e64 6172 6420 6164 6472 6573 7365  tandard addresse
-000091b0: 7320 7769 7468 6f75 7420 4944 4e2e 0a20  s without IDN.. 
-000091c0: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
-000091d0: 6c6c 5f75 7365 725f 6675 6e63 5f61 7272  ll_user_func_arr
-000091e0: 6179 285b 2474 6869 732c 2027 6164 6441  ay([$this, 'addA
-000091f0: 6e41 6464 7265 7373 275d 2c20 2470 6172  nAddress'], $par
-00009200: 616d 7329 3b0a 2020 2020 7d0a 0a20 2020  ams);.    }..   
-00009210: 202f 2a2a 0a20 2020 2020 2a20 4164 6420   /**.     * Add 
-00009220: 616e 2061 6464 7265 7373 2074 6f20 6f6e  an address to on
-00009230: 6520 6f66 2074 6865 2072 6563 6970 6965  e of the recipie
-00009240: 6e74 2061 7272 6179 7320 6f72 2074 6f20  nt arrays or to 
-00009250: 7468 6520 5265 706c 7954 6f20 6172 7261  the ReplyTo arra
-00009260: 792e 0a20 2020 2020 2a20 4164 6472 6573  y..     * Addres
-00009270: 7365 7320 7468 6174 2068 6176 6520 6265  ses that have be
-00009280: 656e 2061 6464 6564 2061 6c72 6561 6479  en added already
-00009290: 2072 6574 7572 6e20 6661 6c73 652c 2062   return false, b
-000092a0: 7574 2064 6f20 6e6f 7420 7468 726f 7720  ut do not throw 
-000092b0: 6578 6365 7074 696f 6e73 2e0a 2020 2020  exceptions..    
-000092c0: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
-000092d0: 2073 7472 696e 6720 246b 696e 6420 2020   string $kind   
-000092e0: 204f 6e65 206f 6620 2774 6f27 2c20 2763   One of 'to', 'c
-000092f0: 6327 2c20 2762 6363 272c 206f 7220 2752  c', 'bcc', or 'R
-00009300: 6570 6c79 546f 270a 2020 2020 202a 2040  eplyTo'.     * @
-00009310: 7061 7261 6d20 7374 7269 6e67 2024 6164  param string $ad
-00009320: 6472 6573 7320 5468 6520 656d 6169 6c20  dress The email 
-00009330: 6164 6472 6573 7320 746f 2073 656e 642c  address to send,
-00009340: 2072 6573 702e 2074 6f20 7265 706c 7920   resp. to reply 
-00009350: 746f 0a20 2020 2020 2a20 4070 6172 616d  to.     * @param
-00009360: 2073 7472 696e 6720 246e 616d 650a 2020   string $name.  
-00009370: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
-00009380: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
-00009390: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-000093a0: 7572 6e20 626f 6f6c 2074 7275 6520 6f6e  urn bool true on
-000093b0: 2073 7563 6365 7373 2c20 6661 6c73 6520   success, false 
-000093c0: 6966 2061 6464 7265 7373 2061 6c72 6561  if address alrea
-000093d0: 6479 2075 7365 6420 6f72 2069 6e76 616c  dy used or inval
-000093e0: 6964 2069 6e20 736f 6d65 2077 6179 0a20  id in some way. 
-000093f0: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-00009400: 6374 6564 2066 756e 6374 696f 6e20 6164  cted function ad
-00009410: 6441 6e41 6464 7265 7373 2824 6b69 6e64  dAnAddress($kind
-00009420: 2c20 2461 6464 7265 7373 2c20 246e 616d  , $address, $nam
-00009430: 6520 3d20 2727 290a 2020 2020 7b0a 2020  e = '').    {.  
-00009440: 2020 2020 2020 6966 2028 2169 6e5f 6172        if (!in_ar
-00009450: 7261 7928 246b 696e 642c 205b 2774 6f27  ray($kind, ['to'
-00009460: 2c20 2763 6327 2c20 2762 6363 272c 2027  , 'cc', 'bcc', '
-00009470: 5265 706c 792d 546f 275d 2929 207b 0a20  Reply-To'])) {. 
-00009480: 2020 2020 2020 2020 2020 2024 6572 726f             $erro
-00009490: 725f 6d65 7373 6167 6520 3d20 7370 7269  r_message = spri
-000094a0: 6e74 6628 0a20 2020 2020 2020 2020 2020  ntf(.           
-000094b0: 2020 2020 2027 2573 3a20 2573 272c 0a20       '%s: %s',. 
-000094c0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-000094d0: 7468 6973 2d3e 6c61 6e67 2827 496e 7661  this->lang('Inva
-000094e0: 6c69 6420 7265 6369 7069 656e 7420 6b69  lid recipient ki
-000094f0: 6e64 2729 2c0a 2020 2020 2020 2020 2020  nd'),.          
-00009500: 2020 2020 2020 246b 696e 640a 2020 2020        $kind.    
-00009510: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
-00009520: 2020 2020 2020 2024 7468 6973 2d3e 7365         $this->se
-00009530: 7445 7272 6f72 2824 6572 726f 725f 6d65  tError($error_me
-00009540: 7373 6167 6529 3b0a 2020 2020 2020 2020  ssage);.        
-00009550: 2020 2020 2474 6869 732d 3e65 6465 6275      $this->edebu
-00009560: 6728 2465 7272 6f72 5f6d 6573 7361 6765  g($error_message
-00009570: 293b 0a20 2020 2020 2020 2020 2020 2069  );.            i
-00009580: 6620 2824 7468 6973 2d3e 6578 6365 7074  f ($this->except
-00009590: 696f 6e73 2920 7b0a 2020 2020 2020 2020  ions) {.        
-000095a0: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
-000095b0: 7720 4578 6365 7074 696f 6e28 2465 7272  w Exception($err
-000095c0: 6f72 5f6d 6573 7361 6765 293b 0a20 2020  or_message);.   
-000095d0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-000095e0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-000095f0: 616c 7365 3b0a 2020 2020 2020 2020 7d0a  alse;.        }.
-00009600: 2020 2020 2020 2020 6966 2028 2173 7461          if (!sta
-00009610: 7469 633a 3a76 616c 6964 6174 6541 6464  tic::validateAdd
-00009620: 7265 7373 2824 6164 6472 6573 7329 2920  ress($address)) 
-00009630: 7b0a 2020 2020 2020 2020 2020 2020 2465  {.            $e
-00009640: 7272 6f72 5f6d 6573 7361 6765 203d 2073  rror_message = s
-00009650: 7072 696e 7466 280a 2020 2020 2020 2020  printf(.        
-00009660: 2020 2020 2020 2020 2725 7320 2825 7329          '%s (%s)
-00009670: 3a20 2573 272c 0a20 2020 2020 2020 2020  : %s',.         
-00009680: 2020 2020 2020 2024 7468 6973 2d3e 6c61         $this->la
-00009690: 6e67 2827 696e 7661 6c69 645f 6164 6472  ng('invalid_addr
-000096a0: 6573 7327 292c 0a20 2020 2020 2020 2020  ess'),.         
-000096b0: 2020 2020 2020 2024 6b69 6e64 2c0a 2020         $kind,.  
-000096c0: 2020 2020 2020 2020 2020 2020 2020 2461                $a
-000096d0: 6464 7265 7373 0a20 2020 2020 2020 2020  ddress.         
-000096e0: 2020 2029 3b0a 2020 2020 2020 2020 2020     );.          
-000096f0: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
-00009700: 7228 2465 7272 6f72 5f6d 6573 7361 6765  r($error_message
-00009710: 293b 0a20 2020 2020 2020 2020 2020 2024  );.            $
-00009720: 7468 6973 2d3e 6564 6562 7567 2824 6572  this->edebug($er
-00009730: 726f 725f 6d65 7373 6167 6529 3b0a 2020  ror_message);.  
-00009740: 2020 2020 2020 2020 2020 6966 2028 2474            if ($t
-00009750: 6869 732d 3e65 7863 6570 7469 6f6e 7329  his->exceptions)
-00009760: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00009770: 2020 2074 6872 6f77 206e 6577 2045 7863     throw new Exc
-00009780: 6570 7469 6f6e 2824 6572 726f 725f 6d65  eption($error_me
-00009790: 7373 6167 6529 3b0a 2020 2020 2020 2020  ssage);.        
-000097a0: 2020 2020 7d0a 0a20 2020 2020 2020 2020      }..         
-000097b0: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
-000097c0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-000097d0: 2020 2069 6620 2827 5265 706c 792d 546f     if ('Reply-To
-000097e0: 2720 213d 3d20 246b 696e 6429 207b 0a20  ' !== $kind) {. 
-000097f0: 2020 2020 2020 2020 2020 2069 6620 2821             if (!
-00009800: 6172 7261 795f 6b65 795f 6578 6973 7473  array_key_exists
-00009810: 2873 7472 746f 6c6f 7765 7228 2461 6464  (strtolower($add
-00009820: 7265 7373 292c 2024 7468 6973 2d3e 616c  ress), $this->al
-00009830: 6c5f 7265 6369 7069 656e 7473 2929 207b  l_recipients)) {
-00009840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009850: 2024 7468 6973 2d3e 7b24 6b69 6e64 7d5b   $this->{$kind}[
-00009860: 5d20 3d20 5b24 6164 6472 6573 732c 2024  ] = [$address, $
-00009870: 6e61 6d65 5d3b 0a20 2020 2020 2020 2020  name];.         
-00009880: 2020 2020 2020 2024 7468 6973 2d3e 616c         $this->al
-00009890: 6c5f 7265 6369 7069 656e 7473 5b73 7472  l_recipients[str
-000098a0: 746f 6c6f 7765 7228 2461 6464 7265 7373  tolower($address
-000098b0: 295d 203d 2074 7275 653b 0a0a 2020 2020  )] = true;..    
-000098c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000098d0: 726e 2074 7275 653b 0a20 2020 2020 2020  rn true;.       
-000098e0: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
-000098f0: 2065 6c73 6569 6620 2821 6172 7261 795f   elseif (!array_
-00009900: 6b65 795f 6578 6973 7473 2873 7472 746f  key_exists(strto
-00009910: 6c6f 7765 7228 2461 6464 7265 7373 292c  lower($address),
-00009920: 2024 7468 6973 2d3e 5265 706c 7954 6f29   $this->ReplyTo)
-00009930: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00009940: 2474 6869 732d 3e52 6570 6c79 546f 5b73  $this->ReplyTo[s
-00009950: 7472 746f 6c6f 7765 7228 2461 6464 7265  trtolower($addre
-00009960: 7373 295d 203d 205b 2461 6464 7265 7373  ss)] = [$address
-00009970: 2c20 246e 616d 655d 3b0a 0a20 2020 2020  , $name];..     
-00009980: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
-00009990: 7565 3b0a 2020 2020 2020 2020 7d0a 0a20  ue;.        }.. 
-000099a0: 2020 2020 2020 2072 6574 7572 6e20 6661         return fa
-000099b0: 6c73 653b 0a20 2020 207d 0a0a 2020 2020  lse;.    }..    
-000099c0: 2f2a 2a0a 2020 2020 202a 2050 6172 7365  /**.     * Parse
-000099d0: 2061 6e64 2076 616c 6964 6174 6520 6120   and validate a 
-000099e0: 7374 7269 6e67 2063 6f6e 7461 696e 696e  string containin
-000099f0: 6720 6f6e 6520 6f72 206d 6f72 6520 5246  g one or more RF
-00009a00: 4338 3232 2d73 7479 6c65 2063 6f6d 6d61  C822-style comma
-00009a10: 2d73 6570 6172 6174 6564 2065 6d61 696c  -separated email
-00009a20: 2061 6464 7265 7373 6573 0a20 2020 2020   addresses.     
-00009a30: 2a20 6f66 2074 6865 2066 6f72 6d20 2264  * of the form "d
-00009a40: 6973 706c 6179 206e 616d 6520 3c61 6464  isplay name <add
-00009a50: 7265 7373 3e22 2069 6e74 6f20 616e 2061  ress>" into an a
-00009a60: 7272 6179 206f 6620 6e61 6d65 2f61 6464  rray of name/add
-00009a70: 7265 7373 2070 6169 7273 2e0a 2020 2020  ress pairs..    
-00009a80: 202a 2055 7365 7320 7468 6520 696d 6170   * Uses the imap
-00009a90: 5f72 6663 3832 325f 7061 7273 655f 6164  _rfc822_parse_ad
-00009aa0: 726c 6973 7420 6675 6e63 7469 6f6e 2069  rlist function i
-00009ab0: 6620 7468 6520 494d 4150 2065 7874 656e  f the IMAP exten
-00009ac0: 7369 6f6e 2069 7320 6176 6169 6c61 626c  sion is availabl
-00009ad0: 652e 0a20 2020 2020 2a20 4e6f 7465 2074  e..     * Note t
-00009ae0: 6861 7420 7175 6f74 6573 2069 6e20 7468  hat quotes in th
-00009af0: 6520 6e61 6d65 2070 6172 7420 6172 6520  e name part are 
-00009b00: 7265 6d6f 7665 642e 0a20 2020 2020 2a0a  removed..     *.
-00009b10: 2020 2020 202a 2040 7365 6520 6874 7470       * @see http
-00009b20: 3a2f 2f77 7777 2e61 6e64 7265 772e 636d  ://www.andrew.cm
-00009b30: 752e 6564 752f 7573 6572 2f61 6772 6565  u.edu/user/agree
-00009b40: 6e31 2f74 6573 7469 6e67 2f6d 7262 732f  n1/testing/mrbs/
-00009b50: 7765 622f 4d61 696c 2f52 4643 3832 322e  web/Mail/RFC822.
-00009b60: 7068 7020 4120 6d6f 7265 2063 6172 6566  php A more caref
-00009b70: 756c 2069 6d70 6c65 6d65 6e74 6174 696f  ul implementatio
-00009b80: 6e0a 2020 2020 202a 0a20 2020 2020 2a20  n.     *.     * 
-00009b90: 4070 6172 616d 2073 7472 696e 6720 2461  @param string $a
-00009ba0: 6464 7273 7472 2054 6865 2061 6464 7265  ddrstr The addre
-00009bb0: 7373 206c 6973 7420 7374 7269 6e67 0a20  ss list string. 
-00009bc0: 2020 2020 2a20 4070 6172 616d 2062 6f6f      * @param boo
-00009bd0: 6c20 2020 2475 7365 696d 6170 2057 6865  l   $useimap Whe
-00009be0: 7468 6572 2074 6f20 7573 6520 7468 6520  ther to use the 
-00009bf0: 494d 4150 2065 7874 656e 7369 6f6e 2074  IMAP extension t
-00009c00: 6f20 7061 7273 6520 7468 6520 6c69 7374  o parse the list
-00009c10: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00009c20: 7472 696e 6720 2463 6861 7273 6574 2054  tring $charset T
-00009c30: 6865 2063 6861 7273 6574 2074 6f20 7573  he charset to us
-00009c40: 6520 7768 656e 2064 6563 6f64 696e 6720  e when decoding 
-00009c50: 7468 6520 6164 6472 6573 7320 6c69 7374  the address list
-00009c60: 2073 7472 696e 672e 0a20 2020 2020 2a0a   string..     *.
-00009c70: 2020 2020 202a 2040 7265 7475 726e 2061       * @return a
-00009c80: 7272 6179 0a20 2020 2020 2a2f 0a20 2020  rray.     */.   
-00009c90: 2070 7562 6c69 6320 7374 6174 6963 2066   public static f
-00009ca0: 756e 6374 696f 6e20 7061 7273 6541 6464  unction parseAdd
-00009cb0: 7265 7373 6573 2824 6164 6472 7374 722c  resses($addrstr,
-00009cc0: 2024 7573 6569 6d61 7020 3d20 7472 7565   $useimap = true
-00009cd0: 2c20 2463 6861 7273 6574 203d 2073 656c  , $charset = sel
-00009ce0: 663a 3a43 4841 5253 4554 5f49 534f 3838  f::CHARSET_ISO88
-00009cf0: 3539 3129 0a20 2020 207b 0a20 2020 2020  591).    {.     
-00009d00: 2020 2024 6164 6472 6573 7365 7320 3d20     $addresses = 
-00009d10: 5b5d 3b0a 2020 2020 2020 2020 6966 2028  [];.        if (
-00009d20: 2475 7365 696d 6170 2026 2620 6675 6e63  $useimap && func
-00009d30: 7469 6f6e 5f65 7869 7374 7328 2769 6d61  tion_exists('ima
-00009d40: 705f 7266 6338 3232 5f70 6172 7365 5f61  p_rfc822_parse_a
-00009d50: 6472 6c69 7374 2729 2920 7b0a 2020 2020  drlist')) {.    
-00009d60: 2020 2020 2020 2020 2f2f 5573 6520 7468          //Use th
-00009d70: 6973 2062 7569 6c74 2d69 6e20 7061 7273  is built-in pars
-00009d80: 6572 2069 6620 6974 2773 2061 7661 696c  er if it's avail
-00009d90: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-00009da0: 2024 6c69 7374 203d 2069 6d61 705f 7266   $list = imap_rf
-00009db0: 6338 3232 5f70 6172 7365 5f61 6472 6c69  c822_parse_adrli
-00009dc0: 7374 2824 6164 6472 7374 722c 2027 2729  st($addrstr, '')
-00009dd0: 3b0a 2020 2020 2020 2020 2020 2020 2f2f  ;.            //
-00009de0: 2043 6c65 6172 2061 6e79 2070 6f74 656e   Clear any poten
-00009df0: 7469 616c 2049 4d41 5020 6572 726f 7273  tial IMAP errors
-00009e00: 2074 6f20 6765 7420 7269 6420 6f66 206e   to get rid of n
-00009e10: 6f74 6963 6573 2062 6569 6e67 2074 6872  otices being thr
-00009e20: 6f77 6e20 6174 2065 6e64 206f 6620 7363  own at end of sc
-00009e30: 7269 7074 2e0a 2020 2020 2020 2020 2020  ript..          
-00009e40: 2020 696d 6170 5f65 7272 6f72 7328 293b    imap_errors();
-00009e50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00009e60: 6561 6368 2028 246c 6973 7420 6173 2024  each ($list as $
-00009e70: 6164 6472 6573 7329 207b 0a20 2020 2020  address) {.     
-00009e80: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2020 2020 272e 5359 4e54 4158 2d45 5252      '.SYNTAX-ERR
-00009eb0: 4f52 2e27 2021 3d3d 2024 6164 6472 6573  OR.' !== $addres
-00009ec0: 732d 3e68 6f73 7420 2626 0a20 2020 2020  s->host &&.     
-00009ed0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009ee0: 7461 7469 633a 3a76 616c 6964 6174 6541  tatic::validateA
-00009ef0: 6464 7265 7373 2824 6164 6472 6573 732d  ddress($address-
-00009f00: 3e6d 6169 6c62 6f78 202e 2027 4027 202e  >mailbox . '@' .
-00009f10: 2024 6164 6472 6573 732d 3e68 6f73 7429   $address->host)
-00009f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009f30: 2029 207b 0a20 2020 2020 2020 2020 2020   ) {.           
-00009f40: 2020 2020 2020 2020 202f 2f44 6563 6f64           //Decod
-00009f50: 6520 7468 6520 6e61 6d65 2070 6172 7420  e the name part 
-00009f60: 6966 2069 7427 7320 7072 6573 656e 7420  if it's present 
-00009f70: 616e 6420 656e 636f 6465 640a 2020 2020  and encoded.    
-00009f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f90: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00009fa0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-00009fb0: 7065 7274 795f 6578 6973 7473 2824 6164  perty_exists($ad
-00009fc0: 6472 6573 732c 2027 7065 7273 6f6e 616c  dress, 'personal
-00009fd0: 2729 2026 260a 2020 2020 2020 2020 2020  ') &&.          
-00009fe0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00009ff0: 4368 6563 6b20 666f 7220 6120 4d62 7374  Check for a Mbst
-0000a000: 7269 6e67 2063 6f6e 7374 616e 7420 7261  ring constant ra
-0000a010: 7468 6572 2074 6861 6e20 7573 696e 6720  ther than using 
-0000a020: 6578 7465 6e73 696f 6e5f 6c6f 6164 6564  extension_loaded
-0000a030: 2c20 7768 6963 6820 6973 2073 6f6d 6574  , which is somet
-0000a040: 696d 6573 2064 6973 6162 6c65 640a 2020  imes disabled.  
-0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a060: 2020 2020 2020 6465 6669 6e65 6428 274d        defined('M
-0000a070: 425f 4341 5345 5f55 5050 4552 2729 2026  B_CASE_UPPER') &
-0000a080: 260a 2020 2020 2020 2020 2020 2020 2020  &.              
-0000a090: 2020 2020 2020 2020 2020 7072 6567 5f6d            preg_m
-0000a0a0: 6174 6368 2827 2f5e 3d5c 3f2e 2a5c 3f3d  atch('/^=\?.*\?=
-0000a0b0: 242f 7327 2c20 2461 6464 7265 7373 2d3e  $/s', $address->
-0000a0c0: 7065 7273 6f6e 616c 290a 2020 2020 2020  personal).      
-0000a0d0: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
-0000a0e0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0000a0f0: 2020 2020 2020 2020 2020 246f 7269 6743            $origC
-0000a100: 6861 7273 6574 203d 206d 625f 696e 7465  harset = mb_inte
-0000a110: 726e 616c 5f65 6e63 6f64 696e 6728 293b  rnal_encoding();
-0000a120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a130: 2020 2020 2020 2020 206d 625f 696e 7465           mb_inte
-0000a140: 726e 616c 5f65 6e63 6f64 696e 6728 2463  rnal_encoding($c
-0000a150: 6861 7273 6574 293b 0a20 2020 2020 2020  harset);.       
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a170: 202f 2f55 6e64 6f20 616e 7920 5246 4332   //Undo any RFC2
-0000a180: 3034 372d 656e 636f 6465 6420 7370 6163  047-encoded spac
-0000a190: 6573 2d61 732d 756e 6465 7273 636f 7265  es-as-underscore
-0000a1a0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0000a1b0: 2020 2020 2020 2020 2020 2461 6464 7265            $addre
-0000a1c0: 7373 2d3e 7065 7273 6f6e 616c 203d 2073  ss->personal = s
-0000a1d0: 7472 5f72 6570 6c61 6365 2827 5f27 2c20  tr_replace('_', 
-0000a1e0: 273d 3230 272c 2024 6164 6472 6573 732d  '=20', $address-
-0000a1f0: 3e70 6572 736f 6e61 6c29 3b0a 2020 2020  >personal);.    
+000056e0: 2020 2020 2020 2273 6d74 705f 7472 616e        "smtp_tran
+000056f0: 7361 6374 696f 6e5f 6964 2720 3d3e 206c  saction_id' => l
+00005700: 6173 7420 736d 7470 2074 7261 6e73 6163  ast smtp transac
+00005710: 7469 6f6e 2069 640a 2020 2020 202a 0a20  tion id.     *. 
+00005720: 2020 2020 2a20 4076 6172 2073 7472 696e      * @var strin
+00005730: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
+00005740: 626c 6963 2024 6163 7469 6f6e 5f66 756e  blic $action_fun
+00005750: 6374 696f 6e20 3d20 2727 3b0a 0a20 2020  ction = '';..   
+00005760: 202f 2a2a 0a20 2020 2020 2a20 5768 6174   /**.     * What
+00005770: 2074 6f20 7075 7420 696e 2074 6865 2058   to put in the X
+00005780: 2d4d 6169 6c65 7220 6865 6164 6572 2e0a  -Mailer header..
+00005790: 2020 2020 202a 204f 7074 696f 6e73 3a20       * Options: 
+000057a0: 416e 2065 6d70 7479 2073 7472 696e 6720  An empty string 
+000057b0: 666f 7220 5048 504d 6169 6c65 7220 6465  for PHPMailer de
+000057c0: 6661 756c 742c 2077 6869 7465 7370 6163  fault, whitespac
+000057d0: 652f 6e75 6c6c 2066 6f72 206e 6f6e 652c  e/null for none,
+000057e0: 206f 7220 6120 7374 7269 6e67 2074 6f20   or a string to 
+000057f0: 7573 652e 0a20 2020 2020 2a0a 2020 2020  use..     *.    
+00005800: 202a 2040 7661 7220 7374 7269 6e67 7c6e   * @var string|n
+00005810: 756c 6c0a 2020 2020 202a 2f0a 2020 2020  ull.     */.    
+00005820: 7075 626c 6963 2024 584d 6169 6c65 7220  public $XMailer 
+00005830: 3d20 2727 3b0a 0a20 2020 202f 2a2a 0a20  = '';..    /**. 
+00005840: 2020 2020 2a20 5768 6963 6820 7661 6c69      * Which vali
+00005850: 6461 746f 7220 746f 2075 7365 2062 7920  dator to use by 
+00005860: 6465 6661 756c 7420 7768 656e 2076 616c  default when val
+00005870: 6964 6174 696e 6720 656d 6169 6c20 6164  idating email ad
+00005880: 6472 6573 7365 732e 0a20 2020 2020 2a20  dresses..     * 
+00005890: 4d61 7920 6265 2061 2063 616c 6c61 626c  May be a callabl
+000058a0: 6520 746f 2069 6e6a 6563 7420 796f 7572  e to inject your
+000058b0: 206f 776e 2076 616c 6964 6174 6f72 2c20   own validator, 
+000058c0: 6275 7420 7468 6572 6520 6172 6520 7365  but there are se
+000058d0: 7665 7261 6c20 6275 696c 742d 696e 2076  veral built-in v
+000058e0: 616c 6964 6174 6f72 732e 0a20 2020 2020  alidators..     
+000058f0: 2a20 5468 6520 6465 6661 756c 7420 7661  * The default va
+00005900: 6c69 6461 746f 7220 7573 6573 2050 4850  lidator uses PHP
+00005910: 2773 2046 494c 5445 525f 5641 4c49 4441  's FILTER_VALIDA
+00005920: 5445 5f45 4d41 494c 2066 696c 7465 725f  TE_EMAIL filter_
+00005930: 7661 7220 6f70 7469 6f6e 2e0a 2020 2020  var option..    
+00005940: 202a 0a20 2020 2020 2a20 4073 6565 2050   *.     * @see P
+00005950: 4850 4d61 696c 6572 3a3a 7661 6c69 6461  HPMailer::valida
+00005960: 7465 4164 6472 6573 7328 290a 2020 2020  teAddress().    
+00005970: 202a 0a20 2020 2020 2a20 4076 6172 2073   *.     * @var s
+00005980: 7472 696e 677c 6361 6c6c 6162 6c65 0a20  tring|callable. 
+00005990: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+000059a0: 6320 7374 6174 6963 2024 7661 6c69 6461  c static $valida
+000059b0: 746f 7220 3d20 2770 6870 273b 0a0a 2020  tor = 'php';..  
+000059c0: 2020 2f2a 2a0a 2020 2020 202a 2041 6e20    /**.     * An 
+000059d0: 696e 7374 616e 6365 206f 6620 7468 6520  instance of the 
+000059e0: 534d 5450 2073 656e 6465 7220 636c 6173  SMTP sender clas
+000059f0: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
+00005a00: 2040 7661 7220 534d 5450 0a20 2020 2020   @var SMTP.     
+00005a10: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
+00005a20: 2024 736d 7470 3b0a 0a20 2020 202f 2a2a   $smtp;..    /**
+00005a30: 0a20 2020 2020 2a20 5468 6520 6172 7261  .     * The arra
+00005a40: 7920 6f66 2027 746f 2720 6e61 6d65 7320  y of 'to' names 
+00005a50: 616e 6420 6164 6472 6573 7365 732e 0a20  and addresses.. 
+00005a60: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+00005a70: 7220 6172 7261 790a 2020 2020 202a 2f0a  r array.     */.
+00005a80: 2020 2020 7072 6f74 6563 7465 6420 2474      protected $t
+00005a90: 6f20 3d20 5b5d 3b0a 0a20 2020 202f 2a2a  o = [];..    /**
+00005aa0: 0a20 2020 2020 2a20 5468 6520 6172 7261  .     * The arra
+00005ab0: 7920 6f66 2027 6363 2720 6e61 6d65 7320  y of 'cc' names 
+00005ac0: 616e 6420 6164 6472 6573 7365 732e 0a20  and addresses.. 
+00005ad0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+00005ae0: 7220 6172 7261 790a 2020 2020 202a 2f0a  r array.     */.
+00005af0: 2020 2020 7072 6f74 6563 7465 6420 2463      protected $c
+00005b00: 6320 3d20 5b5d 3b0a 0a20 2020 202f 2a2a  c = [];..    /**
+00005b10: 0a20 2020 2020 2a20 5468 6520 6172 7261  .     * The arra
+00005b20: 7920 6f66 2027 6263 6327 206e 616d 6573  y of 'bcc' names
+00005b30: 2061 6e64 2061 6464 7265 7373 6573 2e0a   and addresses..
+00005b40: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+00005b50: 6172 2061 7272 6179 0a20 2020 2020 2a2f  ar array.     */
+00005b60: 0a20 2020 2070 726f 7465 6374 6564 2024  .    protected $
+00005b70: 6263 6320 3d20 5b5d 3b0a 0a20 2020 202f  bcc = [];..    /
+00005b80: 2a2a 0a20 2020 2020 2a20 5468 6520 6172  **.     * The ar
+00005b90: 7261 7920 6f66 2072 6570 6c79 2d74 6f20  ray of reply-to 
+00005ba0: 6e61 6d65 7320 616e 6420 6164 6472 6573  names and addres
+00005bb0: 7365 732e 0a20 2020 2020 2a0a 2020 2020  ses..     *.    
+00005bc0: 202a 2040 7661 7220 6172 7261 790a 2020   * @var array.  
+00005bd0: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
+00005be0: 7465 6420 2452 6570 6c79 546f 203d 205b  ted $ReplyTo = [
+00005bf0: 5d3b 0a0a 2020 2020 2f2a 2a0a 2020 2020  ];..    /**.    
+00005c00: 202a 2041 6e20 6172 7261 7920 6f66 2061   * An array of a
+00005c10: 6c6c 206b 696e 6473 206f 6620 6164 6472  ll kinds of addr
+00005c20: 6573 7365 732e 0a20 2020 2020 2a20 496e  esses..     * In
+00005c30: 636c 7564 6573 2061 6c6c 206f 6620 2474  cludes all of $t
+00005c40: 6f2c 2024 6363 2c20 2462 6363 2e0a 2020  o, $cc, $bcc..  
+00005c50: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
+00005c60: 2050 4850 4d61 696c 6572 3a3a 2474 6f0a   PHPMailer::$to.
+00005c70: 2020 2020 202a 2040 7365 6520 5048 504d       * @see PHPM
+00005c80: 6169 6c65 723a 3a24 6363 0a20 2020 2020  ailer::$cc.     
+00005c90: 2a20 4073 6565 2050 4850 4d61 696c 6572  * @see PHPMailer
+00005ca0: 3a3a 2462 6363 0a20 2020 2020 2a0a 2020  ::$bcc.     *.  
+00005cb0: 2020 202a 2040 7661 7220 6172 7261 790a     * @var array.
+00005cc0: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
+00005cd0: 6563 7465 6420 2461 6c6c 5f72 6563 6970  ected $all_recip
+00005ce0: 6965 6e74 7320 3d20 5b5d 3b0a 0a20 2020  ients = [];..   
+00005cf0: 202f 2a2a 0a20 2020 2020 2a20 416e 2061   /**.     * An a
+00005d00: 7272 6179 206f 6620 6e61 6d65 7320 616e  rray of names an
+00005d10: 6420 6164 6472 6573 7365 7320 7175 6575  d addresses queu
+00005d20: 6564 2066 6f72 2076 616c 6964 6174 696f  ed for validatio
+00005d30: 6e2e 0a20 2020 2020 2a20 496e 2073 656e  n..     * In sen
+00005d40: 6428 292c 2076 616c 6964 2061 6e64 206e  d(), valid and n
+00005d50: 6f6e 2064 7570 6c69 6361 7465 2065 6e74  on duplicate ent
+00005d60: 7269 6573 2061 7265 206d 6f76 6564 2074  ries are moved t
+00005d70: 6f20 2461 6c6c 5f72 6563 6970 6965 6e74  o $all_recipient
+00005d80: 730a 2020 2020 202a 2061 6e64 206f 6e65  s.     * and one
+00005d90: 206f 6620 2474 6f2c 2024 6363 2c20 6f72   of $to, $cc, or
+00005da0: 2024 6263 632e 0a20 2020 2020 2a20 5468   $bcc..     * Th
+00005db0: 6973 2061 7272 6179 2069 7320 7573 6564  is array is used
+00005dc0: 206f 6e6c 7920 666f 7220 6164 6472 6573   only for addres
+00005dd0: 7365 7320 7769 7468 2049 444e 2e0a 2020  ses with IDN..  
+00005de0: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
+00005df0: 2050 4850 4d61 696c 6572 3a3a 2474 6f0a   PHPMailer::$to.
+00005e00: 2020 2020 202a 2040 7365 6520 5048 504d       * @see PHPM
+00005e10: 6169 6c65 723a 3a24 6363 0a20 2020 2020  ailer::$cc.     
+00005e20: 2a20 4073 6565 2050 4850 4d61 696c 6572  * @see PHPMailer
+00005e30: 3a3a 2462 6363 0a20 2020 2020 2a20 4073  ::$bcc.     * @s
+00005e40: 6565 2050 4850 4d61 696c 6572 3a3a 2461  ee PHPMailer::$a
+00005e50: 6c6c 5f72 6563 6970 6965 6e74 730a 2020  ll_recipients.  
+00005e60: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
+00005e70: 2061 7272 6179 0a20 2020 2020 2a2f 0a20   array.     */. 
+00005e80: 2020 2070 726f 7465 6374 6564 2024 5265     protected $Re
+00005e90: 6369 7069 656e 7473 5175 6575 6520 3d20  cipientsQueue = 
+00005ea0: 5b5d 3b0a 0a20 2020 202f 2a2a 0a20 2020  [];..    /**.   
+00005eb0: 2020 2a20 416e 2061 7272 6179 206f 6620    * An array of 
+00005ec0: 7265 706c 792d 746f 206e 616d 6573 2061  reply-to names a
+00005ed0: 6e64 2061 6464 7265 7373 6573 2071 7565  nd addresses que
+00005ee0: 7565 6420 666f 7220 7661 6c69 6461 7469  ued for validati
+00005ef0: 6f6e 2e0a 2020 2020 202a 2049 6e20 7365  on..     * In se
+00005f00: 6e64 2829 2c20 7661 6c69 6420 616e 6420  nd(), valid and 
+00005f10: 6e6f 6e20 6475 706c 6963 6174 6520 656e  non duplicate en
+00005f20: 7472 6965 7320 6172 6520 6d6f 7665 6420  tries are moved 
+00005f30: 746f 2024 5265 706c 7954 6f2e 0a20 2020  to $ReplyTo..   
+00005f40: 2020 2a20 5468 6973 2061 7272 6179 2069    * This array i
+00005f50: 7320 7573 6564 206f 6e6c 7920 666f 7220  s used only for 
+00005f60: 6164 6472 6573 7365 7320 7769 7468 2049  addresses with I
+00005f70: 444e 2e0a 2020 2020 202a 0a20 2020 2020  DN..     *.     
+00005f80: 2a20 4073 6565 2050 4850 4d61 696c 6572  * @see PHPMailer
+00005f90: 3a3a 2452 6570 6c79 546f 0a20 2020 2020  ::$ReplyTo.     
+00005fa0: 2a0a 2020 2020 202a 2040 7661 7220 6172  *.     * @var ar
+00005fb0: 7261 790a 2020 2020 202a 2f0a 2020 2020  ray.     */.    
+00005fc0: 7072 6f74 6563 7465 6420 2452 6570 6c79  protected $Reply
+00005fd0: 546f 5175 6575 6520 3d20 5b5d 3b0a 0a20  ToQueue = [];.. 
+00005fe0: 2020 202f 2a2a 0a20 2020 2020 2a20 5468     /**.     * Th
+00005ff0: 6520 6172 7261 7920 6f66 2061 7474 6163  e array of attac
+00006000: 686d 656e 7473 2e0a 2020 2020 202a 0a20  hments..     *. 
+00006010: 2020 2020 2a20 4076 6172 2061 7272 6179      * @var array
+00006020: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+00006030: 7465 6374 6564 2024 6174 7461 6368 6d65  tected $attachme
+00006040: 6e74 203d 205b 5d3b 0a0a 2020 2020 2f2a  nt = [];..    /*
+00006050: 2a0a 2020 2020 202a 2054 6865 2061 7272  *.     * The arr
+00006060: 6179 206f 6620 6375 7374 6f6d 2068 6561  ay of custom hea
+00006070: 6465 7273 2e0a 2020 2020 202a 0a20 2020  ders..     *.   
+00006080: 2020 2a20 4076 6172 2061 7272 6179 0a20    * @var array. 
+00006090: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
+000060a0: 6374 6564 2024 4375 7374 6f6d 4865 6164  cted $CustomHead
+000060b0: 6572 203d 205b 5d3b 0a0a 2020 2020 2f2a  er = [];..    /*
+000060c0: 2a0a 2020 2020 202a 2054 6865 206d 6f73  *.     * The mos
+000060d0: 7420 7265 6365 6e74 204d 6573 7361 6765  t recent Message
+000060e0: 2d49 4420 2869 6e63 6c75 6469 6e67 2061  -ID (including a
+000060f0: 6e67 756c 6172 2062 7261 636b 6574 7329  ngular brackets)
+00006100: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00006110: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
+00006120: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
+00006130: 6420 246c 6173 744d 6573 7361 6765 4944  d $lastMessageID
+00006140: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
+00006150: 2020 2020 202a 2054 6865 206d 6573 7361       * The messa
+00006160: 6765 2773 204d 494d 4520 7479 7065 2e0a  ge's MIME type..
+00006170: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+00006180: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
+00006190: 2f0a 2020 2020 7072 6f74 6563 7465 6420  /.    protected 
+000061a0: 246d 6573 7361 6765 5f74 7970 6520 3d20  $message_type = 
+000061b0: 2727 3b0a 0a20 2020 202f 2a2a 0a20 2020  '';..    /**.   
+000061c0: 2020 2a20 5468 6520 6172 7261 7920 6f66    * The array of
+000061d0: 204d 494d 4520 626f 756e 6461 7279 2073   MIME boundary s
+000061e0: 7472 696e 6773 2e0a 2020 2020 202a 0a20  trings..     *. 
+000061f0: 2020 2020 2a20 4076 6172 2061 7272 6179      * @var array
+00006200: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+00006210: 7465 6374 6564 2024 626f 756e 6461 7279  tected $boundary
+00006220: 203d 205b 5d3b 0a0a 2020 2020 2f2a 2a0a   = [];..    /**.
+00006230: 2020 2020 202a 2054 6865 2061 7272 6179       * The array
+00006240: 206f 6620 6176 6169 6c61 626c 6520 7465   of available te
+00006250: 7874 2073 7472 696e 6773 2066 6f72 2074  xt strings for t
+00006260: 6865 2063 7572 7265 6e74 206c 616e 6775  he current langu
+00006270: 6167 652e 0a20 2020 2020 2a0a 2020 2020  age..     *.    
+00006280: 202a 2040 7661 7220 6172 7261 790a 2020   * @var array.  
+00006290: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
+000062a0: 7465 6420 246c 616e 6775 6167 6520 3d20  ted $language = 
+000062b0: 5b5d 3b0a 0a20 2020 202f 2a2a 0a20 2020  [];..    /**.   
+000062c0: 2020 2a20 5468 6520 6e75 6d62 6572 206f    * The number o
+000062d0: 6620 6572 726f 7273 2065 6e63 6f75 6e74  f errors encount
+000062e0: 6572 6564 2e0a 2020 2020 202a 0a20 2020  ered..     *.   
+000062f0: 2020 2a20 4076 6172 2069 6e74 0a20 2020    * @var int.   
+00006300: 2020 2a2f 0a20 2020 2070 726f 7465 6374    */.    protect
+00006310: 6564 2024 6572 726f 725f 636f 756e 7420  ed $error_count 
+00006320: 3d20 303b 0a0a 2020 2020 2f2a 2a0a 2020  = 0;..    /**.  
+00006330: 2020 202a 2054 6865 2053 2f4d 494d 4520     * The S/MIME 
+00006340: 6365 7274 6966 6963 6174 6520 6669 6c65  certificate file
+00006350: 2070 6174 682e 0a20 2020 2020 2a0a 2020   path..     *.  
+00006360: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+00006370: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+00006380: 7465 6374 6564 2024 7369 676e 5f63 6572  tected $sign_cer
+00006390: 745f 6669 6c65 203d 2027 273b 0a0a 2020  t_file = '';..  
+000063a0: 2020 2f2a 2a0a 2020 2020 202a 2054 6865    /**.     * The
+000063b0: 2053 2f4d 494d 4520 6b65 7920 6669 6c65   S/MIME key file
+000063c0: 2070 6174 682e 0a20 2020 2020 2a0a 2020   path..     *.  
+000063d0: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+000063e0: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+000063f0: 7465 6374 6564 2024 7369 676e 5f6b 6579  tected $sign_key
+00006400: 5f66 696c 6520 3d20 2727 3b0a 0a20 2020  _file = '';..   
+00006410: 202f 2a2a 0a20 2020 2020 2a20 5468 6520   /**.     * The 
+00006420: 6f70 7469 6f6e 616c 2053 2f4d 494d 4520  optional S/MIME 
+00006430: 6578 7472 6120 6365 7274 6966 6963 6174  extra certificat
+00006440: 6573 2028 2243 4120 4368 6169 6e22 2920  es ("CA Chain") 
+00006450: 6669 6c65 2070 6174 682e 0a20 2020 2020  file path..     
+00006460: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
+00006470: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
+00006480: 2070 726f 7465 6374 6564 2024 7369 676e   protected $sign
+00006490: 5f65 7874 7261 6365 7274 735f 6669 6c65  _extracerts_file
+000064a0: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
+000064b0: 2020 2020 202a 2054 6865 2053 2f4d 494d       * The S/MIM
+000064c0: 4520 7061 7373 776f 7264 2066 6f72 2074  E password for t
+000064d0: 6865 206b 6579 2e0a 2020 2020 202a 2055  he key..     * U
+000064e0: 7365 6420 6f6e 6c79 2069 6620 7468 6520  sed only if the 
+000064f0: 6b65 7920 6973 2065 6e63 7279 7074 6564  key is encrypted
+00006500: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00006510: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
+00006520: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
+00006530: 6420 2473 6967 6e5f 6b65 795f 7061 7373  d $sign_key_pass
+00006540: 203d 2027 273b 0a0a 2020 2020 2f2a 2a0a   = '';..    /**.
+00006550: 2020 2020 202a 2057 6865 7468 6572 2074       * Whether t
+00006560: 6f20 7468 726f 7720 6578 6365 7074 696f  o throw exceptio
+00006570: 6e73 2066 6f72 2065 7272 6f72 732e 0a20  ns for errors.. 
+00006580: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+00006590: 7220 626f 6f6c 0a20 2020 2020 2a2f 0a20  r bool.     */. 
+000065a0: 2020 2070 726f 7465 6374 6564 2024 6578     protected $ex
+000065b0: 6365 7074 696f 6e73 203d 2066 616c 7365  ceptions = false
+000065c0: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
+000065d0: 2a20 556e 6971 7565 2049 4420 7573 6564  * Unique ID used
+000065e0: 2066 6f72 206d 6573 7361 6765 2049 4420   for message ID 
+000065f0: 616e 6420 626f 756e 6461 7269 6573 2e0a  and boundaries..
+00006600: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+00006610: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
+00006620: 2f0a 2020 2020 7072 6f74 6563 7465 6420  /.    protected 
+00006630: 2475 6e69 7175 6569 6420 3d20 2727 3b0a  $uniqueid = '';.
+00006640: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00006650: 5468 6520 5048 504d 6169 6c65 7220 5665  The PHPMailer Ve
+00006660: 7273 696f 6e20 6e75 6d62 6572 2e0a 2020  rsion number..  
+00006670: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
+00006680: 2073 7472 696e 670a 2020 2020 202a 2f0a   string.     */.
+00006690: 2020 2020 636f 6e73 7420 5645 5253 494f      const VERSIO
+000066a0: 4e20 3d20 2736 2e39 2e31 273b 0a0a 2020  N = '6.9.1';..  
+000066b0: 2020 2f2a 2a0a 2020 2020 202a 2045 7272    /**.     * Err
+000066c0: 6f72 2073 6576 6572 6974 793a 206d 6573  or severity: mes
+000066d0: 7361 6765 206f 6e6c 792c 2063 6f6e 7469  sage only, conti
+000066e0: 6e75 6520 7072 6f63 6573 7369 6e67 2e0a  nue processing..
+000066f0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+00006700: 6172 2069 6e74 0a20 2020 2020 2a2f 0a20  ar int.     */. 
+00006710: 2020 2063 6f6e 7374 2053 544f 505f 4d45     const STOP_ME
+00006720: 5353 4147 4520 3d20 303b 0a0a 2020 2020  SSAGE = 0;..    
+00006730: 2f2a 2a0a 2020 2020 202a 2045 7272 6f72  /**.     * Error
+00006740: 2073 6576 6572 6974 793a 206d 6573 7361   severity: messa
+00006750: 6765 2c20 6c69 6b65 6c79 206f 6b20 746f  ge, likely ok to
+00006760: 2063 6f6e 7469 6e75 6520 7072 6f63 6573   continue proces
+00006770: 7369 6e67 2e0a 2020 2020 202a 0a20 2020  sing..     *.   
+00006780: 2020 2a20 4076 6172 2069 6e74 0a20 2020    * @var int.   
+00006790: 2020 2a2f 0a20 2020 2063 6f6e 7374 2053    */.    const S
+000067a0: 544f 505f 434f 4e54 494e 5545 203d 2031  TOP_CONTINUE = 1
+000067b0: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
+000067c0: 2a20 4572 726f 7220 7365 7665 7269 7479  * Error severity
+000067d0: 3a20 6d65 7373 6167 652c 2070 6c75 7320  : message, plus 
+000067e0: 6675 6c6c 2073 746f 702c 2063 7269 7469  full stop, criti
+000067f0: 6361 6c20 6572 726f 7220 7265 6163 6865  cal error reache
+00006800: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
+00006810: 2040 7661 7220 696e 740a 2020 2020 202a   @var int.     *
+00006820: 2f0a 2020 2020 636f 6e73 7420 5354 4f50  /.    const STOP
+00006830: 5f43 5249 5449 4341 4c20 3d20 323b 0a0a  _CRITICAL = 2;..
+00006840: 2020 2020 2f2a 2a0a 2020 2020 202a 2054      /**.     * T
+00006850: 6865 2053 4d54 5020 7374 616e 6461 7264  he SMTP standard
+00006860: 2043 524c 4620 6c69 6e65 2062 7265 616b   CRLF line break
+00006870: 2e0a 2020 2020 202a 2049 6620 796f 7520  ..     * If you 
+00006880: 7761 6e74 2074 6f20 6368 616e 6765 206c  want to change l
+00006890: 696e 6520 6272 6561 6b20 666f 726d 6174  ine break format
+000068a0: 2c20 6368 616e 6765 2073 7461 7469 633a  , change static:
+000068b0: 3a24 4c45 2c20 6e6f 7420 7468 6973 2e0a  :$LE, not this..
+000068c0: 2020 2020 202a 2f0a 2020 2020 636f 6e73       */.    cons
+000068d0: 7420 4352 4c46 203d 2022 5c72 5c6e 223b  t CRLF = "\r\n";
+000068e0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+000068f0: 2022 466f 6c64 696e 6720 5768 6974 6520   "Folding White 
+00006900: 5370 6163 6522 2061 2077 6869 7465 2073  Space" a white s
+00006910: 7061 6365 2073 7472 696e 6720 7573 6564  pace string used
+00006920: 2066 6f72 206c 696e 6520 666f 6c64 696e   for line foldin
+00006930: 672e 0a20 2020 2020 2a2f 0a20 2020 2063  g..     */.    c
+00006940: 6f6e 7374 2046 5753 203d 2027 2027 3b0a  onst FWS = ' ';.
+00006950: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00006960: 534d 5450 2052 4643 2073 7461 6e64 6172  SMTP RFC standar
+00006970: 6420 6c69 6e65 2065 6e64 696e 673b 2043  d line ending; C
+00006980: 6172 7269 6167 6520 5265 7475 726e 2c20  arriage Return, 
+00006990: 4c69 6e65 2046 6565 642e 0a20 2020 2020  Line Feed..     
+000069a0: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
+000069b0: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
+000069c0: 2070 726f 7465 6374 6564 2073 7461 7469   protected stati
+000069d0: 6320 244c 4520 3d20 7365 6c66 3a3a 4352  c $LE = self::CR
+000069e0: 4c46 3b0a 0a20 2020 202f 2a2a 0a20 2020  LF;..    /**.   
+000069f0: 2020 2a20 5468 6520 6d61 7869 6d75 6d20    * The maximum 
+00006a00: 6c69 6e65 206c 656e 6774 6820 7375 7070  line length supp
+00006a10: 6f72 7465 6420 6279 206d 6169 6c28 292e  orted by mail().
+00006a20: 0a20 2020 2020 2a0a 2020 2020 202a 2042  .     *.     * B
+00006a30: 6163 6b67 726f 756e 643a 206d 6169 6c28  ackground: mail(
+00006a40: 2920 7769 6c6c 2073 6f6d 6574 696d 6573  ) will sometimes
+00006a50: 2063 6f72 7275 7074 206d 6573 7361 6765   corrupt message
+00006a60: 730a 2020 2020 202a 2077 6974 6820 6865  s.     * with he
+00006a70: 6164 6572 7320 6c6f 6e67 6572 2074 6861  aders longer tha
+00006a80: 6e20 3635 2063 6861 7273 2c20 7365 6520  n 65 chars, see 
+00006a90: 2338 3138 2e0a 2020 2020 202a 0a20 2020  #818..     *.   
+00006aa0: 2020 2a20 4076 6172 2069 6e74 0a20 2020    * @var int.   
+00006ab0: 2020 2a2f 0a20 2020 2063 6f6e 7374 204d    */.    const M
+00006ac0: 4149 4c5f 4d41 585f 4c49 4e45 5f4c 454e  AIL_MAX_LINE_LEN
+00006ad0: 4754 4820 3d20 3633 3b0a 0a20 2020 202f  GTH = 63;..    /
+00006ae0: 2a2a 0a20 2020 2020 2a20 5468 6520 6d61  **.     * The ma
+00006af0: 7869 6d75 6d20 6c69 6e65 206c 656e 6774  ximum line lengt
+00006b00: 6820 616c 6c6f 7765 6420 6279 2052 4643  h allowed by RFC
+00006b10: 2032 3832 3220 7365 6374 696f 6e20 322e   2822 section 2.
+00006b20: 312e 312e 0a20 2020 2020 2a0a 2020 2020  1.1..     *.    
+00006b30: 202a 2040 7661 7220 696e 740a 2020 2020   * @var int.    
+00006b40: 202a 2f0a 2020 2020 636f 6e73 7420 4d41   */.    const MA
+00006b50: 585f 4c49 4e45 5f4c 454e 4754 4820 3d20  X_LINE_LENGTH = 
+00006b60: 3939 383b 0a0a 2020 2020 2f2a 2a0a 2020  998;..    /**.  
+00006b70: 2020 202a 2054 6865 206c 6f77 6572 206d     * The lower m
+00006b80: 6178 696d 756d 206c 696e 6520 6c65 6e67  aximum line leng
+00006b90: 7468 2061 6c6c 6f77 6564 2062 7920 5246  th allowed by RF
+00006ba0: 4320 3238 3232 2073 6563 7469 6f6e 2032  C 2822 section 2
+00006bb0: 2e31 2e31 2e0a 2020 2020 202a 2054 6869  .1.1..     * Thi
+00006bc0: 7320 6c65 6e67 7468 2064 6f65 7320 4e4f  s length does NO
+00006bd0: 5420 696e 636c 7564 6520 7468 6520 6c69  T include the li
+00006be0: 6e65 2062 7265 616b 0a20 2020 2020 2a20  ne break.     * 
+00006bf0: 3736 206d 6561 6e73 2074 6861 7420 6c69  76 means that li
+00006c00: 6e65 7320 7769 6c6c 2062 6520 3737 206f  nes will be 77 o
+00006c10: 7220 3738 2063 6861 7273 2064 6570 656e  r 78 chars depen
+00006c20: 6469 6e67 206f 6e20 7768 6574 6865 720a  ding on whether.
+00006c30: 2020 2020 202a 2074 6865 206c 696e 6520       * the line 
+00006c40: 6272 6561 6b20 666f 726d 6174 2069 7320  break format is 
+00006c50: 4c46 206f 7220 4352 4c46 3b20 626f 7468  LF or CRLF; both
+00006c60: 2061 7265 2076 616c 6964 2e0a 2020 2020   are valid..    
+00006c70: 202a 0a20 2020 2020 2a20 4076 6172 2069   *.     * @var i
+00006c80: 6e74 0a20 2020 2020 2a2f 0a20 2020 2063  nt.     */.    c
+00006c90: 6f6e 7374 2053 5444 5f4c 494e 455f 4c45  onst STD_LINE_LE
+00006ca0: 4e47 5448 203d 2037 363b 0a0a 2020 2020  NGTH = 76;..    
+00006cb0: 2f2a 2a0a 2020 2020 202a 2043 6f6e 7374  /**.     * Const
+00006cc0: 7275 6374 6f72 2e0a 2020 2020 202a 0a20  ructor..     *. 
+00006cd0: 2020 2020 2a20 4070 6172 616d 2062 6f6f      * @param boo
+00006ce0: 6c20 2465 7863 6570 7469 6f6e 7320 5368  l $exceptions Sh
+00006cf0: 6f75 6c64 2077 6520 7468 726f 7720 6578  ould we throw ex
+00006d00: 7465 726e 616c 2065 7863 6570 7469 6f6e  ternal exception
+00006d10: 733f 0a20 2020 2020 2a2f 0a20 2020 2070  s?.     */.    p
+00006d20: 7562 6c69 6320 6675 6e63 7469 6f6e 205f  ublic function _
+00006d30: 5f63 6f6e 7374 7275 6374 2824 6578 6365  _construct($exce
+00006d40: 7074 696f 6e73 203d 206e 756c 6c29 0a20  ptions = null). 
+00006d50: 2020 207b 0a20 2020 2020 2020 2069 6620     {.        if 
+00006d60: 286e 756c 6c20 213d 3d20 2465 7863 6570  (null !== $excep
+00006d70: 7469 6f6e 7329 207b 0a20 2020 2020 2020  tions) {.       
+00006d80: 2020 2020 2024 7468 6973 2d3e 6578 6365       $this->exce
+00006d90: 7074 696f 6e73 203d 2028 626f 6f6c 2920  ptions = (bool) 
+00006da0: 2465 7863 6570 7469 6f6e 733b 0a20 2020  $exceptions;.   
+00006db0: 2020 2020 207d 0a20 2020 2020 2020 202f       }.        /
+00006dc0: 2f50 6963 6b20 616e 2061 7070 726f 7072  /Pick an appropr
+00006dd0: 6961 7465 2064 6562 7567 206f 7574 7075  iate debug outpu
+00006de0: 7420 666f 726d 6174 2061 7574 6f6d 6174  t format automat
+00006df0: 6963 616c 6c79 0a20 2020 2020 2020 2024  ically.        $
+00006e00: 7468 6973 2d3e 4465 6275 676f 7574 7075  this->Debugoutpu
+00006e10: 7420 3d20 2873 7472 706f 7328 5048 505f  t = (strpos(PHP_
+00006e20: 5341 5049 2c20 2763 6c69 2729 2021 3d3d  SAPI, 'cli') !==
+00006e30: 2066 616c 7365 203f 2027 6563 686f 2720   false ? 'echo' 
+00006e40: 3a20 2768 746d 6c27 293b 0a20 2020 207d  : 'html');.    }
+00006e50: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00006e60: 2044 6573 7472 7563 746f 722e 0a20 2020   Destructor..   
+00006e70: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00006e80: 6675 6e63 7469 6f6e 205f 5f64 6573 7472  function __destr
+00006e90: 7563 7428 290a 2020 2020 7b0a 2020 2020  uct().    {.    
+00006ea0: 2020 2020 2f2f 436c 6f73 6520 616e 7920      //Close any 
+00006eb0: 6f70 656e 2053 4d54 5020 636f 6e6e 6563  open SMTP connec
+00006ec0: 7469 6f6e 206e 6963 656c 790a 2020 2020  tion nicely.    
+00006ed0: 2020 2020 2474 6869 732d 3e73 6d74 7043      $this->smtpC
+00006ee0: 6c6f 7365 2829 3b0a 2020 2020 7d0a 0a20  lose();.    }.. 
+00006ef0: 2020 202f 2a2a 0a20 2020 2020 2a20 4361     /**.     * Ca
+00006f00: 6c6c 206d 6169 6c28 2920 696e 2061 2073  ll mail() in a s
+00006f10: 6166 655f 6d6f 6465 2d61 7761 7265 2066  afe_mode-aware f
+00006f20: 6173 6869 6f6e 2e0a 2020 2020 202a 2041  ashion..     * A
+00006f30: 6c73 6f2c 2075 6e6c 6573 7320 7365 6e64  lso, unless send
+00006f40: 6d61 696c 5f70 6174 6820 706f 696e 7473  mail_path points
+00006f50: 2074 6f20 7365 6e64 6d61 696c 2028 6f72   to sendmail (or
+00006f60: 2073 6f6d 6574 6869 6e67 2074 6861 740a   something that.
+00006f70: 2020 2020 202a 2063 6c61 696d 7320 746f       * claims to
+00006f80: 2062 6520 7365 6e64 6d61 696c 292c 2064   be sendmail), d
+00006f90: 6f6e 2774 2070 6173 7320 7061 7261 6d73  on't pass params
+00006fa0: 2028 6e6f 7420 6120 7065 7266 6563 7420   (not a perfect 
+00006fb0: 6669 782c 0a20 2020 2020 2a20 6275 7420  fix,.     * but 
+00006fc0: 6974 2077 696c 6c20 646f 292e 0a20 2020  it will do)..   
+00006fd0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
+00006fe0: 6d20 7374 7269 6e67 2020 2020 2020 2474  m string      $t
+00006ff0: 6f20 2020 2020 2054 6f0a 2020 2020 202a  o      To.     *
+00007000: 2040 7061 7261 6d20 7374 7269 6e67 2020   @param string  
+00007010: 2020 2020 2473 7562 6a65 6374 2053 7562      $subject Sub
+00007020: 6a65 6374 0a20 2020 2020 2a20 4070 6172  ject.     * @par
+00007030: 616d 2073 7472 696e 6720 2020 2020 2024  am string      $
+00007040: 626f 6479 2020 2020 4d65 7373 6167 6520  body    Message 
+00007050: 426f 6479 0a20 2020 2020 2a20 4070 6172  Body.     * @par
+00007060: 616d 2073 7472 696e 6720 2020 2020 2024  am string      $
+00007070: 6865 6164 6572 2020 4164 6469 7469 6f6e  header  Addition
+00007080: 616c 2048 6561 6465 7228 7329 0a20 2020  al Header(s).   
+00007090: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+000070a0: 677c 6e75 6c6c 2024 7061 7261 6d73 2020  g|null $params  
+000070b0: 5061 7261 6d73 0a20 2020 2020 2a0a 2020  Params.     *.  
+000070c0: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
+000070d0: 6c0a 2020 2020 202a 2f0a 2020 2020 7072  l.     */.    pr
+000070e0: 6976 6174 6520 6675 6e63 7469 6f6e 206d  ivate function m
+000070f0: 6169 6c50 6173 7374 6872 7528 2474 6f2c  ailPassthru($to,
+00007100: 2024 7375 626a 6563 742c 2024 626f 6479   $subject, $body
+00007110: 2c20 2468 6561 6465 722c 2024 7061 7261  , $header, $para
+00007120: 6d73 290a 2020 2020 7b0a 2020 2020 2020  ms).    {.      
+00007130: 2020 2f2f 4368 6563 6b20 6f76 6572 6c6f    //Check overlo
+00007140: 6164 696e 6720 6f66 206d 6169 6c20 6675  ading of mail fu
+00007150: 6e63 7469 6f6e 2074 6f20 6176 6f69 6420  nction to avoid 
+00007160: 646f 7562 6c65 2d65 6e63 6f64 696e 670a  double-encoding.
+00007170: 2020 2020 2020 2020 6966 2028 2869 6e74          if ((int
+00007180: 2969 6e69 5f67 6574 2827 6d62 7374 7269  )ini_get('mbstri
+00007190: 6e67 2e66 756e 635f 6f76 6572 6c6f 6164  ng.func_overload
+000071a0: 2729 2026 2031 2920 7b0a 2020 2020 2020  ') & 1) {.      
+000071b0: 2020 2020 2020 2473 7562 6a65 6374 203d        $subject =
+000071c0: 2024 7468 6973 2d3e 7365 6375 7265 4865   $this->secureHe
+000071d0: 6164 6572 2824 7375 626a 6563 7429 3b0a  ader($subject);.
+000071e0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
+000071f0: 0a20 2020 2020 2020 2020 2020 2024 7375  .            $su
+00007200: 626a 6563 7420 3d20 2474 6869 732d 3e65  bject = $this->e
+00007210: 6e63 6f64 6548 6561 6465 7228 2474 6869  ncodeHeader($thi
+00007220: 732d 3e73 6563 7572 6548 6561 6465 7228  s->secureHeader(
+00007230: 2473 7562 6a65 6374 2929 3b0a 2020 2020  $subject));.    
+00007240: 2020 2020 7d0a 2020 2020 2020 2020 2f2f      }.        //
+00007250: 4361 6c6c 696e 6720 6d61 696c 2829 2077  Calling mail() w
+00007260: 6974 6820 6e75 6c6c 2070 6172 616d 7320  ith null params 
+00007270: 6272 6561 6b73 0a20 2020 2020 2020 2024  breaks.        $
+00007280: 7468 6973 2d3e 6564 6562 7567 2827 5365  this->edebug('Se
+00007290: 6e64 696e 6720 7769 7468 206d 6169 6c28  nding with mail(
+000072a0: 2927 293b 0a20 2020 2020 2020 2024 7468  )');.        $th
+000072b0: 6973 2d3e 6564 6562 7567 2827 5365 6e64  is->edebug('Send
+000072c0: 6d61 696c 2070 6174 683a 2027 202e 2069  mail path: ' . i
+000072d0: 6e69 5f67 6574 2827 7365 6e64 6d61 696c  ni_get('sendmail
+000072e0: 5f70 6174 6827 2929 3b0a 2020 2020 2020  _path'));.      
+000072f0: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
+00007300: 2245 6e76 656c 6f70 6520 7365 6e64 6572  "Envelope sender
+00007310: 3a20 7b24 7468 6973 2d3e 5365 6e64 6572  : {$this->Sender
+00007320: 7d22 293b 0a20 2020 2020 2020 2024 7468  }");.        $th
+00007330: 6973 2d3e 6564 6562 7567 2822 546f 3a20  is->edebug("To: 
+00007340: 7b24 746f 7d22 293b 0a20 2020 2020 2020  {$to}");.       
+00007350: 2024 7468 6973 2d3e 6564 6562 7567 2822   $this->edebug("
+00007360: 5375 626a 6563 743a 207b 2473 7562 6a65  Subject: {$subje
+00007370: 6374 7d22 293b 0a20 2020 2020 2020 2024  ct}");.        $
+00007380: 7468 6973 2d3e 6564 6562 7567 2822 4865  this->edebug("He
+00007390: 6164 6572 733a 207b 2468 6561 6465 727d  aders: {$header}
+000073a0: 2229 3b0a 2020 2020 2020 2020 6966 2028  ");.        if (
+000073b0: 2124 7468 6973 2d3e 5573 6553 656e 646d  !$this->UseSendm
+000073c0: 6169 6c4f 7074 696f 6e73 207c 7c20 6e75  ailOptions || nu
+000073d0: 6c6c 203d 3d3d 2024 7061 7261 6d73 2920  ll === $params) 
+000073e0: 7b0a 2020 2020 2020 2020 2020 2020 2472  {.            $r
+000073f0: 6573 756c 7420 3d20 406d 6169 6c28 2474  esult = @mail($t
+00007400: 6f2c 2024 7375 626a 6563 742c 2024 626f  o, $subject, $bo
+00007410: 6479 2c20 2468 6561 6465 7229 3b0a 2020  dy, $header);.  
+00007420: 2020 2020 2020 7d20 656c 7365 207b 0a20        } else {. 
+00007430: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00007440: 2d3e 6564 6562 7567 2822 4164 6469 7469  ->edebug("Additi
+00007450: 6f6e 616c 2070 6172 616d 733a 207b 2470  onal params: {$p
+00007460: 6172 616d 737d 2229 3b0a 2020 2020 2020  arams}");.      
+00007470: 2020 2020 2020 2472 6573 756c 7420 3d20        $result = 
+00007480: 406d 6169 6c28 2474 6f2c 2024 7375 626a  @mail($to, $subj
+00007490: 6563 742c 2024 626f 6479 2c20 2468 6561  ect, $body, $hea
+000074a0: 6465 722c 2024 7061 7261 6d73 293b 0a20  der, $params);. 
+000074b0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000074c0: 2024 7468 6973 2d3e 6564 6562 7567 2827   $this->edebug('
+000074d0: 5265 7375 6c74 3a20 2720 2e20 2824 7265  Result: ' . ($re
+000074e0: 7375 6c74 203f 2027 7472 7565 2720 3a20  sult ? 'true' : 
+000074f0: 2766 616c 7365 2729 293b 0a20 2020 2020  'false'));.     
+00007500: 2020 2072 6574 7572 6e20 2472 6573 756c     return $resul
+00007510: 743b 0a20 2020 207d 0a0a 2020 2020 2f2a  t;.    }..    /*
+00007520: 2a0a 2020 2020 202a 204f 7574 7075 7420  *.     * Output 
+00007530: 6465 6275 6767 696e 6720 696e 666f 2076  debugging info v
+00007540: 6961 2061 2075 7365 722d 6465 6669 6e65  ia a user-define
+00007550: 6420 6d65 7468 6f64 2e0a 2020 2020 202a  d method..     *
+00007560: 204f 6e6c 7920 6765 6e65 7261 7465 7320   Only generates 
+00007570: 6f75 7470 7574 2069 6620 6465 6275 6720  output if debug 
+00007580: 6f75 7470 7574 2069 7320 656e 6162 6c65  output is enable
+00007590: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
+000075a0: 2040 7365 6520 5048 504d 6169 6c65 723a   @see PHPMailer:
+000075b0: 3a24 4465 6275 676f 7574 7075 740a 2020  :$Debugoutput.  
+000075c0: 2020 202a 2040 7365 6520 5048 504d 6169     * @see PHPMai
+000075d0: 6c65 723a 3a24 534d 5450 4465 6275 670a  ler::$SMTPDebug.
+000075e0: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
+000075f0: 6172 616d 2073 7472 696e 6720 2473 7472  aram string $str
+00007600: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+00007610: 7465 6374 6564 2066 756e 6374 696f 6e20  tected function 
+00007620: 6564 6562 7567 2824 7374 7229 0a20 2020  edebug($str).   
+00007630: 207b 0a20 2020 2020 2020 2069 6620 2824   {.        if ($
+00007640: 7468 6973 2d3e 534d 5450 4465 6275 6720  this->SMTPDebug 
+00007650: 3c3d 2030 2920 7b0a 2020 2020 2020 2020  <= 0) {.        
+00007660: 2020 2020 7265 7475 726e 3b0a 2020 2020      return;.    
+00007670: 2020 2020 7d0a 2020 2020 2020 2020 2f2f      }.        //
+00007680: 4973 2074 6869 7320 6120 5053 522d 3320  Is this a PSR-3 
+00007690: 6c6f 6767 6572 3f0a 2020 2020 2020 2020  logger?.        
+000076a0: 6966 2028 2474 6869 732d 3e44 6562 7567  if ($this->Debug
+000076b0: 6f75 7470 7574 2069 6e73 7461 6e63 656f  output instanceo
+000076c0: 6620 5c50 7372 5c4c 6f67 5c4c 6f67 6765  f \Psr\Log\Logge
+000076d0: 7249 6e74 6572 6661 6365 2920 7b0a 2020  rInterface) {.  
+000076e0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+000076f0: 3e44 6562 7567 6f75 7470 7574 2d3e 6465  >Debugoutput->de
+00007700: 6275 6728 2473 7472 293b 0a0a 2020 2020  bug($str);..    
+00007710: 2020 2020 2020 2020 7265 7475 726e 3b0a          return;.
+00007720: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00007730: 2020 2f2f 4176 6f69 6420 636c 6173 6820    //Avoid clash 
+00007740: 7769 7468 2062 7569 6c74 2d69 6e20 6675  with built-in fu
+00007750: 6e63 7469 6f6e 206e 616d 6573 0a20 2020  nction names.   
+00007760: 2020 2020 2069 6620 2869 735f 6361 6c6c       if (is_call
+00007770: 6162 6c65 2824 7468 6973 2d3e 4465 6275  able($this->Debu
+00007780: 676f 7574 7075 7429 2026 2620 2169 6e5f  goutput) && !in_
+00007790: 6172 7261 7928 2474 6869 732d 3e44 6562  array($this->Deb
+000077a0: 7567 6f75 7470 7574 2c20 5b27 6572 726f  ugoutput, ['erro
+000077b0: 725f 6c6f 6727 2c20 2768 746d 6c27 2c20  r_log', 'html', 
+000077c0: 2765 6368 6f27 5d29 2920 7b0a 2020 2020  'echo'])) {.    
+000077d0: 2020 2020 2020 2020 6361 6c6c 5f75 7365          call_use
+000077e0: 725f 6675 6e63 2824 7468 6973 2d3e 4465  r_func($this->De
+000077f0: 6275 676f 7574 7075 742c 2024 7374 722c  bugoutput, $str,
+00007800: 2024 7468 6973 2d3e 534d 5450 4465 6275   $this->SMTPDebu
+00007810: 6729 3b0a 0a20 2020 2020 2020 2020 2020  g);..           
+00007820: 2072 6574 7572 6e3b 0a20 2020 2020 2020   return;.       
+00007830: 207d 0a20 2020 2020 2020 2073 7769 7463   }.        switc
+00007840: 6820 2824 7468 6973 2d3e 4465 6275 676f  h ($this->Debugo
+00007850: 7574 7075 7429 207b 0a20 2020 2020 2020  utput) {.       
+00007860: 2020 2020 2063 6173 6520 2765 7272 6f72       case 'error
+00007870: 5f6c 6f67 273a 0a20 2020 2020 2020 2020  _log':.         
+00007880: 2020 2020 2020 202f 2f44 6f6e 2774 206f         //Don't o
+00007890: 7574 7075 742c 206a 7573 7420 6c6f 670a  utput, just log.
+000078a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078b0: 2f2a 2a20 406e 6f69 6e73 7065 6374 696f  /** @noinspectio
+000078c0: 6e20 466f 7267 6f74 7465 6e44 6562 7567  n ForgottenDebug
+000078d0: 4f75 7470 7574 496e 7370 6563 7469 6f6e  OutputInspection
+000078e0: 202a 2f0a 2020 2020 2020 2020 2020 2020   */.            
+000078f0: 2020 2020 6572 726f 725f 6c6f 6728 2473      error_log($s
+00007900: 7472 293b 0a20 2020 2020 2020 2020 2020  tr);.           
+00007910: 2020 2020 2062 7265 616b 3b0a 2020 2020       break;.    
+00007920: 2020 2020 2020 2020 6361 7365 2027 6874          case 'ht
+00007930: 6d6c 273a 0a20 2020 2020 2020 2020 2020  ml':.           
+00007940: 2020 2020 202f 2f43 6c65 616e 7320 7570       //Cleans up
+00007950: 206f 7574 7075 7420 6120 6269 7420 666f   output a bit fo
+00007960: 7220 6120 6265 7474 6572 206c 6f6f 6b69  r a better looki
+00007970: 6e67 2c20 4854 4d4c 2d73 6166 6520 6f75  ng, HTML-safe ou
+00007980: 7470 7574 0a20 2020 2020 2020 2020 2020  tput.           
+00007990: 2020 2020 2065 6368 6f20 6874 6d6c 656e       echo htmlen
+000079a0: 7469 7469 6573 280a 2020 2020 2020 2020  tities(.        
+000079b0: 2020 2020 2020 2020 2020 2020 7072 6567              preg
+000079c0: 5f72 6570 6c61 6365 2827 2f5b 5c72 5c6e  _replace('/[\r\n
+000079d0: 5d2b 2f27 2c20 2727 2c20 2473 7472 292c  ]+/', '', $str),
+000079e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000079f0: 2020 2020 2045 4e54 5f51 554f 5445 532c       ENT_QUOTES,
+00007a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007a10: 2020 2020 2027 5554 462d 3827 0a20 2020       'UTF-8'.   
+00007a20: 2020 2020 2020 2020 2020 2020 2029 2c20               ), 
+00007a30: 223c 6272 3e5c 6e22 3b0a 2020 2020 2020  "<br>\n";.      
+00007a40: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
+00007a50: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
+00007a60: 6520 2765 6368 6f27 3a0a 2020 2020 2020  e 'echo':.      
+00007a70: 2020 2020 2020 6465 6661 756c 743a 0a20        default:. 
+00007a80: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+00007a90: 2f4e 6f72 6d61 6c69 7a65 206c 696e 6520  /Normalize line 
+00007aa0: 6272 6561 6b73 0a20 2020 2020 2020 2020  breaks.         
+00007ab0: 2020 2020 2020 2024 7374 7220 3d20 7072         $str = pr
+00007ac0: 6567 5f72 6570 6c61 6365 2827 2f5c 725c  eg_replace('/\r\
+00007ad0: 6e7c 5c72 2f6d 272c 2022 5c6e 222c 2024  n|\r/m', "\n", $
+00007ae0: 7374 7229 3b0a 2020 2020 2020 2020 2020  str);.          
+00007af0: 2020 2020 2020 6563 686f 2067 6d64 6174        echo gmdat
+00007b00: 6528 2759 2d6d 2d64 2048 3a69 3a73 2729  e('Y-m-d H:i:s')
+00007b10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007b20: 2020 225c 7422 2c0a 2020 2020 2020 2020    "\t",.        
+00007b30: 2020 2020 2020 2020 2020 2020 2f2f 5472              //Tr
+00007b40: 696d 2074 7261 696c 696e 6720 7370 6163  im trailing spac
+00007b50: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00007b60: 2020 7472 696d 280a 2020 2020 2020 2020    trim(.        
+00007b70: 2020 2020 2020 2020 2020 2020 2f2f 496e              //In
+00007b80: 6465 6e74 2066 6f72 2072 6561 6461 6269  dent for readabi
+00007b90: 6c69 7479 2c20 6578 6365 7074 2066 6f72  lity, except for
+00007ba0: 2074 7261 696c 696e 6720 6272 6561 6b0a   trailing break.
+00007bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007bc0: 2020 2020 7374 725f 7265 706c 6163 6528      str_replace(
+00007bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007be0: 2020 2020 2020 2020 2022 5c6e 222c 0a20           "\n",. 
+00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c00: 2020 2020 2020 2022 5c6e 2020 2020 2020         "\n      
+00007c10: 2020 2020 2020 2020 2020 2020 205c 7420               \t 
+00007c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c30: 2022 2c0a 2020 2020 2020 2020 2020 2020   ",.            
+00007c40: 2020 2020 2020 2020 2020 2020 7472 696d              trim
+00007c50: 2824 7374 7229 0a20 2020 2020 2020 2020  ($str).         
+00007c60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00007c70: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+00007c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c90: 225c 6e22 3b0a 2020 2020 2020 2020 7d0a  "\n";.        }.
+00007ca0: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+00007cb0: 2020 2020 2a20 5365 7473 206d 6573 7361      * Sets messa
+00007cc0: 6765 2074 7970 6520 746f 2048 544d 4c20  ge type to HTML 
+00007cd0: 6f72 2070 6c61 696e 2e0a 2020 2020 202a  or plain..     *
+00007ce0: 0a20 2020 2020 2a20 4070 6172 616d 2062  .     * @param b
+00007cf0: 6f6f 6c20 2469 7348 746d 6c20 5472 7565  ool $isHtml True
+00007d00: 2066 6f72 2048 544d 4c20 6d6f 6465 0a20   for HTML mode. 
+00007d10: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00007d20: 6320 6675 6e63 7469 6f6e 2069 7348 544d  c function isHTM
+00007d30: 4c28 2469 7348 746d 6c20 3d20 7472 7565  L($isHtml = true
+00007d40: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+00007d50: 6966 2028 2469 7348 746d 6c29 207b 0a20  if ($isHtml) {. 
+00007d60: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00007d70: 2d3e 436f 6e74 656e 7454 7970 6520 3d20  ->ContentType = 
+00007d80: 7374 6174 6963 3a3a 434f 4e54 454e 545f  static::CONTENT_
+00007d90: 5459 5045 5f54 4558 545f 4854 4d4c 3b0a  TYPE_TEXT_HTML;.
+00007da0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
+00007db0: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
+00007dc0: 6973 2d3e 436f 6e74 656e 7454 7970 6520  is->ContentType 
+00007dd0: 3d20 7374 6174 6963 3a3a 434f 4e54 454e  = static::CONTEN
+00007de0: 545f 5459 5045 5f50 4c41 494e 5445 5854  T_TYPE_PLAINTEXT
+00007df0: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00007e00: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00007e10: 2a20 5365 6e64 206d 6573 7361 6765 7320  * Send messages 
+00007e20: 7573 696e 6720 534d 5450 2e0a 2020 2020  using SMTP..    
+00007e30: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
+00007e40: 756e 6374 696f 6e20 6973 534d 5450 2829  unction isSMTP()
+00007e50: 0a20 2020 207b 0a20 2020 2020 2020 2024  .    {.        $
+00007e60: 7468 6973 2d3e 4d61 696c 6572 203d 2027  this->Mailer = '
+00007e70: 736d 7470 273b 0a20 2020 207d 0a0a 2020  smtp';.    }..  
+00007e80: 2020 2f2a 2a0a 2020 2020 202a 2053 656e    /**.     * Sen
+00007e90: 6420 6d65 7373 6167 6573 2075 7369 6e67  d messages using
+00007ea0: 2050 4850 2773 206d 6169 6c28 2920 6675   PHP's mail() fu
+00007eb0: 6e63 7469 6f6e 2e0a 2020 2020 202a 2f0a  nction..     */.
+00007ec0: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+00007ed0: 696f 6e20 6973 4d61 696c 2829 0a20 2020  ion isMail().   
+00007ee0: 207b 0a20 2020 2020 2020 2024 7468 6973   {.        $this
+00007ef0: 2d3e 4d61 696c 6572 203d 2027 6d61 696c  ->Mailer = 'mail
+00007f00: 273b 0a20 2020 207d 0a0a 2020 2020 2f2a  ';.    }..    /*
+00007f10: 2a0a 2020 2020 202a 2053 656e 6420 6d65  *.     * Send me
+00007f20: 7373 6167 6573 2075 7369 6e67 2024 5365  ssages using $Se
+00007f30: 6e64 6d61 696c 2e0a 2020 2020 202a 2f0a  ndmail..     */.
+00007f40: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+00007f50: 696f 6e20 6973 5365 6e64 6d61 696c 2829  ion isSendmail()
+00007f60: 0a20 2020 207b 0a20 2020 2020 2020 2024  .    {.        $
+00007f70: 696e 695f 7365 6e64 6d61 696c 5f70 6174  ini_sendmail_pat
+00007f80: 6820 3d20 696e 695f 6765 7428 2773 656e  h = ini_get('sen
+00007f90: 646d 6169 6c5f 7061 7468 2729 3b0a 0a20  dmail_path');.. 
+00007fa0: 2020 2020 2020 2069 6620 2866 616c 7365         if (false
+00007fb0: 203d 3d3d 2073 7472 6970 6f73 2824 696e   === stripos($in
+00007fc0: 695f 7365 6e64 6d61 696c 5f70 6174 682c  i_sendmail_path,
+00007fd0: 2027 7365 6e64 6d61 696c 2729 2920 7b0a   'sendmail')) {.
+00007fe0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+00007ff0: 732d 3e53 656e 646d 6169 6c20 3d20 272f  s->Sendmail = '/
+00008000: 7573 722f 7362 696e 2f73 656e 646d 6169  usr/sbin/sendmai
+00008010: 6c27 3b0a 2020 2020 2020 2020 7d20 656c  l';.        } el
+00008020: 7365 207b 0a20 2020 2020 2020 2020 2020  se {.           
+00008030: 2024 7468 6973 2d3e 5365 6e64 6d61 696c   $this->Sendmail
+00008040: 203d 2024 696e 695f 7365 6e64 6d61 696c   = $ini_sendmail
+00008050: 5f70 6174 683b 0a20 2020 2020 2020 207d  _path;.        }
+00008060: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+00008070: 4d61 696c 6572 203d 2027 7365 6e64 6d61  Mailer = 'sendma
+00008080: 696c 273b 0a20 2020 207d 0a0a 2020 2020  il';.    }..    
+00008090: 2f2a 2a0a 2020 2020 202a 2053 656e 6420  /**.     * Send 
+000080a0: 6d65 7373 6167 6573 2075 7369 6e67 2071  messages using q
+000080b0: 6d61 696c 2e0a 2020 2020 202a 2f0a 2020  mail..     */.  
+000080c0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+000080d0: 6e20 6973 516d 6169 6c28 290a 2020 2020  n isQmail().    
+000080e0: 7b0a 2020 2020 2020 2020 2469 6e69 5f73  {.        $ini_s
+000080f0: 656e 646d 6169 6c5f 7061 7468 203d 2069  endmail_path = i
+00008100: 6e69 5f67 6574 2827 7365 6e64 6d61 696c  ni_get('sendmail
+00008110: 5f70 6174 6827 293b 0a0a 2020 2020 2020  _path');..      
+00008120: 2020 6966 2028 6661 6c73 6520 3d3d 3d20    if (false === 
+00008130: 7374 7269 706f 7328 2469 6e69 5f73 656e  stripos($ini_sen
+00008140: 646d 6169 6c5f 7061 7468 2c20 2771 6d61  dmail_path, 'qma
+00008150: 696c 2729 2920 7b0a 2020 2020 2020 2020  il')) {.        
+00008160: 2020 2020 2474 6869 732d 3e53 656e 646d      $this->Sendm
+00008170: 6169 6c20 3d20 272f 7661 722f 716d 6169  ail = '/var/qmai
+00008180: 6c2f 6269 6e2f 716d 6169 6c2d 696e 6a65  l/bin/qmail-inje
+00008190: 6374 273b 0a20 2020 2020 2020 207d 2065  ct';.        } e
+000081a0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
+000081b0: 2020 2474 6869 732d 3e53 656e 646d 6169    $this->Sendmai
+000081c0: 6c20 3d20 2469 6e69 5f73 656e 646d 6169  l = $ini_sendmai
+000081d0: 6c5f 7061 7468 3b0a 2020 2020 2020 2020  l_path;.        
+000081e0: 7d0a 2020 2020 2020 2020 2474 6869 732d  }.        $this-
+000081f0: 3e4d 6169 6c65 7220 3d20 2771 6d61 696c  >Mailer = 'qmail
+00008200: 273b 0a20 2020 207d 0a0a 2020 2020 2f2a  ';.    }..    /*
+00008210: 2a0a 2020 2020 202a 2041 6464 2061 2022  *.     * Add a "
+00008220: 546f 2220 6164 6472 6573 732e 0a20 2020  To" address..   
+00008230: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
+00008240: 6d20 7374 7269 6e67 2024 6164 6472 6573  m string $addres
+00008250: 7320 5468 6520 656d 6169 6c20 6164 6472  s The email addr
+00008260: 6573 7320 746f 2073 656e 6420 746f 0a20  ess to send to. 
+00008270: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00008280: 696e 6720 246e 616d 650a 2020 2020 202a  ing $name.     *
+00008290: 0a20 2020 2020 2a20 4074 6872 6f77 7320  .     * @throws 
+000082a0: 4578 6365 7074 696f 6e0a 2020 2020 202a  Exception.     *
+000082b0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+000082c0: 626f 6f6c 2074 7275 6520 6f6e 2073 7563  bool true on suc
+000082d0: 6365 7373 2c20 6661 6c73 6520 6966 2061  cess, false if a
+000082e0: 6464 7265 7373 2061 6c72 6561 6479 2075  ddress already u
+000082f0: 7365 6420 6f72 2069 6e76 616c 6964 2069  sed or invalid i
+00008300: 6e20 736f 6d65 2077 6179 0a20 2020 2020  n some way.     
+00008310: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+00008320: 6e63 7469 6f6e 2061 6464 4164 6472 6573  nction addAddres
+00008330: 7328 2461 6464 7265 7373 2c20 246e 616d  s($address, $nam
+00008340: 6520 3d20 2727 290a 2020 2020 7b0a 2020  e = '').    {.  
+00008350: 2020 2020 2020 7265 7475 726e 2024 7468        return $th
+00008360: 6973 2d3e 6164 644f 7245 6e71 7565 7565  is->addOrEnqueue
+00008370: 416e 4164 6472 6573 7328 2774 6f27 2c20  AnAddress('to', 
+00008380: 2461 6464 7265 7373 2c20 246e 616d 6529  $address, $name)
+00008390: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+000083a0: 0a20 2020 2020 2a20 4164 6420 6120 2243  .     * Add a "C
+000083b0: 4322 2061 6464 7265 7373 2e0a 2020 2020  C" address..    
+000083c0: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+000083d0: 2073 7472 696e 6720 2461 6464 7265 7373   string $address
+000083e0: 2054 6865 2065 6d61 696c 2061 6464 7265   The email addre
+000083f0: 7373 2074 6f20 7365 6e64 2074 6f0a 2020  ss to send to.  
+00008400: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00008410: 6e67 2024 6e61 6d65 0a20 2020 2020 2a0a  ng $name.     *.
+00008420: 2020 2020 202a 2040 7468 726f 7773 2045       * @throws E
+00008430: 7863 6570 7469 6f6e 0a20 2020 2020 2a0a  xception.     *.
+00008440: 2020 2020 202a 2040 7265 7475 726e 2062       * @return b
+00008450: 6f6f 6c20 7472 7565 206f 6e20 7375 6363  ool true on succ
+00008460: 6573 732c 2066 616c 7365 2069 6620 6164  ess, false if ad
+00008470: 6472 6573 7320 616c 7265 6164 7920 7573  dress already us
+00008480: 6564 206f 7220 696e 7661 6c69 6420 696e  ed or invalid in
+00008490: 2073 6f6d 6520 7761 790a 2020 2020 202a   some way.     *
+000084a0: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+000084b0: 6374 696f 6e20 6164 6443 4328 2461 6464  ction addCC($add
+000084c0: 7265 7373 2c20 246e 616d 6520 3d20 2727  ress, $name = ''
+000084d0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+000084e0: 7265 7475 726e 2024 7468 6973 2d3e 6164  return $this->ad
+000084f0: 644f 7245 6e71 7565 7565 416e 4164 6472  dOrEnqueueAnAddr
+00008500: 6573 7328 2763 6327 2c20 2461 6464 7265  ess('cc', $addre
+00008510: 7373 2c20 246e 616d 6529 3b0a 2020 2020  ss, $name);.    
+00008520: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00008530: 2a20 4164 6420 6120 2242 4343 2220 6164  * Add a "BCC" ad
+00008540: 6472 6573 732e 0a20 2020 2020 2a0a 2020  dress..     *.  
+00008550: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00008560: 6e67 2024 6164 6472 6573 7320 5468 6520  ng $address The 
+00008570: 656d 6169 6c20 6164 6472 6573 7320 746f  email address to
+00008580: 2073 656e 6420 746f 0a20 2020 2020 2a20   send to.     * 
+00008590: 4070 6172 616d 2073 7472 696e 6720 246e  @param string $n
+000085a0: 616d 650a 2020 2020 202a 0a20 2020 2020  ame.     *.     
+000085b0: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
+000085c0: 696f 6e0a 2020 2020 202a 0a20 2020 2020  ion.     *.     
+000085d0: 2a20 4072 6574 7572 6e20 626f 6f6c 2074  * @return bool t
+000085e0: 7275 6520 6f6e 2073 7563 6365 7373 2c20  rue on success, 
+000085f0: 6661 6c73 6520 6966 2061 6464 7265 7373  false if address
+00008600: 2061 6c72 6561 6479 2075 7365 6420 6f72   already used or
+00008610: 2069 6e76 616c 6964 2069 6e20 736f 6d65   invalid in some
+00008620: 2077 6179 0a20 2020 2020 2a2f 0a20 2020   way.     */.   
+00008630: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+00008640: 2061 6464 4243 4328 2461 6464 7265 7373   addBCC($address
+00008650: 2c20 246e 616d 6520 3d20 2727 290a 2020  , $name = '').  
+00008660: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
+00008670: 726e 2024 7468 6973 2d3e 6164 644f 7245  rn $this->addOrE
+00008680: 6e71 7565 7565 416e 4164 6472 6573 7328  nqueueAnAddress(
+00008690: 2762 6363 272c 2024 6164 6472 6573 732c  'bcc', $address,
+000086a0: 2024 6e61 6d65 293b 0a20 2020 207d 0a0a   $name);.    }..
+000086b0: 2020 2020 2f2a 2a0a 2020 2020 202a 2041      /**.     * A
+000086c0: 6464 2061 2022 5265 706c 792d 546f 2220  dd a "Reply-To" 
+000086d0: 6164 6472 6573 732e 0a20 2020 2020 2a0a  address..     *.
+000086e0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+000086f0: 7269 6e67 2024 6164 6472 6573 7320 5468  ring $address Th
+00008700: 6520 656d 6169 6c20 6164 6472 6573 7320  e email address 
+00008710: 746f 2072 6570 6c79 2074 6f0a 2020 2020  to reply to.    
+00008720: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00008730: 2024 6e61 6d65 0a20 2020 2020 2a0a 2020   $name.     *.  
+00008740: 2020 202a 2040 7468 726f 7773 2045 7863     * @throws Exc
+00008750: 6570 7469 6f6e 0a20 2020 2020 2a0a 2020  eption.     *.  
+00008760: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
+00008770: 6c20 7472 7565 206f 6e20 7375 6363 6573  l true on succes
+00008780: 732c 2066 616c 7365 2069 6620 6164 6472  s, false if addr
+00008790: 6573 7320 616c 7265 6164 7920 7573 6564  ess already used
+000087a0: 206f 7220 696e 7661 6c69 6420 696e 2073   or invalid in s
+000087b0: 6f6d 6520 7761 790a 2020 2020 202a 2f0a  ome way.     */.
+000087c0: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+000087d0: 696f 6e20 6164 6452 6570 6c79 546f 2824  ion addReplyTo($
+000087e0: 6164 6472 6573 732c 2024 6e61 6d65 203d  address, $name =
+000087f0: 2027 2729 0a20 2020 207b 0a20 2020 2020   '').    {.     
+00008800: 2020 2072 6574 7572 6e20 2474 6869 732d     return $this-
+00008810: 3e61 6464 4f72 456e 7175 6575 6541 6e41  >addOrEnqueueAnA
+00008820: 6464 7265 7373 2827 5265 706c 792d 546f  ddress('Reply-To
+00008830: 272c 2024 6164 6472 6573 732c 2024 6e61  ', $address, $na
+00008840: 6d65 293b 0a20 2020 207d 0a0a 2020 2020  me);.    }..    
+00008850: 2f2a 2a0a 2020 2020 202a 2041 6464 2061  /**.     * Add a
+00008860: 6e20 6164 6472 6573 7320 746f 206f 6e65  n address to one
+00008870: 206f 6620 7468 6520 7265 6369 7069 656e   of the recipien
+00008880: 7420 6172 7261 7973 206f 7220 746f 2074  t arrays or to t
+00008890: 6865 2052 6570 6c79 546f 2061 7272 6179  he ReplyTo array
+000088a0: 2e20 4265 6361 7573 6520 5048 504d 6169  . Because PHPMai
+000088b0: 6c65 720a 2020 2020 202a 2063 616e 2774  ler.     * can't
+000088c0: 2076 616c 6964 6174 6520 6164 6472 6573   validate addres
+000088d0: 7365 7320 7769 7468 2061 6e20 4944 4e20  ses with an IDN 
+000088e0: 7769 7468 6f75 7420 6b6e 6f77 696e 6720  without knowing 
+000088f0: 7468 6520 5048 504d 6169 6c65 723a 3a24  the PHPMailer::$
+00008900: 4368 6172 5365 7420 2874 6861 7420 6361  CharSet (that ca
+00008910: 6e20 7374 696c 6c0a 2020 2020 202a 2062  n still.     * b
+00008920: 6520 6d6f 6469 6669 6564 2061 6674 6572  e modified after
+00008930: 2063 616c 6c69 6e67 2074 6869 7320 6675   calling this fu
+00008940: 6e63 7469 6f6e 292c 2061 6464 6974 696f  nction), additio
+00008950: 6e20 6f66 2073 7563 6820 6164 6472 6573  n of such addres
+00008960: 7365 7320 6973 2064 656c 6179 6564 2075  ses is delayed u
+00008970: 6e74 696c 2073 656e 6428 292e 0a20 2020  ntil send()..   
+00008980: 2020 2a20 4164 6472 6573 7365 7320 7468    * Addresses th
+00008990: 6174 2068 6176 6520 6265 656e 2061 6464  at have been add
+000089a0: 6564 2061 6c72 6561 6479 2072 6574 7572  ed already retur
+000089b0: 6e20 6661 6c73 652c 2062 7574 2064 6f20  n false, but do 
+000089c0: 6e6f 7420 7468 726f 7720 6578 6365 7074  not throw except
+000089d0: 696f 6e73 2e0a 2020 2020 202a 0a20 2020  ions..     *.   
+000089e0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+000089f0: 6720 246b 696e 6420 2020 204f 6e65 206f  g $kind    One o
+00008a00: 6620 2774 6f27 2c20 2763 6327 2c20 2762  f 'to', 'cc', 'b
+00008a10: 6363 272c 206f 7220 2752 6570 6c79 546f  cc', or 'ReplyTo
+00008a20: 270a 2020 2020 202a 2040 7061 7261 6d20  '.     * @param 
+00008a30: 7374 7269 6e67 2024 6164 6472 6573 7320  string $address 
+00008a40: 5468 6520 656d 6169 6c20 6164 6472 6573  The email addres
+00008a50: 730a 2020 2020 202a 2040 7061 7261 6d20  s.     * @param 
+00008a60: 7374 7269 6e67 2024 6e61 6d65 2020 2020  string $name    
+00008a70: 416e 206f 7074 696f 6e61 6c20 7573 6572  An optional user
+00008a80: 6e61 6d65 2061 7373 6f63 6961 7465 6420  name associated 
+00008a90: 7769 7468 2074 6865 2061 6464 7265 7373  with the address
+00008aa0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00008ab0: 7468 726f 7773 2045 7863 6570 7469 6f6e  throws Exception
+00008ac0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00008ad0: 7265 7475 726e 2062 6f6f 6c20 7472 7565  return bool true
+00008ae0: 206f 6e20 7375 6363 6573 732c 2066 616c   on success, fal
+00008af0: 7365 2069 6620 6164 6472 6573 7320 616c  se if address al
+00008b00: 7265 6164 7920 7573 6564 206f 7220 696e  ready used or in
+00008b10: 7661 6c69 6420 696e 2073 6f6d 6520 7761  valid in some wa
+00008b20: 790a 2020 2020 202a 2f0a 2020 2020 7072  y.     */.    pr
+00008b30: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+00008b40: 2061 6464 4f72 456e 7175 6575 6541 6e41   addOrEnqueueAnA
+00008b50: 6464 7265 7373 2824 6b69 6e64 2c20 2461  ddress($kind, $a
+00008b60: 6464 7265 7373 2c20 246e 616d 6529 0a20  ddress, $name). 
+00008b70: 2020 207b 0a20 2020 2020 2020 2024 706f     {.        $po
+00008b80: 7320 3d20 6661 6c73 653b 0a20 2020 2020  s = false;.     
+00008b90: 2020 2069 6620 2824 6164 6472 6573 7320     if ($address 
+00008ba0: 213d 3d20 6e75 6c6c 2920 7b0a 2020 2020  !== null) {.    
+00008bb0: 2020 2020 2020 2020 2461 6464 7265 7373          $address
+00008bc0: 203d 2074 7269 6d28 2461 6464 7265 7373   = trim($address
+00008bd0: 293b 0a20 2020 2020 2020 2020 2020 2024  );.            $
+00008be0: 706f 7320 3d20 7374 7272 706f 7328 2461  pos = strrpos($a
+00008bf0: 6464 7265 7373 2c20 2740 2729 3b0a 2020  ddress, '@');.  
+00008c00: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00008c10: 6966 2028 6661 6c73 6520 3d3d 3d20 2470  if (false === $p
+00008c20: 6f73 2920 7b0a 2020 2020 2020 2020 2020  os) {.          
+00008c30: 2020 2f2f 4174 2d73 6967 6e20 6973 206d    //At-sign is m
+00008c40: 6973 7369 6e67 2e0a 2020 2020 2020 2020  issing..        
+00008c50: 2020 2020 2465 7272 6f72 5f6d 6573 7361      $error_messa
+00008c60: 6765 203d 2073 7072 696e 7466 280a 2020  ge = sprintf(.  
+00008c70: 2020 2020 2020 2020 2020 2020 2020 2725                '%
+00008c80: 7320 2825 7329 3a20 2573 272c 0a20 2020  s (%s): %s',.   
+00008c90: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+00008ca0: 6973 2d3e 6c61 6e67 2827 696e 7661 6c69  is->lang('invali
+00008cb0: 645f 6164 6472 6573 7327 292c 0a20 2020  d_address'),.   
+00008cc0: 2020 2020 2020 2020 2020 2020 2024 6b69               $ki
+00008cd0: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
+00008ce0: 2020 2020 2461 6464 7265 7373 0a20 2020      $address.   
+00008cf0: 2020 2020 2020 2020 2029 3b0a 2020 2020           );.    
+00008d00: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
+00008d10: 6574 4572 726f 7228 2465 7272 6f72 5f6d  etError($error_m
+00008d20: 6573 7361 6765 293b 0a20 2020 2020 2020  essage);.       
+00008d30: 2020 2020 2024 7468 6973 2d3e 6564 6562       $this->edeb
+00008d40: 7567 2824 6572 726f 725f 6d65 7373 6167  ug($error_messag
+00008d50: 6529 3b0a 2020 2020 2020 2020 2020 2020  e);.            
+00008d60: 6966 2028 2474 6869 732d 3e65 7863 6570  if ($this->excep
+00008d70: 7469 6f6e 7329 207b 0a20 2020 2020 2020  tions) {.       
+00008d80: 2020 2020 2020 2020 2074 6872 6f77 206e           throw n
+00008d90: 6577 2045 7863 6570 7469 6f6e 2824 6572  ew Exception($er
+00008da0: 726f 725f 6d65 7373 6167 6529 3b0a 2020  ror_message);.  
+00008db0: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+00008dc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008dd0: 6661 6c73 653b 0a20 2020 2020 2020 207d  false;.        }
+00008de0: 0a20 2020 2020 2020 2069 6620 2824 6e61  .        if ($na
+00008df0: 6d65 2021 3d3d 206e 756c 6c20 2626 2069  me !== null && i
+00008e00: 735f 7374 7269 6e67 2824 6e61 6d65 2929  s_string($name))
+00008e10: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+00008e20: 6e61 6d65 203d 2074 7269 6d28 7072 6567  name = trim(preg
+00008e30: 5f72 6570 6c61 6365 2827 2f5b 5c72 5c6e  _replace('/[\r\n
+00008e40: 5d2b 2f27 2c20 2727 2c20 246e 616d 6529  ]+/', '', $name)
+00008e50: 293b 202f 2f53 7472 6970 2062 7265 616b  ); //Strip break
+00008e60: 7320 616e 6420 7472 696d 0a20 2020 2020  s and trim.     
+00008e70: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
+00008e80: 2020 2020 2020 2020 246e 616d 6520 3d20          $name = 
+00008e90: 2727 3b0a 2020 2020 2020 2020 7d0a 2020  '';.        }.  
+00008ea0: 2020 2020 2020 2470 6172 616d 7320 3d20        $params = 
+00008eb0: 5b24 6b69 6e64 2c20 2461 6464 7265 7373  [$kind, $address
+00008ec0: 2c20 246e 616d 655d 3b0a 2020 2020 2020  , $name];.      
+00008ed0: 2020 2f2f 456e 7175 6575 6520 6164 6472    //Enqueue addr
+00008ee0: 6573 7365 7320 7769 7468 2049 444e 2075  esses with IDN u
+00008ef0: 6e74 696c 2077 6520 6b6e 6f77 2074 6865  ntil we know the
+00008f00: 2050 4850 4d61 696c 6572 3a3a 2443 6861   PHPMailer::$Cha
+00008f10: 7253 6574 2e0a 2020 2020 2020 2020 2f2f  rSet..        //
+00008f20: 446f 6d61 696e 2069 7320 6173 7375 6d65  Domain is assume
+00008f30: 6420 746f 2062 6520 7768 6174 6576 6572  d to be whatever
+00008f40: 2069 7320 6166 7465 7220 7468 6520 6c61   is after the la
+00008f50: 7374 2040 2073 796d 626f 6c20 696e 2074  st @ symbol in t
+00008f60: 6865 2061 6464 7265 7373 0a20 2020 2020  he address.     
+00008f70: 2020 2069 6620 2873 7461 7469 633a 3a69     if (static::i
+00008f80: 646e 5375 7070 6f72 7465 6428 2920 2626  dnSupported() &&
+00008f90: 2024 7468 6973 2d3e 6861 7338 6269 7443   $this->has8bitC
+00008fa0: 6861 7273 2873 7562 7374 7228 2461 6464  hars(substr($add
+00008fb0: 7265 7373 2c20 2b2b 2470 6f73 2929 2920  ress, ++$pos))) 
+00008fc0: 7b0a 2020 2020 2020 2020 2020 2020 6966  {.            if
+00008fd0: 2028 2752 6570 6c79 2d54 6f27 2021 3d3d   ('Reply-To' !==
+00008fe0: 2024 6b69 6e64 2920 7b0a 2020 2020 2020   $kind) {.      
+00008ff0: 2020 2020 2020 2020 2020 6966 2028 2161            if (!a
+00009000: 7272 6179 5f6b 6579 5f65 7869 7374 7328  rray_key_exists(
+00009010: 2461 6464 7265 7373 2c20 2474 6869 732d  $address, $this-
+00009020: 3e52 6563 6970 6965 6e74 7351 7565 7565  >RecipientsQueue
+00009030: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00009040: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00009050: 5265 6369 7069 656e 7473 5175 6575 655b  RecipientsQueue[
+00009060: 2461 6464 7265 7373 5d20 3d20 2470 6172  $address] = $par
+00009070: 616d 733b 0a0a 2020 2020 2020 2020 2020  ams;..          
+00009080: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009090: 2074 7275 653b 0a20 2020 2020 2020 2020   true;.         
+000090a0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000090b0: 2020 2020 207d 2065 6c73 6569 6620 2821       } elseif (!
+000090c0: 6172 7261 795f 6b65 795f 6578 6973 7473  array_key_exists
+000090d0: 2824 6164 6472 6573 732c 2024 7468 6973  ($address, $this
+000090e0: 2d3e 5265 706c 7954 6f51 7565 7565 2929  ->ReplyToQueue))
+000090f0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00009100: 2020 2024 7468 6973 2d3e 5265 706c 7954     $this->ReplyT
+00009110: 6f51 7565 7565 5b24 6164 6472 6573 735d  oQueue[$address]
+00009120: 203d 2024 7061 7261 6d73 3b0a 0a20 2020   = $params;..   
+00009130: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00009140: 7572 6e20 7472 7565 3b0a 2020 2020 2020  urn true;.      
+00009150: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00009160: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
+00009170: 653b 0a20 2020 2020 2020 207d 0a0a 2020  e;.        }..  
+00009180: 2020 2020 2020 2f2f 496d 6d65 6469 6174        //Immediat
+00009190: 656c 7920 6164 6420 7374 616e 6461 7264  ely add standard
+000091a0: 2061 6464 7265 7373 6573 2077 6974 686f   addresses witho
+000091b0: 7574 2049 444e 2e0a 2020 2020 2020 2020  ut IDN..        
+000091c0: 7265 7475 726e 2063 616c 6c5f 7573 6572  return call_user
+000091d0: 5f66 756e 635f 6172 7261 7928 5b24 7468  _func_array([$th
+000091e0: 6973 2c20 2761 6464 416e 4164 6472 6573  is, 'addAnAddres
+000091f0: 7327 5d2c 2024 7061 7261 6d73 293b 0a20  s'], $params);. 
+00009200: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
+00009210: 2020 202a 2053 6574 2074 6865 2062 6f75     * Set the bou
+00009220: 6e64 6172 6965 7320 746f 2075 7365 2066  ndaries to use f
+00009230: 6f72 2064 656c 696d 6974 696e 6720 4d49  or delimiting MI
+00009240: 4d45 2070 6172 7473 2e0a 2020 2020 202a  ME parts..     *
+00009250: 2049 6620 796f 7520 6f76 6572 7269 6465   If you override
+00009260: 2074 6869 732c 2065 6e73 7572 6520 796f   this, ensure yo
+00009270: 7520 7365 7420 616c 6c20 3320 626f 756e  u set all 3 boun
+00009280: 6461 7269 6573 2074 6f20 756e 6971 7565  daries to unique
+00009290: 2076 616c 7565 732e 0a20 2020 2020 2a20   values..     * 
+000092a0: 5468 6520 6465 6661 756c 7420 626f 756e  The default boun
+000092b0: 6461 7269 6573 2069 6e63 6c75 6465 2061  daries include a
+000092c0: 2022 3d5f 2220 7365 7175 656e 6365 2077   "=_" sequence w
+000092d0: 6869 6368 2063 616e 6e6f 7420 6f63 6375  hich cannot occu
+000092e0: 7220 696e 2071 756f 7465 642d 7072 696e  r in quoted-prin
+000092f0: 7461 626c 6520 626f 6469 6573 2c0a 2020  table bodies,.  
+00009300: 2020 202a 2061 7320 7375 6767 6573 7465     * as suggeste
+00009310: 6420 6279 2068 7474 7073 3a2f 2f77 7777  d by https://www
+00009320: 2e72 6663 2d65 6469 746f 722e 6f72 672f  .rfc-editor.org/
+00009330: 7266 632f 7266 6332 3034 3523 7365 6374  rfc/rfc2045#sect
+00009340: 696f 6e2d 362e 370a 2020 2020 202a 0a20  ion-6.7.     *. 
+00009350: 2020 2020 2a20 4072 6574 7572 6e20 766f      * @return vo
+00009360: 6964 0a20 2020 2020 2a2f 0a20 2020 2070  id.     */.    p
+00009370: 7562 6c69 6320 6675 6e63 7469 6f6e 2073  ublic function s
+00009380: 6574 426f 756e 6461 7269 6573 2829 0a20  etBoundaries(). 
+00009390: 2020 207b 0a20 2020 2020 2020 2024 7468     {.        $th
+000093a0: 6973 2d3e 756e 6971 7565 6964 203d 2024  is->uniqueid = $
+000093b0: 7468 6973 2d3e 6765 6e65 7261 7465 4964  this->generateId
+000093c0: 2829 3b0a 2020 2020 2020 2020 2474 6869  ();.        $thi
+000093d0: 732d 3e62 6f75 6e64 6172 795b 315d 203d  s->boundary[1] =
+000093e0: 2027 6231 3d5f 2720 2e20 2474 6869 732d   'b1=_' . $this-
+000093f0: 3e75 6e69 7175 6569 643b 0a20 2020 2020  >uniqueid;.     
+00009400: 2020 2024 7468 6973 2d3e 626f 756e 6461     $this->bounda
+00009410: 7279 5b32 5d20 3d20 2762 323d 5f27 202e  ry[2] = 'b2=_' .
+00009420: 2024 7468 6973 2d3e 756e 6971 7565 6964   $this->uniqueid
+00009430: 3b0a 2020 2020 2020 2020 2474 6869 732d  ;.        $this-
+00009440: 3e62 6f75 6e64 6172 795b 335d 203d 2027  >boundary[3] = '
+00009450: 6233 3d5f 2720 2e20 2474 6869 732d 3e75  b3=_' . $this->u
+00009460: 6e69 7175 6569 643b 0a20 2020 207d 0a0a  niqueid;.    }..
+00009470: 2020 2020 2f2a 2a0a 2020 2020 202a 2041      /**.     * A
+00009480: 6464 2061 6e20 6164 6472 6573 7320 746f  dd an address to
+00009490: 206f 6e65 206f 6620 7468 6520 7265 6369   one of the reci
+000094a0: 7069 656e 7420 6172 7261 7973 206f 7220  pient arrays or 
+000094b0: 746f 2074 6865 2052 6570 6c79 546f 2061  to the ReplyTo a
+000094c0: 7272 6179 2e0a 2020 2020 202a 2041 6464  rray..     * Add
+000094d0: 7265 7373 6573 2074 6861 7420 6861 7665  resses that have
+000094e0: 2062 6565 6e20 6164 6465 6420 616c 7265   been added alre
+000094f0: 6164 7920 7265 7475 726e 2066 616c 7365  ady return false
+00009500: 2c20 6275 7420 646f 206e 6f74 2074 6872  , but do not thr
+00009510: 6f77 2065 7863 6570 7469 6f6e 732e 0a20  ow exceptions.. 
+00009520: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+00009530: 7261 6d20 7374 7269 6e67 2024 6b69 6e64  ram string $kind
+00009540: 2020 2020 4f6e 6520 6f66 2027 746f 272c      One of 'to',
+00009550: 2027 6363 272c 2027 6263 6327 2c20 6f72   'cc', 'bcc', or
+00009560: 2027 5265 706c 7954 6f27 0a20 2020 2020   'ReplyTo'.     
+00009570: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+00009580: 2461 6464 7265 7373 2054 6865 2065 6d61  $address The ema
+00009590: 696c 2061 6464 7265 7373 2074 6f20 7365  il address to se
+000095a0: 6e64 2c20 7265 7370 2e20 746f 2072 6570  nd, resp. to rep
+000095b0: 6c79 2074 6f0a 2020 2020 202a 2040 7061  ly to.     * @pa
+000095c0: 7261 6d20 7374 7269 6e67 2024 6e61 6d65  ram string $name
+000095d0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+000095e0: 7468 726f 7773 2045 7863 6570 7469 6f6e  throws Exception
+000095f0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00009600: 7265 7475 726e 2062 6f6f 6c20 7472 7565  return bool true
+00009610: 206f 6e20 7375 6363 6573 732c 2066 616c   on success, fal
+00009620: 7365 2069 6620 6164 6472 6573 7320 616c  se if address al
+00009630: 7265 6164 7920 7573 6564 206f 7220 696e  ready used or in
+00009640: 7661 6c69 6420 696e 2073 6f6d 6520 7761  valid in some wa
+00009650: 790a 2020 2020 202a 2f0a 2020 2020 7072  y.     */.    pr
+00009660: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+00009670: 2061 6464 416e 4164 6472 6573 7328 246b   addAnAddress($k
+00009680: 696e 642c 2024 6164 6472 6573 732c 2024  ind, $address, $
+00009690: 6e61 6d65 203d 2027 2729 0a20 2020 207b  name = '').    {
+000096a0: 0a20 2020 2020 2020 2069 6620 2821 696e  .        if (!in
+000096b0: 5f61 7272 6179 2824 6b69 6e64 2c20 5b27  _array($kind, ['
+000096c0: 746f 272c 2027 6363 272c 2027 6263 6327  to', 'cc', 'bcc'
+000096d0: 2c20 2752 6570 6c79 2d54 6f27 5d29 2920  , 'Reply-To'])) 
+000096e0: 7b0a 2020 2020 2020 2020 2020 2020 2465  {.            $e
+000096f0: 7272 6f72 5f6d 6573 7361 6765 203d 2073  rror_message = s
+00009700: 7072 696e 7466 280a 2020 2020 2020 2020  printf(.        
+00009710: 2020 2020 2020 2020 2725 733a 2025 7327          '%s: %s'
+00009720: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009730: 2020 2474 6869 732d 3e6c 616e 6728 2749    $this->lang('I
+00009740: 6e76 616c 6964 2072 6563 6970 6965 6e74  nvalid recipient
+00009750: 206b 696e 6427 292c 0a20 2020 2020 2020   kind'),.       
+00009760: 2020 2020 2020 2020 2024 6b69 6e64 0a20           $kind. 
+00009770: 2020 2020 2020 2020 2020 2029 3b0a 2020             );.  
+00009780: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00009790: 3e73 6574 4572 726f 7228 2465 7272 6f72  >setError($error
+000097a0: 5f6d 6573 7361 6765 293b 0a20 2020 2020  _message);.     
+000097b0: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
+000097c0: 6562 7567 2824 6572 726f 725f 6d65 7373  ebug($error_mess
+000097d0: 6167 6529 3b0a 2020 2020 2020 2020 2020  age);.          
+000097e0: 2020 6966 2028 2474 6869 732d 3e65 7863    if ($this->exc
+000097f0: 6570 7469 6f6e 7329 207b 0a20 2020 2020  eptions) {.     
+00009800: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
+00009810: 206e 6577 2045 7863 6570 7469 6f6e 2824   new Exception($
+00009820: 6572 726f 725f 6d65 7373 6167 6529 3b0a  error_message);.
+00009830: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
+00009840: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009850: 6e20 6661 6c73 653b 0a20 2020 2020 2020  n false;.       
+00009860: 207d 0a20 2020 2020 2020 2069 6620 2821   }.        if (!
+00009870: 7374 6174 6963 3a3a 7661 6c69 6461 7465  static::validate
+00009880: 4164 6472 6573 7328 2461 6464 7265 7373  Address($address
+00009890: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+000098a0: 2024 6572 726f 725f 6d65 7373 6167 6520   $error_message 
+000098b0: 3d20 7370 7269 6e74 6628 0a20 2020 2020  = sprintf(.     
+000098c0: 2020 2020 2020 2020 2020 2027 2573 2028             '%s (
+000098d0: 2573 293a 2025 7327 2c0a 2020 2020 2020  %s): %s',.      
+000098e0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+000098f0: 3e6c 616e 6728 2769 6e76 616c 6964 5f61  >lang('invalid_a
+00009900: 6464 7265 7373 2729 2c0a 2020 2020 2020  ddress'),.      
+00009910: 2020 2020 2020 2020 2020 246b 696e 642c            $kind,
+00009920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009930: 2024 6164 6472 6573 730a 2020 2020 2020   $address.      
+00009940: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
+00009950: 2020 2020 2024 7468 6973 2d3e 7365 7445       $this->setE
+00009960: 7272 6f72 2824 6572 726f 725f 6d65 7373  rror($error_mess
+00009970: 6167 6529 3b0a 2020 2020 2020 2020 2020  age);.          
+00009980: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
+00009990: 2465 7272 6f72 5f6d 6573 7361 6765 293b  $error_message);
+000099a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000099b0: 2824 7468 6973 2d3e 6578 6365 7074 696f  ($this->exceptio
+000099c0: 6e73 2920 7b0a 2020 2020 2020 2020 2020  ns) {.          
+000099d0: 2020 2020 2020 7468 726f 7720 6e65 7720        throw new 
+000099e0: 4578 6365 7074 696f 6e28 2465 7272 6f72  Exception($error
+000099f0: 5f6d 6573 7361 6765 293b 0a20 2020 2020  _message);.     
+00009a00: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00009a10: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+00009a20: 7365 3b0a 2020 2020 2020 2020 7d0a 2020  se;.        }.  
+00009a30: 2020 2020 2020 6966 2028 2752 6570 6c79        if ('Reply
+00009a40: 2d54 6f27 2021 3d3d 2024 6b69 6e64 2920  -To' !== $kind) 
+00009a50: 7b0a 2020 2020 2020 2020 2020 2020 6966  {.            if
+00009a60: 2028 2161 7272 6179 5f6b 6579 5f65 7869   (!array_key_exi
+00009a70: 7374 7328 7374 7274 6f6c 6f77 6572 2824  sts(strtolower($
+00009a80: 6164 6472 6573 7329 2c20 2474 6869 732d  address), $this-
+00009a90: 3e61 6c6c 5f72 6563 6970 6965 6e74 7329  >all_recipients)
+00009aa0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00009ab0: 2020 2020 2474 6869 732d 3e7b 246b 696e      $this->{$kin
+00009ac0: 647d 5b5d 203d 205b 2461 6464 7265 7373  d}[] = [$address
+00009ad0: 2c20 246e 616d 655d 3b0a 2020 2020 2020  , $name];.      
+00009ae0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00009af0: 3e61 6c6c 5f72 6563 6970 6965 6e74 735b  >all_recipients[
+00009b00: 7374 7274 6f6c 6f77 6572 2824 6164 6472  strtolower($addr
+00009b10: 6573 7329 5d20 3d20 7472 7565 3b0a 0a20  ess)] = true;.. 
+00009b20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009b30: 6574 7572 6e20 7472 7565 3b0a 2020 2020  eturn true;.    
+00009b40: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00009b50: 2020 7d20 656c 7365 6966 2028 2161 7272    } elseif (!arr
+00009b60: 6179 5f6b 6579 5f65 7869 7374 7328 7374  ay_key_exists(st
+00009b70: 7274 6f6c 6f77 6572 2824 6164 6472 6573  rtolower($addres
+00009b80: 7329 2c20 2474 6869 732d 3e52 6570 6c79  s), $this->Reply
+00009b90: 546f 2929 207b 0a20 2020 2020 2020 2020  To)) {.         
+00009ba0: 2020 2024 7468 6973 2d3e 5265 706c 7954     $this->ReplyT
+00009bb0: 6f5b 7374 7274 6f6c 6f77 6572 2824 6164  o[strtolower($ad
+00009bc0: 6472 6573 7329 5d20 3d20 5b24 6164 6472  dress)] = [$addr
+00009bd0: 6573 732c 2024 6e61 6d65 5d3b 0a0a 2020  ess, $name];..  
+00009be0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009bf0: 2074 7275 653b 0a20 2020 2020 2020 207d   true;.        }
+00009c00: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00009c10: 2066 616c 7365 3b0a 2020 2020 7d0a 0a20   false;.    }.. 
+00009c20: 2020 202f 2a2a 0a20 2020 2020 2a20 5061     /**.     * Pa
+00009c30: 7273 6520 616e 6420 7661 6c69 6461 7465  rse and validate
+00009c40: 2061 2073 7472 696e 6720 636f 6e74 6169   a string contai
+00009c50: 6e69 6e67 206f 6e65 206f 7220 6d6f 7265  ning one or more
+00009c60: 2052 4643 3832 322d 7374 796c 6520 636f   RFC822-style co
+00009c70: 6d6d 612d 7365 7061 7261 7465 6420 656d  mma-separated em
+00009c80: 6169 6c20 6164 6472 6573 7365 730a 2020  ail addresses.  
+00009c90: 2020 202a 206f 6620 7468 6520 666f 726d     * of the form
+00009ca0: 2022 6469 7370 6c61 7920 6e61 6d65 203c   "display name <
+00009cb0: 6164 6472 6573 733e 2220 696e 746f 2061  address>" into a
+00009cc0: 6e20 6172 7261 7920 6f66 206e 616d 652f  n array of name/
+00009cd0: 6164 6472 6573 7320 7061 6972 732e 0a20  address pairs.. 
+00009ce0: 2020 2020 2a20 5573 6573 2074 6865 2069      * Uses the i
+00009cf0: 6d61 705f 7266 6338 3232 5f70 6172 7365  map_rfc822_parse
+00009d00: 5f61 6472 6c69 7374 2066 756e 6374 696f  _adrlist functio
+00009d10: 6e20 6966 2074 6865 2049 4d41 5020 6578  n if the IMAP ex
+00009d20: 7465 6e73 696f 6e20 6973 2061 7661 696c  tension is avail
+00009d30: 6162 6c65 2e0a 2020 2020 202a 204e 6f74  able..     * Not
+00009d40: 6520 7468 6174 2071 756f 7465 7320 696e  e that quotes in
+00009d50: 2074 6865 206e 616d 6520 7061 7274 2061   the name part a
+00009d60: 7265 2072 656d 6f76 6564 2e0a 2020 2020  re removed..    
+00009d70: 202a 0a20 2020 2020 2a20 4073 6565 2068   *.     * @see h
+00009d80: 7474 703a 2f2f 7777 772e 616e 6472 6577  ttp://www.andrew
+00009d90: 2e63 6d75 2e65 6475 2f75 7365 722f 6167  .cmu.edu/user/ag
+00009da0: 7265 656e 312f 7465 7374 696e 672f 6d72  reen1/testing/mr
+00009db0: 6273 2f77 6562 2f4d 6169 6c2f 5246 4338  bs/web/Mail/RFC8
+00009dc0: 3232 2e70 6870 2041 206d 6f72 6520 6361  22.php A more ca
+00009dd0: 7265 6675 6c20 696d 706c 656d 656e 7461  reful implementa
+00009de0: 7469 6f6e 0a20 2020 2020 2a0a 2020 2020  tion.     *.    
+00009df0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00009e00: 2024 6164 6472 7374 7220 5468 6520 6164   $addrstr The ad
+00009e10: 6472 6573 7320 6c69 7374 2073 7472 696e  dress list strin
+00009e20: 670a 2020 2020 202a 2040 7061 7261 6d20  g.     * @param 
+00009e30: 626f 6f6c 2020 2024 7573 6569 6d61 7020  bool   $useimap 
+00009e40: 5768 6574 6865 7220 746f 2075 7365 2074  Whether to use t
+00009e50: 6865 2049 4d41 5020 6578 7465 6e73 696f  he IMAP extensio
+00009e60: 6e20 746f 2070 6172 7365 2074 6865 206c  n to parse the l
+00009e70: 6973 740a 2020 2020 202a 2040 7061 7261  ist.     * @para
+00009e80: 6d20 7374 7269 6e67 2024 6368 6172 7365  m string $charse
+00009e90: 7420 5468 6520 6368 6172 7365 7420 746f  t The charset to
+00009ea0: 2075 7365 2077 6865 6e20 6465 636f 6469   use when decodi
+00009eb0: 6e67 2074 6865 2061 6464 7265 7373 206c  ng the address l
+00009ec0: 6973 7420 7374 7269 6e67 2e0a 2020 2020  ist string..    
+00009ed0: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+00009ee0: 6e20 6172 7261 790a 2020 2020 202a 2f0a  n array.     */.
+00009ef0: 2020 2020 7075 626c 6963 2073 7461 7469      public stati
+00009f00: 6320 6675 6e63 7469 6f6e 2070 6172 7365  c function parse
+00009f10: 4164 6472 6573 7365 7328 2461 6464 7273  Addresses($addrs
+00009f20: 7472 2c20 2475 7365 696d 6170 203d 2074  tr, $useimap = t
+00009f30: 7275 652c 2024 6368 6172 7365 7420 3d20  rue, $charset = 
+00009f40: 7365 6c66 3a3a 4348 4152 5345 545f 4953  self::CHARSET_IS
+00009f50: 4f38 3835 3931 290a 2020 2020 7b0a 2020  O88591).    {.  
+00009f60: 2020 2020 2020 2461 6464 7265 7373 6573        $addresses
+00009f70: 203d 205b 5d3b 0a20 2020 2020 2020 2069   = [];.        i
+00009f80: 6620 2824 7573 6569 6d61 7020 2626 2066  f ($useimap && f
+00009f90: 756e 6374 696f 6e5f 6578 6973 7473 2827  unction_exists('
+00009fa0: 696d 6170 5f72 6663 3832 325f 7061 7273  imap_rfc822_pars
+00009fb0: 655f 6164 726c 6973 7427 2929 207b 0a20  e_adrlist')) {. 
+00009fc0: 2020 2020 2020 2020 2020 202f 2f55 7365             //Use
+00009fd0: 2074 6869 7320 6275 696c 742d 696e 2070   this built-in p
+00009fe0: 6172 7365 7220 6966 2069 7427 7320 6176  arser if it's av
+00009ff0: 6169 6c61 626c 650a 2020 2020 2020 2020  ailable.        
+0000a000: 2020 2020 246c 6973 7420 3d20 696d 6170      $list = imap
+0000a010: 5f72 6663 3832 325f 7061 7273 655f 6164  _rfc822_parse_ad
+0000a020: 726c 6973 7428 2461 6464 7273 7472 2c20  rlist($addrstr, 
+0000a030: 2727 293b 0a20 2020 2020 2020 2020 2020  '');.           
+0000a040: 202f 2f20 436c 6561 7220 616e 7920 706f   // Clear any po
+0000a050: 7465 6e74 6961 6c20 494d 4150 2065 7272  tential IMAP err
+0000a060: 6f72 7320 746f 2067 6574 2072 6964 206f  ors to get rid o
+0000a070: 6620 6e6f 7469 6365 7320 6265 696e 6720  f notices being 
+0000a080: 7468 726f 776e 2061 7420 656e 6420 6f66  thrown at end of
+0000a090: 2073 6372 6970 742e 0a20 2020 2020 2020   script..       
+0000a0a0: 2020 2020 2069 6d61 705f 6572 726f 7273       imap_errors
+0000a0b0: 2829 3b0a 2020 2020 2020 2020 2020 2020  ();.            
+0000a0c0: 666f 7265 6163 6820 2824 6c69 7374 2061  foreach ($list a
+0000a0d0: 7320 2461 6464 7265 7373 2920 7b0a 2020  s $address) {.  
+0000a0e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000a0f0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000a100: 2020 2020 2020 2027 2e53 594e 5441 582d         '.SYNTAX-
+0000a110: 4552 524f 522e 2720 213d 3d20 2461 6464  ERROR.' !== $add
+0000a120: 7265 7373 2d3e 686f 7374 2026 260a 2020  ress->host &&.  
+0000a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a140: 2020 7374 6174 6963 3a3a 7661 6c69 6461    static::valida
+0000a150: 7465 4164 6472 6573 7328 2461 6464 7265  teAddress($addre
+0000a160: 7373 2d3e 6d61 696c 626f 7820 2e20 2740  ss->mailbox . '@
+0000a170: 2720 2e20 2461 6464 7265 7373 2d3e 686f  ' . $address->ho
+0000a180: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+0000a190: 2020 2020 2920 7b0a 2020 2020 2020 2020      ) {.        
+0000a1a0: 2020 2020 2020 2020 2020 2020 2f2f 4465              //De
+0000a1b0: 636f 6465 2074 6865 206e 616d 6520 7061  code the name pa
+0000a1c0: 7274 2069 6620 6974 2773 2070 7265 7365  rt if it's prese
+0000a1d0: 6e74 2061 6e64 2065 6e63 6f64 6564 0a20  nt and encoded. 
+0000a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1f0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
 0000a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a210: 2020 2020 2f2f 4465 636f 6465 2074 6865      //Decode the
-0000a220: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
-0000a230: 2020 2020 2020 2020 2020 2020 2020 2461                $a
-0000a240: 6464 7265 7373 2d3e 7065 7273 6f6e 616c  ddress->personal
-0000a250: 203d 206d 625f 6465 636f 6465 5f6d 696d   = mb_decode_mim
-0000a260: 6568 6561 6465 7228 2461 6464 7265 7373  eheader($address
-0000a270: 2d3e 7065 7273 6f6e 616c 293b 0a20 2020  ->personal);.   
-0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a290: 2020 2020 206d 625f 696e 7465 726e 616c       mb_internal
-0000a2a0: 5f65 6e63 6f64 696e 6728 246f 7269 6743  _encoding($origC
-0000a2b0: 6861 7273 6574 293b 0a20 2020 2020 2020  harset);.       
-0000a2c0: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2020 2020 2461 6464 7265 7373 6573 5b5d      $addresses[]
-0000a2f0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-0000a300: 2020 2020 2020 2020 2020 2020 2027 6e61               'na
-0000a310: 6d65 2720 3d3e 2028 7072 6f70 6572 7479  me' => (property
-0000a320: 5f65 7869 7374 7328 2461 6464 7265 7373  _exists($address
-0000a330: 2c20 2770 6572 736f 6e61 6c27 2920 3f20  , 'personal') ? 
-0000a340: 2461 6464 7265 7373 2d3e 7065 7273 6f6e  $address->person
-0000a350: 616c 203a 2027 2729 2c0a 2020 2020 2020  al : ''),.      
-0000a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a370: 2020 2761 6464 7265 7373 2720 3d3e 2024    'address' => $
-0000a380: 6164 6472 6573 732d 3e6d 6169 6c62 6f78  address->mailbox
-0000a390: 202e 2027 4027 202e 2024 6164 6472 6573   . '@' . $addres
-0000a3a0: 732d 3e68 6f73 742c 0a20 2020 2020 2020  s->host,.       
-0000a3b0: 2020 2020 2020 2020 2020 2020 205d 3b0a               ];.
+0000a210: 7072 6f70 6572 7479 5f65 7869 7374 7328  property_exists(
+0000a220: 2461 6464 7265 7373 2c20 2770 6572 736f  $address, 'perso
+0000a230: 6e61 6c27 2920 2626 0a20 2020 2020 2020  nal') &&.       
+0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a250: 202f 2f43 6865 636b 2066 6f72 2061 204d   //Check for a M
+0000a260: 6273 7472 696e 6720 636f 6e73 7461 6e74  bstring constant
+0000a270: 2072 6174 6865 7220 7468 616e 2075 7369   rather than usi
+0000a280: 6e67 2065 7874 656e 7369 6f6e 5f6c 6f61  ng extension_loa
+0000a290: 6465 642c 2077 6869 6368 2069 7320 736f  ded, which is so
+0000a2a0: 6d65 7469 6d65 7320 6469 7361 626c 6564  metimes disabled
+0000a2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2c0: 2020 2020 2020 2020 2064 6566 696e 6564           defined
+0000a2d0: 2827 4d42 5f43 4153 455f 5550 5045 5227  ('MB_CASE_UPPER'
+0000a2e0: 2920 2626 0a20 2020 2020 2020 2020 2020  ) &&.           
+0000a2f0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000a300: 675f 6d61 7463 6828 272f 5e3d 5c3f 2e2a  g_match('/^=\?.*
+0000a310: 5c3f 3d24 2f73 272c 2024 6164 6472 6573  \?=$/s', $addres
+0000a320: 732d 3e70 6572 736f 6e61 6c29 0a20 2020  s->personal).   
+0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a340: 2029 207b 0a20 2020 2020 2020 2020 2020   ) {.           
+0000a350: 2020 2020 2020 2020 2020 2020 2024 6f72               $or
+0000a360: 6967 4368 6172 7365 7420 3d20 6d62 5f69  igCharset = mb_i
+0000a370: 6e74 6572 6e61 6c5f 656e 636f 6469 6e67  nternal_encoding
+0000a380: 2829 3b0a 2020 2020 2020 2020 2020 2020  ();.            
+0000a390: 2020 2020 2020 2020 2020 2020 6d62 5f69              mb_i
+0000a3a0: 6e74 6572 6e61 6c5f 656e 636f 6469 6e67  nternal_encoding
+0000a3b0: 2824 6368 6172 7365 7429 3b0a 2020 2020  ($charset);.    
 0000a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3d0: 7d0a 2020 2020 2020 2020 2020 2020 7d0a  }.            }.
-0000a3e0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
-0000a3f0: 0a20 2020 2020 2020 2020 2020 202f 2f55  .            //U
-0000a400: 7365 2074 6869 7320 7369 6d70 6c65 7220  se this simpler 
-0000a410: 7061 7273 6572 0a20 2020 2020 2020 2020  parser.         
-0000a420: 2020 2024 6c69 7374 203d 2065 7870 6c6f     $list = explo
-0000a430: 6465 2827 2c27 2c20 2461 6464 7273 7472  de(',', $addrstr
-0000a440: 293b 0a20 2020 2020 2020 2020 2020 2066  );.            f
-0000a450: 6f72 6561 6368 2028 246c 6973 7420 6173  oreach ($list as
-0000a460: 2024 6164 6472 6573 7329 207b 0a20 2020   $address) {.   
-0000a470: 2020 2020 2020 2020 2020 2020 2024 6164               $ad
-0000a480: 6472 6573 7320 3d20 7472 696d 2824 6164  dress = trim($ad
-0000a490: 6472 6573 7329 3b0a 2020 2020 2020 2020  dress);.        
-0000a4a0: 2020 2020 2020 2020 2f2f 4973 2074 6865          //Is the
-0000a4b0: 7265 2061 2073 6570 6172 6174 6520 6e61  re a separate na
-0000a4c0: 6d65 2070 6172 743f 0a20 2020 2020 2020  me part?.       
-0000a4d0: 2020 2020 2020 2020 2069 6620 2873 7472           if (str
-0000a4e0: 706f 7328 2461 6464 7265 7373 2c20 273c  pos($address, '<
-0000a4f0: 2729 203d 3d3d 2066 616c 7365 2920 7b0a  ') === false) {.
-0000a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a510: 2020 2020 2f2f 4e6f 2073 6570 6172 6174      //No separat
-0000a520: 6520 6e61 6d65 2c20 6a75 7374 2075 7365  e name, just use
-0000a530: 2074 6865 2077 686f 6c65 2074 6869 6e67   the whole thing
-0000a540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a550: 2020 2020 2069 6620 2873 7461 7469 633a       if (static:
-0000a560: 3a76 616c 6964 6174 6541 6464 7265 7373  :validateAddress
-0000a570: 2824 6164 6472 6573 7329 2920 7b0a 2020  ($address)) {.  
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a590: 2020 2020 2020 2461 6464 7265 7373 6573        $addresses
-0000a5a0: 5b5d 203d 205b 0a20 2020 2020 2020 2020  [] = [.         
-0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5c0: 2020 2027 6e61 6d65 2720 3d3e 2027 272c     'name' => '',
-0000a5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a5e0: 2020 2020 2020 2020 2020 2020 2027 6164               'ad
-0000a5f0: 6472 6573 7327 203d 3e20 2461 6464 7265  dress' => $addre
-0000a600: 7373 2c0a 2020 2020 2020 2020 2020 2020  ss,.            
-0000a610: 2020 2020 2020 2020 2020 2020 5d3b 0a20              ];. 
-0000a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3d0: 2020 2020 2f2f 556e 646f 2061 6e79 2052      //Undo any R
+0000a3e0: 4643 3230 3437 2d65 6e63 6f64 6564 2073  FC2047-encoded s
+0000a3f0: 7061 6365 732d 6173 2d75 6e64 6572 7363  paces-as-undersc
+0000a400: 6f72 6573 0a20 2020 2020 2020 2020 2020  ores.           
+0000a410: 2020 2020 2020 2020 2020 2020 2024 6164               $ad
+0000a420: 6472 6573 732d 3e70 6572 736f 6e61 6c20  dress->personal 
+0000a430: 3d20 7374 725f 7265 706c 6163 6528 275f  = str_replace('_
+0000a440: 272c 2027 3d32 3027 2c20 2461 6464 7265  ', '=20', $addre
+0000a450: 7373 2d3e 7065 7273 6f6e 616c 293b 0a20  ss->personal);. 
+0000a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a470: 2020 2020 2020 202f 2f44 6563 6f64 6520         //Decode 
+0000a480: 7468 6520 6e61 6d65 0a20 2020 2020 2020  the name.       
+0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4a0: 2024 6164 6472 6573 732d 3e70 6572 736f   $address->perso
+0000a4b0: 6e61 6c20 3d20 6d62 5f64 6563 6f64 655f  nal = mb_decode_
+0000a4c0: 6d69 6d65 6865 6164 6572 2824 6164 6472  mimeheader($addr
+0000a4d0: 6573 732d 3e70 6572 736f 6e61 6c29 3b0a  ess->personal);.
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 2020 2020 2020 2020 6d62 5f69 6e74 6572          mb_inter
+0000a500: 6e61 6c5f 656e 636f 6469 6e67 2824 6f72  nal_encoding($or
+0000a510: 6967 4368 6172 7365 7429 3b0a 2020 2020  igCharset);.    
+0000a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a530: 7d0a 0a20 2020 2020 2020 2020 2020 2020  }..             
+0000a540: 2020 2020 2020 2024 6164 6472 6573 7365         $addresse
+0000a550: 735b 5d20 3d20 5b0a 2020 2020 2020 2020  s[] = [.        
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a570: 276e 616d 6527 203d 3e20 2870 726f 7065  'name' => (prope
+0000a580: 7274 795f 6578 6973 7473 2824 6164 6472  rty_exists($addr
+0000a590: 6573 732c 2027 7065 7273 6f6e 616c 2729  ess, 'personal')
+0000a5a0: 203f 2024 6164 6472 6573 732d 3e70 6572   ? $address->per
+0000a5b0: 736f 6e61 6c20 3a20 2727 292c 0a20 2020  sonal : ''),.   
+0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5d0: 2020 2020 2027 6164 6472 6573 7327 203d       'address' =
+0000a5e0: 3e20 2461 6464 7265 7373 2d3e 6d61 696c  > $address->mail
+0000a5f0: 626f 7820 2e20 2740 2720 2e20 2461 6464  box . '@' . $add
+0000a600: 7265 7373 2d3e 686f 7374 2c0a 2020 2020  ress->host,.    
+0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a620: 5d3b 0a20 2020 2020 2020 2020 2020 2020  ];.             
 0000a630: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0000a640: 2020 2020 207d 2065 6c73 6520 7b0a 2020       } else {.  
-0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a660: 2020 6c69 7374 2824 6e61 6d65 2c20 2465    list($name, $e
-0000a670: 6d61 696c 2920 3d20 6578 706c 6f64 6528  mail) = explode(
-0000a680: 273c 272c 2024 6164 6472 6573 7329 3b0a  '<', $address);.
-0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6a0: 2020 2020 2465 6d61 696c 203d 2074 7269      $email = tri
-0000a6b0: 6d28 7374 725f 7265 706c 6163 6528 273e  m(str_replace('>
-0000a6c0: 272c 2027 272c 2024 656d 6169 6c29 293b  ', '', $email));
-0000a6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a6e0: 2020 2020 2024 6e61 6d65 203d 2074 7269       $name = tri
-0000a6f0: 6d28 246e 616d 6529 3b0a 2020 2020 2020  m($name);.      
-0000a700: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000a710: 2028 7374 6174 6963 3a3a 7661 6c69 6461   (static::valida
-0000a720: 7465 4164 6472 6573 7328 2465 6d61 696c  teAddress($email
-0000a730: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-0000a740: 2020 2020 2020 2020 2020 2020 202f 2f43               //C
-0000a750: 6865 636b 2066 6f72 2061 204d 6273 7472  heck for a Mbstr
-0000a760: 696e 6720 636f 6e73 7461 6e74 2072 6174  ing constant rat
-0000a770: 6865 7220 7468 616e 2075 7369 6e67 2065  her than using e
-0000a780: 7874 656e 7369 6f6e 5f6c 6f61 6465 642c  xtension_loaded,
-0000a790: 2077 6869 6368 2069 7320 736f 6d65 7469   which is someti
-0000a7a0: 6d65 7320 6469 7361 626c 6564 0a20 2020  mes disabled.   
-0000a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7c0: 2020 2020 202f 2f49 6620 7468 6973 206e       //If this n
-0000a7d0: 616d 6520 6973 2065 6e63 6f64 6564 2c20  ame is encoded, 
-0000a7e0: 6465 636f 6465 2069 740a 2020 2020 2020  decode it.      
-0000a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a800: 2020 6966 2028 6465 6669 6e65 6428 274d    if (defined('M
-0000a810: 425f 4341 5345 5f55 5050 4552 2729 2026  B_CASE_UPPER') &
-0000a820: 2620 7072 6567 5f6d 6174 6368 2827 2f5e  & preg_match('/^
-0000a830: 3d5c 3f2e 2a5c 3f3d 242f 7327 2c20 246e  =\?.*\?=$/s', $n
-0000a840: 616d 6529 2920 7b0a 2020 2020 2020 2020  ame)) {.        
-0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a860: 2020 2020 246f 7269 6743 6861 7273 6574      $origCharset
-0000a870: 203d 206d 625f 696e 7465 726e 616c 5f65   = mb_internal_e
-0000a880: 6e63 6f64 696e 6728 293b 0a20 2020 2020  ncoding();.     
-0000a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8a0: 2020 2020 2020 206d 625f 696e 7465 726e         mb_intern
-0000a8b0: 616c 5f65 6e63 6f64 696e 6728 2463 6861  al_encoding($cha
-0000a8c0: 7273 6574 293b 0a20 2020 2020 2020 2020  rset);.         
-0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8e0: 2020 202f 2f55 6e64 6f20 616e 7920 5246     //Undo any RF
-0000a8f0: 4332 3034 372d 656e 636f 6465 6420 7370  C2047-encoded sp
-0000a900: 6163 6573 2d61 732d 756e 6465 7273 636f  aces-as-undersco
-0000a910: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
-0000a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a930: 246e 616d 6520 3d20 7374 725f 7265 706c  $name = str_repl
-0000a940: 6163 6528 275f 272c 2027 3d32 3027 2c20  ace('_', '=20', 
-0000a950: 246e 616d 6529 3b0a 2020 2020 2020 2020  $name);.        
+0000a640: 207d 0a20 2020 2020 2020 207d 2065 6c73   }.        } els
+0000a650: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+0000a660: 2f2f 5573 6520 7468 6973 2073 696d 706c  //Use this simpl
+0000a670: 6572 2070 6172 7365 720a 2020 2020 2020  er parser.      
+0000a680: 2020 2020 2020 246c 6973 7420 3d20 6578        $list = ex
+0000a690: 706c 6f64 6528 272c 272c 2024 6164 6472  plode(',', $addr
+0000a6a0: 7374 7229 3b0a 2020 2020 2020 2020 2020  str);.          
+0000a6b0: 2020 666f 7265 6163 6820 2824 6c69 7374    foreach ($list
+0000a6c0: 2061 7320 2461 6464 7265 7373 2920 7b0a   as $address) {.
+0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6e0: 2461 6464 7265 7373 203d 2074 7269 6d28  $address = trim(
+0000a6f0: 2461 6464 7265 7373 293b 0a20 2020 2020  $address);.     
+0000a700: 2020 2020 2020 2020 2020 202f 2f49 7320             //Is 
+0000a710: 7468 6572 6520 6120 7365 7061 7261 7465  there a separate
+0000a720: 206e 616d 6520 7061 7274 3f0a 2020 2020   name part?.    
+0000a730: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0000a740: 7374 7270 6f73 2824 6164 6472 6573 732c  strpos($address,
+0000a750: 2027 3c27 2920 3d3d 3d20 6661 6c73 6529   '<') === false)
+0000a760: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0000a770: 2020 2020 2020 202f 2f4e 6f20 7365 7061         //No sepa
+0000a780: 7261 7465 206e 616d 652c 206a 7573 7420  rate name, just 
+0000a790: 7573 6520 7468 6520 7768 6f6c 6520 7468  use the whole th
+0000a7a0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0000a7b0: 2020 2020 2020 2020 6966 2028 7374 6174          if (stat
+0000a7c0: 6963 3a3a 7661 6c69 6461 7465 4164 6472  ic::validateAddr
+0000a7d0: 6573 7328 2461 6464 7265 7373 2929 207b  ess($address)) {
+0000a7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a7f0: 2020 2020 2020 2020 2024 6164 6472 6573           $addres
+0000a800: 7365 735b 5d20 3d20 5b0a 2020 2020 2020  ses[] = [.      
+0000a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a820: 2020 2020 2020 276e 616d 6527 203d 3e20        'name' => 
+0000a830: 2727 2c0a 2020 2020 2020 2020 2020 2020  '',.            
+0000a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a850: 2761 6464 7265 7373 2720 3d3e 2024 6164  'address' => $ad
+0000a860: 6472 6573 732c 0a20 2020 2020 2020 2020  dress,.         
+0000a870: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0000a880: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0000a890: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000a8a0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
+0000a8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a8c0: 2020 2020 206c 6973 7428 246e 616d 652c       list($name,
+0000a8d0: 2024 656d 6169 6c29 203d 2065 7870 6c6f   $email) = explo
+0000a8e0: 6465 2827 3c27 2c20 2461 6464 7265 7373  de('<', $address
+0000a8f0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0000a900: 2020 2020 2020 2024 656d 6169 6c20 3d20         $email = 
+0000a910: 7472 696d 2873 7472 5f72 6570 6c61 6365  trim(str_replace
+0000a920: 2827 3e27 2c20 2727 2c20 2465 6d61 696c  ('>', '', $email
+0000a930: 2929 3b0a 2020 2020 2020 2020 2020 2020  ));.            
+0000a940: 2020 2020 2020 2020 246e 616d 6520 3d20          $name = 
+0000a950: 7472 696d 2824 6e61 6d65 293b 0a20 2020  trim($name);.   
 0000a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a970: 2020 2020 2f2f 4465 636f 6465 2074 6865      //Decode the
-0000a980: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
-0000a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9a0: 2020 246e 616d 6520 3d20 6d62 5f64 6563    $name = mb_dec
-0000a9b0: 6f64 655f 6d69 6d65 6865 6164 6572 2824  ode_mimeheader($
-0000a9c0: 6e61 6d65 293b 0a20 2020 2020 2020 2020  name);.         
-0000a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9e0: 2020 206d 625f 696e 7465 726e 616c 5f65     mb_internal_e
-0000a9f0: 6e63 6f64 696e 6728 246f 7269 6743 6861  ncoding($origCha
-0000aa00: 7273 6574 293b 0a20 2020 2020 2020 2020  rset);.         
-0000aa10: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0000aa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aa30: 2020 2020 2020 2020 2024 6164 6472 6573           $addres
-0000aa40: 7365 735b 5d20 3d20 5b0a 2020 2020 2020  ses[] = [.      
+0000a970: 2069 6620 2873 7461 7469 633a 3a76 616c   if (static::val
+0000a980: 6964 6174 6541 6464 7265 7373 2824 656d  idateAddress($em
+0000a990: 6169 6c29 2920 7b0a 2020 2020 2020 2020  ail)) {.        
+0000a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9b0: 2f2f 4368 6563 6b20 666f 7220 6120 4d62  //Check for a Mb
+0000a9c0: 7374 7269 6e67 2063 6f6e 7374 616e 7420  string constant 
+0000a9d0: 7261 7468 6572 2074 6861 6e20 7573 696e  rather than usin
+0000a9e0: 6720 6578 7465 6e73 696f 6e5f 6c6f 6164  g extension_load
+0000a9f0: 6564 2c20 7768 6963 6820 6973 2073 6f6d  ed, which is som
+0000aa00: 6574 696d 6573 2064 6973 6162 6c65 640a  etimes disabled.
+0000aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa20: 2020 2020 2020 2020 2f2f 4966 2074 6869          //If thi
+0000aa30: 7320 6e61 6d65 2069 7320 656e 636f 6465  s name is encode
+0000aa40: 642c 2064 6563 6f64 6520 6974 0a20 2020  d, decode it.   
 0000aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa60: 2020 2020 2020 2f2f 5265 6d6f 7665 2061        //Remove a
-0000aa70: 6e79 2073 7572 726f 756e 6469 6e67 2071  ny surrounding q
-0000aa80: 756f 7465 7320 616e 6420 7370 6163 6573  uotes and spaces
-0000aa90: 2066 726f 6d20 7468 6520 6e61 6d65 0a20   from the name. 
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aab0: 2020 2020 2020 2020 2020 2027 6e61 6d65             'name
-0000aac0: 2720 3d3e 2074 7269 6d28 246e 616d 652c  ' => trim($name,
-0000aad0: 2027 5c27 2220 2729 2c0a 2020 2020 2020   '\'" '),.      
-0000aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aaf0: 2020 2020 2020 2761 6464 7265 7373 2720        'address' 
-0000ab00: 3d3e 2024 656d 6169 6c2c 0a20 2020 2020  => $email,.     
-0000ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab20: 2020 205d 3b0a 2020 2020 2020 2020 2020     ];.          
-0000ab30: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0000ab40: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0000ab50: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0000ab60: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
-0000ab70: 6574 7572 6e20 2461 6464 7265 7373 6573  eturn $addresses
-0000ab80: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-0000ab90: 0a20 2020 2020 2a20 5365 7420 7468 6520  .     * Set the 
-0000aba0: 4672 6f6d 2061 6e64 2046 726f 6d4e 616d  From and FromNam
-0000abb0: 6520 7072 6f70 6572 7469 6573 2e0a 2020  e properties..  
-0000abc0: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
-0000abd0: 616d 2073 7472 696e 6720 2461 6464 7265  am string $addre
-0000abe0: 7373 0a20 2020 2020 2a20 4070 6172 616d  ss.     * @param
-0000abf0: 2073 7472 696e 6720 246e 616d 650a 2020   string $name.  
-0000ac00: 2020 202a 2040 7061 7261 6d20 626f 6f6c     * @param bool
-0000ac10: 2020 2024 6175 746f 2020 2020 5768 6574     $auto    Whet
-0000ac20: 6865 7220 746f 2061 6c73 6f20 7365 7420  her to also set 
-0000ac30: 7468 6520 5365 6e64 6572 2061 6464 7265  the Sender addre
-0000ac40: 7373 2c20 6465 6661 756c 7473 2074 6f20  ss, defaults to 
-0000ac50: 7472 7565 0a20 2020 2020 2a0a 2020 2020  true.     *.    
-0000ac60: 202a 2040 7468 726f 7773 2045 7863 6570   * @throws Excep
-0000ac70: 7469 6f6e 0a20 2020 2020 2a0a 2020 2020  tion.     *.    
-0000ac80: 202a 2040 7265 7475 726e 2062 6f6f 6c0a   * @return bool.
-0000ac90: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-0000aca0: 6963 2066 756e 6374 696f 6e20 7365 7446  ic function setF
-0000acb0: 726f 6d28 2461 6464 7265 7373 2c20 246e  rom($address, $n
-0000acc0: 616d 6520 3d20 2727 2c20 2461 7574 6f20  ame = '', $auto 
-0000acd0: 3d20 7472 7565 290a 2020 2020 7b0a 2020  = true).    {.  
-0000ace0: 2020 2020 2020 2461 6464 7265 7373 203d        $address =
-0000acf0: 2074 7269 6d28 2873 7472 696e 6729 2461   trim((string)$a
-0000ad00: 6464 7265 7373 293b 0a20 2020 2020 2020  ddress);.       
-0000ad10: 2024 6e61 6d65 203d 2074 7269 6d28 7072   $name = trim(pr
-0000ad20: 6567 5f72 6570 6c61 6365 2827 2f5b 5c72  eg_replace('/[\r
-0000ad30: 5c6e 5d2b 2f27 2c20 2727 2c20 246e 616d  \n]+/', '', $nam
-0000ad40: 6529 293b 202f 2f53 7472 6970 2062 7265  e)); //Strip bre
-0000ad50: 616b 7320 616e 6420 7472 696d 0a20 2020  aks and trim.   
-0000ad60: 2020 2020 202f 2f44 6f6e 2774 2076 616c       //Don't val
-0000ad70: 6964 6174 6520 6e6f 7720 6164 6472 6573  idate now addres
-0000ad80: 7365 7320 7769 7468 2049 444e 2e20 5769  ses with IDN. Wi
-0000ad90: 6c6c 2062 6520 646f 6e65 2069 6e20 7365  ll be done in se
-0000ada0: 6e64 2829 2e0a 2020 2020 2020 2020 2470  nd()..        $p
-0000adb0: 6f73 203d 2073 7472 7270 6f73 2824 6164  os = strrpos($ad
-0000adc0: 6472 6573 732c 2027 4027 293b 0a20 2020  dress, '@');.   
-0000add0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-0000ade0: 2020 2020 2020 2866 616c 7365 203d 3d3d        (false ===
-0000adf0: 2024 706f 7329 0a20 2020 2020 2020 2020   $pos).         
-0000ae00: 2020 207c 7c20 2828 2124 7468 6973 2d3e     || ((!$this->
-0000ae10: 6861 7338 6269 7443 6861 7273 2873 7562  has8bitChars(sub
-0000ae20: 7374 7228 2461 6464 7265 7373 2c20 2b2b  str($address, ++
-0000ae30: 2470 6f73 2929 207c 7c20 2173 7461 7469  $pos)) || !stati
-0000ae40: 633a 3a69 646e 5375 7070 6f72 7465 6428  c::idnSupported(
-0000ae50: 2929 0a20 2020 2020 2020 2020 2020 2026  )).            &
-0000ae60: 2620 2173 7461 7469 633a 3a76 616c 6964  & !static::valid
-0000ae70: 6174 6541 6464 7265 7373 2824 6164 6472  ateAddress($addr
-0000ae80: 6573 7329 290a 2020 2020 2020 2020 2920  ess)).        ) 
-0000ae90: 7b0a 2020 2020 2020 2020 2020 2020 2465  {.            $e
-0000aea0: 7272 6f72 5f6d 6573 7361 6765 203d 2073  rror_message = s
-0000aeb0: 7072 696e 7466 280a 2020 2020 2020 2020  printf(.        
-0000aec0: 2020 2020 2020 2020 2725 7320 2846 726f          '%s (Fro
-0000aed0: 6d29 3a20 2573 272c 0a20 2020 2020 2020  m): %s',.       
-0000aee0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0000aef0: 6c61 6e67 2827 696e 7661 6c69 645f 6164  lang('invalid_ad
-0000af00: 6472 6573 7327 292c 0a20 2020 2020 2020  dress'),.       
-0000af10: 2020 2020 2020 2020 2024 6164 6472 6573           $addres
-0000af20: 730a 2020 2020 2020 2020 2020 2020 293b  s.            );
-0000af30: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
-0000af40: 6973 2d3e 7365 7445 7272 6f72 2824 6572  is->setError($er
-0000af50: 726f 725f 6d65 7373 6167 6529 3b0a 2020  ror_message);.  
-0000af60: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0000af70: 3e65 6465 6275 6728 2465 7272 6f72 5f6d  >edebug($error_m
-0000af80: 6573 7361 6765 293b 0a20 2020 2020 2020  essage);.       
-0000af90: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
-0000afa0: 6578 6365 7074 696f 6e73 2920 7b0a 2020  exceptions) {.  
-0000afb0: 2020 2020 2020 2020 2020 2020 2020 7468                th
-0000afc0: 726f 7720 6e65 7720 4578 6365 7074 696f  row new Exceptio
-0000afd0: 6e28 2465 7272 6f72 5f6d 6573 7361 6765  n($error_message
-0000afe0: 293b 0a20 2020 2020 2020 2020 2020 207d  );.            }
-0000aff0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000b000: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
-0000b010: 2020 2020 7d0a 2020 2020 2020 2020 2474      }.        $t
-0000b020: 6869 732d 3e46 726f 6d20 3d20 2461 6464  his->From = $add
-0000b030: 7265 7373 3b0a 2020 2020 2020 2020 2474  ress;.        $t
-0000b040: 6869 732d 3e46 726f 6d4e 616d 6520 3d20  his->FromName = 
-0000b050: 246e 616d 653b 0a20 2020 2020 2020 2069  $name;.        i
-0000b060: 6620 2824 6175 746f 2026 2620 656d 7074  f ($auto && empt
-0000b070: 7928 2474 6869 732d 3e53 656e 6465 7229  y($this->Sender)
-0000b080: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0000b090: 2474 6869 732d 3e53 656e 6465 7220 3d20  $this->Sender = 
-0000b0a0: 2461 6464 7265 7373 3b0a 2020 2020 2020  $address;.      
-0000b0b0: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
-0000b0c0: 7572 6e20 7472 7565 3b0a 2020 2020 7d0a  urn true;.    }.
-0000b0d0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0000b0e0: 5265 7475 726e 2074 6865 204d 6573 7361  Return the Messa
-0000b0f0: 6765 2d49 4420 6865 6164 6572 206f 6620  ge-ID header of 
-0000b100: 7468 6520 6c61 7374 2065 6d61 696c 2e0a  the last email..
-0000b110: 2020 2020 202a 2054 6563 686e 6963 616c       * Technical
-0000b120: 6c79 2074 6869 7320 6973 2074 6865 2076  ly this is the v
-0000b130: 616c 7565 2066 726f 6d20 7468 6520 6c61  alue from the la
-0000b140: 7374 2074 696d 6520 7468 6520 6865 6164  st time the head
-0000b150: 6572 7320 7765 7265 2063 7265 6174 6564  ers were created
-0000b160: 2c0a 2020 2020 202a 2062 7574 2069 7427  ,.     * but it'
-0000b170: 7320 616c 736f 2074 6865 206d 6573 7361  s also the messa
-0000b180: 6765 2049 4420 6f66 2074 6865 206c 6173  ge ID of the las
-0000b190: 7420 7365 6e74 206d 6573 7361 6765 2065  t sent message e
-0000b1a0: 7863 6570 7420 696e 0a20 2020 2020 2a20  xcept in.     * 
-0000b1b0: 7061 7468 6f6c 6f67 6963 616c 2063 6173  pathological cas
-0000b1c0: 6573 2e0a 2020 2020 202a 0a20 2020 2020  es..     *.     
-0000b1d0: 2a20 4072 6574 7572 6e20 7374 7269 6e67  * @return string
-0000b1e0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-0000b1f0: 6c69 6320 6675 6e63 7469 6f6e 2067 6574  lic function get
-0000b200: 4c61 7374 4d65 7373 6167 6549 4428 290a  LastMessageID().
-0000b210: 2020 2020 7b0a 2020 2020 2020 2020 7265      {.        re
-0000b220: 7475 726e 2024 7468 6973 2d3e 6c61 7374  turn $this->last
-0000b230: 4d65 7373 6167 6549 443b 0a20 2020 207d  MessageID;.    }
-0000b240: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-0000b250: 2043 6865 636b 2074 6861 7420 6120 7374   Check that a st
-0000b260: 7269 6e67 206c 6f6f 6b73 206c 696b 6520  ring looks like 
-0000b270: 616e 2065 6d61 696c 2061 6464 7265 7373  an email address
-0000b280: 2e0a 2020 2020 202a 2056 616c 6964 6174  ..     * Validat
-0000b290: 696f 6e20 7061 7474 6572 6e73 2073 7570  ion patterns sup
-0000b2a0: 706f 7274 6564 3a0a 2020 2020 202a 202a  ported:.     * *
-0000b2b0: 2060 6175 746f 6020 5069 636b 2062 6573   `auto` Pick bes
-0000b2c0: 7420 7061 7474 6572 6e20 6175 746f 6d61  t pattern automa
-0000b2d0: 7469 6361 6c6c 793b 0a20 2020 2020 2a20  tically;.     * 
-0000b2e0: 2a20 6070 6372 6538 6020 5573 6520 7468  * `pcre8` Use th
-0000b2f0: 6520 7371 7569 6c6f 6f70 6c65 2e63 6f6d  e squiloople.com
-0000b300: 2070 6174 7465 726e 2c20 7265 7175 6972   pattern, requir
-0000b310: 6573 2050 4352 4520 3e20 382e 303b 0a20  es PCRE > 8.0;. 
-0000b320: 2020 2020 2a20 2a20 6070 6372 6560 2055      * * `pcre` U
-0000b330: 7365 206f 6c64 2050 4352 4520 696d 706c  se old PCRE impl
-0000b340: 656d 656e 7461 7469 6f6e 3b0a 2020 2020  ementation;.    
-0000b350: 202a 202a 2060 7068 7060 2055 7365 2050   * * `php` Use P
-0000b360: 4850 2062 7569 6c74 2d69 6e20 4649 4c54  HP built-in FILT
-0000b370: 4552 5f56 414c 4944 4154 455f 454d 4149  ER_VALIDATE_EMAI
-0000b380: 4c3b 0a20 2020 2020 2a20 2a20 6068 746d  L;.     * * `htm
-0000b390: 6c35 6020 5573 6520 7468 6520 7061 7474  l5` Use the patt
-0000b3a0: 6572 6e20 6769 7665 6e20 6279 2074 6865  ern given by the
-0000b3b0: 2048 544d 4c35 2073 7065 6320 666f 7220   HTML5 spec for 
-0000b3c0: 2765 6d61 696c 2720 7479 7065 2066 6f72  'email' type for
-0000b3d0: 6d20 696e 7075 7420 656c 656d 656e 7473  m input elements
-0000b3e0: 2e0a 2020 2020 202a 202a 2060 6e6f 7265  ..     * * `nore
-0000b3f0: 6765 7860 2044 6f6e 2774 2075 7365 2061  gex` Don't use a
-0000b400: 2072 6567 6578 3a20 7375 7065 7220 6661   regex: super fa
-0000b410: 7374 2c20 7265 616c 6c79 2064 756d 622e  st, really dumb.
-0000b420: 0a20 2020 2020 2a20 416c 7465 726e 6174  .     * Alternat
-0000b430: 6976 656c 7920 796f 7520 6d61 7920 7061  ively you may pa
-0000b440: 7373 2069 6e20 6120 6361 6c6c 6162 6c65  ss in a callable
-0000b450: 2074 6f20 696e 6a65 6374 2079 6f75 7220   to inject your 
-0000b460: 6f77 6e20 7661 6c69 6461 746f 722c 2066  own validator, f
-0000b470: 6f72 2065 7861 6d70 6c65 3a0a 2020 2020  or example:.    
-0000b480: 202a 0a20 2020 2020 2a20 6060 6070 6870   *.     * ```php
-0000b490: 0a20 2020 2020 2a20 5048 504d 6169 6c65  .     * PHPMaile
-0000b4a0: 723a 3a76 616c 6964 6174 6541 6464 7265  r::validateAddre
-0000b4b0: 7373 2827 7573 6572 4065 7861 6d70 6c65  ss('user@example
-0000b4c0: 2e63 6f6d 272c 2066 756e 6374 696f 6e28  .com', function(
-0000b4d0: 2461 6464 7265 7373 2920 7b0a 2020 2020  $address) {.    
-0000b4e0: 202a 2020 2020 2072 6574 7572 6e20 2873   *     return (s
-0000b4f0: 7472 706f 7328 2461 6464 7265 7373 2c20  trpos($address, 
-0000b500: 2740 2729 2021 3d3d 2066 616c 7365 293b  '@') !== false);
-0000b510: 0a20 2020 2020 2a20 7d29 3b0a 2020 2020  .     * });.    
-0000b520: 202a 2060 6060 0a20 2020 2020 2a0a 2020   * ```.     *.  
-0000b530: 2020 202a 2059 6f75 2063 616e 2061 6c73     * You can als
-0000b540: 6f20 7365 7420 7468 6520 5048 504d 6169  o set the PHPMai
-0000b550: 6c65 723a 3a24 7661 6c69 6461 746f 7220  ler::$validator 
-0000b560: 7374 6174 6963 2074 6f20 6120 6361 6c6c  static to a call
-0000b570: 6162 6c65 2c20 616c 6c6f 7769 6e67 2062  able, allowing b
-0000b580: 7569 6c74 2d69 6e20 6d65 7468 6f64 7320  uilt-in methods 
-0000b590: 746f 2075 7365 2079 6f75 7220 7661 6c69  to use your vali
-0000b5a0: 6461 746f 722e 0a20 2020 2020 2a0a 2020  dator..     *.  
-0000b5b0: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-0000b5c0: 6e67 2020 2020 2020 2020 2020 2461 6464  ng          $add
-0000b5d0: 7265 7373 2020 2020 2020 2054 6865 2065  ress       The e
-0000b5e0: 6d61 696c 2061 6464 7265 7373 2074 6f20  mail address to 
-0000b5f0: 6368 6563 6b0a 2020 2020 202a 2040 7061  check.     * @pa
-0000b600: 7261 6d20 7374 7269 6e67 7c63 616c 6c61  ram string|calla
-0000b610: 626c 6520 2470 6174 7465 726e 7365 6c65  ble $patternsele
-0000b620: 6374 2057 6869 6368 2070 6174 7465 726e  ct Which pattern
-0000b630: 2074 6f20 7573 650a 2020 2020 202a 0a20   to use.     *. 
-0000b640: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
-0000b650: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
-0000b660: 7562 6c69 6320 7374 6174 6963 2066 756e  ublic static fun
-0000b670: 6374 696f 6e20 7661 6c69 6461 7465 4164  ction validateAd
-0000b680: 6472 6573 7328 2461 6464 7265 7373 2c20  dress($address, 
-0000b690: 2470 6174 7465 726e 7365 6c65 6374 203d  $patternselect =
-0000b6a0: 206e 756c 6c29 0a20 2020 207b 0a20 2020   null).    {.   
-0000b6b0: 2020 2020 2069 6620 286e 756c 6c20 3d3d       if (null ==
-0000b6c0: 3d20 2470 6174 7465 726e 7365 6c65 6374  = $patternselect
-0000b6d0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0000b6e0: 2470 6174 7465 726e 7365 6c65 6374 203d  $patternselect =
-0000b6f0: 2073 7461 7469 633a 3a24 7661 6c69 6461   static::$valida
-0000b700: 746f 723b 0a20 2020 2020 2020 207d 0a20  tor;.        }. 
-0000b710: 2020 2020 2020 202f 2f44 6f6e 2774 2061         //Don't a
-0000b720: 6c6c 6f77 2073 7472 696e 6773 2061 7320  llow strings as 
-0000b730: 6361 6c6c 6162 6c65 732c 2073 6565 2053  callables, see S
-0000b740: 4543 5552 4954 592e 6d64 2061 6e64 2043  ECURITY.md and C
-0000b750: 5645 2d32 3032 312d 3336 3033 0a20 2020  VE-2021-3603.   
-0000b760: 2020 2020 2069 6620 2869 735f 6361 6c6c       if (is_call
-0000b770: 6162 6c65 2824 7061 7474 6572 6e73 656c  able($patternsel
-0000b780: 6563 7429 2026 2620 2169 735f 7374 7269  ect) && !is_stri
-0000b790: 6e67 2824 7061 7474 6572 6e73 656c 6563  ng($patternselec
-0000b7a0: 7429 2920 7b0a 2020 2020 2020 2020 2020  t)) {.          
-0000b7b0: 2020 7265 7475 726e 2063 616c 6c5f 7573    return call_us
-0000b7c0: 6572 5f66 756e 6328 2470 6174 7465 726e  er_func($pattern
-0000b7d0: 7365 6c65 6374 2c20 2461 6464 7265 7373  select, $address
-0000b7e0: 293b 0a20 2020 2020 2020 207d 0a20 2020  );.        }.   
-0000b7f0: 2020 2020 202f 2f52 656a 6563 7420 6c69       //Reject li
-0000b800: 6e65 2062 7265 616b 7320 696e 2061 6464  ne breaks in add
-0000b810: 7265 7373 6573 3b20 6974 2773 2076 616c  resses; it's val
-0000b820: 6964 2052 4643 3533 3232 2c20 6275 7420  id RFC5322, but 
-0000b830: 6e6f 7420 5246 4335 3332 310a 2020 2020  not RFC5321.    
-0000b840: 2020 2020 6966 2028 7374 7270 6f73 2824      if (strpos($
-0000b850: 6164 6472 6573 732c 2022 5c6e 2229 2021  address, "\n") !
-0000b860: 3d3d 2066 616c 7365 207c 7c20 7374 7270  == false || strp
-0000b870: 6f73 2824 6164 6472 6573 732c 2022 5c72  os($address, "\r
-0000b880: 2229 2021 3d3d 2066 616c 7365 2920 7b0a  ") !== false) {.
-0000b890: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000b8a0: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
-0000b8b0: 2020 7d0a 2020 2020 2020 2020 7377 6974    }.        swit
-0000b8c0: 6368 2028 2470 6174 7465 726e 7365 6c65  ch ($patternsele
-0000b8d0: 6374 2920 7b0a 2020 2020 2020 2020 2020  ct) {.          
-0000b8e0: 2020 6361 7365 2027 7063 7265 273a 202f    case 'pcre': /
-0000b8f0: 2f4b 6570 7420 666f 7220 4243 0a20 2020  /Kept for BC.   
-0000b900: 2020 2020 2020 2020 2063 6173 6520 2770           case 'p
-0000b910: 6372 6538 273a 0a20 2020 2020 2020 2020  cre8':.         
-0000b920: 2020 2020 2020 202f 2a0a 2020 2020 2020         /*.      
-0000b930: 2020 2020 2020 2020 2020 202a 2041 206d             * A m
-0000b940: 6f72 6520 636f 6d70 6c65 7820 616e 6420  ore complex and 
-0000b950: 6d6f 7265 2070 6572 6d69 7373 6976 6520  more permissive 
-0000b960: 7665 7273 696f 6e20 6f66 2074 6865 2052  version of the R
-0000b970: 4643 3533 3232 2072 6567 6578 206f 6e20  FC5322 regex on 
-0000b980: 7768 6963 6820 4649 4c54 4552 5f56 414c  which FILTER_VAL
-0000b990: 4944 4154 455f 454d 4149 4c0a 2020 2020  IDATE_EMAIL.    
-0000b9a0: 2020 2020 2020 2020 2020 2020 202a 2069               * i
-0000b9b0: 7320 6261 7365 642e 0a20 2020 2020 2020  s based..       
-0000b9c0: 2020 2020 2020 2020 2020 2a20 496e 2061            * In a
-0000b9d0: 6464 6974 696f 6e20 746f 2074 6865 2061  ddition to the a
-0000b9e0: 6464 7265 7373 6573 2061 6c6c 6f77 6564  ddresses allowed
-0000b9f0: 2062 7920 6669 6c74 6572 5f76 6172 2c20   by filter_var, 
-0000ba00: 616c 736f 2070 6572 6d69 7473 3a0a 2020  also permits:.  
-0000ba10: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0000ba20: 2020 2a20 646f 746c 6573 7320 646f 6d61    * dotless doma
-0000ba30: 696e 733a 2060 6140 6260 0a20 2020 2020  ins: `a@b`.     
-0000ba40: 2020 2020 2020 2020 2020 2020 2a20 202a              *  *
-0000ba50: 2063 6f6d 6d65 6e74 733a 2060 3132 3334   comments: `1234
-0000ba60: 2040 206c 6f63 616c 2862 6c61 6829 202e   @ local(blah) .
-0000ba70: 6d61 6368 696e 6520 2e65 7861 6d70 6c65  machine .example
-0000ba80: 600a 2020 2020 2020 2020 2020 2020 2020  `.              
-0000ba90: 2020 202a 2020 2a20 7175 6f74 6564 2065     *  * quoted e
-0000baa0: 6c65 6d65 6e74 733a 2060 2722 7465 7374  lements: `'"test
-0000bab0: 2062 6c61 6822 4065 7861 6d70 6c65 2e6f   blah"@example.o
-0000bac0: 7267 2760 0a20 2020 2020 2020 2020 2020  rg'`.           
-0000bad0: 2020 2020 2020 2a20 202a 206e 756d 6572        *  * numer
-0000bae0: 6963 2054 4c44 733a 2060 6140 622e 3132  ic TLDs: `a@b.12
-0000baf0: 3360 0a20 2020 2020 2020 2020 2020 2020  3`.             
-0000bb00: 2020 2020 2a20 202a 2075 6e62 7261 636b      *  * unbrack
-0000bb10: 6574 6564 2049 5076 3420 6c69 7465 7261  eted IPv4 litera
-0000bb20: 6c73 3a20 6061 4031 3932 2e31 3638 2e30  ls: `a@192.168.0
-0000bb30: 2e31 600a 2020 2020 2020 2020 2020 2020  .1`.            
-0000bb40: 2020 2020 202a 2020 2a20 4950 7636 206c       *  * IPv6 l
-0000bb50: 6974 6572 616c 733a 2027 6669 7273 742e  iterals: 'first.
-0000bb60: 6c61 7374 405b 4950 7636 3a61 313a 3a5d  last@[IPv6:a1::]
-0000bb70: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000bb80: 2020 202a 204e 6f74 2061 6c6c 206f 6620     * Not all of 
-0000bb90: 7468 6573 6520 7769 6c6c 206e 6563 6573  these will neces
-0000bba0: 7361 7269 6c79 2077 6f72 6b20 666f 7220  sarily work for 
-0000bbb0: 7365 6e64 696e 6721 0a20 2020 2020 2020  sending!.       
-0000bbc0: 2020 2020 2020 2020 2020 2a0a 2020 2020            *.    
-0000bbd0: 2020 2020 2020 2020 2020 2020 202a 2040               * @
-0000bbe0: 7365 6520 2020 2020 2020 6874 7470 3a2f  see       http:/
-0000bbf0: 2f73 7175 696c 6f6f 706c 652e 636f 6d2f  /squiloople.com/
-0000bc00: 3230 3039 2f31 322f 3230 2f65 6d61 696c  2009/12/20/email
-0000bc10: 2d61 6464 7265 7373 2d76 616c 6964 6174  -address-validat
-0000bc20: 696f 6e2f 0a20 2020 2020 2020 2020 2020  ion/.           
-0000bc30: 2020 2020 2020 2a20 4063 6f70 7972 6967        * @copyrig
-0000bc40: 6874 2032 3030 392d 3230 3130 204d 6963  ht 2009-2010 Mic
-0000bc50: 6861 656c 2052 7573 6874 6f6e 0a20 2020  hael Rushton.   
-0000bc60: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-0000bc70: 4665 656c 2066 7265 6520 746f 2075 7365  Feel free to use
-0000bc80: 2061 6e64 2072 6564 6973 7472 6962 7574   and redistribut
-0000bc90: 6520 7468 6973 2063 6f64 652e 2042 7574  e this code. But
-0000bca0: 2070 6c65 6173 6520 6b65 6570 2074 6869   please keep thi
-0000bcb0: 7320 636f 7079 7269 6768 7420 6e6f 7469  s copyright noti
-0000bcc0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-0000bcd0: 2020 2020 202a 2f0a 2020 2020 2020 2020       */.        
-0000bce0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0000bcf0: 626f 6f6c 2920 7072 6567 5f6d 6174 6368  bool) preg_match
-0000bd00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000bd10: 2020 2020 2020 272f 5e28 3f21 283f 3e28        '/^(?!(?>(
-0000bd20: 3f31 2922 3f28 3f3e 5c5c 5c5b 202d 7e5d  ?1)"?(?>\\\[ -~]
-0000bd30: 7c5b 5e22 5d29 223f 283f 3129 297b 3235  |[^"])"?(?1)){25
-0000bd40: 352c 7d29 283f 2128 3f3e 283f 3129 223f  5,})(?!(?>(?1)"?
-0000bd50: 283f 3e5c 5c5c 5b20 2d7e 5d7c 5b5e 225d  (?>\\\[ -~]|[^"]
-0000bd60: 2922 3f28 3f31 2929 7b36 352c 7d40 2927  )"?(?1)){65,}@)'
-0000bd70: 202e 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000bd80: 2020 2020 2020 2027 2828 3f3e 283f 3e28         '((?>(?>(
-0000bd90: 3f3e 2828 3f3e 283f 3e28 3f3e 5c78 3044  ?>((?>(?>(?>\x0D
-0000bda0: 5c78 3041 293f 5b5c 7420 5d29 2b7c 283f  \x0A)?[\t ])+|(?
-0000bdb0: 3e5b 5c74 205d 2a5c 7830 445c 7830 4129  >[\t ]*\x0D\x0A)
-0000bdc0: 3f5b 5c74 205d 2b29 3f29 285c 2828 3f3e  ?[\t ]+)?)(\((?>
-0000bdd0: 283f 3229 2720 2e0a 2020 2020 2020 2020  (?2)' ..        
-0000bde0: 2020 2020 2020 2020 2020 2020 2728 3f3e              '(?>
-0000bdf0: 5b5c 7830 312d 5c78 3038 5c78 3042 5c78  [\x01-\x08\x0B\x
-0000be00: 3043 5c78 3045 2d5c 272a 2d5c 5b5c 5d2d  0C\x0E-\'*-\[\]-
-0000be10: 5c78 3746 5d7c 5c5c 5c5b 5c78 3030 2d5c  \x7F]|\\\[\x00-\
-0000be20: 7837 465d 7c28 3f33 2929 292a 283f 3229  x7F]|(?3)))*(?2)
-0000be30: 5c29 2929 2b28 3f32 2929 7c28 3f32 2929  \)))+(?2))|(?2))
-0000be40: 3f29 2720 2e0a 2020 2020 2020 2020 2020  ?)' ..          
-0000be50: 2020 2020 2020 2020 2020 2728 5b21 232d            '([!#-
-0000be60: 5c27 2a2b 5c2f 2d39 3d3f 5e2d 7e2d 5d2b  \'*+\/-9=?^-~-]+
-0000be70: 7c22 283f 3e28 3f32 2928 3f3e 5b5c 7830  |"(?>(?2)(?>[\x0
-0000be80: 312d 5c78 3038 5c78 3042 5c78 3043 5c78  1-\x08\x0B\x0C\x
-0000be90: 3045 2d21 232d 5c5b 5c5d 2d5c 7837 465d  0E-!#-\[\]-\x7F]
-0000bea0: 7c5c 5c5c 5b5c 7830 302d 5c78 3746 5d29  |\\\[\x00-\x7F])
-0000beb0: 292a 2720 2e0a 2020 2020 2020 2020 2020  )*' ..          
-0000bec0: 2020 2020 2020 2020 2020 2728 3f32 2922            '(?2)"
-0000bed0: 2928 3f3e 283f 3129 5c2e 283f 3129 283f  )(?>(?1)\.(?1)(?
-0000bee0: 3429 292a 283f 3129 4028 3f21 283f 3129  4))*(?1)@(?!(?1)
-0000bef0: 5b61 2d7a 302d 392d 5d7b 3634 2c7d 2928  [a-z0-9-]{64,})(
-0000bf00: 3f31 2928 3f3e 285b 612d 7a30 2d39 5d28  ?1)(?>([a-z0-9](
-0000bf10: 3f3e 5b61 2d7a 302d 392d 5d2a 5b61 2d7a  ?>[a-z0-9-]*[a-z
-0000bf20: 302d 395d 293f 2927 202e 0a20 2020 2020  0-9])?)' ..     
-0000bf30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000bf40: 283f 3e28 3f31 295c 2e28 3f21 283f 3129  (?>(?1)\.(?!(?1)
-0000bf50: 5b61 2d7a 302d 392d 5d7b 3634 2c7d 2928  [a-z0-9-]{64,})(
-0000bf60: 3f31 2928 3f35 2929 7b30 2c31 3236 7d7c  ?1)(?5)){0,126}|
-0000bf70: 5c5b 283f 3a28 3f3e 4950 7636 3a28 3f3e  \[(?:(?>IPv6:(?>
-0000bf80: 285b 612d 6630 2d39 5d7b 312c 347d 2928  ([a-f0-9]{1,4})(
-0000bf90: 3f3e 3a28 3f36 2929 7b37 7d27 202e 0a20  ?>:(?6)){7}' .. 
-0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfb0: 2020 2027 7c28 3f21 283f 3a2e 2a5b 612d     '|(?!(?:.*[a-
-0000bfc0: 6630 2d39 5d5b 3a5c 5d5d 297b 382c 7d29  f0-9][:\]]){8,})
-0000bfd0: 2828 3f36 2928 3f3e 3a28 3f36 2929 7b30  ((?6)(?>:(?6)){0
-0000bfe0: 2c36 7d29 3f3a 3a28 3f37 293f 2929 7c28  ,6})?::(?7)?))|(
-0000bff0: 3f3e 283f 3e49 5076 363a 283f 3e28 3f36  ?>(?>IPv6:(?>(?6
-0000c000: 2928 3f3e 3a28 3f36 2929 7b35 7d3a 2720  )(?>:(?6)){5}:' 
-0000c010: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c020: 2020 2020 2020 277c 283f 2128 3f3a 2e2a        '|(?!(?:.*
-0000c030: 5b61 2d66 302d 395d 3a29 7b36 2c7d 2928  [a-f0-9]:){6,})(
-0000c040: 3f38 293f 3a3a 283f 3e28 283f 3629 283f  ?8)?::(?>((?6)(?
-0000c050: 3e3a 283f 3629 297b 302c 347d 293a 293f  >:(?6)){0,4}):)?
-0000c060: 2929 3f28 3235 5b30 2d35 5d7c 325b 302d  ))?(25[0-5]|2[0-
-0000c070: 345d 5b30 2d39 5d7c 315b 302d 395d 7b32  4][0-9]|1[0-9]{2
-0000c080: 7d27 202e 0a20 2020 2020 2020 2020 2020  }' ..           
-0000c090: 2020 2020 2020 2020 2027 7c5b 312d 395d           '|[1-9]
-0000c0a0: 3f5b 302d 395d 2928 3f3e 5c2e 283f 3929  ?[0-9])(?>\.(?9)
-0000c0b0: 297b 337d 2929 5c5d 2928 3f31 2924 2f69  ){3}))\])(?1)$/i
-0000c0c0: 7344 272c 0a20 2020 2020 2020 2020 2020  sD',.           
-0000c0d0: 2020 2020 2020 2020 2024 6164 6472 6573           $addres
-0000c0e0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0000c0f0: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
-0000c100: 2063 6173 6520 2768 746d 6c35 273a 0a20   case 'html5':. 
-0000c110: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-0000c120: 2a0a 2020 2020 2020 2020 2020 2020 2020  *.              
-0000c130: 2020 202a 2054 6869 7320 6973 2074 6865     * This is the
-0000c140: 2070 6174 7465 726e 2075 7365 6420 696e   pattern used in
-0000c150: 2074 6865 2048 544d 4c35 2073 7065 6320   the HTML5 spec 
-0000c160: 666f 7220 7661 6c69 6461 7469 6f6e 206f  for validation o
-0000c170: 6620 2765 6d61 696c 2720 7479 7065 2066  f 'email' type f
-0000c180: 6f72 6d20 696e 7075 7420 656c 656d 656e  orm input elemen
-0000c190: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
-0000c1a0: 2020 2020 202a 0a20 2020 2020 2020 2020       *.         
-0000c1b0: 2020 2020 2020 2020 2a20 4073 6565 2068          * @see h
-0000c1c0: 7474 7073 3a2f 2f68 746d 6c2e 7370 6563  ttps://html.spec
-0000c1d0: 2e77 6861 7477 672e 6f72 672f 2365 2d6d  .whatwg.org/#e-m
-0000c1e0: 6169 6c2d 7374 6174 652d 2874 7970 653d  ail-state-(type=
-0000c1f0: 656d 6169 6c29 0a20 2020 2020 2020 2020  email).         
-0000c200: 2020 2020 2020 2020 2a2f 0a20 2020 2020          */.     
-0000c210: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000c220: 6e20 2862 6f6f 6c29 2070 7265 675f 6d61  n (bool) preg_ma
-0000c230: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
-0000c240: 2020 2020 2020 2020 2027 2f5e 5b61 2d7a           '/^[a-z
-0000c250: 412d 5a30 2d39 2e21 2324 2526 5c27 2a2b  A-Z0-9.!#$%&\'*+
-0000c260: 5c2f 3d3f 5e5f 607b 7c7d 7e2d 5d2b 405b  \/=?^_`{|}~-]+@[
-0000c270: 612d 7a41 2d5a 302d 395d 283f 3a5b 612d  a-zA-Z0-9](?:[a-
-0000c280: 7a41 2d5a 302d 392d 5d7b 302c 3631 7d27  zA-Z0-9-]{0,61}'
-0000c290: 202e 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000c2a0: 2020 2020 2020 2027 5b61 2d7a 412d 5a30         '[a-zA-Z0
-0000c2b0: 2d39 5d29 3f28 3f3a 5c2e 5b61 2d7a 412d  -9])?(?:\.[a-zA-
-0000c2c0: 5a30 2d39 5d28 3f3a 5b61 2d7a 412d 5a30  Z0-9](?:[a-zA-Z0
-0000c2d0: 2d39 2d5d 7b30 2c36 317d 5b61 2d7a 412d  -9-]{0,61}[a-zA-
-0000c2e0: 5a30 2d39 5d29 3f29 2a24 2f73 4427 2c0a  Z0-9])?)*$/sD',.
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c300: 2020 2020 2461 6464 7265 7373 0a20 2020      $address.   
-0000c310: 2020 2020 2020 2020 2020 2020 2029 3b0a               );.
-0000c320: 2020 2020 2020 2020 2020 2020 6361 7365              case
-0000c330: 2027 7068 7027 3a0a 2020 2020 2020 2020   'php':.        
-0000c340: 2020 2020 6465 6661 756c 743a 0a20 2020      default:.   
-0000c350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000c360: 7572 6e20 6669 6c74 6572 5f76 6172 2824  urn filter_var($
-0000c370: 6164 6472 6573 732c 2046 494c 5445 525f  address, FILTER_
-0000c380: 5641 4c49 4441 5445 5f45 4d41 494c 2920  VALIDATE_EMAIL) 
-0000c390: 213d 3d20 6661 6c73 653b 0a20 2020 2020  !== false;.     
-0000c3a0: 2020 207d 0a20 2020 207d 0a0a 2020 2020     }.    }..    
-0000c3b0: 2f2a 2a0a 2020 2020 202a 2054 656c 6c73  /**.     * Tells
-0000c3c0: 2077 6865 7468 6572 2049 444e 7320 2849   whether IDNs (I
-0000c3d0: 6e74 6572 6e61 7469 6f6e 616c 697a 6564  nternationalized
-0000c3e0: 2044 6f6d 6169 6e20 4e61 6d65 7329 2061   Domain Names) a
-0000c3f0: 7265 2073 7570 706f 7274 6564 206f 7220  re supported or 
-0000c400: 6e6f 742e 2054 6869 7320 7265 7175 6972  not. This requir
-0000c410: 6573 2074 6865 0a20 2020 2020 2a20 6069  es the.     * `i
-0000c420: 6e74 6c60 2061 6e64 2060 6d62 7374 7269  ntl` and `mbstri
-0000c430: 6e67 6020 5048 5020 6578 7465 6e73 696f  ng` PHP extensio
-0000c440: 6e73 2e0a 2020 2020 202a 0a20 2020 2020  ns..     *.     
-0000c450: 2a20 4072 6574 7572 6e20 626f 6f6c 2060  * @return bool `
-0000c460: 7472 7565 6020 6966 2072 6571 7569 7265  true` if require
-0000c470: 6420 6675 6e63 7469 6f6e 7320 666f 7220  d functions for 
-0000c480: 4944 4e20 7375 7070 6f72 7420 6172 6520  IDN support are 
-0000c490: 7072 6573 656e 740a 2020 2020 202a 2f0a  present.     */.
-0000c4a0: 2020 2020 7075 626c 6963 2073 7461 7469      public stati
-0000c4b0: 6320 6675 6e63 7469 6f6e 2069 646e 5375  c function idnSu
-0000c4c0: 7070 6f72 7465 6428 290a 2020 2020 7b0a  pported().    {.
-0000c4d0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0000c4e0: 756e 6374 696f 6e5f 6578 6973 7473 2827  unction_exists('
-0000c4f0: 6964 6e5f 746f 5f61 7363 6969 2729 2026  idn_to_ascii') &
-0000c500: 2620 6675 6e63 7469 6f6e 5f65 7869 7374  & function_exist
-0000c510: 7328 276d 625f 636f 6e76 6572 745f 656e  s('mb_convert_en
-0000c520: 636f 6469 6e67 2729 3b0a 2020 2020 7d0a  coding');.    }.
-0000c530: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0000c540: 436f 6e76 6572 7473 2049 444e 2069 6e20  Converts IDN in 
-0000c550: 6769 7665 6e20 656d 6169 6c20 6164 6472  given email addr
-0000c560: 6573 7320 746f 2069 7473 2041 5343 4949  ess to its ASCII
-0000c570: 2066 6f72 6d2c 2061 6c73 6f20 6b6e 6f77   form, also know
-0000c580: 6e20 6173 2070 756e 7963 6f64 652c 2069  n as punycode, i
-0000c590: 6620 706f 7373 6962 6c65 2e0a 2020 2020  f possible..    
-0000c5a0: 202a 2049 6d70 6f72 7461 6e74 3a20 4164   * Important: Ad
-0000c5b0: 6472 6573 7320 6d75 7374 2062 6520 7061  dress must be pa
-0000c5c0: 7373 6564 2069 6e20 7361 6d65 2065 6e63  ssed in same enc
-0000c5d0: 6f64 696e 6720 6173 2063 7572 7265 6e74  oding as current
-0000c5e0: 6c79 2073 6574 2069 6e20 5048 504d 6169  ly set in PHPMai
-0000c5f0: 6c65 723a 3a24 4368 6172 5365 742e 0a20  ler::$CharSet.. 
-0000c600: 2020 2020 2a20 5468 6973 2066 756e 6374      * This funct
-0000c610: 696f 6e20 7369 6c65 6e74 6c79 2072 6574  ion silently ret
-0000c620: 7572 6e73 2075 6e6d 6f64 6966 6965 6420  urns unmodified 
-0000c630: 6164 6472 6573 7320 6966 3a0a 2020 2020  address if:.    
-0000c640: 202a 202d 204e 6f20 636f 6e76 6572 7369   * - No conversi
-0000c650: 6f6e 2069 7320 6e65 6365 7373 6172 7920  on is necessary 
-0000c660: 2869 2e65 2e20 646f 6d61 696e 206e 616d  (i.e. domain nam
-0000c670: 6520 6973 206e 6f74 2061 6e20 4944 4e2c  e is not an IDN,
-0000c680: 206f 7220 6973 2061 6c72 6561 6479 2069   or is already i
-0000c690: 6e20 4153 4349 4920 666f 726d 290a 2020  n ASCII form).  
-0000c6a0: 2020 202a 202d 2043 6f6e 7665 7273 696f     * - Conversio
-0000c6b0: 6e20 746f 2070 756e 7963 6f64 6520 6973  n to punycode is
-0000c6c0: 2069 6d70 6f73 7369 626c 6520 2865 2e67   impossible (e.g
-0000c6d0: 2e20 7265 7175 6972 6564 2050 4850 2066  . required PHP f
-0000c6e0: 756e 6374 696f 6e73 2061 7265 206e 6f74  unctions are not
-0000c6f0: 2061 7661 696c 6162 6c65 290a 2020 2020   available).    
-0000c700: 202a 2020 206f 7220 6661 696c 7320 666f   *   or fails fo
-0000c710: 7220 616e 7920 7265 6173 6f6e 2028 652e  r any reason (e.
-0000c720: 672e 2064 6f6d 6169 6e20 636f 6e74 6169  g. domain contai
-0000c730: 6e73 2063 6861 7261 6374 6572 7320 6e6f  ns characters no
-0000c740: 7420 616c 6c6f 7765 6420 696e 2061 6e20  t allowed in an 
-0000c750: 4944 4e29 2e0a 2020 2020 202a 0a20 2020  IDN)..     *.   
-0000c760: 2020 2a20 4073 6565 2050 4850 4d61 696c    * @see PHPMail
-0000c770: 6572 3a3a 2443 6861 7253 6574 0a20 2020  er::$CharSet.   
-0000c780: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-0000c790: 6d20 7374 7269 6e67 2024 6164 6472 6573  m string $addres
-0000c7a0: 7320 5468 6520 656d 6169 6c20 6164 6472  s The email addr
-0000c7b0: 6573 7320 746f 2063 6f6e 7665 7274 0a20  ess to convert. 
-0000c7c0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-0000c7d0: 7475 726e 2073 7472 696e 6720 5468 6520  turn string The 
-0000c7e0: 656e 636f 6465 6420 6164 6472 6573 7320  encoded address 
-0000c7f0: 696e 2041 5343 4949 2066 6f72 6d0a 2020  in ASCII form.  
-0000c800: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
-0000c810: 2066 756e 6374 696f 6e20 7075 6e79 656e   function punyen
-0000c820: 636f 6465 4164 6472 6573 7328 2461 6464  codeAddress($add
-0000c830: 7265 7373 290a 2020 2020 7b0a 2020 2020  ress).    {.    
-0000c840: 2020 2020 2f2f 5665 7269 6679 2077 6520      //Verify we 
-0000c850: 6861 7665 2072 6571 7569 7265 6420 6675  have required fu
-0000c860: 6e63 7469 6f6e 732c 2043 6861 7253 6574  nctions, CharSet
-0000c870: 2c20 616e 6420 6174 2d73 6967 6e2e 0a20  , and at-sign.. 
-0000c880: 2020 2020 2020 2024 706f 7320 3d20 7374         $pos = st
-0000c890: 7272 706f 7328 2461 6464 7265 7373 2c20  rrpos($address, 
-0000c8a0: 2740 2729 3b0a 2020 2020 2020 2020 6966  '@');.        if
-0000c8b0: 2028 0a20 2020 2020 2020 2020 2020 2021   (.            !
-0000c8c0: 656d 7074 7928 2474 6869 732d 3e43 6861  empty($this->Cha
-0000c8d0: 7253 6574 2920 2626 0a20 2020 2020 2020  rSet) &&.       
-0000c8e0: 2020 2020 2066 616c 7365 2021 3d3d 2024       false !== $
-0000c8f0: 706f 7320 2626 0a20 2020 2020 2020 2020  pos &&.         
-0000c900: 2020 2073 7461 7469 633a 3a69 646e 5375     static::idnSu
-0000c910: 7070 6f72 7465 6428 290a 2020 2020 2020  pported().      
-0000c920: 2020 2920 7b0a 2020 2020 2020 2020 2020    ) {.          
-0000c930: 2020 2464 6f6d 6169 6e20 3d20 7375 6273    $domain = subs
-0000c940: 7472 2824 6164 6472 6573 732c 202b 2b24  tr($address, ++$
-0000c950: 706f 7329 3b0a 2020 2020 2020 2020 2020  pos);.          
-0000c960: 2020 2f2f 5665 7269 6679 2043 6861 7253    //Verify CharS
-0000c970: 6574 2073 7472 696e 6720 6973 2061 2076  et string is a v
-0000c980: 616c 6964 206f 6e65 2c20 616e 6420 646f  alid one, and do
-0000c990: 6d61 696e 2070 726f 7065 726c 7920 656e  main properly en
-0000c9a0: 636f 6465 6420 696e 2074 6869 7320 4368  coded in this Ch
-0000c9b0: 6172 5365 742e 0a20 2020 2020 2020 2020  arSet..         
-0000c9c0: 2020 2069 6620 2824 7468 6973 2d3e 6861     if ($this->ha
-0000c9d0: 7338 6269 7443 6861 7273 2824 646f 6d61  s8bitChars($doma
-0000c9e0: 696e 2920 2626 2040 6d62 5f63 6865 636b  in) && @mb_check
-0000c9f0: 5f65 6e63 6f64 696e 6728 2464 6f6d 6169  _encoding($domai
-0000ca00: 6e2c 2024 7468 6973 2d3e 4368 6172 5365  n, $this->CharSe
-0000ca10: 7429 2920 7b0a 2020 2020 2020 2020 2020  t)) {.          
-0000ca20: 2020 2020 2020 2f2f 436f 6e76 6572 7420        //Convert 
-0000ca30: 7468 6520 646f 6d61 696e 2066 726f 6d20  the domain from 
-0000ca40: 7768 6174 6576 6572 2063 6861 7273 6574  whatever charset
-0000ca50: 2069 7427 7320 696e 2074 6f20 5554 462d   it's in to UTF-
-0000ca60: 380a 2020 2020 2020 2020 2020 2020 2020  8.              
-0000ca70: 2020 2464 6f6d 6169 6e20 3d20 6d62 5f63    $domain = mb_c
-0000ca80: 6f6e 7665 7274 5f65 6e63 6f64 696e 6728  onvert_encoding(
-0000ca90: 2464 6f6d 6169 6e2c 2073 656c 663a 3a43  $domain, self::C
-0000caa0: 4841 5253 4554 5f55 5446 382c 2024 7468  HARSET_UTF8, $th
-0000cab0: 6973 2d3e 4368 6172 5365 7429 3b0a 2020  is->CharSet);.  
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-0000cad0: 4967 6e6f 7265 2049 4445 2063 6f6d 706c  Ignore IDE compl
-0000cae0: 6169 6e74 7320 6162 6f75 7420 7468 6973  aints about this
-0000caf0: 206c 696e 6520 2d20 6d65 7468 6f64 2073   line - method s
-0000cb00: 6967 6e61 7475 7265 2063 6861 6e67 6564  ignature changed
-0000cb10: 2069 6e20 5048 5020 352e 340a 2020 2020   in PHP 5.4.    
-0000cb20: 2020 2020 2020 2020 2020 2020 2465 7272              $err
-0000cb30: 6f72 636f 6465 203d 2030 3b0a 2020 2020  orcode = 0;.    
-0000cb40: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0000cb50: 6465 6669 6e65 6428 2749 4e54 4c5f 4944  defined('INTL_ID
-0000cb60: 4e41 5f56 4152 4941 4e54 5f55 5453 3436  NA_VARIANT_UTS46
-0000cb70: 2729 2920 7b0a 2020 2020 2020 2020 2020  ')) {.          
-0000cb80: 2020 2020 2020 2020 2020 2f2f 5573 6520            //Use 
-0000cb90: 7468 6520 6375 7272 656e 7420 7075 6e79  the current puny
-0000cba0: 636f 6465 2073 7461 6e64 6172 6420 2861  code standard (a
-0000cbb0: 7070 6561 7265 6420 696e 2050 4850 2037  ppeared in PHP 7
-0000cbc0: 2e32 290a 2020 2020 2020 2020 2020 2020  .2).            
-0000cbd0: 2020 2020 2020 2020 2470 756e 7963 6f64          $punycod
-0000cbe0: 6520 3d20 6964 6e5f 746f 5f61 7363 6969  e = idn_to_ascii
-0000cbf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000cc00: 2020 2020 2020 2020 2020 2464 6f6d 6169            $domai
-0000cc10: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0000cc20: 2020 2020 2020 2020 2020 205c 4944 4e41             \IDNA
-0000cc30: 5f44 4546 4155 4c54 207c 205c 4944 4e41  _DEFAULT | \IDNA
-0000cc40: 5f55 5345 5f53 5444 335f 5255 4c45 5320  _USE_STD3_RULES 
-0000cc50: 7c20 5c49 444e 415f 4348 4543 4b5f 4249  | \IDNA_CHECK_BI
-0000cc60: 4449 207c 0a20 2020 2020 2020 2020 2020  DI |.           
-0000cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc80: 205c 4944 4e41 5f43 4845 434b 5f43 4f4e   \IDNA_CHECK_CON
-0000cc90: 5445 5854 4a20 7c20 5c49 444e 415f 4e4f  TEXTJ | \IDNA_NO
-0000cca0: 4e54 5241 4e53 4954 494f 4e41 4c5f 544f  NTRANSITIONAL_TO
-0000ccb0: 5f41 5343 4949 2c0a 2020 2020 2020 2020  _ASCII,.        
-0000ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ccd0: 5c49 4e54 4c5f 4944 4e41 5f56 4152 4941  \INTL_IDNA_VARIA
-0000cce0: 4e54 5f55 5453 3436 0a20 2020 2020 2020  NT_UTS46.       
-0000ccf0: 2020 2020 2020 2020 2020 2020 2029 3b0a               );.
-0000cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd10: 7d20 656c 7365 6966 2028 6465 6669 6e65  } elseif (define
-0000cd20: 6428 2749 4e54 4c5f 4944 4e41 5f56 4152  d('INTL_IDNA_VAR
-0000cd30: 4941 4e54 5f32 3030 3327 2929 207b 0a20  IANT_2003')) {. 
-0000cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd50: 2020 202f 2f46 616c 6c20 6261 636b 2074     //Fall back t
-0000cd60: 6f20 7468 6973 206f 6c64 2c20 6465 7072  o this old, depr
-0000cd70: 6563 6174 6564 2f72 656d 6f76 6564 2065  ecated/removed e
-0000cd80: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
-0000cd90: 2020 2020 2020 2020 2020 2020 2470 756e              $pun
-0000cda0: 7963 6f64 6520 3d20 6964 6e5f 746f 5f61  ycode = idn_to_a
-0000cdb0: 7363 6969 2824 646f 6d61 696e 2c20 2465  scii($domain, $e
-0000cdc0: 7272 6f72 636f 6465 2c20 5c49 4e54 4c5f  rrorcode, \INTL_
-0000cdd0: 4944 4e41 5f56 4152 4941 4e54 5f32 3030  IDNA_VARIANT_200
-0000cde0: 3329 3b0a 2020 2020 2020 2020 2020 2020  3);.            
-0000cdf0: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
-0000ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce10: 202f 2f46 616c 6c20 6261 636b 2074 6f20   //Fall back to 
-0000ce20: 6120 6465 6661 756c 7420 7765 2064 6f6e  a default we don
-0000ce30: 2774 206b 6e6f 7720 6162 6f75 740a 2020  't know about.  
-0000ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce50: 2020 2470 756e 7963 6f64 6520 3d20 6964    $punycode = id
-0000ce60: 6e5f 746f 5f61 7363 6969 2824 646f 6d61  n_to_ascii($doma
-0000ce70: 696e 2c20 2465 7272 6f72 636f 6465 293b  in, $errorcode);
-0000ce80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ce90: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-0000cea0: 2020 2069 6620 2866 616c 7365 2021 3d3d     if (false !==
-0000ceb0: 2024 7075 6e79 636f 6465 2920 7b0a 2020   $punycode) {.  
-0000cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ced0: 2020 7265 7475 726e 2073 7562 7374 7228    return substr(
-0000cee0: 2461 6464 7265 7373 2c20 302c 2024 706f  $address, 0, $po
-0000cef0: 7329 202e 2024 7075 6e79 636f 6465 3b0a  s) . $punycode;.
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf10: 7d0a 2020 2020 2020 2020 2020 2020 7d0a  }.            }.
-0000cf20: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0000cf30: 2020 2072 6574 7572 6e20 2461 6464 7265     return $addre
-0000cf40: 7373 3b0a 2020 2020 7d0a 0a20 2020 202f  ss;.    }..    /
-0000cf50: 2a2a 0a20 2020 2020 2a20 4372 6561 7465  **.     * Create
-0000cf60: 2061 206d 6573 7361 6765 2061 6e64 2073   a message and s
-0000cf70: 656e 6420 6974 2e0a 2020 2020 202a 2055  end it..     * U
-0000cf80: 7365 7320 7468 6520 7365 6e64 696e 6720  ses the sending 
-0000cf90: 6d65 7468 6f64 2073 7065 6369 6669 6564  method specified
-0000cfa0: 2062 7920 244d 6169 6c65 722e 0a20 2020   by $Mailer..   
-0000cfb0: 2020 2a0a 2020 2020 202a 2040 7468 726f    *.     * @thro
-0000cfc0: 7773 2045 7863 6570 7469 6f6e 0a20 2020  ws Exception.   
-0000cfd0: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
-0000cfe0: 726e 2062 6f6f 6c20 6661 6c73 6520 6f6e  rn bool false on
-0000cff0: 2065 7272 6f72 202d 2053 6565 2074 6865   error - See the
-0000d000: 2045 7272 6f72 496e 666f 2070 726f 7065   ErrorInfo prope
-0000d010: 7274 7920 666f 7220 6465 7461 696c 7320  rty for details 
-0000d020: 6f66 2074 6865 2065 7272 6f72 0a20 2020  of the error.   
-0000d030: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-0000d040: 6675 6e63 7469 6f6e 2073 656e 6428 290a  function send().
-0000d050: 2020 2020 7b0a 2020 2020 2020 2020 7472      {.        tr
-0000d060: 7920 7b0a 2020 2020 2020 2020 2020 2020  y {.            
-0000d070: 6966 2028 2124 7468 6973 2d3e 7072 6553  if (!$this->preS
-0000d080: 656e 6428 2929 207b 0a20 2020 2020 2020  end()) {.       
-0000d090: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000d0a0: 6661 6c73 653b 0a20 2020 2020 2020 2020  false;.         
-0000d0b0: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-0000d0c0: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
-0000d0d0: 706f 7374 5365 6e64 2829 3b0a 2020 2020  postSend();.    
-0000d0e0: 2020 2020 7d20 6361 7463 6820 2845 7863      } catch (Exc
-0000d0f0: 6570 7469 6f6e 2024 6578 6329 207b 0a20  eption $exc) {. 
-0000d100: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-0000d110: 2d3e 6d61 696c 4865 6164 6572 203d 2027  ->mailHeader = '
-0000d120: 273b 0a20 2020 2020 2020 2020 2020 2024  ';.            $
-0000d130: 7468 6973 2d3e 7365 7445 7272 6f72 2824  this->setError($
-0000d140: 6578 632d 3e67 6574 4d65 7373 6167 6528  exc->getMessage(
-0000d150: 2929 3b0a 2020 2020 2020 2020 2020 2020  ));.            
-0000d160: 6966 2028 2474 6869 732d 3e65 7863 6570  if ($this->excep
-0000d170: 7469 6f6e 7329 207b 0a20 2020 2020 2020  tions) {.       
-0000d180: 2020 2020 2020 2020 2074 6872 6f77 2024           throw $
-0000d190: 6578 633b 0a20 2020 2020 2020 2020 2020  exc;.           
-0000d1a0: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-0000d1b0: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
-0000d1c0: 2020 2020 2020 7d0a 2020 2020 7d0a 0a20        }.    }.. 
-0000d1d0: 2020 202f 2a2a 0a20 2020 2020 2a20 5072     /**.     * Pr
-0000d1e0: 6570 6172 6520 6120 6d65 7373 6167 6520  epare a message 
-0000d1f0: 666f 7220 7365 6e64 696e 672e 0a20 2020  for sending..   
-0000d200: 2020 2a0a 2020 2020 202a 2040 7468 726f    *.     * @thro
-0000d210: 7773 2045 7863 6570 7469 6f6e 0a20 2020  ws Exception.   
-0000d220: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
-0000d230: 726e 2062 6f6f 6c0a 2020 2020 202a 2f0a  rn bool.     */.
-0000d240: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
-0000d250: 696f 6e20 7072 6553 656e 6428 290a 2020  ion preSend().  
-0000d260: 2020 7b0a 2020 2020 2020 2020 6966 2028    {.        if (
-0000d270: 0a20 2020 2020 2020 2020 2020 2027 736d  .            'sm
-0000d280: 7470 2720 3d3d 3d20 2474 6869 732d 3e4d  tp' === $this->M
-0000d290: 6169 6c65 720a 2020 2020 2020 2020 2020  ailer.          
-0000d2a0: 2020 7c7c 2028 276d 6169 6c27 203d 3d3d    || ('mail' ===
-0000d2b0: 2024 7468 6973 2d3e 4d61 696c 6572 2026   $this->Mailer &
-0000d2c0: 2620 285c 5048 505f 5645 5253 494f 4e5f  & (\PHP_VERSION_
-0000d2d0: 4944 203e 3d20 3830 3030 3020 7c7c 2073  ID >= 80000 || s
-0000d2e0: 7472 6970 6f73 2850 4850 5f4f 532c 2027  tripos(PHP_OS, '
-0000d2f0: 5749 4e27 2920 3d3d 3d20 3029 290a 2020  WIN') === 0)).  
-0000d300: 2020 2020 2020 2920 7b0a 2020 2020 2020        ) {.      
-0000d310: 2020 2020 2020 2f2f 534d 5450 206d 616e        //SMTP man
-0000d320: 6461 7465 7320 5246 432d 636f 6d70 6c69  dates RFC-compli
-0000d330: 616e 7420 6c69 6e65 2065 6e64 696e 6773  ant line endings
-0000d340: 0a20 2020 2020 2020 2020 2020 202f 2f61  .            //a
-0000d350: 6e64 2069 7427 7320 616c 736f 2075 7365  nd it's also use
-0000d360: 6420 7769 7468 206d 6169 6c28 2920 6f6e  d with mail() on
-0000d370: 2057 696e 646f 7773 0a20 2020 2020 2020   Windows.       
-0000d380: 2020 2020 2073 7461 7469 633a 3a73 6574       static::set
-0000d390: 4c45 2873 656c 663a 3a43 524c 4629 3b0a  LE(self::CRLF);.
-0000d3a0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
-0000d3b0: 0a20 2020 2020 2020 2020 2020 202f 2f4d  .            //M
-0000d3c0: 6169 6e74 6169 6e20 6261 636b 7761 7264  aintain backward
-0000d3d0: 2063 6f6d 7061 7469 6269 6c69 7479 2077   compatibility w
-0000d3e0: 6974 6820 6c65 6761 6379 204c 696e 7578  ith legacy Linux
-0000d3f0: 2063 6f6d 6d61 6e64 206c 696e 6520 6d61   command line ma
-0000d400: 696c 6572 730a 2020 2020 2020 2020 2020  ilers.          
-0000d410: 2020 7374 6174 6963 3a3a 7365 744c 4528    static::setLE(
-0000d420: 5048 505f 454f 4c29 3b0a 2020 2020 2020  PHP_EOL);.      
-0000d430: 2020 7d0a 2020 2020 2020 2020 2f2f 4368    }.        //Ch
-0000d440: 6563 6b20 666f 7220 6275 6767 7920 5048  eck for buggy PH
-0000d450: 5020 7665 7273 696f 6e73 2074 6861 7420  P versions that 
-0000d460: 6164 6420 6120 6865 6164 6572 2077 6974  add a header wit
-0000d470: 6820 616e 2069 6e63 6f72 7265 6374 206c  h an incorrect l
-0000d480: 696e 6520 6272 6561 6b0a 2020 2020 2020  ine break.      
-0000d490: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-0000d4a0: 2020 2027 6d61 696c 2720 3d3d 3d20 2474     'mail' === $t
-0000d4b0: 6869 732d 3e4d 6169 6c65 720a 2020 2020  his->Mailer.    
-0000d4c0: 2020 2020 2020 2020 2626 2028 285c 5048          && ((\PH
-0000d4d0: 505f 5645 5253 494f 4e5f 4944 203e 3d20  P_VERSION_ID >= 
-0000d4e0: 3730 3030 3020 2626 205c 5048 505f 5645  70000 && \PHP_VE
-0000d4f0: 5253 494f 4e5f 4944 203c 2037 3030 3137  RSION_ID < 70017
-0000d500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d510: 2020 7c7c 2028 5c50 4850 5f56 4552 5349    || (\PHP_VERSI
-0000d520: 4f4e 5f49 4420 3e3d 2037 3031 3030 2026  ON_ID >= 70100 &
-0000d530: 2620 5c50 4850 5f56 4552 5349 4f4e 5f49  & \PHP_VERSION_I
-0000d540: 4420 3c20 3730 3130 3329 290a 2020 2020  D < 70103)).    
-0000d550: 2020 2020 2020 2020 2626 2069 6e69 5f67          && ini_g
-0000d560: 6574 2827 6d61 696c 2e61 6464 5f78 5f68  et('mail.add_x_h
-0000d570: 6561 6465 7227 2920 3d3d 3d20 2731 270a  eader') === '1'.
-0000d580: 2020 2020 2020 2020 2020 2020 2626 2073              && s
-0000d590: 7472 6970 6f73 2850 4850 5f4f 532c 2027  tripos(PHP_OS, '
-0000d5a0: 5749 4e27 2920 3d3d 3d20 300a 2020 2020  WIN') === 0.    
-0000d5b0: 2020 2020 2920 7b0a 2020 2020 2020 2020      ) {.        
-0000d5c0: 2020 2020 7472 6967 6765 725f 6572 726f      trigger_erro
-0000d5d0: 7228 2474 6869 732d 3e6c 616e 6728 2762  r($this->lang('b
-0000d5e0: 7567 6779 5f70 6870 2729 2c20 455f 5553  uggy_php'), E_US
-0000d5f0: 4552 5f57 4152 4e49 4e47 293b 0a20 2020  ER_WARNING);.   
-0000d600: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-0000d610: 7472 7920 7b0a 2020 2020 2020 2020 2020  try {.          
-0000d620: 2020 2474 6869 732d 3e65 7272 6f72 5f63    $this->error_c
-0000d630: 6f75 6e74 203d 2030 3b20 2f2f 5265 7365  ount = 0; //Rese
-0000d640: 7420 6572 726f 7273 0a20 2020 2020 2020  t errors.       
-0000d650: 2020 2020 2024 7468 6973 2d3e 6d61 696c       $this->mail
-0000d660: 4865 6164 6572 203d 2027 273b 0a0a 2020  Header = '';..  
-0000d670: 2020 2020 2020 2020 2020 2f2f 4465 7175            //Dequ
-0000d680: 6575 6520 7265 6369 7069 656e 7420 616e  eue recipient an
-0000d690: 6420 5265 706c 792d 546f 2061 6464 7265  d Reply-To addre
-0000d6a0: 7373 6573 2077 6974 6820 4944 4e0a 2020  sses with IDN.  
-0000d6b0: 2020 2020 2020 2020 2020 666f 7265 6163            foreac
-0000d6c0: 6820 2861 7272 6179 5f6d 6572 6765 2824  h (array_merge($
-0000d6d0: 7468 6973 2d3e 5265 6369 7069 656e 7473  this->Recipients
-0000d6e0: 5175 6575 652c 2024 7468 6973 2d3e 5265  Queue, $this->Re
-0000d6f0: 706c 7954 6f51 7565 7565 2920 6173 2024  plyToQueue) as $
-0000d700: 7061 7261 6d73 2920 7b0a 2020 2020 2020  params) {.      
-0000d710: 2020 2020 2020 2020 2020 2470 6172 616d            $param
-0000d720: 735b 315d 203d 2024 7468 6973 2d3e 7075  s[1] = $this->pu
-0000d730: 6e79 656e 636f 6465 4164 6472 6573 7328  nyencodeAddress(
-0000d740: 2470 6172 616d 735b 315d 293b 0a20 2020  $params[1]);.   
-0000d750: 2020 2020 2020 2020 2020 2020 2063 616c               cal
-0000d760: 6c5f 7573 6572 5f66 756e 635f 6172 7261  l_user_func_arra
-0000d770: 7928 5b24 7468 6973 2c20 2761 6464 416e  y([$this, 'addAn
-0000d780: 4164 6472 6573 7327 5d2c 2024 7061 7261  Address'], $para
-0000d790: 6d73 293b 0a20 2020 2020 2020 2020 2020  ms);.           
-0000d7a0: 207d 0a20 2020 2020 2020 2020 2020 2069   }.            i
-0000d7b0: 6620 2863 6f75 6e74 2824 7468 6973 2d3e  f (count($this->
-0000d7c0: 746f 2920 2b20 636f 756e 7428 2474 6869  to) + count($thi
-0000d7d0: 732d 3e63 6329 202b 2063 6f75 6e74 2824  s->cc) + count($
-0000d7e0: 7468 6973 2d3e 6263 6329 203c 2031 2920  this->bcc) < 1) 
-0000d7f0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0000d800: 2020 7468 726f 7720 6e65 7720 4578 6365    throw new Exce
-0000d810: 7074 696f 6e28 2474 6869 732d 3e6c 616e  ption($this->lan
-0000d820: 6728 2770 726f 7669 6465 5f61 6464 7265  g('provide_addre
-0000d830: 7373 2729 2c20 7365 6c66 3a3a 5354 4f50  ss'), self::STOP
-0000d840: 5f43 5249 5449 4341 4c29 3b0a 2020 2020  _CRITICAL);.    
-0000d850: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0000d860: 2020 2020 2020 202f 2f56 616c 6964 6174         //Validat
-0000d870: 6520 4672 6f6d 2c20 5365 6e64 6572 2c20  e From, Sender, 
-0000d880: 616e 6420 436f 6e66 6972 6d52 6561 6469  and ConfirmReadi
-0000d890: 6e67 546f 2061 6464 7265 7373 6573 0a20  ngTo addresses. 
-0000d8a0: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
-0000d8b0: 6368 2028 5b27 4672 6f6d 272c 2027 5365  ch (['From', 'Se
-0000d8c0: 6e64 6572 272c 2027 436f 6e66 6972 6d52  nder', 'ConfirmR
-0000d8d0: 6561 6469 6e67 546f 275d 2061 7320 2461  eadingTo'] as $a
-0000d8e0: 6464 7265 7373 5f6b 696e 6429 207b 0a20  ddress_kind) {. 
-0000d8f0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0000d900: 7468 6973 2d3e 7b24 6164 6472 6573 735f  this->{$address_
-0000d910: 6b69 6e64 7d20 3d20 7472 696d 2824 7468  kind} = trim($th
-0000d920: 6973 2d3e 7b24 6164 6472 6573 735f 6b69  is->{$address_ki
-0000d930: 6e64 7d29 3b0a 2020 2020 2020 2020 2020  nd});.          
-0000d940: 2020 2020 2020 6966 2028 656d 7074 7928        if (empty(
-0000d950: 2474 6869 732d 3e7b 2461 6464 7265 7373  $this->{$address
-0000d960: 5f6b 696e 647d 2929 207b 0a20 2020 2020  _kind})) {.     
-0000d970: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000d980: 6f6e 7469 6e75 653b 0a20 2020 2020 2020  ontinue;.       
-0000d990: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-0000d9a0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-0000d9b0: 2d3e 7b24 6164 6472 6573 735f 6b69 6e64  ->{$address_kind
-0000d9c0: 7d20 3d20 2474 6869 732d 3e70 756e 7965  } = $this->punye
-0000d9d0: 6e63 6f64 6541 6464 7265 7373 2824 7468  ncodeAddress($th
-0000d9e0: 6973 2d3e 7b24 6164 6472 6573 735f 6b69  is->{$address_ki
-0000d9f0: 6e64 7d29 3b0a 2020 2020 2020 2020 2020  nd});.          
-0000da00: 2020 2020 2020 6966 2028 2173 7461 7469        if (!stati
-0000da10: 633a 3a76 616c 6964 6174 6541 6464 7265  c::validateAddre
-0000da20: 7373 2824 7468 6973 2d3e 7b24 6164 6472  ss($this->{$addr
-0000da30: 6573 735f 6b69 6e64 7d29 2920 7b0a 2020  ess_kind})) {.  
-0000da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da50: 2020 2465 7272 6f72 5f6d 6573 7361 6765    $error_message
-0000da60: 203d 2073 7072 696e 7466 280a 2020 2020   = sprintf(.    
-0000da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da80: 2020 2020 2725 7320 2825 7329 3a20 2573      '%s (%s): %s
-0000da90: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000daa0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-0000dab0: 2d3e 6c61 6e67 2827 696e 7661 6c69 645f  ->lang('invalid_
-0000dac0: 6164 6472 6573 7327 292c 0a20 2020 2020  address'),.     
-0000dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dae0: 2020 2024 6164 6472 6573 735f 6b69 6e64     $address_kind
-0000daf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000db00: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0000db10: 3e7b 2461 6464 7265 7373 5f6b 696e 647d  >{$address_kind}
-0000db20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000db30: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-0000db40: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-0000db50: 732d 3e73 6574 4572 726f 7228 2465 7272  s->setError($err
-0000db60: 6f72 5f6d 6573 7361 6765 293b 0a20 2020  or_message);.   
-0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db80: 2024 7468 6973 2d3e 6564 6562 7567 2824   $this->edebug($
-0000db90: 6572 726f 725f 6d65 7373 6167 6529 3b0a  error_message);.
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbb0: 2020 2020 6966 2028 2474 6869 732d 3e65      if ($this->e
-0000dbc0: 7863 6570 7469 6f6e 7329 207b 0a20 2020  xceptions) {.   
-0000dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbe0: 2020 2020 2074 6872 6f77 206e 6577 2045       throw new E
-0000dbf0: 7863 6570 7469 6f6e 2824 6572 726f 725f  xception($error_
-0000dc00: 6d65 7373 6167 6529 3b0a 2020 2020 2020  message);.      
-0000dc10: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-0000dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc30: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
-0000dc40: 653b 0a20 2020 2020 2020 2020 2020 2020  e;.             
-0000dc50: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0000dc60: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-0000dc70: 2f2f 5365 7420 7768 6574 6865 7220 7468  //Set whether th
-0000dc80: 6520 6d65 7373 6167 6520 6973 206d 756c  e message is mul
-0000dc90: 7469 7061 7274 2f61 6c74 6572 6e61 7469  tipart/alternati
-0000dca0: 7665 0a20 2020 2020 2020 2020 2020 2069  ve.            i
-0000dcb0: 6620 2824 7468 6973 2d3e 616c 7465 726e  f ($this->altern
-0000dcc0: 6174 6976 6545 7869 7374 7328 2929 207b  ativeExists()) {
-0000dcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dce0: 2024 7468 6973 2d3e 436f 6e74 656e 7454   $this->ContentT
-0000dcf0: 7970 6520 3d20 7374 6174 6963 3a3a 434f  ype = static::CO
-0000dd00: 4e54 454e 545f 5459 5045 5f4d 554c 5449  NTENT_TYPE_MULTI
-0000dd10: 5041 5254 5f41 4c54 4552 4e41 5449 5645  PART_ALTERNATIVE
-0000dd20: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
-0000dd30: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
-0000dd40: 6973 2d3e 7365 744d 6573 7361 6765 5479  is->setMessageTy
-0000dd50: 7065 2829 3b0a 2020 2020 2020 2020 2020  pe();.          
-0000dd60: 2020 2f2f 5265 6675 7365 2074 6f20 7365    //Refuse to se
-0000dd70: 6e64 2061 6e20 656d 7074 7920 6d65 7373  nd an empty mess
-0000dd80: 6167 6520 756e 6c65 7373 2077 6520 6172  age unless we ar
-0000dd90: 6520 7370 6563 6966 6963 616c 6c79 2061  e specifically a
-0000dda0: 6c6c 6f77 696e 6720 6974 0a20 2020 2020  llowing it.     
-0000ddb0: 2020 2020 2020 2069 6620 2821 2474 6869         if (!$thi
-0000ddc0: 732d 3e41 6c6c 6f77 456d 7074 7920 2626  s->AllowEmpty &&
-0000ddd0: 2065 6d70 7479 2824 7468 6973 2d3e 426f   empty($this->Bo
-0000dde0: 6479 2929 207b 0a20 2020 2020 2020 2020  dy)) {.         
-0000ddf0: 2020 2020 2020 2074 6872 6f77 206e 6577         throw new
-0000de00: 2045 7863 6570 7469 6f6e 2824 7468 6973   Exception($this
-0000de10: 2d3e 6c61 6e67 2827 656d 7074 795f 6d65  ->lang('empty_me
-0000de20: 7373 6167 6527 292c 2073 656c 663a 3a53  ssage'), self::S
-0000de30: 544f 505f 4352 4954 4943 414c 293b 0a20  TOP_CRITICAL);. 
-0000de40: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
-0000de50: 2020 2020 2020 2020 2020 2f2f 5472 696d            //Trim
-0000de60: 2073 7562 6a65 6374 2063 6f6e 7369 7374   subject consist
-0000de70: 656e 746c 790a 2020 2020 2020 2020 2020  ently.          
-0000de80: 2020 2474 6869 732d 3e53 7562 6a65 6374    $this->Subject
-0000de90: 203d 2074 7269 6d28 2474 6869 732d 3e53   = trim($this->S
-0000dea0: 7562 6a65 6374 293b 0a20 2020 2020 2020  ubject);.       
-0000deb0: 2020 2020 202f 2f43 7265 6174 6520 626f       //Create bo
-0000dec0: 6479 2062 6566 6f72 6520 6865 6164 6572  dy before header
-0000ded0: 7320 696e 2063 6173 6520 626f 6479 206d  s in case body m
-0000dee0: 616b 6573 2063 6861 6e67 6573 2074 6f20  akes changes to 
-0000def0: 6865 6164 6572 7320 2865 2e67 2e20 616c  headers (e.g. al
-0000df00: 7465 7269 6e67 2074 7261 6e73 6665 7220  tering transfer 
-0000df10: 656e 636f 6469 6e67 290a 2020 2020 2020  encoding).      
-0000df20: 2020 2020 2020 2474 6869 732d 3e4d 494d        $this->MIM
-0000df30: 4548 6561 6465 7220 3d20 2727 3b0a 2020  EHeader = '';.  
-0000df40: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0000df50: 3e4d 494d 4542 6f64 7920 3d20 2474 6869  >MIMEBody = $thi
-0000df60: 732d 3e63 7265 6174 6542 6f64 7928 293b  s->createBody();
-0000df70: 0a20 2020 2020 2020 2020 2020 202f 2f63  .            //c
-0000df80: 7265 6174 6542 6f64 7920 6d61 7920 6861  reateBody may ha
-0000df90: 7665 2061 6464 6564 2073 6f6d 6520 6865  ve added some he
-0000dfa0: 6164 6572 732c 2073 6f20 7265 7461 696e  aders, so retain
-0000dfb0: 2074 6865 6d0a 2020 2020 2020 2020 2020   them.          
-0000dfc0: 2020 2474 656d 7068 6561 6465 7273 203d    $tempheaders =
-0000dfd0: 2024 7468 6973 2d3e 4d49 4d45 4865 6164   $this->MIMEHead
-0000dfe0: 6572 3b0a 2020 2020 2020 2020 2020 2020  er;.            
-0000dff0: 2474 6869 732d 3e4d 494d 4548 6561 6465  $this->MIMEHeade
-0000e000: 7220 3d20 2474 6869 732d 3e63 7265 6174  r = $this->creat
-0000e010: 6548 6561 6465 7228 293b 0a20 2020 2020  eHeader();.     
-0000e020: 2020 2020 2020 2024 7468 6973 2d3e 4d49         $this->MI
-0000e030: 4d45 4865 6164 6572 202e 3d20 2474 656d  MEHeader .= $tem
-0000e040: 7068 6561 6465 7273 3b0a 0a20 2020 2020  pheaders;..     
-0000e050: 2020 2020 2020 202f 2f54 6f20 6361 7074         //To capt
-0000e060: 7572 6520 7468 6520 636f 6d70 6c65 7465  ure the complete
-0000e070: 206d 6573 7361 6765 2077 6865 6e20 7573   message when us
-0000e080: 696e 6720 6d61 696c 2829 2c20 6372 6561  ing mail(), crea
-0000e090: 7465 0a20 2020 2020 2020 2020 2020 202f  te.            /
-0000e0a0: 2f61 6e20 6578 7472 6120 6865 6164 6572  /an extra header
-0000e0b0: 206c 6973 7420 7768 6963 6820 6372 6561   list which crea
-0000e0c0: 7465 4865 6164 6572 2829 2064 6f65 736e  teHeader() doesn
-0000e0d0: 2774 2066 6f6c 6420 696e 0a20 2020 2020  't fold in.     
-0000e0e0: 2020 2020 2020 2069 6620 2827 6d61 696c         if ('mail
-0000e0f0: 2720 3d3d 3d20 2474 6869 732d 3e4d 6169  ' === $this->Mai
-0000e100: 6c65 7229 207b 0a20 2020 2020 2020 2020  ler) {.         
-0000e110: 2020 2020 2020 2069 6620 2863 6f75 6e74         if (count
-0000e120: 2824 7468 6973 2d3e 746f 2920 3e20 3029  ($this->to) > 0)
-0000e130: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0000e140: 2020 2020 2020 2024 7468 6973 2d3e 6d61         $this->ma
-0000e150: 696c 4865 6164 6572 202e 3d20 2474 6869  ilHeader .= $thi
-0000e160: 732d 3e61 6464 7241 7070 656e 6428 2754  s->addrAppend('T
-0000e170: 6f27 2c20 2474 6869 732d 3e74 6f29 3b0a  o', $this->to);.
-0000e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e190: 7d20 656c 7365 207b 0a20 2020 2020 2020  } else {.       
-0000e1a0: 2020 2020 2020 2020 2020 2020 2024 7468               $th
-0000e1b0: 6973 2d3e 6d61 696c 4865 6164 6572 202e  is->mailHeader .
-0000e1c0: 3d20 2474 6869 732d 3e68 6561 6465 724c  = $this->headerL
-0000e1d0: 696e 6528 2754 6f27 2c20 2775 6e64 6973  ine('To', 'undis
-0000e1e0: 636c 6f73 6564 2d72 6563 6970 6965 6e74  closed-recipient
-0000e1f0: 733a 3b27 293b 0a20 2020 2020 2020 2020  s:;');.         
-0000e200: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0000e210: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0000e220: 6d61 696c 4865 6164 6572 202e 3d20 2474  mailHeader .= $t
-0000e230: 6869 732d 3e68 6561 6465 724c 696e 6528  his->headerLine(
-0000e240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e250: 2020 2020 2027 5375 626a 6563 7427 2c0a       'Subject',.
-0000e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e270: 2020 2020 2474 6869 732d 3e65 6e63 6f64      $this->encod
-0000e280: 6548 6561 6465 7228 2474 6869 732d 3e73  eHeader($this->s
-0000e290: 6563 7572 6548 6561 6465 7228 2474 6869  ecureHeader($thi
-0000e2a0: 732d 3e53 7562 6a65 6374 2929 0a20 2020  s->Subject)).   
-0000e2b0: 2020 2020 2020 2020 2020 2020 2029 3b0a               );.
-0000e2c0: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-0000e2d0: 2020 2020 2020 2020 2020 202f 2f53 6967             //Sig
-0000e2e0: 6e20 7769 7468 2044 4b49 4d20 6966 2065  n with DKIM if e
-0000e2f0: 6e61 626c 6564 0a20 2020 2020 2020 2020  nabled.         
-0000e300: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-0000e310: 2020 2020 2020 2020 2165 6d70 7479 2824          !empty($
-0000e320: 7468 6973 2d3e 444b 494d 5f64 6f6d 6169  this->DKIM_domai
-0000e330: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-0000e340: 2020 2026 2620 2165 6d70 7479 2824 7468     && !empty($th
-0000e350: 6973 2d3e 444b 494d 5f73 656c 6563 746f  is->DKIM_selecto
-0000e360: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-0000e370: 2020 2026 2620 2821 656d 7074 7928 2474     && (!empty($t
-0000e380: 6869 732d 3e44 4b49 4d5f 7072 6976 6174  his->DKIM_privat
-0000e390: 655f 7374 7269 6e67 290a 2020 2020 2020  e_string).      
-0000e3a0: 2020 2020 2020 2020 2020 2020 2020 7c7c                ||
-0000e3b0: 2028 2165 6d70 7479 2824 7468 6973 2d3e   (!empty($this->
-0000e3c0: 444b 494d 5f70 7269 7661 7465 290a 2020  DKIM_private).  
-0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3e0: 2020 2020 2020 2626 2073 7461 7469 633a        && static:
-0000e3f0: 3a69 7350 6572 6d69 7474 6564 5061 7468  :isPermittedPath
-0000e400: 2824 7468 6973 2d3e 444b 494d 5f70 7269  ($this->DKIM_pri
-0000e410: 7661 7465 290a 2020 2020 2020 2020 2020  vate).          
-0000e420: 2020 2020 2020 2020 2020 2020 2020 2626                &&
-0000e430: 2066 696c 655f 6578 6973 7473 2824 7468   file_exists($th
-0000e440: 6973 2d3e 444b 494d 5f70 7269 7661 7465  is->DKIM_private
-0000e450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e460: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e470: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000e480: 2020 2020 2020 2920 7b0a 2020 2020 2020        ) {.      
-0000e490: 2020 2020 2020 2020 2020 2468 6561 6465            $heade
-0000e4a0: 725f 646b 696d 203d 2024 7468 6973 2d3e  r_dkim = $this->
-0000e4b0: 444b 494d 5f41 6464 280a 2020 2020 2020  DKIM_Add(.      
-0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-0000e4d0: 6869 732d 3e4d 494d 4548 6561 6465 7220  his->MIMEHeader 
-0000e4e0: 2e20 2474 6869 732d 3e6d 6169 6c48 6561  . $this->mailHea
-0000e4f0: 6465 722c 0a20 2020 2020 2020 2020 2020  der,.           
-0000e500: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0000e510: 656e 636f 6465 4865 6164 6572 2824 7468  encodeHeader($th
-0000e520: 6973 2d3e 7365 6375 7265 4865 6164 6572  is->secureHeader
-0000e530: 2824 7468 6973 2d3e 5375 626a 6563 7429  ($this->Subject)
-0000e540: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000e550: 2020 2020 2020 2024 7468 6973 2d3e 4d49         $this->MI
-0000e560: 4d45 426f 6479 0a20 2020 2020 2020 2020  MEBody.         
-0000e570: 2020 2020 2020 2029 3b0a 2020 2020 2020         );.      
-0000e580: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0000e590: 3e4d 494d 4548 6561 6465 7220 3d20 7374  >MIMEHeader = st
-0000e5a0: 6174 6963 3a3a 7374 7269 7054 7261 696c  atic::stripTrail
-0000e5b0: 696e 6757 5350 2824 7468 6973 2d3e 4d49  ingWSP($this->MI
-0000e5c0: 4d45 4865 6164 6572 2920 2e20 7374 6174  MEHeader) . stat
-0000e5d0: 6963 3a3a 244c 4520 2e0a 2020 2020 2020  ic::$LE ..      
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0000e5f0: 6174 6963 3a3a 6e6f 726d 616c 697a 6542  atic::normalizeB
-0000e600: 7265 616b 7328 2468 6561 6465 725f 646b  reaks($header_dk
-0000e610: 696d 2920 2e20 7374 6174 6963 3a3a 244c  im) . static::$L
-0000e620: 453b 0a20 2020 2020 2020 2020 2020 207d  E;.            }
-0000e630: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000e640: 7475 726e 2074 7275 653b 0a20 2020 2020  turn true;.     
-0000e650: 2020 207d 2063 6174 6368 2028 4578 6365     } catch (Exce
-0000e660: 7074 696f 6e20 2465 7863 2920 7b0a 2020  ption $exc) {.  
-0000e670: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0000e680: 3e73 6574 4572 726f 7228 2465 7863 2d3e  >setError($exc->
-0000e690: 6765 744d 6573 7361 6765 2829 293b 0a20  getMessage());. 
-0000e6a0: 2020 2020 2020 2020 2020 2069 6620 2824             if ($
-0000e6b0: 7468 6973 2d3e 6578 6365 7074 696f 6e73  this->exceptions
-0000e6c0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0000e6d0: 2020 2020 7468 726f 7720 2465 7863 3b0a      throw $exc;.
-0000e6e0: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-0000e6f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e700: 6e20 6661 6c73 653b 0a20 2020 2020 2020  n false;.       
-0000e710: 207d 0a20 2020 207d 0a0a 2020 2020 2f2a   }.    }..    /*
-0000e720: 2a0a 2020 2020 202a 2041 6374 7561 6c6c  *.     * Actuall
-0000e730: 7920 7365 6e64 2061 206d 6573 7361 6765  y send a message
-0000e740: 2076 6961 2074 6865 2073 656c 6563 7465   via the selecte
-0000e750: 6420 6d65 6368 616e 6973 6d2e 0a20 2020  d mechanism..   
-0000e760: 2020 2a0a 2020 2020 202a 2040 7468 726f    *.     * @thro
-0000e770: 7773 2045 7863 6570 7469 6f6e 0a20 2020  ws Exception.   
-0000e780: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
-0000e790: 726e 2062 6f6f 6c0a 2020 2020 202a 2f0a  rn bool.     */.
-0000e7a0: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
-0000e7b0: 696f 6e20 706f 7374 5365 6e64 2829 0a20  ion postSend(). 
-0000e7c0: 2020 207b 0a20 2020 2020 2020 2074 7279     {.        try
-0000e7d0: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
-0000e7e0: 2f43 686f 6f73 6520 7468 6520 6d61 696c  /Choose the mail
-0000e7f0: 6572 2061 6e64 2073 656e 6420 7468 726f  er and send thro
-0000e800: 7567 6820 6974 0a20 2020 2020 2020 2020  ugh it.         
-0000e810: 2020 2073 7769 7463 6820 2824 7468 6973     switch ($this
-0000e820: 2d3e 4d61 696c 6572 2920 7b0a 2020 2020  ->Mailer) {.    
-0000e830: 2020 2020 2020 2020 2020 2020 6361 7365              case
-0000e840: 2027 7365 6e64 6d61 696c 273a 0a20 2020   'sendmail':.   
-0000e850: 2020 2020 2020 2020 2020 2020 2063 6173               cas
-0000e860: 6520 2771 6d61 696c 273a 0a20 2020 2020  e 'qmail':.     
-0000e870: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e880: 6574 7572 6e20 2474 6869 732d 3e73 656e  eturn $this->sen
-0000e890: 646d 6169 6c53 656e 6428 2474 6869 732d  dmailSend($this-
-0000e8a0: 3e4d 494d 4548 6561 6465 722c 2024 7468  >MIMEHeader, $th
-0000e8b0: 6973 2d3e 4d49 4d45 426f 6479 293b 0a20  is->MIMEBody);. 
-0000e8c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000e8d0: 6173 6520 2773 6d74 7027 3a0a 2020 2020  ase 'smtp':.    
-0000e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8f0: 7265 7475 726e 2024 7468 6973 2d3e 736d  return $this->sm
-0000e900: 7470 5365 6e64 2824 7468 6973 2d3e 4d49  tpSend($this->MI
-0000e910: 4d45 4865 6164 6572 2c20 2474 6869 732d  MEHeader, $this-
-0000e920: 3e4d 494d 4542 6f64 7929 3b0a 2020 2020  >MIMEBody);.    
-0000e930: 2020 2020 2020 2020 2020 2020 6361 7365              case
-0000e940: 2027 6d61 696c 273a 0a20 2020 2020 2020   'mail':.       
-0000e950: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000e960: 7572 6e20 2474 6869 732d 3e6d 6169 6c53  urn $this->mailS
-0000e970: 656e 6428 2474 6869 732d 3e4d 494d 4548  end($this->MIMEH
-0000e980: 6561 6465 722c 2024 7468 6973 2d3e 4d49  eader, $this->MI
-0000e990: 4d45 426f 6479 293b 0a20 2020 2020 2020  MEBody);.       
-0000e9a0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0000e9b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e9c0: 2020 2020 2020 2473 656e 644d 6574 686f        $sendMetho
-0000e9d0: 6420 3d20 2474 6869 732d 3e4d 6169 6c65  d = $this->Maile
-0000e9e0: 7220 2e20 2753 656e 6427 3b0a 2020 2020  r . 'Send';.    
-0000e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea00: 6966 2028 6d65 7468 6f64 5f65 7869 7374  if (method_exist
-0000ea10: 7328 2474 6869 732c 2024 7365 6e64 4d65  s($this, $sendMe
-0000ea20: 7468 6f64 2929 207b 0a20 2020 2020 2020  thod)) {.       
-0000ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea40: 2072 6574 7572 6e20 2474 6869 732d 3e7b   return $this->{
-0000ea50: 2473 656e 644d 6574 686f 647d 2824 7468  $sendMethod}($th
-0000ea60: 6973 2d3e 4d49 4d45 4865 6164 6572 2c20  is->MIMEHeader, 
-0000ea70: 2474 6869 732d 3e4d 494d 4542 6f64 7929  $this->MIMEBody)
-0000ea80: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0000ea90: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0000eaa0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000eab0: 7572 6e20 2474 6869 732d 3e6d 6169 6c53  urn $this->mailS
-0000eac0: 656e 6428 2474 6869 732d 3e4d 494d 4548  end($this->MIMEH
-0000ead0: 6561 6465 722c 2024 7468 6973 2d3e 4d49  eader, $this->MI
-0000eae0: 4d45 426f 6479 293b 0a20 2020 2020 2020  MEBody);.       
-0000eaf0: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
-0000eb00: 2063 6174 6368 2028 4578 6365 7074 696f   catch (Exceptio
-0000eb10: 6e20 2465 7863 2920 7b0a 2020 2020 2020  n $exc) {.      
-0000eb20: 2020 2020 2020 6966 2028 2474 6869 732d        if ($this-
-0000eb30: 3e4d 6169 6c65 7220 3d3d 3d20 2773 6d74  >Mailer === 'smt
-0000eb40: 7027 2026 2620 2474 6869 732d 3e53 4d54  p' && $this->SMT
-0000eb50: 504b 6565 7041 6c69 7665 203d 3d20 7472  PKeepAlive == tr
-0000eb60: 7565 2920 7b0a 2020 2020 2020 2020 2020  ue) {.          
-0000eb70: 2020 2020 2020 2474 6869 732d 3e73 6d74        $this->smt
-0000eb80: 702d 3e72 6573 6574 2829 3b0a 2020 2020  p->reset();.    
-0000eb90: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000eba0: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
-0000ebb0: 4572 726f 7228 2465 7863 2d3e 6765 744d  Error($exc->getM
-0000ebc0: 6573 7361 6765 2829 293b 0a20 2020 2020  essage());.     
-0000ebd0: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
-0000ebe0: 6562 7567 2824 6578 632d 3e67 6574 4d65  ebug($exc->getMe
-0000ebf0: 7373 6167 6528 2929 3b0a 2020 2020 2020  ssage());.      
-0000ec00: 2020 2020 2020 6966 2028 2474 6869 732d        if ($this-
-0000ec10: 3e65 7863 6570 7469 6f6e 7329 207b 0a20  >exceptions) {. 
-0000ec20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000ec30: 6872 6f77 2024 6578 633b 0a20 2020 2020  hrow $exc;.     
-0000ec40: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0000ec50: 207d 0a0a 2020 2020 2020 2020 7265 7475   }..        retu
-0000ec60: 726e 2066 616c 7365 3b0a 2020 2020 7d0a  rn false;.    }.
-0000ec70: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0000ec80: 5365 6e64 206d 6169 6c20 7573 696e 6720  Send mail using 
-0000ec90: 7468 6520 2453 656e 646d 6169 6c20 7072  the $Sendmail pr
-0000eca0: 6f67 7261 6d2e 0a20 2020 2020 2a0a 2020  ogram..     *.  
-0000ecb0: 2020 202a 2040 7365 6520 5048 504d 6169     * @see PHPMai
-0000ecc0: 6c65 723a 3a24 5365 6e64 6d61 696c 0a20  ler::$Sendmail. 
-0000ecd0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-0000ece0: 7261 6d20 7374 7269 6e67 2024 6865 6164  ram string $head
-0000ecf0: 6572 2054 6865 206d 6573 7361 6765 2068  er The message h
-0000ed00: 6561 6465 7273 0a20 2020 2020 2a20 4070  eaders.     * @p
-0000ed10: 6172 616d 2073 7472 696e 6720 2462 6f64  aram string $bod
-0000ed20: 7920 2020 5468 6520 6d65 7373 6167 6520  y   The message 
-0000ed30: 626f 6479 0a20 2020 2020 2a0a 2020 2020  body.     *.    
-0000ed40: 202a 2040 7468 726f 7773 2045 7863 6570   * @throws Excep
-0000ed50: 7469 6f6e 0a20 2020 2020 2a0a 2020 2020  tion.     *.    
-0000ed60: 202a 2040 7265 7475 726e 2062 6f6f 6c0a   * @return bool.
-0000ed70: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
-0000ed80: 6563 7465 6420 6675 6e63 7469 6f6e 2073  ected function s
-0000ed90: 656e 646d 6169 6c53 656e 6428 2468 6561  endmailSend($hea
-0000eda0: 6465 722c 2024 626f 6479 290a 2020 2020  der, $body).    
-0000edb0: 7b0a 2020 2020 2020 2020 6966 2028 2474  {.        if ($t
-0000edc0: 6869 732d 3e4d 6169 6c65 7220 3d3d 3d20  his->Mailer === 
-0000edd0: 2771 6d61 696c 2729 207b 0a20 2020 2020  'qmail') {.     
-0000ede0: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
-0000edf0: 6562 7567 2827 5365 6e64 696e 6720 7769  ebug('Sending wi
-0000ee00: 7468 2071 6d61 696c 2729 3b0a 2020 2020  th qmail');.    
-0000ee10: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
-0000ee20: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0000ee30: 6564 6562 7567 2827 5365 6e64 696e 6720  edebug('Sending 
-0000ee40: 7769 7468 2073 656e 646d 6169 6c27 293b  with sendmail');
-0000ee50: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-0000ee60: 2020 2024 6865 6164 6572 203d 2073 7461     $header = sta
-0000ee70: 7469 633a 3a73 7472 6970 5472 6169 6c69  tic::stripTraili
-0000ee80: 6e67 5753 5028 2468 6561 6465 7229 202e  ngWSP($header) .
-0000ee90: 2073 7461 7469 633a 3a24 4c45 202e 2073   static::$LE . s
-0000eea0: 7461 7469 633a 3a24 4c45 3b0a 2020 2020  tatic::$LE;.    
-0000eeb0: 2020 2020 2f2f 5468 6973 2073 6574 7320      //This sets 
-0000eec0: 7468 6520 534d 5450 2065 6e76 656c 6f70  the SMTP envelop
-0000eed0: 6520 7365 6e64 6572 2077 6869 6368 2067  e sender which g
-0000eee0: 6574 7320 7475 726e 6564 2069 6e74 6f20  ets turned into 
-0000eef0: 6120 7265 7475 726e 2d70 6174 6820 6865  a return-path he
-0000ef00: 6164 6572 2062 7920 7468 6520 7265 6365  ader by the rece
-0000ef10: 6976 6572 0a20 2020 2020 2020 202f 2f41  iver.        //A
-0000ef20: 2073 7061 6365 2061 6674 6572 2060 2d66   space after `-f
-0000ef30: 6020 6973 206f 7074 696f 6e61 6c2c 2062  ` is optional, b
-0000ef40: 7574 2074 6865 7265 2069 7320 6120 6c6f  ut there is a lo
-0000ef50: 6e67 2068 6973 746f 7279 206f 6620 6974  ng history of it
-0000ef60: 7320 7072 6573 656e 6365 0a20 2020 2020  s presence.     
-0000ef70: 2020 202f 2f63 6175 7369 6e67 2070 726f     //causing pro
-0000ef80: 626c 656d 732c 2073 6f20 7765 2064 6f6e  blems, so we don
-0000ef90: 2774 2075 7365 206f 6e65 0a20 2020 2020  't use one.     
-0000efa0: 2020 202f 2f45 7869 6d20 646f 6373 3a20     //Exim docs: 
-0000efb0: 6874 7470 3a2f 2f77 7777 2e65 7869 6d2e  http://www.exim.
-0000efc0: 6f72 672f 6578 696d 2d68 746d 6c2d 6375  org/exim-html-cu
-0000efd0: 7272 656e 742f 646f 632f 6874 6d6c 2f73  rrent/doc/html/s
-0000efe0: 7065 635f 6874 6d6c 2f63 682d 7468 655f  pec_html/ch-the_
-0000eff0: 6578 696d 5f63 6f6d 6d61 6e64 5f6c 696e  exim_command_lin
-0000f000: 652e 6874 6d6c 0a20 2020 2020 2020 202f  e.html.        /
-0000f010: 2f53 656e 646d 6169 6c20 646f 6373 3a20  /Sendmail docs: 
-0000f020: 6874 7470 3a2f 2f77 7777 2e73 656e 646d  http://www.sendm
-0000f030: 6169 6c2e 6f72 672f 7e63 612f 656d 6169  ail.org/~ca/emai
-0000f040: 6c2f 6d61 6e2f 7365 6e64 6d61 696c 2e68  l/man/sendmail.h
-0000f050: 746d 6c0a 2020 2020 2020 2020 2f2f 516d  tml.        //Qm
-0000f060: 6169 6c20 646f 6373 3a20 6874 7470 3a2f  ail docs: http:/
-0000f070: 2f77 7777 2e71 6d61 696c 2e6f 7267 2f6d  /www.qmail.org/m
-0000f080: 616e 2f6d 616e 382f 716d 6169 6c2d 696e  an/man8/qmail-in
-0000f090: 6a65 6374 2e68 746d 6c0a 2020 2020 2020  ject.html.      
-0000f0a0: 2020 2f2f 4578 616d 706c 6520 7072 6f62    //Example prob
-0000f0b0: 6c65 6d3a 2068 7474 7073 3a2f 2f77 7777  lem: https://www
-0000f0c0: 2e64 7275 7061 6c2e 6f72 672f 6e6f 6465  .drupal.org/node
-0000f0d0: 2f31 3035 3739 3534 0a0a 2020 2020 2020  /1057954..      
-0000f0e0: 2020 2f2f 5048 5020 352e 3620 776f 726b    //PHP 5.6 work
-0000f0f0: 6172 6f75 6e64 0a20 2020 2020 2020 2024  around.        $
-0000f100: 7365 6e64 6d61 696c 5f66 726f 6d5f 7661  sendmail_from_va
-0000f110: 6c75 6520 3d20 696e 695f 6765 7428 2773  lue = ini_get('s
-0000f120: 656e 646d 6169 6c5f 6672 6f6d 2729 3b0a  endmail_from');.
-0000f130: 2020 2020 2020 2020 6966 2028 656d 7074          if (empt
-0000f140: 7928 2474 6869 732d 3e53 656e 6465 7229  y($this->Sender)
-0000f150: 2026 2620 2165 6d70 7479 2824 7365 6e64   && !empty($send
-0000f160: 6d61 696c 5f66 726f 6d5f 7661 6c75 6529  mail_from_value)
-0000f170: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0000f180: 2f2f 5048 5020 636f 6e66 6967 2068 6173  //PHP config has
-0000f190: 2061 2073 656e 6465 7220 6164 6472 6573   a sender addres
-0000f1a0: 7320 7765 2063 616e 2075 7365 0a20 2020  s we can use.   
-0000f1b0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0000f1c0: 5365 6e64 6572 203d 2069 6e69 5f67 6574  Sender = ini_get
-0000f1d0: 2827 7365 6e64 6d61 696c 5f66 726f 6d27  ('sendmail_from'
-0000f1e0: 293b 0a20 2020 2020 2020 207d 0a20 2020  );.        }.   
-0000f1f0: 2020 2020 202f 2f43 5645 2d32 3031 362d       //CVE-2016-
-0000f200: 3130 3033 332c 2043 5645 2d32 3031 362d  10033, CVE-2016-
-0000f210: 3130 3034 353a 2044 6f6e 2774 2070 6173  10045: Don't pas
-0000f220: 7320 2d66 2069 6620 6368 6172 6163 7465  s -f if characte
-0000f230: 7273 2077 696c 6c20 6265 2065 7363 6170  rs will be escap
-0000f240: 6564 2e0a 2020 2020 2020 2020 6966 2028  ed..        if (
-0000f250: 2165 6d70 7479 2824 7468 6973 2d3e 5365  !empty($this->Se
-0000f260: 6e64 6572 2920 2626 2073 7461 7469 633a  nder) && static:
-0000f270: 3a76 616c 6964 6174 6541 6464 7265 7373  :validateAddress
-0000f280: 2824 7468 6973 2d3e 5365 6e64 6572 2920  ($this->Sender) 
-0000f290: 2626 2073 656c 663a 3a69 7353 6865 6c6c  && self::isShell
-0000f2a0: 5361 6665 2824 7468 6973 2d3e 5365 6e64  Safe($this->Send
-0000f2b0: 6572 2929 207b 0a20 2020 2020 2020 2020  er)) {.         
-0000f2c0: 2020 2069 6620 2824 7468 6973 2d3e 4d61     if ($this->Ma
-0000f2d0: 696c 6572 203d 3d3d 2027 716d 6169 6c27  iler === 'qmail'
-0000f2e0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0000f2f0: 2020 2020 2473 656e 646d 6169 6c46 6d74      $sendmailFmt
-0000f300: 203d 2027 2573 202d 6625 7327 3b0a 2020   = '%s -f%s';.  
-0000f310: 2020 2020 2020 2020 2020 7d20 656c 7365            } else
-0000f320: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0000f330: 2020 2024 7365 6e64 6d61 696c 466d 7420     $sendmailFmt 
-0000f340: 3d20 2725 7320 2d6f 6920 2d66 2573 202d  = '%s -oi -f%s -
-0000f350: 7427 3b0a 2020 2020 2020 2020 2020 2020  t';.            
-0000f360: 7d0a 2020 2020 2020 2020 7d20 656c 7365  }.        } else
-0000f370: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
-0000f380: 2f61 6c6c 6f77 2073 656e 646d 6169 6c20  /allow sendmail 
-0000f390: 746f 2063 686f 6f73 6520 6120 6465 6661  to choose a defa
-0000f3a0: 756c 7420 656e 7665 6c6f 7065 2073 656e  ult envelope sen
-0000f3b0: 6465 722e 2049 7420 6d61 790a 2020 2020  der. It may.    
-0000f3c0: 2020 2020 2020 2020 2f2f 7365 656d 2070          //seem p
-0000f3d0: 7265 6665 7261 626c 6520 746f 2066 6f72  referable to for
-0000f3e0: 6365 2069 7420 746f 2075 7365 2074 6865  ce it to use the
-0000f3f0: 2046 726f 6d20 6865 6164 6572 2061 7320   From header as 
-0000f400: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
-0000f410: 202f 2f53 4d54 502c 2062 7574 2074 6861   //SMTP, but tha
-0000f420: 7420 696e 7472 6f64 7563 6573 206e 6577  t introduces new
-0000f430: 2070 726f 626c 656d 7320 2873 6565 0a20   problems (see. 
-0000f440: 2020 2020 2020 2020 2020 202f 2f3c 6874             //<ht
-0000f450: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-0000f460: 2f50 4850 4d61 696c 6572 2f50 4850 4d61  /PHPMailer/PHPMa
-0000f470: 696c 6572 2f69 7373 7565 732f 3232 3938  iler/issues/2298
-0000f480: 3e29 2c20 616e 640a 2020 2020 2020 2020  >), and.        
-0000f490: 2020 2020 2f2f 6974 2068 6173 2068 6973      //it has his
-0000f4a0: 746f 7269 6361 6c6c 7920 776f 726b 6564  torically worked
-0000f4b0: 2074 6869 7320 7761 792e 0a20 2020 2020   this way..     
-0000f4c0: 2020 2020 2020 2024 7365 6e64 6d61 696c         $sendmail
-0000f4d0: 466d 7420 3d20 2725 7320 2d6f 6920 2d74  Fmt = '%s -oi -t
-0000f4e0: 273b 0a20 2020 2020 2020 207d 0a0a 2020  ';.        }..  
-0000f4f0: 2020 2020 2020 2473 656e 646d 6169 6c20        $sendmail 
-0000f500: 3d20 7370 7269 6e74 6628 2473 656e 646d  = sprintf($sendm
-0000f510: 6169 6c46 6d74 2c20 6573 6361 7065 7368  ailFmt, escapesh
-0000f520: 656c 6c63 6d64 2824 7468 6973 2d3e 5365  ellcmd($this->Se
-0000f530: 6e64 6d61 696c 292c 2024 7468 6973 2d3e  ndmail), $this->
-0000f540: 5365 6e64 6572 293b 0a20 2020 2020 2020  Sender);.       
-0000f550: 2024 7468 6973 2d3e 6564 6562 7567 2827   $this->edebug('
-0000f560: 5365 6e64 6d61 696c 2070 6174 683a 2027  Sendmail path: '
-0000f570: 202e 2024 7468 6973 2d3e 5365 6e64 6d61   . $this->Sendma
-0000f580: 696c 293b 0a20 2020 2020 2020 2024 7468  il);.        $th
-0000f590: 6973 2d3e 6564 6562 7567 2827 5365 6e64  is->edebug('Send
-0000f5a0: 6d61 696c 2063 6f6d 6d61 6e64 3a20 2720  mail command: ' 
-0000f5b0: 2e20 2473 656e 646d 6169 6c29 3b0a 2020  . $sendmail);.  
-0000f5c0: 2020 2020 2020 2474 6869 732d 3e65 6465        $this->ede
-0000f5d0: 6275 6728 2745 6e76 656c 6f70 6520 7365  bug('Envelope se
-0000f5e0: 6e64 6572 3a20 2720 2e20 2474 6869 732d  nder: ' . $this-
-0000f5f0: 3e53 656e 6465 7229 3b0a 2020 2020 2020  >Sender);.      
-0000f600: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
-0000f610: 2248 6561 6465 7273 3a20 7b24 6865 6164  "Headers: {$head
-0000f620: 6572 7d22 293b 0a0a 2020 2020 2020 2020  er}");..        
-0000f630: 6966 2028 2474 6869 732d 3e53 696e 676c  if ($this->Singl
-0000f640: 6554 6f29 207b 0a20 2020 2020 2020 2020  eTo) {.         
-0000f650: 2020 2066 6f72 6561 6368 2028 2474 6869     foreach ($thi
-0000f660: 732d 3e53 696e 676c 6554 6f41 7272 6179  s->SingleToArray
-0000f670: 2061 7320 2474 6f41 6464 7229 207b 0a20   as $toAddr) {. 
-0000f680: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0000f690: 6d61 696c 203d 2040 706f 7065 6e28 2473  mail = @popen($s
-0000f6a0: 656e 646d 6169 6c2c 2027 7727 293b 0a20  endmail, 'w');. 
-0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000f6c0: 6620 2821 246d 6169 6c29 207b 0a20 2020  f (!$mail) {.   
-0000f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6e0: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
-0000f6f0: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
-0000f700: 2827 6578 6563 7574 6527 2920 2e20 2474  ('execute') . $t
-0000f710: 6869 732d 3e53 656e 646d 6169 6c2c 2073  his->Sendmail, s
-0000f720: 656c 663a 3a53 544f 505f 4352 4954 4943  elf::STOP_CRITIC
-0000f730: 414c 293b 0a20 2020 2020 2020 2020 2020  AL);.           
-0000f740: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0000f750: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
-0000f760: 6562 7567 2822 546f 3a20 7b24 746f 4164  ebug("To: {$toAd
-0000f770: 6472 7d22 293b 0a20 2020 2020 2020 2020  dr}");.         
-0000f780: 2020 2020 2020 2066 7772 6974 6528 246d         fwrite($m
-0000f790: 6169 6c2c 2027 546f 3a20 2720 2e20 2474  ail, 'To: ' . $t
-0000f7a0: 6f41 6464 7220 2e20 225c 6e22 293b 0a20  oAddr . "\n");. 
-0000f7b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000f7c0: 7772 6974 6528 246d 6169 6c2c 2024 6865  write($mail, $he
-0000f7d0: 6164 6572 293b 0a20 2020 2020 2020 2020  ader);.         
-0000f7e0: 2020 2020 2020 2066 7772 6974 6528 246d         fwrite($m
-0000f7f0: 6169 6c2c 2024 626f 6479 293b 0a20 2020  ail, $body);.   
-0000f800: 2020 2020 2020 2020 2020 2020 2024 7265               $re
-0000f810: 7375 6c74 203d 2070 636c 6f73 6528 246d  sult = pclose($m
-0000f820: 6169 6c29 3b0a 2020 2020 2020 2020 2020  ail);.          
-0000f830: 2020 2020 2020 2461 6464 7269 6e66 6f20        $addrinfo 
-0000f840: 3d20 7374 6174 6963 3a3a 7061 7273 6541  = static::parseA
-0000f850: 6464 7265 7373 6573 2824 746f 4164 6472  ddresses($toAddr
-0000f860: 2c20 7472 7565 2c20 2474 6869 732d 3e43  , true, $this->C
-0000f870: 6861 7253 6574 293b 0a20 2020 2020 2020  harSet);.       
-0000f880: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0000f890: 646f 4361 6c6c 6261 636b 280a 2020 2020  doCallback(.    
-0000f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8b0: 2824 7265 7375 6c74 203d 3d3d 2030 292c  ($result === 0),
-0000f8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f8d0: 2020 2020 205b 5b24 6164 6472 696e 666f       [[$addrinfo
-0000f8e0: 5b27 6164 6472 6573 7327 5d2c 2024 6164  ['address'], $ad
-0000f8f0: 6472 696e 666f 5b27 6e61 6d65 275d 5d5d  drinfo['name']]]
-0000f900: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f910: 2020 2020 2020 2474 6869 732d 3e63 632c        $this->cc,
-0000f920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f930: 2020 2020 2024 7468 6973 2d3e 6263 632c       $this->bcc,
-0000f940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f950: 2020 2020 2024 7468 6973 2d3e 5375 626a       $this->Subj
-0000f960: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
-0000f970: 2020 2020 2020 2020 2024 626f 6479 2c0a           $body,.
-0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f990: 2020 2020 2474 6869 732d 3e46 726f 6d2c      $this->From,
-0000f9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f9b0: 2020 2020 205b 5d0a 2020 2020 2020 2020       [].        
-0000f9c0: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
-0000f9d0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-0000f9e0: 2d3e 6564 6562 7567 2822 5265 7375 6c74  ->edebug("Result
-0000f9f0: 3a20 2220 2e20 2824 7265 7375 6c74 203d  : " . ($result =
-0000fa00: 3d3d 2030 203f 2027 7472 7565 2720 3a20  == 0 ? 'true' : 
-0000fa10: 2766 616c 7365 2729 293b 0a20 2020 2020  'false'));.     
-0000fa20: 2020 2020 2020 2020 2020 2069 6620 2830             if (0
-0000fa30: 2021 3d3d 2024 7265 7375 6c74 2920 7b0a   !== $result) {.
-0000fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa50: 2020 2020 7468 726f 7720 6e65 7720 4578      throw new Ex
-0000fa60: 6365 7074 696f 6e28 2474 6869 732d 3e6c  ception($this->l
-0000fa70: 616e 6728 2765 7865 6375 7465 2729 202e  ang('execute') .
-0000fa80: 2024 7468 6973 2d3e 5365 6e64 6d61 696c   $this->Sendmail
-0000fa90: 2c20 7365 6c66 3a3a 5354 4f50 5f43 5249  , self::STOP_CRI
-0000faa0: 5449 4341 4c29 3b0a 2020 2020 2020 2020  TICAL);.        
-0000fab0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000fac0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000fad0: 7d20 656c 7365 207b 0a20 2020 2020 2020  } else {.       
-0000fae0: 2020 2020 2024 6d61 696c 203d 2040 706f       $mail = @po
-0000faf0: 7065 6e28 2473 656e 646d 6169 6c2c 2027  pen($sendmail, '
-0000fb00: 7727 293b 0a20 2020 2020 2020 2020 2020  w');.           
-0000fb10: 2069 6620 2821 246d 6169 6c29 207b 0a20   if (!$mail) {. 
-0000fb20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000fb30: 6872 6f77 206e 6577 2045 7863 6570 7469  hrow new Excepti
-0000fb40: 6f6e 2824 7468 6973 2d3e 6c61 6e67 2827  on($this->lang('
-0000fb50: 6578 6563 7574 6527 2920 2e20 2474 6869  execute') . $thi
-0000fb60: 732d 3e53 656e 646d 6169 6c2c 2073 656c  s->Sendmail, sel
-0000fb70: 663a 3a53 544f 505f 4352 4954 4943 414c  f::STOP_CRITICAL
-0000fb80: 293b 0a20 2020 2020 2020 2020 2020 207d  );.            }
-0000fb90: 0a20 2020 2020 2020 2020 2020 2066 7772  .            fwr
-0000fba0: 6974 6528 246d 6169 6c2c 2024 6865 6164  ite($mail, $head
-0000fbb0: 6572 293b 0a20 2020 2020 2020 2020 2020  er);.           
-0000fbc0: 2066 7772 6974 6528 246d 6169 6c2c 2024   fwrite($mail, $
-0000fbd0: 626f 6479 293b 0a20 2020 2020 2020 2020  body);.         
-0000fbe0: 2020 2024 7265 7375 6c74 203d 2070 636c     $result = pcl
-0000fbf0: 6f73 6528 246d 6169 6c29 3b0a 2020 2020  ose($mail);.    
-0000fc00: 2020 2020 2020 2020 2474 6869 732d 3e64          $this->d
-0000fc10: 6f43 616c 6c62 6163 6b28 0a20 2020 2020  oCallback(.     
-0000fc20: 2020 2020 2020 2020 2020 2028 2472 6573             ($res
-0000fc30: 756c 7420 3d3d 3d20 3029 2c0a 2020 2020  ult === 0),.    
+0000aa60: 2020 2020 2069 6620 2864 6566 696e 6564       if (defined
+0000aa70: 2827 4d42 5f43 4153 455f 5550 5045 5227  ('MB_CASE_UPPER'
+0000aa80: 2920 2626 2070 7265 675f 6d61 7463 6828  ) && preg_match(
+0000aa90: 272f 5e3d 5c3f 2e2a 5c3f 3d24 2f73 272c  '/^=\?.*\?=$/s',
+0000aaa0: 2024 6e61 6d65 2929 207b 0a20 2020 2020   $name)) {.     
+0000aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aac0: 2020 2020 2020 2024 6f72 6967 4368 6172         $origChar
+0000aad0: 7365 7420 3d20 6d62 5f69 6e74 6572 6e61  set = mb_interna
+0000aae0: 6c5f 656e 636f 6469 6e67 2829 3b0a 2020  l_encoding();.  
+0000aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab00: 2020 2020 2020 2020 2020 6d62 5f69 6e74            mb_int
+0000ab10: 6572 6e61 6c5f 656e 636f 6469 6e67 2824  ernal_encoding($
+0000ab20: 6368 6172 7365 7429 3b0a 2020 2020 2020  charset);.      
+0000ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab40: 2020 2020 2020 2f2f 556e 646f 2061 6e79        //Undo any
+0000ab50: 2052 4643 3230 3437 2d65 6e63 6f64 6564   RFC2047-encoded
+0000ab60: 2073 7061 6365 732d 6173 2d75 6e64 6572   spaces-as-under
+0000ab70: 7363 6f72 6573 0a20 2020 2020 2020 2020  scores.         
+0000ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab90: 2020 2024 6e61 6d65 203d 2073 7472 5f72     $name = str_r
+0000aba0: 6570 6c61 6365 2827 5f27 2c20 273d 3230  eplace('_', '=20
+0000abb0: 272c 2024 6e61 6d65 293b 0a20 2020 2020  ', $name);.     
+0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abd0: 2020 2020 2020 202f 2f44 6563 6f64 6520         //Decode 
+0000abe0: 7468 6520 6e61 6d65 0a20 2020 2020 2020  the name.       
+0000abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac00: 2020 2020 2024 6e61 6d65 203d 206d 625f       $name = mb_
+0000ac10: 6465 636f 6465 5f6d 696d 6568 6561 6465  decode_mimeheade
+0000ac20: 7228 246e 616d 6529 3b0a 2020 2020 2020  r($name);.      
+0000ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac40: 2020 2020 2020 6d62 5f69 6e74 6572 6e61        mb_interna
+0000ac50: 6c5f 656e 636f 6469 6e67 2824 6f72 6967  l_encoding($orig
+0000ac60: 4368 6172 7365 7429 3b0a 2020 2020 2020  Charset);.      
+0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac80: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+0000ac90: 2020 2020 2020 2020 2020 2020 2461 6464              $add
+0000aca0: 7265 7373 6573 5b5d 203d 205b 0a20 2020  resses[] = [.   
+0000acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acc0: 2020 2020 2020 2020 202f 2f52 656d 6f76           //Remov
+0000acd0: 6520 616e 7920 7375 7272 6f75 6e64 696e  e any surroundin
+0000ace0: 6720 7175 6f74 6573 2061 6e64 2073 7061  g quotes and spa
+0000acf0: 6365 7320 6672 6f6d 2074 6865 206e 616d  ces from the nam
+0000ad00: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000ad10: 2020 2020 2020 2020 2020 2020 2020 276e                'n
+0000ad20: 616d 6527 203d 3e20 7472 696d 2824 6e61  ame' => trim($na
+0000ad30: 6d65 2c20 275c 2722 2027 292c 0a20 2020  me, '\'" '),.   
+0000ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad50: 2020 2020 2020 2020 2027 6164 6472 6573           'addres
+0000ad60: 7327 203d 3e20 2465 6d61 696c 2c0a 2020  s' => $email,.  
+0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad80: 2020 2020 2020 5d3b 0a20 2020 2020 2020        ];.       
+0000ad90: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0000ada0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0000adb0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+0000adc0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0000add0: 2020 7265 7475 726e 2024 6164 6472 6573    return $addres
+0000ade0: 7365 733b 0a20 2020 207d 0a0a 2020 2020  ses;.    }..    
+0000adf0: 2f2a 2a0a 2020 2020 202a 2053 6574 2074  /**.     * Set t
+0000ae00: 6865 2046 726f 6d20 616e 6420 4672 6f6d  he From and From
+0000ae10: 4e61 6d65 2070 726f 7065 7274 6965 732e  Name properties.
+0000ae20: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+0000ae30: 7061 7261 6d20 7374 7269 6e67 2024 6164  param string $ad
+0000ae40: 6472 6573 730a 2020 2020 202a 2040 7061  dress.     * @pa
+0000ae50: 7261 6d20 7374 7269 6e67 2024 6e61 6d65  ram string $name
+0000ae60: 0a20 2020 2020 2a20 4070 6172 616d 2062  .     * @param b
+0000ae70: 6f6f 6c20 2020 2461 7574 6f20 2020 2057  ool   $auto    W
+0000ae80: 6865 7468 6572 2074 6f20 616c 736f 2073  hether to also s
+0000ae90: 6574 2074 6865 2053 656e 6465 7220 6164  et the Sender ad
+0000aea0: 6472 6573 732c 2064 6566 6175 6c74 7320  dress, defaults 
+0000aeb0: 746f 2074 7275 650a 2020 2020 202a 0a20  to true.     *. 
+0000aec0: 2020 2020 2a20 4074 6872 6f77 7320 4578      * @throws Ex
+0000aed0: 6365 7074 696f 6e0a 2020 2020 202a 0a20  ception.     *. 
+0000aee0: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
+0000aef0: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
+0000af00: 7562 6c69 6320 6675 6e63 7469 6f6e 2073  ublic function s
+0000af10: 6574 4672 6f6d 2824 6164 6472 6573 732c  etFrom($address,
+0000af20: 2024 6e61 6d65 203d 2027 272c 2024 6175   $name = '', $au
+0000af30: 746f 203d 2074 7275 6529 0a20 2020 207b  to = true).    {
+0000af40: 0a20 2020 2020 2020 2024 6164 6472 6573  .        $addres
+0000af50: 7320 3d20 7472 696d 2828 7374 7269 6e67  s = trim((string
+0000af60: 2924 6164 6472 6573 7329 3b0a 2020 2020  )$address);.    
+0000af70: 2020 2020 246e 616d 6520 3d20 7472 696d      $name = trim
+0000af80: 2870 7265 675f 7265 706c 6163 6528 272f  (preg_replace('/
+0000af90: 5b5c 725c 6e5d 2b2f 272c 2027 272c 2024  [\r\n]+/', '', $
+0000afa0: 6e61 6d65 2929 3b20 2f2f 5374 7269 7020  name)); //Strip 
+0000afb0: 6272 6561 6b73 2061 6e64 2074 7269 6d0a  breaks and trim.
+0000afc0: 2020 2020 2020 2020 2f2f 446f 6e27 7420          //Don't 
+0000afd0: 7661 6c69 6461 7465 206e 6f77 2061 6464  validate now add
+0000afe0: 7265 7373 6573 2077 6974 6820 4944 4e2e  resses with IDN.
+0000aff0: 2057 696c 6c20 6265 2064 6f6e 6520 696e   Will be done in
+0000b000: 2073 656e 6428 292e 0a20 2020 2020 2020   send()..       
+0000b010: 2024 706f 7320 3d20 7374 7272 706f 7328   $pos = strrpos(
+0000b020: 2461 6464 7265 7373 2c20 2740 2729 3b0a  $address, '@');.
+0000b030: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+0000b040: 2020 2020 2020 2020 2028 6661 6c73 6520           (false 
+0000b050: 3d3d 3d20 2470 6f73 290a 2020 2020 2020  === $pos).      
+0000b060: 2020 2020 2020 7c7c 2028 2821 2474 6869        || ((!$thi
+0000b070: 732d 3e68 6173 3862 6974 4368 6172 7328  s->has8bitChars(
+0000b080: 7375 6273 7472 2824 6164 6472 6573 732c  substr($address,
+0000b090: 202b 2b24 706f 7329 2920 7c7c 2021 7374   ++$pos)) || !st
+0000b0a0: 6174 6963 3a3a 6964 6e53 7570 706f 7274  atic::idnSupport
+0000b0b0: 6564 2829 290a 2020 2020 2020 2020 2020  ed()).          
+0000b0c0: 2020 2626 2021 7374 6174 6963 3a3a 7661    && !static::va
+0000b0d0: 6c69 6461 7465 4164 6472 6573 7328 2461  lidateAddress($a
+0000b0e0: 6464 7265 7373 2929 0a20 2020 2020 2020  ddress)).       
+0000b0f0: 2029 207b 0a20 2020 2020 2020 2020 2020   ) {.           
+0000b100: 2024 6572 726f 725f 6d65 7373 6167 6520   $error_message 
+0000b110: 3d20 7370 7269 6e74 6628 0a20 2020 2020  = sprintf(.     
+0000b120: 2020 2020 2020 2020 2020 2027 2573 2028             '%s (
+0000b130: 4672 6f6d 293a 2025 7327 2c0a 2020 2020  From): %s',.    
+0000b140: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0000b150: 732d 3e6c 616e 6728 2769 6e76 616c 6964  s->lang('invalid
+0000b160: 5f61 6464 7265 7373 2729 2c0a 2020 2020  _address'),.    
+0000b170: 2020 2020 2020 2020 2020 2020 2461 6464              $add
+0000b180: 7265 7373 0a20 2020 2020 2020 2020 2020  ress.           
+0000b190: 2029 3b0a 2020 2020 2020 2020 2020 2020   );.            
+0000b1a0: 2474 6869 732d 3e73 6574 4572 726f 7228  $this->setError(
+0000b1b0: 2465 7272 6f72 5f6d 6573 7361 6765 293b  $error_message);
+0000b1c0: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
+0000b1d0: 6973 2d3e 6564 6562 7567 2824 6572 726f  is->edebug($erro
+0000b1e0: 725f 6d65 7373 6167 6529 3b0a 2020 2020  r_message);.    
+0000b1f0: 2020 2020 2020 2020 6966 2028 2474 6869          if ($thi
+0000b200: 732d 3e65 7863 6570 7469 6f6e 7329 207b  s->exceptions) {
+0000b210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b220: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+0000b230: 7469 6f6e 2824 6572 726f 725f 6d65 7373  tion($error_mess
+0000b240: 6167 6529 3b0a 2020 2020 2020 2020 2020  age);.          
+0000b250: 2020 7d0a 0a20 2020 2020 2020 2020 2020    }..           
+0000b260: 2072 6574 7572 6e20 6661 6c73 653b 0a20   return false;. 
+0000b270: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000b280: 2024 7468 6973 2d3e 4672 6f6d 203d 2024   $this->From = $
+0000b290: 6164 6472 6573 733b 0a20 2020 2020 2020  address;.       
+0000b2a0: 2024 7468 6973 2d3e 4672 6f6d 4e61 6d65   $this->FromName
+0000b2b0: 203d 2024 6e61 6d65 3b0a 2020 2020 2020   = $name;.      
+0000b2c0: 2020 6966 2028 2461 7574 6f20 2626 2065    if ($auto && e
+0000b2d0: 6d70 7479 2824 7468 6973 2d3e 5365 6e64  mpty($this->Send
+0000b2e0: 6572 2929 207b 0a20 2020 2020 2020 2020  er)) {.         
+0000b2f0: 2020 2024 7468 6973 2d3e 5365 6e64 6572     $this->Sender
+0000b300: 203d 2024 6164 6472 6573 733b 0a20 2020   = $address;.   
+0000b310: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+0000b320: 7265 7475 726e 2074 7275 653b 0a20 2020  return true;.   
+0000b330: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+0000b340: 202a 2052 6574 7572 6e20 7468 6520 4d65   * Return the Me
+0000b350: 7373 6167 652d 4944 2068 6561 6465 7220  ssage-ID header 
+0000b360: 6f66 2074 6865 206c 6173 7420 656d 6169  of the last emai
+0000b370: 6c2e 0a20 2020 2020 2a20 5465 6368 6e69  l..     * Techni
+0000b380: 6361 6c6c 7920 7468 6973 2069 7320 7468  cally this is th
+0000b390: 6520 7661 6c75 6520 6672 6f6d 2074 6865  e value from the
+0000b3a0: 206c 6173 7420 7469 6d65 2074 6865 2068   last time the h
+0000b3b0: 6561 6465 7273 2077 6572 6520 6372 6561  eaders were crea
+0000b3c0: 7465 642c 0a20 2020 2020 2a20 6275 7420  ted,.     * but 
+0000b3d0: 6974 2773 2061 6c73 6f20 7468 6520 6d65  it's also the me
+0000b3e0: 7373 6167 6520 4944 206f 6620 7468 6520  ssage ID of the 
+0000b3f0: 6c61 7374 2073 656e 7420 6d65 7373 6167  last sent messag
+0000b400: 6520 6578 6365 7074 2069 6e0a 2020 2020  e except in.    
+0000b410: 202a 2070 6174 686f 6c6f 6769 6361 6c20   * pathological 
+0000b420: 6361 7365 732e 0a20 2020 2020 2a0a 2020  cases..     *.  
+0000b430: 2020 202a 2040 7265 7475 726e 2073 7472     * @return str
+0000b440: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
+0000b450: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+0000b460: 6765 744c 6173 744d 6573 7361 6765 4944  getLastMessageID
+0000b470: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
+0000b480: 2072 6574 7572 6e20 2474 6869 732d 3e6c   return $this->l
+0000b490: 6173 744d 6573 7361 6765 4944 3b0a 2020  astMessageID;.  
+0000b4a0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+0000b4b0: 2020 2a20 4368 6563 6b20 7468 6174 2061    * Check that a
+0000b4c0: 2073 7472 696e 6720 6c6f 6f6b 7320 6c69   string looks li
+0000b4d0: 6b65 2061 6e20 656d 6169 6c20 6164 6472  ke an email addr
+0000b4e0: 6573 732e 0a20 2020 2020 2a20 5661 6c69  ess..     * Vali
+0000b4f0: 6461 7469 6f6e 2070 6174 7465 726e 7320  dation patterns 
+0000b500: 7375 7070 6f72 7465 643a 0a20 2020 2020  supported:.     
+0000b510: 2a20 2a20 6061 7574 6f60 2050 6963 6b20  * * `auto` Pick 
+0000b520: 6265 7374 2070 6174 7465 726e 2061 7574  best pattern aut
+0000b530: 6f6d 6174 6963 616c 6c79 3b0a 2020 2020  omatically;.    
+0000b540: 202a 202a 2060 7063 7265 3860 2055 7365   * * `pcre8` Use
+0000b550: 2074 6865 2073 7175 696c 6f6f 706c 652e   the squiloople.
+0000b560: 636f 6d20 7061 7474 6572 6e2c 2072 6571  com pattern, req
+0000b570: 7569 7265 7320 5043 5245 203e 2038 2e30  uires PCRE > 8.0
+0000b580: 3b0a 2020 2020 202a 202a 2060 7063 7265  ;.     * * `pcre
+0000b590: 6020 5573 6520 6f6c 6420 5043 5245 2069  ` Use old PCRE i
+0000b5a0: 6d70 6c65 6d65 6e74 6174 696f 6e3b 0a20  mplementation;. 
+0000b5b0: 2020 2020 2a20 2a20 6070 6870 6020 5573      * * `php` Us
+0000b5c0: 6520 5048 5020 6275 696c 742d 696e 2046  e PHP built-in F
+0000b5d0: 494c 5445 525f 5641 4c49 4441 5445 5f45  ILTER_VALIDATE_E
+0000b5e0: 4d41 494c 3b0a 2020 2020 202a 202a 2060  MAIL;.     * * `
+0000b5f0: 6874 6d6c 3560 2055 7365 2074 6865 2070  html5` Use the p
+0000b600: 6174 7465 726e 2067 6976 656e 2062 7920  attern given by 
+0000b610: 7468 6520 4854 4d4c 3520 7370 6563 2066  the HTML5 spec f
+0000b620: 6f72 2027 656d 6169 6c27 2074 7970 6520  or 'email' type 
+0000b630: 666f 726d 2069 6e70 7574 2065 6c65 6d65  form input eleme
+0000b640: 6e74 732e 0a20 2020 2020 2a20 2a20 606e  nts..     * * `n
+0000b650: 6f72 6567 6578 6020 446f 6e27 7420 7573  oregex` Don't us
+0000b660: 6520 6120 7265 6765 783a 2073 7570 6572  e a regex: super
+0000b670: 2066 6173 742c 2072 6561 6c6c 7920 6475   fast, really du
+0000b680: 6d62 2e0a 2020 2020 202a 2041 6c74 6572  mb..     * Alter
+0000b690: 6e61 7469 7665 6c79 2079 6f75 206d 6179  natively you may
+0000b6a0: 2070 6173 7320 696e 2061 2063 616c 6c61   pass in a calla
+0000b6b0: 626c 6520 746f 2069 6e6a 6563 7420 796f  ble to inject yo
+0000b6c0: 7572 206f 776e 2076 616c 6964 6174 6f72  ur own validator
+0000b6d0: 2c20 666f 7220 6578 616d 706c 653a 0a20  , for example:. 
+0000b6e0: 2020 2020 2a0a 2020 2020 202a 2060 6060      *.     * ```
+0000b6f0: 7068 700a 2020 2020 202a 2050 4850 4d61  php.     * PHPMa
+0000b700: 696c 6572 3a3a 7661 6c69 6461 7465 4164  iler::validateAd
+0000b710: 6472 6573 7328 2775 7365 7240 6578 616d  dress('user@exam
+0000b720: 706c 652e 636f 6d27 2c20 6675 6e63 7469  ple.com', functi
+0000b730: 6f6e 2824 6164 6472 6573 7329 207b 0a20  on($address) {. 
+0000b740: 2020 2020 2a20 2020 2020 7265 7475 726e      *     return
+0000b750: 2028 7374 7270 6f73 2824 6164 6472 6573   (strpos($addres
+0000b760: 732c 2027 4027 2920 213d 3d20 6661 6c73  s, '@') !== fals
+0000b770: 6529 3b0a 2020 2020 202a 207d 293b 0a20  e);.     * });. 
+0000b780: 2020 2020 2a20 6060 600a 2020 2020 202a      * ```.     *
+0000b790: 0a20 2020 2020 2a20 596f 7520 6361 6e20  .     * You can 
+0000b7a0: 616c 736f 2073 6574 2074 6865 2050 4850  also set the PHP
+0000b7b0: 4d61 696c 6572 3a3a 2476 616c 6964 6174  Mailer::$validat
+0000b7c0: 6f72 2073 7461 7469 6320 746f 2061 2063  or static to a c
+0000b7d0: 616c 6c61 626c 652c 2061 6c6c 6f77 696e  allable, allowin
+0000b7e0: 6720 6275 696c 742d 696e 206d 6574 686f  g built-in metho
+0000b7f0: 6473 2074 6f20 7573 6520 796f 7572 2076  ds to use your v
+0000b800: 616c 6964 6174 6f72 2e0a 2020 2020 202a  alidator..     *
+0000b810: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+0000b820: 7472 696e 6720 2020 2020 2020 2020 2024  tring          $
+0000b830: 6164 6472 6573 7320 2020 2020 2020 5468  address       Th
+0000b840: 6520 656d 6169 6c20 6164 6472 6573 7320  e email address 
+0000b850: 746f 2063 6865 636b 0a20 2020 2020 2a20  to check.     * 
+0000b860: 4070 6172 616d 2073 7472 696e 677c 6361  @param string|ca
+0000b870: 6c6c 6162 6c65 2024 7061 7474 6572 6e73  llable $patterns
+0000b880: 656c 6563 7420 5768 6963 6820 7061 7474  elect Which patt
+0000b890: 6572 6e20 746f 2075 7365 0a20 2020 2020  ern to use.     
+0000b8a0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+0000b8b0: 2062 6f6f 6c0a 2020 2020 202a 2f0a 2020   bool.     */.  
+0000b8c0: 2020 7075 626c 6963 2073 7461 7469 6320    public static 
+0000b8d0: 6675 6e63 7469 6f6e 2076 616c 6964 6174  function validat
+0000b8e0: 6541 6464 7265 7373 2824 6164 6472 6573  eAddress($addres
+0000b8f0: 732c 2024 7061 7474 6572 6e73 656c 6563  s, $patternselec
+0000b900: 7420 3d20 6e75 6c6c 290a 2020 2020 7b0a  t = null).    {.
+0000b910: 2020 2020 2020 2020 6966 2028 6e75 6c6c          if (null
+0000b920: 203d 3d3d 2024 7061 7474 6572 6e73 656c   === $patternsel
+0000b930: 6563 7429 207b 0a20 2020 2020 2020 2020  ect) {.         
+0000b940: 2020 2024 7061 7474 6572 6e73 656c 6563     $patternselec
+0000b950: 7420 3d20 7374 6174 6963 3a3a 2476 616c  t = static::$val
+0000b960: 6964 6174 6f72 3b0a 2020 2020 2020 2020  idator;.        
+0000b970: 7d0a 2020 2020 2020 2020 2f2f 446f 6e27  }.        //Don'
+0000b980: 7420 616c 6c6f 7720 7374 7269 6e67 7320  t allow strings 
+0000b990: 6173 2063 616c 6c61 626c 6573 2c20 7365  as callables, se
+0000b9a0: 6520 5345 4355 5249 5459 2e6d 6420 616e  e SECURITY.md an
+0000b9b0: 6420 4356 452d 3230 3231 2d33 3630 330a  d CVE-2021-3603.
+0000b9c0: 2020 2020 2020 2020 6966 2028 6973 5f63          if (is_c
+0000b9d0: 616c 6c61 626c 6528 2470 6174 7465 726e  allable($pattern
+0000b9e0: 7365 6c65 6374 2920 2626 2021 6973 5f73  select) && !is_s
+0000b9f0: 7472 696e 6728 2470 6174 7465 726e 7365  tring($patternse
+0000ba00: 6c65 6374 2929 207b 0a20 2020 2020 2020  lect)) {.       
+0000ba10: 2020 2020 2072 6574 7572 6e20 6361 6c6c       return call
+0000ba20: 5f75 7365 725f 6675 6e63 2824 7061 7474  _user_func($patt
+0000ba30: 6572 6e73 656c 6563 742c 2024 6164 6472  ernselect, $addr
+0000ba40: 6573 7329 3b0a 2020 2020 2020 2020 7d0a  ess);.        }.
+0000ba50: 2020 2020 2020 2020 2f2f 5265 6a65 6374          //Reject
+0000ba60: 206c 696e 6520 6272 6561 6b73 2069 6e20   line breaks in 
+0000ba70: 6164 6472 6573 7365 733b 2069 7427 7320  addresses; it's 
+0000ba80: 7661 6c69 6420 5246 4335 3332 322c 2062  valid RFC5322, b
+0000ba90: 7574 206e 6f74 2052 4643 3533 3231 0a20  ut not RFC5321. 
+0000baa0: 2020 2020 2020 2069 6620 2873 7472 706f         if (strpo
+0000bab0: 7328 2461 6464 7265 7373 2c20 225c 6e22  s($address, "\n"
+0000bac0: 2920 213d 3d20 6661 6c73 6520 7c7c 2073  ) !== false || s
+0000bad0: 7472 706f 7328 2461 6464 7265 7373 2c20  trpos($address, 
+0000bae0: 225c 7222 2920 213d 3d20 6661 6c73 6529  "\r") !== false)
+0000baf0: 207b 0a20 2020 2020 2020 2020 2020 2072   {.            r
+0000bb00: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
+0000bb10: 2020 2020 207d 0a20 2020 2020 2020 2073       }.        s
+0000bb20: 7769 7463 6820 2824 7061 7474 6572 6e73  witch ($patterns
+0000bb30: 656c 6563 7429 207b 0a20 2020 2020 2020  elect) {.       
+0000bb40: 2020 2020 2063 6173 6520 2770 6372 6527       case 'pcre'
+0000bb50: 3a20 2f2f 4b65 7074 2066 6f72 2042 430a  : //Kept for BC.
+0000bb60: 2020 2020 2020 2020 2020 2020 6361 7365              case
+0000bb70: 2027 7063 7265 3827 3a0a 2020 2020 2020   'pcre8':.      
+0000bb80: 2020 2020 2020 2020 2020 2f2a 0a20 2020            /*.   
+0000bb90: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+0000bba0: 4120 6d6f 7265 2063 6f6d 706c 6578 2061  A more complex a
+0000bbb0: 6e64 206d 6f72 6520 7065 726d 6973 7369  nd more permissi
+0000bbc0: 7665 2076 6572 7369 6f6e 206f 6620 7468  ve version of th
+0000bbd0: 6520 5246 4335 3332 3220 7265 6765 7820  e RFC5322 regex 
+0000bbe0: 6f6e 2077 6869 6368 2046 494c 5445 525f  on which FILTER_
+0000bbf0: 5641 4c49 4441 5445 5f45 4d41 494c 0a20  VALIDATE_EMAIL. 
+0000bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc10: 2a20 6973 2062 6173 6564 2e0a 2020 2020  * is based..    
+0000bc20: 2020 2020 2020 2020 2020 2020 202a 2049               * I
+0000bc30: 6e20 6164 6469 7469 6f6e 2074 6f20 7468  n addition to th
+0000bc40: 6520 6164 6472 6573 7365 7320 616c 6c6f  e addresses allo
+0000bc50: 7765 6420 6279 2066 696c 7465 725f 7661  wed by filter_va
+0000bc60: 722c 2061 6c73 6f20 7065 726d 6974 733a  r, also permits:
+0000bc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bc80: 2020 2a20 202a 2064 6f74 6c65 7373 2064    *  * dotless d
+0000bc90: 6f6d 6169 6e73 3a20 6061 4062 600a 2020  omains: `a@b`.  
+0000bca0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0000bcb0: 2020 2a20 636f 6d6d 656e 7473 3a20 6031    * comments: `1
+0000bcc0: 3233 3420 4020 6c6f 6361 6c28 626c 6168  234 @ local(blah
+0000bcd0: 2920 2e6d 6163 6869 6e65 202e 6578 616d  ) .machine .exam
+0000bce0: 706c 6560 0a20 2020 2020 2020 2020 2020  ple`.           
+0000bcf0: 2020 2020 2020 2a20 202a 2071 756f 7465        *  * quote
+0000bd00: 6420 656c 656d 656e 7473 3a20 6027 2274  d elements: `'"t
+0000bd10: 6573 7420 626c 6168 2240 6578 616d 706c  est blah"@exampl
+0000bd20: 652e 6f72 6727 600a 2020 2020 2020 2020  e.org'`.        
+0000bd30: 2020 2020 2020 2020 202a 2020 2a20 6e75           *  * nu
+0000bd40: 6d65 7269 6320 544c 4473 3a20 6061 4062  meric TLDs: `a@b
+0000bd50: 2e31 3233 600a 2020 2020 2020 2020 2020  .123`.          
+0000bd60: 2020 2020 2020 202a 2020 2a20 756e 6272         *  * unbr
+0000bd70: 6163 6b65 7465 6420 4950 7634 206c 6974  acketed IPv4 lit
+0000bd80: 6572 616c 733a 2060 6140 3139 322e 3136  erals: `a@192.16
+0000bd90: 382e 302e 3160 0a20 2020 2020 2020 2020  8.0.1`.         
+0000bda0: 2020 2020 2020 2020 2a20 202a 2049 5076          *  * IPv
+0000bdb0: 3620 6c69 7465 7261 6c73 3a20 2766 6972  6 literals: 'fir
+0000bdc0: 7374 2e6c 6173 7440 5b49 5076 363a 6131  st.last@[IPv6:a1
+0000bdd0: 3a3a 5d27 0a20 2020 2020 2020 2020 2020  ::]'.           
+0000bde0: 2020 2020 2020 2a20 4e6f 7420 616c 6c20        * Not all 
+0000bdf0: 6f66 2074 6865 7365 2077 696c 6c20 6e65  of these will ne
+0000be00: 6365 7373 6172 696c 7920 776f 726b 2066  cessarily work f
+0000be10: 6f72 2073 656e 6469 6e67 210a 2020 2020  or sending!.    
+0000be20: 2020 2020 2020 2020 2020 2020 202a 0a20               *. 
+0000be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be40: 2a20 4073 6565 2020 2020 2020 2068 7474  * @see       htt
+0000be50: 703a 2f2f 7371 7569 6c6f 6f70 6c65 2e63  p://squiloople.c
+0000be60: 6f6d 2f32 3030 392f 3132 2f32 302f 656d  om/2009/12/20/em
+0000be70: 6169 6c2d 6164 6472 6573 732d 7661 6c69  ail-address-vali
+0000be80: 6461 7469 6f6e 2f0a 2020 2020 2020 2020  dation/.        
+0000be90: 2020 2020 2020 2020 202a 2040 636f 7079           * @copy
+0000bea0: 7269 6768 7420 3230 3039 2d32 3031 3020  right 2009-2010 
+0000beb0: 4d69 6368 6165 6c20 5275 7368 746f 6e0a  Michael Rushton.
+0000bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bed0: 202a 2046 6565 6c20 6672 6565 2074 6f20   * Feel free to 
+0000bee0: 7573 6520 616e 6420 7265 6469 7374 7269  use and redistri
+0000bef0: 6275 7465 2074 6869 7320 636f 6465 2e20  bute this code. 
+0000bf00: 4275 7420 706c 6561 7365 206b 6565 7020  But please keep 
+0000bf10: 7468 6973 2063 6f70 7972 6967 6874 206e  this copyright n
+0000bf20: 6f74 6963 652e 0a20 2020 2020 2020 2020  otice..         
+0000bf30: 2020 2020 2020 2020 2a2f 0a20 2020 2020          */.     
+0000bf40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000bf50: 6e20 2862 6f6f 6c29 2070 7265 675f 6d61  n (bool) preg_ma
+0000bf60: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
+0000bf70: 2020 2020 2020 2020 2027 2f5e 283f 2128           '/^(?!(
+0000bf80: 3f3e 283f 3129 223f 283f 3e5c 5c5c 5b20  ?>(?1)"?(?>\\\[ 
+0000bf90: 2d7e 5d7c 5b5e 225d 2922 3f28 3f31 2929  -~]|[^"])"?(?1))
+0000bfa0: 7b32 3535 2c7d 2928 3f21 283f 3e28 3f31  {255,})(?!(?>(?1
+0000bfb0: 2922 3f28 3f3e 5c5c 5c5b 202d 7e5d 7c5b  )"?(?>\\\[ -~]|[
+0000bfc0: 5e22 5d29 223f 283f 3129 297b 3635 2c7d  ^"])"?(?1)){65,}
+0000bfd0: 4029 2720 2e0a 2020 2020 2020 2020 2020  @)' ..          
+0000bfe0: 2020 2020 2020 2020 2020 2728 283f 3e28            '((?>(
+0000bff0: 3f3e 283f 3e28 283f 3e28 3f3e 283f 3e5c  ?>(?>((?>(?>(?>\
+0000c000: 7830 445c 7830 4129 3f5b 5c74 205d 292b  x0D\x0A)?[\t ])+
+0000c010: 7c28 3f3e 5b5c 7420 5d2a 5c78 3044 5c78  |(?>[\t ]*\x0D\x
+0000c020: 3041 293f 5b5c 7420 5d2b 293f 2928 5c28  0A)?[\t ]+)?)(\(
+0000c030: 283f 3e28 3f32 2927 202e 0a20 2020 2020  (?>(?2)' ..     
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000c050: 283f 3e5b 5c78 3031 2d5c 7830 385c 7830  (?>[\x01-\x08\x0
+0000c060: 425c 7830 435c 7830 452d 5c27 2a2d 5c5b  B\x0C\x0E-\'*-\[
+0000c070: 5c5d 2d5c 7837 465d 7c5c 5c5c 5b5c 7830  \]-\x7F]|\\\[\x0
+0000c080: 302d 5c78 3746 5d7c 283f 3329 2929 2a28  0-\x7F]|(?3)))*(
+0000c090: 3f32 295c 2929 292b 283f 3229 297c 283f  ?2)\)))+(?2))|(?
+0000c0a0: 3229 293f 2927 202e 0a20 2020 2020 2020  2))?)' ..       
+0000c0b0: 2020 2020 2020 2020 2020 2020 2027 285b               '([
+0000c0c0: 2123 2d5c 272a 2b5c 2f2d 393d 3f5e 2d7e  !#-\'*+\/-9=?^-~
+0000c0d0: 2d5d 2b7c 2228 3f3e 283f 3229 283f 3e5b  -]+|"(?>(?2)(?>[
+0000c0e0: 5c78 3031 2d5c 7830 385c 7830 425c 7830  \x01-\x08\x0B\x0
+0000c0f0: 435c 7830 452d 2123 2d5c 5b5c 5d2d 5c78  C\x0E-!#-\[\]-\x
+0000c100: 3746 5d7c 5c5c 5c5b 5c78 3030 2d5c 7837  7F]|\\\[\x00-\x7
+0000c110: 465d 2929 2a27 202e 0a20 2020 2020 2020  F]))*' ..       
+0000c120: 2020 2020 2020 2020 2020 2020 2027 283f               '(?
+0000c130: 3229 2229 283f 3e28 3f31 295c 2e28 3f31  2)")(?>(?1)\.(?1
+0000c140: 2928 3f34 2929 2a28 3f31 2940 283f 2128  )(?4))*(?1)@(?!(
+0000c150: 3f31 295b 612d 7a30 2d39 2d5d 7b36 342c  ?1)[a-z0-9-]{64,
+0000c160: 7d29 283f 3129 283f 3e28 5b61 2d7a 302d  })(?1)(?>([a-z0-
+0000c170: 395d 283f 3e5b 612d 7a30 2d39 2d5d 2a5b  9](?>[a-z0-9-]*[
+0000c180: 612d 7a30 2d39 5d29 3f29 2720 2e0a 2020  a-z0-9])?)' ..  
+0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1a0: 2020 2728 3f3e 283f 3129 5c2e 283f 2128    '(?>(?1)\.(?!(
+0000c1b0: 3f31 295b 612d 7a30 2d39 2d5d 7b36 342c  ?1)[a-z0-9-]{64,
+0000c1c0: 7d29 283f 3129 283f 3529 297b 302c 3132  })(?1)(?5)){0,12
+0000c1d0: 367d 7c5c 5b28 3f3a 283f 3e49 5076 363a  6}|\[(?:(?>IPv6:
+0000c1e0: 283f 3e28 5b61 2d66 302d 395d 7b31 2c34  (?>([a-f0-9]{1,4
+0000c1f0: 7d29 283f 3e3a 283f 3629 297b 377d 2720  })(?>:(?6)){7}' 
+0000c200: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c210: 2020 2020 2020 277c 283f 2128 3f3a 2e2a        '|(?!(?:.*
+0000c220: 5b61 2d66 302d 395d 5b3a 5c5d 5d29 7b38  [a-f0-9][:\]]){8
+0000c230: 2c7d 2928 283f 3629 283f 3e3a 283f 3629  ,})((?6)(?>:(?6)
+0000c240: 297b 302c 367d 293f 3a3a 283f 3729 3f29  ){0,6})?::(?7)?)
+0000c250: 297c 283f 3e28 3f3e 4950 7636 3a28 3f3e  )|(?>(?>IPv6:(?>
+0000c260: 283f 3629 283f 3e3a 283f 3629 297b 357d  (?6)(?>:(?6)){5}
+0000c270: 3a27 202e 0a20 2020 2020 2020 2020 2020  :' ..           
+0000c280: 2020 2020 2020 2020 2027 7c28 3f21 283f           '|(?!(?
+0000c290: 3a2e 2a5b 612d 6630 2d39 5d3a 297b 362c  :.*[a-f0-9]:){6,
+0000c2a0: 7d29 283f 3829 3f3a 3a28 3f3e 2828 3f36  })(?8)?::(?>((?6
+0000c2b0: 2928 3f3e 3a28 3f36 2929 7b30 2c34 7d29  )(?>:(?6)){0,4})
+0000c2c0: 3a29 3f29 293f 2832 355b 302d 355d 7c32  :)?))?(25[0-5]|2
+0000c2d0: 5b30 2d34 5d5b 302d 395d 7c31 5b30 2d39  [0-4][0-9]|1[0-9
+0000c2e0: 5d7b 327d 2720 2e0a 2020 2020 2020 2020  ]{2}' ..        
+0000c2f0: 2020 2020 2020 2020 2020 2020 277c 5b31              '|[1
+0000c300: 2d39 5d3f 5b30 2d39 5d29 283f 3e5c 2e28  -9]?[0-9])(?>\.(
+0000c310: 3f39 2929 7b33 7d29 295c 5d29 283f 3129  ?9)){3}))\])(?1)
+0000c320: 242f 6973 4427 2c0a 2020 2020 2020 2020  $/isD',.        
+0000c330: 2020 2020 2020 2020 2020 2020 2461 6464              $add
+0000c340: 7265 7373 0a20 2020 2020 2020 2020 2020  ress.           
+0000c350: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
+0000c360: 2020 2020 6361 7365 2027 6874 6d6c 3527      case 'html5'
+0000c370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c380: 2020 2f2a 0a20 2020 2020 2020 2020 2020    /*.           
+0000c390: 2020 2020 2020 2a20 5468 6973 2069 7320        * This is 
+0000c3a0: 7468 6520 7061 7474 6572 6e20 7573 6564  the pattern used
+0000c3b0: 2069 6e20 7468 6520 4854 4d4c 3520 7370   in the HTML5 sp
+0000c3c0: 6563 2066 6f72 2076 616c 6964 6174 696f  ec for validatio
+0000c3d0: 6e20 6f66 2027 656d 6169 6c27 2074 7970  n of 'email' typ
+0000c3e0: 6520 666f 726d 2069 6e70 7574 2065 6c65  e form input ele
+0000c3f0: 6d65 6e74 732e 0a20 2020 2020 2020 2020  ments..         
+0000c400: 2020 2020 2020 2020 2a0a 2020 2020 2020          *.      
+0000c410: 2020 2020 2020 2020 2020 202a 2040 7365             * @se
+0000c420: 6520 6874 7470 733a 2f2f 6874 6d6c 2e73  e https://html.s
+0000c430: 7065 632e 7768 6174 7767 2e6f 7267 2f23  pec.whatwg.org/#
+0000c440: 652d 6d61 696c 2d73 7461 7465 2d28 7479  e-mail-state-(ty
+0000c450: 7065 3d65 6d61 696c 290a 2020 2020 2020  pe=email).      
+0000c460: 2020 2020 2020 2020 2020 202a 2f0a 2020             */.  
+0000c470: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000c480: 7475 726e 2028 626f 6f6c 2920 7072 6567  turn (bool) preg
+0000c490: 5f6d 6174 6368 280a 2020 2020 2020 2020  _match(.        
+0000c4a0: 2020 2020 2020 2020 2020 2020 272f 5e5b              '/^[
+0000c4b0: 612d 7a41 2d5a 302d 392e 2123 2425 265c  a-zA-Z0-9.!#$%&\
+0000c4c0: 272a 2b5c 2f3d 3f5e 5f60 7b7c 7d7e 2d5d  '*+\/=?^_`{|}~-]
+0000c4d0: 2b40 5b61 2d7a 412d 5a30 2d39 5d28 3f3a  +@[a-zA-Z0-9](?:
+0000c4e0: 5b61 2d7a 412d 5a30 2d39 2d5d 7b30 2c36  [a-zA-Z0-9-]{0,6
+0000c4f0: 317d 2720 2e0a 2020 2020 2020 2020 2020  1}' ..          
+0000c500: 2020 2020 2020 2020 2020 275b 612d 7a41            '[a-zA
+0000c510: 2d5a 302d 395d 293f 283f 3a5c 2e5b 612d  -Z0-9])?(?:\.[a-
+0000c520: 7a41 2d5a 302d 395d 283f 3a5b 612d 7a41  zA-Z0-9](?:[a-zA
+0000c530: 2d5a 302d 392d 5d7b 302c 3631 7d5b 612d  -Z0-9-]{0,61}[a-
+0000c540: 7a41 2d5a 302d 395d 293f 292a 242f 7344  zA-Z0-9])?)*$/sD
+0000c550: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0000c560: 2020 2020 2020 2024 6164 6472 6573 730a         $address.
+0000c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c580: 293b 0a20 2020 2020 2020 2020 2020 2063  );.            c
+0000c590: 6173 6520 2770 6870 273a 0a20 2020 2020  ase 'php':.     
+0000c5a0: 2020 2020 2020 2064 6566 6175 6c74 3a0a         default:.
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5c0: 7265 7475 726e 2066 696c 7465 725f 7661  return filter_va
+0000c5d0: 7228 2461 6464 7265 7373 2c20 4649 4c54  r($address, FILT
+0000c5e0: 4552 5f56 414c 4944 4154 455f 454d 4149  ER_VALIDATE_EMAI
+0000c5f0: 4c29 2021 3d3d 2066 616c 7365 3b0a 2020  L) !== false;.  
+0000c600: 2020 2020 2020 7d0a 2020 2020 7d0a 0a20        }.    }.. 
+0000c610: 2020 202f 2a2a 0a20 2020 2020 2a20 5465     /**.     * Te
+0000c620: 6c6c 7320 7768 6574 6865 7220 4944 4e73  lls whether IDNs
+0000c630: 2028 496e 7465 726e 6174 696f 6e61 6c69   (Internationali
+0000c640: 7a65 6420 446f 6d61 696e 204e 616d 6573  zed Domain Names
+0000c650: 2920 6172 6520 7375 7070 6f72 7465 6420  ) are supported 
+0000c660: 6f72 206e 6f74 2e20 5468 6973 2072 6571  or not. This req
+0000c670: 7569 7265 7320 7468 650a 2020 2020 202a  uires the.     *
+0000c680: 2060 696e 746c 6020 616e 6420 606d 6273   `intl` and `mbs
+0000c690: 7472 696e 6760 2050 4850 2065 7874 656e  tring` PHP exten
+0000c6a0: 7369 6f6e 732e 0a20 2020 2020 2a0a 2020  sions..     *.  
+0000c6b0: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
+0000c6c0: 6c20 6074 7275 6560 2069 6620 7265 7175  l `true` if requ
+0000c6d0: 6972 6564 2066 756e 6374 696f 6e73 2066  ired functions f
+0000c6e0: 6f72 2049 444e 2073 7570 706f 7274 2061  or IDN support a
+0000c6f0: 7265 2070 7265 7365 6e74 0a20 2020 2020  re present.     
+0000c700: 2a2f 0a20 2020 2070 7562 6c69 6320 7374  */.    public st
+0000c710: 6174 6963 2066 756e 6374 696f 6e20 6964  atic function id
+0000c720: 6e53 7570 706f 7274 6564 2829 0a20 2020  nSupported().   
+0000c730: 207b 0a20 2020 2020 2020 2072 6574 7572   {.        retur
+0000c740: 6e20 6675 6e63 7469 6f6e 5f65 7869 7374  n function_exist
+0000c750: 7328 2769 646e 5f74 6f5f 6173 6369 6927  s('idn_to_ascii'
+0000c760: 2920 2626 2066 756e 6374 696f 6e5f 6578  ) && function_ex
+0000c770: 6973 7473 2827 6d62 5f63 6f6e 7665 7274  ists('mb_convert
+0000c780: 5f65 6e63 6f64 696e 6727 293b 0a20 2020  _encoding');.   
+0000c790: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+0000c7a0: 202a 2043 6f6e 7665 7274 7320 4944 4e20   * Converts IDN 
+0000c7b0: 696e 2067 6976 656e 2065 6d61 696c 2061  in given email a
+0000c7c0: 6464 7265 7373 2074 6f20 6974 7320 4153  ddress to its AS
+0000c7d0: 4349 4920 666f 726d 2c20 616c 736f 206b  CII form, also k
+0000c7e0: 6e6f 776e 2061 7320 7075 6e79 636f 6465  nown as punycode
+0000c7f0: 2c20 6966 2070 6f73 7369 626c 652e 0a20  , if possible.. 
+0000c800: 2020 2020 2a20 496d 706f 7274 616e 743a      * Important:
+0000c810: 2041 6464 7265 7373 206d 7573 7420 6265   Address must be
+0000c820: 2070 6173 7365 6420 696e 2073 616d 6520   passed in same 
+0000c830: 656e 636f 6469 6e67 2061 7320 6375 7272  encoding as curr
+0000c840: 656e 746c 7920 7365 7420 696e 2050 4850  ently set in PHP
+0000c850: 4d61 696c 6572 3a3a 2443 6861 7253 6574  Mailer::$CharSet
+0000c860: 2e0a 2020 2020 202a 2054 6869 7320 6675  ..     * This fu
+0000c870: 6e63 7469 6f6e 2073 696c 656e 746c 7920  nction silently 
+0000c880: 7265 7475 726e 7320 756e 6d6f 6469 6669  returns unmodifi
+0000c890: 6564 2061 6464 7265 7373 2069 663a 0a20  ed address if:. 
+0000c8a0: 2020 2020 2a20 2d20 4e6f 2063 6f6e 7665      * - No conve
+0000c8b0: 7273 696f 6e20 6973 206e 6563 6573 7361  rsion is necessa
+0000c8c0: 7279 2028 692e 652e 2064 6f6d 6169 6e20  ry (i.e. domain 
+0000c8d0: 6e61 6d65 2069 7320 6e6f 7420 616e 2049  name is not an I
+0000c8e0: 444e 2c20 6f72 2069 7320 616c 7265 6164  DN, or is alread
+0000c8f0: 7920 696e 2041 5343 4949 2066 6f72 6d29  y in ASCII form)
+0000c900: 0a20 2020 2020 2a20 2d20 436f 6e76 6572  .     * - Conver
+0000c910: 7369 6f6e 2074 6f20 7075 6e79 636f 6465  sion to punycode
+0000c920: 2069 7320 696d 706f 7373 6962 6c65 2028   is impossible (
+0000c930: 652e 672e 2072 6571 7569 7265 6420 5048  e.g. required PH
+0000c940: 5020 6675 6e63 7469 6f6e 7320 6172 6520  P functions are 
+0000c950: 6e6f 7420 6176 6169 6c61 626c 6529 0a20  not available). 
+0000c960: 2020 2020 2a20 2020 6f72 2066 6169 6c73      *   or fails
+0000c970: 2066 6f72 2061 6e79 2072 6561 736f 6e20   for any reason 
+0000c980: 2865 2e67 2e20 646f 6d61 696e 2063 6f6e  (e.g. domain con
+0000c990: 7461 696e 7320 6368 6172 6163 7465 7273  tains characters
+0000c9a0: 206e 6f74 2061 6c6c 6f77 6564 2069 6e20   not allowed in 
+0000c9b0: 616e 2049 444e 292e 0a20 2020 2020 2a0a  an IDN)..     *.
+0000c9c0: 2020 2020 202a 2040 7365 6520 5048 504d       * @see PHPM
+0000c9d0: 6169 6c65 723a 3a24 4368 6172 5365 740a  ailer::$CharSet.
+0000c9e0: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
+0000c9f0: 6172 616d 2073 7472 696e 6720 2461 6464  aram string $add
+0000ca00: 7265 7373 2054 6865 2065 6d61 696c 2061  ress The email a
+0000ca10: 6464 7265 7373 2074 6f20 636f 6e76 6572  ddress to conver
+0000ca20: 740a 2020 2020 202a 0a20 2020 2020 2a20  t.     *.     * 
+0000ca30: 4072 6574 7572 6e20 7374 7269 6e67 2054  @return string T
+0000ca40: 6865 2065 6e63 6f64 6564 2061 6464 7265  he encoded addre
+0000ca50: 7373 2069 6e20 4153 4349 4920 666f 726d  ss in ASCII form
+0000ca60: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+0000ca70: 6c69 6320 6675 6e63 7469 6f6e 2070 756e  lic function pun
+0000ca80: 7965 6e63 6f64 6541 6464 7265 7373 2824  yencodeAddress($
+0000ca90: 6164 6472 6573 7329 0a20 2020 207b 0a20  address).    {. 
+0000caa0: 2020 2020 2020 202f 2f56 6572 6966 7920         //Verify 
+0000cab0: 7765 2068 6176 6520 7265 7175 6972 6564  we have required
+0000cac0: 2066 756e 6374 696f 6e73 2c20 4368 6172   functions, Char
+0000cad0: 5365 742c 2061 6e64 2061 742d 7369 676e  Set, and at-sign
+0000cae0: 2e0a 2020 2020 2020 2020 2470 6f73 203d  ..        $pos =
+0000caf0: 2073 7472 7270 6f73 2824 6164 6472 6573   strrpos($addres
+0000cb00: 732c 2027 4027 293b 0a20 2020 2020 2020  s, '@');.       
+0000cb10: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+0000cb20: 2020 2165 6d70 7479 2824 7468 6973 2d3e    !empty($this->
+0000cb30: 4368 6172 5365 7429 2026 260a 2020 2020  CharSet) &&.    
+0000cb40: 2020 2020 2020 2020 6661 6c73 6520 213d          false !=
+0000cb50: 3d20 2470 6f73 2026 260a 2020 2020 2020  = $pos &&.      
+0000cb60: 2020 2020 2020 7374 6174 6963 3a3a 6964        static::id
+0000cb70: 6e53 7570 706f 7274 6564 2829 0a20 2020  nSupported().   
+0000cb80: 2020 2020 2029 207b 0a20 2020 2020 2020       ) {.       
+0000cb90: 2020 2020 2024 646f 6d61 696e 203d 2073       $domain = s
+0000cba0: 7562 7374 7228 2461 6464 7265 7373 2c20  ubstr($address, 
+0000cbb0: 2b2b 2470 6f73 293b 0a20 2020 2020 2020  ++$pos);.       
+0000cbc0: 2020 2020 202f 2f56 6572 6966 7920 4368       //Verify Ch
+0000cbd0: 6172 5365 7420 7374 7269 6e67 2069 7320  arSet string is 
+0000cbe0: 6120 7661 6c69 6420 6f6e 652c 2061 6e64  a valid one, and
+0000cbf0: 2064 6f6d 6169 6e20 7072 6f70 6572 6c79   domain properly
+0000cc00: 2065 6e63 6f64 6564 2069 6e20 7468 6973   encoded in this
+0000cc10: 2043 6861 7253 6574 2e0a 2020 2020 2020   CharSet..      
+0000cc20: 2020 2020 2020 6966 2028 2474 6869 732d        if ($this-
+0000cc30: 3e68 6173 3862 6974 4368 6172 7328 2464  >has8bitChars($d
+0000cc40: 6f6d 6169 6e29 2026 2620 406d 625f 6368  omain) && @mb_ch
+0000cc50: 6563 6b5f 656e 636f 6469 6e67 2824 646f  eck_encoding($do
+0000cc60: 6d61 696e 2c20 2474 6869 732d 3e43 6861  main, $this->Cha
+0000cc70: 7253 6574 2929 207b 0a20 2020 2020 2020  rSet)) {.       
+0000cc80: 2020 2020 2020 2020 202f 2f43 6f6e 7665           //Conve
+0000cc90: 7274 2074 6865 2064 6f6d 6169 6e20 6672  rt the domain fr
+0000cca0: 6f6d 2077 6861 7465 7665 7220 6368 6172  om whatever char
+0000ccb0: 7365 7420 6974 2773 2069 6e20 746f 2055  set it's in to U
+0000ccc0: 5446 2d38 0a20 2020 2020 2020 2020 2020  TF-8.           
+0000ccd0: 2020 2020 2024 646f 6d61 696e 203d 206d       $domain = m
+0000cce0: 625f 636f 6e76 6572 745f 656e 636f 6469  b_convert_encodi
+0000ccf0: 6e67 2824 646f 6d61 696e 2c20 7365 6c66  ng($domain, self
+0000cd00: 3a3a 4348 4152 5345 545f 5554 4638 2c20  ::CHARSET_UTF8, 
+0000cd10: 2474 6869 732d 3e43 6861 7253 6574 293b  $this->CharSet);
+0000cd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cd30: 202f 2f49 676e 6f72 6520 4944 4520 636f   //Ignore IDE co
+0000cd40: 6d70 6c61 696e 7473 2061 626f 7574 2074  mplaints about t
+0000cd50: 6869 7320 6c69 6e65 202d 206d 6574 686f  his line - metho
+0000cd60: 6420 7369 676e 6174 7572 6520 6368 616e  d signature chan
+0000cd70: 6765 6420 696e 2050 4850 2035 2e34 0a20  ged in PHP 5.4. 
+0000cd80: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0000cd90: 6572 726f 7263 6f64 6520 3d20 303b 0a20  errorcode = 0;. 
+0000cda0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cdb0: 6620 2864 6566 696e 6564 2827 494e 544c  f (defined('INTL
+0000cdc0: 5f49 444e 415f 5641 5249 414e 545f 5554  _IDNA_VARIANT_UT
+0000cdd0: 5334 3627 2929 207b 0a20 2020 2020 2020  S46')) {.       
+0000cde0: 2020 2020 2020 2020 2020 2020 202f 2f55               //U
+0000cdf0: 7365 2074 6865 2063 7572 7265 6e74 2070  se the current p
+0000ce00: 756e 7963 6f64 6520 7374 616e 6461 7264  unycode standard
+0000ce10: 2028 6170 7065 6172 6564 2069 6e20 5048   (appeared in PH
+0000ce20: 5020 372e 3229 0a20 2020 2020 2020 2020  P 7.2).         
+0000ce30: 2020 2020 2020 2020 2020 2024 7075 6e79             $puny
+0000ce40: 636f 6465 203d 2069 646e 5f74 6f5f 6173  code = idn_to_as
+0000ce50: 6369 6928 0a20 2020 2020 2020 2020 2020  cii(.           
+0000ce60: 2020 2020 2020 2020 2020 2020 2024 646f               $do
+0000ce70: 6d61 696e 2c0a 2020 2020 2020 2020 2020  main,.          
+0000ce80: 2020 2020 2020 2020 2020 2020 2020 5c49                \I
+0000ce90: 444e 415f 4445 4641 554c 5420 7c20 5c49  DNA_DEFAULT | \I
+0000cea0: 444e 415f 5553 455f 5354 4433 5f52 554c  DNA_USE_STD3_RUL
+0000ceb0: 4553 207c 205c 4944 4e41 5f43 4845 434b  ES | \IDNA_CHECK
+0000cec0: 5f42 4944 4920 7c0a 2020 2020 2020 2020  _BIDI |.        
+0000ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cee0: 2020 2020 5c49 444e 415f 4348 4543 4b5f      \IDNA_CHECK_
+0000cef0: 434f 4e54 4558 544a 207c 205c 4944 4e41  CONTEXTJ | \IDNA
+0000cf00: 5f4e 4f4e 5452 414e 5349 5449 4f4e 414c  _NONTRANSITIONAL
+0000cf10: 5f54 4f5f 4153 4349 492c 0a20 2020 2020  _TO_ASCII,.     
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf30: 2020 205c 494e 544c 5f49 444e 415f 5641     \INTL_IDNA_VA
+0000cf40: 5249 414e 545f 5554 5334 360a 2020 2020  RIANT_UTS46.    
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf60: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0000cf70: 2020 207d 2065 6c73 6569 6620 2864 6566     } elseif (def
+0000cf80: 696e 6564 2827 494e 544c 5f49 444e 415f  ined('INTL_IDNA_
+0000cf90: 5641 5249 414e 545f 3230 3033 2729 2920  VARIANT_2003')) 
+0000cfa0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0000cfb0: 2020 2020 2020 2f2f 4661 6c6c 2062 6163        //Fall bac
+0000cfc0: 6b20 746f 2074 6869 7320 6f6c 642c 2064  k to this old, d
+0000cfd0: 6570 7265 6361 7465 642f 7265 6d6f 7665  eprecated/remove
+0000cfe0: 6420 656e 636f 6469 6e67 0a20 2020 2020  d encoding.     
+0000cff0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0000d000: 7075 6e79 636f 6465 203d 2069 646e 5f74  punycode = idn_t
+0000d010: 6f5f 6173 6369 6928 2464 6f6d 6169 6e2c  o_ascii($domain,
+0000d020: 2024 6572 726f 7263 6f64 652c 205c 494e   $errorcode, \IN
+0000d030: 544c 5f49 444e 415f 5641 5249 414e 545f  TL_IDNA_VARIANT_
+0000d040: 3230 3033 293b 0a20 2020 2020 2020 2020  2003);.         
+0000d050: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
+0000d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d070: 2020 2020 2f2f 4661 6c6c 2062 6163 6b20      //Fall back 
+0000d080: 746f 2061 2064 6566 6175 6c74 2077 6520  to a default we 
+0000d090: 646f 6e27 7420 6b6e 6f77 2061 626f 7574  don't know about
+0000d0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d0b0: 2020 2020 2024 7075 6e79 636f 6465 203d       $punycode =
+0000d0c0: 2069 646e 5f74 6f5f 6173 6369 6928 2464   idn_to_ascii($d
+0000d0d0: 6f6d 6169 6e2c 2024 6572 726f 7263 6f64  omain, $errorcod
+0000d0e0: 6529 3b0a 2020 2020 2020 2020 2020 2020  e);.            
+0000d0f0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+0000d100: 2020 2020 2020 6966 2028 6661 6c73 6520        if (false 
+0000d110: 213d 3d20 2470 756e 7963 6f64 6529 207b  !== $punycode) {
+0000d120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d130: 2020 2020 2072 6574 7572 6e20 7375 6273       return subs
+0000d140: 7472 2824 6164 6472 6573 732c 2030 2c20  tr($address, 0, 
+0000d150: 2470 6f73 2920 2e20 2470 756e 7963 6f64  $pos) . $punycod
+0000d160: 653b 0a20 2020 2020 2020 2020 2020 2020  e;.             
+0000d170: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+0000d180: 207d 0a20 2020 2020 2020 207d 0a0a 2020   }.        }..  
+0000d190: 2020 2020 2020 7265 7475 726e 2024 6164        return $ad
+0000d1a0: 6472 6573 733b 0a20 2020 207d 0a0a 2020  dress;.    }..  
+0000d1b0: 2020 2f2a 2a0a 2020 2020 202a 2043 7265    /**.     * Cre
+0000d1c0: 6174 6520 6120 6d65 7373 6167 6520 616e  ate a message an
+0000d1d0: 6420 7365 6e64 2069 742e 0a20 2020 2020  d send it..     
+0000d1e0: 2a20 5573 6573 2074 6865 2073 656e 6469  * Uses the sendi
+0000d1f0: 6e67 206d 6574 686f 6420 7370 6563 6966  ng method specif
+0000d200: 6965 6420 6279 2024 4d61 696c 6572 2e0a  ied by $Mailer..
+0000d210: 2020 2020 202a 0a20 2020 2020 2a20 4074       *.     * @t
+0000d220: 6872 6f77 7320 4578 6365 7074 696f 6e0a  hrows Exception.
+0000d230: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
+0000d240: 6574 7572 6e20 626f 6f6c 2066 616c 7365  eturn bool false
+0000d250: 206f 6e20 6572 726f 7220 2d20 5365 6520   on error - See 
+0000d260: 7468 6520 4572 726f 7249 6e66 6f20 7072  the ErrorInfo pr
+0000d270: 6f70 6572 7479 2066 6f72 2064 6574 6169  operty for detai
+0000d280: 6c73 206f 6620 7468 6520 6572 726f 720a  ls of the error.
+0000d290: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+0000d2a0: 6963 2066 756e 6374 696f 6e20 7365 6e64  ic function send
+0000d2b0: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
+0000d2c0: 2074 7279 207b 0a20 2020 2020 2020 2020   try {.         
+0000d2d0: 2020 2069 6620 2821 2474 6869 732d 3e70     if (!$this->p
+0000d2e0: 7265 5365 6e64 2829 2920 7b0a 2020 2020  reSend()) {.    
+0000d2f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d300: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
+0000d310: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0000d320: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
+0000d330: 732d 3e70 6f73 7453 656e 6428 293b 0a20  s->postSend();. 
+0000d340: 2020 2020 2020 207d 2063 6174 6368 2028         } catch (
+0000d350: 4578 6365 7074 696f 6e20 2465 7863 2920  Exception $exc) 
+0000d360: 7b0a 2020 2020 2020 2020 2020 2020 2474  {.            $t
+0000d370: 6869 732d 3e6d 6169 6c48 6561 6465 7220  his->mailHeader 
+0000d380: 3d20 2727 3b0a 2020 2020 2020 2020 2020  = '';.          
+0000d390: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
+0000d3a0: 7228 2465 7863 2d3e 6765 744d 6573 7361  r($exc->getMessa
+0000d3b0: 6765 2829 293b 0a20 2020 2020 2020 2020  ge());.         
+0000d3c0: 2020 2069 6620 2824 7468 6973 2d3e 6578     if ($this->ex
+0000d3d0: 6365 7074 696f 6e73 2920 7b0a 2020 2020  ceptions) {.    
+0000d3e0: 2020 2020 2020 2020 2020 2020 7468 726f              thro
+0000d3f0: 7720 2465 7863 3b0a 2020 2020 2020 2020  w $exc;.        
+0000d400: 2020 2020 7d0a 0a20 2020 2020 2020 2020      }..         
+0000d410: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
+0000d420: 0a20 2020 2020 2020 207d 0a20 2020 207d  .        }.    }
+0000d430: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+0000d440: 2050 7265 7061 7265 2061 206d 6573 7361   Prepare a messa
+0000d450: 6765 2066 6f72 2073 656e 6469 6e67 2e0a  ge for sending..
+0000d460: 2020 2020 202a 0a20 2020 2020 2a20 4074       *.     * @t
+0000d470: 6872 6f77 7320 4578 6365 7074 696f 6e0a  hrows Exception.
+0000d480: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
+0000d490: 6574 7572 6e20 626f 6f6c 0a20 2020 2020  eturn bool.     
+0000d4a0: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+0000d4b0: 6e63 7469 6f6e 2070 7265 5365 6e64 2829  nction preSend()
+0000d4c0: 0a20 2020 207b 0a20 2020 2020 2020 2069  .    {.        i
+0000d4d0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0000d4e0: 2773 6d74 7027 203d 3d3d 2024 7468 6973  'smtp' === $this
+0000d4f0: 2d3e 4d61 696c 6572 0a20 2020 2020 2020  ->Mailer.       
+0000d500: 2020 2020 207c 7c20 2827 6d61 696c 2720       || ('mail' 
+0000d510: 3d3d 3d20 2474 6869 732d 3e4d 6169 6c65  === $this->Maile
+0000d520: 7220 2626 2028 5c50 4850 5f56 4552 5349  r && (\PHP_VERSI
+0000d530: 4f4e 5f49 4420 3e3d 2038 3030 3030 207c  ON_ID >= 80000 |
+0000d540: 7c20 7374 7269 706f 7328 5048 505f 4f53  | stripos(PHP_OS
+0000d550: 2c20 2757 494e 2729 203d 3d3d 2030 2929  , 'WIN') === 0))
+0000d560: 0a20 2020 2020 2020 2029 207b 0a20 2020  .        ) {.   
+0000d570: 2020 2020 2020 2020 202f 2f53 4d54 5020           //SMTP 
+0000d580: 6d61 6e64 6174 6573 2052 4643 2d63 6f6d  mandates RFC-com
+0000d590: 706c 6961 6e74 206c 696e 6520 656e 6469  pliant line endi
+0000d5a0: 6e67 730a 2020 2020 2020 2020 2020 2020  ngs.            
+0000d5b0: 2f2f 616e 6420 6974 2773 2061 6c73 6f20  //and it's also 
+0000d5c0: 7573 6564 2077 6974 6820 6d61 696c 2829  used with mail()
+0000d5d0: 206f 6e20 5769 6e64 6f77 730a 2020 2020   on Windows.    
+0000d5e0: 2020 2020 2020 2020 7374 6174 6963 3a3a          static::
+0000d5f0: 7365 744c 4528 7365 6c66 3a3a 4352 4c46  setLE(self::CRLF
+0000d600: 293b 0a20 2020 2020 2020 207d 2065 6c73  );.        } els
+0000d610: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+0000d620: 2f2f 4d61 696e 7461 696e 2062 6163 6b77  //Maintain backw
+0000d630: 6172 6420 636f 6d70 6174 6962 696c 6974  ard compatibilit
+0000d640: 7920 7769 7468 206c 6567 6163 7920 4c69  y with legacy Li
+0000d650: 6e75 7820 636f 6d6d 616e 6420 6c69 6e65  nux command line
+0000d660: 206d 6169 6c65 7273 0a20 2020 2020 2020   mailers.       
+0000d670: 2020 2020 2073 7461 7469 633a 3a73 6574       static::set
+0000d680: 4c45 2850 4850 5f45 4f4c 293b 0a20 2020  LE(PHP_EOL);.   
+0000d690: 2020 2020 207d 0a20 2020 2020 2020 202f       }.        /
+0000d6a0: 2f43 6865 636b 2066 6f72 2062 7567 6779  /Check for buggy
+0000d6b0: 2050 4850 2076 6572 7369 6f6e 7320 7468   PHP versions th
+0000d6c0: 6174 2061 6464 2061 2068 6561 6465 7220  at add a header 
+0000d6d0: 7769 7468 2061 6e20 696e 636f 7272 6563  with an incorrec
+0000d6e0: 7420 6c69 6e65 2062 7265 616b 0a20 2020  t line break.   
+0000d6f0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+0000d700: 2020 2020 2020 276d 6169 6c27 203d 3d3d        'mail' ===
+0000d710: 2024 7468 6973 2d3e 4d61 696c 6572 0a20   $this->Mailer. 
+0000d720: 2020 2020 2020 2020 2020 2026 2620 2828             && ((
+0000d730: 5c50 4850 5f56 4552 5349 4f4e 5f49 4420  \PHP_VERSION_ID 
+0000d740: 3e3d 2037 3030 3030 2026 2620 5c50 4850  >= 70000 && \PHP
+0000d750: 5f56 4552 5349 4f4e 5f49 4420 3c20 3730  _VERSION_ID < 70
+0000d760: 3031 3729 0a20 2020 2020 2020 2020 2020  017).           
+0000d770: 2020 2020 207c 7c20 285c 5048 505f 5645       || (\PHP_VE
+0000d780: 5253 494f 4e5f 4944 203e 3d20 3730 3130  RSION_ID >= 7010
+0000d790: 3020 2626 205c 5048 505f 5645 5253 494f  0 && \PHP_VERSIO
+0000d7a0: 4e5f 4944 203c 2037 3031 3033 2929 0a20  N_ID < 70103)). 
+0000d7b0: 2020 2020 2020 2020 2020 2026 2620 696e             && in
+0000d7c0: 695f 6765 7428 276d 6169 6c2e 6164 645f  i_get('mail.add_
+0000d7d0: 785f 6865 6164 6572 2729 203d 3d3d 2027  x_header') === '
+0000d7e0: 3127 0a20 2020 2020 2020 2020 2020 2026  1'.            &
+0000d7f0: 2620 7374 7269 706f 7328 5048 505f 4f53  & stripos(PHP_OS
+0000d800: 2c20 2757 494e 2729 203d 3d3d 2030 0a20  , 'WIN') === 0. 
+0000d810: 2020 2020 2020 2029 207b 0a20 2020 2020         ) {.     
+0000d820: 2020 2020 2020 2074 7269 6767 6572 5f65         trigger_e
+0000d830: 7272 6f72 2824 7468 6973 2d3e 6c61 6e67  rror($this->lang
+0000d840: 2827 6275 6767 795f 7068 7027 292c 2045  ('buggy_php'), E
+0000d850: 5f55 5345 525f 5741 524e 494e 4729 3b0a  _USER_WARNING);.
+0000d860: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+0000d870: 2020 2074 7279 207b 0a20 2020 2020 2020     try {.       
+0000d880: 2020 2020 2024 7468 6973 2d3e 6572 726f       $this->erro
+0000d890: 725f 636f 756e 7420 3d20 303b 202f 2f52  r_count = 0; //R
+0000d8a0: 6573 6574 2065 7272 6f72 730a 2020 2020  eset errors.    
+0000d8b0: 2020 2020 2020 2020 2474 6869 732d 3e6d          $this->m
+0000d8c0: 6169 6c48 6561 6465 7220 3d20 2727 3b0a  ailHeader = '';.
+0000d8d0: 0a20 2020 2020 2020 2020 2020 202f 2f44  .            //D
+0000d8e0: 6571 7565 7565 2072 6563 6970 6965 6e74  equeue recipient
+0000d8f0: 2061 6e64 2052 6570 6c79 2d54 6f20 6164   and Reply-To ad
+0000d900: 6472 6573 7365 7320 7769 7468 2049 444e  dresses with IDN
+0000d910: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000d920: 6561 6368 2028 6172 7261 795f 6d65 7267  each (array_merg
+0000d930: 6528 2474 6869 732d 3e52 6563 6970 6965  e($this->Recipie
+0000d940: 6e74 7351 7565 7565 2c20 2474 6869 732d  ntsQueue, $this-
+0000d950: 3e52 6570 6c79 546f 5175 6575 6529 2061  >ReplyToQueue) a
+0000d960: 7320 2470 6172 616d 7329 207b 0a20 2020  s $params) {.   
+0000d970: 2020 2020 2020 2020 2020 2020 2024 7061               $pa
+0000d980: 7261 6d73 5b31 5d20 3d20 2474 6869 732d  rams[1] = $this-
+0000d990: 3e70 756e 7965 6e63 6f64 6541 6464 7265  >punyencodeAddre
+0000d9a0: 7373 2824 7061 7261 6d73 5b31 5d29 3b0a  ss($params[1]);.
+0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9c0: 6361 6c6c 5f75 7365 725f 6675 6e63 5f61  call_user_func_a
+0000d9d0: 7272 6179 285b 2474 6869 732c 2027 6164  rray([$this, 'ad
+0000d9e0: 6441 6e41 6464 7265 7373 275d 2c20 2470  dAnAddress'], $p
+0000d9f0: 6172 616d 7329 3b0a 2020 2020 2020 2020  arams);.        
+0000da00: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+0000da10: 2020 6966 2028 636f 756e 7428 2474 6869    if (count($thi
+0000da20: 732d 3e74 6f29 202b 2063 6f75 6e74 2824  s->to) + count($
+0000da30: 7468 6973 2d3e 6363 2920 2b20 636f 756e  this->cc) + coun
+0000da40: 7428 2474 6869 732d 3e62 6363 2920 3c20  t($this->bcc) < 
+0000da50: 3129 207b 0a20 2020 2020 2020 2020 2020  1) {.           
+0000da60: 2020 2020 2074 6872 6f77 206e 6577 2045       throw new E
+0000da70: 7863 6570 7469 6f6e 2824 7468 6973 2d3e  xception($this->
+0000da80: 6c61 6e67 2827 7072 6f76 6964 655f 6164  lang('provide_ad
+0000da90: 6472 6573 7327 292c 2073 656c 663a 3a53  dress'), self::S
+0000daa0: 544f 505f 4352 4954 4943 414c 293b 0a20  TOP_CRITICAL);. 
+0000dab0: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
+0000dac0: 2020 2020 2020 2020 2020 2f2f 5661 6c69            //Vali
+0000dad0: 6461 7465 2046 726f 6d2c 2053 656e 6465  date From, Sende
+0000dae0: 722c 2061 6e64 2043 6f6e 6669 726d 5265  r, and ConfirmRe
+0000daf0: 6164 696e 6754 6f20 6164 6472 6573 7365  adingTo addresse
+0000db00: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
+0000db10: 7265 6163 6820 285b 2746 726f 6d27 2c20  reach (['From', 
+0000db20: 2753 656e 6465 7227 2c20 2743 6f6e 6669  'Sender', 'Confi
+0000db30: 726d 5265 6164 696e 6754 6f27 5d20 6173  rmReadingTo'] as
+0000db40: 2024 6164 6472 6573 735f 6b69 6e64 2920   $address_kind) 
+0000db50: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0000db60: 2020 6966 2028 2474 6869 732d 3e7b 2461    if ($this->{$a
+0000db70: 6464 7265 7373 5f6b 696e 647d 203d 3d3d  ddress_kind} ===
+0000db80: 206e 756c 6c29 207b 0a20 2020 2020 2020   null) {.       
+0000db90: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+0000dba0: 6973 2d3e 7b24 6164 6472 6573 735f 6b69  is->{$address_ki
+0000dbb0: 6e64 7d20 3d20 2727 3b0a 2020 2020 2020  nd} = '';.      
+0000dbc0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000dbd0: 6e74 696e 7565 3b0a 2020 2020 2020 2020  ntinue;.        
+0000dbe0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0000dbf0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+0000dc00: 3e7b 2461 6464 7265 7373 5f6b 696e 647d  >{$address_kind}
+0000dc10: 203d 2074 7269 6d28 2474 6869 732d 3e7b   = trim($this->{
+0000dc20: 2461 6464 7265 7373 5f6b 696e 647d 293b  $address_kind});
+0000dc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc40: 2069 6620 2865 6d70 7479 2824 7468 6973   if (empty($this
+0000dc50: 2d3e 7b24 6164 6472 6573 735f 6b69 6e64  ->{$address_kind
+0000dc60: 7d29 2920 7b0a 2020 2020 2020 2020 2020  })) {.          
+0000dc70: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0000dc80: 7565 3b0a 2020 2020 2020 2020 2020 2020  ue;.            
+0000dc90: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+0000dca0: 2020 2020 2020 2474 6869 732d 3e7b 2461        $this->{$a
+0000dcb0: 6464 7265 7373 5f6b 696e 647d 203d 2024  ddress_kind} = $
+0000dcc0: 7468 6973 2d3e 7075 6e79 656e 636f 6465  this->punyencode
+0000dcd0: 4164 6472 6573 7328 2474 6869 732d 3e7b  Address($this->{
+0000dce0: 2461 6464 7265 7373 5f6b 696e 647d 293b  $address_kind});
+0000dcf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd00: 2069 6620 2821 7374 6174 6963 3a3a 7661   if (!static::va
+0000dd10: 6c69 6461 7465 4164 6472 6573 7328 2474  lidateAddress($t
+0000dd20: 6869 732d 3e7b 2461 6464 7265 7373 5f6b  his->{$address_k
+0000dd30: 696e 647d 2929 207b 0a20 2020 2020 2020  ind})) {.       
+0000dd40: 2020 2020 2020 2020 2020 2020 2024 6572               $er
+0000dd50: 726f 725f 6d65 7373 6167 6520 3d20 7370  ror_message = sp
+0000dd60: 7269 6e74 6628 0a20 2020 2020 2020 2020  rintf(.         
+0000dd70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000dd80: 2573 2028 2573 293a 2025 7327 2c0a 2020  %s (%s): %s',.  
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dda0: 2020 2020 2020 2474 6869 732d 3e6c 616e        $this->lan
+0000ddb0: 6728 2769 6e76 616c 6964 5f61 6464 7265  g('invalid_addre
+0000ddc0: 7373 2729 2c0a 2020 2020 2020 2020 2020  ss'),.          
+0000ddd0: 2020 2020 2020 2020 2020 2020 2020 2461                $a
+0000dde0: 6464 7265 7373 5f6b 696e 642c 0a20 2020  ddress_kind,.   
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de00: 2020 2020 2024 7468 6973 2d3e 7b24 6164       $this->{$ad
+0000de10: 6472 6573 735f 6b69 6e64 7d0a 2020 2020  dress_kind}.    
+0000de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de30: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0000de40: 2020 2020 2020 2024 7468 6973 2d3e 7365         $this->se
+0000de50: 7445 7272 6f72 2824 6572 726f 725f 6d65  tError($error_me
+0000de60: 7373 6167 6529 3b0a 2020 2020 2020 2020  ssage);.        
+0000de70: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0000de80: 732d 3e65 6465 6275 6728 2465 7272 6f72  s->edebug($error
+0000de90: 5f6d 6573 7361 6765 293b 0a20 2020 2020  _message);.     
+0000dea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000deb0: 6620 2824 7468 6973 2d3e 6578 6365 7074  f ($this->except
+0000dec0: 696f 6e73 2920 7b0a 2020 2020 2020 2020  ions) {.        
+0000ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dee0: 7468 726f 7720 6e65 7720 4578 6365 7074  throw new Except
+0000def0: 696f 6e28 2465 7272 6f72 5f6d 6573 7361  ion($error_messa
+0000df00: 6765 293b 0a20 2020 2020 2020 2020 2020  ge);.           
+0000df10: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+0000df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df30: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
+0000df40: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+0000df50: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
+0000df60: 2020 2020 2020 2020 2020 202f 2f53 6574             //Set
+0000df70: 2077 6865 7468 6572 2074 6865 206d 6573   whether the mes
+0000df80: 7361 6765 2069 7320 6d75 6c74 6970 6172  sage is multipar
+0000df90: 742f 616c 7465 726e 6174 6976 650a 2020  t/alternative.  
+0000dfa0: 2020 2020 2020 2020 2020 6966 2028 2474            if ($t
+0000dfb0: 6869 732d 3e61 6c74 6572 6e61 7469 7665  his->alternative
+0000dfc0: 4578 6973 7473 2829 2920 7b0a 2020 2020  Exists()) {.    
+0000dfd0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0000dfe0: 732d 3e43 6f6e 7465 6e74 5479 7065 203d  s->ContentType =
+0000dff0: 2073 7461 7469 633a 3a43 4f4e 5445 4e54   static::CONTENT
+0000e000: 5f54 5950 455f 4d55 4c54 4950 4152 545f  _TYPE_MULTIPART_
+0000e010: 414c 5445 524e 4154 4956 453b 0a20 2020  ALTERNATIVE;.   
+0000e020: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+0000e030: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
+0000e040: 6574 4d65 7373 6167 6554 7970 6528 293b  etMessageType();
+0000e050: 0a20 2020 2020 2020 2020 2020 202f 2f52  .            //R
+0000e060: 6566 7573 6520 746f 2073 656e 6420 616e  efuse to send an
+0000e070: 2065 6d70 7479 206d 6573 7361 6765 2075   empty message u
+0000e080: 6e6c 6573 7320 7765 2061 7265 2073 7065  nless we are spe
+0000e090: 6369 6669 6361 6c6c 7920 616c 6c6f 7769  cifically allowi
+0000e0a0: 6e67 2069 740a 2020 2020 2020 2020 2020  ng it.          
+0000e0b0: 2020 6966 2028 2124 7468 6973 2d3e 416c    if (!$this->Al
+0000e0c0: 6c6f 7745 6d70 7479 2026 2620 656d 7074  lowEmpty && empt
+0000e0d0: 7928 2474 6869 732d 3e42 6f64 7929 2920  y($this->Body)) 
+0000e0e0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0000e0f0: 2020 7468 726f 7720 6e65 7720 4578 6365    throw new Exce
+0000e100: 7074 696f 6e28 2474 6869 732d 3e6c 616e  ption($this->lan
+0000e110: 6728 2765 6d70 7479 5f6d 6573 7361 6765  g('empty_message
+0000e120: 2729 2c20 7365 6c66 3a3a 5354 4f50 5f43  '), self::STOP_C
+0000e130: 5249 5449 4341 4c29 3b0a 2020 2020 2020  RITICAL);.      
+0000e140: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0000e150: 2020 2020 202f 2f54 7269 6d20 7375 626a       //Trim subj
+0000e160: 6563 7420 636f 6e73 6973 7465 6e74 6c79  ect consistently
+0000e170: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
+0000e180: 6973 2d3e 5375 626a 6563 7420 3d20 7472  is->Subject = tr
+0000e190: 696d 2824 7468 6973 2d3e 5375 626a 6563  im($this->Subjec
+0000e1a0: 7429 3b0a 2020 2020 2020 2020 2020 2020  t);.            
+0000e1b0: 2f2f 4372 6561 7465 2062 6f64 7920 6265  //Create body be
+0000e1c0: 666f 7265 2068 6561 6465 7273 2069 6e20  fore headers in 
+0000e1d0: 6361 7365 2062 6f64 7920 6d61 6b65 7320  case body makes 
+0000e1e0: 6368 616e 6765 7320 746f 2068 6561 6465  changes to heade
+0000e1f0: 7273 2028 652e 672e 2061 6c74 6572 696e  rs (e.g. alterin
+0000e200: 6720 7472 616e 7366 6572 2065 6e63 6f64  g transfer encod
+0000e210: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
+0000e220: 2024 7468 6973 2d3e 4d49 4d45 4865 6164   $this->MIMEHead
+0000e230: 6572 203d 2027 273b 0a20 2020 2020 2020  er = '';.       
+0000e240: 2020 2020 2024 7468 6973 2d3e 4d49 4d45       $this->MIME
+0000e250: 426f 6479 203d 2024 7468 6973 2d3e 6372  Body = $this->cr
+0000e260: 6561 7465 426f 6479 2829 3b0a 2020 2020  eateBody();.    
+0000e270: 2020 2020 2020 2020 2f2f 6372 6561 7465          //create
+0000e280: 426f 6479 206d 6179 2068 6176 6520 6164  Body may have ad
+0000e290: 6465 6420 736f 6d65 2068 6561 6465 7273  ded some headers
+0000e2a0: 2c20 736f 2072 6574 6169 6e20 7468 656d  , so retain them
+0000e2b0: 0a20 2020 2020 2020 2020 2020 2024 7465  .            $te
+0000e2c0: 6d70 6865 6164 6572 7320 3d20 2474 6869  mpheaders = $thi
+0000e2d0: 732d 3e4d 494d 4548 6561 6465 723b 0a20  s->MIMEHeader;. 
+0000e2e0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+0000e2f0: 2d3e 4d49 4d45 4865 6164 6572 203d 2024  ->MIMEHeader = $
+0000e300: 7468 6973 2d3e 6372 6561 7465 4865 6164  this->createHead
+0000e310: 6572 2829 3b0a 2020 2020 2020 2020 2020  er();.          
+0000e320: 2020 2474 6869 732d 3e4d 494d 4548 6561    $this->MIMEHea
+0000e330: 6465 7220 2e3d 2024 7465 6d70 6865 6164  der .= $temphead
+0000e340: 6572 733b 0a0a 2020 2020 2020 2020 2020  ers;..          
+0000e350: 2020 2f2f 546f 2063 6170 7475 7265 2074    //To capture t
+0000e360: 6865 2063 6f6d 706c 6574 6520 6d65 7373  he complete mess
+0000e370: 6167 6520 7768 656e 2075 7369 6e67 206d  age when using m
+0000e380: 6169 6c28 292c 2063 7265 6174 650a 2020  ail(), create.  
+0000e390: 2020 2020 2020 2020 2020 2f2f 616e 2065            //an e
+0000e3a0: 7874 7261 2068 6561 6465 7220 6c69 7374  xtra header list
+0000e3b0: 2077 6869 6368 2063 7265 6174 6548 6561   which createHea
+0000e3c0: 6465 7228 2920 646f 6573 6e27 7420 666f  der() doesn't fo
+0000e3d0: 6c64 2069 6e0a 2020 2020 2020 2020 2020  ld in.          
+0000e3e0: 2020 6966 2028 276d 6169 6c27 203d 3d3d    if ('mail' ===
+0000e3f0: 2024 7468 6973 2d3e 4d61 696c 6572 2920   $this->Mailer) 
+0000e400: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0000e410: 2020 6966 2028 636f 756e 7428 2474 6869    if (count($thi
+0000e420: 732d 3e74 6f29 203e 2030 2920 7b0a 2020  s->to) > 0) {.  
+0000e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e440: 2020 2474 6869 732d 3e6d 6169 6c48 6561    $this->mailHea
+0000e450: 6465 7220 2e3d 2024 7468 6973 2d3e 6164  der .= $this->ad
+0000e460: 6472 4170 7065 6e64 2827 546f 272c 2024  drAppend('To', $
+0000e470: 7468 6973 2d3e 746f 293b 0a20 2020 2020  this->to);.     
+0000e480: 2020 2020 2020 2020 2020 207d 2065 6c73             } els
+0000e490: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+0000e4a0: 2020 2020 2020 2020 2474 6869 732d 3e6d          $this->m
+0000e4b0: 6169 6c48 6561 6465 7220 2e3d 2024 7468  ailHeader .= $th
+0000e4c0: 6973 2d3e 6865 6164 6572 4c69 6e65 2827  is->headerLine('
+0000e4d0: 546f 272c 2027 756e 6469 7363 6c6f 7365  To', 'undisclose
+0000e4e0: 642d 7265 6369 7069 656e 7473 3a3b 2729  d-recipients:;')
+0000e4f0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0000e500: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+0000e510: 2020 2020 2474 6869 732d 3e6d 6169 6c48      $this->mailH
+0000e520: 6561 6465 7220 2e3d 2024 7468 6973 2d3e  eader .= $this->
+0000e530: 6865 6164 6572 4c69 6e65 280a 2020 2020  headerLine(.    
+0000e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e550: 2753 7562 6a65 6374 272c 0a20 2020 2020  'Subject',.     
+0000e560: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0000e570: 7468 6973 2d3e 656e 636f 6465 4865 6164  this->encodeHead
+0000e580: 6572 2824 7468 6973 2d3e 7365 6375 7265  er($this->secure
+0000e590: 4865 6164 6572 2824 7468 6973 2d3e 5375  Header($this->Su
+0000e5a0: 626a 6563 7429 290a 2020 2020 2020 2020  bject)).        
+0000e5b0: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
+0000e5c0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0000e5d0: 2020 2020 2020 2f2f 5369 676e 2077 6974        //Sign wit
+0000e5e0: 6820 444b 494d 2069 6620 656e 6162 6c65  h DKIM if enable
+0000e5f0: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+0000e600: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000e610: 2020 2021 656d 7074 7928 2474 6869 732d     !empty($this-
+0000e620: 3e44 4b49 4d5f 646f 6d61 696e 290a 2020  >DKIM_domain).  
+0000e630: 2020 2020 2020 2020 2020 2020 2020 2626                &&
+0000e640: 2021 656d 7074 7928 2474 6869 732d 3e44   !empty($this->D
+0000e650: 4b49 4d5f 7365 6c65 6374 6f72 290a 2020  KIM_selector).  
+0000e660: 2020 2020 2020 2020 2020 2020 2020 2626                &&
+0000e670: 2028 2165 6d70 7479 2824 7468 6973 2d3e   (!empty($this->
+0000e680: 444b 494d 5f70 7269 7661 7465 5f73 7472  DKIM_private_str
+0000e690: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
+0000e6a0: 2020 2020 2020 2020 207c 7c20 2821 656d           || (!em
+0000e6b0: 7074 7928 2474 6869 732d 3e44 4b49 4d5f  pty($this->DKIM_
+0000e6c0: 7072 6976 6174 6529 0a20 2020 2020 2020  private).       
+0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6e0: 2026 2620 7374 6174 6963 3a3a 6973 5065   && static::isPe
+0000e6f0: 726d 6974 7465 6450 6174 6828 2474 6869  rmittedPath($thi
+0000e700: 732d 3e44 4b49 4d5f 7072 6976 6174 6529  s->DKIM_private)
+0000e710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e720: 2020 2020 2020 2020 2026 2620 6669 6c65           && file
+0000e730: 5f65 7869 7374 7328 2474 6869 732d 3e44  _exists($this->D
+0000e740: 4b49 4d5f 7072 6976 6174 6529 0a20 2020  KIM_private).   
+0000e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e760: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000e770: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000e780: 2029 207b 0a20 2020 2020 2020 2020 2020   ) {.           
+0000e790: 2020 2020 2024 6865 6164 6572 5f64 6b69       $header_dki
+0000e7a0: 6d20 3d20 2474 6869 732d 3e44 4b49 4d5f  m = $this->DKIM_
+0000e7b0: 4164 6428 0a20 2020 2020 2020 2020 2020  Add(.           
+0000e7c0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+0000e7d0: 4d49 4d45 4865 6164 6572 202e 2024 7468  MIMEHeader . $th
+0000e7e0: 6973 2d3e 6d61 696c 4865 6164 6572 2c0a  is->mailHeader,.
+0000e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e800: 2020 2020 2474 6869 732d 3e65 6e63 6f64      $this->encod
+0000e810: 6548 6561 6465 7228 2474 6869 732d 3e73  eHeader($this->s
+0000e820: 6563 7572 6548 6561 6465 7228 2474 6869  ecureHeader($thi
+0000e830: 732d 3e53 7562 6a65 6374 2929 2c0a 2020  s->Subject)),.  
+0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e850: 2020 2474 6869 732d 3e4d 494d 4542 6f64    $this->MIMEBod
+0000e860: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0000e870: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
+0000e880: 2020 2020 2024 7468 6973 2d3e 4d49 4d45       $this->MIME
+0000e890: 4865 6164 6572 203d 2073 7461 7469 633a  Header = static:
+0000e8a0: 3a73 7472 6970 5472 6169 6c69 6e67 5753  :stripTrailingWS
+0000e8b0: 5028 2474 6869 732d 3e4d 494d 4548 6561  P($this->MIMEHea
+0000e8c0: 6465 7229 202e 2073 7461 7469 633a 3a24  der) . static::$
+0000e8d0: 4c45 202e 0a20 2020 2020 2020 2020 2020  LE ..           
+0000e8e0: 2020 2020 2020 2020 2073 7461 7469 633a           static:
+0000e8f0: 3a6e 6f72 6d61 6c69 7a65 4272 6561 6b73  :normalizeBreaks
+0000e900: 2824 6865 6164 6572 5f64 6b69 6d29 202e  ($header_dkim) .
+0000e910: 2073 7461 7469 633a 3a24 4c45 3b0a 2020   static::$LE;.  
+0000e920: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+0000e930: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e940: 7472 7565 3b0a 2020 2020 2020 2020 7d20  true;.        } 
+0000e950: 6361 7463 6820 2845 7863 6570 7469 6f6e  catch (Exception
+0000e960: 2024 6578 6329 207b 0a20 2020 2020 2020   $exc) {.       
+0000e970: 2020 2020 2024 7468 6973 2d3e 7365 7445       $this->setE
+0000e980: 7272 6f72 2824 6578 632d 3e67 6574 4d65  rror($exc->getMe
+0000e990: 7373 6167 6528 2929 3b0a 2020 2020 2020  ssage());.      
+0000e9a0: 2020 2020 2020 6966 2028 2474 6869 732d        if ($this-
+0000e9b0: 3e65 7863 6570 7469 6f6e 7329 207b 0a20  >exceptions) {. 
+0000e9c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000e9d0: 6872 6f77 2024 6578 633b 0a20 2020 2020  hrow $exc;.     
+0000e9e0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0000e9f0: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+0000ea00: 7365 3b0a 2020 2020 2020 2020 7d0a 2020  se;.        }.  
+0000ea10: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+0000ea20: 2020 2a20 4163 7475 616c 6c79 2073 656e    * Actually sen
+0000ea30: 6420 6120 6d65 7373 6167 6520 7669 6120  d a message via 
+0000ea40: 7468 6520 7365 6c65 6374 6564 206d 6563  the selected mec
+0000ea50: 6861 6e69 736d 2e0a 2020 2020 202a 0a20  hanism..     *. 
+0000ea60: 2020 2020 2a20 4074 6872 6f77 7320 4578      * @throws Ex
+0000ea70: 6365 7074 696f 6e0a 2020 2020 202a 0a20  ception.     *. 
+0000ea80: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
+0000ea90: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
+0000eaa0: 7562 6c69 6320 6675 6e63 7469 6f6e 2070  ublic function p
+0000eab0: 6f73 7453 656e 6428 290a 2020 2020 7b0a  ostSend().    {.
+0000eac0: 2020 2020 2020 2020 7472 7920 7b0a 2020          try {.  
+0000ead0: 2020 2020 2020 2020 2020 2f2f 4368 6f6f            //Choo
+0000eae0: 7365 2074 6865 206d 6169 6c65 7220 616e  se the mailer an
+0000eaf0: 6420 7365 6e64 2074 6872 6f75 6768 2069  d send through i
+0000eb00: 740a 2020 2020 2020 2020 2020 2020 7377  t.            sw
+0000eb10: 6974 6368 2028 2474 6869 732d 3e4d 6169  itch ($this->Mai
+0000eb20: 6c65 7229 207b 0a20 2020 2020 2020 2020  ler) {.         
+0000eb30: 2020 2020 2020 2063 6173 6520 2773 656e         case 'sen
+0000eb40: 646d 6169 6c27 3a0a 2020 2020 2020 2020  dmail':.        
+0000eb50: 2020 2020 2020 2020 6361 7365 2027 716d          case 'qm
+0000eb60: 6169 6c27 3a0a 2020 2020 2020 2020 2020  ail':.          
+0000eb70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000eb80: 2024 7468 6973 2d3e 7365 6e64 6d61 696c   $this->sendmail
+0000eb90: 5365 6e64 2824 7468 6973 2d3e 4d49 4d45  Send($this->MIME
+0000eba0: 4865 6164 6572 2c20 2474 6869 732d 3e4d  Header, $this->M
+0000ebb0: 494d 4542 6f64 7929 3b0a 2020 2020 2020  IMEBody);.      
+0000ebc0: 2020 2020 2020 2020 2020 6361 7365 2027            case '
+0000ebd0: 736d 7470 273a 0a20 2020 2020 2020 2020  smtp':.         
+0000ebe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ebf0: 6e20 2474 6869 732d 3e73 6d74 7053 656e  n $this->smtpSen
+0000ec00: 6428 2474 6869 732d 3e4d 494d 4548 6561  d($this->MIMEHea
+0000ec10: 6465 722c 2024 7468 6973 2d3e 4d49 4d45  der, $this->MIME
+0000ec20: 426f 6479 293b 0a20 2020 2020 2020 2020  Body);.         
+0000ec30: 2020 2020 2020 2063 6173 6520 276d 6169         case 'mai
+0000ec40: 6c27 3a0a 2020 2020 2020 2020 2020 2020  l':.            
+0000ec50: 2020 2020 2020 2020 7265 7475 726e 2024          return $
+0000ec60: 7468 6973 2d3e 6d61 696c 5365 6e64 2824  this->mailSend($
+0000ec70: 7468 6973 2d3e 4d49 4d45 4865 6164 6572  this->MIMEHeader
+0000ec80: 2c20 2474 6869 732d 3e4d 494d 4542 6f64  , $this->MIMEBod
+0000ec90: 7929 3b0a 2020 2020 2020 2020 2020 2020  y);.            
+0000eca0: 2020 2020 6465 6661 756c 743a 0a20 2020      default:.   
+0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecc0: 2024 7365 6e64 4d65 7468 6f64 203d 2024   $sendMethod = $
+0000ecd0: 7468 6973 2d3e 4d61 696c 6572 202e 2027  this->Mailer . '
+0000ece0: 5365 6e64 273b 0a20 2020 2020 2020 2020  Send';.         
+0000ecf0: 2020 2020 2020 2020 2020 2069 6620 286d             if (m
+0000ed00: 6574 686f 645f 6578 6973 7473 2824 7468  ethod_exists($th
+0000ed10: 6973 2c20 2473 656e 644d 6574 686f 6429  is, $sendMethod)
+0000ed20: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0000ed30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000ed40: 726e 2024 7468 6973 2d3e 7b24 7365 6e64  rn $this->{$send
+0000ed50: 4d65 7468 6f64 7d28 2474 6869 732d 3e4d  Method}($this->M
+0000ed60: 494d 4548 6561 6465 722c 2024 7468 6973  IMEHeader, $this
+0000ed70: 2d3e 4d49 4d45 426f 6479 293b 0a20 2020  ->MIMEBody);.   
+0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed90: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
+0000eda0: 2020 2020 2020 2020 7265 7475 726e 2024          return $
+0000edb0: 7468 6973 2d3e 6d61 696c 5365 6e64 2824  this->mailSend($
+0000edc0: 7468 6973 2d3e 4d49 4d45 4865 6164 6572  this->MIMEHeader
+0000edd0: 2c20 2474 6869 732d 3e4d 494d 4542 6f64  , $this->MIMEBod
+0000ede0: 7929 3b0a 2020 2020 2020 2020 2020 2020  y);.            
+0000edf0: 7d0a 2020 2020 2020 2020 7d20 6361 7463  }.        } catc
+0000ee00: 6820 2845 7863 6570 7469 6f6e 2024 6578  h (Exception $ex
+0000ee10: 6329 207b 0a20 2020 2020 2020 2020 2020  c) {.           
+0000ee20: 2024 7468 6973 2d3e 7365 7445 7272 6f72   $this->setError
+0000ee30: 2824 6578 632d 3e67 6574 4d65 7373 6167  ($exc->getMessag
+0000ee40: 6528 2929 3b0a 2020 2020 2020 2020 2020  e());.          
+0000ee50: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
+0000ee60: 2465 7863 2d3e 6765 744d 6573 7361 6765  $exc->getMessage
+0000ee70: 2829 293b 0a20 2020 2020 2020 2020 2020  ());.           
+0000ee80: 2069 6620 2824 7468 6973 2d3e 4d61 696c   if ($this->Mail
+0000ee90: 6572 203d 3d3d 2027 736d 7470 2720 2626  er === 'smtp' &&
+0000eea0: 2024 7468 6973 2d3e 534d 5450 4b65 6570   $this->SMTPKeep
+0000eeb0: 416c 6976 6520 3d3d 2074 7275 6520 2626  Alive == true &&
+0000eec0: 2024 7468 6973 2d3e 736d 7470 2d3e 636f   $this->smtp->co
+0000eed0: 6e6e 6563 7465 6428 2929 207b 0a20 2020  nnected()) {.   
+0000eee0: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+0000eef0: 6973 2d3e 736d 7470 2d3e 7265 7365 7428  is->smtp->reset(
+0000ef00: 293b 0a20 2020 2020 2020 2020 2020 207d  );.            }
+0000ef10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000ef20: 2824 7468 6973 2d3e 6578 6365 7074 696f  ($this->exceptio
+0000ef30: 6e73 2920 7b0a 2020 2020 2020 2020 2020  ns) {.          
+0000ef40: 2020 2020 2020 7468 726f 7720 2465 7863        throw $exc
+0000ef50: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
+0000ef60: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+0000ef70: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
+0000ef80: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+0000ef90: 2020 2020 202a 2053 656e 6420 6d61 696c       * Send mail
+0000efa0: 2075 7369 6e67 2074 6865 2024 5365 6e64   using the $Send
+0000efb0: 6d61 696c 2070 726f 6772 616d 2e0a 2020  mail program..  
+0000efc0: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
+0000efd0: 2050 4850 4d61 696c 6572 3a3a 2453 656e   PHPMailer::$Sen
+0000efe0: 646d 6169 6c0a 2020 2020 202a 0a20 2020  dmail.     *.   
+0000eff0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+0000f000: 6720 2468 6561 6465 7220 5468 6520 6d65  g $header The me
+0000f010: 7373 6167 6520 6865 6164 6572 730a 2020  ssage headers.  
+0000f020: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+0000f030: 6e67 2024 626f 6479 2020 2054 6865 206d  ng $body   The m
+0000f040: 6573 7361 6765 2062 6f64 790a 2020 2020  essage body.    
+0000f050: 202a 0a20 2020 2020 2a20 4074 6872 6f77   *.     * @throw
+0000f060: 7320 4578 6365 7074 696f 6e0a 2020 2020  s Exception.    
+0000f070: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+0000f080: 6e20 626f 6f6c 0a20 2020 2020 2a2f 0a20  n bool.     */. 
+0000f090: 2020 2070 726f 7465 6374 6564 2066 756e     protected fun
+0000f0a0: 6374 696f 6e20 7365 6e64 6d61 696c 5365  ction sendmailSe
+0000f0b0: 6e64 2824 6865 6164 6572 2c20 2462 6f64  nd($header, $bod
+0000f0c0: 7929 0a20 2020 207b 0a20 2020 2020 2020  y).    {.       
+0000f0d0: 2069 6620 2824 7468 6973 2d3e 4d61 696c   if ($this->Mail
+0000f0e0: 6572 203d 3d3d 2027 716d 6169 6c27 2920  er === 'qmail') 
+0000f0f0: 7b0a 2020 2020 2020 2020 2020 2020 2474  {.            $t
+0000f100: 6869 732d 3e65 6465 6275 6728 2753 656e  his->edebug('Sen
+0000f110: 6469 6e67 2077 6974 6820 716d 6169 6c27  ding with qmail'
+0000f120: 293b 0a20 2020 2020 2020 207d 2065 6c73  );.        } els
+0000f130: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+0000f140: 2474 6869 732d 3e65 6465 6275 6728 2753  $this->edebug('S
+0000f150: 656e 6469 6e67 2077 6974 6820 7365 6e64  ending with send
+0000f160: 6d61 696c 2729 3b0a 2020 2020 2020 2020  mail');.        
+0000f170: 7d0a 2020 2020 2020 2020 2468 6561 6465  }.        $heade
+0000f180: 7220 3d20 7374 6174 6963 3a3a 7374 7269  r = static::stri
+0000f190: 7054 7261 696c 696e 6757 5350 2824 6865  pTrailingWSP($he
+0000f1a0: 6164 6572 2920 2e20 7374 6174 6963 3a3a  ader) . static::
+0000f1b0: 244c 4520 2e20 7374 6174 6963 3a3a 244c  $LE . static::$L
+0000f1c0: 453b 0a20 2020 2020 2020 202f 2f54 6869  E;.        //Thi
+0000f1d0: 7320 7365 7473 2074 6865 2053 4d54 5020  s sets the SMTP 
+0000f1e0: 656e 7665 6c6f 7065 2073 656e 6465 7220  envelope sender 
+0000f1f0: 7768 6963 6820 6765 7473 2074 7572 6e65  which gets turne
+0000f200: 6420 696e 746f 2061 2072 6574 7572 6e2d  d into a return-
+0000f210: 7061 7468 2068 6561 6465 7220 6279 2074  path header by t
+0000f220: 6865 2072 6563 6569 7665 720a 2020 2020  he receiver.    
+0000f230: 2020 2020 2f2f 4120 7370 6163 6520 6166      //A space af
+0000f240: 7465 7220 602d 6660 2069 7320 6f70 7469  ter `-f` is opti
+0000f250: 6f6e 616c 2c20 6275 7420 7468 6572 6520  onal, but there 
+0000f260: 6973 2061 206c 6f6e 6720 6869 7374 6f72  is a long histor
+0000f270: 7920 6f66 2069 7473 2070 7265 7365 6e63  y of its presenc
+0000f280: 650a 2020 2020 2020 2020 2f2f 6361 7573  e.        //caus
+0000f290: 696e 6720 7072 6f62 6c65 6d73 2c20 736f  ing problems, so
+0000f2a0: 2077 6520 646f 6e27 7420 7573 6520 6f6e   we don't use on
+0000f2b0: 650a 2020 2020 2020 2020 2f2f 4578 696d  e.        //Exim
+0000f2c0: 2064 6f63 733a 2068 7474 703a 2f2f 7777   docs: http://ww
+0000f2d0: 772e 6578 696d 2e6f 7267 2f65 7869 6d2d  w.exim.org/exim-
+0000f2e0: 6874 6d6c 2d63 7572 7265 6e74 2f64 6f63  html-current/doc
+0000f2f0: 2f68 746d 6c2f 7370 6563 5f68 746d 6c2f  /html/spec_html/
+0000f300: 6368 2d74 6865 5f65 7869 6d5f 636f 6d6d  ch-the_exim_comm
+0000f310: 616e 645f 6c69 6e65 2e68 746d 6c0a 2020  and_line.html.  
+0000f320: 2020 2020 2020 2f2f 5365 6e64 6d61 696c        //Sendmail
+0000f330: 2064 6f63 733a 2068 7474 703a 2f2f 7777   docs: http://ww
+0000f340: 772e 7365 6e64 6d61 696c 2e6f 7267 2f7e  w.sendmail.org/~
+0000f350: 6361 2f65 6d61 696c 2f6d 616e 2f73 656e  ca/email/man/sen
+0000f360: 646d 6169 6c2e 6874 6d6c 0a20 2020 2020  dmail.html.     
+0000f370: 2020 202f 2f51 6d61 696c 2064 6f63 733a     //Qmail docs:
+0000f380: 2068 7474 703a 2f2f 7777 772e 716d 6169   http://www.qmai
+0000f390: 6c2e 6f72 672f 6d61 6e2f 6d61 6e38 2f71  l.org/man/man8/q
+0000f3a0: 6d61 696c 2d69 6e6a 6563 742e 6874 6d6c  mail-inject.html
+0000f3b0: 0a20 2020 2020 2020 202f 2f45 7861 6d70  .        //Examp
+0000f3c0: 6c65 2070 726f 626c 656d 3a20 6874 7470  le problem: http
+0000f3d0: 733a 2f2f 7777 772e 6472 7570 616c 2e6f  s://www.drupal.o
+0000f3e0: 7267 2f6e 6f64 652f 3130 3537 3935 340a  rg/node/1057954.
+0000f3f0: 0a20 2020 2020 2020 202f 2f50 4850 2035  .        //PHP 5
+0000f400: 2e36 2077 6f72 6b61 726f 756e 640a 2020  .6 workaround.  
+0000f410: 2020 2020 2020 2473 656e 646d 6169 6c5f        $sendmail_
+0000f420: 6672 6f6d 5f76 616c 7565 203d 2069 6e69  from_value = ini
+0000f430: 5f67 6574 2827 7365 6e64 6d61 696c 5f66  _get('sendmail_f
+0000f440: 726f 6d27 293b 0a20 2020 2020 2020 2069  rom');.        i
+0000f450: 6620 2865 6d70 7479 2824 7468 6973 2d3e  f (empty($this->
+0000f460: 5365 6e64 6572 2920 2626 2021 656d 7074  Sender) && !empt
+0000f470: 7928 2473 656e 646d 6169 6c5f 6672 6f6d  y($sendmail_from
+0000f480: 5f76 616c 7565 2929 207b 0a20 2020 2020  _value)) {.     
+0000f490: 2020 2020 2020 202f 2f50 4850 2063 6f6e         //PHP con
+0000f4a0: 6669 6720 6861 7320 6120 7365 6e64 6572  fig has a sender
+0000f4b0: 2061 6464 7265 7373 2077 6520 6361 6e20   address we can 
+0000f4c0: 7573 650a 2020 2020 2020 2020 2020 2020  use.            
+0000f4d0: 2474 6869 732d 3e53 656e 6465 7220 3d20  $this->Sender = 
+0000f4e0: 696e 695f 6765 7428 2773 656e 646d 6169  ini_get('sendmai
+0000f4f0: 6c5f 6672 6f6d 2729 3b0a 2020 2020 2020  l_from');.      
+0000f500: 2020 7d0a 2020 2020 2020 2020 2f2f 4356    }.        //CV
+0000f510: 452d 3230 3136 2d31 3030 3333 2c20 4356  E-2016-10033, CV
+0000f520: 452d 3230 3136 2d31 3030 3435 3a20 446f  E-2016-10045: Do
+0000f530: 6e27 7420 7061 7373 202d 6620 6966 2063  n't pass -f if c
+0000f540: 6861 7261 6374 6572 7320 7769 6c6c 2062  haracters will b
+0000f550: 6520 6573 6361 7065 642e 0a20 2020 2020  e escaped..     
+0000f560: 2020 2069 6620 2821 656d 7074 7928 2474     if (!empty($t
+0000f570: 6869 732d 3e53 656e 6465 7229 2026 2620  his->Sender) && 
+0000f580: 7374 6174 6963 3a3a 7661 6c69 6461 7465  static::validate
+0000f590: 4164 6472 6573 7328 2474 6869 732d 3e53  Address($this->S
+0000f5a0: 656e 6465 7229 2026 2620 7365 6c66 3a3a  ender) && self::
+0000f5b0: 6973 5368 656c 6c53 6166 6528 2474 6869  isShellSafe($thi
+0000f5c0: 732d 3e53 656e 6465 7229 2920 7b0a 2020  s->Sender)) {.  
+0000f5d0: 2020 2020 2020 2020 2020 6966 2028 2474            if ($t
+0000f5e0: 6869 732d 3e4d 6169 6c65 7220 3d3d 3d20  his->Mailer === 
+0000f5f0: 2771 6d61 696c 2729 207b 0a20 2020 2020  'qmail') {.     
+0000f600: 2020 2020 2020 2020 2020 2024 7365 6e64             $send
+0000f610: 6d61 696c 466d 7420 3d20 2725 7320 2d66  mailFmt = '%s -f
+0000f620: 2573 273b 0a20 2020 2020 2020 2020 2020  %s';.           
+0000f630: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
+0000f640: 2020 2020 2020 2020 2020 2473 656e 646d            $sendm
+0000f650: 6169 6c46 6d74 203d 2027 2573 202d 6f69  ailFmt = '%s -oi
+0000f660: 202d 6625 7320 2d74 273b 0a20 2020 2020   -f%s -t';.     
+0000f670: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000f680: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
+0000f690: 2020 2020 2020 2f2f 616c 6c6f 7720 7365        //allow se
+0000f6a0: 6e64 6d61 696c 2074 6f20 6368 6f6f 7365  ndmail to choose
+0000f6b0: 2061 2064 6566 6175 6c74 2065 6e76 656c   a default envel
+0000f6c0: 6f70 6520 7365 6e64 6572 2e20 4974 206d  ope sender. It m
+0000f6d0: 6179 0a20 2020 2020 2020 2020 2020 202f  ay.            /
+0000f6e0: 2f73 6565 6d20 7072 6566 6572 6162 6c65  /seem preferable
+0000f6f0: 2074 6f20 666f 7263 6520 6974 2074 6f20   to force it to 
+0000f700: 7573 6520 7468 6520 4672 6f6d 2068 6561  use the From hea
+0000f710: 6465 7220 6173 2077 6974 680a 2020 2020  der as with.    
+0000f720: 2020 2020 2020 2020 2f2f 534d 5450 2c20          //SMTP, 
+0000f730: 6275 7420 7468 6174 2069 6e74 726f 6475  but that introdu
+0000f740: 6365 7320 6e65 7720 7072 6f62 6c65 6d73  ces new problems
+0000f750: 2028 7365 650a 2020 2020 2020 2020 2020   (see.          
+0000f760: 2020 2f2f 3c68 7474 7073 3a2f 2f67 6974    //<https://git
+0000f770: 6875 622e 636f 6d2f 5048 504d 6169 6c65  hub.com/PHPMaile
+0000f780: 722f 5048 504d 6169 6c65 722f 6973 7375  r/PHPMailer/issu
+0000f790: 6573 2f32 3239 383e 292c 2061 6e64 0a20  es/2298>), and. 
+0000f7a0: 2020 2020 2020 2020 2020 202f 2f69 7420             //it 
+0000f7b0: 6861 7320 6869 7374 6f72 6963 616c 6c79  has historically
+0000f7c0: 2077 6f72 6b65 6420 7468 6973 2077 6179   worked this way
+0000f7d0: 2e0a 2020 2020 2020 2020 2020 2020 2473  ..            $s
+0000f7e0: 656e 646d 6169 6c46 6d74 203d 2027 2573  endmailFmt = '%s
+0000f7f0: 202d 6f69 202d 7427 3b0a 2020 2020 2020   -oi -t';.      
+0000f800: 2020 7d0a 0a20 2020 2020 2020 2024 7365    }..        $se
+0000f810: 6e64 6d61 696c 203d 2073 7072 696e 7466  ndmail = sprintf
+0000f820: 2824 7365 6e64 6d61 696c 466d 742c 2065  ($sendmailFmt, e
+0000f830: 7363 6170 6573 6865 6c6c 636d 6428 2474  scapeshellcmd($t
+0000f840: 6869 732d 3e53 656e 646d 6169 6c29 2c20  his->Sendmail), 
+0000f850: 2474 6869 732d 3e53 656e 6465 7229 3b0a  $this->Sender);.
+0000f860: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
+0000f870: 6465 6275 6728 2753 656e 646d 6169 6c20  debug('Sendmail 
+0000f880: 7061 7468 3a20 2720 2e20 2474 6869 732d  path: ' . $this-
+0000f890: 3e53 656e 646d 6169 6c29 3b0a 2020 2020  >Sendmail);.    
+0000f8a0: 2020 2020 2474 6869 732d 3e65 6465 6275      $this->edebu
+0000f8b0: 6728 2753 656e 646d 6169 6c20 636f 6d6d  g('Sendmail comm
+0000f8c0: 616e 643a 2027 202e 2024 7365 6e64 6d61  and: ' . $sendma
+0000f8d0: 696c 293b 0a20 2020 2020 2020 2024 7468  il);.        $th
+0000f8e0: 6973 2d3e 6564 6562 7567 2827 456e 7665  is->edebug('Enve
+0000f8f0: 6c6f 7065 2073 656e 6465 723a 2027 202e  lope sender: ' .
+0000f900: 2024 7468 6973 2d3e 5365 6e64 6572 293b   $this->Sender);
+0000f910: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+0000f920: 6564 6562 7567 2822 4865 6164 6572 733a  edebug("Headers:
+0000f930: 207b 2468 6561 6465 727d 2229 3b0a 0a20   {$header}");.. 
+0000f940: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
+0000f950: 2d3e 5369 6e67 6c65 546f 2920 7b0a 2020  ->SingleTo) {.  
+0000f960: 2020 2020 2020 2020 2020 666f 7265 6163            foreac
+0000f970: 6820 2824 7468 6973 2d3e 5369 6e67 6c65  h ($this->Single
+0000f980: 546f 4172 7261 7920 6173 2024 746f 4164  ToArray as $toAd
+0000f990: 6472 2920 7b0a 2020 2020 2020 2020 2020  dr) {.          
+0000f9a0: 2020 2020 2020 246d 6169 6c20 3d20 4070        $mail = @p
+0000f9b0: 6f70 656e 2824 7365 6e64 6d61 696c 2c20  open($sendmail, 
+0000f9c0: 2777 2729 3b0a 2020 2020 2020 2020 2020  'w');.          
+0000f9d0: 2020 2020 2020 6966 2028 2124 6d61 696c        if (!$mail
+0000f9e0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0000f9f0: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
+0000fa00: 7720 4578 6365 7074 696f 6e28 2474 6869  w Exception($thi
+0000fa10: 732d 3e6c 616e 6728 2765 7865 6375 7465  s->lang('execute
+0000fa20: 2729 202e 2024 7468 6973 2d3e 5365 6e64  ') . $this->Send
+0000fa30: 6d61 696c 2c20 7365 6c66 3a3a 5354 4f50  mail, self::STOP
+0000fa40: 5f43 5249 5449 4341 4c29 3b0a 2020 2020  _CRITICAL);.    
+0000fa50: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+0000fa60: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+0000fa70: 6869 732d 3e65 6465 6275 6728 2254 6f3a  his->edebug("To:
+0000fa80: 207b 2474 6f41 6464 727d 2229 3b0a 2020   {$toAddr}");.  
+0000fa90: 2020 2020 2020 2020 2020 2020 2020 6677                fw
+0000faa0: 7269 7465 2824 6d61 696c 2c20 2754 6f3a  rite($mail, 'To:
+0000fab0: 2027 202e 2024 746f 4164 6472 202e 2022   ' . $toAddr . "
+0000fac0: 5c6e 2229 3b0a 2020 2020 2020 2020 2020  \n");.          
+0000fad0: 2020 2020 2020 6677 7269 7465 2824 6d61        fwrite($ma
+0000fae0: 696c 2c20 2468 6561 6465 7229 3b0a 2020  il, $header);.  
+0000faf0: 2020 2020 2020 2020 2020 2020 2020 6677                fw
+0000fb00: 7269 7465 2824 6d61 696c 2c20 2462 6f64  rite($mail, $bod
+0000fb10: 7929 3b0a 2020 2020 2020 2020 2020 2020  y);.            
+0000fb20: 2020 2020 2472 6573 756c 7420 3d20 7063      $result = pc
+0000fb30: 6c6f 7365 2824 6d61 696c 293b 0a20 2020  lose($mail);.   
+0000fb40: 2020 2020 2020 2020 2020 2020 2024 6164               $ad
+0000fb50: 6472 696e 666f 203d 2073 7461 7469 633a  drinfo = static:
+0000fb60: 3a70 6172 7365 4164 6472 6573 7365 7328  :parseAddresses(
+0000fb70: 2474 6f41 6464 722c 2074 7275 652c 2024  $toAddr, true, $
+0000fb80: 7468 6973 2d3e 4368 6172 5365 7429 3b0a  this->CharSet);.
+0000fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fba0: 2474 6869 732d 3e64 6f43 616c 6c62 6163  $this->doCallbac
+0000fbb0: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+0000fbc0: 2020 2020 2020 2028 2472 6573 756c 7420         ($result 
+0000fbd0: 3d3d 3d20 3029 2c0a 2020 2020 2020 2020  === 0),.        
+0000fbe0: 2020 2020 2020 2020 2020 2020 5b5b 2461              [[$a
+0000fbf0: 6464 7269 6e66 6f5b 2761 6464 7265 7373  ddrinfo['address
+0000fc00: 275d 2c20 2461 6464 7269 6e66 6f5b 276e  '], $addrinfo['n
+0000fc10: 616d 6527 5d5d 5d2c 0a20 2020 2020 2020  ame']]],.       
+0000fc20: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+0000fc30: 6973 2d3e 6363 2c0a 2020 2020 2020 2020  is->cc,.        
 0000fc40: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-0000fc50: 732d 3e74 6f2c 0a20 2020 2020 2020 2020  s->to,.         
-0000fc60: 2020 2020 2020 2024 7468 6973 2d3e 6363         $this->cc
-0000fc70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fc80: 2020 2474 6869 732d 3e62 6363 2c0a 2020    $this->bcc,.  
-0000fc90: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-0000fca0: 6869 732d 3e53 7562 6a65 6374 2c0a 2020  his->Subject,.  
-0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-0000fcc0: 6f64 792c 0a20 2020 2020 2020 2020 2020  ody,.           
-0000fcd0: 2020 2020 2024 7468 6973 2d3e 4672 6f6d       $this->From
-0000fce0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fcf0: 2020 5b5d 0a20 2020 2020 2020 2020 2020    [].           
-0000fd00: 2029 3b0a 2020 2020 2020 2020 2020 2020   );.            
-0000fd10: 2474 6869 732d 3e65 6465 6275 6728 2252  $this->edebug("R
-0000fd20: 6573 756c 743a 2022 202e 2028 2472 6573  esult: " . ($res
-0000fd30: 756c 7420 3d3d 3d20 3020 3f20 2774 7275  ult === 0 ? 'tru
-0000fd40: 6527 203a 2027 6661 6c73 6527 2929 3b0a  e' : 'false'));.
-0000fd50: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0000fd60: 3020 213d 3d20 2472 6573 756c 7429 207b  0 !== $result) {
-0000fd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fd80: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
-0000fd90: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
-0000fda0: 2827 6578 6563 7574 6527 2920 2e20 2474  ('execute') . $t
-0000fdb0: 6869 732d 3e53 656e 646d 6169 6c2c 2073  his->Sendmail, s
-0000fdc0: 656c 663a 3a53 544f 505f 4352 4954 4943  elf::STOP_CRITIC
-0000fdd0: 414c 293b 0a20 2020 2020 2020 2020 2020  AL);.           
-0000fde0: 207d 0a20 2020 2020 2020 207d 0a0a 2020   }.        }..  
-0000fdf0: 2020 2020 2020 7265 7475 726e 2074 7275        return tru
-0000fe00: 653b 0a20 2020 207d 0a0a 2020 2020 2f2a  e;.    }..    /*
-0000fe10: 2a0a 2020 2020 202a 2046 6978 2043 5645  *.     * Fix CVE
-0000fe20: 2d32 3031 362d 3130 3033 3320 616e 6420  -2016-10033 and 
-0000fe30: 4356 452d 3230 3136 2d31 3030 3435 2062  CVE-2016-10045 b
-0000fe40: 7920 6469 7361 6c6c 6f77 696e 6720 706f  y disallowing po
-0000fe50: 7465 6e74 6961 6c6c 7920 756e 7361 6665  tentially unsafe
-0000fe60: 2073 6865 6c6c 2063 6861 7261 6374 6572   shell character
-0000fe70: 732e 0a20 2020 2020 2a20 4e6f 7465 2074  s..     * Note t
-0000fe80: 6861 7420 6573 6361 7065 7368 656c 6c61  hat escapeshella
-0000fe90: 7267 2061 6e64 2065 7363 6170 6573 6865  rg and escapeshe
-0000fea0: 6c6c 636d 6420 6172 6520 696e 6164 6571  llcmd are inadeq
-0000feb0: 7561 7465 2066 6f72 206f 7572 2070 7572  uate for our pur
-0000fec0: 706f 7365 732c 2065 7370 6563 6961 6c6c  poses, especiall
-0000fed0: 7920 6f6e 2057 696e 646f 7773 2e0a 2020  y on Windows..  
-0000fee0: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
-0000fef0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-0000ff00: 636f 6d2f 5048 504d 6169 6c65 722f 5048  com/PHPMailer/PH
-0000ff10: 504d 6169 6c65 722f 6973 7375 6573 2f39  PMailer/issues/9
-0000ff20: 3234 2043 5645 2d32 3031 362d 3130 3034  24 CVE-2016-1004
-0000ff30: 3520 6275 6720 7265 706f 7274 0a20 2020  5 bug report.   
-0000ff40: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-0000ff50: 6d20 7374 7269 6e67 2024 7374 7269 6e67  m string $string
-0000ff60: 2054 6865 2073 7472 696e 6720 746f 2062   The string to b
-0000ff70: 6520 7661 6c69 6461 7465 640a 2020 2020  e validated.    
-0000ff80: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
-0000ff90: 6e20 626f 6f6c 0a20 2020 2020 2a2f 0a20  n bool.     */. 
-0000ffa0: 2020 2070 726f 7465 6374 6564 2073 7461     protected sta
-0000ffb0: 7469 6320 6675 6e63 7469 6f6e 2069 7353  tic function isS
-0000ffc0: 6865 6c6c 5361 6665 2824 7374 7269 6e67  hellSafe($string
-0000ffd0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-0000ffe0: 2f2f 4974 2773 206e 6f74 2070 6f73 7369  //It's not possi
-0000fff0: 626c 6520 746f 2075 7365 2073 6865 6c6c  ble to use shell
-00010000: 2063 6f6d 6d61 6e64 7320 7361 6665 6c79   commands safely
-00010010: 2028 7768 6963 6820 696e 636c 7564 6573   (which includes
-00010020: 2074 6865 206d 6169 6c28 2920 6675 6e63   the mail() func
-00010030: 7469 6f6e 2920 7769 7468 6f75 7420 6573  tion) without es
-00010040: 6361 7065 7368 656c 6c61 7267 2c0a 2020  capeshellarg,.  
-00010050: 2020 2020 2020 2f2f 6275 7420 736f 6d65        //but some
-00010060: 2068 6f73 7469 6e67 2070 726f 7669 6465   hosting provide
-00010070: 7273 2064 6973 6162 6c65 2069 742c 2063  rs disable it, c
-00010080: 7265 6174 696e 6720 6120 7365 6375 7269  reating a securi
-00010090: 7479 2070 726f 626c 656d 2074 6861 7420  ty problem that 
-000100a0: 7765 2064 6f6e 2774 2077 616e 7420 746f  we don't want to
-000100b0: 2068 6176 6520 746f 2064 6561 6c20 7769   have to deal wi
-000100c0: 7468 2c0a 2020 2020 2020 2020 2f2f 736f  th,.        //so
-000100d0: 2077 6520 646f 6e27 742e 0a20 2020 2020   we don't..     
-000100e0: 2020 2069 6620 2821 6675 6e63 7469 6f6e     if (!function
-000100f0: 5f65 7869 7374 7328 2765 7363 6170 6573  _exists('escapes
-00010100: 6865 6c6c 6172 6727 2920 7c7c 2021 6675  hellarg') || !fu
-00010110: 6e63 7469 6f6e 5f65 7869 7374 7328 2765  nction_exists('e
-00010120: 7363 6170 6573 6865 6c6c 636d 6427 2929  scapeshellcmd'))
-00010130: 207b 0a20 2020 2020 2020 2020 2020 2072   {.            r
-00010140: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
-00010150: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00010160: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00010170: 2065 7363 6170 6573 6865 6c6c 636d 6428   escapeshellcmd(
-00010180: 2473 7472 696e 6729 2021 3d3d 2024 7374  $string) !== $st
-00010190: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-000101a0: 207c 7c20 2169 6e5f 6172 7261 7928 6573   || !in_array(es
-000101b0: 6361 7065 7368 656c 6c61 7267 2824 7374  capeshellarg($st
-000101c0: 7269 6e67 292c 205b 2227 2473 7472 696e  ring), ["'$strin
-000101d0: 6727 222c 2022 5c22 2473 7472 696e 675c  g'", "\"$string\
-000101e0: 2222 5d29 0a20 2020 2020 2020 2029 207b  ""]).        ) {
-000101f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00010200: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
-00010210: 2020 207d 0a0a 2020 2020 2020 2020 246c     }..        $l
-00010220: 656e 6774 6820 3d20 7374 726c 656e 2824  ength = strlen($
-00010230: 7374 7269 6e67 293b 0a0a 2020 2020 2020  string);..      
-00010240: 2020 666f 7220 2824 6920 3d20 303b 2024    for ($i = 0; $
-00010250: 6920 3c20 246c 656e 6774 683b 202b 2b24  i < $length; ++$
-00010260: 6929 207b 0a20 2020 2020 2020 2020 2020  i) {.           
-00010270: 2024 6320 3d20 2473 7472 696e 675b 2469   $c = $string[$i
-00010280: 5d3b 0a0a 2020 2020 2020 2020 2020 2020  ];..            
-00010290: 2f2f 416c 6c20 6f74 6865 7220 6368 6172  //All other char
-000102a0: 6163 7465 7273 2068 6176 6520 6120 7370  acters have a sp
-000102b0: 6563 6961 6c20 6d65 616e 696e 6720 696e  ecial meaning in
-000102c0: 2061 7420 6c65 6173 7420 6f6e 6520 636f   at least one co
-000102d0: 6d6d 6f6e 2073 6865 6c6c 2c20 696e 636c  mmon shell, incl
-000102e0: 7564 696e 6720 3d20 616e 6420 2b2e 0a20  uding = and +.. 
-000102f0: 2020 2020 2020 2020 2020 202f 2f46 756c             //Ful
-00010300: 6c20 7374 6f70 2028 2e29 2068 6173 2061  l stop (.) has a
-00010310: 2073 7065 6369 616c 206d 6561 6e69 6e67   special meaning
-00010320: 2069 6e20 636d 642e 6578 652c 2062 7574   in cmd.exe, but
-00010330: 2069 7473 2069 6d70 6163 7420 7368 6f75   its impact shou
-00010340: 6c64 2062 6520 6e65 676c 6967 6962 6c65  ld be negligible
-00010350: 2068 6572 652e 0a20 2020 2020 2020 2020   here..         
-00010360: 2020 202f 2f4e 6f74 6520 7468 6174 2074     //Note that t
-00010370: 6869 7320 646f 6573 2070 6572 6d69 7420  his does permit 
-00010380: 6e6f 6e2d 4c61 7469 6e20 616c 7068 616e  non-Latin alphan
-00010390: 756d 6572 6963 2063 6861 7261 6374 6572  umeric character
-000103a0: 7320 6261 7365 6420 6f6e 2074 6865 2063  s based on the c
-000103b0: 7572 7265 6e74 206c 6f63 616c 652e 0a20  urrent locale.. 
-000103c0: 2020 2020 2020 2020 2020 2069 6620 2821             if (!
-000103d0: 6374 7970 655f 616c 6e75 6d28 2463 2920  ctype_alnum($c) 
-000103e0: 2626 2073 7472 706f 7328 2740 5f2d 2e27  && strpos('@_-.'
-000103f0: 2c20 2463 2920 3d3d 3d20 6661 6c73 6529  , $c) === false)
-00010400: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00010410: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
-00010420: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-00010430: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-00010440: 2020 7265 7475 726e 2074 7275 653b 0a20    return true;. 
-00010450: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-00010460: 2020 202a 2043 6865 636b 2077 6865 7468     * Check wheth
-00010470: 6572 2061 2066 696c 6520 7061 7468 2069  er a file path i
-00010480: 7320 6f66 2061 2070 6572 6d69 7474 6564  s of a permitted
-00010490: 2074 7970 652e 0a20 2020 2020 2a20 5573   type..     * Us
-000104a0: 6564 2074 6f20 7265 6a65 6374 2055 524c  ed to reject URL
-000104b0: 7320 616e 6420 7068 6172 2066 696c 6573  s and phar files
-000104c0: 2066 726f 6d20 6675 6e63 7469 6f6e 7320   from functions 
-000104d0: 7468 6174 2061 6363 6573 7320 6c6f 6361  that access loca
-000104e0: 6c20 6669 6c65 2070 6174 6873 2c0a 2020  l file paths,.  
-000104f0: 2020 202a 2073 7563 6820 6173 2061 6464     * such as add
-00010500: 4174 7461 6368 6d65 6e74 2e0a 2020 2020  Attachment..    
-00010510: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
-00010520: 2073 7472 696e 6720 2470 6174 6820 4120   string $path A 
-00010530: 7265 6c61 7469 7665 206f 7220 6162 736f  relative or abso
-00010540: 6c75 7465 2070 6174 6820 746f 2061 2066  lute path to a f
-00010550: 696c 650a 2020 2020 202a 0a20 2020 2020  ile.     *.     
-00010560: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
-00010570: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-00010580: 6374 6564 2073 7461 7469 6320 6675 6e63  cted static func
-00010590: 7469 6f6e 2069 7350 6572 6d69 7474 6564  tion isPermitted
-000105a0: 5061 7468 2824 7061 7468 290a 2020 2020  Path($path).    
-000105b0: 7b0a 2020 2020 2020 2020 2f2f 4d61 7463  {.        //Matc
-000105c0: 6865 7320 7363 6865 6d65 2064 6566 696e  hes scheme defin
-000105d0: 6974 696f 6e20 6672 6f6d 2068 7474 7073  ition from https
-000105e0: 3a2f 2f74 6f6f 6c73 2e69 6574 662e 6f72  ://tools.ietf.or
-000105f0: 672f 6874 6d6c 2f72 6663 3339 3836 2373  g/html/rfc3986#s
-00010600: 6563 7469 6f6e 2d33 2e31 0a20 2020 2020  ection-3.1.     
-00010610: 2020 2072 6574 7572 6e20 2170 7265 675f     return !preg_
-00010620: 6d61 7463 6828 2723 5e5b 612d 7a5d 5b61  match('#^[a-z][a
-00010630: 2d7a 5c64 2b2e 2d5d 2a3a 2f2f 2369 272c  -z\d+.-]*://#i',
-00010640: 2024 7061 7468 293b 0a20 2020 207d 0a0a   $path);.    }..
-00010650: 2020 2020 2f2a 2a0a 2020 2020 202a 2043      /**.     * C
-00010660: 6865 636b 2077 6865 7468 6572 2061 2066  heck whether a f
-00010670: 696c 6520 7061 7468 2069 7320 7361 6665  ile path is safe
-00010680: 2c20 6163 6365 7373 6962 6c65 2c20 616e  , accessible, an
-00010690: 6420 7265 6164 6162 6c65 2e0a 2020 2020  d readable..    
-000106a0: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
-000106b0: 2073 7472 696e 6720 2470 6174 6820 4120   string $path A 
-000106c0: 7265 6c61 7469 7665 206f 7220 6162 736f  relative or abso
-000106d0: 6c75 7465 2070 6174 6820 746f 2061 2066  lute path to a f
-000106e0: 696c 650a 2020 2020 202a 0a20 2020 2020  ile.     *.     
-000106f0: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
-00010700: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-00010710: 6374 6564 2073 7461 7469 6320 6675 6e63  cted static func
-00010720: 7469 6f6e 2066 696c 6549 7341 6363 6573  tion fileIsAcces
-00010730: 7369 626c 6528 2470 6174 6829 0a20 2020  sible($path).   
-00010740: 207b 0a20 2020 2020 2020 2069 6620 2821   {.        if (!
-00010750: 7374 6174 6963 3a3a 6973 5065 726d 6974  static::isPermit
-00010760: 7465 6450 6174 6828 2470 6174 6829 2920  tedPath($path)) 
-00010770: 7b0a 2020 2020 2020 2020 2020 2020 7265  {.            re
-00010780: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
-00010790: 2020 2020 7d0a 2020 2020 2020 2020 2472      }.        $r
-000107a0: 6561 6461 626c 6520 3d20 6669 6c65 5f65  eadable = file_e
-000107b0: 7869 7374 7328 2470 6174 6829 3b0a 2020  xists($path);.  
-000107c0: 2020 2020 2020 2f2f 4966 206e 6f74 2061        //If not a
-000107d0: 2055 4e43 2070 6174 6820 2865 7870 6563   UNC path (expec
-000107e0: 7465 6420 746f 2073 7461 7274 2077 6974  ted to start wit
-000107f0: 6820 5c5c 292c 2063 6865 636b 2072 6561  h \\), check rea
-00010800: 6420 7065 726d 6973 7369 6f6e 2c20 7365  d permission, se
-00010810: 6520 2332 3036 390a 2020 2020 2020 2020  e #2069.        
-00010820: 6966 2028 7374 7270 6f73 2824 7061 7468  if (strpos($path
-00010830: 2c20 275c 5c5c 5c27 2920 213d 3d20 3029  , '\\\\') !== 0)
-00010840: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
-00010850: 7265 6164 6162 6c65 203d 2024 7265 6164  readable = $read
-00010860: 6162 6c65 2026 2620 6973 5f72 6561 6461  able && is_reada
-00010870: 626c 6528 2470 6174 6829 3b0a 2020 2020  ble($path);.    
-00010880: 2020 2020 7d0a 2020 2020 2020 2020 7265      }.        re
-00010890: 7475 726e 2020 2472 6561 6461 626c 653b  turn  $readable;
-000108a0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-000108b0: 2020 2020 202a 2053 656e 6420 6d61 696c       * Send mail
-000108c0: 2075 7369 6e67 2074 6865 2050 4850 206d   using the PHP m
-000108d0: 6169 6c28 2920 6675 6e63 7469 6f6e 2e0a  ail() function..
-000108e0: 2020 2020 202a 0a20 2020 2020 2a20 4073       *.     * @s
-000108f0: 6565 2068 7474 703a 2f2f 7777 772e 7068  ee http://www.ph
-00010900: 702e 6e65 742f 6d61 6e75 616c 2f65 6e2f  p.net/manual/en/
-00010910: 626f 6f6b 2e6d 6169 6c2e 7068 700a 2020  book.mail.php.  
-00010920: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
-00010930: 616d 2073 7472 696e 6720 2468 6561 6465  am string $heade
-00010940: 7220 5468 6520 6d65 7373 6167 6520 6865  r The message he
-00010950: 6164 6572 730a 2020 2020 202a 2040 7061  aders.     * @pa
-00010960: 7261 6d20 7374 7269 6e67 2024 626f 6479  ram string $body
-00010970: 2020 2054 6865 206d 6573 7361 6765 2062     The message b
-00010980: 6f64 790a 2020 2020 202a 0a20 2020 2020  ody.     *.     
-00010990: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
-000109a0: 696f 6e0a 2020 2020 202a 0a20 2020 2020  ion.     *.     
-000109b0: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
-000109c0: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-000109d0: 6374 6564 2066 756e 6374 696f 6e20 6d61  cted function ma
-000109e0: 696c 5365 6e64 2824 6865 6164 6572 2c20  ilSend($header, 
-000109f0: 2462 6f64 7929 0a20 2020 207b 0a20 2020  $body).    {.   
-00010a00: 2020 2020 2024 6865 6164 6572 203d 2073       $header = s
-00010a10: 7461 7469 633a 3a73 7472 6970 5472 6169  tatic::stripTrai
-00010a20: 6c69 6e67 5753 5028 2468 6561 6465 7229  lingWSP($header)
-00010a30: 202e 2073 7461 7469 633a 3a24 4c45 202e   . static::$LE .
-00010a40: 2073 7461 7469 633a 3a24 4c45 3b0a 0a20   static::$LE;.. 
-00010a50: 2020 2020 2020 2024 746f 4172 7220 3d20         $toArr = 
-00010a60: 5b5d 3b0a 2020 2020 2020 2020 666f 7265  [];.        fore
-00010a70: 6163 6820 2824 7468 6973 2d3e 746f 2061  ach ($this->to a
-00010a80: 7320 2474 6f61 6464 7229 207b 0a20 2020  s $toaddr) {.   
-00010a90: 2020 2020 2020 2020 2024 746f 4172 725b           $toArr[
-00010aa0: 5d20 3d20 2474 6869 732d 3e61 6464 7246  ] = $this->addrF
-00010ab0: 6f72 6d61 7428 2474 6f61 6464 7229 3b0a  ormat($toaddr);.
-00010ac0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00010ad0: 2020 2474 6f20 3d20 7472 696d 2869 6d70    $to = trim(imp
-00010ae0: 6c6f 6465 2827 2c20 272c 2024 746f 4172  lode(', ', $toAr
-00010af0: 7229 293b 0a0a 2020 2020 2020 2020 2f2f  r));..        //
-00010b00: 4966 2074 6865 7265 2061 7265 206e 6f20  If there are no 
-00010b10: 546f 2d61 6464 7265 7373 6573 2028 652e  To-addresses (e.
-00010b20: 672e 2077 6865 6e20 7365 6e64 696e 6720  g. when sending 
-00010b30: 6f6e 6c79 2074 6f20 4243 432d 6164 6472  only to BCC-addr
-00010b40: 6573 7365 7329 0a20 2020 2020 2020 202f  esses).        /
-00010b50: 2f74 6865 2066 6f6c 6c6f 7769 6e67 2073  /the following s
-00010b60: 686f 756c 6420 6265 2061 6464 6564 2074  hould be added t
-00010b70: 6f20 6765 7420 6120 636f 7272 6563 7420  o get a correct 
-00010b80: 444b 494d 2d73 6967 6e61 7475 7265 2e0a  DKIM-signature..
-00010b90: 2020 2020 2020 2020 2f2f 436f 6d70 6172          //Compar
-00010ba0: 6520 7769 7468 2024 7468 6973 2d3e 7072  e with $this->pr
-00010bb0: 6553 656e 6428 290a 2020 2020 2020 2020  eSend().        
-00010bc0: 6966 2028 2474 6f20 3d3d 3d20 2727 2920  if ($to === '') 
-00010bd0: 7b0a 2020 2020 2020 2020 2020 2020 2474  {.            $t
-00010be0: 6f20 3d20 2775 6e64 6973 636c 6f73 6564  o = 'undisclosed
-00010bf0: 2d72 6563 6970 6965 6e74 733a 3b27 3b0a  -recipients:;';.
-00010c00: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00010c10: 2020 2024 7061 7261 6d73 203d 206e 756c     $params = nul
-00010c20: 6c3b 0a20 2020 2020 2020 202f 2f54 6869  l;.        //Thi
-00010c30: 7320 7365 7473 2074 6865 2053 4d54 5020  s sets the SMTP 
-00010c40: 656e 7665 6c6f 7065 2073 656e 6465 7220  envelope sender 
-00010c50: 7768 6963 6820 6765 7473 2074 7572 6e65  which gets turne
-00010c60: 6420 696e 746f 2061 2072 6574 7572 6e2d  d into a return-
-00010c70: 7061 7468 2068 6561 6465 7220 6279 2074  path header by t
-00010c80: 6865 2072 6563 6569 7665 720a 2020 2020  he receiver.    
-00010c90: 2020 2020 2f2f 4120 7370 6163 6520 6166      //A space af
-00010ca0: 7465 7220 602d 6660 2069 7320 6f70 7469  ter `-f` is opti
-00010cb0: 6f6e 616c 2c20 6275 7420 7468 6572 6520  onal, but there 
-00010cc0: 6973 2061 206c 6f6e 6720 6869 7374 6f72  is a long histor
-00010cd0: 7920 6f66 2069 7473 2070 7265 7365 6e63  y of its presenc
-00010ce0: 650a 2020 2020 2020 2020 2f2f 6361 7573  e.        //caus
-00010cf0: 696e 6720 7072 6f62 6c65 6d73 2c20 736f  ing problems, so
-00010d00: 2077 6520 646f 6e27 7420 7573 6520 6f6e   we don't use on
-00010d10: 650a 2020 2020 2020 2020 2f2f 4578 696d  e.        //Exim
-00010d20: 2064 6f63 733a 2068 7474 703a 2f2f 7777   docs: http://ww
-00010d30: 772e 6578 696d 2e6f 7267 2f65 7869 6d2d  w.exim.org/exim-
-00010d40: 6874 6d6c 2d63 7572 7265 6e74 2f64 6f63  html-current/doc
-00010d50: 2f68 746d 6c2f 7370 6563 5f68 746d 6c2f  /html/spec_html/
-00010d60: 6368 2d74 6865 5f65 7869 6d5f 636f 6d6d  ch-the_exim_comm
-00010d70: 616e 645f 6c69 6e65 2e68 746d 6c0a 2020  and_line.html.  
-00010d80: 2020 2020 2020 2f2f 5365 6e64 6d61 696c        //Sendmail
-00010d90: 2064 6f63 733a 2068 7474 703a 2f2f 7777   docs: http://ww
-00010da0: 772e 7365 6e64 6d61 696c 2e6f 7267 2f7e  w.sendmail.org/~
-00010db0: 6361 2f65 6d61 696c 2f6d 616e 2f73 656e  ca/email/man/sen
-00010dc0: 646d 6169 6c2e 6874 6d6c 0a20 2020 2020  dmail.html.     
-00010dd0: 2020 202f 2f51 6d61 696c 2064 6f63 733a     //Qmail docs:
-00010de0: 2068 7474 703a 2f2f 7777 772e 716d 6169   http://www.qmai
-00010df0: 6c2e 6f72 672f 6d61 6e2f 6d61 6e38 2f71  l.org/man/man8/q
-00010e00: 6d61 696c 2d69 6e6a 6563 742e 6874 6d6c  mail-inject.html
-00010e10: 0a20 2020 2020 2020 202f 2f45 7861 6d70  .        //Examp
-00010e20: 6c65 2070 726f 626c 656d 3a20 6874 7470  le problem: http
-00010e30: 733a 2f2f 7777 772e 6472 7570 616c 2e6f  s://www.drupal.o
-00010e40: 7267 2f6e 6f64 652f 3130 3537 3935 340a  rg/node/1057954.
-00010e50: 2020 2020 2020 2020 2f2f 4356 452d 3230          //CVE-20
-00010e60: 3136 2d31 3030 3333 2c20 4356 452d 3230  16-10033, CVE-20
-00010e70: 3136 2d31 3030 3435 3a20 446f 6e27 7420  16-10045: Don't 
-00010e80: 7061 7373 202d 6620 6966 2063 6861 7261  pass -f if chara
-00010e90: 6374 6572 7320 7769 6c6c 2062 6520 6573  cters will be es
-00010ea0: 6361 7065 642e 0a0a 2020 2020 2020 2020  caped...        
-00010eb0: 2f2f 5048 5020 352e 3620 776f 726b 6172  //PHP 5.6 workar
-00010ec0: 6f75 6e64 0a20 2020 2020 2020 2024 7365  ound.        $se
-00010ed0: 6e64 6d61 696c 5f66 726f 6d5f 7661 6c75  ndmail_from_valu
-00010ee0: 6520 3d20 696e 695f 6765 7428 2773 656e  e = ini_get('sen
-00010ef0: 646d 6169 6c5f 6672 6f6d 2729 3b0a 2020  dmail_from');.  
-00010f00: 2020 2020 2020 6966 2028 656d 7074 7928        if (empty(
-00010f10: 2474 6869 732d 3e53 656e 6465 7229 2026  $this->Sender) &
-00010f20: 2620 2165 6d70 7479 2824 7365 6e64 6d61  & !empty($sendma
-00010f30: 696c 5f66 726f 6d5f 7661 6c75 6529 2920  il_from_value)) 
-00010f40: 7b0a 2020 2020 2020 2020 2020 2020 2f2f  {.            //
-00010f50: 5048 5020 636f 6e66 6967 2068 6173 2061  PHP config has a
-00010f60: 2073 656e 6465 7220 6164 6472 6573 7320   sender address 
-00010f70: 7765 2063 616e 2075 7365 0a20 2020 2020  we can use.     
-00010f80: 2020 2020 2020 2024 7468 6973 2d3e 5365         $this->Se
-00010f90: 6e64 6572 203d 2069 6e69 5f67 6574 2827  nder = ini_get('
-00010fa0: 7365 6e64 6d61 696c 5f66 726f 6d27 293b  sendmail_from');
-00010fb0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-00010fc0: 2020 2069 6620 2821 656d 7074 7928 2474     if (!empty($t
-00010fd0: 6869 732d 3e53 656e 6465 7229 2026 2620  his->Sender) && 
-00010fe0: 7374 6174 6963 3a3a 7661 6c69 6461 7465  static::validate
-00010ff0: 4164 6472 6573 7328 2474 6869 732d 3e53  Address($this->S
-00011000: 656e 6465 7229 2920 7b0a 2020 2020 2020  ender)) {.      
-00011010: 2020 2020 2020 6966 2028 7365 6c66 3a3a        if (self::
-00011020: 6973 5368 656c 6c53 6166 6528 2474 6869  isShellSafe($thi
-00011030: 732d 3e53 656e 6465 7229 2920 7b0a 2020  s->Sender)) {.  
-00011040: 2020 2020 2020 2020 2020 2020 2020 2470                $p
-00011050: 6172 616d 7320 3d20 7370 7269 6e74 6628  arams = sprintf(
-00011060: 272d 6625 7327 2c20 2474 6869 732d 3e53  '-f%s', $this->S
-00011070: 656e 6465 7229 3b0a 2020 2020 2020 2020  ender);.        
-00011080: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00011090: 2020 246f 6c64 5f66 726f 6d20 3d20 696e    $old_from = in
-000110a0: 695f 6765 7428 2773 656e 646d 6169 6c5f  i_get('sendmail_
-000110b0: 6672 6f6d 2729 3b0a 2020 2020 2020 2020  from');.        
-000110c0: 2020 2020 696e 695f 7365 7428 2773 656e      ini_set('sen
-000110d0: 646d 6169 6c5f 6672 6f6d 272c 2024 7468  dmail_from', $th
-000110e0: 6973 2d3e 5365 6e64 6572 293b 0a20 2020  is->Sender);.   
-000110f0: 2020 2020 207d 0a20 2020 2020 2020 2024       }.        $
-00011100: 7265 7375 6c74 203d 2066 616c 7365 3b0a  result = false;.
-00011110: 2020 2020 2020 2020 6966 2028 2474 6869          if ($thi
-00011120: 732d 3e53 696e 676c 6554 6f20 2626 2063  s->SingleTo && c
-00011130: 6f75 6e74 2824 746f 4172 7229 203e 2031  ount($toArr) > 1
-00011140: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00011150: 666f 7265 6163 6820 2824 746f 4172 7220  foreach ($toArr 
-00011160: 6173 2024 746f 4164 6472 2920 7b0a 2020  as $toAddr) {.  
-00011170: 2020 2020 2020 2020 2020 2020 2020 2472                $r
-00011180: 6573 756c 7420 3d20 2474 6869 732d 3e6d  esult = $this->m
-00011190: 6169 6c50 6173 7374 6872 7528 2474 6f41  ailPassthru($toA
-000111a0: 6464 722c 2024 7468 6973 2d3e 5375 626a  ddr, $this->Subj
-000111b0: 6563 742c 2024 626f 6479 2c20 2468 6561  ect, $body, $hea
-000111c0: 6465 722c 2024 7061 7261 6d73 293b 0a20  der, $params);. 
-000111d0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-000111e0: 6164 6472 696e 666f 203d 2073 7461 7469  addrinfo = stati
-000111f0: 633a 3a70 6172 7365 4164 6472 6573 7365  c::parseAddresse
-00011200: 7328 2474 6f41 6464 722c 2074 7275 652c  s($toAddr, true,
-00011210: 2024 7468 6973 2d3e 4368 6172 5365 7429   $this->CharSet)
-00011220: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-00011230: 2020 2474 6869 732d 3e64 6f43 616c 6c62    $this->doCallb
-00011240: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
-00011250: 2020 2020 2020 2020 2024 7265 7375 6c74           $result
-00011260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011270: 2020 2020 2020 5b5b 2461 6464 7269 6e66        [[$addrinf
-00011280: 6f5b 2761 6464 7265 7373 275d 2c20 2461  o['address'], $a
-00011290: 6464 7269 6e66 6f5b 276e 616d 6527 5d5d  ddrinfo['name']]
-000112a0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000112b0: 2020 2020 2020 2024 7468 6973 2d3e 6363         $this->cc
-000112c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000112d0: 2020 2020 2020 2474 6869 732d 3e62 6363        $this->bcc
-000112e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000112f0: 2020 2020 2020 2474 6869 732d 3e53 7562        $this->Sub
-00011300: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
-00011310: 2020 2020 2020 2020 2020 2462 6f64 792c            $body,
-00011320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011330: 2020 2020 2024 7468 6973 2d3e 4672 6f6d       $this->From
-00011340: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011350: 2020 2020 2020 5b5d 0a20 2020 2020 2020        [].       
-00011360: 2020 2020 2020 2020 2029 3b0a 2020 2020           );.    
-00011370: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00011380: 2020 7d20 656c 7365 207b 0a20 2020 2020    } else {.     
-00011390: 2020 2020 2020 2024 7265 7375 6c74 203d         $result =
-000113a0: 2024 7468 6973 2d3e 6d61 696c 5061 7373   $this->mailPass
-000113b0: 7468 7275 2824 746f 2c20 2474 6869 732d  thru($to, $this-
-000113c0: 3e53 7562 6a65 6374 2c20 2462 6f64 792c  >Subject, $body,
-000113d0: 2024 6865 6164 6572 2c20 2470 6172 616d   $header, $param
-000113e0: 7329 3b0a 2020 2020 2020 2020 2020 2020  s);.            
-000113f0: 2474 6869 732d 3e64 6f43 616c 6c62 6163  $this->doCallbac
-00011400: 6b28 2472 6573 756c 742c 2024 7468 6973  k($result, $this
-00011410: 2d3e 746f 2c20 2474 6869 732d 3e63 632c  ->to, $this->cc,
-00011420: 2024 7468 6973 2d3e 6263 632c 2024 7468   $this->bcc, $th
-00011430: 6973 2d3e 5375 626a 6563 742c 2024 626f  is->Subject, $bo
-00011440: 6479 2c20 2474 6869 732d 3e46 726f 6d2c  dy, $this->From,
-00011450: 205b 5d29 3b0a 2020 2020 2020 2020 7d0a   []);.        }.
-00011460: 2020 2020 2020 2020 6966 2028 6973 7365          if (isse
-00011470: 7428 246f 6c64 5f66 726f 6d29 2920 7b0a  t($old_from)) {.
-00011480: 2020 2020 2020 2020 2020 2020 696e 695f              ini_
-00011490: 7365 7428 2773 656e 646d 6169 6c5f 6672  set('sendmail_fr
-000114a0: 6f6d 272c 2024 6f6c 645f 6672 6f6d 293b  om', $old_from);
-000114b0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-000114c0: 2020 2069 6620 2821 2472 6573 756c 7429     if (!$result)
-000114d0: 207b 0a20 2020 2020 2020 2020 2020 2074   {.            t
-000114e0: 6872 6f77 206e 6577 2045 7863 6570 7469  hrow new Excepti
-000114f0: 6f6e 2824 7468 6973 2d3e 6c61 6e67 2827  on($this->lang('
-00011500: 696e 7374 616e 7469 6174 6527 292c 2073  instantiate'), s
-00011510: 656c 663a 3a53 544f 505f 4352 4954 4943  elf::STOP_CRITIC
-00011520: 414c 293b 0a20 2020 2020 2020 207d 0a0a  AL);.        }..
-00011530: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00011540: 7275 653b 0a20 2020 207d 0a0a 2020 2020  rue;.    }..    
-00011550: 2f2a 2a0a 2020 2020 202a 2047 6574 2061  /**.     * Get a
-00011560: 6e20 696e 7374 616e 6365 2074 6f20 7573  n instance to us
-00011570: 6520 666f 7220 534d 5450 206f 7065 7261  e for SMTP opera
-00011580: 7469 6f6e 732e 0a20 2020 2020 2a20 4f76  tions..     * Ov
-00011590: 6572 7269 6465 2074 6869 7320 6675 6e63  erride this func
-000115a0: 7469 6f6e 2074 6f20 6c6f 6164 2079 6f75  tion to load you
-000115b0: 7220 6f77 6e20 534d 5450 2069 6d70 6c65  r own SMTP imple
-000115c0: 6d65 6e74 6174 696f 6e2c 0a20 2020 2020  mentation,.     
-000115d0: 2a20 6f72 2073 6574 206f 6e65 2077 6974  * or set one wit
-000115e0: 6820 7365 7453 4d54 5049 6e73 7461 6e63  h setSMTPInstanc
-000115f0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-00011600: 2040 7265 7475 726e 2053 4d54 500a 2020   @return SMTP.  
-00011610: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
-00011620: 2066 756e 6374 696f 6e20 6765 7453 4d54   function getSMT
-00011630: 5049 6e73 7461 6e63 6528 290a 2020 2020  PInstance().    
-00011640: 7b0a 2020 2020 2020 2020 6966 2028 2169  {.        if (!i
-00011650: 735f 6f62 6a65 6374 2824 7468 6973 2d3e  s_object($this->
-00011660: 736d 7470 2929 207b 0a20 2020 2020 2020  smtp)) {.       
-00011670: 2020 2020 2024 7468 6973 2d3e 736d 7470       $this->smtp
-00011680: 203d 206e 6577 2053 4d54 5028 293b 0a20   = new SMTP();. 
-00011690: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-000116a0: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
-000116b0: 736d 7470 3b0a 2020 2020 7d0a 0a20 2020  smtp;.    }..   
-000116c0: 202f 2a2a 0a20 2020 2020 2a20 5072 6f76   /**.     * Prov
-000116d0: 6964 6520 616e 2069 6e73 7461 6e63 6520  ide an instance 
-000116e0: 746f 2075 7365 2066 6f72 2053 4d54 5020  to use for SMTP 
-000116f0: 6f70 6572 6174 696f 6e73 2e0a 2020 2020  operations..    
-00011700: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
-00011710: 6e20 534d 5450 0a20 2020 2020 2a2f 0a20  n SMTP.     */. 
-00011720: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
-00011730: 6f6e 2073 6574 534d 5450 496e 7374 616e  on setSMTPInstan
-00011740: 6365 2853 4d54 5020 2473 6d74 7029 0a20  ce(SMTP $smtp). 
-00011750: 2020 207b 0a20 2020 2020 2020 2024 7468     {.        $th
-00011760: 6973 2d3e 736d 7470 203d 2024 736d 7470  is->smtp = $smtp
-00011770: 3b0a 0a20 2020 2020 2020 2072 6574 7572  ;..        retur
-00011780: 6e20 2474 6869 732d 3e73 6d74 703b 0a20  n $this->smtp;. 
-00011790: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-000117a0: 2020 202a 2053 656e 6420 6d61 696c 2076     * Send mail v
-000117b0: 6961 2053 4d54 502e 0a20 2020 2020 2a20  ia SMTP..     * 
-000117c0: 5265 7475 726e 7320 6661 6c73 6520 6966  Returns false if
-000117d0: 2074 6865 7265 2069 7320 6120 6261 6420   there is a bad 
-000117e0: 4d41 494c 2046 524f 4d2c 2052 4350 542c  MAIL FROM, RCPT,
-000117f0: 206f 7220 4441 5441 2069 6e70 7574 2e0a   or DATA input..
-00011800: 2020 2020 202a 0a20 2020 2020 2a20 4073       *.     * @s
-00011810: 6565 2050 4850 4d61 696c 6572 3a3a 7365  ee PHPMailer::se
-00011820: 7453 4d54 5049 6e73 7461 6e63 6528 2920  tSMTPInstance() 
-00011830: 746f 2075 7365 2061 2064 6966 6665 7265  to use a differe
-00011840: 6e74 2063 6c61 7373 2e0a 2020 2020 202a  nt class..     *
-00011850: 0a20 2020 2020 2a20 4075 7365 7320 5c50  .     * @uses \P
-00011860: 4850 4d61 696c 6572 5c50 4850 4d61 696c  HPMailer\PHPMail
-00011870: 6572 5c53 4d54 500a 2020 2020 202a 0a20  er\SMTP.     *. 
-00011880: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-00011890: 696e 6720 2468 6561 6465 7220 5468 6520  ing $header The 
-000118a0: 6d65 7373 6167 6520 6865 6164 6572 730a  message headers.
-000118b0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-000118c0: 7269 6e67 2024 626f 6479 2020 2054 6865  ring $body   The
-000118d0: 206d 6573 7361 6765 2062 6f64 790a 2020   message body.  
-000118e0: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
-000118f0: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
-00011900: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00011910: 7572 6e20 626f 6f6c 0a20 2020 2020 2a2f  urn bool.     */
-00011920: 0a20 2020 2070 726f 7465 6374 6564 2066  .    protected f
-00011930: 756e 6374 696f 6e20 736d 7470 5365 6e64  unction smtpSend
-00011940: 2824 6865 6164 6572 2c20 2462 6f64 7929  ($header, $body)
-00011950: 0a20 2020 207b 0a20 2020 2020 2020 2024  .    {.        $
-00011960: 6865 6164 6572 203d 2073 7461 7469 633a  header = static:
-00011970: 3a73 7472 6970 5472 6169 6c69 6e67 5753  :stripTrailingWS
-00011980: 5028 2468 6561 6465 7229 202e 2073 7461  P($header) . sta
-00011990: 7469 633a 3a24 4c45 202e 2073 7461 7469  tic::$LE . stati
-000119a0: 633a 3a24 4c45 3b0a 2020 2020 2020 2020  c::$LE;.        
-000119b0: 2462 6164 5f72 6370 7420 3d20 5b5d 3b0a  $bad_rcpt = [];.
-000119c0: 2020 2020 2020 2020 6966 2028 2124 7468          if (!$th
-000119d0: 6973 2d3e 736d 7470 436f 6e6e 6563 7428  is->smtpConnect(
-000119e0: 2474 6869 732d 3e53 4d54 504f 7074 696f  $this->SMTPOptio
-000119f0: 6e73 2929 207b 0a20 2020 2020 2020 2020  ns)) {.         
-00011a00: 2020 2074 6872 6f77 206e 6577 2045 7863     throw new Exc
-00011a10: 6570 7469 6f6e 2824 7468 6973 2d3e 6c61  eption($this->la
-00011a20: 6e67 2827 736d 7470 5f63 6f6e 6e65 6374  ng('smtp_connect
-00011a30: 5f66 6169 6c65 6427 292c 2073 656c 663a  _failed'), self:
-00011a40: 3a53 544f 505f 4352 4954 4943 414c 293b  :STOP_CRITICAL);
-00011a50: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-00011a60: 2020 202f 2f53 656e 6465 7220 616c 7265     //Sender alre
-00011a70: 6164 7920 7661 6c69 6461 7465 6420 696e  ady validated in
-00011a80: 2070 7265 5365 6e64 2829 0a20 2020 2020   preSend().     
-00011a90: 2020 2069 6620 2827 2720 3d3d 3d20 2474     if ('' === $t
-00011aa0: 6869 732d 3e53 656e 6465 7229 207b 0a20  his->Sender) {. 
-00011ab0: 2020 2020 2020 2020 2020 2024 736d 7470             $smtp
-00011ac0: 5f66 726f 6d20 3d20 2474 6869 732d 3e46  _from = $this->F
-00011ad0: 726f 6d3b 0a20 2020 2020 2020 207d 2065  rom;.        } e
-00011ae0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-00011af0: 2020 2473 6d74 705f 6672 6f6d 203d 2024    $smtp_from = $
-00011b00: 7468 6973 2d3e 5365 6e64 6572 3b0a 2020  this->Sender;.  
-00011b10: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00011b20: 6966 2028 2124 7468 6973 2d3e 736d 7470  if (!$this->smtp
-00011b30: 2d3e 6d61 696c 2824 736d 7470 5f66 726f  ->mail($smtp_fro
-00011b40: 6d29 2920 7b0a 2020 2020 2020 2020 2020  m)) {.          
-00011b50: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
-00011b60: 7228 2474 6869 732d 3e6c 616e 6728 2766  r($this->lang('f
-00011b70: 726f 6d5f 6661 696c 6564 2729 202e 2024  rom_failed') . $
-00011b80: 736d 7470 5f66 726f 6d20 2e20 2720 3a20  smtp_from . ' : 
-00011b90: 2720 2e20 696d 706c 6f64 6528 272c 272c  ' . implode(',',
-00011ba0: 2024 7468 6973 2d3e 736d 7470 2d3e 6765   $this->smtp->ge
-00011bb0: 7445 7272 6f72 2829 2929 3b0a 2020 2020  tError()));.    
-00011bc0: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
-00011bd0: 7720 4578 6365 7074 696f 6e28 2474 6869  w Exception($thi
-00011be0: 732d 3e45 7272 6f72 496e 666f 2c20 7365  s->ErrorInfo, se
-00011bf0: 6c66 3a3a 5354 4f50 5f43 5249 5449 4341  lf::STOP_CRITICA
-00011c00: 4c29 3b0a 2020 2020 2020 2020 7d0a 0a20  L);.        }.. 
-00011c10: 2020 2020 2020 2024 6361 6c6c 6261 636b         $callback
-00011c20: 7320 3d20 5b5d 3b0a 2020 2020 2020 2020  s = [];.        
-00011c30: 2f2f 4174 7465 6d70 7420 746f 2073 656e  //Attempt to sen
-00011c40: 6420 746f 2061 6c6c 2072 6563 6970 6965  d to all recipie
-00011c50: 6e74 730a 2020 2020 2020 2020 666f 7265  nts.        fore
-00011c60: 6163 6820 285b 2474 6869 732d 3e74 6f2c  ach ([$this->to,
-00011c70: 2024 7468 6973 2d3e 6363 2c20 2474 6869   $this->cc, $thi
-00011c80: 732d 3e62 6363 5d20 6173 2024 746f 6772  s->bcc] as $togr
-00011c90: 6f75 7029 207b 0a20 2020 2020 2020 2020  oup) {.         
-00011ca0: 2020 2066 6f72 6561 6368 2028 2474 6f67     foreach ($tog
-00011cb0: 726f 7570 2061 7320 2474 6f29 207b 0a20  roup as $to) {. 
-00011cc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011cd0: 6620 2821 2474 6869 732d 3e73 6d74 702d  f (!$this->smtp-
-00011ce0: 3e72 6563 6970 6965 6e74 2824 746f 5b30  >recipient($to[0
-00011cf0: 5d2c 2024 7468 6973 2d3e 6473 6e29 2920  ], $this->dsn)) 
-00011d00: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00011d10: 2020 2020 2020 2465 7272 6f72 203d 2024        $error = $
-00011d20: 7468 6973 2d3e 736d 7470 2d3e 6765 7445  this->smtp->getE
-00011d30: 7272 6f72 2829 3b0a 2020 2020 2020 2020  rror();.        
-00011d40: 2020 2020 2020 2020 2020 2020 2462 6164              $bad
-00011d50: 5f72 6370 745b 5d20 3d20 5b27 746f 2720  _rcpt[] = ['to' 
-00011d60: 3d3e 2024 746f 5b30 5d2c 2027 6572 726f  => $to[0], 'erro
-00011d70: 7227 203d 3e20 2465 7272 6f72 5b27 6465  r' => $error['de
-00011d80: 7461 696c 275d 5d3b 0a20 2020 2020 2020  tail']];.       
-00011d90: 2020 2020 2020 2020 2020 2020 2024 6973               $is
-00011da0: 5365 6e74 203d 2066 616c 7365 3b0a 2020  Sent = false;.  
-00011db0: 2020 2020 2020 2020 2020 2020 2020 7d20                } 
-00011dc0: 656c 7365 207b 0a20 2020 2020 2020 2020  else {.         
-00011dd0: 2020 2020 2020 2020 2020 2024 6973 5365             $isSe
-00011de0: 6e74 203d 2074 7275 653b 0a20 2020 2020  nt = true;.     
-00011df0: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
-00011e00: 2020 2020 2020 2020 2020 2020 2020 2463                $c
-00011e10: 616c 6c62 6163 6b73 5b5d 203d 205b 2769  allbacks[] = ['i
-00011e20: 7373 656e 7427 203d 3e20 2469 7353 656e  ssent' => $isSen
-00011e30: 742c 2027 746f 2720 3d3e 2024 746f 5b30  t, 'to' => $to[0
-00011e40: 5d2c 2027 6e61 6d65 2720 3d3e 2024 746f  ], 'name' => $to
-00011e50: 5b31 5d5d 3b0a 2020 2020 2020 2020 2020  [1]];.          
-00011e60: 2020 7d0a 2020 2020 2020 2020 7d0a 0a20    }.        }.. 
-00011e70: 2020 2020 2020 202f 2f4f 6e6c 7920 7365         //Only se
-00011e80: 6e64 2074 6865 2044 4154 4120 636f 6d6d  nd the DATA comm
-00011e90: 616e 6420 6966 2077 6520 6861 7665 2076  and if we have v
-00011ea0: 6961 626c 6520 7265 6369 7069 656e 7473  iable recipients
-00011eb0: 0a20 2020 2020 2020 2069 6620 2828 636f  .        if ((co
-00011ec0: 756e 7428 2474 6869 732d 3e61 6c6c 5f72  unt($this->all_r
-00011ed0: 6563 6970 6965 6e74 7329 203e 2063 6f75  ecipients) > cou
-00011ee0: 6e74 2824 6261 645f 7263 7074 2929 2026  nt($bad_rcpt)) &
-00011ef0: 2620 2124 7468 6973 2d3e 736d 7470 2d3e  & !$this->smtp->
-00011f00: 6461 7461 2824 6865 6164 6572 202e 2024  data($header . $
-00011f10: 626f 6479 2929 207b 0a20 2020 2020 2020  body)) {.       
-00011f20: 2020 2020 2074 6872 6f77 206e 6577 2045       throw new E
-00011f30: 7863 6570 7469 6f6e 2824 7468 6973 2d3e  xception($this->
-00011f40: 6c61 6e67 2827 6461 7461 5f6e 6f74 5f61  lang('data_not_a
-00011f50: 6363 6570 7465 6427 292c 2073 656c 663a  ccepted'), self:
-00011f60: 3a53 544f 505f 4352 4954 4943 414c 293b  :STOP_CRITICAL);
-00011f70: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00011f80: 2020 2020 2473 6d74 705f 7472 616e 7361      $smtp_transa
-00011f90: 6374 696f 6e5f 6964 203d 2024 7468 6973  ction_id = $this
-00011fa0: 2d3e 736d 7470 2d3e 6765 744c 6173 7454  ->smtp->getLastT
-00011fb0: 7261 6e73 6163 7469 6f6e 4944 2829 3b0a  ransactionID();.
-00011fc0: 0a20 2020 2020 2020 2069 6620 2824 7468  .        if ($th
-00011fd0: 6973 2d3e 534d 5450 4b65 6570 416c 6976  is->SMTPKeepAliv
-00011fe0: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-00011ff0: 2024 7468 6973 2d3e 736d 7470 2d3e 7265   $this->smtp->re
-00012000: 7365 7428 293b 0a20 2020 2020 2020 207d  set();.        }
-00012010: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
-00012020: 2020 2020 2474 6869 732d 3e73 6d74 702d      $this->smtp-
-00012030: 3e71 7569 7428 293b 0a20 2020 2020 2020  >quit();.       
-00012040: 2020 2020 2024 7468 6973 2d3e 736d 7470       $this->smtp
-00012050: 2d3e 636c 6f73 6528 293b 0a20 2020 2020  ->close();.     
-00012060: 2020 207d 0a0a 2020 2020 2020 2020 666f     }..        fo
-00012070: 7265 6163 6820 2824 6361 6c6c 6261 636b  reach ($callback
-00012080: 7320 6173 2024 6362 2920 7b0a 2020 2020  s as $cb) {.    
-00012090: 2020 2020 2020 2020 2474 6869 732d 3e64          $this->d
-000120a0: 6f43 616c 6c62 6163 6b28 0a20 2020 2020  oCallback(.     
-000120b0: 2020 2020 2020 2020 2020 2024 6362 5b27             $cb['
-000120c0: 6973 7365 6e74 275d 2c0a 2020 2020 2020  issent'],.      
-000120d0: 2020 2020 2020 2020 2020 5b5b 2463 625b            [[$cb[
-000120e0: 2774 6f27 5d2c 2024 6362 5b27 6e61 6d65  'to'], $cb['name
-000120f0: 275d 5d5d 2c0a 2020 2020 2020 2020 2020  ']]],.          
-00012100: 2020 2020 2020 5b5d 2c0a 2020 2020 2020        [],.      
-00012110: 2020 2020 2020 2020 2020 5b5d 2c0a 2020            [],.  
-00012120: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-00012130: 6869 732d 3e53 7562 6a65 6374 2c0a 2020  his->Subject,.  
-00012140: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-00012150: 6f64 792c 0a20 2020 2020 2020 2020 2020  ody,.           
-00012160: 2020 2020 2024 7468 6973 2d3e 4672 6f6d       $this->From
-00012170: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012180: 2020 5b27 736d 7470 5f74 7261 6e73 6163    ['smtp_transac
-00012190: 7469 6f6e 5f69 6427 203d 3e20 2473 6d74  tion_id' => $smt
-000121a0: 705f 7472 616e 7361 6374 696f 6e5f 6964  p_transaction_id
-000121b0: 5d0a 2020 2020 2020 2020 2020 2020 293b  ].            );
-000121c0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-000121d0: 2020 2020 2f2f 4372 6561 7465 2065 7272      //Create err
-000121e0: 6f72 206d 6573 7361 6765 2066 6f72 2061  or message for a
-000121f0: 6e79 2062 6164 2061 6464 7265 7373 6573  ny bad addresses
-00012200: 0a20 2020 2020 2020 2069 6620 2863 6f75  .        if (cou
-00012210: 6e74 2824 6261 645f 7263 7074 2920 3e20  nt($bad_rcpt) > 
-00012220: 3029 207b 0a20 2020 2020 2020 2020 2020  0) {.           
-00012230: 2024 6572 7273 7472 203d 2027 273b 0a20   $errstr = '';. 
-00012240: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
-00012250: 6368 2028 2462 6164 5f72 6370 7420 6173  ch ($bad_rcpt as
-00012260: 2024 6261 6429 207b 0a20 2020 2020 2020   $bad) {.       
-00012270: 2020 2020 2020 2020 2024 6572 7273 7472           $errstr
-00012280: 202e 3d20 2462 6164 5b27 746f 275d 202e   .= $bad['to'] .
-00012290: 2027 3a20 2720 2e20 2462 6164 5b27 6572   ': ' . $bad['er
-000122a0: 726f 7227 5d3b 0a20 2020 2020 2020 2020  ror'];.         
-000122b0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-000122c0: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
-000122d0: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
-000122e0: 2827 7265 6369 7069 656e 7473 5f66 6169  ('recipients_fai
-000122f0: 6c65 6427 2920 2e20 2465 7272 7374 722c  led') . $errstr,
-00012300: 2073 656c 663a 3a53 544f 505f 434f 4e54   self::STOP_CONT
-00012310: 494e 5545 293b 0a20 2020 2020 2020 207d  INUE);.        }
-00012320: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00012330: 2074 7275 653b 0a20 2020 207d 0a0a 2020   true;.    }..  
-00012340: 2020 2f2a 2a0a 2020 2020 202a 2049 6e69    /**.     * Ini
-00012350: 7469 6174 6520 6120 636f 6e6e 6563 7469  tiate a connecti
-00012360: 6f6e 2074 6f20 616e 2053 4d54 5020 7365  on to an SMTP se
-00012370: 7276 6572 2e0a 2020 2020 202a 2052 6574  rver..     * Ret
-00012380: 7572 6e73 2066 616c 7365 2069 6620 7468  urns false if th
-00012390: 6520 6f70 6572 6174 696f 6e20 6661 696c  e operation fail
-000123a0: 6564 2e0a 2020 2020 202a 0a20 2020 2020  ed..     *.     
-000123b0: 2a20 4070 6172 616d 2061 7272 6179 2024  * @param array $
-000123c0: 6f70 7469 6f6e 7320 416e 2061 7272 6179  options An array
-000123d0: 206f 6620 6f70 7469 6f6e 7320 636f 6d70   of options comp
-000123e0: 6174 6962 6c65 2077 6974 6820 7374 7265  atible with stre
-000123f0: 616d 5f63 6f6e 7465 7874 5f63 7265 6174  am_context_creat
-00012400: 6528 290a 2020 2020 202a 0a20 2020 2020  e().     *.     
-00012410: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
-00012420: 696f 6e0a 2020 2020 202a 0a20 2020 2020  ion.     *.     
-00012430: 2a20 4075 7365 7320 5c50 4850 4d61 696c  * @uses \PHPMail
-00012440: 6572 5c50 4850 4d61 696c 6572 5c53 4d54  er\PHPMailer\SMT
-00012450: 500a 2020 2020 202a 0a20 2020 2020 2a20  P.     *.     * 
-00012460: 4072 6574 7572 6e20 626f 6f6c 0a20 2020  @return bool.   
-00012470: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-00012480: 6675 6e63 7469 6f6e 2073 6d74 7043 6f6e  function smtpCon
-00012490: 6e65 6374 2824 6f70 7469 6f6e 7320 3d20  nect($options = 
-000124a0: 6e75 6c6c 290a 2020 2020 7b0a 2020 2020  null).    {.    
-000124b0: 2020 2020 6966 2028 6e75 6c6c 203d 3d3d      if (null ===
-000124c0: 2024 7468 6973 2d3e 736d 7470 2920 7b0a   $this->smtp) {.
-000124d0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-000124e0: 732d 3e73 6d74 7020 3d20 2474 6869 732d  s->smtp = $this-
-000124f0: 3e67 6574 534d 5450 496e 7374 616e 6365  >getSMTPInstance
-00012500: 2829 3b0a 2020 2020 2020 2020 7d0a 0a20  ();.        }.. 
-00012510: 2020 2020 2020 202f 2f49 6620 6e6f 206f         //If no o
-00012520: 7074 696f 6e73 2061 7265 2070 726f 7669  ptions are provi
-00012530: 6465 642c 2075 7365 2077 6861 7465 7665  ded, use whateve
-00012540: 7220 6973 2073 6574 2069 6e20 7468 6520  r is set in the 
-00012550: 696e 7374 616e 6365 0a20 2020 2020 2020  instance.       
-00012560: 2069 6620 286e 756c 6c20 3d3d 3d20 246f   if (null === $o
-00012570: 7074 696f 6e73 2920 7b0a 2020 2020 2020  ptions) {.      
-00012580: 2020 2020 2020 246f 7074 696f 6e73 203d        $options =
-00012590: 2024 7468 6973 2d3e 534d 5450 4f70 7469   $this->SMTPOpti
-000125a0: 6f6e 733b 0a20 2020 2020 2020 207d 0a0a  ons;.        }..
-000125b0: 2020 2020 2020 2020 2f2f 416c 7265 6164          //Alread
-000125c0: 7920 636f 6e6e 6563 7465 643f 0a20 2020  y connected?.   
-000125d0: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
-000125e0: 736d 7470 2d3e 636f 6e6e 6563 7465 6428  smtp->connected(
-000125f0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00012600: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
-00012610: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00012620: 2024 7468 6973 2d3e 736d 7470 2d3e 7365   $this->smtp->se
-00012630: 7454 696d 656f 7574 2824 7468 6973 2d3e  tTimeout($this->
-00012640: 5469 6d65 6f75 7429 3b0a 2020 2020 2020  Timeout);.      
-00012650: 2020 2474 6869 732d 3e73 6d74 702d 3e73    $this->smtp->s
-00012660: 6574 4465 6275 674c 6576 656c 2824 7468  etDebugLevel($th
-00012670: 6973 2d3e 534d 5450 4465 6275 6729 3b0a  is->SMTPDebug);.
-00012680: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
-00012690: 6d74 702d 3e73 6574 4465 6275 674f 7574  mtp->setDebugOut
-000126a0: 7075 7428 2474 6869 732d 3e44 6562 7567  put($this->Debug
-000126b0: 6f75 7470 7574 293b 0a20 2020 2020 2020  output);.       
-000126c0: 2024 7468 6973 2d3e 736d 7470 2d3e 7365   $this->smtp->se
-000126d0: 7456 6572 7028 2474 6869 732d 3e64 6f5f  tVerp($this->do_
-000126e0: 7665 7270 293b 0a20 2020 2020 2020 2069  verp);.        i
-000126f0: 6620 2824 7468 6973 2d3e 486f 7374 203d  f ($this->Host =
-00012700: 3d3d 206e 756c 6c29 207b 0a20 2020 2020  == null) {.     
-00012710: 2020 2020 2020 2024 7468 6973 2d3e 486f         $this->Ho
-00012720: 7374 203d 2027 6c6f 6361 6c68 6f73 7427  st = 'localhost'
-00012730: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
-00012740: 2020 2020 2468 6f73 7473 203d 2065 7870      $hosts = exp
-00012750: 6c6f 6465 2827 3b27 2c20 2474 6869 732d  lode(';', $this-
-00012760: 3e48 6f73 7429 3b0a 2020 2020 2020 2020  >Host);.        
-00012770: 246c 6173 7465 7863 6570 7469 6f6e 203d  $lastexception =
-00012780: 206e 756c 6c3b 0a0a 2020 2020 2020 2020   null;..        
-00012790: 666f 7265 6163 6820 2824 686f 7374 7320  foreach ($hosts 
-000127a0: 6173 2024 686f 7374 656e 7472 7929 207b  as $hostentry) {
-000127b0: 0a20 2020 2020 2020 2020 2020 2024 686f  .            $ho
-000127c0: 7374 696e 666f 203d 205b 5d3b 0a20 2020  stinfo = [];.   
-000127d0: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-000127e0: 2020 2020 2020 2020 2020 2020 2020 2170                !p
-000127f0: 7265 675f 6d61 7463 6828 0a20 2020 2020  reg_match(.     
-00012800: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00012810: 2f5e 283f 3a28 7373 6c7c 746c 7329 3a5c  /^(?:(ssl|tls):\
-00012820: 2f5c 2f29 3f28 2e2b 3f29 283f 3a3a 285c  /\/)?(.+?)(?::(\
-00012830: 642b 2929 3f24 2f27 2c0a 2020 2020 2020  d+))?$/',.      
-00012840: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00012850: 696d 2824 686f 7374 656e 7472 7929 2c0a  im($hostentry),.
-00012860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012870: 2020 2020 2468 6f73 7469 6e66 6f0a 2020      $hostinfo.  
-00012880: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00012890: 2020 2020 2020 2020 2020 2020 2920 7b0a              ) {.
-000128a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128b0: 2474 6869 732d 3e65 6465 6275 6728 2474  $this->edebug($t
-000128c0: 6869 732d 3e6c 616e 6728 2769 6e76 616c  his->lang('inval
-000128d0: 6964 5f68 6f73 7465 6e74 7279 2729 202e  id_hostentry') .
-000128e0: 2027 2027 202e 2074 7269 6d28 2468 6f73   ' ' . trim($hos
-000128f0: 7465 6e74 7279 2929 3b0a 2020 2020 2020  tentry));.      
-00012900: 2020 2020 2020 2020 2020 2f2f 4e6f 7420            //Not 
-00012910: 6120 7661 6c69 6420 686f 7374 2065 6e74  a valid host ent
-00012920: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-00012930: 2020 2063 6f6e 7469 6e75 653b 0a20 2020     continue;.   
-00012940: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00012950: 2020 2020 2020 202f 2f24 686f 7374 696e         //$hostin
-00012960: 666f 5b31 5d3a 206f 7074 696f 6e61 6c20  fo[1]: optional 
-00012970: 7373 6c20 6f72 2074 6c73 2070 7265 6669  ssl or tls prefi
-00012980: 780a 2020 2020 2020 2020 2020 2020 2f2f  x.            //
-00012990: 2468 6f73 7469 6e66 6f5b 325d 3a20 7468  $hostinfo[2]: th
-000129a0: 6520 686f 7374 6e61 6d65 0a20 2020 2020  e hostname.     
-000129b0: 2020 2020 2020 202f 2f24 686f 7374 696e         //$hostin
-000129c0: 666f 5b33 5d3a 206f 7074 696f 6e61 6c20  fo[3]: optional 
-000129d0: 706f 7274 206e 756d 6265 720a 2020 2020  port number.    
-000129e0: 2020 2020 2020 2020 2f2f 5468 6520 686f          //The ho
-000129f0: 7374 2073 7472 696e 6720 7072 6566 6978  st string prefix
-00012a00: 2063 616e 2074 656d 706f 7261 7269 6c79   can temporarily
-00012a10: 206f 7665 7272 6964 6520 7468 6520 6375   override the cu
-00012a20: 7272 656e 7420 7365 7474 696e 6720 666f  rrent setting fo
-00012a30: 7220 534d 5450 5365 6375 7265 0a20 2020  r SMTPSecure.   
-00012a40: 2020 2020 2020 2020 202f 2f49 6620 6974           //If it
-00012a50: 2773 206e 6f74 2073 7065 6369 6669 6564  's not specified
-00012a60: 2c20 7468 6520 6465 6661 756c 7420 7661  , the default va
-00012a70: 6c75 6520 6973 2075 7365 640a 0a20 2020  lue is used..   
-00012a80: 2020 2020 2020 2020 202f 2f43 6865 636b           //Check
-00012a90: 2074 6865 2068 6f73 7420 6e61 6d65 2069   the host name i
-00012aa0: 7320 6120 7661 6c69 6420 6e61 6d65 206f  s a valid name o
-00012ab0: 7220 4950 2061 6464 7265 7373 2062 6566  r IP address bef
-00012ac0: 6f72 6520 7472 7969 6e67 2074 6f20 7573  ore trying to us
-00012ad0: 6520 6974 0a20 2020 2020 2020 2020 2020  e it.           
-00012ae0: 2069 6620 2821 7374 6174 6963 3a3a 6973   if (!static::is
-00012af0: 5661 6c69 6448 6f73 7428 2468 6f73 7469  ValidHost($hosti
-00012b00: 6e66 6f5b 325d 2929 207b 0a20 2020 2020  nfo[2])) {.     
-00012b10: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-00012b20: 2d3e 6564 6562 7567 2824 7468 6973 2d3e  ->edebug($this->
-00012b30: 6c61 6e67 2827 696e 7661 6c69 645f 686f  lang('invalid_ho
-00012b40: 7374 2729 202e 2027 2027 202e 2024 686f  st') . ' ' . $ho
-00012b50: 7374 696e 666f 5b32 5d29 3b0a 2020 2020  stinfo[2]);.    
-00012b60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00012b70: 696e 7565 3b0a 2020 2020 2020 2020 2020  inue;.          
-00012b80: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00012b90: 2470 7265 6669 7820 3d20 2727 3b0a 2020  $prefix = '';.  
-00012ba0: 2020 2020 2020 2020 2020 2473 6563 7572            $secur
-00012bb0: 6520 3d20 2474 6869 732d 3e53 4d54 5053  e = $this->SMTPS
-00012bc0: 6563 7572 653b 0a20 2020 2020 2020 2020  ecure;.         
-00012bd0: 2020 2024 746c 7320 3d20 2873 7461 7469     $tls = (stati
-00012be0: 633a 3a45 4e43 5259 5054 494f 4e5f 5354  c::ENCRYPTION_ST
-00012bf0: 4152 5454 4c53 203d 3d3d 2024 7468 6973  ARTTLS === $this
-00012c00: 2d3e 534d 5450 5365 6375 7265 293b 0a20  ->SMTPSecure);. 
-00012c10: 2020 2020 2020 2020 2020 2069 6620 2827             if ('
-00012c20: 7373 6c27 203d 3d3d 2024 686f 7374 696e  ssl' === $hostin
-00012c30: 666f 5b31 5d20 7c7c 2028 2727 203d 3d3d  fo[1] || ('' ===
-00012c40: 2024 686f 7374 696e 666f 5b31 5d20 2626   $hostinfo[1] &&
-00012c50: 2073 7461 7469 633a 3a45 4e43 5259 5054   static::ENCRYPT
-00012c60: 494f 4e5f 534d 5450 5320 3d3d 3d20 2474  ION_SMTPS === $t
-00012c70: 6869 732d 3e53 4d54 5053 6563 7572 6529  his->SMTPSecure)
-00012c80: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00012c90: 2020 2020 2470 7265 6669 7820 3d20 2773      $prefix = 's
-00012ca0: 736c 3a2f 2f27 3b0a 2020 2020 2020 2020  sl://';.        
-00012cb0: 2020 2020 2020 2020 2474 6c73 203d 2066          $tls = f
-00012cc0: 616c 7365 3b20 2f2f 4361 6e27 7420 6861  alse; //Can't ha
-00012cd0: 7665 2053 534c 2061 6e64 2054 4c53 2061  ve SSL and TLS a
-00012ce0: 7420 7468 6520 7361 6d65 2074 696d 650a  t the same time.
-00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d00: 2473 6563 7572 6520 3d20 7374 6174 6963  $secure = static
-00012d10: 3a3a 454e 4352 5950 5449 4f4e 5f53 4d54  ::ENCRYPTION_SMT
-00012d20: 5053 3b0a 2020 2020 2020 2020 2020 2020  PS;.            
-00012d30: 7d20 656c 7365 6966 2028 2774 6c73 2720  } elseif ('tls' 
-00012d40: 3d3d 3d20 2468 6f73 7469 6e66 6f5b 315d  === $hostinfo[1]
-00012d50: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00012d60: 2020 2020 2474 6c73 203d 2074 7275 653b      $tls = true;
-00012d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d80: 202f 2f54 4c53 2064 6f65 736e 2774 2075   //TLS doesn't u
-00012d90: 7365 2061 2070 7265 6669 780a 2020 2020  se a prefix.    
-00012da0: 2020 2020 2020 2020 2020 2020 2473 6563              $sec
-00012db0: 7572 6520 3d20 7374 6174 6963 3a3a 454e  ure = static::EN
-00012dc0: 4352 5950 5449 4f4e 5f53 5441 5254 544c  CRYPTION_STARTTL
-00012dd0: 533b 0a20 2020 2020 2020 2020 2020 207d  S;.            }
-00012de0: 0a20 2020 2020 2020 2020 2020 202f 2f44  .            //D
-00012df0: 6f20 7765 206e 6565 6420 7468 6520 4f70  o we need the Op
-00012e00: 656e 5353 4c20 6578 7465 6e73 696f 6e3f  enSSL extension?
-00012e10: 0a20 2020 2020 2020 2020 2020 2024 7373  .            $ss
-00012e20: 6c65 7874 203d 2064 6566 696e 6564 2827  lext = defined('
-00012e30: 4f50 454e 5353 4c5f 414c 474f 5f53 4841  OPENSSL_ALGO_SHA
-00012e40: 3235 3627 293b 0a20 2020 2020 2020 2020  256');.         
-00012e50: 2020 2069 6620 2873 7461 7469 633a 3a45     if (static::E
-00012e60: 4e43 5259 5054 494f 4e5f 5354 4152 5454  NCRYPTION_STARTT
-00012e70: 4c53 203d 3d3d 2024 7365 6375 7265 207c  LS === $secure |
-00012e80: 7c20 7374 6174 6963 3a3a 454e 4352 5950  | static::ENCRYP
-00012e90: 5449 4f4e 5f53 4d54 5053 203d 3d3d 2024  TION_SMTPS === $
-00012ea0: 7365 6375 7265 2920 7b0a 2020 2020 2020  secure) {.      
-00012eb0: 2020 2020 2020 2020 2020 2f2f 4368 6563            //Chec
-00012ec0: 6b20 666f 7220 616e 204f 7065 6e53 534c  k for an OpenSSL
-00012ed0: 2063 6f6e 7374 616e 7420 7261 7468 6572   constant rather
-00012ee0: 2074 6861 6e20 7573 696e 6720 6578 7465   than using exte
-00012ef0: 6e73 696f 6e5f 6c6f 6164 6564 2c20 7768  nsion_loaded, wh
-00012f00: 6963 6820 6973 2073 6f6d 6574 696d 6573  ich is sometimes
-00012f10: 2064 6973 6162 6c65 640a 2020 2020 2020   disabled.      
-00012f20: 2020 2020 2020 2020 2020 6966 2028 2124            if (!$
-00012f30: 7373 6c65 7874 2920 7b0a 2020 2020 2020  sslext) {.      
-00012f40: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00012f50: 726f 7720 6e65 7720 4578 6365 7074 696f  row new Exceptio
-00012f60: 6e28 2474 6869 732d 3e6c 616e 6728 2765  n($this->lang('e
-00012f70: 7874 656e 7369 6f6e 5f6d 6973 7369 6e67  xtension_missing
-00012f80: 2729 202e 2027 6f70 656e 7373 6c27 2c20  ') . 'openssl', 
-00012f90: 7365 6c66 3a3a 5354 4f50 5f43 5249 5449  self::STOP_CRITI
-00012fa0: 4341 4c29 3b0a 2020 2020 2020 2020 2020  CAL);.          
-00012fb0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00012fc0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00012fd0: 2020 2468 6f73 7420 3d20 2468 6f73 7469    $host = $hosti
-00012fe0: 6e66 6f5b 325d 3b0a 2020 2020 2020 2020  nfo[2];.        
-00012ff0: 2020 2020 2470 6f72 7420 3d20 2474 6869      $port = $thi
-00013000: 732d 3e50 6f72 743b 0a20 2020 2020 2020  s->Port;.       
-00013010: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00013020: 2020 2020 2020 2020 2020 6172 7261 795f            array_
-00013030: 6b65 795f 6578 6973 7473 2833 2c20 2468  key_exists(3, $h
-00013040: 6f73 7469 6e66 6f29 2026 260a 2020 2020  ostinfo) &&.    
-00013050: 2020 2020 2020 2020 2020 2020 6973 5f6e              is_n
-00013060: 756d 6572 6963 2824 686f 7374 696e 666f  umeric($hostinfo
-00013070: 5b33 5d29 2026 260a 2020 2020 2020 2020  [3]) &&.        
-00013080: 2020 2020 2020 2020 2468 6f73 7469 6e66          $hostinf
-00013090: 6f5b 335d 203e 2030 2026 260a 2020 2020  o[3] > 0 &&.    
-000130a0: 2020 2020 2020 2020 2020 2020 2468 6f73              $hos
-000130b0: 7469 6e66 6f5b 335d 203c 2036 3535 3336  tinfo[3] < 65536
-000130c0: 0a20 2020 2020 2020 2020 2020 2029 207b  .            ) {
-000130d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000130e0: 2024 706f 7274 203d 2028 696e 7429 2024   $port = (int) $
-000130f0: 686f 7374 696e 666f 5b33 5d3b 0a20 2020  hostinfo[3];.   
-00013100: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00013110: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
-00013120: 2d3e 736d 7470 2d3e 636f 6e6e 6563 7428  ->smtp->connect(
-00013130: 2470 7265 6669 7820 2e20 2468 6f73 742c  $prefix . $host,
-00013140: 2024 706f 7274 2c20 2474 6869 732d 3e54   $port, $this->T
-00013150: 696d 656f 7574 2c20 246f 7074 696f 6e73  imeout, $options
-00013160: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00013170: 2020 2020 2074 7279 207b 0a20 2020 2020       try {.     
-00013180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013190: 6620 2824 7468 6973 2d3e 4865 6c6f 2920  f ($this->Helo) 
-000131a0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-000131b0: 2020 2020 2020 2020 2020 2468 656c 6c6f            $hello
-000131c0: 203d 2024 7468 6973 2d3e 4865 6c6f 3b0a   = $this->Helo;.
-000131d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131e0: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
-000131f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013200: 2020 2020 2024 6865 6c6c 6f20 3d20 2474       $hello = $t
-00013210: 6869 732d 3e73 6572 7665 7248 6f73 746e  his->serverHostn
-00013220: 616d 6528 293b 0a20 2020 2020 2020 2020  ame();.         
-00013230: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00013240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013250: 2024 7468 6973 2d3e 736d 7470 2d3e 6865   $this->smtp->he
-00013260: 6c6c 6f28 2468 656c 6c6f 293b 0a20 2020  llo($hello);.   
-00013270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013280: 202f 2f41 7574 6f6d 6174 6963 616c 6c79   //Automatically
-00013290: 2065 6e61 626c 6520 544c 5320 656e 6372   enable TLS encr
-000132a0: 7970 7469 6f6e 2069 663a 0a20 2020 2020  yption if:.     
-000132b0: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-000132c0: 2f2a 2069 7427 7320 6e6f 7420 6469 7361  /* it's not disa
-000132d0: 626c 6564 0a20 2020 2020 2020 2020 2020  bled.           
-000132e0: 2020 2020 2020 2020 202f 2f2a 2077 6520           //* we 
-000132f0: 6861 7665 206f 7065 6e73 736c 2065 7874  have openssl ext
-00013300: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
-00013310: 2020 2020 2020 2020 2020 202f 2f2a 2077             //* w
-00013320: 6520 6172 6520 6e6f 7420 616c 7265 6164  e are not alread
-00013330: 7920 7573 696e 6720 5353 4c0a 2020 2020  y using SSL.    
-00013340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013350: 2f2f 2a20 7468 6520 7365 7276 6572 206f  //* the server o
-00013360: 6666 6572 7320 5354 4152 5454 4c53 0a20  ffers STARTTLS. 
-00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013380: 2020 2069 6620 2824 7468 6973 2d3e 534d     if ($this->SM
-00013390: 5450 4175 746f 544c 5320 2626 2024 7373  TPAutoTLS && $ss
-000133a0: 6c65 7874 2026 2620 2773 736c 2720 213d  lext && 'ssl' !=
-000133b0: 3d20 2473 6563 7572 6520 2626 2024 7468  = $secure && $th
-000133c0: 6973 2d3e 736d 7470 2d3e 6765 7453 6572  is->smtp->getSer
-000133d0: 7665 7245 7874 2827 5354 4152 5454 4c53  verExt('STARTTLS
-000133e0: 2729 2920 7b0a 2020 2020 2020 2020 2020  ')) {.          
-000133f0: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-00013400: 6c73 203d 2074 7275 653b 0a20 2020 2020  ls = true;.     
-00013410: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00013420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013430: 2020 2020 2069 6620 2824 746c 7329 207b       if ($tls) {
-00013440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013450: 2020 2020 2020 2020 2069 6620 2821 2474           if (!$t
-00013460: 6869 732d 3e73 6d74 702d 3e73 7461 7274  his->smtp->start
-00013470: 544c 5328 2929 207b 0a20 2020 2020 2020  TLS()) {.       
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 2020 2020 2024 6d65 7373 6167 6520 3d20       $message = 
-000134a0: 2474 6869 732d 3e67 6574 536d 7470 4572  $this->getSmtpEr
-000134b0: 726f 724d 6573 7361 6765 2827 636f 6e6e  rorMessage('conn
-000134c0: 6563 745f 686f 7374 2729 3b0a 2020 2020  ect_host');.    
-000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134e0: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
-000134f0: 7720 4578 6365 7074 696f 6e28 246d 6573  w Exception($mes
-00013500: 7361 6765 293b 0a20 2020 2020 2020 2020  sage);.         
-00013510: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00013520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013530: 2020 2020 2020 2020 202f 2f57 6520 6d75           //We mu
-00013540: 7374 2072 6573 656e 6420 4548 4c4f 2061  st resend EHLO a
-00013550: 6674 6572 2054 4c53 206e 6567 6f74 6961  fter TLS negotia
-00013560: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00013570: 2020 2020 2020 2020 2020 2020 2024 7468               $th
-00013580: 6973 2d3e 736d 7470 2d3e 6865 6c6c 6f28  is->smtp->hello(
-00013590: 2468 656c 6c6f 293b 0a20 2020 2020 2020  $hello);.       
-000135a0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-000135b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135c0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-000135d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135e0: 2474 6869 732d 3e53 4d54 5041 7574 6820  $this->SMTPAuth 
-000135f0: 2626 2021 2474 6869 732d 3e73 6d74 702d  && !$this->smtp-
-00013600: 3e61 7574 6865 6e74 6963 6174 6528 0a20  >authenticate(. 
-00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013620: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-00013630: 2d3e 5573 6572 6e61 6d65 2c0a 2020 2020  ->Username,.    
-00013640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013650: 2020 2020 2020 2020 2474 6869 732d 3e50          $this->P
-00013660: 6173 7377 6f72 642c 0a20 2020 2020 2020  assword,.       
-00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013680: 2020 2020 2024 7468 6973 2d3e 4175 7468       $this->Auth
-00013690: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
-000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136b0: 2020 2474 6869 732d 3e6f 6175 7468 0a20    $this->oauth. 
-000136c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000136e0: 2020 2020 2020 2020 2020 2020 2029 207b               ) {
-000136f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013700: 2020 2020 2020 2020 2074 6872 6f77 206e           throw n
-00013710: 6577 2045 7863 6570 7469 6f6e 2824 7468  ew Exception($th
-00013720: 6973 2d3e 6c61 6e67 2827 6175 7468 656e  is->lang('authen
-00013730: 7469 6361 7465 2729 293b 0a20 2020 2020  ticate'));.     
-00013740: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00013750: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013760: 2020 2020 2020 7265 7475 726e 2074 7275        return tru
-00013770: 653b 0a20 2020 2020 2020 2020 2020 2020  e;.             
-00013780: 2020 207d 2063 6174 6368 2028 4578 6365     } catch (Exce
-00013790: 7074 696f 6e20 2465 7863 2920 7b0a 2020  ption $exc) {.  
-000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137b0: 2020 246c 6173 7465 7863 6570 7469 6f6e    $lastexception
-000137c0: 203d 2024 6578 633b 0a20 2020 2020 2020   = $exc;.       
-000137d0: 2020 2020 2020 2020 2020 2020 2024 7468               $th
-000137e0: 6973 2d3e 6564 6562 7567 2824 6578 632d  is->edebug($exc-
-000137f0: 3e67 6574 4d65 7373 6167 6528 2929 3b0a  >getMessage());.
-00013800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013810: 2020 2020 2f2f 5765 206d 7573 7420 6861      //We must ha
-00013820: 7665 2063 6f6e 6e65 6374 6564 2c20 6275  ve connected, bu
-00013830: 7420 7468 656e 2066 6169 6c65 6420 544c  t then failed TL
-00013840: 5320 6f72 2041 7574 682c 2073 6f20 636c  S or Auth, so cl
-00013850: 6f73 6520 636f 6e6e 6563 7469 6f6e 206e  ose connection n
-00013860: 6963 656c 790a 2020 2020 2020 2020 2020  icely.          
-00013870: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-00013880: 3e73 6d74 702d 3e71 7569 7428 293b 0a20  >smtp->quit();. 
-00013890: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000138a0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-000138b0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000138c0: 202f 2f49 6620 7765 2067 6574 2068 6572   //If we get her
-000138d0: 652c 2061 6c6c 2063 6f6e 6e65 6374 696f  e, all connectio
-000138e0: 6e20 6174 7465 6d70 7473 2068 6176 6520  n attempts have 
-000138f0: 6661 696c 6564 2c20 736f 2063 6c6f 7365  failed, so close
-00013900: 2063 6f6e 6e65 6374 696f 6e20 6861 7264   connection hard
-00013910: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
-00013920: 736d 7470 2d3e 636c 6f73 6528 293b 0a20  smtp->close();. 
-00013930: 2020 2020 2020 202f 2f41 7320 7765 2776         //As we'v
-00013940: 6520 6361 7567 6874 2061 6c6c 2065 7863  e caught all exc
-00013950: 6570 7469 6f6e 732c 206a 7573 7420 7265  eptions, just re
-00013960: 706f 7274 2077 6861 7465 7665 7220 7468  port whatever th
-00013970: 6520 6c61 7374 206f 6e65 2077 6173 0a20  e last one was. 
-00013980: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
-00013990: 2d3e 6578 6365 7074 696f 6e73 2026 2620  ->exceptions && 
-000139a0: 6e75 6c6c 2021 3d3d 2024 6c61 7374 6578  null !== $lastex
-000139b0: 6365 7074 696f 6e29 207b 0a20 2020 2020  ception) {.     
-000139c0: 2020 2020 2020 2074 6872 6f77 2024 6c61         throw $la
-000139d0: 7374 6578 6365 7074 696f 6e3b 0a20 2020  stexception;.   
-000139e0: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
-000139f0: 6620 2824 7468 6973 2d3e 6578 6365 7074  f ($this->except
-00013a00: 696f 6e73 2920 7b0a 2020 2020 2020 2020  ions) {.        
-00013a10: 2020 2020 2f2f 206e 6f20 6578 6365 7074      // no except
-00013a20: 696f 6e20 7761 7320 7468 726f 776e 2c20  ion was thrown, 
-00013a30: 6c69 6b65 6c79 2024 7468 6973 2d3e 736d  likely $this->sm
-00013a40: 7470 2d3e 636f 6e6e 6563 7428 2920 6661  tp->connect() fa
-00013a50: 696c 6564 0a20 2020 2020 2020 2020 2020  iled.           
-00013a60: 2024 6d65 7373 6167 6520 3d20 2474 6869   $message = $thi
-00013a70: 732d 3e67 6574 536d 7470 4572 726f 724d  s->getSmtpErrorM
-00013a80: 6573 7361 6765 2827 636f 6e6e 6563 745f  essage('connect_
-00013a90: 686f 7374 2729 3b0a 2020 2020 2020 2020  host');.        
-00013aa0: 2020 2020 7468 726f 7720 6e65 7720 4578      throw new Ex
-00013ab0: 6365 7074 696f 6e28 246d 6573 7361 6765  ception($message
-00013ac0: 293b 0a20 2020 2020 2020 207d 0a0a 2020  );.        }..  
-00013ad0: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
-00013ae0: 7365 3b0a 2020 2020 7d0a 0a20 2020 202f  se;.    }..    /
-00013af0: 2a2a 0a20 2020 2020 2a20 436c 6f73 6520  **.     * Close 
-00013b00: 7468 6520 6163 7469 7665 2053 4d54 5020  the active SMTP 
-00013b10: 7365 7373 696f 6e20 6966 206f 6e65 2065  session if one e
-00013b20: 7869 7374 732e 0a20 2020 2020 2a2f 0a20  xists..     */. 
-00013b30: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
-00013b40: 6f6e 2073 6d74 7043 6c6f 7365 2829 0a20  on smtpClose(). 
-00013b50: 2020 207b 0a20 2020 2020 2020 2069 6620     {.        if 
-00013b60: 2828 6e75 6c6c 2021 3d3d 2024 7468 6973  ((null !== $this
-00013b70: 2d3e 736d 7470 2920 2626 2024 7468 6973  ->smtp) && $this
-00013b80: 2d3e 736d 7470 2d3e 636f 6e6e 6563 7465  ->smtp->connecte
-00013b90: 6428 2929 207b 0a20 2020 2020 2020 2020  d()) {.         
-00013ba0: 2020 2024 7468 6973 2d3e 736d 7470 2d3e     $this->smtp->
-00013bb0: 7175 6974 2829 3b0a 2020 2020 2020 2020  quit();.        
-00013bc0: 2020 2020 2474 6869 732d 3e73 6d74 702d      $this->smtp-
-00013bd0: 3e63 6c6f 7365 2829 3b0a 2020 2020 2020  >close();.      
-00013be0: 2020 7d0a 2020 2020 7d0a 0a20 2020 202f    }.    }..    /
-00013bf0: 2a2a 0a20 2020 2020 2a20 5365 7420 7468  **.     * Set th
-00013c00: 6520 6c61 6e67 7561 6765 2066 6f72 2065  e language for e
-00013c10: 7272 6f72 206d 6573 7361 6765 732e 0a20  rror messages.. 
-00013c20: 2020 2020 2a20 5468 6520 6465 6661 756c      * The defaul
-00013c30: 7420 6c61 6e67 7561 6765 2069 7320 456e  t language is En
-00013c40: 676c 6973 682e 0a20 2020 2020 2a0a 2020  glish..     *.  
-00013c50: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-00013c60: 6e67 2024 6c61 6e67 636f 6465 2020 4953  ng $langcode  IS
-00013c70: 4f20 3633 392d 3120 322d 6368 6172 6163  O 639-1 2-charac
-00013c80: 7465 7220 6c61 6e67 7561 6765 2063 6f64  ter language cod
-00013c90: 6520 2865 2e67 2e20 4672 656e 6368 2069  e (e.g. French i
-00013ca0: 7320 2266 7222 290a 2020 2020 202a 2020  s "fr").     *  
-00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cc0: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
-00013cd0: 6c79 2c20 7468 6520 6c61 6e67 7561 6765  ly, the language
-00013ce0: 2063 6f64 6520 6361 6e20 6265 2065 6e68   code can be enh
-00013cf0: 616e 6365 6420 7769 7468 2061 2034 2d63  anced with a 4-c
-00013d00: 6861 7261 6374 6572 0a20 2020 2020 2a20  haracter.     * 
-00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d20: 2020 2020 2020 2020 2073 6372 6970 7420           script 
-00013d30: 616e 6e6f 7461 7469 6f6e 2061 6e64 2f6f  annotation and/o
-00013d40: 7220 6120 322d 6368 6172 6163 7465 7220  r a 2-character 
-00013d50: 636f 756e 7472 7920 616e 6e6f 7461 7469  country annotati
-00013d60: 6f6e 2e0a 2020 2020 202a 2040 7061 7261  on..     * @para
-00013d70: 6d20 7374 7269 6e67 2024 6c61 6e67 5f70  m string $lang_p
-00013d80: 6174 6820 5061 7468 2074 6f20 7468 6520  ath Path to the 
-00013d90: 6c61 6e67 7561 6765 2066 696c 6520 6469  language file di
-00013da0: 7265 6374 6f72 792c 2077 6974 6820 7472  rectory, with tr
-00013db0: 6169 6c69 6e67 2073 6570 6172 6174 6f72  ailing separator
-00013dc0: 2028 736c 6173 6829 0a20 2020 2020 2a20   (slash).     * 
-00013dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013de0: 2020 2020 2020 2020 2044 6f20 6e6f 7420           Do not 
-00013df0: 7365 7420 7468 6973 2066 726f 6d20 7573  set this from us
-00013e00: 6572 2069 6e70 7574 210a 2020 2020 202a  er input!.     *
-00013e10: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
-00013e20: 626f 6f6c 2052 6574 7572 6e73 2074 7275  bool Returns tru
-00013e30: 6520 6966 2074 6865 2072 6571 7565 7374  e if the request
-00013e40: 6564 206c 616e 6775 6167 6520 7761 7320  ed language was 
-00013e50: 6c6f 6164 6564 2c20 6661 6c73 6520 6f74  loaded, false ot
-00013e60: 6865 7277 6973 652e 0a20 2020 2020 2a2f  herwise..     */
-00013e70: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00013e80: 7469 6f6e 2073 6574 4c61 6e67 7561 6765  tion setLanguage
-00013e90: 2824 6c61 6e67 636f 6465 203d 2027 656e  ($langcode = 'en
-00013ea0: 272c 2024 6c61 6e67 5f70 6174 6820 3d20  ', $lang_path = 
-00013eb0: 2727 290a 2020 2020 7b0a 2020 2020 2020  '').    {.      
-00013ec0: 2020 2f2f 4261 636b 7761 7264 7320 636f    //Backwards co
-00013ed0: 6d70 6174 6962 696c 6974 7920 666f 7220  mpatibility for 
-00013ee0: 7265 6e61 6d65 6420 6c61 6e67 7561 6765  renamed language
-00013ef0: 2063 6f64 6573 0a20 2020 2020 2020 2024   codes.        $
-00013f00: 7265 6e61 6d65 645f 6c61 6e67 636f 6465  renamed_langcode
-00013f10: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-00013f20: 2020 2762 7227 203d 3e20 2770 745f 6272    'br' => 'pt_br
-00013f30: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00013f40: 637a 2720 3d3e 2027 6373 272c 0a20 2020  cz' => 'cs',.   
-00013f50: 2020 2020 2020 2020 2027 646b 2720 3d3e           'dk' =>
-00013f60: 2027 6461 272c 0a20 2020 2020 2020 2020   'da',.         
-00013f70: 2020 2027 6e6f 2720 3d3e 2027 6e62 272c     'no' => 'nb',
-00013f80: 0a20 2020 2020 2020 2020 2020 2027 7365  .            'se
-00013f90: 2720 3d3e 2027 7376 272c 0a20 2020 2020  ' => 'sv',.     
-00013fa0: 2020 2020 2020 2027 7273 2720 3d3e 2027         'rs' => '
-00013fb0: 7372 272c 0a20 2020 2020 2020 2020 2020  sr',.           
-00013fc0: 2027 7467 2720 3d3e 2027 746c 272c 0a20   'tg' => 'tl',. 
-00013fd0: 2020 2020 2020 2020 2020 2027 616d 2720             'am' 
-00013fe0: 3d3e 2027 6879 272c 0a20 2020 2020 2020  => 'hy',.       
-00013ff0: 205d 3b0a 0a20 2020 2020 2020 2069 6620   ];..        if 
-00014000: 2861 7272 6179 5f6b 6579 5f65 7869 7374  (array_key_exist
-00014010: 7328 246c 616e 6763 6f64 652c 2024 7265  s($langcode, $re
-00014020: 6e61 6d65 645f 6c61 6e67 636f 6465 7329  named_langcodes)
-00014030: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00014040: 246c 616e 6763 6f64 6520 3d20 2472 656e  $langcode = $ren
-00014050: 616d 6564 5f6c 616e 6763 6f64 6573 5b24  amed_langcodes[$
-00014060: 6c61 6e67 636f 6465 5d3b 0a20 2020 2020  langcode];.     
-00014070: 2020 207d 0a0a 2020 2020 2020 2020 2f2f     }..        //
-00014080: 4465 6669 6e65 2066 756c 6c20 7365 7420  Define full set 
-00014090: 6f66 2074 7261 6e73 6c61 7461 626c 6520  of translatable 
-000140a0: 7374 7269 6e67 7320 696e 2045 6e67 6c69  strings in Engli
-000140b0: 7368 0a20 2020 2020 2020 2024 5048 504d  sh.        $PHPM
-000140c0: 4149 4c45 525f 4c41 4e47 203d 205b 0a20  AILER_LANG = [. 
-000140d0: 2020 2020 2020 2020 2020 2027 6175 7468             'auth
-000140e0: 656e 7469 6361 7465 2720 3d3e 2027 534d  enticate' => 'SM
-000140f0: 5450 2045 7272 6f72 3a20 436f 756c 6420  TP Error: Could 
-00014100: 6e6f 7420 6175 7468 656e 7469 6361 7465  not authenticate
-00014110: 2e27 2c0a 2020 2020 2020 2020 2020 2020  .',.            
-00014120: 2762 7567 6779 5f70 6870 2720 3d3e 2027  'buggy_php' => '
-00014130: 596f 7572 2076 6572 7369 6f6e 206f 6620  Your version of 
-00014140: 5048 5020 6973 2061 6666 6563 7465 6420  PHP is affected 
-00014150: 6279 2061 2062 7567 2074 6861 7420 6d61  by a bug that ma
-00014160: 7920 7265 7375 6c74 2069 6e20 636f 7272  y result in corr
-00014170: 7570 7465 6420 6d65 7373 6167 6573 2e27  upted messages.'
-00014180: 202e 0a20 2020 2020 2020 2020 2020 2020   ..             
-00014190: 2020 2027 2054 6f20 6669 7820 6974 2c20     ' To fix it, 
-000141a0: 7377 6974 6368 2074 6f20 7365 6e64 696e  switch to sendin
-000141b0: 6720 7573 696e 6720 534d 5450 2c20 6469  g using SMTP, di
-000141c0: 7361 626c 6520 7468 6520 6d61 696c 2e61  sable the mail.a
-000141d0: 6464 5f78 5f68 6561 6465 7220 6f70 7469  dd_x_header opti
-000141e0: 6f6e 2069 6e27 202e 0a20 2020 2020 2020  on in' ..       
-000141f0: 2020 2020 2020 2020 2027 2079 6f75 7220           ' your 
-00014200: 7068 702e 696e 692c 2073 7769 7463 6820  php.ini, switch 
-00014210: 746f 204d 6163 4f53 206f 7220 4c69 6e75  to MacOS or Linu
-00014220: 782c 206f 7220 7570 6772 6164 6520 796f  x, or upgrade yo
-00014230: 7572 2050 4850 2074 6f20 7665 7273 696f  ur PHP to versio
-00014240: 6e20 372e 302e 3137 2b20 6f72 2037 2e31  n 7.0.17+ or 7.1
-00014250: 2e33 2b2e 272c 0a20 2020 2020 2020 2020  .3+.',.         
-00014260: 2020 2027 636f 6e6e 6563 745f 686f 7374     'connect_host
-00014270: 2720 3d3e 2027 534d 5450 2045 7272 6f72  ' => 'SMTP Error
-00014280: 3a20 436f 756c 6420 6e6f 7420 636f 6e6e  : Could not conn
-00014290: 6563 7420 746f 2053 4d54 5020 686f 7374  ect to SMTP host
-000142a0: 2e27 2c0a 2020 2020 2020 2020 2020 2020  .',.            
-000142b0: 2764 6174 615f 6e6f 745f 6163 6365 7074  'data_not_accept
-000142c0: 6564 2720 3d3e 2027 534d 5450 2045 7272  ed' => 'SMTP Err
-000142d0: 6f72 3a20 6461 7461 206e 6f74 2061 6363  or: data not acc
-000142e0: 6570 7465 642e 272c 0a20 2020 2020 2020  epted.',.       
-000142f0: 2020 2020 2027 656d 7074 795f 6d65 7373       'empty_mess
-00014300: 6167 6527 203d 3e20 274d 6573 7361 6765  age' => 'Message
-00014310: 2062 6f64 7920 656d 7074 7927 2c0a 2020   body empty',.  
-00014320: 2020 2020 2020 2020 2020 2765 6e63 6f64            'encod
-00014330: 696e 6727 203d 3e20 2755 6e6b 6e6f 776e  ing' => 'Unknown
-00014340: 2065 6e63 6f64 696e 673a 2027 2c0a 2020   encoding: ',.  
-00014350: 2020 2020 2020 2020 2020 2765 7865 6375            'execu
-00014360: 7465 2720 3d3e 2027 436f 756c 6420 6e6f  te' => 'Could no
-00014370: 7420 6578 6563 7574 653a 2027 2c0a 2020  t execute: ',.  
-00014380: 2020 2020 2020 2020 2020 2765 7874 656e            'exten
-00014390: 7369 6f6e 5f6d 6973 7369 6e67 2720 3d3e  sion_missing' =>
-000143a0: 2027 4578 7465 6e73 696f 6e20 6d69 7373   'Extension miss
-000143b0: 696e 673a 2027 2c0a 2020 2020 2020 2020  ing: ',.        
-000143c0: 2020 2020 2766 696c 655f 6163 6365 7373      'file_access
-000143d0: 2720 3d3e 2027 436f 756c 6420 6e6f 7420  ' => 'Could not 
-000143e0: 6163 6365 7373 2066 696c 653a 2027 2c0a  access file: ',.
-000143f0: 2020 2020 2020 2020 2020 2020 2766 696c              'fil
-00014400: 655f 6f70 656e 2720 3d3e 2027 4669 6c65  e_open' => 'File
-00014410: 2045 7272 6f72 3a20 436f 756c 6420 6e6f   Error: Could no
-00014420: 7420 6f70 656e 2066 696c 653a 2027 2c0a  t open file: ',.
-00014430: 2020 2020 2020 2020 2020 2020 2766 726f              'fro
-00014440: 6d5f 6661 696c 6564 2720 3d3e 2027 5468  m_failed' => 'Th
-00014450: 6520 666f 6c6c 6f77 696e 6720 4672 6f6d  e following From
-00014460: 2061 6464 7265 7373 2066 6169 6c65 643a   address failed:
-00014470: 2027 2c0a 2020 2020 2020 2020 2020 2020   ',.            
-00014480: 2769 6e73 7461 6e74 6961 7465 2720 3d3e  'instantiate' =>
-00014490: 2027 436f 756c 6420 6e6f 7420 696e 7374   'Could not inst
-000144a0: 616e 7469 6174 6520 6d61 696c 2066 756e  antiate mail fun
-000144b0: 6374 696f 6e2e 272c 0a20 2020 2020 2020  ction.',.       
-000144c0: 2020 2020 2027 696e 7661 6c69 645f 6164       'invalid_ad
-000144d0: 6472 6573 7327 203d 3e20 2749 6e76 616c  dress' => 'Inval
-000144e0: 6964 2061 6464 7265 7373 3a20 272c 0a20  id address: ',. 
-000144f0: 2020 2020 2020 2020 2020 2027 696e 7661             'inva
-00014500: 6c69 645f 6865 6164 6572 2720 3d3e 2027  lid_header' => '
-00014510: 496e 7661 6c69 6420 6865 6164 6572 206e  Invalid header n
-00014520: 616d 6520 6f72 2076 616c 7565 272c 0a20  ame or value',. 
-00014530: 2020 2020 2020 2020 2020 2027 696e 7661             'inva
-00014540: 6c69 645f 686f 7374 656e 7472 7927 203d  lid_hostentry' =
-00014550: 3e20 2749 6e76 616c 6964 2068 6f73 7465  > 'Invalid hoste
-00014560: 6e74 7279 3a20 272c 0a20 2020 2020 2020  ntry: ',.       
-00014570: 2020 2020 2027 696e 7661 6c69 645f 686f       'invalid_ho
-00014580: 7374 2720 3d3e 2027 496e 7661 6c69 6420  st' => 'Invalid 
-00014590: 686f 7374 3a20 272c 0a20 2020 2020 2020  host: ',.       
-000145a0: 2020 2020 2027 6d61 696c 6572 5f6e 6f74       'mailer_not
-000145b0: 5f73 7570 706f 7274 6564 2720 3d3e 2027  _supported' => '
-000145c0: 206d 6169 6c65 7220 6973 206e 6f74 2073   mailer is not s
-000145d0: 7570 706f 7274 6564 2e27 2c0a 2020 2020  upported.',.    
-000145e0: 2020 2020 2020 2020 2770 726f 7669 6465          'provide
-000145f0: 5f61 6464 7265 7373 2720 3d3e 2027 596f  _address' => 'Yo
-00014600: 7520 6d75 7374 2070 726f 7669 6465 2061  u must provide a
-00014610: 7420 6c65 6173 7420 6f6e 6520 7265 6369  t least one reci
-00014620: 7069 656e 7420 656d 6169 6c20 6164 6472  pient email addr
-00014630: 6573 732e 272c 0a20 2020 2020 2020 2020  ess.',.         
-00014640: 2020 2027 7265 6369 7069 656e 7473 5f66     'recipients_f
-00014650: 6169 6c65 6427 203d 3e20 2753 4d54 5020  ailed' => 'SMTP 
-00014660: 4572 726f 723a 2054 6865 2066 6f6c 6c6f  Error: The follo
-00014670: 7769 6e67 2072 6563 6970 6965 6e74 7320  wing recipients 
-00014680: 6661 696c 6564 3a20 272c 0a20 2020 2020  failed: ',.     
-00014690: 2020 2020 2020 2027 7369 676e 696e 6727         'signing'
-000146a0: 203d 3e20 2753 6967 6e69 6e67 2045 7272   => 'Signing Err
-000146b0: 6f72 3a20 272c 0a20 2020 2020 2020 2020  or: ',.         
-000146c0: 2020 2027 736d 7470 5f63 6f64 6527 203d     'smtp_code' =
-000146d0: 3e20 2753 4d54 5020 636f 6465 3a20 272c  > 'SMTP code: ',
-000146e0: 0a20 2020 2020 2020 2020 2020 2027 736d  .            'sm
-000146f0: 7470 5f63 6f64 655f 6578 2720 3d3e 2027  tp_code_ex' => '
-00014700: 4164 6469 7469 6f6e 616c 2053 4d54 5020  Additional SMTP 
-00014710: 696e 666f 3a20 272c 0a20 2020 2020 2020  info: ',.       
-00014720: 2020 2020 2027 736d 7470 5f63 6f6e 6e65       'smtp_conne
-00014730: 6374 5f66 6169 6c65 6427 203d 3e20 2753  ct_failed' => 'S
-00014740: 4d54 5020 636f 6e6e 6563 7428 2920 6661  MTP connect() fa
-00014750: 696c 6564 2e27 2c0a 2020 2020 2020 2020  iled.',.        
-00014760: 2020 2020 2773 6d74 705f 6465 7461 696c      'smtp_detail
-00014770: 2720 3d3e 2027 4465 7461 696c 3a20 272c  ' => 'Detail: ',
-00014780: 0a20 2020 2020 2020 2020 2020 2027 736d  .            'sm
-00014790: 7470 5f65 7272 6f72 2720 3d3e 2027 534d  tp_error' => 'SM
-000147a0: 5450 2073 6572 7665 7220 6572 726f 723a  TP server error:
-000147b0: 2027 2c0a 2020 2020 2020 2020 2020 2020   ',.            
-000147c0: 2776 6172 6961 626c 655f 7365 7427 203d  'variable_set' =
-000147d0: 3e20 2743 616e 6e6f 7420 7365 7420 6f72  > 'Cannot set or
-000147e0: 2072 6573 6574 2076 6172 6961 626c 653a   reset variable:
-000147f0: 2027 2c0a 2020 2020 2020 2020 5d3b 0a20   ',.        ];. 
-00014800: 2020 2020 2020 2069 6620 2865 6d70 7479         if (empty
-00014810: 2824 6c61 6e67 5f70 6174 6829 2920 7b0a  ($lang_path)) {.
-00014820: 2020 2020 2020 2020 2020 2020 2f2f 4361              //Ca
-00014830: 6c63 756c 6174 6520 616e 2061 6273 6f6c  lculate an absol
-00014840: 7574 6520 7061 7468 2073 6f20 6974 2063  ute path so it c
-00014850: 616e 2077 6f72 6b20 6966 2043 5744 2069  an work if CWD i
-00014860: 7320 6e6f 7420 6865 7265 0a20 2020 2020  s not here.     
-00014870: 2020 2020 2020 2024 6c61 6e67 5f70 6174         $lang_pat
-00014880: 6820 3d20 6469 726e 616d 6528 5f5f 4449  h = dirname(__DI
-00014890: 525f 5f29 202e 2044 4952 4543 544f 5259  R__) . DIRECTORY
-000148a0: 5f53 4550 4152 4154 4f52 202e 2027 6c61  _SEPARATOR . 'la
-000148b0: 6e67 7561 6765 2720 2e20 4449 5245 4354  nguage' . DIRECT
-000148c0: 4f52 595f 5345 5041 5241 544f 523b 0a20  ORY_SEPARATOR;. 
-000148d0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-000148e0: 2020 2f2f 5661 6c69 6461 7465 2024 6c61    //Validate $la
-000148f0: 6e67 636f 6465 0a20 2020 2020 2020 2024  ngcode.        $
-00014900: 666f 756e 646c 616e 6720 3d20 7472 7565  foundlang = true
-00014910: 3b0a 2020 2020 2020 2020 246c 616e 6763  ;.        $langc
-00014920: 6f64 6520 203d 2073 7472 746f 6c6f 7765  ode  = strtolowe
-00014930: 7228 246c 616e 6763 6f64 6529 3b0a 2020  r($langcode);.  
-00014940: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00014950: 2020 2020 2020 2021 7072 6567 5f6d 6174         !preg_mat
-00014960: 6368 2827 2f5e 283f 503c 6c61 6e67 3e5b  ch('/^(?P<lang>[
-00014970: 612d 7a5d 7b32 7d29 283f 503c 7363 7269  a-z]{2})(?P<scri
-00014980: 7074 3e5f 5b61 2d7a 5d7b 347d 293f 283f  pt>_[a-z]{4})?(?
-00014990: 503c 636f 756e 7472 793e 5f5b 612d 7a5d  P<country>_[a-z]
-000149a0: 7b32 7d29 3f24 2f27 2c20 246c 616e 6763  {2})?$/', $langc
-000149b0: 6f64 652c 2024 6d61 7463 6865 7329 0a20  ode, $matches). 
-000149c0: 2020 2020 2020 2020 2020 2026 2620 246c             && $l
-000149d0: 616e 6763 6f64 6520 213d 3d20 2765 6e27  angcode !== 'en'
-000149e0: 0a20 2020 2020 2020 2029 207b 0a20 2020  .        ) {.   
-000149f0: 2020 2020 2020 2020 2024 666f 756e 646c           $foundl
-00014a00: 616e 6720 3d20 6661 6c73 653b 0a20 2020  ang = false;.   
-00014a10: 2020 2020 2020 2020 2024 6c61 6e67 636f           $langco
-00014a20: 6465 203d 2027 656e 273b 0a20 2020 2020  de = 'en';.     
-00014a30: 2020 207d 0a0a 2020 2020 2020 2020 2f2f     }..        //
-00014a40: 5468 6572 6520 6973 206e 6f20 456e 676c  There is no Engl
-00014a50: 6973 6820 7472 616e 736c 6174 696f 6e20  ish translation 
-00014a60: 6669 6c65 0a20 2020 2020 2020 2069 6620  file.        if 
-00014a70: 2827 656e 2720 213d 3d20 246c 616e 6763  ('en' !== $langc
-00014a80: 6f64 6529 207b 0a20 2020 2020 2020 2020  ode) {.         
-00014a90: 2020 2024 6c61 6e67 636f 6465 7320 3d20     $langcodes = 
-00014aa0: 5b5d 3b0a 2020 2020 2020 2020 2020 2020  [];.            
-00014ab0: 6966 2028 2165 6d70 7479 2824 6d61 7463  if (!empty($matc
-00014ac0: 6865 735b 2773 6372 6970 7427 5d29 2026  hes['script']) &
-00014ad0: 2620 2165 6d70 7479 2824 6d61 7463 6865  & !empty($matche
-00014ae0: 735b 2763 6f75 6e74 7279 275d 2929 207b  s['country'])) {
-00014af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014b00: 2024 6c61 6e67 636f 6465 735b 5d20 3d20   $langcodes[] = 
-00014b10: 246d 6174 6368 6573 5b27 6c61 6e67 275d  $matches['lang']
-00014b20: 202e 2024 6d61 7463 6865 735b 2773 6372   . $matches['scr
-00014b30: 6970 7427 5d20 2e20 246d 6174 6368 6573  ipt'] . $matches
-00014b40: 5b27 636f 756e 7472 7927 5d3b 0a20 2020  ['country'];.   
-00014b50: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00014b60: 2020 2020 2020 2069 6620 2821 656d 7074         if (!empt
-00014b70: 7928 246d 6174 6368 6573 5b27 636f 756e  y($matches['coun
-00014b80: 7472 7927 5d29 2920 7b0a 2020 2020 2020  try'])) {.      
-00014b90: 2020 2020 2020 2020 2020 246c 616e 6763            $langc
-00014ba0: 6f64 6573 5b5d 203d 2024 6d61 7463 6865  odes[] = $matche
-00014bb0: 735b 276c 616e 6727 5d20 2e20 246d 6174  s['lang'] . $mat
-00014bc0: 6368 6573 5b27 636f 756e 7472 7927 5d3b  ches['country'];
-00014bd0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-00014be0: 2020 2020 2020 2020 2020 2069 6620 2821             if (!
-00014bf0: 656d 7074 7928 246d 6174 6368 6573 5b27  empty($matches['
-00014c00: 7363 7269 7074 275d 2929 207b 0a20 2020  script'])) {.   
-00014c10: 2020 2020 2020 2020 2020 2020 2024 6c61               $la
-00014c20: 6e67 636f 6465 735b 5d20 3d20 246d 6174  ngcodes[] = $mat
-00014c30: 6368 6573 5b27 6c61 6e67 275d 202e 2024  ches['lang'] . $
-00014c40: 6d61 7463 6865 735b 2773 6372 6970 7427  matches['script'
-00014c50: 5d3b 0a20 2020 2020 2020 2020 2020 207d  ];.            }
-00014c60: 0a20 2020 2020 2020 2020 2020 2024 6c61  .            $la
-00014c70: 6e67 636f 6465 735b 5d20 3d20 246d 6174  ngcodes[] = $mat
-00014c80: 6368 6573 5b27 6c61 6e67 275d 3b0a 0a20  ches['lang'];.. 
-00014c90: 2020 2020 2020 2020 2020 202f 2f54 7279             //Try
-00014ca0: 2061 6e64 2066 696e 6420 6120 7265 6164   and find a read
-00014cb0: 6162 6c65 206c 616e 6775 6167 6520 6669  able language fi
-00014cc0: 6c65 2066 6f72 2074 6865 2072 6571 7565  le for the reque
-00014cd0: 7374 6564 206c 616e 6775 6167 652e 0a20  sted language.. 
-00014ce0: 2020 2020 2020 2020 2020 2024 666f 756e             $foun
-00014cf0: 6446 696c 6520 3d20 6661 6c73 653b 0a20  dFile = false;. 
-00014d00: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
-00014d10: 6368 2028 246c 616e 6763 6f64 6573 2061  ch ($langcodes a
-00014d20: 7320 2463 6f64 6529 207b 0a20 2020 2020  s $code) {.     
-00014d30: 2020 2020 2020 2020 2020 2024 6c61 6e67             $lang
-00014d40: 5f66 696c 6520 3d20 246c 616e 675f 7061  _file = $lang_pa
-00014d50: 7468 202e 2027 7068 706d 6169 6c65 722e  th . 'phpmailer.
-00014d60: 6c61 6e67 2d27 202e 2024 636f 6465 202e  lang-' . $code .
-00014d70: 2027 2e70 6870 273b 0a20 2020 2020 2020   '.php';.       
-00014d80: 2020 2020 2020 2020 2069 6620 2873 7461           if (sta
-00014d90: 7469 633a 3a66 696c 6549 7341 6363 6573  tic::fileIsAcces
-00014da0: 7369 626c 6528 246c 616e 675f 6669 6c65  sible($lang_file
-00014db0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00014dc0: 2020 2020 2020 2020 2024 666f 756e 6446           $foundF
-00014dd0: 696c 6520 3d20 7472 7565 3b0a 2020 2020  ile = true;.    
-00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014df0: 6272 6561 6b3b 0a20 2020 2020 2020 2020  break;.         
-00014e00: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00014e10: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00014e20: 2020 2020 6966 2028 2466 6f75 6e64 4669      if ($foundFi
-00014e30: 6c65 203d 3d3d 2066 616c 7365 2920 7b0a  le === false) {.
-00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e50: 2466 6f75 6e64 6c61 6e67 203d 2066 616c  $foundlang = fal
-00014e60: 7365 3b0a 2020 2020 2020 2020 2020 2020  se;.            
-00014e70: 7d20 656c 7365 207b 0a20 2020 2020 2020  } else {.       
-00014e80: 2020 2020 2020 2020 2024 6c69 6e65 7320           $lines 
-00014e90: 3d20 6669 6c65 2824 6c61 6e67 5f66 696c  = file($lang_fil
-00014ea0: 6529 3b0a 2020 2020 2020 2020 2020 2020  e);.            
-00014eb0: 2020 2020 666f 7265 6163 6820 2824 6c69      foreach ($li
-00014ec0: 6e65 7320 6173 2024 6c69 6e65 2920 7b0a  nes as $line) {.
-00014ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ee0: 2020 2020 2f2f 5472 616e 736c 6174 696f      //Translatio
-00014ef0: 6e20 6669 6c65 206c 696e 6573 206c 6f6f  n file lines loo
-00014f00: 6b20 6c69 6b65 2074 6869 733a 0a20 2020  k like this:.   
-00014f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f20: 202f 2f24 5048 504d 4149 4c45 525f 4c41   //$PHPMAILER_LA
-00014f30: 4e47 5b27 6175 7468 656e 7469 6361 7465  NG['authenticate
-00014f40: 275d 203d 2027 534d 5450 2d46 6568 6c65  '] = 'SMTP-Fehle
-00014f50: 723a 2041 7574 6865 6e74 6966 697a 6965  r: Authentifizie
-00014f60: 7275 6e67 2066 6568 6c67 6573 6368 6c61  rung fehlgeschla
-00014f70: 6765 6e2e 273b 0a20 2020 2020 2020 2020  gen.';.         
-00014f80: 2020 2020 2020 2020 2020 202f 2f54 6865             //The
-00014f90: 7365 2066 696c 6573 2061 7265 2070 6172  se files are par
-00014fa0: 7365 6420 6173 2074 6578 7420 616e 6420  sed as text and 
-00014fb0: 6e6f 7420 5048 5020 736f 2061 7320 746f  not PHP so as to
-00014fc0: 2061 766f 6964 2074 6865 2070 6f73 7369   avoid the possi
-00014fd0: 6269 6c69 7479 206f 6620 636f 6465 2069  bility of code i
-00014fe0: 6e6a 6563 7469 6f6e 0a20 2020 2020 2020  njection.       
-00014ff0: 2020 2020 2020 2020 2020 2020 202f 2f53               //S
-00015000: 6565 2068 7474 7073 3a2f 2f62 6c6f 672e  ee https://blog.
-00015010: 7374 6576 656e 6c65 7669 7468 616e 2e63  stevenlevithan.c
-00015020: 6f6d 2f61 7263 6869 7665 732f 6d61 7463  om/archives/matc
-00015030: 682d 7175 6f74 6564 2d73 7472 696e 670a  h-quoted-string.
-00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015050: 2020 2020 246d 6174 6368 6573 203d 205b      $matches = [
-00015060: 5d3b 0a20 2020 2020 2020 2020 2020 2020  ];.             
-00015070: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00015080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015090: 2020 2020 7072 6567 5f6d 6174 6368 280a      preg_match(.
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150b0: 2020 2020 2020 2020 2020 2020 272f 5e5c              '/^\
-000150c0: 2450 4850 4d41 494c 4552 5f4c 414e 475c  $PHPMAILER_LANG\
-000150d0: 5b5c 2728 5b61 2d7a 5c64 5f5d 2b29 5c27  [\'([a-z\d_]+)\'
-000150e0: 5c5d 5c73 2a3d 5c73 2a28 5b22 5c27 5d29  \]\s*=\s*(["\'])
-000150f0: 282e 2b29 2a3f 5c32 3b2f 272c 0a20 2020  (.+)*?\2;/',.   
-00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015110: 2020 2020 2020 2020 2024 6c69 6e65 2c0a           $line,.
-00015120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015130: 2020 2020 2020 2020 2020 2020 246d 6174              $mat
-00015140: 6368 6573 0a20 2020 2020 2020 2020 2020  ches.           
-00015150: 2020 2020 2020 2020 2020 2020 2029 2026               ) &
-00015160: 260a 2020 2020 2020 2020 2020 2020 2020  &.              
-00015170: 2020 2020 2020 2020 2020 2f2f 4967 6e6f            //Igno
-00015180: 7265 2075 6e6b 6e6f 776e 2074 7261 6e73  re unknown trans
-00015190: 6c61 7469 6f6e 206b 6579 730a 2020 2020  lation keys.    
-000151a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151b0: 2020 2020 6172 7261 795f 6b65 795f 6578      array_key_ex
-000151c0: 6973 7473 2824 6d61 7463 6865 735b 315d  ists($matches[1]
-000151d0: 2c20 2450 4850 4d41 494c 4552 5f4c 414e  , $PHPMAILER_LAN
-000151e0: 4729 0a20 2020 2020 2020 2020 2020 2020  G).             
-000151f0: 2020 2020 2020 2029 207b 0a20 2020 2020         ) {.     
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 2020 202f 2f4f 7665 7277 7269 7465 206c     //Overwrite l
-00015220: 616e 6775 6167 652d 7370 6563 6966 6963  anguage-specific
-00015230: 2073 7472 696e 6773 2073 6f20 7765 276c   strings so we'l
-00015240: 6c20 6e65 7665 7220 6861 7665 206d 6973  l never have mis
-00015250: 7369 6e67 2074 7261 6e73 6c61 7469 6f6e  sing translation
-00015260: 206b 6579 732e 0a20 2020 2020 2020 2020   keys..         
-00015270: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00015280: 5048 504d 4149 4c45 525f 4c41 4e47 5b24  PHPMAILER_LANG[$
-00015290: 6d61 7463 6865 735b 315d 5d20 3d20 2873  matches[1]] = (s
-000152a0: 7472 696e 6729 246d 6174 6368 6573 5b33  tring)$matches[3
-000152b0: 5d3b 0a20 2020 2020 2020 2020 2020 2020  ];.             
-000152c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000152d0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-000152e0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000152f0: 207d 0a20 2020 2020 2020 2024 7468 6973   }.        $this
-00015300: 2d3e 6c61 6e67 7561 6765 203d 2024 5048  ->language = $PH
-00015310: 504d 4149 4c45 525f 4c41 4e47 3b0a 0a20  PMAILER_LANG;.. 
-00015320: 2020 2020 2020 2072 6574 7572 6e20 2466         return $f
-00015330: 6f75 6e64 6c61 6e67 3b20 2f2f 5265 7475  oundlang; //Retu
-00015340: 726e 7320 6661 6c73 6520 6966 206c 616e  rns false if lan
-00015350: 6775 6167 6520 6e6f 7420 666f 756e 640a  guage not found.
-00015360: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
-00015370: 2020 2020 2a20 4765 7420 7468 6520 6172      * Get the ar
-00015380: 7261 7920 6f66 2073 7472 696e 6773 2066  ray of strings f
-00015390: 6f72 2074 6865 2063 7572 7265 6e74 206c  or the current l
-000153a0: 616e 6775 6167 652e 0a20 2020 2020 2a0a  anguage..     *.
-000153b0: 2020 2020 202a 2040 7265 7475 726e 2061       * @return a
-000153c0: 7272 6179 0a20 2020 2020 2a2f 0a20 2020  rray.     */.   
-000153d0: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-000153e0: 2067 6574 5472 616e 736c 6174 696f 6e73   getTranslations
-000153f0: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
-00015400: 2069 6620 2865 6d70 7479 2824 7468 6973   if (empty($this
-00015410: 2d3e 6c61 6e67 7561 6765 2929 207b 0a20  ->language)) {. 
-00015420: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-00015430: 2d3e 7365 744c 616e 6775 6167 6528 293b  ->setLanguage();
-00015440: 202f 2f20 5365 7420 7468 6520 6465 6661   // Set the defa
-00015450: 756c 7420 6c61 6e67 7561 6765 2e0a 2020  ult language..  
-00015460: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00015470: 2072 6574 7572 6e20 2474 6869 732d 3e6c   return $this->l
-00015480: 616e 6775 6167 653b 0a20 2020 207d 0a0a  anguage;.    }..
-00015490: 2020 2020 2f2a 2a0a 2020 2020 202a 2043      /**.     * C
-000154a0: 7265 6174 6520 7265 6369 7069 656e 7420  reate recipient 
-000154b0: 6865 6164 6572 732e 0a20 2020 2020 2a0a  headers..     *.
-000154c0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-000154d0: 7269 6e67 2024 7479 7065 0a20 2020 2020  ring $type.     
-000154e0: 2a20 4070 6172 616d 2061 7272 6179 2020  * @param array  
-000154f0: 2461 6464 7220 416e 2061 7272 6179 206f  $addr An array o
-00015500: 6620 7265 6369 7069 656e 7473 2c0a 2020  f recipients,.  
-00015510: 2020 202a 2020 2020 2020 2020 2020 2020     *            
-00015520: 2020 2020 2020 2020 2077 6865 7265 2065           where e
-00015530: 6163 6820 7265 6369 7069 656e 7420 6973  ach recipient is
-00015540: 2061 2032 2d65 6c65 6d65 6e74 2069 6e64   a 2-element ind
-00015550: 6578 6564 2061 7272 6179 2077 6974 6820  exed array with 
-00015560: 656c 656d 656e 7420 3020 636f 6e74 6169  element 0 contai
-00015570: 6e69 6e67 2061 6e20 6164 6472 6573 730a  ning an address.
-00015580: 2020 2020 202a 2020 2020 2020 2020 2020       *          
-00015590: 2020 2020 2020 2020 2020 2061 6e64 2065             and e
-000155a0: 6c65 6d65 6e74 2031 2063 6f6e 7461 696e  lement 1 contain
-000155b0: 696e 6720 6120 6e61 6d65 2c20 6c69 6b65  ing a name, like
-000155c0: 3a0a 2020 2020 202a 2020 2020 2020 2020  :.     *        
-000155d0: 2020 2020 2020 2020 2020 2020 205b 5b27               [['
-000155e0: 6a6f 6540 6578 616d 706c 652e 636f 6d27  joe@example.com'
-000155f0: 2c20 274a 6f65 2055 7365 7227 5d2c 205b  , 'Joe User'], [
-00015600: 277a 6f65 4065 7861 6d70 6c65 2e63 6f6d  'zoe@example.com
-00015610: 272c 2027 5a6f 6520 5573 6572 275d 5d0a  ', 'Zoe User']].
-00015620: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00015630: 6574 7572 6e20 7374 7269 6e67 0a20 2020  eturn string.   
-00015640: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-00015650: 6675 6e63 7469 6f6e 2061 6464 7241 7070  function addrApp
-00015660: 656e 6428 2474 7970 652c 2024 6164 6472  end($type, $addr
-00015670: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00015680: 2461 6464 7265 7373 6573 203d 205b 5d3b  $addresses = [];
-00015690: 0a20 2020 2020 2020 2066 6f72 6561 6368  .        foreach
-000156a0: 2028 2461 6464 7220 6173 2024 6164 6472   ($addr as $addr
-000156b0: 6573 7329 207b 0a20 2020 2020 2020 2020  ess) {.         
-000156c0: 2020 2024 6164 6472 6573 7365 735b 5d20     $addresses[] 
-000156d0: 3d20 2474 6869 732d 3e61 6464 7246 6f72  = $this->addrFor
-000156e0: 6d61 7428 2461 6464 7265 7373 293b 0a20  mat($address);. 
-000156f0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-00015700: 2020 7265 7475 726e 2024 7479 7065 202e    return $type .
-00015710: 2027 3a20 2720 2e20 696d 706c 6f64 6528   ': ' . implode(
-00015720: 272c 2027 2c20 2461 6464 7265 7373 6573  ', ', $addresses
-00015730: 2920 2e20 7374 6174 6963 3a3a 244c 453b  ) . static::$LE;
-00015740: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00015750: 2020 2020 202a 2046 6f72 6d61 7420 616e       * Format an
-00015760: 2061 6464 7265 7373 2066 6f72 2075 7365   address for use
-00015770: 2069 6e20 6120 6d65 7373 6167 6520 6865   in a message he
-00015780: 6164 6572 2e0a 2020 2020 202a 0a20 2020  ader..     *.   
-00015790: 2020 2a20 4070 6172 616d 2061 7272 6179    * @param array
-000157a0: 2024 6164 6472 2041 2032 2d65 6c65 6d65   $addr A 2-eleme
-000157b0: 6e74 2069 6e64 6578 6564 2061 7272 6179  nt indexed array
-000157c0: 2c20 656c 656d 656e 7420 3020 636f 6e74  , element 0 cont
-000157d0: 6169 6e69 6e67 2061 6e20 6164 6472 6573  aining an addres
-000157e0: 732c 2065 6c65 6d65 6e74 2031 2063 6f6e  s, element 1 con
-000157f0: 7461 696e 696e 6720 6120 6e61 6d65 206c  taining a name l
-00015800: 696b 650a 2020 2020 202a 2020 2020 2020  ike.     *      
-00015810: 2020 2020 2020 2020 2020 2020 2020 5b27                ['
-00015820: 6a6f 6540 6578 616d 706c 652e 636f 6d27  joe@example.com'
-00015830: 2c20 274a 6f65 2055 7365 7227 5d0a 2020  , 'Joe User'].  
-00015840: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00015850: 7572 6e20 7374 7269 6e67 0a20 2020 2020  urn string.     
-00015860: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-00015870: 6e63 7469 6f6e 2061 6464 7246 6f72 6d61  nction addrForma
-00015880: 7428 2461 6464 7229 0a20 2020 207b 0a20  t($addr).    {. 
-00015890: 2020 2020 2020 2069 6620 2865 6d70 7479         if (empty
-000158a0: 2824 6164 6472 5b31 5d29 2920 7b20 2f2f  ($addr[1])) { //
-000158b0: 4e6f 206e 616d 6520 7072 6f76 6964 6564  No name provided
-000158c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000158d0: 7572 6e20 2474 6869 732d 3e73 6563 7572  urn $this->secur
-000158e0: 6548 6561 6465 7228 2461 6464 725b 305d  eHeader($addr[0]
-000158f0: 293b 0a20 2020 2020 2020 207d 0a0a 2020  );.        }..  
-00015900: 2020 2020 2020 7265 7475 726e 2024 7468        return $th
-00015910: 6973 2d3e 656e 636f 6465 4865 6164 6572  is->encodeHeader
-00015920: 2824 7468 6973 2d3e 7365 6375 7265 4865  ($this->secureHe
-00015930: 6164 6572 2824 6164 6472 5b31 5d29 2c20  ader($addr[1]), 
-00015940: 2770 6872 6173 6527 2920 2e0a 2020 2020  'phrase') ..    
-00015950: 2020 2020 2020 2020 2720 3c27 202e 2024          ' <' . $
-00015960: 7468 6973 2d3e 7365 6375 7265 4865 6164  this->secureHead
-00015970: 6572 2824 6164 6472 5b30 5d29 202e 2027  er($addr[0]) . '
-00015980: 3e27 3b0a 2020 2020 7d0a 0a20 2020 202f  >';.    }..    /
-00015990: 2a2a 0a20 2020 2020 2a20 576f 7264 2d77  **.     * Word-w
-000159a0: 7261 7020 6d65 7373 6167 652e 0a20 2020  rap message..   
-000159b0: 2020 2a20 466f 7220 7573 6520 7769 7468    * For use with
-000159c0: 206d 6169 6c65 7273 2074 6861 7420 646f   mailers that do
-000159d0: 206e 6f74 2061 7574 6f6d 6174 6963 616c   not automatical
-000159e0: 6c79 2070 6572 666f 726d 2077 7261 7070  ly perform wrapp
-000159f0: 696e 670a 2020 2020 202a 2061 6e64 2066  ing.     * and f
-00015a00: 6f72 2071 756f 7465 642d 7072 696e 7461  or quoted-printa
-00015a10: 626c 6520 656e 636f 6465 6420 6d65 7373  ble encoded mess
-00015a20: 6167 6573 2e0a 2020 2020 202a 204f 7269  ages..     * Ori
-00015a30: 6769 6e61 6c20 7772 6974 7465 6e20 6279  ginal written by
-00015a40: 2070 6869 6c69 7070 652e 0a20 2020 2020   philippe..     
-00015a50: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-00015a60: 7374 7269 6e67 2024 6d65 7373 6167 6520  string $message 
-00015a70: 5468 6520 6d65 7373 6167 6520 746f 2077  The message to w
-00015a80: 7261 700a 2020 2020 202a 2040 7061 7261  rap.     * @para
-00015a90: 6d20 696e 7420 2020 2024 6c65 6e67 7468  m int    $length
-00015aa0: 2020 5468 6520 6c69 6e65 206c 656e 6774    The line lengt
-00015ab0: 6820 746f 2077 7261 7020 746f 0a20 2020  h to wrap to.   
-00015ac0: 2020 2a20 4070 6172 616d 2062 6f6f 6c20    * @param bool 
-00015ad0: 2020 2471 705f 6d6f 6465 2057 6865 7468    $qp_mode Wheth
-00015ae0: 6572 2074 6f20 7275 6e20 696e 2051 756f  er to run in Quo
-00015af0: 7465 642d 5072 696e 7461 626c 6520 6d6f  ted-Printable mo
-00015b00: 6465 0a20 2020 2020 2a0a 2020 2020 202a  de.     *.     *
-00015b10: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
-00015b20: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00015b30: 6963 2066 756e 6374 696f 6e20 7772 6170  ic function wrap
-00015b40: 5465 7874 2824 6d65 7373 6167 652c 2024  Text($message, $
-00015b50: 6c65 6e67 7468 2c20 2471 705f 6d6f 6465  length, $qp_mode
-00015b60: 203d 2066 616c 7365 290a 2020 2020 7b0a   = false).    {.
-00015b70: 2020 2020 2020 2020 6966 2028 2471 705f          if ($qp_
-00015b80: 6d6f 6465 2920 7b0a 2020 2020 2020 2020  mode) {.        
-00015b90: 2020 2020 2473 6f66 745f 6272 6561 6b20      $soft_break 
-00015ba0: 3d20 7370 7269 6e74 6628 2720 3d25 7327  = sprintf(' =%s'
-00015bb0: 2c20 7374 6174 6963 3a3a 244c 4529 3b0a  , static::$LE);.
-00015bc0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
-00015bd0: 0a20 2020 2020 2020 2020 2020 2024 736f  .            $so
-00015be0: 6674 5f62 7265 616b 203d 2073 7461 7469  ft_break = stati
-00015bf0: 633a 3a24 4c45 3b0a 2020 2020 2020 2020  c::$LE;.        
-00015c00: 7d0a 2020 2020 2020 2020 2f2f 4966 2075  }.        //If u
-00015c10: 7466 2d38 2065 6e63 6f64 696e 6720 6973  tf-8 encoding is
-00015c20: 2075 7365 642c 2077 6520 7769 6c6c 206e   used, we will n
-00015c30: 6565 6420 746f 206d 616b 6520 7375 7265  eed to make sure
-00015c40: 2077 6520 646f 6e27 740a 2020 2020 2020   we don't.      
-00015c50: 2020 2f2f 7370 6c69 7420 6d75 6c74 6962    //split multib
-00015c60: 7974 6520 6368 6172 6163 7465 7273 2077  yte characters w
-00015c70: 6865 6e20 7765 2077 7261 700a 2020 2020  hen we wrap.    
-00015c80: 2020 2020 2469 735f 7574 6638 203d 2073      $is_utf8 = s
-00015c90: 7461 7469 633a 3a43 4841 5253 4554 5f55  tatic::CHARSET_U
-00015ca0: 5446 3820 3d3d 3d20 7374 7274 6f6c 6f77  TF8 === strtolow
-00015cb0: 6572 2824 7468 6973 2d3e 4368 6172 5365  er($this->CharSe
-00015cc0: 7429 3b0a 2020 2020 2020 2020 246c 656c  t);.        $lel
-00015cd0: 656e 203d 2073 7472 6c65 6e28 7374 6174  en = strlen(stat
-00015ce0: 6963 3a3a 244c 4529 3b0a 2020 2020 2020  ic::$LE);.      
-00015cf0: 2020 2463 726c 666c 656e 203d 2073 7472    $crlflen = str
-00015d00: 6c65 6e28 7374 6174 6963 3a3a 244c 4529  len(static::$LE)
-00015d10: 3b0a 0a20 2020 2020 2020 2024 6d65 7373  ;..        $mess
-00015d20: 6167 6520 3d20 7374 6174 6963 3a3a 6e6f  age = static::no
-00015d30: 726d 616c 697a 6542 7265 616b 7328 246d  rmalizeBreaks($m
-00015d40: 6573 7361 6765 293b 0a20 2020 2020 2020  essage);.       
-00015d50: 202f 2f52 656d 6f76 6520 6120 7472 6169   //Remove a trai
-00015d60: 6c69 6e67 206c 696e 6520 6272 6561 6b0a  ling line break.
-00015d70: 2020 2020 2020 2020 6966 2028 7375 6273          if (subs
-00015d80: 7472 2824 6d65 7373 6167 652c 202d 246c  tr($message, -$l
-00015d90: 656c 656e 2920 3d3d 3d20 7374 6174 6963  elen) === static
-00015da0: 3a3a 244c 4529 207b 0a20 2020 2020 2020  ::$LE) {.       
-00015db0: 2020 2020 2024 6d65 7373 6167 6520 3d20       $message = 
-00015dc0: 7375 6273 7472 2824 6d65 7373 6167 652c  substr($message,
-00015dd0: 2030 2c20 2d24 6c65 6c65 6e29 3b0a 2020   0, -$lelen);.  
-00015de0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00015df0: 202f 2f53 706c 6974 206d 6573 7361 6765   //Split message
-00015e00: 2069 6e74 6f20 6c69 6e65 730a 2020 2020   into lines.    
-00015e10: 2020 2020 246c 696e 6573 203d 2065 7870      $lines = exp
-00015e20: 6c6f 6465 2873 7461 7469 633a 3a24 4c45  lode(static::$LE
-00015e30: 2c20 246d 6573 7361 6765 293b 0a20 2020  , $message);.   
-00015e40: 2020 2020 202f 2f4d 6573 7361 6765 2077       //Message w
-00015e50: 696c 6c20 6265 2072 6562 7569 6c74 2069  ill be rebuilt i
-00015e60: 6e20 6865 7265 0a20 2020 2020 2020 2024  n here.        $
-00015e70: 6d65 7373 6167 6520 3d20 2727 3b0a 2020  message = '';.  
-00015e80: 2020 2020 2020 666f 7265 6163 6820 2824        foreach ($
-00015e90: 6c69 6e65 7320 6173 2024 6c69 6e65 2920  lines as $line) 
-00015ea0: 7b0a 2020 2020 2020 2020 2020 2020 2477  {.            $w
-00015eb0: 6f72 6473 203d 2065 7870 6c6f 6465 2827  ords = explode('
-00015ec0: 2027 2c20 246c 696e 6529 3b0a 2020 2020   ', $line);.    
-00015ed0: 2020 2020 2020 2020 2462 7566 203d 2027          $buf = '
-00015ee0: 273b 0a20 2020 2020 2020 2020 2020 2024  ';.            $
-00015ef0: 6669 7273 7477 6f72 6420 3d20 7472 7565  firstword = true
-00015f00: 3b0a 2020 2020 2020 2020 2020 2020 666f  ;.            fo
-00015f10: 7265 6163 6820 2824 776f 7264 7320 6173  reach ($words as
-00015f20: 2024 776f 7264 2920 7b0a 2020 2020 2020   $word) {.      
-00015f30: 2020 2020 2020 2020 2020 6966 2028 2471            if ($q
-00015f40: 705f 6d6f 6465 2026 2620 2873 7472 6c65  p_mode && (strle
-00015f50: 6e28 2477 6f72 6429 203e 2024 6c65 6e67  n($word) > $leng
-00015f60: 7468 2929 207b 0a20 2020 2020 2020 2020  th)) {.         
-00015f70: 2020 2020 2020 2020 2020 2024 7370 6163             $spac
-00015f80: 655f 6c65 6674 203d 2024 6c65 6e67 7468  e_left = $length
-00015f90: 202d 2073 7472 6c65 6e28 2462 7566 2920   - strlen($buf) 
-00015fa0: 2d20 2463 726c 666c 656e 3b0a 2020 2020  - $crlflen;.    
-00015fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fc0: 6966 2028 2124 6669 7273 7477 6f72 6429  if (!$firstword)
-00015fd0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00015fe0: 2020 2020 2020 2020 2020 2069 6620 2824             if ($
-00015ff0: 7370 6163 655f 6c65 6674 203e 2032 3029  space_left > 20)
-00016000: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00016010: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00016020: 6c65 6e20 3d20 2473 7061 6365 5f6c 6566  len = $space_lef
-00016030: 743b 0a20 2020 2020 2020 2020 2020 2020  t;.             
-00016040: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016050: 6620 2824 6973 5f75 7466 3829 207b 0a20  f ($is_utf8) {. 
-00016060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016070: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00016080: 6c65 6e20 3d20 2474 6869 732d 3e75 7466  len = $this->utf
-00016090: 3843 6861 7242 6f75 6e64 6172 7928 2477  8CharBoundary($w
-000160a0: 6f72 642c 2024 6c65 6e29 3b0a 2020 2020  ord, $len);.    
-000160b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160c0: 2020 2020 2020 2020 7d20 656c 7365 6966          } elseif
-000160d0: 2028 273d 2720 3d3d 3d20 7375 6273 7472   ('=' === substr
-000160e0: 2824 776f 7264 2c20 246c 656e 202d 2031  ($word, $len - 1
-000160f0: 2c20 3129 2920 7b0a 2020 2020 2020 2020  , 1)) {.        
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 2020 2020 2020 2020 2d2d 246c 656e 3b0a          --$len;.
-00016120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016130: 2020 2020 2020 2020 2020 2020 7d20 656c              } el
-00016140: 7365 6966 2028 273d 2720 3d3d 3d20 7375  seif ('=' === su
-00016150: 6273 7472 2824 776f 7264 2c20 246c 656e  bstr($word, $len
-00016160: 202d 2032 2c20 3129 2920 7b0a 2020 2020   - 2, 1)) {.    
-00016170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016180: 2020 2020 2020 2020 2020 2020 246c 656e              $len
-00016190: 202d 3d20 323b 0a20 2020 2020 2020 2020   -= 2;.         
-000161a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161b0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 2024 7061 7274 203d 2073 7562 7374 7228   $part = substr(
-000161e0: 2477 6f72 642c 2030 2c20 246c 656e 293b  $word, 0, $len);
-000161f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016200: 2020 2020 2020 2020 2020 2020 2024 776f               $wo
-00016210: 7264 203d 2073 7562 7374 7228 2477 6f72  rd = substr($wor
-00016220: 642c 2024 6c65 6e29 3b0a 2020 2020 2020  d, $len);.      
-00016230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016240: 2020 2020 2020 2462 7566 202e 3d20 2720        $buf .= ' 
-00016250: 2720 2e20 2470 6172 743b 0a20 2020 2020  ' . $part;.     
-00016260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016270: 2020 2020 2020 2024 6d65 7373 6167 6520         $message 
-00016280: 2e3d 2024 6275 6620 2e20 7370 7269 6e74  .= $buf . sprint
-00016290: 6628 273d 2573 272c 2073 7461 7469 633a  f('=%s', static:
-000162a0: 3a24 4c45 293b 0a20 2020 2020 2020 2020  :$LE);.         
-000162b0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000162c0: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
-000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162e0: 2020 2020 246d 6573 7361 6765 202e 3d20      $message .= 
-000162f0: 2462 7566 202e 2024 736f 6674 5f62 7265  $buf . $soft_bre
-00016300: 616b 3b0a 2020 2020 2020 2020 2020 2020  ak;.            
-00016310: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00016320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016330: 2020 2020 2020 2462 7566 203d 2027 273b        $buf = '';
-00016340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016350: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00016360: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-00016370: 2028 2477 6f72 6420 213d 3d20 2727 2920   ($word !== '') 
-00016380: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00016390: 2020 2020 2020 2020 2020 6966 2028 246c            if ($l
-000163a0: 656e 6774 6820 3c3d 2030 2920 7b0a 2020  ength <= 0) {.  
-000163b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163c0: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
-000163d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000163e0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-000163f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016400: 2020 2024 6c65 6e20 3d20 246c 656e 6774     $len = $lengt
-00016410: 683b 0a20 2020 2020 2020 2020 2020 2020  h;.             
-00016420: 2020 2020 2020 2020 2020 2069 6620 2824             if ($
-00016430: 6973 5f75 7466 3829 207b 0a20 2020 2020  is_utf8) {.     
-00016440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016450: 2020 2020 2020 2024 6c65 6e20 3d20 2474         $len = $t
-00016460: 6869 732d 3e75 7466 3843 6861 7242 6f75  his->utf8CharBou
-00016470: 6e64 6172 7928 2477 6f72 642c 2024 6c65  ndary($word, $le
-00016480: 6e29 3b0a 2020 2020 2020 2020 2020 2020  n);.            
-00016490: 2020 2020 2020 2020 2020 2020 7d20 656c              } el
-000164a0: 7365 6966 2028 273d 2720 3d3d 3d20 7375  seif ('=' === su
-000164b0: 6273 7472 2824 776f 7264 2c20 246c 656e  bstr($word, $len
-000164c0: 202d 2031 2c20 3129 2920 7b0a 2020 2020   - 1, 1)) {.    
-000164d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000164e0: 2020 2020 2020 2020 2d2d 246c 656e 3b0a          --$len;.
-000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016500: 2020 2020 2020 2020 7d20 656c 7365 6966          } elseif
-00016510: 2028 273d 2720 3d3d 3d20 7375 6273 7472   ('=' === substr
-00016520: 2824 776f 7264 2c20 246c 656e 202d 2032  ($word, $len - 2
-00016530: 2c20 3129 2920 7b0a 2020 2020 2020 2020  , 1)) {.        
-00016540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016550: 2020 2020 246c 656e 202d 3d20 323b 0a20      $len -= 2;. 
-00016560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016570: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016590: 2024 7061 7274 203d 2073 7562 7374 7228   $part = substr(
-000165a0: 2477 6f72 642c 2030 2c20 246c 656e 293b  $word, 0, $len);
-000165b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000165c0: 2020 2020 2020 2020 2024 776f 7264 203d           $word =
-000165d0: 2028 7374 7269 6e67 2920 7375 6273 7472   (string) substr
-000165e0: 2824 776f 7264 2c20 246c 656e 293b 0a0a  ($word, $len);..
-000165f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016600: 2020 2020 2020 2020 6966 2028 2477 6f72          if ($wor
-00016610: 6420 213d 3d20 2727 2920 7b0a 2020 2020  d !== '') {.    
-00016620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016630: 2020 2020 2020 2020 246d 6573 7361 6765          $message
-00016640: 202e 3d20 2470 6172 7420 2e20 7370 7269   .= $part . spri
-00016650: 6e74 6628 273d 2573 272c 2073 7461 7469  ntf('=%s', stati
-00016660: 633a 3a24 4c45 293b 0a20 2020 2020 2020  c::$LE);.       
-00016670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016680: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
-00016690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000166a0: 2020 2020 2020 2462 7566 203d 2024 7061        $buf = $pa
-000166b0: 7274 3b0a 2020 2020 2020 2020 2020 2020  rt;.            
-000166c0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-000166d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000166e0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-000166f0: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
-00016700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016710: 2024 6275 665f 6f20 3d20 2462 7566 3b0a   $buf_o = $buf;.
-00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016730: 2020 2020 6966 2028 2124 6669 7273 7477      if (!$firstw
-00016740: 6f72 6429 207b 0a20 2020 2020 2020 2020  ord) {.         
-00016750: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00016760: 6275 6620 2e3d 2027 2027 3b0a 2020 2020  buf .= ' ';.    
-00016770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016780: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00016790: 2020 2020 2020 2462 7566 202e 3d20 2477        $buf .= $w
-000167a0: 6f72 643b 0a0a 2020 2020 2020 2020 2020  ord;..          
-000167b0: 2020 2020 2020 2020 2020 6966 2028 2727            if (''
-000167c0: 2021 3d3d 2024 6275 665f 6f20 2626 2073   !== $buf_o && s
-000167d0: 7472 6c65 6e28 2462 7566 2920 3e20 246c  trlen($buf) > $l
-000167e0: 656e 6774 6829 207b 0a20 2020 2020 2020  ength) {.       
-000167f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016800: 2024 6d65 7373 6167 6520 2e3d 2024 6275   $message .= $bu
-00016810: 665f 6f20 2e20 2473 6f66 745f 6272 6561  f_o . $soft_brea
-00016820: 6b3b 0a20 2020 2020 2020 2020 2020 2020  k;.             
-00016830: 2020 2020 2020 2020 2020 2024 6275 6620             $buf 
-00016840: 3d20 2477 6f72 643b 0a20 2020 2020 2020  = $word;.       
-00016850: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00016860: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00016870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016880: 2024 6669 7273 7477 6f72 6420 3d20 6661   $firstword = fa
-00016890: 6c73 653b 0a20 2020 2020 2020 2020 2020  lse;.           
-000168a0: 207d 0a20 2020 2020 2020 2020 2020 2024   }.            $
-000168b0: 6d65 7373 6167 6520 2e3d 2024 6275 6620  message .= $buf 
-000168c0: 2e20 7374 6174 6963 3a3a 244c 453b 0a20  . static::$LE;. 
-000168d0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-000168e0: 2020 7265 7475 726e 2024 6d65 7373 6167    return $messag
-000168f0: 653b 0a20 2020 207d 0a0a 2020 2020 2f2a  e;.    }..    /*
-00016900: 2a0a 2020 2020 202a 2046 696e 6420 7468  *.     * Find th
-00016910: 6520 6c61 7374 2063 6861 7261 6374 6572  e last character
-00016920: 2062 6f75 6e64 6172 7920 7072 696f 7220   boundary prior 
-00016930: 746f 2024 6d61 784c 656e 6774 6820 696e  to $maxLength in
-00016940: 2061 2075 7466 2d38 0a20 2020 2020 2a20   a utf-8.     * 
-00016950: 7175 6f74 6564 2d70 7269 6e74 6162 6c65  quoted-printable
-00016960: 2065 6e63 6f64 6564 2073 7472 696e 672e   encoded string.
-00016970: 0a20 2020 2020 2a20 4f72 6967 696e 616c  .     * Original
-00016980: 2077 7269 7474 656e 2062 7920 436f 6c69   written by Coli
-00016990: 6e20 4272 6f77 6e2e 0a20 2020 2020 2a0a  n Brown..     *.
-000169a0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-000169b0: 7269 6e67 2024 656e 636f 6465 6454 6578  ring $encodedTex
-000169c0: 7420 7574 662d 3820 5150 2074 6578 740a  t utf-8 QP text.
-000169d0: 2020 2020 202a 2040 7061 7261 6d20 696e       * @param in
-000169e0: 7420 2020 2024 6d61 784c 656e 6774 6820  t    $maxLength 
-000169f0: 2020 4669 6e64 2074 6865 206c 6173 7420    Find the last 
-00016a00: 6368 6172 6163 7465 7220 626f 756e 6461  character bounda
-00016a10: 7279 2070 7269 6f72 2074 6f20 7468 6973  ry prior to this
-00016a20: 206c 656e 6774 680a 2020 2020 202a 0a20   length.     *. 
-00016a30: 2020 2020 2a20 4072 6574 7572 6e20 696e      * @return in
-00016a40: 740a 2020 2020 202a 2f0a 2020 2020 7075  t.     */.    pu
-00016a50: 626c 6963 2066 756e 6374 696f 6e20 7574  blic function ut
-00016a60: 6638 4368 6172 426f 756e 6461 7279 2824  f8CharBoundary($
-00016a70: 656e 636f 6465 6454 6578 742c 2024 6d61  encodedText, $ma
-00016a80: 784c 656e 6774 6829 0a20 2020 207b 0a20  xLength).    {. 
-00016a90: 2020 2020 2020 2024 666f 756e 6453 706c         $foundSpl
-00016aa0: 6974 506f 7320 3d20 6661 6c73 653b 0a20  itPos = false;. 
-00016ab0: 2020 2020 2020 2024 6c6f 6f6b 4261 636b         $lookBack
-00016ac0: 203d 2033 3b0a 2020 2020 2020 2020 7768   = 3;.        wh
-00016ad0: 696c 6520 2821 2466 6f75 6e64 5370 6c69  ile (!$foundSpli
-00016ae0: 7450 6f73 2920 7b0a 2020 2020 2020 2020  tPos) {.        
-00016af0: 2020 2020 246c 6173 7443 6875 6e6b 203d      $lastChunk =
-00016b00: 2073 7562 7374 7228 2465 6e63 6f64 6564   substr($encoded
-00016b10: 5465 7874 2c20 246d 6178 4c65 6e67 7468  Text, $maxLength
-00016b20: 202d 2024 6c6f 6f6b 4261 636b 2c20 246c   - $lookBack, $l
-00016b30: 6f6f 6b42 6163 6b29 3b0a 2020 2020 2020  ookBack);.      
-00016b40: 2020 2020 2020 2465 6e63 6f64 6564 4368        $encodedCh
-00016b50: 6172 506f 7320 3d20 7374 7270 6f73 2824  arPos = strpos($
-00016b60: 6c61 7374 4368 756e 6b2c 2027 3d27 293b  lastChunk, '=');
-00016b70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016b80: 2866 616c 7365 2021 3d3d 2024 656e 636f  (false !== $enco
-00016b90: 6465 6443 6861 7250 6f73 2920 7b0a 2020  dedCharPos) {.  
-00016ba0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00016bb0: 466f 756e 6420 7374 6172 7420 6f66 2065  Found start of e
-00016bc0: 6e63 6f64 6564 2063 6861 7261 6374 6572  ncoded character
-00016bd0: 2062 7974 6520 7769 7468 696e 2024 6c6f   byte within $lo
-00016be0: 6f6b 4261 636b 2062 6c6f 636b 2e0a 2020  okBack block..  
-00016bf0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00016c00: 4368 6563 6b20 7468 6520 656e 636f 6465  Check the encode
-00016c10: 6420 6279 7465 2076 616c 7565 2028 7468  d byte value (th
-00016c20: 6520 3220 6368 6172 7320 6166 7465 7220  e 2 chars after 
-00016c30: 7468 6520 273d 2729 0a20 2020 2020 2020  the '=').       
-00016c40: 2020 2020 2020 2020 2024 6865 7820 3d20           $hex = 
-00016c50: 7375 6273 7472 2824 656e 636f 6465 6454  substr($encodedT
-00016c60: 6578 742c 2024 6d61 784c 656e 6774 6820  ext, $maxLength 
-00016c70: 2d20 246c 6f6f 6b42 6163 6b20 2b20 2465  - $lookBack + $e
-00016c80: 6e63 6f64 6564 4368 6172 506f 7320 2b20  ncodedCharPos + 
-00016c90: 312c 2032 293b 0a20 2020 2020 2020 2020  1, 2);.         
-00016ca0: 2020 2020 2020 2024 6465 6320 3d20 6865         $dec = he
-00016cb0: 7864 6563 2824 6865 7829 3b0a 2020 2020  xdec($hex);.    
-00016cc0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00016cd0: 2464 6563 203c 2031 3238 2920 7b0a 2020  $dec < 128) {.  
-00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cf0: 2020 2f2f 5369 6e67 6c65 2062 7974 6520    //Single byte 
-00016d00: 6368 6172 6163 7465 722e 0a20 2020 2020  character..     
-00016d10: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00016d20: 2f49 6620 7468 6520 656e 636f 6465 6420  /If the encoded 
-00016d30: 6368 6172 2077 6173 2066 6f75 6e64 2061  char was found a
-00016d40: 7420 706f 7320 302c 2069 7420 7769 6c6c  t pos 0, it will
-00016d50: 2066 6974 0a20 2020 2020 2020 2020 2020   fit.           
-00016d60: 2020 2020 2020 2020 202f 2f6f 7468 6572           //other
-00016d70: 7769 7365 2072 6564 7563 6520 6d61 784c  wise reduce maxL
-00016d80: 656e 6774 6820 746f 2073 7461 7274 206f  ength to start o
-00016d90: 6620 7468 6520 656e 636f 6465 6420 6368  f the encoded ch
-00016da0: 6172 0a20 2020 2020 2020 2020 2020 2020  ar.             
-00016db0: 2020 2020 2020 2069 6620 2824 656e 636f         if ($enco
-00016dc0: 6465 6443 6861 7250 6f73 203e 2030 2920  dedCharPos > 0) 
-00016dd0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00016de0: 2020 2020 2020 2020 2020 246d 6178 4c65            $maxLe
-00016df0: 6e67 7468 202d 3d20 246c 6f6f 6b42 6163  ngth -= $lookBac
-00016e00: 6b20 2d20 2465 6e63 6f64 6564 4368 6172  k - $encodedChar
-00016e10: 506f 733b 0a20 2020 2020 2020 2020 2020  Pos;.           
-00016e20: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00016e30: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00016e40: 666f 756e 6453 706c 6974 506f 7320 3d20  foundSplitPos = 
-00016e50: 7472 7565 3b0a 2020 2020 2020 2020 2020  true;.          
-00016e60: 2020 2020 2020 7d20 656c 7365 6966 2028        } elseif (
-00016e70: 2464 6563 203e 3d20 3139 3229 207b 0a20  $dec >= 192) {. 
-00016e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e90: 2020 202f 2f46 6972 7374 2062 7974 6520     //First byte 
-00016ea0: 6f66 2061 206d 756c 7469 2062 7974 6520  of a multi byte 
-00016eb0: 6368 6172 6163 7465 720a 2020 2020 2020  character.      
-00016ec0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00016ed0: 5265 6475 6365 206d 6178 4c65 6e67 7468  Reduce maxLength
-00016ee0: 2074 6f20 7370 6c69 7420 6174 2073 7461   to split at sta
-00016ef0: 7274 206f 6620 6368 6172 6163 7465 720a  rt of character.
-00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f10: 2020 2020 246d 6178 4c65 6e67 7468 202d      $maxLength -
-00016f20: 3d20 246c 6f6f 6b42 6163 6b20 2d20 2465  = $lookBack - $e
-00016f30: 6e63 6f64 6564 4368 6172 506f 733b 0a20  ncodedCharPos;. 
-00016f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f50: 2020 2024 666f 756e 6453 706c 6974 506f     $foundSplitPo
-00016f60: 7320 3d20 7472 7565 3b0a 2020 2020 2020  s = true;.      
-00016f70: 2020 2020 2020 2020 2020 7d20 656c 7365            } else
-00016f80: 6966 2028 2464 6563 203c 2031 3932 2920  if ($dec < 192) 
-00016f90: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00016fa0: 2020 2020 2020 2f2f 4d69 6464 6c65 2062        //Middle b
-00016fb0: 7974 6520 6f66 2061 206d 756c 7469 2062  yte of a multi b
-00016fc0: 7974 6520 6368 6172 6163 7465 722c 206c  yte character, l
-00016fd0: 6f6f 6b20 6675 7274 6865 7220 6261 636b  ook further back
-00016fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ff0: 2020 2020 2024 6c6f 6f6b 4261 636b 202b       $lookBack +
-00017000: 3d20 333b 0a20 2020 2020 2020 2020 2020  = 3;.           
-00017010: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00017020: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-00017030: 2020 2020 2020 2020 2020 2020 2f2f 4e6f              //No
-00017040: 2065 6e63 6f64 6564 2063 6861 7261 6374   encoded charact
-00017050: 6572 2066 6f75 6e64 0a20 2020 2020 2020  er found.       
-00017060: 2020 2020 2020 2020 2024 666f 756e 6453           $foundS
-00017070: 706c 6974 506f 7320 3d20 7472 7565 3b0a  plitPos = true;.
-00017080: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00017090: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-000170a0: 2072 6574 7572 6e20 246d 6178 4c65 6e67   return $maxLeng
-000170b0: 7468 3b0a 2020 2020 7d0a 0a20 2020 202f  th;.    }..    /
-000170c0: 2a2a 0a20 2020 2020 2a20 4170 706c 7920  **.     * Apply 
-000170d0: 776f 7264 2077 7261 7070 696e 6720 746f  word wrapping to
-000170e0: 2074 6865 206d 6573 7361 6765 2062 6f64   the message bod
-000170f0: 792e 0a20 2020 2020 2a20 5772 6170 7320  y..     * Wraps 
-00017100: 7468 6520 6d65 7373 6167 6520 626f 6479  the message body
-00017110: 2074 6f20 7468 6520 6e75 6d62 6572 206f   to the number o
-00017120: 6620 6368 6172 7320 7365 7420 696e 2074  f chars set in t
-00017130: 6865 2057 6f72 6457 7261 7020 7072 6f70  he WordWrap prop
-00017140: 6572 7479 2e0a 2020 2020 202a 2059 6f75  erty..     * You
-00017150: 2073 686f 756c 6420 6f6e 6c79 2064 6f20   should only do 
-00017160: 7468 6973 2074 6f20 706c 6169 6e2d 7465  this to plain-te
-00017170: 7874 2062 6f64 6965 7320 6173 2077 7261  xt bodies as wra
-00017180: 7070 696e 6720 4854 4d4c 2074 6167 7320  pping HTML tags 
-00017190: 6d61 7920 6272 6561 6b20 7468 656d 2e0a  may break them..
-000171a0: 2020 2020 202a 2054 6869 7320 6973 2063       * This is c
-000171b0: 616c 6c65 6420 6175 746f 6d61 7469 6361  alled automatica
-000171c0: 6c6c 7920 6279 2063 7265 6174 6542 6f64  lly by createBod
-000171d0: 7928 292c 2073 6f20 796f 7520 646f 6e27  y(), so you don'
-000171e0: 7420 6e65 6564 2074 6f20 6361 6c6c 2069  t need to call i
-000171f0: 7420 796f 7572 7365 6c66 2e0a 2020 2020  t yourself..    
-00017200: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-00017210: 756e 6374 696f 6e20 7365 7457 6f72 6457  unction setWordW
-00017220: 7261 7028 290a 2020 2020 7b0a 2020 2020  rap().    {.    
-00017230: 2020 2020 6966 2028 2474 6869 732d 3e57      if ($this->W
-00017240: 6f72 6457 7261 7020 3c20 3129 207b 0a20  ordWrap < 1) {. 
-00017250: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017260: 6e3b 0a20 2020 2020 2020 207d 0a0a 2020  n;.        }..  
-00017270: 2020 2020 2020 7377 6974 6368 2028 2474        switch ($t
-00017280: 6869 732d 3e6d 6573 7361 6765 5f74 7970  his->message_typ
-00017290: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-000172a0: 2063 6173 6520 2761 6c74 273a 0a20 2020   case 'alt':.   
-000172b0: 2020 2020 2020 2020 2063 6173 6520 2761           case 'a
-000172c0: 6c74 5f69 6e6c 696e 6527 3a0a 2020 2020  lt_inline':.    
-000172d0: 2020 2020 2020 2020 6361 7365 2027 616c          case 'al
-000172e0: 745f 6174 7461 6368 273a 0a20 2020 2020  t_attach':.     
-000172f0: 2020 2020 2020 2063 6173 6520 2761 6c74         case 'alt
-00017300: 5f69 6e6c 696e 655f 6174 7461 6368 273a  _inline_attach':
-00017310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017320: 2024 7468 6973 2d3e 416c 7442 6f64 7920   $this->AltBody 
-00017330: 3d20 2474 6869 732d 3e77 7261 7054 6578  = $this->wrapTex
-00017340: 7428 2474 6869 732d 3e41 6c74 426f 6479  t($this->AltBody
-00017350: 2c20 2474 6869 732d 3e57 6f72 6457 7261  , $this->WordWra
-00017360: 7029 3b0a 2020 2020 2020 2020 2020 2020  p);.            
-00017370: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
-00017380: 2020 2020 2020 2064 6566 6175 6c74 3a0a         default:.
-00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173a0: 2474 6869 732d 3e42 6f64 7920 3d20 2474  $this->Body = $t
-000173b0: 6869 732d 3e77 7261 7054 6578 7428 2474  his->wrapText($t
-000173c0: 6869 732d 3e42 6f64 792c 2024 7468 6973  his->Body, $this
-000173d0: 2d3e 576f 7264 5772 6170 293b 0a20 2020  ->WordWrap);.   
-000173e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-000173f0: 616b 3b0a 2020 2020 2020 2020 7d0a 2020  ak;.        }.  
-00017400: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00017410: 2020 2a20 4173 7365 6d62 6c65 206d 6573    * Assemble mes
-00017420: 7361 6765 2068 6561 6465 7273 2e0a 2020  sage headers..  
-00017430: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00017440: 7572 6e20 7374 7269 6e67 2054 6865 2061  urn string The a
-00017450: 7373 656d 626c 6564 2068 6561 6465 7273  ssembled headers
-00017460: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00017470: 6c69 6320 6675 6e63 7469 6f6e 2063 7265  lic function cre
-00017480: 6174 6548 6561 6465 7228 290a 2020 2020  ateHeader().    
-00017490: 7b0a 2020 2020 2020 2020 2472 6573 756c  {.        $resul
-000174a0: 7420 3d20 2727 3b0a 0a20 2020 2020 2020  t = '';..       
-000174b0: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
-000174c0: 732d 3e68 6561 6465 724c 696e 6528 2744  s->headerLine('D
-000174d0: 6174 6527 2c20 2727 203d 3d3d 2024 7468  ate', '' === $th
-000174e0: 6973 2d3e 4d65 7373 6167 6544 6174 6520  is->MessageDate 
-000174f0: 3f20 7365 6c66 3a3a 7266 6344 6174 6528  ? self::rfcDate(
-00017500: 2920 3a20 2474 6869 732d 3e4d 6573 7361  ) : $this->Messa
-00017510: 6765 4461 7465 293b 0a0a 2020 2020 2020  geDate);..      
-00017520: 2020 2f2f 5468 6520 546f 2068 6561 6465    //The To heade
-00017530: 7220 6973 2063 7265 6174 6564 2061 7574  r is created aut
-00017540: 6f6d 6174 6963 616c 6c79 2062 7920 6d61  omatically by ma
-00017550: 696c 2829 2c20 736f 206e 6565 6473 2074  il(), so needs t
-00017560: 6f20 6265 206f 6d69 7474 6564 2068 6572  o be omitted her
-00017570: 650a 2020 2020 2020 2020 6966 2028 276d  e.        if ('m
-00017580: 6169 6c27 2021 3d3d 2024 7468 6973 2d3e  ail' !== $this->
-00017590: 4d61 696c 6572 2920 7b0a 2020 2020 2020  Mailer) {.      
-000175a0: 2020 2020 2020 6966 2028 2474 6869 732d        if ($this-
-000175b0: 3e53 696e 676c 6554 6f29 207b 0a20 2020  >SingleTo) {.   
-000175c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000175d0: 6561 6368 2028 2474 6869 732d 3e74 6f20  each ($this->to 
-000175e0: 6173 2024 746f 6164 6472 2920 7b0a 2020  as $toaddr) {.  
+0000fc50: 732d 3e62 6363 2c0a 2020 2020 2020 2020  s->bcc,.        
+0000fc60: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0000fc70: 732d 3e53 7562 6a65 6374 2c0a 2020 2020  s->Subject,.    
+0000fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc90: 2462 6f64 792c 0a20 2020 2020 2020 2020  $body,.         
+0000fca0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+0000fcb0: 2d3e 4672 6f6d 2c0a 2020 2020 2020 2020  ->From,.        
+0000fcc0: 2020 2020 2020 2020 2020 2020 5b5d 0a20              []. 
+0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000fce0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0000fcf0: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
+0000fd00: 2252 6573 756c 743a 2022 202e 2028 2472  "Result: " . ($r
+0000fd10: 6573 756c 7420 3d3d 3d20 3020 3f20 2774  esult === 0 ? 't
+0000fd20: 7275 6527 203a 2027 6661 6c73 6527 2929  rue' : 'false'))
+0000fd30: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0000fd40: 2020 6966 2028 3020 213d 3d20 2472 6573    if (0 !== $res
+0000fd50: 756c 7429 207b 0a20 2020 2020 2020 2020  ult) {.         
+0000fd60: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
+0000fd70: 206e 6577 2045 7863 6570 7469 6f6e 2824   new Exception($
+0000fd80: 7468 6973 2d3e 6c61 6e67 2827 6578 6563  this->lang('exec
+0000fd90: 7574 6527 2920 2e20 2474 6869 732d 3e53  ute') . $this->S
+0000fda0: 656e 646d 6169 6c2c 2073 656c 663a 3a53  endmail, self::S
+0000fdb0: 544f 505f 4352 4954 4943 414c 293b 0a20  TOP_CRITICAL);. 
+0000fdc0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0000fdd0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+0000fde0: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
+0000fdf0: 2020 2020 2020 2020 2020 2020 246d 6169              $mai
+0000fe00: 6c20 3d20 4070 6f70 656e 2824 7365 6e64  l = @popen($send
+0000fe10: 6d61 696c 2c20 2777 2729 3b0a 2020 2020  mail, 'w');.    
+0000fe20: 2020 2020 2020 2020 6966 2028 2124 6d61          if (!$ma
+0000fe30: 696c 2920 7b0a 2020 2020 2020 2020 2020  il) {.          
+0000fe40: 2020 2020 2020 7468 726f 7720 6e65 7720        throw new 
+0000fe50: 4578 6365 7074 696f 6e28 2474 6869 732d  Exception($this-
+0000fe60: 3e6c 616e 6728 2765 7865 6375 7465 2729  >lang('execute')
+0000fe70: 202e 2024 7468 6973 2d3e 5365 6e64 6d61   . $this->Sendma
+0000fe80: 696c 2c20 7365 6c66 3a3a 5354 4f50 5f43  il, self::STOP_C
+0000fe90: 5249 5449 4341 4c29 3b0a 2020 2020 2020  RITICAL);.      
+0000fea0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000feb0: 2020 2020 6677 7269 7465 2824 6d61 696c      fwrite($mail
+0000fec0: 2c20 2468 6561 6465 7229 3b0a 2020 2020  , $header);.    
+0000fed0: 2020 2020 2020 2020 6677 7269 7465 2824          fwrite($
+0000fee0: 6d61 696c 2c20 2462 6f64 7929 3b0a 2020  mail, $body);.  
+0000fef0: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
+0000ff00: 7420 3d20 7063 6c6f 7365 2824 6d61 696c  t = pclose($mail
+0000ff10: 293b 0a20 2020 2020 2020 2020 2020 2024  );.            $
+0000ff20: 7468 6973 2d3e 646f 4361 6c6c 6261 636b  this->doCallback
+0000ff30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ff40: 2020 2824 7265 7375 6c74 203d 3d3d 2030    ($result === 0
+0000ff50: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000ff60: 2020 2024 7468 6973 2d3e 746f 2c0a 2020     $this->to,.  
+0000ff70: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+0000ff80: 6869 732d 3e63 632c 0a20 2020 2020 2020  his->cc,.       
+0000ff90: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+0000ffa0: 6263 632c 0a20 2020 2020 2020 2020 2020  bcc,.           
+0000ffb0: 2020 2020 2024 7468 6973 2d3e 5375 626a       $this->Subj
+0000ffc0: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
+0000ffd0: 2020 2020 2024 626f 6479 2c0a 2020 2020       $body,.    
+0000ffe0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0000fff0: 732d 3e46 726f 6d2c 0a20 2020 2020 2020  s->From,.       
+00010000: 2020 2020 2020 2020 205b 5d0a 2020 2020           [].    
+00010010: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
+00010020: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
+00010030: 6562 7567 2822 5265 7375 6c74 3a20 2220  ebug("Result: " 
+00010040: 2e20 2824 7265 7375 6c74 203d 3d3d 2030  . ($result === 0
+00010050: 203f 2027 7472 7565 2720 3a20 2766 616c   ? 'true' : 'fal
+00010060: 7365 2729 293b 0a20 2020 2020 2020 2020  se'));.         
+00010070: 2020 2069 6620 2830 2021 3d3d 2024 7265     if (0 !== $re
+00010080: 7375 6c74 2920 7b0a 2020 2020 2020 2020  sult) {.        
+00010090: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
+000100a0: 7720 4578 6365 7074 696f 6e28 2474 6869  w Exception($thi
+000100b0: 732d 3e6c 616e 6728 2765 7865 6375 7465  s->lang('execute
+000100c0: 2729 202e 2024 7468 6973 2d3e 5365 6e64  ') . $this->Send
+000100d0: 6d61 696c 2c20 7365 6c66 3a3a 5354 4f50  mail, self::STOP
+000100e0: 5f43 5249 5449 4341 4c29 3b0a 2020 2020  _CRITICAL);.    
+000100f0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00010100: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
+00010110: 7572 6e20 7472 7565 3b0a 2020 2020 7d0a  urn true;.    }.
+00010120: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00010130: 4669 7820 4356 452d 3230 3136 2d31 3030  Fix CVE-2016-100
+00010140: 3333 2061 6e64 2043 5645 2d32 3031 362d  33 and CVE-2016-
+00010150: 3130 3034 3520 6279 2064 6973 616c 6c6f  10045 by disallo
+00010160: 7769 6e67 2070 6f74 656e 7469 616c 6c79  wing potentially
+00010170: 2075 6e73 6166 6520 7368 656c 6c20 6368   unsafe shell ch
+00010180: 6172 6163 7465 7273 2e0a 2020 2020 202a  aracters..     *
+00010190: 204e 6f74 6520 7468 6174 2065 7363 6170   Note that escap
+000101a0: 6573 6865 6c6c 6172 6720 616e 6420 6573  eshellarg and es
+000101b0: 6361 7065 7368 656c 6c63 6d64 2061 7265  capeshellcmd are
+000101c0: 2069 6e61 6465 7175 6174 6520 666f 7220   inadequate for 
+000101d0: 6f75 7220 7075 7270 6f73 6573 2c20 6573  our purposes, es
+000101e0: 7065 6369 616c 6c79 206f 6e20 5769 6e64  pecially on Wind
+000101f0: 6f77 732e 0a20 2020 2020 2a0a 2020 2020  ows..     *.    
+00010200: 202a 2040 7365 6520 6874 7470 733a 2f2f   * @see https://
+00010210: 6769 7468 7562 2e63 6f6d 2f50 4850 4d61  github.com/PHPMa
+00010220: 696c 6572 2f50 4850 4d61 696c 6572 2f69  iler/PHPMailer/i
+00010230: 7373 7565 732f 3932 3420 4356 452d 3230  ssues/924 CVE-20
+00010240: 3136 2d31 3030 3435 2062 7567 2072 6570  16-10045 bug rep
+00010250: 6f72 740a 2020 2020 202a 0a20 2020 2020  ort.     *.     
+00010260: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+00010270: 2473 7472 696e 6720 5468 6520 7374 7269  $string The stri
+00010280: 6e67 2074 6f20 6265 2076 616c 6964 6174  ng to be validat
+00010290: 6564 0a20 2020 2020 2a0a 2020 2020 202a  ed.     *.     *
+000102a0: 2040 7265 7475 726e 2062 6f6f 6c0a 2020   @return bool.  
+000102b0: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
+000102c0: 7465 6420 7374 6174 6963 2066 756e 6374  ted static funct
+000102d0: 696f 6e20 6973 5368 656c 6c53 6166 6528  ion isShellSafe(
+000102e0: 2473 7472 696e 6729 0a20 2020 207b 0a20  $string).    {. 
+000102f0: 2020 2020 2020 202f 2f49 7427 7320 6e6f         //It's no
+00010300: 7420 706f 7373 6962 6c65 2074 6f20 7573  t possible to us
+00010310: 6520 7368 656c 6c20 636f 6d6d 616e 6473  e shell commands
+00010320: 2073 6166 656c 7920 2877 6869 6368 2069   safely (which i
+00010330: 6e63 6c75 6465 7320 7468 6520 6d61 696c  ncludes the mail
+00010340: 2829 2066 756e 6374 696f 6e29 2077 6974  () function) wit
+00010350: 686f 7574 2065 7363 6170 6573 6865 6c6c  hout escapeshell
+00010360: 6172 672c 0a20 2020 2020 2020 202f 2f62  arg,.        //b
+00010370: 7574 2073 6f6d 6520 686f 7374 696e 6720  ut some hosting 
+00010380: 7072 6f76 6964 6572 7320 6469 7361 626c  providers disabl
+00010390: 6520 6974 2c20 6372 6561 7469 6e67 2061  e it, creating a
+000103a0: 2073 6563 7572 6974 7920 7072 6f62 6c65   security proble
+000103b0: 6d20 7468 6174 2077 6520 646f 6e27 7420  m that we don't 
+000103c0: 7761 6e74 2074 6f20 6861 7665 2074 6f20  want to have to 
+000103d0: 6465 616c 2077 6974 682c 0a20 2020 2020  deal with,.     
+000103e0: 2020 202f 2f73 6f20 7765 2064 6f6e 2774     //so we don't
+000103f0: 2e0a 2020 2020 2020 2020 6966 2028 2166  ..        if (!f
+00010400: 756e 6374 696f 6e5f 6578 6973 7473 2827  unction_exists('
+00010410: 6573 6361 7065 7368 656c 6c61 7267 2729  escapeshellarg')
+00010420: 207c 7c20 2166 756e 6374 696f 6e5f 6578   || !function_ex
+00010430: 6973 7473 2827 6573 6361 7065 7368 656c  ists('escapeshel
+00010440: 6c63 6d64 2729 2920 7b0a 2020 2020 2020  lcmd')) {.      
+00010450: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+00010460: 7365 3b0a 2020 2020 2020 2020 7d0a 0a20  se;.        }.. 
+00010470: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00010480: 2020 2020 2020 2020 6573 6361 7065 7368          escapesh
+00010490: 656c 6c63 6d64 2824 7374 7269 6e67 2920  ellcmd($string) 
+000104a0: 213d 3d20 2473 7472 696e 670a 2020 2020  !== $string.    
+000104b0: 2020 2020 2020 2020 7c7c 2021 696e 5f61          || !in_a
+000104c0: 7272 6179 2865 7363 6170 6573 6865 6c6c  rray(escapeshell
+000104d0: 6172 6728 2473 7472 696e 6729 2c20 5b22  arg($string), ["
+000104e0: 2724 7374 7269 6e67 2722 2c20 225c 2224  '$string'", "\"$
+000104f0: 7374 7269 6e67 5c22 225d 290a 2020 2020  string\""]).    
+00010500: 2020 2020 2920 7b0a 2020 2020 2020 2020      ) {.        
+00010510: 2020 2020 7265 7475 726e 2066 616c 7365      return false
+00010520: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
+00010530: 2020 2020 2024 6c65 6e67 7468 203d 2073       $length = s
+00010540: 7472 6c65 6e28 2473 7472 696e 6729 3b0a  trlen($string);.
+00010550: 0a20 2020 2020 2020 2066 6f72 2028 2469  .        for ($i
+00010560: 203d 2030 3b20 2469 203c 2024 6c65 6e67   = 0; $i < $leng
+00010570: 7468 3b20 2b2b 2469 2920 7b0a 2020 2020  th; ++$i) {.    
+00010580: 2020 2020 2020 2020 2463 203d 2024 7374          $c = $st
+00010590: 7269 6e67 5b24 695d 3b0a 0a20 2020 2020  ring[$i];..     
+000105a0: 2020 2020 2020 202f 2f41 6c6c 206f 7468         //All oth
+000105b0: 6572 2063 6861 7261 6374 6572 7320 6861  er characters ha
+000105c0: 7665 2061 2073 7065 6369 616c 206d 6561  ve a special mea
+000105d0: 6e69 6e67 2069 6e20 6174 206c 6561 7374  ning in at least
+000105e0: 206f 6e65 2063 6f6d 6d6f 6e20 7368 656c   one common shel
+000105f0: 6c2c 2069 6e63 6c75 6469 6e67 203d 2061  l, including = a
+00010600: 6e64 202b 2e0a 2020 2020 2020 2020 2020  nd +..          
+00010610: 2020 2f2f 4675 6c6c 2073 746f 7020 282e    //Full stop (.
+00010620: 2920 6861 7320 6120 7370 6563 6961 6c20  ) has a special 
+00010630: 6d65 616e 696e 6720 696e 2063 6d64 2e65  meaning in cmd.e
+00010640: 7865 2c20 6275 7420 6974 7320 696d 7061  xe, but its impa
+00010650: 6374 2073 686f 756c 6420 6265 206e 6567  ct should be neg
+00010660: 6c69 6769 626c 6520 6865 7265 2e0a 2020  ligible here..  
+00010670: 2020 2020 2020 2020 2020 2f2f 4e6f 7465            //Note
+00010680: 2074 6861 7420 7468 6973 2064 6f65 7320   that this does 
+00010690: 7065 726d 6974 206e 6f6e 2d4c 6174 696e  permit non-Latin
+000106a0: 2061 6c70 6861 6e75 6d65 7269 6320 6368   alphanumeric ch
+000106b0: 6172 6163 7465 7273 2062 6173 6564 206f  aracters based o
+000106c0: 6e20 7468 6520 6375 7272 656e 7420 6c6f  n the current lo
+000106d0: 6361 6c65 2e0a 2020 2020 2020 2020 2020  cale..          
+000106e0: 2020 6966 2028 2163 7479 7065 5f61 6c6e    if (!ctype_aln
+000106f0: 756d 2824 6329 2026 2620 7374 7270 6f73  um($c) && strpos
+00010700: 2827 405f 2d2e 272c 2024 6329 203d 3d3d  ('@_-.', $c) ===
+00010710: 2066 616c 7365 2920 7b0a 2020 2020 2020   false) {.      
+00010720: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010730: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
+00010740: 2020 2020 7d0a 2020 2020 2020 2020 7d0a      }.        }.
+00010750: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00010760: 7472 7565 3b0a 2020 2020 7d0a 0a20 2020  true;.    }..   
+00010770: 202f 2a2a 0a20 2020 2020 2a20 4368 6563   /**.     * Chec
+00010780: 6b20 7768 6574 6865 7220 6120 6669 6c65  k whether a file
+00010790: 2070 6174 6820 6973 206f 6620 6120 7065   path is of a pe
+000107a0: 726d 6974 7465 6420 7479 7065 2e0a 2020  rmitted type..  
+000107b0: 2020 202a 2055 7365 6420 746f 2072 656a     * Used to rej
+000107c0: 6563 7420 5552 4c73 2061 6e64 2070 6861  ect URLs and pha
+000107d0: 7220 6669 6c65 7320 6672 6f6d 2066 756e  r files from fun
+000107e0: 6374 696f 6e73 2074 6861 7420 6163 6365  ctions that acce
+000107f0: 7373 206c 6f63 616c 2066 696c 6520 7061  ss local file pa
+00010800: 7468 732c 0a20 2020 2020 2a20 7375 6368  ths,.     * such
+00010810: 2061 7320 6164 6441 7474 6163 686d 656e   as addAttachmen
+00010820: 742e 0a20 2020 2020 2a0a 2020 2020 202a  t..     *.     *
+00010830: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+00010840: 7061 7468 2041 2072 656c 6174 6976 6520  path A relative 
+00010850: 6f72 2061 6273 6f6c 7574 6520 7061 7468  or absolute path
+00010860: 2074 6f20 6120 6669 6c65 0a20 2020 2020   to a file.     
+00010870: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+00010880: 2062 6f6f 6c0a 2020 2020 202a 2f0a 2020   bool.     */.  
+00010890: 2020 7072 6f74 6563 7465 6420 7374 6174    protected stat
+000108a0: 6963 2066 756e 6374 696f 6e20 6973 5065  ic function isPe
+000108b0: 726d 6974 7465 6450 6174 6828 2470 6174  rmittedPath($pat
+000108c0: 6829 0a20 2020 207b 0a20 2020 2020 2020  h).    {.       
+000108d0: 202f 2f4d 6174 6368 6573 2073 6368 656d   //Matches schem
+000108e0: 6520 6465 6669 6e69 7469 6f6e 2066 726f  e definition fro
+000108f0: 6d20 6874 7470 733a 2f2f 746f 6f6c 732e  m https://tools.
+00010900: 6965 7466 2e6f 7267 2f68 746d 6c2f 7266  ietf.org/html/rf
+00010910: 6333 3938 3623 7365 6374 696f 6e2d 332e  c3986#section-3.
+00010920: 310a 2020 2020 2020 2020 7265 7475 726e  1.        return
+00010930: 2021 7072 6567 5f6d 6174 6368 2827 235e   !preg_match('#^
+00010940: 5b61 2d7a 5d5b 612d 7a5c 642b 2e2d 5d2a  [a-z][a-z\d+.-]*
+00010950: 3a2f 2f23 6927 2c20 2470 6174 6829 3b0a  ://#i', $path);.
+00010960: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+00010970: 2020 2020 2a20 4368 6563 6b20 7768 6574      * Check whet
+00010980: 6865 7220 6120 6669 6c65 2070 6174 6820  her a file path 
+00010990: 6973 2073 6166 652c 2061 6363 6573 7369  is safe, accessi
+000109a0: 626c 652c 2061 6e64 2072 6561 6461 626c  ble, and readabl
+000109b0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
+000109c0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+000109d0: 7061 7468 2041 2072 656c 6174 6976 6520  path A relative 
+000109e0: 6f72 2061 6273 6f6c 7574 6520 7061 7468  or absolute path
+000109f0: 2074 6f20 6120 6669 6c65 0a20 2020 2020   to a file.     
+00010a00: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+00010a10: 2062 6f6f 6c0a 2020 2020 202a 2f0a 2020   bool.     */.  
+00010a20: 2020 7072 6f74 6563 7465 6420 7374 6174    protected stat
+00010a30: 6963 2066 756e 6374 696f 6e20 6669 6c65  ic function file
+00010a40: 4973 4163 6365 7373 6962 6c65 2824 7061  IsAccessible($pa
+00010a50: 7468 290a 2020 2020 7b0a 2020 2020 2020  th).    {.      
+00010a60: 2020 6966 2028 2173 7461 7469 633a 3a69    if (!static::i
+00010a70: 7350 6572 6d69 7474 6564 5061 7468 2824  sPermittedPath($
+00010a80: 7061 7468 2929 207b 0a20 2020 2020 2020  path)) {.       
+00010a90: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
+00010aa0: 653b 0a20 2020 2020 2020 207d 0a20 2020  e;.        }.   
+00010ab0: 2020 2020 2024 7265 6164 6162 6c65 203d       $readable =
+00010ac0: 2069 735f 6669 6c65 2824 7061 7468 293b   is_file($path);
+00010ad0: 0a20 2020 2020 2020 202f 2f49 6620 6e6f  .        //If no
+00010ae0: 7420 6120 554e 4320 7061 7468 2028 6578  t a UNC path (ex
+00010af0: 7065 6374 6564 2074 6f20 7374 6172 7420  pected to start 
+00010b00: 7769 7468 205c 5c29 2c20 6368 6563 6b20  with \\), check 
+00010b10: 7265 6164 2070 6572 6d69 7373 696f 6e2c  read permission,
+00010b20: 2073 6565 2023 3230 3639 0a20 2020 2020   see #2069.     
+00010b30: 2020 2069 6620 2873 7472 706f 7328 2470     if (strpos($p
+00010b40: 6174 682c 2027 5c5c 5c5c 2729 2021 3d3d  ath, '\\\\') !==
+00010b50: 2030 2920 7b0a 2020 2020 2020 2020 2020   0) {.          
+00010b60: 2020 2472 6561 6461 626c 6520 3d20 2472    $readable = $r
+00010b70: 6561 6461 626c 6520 2626 2069 735f 7265  eadable && is_re
+00010b80: 6164 6162 6c65 2824 7061 7468 293b 0a20  adable($path);. 
+00010b90: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00010ba0: 2072 6574 7572 6e20 2024 7265 6164 6162   return  $readab
+00010bb0: 6c65 3b0a 2020 2020 7d0a 0a20 2020 202f  le;.    }..    /
+00010bc0: 2a2a 0a20 2020 2020 2a20 5365 6e64 206d  **.     * Send m
+00010bd0: 6169 6c20 7573 696e 6720 7468 6520 5048  ail using the PH
+00010be0: 5020 6d61 696c 2829 2066 756e 6374 696f  P mail() functio
+00010bf0: 6e2e 0a20 2020 2020 2a0a 2020 2020 202a  n..     *.     *
+00010c00: 2040 7365 6520 6874 7470 3a2f 2f77 7777   @see http://www
+00010c10: 2e70 6870 2e6e 6574 2f6d 616e 7561 6c2f  .php.net/manual/
+00010c20: 656e 2f62 6f6f 6b2e 6d61 696c 2e70 6870  en/book.mail.php
+00010c30: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00010c40: 7061 7261 6d20 7374 7269 6e67 2024 6865  param string $he
+00010c50: 6164 6572 2054 6865 206d 6573 7361 6765  ader The message
+00010c60: 2068 6561 6465 7273 0a20 2020 2020 2a20   headers.     * 
+00010c70: 4070 6172 616d 2073 7472 696e 6720 2462  @param string $b
+00010c80: 6f64 7920 2020 5468 6520 6d65 7373 6167  ody   The messag
+00010c90: 6520 626f 6479 0a20 2020 2020 2a0a 2020  e body.     *.  
+00010ca0: 2020 202a 2040 7468 726f 7773 2045 7863     * @throws Exc
+00010cb0: 6570 7469 6f6e 0a20 2020 2020 2a0a 2020  eption.     *.  
+00010cc0: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
+00010cd0: 6c0a 2020 2020 202a 2f0a 2020 2020 7072  l.     */.    pr
+00010ce0: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+00010cf0: 206d 6169 6c53 656e 6428 2468 6561 6465   mailSend($heade
+00010d00: 722c 2024 626f 6479 290a 2020 2020 7b0a  r, $body).    {.
+00010d10: 2020 2020 2020 2020 2468 6561 6465 7220          $header 
+00010d20: 3d20 7374 6174 6963 3a3a 7374 7269 7054  = static::stripT
+00010d30: 7261 696c 696e 6757 5350 2824 6865 6164  railingWSP($head
+00010d40: 6572 2920 2e20 7374 6174 6963 3a3a 244c  er) . static::$L
+00010d50: 4520 2e20 7374 6174 6963 3a3a 244c 453b  E . static::$LE;
+00010d60: 0a0a 2020 2020 2020 2020 2474 6f41 7272  ..        $toArr
+00010d70: 203d 205b 5d3b 0a20 2020 2020 2020 2066   = [];.        f
+00010d80: 6f72 6561 6368 2028 2474 6869 732d 3e74  oreach ($this->t
+00010d90: 6f20 6173 2024 746f 6164 6472 2920 7b0a  o as $toaddr) {.
+00010da0: 2020 2020 2020 2020 2020 2020 2474 6f41              $toA
+00010db0: 7272 5b5d 203d 2024 7468 6973 2d3e 6164  rr[] = $this->ad
+00010dc0: 6472 466f 726d 6174 2824 746f 6164 6472  drFormat($toaddr
+00010dd0: 293b 0a20 2020 2020 2020 207d 0a20 2020  );.        }.   
+00010de0: 2020 2020 2024 746f 203d 2074 7269 6d28       $to = trim(
+00010df0: 696d 706c 6f64 6528 272c 2027 2c20 2474  implode(', ', $t
+00010e00: 6f41 7272 2929 3b0a 0a20 2020 2020 2020  oArr));..       
+00010e10: 202f 2f49 6620 7468 6572 6520 6172 6520   //If there are 
+00010e20: 6e6f 2054 6f2d 6164 6472 6573 7365 7320  no To-addresses 
+00010e30: 2865 2e67 2e20 7768 656e 2073 656e 6469  (e.g. when sendi
+00010e40: 6e67 206f 6e6c 7920 746f 2042 4343 2d61  ng only to BCC-a
+00010e50: 6464 7265 7373 6573 290a 2020 2020 2020  ddresses).      
+00010e60: 2020 2f2f 7468 6520 666f 6c6c 6f77 696e    //the followin
+00010e70: 6720 7368 6f75 6c64 2062 6520 6164 6465  g should be adde
+00010e80: 6420 746f 2067 6574 2061 2063 6f72 7265  d to get a corre
+00010e90: 6374 2044 4b49 4d2d 7369 676e 6174 7572  ct DKIM-signatur
+00010ea0: 652e 0a20 2020 2020 2020 202f 2f43 6f6d  e..        //Com
+00010eb0: 7061 7265 2077 6974 6820 2474 6869 732d  pare with $this-
+00010ec0: 3e70 7265 5365 6e64 2829 0a20 2020 2020  >preSend().     
+00010ed0: 2020 2069 6620 2824 746f 203d 3d3d 2027     if ($to === '
+00010ee0: 2729 207b 0a20 2020 2020 2020 2020 2020  ') {.           
+00010ef0: 2024 746f 203d 2027 756e 6469 7363 6c6f   $to = 'undisclo
+00010f00: 7365 642d 7265 6369 7069 656e 7473 3a3b  sed-recipients:;
+00010f10: 273b 0a20 2020 2020 2020 207d 0a0a 2020  ';.        }..  
+00010f20: 2020 2020 2020 2470 6172 616d 7320 3d20        $params = 
+00010f30: 6e75 6c6c 3b0a 2020 2020 2020 2020 2f2f  null;.        //
+00010f40: 5468 6973 2073 6574 7320 7468 6520 534d  This sets the SM
+00010f50: 5450 2065 6e76 656c 6f70 6520 7365 6e64  TP envelope send
+00010f60: 6572 2077 6869 6368 2067 6574 7320 7475  er which gets tu
+00010f70: 726e 6564 2069 6e74 6f20 6120 7265 7475  rned into a retu
+00010f80: 726e 2d70 6174 6820 6865 6164 6572 2062  rn-path header b
+00010f90: 7920 7468 6520 7265 6365 6976 6572 0a20  y the receiver. 
+00010fa0: 2020 2020 2020 202f 2f41 2073 7061 6365         //A space
+00010fb0: 2061 6674 6572 2060 2d66 6020 6973 206f   after `-f` is o
+00010fc0: 7074 696f 6e61 6c2c 2062 7574 2074 6865  ptional, but the
+00010fd0: 7265 2069 7320 6120 6c6f 6e67 2068 6973  re is a long his
+00010fe0: 746f 7279 206f 6620 6974 7320 7072 6573  tory of its pres
+00010ff0: 656e 6365 0a20 2020 2020 2020 202f 2f63  ence.        //c
+00011000: 6175 7369 6e67 2070 726f 626c 656d 732c  ausing problems,
+00011010: 2073 6f20 7765 2064 6f6e 2774 2075 7365   so we don't use
+00011020: 206f 6e65 0a20 2020 2020 2020 202f 2f45   one.        //E
+00011030: 7869 6d20 646f 6373 3a20 6874 7470 3a2f  xim docs: http:/
+00011040: 2f77 7777 2e65 7869 6d2e 6f72 672f 6578  /www.exim.org/ex
+00011050: 696d 2d68 746d 6c2d 6375 7272 656e 742f  im-html-current/
+00011060: 646f 632f 6874 6d6c 2f73 7065 635f 6874  doc/html/spec_ht
+00011070: 6d6c 2f63 682d 7468 655f 6578 696d 5f63  ml/ch-the_exim_c
+00011080: 6f6d 6d61 6e64 5f6c 696e 652e 6874 6d6c  ommand_line.html
+00011090: 0a20 2020 2020 2020 202f 2f53 656e 646d  .        //Sendm
+000110a0: 6169 6c20 646f 6373 3a20 6874 7470 3a2f  ail docs: http:/
+000110b0: 2f77 7777 2e73 656e 646d 6169 6c2e 6f72  /www.sendmail.or
+000110c0: 672f 7e63 612f 656d 6169 6c2f 6d61 6e2f  g/~ca/email/man/
+000110d0: 7365 6e64 6d61 696c 2e68 746d 6c0a 2020  sendmail.html.  
+000110e0: 2020 2020 2020 2f2f 516d 6169 6c20 646f        //Qmail do
+000110f0: 6373 3a20 6874 7470 3a2f 2f77 7777 2e71  cs: http://www.q
+00011100: 6d61 696c 2e6f 7267 2f6d 616e 2f6d 616e  mail.org/man/man
+00011110: 382f 716d 6169 6c2d 696e 6a65 6374 2e68  8/qmail-inject.h
+00011120: 746d 6c0a 2020 2020 2020 2020 2f2f 4578  tml.        //Ex
+00011130: 616d 706c 6520 7072 6f62 6c65 6d3a 2068  ample problem: h
+00011140: 7474 7073 3a2f 2f77 7777 2e64 7275 7061  ttps://www.drupa
+00011150: 6c2e 6f72 672f 6e6f 6465 2f31 3035 3739  l.org/node/10579
+00011160: 3534 0a20 2020 2020 2020 202f 2f43 5645  54.        //CVE
+00011170: 2d32 3031 362d 3130 3033 332c 2043 5645  -2016-10033, CVE
+00011180: 2d32 3031 362d 3130 3034 353a 2044 6f6e  -2016-10045: Don
+00011190: 2774 2070 6173 7320 2d66 2069 6620 6368  't pass -f if ch
+000111a0: 6172 6163 7465 7273 2077 696c 6c20 6265  aracters will be
+000111b0: 2065 7363 6170 6564 2e0a 0a20 2020 2020   escaped...     
+000111c0: 2020 202f 2f50 4850 2035 2e36 2077 6f72     //PHP 5.6 wor
+000111d0: 6b61 726f 756e 640a 2020 2020 2020 2020  karound.        
+000111e0: 2473 656e 646d 6169 6c5f 6672 6f6d 5f76  $sendmail_from_v
+000111f0: 616c 7565 203d 2069 6e69 5f67 6574 2827  alue = ini_get('
+00011200: 7365 6e64 6d61 696c 5f66 726f 6d27 293b  sendmail_from');
+00011210: 0a20 2020 2020 2020 2069 6620 2865 6d70  .        if (emp
+00011220: 7479 2824 7468 6973 2d3e 5365 6e64 6572  ty($this->Sender
+00011230: 2920 2626 2021 656d 7074 7928 2473 656e  ) && !empty($sen
+00011240: 646d 6169 6c5f 6672 6f6d 5f76 616c 7565  dmail_from_value
+00011250: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00011260: 202f 2f50 4850 2063 6f6e 6669 6720 6861   //PHP config ha
+00011270: 7320 6120 7365 6e64 6572 2061 6464 7265  s a sender addre
+00011280: 7373 2077 6520 6361 6e20 7573 650a 2020  ss we can use.  
+00011290: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+000112a0: 3e53 656e 6465 7220 3d20 696e 695f 6765  >Sender = ini_ge
+000112b0: 7428 2773 656e 646d 6169 6c5f 6672 6f6d  t('sendmail_from
+000112c0: 2729 3b0a 2020 2020 2020 2020 7d0a 2020  ');.        }.  
+000112d0: 2020 2020 2020 6966 2028 2165 6d70 7479        if (!empty
+000112e0: 2824 7468 6973 2d3e 5365 6e64 6572 2920  ($this->Sender) 
+000112f0: 2626 2073 7461 7469 633a 3a76 616c 6964  && static::valid
+00011300: 6174 6541 6464 7265 7373 2824 7468 6973  ateAddress($this
+00011310: 2d3e 5365 6e64 6572 2929 207b 0a20 2020  ->Sender)) {.   
+00011320: 2020 2020 2020 2020 2069 6620 2873 656c           if (sel
+00011330: 663a 3a69 7353 6865 6c6c 5361 6665 2824  f::isShellSafe($
+00011340: 7468 6973 2d3e 5365 6e64 6572 2929 207b  this->Sender)) {
+00011350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011360: 2024 7061 7261 6d73 203d 2073 7072 696e   $params = sprin
+00011370: 7466 2827 2d66 2573 272c 2024 7468 6973  tf('-f%s', $this
+00011380: 2d3e 5365 6e64 6572 293b 0a20 2020 2020  ->Sender);.     
+00011390: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000113a0: 2020 2020 2024 6f6c 645f 6672 6f6d 203d       $old_from =
+000113b0: 2069 6e69 5f67 6574 2827 7365 6e64 6d61   ini_get('sendma
+000113c0: 696c 5f66 726f 6d27 293b 0a20 2020 2020  il_from');.     
+000113d0: 2020 2020 2020 2069 6e69 5f73 6574 2827         ini_set('
+000113e0: 7365 6e64 6d61 696c 5f66 726f 6d27 2c20  sendmail_from', 
+000113f0: 2474 6869 732d 3e53 656e 6465 7229 3b0a  $this->Sender);.
+00011400: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00011410: 2020 2472 6573 756c 7420 3d20 6661 6c73    $result = fals
+00011420: 653b 0a20 2020 2020 2020 2069 6620 2824  e;.        if ($
+00011430: 7468 6973 2d3e 5369 6e67 6c65 546f 2026  this->SingleTo &
+00011440: 2620 636f 756e 7428 2474 6f41 7272 2920  & count($toArr) 
+00011450: 3e20 3129 207b 0a20 2020 2020 2020 2020  > 1) {.         
+00011460: 2020 2066 6f72 6561 6368 2028 2474 6f41     foreach ($toA
+00011470: 7272 2061 7320 2474 6f41 6464 7229 207b  rr as $toAddr) {
+00011480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011490: 2024 7265 7375 6c74 203d 2024 7468 6973   $result = $this
+000114a0: 2d3e 6d61 696c 5061 7373 7468 7275 2824  ->mailPassthru($
+000114b0: 746f 4164 6472 2c20 2474 6869 732d 3e53  toAddr, $this->S
+000114c0: 7562 6a65 6374 2c20 2462 6f64 792c 2024  ubject, $body, $
+000114d0: 6865 6164 6572 2c20 2470 6172 616d 7329  header, $params)
+000114e0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+000114f0: 2020 2461 6464 7269 6e66 6f20 3d20 7374    $addrinfo = st
+00011500: 6174 6963 3a3a 7061 7273 6541 6464 7265  atic::parseAddre
+00011510: 7373 6573 2824 746f 4164 6472 2c20 7472  sses($toAddr, tr
+00011520: 7565 2c20 2474 6869 732d 3e43 6861 7253  ue, $this->CharS
+00011530: 6574 293b 0a20 2020 2020 2020 2020 2020  et);.           
+00011540: 2020 2020 2024 7468 6973 2d3e 646f 4361       $this->doCa
+00011550: 6c6c 6261 636b 280a 2020 2020 2020 2020  llback(.        
+00011560: 2020 2020 2020 2020 2020 2020 2472 6573              $res
+00011570: 756c 742c 0a20 2020 2020 2020 2020 2020  ult,.           
+00011580: 2020 2020 2020 2020 205b 5b24 6164 6472           [[$addr
+00011590: 696e 666f 5b27 6164 6472 6573 7327 5d2c  info['address'],
+000115a0: 2024 6164 6472 696e 666f 5b27 6e61 6d65   $addrinfo['name
+000115b0: 275d 5d5d 2c0a 2020 2020 2020 2020 2020  ']]],.          
+000115c0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+000115d0: 3e63 632c 0a20 2020 2020 2020 2020 2020  >cc,.           
+000115e0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+000115f0: 6263 632c 0a20 2020 2020 2020 2020 2020  bcc,.           
+00011600: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00011610: 5375 626a 6563 742c 0a20 2020 2020 2020  Subject,.       
+00011620: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+00011630: 6479 2c0a 2020 2020 2020 2020 2020 2020  dy,.            
+00011640: 2020 2020 2020 2020 2474 6869 732d 3e46          $this->F
+00011650: 726f 6d2c 0a20 2020 2020 2020 2020 2020  rom,.           
+00011660: 2020 2020 2020 2020 205b 5d0a 2020 2020           [].    
+00011670: 2020 2020 2020 2020 2020 2020 293b 0a20              );. 
+00011680: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00011690: 2020 2020 207d 2065 6c73 6520 7b0a 2020       } else {.  
+000116a0: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
+000116b0: 7420 3d20 2474 6869 732d 3e6d 6169 6c50  t = $this->mailP
+000116c0: 6173 7374 6872 7528 2474 6f2c 2024 7468  assthru($to, $th
+000116d0: 6973 2d3e 5375 626a 6563 742c 2024 626f  is->Subject, $bo
+000116e0: 6479 2c20 2468 6561 6465 722c 2024 7061  dy, $header, $pa
+000116f0: 7261 6d73 293b 0a20 2020 2020 2020 2020  rams);.         
+00011700: 2020 2024 7468 6973 2d3e 646f 4361 6c6c     $this->doCall
+00011710: 6261 636b 2824 7265 7375 6c74 2c20 2474  back($result, $t
+00011720: 6869 732d 3e74 6f2c 2024 7468 6973 2d3e  his->to, $this->
+00011730: 6363 2c20 2474 6869 732d 3e62 6363 2c20  cc, $this->bcc, 
+00011740: 2474 6869 732d 3e53 7562 6a65 6374 2c20  $this->Subject, 
+00011750: 2462 6f64 792c 2024 7468 6973 2d3e 4672  $body, $this->Fr
+00011760: 6f6d 2c20 5b5d 293b 0a20 2020 2020 2020  om, []);.       
+00011770: 207d 0a20 2020 2020 2020 2069 6620 2869   }.        if (i
+00011780: 7373 6574 2824 6f6c 645f 6672 6f6d 2929  sset($old_from))
+00011790: 207b 0a20 2020 2020 2020 2020 2020 2069   {.            i
+000117a0: 6e69 5f73 6574 2827 7365 6e64 6d61 696c  ni_set('sendmail
+000117b0: 5f66 726f 6d27 2c20 246f 6c64 5f66 726f  _from', $old_fro
+000117c0: 6d29 3b0a 2020 2020 2020 2020 7d0a 2020  m);.        }.  
+000117d0: 2020 2020 2020 6966 2028 2124 7265 7375        if (!$resu
+000117e0: 6c74 2920 7b0a 2020 2020 2020 2020 2020  lt) {.          
+000117f0: 2020 7468 726f 7720 6e65 7720 4578 6365    throw new Exce
+00011800: 7074 696f 6e28 2474 6869 732d 3e6c 616e  ption($this->lan
+00011810: 6728 2769 6e73 7461 6e74 6961 7465 2729  g('instantiate')
+00011820: 2c20 7365 6c66 3a3a 5354 4f50 5f43 5249  , self::STOP_CRI
+00011830: 5449 4341 4c29 3b0a 2020 2020 2020 2020  TICAL);.        
+00011840: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+00011850: 6e20 7472 7565 3b0a 2020 2020 7d0a 0a20  n true;.    }.. 
+00011860: 2020 202f 2a2a 0a20 2020 2020 2a20 4765     /**.     * Ge
+00011870: 7420 616e 2069 6e73 7461 6e63 6520 746f  t an instance to
+00011880: 2075 7365 2066 6f72 2053 4d54 5020 6f70   use for SMTP op
+00011890: 6572 6174 696f 6e73 2e0a 2020 2020 202a  erations..     *
+000118a0: 204f 7665 7272 6964 6520 7468 6973 2066   Override this f
+000118b0: 756e 6374 696f 6e20 746f 206c 6f61 6420  unction to load 
+000118c0: 796f 7572 206f 776e 2053 4d54 5020 696d  your own SMTP im
+000118d0: 706c 656d 656e 7461 7469 6f6e 2c0a 2020  plementation,.  
+000118e0: 2020 202a 206f 7220 7365 7420 6f6e 6520     * or set one 
+000118f0: 7769 7468 2073 6574 534d 5450 496e 7374  with setSMTPInst
+00011900: 616e 6365 2e0a 2020 2020 202a 0a20 2020  ance..     *.   
+00011910: 2020 2a20 4072 6574 7572 6e20 534d 5450    * @return SMTP
+00011920: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00011930: 6c69 6320 6675 6e63 7469 6f6e 2067 6574  lic function get
+00011940: 534d 5450 496e 7374 616e 6365 2829 0a20  SMTPInstance(). 
+00011950: 2020 207b 0a20 2020 2020 2020 2069 6620     {.        if 
+00011960: 2821 6973 5f6f 626a 6563 7428 2474 6869  (!is_object($thi
+00011970: 732d 3e73 6d74 7029 2920 7b0a 2020 2020  s->smtp)) {.    
+00011980: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
+00011990: 6d74 7020 3d20 6e65 7720 534d 5450 2829  mtp = new SMTP()
+000119a0: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
+000119b0: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
+000119c0: 732d 3e73 6d74 703b 0a20 2020 207d 0a0a  s->smtp;.    }..
+000119d0: 2020 2020 2f2a 2a0a 2020 2020 202a 2050      /**.     * P
+000119e0: 726f 7669 6465 2061 6e20 696e 7374 616e  rovide an instan
+000119f0: 6365 2074 6f20 7573 6520 666f 7220 534d  ce to use for SM
+00011a00: 5450 206f 7065 7261 7469 6f6e 732e 0a20  TP operations.. 
+00011a10: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
+00011a20: 7475 726e 2053 4d54 500a 2020 2020 202a  turn SMTP.     *
+00011a30: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+00011a40: 6374 696f 6e20 7365 7453 4d54 5049 6e73  ction setSMTPIns
+00011a50: 7461 6e63 6528 534d 5450 2024 736d 7470  tance(SMTP $smtp
+00011a60: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+00011a70: 2474 6869 732d 3e73 6d74 7020 3d20 2473  $this->smtp = $s
+00011a80: 6d74 703b 0a0a 2020 2020 2020 2020 7265  mtp;..        re
+00011a90: 7475 726e 2024 7468 6973 2d3e 736d 7470  turn $this->smtp
+00011aa0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+00011ab0: 0a20 2020 2020 2a20 5072 6f76 6964 6520  .     * Provide 
+00011ac0: 534d 5450 2058 434c 4945 4e54 2061 7474  SMTP XCLIENT att
+00011ad0: 7269 6275 7465 730a 2020 2020 202a 0a20  ributes.     *. 
+00011ae0: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00011af0: 696e 6720 246e 616d 6520 2041 7474 7269  ing $name  Attri
+00011b00: 6275 7465 206e 616d 650a 2020 2020 202a  bute name.     *
+00011b10: 2040 7061 7261 6d20 3f73 7472 696e 6720   @param ?string 
+00011b20: 2476 616c 7565 2041 7474 7269 6275 7465  $value Attribute
+00011b30: 2076 616c 7565 0a20 2020 2020 2a0a 2020   value.     *.  
+00011b40: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
+00011b50: 6c0a 2020 2020 202a 2f0a 2020 2020 7075  l.     */.    pu
+00011b60: 626c 6963 2066 756e 6374 696f 6e20 7365  blic function se
+00011b70: 7453 4d54 5058 636c 6965 6e74 4174 7472  tSMTPXclientAttr
+00011b80: 6962 7574 6528 246e 616d 652c 2024 7661  ibute($name, $va
+00011b90: 6c75 6529 0a20 2020 207b 0a20 2020 2020  lue).    {.     
+00011ba0: 2020 2069 6620 2821 696e 5f61 7272 6179     if (!in_array
+00011bb0: 2824 6e61 6d65 2c20 534d 5450 3a3a 2478  ($name, SMTP::$x
+00011bc0: 636c 6965 6e74 5f61 6c6c 6f77 6564 5f61  client_allowed_a
+00011bd0: 7474 7269 6275 7465 7329 2920 7b0a 2020  ttributes)) {.  
+00011be0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011bf0: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
+00011c00: 7d0a 2020 2020 2020 2020 6966 2028 6973  }.        if (is
+00011c10: 7365 7428 2474 6869 732d 3e53 4d54 5058  set($this->SMTPX
+00011c20: 436c 6965 6e74 5b24 6e61 6d65 5d29 2026  Client[$name]) &
+00011c30: 2620 2476 616c 7565 203d 3d3d 206e 756c  & $value === nul
+00011c40: 6c29 207b 0a20 2020 2020 2020 2020 2020  l) {.           
+00011c50: 2075 6e73 6574 2824 7468 6973 2d3e 534d   unset($this->SM
+00011c60: 5450 5843 6c69 656e 745b 246e 616d 655d  TPXClient[$name]
+00011c70: 293b 0a20 2020 2020 2020 207d 2065 6c73  );.        } els
+00011c80: 6569 6620 2824 7661 6c75 6520 213d 3d20  eif ($value !== 
+00011c90: 6e75 6c6c 2920 7b0a 2020 2020 2020 2020  null) {.        
+00011ca0: 2020 2020 2474 6869 732d 3e53 4d54 5058      $this->SMTPX
+00011cb0: 436c 6965 6e74 5b24 6e61 6d65 5d20 3d20  Client[$name] = 
+00011cc0: 2476 616c 7565 3b0a 2020 2020 2020 2020  $value;.        
+00011cd0: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+00011ce0: 6e20 7472 7565 3b0a 2020 2020 7d0a 0a20  n true;.    }.. 
+00011cf0: 2020 202f 2a2a 0a20 2020 2020 2a20 4765     /**.     * Ge
+00011d00: 7420 534d 5450 2058 434c 4945 4e54 2061  t SMTP XCLIENT a
+00011d10: 7474 7269 6275 7465 730a 2020 2020 202a  ttributes.     *
+00011d20: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+00011d30: 6172 7261 790a 2020 2020 202a 2f0a 2020  array.     */.  
+00011d40: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+00011d50: 6e20 6765 7453 4d54 5058 636c 6965 6e74  n getSMTPXclient
+00011d60: 4174 7472 6962 7574 6573 2829 0a20 2020  Attributes().   
+00011d70: 207b 0a20 2020 2020 2020 2072 6574 7572   {.        retur
+00011d80: 6e20 2474 6869 732d 3e53 4d54 5058 436c  n $this->SMTPXCl
+00011d90: 6965 6e74 3b0a 2020 2020 7d0a 0a20 2020  ient;.    }..   
+00011da0: 202f 2a2a 0a20 2020 2020 2a20 5365 6e64   /**.     * Send
+00011db0: 206d 6169 6c20 7669 6120 534d 5450 2e0a   mail via SMTP..
+00011dc0: 2020 2020 202a 2052 6574 7572 6e73 2066       * Returns f
+00011dd0: 616c 7365 2069 6620 7468 6572 6520 6973  alse if there is
+00011de0: 2061 2062 6164 204d 4149 4c20 4652 4f4d   a bad MAIL FROM
+00011df0: 2c20 5243 5054 2c20 6f72 2044 4154 4120  , RCPT, or DATA 
+00011e00: 696e 7075 742e 0a20 2020 2020 2a0a 2020  input..     *.  
+00011e10: 2020 202a 2040 7365 6520 5048 504d 6169     * @see PHPMai
+00011e20: 6c65 723a 3a73 6574 534d 5450 496e 7374  ler::setSMTPInst
+00011e30: 616e 6365 2829 2074 6f20 7573 6520 6120  ance() to use a 
+00011e40: 6469 6666 6572 656e 7420 636c 6173 732e  different class.
+00011e50: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00011e60: 7573 6573 205c 5048 504d 6169 6c65 725c  uses \PHPMailer\
+00011e70: 5048 504d 6169 6c65 725c 534d 5450 0a20  PHPMailer\SMTP. 
+00011e80: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+00011e90: 7261 6d20 7374 7269 6e67 2024 6865 6164  ram string $head
+00011ea0: 6572 2054 6865 206d 6573 7361 6765 2068  er The message h
+00011eb0: 6561 6465 7273 0a20 2020 2020 2a20 4070  eaders.     * @p
+00011ec0: 6172 616d 2073 7472 696e 6720 2462 6f64  aram string $bod
+00011ed0: 7920 2020 5468 6520 6d65 7373 6167 6520  y   The message 
+00011ee0: 626f 6479 0a20 2020 2020 2a0a 2020 2020  body.     *.    
+00011ef0: 202a 2040 7468 726f 7773 2045 7863 6570   * @throws Excep
+00011f00: 7469 6f6e 0a20 2020 2020 2a0a 2020 2020  tion.     *.    
+00011f10: 202a 2040 7265 7475 726e 2062 6f6f 6c0a   * @return bool.
+00011f20: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
+00011f30: 6563 7465 6420 6675 6e63 7469 6f6e 2073  ected function s
+00011f40: 6d74 7053 656e 6428 2468 6561 6465 722c  mtpSend($header,
+00011f50: 2024 626f 6479 290a 2020 2020 7b0a 2020   $body).    {.  
+00011f60: 2020 2020 2020 2468 6561 6465 7220 3d20        $header = 
+00011f70: 7374 6174 6963 3a3a 7374 7269 7054 7261  static::stripTra
+00011f80: 696c 696e 6757 5350 2824 6865 6164 6572  ilingWSP($header
+00011f90: 2920 2e20 7374 6174 6963 3a3a 244c 4520  ) . static::$LE 
+00011fa0: 2e20 7374 6174 6963 3a3a 244c 453b 0a20  . static::$LE;. 
+00011fb0: 2020 2020 2020 2024 6261 645f 7263 7074         $bad_rcpt
+00011fc0: 203d 205b 5d3b 0a20 2020 2020 2020 2069   = [];.        i
+00011fd0: 6620 2821 2474 6869 732d 3e73 6d74 7043  f (!$this->smtpC
+00011fe0: 6f6e 6e65 6374 2824 7468 6973 2d3e 534d  onnect($this->SM
+00011ff0: 5450 4f70 7469 6f6e 7329 2920 7b0a 2020  TPOptions)) {.  
+00012000: 2020 2020 2020 2020 2020 7468 726f 7720            throw 
+00012010: 6e65 7720 4578 6365 7074 696f 6e28 2474  new Exception($t
+00012020: 6869 732d 3e6c 616e 6728 2773 6d74 705f  his->lang('smtp_
+00012030: 636f 6e6e 6563 745f 6661 696c 6564 2729  connect_failed')
+00012040: 2c20 7365 6c66 3a3a 5354 4f50 5f43 5249  , self::STOP_CRI
+00012050: 5449 4341 4c29 3b0a 2020 2020 2020 2020  TICAL);.        
+00012060: 7d0a 2020 2020 2020 2020 2f2f 5365 6e64  }.        //Send
+00012070: 6572 2061 6c72 6561 6479 2076 616c 6964  er already valid
+00012080: 6174 6564 2069 6e20 7072 6553 656e 6428  ated in preSend(
+00012090: 290a 2020 2020 2020 2020 6966 2028 2727  ).        if (''
+000120a0: 203d 3d3d 2024 7468 6973 2d3e 5365 6e64   === $this->Send
+000120b0: 6572 2920 7b0a 2020 2020 2020 2020 2020  er) {.          
+000120c0: 2020 2473 6d74 705f 6672 6f6d 203d 2024    $smtp_from = $
+000120d0: 7468 6973 2d3e 4672 6f6d 3b0a 2020 2020  this->From;.    
+000120e0: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
+000120f0: 2020 2020 2020 2020 2024 736d 7470 5f66           $smtp_f
+00012100: 726f 6d20 3d20 2474 6869 732d 3e53 656e  rom = $this->Sen
+00012110: 6465 723b 0a20 2020 2020 2020 207d 0a20  der;.        }. 
+00012120: 2020 2020 2020 2069 6620 2863 6f75 6e74         if (count
+00012130: 2824 7468 6973 2d3e 534d 5450 5843 6c69  ($this->SMTPXCli
+00012140: 656e 7429 2920 7b0a 2020 2020 2020 2020  ent)) {.        
+00012150: 2020 2020 2474 6869 732d 3e73 6d74 702d      $this->smtp-
+00012160: 3e78 636c 6965 6e74 2824 7468 6973 2d3e  >xclient($this->
+00012170: 534d 5450 5843 6c69 656e 7429 3b0a 2020  SMTPXClient);.  
+00012180: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00012190: 6966 2028 2124 7468 6973 2d3e 736d 7470  if (!$this->smtp
+000121a0: 2d3e 6d61 696c 2824 736d 7470 5f66 726f  ->mail($smtp_fro
+000121b0: 6d29 2920 7b0a 2020 2020 2020 2020 2020  m)) {.          
+000121c0: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
+000121d0: 7228 2474 6869 732d 3e6c 616e 6728 2766  r($this->lang('f
+000121e0: 726f 6d5f 6661 696c 6564 2729 202e 2024  rom_failed') . $
+000121f0: 736d 7470 5f66 726f 6d20 2e20 2720 3a20  smtp_from . ' : 
+00012200: 2720 2e20 696d 706c 6f64 6528 272c 272c  ' . implode(',',
+00012210: 2024 7468 6973 2d3e 736d 7470 2d3e 6765   $this->smtp->ge
+00012220: 7445 7272 6f72 2829 2929 3b0a 2020 2020  tError()));.    
+00012230: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
+00012240: 7720 4578 6365 7074 696f 6e28 2474 6869  w Exception($thi
+00012250: 732d 3e45 7272 6f72 496e 666f 2c20 7365  s->ErrorInfo, se
+00012260: 6c66 3a3a 5354 4f50 5f43 5249 5449 4341  lf::STOP_CRITICA
+00012270: 4c29 3b0a 2020 2020 2020 2020 7d0a 0a20  L);.        }.. 
+00012280: 2020 2020 2020 2024 6361 6c6c 6261 636b         $callback
+00012290: 7320 3d20 5b5d 3b0a 2020 2020 2020 2020  s = [];.        
+000122a0: 2f2f 4174 7465 6d70 7420 746f 2073 656e  //Attempt to sen
+000122b0: 6420 746f 2061 6c6c 2072 6563 6970 6965  d to all recipie
+000122c0: 6e74 730a 2020 2020 2020 2020 666f 7265  nts.        fore
+000122d0: 6163 6820 285b 2474 6869 732d 3e74 6f2c  ach ([$this->to,
+000122e0: 2024 7468 6973 2d3e 6363 2c20 2474 6869   $this->cc, $thi
+000122f0: 732d 3e62 6363 5d20 6173 2024 746f 6772  s->bcc] as $togr
+00012300: 6f75 7029 207b 0a20 2020 2020 2020 2020  oup) {.         
+00012310: 2020 2066 6f72 6561 6368 2028 2474 6f67     foreach ($tog
+00012320: 726f 7570 2061 7320 2474 6f29 207b 0a20  roup as $to) {. 
+00012330: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012340: 6620 2821 2474 6869 732d 3e73 6d74 702d  f (!$this->smtp-
+00012350: 3e72 6563 6970 6965 6e74 2824 746f 5b30  >recipient($to[0
+00012360: 5d2c 2024 7468 6973 2d3e 6473 6e29 2920  ], $this->dsn)) 
+00012370: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00012380: 2020 2020 2020 2465 7272 6f72 203d 2024        $error = $
+00012390: 7468 6973 2d3e 736d 7470 2d3e 6765 7445  this->smtp->getE
+000123a0: 7272 6f72 2829 3b0a 2020 2020 2020 2020  rror();.        
+000123b0: 2020 2020 2020 2020 2020 2020 2462 6164              $bad
+000123c0: 5f72 6370 745b 5d20 3d20 5b27 746f 2720  _rcpt[] = ['to' 
+000123d0: 3d3e 2024 746f 5b30 5d2c 2027 6572 726f  => $to[0], 'erro
+000123e0: 7227 203d 3e20 2465 7272 6f72 5b27 6465  r' => $error['de
+000123f0: 7461 696c 275d 5d3b 0a20 2020 2020 2020  tail']];.       
+00012400: 2020 2020 2020 2020 2020 2020 2024 6973               $is
+00012410: 5365 6e74 203d 2066 616c 7365 3b0a 2020  Sent = false;.  
+00012420: 2020 2020 2020 2020 2020 2020 2020 7d20                } 
+00012430: 656c 7365 207b 0a20 2020 2020 2020 2020  else {.         
+00012440: 2020 2020 2020 2020 2020 2024 6973 5365             $isSe
+00012450: 6e74 203d 2074 7275 653b 0a20 2020 2020  nt = true;.     
+00012460: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
+00012470: 2020 2020 2020 2020 2020 2020 2020 2463                $c
+00012480: 616c 6c62 6163 6b73 5b5d 203d 205b 2769  allbacks[] = ['i
+00012490: 7373 656e 7427 203d 3e20 2469 7353 656e  ssent' => $isSen
+000124a0: 742c 2027 746f 2720 3d3e 2024 746f 5b30  t, 'to' => $to[0
+000124b0: 5d2c 2027 6e61 6d65 2720 3d3e 2024 746f  ], 'name' => $to
+000124c0: 5b31 5d5d 3b0a 2020 2020 2020 2020 2020  [1]];.          
+000124d0: 2020 7d0a 2020 2020 2020 2020 7d0a 0a20    }.        }.. 
+000124e0: 2020 2020 2020 202f 2f4f 6e6c 7920 7365         //Only se
+000124f0: 6e64 2074 6865 2044 4154 4120 636f 6d6d  nd the DATA comm
+00012500: 616e 6420 6966 2077 6520 6861 7665 2076  and if we have v
+00012510: 6961 626c 6520 7265 6369 7069 656e 7473  iable recipients
+00012520: 0a20 2020 2020 2020 2069 6620 2828 636f  .        if ((co
+00012530: 756e 7428 2474 6869 732d 3e61 6c6c 5f72  unt($this->all_r
+00012540: 6563 6970 6965 6e74 7329 203e 2063 6f75  ecipients) > cou
+00012550: 6e74 2824 6261 645f 7263 7074 2929 2026  nt($bad_rcpt)) &
+00012560: 2620 2124 7468 6973 2d3e 736d 7470 2d3e  & !$this->smtp->
+00012570: 6461 7461 2824 6865 6164 6572 202e 2024  data($header . $
+00012580: 626f 6479 2929 207b 0a20 2020 2020 2020  body)) {.       
+00012590: 2020 2020 2074 6872 6f77 206e 6577 2045       throw new E
+000125a0: 7863 6570 7469 6f6e 2824 7468 6973 2d3e  xception($this->
+000125b0: 6c61 6e67 2827 6461 7461 5f6e 6f74 5f61  lang('data_not_a
+000125c0: 6363 6570 7465 6427 292c 2073 656c 663a  ccepted'), self:
+000125d0: 3a53 544f 505f 4352 4954 4943 414c 293b  :STOP_CRITICAL);
+000125e0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+000125f0: 2020 2020 2473 6d74 705f 7472 616e 7361      $smtp_transa
+00012600: 6374 696f 6e5f 6964 203d 2024 7468 6973  ction_id = $this
+00012610: 2d3e 736d 7470 2d3e 6765 744c 6173 7454  ->smtp->getLastT
+00012620: 7261 6e73 6163 7469 6f6e 4944 2829 3b0a  ransactionID();.
+00012630: 0a20 2020 2020 2020 2069 6620 2824 7468  .        if ($th
+00012640: 6973 2d3e 534d 5450 4b65 6570 416c 6976  is->SMTPKeepAliv
+00012650: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
+00012660: 2024 7468 6973 2d3e 736d 7470 2d3e 7265   $this->smtp->re
+00012670: 7365 7428 293b 0a20 2020 2020 2020 207d  set();.        }
+00012680: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
+00012690: 2020 2020 2474 6869 732d 3e73 6d74 702d      $this->smtp-
+000126a0: 3e71 7569 7428 293b 0a20 2020 2020 2020  >quit();.       
+000126b0: 2020 2020 2024 7468 6973 2d3e 736d 7470       $this->smtp
+000126c0: 2d3e 636c 6f73 6528 293b 0a20 2020 2020  ->close();.     
+000126d0: 2020 207d 0a0a 2020 2020 2020 2020 666f     }..        fo
+000126e0: 7265 6163 6820 2824 6361 6c6c 6261 636b  reach ($callback
+000126f0: 7320 6173 2024 6362 2920 7b0a 2020 2020  s as $cb) {.    
+00012700: 2020 2020 2020 2020 2474 6869 732d 3e64          $this->d
+00012710: 6f43 616c 6c62 6163 6b28 0a20 2020 2020  oCallback(.     
+00012720: 2020 2020 2020 2020 2020 2024 6362 5b27             $cb['
+00012730: 6973 7365 6e74 275d 2c0a 2020 2020 2020  issent'],.      
+00012740: 2020 2020 2020 2020 2020 5b5b 2463 625b            [[$cb[
+00012750: 2774 6f27 5d2c 2024 6362 5b27 6e61 6d65  'to'], $cb['name
+00012760: 275d 5d5d 2c0a 2020 2020 2020 2020 2020  ']]],.          
+00012770: 2020 2020 2020 5b5d 2c0a 2020 2020 2020        [],.      
+00012780: 2020 2020 2020 2020 2020 5b5d 2c0a 2020            [],.  
+00012790: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+000127a0: 6869 732d 3e53 7562 6a65 6374 2c0a 2020  his->Subject,.  
+000127b0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
+000127c0: 6f64 792c 0a20 2020 2020 2020 2020 2020  ody,.           
+000127d0: 2020 2020 2024 7468 6973 2d3e 4672 6f6d       $this->From
+000127e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000127f0: 2020 5b27 736d 7470 5f74 7261 6e73 6163    ['smtp_transac
+00012800: 7469 6f6e 5f69 6427 203d 3e20 2473 6d74  tion_id' => $smt
+00012810: 705f 7472 616e 7361 6374 696f 6e5f 6964  p_transaction_id
+00012820: 5d0a 2020 2020 2020 2020 2020 2020 293b  ].            );
+00012830: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00012840: 2020 2020 2f2f 4372 6561 7465 2065 7272      //Create err
+00012850: 6f72 206d 6573 7361 6765 2066 6f72 2061  or message for a
+00012860: 6e79 2062 6164 2061 6464 7265 7373 6573  ny bad addresses
+00012870: 0a20 2020 2020 2020 2069 6620 2863 6f75  .        if (cou
+00012880: 6e74 2824 6261 645f 7263 7074 2920 3e20  nt($bad_rcpt) > 
+00012890: 3029 207b 0a20 2020 2020 2020 2020 2020  0) {.           
+000128a0: 2024 6572 7273 7472 203d 2027 273b 0a20   $errstr = '';. 
+000128b0: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
+000128c0: 6368 2028 2462 6164 5f72 6370 7420 6173  ch ($bad_rcpt as
+000128d0: 2024 6261 6429 207b 0a20 2020 2020 2020   $bad) {.       
+000128e0: 2020 2020 2020 2020 2024 6572 7273 7472           $errstr
+000128f0: 202e 3d20 2462 6164 5b27 746f 275d 202e   .= $bad['to'] .
+00012900: 2027 3a20 2720 2e20 2462 6164 5b27 6572   ': ' . $bad['er
+00012910: 726f 7227 5d3b 0a20 2020 2020 2020 2020  ror'];.         
+00012920: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00012930: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+00012940: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
+00012950: 2827 7265 6369 7069 656e 7473 5f66 6169  ('recipients_fai
+00012960: 6c65 6427 2920 2e20 2465 7272 7374 722c  led') . $errstr,
+00012970: 2073 656c 663a 3a53 544f 505f 434f 4e54   self::STOP_CONT
+00012980: 494e 5545 293b 0a20 2020 2020 2020 207d  INUE);.        }
+00012990: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000129a0: 2074 7275 653b 0a20 2020 207d 0a0a 2020   true;.    }..  
+000129b0: 2020 2f2a 2a0a 2020 2020 202a 2049 6e69    /**.     * Ini
+000129c0: 7469 6174 6520 6120 636f 6e6e 6563 7469  tiate a connecti
+000129d0: 6f6e 2074 6f20 616e 2053 4d54 5020 7365  on to an SMTP se
+000129e0: 7276 6572 2e0a 2020 2020 202a 2052 6574  rver..     * Ret
+000129f0: 7572 6e73 2066 616c 7365 2069 6620 7468  urns false if th
+00012a00: 6520 6f70 6572 6174 696f 6e20 6661 696c  e operation fail
+00012a10: 6564 2e0a 2020 2020 202a 0a20 2020 2020  ed..     *.     
+00012a20: 2a20 4070 6172 616d 2061 7272 6179 2024  * @param array $
+00012a30: 6f70 7469 6f6e 7320 416e 2061 7272 6179  options An array
+00012a40: 206f 6620 6f70 7469 6f6e 7320 636f 6d70   of options comp
+00012a50: 6174 6962 6c65 2077 6974 6820 7374 7265  atible with stre
+00012a60: 616d 5f63 6f6e 7465 7874 5f63 7265 6174  am_context_creat
+00012a70: 6528 290a 2020 2020 202a 0a20 2020 2020  e().     *.     
+00012a80: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
+00012a90: 696f 6e0a 2020 2020 202a 0a20 2020 2020  ion.     *.     
+00012aa0: 2a20 4075 7365 7320 5c50 4850 4d61 696c  * @uses \PHPMail
+00012ab0: 6572 5c50 4850 4d61 696c 6572 5c53 4d54  er\PHPMailer\SMT
+00012ac0: 500a 2020 2020 202a 0a20 2020 2020 2a20  P.     *.     * 
+00012ad0: 4072 6574 7572 6e20 626f 6f6c 0a20 2020  @return bool.   
+00012ae0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00012af0: 6675 6e63 7469 6f6e 2073 6d74 7043 6f6e  function smtpCon
+00012b00: 6e65 6374 2824 6f70 7469 6f6e 7320 3d20  nect($options = 
+00012b10: 6e75 6c6c 290a 2020 2020 7b0a 2020 2020  null).    {.    
+00012b20: 2020 2020 6966 2028 6e75 6c6c 203d 3d3d      if (null ===
+00012b30: 2024 7468 6973 2d3e 736d 7470 2920 7b0a   $this->smtp) {.
+00012b40: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+00012b50: 732d 3e73 6d74 7020 3d20 2474 6869 732d  s->smtp = $this-
+00012b60: 3e67 6574 534d 5450 496e 7374 616e 6365  >getSMTPInstance
+00012b70: 2829 3b0a 2020 2020 2020 2020 7d0a 0a20  ();.        }.. 
+00012b80: 2020 2020 2020 202f 2f49 6620 6e6f 206f         //If no o
+00012b90: 7074 696f 6e73 2061 7265 2070 726f 7669  ptions are provi
+00012ba0: 6465 642c 2075 7365 2077 6861 7465 7665  ded, use whateve
+00012bb0: 7220 6973 2073 6574 2069 6e20 7468 6520  r is set in the 
+00012bc0: 696e 7374 616e 6365 0a20 2020 2020 2020  instance.       
+00012bd0: 2069 6620 286e 756c 6c20 3d3d 3d20 246f   if (null === $o
+00012be0: 7074 696f 6e73 2920 7b0a 2020 2020 2020  ptions) {.      
+00012bf0: 2020 2020 2020 246f 7074 696f 6e73 203d        $options =
+00012c00: 2024 7468 6973 2d3e 534d 5450 4f70 7469   $this->SMTPOpti
+00012c10: 6f6e 733b 0a20 2020 2020 2020 207d 0a0a  ons;.        }..
+00012c20: 2020 2020 2020 2020 2f2f 416c 7265 6164          //Alread
+00012c30: 7920 636f 6e6e 6563 7465 643f 0a20 2020  y connected?.   
+00012c40: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
+00012c50: 736d 7470 2d3e 636f 6e6e 6563 7465 6428  smtp->connected(
+00012c60: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00012c70: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
+00012c80: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00012c90: 2024 7468 6973 2d3e 736d 7470 2d3e 7365   $this->smtp->se
+00012ca0: 7454 696d 656f 7574 2824 7468 6973 2d3e  tTimeout($this->
+00012cb0: 5469 6d65 6f75 7429 3b0a 2020 2020 2020  Timeout);.      
+00012cc0: 2020 2474 6869 732d 3e73 6d74 702d 3e73    $this->smtp->s
+00012cd0: 6574 4465 6275 674c 6576 656c 2824 7468  etDebugLevel($th
+00012ce0: 6973 2d3e 534d 5450 4465 6275 6729 3b0a  is->SMTPDebug);.
+00012cf0: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
+00012d00: 6d74 702d 3e73 6574 4465 6275 674f 7574  mtp->setDebugOut
+00012d10: 7075 7428 2474 6869 732d 3e44 6562 7567  put($this->Debug
+00012d20: 6f75 7470 7574 293b 0a20 2020 2020 2020  output);.       
+00012d30: 2024 7468 6973 2d3e 736d 7470 2d3e 7365   $this->smtp->se
+00012d40: 7456 6572 7028 2474 6869 732d 3e64 6f5f  tVerp($this->do_
+00012d50: 7665 7270 293b 0a20 2020 2020 2020 2069  verp);.        i
+00012d60: 6620 2824 7468 6973 2d3e 486f 7374 203d  f ($this->Host =
+00012d70: 3d3d 206e 756c 6c29 207b 0a20 2020 2020  == null) {.     
+00012d80: 2020 2020 2020 2024 7468 6973 2d3e 486f         $this->Ho
+00012d90: 7374 203d 2027 6c6f 6361 6c68 6f73 7427  st = 'localhost'
+00012da0: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00012db0: 2020 2020 2468 6f73 7473 203d 2065 7870      $hosts = exp
+00012dc0: 6c6f 6465 2827 3b27 2c20 2474 6869 732d  lode(';', $this-
+00012dd0: 3e48 6f73 7429 3b0a 2020 2020 2020 2020  >Host);.        
+00012de0: 246c 6173 7465 7863 6570 7469 6f6e 203d  $lastexception =
+00012df0: 206e 756c 6c3b 0a0a 2020 2020 2020 2020   null;..        
+00012e00: 666f 7265 6163 6820 2824 686f 7374 7320  foreach ($hosts 
+00012e10: 6173 2024 686f 7374 656e 7472 7929 207b  as $hostentry) {
+00012e20: 0a20 2020 2020 2020 2020 2020 2024 686f  .            $ho
+00012e30: 7374 696e 666f 203d 205b 5d3b 0a20 2020  stinfo = [];.   
+00012e40: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2170                !p
+00012e60: 7265 675f 6d61 7463 6828 0a20 2020 2020  reg_match(.     
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00012e80: 2f5e 283f 3a28 7373 6c7c 746c 7329 3a5c  /^(?:(ssl|tls):\
+00012e90: 2f5c 2f29 3f28 2e2b 3f29 283f 3a3a 285c  /\/)?(.+?)(?::(\
+00012ea0: 642b 2929 3f24 2f27 2c0a 2020 2020 2020  d+))?$/',.      
+00012eb0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00012ec0: 696d 2824 686f 7374 656e 7472 7929 2c0a  im($hostentry),.
+00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ee0: 2020 2020 2468 6f73 7469 6e66 6f0a 2020      $hostinfo.  
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00012f00: 2020 2020 2020 2020 2020 2020 2920 7b0a              ) {.
+00012f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f20: 2474 6869 732d 3e65 6465 6275 6728 2474  $this->edebug($t
+00012f30: 6869 732d 3e6c 616e 6728 2769 6e76 616c  his->lang('inval
+00012f40: 6964 5f68 6f73 7465 6e74 7279 2729 202e  id_hostentry') .
+00012f50: 2027 2027 202e 2074 7269 6d28 2468 6f73   ' ' . trim($hos
+00012f60: 7465 6e74 7279 2929 3b0a 2020 2020 2020  tentry));.      
+00012f70: 2020 2020 2020 2020 2020 2f2f 4e6f 7420            //Not 
+00012f80: 6120 7661 6c69 6420 686f 7374 2065 6e74  a valid host ent
+00012f90: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
+00012fa0: 2020 2063 6f6e 7469 6e75 653b 0a20 2020     continue;.   
+00012fb0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00012fc0: 2020 2020 2020 202f 2f24 686f 7374 696e         //$hostin
+00012fd0: 666f 5b31 5d3a 206f 7074 696f 6e61 6c20  fo[1]: optional 
+00012fe0: 7373 6c20 6f72 2074 6c73 2070 7265 6669  ssl or tls prefi
+00012ff0: 780a 2020 2020 2020 2020 2020 2020 2f2f  x.            //
+00013000: 2468 6f73 7469 6e66 6f5b 325d 3a20 7468  $hostinfo[2]: th
+00013010: 6520 686f 7374 6e61 6d65 0a20 2020 2020  e hostname.     
+00013020: 2020 2020 2020 202f 2f24 686f 7374 696e         //$hostin
+00013030: 666f 5b33 5d3a 206f 7074 696f 6e61 6c20  fo[3]: optional 
+00013040: 706f 7274 206e 756d 6265 720a 2020 2020  port number.    
+00013050: 2020 2020 2020 2020 2f2f 5468 6520 686f          //The ho
+00013060: 7374 2073 7472 696e 6720 7072 6566 6978  st string prefix
+00013070: 2063 616e 2074 656d 706f 7261 7269 6c79   can temporarily
+00013080: 206f 7665 7272 6964 6520 7468 6520 6375   override the cu
+00013090: 7272 656e 7420 7365 7474 696e 6720 666f  rrent setting fo
+000130a0: 7220 534d 5450 5365 6375 7265 0a20 2020  r SMTPSecure.   
+000130b0: 2020 2020 2020 2020 202f 2f49 6620 6974           //If it
+000130c0: 2773 206e 6f74 2073 7065 6369 6669 6564  's not specified
+000130d0: 2c20 7468 6520 6465 6661 756c 7420 7661  , the default va
+000130e0: 6c75 6520 6973 2075 7365 640a 0a20 2020  lue is used..   
+000130f0: 2020 2020 2020 2020 202f 2f43 6865 636b           //Check
+00013100: 2074 6865 2068 6f73 7420 6e61 6d65 2069   the host name i
+00013110: 7320 6120 7661 6c69 6420 6e61 6d65 206f  s a valid name o
+00013120: 7220 4950 2061 6464 7265 7373 2062 6566  r IP address bef
+00013130: 6f72 6520 7472 7969 6e67 2074 6f20 7573  ore trying to us
+00013140: 6520 6974 0a20 2020 2020 2020 2020 2020  e it.           
+00013150: 2069 6620 2821 7374 6174 6963 3a3a 6973   if (!static::is
+00013160: 5661 6c69 6448 6f73 7428 2468 6f73 7469  ValidHost($hosti
+00013170: 6e66 6f5b 325d 2929 207b 0a20 2020 2020  nfo[2])) {.     
+00013180: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00013190: 2d3e 6564 6562 7567 2824 7468 6973 2d3e  ->edebug($this->
+000131a0: 6c61 6e67 2827 696e 7661 6c69 645f 686f  lang('invalid_ho
+000131b0: 7374 2729 202e 2027 2027 202e 2024 686f  st') . ' ' . $ho
+000131c0: 7374 696e 666f 5b32 5d29 3b0a 2020 2020  stinfo[2]);.    
+000131d0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000131e0: 696e 7565 3b0a 2020 2020 2020 2020 2020  inue;.          
+000131f0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00013200: 2470 7265 6669 7820 3d20 2727 3b0a 2020  $prefix = '';.  
+00013210: 2020 2020 2020 2020 2020 2473 6563 7572            $secur
+00013220: 6520 3d20 2474 6869 732d 3e53 4d54 5053  e = $this->SMTPS
+00013230: 6563 7572 653b 0a20 2020 2020 2020 2020  ecure;.         
+00013240: 2020 2024 746c 7320 3d20 2873 7461 7469     $tls = (stati
+00013250: 633a 3a45 4e43 5259 5054 494f 4e5f 5354  c::ENCRYPTION_ST
+00013260: 4152 5454 4c53 203d 3d3d 2024 7468 6973  ARTTLS === $this
+00013270: 2d3e 534d 5450 5365 6375 7265 293b 0a20  ->SMTPSecure);. 
+00013280: 2020 2020 2020 2020 2020 2069 6620 2827             if ('
+00013290: 7373 6c27 203d 3d3d 2024 686f 7374 696e  ssl' === $hostin
+000132a0: 666f 5b31 5d20 7c7c 2028 2727 203d 3d3d  fo[1] || ('' ===
+000132b0: 2024 686f 7374 696e 666f 5b31 5d20 2626   $hostinfo[1] &&
+000132c0: 2073 7461 7469 633a 3a45 4e43 5259 5054   static::ENCRYPT
+000132d0: 494f 4e5f 534d 5450 5320 3d3d 3d20 2474  ION_SMTPS === $t
+000132e0: 6869 732d 3e53 4d54 5053 6563 7572 6529  his->SMTPSecure)
+000132f0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00013300: 2020 2020 2470 7265 6669 7820 3d20 2773      $prefix = 's
+00013310: 736c 3a2f 2f27 3b0a 2020 2020 2020 2020  sl://';.        
+00013320: 2020 2020 2020 2020 2474 6c73 203d 2066          $tls = f
+00013330: 616c 7365 3b20 2f2f 4361 6e27 7420 6861  alse; //Can't ha
+00013340: 7665 2053 534c 2061 6e64 2054 4c53 2061  ve SSL and TLS a
+00013350: 7420 7468 6520 7361 6d65 2074 696d 650a  t the same time.
+00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013370: 2473 6563 7572 6520 3d20 7374 6174 6963  $secure = static
+00013380: 3a3a 454e 4352 5950 5449 4f4e 5f53 4d54  ::ENCRYPTION_SMT
+00013390: 5053 3b0a 2020 2020 2020 2020 2020 2020  PS;.            
+000133a0: 7d20 656c 7365 6966 2028 2774 6c73 2720  } elseif ('tls' 
+000133b0: 3d3d 3d20 2468 6f73 7469 6e66 6f5b 315d  === $hostinfo[1]
+000133c0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+000133d0: 2020 2020 2474 6c73 203d 2074 7275 653b      $tls = true;
+000133e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000133f0: 202f 2f54 4c53 2064 6f65 736e 2774 2075   //TLS doesn't u
+00013400: 7365 2061 2070 7265 6669 780a 2020 2020  se a prefix.    
+00013410: 2020 2020 2020 2020 2020 2020 2473 6563              $sec
+00013420: 7572 6520 3d20 7374 6174 6963 3a3a 454e  ure = static::EN
+00013430: 4352 5950 5449 4f4e 5f53 5441 5254 544c  CRYPTION_STARTTL
+00013440: 533b 0a20 2020 2020 2020 2020 2020 207d  S;.            }
+00013450: 0a20 2020 2020 2020 2020 2020 202f 2f44  .            //D
+00013460: 6f20 7765 206e 6565 6420 7468 6520 4f70  o we need the Op
+00013470: 656e 5353 4c20 6578 7465 6e73 696f 6e3f  enSSL extension?
+00013480: 0a20 2020 2020 2020 2020 2020 2024 7373  .            $ss
+00013490: 6c65 7874 203d 2064 6566 696e 6564 2827  lext = defined('
+000134a0: 4f50 454e 5353 4c5f 414c 474f 5f53 4841  OPENSSL_ALGO_SHA
+000134b0: 3235 3627 293b 0a20 2020 2020 2020 2020  256');.         
+000134c0: 2020 2069 6620 2873 7461 7469 633a 3a45     if (static::E
+000134d0: 4e43 5259 5054 494f 4e5f 5354 4152 5454  NCRYPTION_STARTT
+000134e0: 4c53 203d 3d3d 2024 7365 6375 7265 207c  LS === $secure |
+000134f0: 7c20 7374 6174 6963 3a3a 454e 4352 5950  | static::ENCRYP
+00013500: 5449 4f4e 5f53 4d54 5053 203d 3d3d 2024  TION_SMTPS === $
+00013510: 7365 6375 7265 2920 7b0a 2020 2020 2020  secure) {.      
+00013520: 2020 2020 2020 2020 2020 2f2f 4368 6563            //Chec
+00013530: 6b20 666f 7220 616e 204f 7065 6e53 534c  k for an OpenSSL
+00013540: 2063 6f6e 7374 616e 7420 7261 7468 6572   constant rather
+00013550: 2074 6861 6e20 7573 696e 6720 6578 7465   than using exte
+00013560: 6e73 696f 6e5f 6c6f 6164 6564 2c20 7768  nsion_loaded, wh
+00013570: 6963 6820 6973 2073 6f6d 6574 696d 6573  ich is sometimes
+00013580: 2064 6973 6162 6c65 640a 2020 2020 2020   disabled.      
+00013590: 2020 2020 2020 2020 2020 6966 2028 2124            if (!$
+000135a0: 7373 6c65 7874 2920 7b0a 2020 2020 2020  sslext) {.      
+000135b0: 2020 2020 2020 2020 2020 2020 2020 7468                th
+000135c0: 726f 7720 6e65 7720 4578 6365 7074 696f  row new Exceptio
+000135d0: 6e28 2474 6869 732d 3e6c 616e 6728 2765  n($this->lang('e
+000135e0: 7874 656e 7369 6f6e 5f6d 6973 7369 6e67  xtension_missing
+000135f0: 2729 202e 2027 6f70 656e 7373 6c27 2c20  ') . 'openssl', 
+00013600: 7365 6c66 3a3a 5354 4f50 5f43 5249 5449  self::STOP_CRITI
+00013610: 4341 4c29 3b0a 2020 2020 2020 2020 2020  CAL);.          
+00013620: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00013630: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00013640: 2020 2468 6f73 7420 3d20 2468 6f73 7469    $host = $hosti
+00013650: 6e66 6f5b 325d 3b0a 2020 2020 2020 2020  nfo[2];.        
+00013660: 2020 2020 2470 6f72 7420 3d20 2474 6869      $port = $thi
+00013670: 732d 3e50 6f72 743b 0a20 2020 2020 2020  s->Port;.       
+00013680: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+00013690: 2020 2020 2020 2020 2020 6172 7261 795f            array_
+000136a0: 6b65 795f 6578 6973 7473 2833 2c20 2468  key_exists(3, $h
+000136b0: 6f73 7469 6e66 6f29 2026 260a 2020 2020  ostinfo) &&.    
+000136c0: 2020 2020 2020 2020 2020 2020 6973 5f6e              is_n
+000136d0: 756d 6572 6963 2824 686f 7374 696e 666f  umeric($hostinfo
+000136e0: 5b33 5d29 2026 260a 2020 2020 2020 2020  [3]) &&.        
+000136f0: 2020 2020 2020 2020 2468 6f73 7469 6e66          $hostinf
+00013700: 6f5b 335d 203e 2030 2026 260a 2020 2020  o[3] > 0 &&.    
+00013710: 2020 2020 2020 2020 2020 2020 2468 6f73              $hos
+00013720: 7469 6e66 6f5b 335d 203c 2036 3535 3336  tinfo[3] < 65536
+00013730: 0a20 2020 2020 2020 2020 2020 2029 207b  .            ) {
+00013740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013750: 2024 706f 7274 203d 2028 696e 7429 2024   $port = (int) $
+00013760: 686f 7374 696e 666f 5b33 5d3b 0a20 2020  hostinfo[3];.   
+00013770: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00013780: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
+00013790: 2d3e 736d 7470 2d3e 636f 6e6e 6563 7428  ->smtp->connect(
+000137a0: 2470 7265 6669 7820 2e20 2468 6f73 742c  $prefix . $host,
+000137b0: 2024 706f 7274 2c20 2474 6869 732d 3e54   $port, $this->T
+000137c0: 696d 656f 7574 2c20 246f 7074 696f 6e73  imeout, $options
+000137d0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+000137e0: 2020 2020 2074 7279 207b 0a20 2020 2020       try {.     
+000137f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013800: 6620 2824 7468 6973 2d3e 4865 6c6f 2920  f ($this->Helo) 
+00013810: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00013820: 2020 2020 2020 2020 2020 2468 656c 6c6f            $hello
+00013830: 203d 2024 7468 6973 2d3e 4865 6c6f 3b0a   = $this->Helo;.
+00013840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013850: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
+00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013870: 2020 2020 2024 6865 6c6c 6f20 3d20 2474       $hello = $t
+00013880: 6869 732d 3e73 6572 7665 7248 6f73 746e  his->serverHostn
+00013890: 616d 6528 293b 0a20 2020 2020 2020 2020  ame();.         
+000138a0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+000138b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138c0: 2024 7468 6973 2d3e 736d 7470 2d3e 6865   $this->smtp->he
+000138d0: 6c6c 6f28 2468 656c 6c6f 293b 0a20 2020  llo($hello);.   
+000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138f0: 202f 2f41 7574 6f6d 6174 6963 616c 6c79   //Automatically
+00013900: 2065 6e61 626c 6520 544c 5320 656e 6372   enable TLS encr
+00013910: 7970 7469 6f6e 2069 663a 0a20 2020 2020  yption if:.     
+00013920: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+00013930: 2f2a 2069 7427 7320 6e6f 7420 6469 7361  /* it's not disa
+00013940: 626c 6564 0a20 2020 2020 2020 2020 2020  bled.           
+00013950: 2020 2020 2020 2020 202f 2f2a 2077 6520           //* we 
+00013960: 6172 6520 6e6f 7420 636f 6e6e 6563 7469  are not connecti
+00013970: 6e67 2074 6f20 6c6f 6361 6c68 6f73 740a  ng to localhost.
+00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013990: 2020 2020 2f2f 2a20 7765 2068 6176 6520      //* we have 
+000139a0: 6f70 656e 7373 6c20 6578 7465 6e73 696f  openssl extensio
+000139b0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000139c0: 2020 2020 2020 2f2f 2a20 7765 2061 7265        //* we are
+000139d0: 206e 6f74 2061 6c72 6561 6479 2075 7369   not already usi
+000139e0: 6e67 2053 534c 0a20 2020 2020 2020 2020  ng SSL.         
+000139f0: 2020 2020 2020 2020 2020 202f 2f2a 2074             //* t
+00013a00: 6865 2073 6572 7665 7220 6f66 6665 7273  he server offers
+00013a10: 2053 5441 5254 544c 530a 2020 2020 2020   STARTTLS.      
+00013a20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013a30: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00013a40: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00013a50: 2d3e 534d 5450 4175 746f 544c 5320 2626  ->SMTPAutoTLS &&
+00013a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a70: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00013a80: 486f 7374 2021 3d3d 2027 6c6f 6361 6c68  Host !== 'localh
+00013a90: 6f73 7427 2026 260a 2020 2020 2020 2020  ost' &&.        
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ab0: 2473 736c 6578 7420 2626 0a20 2020 2020  $sslext &&.     
+00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ad0: 2020 2024 7365 6375 7265 2021 3d3d 2027     $secure !== '
+00013ae0: 7373 6c27 2026 260a 2020 2020 2020 2020  ssl' &&.        
+00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b00: 2474 6869 732d 3e73 6d74 702d 3e67 6574  $this->smtp->get
+00013b10: 5365 7276 6572 4578 7428 2753 5441 5254  ServerExt('START
+00013b20: 544c 5327 290a 2020 2020 2020 2020 2020  TLS').          
+00013b30: 2020 2020 2020 2020 2020 2920 7b0a 2020            ) {.  
+00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b50: 2020 2020 2020 2474 6c73 203d 2074 7275        $tls = tru
+00013b60: 653b 0a20 2020 2020 2020 2020 2020 2020  e;.             
+00013b70: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00013b80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00013b90: 2824 746c 7329 207b 0a20 2020 2020 2020  ($tls) {.       
+00013ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013bb0: 2069 6620 2821 2474 6869 732d 3e73 6d74   if (!$this->smt
+00013bc0: 702d 3e73 7461 7274 544c 5328 2929 207b  p->startTLS()) {
+00013bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013be0: 2020 2020 2020 2020 2020 2020 2024 6d65               $me
+00013bf0: 7373 6167 6520 3d20 2474 6869 732d 3e67  ssage = $this->g
+00013c00: 6574 536d 7470 4572 726f 724d 6573 7361  etSmtpErrorMessa
+00013c10: 6765 2827 636f 6e6e 6563 745f 686f 7374  ge('connect_host
+00013c20: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
+00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c40: 7468 726f 7720 6e65 7720 4578 6365 7074  throw new Except
+00013c50: 696f 6e28 246d 6573 7361 6765 293b 0a20  ion($message);. 
+00013c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c70: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00013c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c90: 202f 2f57 6520 6d75 7374 2072 6573 656e   //We must resen
+00013ca0: 6420 4548 4c4f 2061 6674 6572 2054 4c53  d EHLO after TLS
+00013cb0: 206e 6567 6f74 6961 7469 6f6e 0a20 2020   negotiation.   
+00013cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013cd0: 2020 2020 2024 7468 6973 2d3e 736d 7470       $this->smtp
+00013ce0: 2d3e 6865 6c6c 6f28 2468 656c 6c6f 293b  ->hello($hello);
+00013cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d00: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00013d10: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
+00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d30: 2020 2020 2020 2020 2474 6869 732d 3e53          $this->S
+00013d40: 4d54 5041 7574 6820 2626 2021 2474 6869  MTPAuth && !$thi
+00013d50: 732d 3e73 6d74 702d 3e61 7574 6865 6e74  s->smtp->authent
+00013d60: 6963 6174 6528 0a20 2020 2020 2020 2020  icate(.         
+00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d80: 2020 2024 7468 6973 2d3e 5573 6572 6e61     $this->Userna
+00013d90: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013db0: 2474 6869 732d 3e50 6173 7377 6f72 642c  $this->Password,
+00013dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013dd0: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+00013de0: 6973 2d3e 4175 7468 5479 7065 2c0a 2020  is->AuthType,.  
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00013e10: 3e6f 6175 7468 0a20 2020 2020 2020 2020  >oauth.         
+00013e20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00013e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e40: 2020 2020 2029 207b 0a20 2020 2020 2020       ) {.       
+00013e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e60: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+00013e70: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
+00013e80: 2827 6175 7468 656e 7469 6361 7465 2729  ('authenticate')
+00013e90: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+00013ea0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00013eb0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013ec0: 7475 726e 2074 7275 653b 0a20 2020 2020  turn true;.     
+00013ed0: 2020 2020 2020 2020 2020 207d 2063 6174             } cat
+00013ee0: 6368 2028 4578 6365 7074 696f 6e20 2465  ch (Exception $e
+00013ef0: 7863 2920 7b0a 2020 2020 2020 2020 2020  xc) {.          
+00013f00: 2020 2020 2020 2020 2020 246c 6173 7465            $laste
+00013f10: 7863 6570 7469 6f6e 203d 2024 6578 633b  xception = $exc;
+00013f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013f30: 2020 2020 2024 7468 6973 2d3e 6564 6562       $this->edeb
+00013f40: 7567 2824 6578 632d 3e67 6574 4d65 7373  ug($exc->getMess
+00013f50: 6167 6528 2929 3b0a 2020 2020 2020 2020  age());.        
+00013f60: 2020 2020 2020 2020 2020 2020 2f2f 5765              //We
+00013f70: 206d 7573 7420 6861 7665 2063 6f6e 6e65   must have conne
+00013f80: 6374 6564 2c20 6275 7420 7468 656e 2066  cted, but then f
+00013f90: 6169 6c65 6420 544c 5320 6f72 2041 7574  ailed TLS or Aut
+00013fa0: 682c 2073 6f20 636c 6f73 6520 636f 6e6e  h, so close conn
+00013fb0: 6563 7469 6f6e 206e 6963 656c 790a 2020  ection nicely.  
+00013fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fd0: 2020 2474 6869 732d 3e73 6d74 702d 3e71    $this->smtp->q
+00013fe0: 7569 7428 293b 0a20 2020 2020 2020 2020  uit();.         
+00013ff0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00014000: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
+00014010: 0a20 2020 2020 2020 202f 2f49 6620 7765  .        //If we
+00014020: 2067 6574 2068 6572 652c 2061 6c6c 2063   get here, all c
+00014030: 6f6e 6e65 6374 696f 6e20 6174 7465 6d70  onnection attemp
+00014040: 7473 2068 6176 6520 6661 696c 6564 2c20  ts have failed, 
+00014050: 736f 2063 6c6f 7365 2063 6f6e 6e65 6374  so close connect
+00014060: 696f 6e20 6861 7264 0a20 2020 2020 2020  ion hard.       
+00014070: 2024 7468 6973 2d3e 736d 7470 2d3e 636c   $this->smtp->cl
+00014080: 6f73 6528 293b 0a20 2020 2020 2020 202f  ose();.        /
+00014090: 2f41 7320 7765 2776 6520 6361 7567 6874  /As we've caught
+000140a0: 2061 6c6c 2065 7863 6570 7469 6f6e 732c   all exceptions,
+000140b0: 206a 7573 7420 7265 706f 7274 2077 6861   just report wha
+000140c0: 7465 7665 7220 7468 6520 6c61 7374 206f  tever the last o
+000140d0: 6e65 2077 6173 0a20 2020 2020 2020 2069  ne was.        i
+000140e0: 6620 2824 7468 6973 2d3e 6578 6365 7074  f ($this->except
+000140f0: 696f 6e73 2026 2620 6e75 6c6c 2021 3d3d  ions && null !==
+00014100: 2024 6c61 7374 6578 6365 7074 696f 6e29   $lastexception)
+00014110: 207b 0a20 2020 2020 2020 2020 2020 2074   {.            t
+00014120: 6872 6f77 2024 6c61 7374 6578 6365 7074  hrow $lastexcept
+00014130: 696f 6e3b 0a20 2020 2020 2020 207d 0a20  ion;.        }. 
+00014140: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
+00014150: 2d3e 6578 6365 7074 696f 6e73 2920 7b0a  ->exceptions) {.
+00014160: 2020 2020 2020 2020 2020 2020 2f2f 206e              // n
+00014170: 6f20 6578 6365 7074 696f 6e20 7761 7320  o exception was 
+00014180: 7468 726f 776e 2c20 6c69 6b65 6c79 2024  thrown, likely $
+00014190: 7468 6973 2d3e 736d 7470 2d3e 636f 6e6e  this->smtp->conn
+000141a0: 6563 7428 2920 6661 696c 6564 0a20 2020  ect() failed.   
+000141b0: 2020 2020 2020 2020 2024 6d65 7373 6167           $messag
+000141c0: 6520 3d20 2474 6869 732d 3e67 6574 536d  e = $this->getSm
+000141d0: 7470 4572 726f 724d 6573 7361 6765 2827  tpErrorMessage('
+000141e0: 636f 6e6e 6563 745f 686f 7374 2729 3b0a  connect_host');.
+000141f0: 2020 2020 2020 2020 2020 2020 7468 726f              thro
+00014200: 7720 6e65 7720 4578 6365 7074 696f 6e28  w new Exception(
+00014210: 246d 6573 7361 6765 293b 0a20 2020 2020  $message);.     
+00014220: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+00014230: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
+00014240: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00014250: 2a20 436c 6f73 6520 7468 6520 6163 7469  * Close the acti
+00014260: 7665 2053 4d54 5020 7365 7373 696f 6e20  ve SMTP session 
+00014270: 6966 206f 6e65 2065 7869 7374 732e 0a20  if one exists.. 
+00014280: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00014290: 6320 6675 6e63 7469 6f6e 2073 6d74 7043  c function smtpC
+000142a0: 6c6f 7365 2829 0a20 2020 207b 0a20 2020  lose().    {.   
+000142b0: 2020 2020 2069 6620 2828 6e75 6c6c 2021       if ((null !
+000142c0: 3d3d 2024 7468 6973 2d3e 736d 7470 2920  == $this->smtp) 
+000142d0: 2626 2024 7468 6973 2d3e 736d 7470 2d3e  && $this->smtp->
+000142e0: 636f 6e6e 6563 7465 6428 2929 207b 0a20  connected()) {. 
+000142f0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00014300: 2d3e 736d 7470 2d3e 7175 6974 2829 3b0a  ->smtp->quit();.
+00014310: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+00014320: 732d 3e73 6d74 702d 3e63 6c6f 7365 2829  s->smtp->close()
+00014330: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00014340: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00014350: 2a20 5365 7420 7468 6520 6c61 6e67 7561  * Set the langua
+00014360: 6765 2066 6f72 2065 7272 6f72 206d 6573  ge for error mes
+00014370: 7361 6765 732e 0a20 2020 2020 2a20 5468  sages..     * Th
+00014380: 6520 6465 6661 756c 7420 6c61 6e67 7561  e default langua
+00014390: 6765 2069 7320 456e 676c 6973 682e 0a20  ge is English.. 
+000143a0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+000143b0: 7261 6d20 7374 7269 6e67 2024 6c61 6e67  ram string $lang
+000143c0: 636f 6465 2020 4953 4f20 3633 392d 3120  code  ISO 639-1 
+000143d0: 322d 6368 6172 6163 7465 7220 6c61 6e67  2-character lang
+000143e0: 7561 6765 2063 6f64 6520 2865 2e67 2e20  uage code (e.g. 
+000143f0: 4672 656e 6368 2069 7320 2266 7222 290a  French is "fr").
+00014400: 2020 2020 202a 2020 2020 2020 2020 2020       *          
+00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014420: 4f70 7469 6f6e 616c 6c79 2c20 7468 6520  Optionally, the 
+00014430: 6c61 6e67 7561 6765 2063 6f64 6520 6361  language code ca
+00014440: 6e20 6265 2065 6e68 616e 6365 6420 7769  n be enhanced wi
+00014450: 7468 2061 2034 2d63 6861 7261 6374 6572  th a 4-character
+00014460: 0a20 2020 2020 2a20 2020 2020 2020 2020  .     *         
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 2073 6372 6970 7420 616e 6e6f 7461 7469   script annotati
+00014490: 6f6e 2061 6e64 2f6f 7220 6120 322d 6368  on and/or a 2-ch
+000144a0: 6172 6163 7465 7220 636f 756e 7472 7920  aracter country 
+000144b0: 616e 6e6f 7461 7469 6f6e 2e0a 2020 2020  annotation..    
+000144c0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+000144d0: 2024 6c61 6e67 5f70 6174 6820 5061 7468   $lang_path Path
+000144e0: 2074 6f20 7468 6520 6c61 6e67 7561 6765   to the language
+000144f0: 2066 696c 6520 6469 7265 6374 6f72 792c   file directory,
+00014500: 2077 6974 6820 7472 6169 6c69 6e67 2073   with trailing s
+00014510: 6570 6172 6174 6f72 2028 736c 6173 6829  eparator (slash)
+00014520: 0a20 2020 2020 2a20 2020 2020 2020 2020  .     *         
+00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2044 6f20 6e6f 7420 7365 7420 7468 6973   Do not set this
+00014550: 2066 726f 6d20 7573 6572 2069 6e70 7574   from user input
+00014560: 210a 2020 2020 202a 0a20 2020 2020 2a20  !.     *.     * 
+00014570: 4072 6574 7572 6e20 626f 6f6c 2052 6574  @return bool Ret
+00014580: 7572 6e73 2074 7275 6520 6966 2074 6865  urns true if the
+00014590: 2072 6571 7565 7374 6564 206c 616e 6775   requested langu
+000145a0: 6167 6520 7761 7320 6c6f 6164 6564 2c20  age was loaded, 
+000145b0: 6661 6c73 6520 6f74 6865 7277 6973 652e  false otherwise.
+000145c0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+000145d0: 6c69 6320 6675 6e63 7469 6f6e 2073 6574  lic function set
+000145e0: 4c61 6e67 7561 6765 2824 6c61 6e67 636f  Language($langco
+000145f0: 6465 203d 2027 656e 272c 2024 6c61 6e67  de = 'en', $lang
+00014600: 5f70 6174 6820 3d20 2727 290a 2020 2020  _path = '').    
+00014610: 7b0a 2020 2020 2020 2020 2f2f 4261 636b  {.        //Back
+00014620: 7761 7264 7320 636f 6d70 6174 6962 696c  wards compatibil
+00014630: 6974 7920 666f 7220 7265 6e61 6d65 6420  ity for renamed 
+00014640: 6c61 6e67 7561 6765 2063 6f64 6573 0a20  language codes. 
+00014650: 2020 2020 2020 2024 7265 6e61 6d65 645f         $renamed_
+00014660: 6c61 6e67 636f 6465 7320 3d20 5b0a 2020  langcodes = [.  
+00014670: 2020 2020 2020 2020 2020 2762 7227 203d            'br' =
+00014680: 3e20 2770 745f 6272 272c 0a20 2020 2020  > 'pt_br',.     
+00014690: 2020 2020 2020 2027 637a 2720 3d3e 2027         'cz' => '
+000146a0: 6373 272c 0a20 2020 2020 2020 2020 2020  cs',.           
+000146b0: 2027 646b 2720 3d3e 2027 6461 272c 0a20   'dk' => 'da',. 
+000146c0: 2020 2020 2020 2020 2020 2027 6e6f 2720             'no' 
+000146d0: 3d3e 2027 6e62 272c 0a20 2020 2020 2020  => 'nb',.       
+000146e0: 2020 2020 2027 7365 2720 3d3e 2027 7376       'se' => 'sv
+000146f0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+00014700: 7273 2720 3d3e 2027 7372 272c 0a20 2020  rs' => 'sr',.   
+00014710: 2020 2020 2020 2020 2027 7467 2720 3d3e           'tg' =>
+00014720: 2027 746c 272c 0a20 2020 2020 2020 2020   'tl',.         
+00014730: 2020 2027 616d 2720 3d3e 2027 6879 272c     'am' => 'hy',
+00014740: 0a20 2020 2020 2020 205d 3b0a 0a20 2020  .        ];..   
+00014750: 2020 2020 2069 6620 2861 7272 6179 5f6b       if (array_k
+00014760: 6579 5f65 7869 7374 7328 246c 616e 6763  ey_exists($langc
+00014770: 6f64 652c 2024 7265 6e61 6d65 645f 6c61  ode, $renamed_la
+00014780: 6e67 636f 6465 7329 2920 7b0a 2020 2020  ngcodes)) {.    
+00014790: 2020 2020 2020 2020 246c 616e 6763 6f64          $langcod
+000147a0: 6520 3d20 2472 656e 616d 6564 5f6c 616e  e = $renamed_lan
+000147b0: 6763 6f64 6573 5b24 6c61 6e67 636f 6465  gcodes[$langcode
+000147c0: 5d3b 0a20 2020 2020 2020 207d 0a0a 2020  ];.        }..  
+000147d0: 2020 2020 2020 2f2f 4465 6669 6e65 2066        //Define f
+000147e0: 756c 6c20 7365 7420 6f66 2074 7261 6e73  ull set of trans
+000147f0: 6c61 7461 626c 6520 7374 7269 6e67 7320  latable strings 
+00014800: 696e 2045 6e67 6c69 7368 0a20 2020 2020  in English.     
+00014810: 2020 2024 5048 504d 4149 4c45 525f 4c41     $PHPMAILER_LA
+00014820: 4e47 203d 205b 0a20 2020 2020 2020 2020  NG = [.         
+00014830: 2020 2027 6175 7468 656e 7469 6361 7465     'authenticate
+00014840: 2720 3d3e 2027 534d 5450 2045 7272 6f72  ' => 'SMTP Error
+00014850: 3a20 436f 756c 6420 6e6f 7420 6175 7468  : Could not auth
+00014860: 656e 7469 6361 7465 2e27 2c0a 2020 2020  enticate.',.    
+00014870: 2020 2020 2020 2020 2762 7567 6779 5f70          'buggy_p
+00014880: 6870 2720 3d3e 2027 596f 7572 2076 6572  hp' => 'Your ver
+00014890: 7369 6f6e 206f 6620 5048 5020 6973 2061  sion of PHP is a
+000148a0: 6666 6563 7465 6420 6279 2061 2062 7567  ffected by a bug
+000148b0: 2074 6861 7420 6d61 7920 7265 7375 6c74   that may result
+000148c0: 2069 6e20 636f 7272 7570 7465 6420 6d65   in corrupted me
+000148d0: 7373 6167 6573 2e27 202e 0a20 2020 2020  ssages.' ..     
+000148e0: 2020 2020 2020 2020 2020 2027 2054 6f20             ' To 
+000148f0: 6669 7820 6974 2c20 7377 6974 6368 2074  fix it, switch t
+00014900: 6f20 7365 6e64 696e 6720 7573 696e 6720  o sending using 
+00014910: 534d 5450 2c20 6469 7361 626c 6520 7468  SMTP, disable th
+00014920: 6520 6d61 696c 2e61 6464 5f78 5f68 6561  e mail.add_x_hea
+00014930: 6465 7220 6f70 7469 6f6e 2069 6e27 202e  der option in' .
+00014940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014950: 2027 2079 6f75 7220 7068 702e 696e 692c   ' your php.ini,
+00014960: 2073 7769 7463 6820 746f 204d 6163 4f53   switch to MacOS
+00014970: 206f 7220 4c69 6e75 782c 206f 7220 7570   or Linux, or up
+00014980: 6772 6164 6520 796f 7572 2050 4850 2074  grade your PHP t
+00014990: 6f20 7665 7273 696f 6e20 372e 302e 3137  o version 7.0.17
+000149a0: 2b20 6f72 2037 2e31 2e33 2b2e 272c 0a20  + or 7.1.3+.',. 
+000149b0: 2020 2020 2020 2020 2020 2027 636f 6e6e             'conn
+000149c0: 6563 745f 686f 7374 2720 3d3e 2027 534d  ect_host' => 'SM
+000149d0: 5450 2045 7272 6f72 3a20 436f 756c 6420  TP Error: Could 
+000149e0: 6e6f 7420 636f 6e6e 6563 7420 746f 2053  not connect to S
+000149f0: 4d54 5020 686f 7374 2e27 2c0a 2020 2020  MTP host.',.    
+00014a00: 2020 2020 2020 2020 2764 6174 615f 6e6f          'data_no
+00014a10: 745f 6163 6365 7074 6564 2720 3d3e 2027  t_accepted' => '
+00014a20: 534d 5450 2045 7272 6f72 3a20 6461 7461  SMTP Error: data
+00014a30: 206e 6f74 2061 6363 6570 7465 642e 272c   not accepted.',
+00014a40: 0a20 2020 2020 2020 2020 2020 2027 656d  .            'em
+00014a50: 7074 795f 6d65 7373 6167 6527 203d 3e20  pty_message' => 
+00014a60: 274d 6573 7361 6765 2062 6f64 7920 656d  'Message body em
+00014a70: 7074 7927 2c0a 2020 2020 2020 2020 2020  pty',.          
+00014a80: 2020 2765 6e63 6f64 696e 6727 203d 3e20    'encoding' => 
+00014a90: 2755 6e6b 6e6f 776e 2065 6e63 6f64 696e  'Unknown encodin
+00014aa0: 673a 2027 2c0a 2020 2020 2020 2020 2020  g: ',.          
+00014ab0: 2020 2765 7865 6375 7465 2720 3d3e 2027    'execute' => '
+00014ac0: 436f 756c 6420 6e6f 7420 6578 6563 7574  Could not execut
+00014ad0: 653a 2027 2c0a 2020 2020 2020 2020 2020  e: ',.          
+00014ae0: 2020 2765 7874 656e 7369 6f6e 5f6d 6973    'extension_mis
+00014af0: 7369 6e67 2720 3d3e 2027 4578 7465 6e73  sing' => 'Extens
+00014b00: 696f 6e20 6d69 7373 696e 673a 2027 2c0a  ion missing: ',.
+00014b10: 2020 2020 2020 2020 2020 2020 2766 696c              'fil
+00014b20: 655f 6163 6365 7373 2720 3d3e 2027 436f  e_access' => 'Co
+00014b30: 756c 6420 6e6f 7420 6163 6365 7373 2066  uld not access f
+00014b40: 696c 653a 2027 2c0a 2020 2020 2020 2020  ile: ',.        
+00014b50: 2020 2020 2766 696c 655f 6f70 656e 2720      'file_open' 
+00014b60: 3d3e 2027 4669 6c65 2045 7272 6f72 3a20  => 'File Error: 
+00014b70: 436f 756c 6420 6e6f 7420 6f70 656e 2066  Could not open f
+00014b80: 696c 653a 2027 2c0a 2020 2020 2020 2020  ile: ',.        
+00014b90: 2020 2020 2766 726f 6d5f 6661 696c 6564      'from_failed
+00014ba0: 2720 3d3e 2027 5468 6520 666f 6c6c 6f77  ' => 'The follow
+00014bb0: 696e 6720 4672 6f6d 2061 6464 7265 7373  ing From address
+00014bc0: 2066 6169 6c65 643a 2027 2c0a 2020 2020   failed: ',.    
+00014bd0: 2020 2020 2020 2020 2769 6e73 7461 6e74          'instant
+00014be0: 6961 7465 2720 3d3e 2027 436f 756c 6420  iate' => 'Could 
+00014bf0: 6e6f 7420 696e 7374 616e 7469 6174 6520  not instantiate 
+00014c00: 6d61 696c 2066 756e 6374 696f 6e2e 272c  mail function.',
+00014c10: 0a20 2020 2020 2020 2020 2020 2027 696e  .            'in
+00014c20: 7661 6c69 645f 6164 6472 6573 7327 203d  valid_address' =
+00014c30: 3e20 2749 6e76 616c 6964 2061 6464 7265  > 'Invalid addre
+00014c40: 7373 3a20 272c 0a20 2020 2020 2020 2020  ss: ',.         
+00014c50: 2020 2027 696e 7661 6c69 645f 6865 6164     'invalid_head
+00014c60: 6572 2720 3d3e 2027 496e 7661 6c69 6420  er' => 'Invalid 
+00014c70: 6865 6164 6572 206e 616d 6520 6f72 2076  header name or v
+00014c80: 616c 7565 272c 0a20 2020 2020 2020 2020  alue',.         
+00014c90: 2020 2027 696e 7661 6c69 645f 686f 7374     'invalid_host
+00014ca0: 656e 7472 7927 203d 3e20 2749 6e76 616c  entry' => 'Inval
+00014cb0: 6964 2068 6f73 7465 6e74 7279 3a20 272c  id hostentry: ',
+00014cc0: 0a20 2020 2020 2020 2020 2020 2027 696e  .            'in
+00014cd0: 7661 6c69 645f 686f 7374 2720 3d3e 2027  valid_host' => '
+00014ce0: 496e 7661 6c69 6420 686f 7374 3a20 272c  Invalid host: ',
+00014cf0: 0a20 2020 2020 2020 2020 2020 2027 6d61  .            'ma
+00014d00: 696c 6572 5f6e 6f74 5f73 7570 706f 7274  iler_not_support
+00014d10: 6564 2720 3d3e 2027 206d 6169 6c65 7220  ed' => ' mailer 
+00014d20: 6973 206e 6f74 2073 7570 706f 7274 6564  is not supported
+00014d30: 2e27 2c0a 2020 2020 2020 2020 2020 2020  .',.            
+00014d40: 2770 726f 7669 6465 5f61 6464 7265 7373  'provide_address
+00014d50: 2720 3d3e 2027 596f 7520 6d75 7374 2070  ' => 'You must p
+00014d60: 726f 7669 6465 2061 7420 6c65 6173 7420  rovide at least 
+00014d70: 6f6e 6520 7265 6369 7069 656e 7420 656d  one recipient em
+00014d80: 6169 6c20 6164 6472 6573 732e 272c 0a20  ail address.',. 
+00014d90: 2020 2020 2020 2020 2020 2027 7265 6369             'reci
+00014da0: 7069 656e 7473 5f66 6169 6c65 6427 203d  pients_failed' =
+00014db0: 3e20 2753 4d54 5020 4572 726f 723a 2054  > 'SMTP Error: T
+00014dc0: 6865 2066 6f6c 6c6f 7769 6e67 2072 6563  he following rec
+00014dd0: 6970 6965 6e74 7320 6661 696c 6564 3a20  ipients failed: 
+00014de0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+00014df0: 7369 676e 696e 6727 203d 3e20 2753 6967  signing' => 'Sig
+00014e00: 6e69 6e67 2045 7272 6f72 3a20 272c 0a20  ning Error: ',. 
+00014e10: 2020 2020 2020 2020 2020 2027 736d 7470             'smtp
+00014e20: 5f63 6f64 6527 203d 3e20 2753 4d54 5020  _code' => 'SMTP 
+00014e30: 636f 6465 3a20 272c 0a20 2020 2020 2020  code: ',.       
+00014e40: 2020 2020 2027 736d 7470 5f63 6f64 655f       'smtp_code_
+00014e50: 6578 2720 3d3e 2027 4164 6469 7469 6f6e  ex' => 'Addition
+00014e60: 616c 2053 4d54 5020 696e 666f 3a20 272c  al SMTP info: ',
+00014e70: 0a20 2020 2020 2020 2020 2020 2027 736d  .            'sm
+00014e80: 7470 5f63 6f6e 6e65 6374 5f66 6169 6c65  tp_connect_faile
+00014e90: 6427 203d 3e20 2753 4d54 5020 636f 6e6e  d' => 'SMTP conn
+00014ea0: 6563 7428 2920 6661 696c 6564 2e27 2c0a  ect() failed.',.
+00014eb0: 2020 2020 2020 2020 2020 2020 2773 6d74              'smt
+00014ec0: 705f 6465 7461 696c 2720 3d3e 2027 4465  p_detail' => 'De
+00014ed0: 7461 696c 3a20 272c 0a20 2020 2020 2020  tail: ',.       
+00014ee0: 2020 2020 2027 736d 7470 5f65 7272 6f72       'smtp_error
+00014ef0: 2720 3d3e 2027 534d 5450 2073 6572 7665  ' => 'SMTP serve
+00014f00: 7220 6572 726f 723a 2027 2c0a 2020 2020  r error: ',.    
+00014f10: 2020 2020 2020 2020 2776 6172 6961 626c          'variabl
+00014f20: 655f 7365 7427 203d 3e20 2743 616e 6e6f  e_set' => 'Canno
+00014f30: 7420 7365 7420 6f72 2072 6573 6574 2076  t set or reset v
+00014f40: 6172 6961 626c 653a 2027 2c0a 2020 2020  ariable: ',.    
+00014f50: 2020 2020 5d3b 0a20 2020 2020 2020 2069      ];.        i
+00014f60: 6620 2865 6d70 7479 2824 6c61 6e67 5f70  f (empty($lang_p
+00014f70: 6174 6829 2920 7b0a 2020 2020 2020 2020  ath)) {.        
+00014f80: 2020 2020 2f2f 4361 6c63 756c 6174 6520      //Calculate 
+00014f90: 616e 2061 6273 6f6c 7574 6520 7061 7468  an absolute path
+00014fa0: 2073 6f20 6974 2063 616e 2077 6f72 6b20   so it can work 
+00014fb0: 6966 2043 5744 2069 7320 6e6f 7420 6865  if CWD is not he
+00014fc0: 7265 0a20 2020 2020 2020 2020 2020 2024  re.            $
+00014fd0: 6c61 6e67 5f70 6174 6820 3d20 6469 726e  lang_path = dirn
+00014fe0: 616d 6528 5f5f 4449 525f 5f29 202e 2044  ame(__DIR__) . D
+00014ff0: 4952 4543 544f 5259 5f53 4550 4152 4154  IRECTORY_SEPARAT
+00015000: 4f52 202e 2027 6c61 6e67 7561 6765 2720  OR . 'language' 
+00015010: 2e20 4449 5245 4354 4f52 595f 5345 5041  . DIRECTORY_SEPA
+00015020: 5241 544f 523b 0a20 2020 2020 2020 207d  RATOR;.        }
+00015030: 0a0a 2020 2020 2020 2020 2f2f 5661 6c69  ..        //Vali
+00015040: 6461 7465 2024 6c61 6e67 636f 6465 0a20  date $langcode. 
+00015050: 2020 2020 2020 2024 666f 756e 646c 616e         $foundlan
+00015060: 6720 3d20 7472 7565 3b0a 2020 2020 2020  g = true;.      
+00015070: 2020 246c 616e 6763 6f64 6520 203d 2073    $langcode  = s
+00015080: 7472 746f 6c6f 7765 7228 246c 616e 6763  trtolower($langc
+00015090: 6f64 6529 3b0a 2020 2020 2020 2020 6966  ode);.        if
+000150a0: 2028 0a20 2020 2020 2020 2020 2020 2021   (.            !
+000150b0: 7072 6567 5f6d 6174 6368 2827 2f5e 283f  preg_match('/^(?
+000150c0: 503c 6c61 6e67 3e5b 612d 7a5d 7b32 7d29  P<lang>[a-z]{2})
+000150d0: 283f 503c 7363 7269 7074 3e5f 5b61 2d7a  (?P<script>_[a-z
+000150e0: 5d7b 347d 293f 283f 503c 636f 756e 7472  ]{4})?(?P<countr
+000150f0: 793e 5f5b 612d 7a5d 7b32 7d29 3f24 2f27  y>_[a-z]{2})?$/'
+00015100: 2c20 246c 616e 6763 6f64 652c 2024 6d61  , $langcode, $ma
+00015110: 7463 6865 7329 0a20 2020 2020 2020 2020  tches).         
+00015120: 2020 2026 2620 246c 616e 6763 6f64 6520     && $langcode 
+00015130: 213d 3d20 2765 6e27 0a20 2020 2020 2020  !== 'en'.       
+00015140: 2029 207b 0a20 2020 2020 2020 2020 2020   ) {.           
+00015150: 2024 666f 756e 646c 616e 6720 3d20 6661   $foundlang = fa
+00015160: 6c73 653b 0a20 2020 2020 2020 2020 2020  lse;.           
+00015170: 2024 6c61 6e67 636f 6465 203d 2027 656e   $langcode = 'en
+00015180: 273b 0a20 2020 2020 2020 207d 0a0a 2020  ';.        }..  
+00015190: 2020 2020 2020 2f2f 5468 6572 6520 6973        //There is
+000151a0: 206e 6f20 456e 676c 6973 6820 7472 616e   no English tran
+000151b0: 736c 6174 696f 6e20 6669 6c65 0a20 2020  slation file.   
+000151c0: 2020 2020 2069 6620 2827 656e 2720 213d       if ('en' !=
+000151d0: 3d20 246c 616e 6763 6f64 6529 207b 0a20  = $langcode) {. 
+000151e0: 2020 2020 2020 2020 2020 2024 6c61 6e67             $lang
+000151f0: 636f 6465 7320 3d20 5b5d 3b0a 2020 2020  codes = [];.    
+00015200: 2020 2020 2020 2020 6966 2028 2165 6d70          if (!emp
+00015210: 7479 2824 6d61 7463 6865 735b 2773 6372  ty($matches['scr
+00015220: 6970 7427 5d29 2026 2620 2165 6d70 7479  ipt']) && !empty
+00015230: 2824 6d61 7463 6865 735b 2763 6f75 6e74  ($matches['count
+00015240: 7279 275d 2929 207b 0a20 2020 2020 2020  ry'])) {.       
+00015250: 2020 2020 2020 2020 2024 6c61 6e67 636f           $langco
+00015260: 6465 735b 5d20 3d20 246d 6174 6368 6573  des[] = $matches
+00015270: 5b27 6c61 6e67 275d 202e 2024 6d61 7463  ['lang'] . $matc
+00015280: 6865 735b 2773 6372 6970 7427 5d20 2e20  hes['script'] . 
+00015290: 246d 6174 6368 6573 5b27 636f 756e 7472  $matches['countr
+000152a0: 7927 5d3b 0a20 2020 2020 2020 2020 2020  y'];.           
+000152b0: 207d 0a20 2020 2020 2020 2020 2020 2069   }.            i
+000152c0: 6620 2821 656d 7074 7928 246d 6174 6368  f (!empty($match
+000152d0: 6573 5b27 636f 756e 7472 7927 5d29 2920  es['country'])) 
+000152e0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000152f0: 2020 246c 616e 6763 6f64 6573 5b5d 203d    $langcodes[] =
+00015300: 2024 6d61 7463 6865 735b 276c 616e 6727   $matches['lang'
+00015310: 5d20 2e20 246d 6174 6368 6573 5b27 636f  ] . $matches['co
+00015320: 756e 7472 7927 5d3b 0a20 2020 2020 2020  untry'];.       
+00015330: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00015340: 2020 2069 6620 2821 656d 7074 7928 246d     if (!empty($m
+00015350: 6174 6368 6573 5b27 7363 7269 7074 275d  atches['script']
+00015360: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00015370: 2020 2020 2024 6c61 6e67 636f 6465 735b       $langcodes[
+00015380: 5d20 3d20 246d 6174 6368 6573 5b27 6c61  ] = $matches['la
+00015390: 6e67 275d 202e 2024 6d61 7463 6865 735b  ng'] . $matches[
+000153a0: 2773 6372 6970 7427 5d3b 0a20 2020 2020  'script'];.     
+000153b0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000153c0: 2020 2020 2024 6c61 6e67 636f 6465 735b       $langcodes[
+000153d0: 5d20 3d20 246d 6174 6368 6573 5b27 6c61  ] = $matches['la
+000153e0: 6e67 275d 3b0a 0a20 2020 2020 2020 2020  ng'];..         
+000153f0: 2020 202f 2f54 7279 2061 6e64 2066 696e     //Try and fin
+00015400: 6420 6120 7265 6164 6162 6c65 206c 616e  d a readable lan
+00015410: 6775 6167 6520 6669 6c65 2066 6f72 2074  guage file for t
+00015420: 6865 2072 6571 7565 7374 6564 206c 616e  he requested lan
+00015430: 6775 6167 652e 0a20 2020 2020 2020 2020  guage..         
+00015440: 2020 2024 666f 756e 6446 696c 6520 3d20     $foundFile = 
+00015450: 6661 6c73 653b 0a20 2020 2020 2020 2020  false;.         
+00015460: 2020 2066 6f72 6561 6368 2028 246c 616e     foreach ($lan
+00015470: 6763 6f64 6573 2061 7320 2463 6f64 6529  gcodes as $code)
+00015480: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00015490: 2020 2024 6c61 6e67 5f66 696c 6520 3d20     $lang_file = 
+000154a0: 246c 616e 675f 7061 7468 202e 2027 7068  $lang_path . 'ph
+000154b0: 706d 6169 6c65 722e 6c61 6e67 2d27 202e  pmailer.lang-' .
+000154c0: 2024 636f 6465 202e 2027 2e70 6870 273b   $code . '.php';
+000154d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000154e0: 2069 6620 2873 7461 7469 633a 3a66 696c   if (static::fil
+000154f0: 6549 7341 6363 6573 7369 626c 6528 246c  eIsAccessible($l
+00015500: 616e 675f 6669 6c65 2929 207b 0a20 2020  ang_file)) {.   
+00015510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015520: 2024 666f 756e 6446 696c 6520 3d20 7472   $foundFile = tr
+00015530: 7565 3b0a 2020 2020 2020 2020 2020 2020  ue;.            
+00015540: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+00015550: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00015560: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
+00015570: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00015580: 2466 6f75 6e64 4669 6c65 203d 3d3d 2066  $foundFile === f
+00015590: 616c 7365 2920 7b0a 2020 2020 2020 2020  alse) {.        
+000155a0: 2020 2020 2020 2020 2466 6f75 6e64 6c61          $foundla
+000155b0: 6e67 203d 2066 616c 7365 3b0a 2020 2020  ng = false;.    
+000155c0: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
+000155d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000155e0: 2024 6c69 6e65 7320 3d20 6669 6c65 2824   $lines = file($
+000155f0: 6c61 6e67 5f66 696c 6529 3b0a 2020 2020  lang_file);.    
+00015600: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+00015610: 6163 6820 2824 6c69 6e65 7320 6173 2024  ach ($lines as $
+00015620: 6c69 6e65 2920 7b0a 2020 2020 2020 2020  line) {.        
+00015630: 2020 2020 2020 2020 2020 2020 2f2f 5472              //Tr
+00015640: 616e 736c 6174 696f 6e20 6669 6c65 206c  anslation file l
+00015650: 696e 6573 206c 6f6f 6b20 6c69 6b65 2074  ines look like t
+00015660: 6869 733a 0a20 2020 2020 2020 2020 2020  his:.           
+00015670: 2020 2020 2020 2020 202f 2f24 5048 504d           //$PHPM
+00015680: 4149 4c45 525f 4c41 4e47 5b27 6175 7468  AILER_LANG['auth
+00015690: 656e 7469 6361 7465 275d 203d 2027 534d  enticate'] = 'SM
+000156a0: 5450 2d46 6568 6c65 723a 2041 7574 6865  TP-Fehler: Authe
+000156b0: 6e74 6966 697a 6965 7275 6e67 2066 6568  ntifizierung feh
+000156c0: 6c67 6573 6368 6c61 6765 6e2e 273b 0a20  lgeschlagen.';. 
+000156d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156e0: 2020 202f 2f54 6865 7365 2066 696c 6573     //These files
+000156f0: 2061 7265 2070 6172 7365 6420 6173 2074   are parsed as t
+00015700: 6578 7420 616e 6420 6e6f 7420 5048 5020  ext and not PHP 
+00015710: 736f 2061 7320 746f 2061 766f 6964 2074  so as to avoid t
+00015720: 6865 2070 6f73 7369 6269 6c69 7479 206f  he possibility o
+00015730: 6620 636f 6465 2069 6e6a 6563 7469 6f6e  f code injection
+00015740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015750: 2020 2020 202f 2f53 6565 2068 7474 7073       //See https
+00015760: 3a2f 2f62 6c6f 672e 7374 6576 656e 6c65  ://blog.stevenle
+00015770: 7669 7468 616e 2e63 6f6d 2f61 7263 6869  vithan.com/archi
+00015780: 7665 732f 6d61 7463 682d 7175 6f74 6564  ves/match-quoted
+00015790: 2d73 7472 696e 670a 2020 2020 2020 2020  -string.        
+000157a0: 2020 2020 2020 2020 2020 2020 246d 6174              $mat
+000157b0: 6368 6573 203d 205b 5d3b 0a20 2020 2020  ches = [];.     
+000157c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000157d0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+000157e0: 2020 2020 2020 2020 2020 2020 7072 6567              preg
+000157f0: 5f6d 6174 6368 280a 2020 2020 2020 2020  _match(.        
+00015800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015810: 2020 2020 272f 5e5c 2450 4850 4d41 494c      '/^\$PHPMAIL
+00015820: 4552 5f4c 414e 475c 5b5c 2728 5b61 2d7a  ER_LANG\[\'([a-z
+00015830: 5c64 5f5d 2b29 5c27 5c5d 5c73 2a3d 5c73  \d_]+)\'\]\s*=\s
+00015840: 2a28 5b22 5c27 5d29 282e 2b29 2a3f 5c32  *(["\'])(.+)*?\2
+00015850: 3b2f 272c 0a20 2020 2020 2020 2020 2020  ;/',.           
+00015860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015870: 2024 6c69 6e65 2c0a 2020 2020 2020 2020   $line,.        
+00015880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015890: 2020 2020 246d 6174 6368 6573 0a20 2020      $matches.   
+000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158b0: 2020 2020 2029 2026 260a 2020 2020 2020       ) &&.      
+000158c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158d0: 2020 2f2f 4967 6e6f 7265 2075 6e6b 6e6f    //Ignore unkno
+000158e0: 776e 2074 7261 6e73 6c61 7469 6f6e 206b  wn translation k
+000158f0: 6579 730a 2020 2020 2020 2020 2020 2020  eys.            
+00015900: 2020 2020 2020 2020 2020 2020 6172 7261              arra
+00015910: 795f 6b65 795f 6578 6973 7473 2824 6d61  y_key_exists($ma
+00015920: 7463 6865 735b 315d 2c20 2450 4850 4d41  tches[1], $PHPMA
+00015930: 494c 4552 5f4c 414e 4729 0a20 2020 2020  ILER_LANG).     
+00015940: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00015950: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00015960: 2020 2020 2020 2020 2020 202f 2f4f 7665             //Ove
+00015970: 7277 7269 7465 206c 616e 6775 6167 652d  rwrite language-
+00015980: 7370 6563 6966 6963 2073 7472 696e 6773  specific strings
+00015990: 2073 6f20 7765 276c 6c20 6e65 7665 7220   so we'll never 
+000159a0: 6861 7665 206d 6973 7369 6e67 2074 7261  have missing tra
+000159b0: 6e73 6c61 7469 6f6e 206b 6579 732e 0a20  nslation keys.. 
+000159c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159d0: 2020 2020 2020 2024 5048 504d 4149 4c45         $PHPMAILE
+000159e0: 525f 4c41 4e47 5b24 6d61 7463 6865 735b  R_LANG[$matches[
+000159f0: 315d 5d20 3d20 2873 7472 696e 6729 246d  1]] = (string)$m
+00015a00: 6174 6368 6573 5b33 5d3b 0a20 2020 2020  atches[3];.     
+00015a10: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00015a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015a30: 207d 0a20 2020 2020 2020 2020 2020 207d   }.            }
+00015a40: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+00015a50: 2020 2024 7468 6973 2d3e 6c61 6e67 7561     $this->langua
+00015a60: 6765 203d 2024 5048 504d 4149 4c45 525f  ge = $PHPMAILER_
+00015a70: 4c41 4e47 3b0a 0a20 2020 2020 2020 2072  LANG;..        r
+00015a80: 6574 7572 6e20 2466 6f75 6e64 6c61 6e67  eturn $foundlang
+00015a90: 3b20 2f2f 5265 7475 726e 7320 6661 6c73  ; //Returns fals
+00015aa0: 6520 6966 206c 616e 6775 6167 6520 6e6f  e if language no
+00015ab0: 7420 666f 756e 640a 2020 2020 7d0a 0a20  t found.    }.. 
+00015ac0: 2020 202f 2a2a 0a20 2020 2020 2a20 4765     /**.     * Ge
+00015ad0: 7420 7468 6520 6172 7261 7920 6f66 2073  t the array of s
+00015ae0: 7472 696e 6773 2066 6f72 2074 6865 2063  trings for the c
+00015af0: 7572 7265 6e74 206c 616e 6775 6167 652e  urrent language.
+00015b00: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00015b10: 7265 7475 726e 2061 7272 6179 0a20 2020  return array.   
+00015b20: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00015b30: 6675 6e63 7469 6f6e 2067 6574 5472 616e  function getTran
+00015b40: 736c 6174 696f 6e73 2829 0a20 2020 207b  slations().    {
+00015b50: 0a20 2020 2020 2020 2069 6620 2865 6d70  .        if (emp
+00015b60: 7479 2824 7468 6973 2d3e 6c61 6e67 7561  ty($this->langua
+00015b70: 6765 2929 207b 0a20 2020 2020 2020 2020  ge)) {.         
+00015b80: 2020 2024 7468 6973 2d3e 7365 744c 616e     $this->setLan
+00015b90: 6775 6167 6528 293b 202f 2f20 5365 7420  guage(); // Set 
+00015ba0: 7468 6520 6465 6661 756c 7420 6c61 6e67  the default lang
+00015bb0: 7561 6765 2e0a 2020 2020 2020 2020 7d0a  uage..        }.
+00015bc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015bd0: 2474 6869 732d 3e6c 616e 6775 6167 653b  $this->language;
+00015be0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+00015bf0: 2020 2020 202a 2043 7265 6174 6520 7265       * Create re
+00015c00: 6369 7069 656e 7420 6865 6164 6572 732e  cipient headers.
+00015c10: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00015c20: 7061 7261 6d20 7374 7269 6e67 2024 7479  param string $ty
+00015c30: 7065 0a20 2020 2020 2a20 4070 6172 616d  pe.     * @param
+00015c40: 2061 7272 6179 2020 2461 6464 7220 416e   array  $addr An
+00015c50: 2061 7272 6179 206f 6620 7265 6369 7069   array of recipi
+00015c60: 656e 7473 2c0a 2020 2020 202a 2020 2020  ents,.     *    
+00015c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c80: 2077 6865 7265 2065 6163 6820 7265 6369   where each reci
+00015c90: 7069 656e 7420 6973 2061 2032 2d65 6c65  pient is a 2-ele
+00015ca0: 6d65 6e74 2069 6e64 6578 6564 2061 7272  ment indexed arr
+00015cb0: 6179 2077 6974 6820 656c 656d 656e 7420  ay with element 
+00015cc0: 3020 636f 6e74 6169 6e69 6e67 2061 6e20  0 containing an 
+00015cd0: 6164 6472 6573 730a 2020 2020 202a 2020  address.     *  
+00015ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015cf0: 2020 2061 6e64 2065 6c65 6d65 6e74 2031     and element 1
+00015d00: 2063 6f6e 7461 696e 696e 6720 6120 6e61   containing a na
+00015d10: 6d65 2c20 6c69 6b65 3a0a 2020 2020 202a  me, like:.     *
+00015d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d30: 2020 2020 205b 5b27 6a6f 6540 6578 616d       [['joe@exam
+00015d40: 706c 652e 636f 6d27 2c20 274a 6f65 2055  ple.com', 'Joe U
+00015d50: 7365 7227 5d2c 205b 277a 6f65 4065 7861  ser'], ['zoe@exa
+00015d60: 6d70 6c65 2e63 6f6d 272c 2027 5a6f 6520  mple.com', 'Zoe 
+00015d70: 5573 6572 275d 5d0a 2020 2020 202a 0a20  User']].     *. 
+00015d80: 2020 2020 2a20 4072 6574 7572 6e20 7374      * @return st
+00015d90: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
+00015da0: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+00015db0: 2061 6464 7241 7070 656e 6428 2474 7970   addrAppend($typ
+00015dc0: 652c 2024 6164 6472 290a 2020 2020 7b0a  e, $addr).    {.
+00015dd0: 2020 2020 2020 2020 2461 6464 7265 7373          $address
+00015de0: 6573 203d 205b 5d3b 0a20 2020 2020 2020  es = [];.       
+00015df0: 2066 6f72 6561 6368 2028 2461 6464 7220   foreach ($addr 
+00015e00: 6173 2024 6164 6472 6573 7329 207b 0a20  as $address) {. 
+00015e10: 2020 2020 2020 2020 2020 2024 6164 6472             $addr
+00015e20: 6573 7365 735b 5d20 3d20 2474 6869 732d  esses[] = $this-
+00015e30: 3e61 6464 7246 6f72 6d61 7428 2461 6464  >addrFormat($add
+00015e40: 7265 7373 293b 0a20 2020 2020 2020 207d  ress);.        }
+00015e50: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015e60: 2024 7479 7065 202e 2027 3a20 2720 2e20   $type . ': ' . 
+00015e70: 696d 706c 6f64 6528 272c 2027 2c20 2461  implode(', ', $a
+00015e80: 6464 7265 7373 6573 2920 2e20 7374 6174  ddresses) . stat
+00015e90: 6963 3a3a 244c 453b 0a20 2020 207d 0a0a  ic::$LE;.    }..
+00015ea0: 2020 2020 2f2a 2a0a 2020 2020 202a 2046      /**.     * F
+00015eb0: 6f72 6d61 7420 616e 2061 6464 7265 7373  ormat an address
+00015ec0: 2066 6f72 2075 7365 2069 6e20 6120 6d65   for use in a me
+00015ed0: 7373 6167 6520 6865 6164 6572 2e0a 2020  ssage header..  
+00015ee0: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
+00015ef0: 616d 2061 7272 6179 2024 6164 6472 2041  am array $addr A
+00015f00: 2032 2d65 6c65 6d65 6e74 2069 6e64 6578   2-element index
+00015f10: 6564 2061 7272 6179 2c20 656c 656d 656e  ed array, elemen
+00015f20: 7420 3020 636f 6e74 6169 6e69 6e67 2061  t 0 containing a
+00015f30: 6e20 6164 6472 6573 732c 2065 6c65 6d65  n address, eleme
+00015f40: 6e74 2031 2063 6f6e 7461 696e 696e 6720  nt 1 containing 
+00015f50: 6120 6e61 6d65 206c 696b 650a 2020 2020  a name like.    
+00015f60: 202a 2020 2020 2020 2020 2020 2020 2020   *              
+00015f70: 2020 2020 2020 5b27 6a6f 6540 6578 616d        ['joe@exam
+00015f80: 706c 652e 636f 6d27 2c20 274a 6f65 2055  ple.com', 'Joe U
+00015f90: 7365 7227 5d0a 2020 2020 202a 0a20 2020  ser'].     *.   
+00015fa0: 2020 2a20 4072 6574 7572 6e20 7374 7269    * @return stri
+00015fb0: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+00015fc0: 7562 6c69 6320 6675 6e63 7469 6f6e 2061  ublic function a
+00015fd0: 6464 7246 6f72 6d61 7428 2461 6464 7229  ddrFormat($addr)
+00015fe0: 0a20 2020 207b 0a20 2020 2020 2020 2069  .    {.        i
+00015ff0: 6620 2821 6973 7365 7428 2461 6464 725b  f (!isset($addr[
+00016000: 315d 2920 7c7c 2028 2461 6464 725b 315d  1]) || ($addr[1]
+00016010: 203d 3d3d 2027 2729 2920 7b20 2f2f 4e6f   === '')) { //No
+00016020: 206e 616d 6520 7072 6f76 6964 6564 0a20   name provided. 
+00016030: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016040: 6e20 2474 6869 732d 3e73 6563 7572 6548  n $this->secureH
+00016050: 6561 6465 7228 2461 6464 725b 305d 293b  eader($addr[0]);
+00016060: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00016070: 2020 2020 7265 7475 726e 2024 7468 6973      return $this
+00016080: 2d3e 656e 636f 6465 4865 6164 6572 2824  ->encodeHeader($
+00016090: 7468 6973 2d3e 7365 6375 7265 4865 6164  this->secureHead
+000160a0: 6572 2824 6164 6472 5b31 5d29 2c20 2770  er($addr[1]), 'p
+000160b0: 6872 6173 6527 2920 2e0a 2020 2020 2020  hrase') ..      
+000160c0: 2020 2020 2020 2720 3c27 202e 2024 7468        ' <' . $th
+000160d0: 6973 2d3e 7365 6375 7265 4865 6164 6572  is->secureHeader
+000160e0: 2824 6164 6472 5b30 5d29 202e 2027 3e27  ($addr[0]) . '>'
+000160f0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+00016100: 0a20 2020 2020 2a20 576f 7264 2d77 7261  .     * Word-wra
+00016110: 7020 6d65 7373 6167 652e 0a20 2020 2020  p message..     
+00016120: 2a20 466f 7220 7573 6520 7769 7468 206d  * For use with m
+00016130: 6169 6c65 7273 2074 6861 7420 646f 206e  ailers that do n
+00016140: 6f74 2061 7574 6f6d 6174 6963 616c 6c79  ot automatically
+00016150: 2070 6572 666f 726d 2077 7261 7070 696e   perform wrappin
+00016160: 670a 2020 2020 202a 2061 6e64 2066 6f72  g.     * and for
+00016170: 2071 756f 7465 642d 7072 696e 7461 626c   quoted-printabl
+00016180: 6520 656e 636f 6465 6420 6d65 7373 6167  e encoded messag
+00016190: 6573 2e0a 2020 2020 202a 204f 7269 6769  es..     * Origi
+000161a0: 6e61 6c20 7772 6974 7465 6e20 6279 2070  nal written by p
+000161b0: 6869 6c69 7070 652e 0a20 2020 2020 2a0a  hilippe..     *.
+000161c0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+000161d0: 7269 6e67 2024 6d65 7373 6167 6520 5468  ring $message Th
+000161e0: 6520 6d65 7373 6167 6520 746f 2077 7261  e message to wra
+000161f0: 700a 2020 2020 202a 2040 7061 7261 6d20  p.     * @param 
+00016200: 696e 7420 2020 2024 6c65 6e67 7468 2020  int    $length  
+00016210: 5468 6520 6c69 6e65 206c 656e 6774 6820  The line length 
+00016220: 746f 2077 7261 7020 746f 0a20 2020 2020  to wrap to.     
+00016230: 2a20 4070 6172 616d 2062 6f6f 6c20 2020  * @param bool   
+00016240: 2471 705f 6d6f 6465 2057 6865 7468 6572  $qp_mode Whether
+00016250: 2074 6f20 7275 6e20 696e 2051 756f 7465   to run in Quote
+00016260: 642d 5072 696e 7461 626c 6520 6d6f 6465  d-Printable mode
+00016270: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00016280: 7265 7475 726e 2073 7472 696e 670a 2020  return string.  
+00016290: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+000162a0: 2066 756e 6374 696f 6e20 7772 6170 5465   function wrapTe
+000162b0: 7874 2824 6d65 7373 6167 652c 2024 6c65  xt($message, $le
+000162c0: 6e67 7468 2c20 2471 705f 6d6f 6465 203d  ngth, $qp_mode =
+000162d0: 2066 616c 7365 290a 2020 2020 7b0a 2020   false).    {.  
+000162e0: 2020 2020 2020 6966 2028 2471 705f 6d6f        if ($qp_mo
+000162f0: 6465 2920 7b0a 2020 2020 2020 2020 2020  de) {.          
+00016300: 2020 2473 6f66 745f 6272 6561 6b20 3d20    $soft_break = 
+00016310: 7370 7269 6e74 6628 2720 3d25 7327 2c20  sprintf(' =%s', 
+00016320: 7374 6174 6963 3a3a 244c 4529 3b0a 2020  static::$LE);.  
+00016330: 2020 2020 2020 7d20 656c 7365 207b 0a20        } else {. 
+00016340: 2020 2020 2020 2020 2020 2024 736f 6674             $soft
+00016350: 5f62 7265 616b 203d 2073 7461 7469 633a  _break = static:
+00016360: 3a24 4c45 3b0a 2020 2020 2020 2020 7d0a  :$LE;.        }.
+00016370: 2020 2020 2020 2020 2f2f 4966 2075 7466          //If utf
+00016380: 2d38 2065 6e63 6f64 696e 6720 6973 2075  -8 encoding is u
+00016390: 7365 642c 2077 6520 7769 6c6c 206e 6565  sed, we will nee
+000163a0: 6420 746f 206d 616b 6520 7375 7265 2077  d to make sure w
+000163b0: 6520 646f 6e27 740a 2020 2020 2020 2020  e don't.        
+000163c0: 2f2f 7370 6c69 7420 6d75 6c74 6962 7974  //split multibyt
+000163d0: 6520 6368 6172 6163 7465 7273 2077 6865  e characters whe
+000163e0: 6e20 7765 2077 7261 700a 2020 2020 2020  n we wrap.      
+000163f0: 2020 2469 735f 7574 6638 203d 2073 7461    $is_utf8 = sta
+00016400: 7469 633a 3a43 4841 5253 4554 5f55 5446  tic::CHARSET_UTF
+00016410: 3820 3d3d 3d20 7374 7274 6f6c 6f77 6572  8 === strtolower
+00016420: 2824 7468 6973 2d3e 4368 6172 5365 7429  ($this->CharSet)
+00016430: 3b0a 2020 2020 2020 2020 246c 656c 656e  ;.        $lelen
+00016440: 203d 2073 7472 6c65 6e28 7374 6174 6963   = strlen(static
+00016450: 3a3a 244c 4529 3b0a 2020 2020 2020 2020  ::$LE);.        
+00016460: 2463 726c 666c 656e 203d 2073 7472 6c65  $crlflen = strle
+00016470: 6e28 7374 6174 6963 3a3a 244c 4529 3b0a  n(static::$LE);.
+00016480: 0a20 2020 2020 2020 2024 6d65 7373 6167  .        $messag
+00016490: 6520 3d20 7374 6174 6963 3a3a 6e6f 726d  e = static::norm
+000164a0: 616c 697a 6542 7265 616b 7328 246d 6573  alizeBreaks($mes
+000164b0: 7361 6765 293b 0a20 2020 2020 2020 202f  sage);.        /
+000164c0: 2f52 656d 6f76 6520 6120 7472 6169 6c69  /Remove a traili
+000164d0: 6e67 206c 696e 6520 6272 6561 6b0a 2020  ng line break.  
+000164e0: 2020 2020 2020 6966 2028 7375 6273 7472        if (substr
+000164f0: 2824 6d65 7373 6167 652c 202d 246c 656c  ($message, -$lel
+00016500: 656e 2920 3d3d 3d20 7374 6174 6963 3a3a  en) === static::
+00016510: 244c 4529 207b 0a20 2020 2020 2020 2020  $LE) {.         
+00016520: 2020 2024 6d65 7373 6167 6520 3d20 7375     $message = su
+00016530: 6273 7472 2824 6d65 7373 6167 652c 2030  bstr($message, 0
+00016540: 2c20 2d24 6c65 6c65 6e29 3b0a 2020 2020  , -$lelen);.    
+00016550: 2020 2020 7d0a 0a20 2020 2020 2020 202f      }..        /
+00016560: 2f53 706c 6974 206d 6573 7361 6765 2069  /Split message i
+00016570: 6e74 6f20 6c69 6e65 730a 2020 2020 2020  nto lines.      
+00016580: 2020 246c 696e 6573 203d 2065 7870 6c6f    $lines = explo
+00016590: 6465 2873 7461 7469 633a 3a24 4c45 2c20  de(static::$LE, 
+000165a0: 246d 6573 7361 6765 293b 0a20 2020 2020  $message);.     
+000165b0: 2020 202f 2f4d 6573 7361 6765 2077 696c     //Message wil
+000165c0: 6c20 6265 2072 6562 7569 6c74 2069 6e20  l be rebuilt in 
+000165d0: 6865 7265 0a20 2020 2020 2020 2024 6d65  here.        $me
+000165e0: 7373 6167 6520 3d20 2727 3b0a 2020 2020  ssage = '';.    
+000165f0: 2020 2020 666f 7265 6163 6820 2824 6c69      foreach ($li
+00016600: 6e65 7320 6173 2024 6c69 6e65 2920 7b0a  nes as $line) {.
+00016610: 2020 2020 2020 2020 2020 2020 2477 6f72              $wor
+00016620: 6473 203d 2065 7870 6c6f 6465 2827 2027  ds = explode(' '
+00016630: 2c20 246c 696e 6529 3b0a 2020 2020 2020  , $line);.      
+00016640: 2020 2020 2020 2462 7566 203d 2027 273b        $buf = '';
+00016650: 0a20 2020 2020 2020 2020 2020 2024 6669  .            $fi
+00016660: 7273 7477 6f72 6420 3d20 7472 7565 3b0a  rstword = true;.
+00016670: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+00016680: 6163 6820 2824 776f 7264 7320 6173 2024  ach ($words as $
+00016690: 776f 7264 2920 7b0a 2020 2020 2020 2020  word) {.        
+000166a0: 2020 2020 2020 2020 6966 2028 2471 705f          if ($qp_
+000166b0: 6d6f 6465 2026 2620 2873 7472 6c65 6e28  mode && (strlen(
+000166c0: 2477 6f72 6429 203e 2024 6c65 6e67 7468  $word) > $length
+000166d0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+000166e0: 2020 2020 2020 2020 2024 7370 6163 655f           $space_
+000166f0: 6c65 6674 203d 2024 6c65 6e67 7468 202d  left = $length -
+00016700: 2073 7472 6c65 6e28 2462 7566 2920 2d20   strlen($buf) - 
+00016710: 2463 726c 666c 656e 3b0a 2020 2020 2020  $crlflen;.      
+00016720: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016730: 2028 2124 6669 7273 7477 6f72 6429 207b   (!$firstword) {
+00016740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016750: 2020 2020 2020 2020 2069 6620 2824 7370           if ($sp
+00016760: 6163 655f 6c65 6674 203e 2032 3029 207b  ace_left > 20) {
+00016770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016780: 2020 2020 2020 2020 2020 2020 2024 6c65               $le
+00016790: 6e20 3d20 2473 7061 6365 5f6c 6566 743b  n = $space_left;
+000167a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000167b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000167c0: 2824 6973 5f75 7466 3829 207b 0a20 2020  ($is_utf8) {.   
+000167d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167e0: 2020 2020 2020 2020 2020 2020 2024 6c65               $le
+000167f0: 6e20 3d20 2474 6869 732d 3e75 7466 3843  n = $this->utf8C
+00016800: 6861 7242 6f75 6e64 6172 7928 2477 6f72  harBoundary($wor
+00016810: 642c 2024 6c65 6e29 3b0a 2020 2020 2020  d, $len);.      
+00016820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016830: 2020 2020 2020 7d20 656c 7365 6966 2028        } elseif (
+00016840: 273d 2720 3d3d 3d20 7375 6273 7472 2824  '=' === substr($
+00016850: 776f 7264 2c20 246c 656e 202d 2031 2c20  word, $len - 1, 
+00016860: 3129 2920 7b0a 2020 2020 2020 2020 2020  1)) {.          
+00016870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016880: 2020 2020 2020 2d2d 246c 656e 3b0a 2020        --$len;.  
+00016890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168a0: 2020 2020 2020 2020 2020 7d20 656c 7365            } else
+000168b0: 6966 2028 273d 2720 3d3d 3d20 7375 6273  if ('=' === subs
+000168c0: 7472 2824 776f 7264 2c20 246c 656e 202d  tr($word, $len -
+000168d0: 2032 2c20 3129 2920 7b0a 2020 2020 2020   2, 1)) {.      
+000168e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168f0: 2020 2020 2020 2020 2020 246c 656e 202d            $len -
+00016900: 3d20 323b 0a20 2020 2020 2020 2020 2020  = 2;.           
+00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016920: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00016930: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00016940: 7061 7274 203d 2073 7562 7374 7228 2477  part = substr($w
+00016950: 6f72 642c 2030 2c20 246c 656e 293b 0a20  ord, 0, $len);. 
+00016960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016970: 2020 2020 2020 2020 2020 2024 776f 7264             $word
+00016980: 203d 2073 7562 7374 7228 2477 6f72 642c   = substr($word,
+00016990: 2024 6c65 6e29 3b0a 2020 2020 2020 2020   $len);.        
+000169a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169b0: 2020 2020 2462 7566 202e 3d20 2720 2720      $buf .= ' ' 
+000169c0: 2e20 2470 6172 743b 0a20 2020 2020 2020  . $part;.       
+000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169e0: 2020 2020 2024 6d65 7373 6167 6520 2e3d       $message .=
+000169f0: 2024 6275 6620 2e20 7370 7269 6e74 6628   $buf . sprintf(
+00016a00: 273d 2573 272c 2073 7461 7469 633a 3a24  '=%s', static::$
+00016a10: 4c45 293b 0a20 2020 2020 2020 2020 2020  LE);.           
+00016a20: 2020 2020 2020 2020 2020 2020 207d 2065               } e
+00016a30: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
+00016a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a50: 2020 246d 6573 7361 6765 202e 3d20 2462    $message .= $b
+00016a60: 7566 202e 2024 736f 6674 5f62 7265 616b  uf . $soft_break
+00016a70: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00016a80: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00016a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016aa0: 2020 2020 2462 7566 203d 2027 273b 0a20      $buf = '';. 
+00016ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ac0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00016ad0: 2020 2020 2020 2020 2077 6869 6c65 2028           while (
+00016ae0: 2477 6f72 6420 213d 3d20 2727 2920 7b0a  $word !== '') {.
+00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b00: 2020 2020 2020 2020 6966 2028 246c 656e          if ($len
+00016b10: 6774 6820 3c3d 2030 2920 7b0a 2020 2020  gth <= 0) {.    
+00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b30: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b50: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b70: 2024 6c65 6e20 3d20 246c 656e 6774 683b   $len = $length;
+00016b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b90: 2020 2020 2020 2020 2069 6620 2824 6973           if ($is
+00016ba0: 5f75 7466 3829 207b 0a20 2020 2020 2020  _utf8) {.       
+00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bc0: 2020 2020 2024 6c65 6e20 3d20 2474 6869       $len = $thi
+00016bd0: 732d 3e75 7466 3843 6861 7242 6f75 6e64  s->utf8CharBound
+00016be0: 6172 7928 2477 6f72 642c 2024 6c65 6e29  ary($word, $len)
+00016bf0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00016c00: 2020 2020 2020 2020 2020 7d20 656c 7365            } else
+00016c10: 6966 2028 273d 2720 3d3d 3d20 7375 6273  if ('=' === subs
+00016c20: 7472 2824 776f 7264 2c20 246c 656e 202d  tr($word, $len -
+00016c30: 2031 2c20 3129 2920 7b0a 2020 2020 2020   1, 1)) {.      
+00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c50: 2020 2020 2020 2d2d 246c 656e 3b0a 2020        --$len;.  
+00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c70: 2020 2020 2020 7d20 656c 7365 6966 2028        } elseif (
+00016c80: 273d 2720 3d3d 3d20 7375 6273 7472 2824  '=' === substr($
+00016c90: 776f 7264 2c20 246c 656e 202d 2032 2c20  word, $len - 2, 
+00016ca0: 3129 2920 7b0a 2020 2020 2020 2020 2020  1)) {.          
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cc0: 2020 246c 656e 202d 3d20 323b 0a20 2020    $len -= 2;.   
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ce0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00016cf0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00016d00: 7061 7274 203d 2073 7562 7374 7228 2477  part = substr($w
+00016d10: 6f72 642c 2030 2c20 246c 656e 293b 0a20  ord, 0, $len);. 
+00016d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d30: 2020 2020 2020 2024 776f 7264 203d 2028         $word = (
+00016d40: 7374 7269 6e67 2920 7375 6273 7472 2824  string) substr($
+00016d50: 776f 7264 2c20 246c 656e 293b 0a0a 2020  word, $len);..  
+00016d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d70: 2020 2020 2020 6966 2028 2477 6f72 6420        if ($word 
+00016d80: 213d 3d20 2727 2920 7b0a 2020 2020 2020  !== '') {.      
+00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016da0: 2020 2020 2020 246d 6573 7361 6765 202e        $message .
+00016db0: 3d20 2470 6172 7420 2e20 7370 7269 6e74  = $part . sprint
+00016dc0: 6628 273d 2573 272c 2073 7461 7469 633a  f('=%s', static:
+00016dd0: 3a24 4c45 293b 0a20 2020 2020 2020 2020  :$LE);.         
+00016de0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00016df0: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
+00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e10: 2020 2020 2462 7566 203d 2024 7061 7274      $buf = $part
+00016e20: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00016e30: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e50: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00016e60: 2020 7d20 656c 7365 207b 0a20 2020 2020    } else {.     
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00016e80: 6275 665f 6f20 3d20 2462 7566 3b0a 2020  buf_o = $buf;.  
+00016e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ea0: 2020 6966 2028 2124 6669 7273 7477 6f72    if (!$firstwor
+00016eb0: 6429 207b 0a20 2020 2020 2020 2020 2020  d) {.           
+00016ec0: 2020 2020 2020 2020 2020 2020 2024 6275               $bu
+00016ed0: 6620 2e3d 2027 2027 3b0a 2020 2020 2020  f .= ' ';.      
+00016ee0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f00: 2020 2020 2462 7566 202e 3d20 2477 6f72      $buf .= $wor
+00016f10: 643b 0a0a 2020 2020 2020 2020 2020 2020  d;..            
+00016f20: 2020 2020 2020 2020 6966 2028 2727 2021          if ('' !
+00016f30: 3d3d 2024 6275 665f 6f20 2626 2073 7472  == $buf_o && str
+00016f40: 6c65 6e28 2462 7566 2920 3e20 246c 656e  len($buf) > $len
+00016f50: 6774 6829 207b 0a20 2020 2020 2020 2020  gth) {.         
+00016f60: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00016f70: 6d65 7373 6167 6520 2e3d 2024 6275 665f  message .= $buf_
+00016f80: 6f20 2e20 2473 6f66 745f 6272 6561 6b3b  o . $soft_break;
+00016f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016fa0: 2020 2020 2020 2020 2024 6275 6620 3d20           $buf = 
+00016fb0: 2477 6f72 643b 0a20 2020 2020 2020 2020  $word;.         
+00016fc0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00016fd0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00016ff0: 6669 7273 7477 6f72 6420 3d20 6661 6c73  firstword = fals
+00017000: 653b 0a20 2020 2020 2020 2020 2020 207d  e;.            }
+00017010: 0a20 2020 2020 2020 2020 2020 2024 6d65  .            $me
+00017020: 7373 6167 6520 2e3d 2024 6275 6620 2e20  ssage .= $buf . 
+00017030: 7374 6174 6963 3a3a 244c 453b 0a20 2020  static::$LE;.   
+00017040: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00017050: 7265 7475 726e 2024 6d65 7373 6167 653b  return $message;
+00017060: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+00017070: 2020 2020 202a 2046 696e 6420 7468 6520       * Find the 
+00017080: 6c61 7374 2063 6861 7261 6374 6572 2062  last character b
+00017090: 6f75 6e64 6172 7920 7072 696f 7220 746f  oundary prior to
+000170a0: 2024 6d61 784c 656e 6774 6820 696e 2061   $maxLength in a
+000170b0: 2075 7466 2d38 0a20 2020 2020 2a20 7175   utf-8.     * qu
+000170c0: 6f74 6564 2d70 7269 6e74 6162 6c65 2065  oted-printable e
+000170d0: 6e63 6f64 6564 2073 7472 696e 672e 0a20  ncoded string.. 
+000170e0: 2020 2020 2a20 4f72 6967 696e 616c 2077      * Original w
+000170f0: 7269 7474 656e 2062 7920 436f 6c69 6e20  ritten by Colin 
+00017100: 4272 6f77 6e2e 0a20 2020 2020 2a0a 2020  Brown..     *.  
+00017110: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00017120: 6e67 2024 656e 636f 6465 6454 6578 7420  ng $encodedText 
+00017130: 7574 662d 3820 5150 2074 6578 740a 2020  utf-8 QP text.  
+00017140: 2020 202a 2040 7061 7261 6d20 696e 7420     * @param int 
+00017150: 2020 2024 6d61 784c 656e 6774 6820 2020     $maxLength   
+00017160: 4669 6e64 2074 6865 206c 6173 7420 6368  Find the last ch
+00017170: 6172 6163 7465 7220 626f 756e 6461 7279  aracter boundary
+00017180: 2070 7269 6f72 2074 6f20 7468 6973 206c   prior to this l
+00017190: 656e 6774 680a 2020 2020 202a 0a20 2020  ength.     *.   
+000171a0: 2020 2a20 4072 6574 7572 6e20 696e 740a    * @return int.
+000171b0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+000171c0: 6963 2066 756e 6374 696f 6e20 7574 6638  ic function utf8
+000171d0: 4368 6172 426f 756e 6461 7279 2824 656e  CharBoundary($en
+000171e0: 636f 6465 6454 6578 742c 2024 6d61 784c  codedText, $maxL
+000171f0: 656e 6774 6829 0a20 2020 207b 0a20 2020  ength).    {.   
+00017200: 2020 2020 2024 666f 756e 6453 706c 6974       $foundSplit
+00017210: 506f 7320 3d20 6661 6c73 653b 0a20 2020  Pos = false;.   
+00017220: 2020 2020 2024 6c6f 6f6b 4261 636b 203d       $lookBack =
+00017230: 2033 3b0a 2020 2020 2020 2020 7768 696c   3;.        whil
+00017240: 6520 2821 2466 6f75 6e64 5370 6c69 7450  e (!$foundSplitP
+00017250: 6f73 2920 7b0a 2020 2020 2020 2020 2020  os) {.          
+00017260: 2020 246c 6173 7443 6875 6e6b 203d 2073    $lastChunk = s
+00017270: 7562 7374 7228 2465 6e63 6f64 6564 5465  ubstr($encodedTe
+00017280: 7874 2c20 246d 6178 4c65 6e67 7468 202d  xt, $maxLength -
+00017290: 2024 6c6f 6f6b 4261 636b 2c20 246c 6f6f   $lookBack, $loo
+000172a0: 6b42 6163 6b29 3b0a 2020 2020 2020 2020  kBack);.        
+000172b0: 2020 2020 2465 6e63 6f64 6564 4368 6172      $encodedChar
+000172c0: 506f 7320 3d20 7374 7270 6f73 2824 6c61  Pos = strpos($la
+000172d0: 7374 4368 756e 6b2c 2027 3d27 293b 0a20  stChunk, '=');. 
+000172e0: 2020 2020 2020 2020 2020 2069 6620 2866             if (f
+000172f0: 616c 7365 2021 3d3d 2024 656e 636f 6465  alse !== $encode
+00017300: 6443 6861 7250 6f73 2920 7b0a 2020 2020  dCharPos) {.    
+00017310: 2020 2020 2020 2020 2020 2020 2f2f 466f              //Fo
+00017320: 756e 6420 7374 6172 7420 6f66 2065 6e63  und start of enc
+00017330: 6f64 6564 2063 6861 7261 6374 6572 2062  oded character b
+00017340: 7974 6520 7769 7468 696e 2024 6c6f 6f6b  yte within $look
+00017350: 4261 636b 2062 6c6f 636b 2e0a 2020 2020  Back block..    
+00017360: 2020 2020 2020 2020 2020 2020 2f2f 4368              //Ch
+00017370: 6563 6b20 7468 6520 656e 636f 6465 6420  eck the encoded 
+00017380: 6279 7465 2076 616c 7565 2028 7468 6520  byte value (the 
+00017390: 3220 6368 6172 7320 6166 7465 7220 7468  2 chars after th
+000173a0: 6520 273d 2729 0a20 2020 2020 2020 2020  e '=').         
+000173b0: 2020 2020 2020 2024 6865 7820 3d20 7375         $hex = su
+000173c0: 6273 7472 2824 656e 636f 6465 6454 6578  bstr($encodedTex
+000173d0: 742c 2024 6d61 784c 656e 6774 6820 2d20  t, $maxLength - 
+000173e0: 246c 6f6f 6b42 6163 6b20 2b20 2465 6e63  $lookBack + $enc
+000173f0: 6f64 6564 4368 6172 506f 7320 2b20 312c  odedCharPos + 1,
+00017400: 2032 293b 0a20 2020 2020 2020 2020 2020   2);.           
+00017410: 2020 2020 2024 6465 6320 3d20 6865 7864       $dec = hexd
+00017420: 6563 2824 6865 7829 3b0a 2020 2020 2020  ec($hex);.      
+00017430: 2020 2020 2020 2020 2020 6966 2028 2464            if ($d
+00017440: 6563 203c 2031 3238 2920 7b0a 2020 2020  ec < 128) {.    
+00017450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017460: 2f2f 5369 6e67 6c65 2062 7974 6520 6368  //Single byte ch
+00017470: 6172 6163 7465 722e 0a20 2020 2020 2020  aracter..       
+00017480: 2020 2020 2020 2020 2020 2020 202f 2f49               //I
+00017490: 6620 7468 6520 656e 636f 6465 6420 6368  f the encoded ch
+000174a0: 6172 2077 6173 2066 6f75 6e64 2061 7420  ar was found at 
+000174b0: 706f 7320 302c 2069 7420 7769 6c6c 2066  pos 0, it will f
+000174c0: 6974 0a20 2020 2020 2020 2020 2020 2020  it.             
+000174d0: 2020 2020 2020 202f 2f6f 7468 6572 7769         //otherwi
+000174e0: 7365 2072 6564 7563 6520 6d61 784c 656e  se reduce maxLen
+000174f0: 6774 6820 746f 2073 7461 7274 206f 6620  gth to start of 
+00017500: 7468 6520 656e 636f 6465 6420 6368 6172  the encoded char
+00017510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017520: 2020 2020 2069 6620 2824 656e 636f 6465       if ($encode
+00017530: 6443 6861 7250 6f73 203e 2030 2920 7b0a  dCharPos > 0) {.
+00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017550: 2020 2020 2020 2020 246d 6178 4c65 6e67          $maxLeng
+00017560: 7468 202d 3d20 246c 6f6f 6b42 6163 6b20  th -= $lookBack 
+00017570: 2d20 2465 6e63 6f64 6564 4368 6172 506f  - $encodedCharPo
+00017580: 733b 0a20 2020 2020 2020 2020 2020 2020  s;.             
+00017590: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000175a0: 2020 2020 2020 2020 2020 2020 2024 666f               $fo
+000175b0: 756e 6453 706c 6974 506f 7320 3d20 7472  undSplitPos = tr
+000175c0: 7565 3b0a 2020 2020 2020 2020 2020 2020  ue;.            
+000175d0: 2020 2020 7d20 656c 7365 6966 2028 2464      } elseif ($d
+000175e0: 6563 203e 3d20 3139 3229 207b 0a20 2020  ec >= 192) {.   
 000175f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017600: 2020 2474 6869 732d 3e53 696e 676c 6554    $this->SingleT
-00017610: 6f41 7272 6179 5b5d 203d 2024 7468 6973  oArray[] = $this
-00017620: 2d3e 6164 6472 466f 726d 6174 2824 746f  ->addrFormat($to
-00017630: 6164 6472 293b 0a20 2020 2020 2020 2020  addr);.         
-00017640: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00017650: 2020 2020 207d 2065 6c73 6569 6620 2863       } elseif (c
-00017660: 6f75 6e74 2824 7468 6973 2d3e 746f 2920  ount($this->to) 
-00017670: 3e20 3029 207b 0a20 2020 2020 2020 2020  > 0) {.         
-00017680: 2020 2020 2020 2024 7265 7375 6c74 202e         $result .
-00017690: 3d20 2474 6869 732d 3e61 6464 7241 7070  = $this->addrApp
-000176a0: 656e 6428 2754 6f27 2c20 2474 6869 732d  end('To', $this-
-000176b0: 3e74 6f29 3b0a 2020 2020 2020 2020 2020  >to);.          
-000176c0: 2020 7d20 656c 7365 6966 2028 636f 756e    } elseif (coun
-000176d0: 7428 2474 6869 732d 3e63 6329 203d 3d3d  t($this->cc) ===
-000176e0: 2030 2920 7b0a 2020 2020 2020 2020 2020   0) {.          
-000176f0: 2020 2020 2020 2472 6573 756c 7420 2e3d        $result .=
-00017700: 2024 7468 6973 2d3e 6865 6164 6572 4c69   $this->headerLi
-00017710: 6e65 2827 546f 272c 2027 756e 6469 7363  ne('To', 'undisc
-00017720: 6c6f 7365 642d 7265 6369 7069 656e 7473  losed-recipients
-00017730: 3a3b 2729 3b0a 2020 2020 2020 2020 2020  :;');.          
-00017740: 2020 7d0a 2020 2020 2020 2020 7d0a 2020    }.        }.  
-00017750: 2020 2020 2020 2472 6573 756c 7420 2e3d        $result .=
-00017760: 2024 7468 6973 2d3e 6164 6472 4170 7065   $this->addrAppe
-00017770: 6e64 2827 4672 6f6d 272c 205b 5b74 7269  nd('From', [[tri
-00017780: 6d28 2474 6869 732d 3e46 726f 6d29 2c20  m($this->From), 
-00017790: 2474 6869 732d 3e46 726f 6d4e 616d 655d  $this->FromName]
-000177a0: 5d29 3b0a 0a20 2020 2020 2020 202f 2f73  ]);..        //s
-000177b0: 656e 646d 6169 6c20 616e 6420 6d61 696c  endmail and mail
-000177c0: 2829 2065 7874 7261 6374 2043 6320 6672  () extract Cc fr
-000177d0: 6f6d 2074 6865 2068 6561 6465 7220 6265  om the header be
-000177e0: 666f 7265 2073 656e 6469 6e67 0a20 2020  fore sending.   
-000177f0: 2020 2020 2069 6620 2863 6f75 6e74 2824       if (count($
-00017800: 7468 6973 2d3e 6363 2920 3e20 3029 207b  this->cc) > 0) {
-00017810: 0a20 2020 2020 2020 2020 2020 2024 7265  .            $re
-00017820: 7375 6c74 202e 3d20 2474 6869 732d 3e61  sult .= $this->a
-00017830: 6464 7241 7070 656e 6428 2743 6327 2c20  ddrAppend('Cc', 
-00017840: 2474 6869 732d 3e63 6329 3b0a 2020 2020  $this->cc);.    
-00017850: 2020 2020 7d0a 0a20 2020 2020 2020 202f      }..        /
-00017860: 2f73 656e 646d 6169 6c20 616e 6420 6d61  /sendmail and ma
-00017870: 696c 2829 2065 7874 7261 6374 2042 6363  il() extract Bcc
-00017880: 2066 726f 6d20 7468 6520 6865 6164 6572   from the header
-00017890: 2062 6566 6f72 6520 7365 6e64 696e 670a   before sending.
-000178a0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-000178b0: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
-000178c0: 2020 2020 2020 2020 2020 2027 7365 6e64             'send
-000178d0: 6d61 696c 2720 3d3d 3d20 2474 6869 732d  mail' === $this-
-000178e0: 3e4d 6169 6c65 7220 7c7c 2027 716d 6169  >Mailer || 'qmai
-000178f0: 6c27 203d 3d3d 2024 7468 6973 2d3e 4d61  l' === $this->Ma
-00017900: 696c 6572 207c 7c20 276d 6169 6c27 203d  iler || 'mail' =
-00017910: 3d3d 2024 7468 6973 2d3e 4d61 696c 6572  == $this->Mailer
-00017920: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00017930: 2020 2020 2020 2020 2020 2026 2620 636f             && co
-00017940: 756e 7428 2474 6869 732d 3e62 6363 2920  unt($this->bcc) 
-00017950: 3e20 300a 2020 2020 2020 2020 2920 7b0a  > 0.        ) {.
-00017960: 2020 2020 2020 2020 2020 2020 2472 6573              $res
-00017970: 756c 7420 2e3d 2024 7468 6973 2d3e 6164  ult .= $this->ad
-00017980: 6472 4170 7065 6e64 2827 4263 6327 2c20  drAppend('Bcc', 
-00017990: 2474 6869 732d 3e62 6363 293b 0a20 2020  $this->bcc);.   
-000179a0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-000179b0: 6966 2028 636f 756e 7428 2474 6869 732d  if (count($this-
-000179c0: 3e52 6570 6c79 546f 2920 3e20 3029 207b  >ReplyTo) > 0) {
-000179d0: 0a20 2020 2020 2020 2020 2020 2024 7265  .            $re
-000179e0: 7375 6c74 202e 3d20 2474 6869 732d 3e61  sult .= $this->a
-000179f0: 6464 7241 7070 656e 6428 2752 6570 6c79  ddrAppend('Reply
-00017a00: 2d54 6f27 2c20 2474 6869 732d 3e52 6570  -To', $this->Rep
-00017a10: 6c79 546f 293b 0a20 2020 2020 2020 207d  lyTo);.        }
-00017a20: 0a0a 2020 2020 2020 2020 2f2f 6d61 696c  ..        //mail
-00017a30: 2829 2073 6574 7320 7468 6520 7375 626a  () sets the subj
-00017a40: 6563 7420 6974 7365 6c66 0a20 2020 2020  ect itself.     
-00017a50: 2020 2069 6620 2827 6d61 696c 2720 213d     if ('mail' !=
-00017a60: 3d20 2474 6869 732d 3e4d 6169 6c65 7229  = $this->Mailer)
-00017a70: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
-00017a80: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
-00017a90: 3e68 6561 6465 724c 696e 6528 2753 7562  >headerLine('Sub
-00017aa0: 6a65 6374 272c 2024 7468 6973 2d3e 656e  ject', $this->en
-00017ab0: 636f 6465 4865 6164 6572 2824 7468 6973  codeHeader($this
-00017ac0: 2d3e 7365 6375 7265 4865 6164 6572 2824  ->secureHeader($
-00017ad0: 7468 6973 2d3e 5375 626a 6563 7429 2929  this->Subject)))
-00017ae0: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
-00017af0: 2020 2020 202f 2f4f 6e6c 7920 616c 6c6f       //Only allo
-00017b00: 7720 6120 6375 7374 6f6d 206d 6573 7361  w a custom messa
-00017b10: 6765 2049 4420 6966 2069 7420 636f 6e66  ge ID if it conf
-00017b20: 6f72 6d73 2074 6f20 5246 4320 3533 3232  orms to RFC 5322
-00017b30: 2073 6563 7469 6f6e 2033 2e36 2e34 0a20   section 3.6.4. 
-00017b40: 2020 2020 2020 202f 2f68 7474 7073 3a2f         //https:/
-00017b50: 2f74 6f6f 6c73 2e69 6574 662e 6f72 672f  /tools.ietf.org/
-00017b60: 6874 6d6c 2f72 6663 3533 3232 2373 6563  html/rfc5322#sec
-00017b70: 7469 6f6e 2d33 2e36 2e34 0a20 2020 2020  tion-3.6.4.     
-00017b80: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00017b90: 2020 2020 2727 2021 3d3d 2024 7468 6973      '' !== $this
-00017ba0: 2d3e 4d65 7373 6167 6549 4420 2626 0a20  ->MessageID &&. 
-00017bb0: 2020 2020 2020 2020 2020 2070 7265 675f             preg_
-00017bc0: 6d61 7463 6828 0a20 2020 2020 2020 2020  match(.         
-00017bd0: 2020 2020 2020 2027 2f5e 3c28 2828 5b61         '/^<((([a
-00017be0: 2d7a 5c64 2123 2425 265c 272a 2b5c 2f3d  -z\d!#$%&\'*+\/=
-00017bf0: 3f5e 5f60 7b7c 7d7e 2d5d 2b28 5c2e 5b61  ?^_`{|}~-]+(\.[a
-00017c00: 2d7a 5c64 2123 2425 265c 272a 2b5c 2f3d  -z\d!#$%&\'*+\/=
-00017c10: 3f5e 5f60 7b7c 7d7e 2d5d 2b29 2a29 2720  ?^_`{|}~-]+)*)' 
-00017c20: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017c30: 2020 277c 2822 2828 5b5c 7830 312d 5c78    '|("(([\x01-\x
-00017c40: 3038 5c78 3042 5c78 3043 5c78 3045 2d5c  08\x0B\x0C\x0E-\
-00017c50: 7831 465c 7837 465d 7c5b 5c78 3231 5c78  x1F\x7F]|[\x21\x
-00017c60: 3233 2d5c 7835 425c 7835 442d 5c78 3745  23-\x5B\x5D-\x7E
-00017c70: 5d29 2720 2e0a 2020 2020 2020 2020 2020  ])' ..          
-00017c80: 2020 2020 2020 277c 285c 5c5b 5c78 3031        '|(\\[\x01
-00017c90: 2d5c 7830 395c 7830 425c 7830 435c 7830  -\x09\x0B\x0C\x0
-00017ca0: 452d 5c78 3746 5d29 292a 2229 2940 2828  E-\x7F]))*"))@((
-00017cb0: 5b61 2d7a 5c64 2123 2425 265c 272a 2b5c  [a-z\d!#$%&\'*+\
-00017cc0: 2f3d 3f5e 5f60 7b7c 7d7e 2d5d 2b27 202e  /=?^_`{|}~-]+' .
-00017cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ce0: 2027 285c 2e5b 612d 7a5c 6421 2324 2526   '(\.[a-z\d!#$%&
-00017cf0: 5c27 2a2b 5c2f 3d3f 5e5f 607b 7c7d 7e2d  \'*+\/=?^_`{|}~-
-00017d00: 5d2b 292a 297c 285c 5b28 285b 5c78 3031  ]+)*)|(\[(([\x01
-00017d10: 2d5c 7830 385c 7830 425c 7830 435c 7830  -\x08\x0B\x0C\x0
-00017d20: 452d 5c78 3146 5c78 3746 5d27 202e 0a20  E-\x1F\x7F]' .. 
-00017d30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00017d40: 7c5b 5c78 3231 2d5c 7835 415c 7835 452d  |[\x21-\x5A\x5E-
-00017d50: 5c78 3745 5d29 7c28 5c5c 5b5c 7830 312d  \x7E])|(\\[\x01-
-00017d60: 5c78 3039 5c78 3042 5c78 3043 5c78 3045  \x09\x0B\x0C\x0E
-00017d70: 2d5c 7837 465d 2929 2a5c 5d29 2929 3e24  -\x7F]))*\])))>$
-00017d80: 2f44 6927 2c0a 2020 2020 2020 2020 2020  /Di',.          
-00017d90: 2020 2020 2020 2474 6869 732d 3e4d 6573        $this->Mes
-00017da0: 7361 6765 4944 0a20 2020 2020 2020 2020  sageID.         
-00017db0: 2020 2029 0a20 2020 2020 2020 2029 207b     ).        ) {
-00017dc0: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
-00017dd0: 6973 2d3e 6c61 7374 4d65 7373 6167 6549  is->lastMessageI
-00017de0: 4420 3d20 2474 6869 732d 3e4d 6573 7361  D = $this->Messa
-00017df0: 6765 4944 3b0a 2020 2020 2020 2020 7d20  geID;.        } 
-00017e00: 656c 7365 207b 0a20 2020 2020 2020 2020  else {.         
-00017e10: 2020 2024 7468 6973 2d3e 6c61 7374 4d65     $this->lastMe
-00017e20: 7373 6167 6549 4420 3d20 7370 7269 6e74  ssageID = sprint
-00017e30: 6628 273c 2573 4025 733e 272c 2024 7468  f('<%s@%s>', $th
-00017e40: 6973 2d3e 756e 6971 7565 6964 2c20 2474  is->uniqueid, $t
-00017e50: 6869 732d 3e73 6572 7665 7248 6f73 746e  his->serverHostn
-00017e60: 616d 6528 2929 3b0a 2020 2020 2020 2020  ame());.        
-00017e70: 7d0a 2020 2020 2020 2020 2472 6573 756c  }.        $resul
-00017e80: 7420 2e3d 2024 7468 6973 2d3e 6865 6164  t .= $this->head
-00017e90: 6572 4c69 6e65 2827 4d65 7373 6167 652d  erLine('Message-
-00017ea0: 4944 272c 2024 7468 6973 2d3e 6c61 7374  ID', $this->last
-00017eb0: 4d65 7373 6167 6549 4429 3b0a 2020 2020  MessageID);.    
-00017ec0: 2020 2020 6966 2028 6e75 6c6c 2021 3d3d      if (null !==
-00017ed0: 2024 7468 6973 2d3e 5072 696f 7269 7479   $this->Priority
-00017ee0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00017ef0: 2472 6573 756c 7420 2e3d 2024 7468 6973  $result .= $this
-00017f00: 2d3e 6865 6164 6572 4c69 6e65 2827 582d  ->headerLine('X-
-00017f10: 5072 696f 7269 7479 272c 2024 7468 6973  Priority', $this
-00017f20: 2d3e 5072 696f 7269 7479 293b 0a20 2020  ->Priority);.   
-00017f30: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
-00017f40: 6620 2827 2720 3d3d 3d20 2474 6869 732d  f ('' === $this-
-00017f50: 3e58 4d61 696c 6572 2920 7b0a 2020 2020  >XMailer) {.    
-00017f60: 2020 2020 2020 2020 2f2f 456d 7074 7920          //Empty 
-00017f70: 7374 7269 6e67 2066 6f72 2064 6566 6175  string for defau
-00017f80: 6c74 2058 2d4d 6169 6c65 7220 6865 6164  lt X-Mailer head
-00017f90: 6572 0a20 2020 2020 2020 2020 2020 2024  er.            $
-00017fa0: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
-00017fb0: 3e68 6561 6465 724c 696e 6528 0a20 2020  >headerLine(.   
-00017fc0: 2020 2020 2020 2020 2020 2020 2027 582d               'X-
-00017fd0: 4d61 696c 6572 272c 0a20 2020 2020 2020  Mailer',.       
-00017fe0: 2020 2020 2020 2020 2027 5048 504d 6169           'PHPMai
-00017ff0: 6c65 7220 2720 2e20 7365 6c66 3a3a 5645  ler ' . self::VE
-00018000: 5253 494f 4e20 2e20 2720 2868 7474 7073  RSION . ' (https
-00018010: 3a2f 2f67 6974 6875 622e 636f 6d2f 5048  ://github.com/PH
-00018020: 504d 6169 6c65 722f 5048 504d 6169 6c65  PMailer/PHPMaile
-00018030: 7229 270a 2020 2020 2020 2020 2020 2020  r)'.            
-00018040: 293b 0a20 2020 2020 2020 207d 2065 6c73  );.        } els
-00018050: 6569 6620 2869 735f 7374 7269 6e67 2824  eif (is_string($
-00018060: 7468 6973 2d3e 584d 6169 6c65 7229 2026  this->XMailer) &
-00018070: 2620 7472 696d 2824 7468 6973 2d3e 584d  & trim($this->XM
-00018080: 6169 6c65 7229 2021 3d3d 2027 2729 207b  ailer) !== '') {
-00018090: 0a20 2020 2020 2020 2020 2020 202f 2f53  .            //S
-000180a0: 6f6d 6520 7374 7269 6e67 0a20 2020 2020  ome string.     
-000180b0: 2020 2020 2020 2024 7265 7375 6c74 202e         $result .
-000180c0: 3d20 2474 6869 732d 3e68 6561 6465 724c  = $this->headerL
-000180d0: 696e 6528 2758 2d4d 6169 6c65 7227 2c20  ine('X-Mailer', 
-000180e0: 7472 696d 2824 7468 6973 2d3e 584d 6169  trim($this->XMai
-000180f0: 6c65 7229 293b 0a20 2020 2020 2020 207d  ler));.        }
-00018100: 202f 2f4f 7468 6572 2076 616c 7565 7320   //Other values 
-00018110: 7265 7375 6c74 2069 6e20 6e6f 2058 2d4d  result in no X-M
-00018120: 6169 6c65 7220 6865 6164 6572 0a0a 2020  ailer header..  
-00018130: 2020 2020 2020 6966 2028 2727 2021 3d3d        if ('' !==
-00018140: 2024 7468 6973 2d3e 436f 6e66 6972 6d52   $this->ConfirmR
-00018150: 6561 6469 6e67 546f 2920 7b0a 2020 2020  eadingTo) {.    
-00018160: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
-00018170: 2e3d 2024 7468 6973 2d3e 6865 6164 6572  .= $this->header
-00018180: 4c69 6e65 2827 4469 7370 6f73 6974 696f  Line('Dispositio
-00018190: 6e2d 4e6f 7469 6669 6361 7469 6f6e 2d54  n-Notification-T
-000181a0: 6f27 2c20 273c 2720 2e20 2474 6869 732d  o', '<' . $this-
-000181b0: 3e43 6f6e 6669 726d 5265 6164 696e 6754  >ConfirmReadingT
-000181c0: 6f20 2e20 273e 2729 3b0a 2020 2020 2020  o . '>');.      
-000181d0: 2020 7d0a 0a20 2020 2020 2020 202f 2f41    }..        //A
-000181e0: 6464 2063 7573 746f 6d20 6865 6164 6572  dd custom header
-000181f0: 730a 2020 2020 2020 2020 666f 7265 6163  s.        foreac
-00018200: 6820 2824 7468 6973 2d3e 4375 7374 6f6d  h ($this->Custom
-00018210: 4865 6164 6572 2061 7320 2468 6561 6465  Header as $heade
-00018220: 7229 207b 0a20 2020 2020 2020 2020 2020  r) {.           
-00018230: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
-00018240: 732d 3e68 6561 6465 724c 696e 6528 0a20  s->headerLine(. 
-00018250: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00018260: 7269 6d28 2468 6561 6465 725b 305d 292c  rim($header[0]),
-00018270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018280: 2024 7468 6973 2d3e 656e 636f 6465 4865   $this->encodeHe
-00018290: 6164 6572 2874 7269 6d28 2468 6561 6465  ader(trim($heade
-000182a0: 725b 315d 2929 0a20 2020 2020 2020 2020  r[1])).         
-000182b0: 2020 2029 3b0a 2020 2020 2020 2020 7d0a     );.        }.
-000182c0: 2020 2020 2020 2020 6966 2028 2124 7468          if (!$th
-000182d0: 6973 2d3e 7369 676e 5f6b 6579 5f66 696c  is->sign_key_fil
-000182e0: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-000182f0: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
-00018300: 732d 3e68 6561 6465 724c 696e 6528 274d  s->headerLine('M
-00018310: 494d 452d 5665 7273 696f 6e27 2c20 2731  IME-Version', '1
-00018320: 2e30 2729 3b0a 2020 2020 2020 2020 2020  .0');.          
-00018330: 2020 2472 6573 756c 7420 2e3d 2024 7468    $result .= $th
-00018340: 6973 2d3e 6765 744d 6169 6c4d 494d 4528  is->getMailMIME(
-00018350: 293b 0a20 2020 2020 2020 207d 0a0a 2020  );.        }..  
-00018360: 2020 2020 2020 7265 7475 726e 2024 7265        return $re
-00018370: 7375 6c74 3b0a 2020 2020 7d0a 0a20 2020  sult;.    }..   
-00018380: 202f 2a2a 0a20 2020 2020 2a20 4765 7420   /**.     * Get 
-00018390: 7468 6520 6d65 7373 6167 6520 4d49 4d45  the message MIME
-000183a0: 2074 7970 6520 6865 6164 6572 732e 0a20   type headers.. 
-000183b0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-000183c0: 7475 726e 2073 7472 696e 670a 2020 2020  turn string.    
-000183d0: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-000183e0: 756e 6374 696f 6e20 6765 744d 6169 6c4d  unction getMailM
-000183f0: 494d 4528 290a 2020 2020 7b0a 2020 2020  IME().    {.    
-00018400: 2020 2020 2472 6573 756c 7420 3d20 2727      $result = ''
-00018410: 3b0a 2020 2020 2020 2020 2469 736d 756c  ;.        $ismul
-00018420: 7469 7061 7274 203d 2074 7275 653b 0a20  tipart = true;. 
-00018430: 2020 2020 2020 2073 7769 7463 6820 2824         switch ($
-00018440: 7468 6973 2d3e 6d65 7373 6167 655f 7479  this->message_ty
-00018450: 7065 2920 7b0a 2020 2020 2020 2020 2020  pe) {.          
-00018460: 2020 6361 7365 2027 696e 6c69 6e65 273a    case 'inline':
-00018470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018480: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
-00018490: 732d 3e68 6561 6465 724c 696e 6528 2743  s->headerLine('C
-000184a0: 6f6e 7465 6e74 2d54 7970 6527 2c20 7374  ontent-Type', st
-000184b0: 6174 6963 3a3a 434f 4e54 454e 545f 5459  atic::CONTENT_TY
-000184c0: 5045 5f4d 554c 5449 5041 5254 5f52 454c  PE_MULTIPART_REL
-000184d0: 4154 4544 202e 2027 3b27 293b 0a20 2020  ATED . ';');.   
-000184e0: 2020 2020 2020 2020 2020 2020 2024 7265               $re
-000184f0: 7375 6c74 202e 3d20 2474 6869 732d 3e74  sult .= $this->t
-00018500: 6578 744c 696e 6528 2720 626f 756e 6461  extLine(' bounda
-00018510: 7279 3d22 2720 2e20 2474 6869 732d 3e62  ry="' . $this->b
-00018520: 6f75 6e64 6172 795b 315d 202e 2027 2227  oundary[1] . '"'
-00018530: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-00018540: 2020 2062 7265 616b 3b0a 2020 2020 2020     break;.      
-00018550: 2020 2020 2020 6361 7365 2027 6174 7461        case 'atta
-00018560: 6368 273a 0a20 2020 2020 2020 2020 2020  ch':.           
-00018570: 2063 6173 6520 2769 6e6c 696e 655f 6174   case 'inline_at
-00018580: 7461 6368 273a 0a20 2020 2020 2020 2020  tach':.         
-00018590: 2020 2063 6173 6520 2761 6c74 5f61 7474     case 'alt_att
-000185a0: 6163 6827 3a0a 2020 2020 2020 2020 2020  ach':.          
-000185b0: 2020 6361 7365 2027 616c 745f 696e 6c69    case 'alt_inli
-000185c0: 6e65 5f61 7474 6163 6827 3a0a 2020 2020  ne_attach':.    
-000185d0: 2020 2020 2020 2020 2020 2020 2472 6573              $res
-000185e0: 756c 7420 2e3d 2024 7468 6973 2d3e 6865  ult .= $this->he
-000185f0: 6164 6572 4c69 6e65 2827 436f 6e74 656e  aderLine('Conten
-00018600: 742d 5479 7065 272c 2073 7461 7469 633a  t-Type', static:
-00018610: 3a43 4f4e 5445 4e54 5f54 5950 455f 4d55  :CONTENT_TYPE_MU
-00018620: 4c54 4950 4152 545f 4d49 5845 4420 2e20  LTIPART_MIXED . 
-00018630: 273b 2729 3b0a 2020 2020 2020 2020 2020  ';');.          
-00018640: 2020 2020 2020 2472 6573 756c 7420 2e3d        $result .=
-00018650: 2024 7468 6973 2d3e 7465 7874 4c69 6e65   $this->textLine
-00018660: 2827 2062 6f75 6e64 6172 793d 2227 202e  (' boundary="' .
-00018670: 2024 7468 6973 2d3e 626f 756e 6461 7279   $this->boundary
-00018680: 5b31 5d20 2e20 2722 2729 3b0a 2020 2020  [1] . '"');.    
-00018690: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000186a0: 6b3b 0a20 2020 2020 2020 2020 2020 2063  k;.            c
-000186b0: 6173 6520 2761 6c74 273a 0a20 2020 2020  ase 'alt':.     
-000186c0: 2020 2020 2020 2063 6173 6520 2761 6c74         case 'alt
-000186d0: 5f69 6e6c 696e 6527 3a0a 2020 2020 2020  _inline':.      
-000186e0: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
-000186f0: 7420 2e3d 2024 7468 6973 2d3e 6865 6164  t .= $this->head
-00018700: 6572 4c69 6e65 2827 436f 6e74 656e 742d  erLine('Content-
-00018710: 5479 7065 272c 2073 7461 7469 633a 3a43  Type', static::C
-00018720: 4f4e 5445 4e54 5f54 5950 455f 4d55 4c54  ONTENT_TYPE_MULT
-00018730: 4950 4152 545f 414c 5445 524e 4154 4956  IPART_ALTERNATIV
-00018740: 4520 2e20 273b 2729 3b0a 2020 2020 2020  E . ';');.      
-00018750: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
-00018760: 7420 2e3d 2024 7468 6973 2d3e 7465 7874  t .= $this->text
-00018770: 4c69 6e65 2827 2062 6f75 6e64 6172 793d  Line(' boundary=
-00018780: 2227 202e 2024 7468 6973 2d3e 626f 756e  "' . $this->boun
-00018790: 6461 7279 5b31 5d20 2e20 2722 2729 3b0a  dary[1] . '"');.
-000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187b0: 6272 6561 6b3b 0a20 2020 2020 2020 2020  break;.         
-000187c0: 2020 2064 6566 6175 6c74 3a0a 2020 2020     default:.    
-000187d0: 2020 2020 2020 2020 2020 2020 2f2f 4361              //Ca
-000187e0: 7463 6865 7320 6361 7365 2027 706c 6169  tches case 'plai
-000187f0: 6e27 3a20 616e 6420 6361 7365 2027 273a  n': and case '':
-00018800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018810: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
-00018820: 732d 3e74 6578 744c 696e 6528 2743 6f6e  s->textLine('Con
-00018830: 7465 6e74 2d54 7970 653a 2027 202e 2024  tent-Type: ' . $
-00018840: 7468 6973 2d3e 436f 6e74 656e 7454 7970  this->ContentTyp
-00018850: 6520 2e20 273b 2063 6861 7273 6574 3d27  e . '; charset='
-00018860: 202e 2024 7468 6973 2d3e 4368 6172 5365   . $this->CharSe
-00018870: 7429 3b0a 2020 2020 2020 2020 2020 2020  t);.            
-00018880: 2020 2020 2469 736d 756c 7469 7061 7274      $ismultipart
-00018890: 203d 2066 616c 7365 3b0a 2020 2020 2020   = false;.      
-000188a0: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
-000188b0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-000188c0: 2020 202f 2f52 4643 3133 3431 2070 6172     //RFC1341 par
-000188d0: 7420 3520 7361 7973 2037 6269 7420 6973  t 5 says 7bit is
-000188e0: 2061 7373 756d 6564 2069 6620 6e6f 7420   assumed if not 
-000188f0: 7370 6563 6966 6965 640a 2020 2020 2020  specified.      
-00018900: 2020 6966 2028 7374 6174 6963 3a3a 454e    if (static::EN
-00018910: 434f 4449 4e47 5f37 4249 5420 213d 3d20  CODING_7BIT !== 
-00018920: 2474 6869 732d 3e45 6e63 6f64 696e 6729  $this->Encoding)
-00018930: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
-00018940: 2f52 4643 2032 3034 3520 7365 6374 696f  /RFC 2045 sectio
-00018950: 6e20 362e 3420 7361 7973 206d 756c 7469  n 6.4 says multi
-00018960: 7061 7274 204d 494d 4520 7061 7274 7320  part MIME parts 
-00018970: 6d61 7920 6f6e 6c79 2075 7365 2037 6269  may only use 7bi
-00018980: 742c 2038 6269 7420 6f72 2062 696e 6172  t, 8bit or binar
-00018990: 7920 4354 450a 2020 2020 2020 2020 2020  y CTE.          
-000189a0: 2020 6966 2028 2469 736d 756c 7469 7061    if ($ismultipa
-000189b0: 7274 2920 7b0a 2020 2020 2020 2020 2020  rt) {.          
-000189c0: 2020 2020 2020 6966 2028 7374 6174 6963        if (static
-000189d0: 3a3a 454e 434f 4449 4e47 5f38 4249 5420  ::ENCODING_8BIT 
-000189e0: 3d3d 3d20 2474 6869 732d 3e45 6e63 6f64  === $this->Encod
-000189f0: 696e 6729 207b 0a20 2020 2020 2020 2020  ing) {.         
-00018a00: 2020 2020 2020 2020 2020 2024 7265 7375             $resu
-00018a10: 6c74 202e 3d20 2474 6869 732d 3e68 6561  lt .= $this->hea
-00018a20: 6465 724c 696e 6528 2743 6f6e 7465 6e74  derLine('Content
-00018a30: 2d54 7261 6e73 6665 722d 456e 636f 6469  -Transfer-Encodi
-00018a40: 6e67 272c 2073 7461 7469 633a 3a45 4e43  ng', static::ENC
-00018a50: 4f44 494e 475f 3842 4954 293b 0a20 2020  ODING_8BIT);.   
-00018a60: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00018a70: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00018a80: 2f54 6865 206f 6e6c 7920 7265 6d61 696e  /The only remain
-00018a90: 696e 6720 616c 7465 726e 6174 6976 6573  ing alternatives
-00018aa0: 2061 7265 2071 756f 7465 642d 7072 696e   are quoted-prin
-00018ab0: 7461 626c 6520 616e 6420 6261 7365 3634  table and base64
-00018ac0: 2c20 7768 6963 6820 6172 6520 626f 7468  , which are both
-00018ad0: 2037 6269 7420 636f 6d70 6174 6962 6c65   7bit compatible
-00018ae0: 0a20 2020 2020 2020 2020 2020 207d 2065  .            } e
-00018af0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-00018b00: 2020 2020 2020 2472 6573 756c 7420 2e3d        $result .=
-00018b10: 2024 7468 6973 2d3e 6865 6164 6572 4c69   $this->headerLi
-00018b20: 6e65 2827 436f 6e74 656e 742d 5472 616e  ne('Content-Tran
-00018b30: 7366 6572 2d45 6e63 6f64 696e 6727 2c20  sfer-Encoding', 
-00018b40: 2474 6869 732d 3e45 6e63 6f64 696e 6729  $this->Encoding)
-00018b50: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
-00018b60: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00018b70: 2020 2072 6574 7572 6e20 2472 6573 756c     return $resul
-00018b80: 743b 0a20 2020 207d 0a0a 2020 2020 2f2a  t;.    }..    /*
-00018b90: 2a0a 2020 2020 202a 2052 6574 7572 6e73  *.     * Returns
-00018ba0: 2074 6865 2077 686f 6c65 204d 494d 4520   the whole MIME 
-00018bb0: 6d65 7373 6167 652e 0a20 2020 2020 2a20  message..     * 
-00018bc0: 496e 636c 7564 6573 2063 6f6d 706c 6574  Includes complet
-00018bd0: 6520 6865 6164 6572 7320 616e 6420 626f  e headers and bo
-00018be0: 6479 2e0a 2020 2020 202a 204f 6e6c 7920  dy..     * Only 
-00018bf0: 7661 6c69 6420 706f 7374 2070 7265 5365  valid post preSe
-00018c00: 6e64 2829 2e0a 2020 2020 202a 0a20 2020  nd()..     *.   
-00018c10: 2020 2a20 4073 6565 2050 4850 4d61 696c    * @see PHPMail
-00018c20: 6572 3a3a 7072 6553 656e 6428 290a 2020  er::preSend().  
-00018c30: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00018c40: 7572 6e20 7374 7269 6e67 0a20 2020 2020  urn string.     
-00018c50: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-00018c60: 6e63 7469 6f6e 2067 6574 5365 6e74 4d49  nction getSentMI
-00018c70: 4d45 4d65 7373 6167 6528 290a 2020 2020  MEMessage().    
-00018c80: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
-00018c90: 2073 7461 7469 633a 3a73 7472 6970 5472   static::stripTr
-00018ca0: 6169 6c69 6e67 5753 5028 2474 6869 732d  ailingWSP($this-
-00018cb0: 3e4d 494d 4548 6561 6465 7220 2e20 2474  >MIMEHeader . $t
-00018cc0: 6869 732d 3e6d 6169 6c48 6561 6465 7229  his->mailHeader)
-00018cd0: 202e 0a20 2020 2020 2020 2020 2020 2073   ..            s
-00018ce0: 7461 7469 633a 3a24 4c45 202e 2073 7461  tatic::$LE . sta
-00018cf0: 7469 633a 3a24 4c45 202e 2024 7468 6973  tic::$LE . $this
-00018d00: 2d3e 4d49 4d45 426f 6479 3b0a 2020 2020  ->MIMEBody;.    
-00018d10: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-00018d20: 2a20 4372 6561 7465 2061 2075 6e69 7175  * Create a uniqu
-00018d30: 6520 4944 2074 6f20 7573 6520 666f 7220  e ID to use for 
-00018d40: 626f 756e 6461 7269 6573 2e0a 2020 2020  boundaries..    
-00018d50: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
-00018d60: 6e20 7374 7269 6e67 0a20 2020 2020 2a2f  n string.     */
-00018d70: 0a20 2020 2070 726f 7465 6374 6564 2066  .    protected f
-00018d80: 756e 6374 696f 6e20 6765 6e65 7261 7465  unction generate
-00018d90: 4964 2829 0a20 2020 207b 0a20 2020 2020  Id().    {.     
-00018da0: 2020 2024 6c65 6e20 3d20 3332 3b20 2f2f     $len = 32; //
-00018db0: 3332 2062 7974 6573 203d 2032 3536 2062  32 bytes = 256 b
-00018dc0: 6974 730a 2020 2020 2020 2020 2462 7974  its.        $byt
-00018dd0: 6573 203d 2027 273b 0a20 2020 2020 2020  es = '';.       
-00018de0: 2069 6620 2866 756e 6374 696f 6e5f 6578   if (function_ex
-00018df0: 6973 7473 2827 7261 6e64 6f6d 5f62 7974  ists('random_byt
-00018e00: 6573 2729 2920 7b0a 2020 2020 2020 2020  es')) {.        
-00018e10: 2020 2020 7472 7920 7b0a 2020 2020 2020      try {.      
-00018e20: 2020 2020 2020 2020 2020 2462 7974 6573            $bytes
-00018e30: 203d 2072 616e 646f 6d5f 6279 7465 7328   = random_bytes(
-00018e40: 246c 656e 293b 0a20 2020 2020 2020 2020  $len);.         
-00018e50: 2020 207d 2063 6174 6368 2028 5c45 7863     } catch (\Exc
-00018e60: 6570 7469 6f6e 2024 6529 207b 0a20 2020  eption $e) {.   
-00018e70: 2020 2020 2020 2020 2020 2020 202f 2f44               //D
-00018e80: 6f20 6e6f 7468 696e 670a 2020 2020 2020  o nothing.      
-00018e90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00018ea0: 7d20 656c 7365 6966 2028 6675 6e63 7469  } elseif (functi
-00018eb0: 6f6e 5f65 7869 7374 7328 276f 7065 6e73  on_exists('opens
-00018ec0: 736c 5f72 616e 646f 6d5f 7073 6575 646f  sl_random_pseudo
-00018ed0: 5f62 7974 6573 2729 2920 7b0a 2020 2020  _bytes')) {.    
-00018ee0: 2020 2020 2020 2020 2f2a 2a20 406e 6f69          /** @noi
-00018ef0: 6e73 7065 6374 696f 6e20 4372 7970 746f  nspection Crypto
-00018f00: 6772 6170 6869 6361 6c6c 7953 6563 7572  graphicallySecur
-00018f10: 6552 616e 646f 6d6e 6573 7349 6e73 7065  eRandomnessInspe
-00018f20: 6374 696f 6e20 2a2f 0a20 2020 2020 2020  ction */.       
-00018f30: 2020 2020 2024 6279 7465 7320 3d20 6f70       $bytes = op
-00018f40: 656e 7373 6c5f 7261 6e64 6f6d 5f70 7365  enssl_random_pse
-00018f50: 7564 6f5f 6279 7465 7328 246c 656e 293b  udo_bytes($len);
-00018f60: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-00018f70: 2020 2069 6620 2824 6279 7465 7320 3d3d     if ($bytes ==
-00018f80: 3d20 2727 2920 7b0a 2020 2020 2020 2020  = '') {.        
-00018f90: 2020 2020 2f2f 5765 2066 6169 6c65 6420      //We failed 
-00018fa0: 746f 2070 726f 6475 6365 2061 2070 726f  to produce a pro
-00018fb0: 7065 7220 7261 6e64 6f6d 2073 7472 696e  per random strin
-00018fc0: 672c 2073 6f20 6d61 6b65 2064 6f2e 0a20  g, so make do.. 
-00018fd0: 2020 2020 2020 2020 2020 202f 2f55 7365             //Use
-00018fe0: 2061 2068 6173 6820 746f 2066 6f72 6365   a hash to force
-00018ff0: 2074 6865 206c 656e 6774 6820 746f 2074   the length to t
-00019000: 6865 2073 616d 6520 6173 2074 6865 206f  he same as the o
-00019010: 7468 6572 206d 6574 686f 6473 0a20 2020  ther methods.   
-00019020: 2020 2020 2020 2020 2024 6279 7465 7320           $bytes 
-00019030: 3d20 6861 7368 2827 7368 6132 3536 272c  = hash('sha256',
-00019040: 2075 6e69 7169 6428 2873 7472 696e 6729   uniqid((string)
-00019050: 206d 745f 7261 6e64 2829 2c20 7472 7565   mt_rand(), true
-00019060: 292c 2074 7275 6529 3b0a 2020 2020 2020  ), true);.      
-00019070: 2020 7d0a 0a20 2020 2020 2020 202f 2f57    }..        //W
-00019080: 6520 646f 6e27 7420 6361 7265 2061 626f  e don't care abo
-00019090: 7574 206d 6573 7369 6e67 2075 7020 6261  ut messing up ba
-000190a0: 7365 3634 2066 6f72 6d61 7420 6865 7265  se64 format here
-000190b0: 2c20 6a75 7374 2077 616e 7420 6120 7261  , just want a ra
-000190c0: 6e64 6f6d 2073 7472 696e 670a 2020 2020  ndom string.    
-000190d0: 2020 2020 7265 7475 726e 2073 7472 5f72      return str_r
-000190e0: 6570 6c61 6365 285b 273d 272c 2027 2b27  eplace(['=', '+'
-000190f0: 2c20 272f 275d 2c20 2727 2c20 6261 7365  , '/'], '', base
-00019100: 3634 5f65 6e63 6f64 6528 6861 7368 2827  64_encode(hash('
-00019110: 7368 6132 3536 272c 2024 6279 7465 732c  sha256', $bytes,
-00019120: 2074 7275 6529 2929 3b0a 2020 2020 7d0a   true)));.    }.
-00019130: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00019140: 4173 7365 6d62 6c65 2074 6865 206d 6573  Assemble the mes
-00019150: 7361 6765 2062 6f64 792e 0a20 2020 2020  sage body..     
-00019160: 2a20 5265 7475 726e 7320 616e 2065 6d70  * Returns an emp
-00019170: 7479 2073 7472 696e 6720 6f6e 2066 6169  ty string on fai
-00019180: 6c75 7265 2e0a 2020 2020 202a 0a20 2020  lure..     *.   
-00019190: 2020 2a20 4074 6872 6f77 7320 4578 6365    * @throws Exce
-000191a0: 7074 696f 6e0a 2020 2020 202a 0a20 2020  ption.     *.   
-000191b0: 2020 2a20 4072 6574 7572 6e20 7374 7269    * @return stri
-000191c0: 6e67 2054 6865 2061 7373 656d 626c 6564  ng The assembled
-000191d0: 206d 6573 7361 6765 2062 6f64 790a 2020   message body.  
-000191e0: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
-000191f0: 2066 756e 6374 696f 6e20 6372 6561 7465   function create
-00019200: 426f 6479 2829 0a20 2020 207b 0a20 2020  Body().    {.   
-00019210: 2020 2020 2024 626f 6479 203d 2027 273b       $body = '';
-00019220: 0a20 2020 2020 2020 202f 2f43 7265 6174  .        //Creat
-00019230: 6520 756e 6971 7565 2049 4473 2061 6e64  e unique IDs and
-00019240: 2070 7265 7365 7420 626f 756e 6461 7269   preset boundari
-00019250: 6573 0a20 2020 2020 2020 2024 7468 6973  es.        $this
-00019260: 2d3e 756e 6971 7565 6964 203d 2024 7468  ->uniqueid = $th
-00019270: 6973 2d3e 6765 6e65 7261 7465 4964 2829  is->generateId()
-00019280: 3b0a 2020 2020 2020 2020 2474 6869 732d  ;.        $this-
-00019290: 3e62 6f75 6e64 6172 795b 315d 203d 2027  >boundary[1] = '
-000192a0: 6231 5f27 202e 2024 7468 6973 2d3e 756e  b1_' . $this->un
-000192b0: 6971 7565 6964 3b0a 2020 2020 2020 2020  iqueid;.        
-000192c0: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
-000192d0: 325d 203d 2027 6232 5f27 202e 2024 7468  2] = 'b2_' . $th
-000192e0: 6973 2d3e 756e 6971 7565 6964 3b0a 2020  is->uniqueid;.  
-000192f0: 2020 2020 2020 2474 6869 732d 3e62 6f75        $this->bou
-00019300: 6e64 6172 795b 335d 203d 2027 6233 5f27  ndary[3] = 'b3_'
-00019310: 202e 2024 7468 6973 2d3e 756e 6971 7565   . $this->unique
-00019320: 6964 3b0a 0a20 2020 2020 2020 2069 6620  id;..        if 
-00019330: 2824 7468 6973 2d3e 7369 676e 5f6b 6579  ($this->sign_key
-00019340: 5f66 696c 6529 207b 0a20 2020 2020 2020  _file) {.       
-00019350: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
-00019360: 6869 732d 3e67 6574 4d61 696c 4d49 4d45  his->getMailMIME
-00019370: 2829 202e 2073 7461 7469 633a 3a24 4c45  () . static::$LE
-00019380: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
-00019390: 2020 2020 2024 7468 6973 2d3e 7365 7457       $this->setW
-000193a0: 6f72 6457 7261 7028 293b 0a0a 2020 2020  ordWrap();..    
-000193b0: 2020 2020 2462 6f64 7945 6e63 6f64 696e      $bodyEncodin
-000193c0: 6720 3d20 2474 6869 732d 3e45 6e63 6f64  g = $this->Encod
-000193d0: 696e 673b 0a20 2020 2020 2020 2024 626f  ing;.        $bo
-000193e0: 6479 4368 6172 5365 7420 3d20 2474 6869  dyCharSet = $thi
-000193f0: 732d 3e43 6861 7253 6574 3b0a 2020 2020  s->CharSet;.    
-00019400: 2020 2020 2f2f 4361 6e20 7765 2064 6f20      //Can we do 
-00019410: 6120 372d 6269 7420 646f 776e 6772 6164  a 7-bit downgrad
-00019420: 653f 0a20 2020 2020 2020 2069 6620 2873  e?.        if (s
-00019430: 7461 7469 633a 3a45 4e43 4f44 494e 475f  tatic::ENCODING_
-00019440: 3842 4954 203d 3d3d 2024 626f 6479 456e  8BIT === $bodyEn
-00019450: 636f 6469 6e67 2026 2620 2124 7468 6973  coding && !$this
-00019460: 2d3e 6861 7338 6269 7443 6861 7273 2824  ->has8bitChars($
-00019470: 7468 6973 2d3e 426f 6479 2929 207b 0a20  this->Body)) {. 
-00019480: 2020 2020 2020 2020 2020 2024 626f 6479             $body
-00019490: 456e 636f 6469 6e67 203d 2073 7461 7469  Encoding = stati
-000194a0: 633a 3a45 4e43 4f44 494e 475f 3742 4954  c::ENCODING_7BIT
-000194b0: 3b0a 2020 2020 2020 2020 2020 2020 2f2f  ;.            //
-000194c0: 416c 6c20 4953 4f20 3838 3539 2c20 5769  All ISO 8859, Wi
-000194d0: 6e64 6f77 7320 636f 6465 7061 6765 2061  ndows codepage a
-000194e0: 6e64 2055 5446 2d38 2063 6861 7273 6574  nd UTF-8 charset
-000194f0: 7320 6172 6520 6173 6369 6920 636f 6d70  s are ascii comp
-00019500: 6174 6962 6c65 2075 7020 746f 2037 2d62  atible up to 7-b
-00019510: 6974 0a20 2020 2020 2020 2020 2020 2024  it.            $
-00019520: 626f 6479 4368 6172 5365 7420 3d20 7374  bodyCharSet = st
-00019530: 6174 6963 3a3a 4348 4152 5345 545f 4153  atic::CHARSET_AS
-00019540: 4349 493b 0a20 2020 2020 2020 207d 0a20  CII;.        }. 
-00019550: 2020 2020 2020 202f 2f49 6620 6c69 6e65         //If line
-00019560: 7320 6172 6520 746f 6f20 6c6f 6e67 2c20  s are too long, 
-00019570: 616e 6420 7765 2772 6520 6e6f 7420 616c  and we're not al
-00019580: 7265 6164 7920 7573 696e 6720 616e 2065  ready using an e
-00019590: 6e63 6f64 696e 6720 7468 6174 2077 696c  ncoding that wil
-000195a0: 6c20 7368 6f72 7465 6e20 7468 656d 2c0a  l shorten them,.
-000195b0: 2020 2020 2020 2020 2f2f 6368 616e 6765          //change
-000195c0: 2074 6f20 7175 6f74 6564 2d70 7269 6e74   to quoted-print
-000195d0: 6162 6c65 2074 7261 6e73 6665 7220 656e  able transfer en
-000195e0: 636f 6469 6e67 2066 6f72 2074 6865 2062  coding for the b
-000195f0: 6f64 7920 7061 7274 206f 6e6c 790a 2020  ody part only.  
-00019600: 2020 2020 2020 6966 2028 7374 6174 6963        if (static
-00019610: 3a3a 454e 434f 4449 4e47 5f42 4153 4536  ::ENCODING_BASE6
-00019620: 3420 213d 3d20 2474 6869 732d 3e45 6e63  4 !== $this->Enc
-00019630: 6f64 696e 6720 2626 2073 7461 7469 633a  oding && static:
-00019640: 3a68 6173 4c69 6e65 4c6f 6e67 6572 5468  :hasLineLongerTh
-00019650: 616e 4d61 7828 2474 6869 732d 3e42 6f64  anMax($this->Bod
-00019660: 7929 2920 7b0a 2020 2020 2020 2020 2020  y)) {.          
-00019670: 2020 2462 6f64 7945 6e63 6f64 696e 6720    $bodyEncoding 
-00019680: 3d20 7374 6174 6963 3a3a 454e 434f 4449  = static::ENCODI
-00019690: 4e47 5f51 554f 5445 445f 5052 494e 5441  NG_QUOTED_PRINTA
-000196a0: 424c 453b 0a20 2020 2020 2020 207d 0a0a  BLE;.        }..
-000196b0: 2020 2020 2020 2020 2461 6c74 426f 6479          $altBody
-000196c0: 456e 636f 6469 6e67 203d 2024 7468 6973  Encoding = $this
-000196d0: 2d3e 456e 636f 6469 6e67 3b0a 2020 2020  ->Encoding;.    
-000196e0: 2020 2020 2461 6c74 426f 6479 4368 6172      $altBodyChar
-000196f0: 5365 7420 3d20 2474 6869 732d 3e43 6861  Set = $this->Cha
-00019700: 7253 6574 3b0a 2020 2020 2020 2020 2f2f  rSet;.        //
-00019710: 4361 6e20 7765 2064 6f20 6120 372d 6269  Can we do a 7-bi
-00019720: 7420 646f 776e 6772 6164 653f 0a20 2020  t downgrade?.   
-00019730: 2020 2020 2069 6620 2873 7461 7469 633a       if (static:
-00019740: 3a45 4e43 4f44 494e 475f 3842 4954 203d  :ENCODING_8BIT =
-00019750: 3d3d 2024 616c 7442 6f64 7945 6e63 6f64  == $altBodyEncod
-00019760: 696e 6720 2626 2021 2474 6869 732d 3e68  ing && !$this->h
-00019770: 6173 3862 6974 4368 6172 7328 2474 6869  as8bitChars($thi
-00019780: 732d 3e41 6c74 426f 6479 2929 207b 0a20  s->AltBody)) {. 
-00019790: 2020 2020 2020 2020 2020 2024 616c 7442             $altB
-000197a0: 6f64 7945 6e63 6f64 696e 6720 3d20 7374  odyEncoding = st
-000197b0: 6174 6963 3a3a 454e 434f 4449 4e47 5f37  atic::ENCODING_7
-000197c0: 4249 543b 0a20 2020 2020 2020 2020 2020  BIT;.           
-000197d0: 202f 2f41 6c6c 2049 534f 2038 3835 392c   //All ISO 8859,
-000197e0: 2057 696e 646f 7773 2063 6f64 6570 6167   Windows codepag
-000197f0: 6520 616e 6420 5554 462d 3820 6368 6172  e and UTF-8 char
-00019800: 7365 7473 2061 7265 2061 7363 6969 2063  sets are ascii c
-00019810: 6f6d 7061 7469 626c 6520 7570 2074 6f20  ompatible up to 
-00019820: 372d 6269 740a 2020 2020 2020 2020 2020  7-bit.          
-00019830: 2020 2461 6c74 426f 6479 4368 6172 5365    $altBodyCharSe
-00019840: 7420 3d20 7374 6174 6963 3a3a 4348 4152  t = static::CHAR
-00019850: 5345 545f 4153 4349 493b 0a20 2020 2020  SET_ASCII;.     
-00019860: 2020 207d 0a20 2020 2020 2020 202f 2f49     }.        //I
-00019870: 6620 6c69 6e65 7320 6172 6520 746f 6f20  f lines are too 
-00019880: 6c6f 6e67 2c20 616e 6420 7765 2772 6520  long, and we're 
-00019890: 6e6f 7420 616c 7265 6164 7920 7573 696e  not already usin
-000198a0: 6720 616e 2065 6e63 6f64 696e 6720 7468  g an encoding th
-000198b0: 6174 2077 696c 6c20 7368 6f72 7465 6e20  at will shorten 
-000198c0: 7468 656d 2c0a 2020 2020 2020 2020 2f2f  them,.        //
-000198d0: 6368 616e 6765 2074 6f20 7175 6f74 6564  change to quoted
-000198e0: 2d70 7269 6e74 6162 6c65 2074 7261 6e73  -printable trans
-000198f0: 6665 7220 656e 636f 6469 6e67 2066 6f72  fer encoding for
-00019900: 2074 6865 2061 6c74 2062 6f64 7920 7061   the alt body pa
-00019910: 7274 206f 6e6c 790a 2020 2020 2020 2020  rt only.        
-00019920: 6966 2028 7374 6174 6963 3a3a 454e 434f  if (static::ENCO
-00019930: 4449 4e47 5f42 4153 4536 3420 213d 3d20  DING_BASE64 !== 
-00019940: 2461 6c74 426f 6479 456e 636f 6469 6e67  $altBodyEncoding
-00019950: 2026 2620 7374 6174 6963 3a3a 6861 734c   && static::hasL
-00019960: 696e 654c 6f6e 6765 7254 6861 6e4d 6178  ineLongerThanMax
-00019970: 2824 7468 6973 2d3e 416c 7442 6f64 7929  ($this->AltBody)
-00019980: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00019990: 2461 6c74 426f 6479 456e 636f 6469 6e67  $altBodyEncoding
-000199a0: 203d 2073 7461 7469 633a 3a45 4e43 4f44   = static::ENCOD
-000199b0: 494e 475f 5155 4f54 4544 5f50 5249 4e54  ING_QUOTED_PRINT
-000199c0: 4142 4c45 3b0a 2020 2020 2020 2020 7d0a  ABLE;.        }.
-000199d0: 2020 2020 2020 2020 2f2f 5573 6520 7468          //Use th
-000199e0: 6973 2061 7320 6120 7072 6561 6d62 6c65  is as a preamble
-000199f0: 2069 6e20 616c 6c20 6d75 6c74 6970 6172   in all multipar
-00019a00: 7420 6d65 7373 6167 6520 7479 7065 730a  t message types.
-00019a10: 2020 2020 2020 2020 246d 696d 6570 7265          $mimepre
-00019a20: 203d 2027 5468 6973 2069 7320 6120 6d75   = 'This is a mu
-00019a30: 6c74 692d 7061 7274 206d 6573 7361 6765  lti-part message
-00019a40: 2069 6e20 4d49 4d45 2066 6f72 6d61 742e   in MIME format.
-00019a50: 2720 2e20 7374 6174 6963 3a3a 244c 4520  ' . static::$LE 
-00019a60: 2e20 7374 6174 6963 3a3a 244c 453b 0a20  . static::$LE;. 
-00019a70: 2020 2020 2020 2073 7769 7463 6820 2824         switch ($
-00019a80: 7468 6973 2d3e 6d65 7373 6167 655f 7479  this->message_ty
-00019a90: 7065 2920 7b0a 2020 2020 2020 2020 2020  pe) {.          
-00019aa0: 2020 6361 7365 2027 696e 6c69 6e65 273a    case 'inline':
-00019ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019ac0: 2024 626f 6479 202e 3d20 246d 696d 6570   $body .= $mimep
-00019ad0: 7265 3b0a 2020 2020 2020 2020 2020 2020  re;.            
-00019ae0: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-00019af0: 6973 2d3e 6765 7442 6f75 6e64 6172 7928  is->getBoundary(
-00019b00: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
-00019b10: 315d 2c20 2462 6f64 7943 6861 7253 6574  1], $bodyCharSet
-00019b20: 2c20 2727 2c20 2462 6f64 7945 6e63 6f64  , '', $bodyEncod
-00019b30: 696e 6729 3b0a 2020 2020 2020 2020 2020  ing);.          
-00019b40: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-00019b50: 7468 6973 2d3e 656e 636f 6465 5374 7269  this->encodeStri
-00019b60: 6e67 2824 7468 6973 2d3e 426f 6479 2c20  ng($this->Body, 
-00019b70: 2462 6f64 7945 6e63 6f64 696e 6729 3b0a  $bodyEncoding);.
-00019b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b90: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
-00019ba0: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
-00019bb0: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-00019bc0: 7468 6973 2d3e 6174 7461 6368 416c 6c28  this->attachAll(
-00019bd0: 2769 6e6c 696e 6527 2c20 2474 6869 732d  'inline', $this-
-00019be0: 3e62 6f75 6e64 6172 795b 315d 293b 0a20  >boundary[1]);. 
-00019bf0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00019c00: 7265 616b 3b0a 2020 2020 2020 2020 2020  reak;.          
-00019c10: 2020 6361 7365 2027 6174 7461 6368 273a    case 'attach':
-00019c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019c30: 2024 626f 6479 202e 3d20 246d 696d 6570   $body .= $mimep
-00019c40: 7265 3b0a 2020 2020 2020 2020 2020 2020  re;.            
-00019c50: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-00019c60: 6973 2d3e 6765 7442 6f75 6e64 6172 7928  is->getBoundary(
-00019c70: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
-00019c80: 315d 2c20 2462 6f64 7943 6861 7253 6574  1], $bodyCharSet
-00019c90: 2c20 2727 2c20 2462 6f64 7945 6e63 6f64  , '', $bodyEncod
-00019ca0: 696e 6729 3b0a 2020 2020 2020 2020 2020  ing);.          
-00019cb0: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-00019cc0: 7468 6973 2d3e 656e 636f 6465 5374 7269  this->encodeStri
-00019cd0: 6e67 2824 7468 6973 2d3e 426f 6479 2c20  ng($this->Body, 
-00019ce0: 2462 6f64 7945 6e63 6f64 696e 6729 3b0a  $bodyEncoding);.
-00019cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d00: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
-00019d10: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
-00019d20: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-00019d30: 7468 6973 2d3e 6174 7461 6368 416c 6c28  this->attachAll(
-00019d40: 2761 7474 6163 686d 656e 7427 2c20 2474  'attachment', $t
-00019d50: 6869 732d 3e62 6f75 6e64 6172 795b 315d  his->boundary[1]
-00019d60: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-00019d70: 2020 2062 7265 616b 3b0a 2020 2020 2020     break;.      
-00019d80: 2020 2020 2020 6361 7365 2027 696e 6c69        case 'inli
-00019d90: 6e65 5f61 7474 6163 6827 3a0a 2020 2020  ne_attach':.    
-00019da0: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
-00019db0: 7920 2e3d 2024 6d69 6d65 7072 653b 0a20  y .= $mimepre;. 
-00019dc0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00019dd0: 626f 6479 202e 3d20 2474 6869 732d 3e74  body .= $this->t
-00019de0: 6578 744c 696e 6528 272d 2d27 202e 2024  extLine('--' . $
-00019df0: 7468 6973 2d3e 626f 756e 6461 7279 5b31  this->boundary[1
-00019e00: 5d29 3b0a 2020 2020 2020 2020 2020 2020  ]);.            
-00019e10: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-00019e20: 6973 2d3e 6865 6164 6572 4c69 6e65 2827  is->headerLine('
-00019e30: 436f 6e74 656e 742d 5479 7065 272c 2073  Content-Type', s
-00019e40: 7461 7469 633a 3a43 4f4e 5445 4e54 5f54  tatic::CONTENT_T
-00019e50: 5950 455f 4d55 4c54 4950 4152 545f 5245  YPE_MULTIPART_RE
-00019e60: 4c41 5445 4420 2e20 273b 2729 3b0a 2020  LATED . ';');.  
-00019e70: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-00019e80: 6f64 7920 2e3d 2024 7468 6973 2d3e 7465  ody .= $this->te
-00019e90: 7874 4c69 6e65 2827 2062 6f75 6e64 6172  xtLine(' boundar
-00019ea0: 793d 2227 202e 2024 7468 6973 2d3e 626f  y="' . $this->bo
-00019eb0: 756e 6461 7279 5b32 5d20 2e20 2722 3b27  undary[2] . '";'
-00019ec0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-00019ed0: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
-00019ee0: 732d 3e74 6578 744c 696e 6528 2720 7479  s->textLine(' ty
-00019ef0: 7065 3d22 2720 2e20 7374 6174 6963 3a3a  pe="' . static::
-00019f00: 434f 4e54 454e 545f 5459 5045 5f54 4558  CONTENT_TYPE_TEX
-00019f10: 545f 4854 4d4c 202e 2027 2227 293b 0a20  T_HTML . '"');. 
-00019f20: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00019f30: 626f 6479 202e 3d20 7374 6174 6963 3a3a  body .= static::
-00019f40: 244c 453b 0a20 2020 2020 2020 2020 2020  $LE;.           
-00019f50: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
-00019f60: 6869 732d 3e67 6574 426f 756e 6461 7279  his->getBoundary
-00019f70: 2824 7468 6973 2d3e 626f 756e 6461 7279  ($this->boundary
-00019f80: 5b32 5d2c 2024 626f 6479 4368 6172 5365  [2], $bodyCharSe
-00019f90: 742c 2027 272c 2024 626f 6479 456e 636f  t, '', $bodyEnco
-00019fa0: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
-00019fb0: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
-00019fc0: 2474 6869 732d 3e65 6e63 6f64 6553 7472  $this->encodeStr
-00019fd0: 696e 6728 2474 6869 732d 3e42 6f64 792c  ing($this->Body,
-00019fe0: 2024 626f 6479 456e 636f 6469 6e67 293b   $bodyEncoding);
-00019ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a000: 2024 626f 6479 202e 3d20 7374 6174 6963   $body .= static
-0001a010: 3a3a 244c 453b 0a20 2020 2020 2020 2020  ::$LE;.         
-0001a020: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
-0001a030: 2474 6869 732d 3e61 7474 6163 6841 6c6c  $this->attachAll
-0001a040: 2827 696e 6c69 6e65 272c 2024 7468 6973  ('inline', $this
-0001a050: 2d3e 626f 756e 6461 7279 5b32 5d29 3b0a  ->boundary[2]);.
-0001a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a070: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
-0001a080: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
-0001a090: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-0001a0a0: 7468 6973 2d3e 6174 7461 6368 416c 6c28  this->attachAll(
-0001a0b0: 2761 7474 6163 686d 656e 7427 2c20 2474  'attachment', $t
-0001a0c0: 6869 732d 3e62 6f75 6e64 6172 795b 315d  his->boundary[1]
-0001a0d0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0001a0e0: 2020 2062 7265 616b 3b0a 2020 2020 2020     break;.      
-0001a0f0: 2020 2020 2020 6361 7365 2027 616c 7427        case 'alt'
-0001a100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a110: 2020 2462 6f64 7920 2e3d 2024 6d69 6d65    $body .= $mime
-0001a120: 7072 653b 0a20 2020 2020 2020 2020 2020  pre;.           
-0001a130: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
-0001a140: 6869 732d 3e67 6574 426f 756e 6461 7279  his->getBoundary
-0001a150: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001a160: 2020 2020 2020 2474 6869 732d 3e62 6f75        $this->bou
-0001a170: 6e64 6172 795b 315d 2c0a 2020 2020 2020  ndary[1],.      
-0001a180: 2020 2020 2020 2020 2020 2020 2020 2461                $a
-0001a190: 6c74 426f 6479 4368 6172 5365 742c 0a20  ltBodyCharSet,. 
-0001a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1b0: 2020 2073 7461 7469 633a 3a43 4f4e 5445     static::CONTE
-0001a1c0: 4e54 5f54 5950 455f 504c 4149 4e54 4558  NT_TYPE_PLAINTEX
-0001a1d0: 542c 0a20 2020 2020 2020 2020 2020 2020  T,.             
-0001a1e0: 2020 2020 2020 2024 616c 7442 6f64 7945         $altBodyE
-0001a1f0: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
-0001a200: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
-0001a210: 2020 2020 2020 2020 2020 2024 626f 6479             $body
-0001a220: 202e 3d20 2474 6869 732d 3e65 6e63 6f64   .= $this->encod
-0001a230: 6553 7472 696e 6728 2474 6869 732d 3e41  eString($this->A
-0001a240: 6c74 426f 6479 2c20 2461 6c74 426f 6479  ltBody, $altBody
-0001a250: 456e 636f 6469 6e67 293b 0a20 2020 2020  Encoding);.     
-0001a260: 2020 2020 2020 2020 2020 2024 626f 6479             $body
-0001a270: 202e 3d20 7374 6174 6963 3a3a 244c 453b   .= static::$LE;
-0001a280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a290: 2024 626f 6479 202e 3d20 2474 6869 732d   $body .= $this-
-0001a2a0: 3e67 6574 426f 756e 6461 7279 280a 2020  >getBoundary(.  
-0001a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2c0: 2020 2474 6869 732d 3e62 6f75 6e64 6172    $this->boundar
-0001a2d0: 795b 315d 2c0a 2020 2020 2020 2020 2020  y[1],.          
-0001a2e0: 2020 2020 2020 2020 2020 2462 6f64 7943            $bodyC
-0001a2f0: 6861 7253 6574 2c0a 2020 2020 2020 2020  harSet,.        
-0001a300: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-0001a310: 6963 3a3a 434f 4e54 454e 545f 5459 5045  ic::CONTENT_TYPE
-0001a320: 5f54 4558 545f 4854 4d4c 2c0a 2020 2020  _TEXT_HTML,.    
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2462 6f64 7945 6e63 6f64 696e 670a 2020  $bodyEncoding.  
-0001a350: 2020 2020 2020 2020 2020 2020 2020 293b                );
-0001a360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a370: 2024 626f 6479 202e 3d20 2474 6869 732d   $body .= $this-
-0001a380: 3e65 6e63 6f64 6553 7472 696e 6728 2474  >encodeString($t
-0001a390: 6869 732d 3e42 6f64 792c 2024 626f 6479  his->Body, $body
-0001a3a0: 456e 636f 6469 6e67 293b 0a20 2020 2020  Encoding);.     
-0001a3b0: 2020 2020 2020 2020 2020 2024 626f 6479             $body
-0001a3c0: 202e 3d20 7374 6174 6963 3a3a 244c 453b   .= static::$LE;
-0001a3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a3e0: 2069 6620 2821 656d 7074 7928 2474 6869   if (!empty($thi
-0001a3f0: 732d 3e49 6361 6c29 2920 7b0a 2020 2020  s->Ical)) {.    
-0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a410: 246d 6574 686f 6420 3d20 7374 6174 6963  $method = static
-0001a420: 3a3a 4943 414c 5f4d 4554 484f 445f 5245  ::ICAL_METHOD_RE
-0001a430: 5155 4553 543b 0a20 2020 2020 2020 2020  QUEST;.         
-0001a440: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
-0001a450: 6368 2028 7374 6174 6963 3a3a 2449 6361  ch (static::$Ica
-0001a460: 6c4d 6574 686f 6473 2061 7320 2469 6d65  lMethods as $ime
-0001a470: 7468 6f64 2920 7b0a 2020 2020 2020 2020  thod) {.        
-0001a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a490: 6966 2028 7374 7269 706f 7328 2474 6869  if (stripos($thi
-0001a4a0: 732d 3e49 6361 6c2c 2027 4d45 5448 4f44  s->Ical, 'METHOD
-0001a4b0: 3a27 202e 2024 696d 6574 686f 6429 2021  :' . $imethod) !
-0001a4c0: 3d3d 2066 616c 7365 2920 7b0a 2020 2020  == false) {.    
-0001a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4e0: 2020 2020 2020 2020 246d 6574 686f 6420          $method 
-0001a4f0: 3d20 2469 6d65 7468 6f64 3b0a 2020 2020  = $imethod;.    
-0001a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a510: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
-0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a530: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0001a540: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-0001a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a560: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
-0001a570: 732d 3e67 6574 426f 756e 6461 7279 280a  s->getBoundary(.
-0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a590: 2020 2020 2020 2020 2474 6869 732d 3e62          $this->b
-0001a5a0: 6f75 6e64 6172 795b 315d 2c0a 2020 2020  oundary[1],.    
-0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5c0: 2020 2020 2727 2c0a 2020 2020 2020 2020      '',.        
-0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5e0: 7374 6174 6963 3a3a 434f 4e54 454e 545f  static::CONTENT_
-0001a5f0: 5459 5045 5f54 4558 545f 4341 4c45 4e44  TYPE_TEXT_CALEND
-0001a600: 4152 202e 2027 3b20 6d65 7468 6f64 3d27  AR . '; method='
-0001a610: 202e 2024 6d65 7468 6f64 2c0a 2020 2020   . $method,.    
-0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 2020 2020 2727 0a20 2020 2020 2020 2020      ''.         
-0001a640: 2020 2020 2020 2020 2020 2029 3b0a 2020             );.  
-0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a660: 2020 2462 6f64 7920 2e3d 2024 7468 6973    $body .= $this
-0001a670: 2d3e 656e 636f 6465 5374 7269 6e67 2824  ->encodeString($
-0001a680: 7468 6973 2d3e 4963 616c 2c20 2474 6869  this->Ical, $thi
-0001a690: 732d 3e45 6e63 6f64 696e 6729 3b0a 2020  s->Encoding);.  
-0001a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6b0: 2020 2462 6f64 7920 2e3d 2073 7461 7469    $body .= stati
-0001a6c0: 633a 3a24 4c45 3b0a 2020 2020 2020 2020  c::$LE;.        
-0001a6d0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0001a6e0: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001a6f0: 2e3d 2024 7468 6973 2d3e 656e 6442 6f75  .= $this->endBou
-0001a700: 6e64 6172 7928 2474 6869 732d 3e62 6f75  ndary($this->bou
-0001a710: 6e64 6172 795b 315d 293b 0a20 2020 2020  ndary[1]);.     
-0001a720: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0001a730: 3b0a 2020 2020 2020 2020 2020 2020 6361  ;.            ca
-0001a740: 7365 2027 616c 745f 696e 6c69 6e65 273a  se 'alt_inline':
-0001a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a760: 2024 626f 6479 202e 3d20 246d 696d 6570   $body .= $mimep
-0001a770: 7265 3b0a 2020 2020 2020 2020 2020 2020  re;.            
-0001a780: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-0001a790: 6973 2d3e 6765 7442 6f75 6e64 6172 7928  is->getBoundary(
-0001a7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a7b0: 2020 2020 2024 7468 6973 2d3e 626f 756e       $this->boun
-0001a7c0: 6461 7279 5b31 5d2c 0a20 2020 2020 2020  dary[1],.       
-0001a7d0: 2020 2020 2020 2020 2020 2020 2024 616c               $al
-0001a7e0: 7442 6f64 7943 6861 7253 6574 2c0a 2020  tBodyCharSet,.  
+00017600: 202f 2f46 6972 7374 2062 7974 6520 6f66   //First byte of
+00017610: 2061 206d 756c 7469 2062 7974 6520 6368   a multi byte ch
+00017620: 6172 6163 7465 720a 2020 2020 2020 2020  aracter.        
+00017630: 2020 2020 2020 2020 2020 2020 2f2f 5265              //Re
+00017640: 6475 6365 206d 6178 4c65 6e67 7468 2074  duce maxLength t
+00017650: 6f20 7370 6c69 7420 6174 2073 7461 7274  o split at start
+00017660: 206f 6620 6368 6172 6163 7465 720a 2020   of character.  
+00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017680: 2020 246d 6178 4c65 6e67 7468 202d 3d20    $maxLength -= 
+00017690: 246c 6f6f 6b42 6163 6b20 2d20 2465 6e63  $lookBack - $enc
+000176a0: 6f64 6564 4368 6172 506f 733b 0a20 2020  odedCharPos;.   
+000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176c0: 2024 666f 756e 6453 706c 6974 506f 7320   $foundSplitPos 
+000176d0: 3d20 7472 7565 3b0a 2020 2020 2020 2020  = true;.        
+000176e0: 2020 2020 2020 2020 7d20 656c 7365 6966          } elseif
+000176f0: 2028 2464 6563 203c 2031 3932 2920 7b0a   ($dec < 192) {.
+00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017710: 2020 2020 2f2f 4d69 6464 6c65 2062 7974      //Middle byt
+00017720: 6520 6f66 2061 206d 756c 7469 2062 7974  e of a multi byt
+00017730: 6520 6368 6172 6163 7465 722c 206c 6f6f  e character, loo
+00017740: 6b20 6675 7274 6865 7220 6261 636b 0a20  k further back. 
+00017750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017760: 2020 2024 6c6f 6f6b 4261 636b 202b 3d20     $lookBack += 
+00017770: 333b 0a20 2020 2020 2020 2020 2020 2020  3;.             
+00017780: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00017790: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
+000177a0: 2020 2020 2020 2020 2020 2f2f 4e6f 2065            //No e
+000177b0: 6e63 6f64 6564 2063 6861 7261 6374 6572  ncoded character
+000177c0: 2066 6f75 6e64 0a20 2020 2020 2020 2020   found.         
+000177d0: 2020 2020 2020 2024 666f 756e 6453 706c         $foundSpl
+000177e0: 6974 506f 7320 3d20 7472 7565 3b0a 2020  itPos = true;.  
+000177f0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00017800: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
+00017810: 6574 7572 6e20 246d 6178 4c65 6e67 7468  eturn $maxLength
+00017820: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+00017830: 0a20 2020 2020 2a20 4170 706c 7920 776f  .     * Apply wo
+00017840: 7264 2077 7261 7070 696e 6720 746f 2074  rd wrapping to t
+00017850: 6865 206d 6573 7361 6765 2062 6f64 792e  he message body.
+00017860: 0a20 2020 2020 2a20 5772 6170 7320 7468  .     * Wraps th
+00017870: 6520 6d65 7373 6167 6520 626f 6479 2074  e message body t
+00017880: 6f20 7468 6520 6e75 6d62 6572 206f 6620  o the number of 
+00017890: 6368 6172 7320 7365 7420 696e 2074 6865  chars set in the
+000178a0: 2057 6f72 6457 7261 7020 7072 6f70 6572   WordWrap proper
+000178b0: 7479 2e0a 2020 2020 202a 2059 6f75 2073  ty..     * You s
+000178c0: 686f 756c 6420 6f6e 6c79 2064 6f20 7468  hould only do th
+000178d0: 6973 2074 6f20 706c 6169 6e2d 7465 7874  is to plain-text
+000178e0: 2062 6f64 6965 7320 6173 2077 7261 7070   bodies as wrapp
+000178f0: 696e 6720 4854 4d4c 2074 6167 7320 6d61  ing HTML tags ma
+00017900: 7920 6272 6561 6b20 7468 656d 2e0a 2020  y break them..  
+00017910: 2020 202a 2054 6869 7320 6973 2063 616c     * This is cal
+00017920: 6c65 6420 6175 746f 6d61 7469 6361 6c6c  led automaticall
+00017930: 7920 6279 2063 7265 6174 6542 6f64 7928  y by createBody(
+00017940: 292c 2073 6f20 796f 7520 646f 6e27 7420  ), so you don't 
+00017950: 6e65 6564 2074 6f20 6361 6c6c 2069 7420  need to call it 
+00017960: 796f 7572 7365 6c66 2e0a 2020 2020 202a  yourself..     *
+00017970: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+00017980: 6374 696f 6e20 7365 7457 6f72 6457 7261  ction setWordWra
+00017990: 7028 290a 2020 2020 7b0a 2020 2020 2020  p().    {.      
+000179a0: 2020 6966 2028 2474 6869 732d 3e57 6f72    if ($this->Wor
+000179b0: 6457 7261 7020 3c20 3129 207b 0a20 2020  dWrap < 1) {.   
+000179c0: 2020 2020 2020 2020 2072 6574 7572 6e3b           return;
+000179d0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+000179e0: 2020 2020 7377 6974 6368 2028 2474 6869      switch ($thi
+000179f0: 732d 3e6d 6573 7361 6765 5f74 7970 6529  s->message_type)
+00017a00: 207b 0a20 2020 2020 2020 2020 2020 2063   {.            c
+00017a10: 6173 6520 2761 6c74 273a 0a20 2020 2020  ase 'alt':.     
+00017a20: 2020 2020 2020 2063 6173 6520 2761 6c74         case 'alt
+00017a30: 5f69 6e6c 696e 6527 3a0a 2020 2020 2020  _inline':.      
+00017a40: 2020 2020 2020 6361 7365 2027 616c 745f        case 'alt_
+00017a50: 6174 7461 6368 273a 0a20 2020 2020 2020  attach':.       
+00017a60: 2020 2020 2063 6173 6520 2761 6c74 5f69       case 'alt_i
+00017a70: 6e6c 696e 655f 6174 7461 6368 273a 0a20  nline_attach':. 
+00017a80: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00017a90: 7468 6973 2d3e 416c 7442 6f64 7920 3d20  this->AltBody = 
+00017aa0: 2474 6869 732d 3e77 7261 7054 6578 7428  $this->wrapText(
+00017ab0: 2474 6869 732d 3e41 6c74 426f 6479 2c20  $this->AltBody, 
+00017ac0: 2474 6869 732d 3e57 6f72 6457 7261 7029  $this->WordWrap)
+00017ad0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00017ae0: 2020 6272 6561 6b3b 0a20 2020 2020 2020    break;.       
+00017af0: 2020 2020 2064 6566 6175 6c74 3a0a 2020       default:.  
+00017b00: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+00017b10: 6869 732d 3e42 6f64 7920 3d20 2474 6869  his->Body = $thi
+00017b20: 732d 3e77 7261 7054 6578 7428 2474 6869  s->wrapText($thi
+00017b30: 732d 3e42 6f64 792c 2024 7468 6973 2d3e  s->Body, $this->
+00017b40: 576f 7264 5772 6170 293b 0a20 2020 2020  WordWrap);.     
+00017b50: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00017b60: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00017b70: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00017b80: 2a20 4173 7365 6d62 6c65 206d 6573 7361  * Assemble messa
+00017b90: 6765 2068 6561 6465 7273 2e0a 2020 2020  ge headers..    
+00017ba0: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+00017bb0: 6e20 7374 7269 6e67 2054 6865 2061 7373  n string The ass
+00017bc0: 656d 626c 6564 2068 6561 6465 7273 0a20  embled headers. 
+00017bd0: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00017be0: 6320 6675 6e63 7469 6f6e 2063 7265 6174  c function creat
+00017bf0: 6548 6561 6465 7228 290a 2020 2020 7b0a  eHeader().    {.
+00017c00: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
+00017c10: 3d20 2727 3b0a 0a20 2020 2020 2020 2024  = '';..        $
+00017c20: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
+00017c30: 3e68 6561 6465 724c 696e 6528 2744 6174  >headerLine('Dat
+00017c40: 6527 2c20 2727 203d 3d3d 2024 7468 6973  e', '' === $this
+00017c50: 2d3e 4d65 7373 6167 6544 6174 6520 3f20  ->MessageDate ? 
+00017c60: 7365 6c66 3a3a 7266 6344 6174 6528 2920  self::rfcDate() 
+00017c70: 3a20 2474 6869 732d 3e4d 6573 7361 6765  : $this->Message
+00017c80: 4461 7465 293b 0a0a 2020 2020 2020 2020  Date);..        
+00017c90: 2f2f 5468 6520 546f 2068 6561 6465 7220  //The To header 
+00017ca0: 6973 2063 7265 6174 6564 2061 7574 6f6d  is created autom
+00017cb0: 6174 6963 616c 6c79 2062 7920 6d61 696c  atically by mail
+00017cc0: 2829 2c20 736f 206e 6565 6473 2074 6f20  (), so needs to 
+00017cd0: 6265 206f 6d69 7474 6564 2068 6572 650a  be omitted here.
+00017ce0: 2020 2020 2020 2020 6966 2028 276d 6169          if ('mai
+00017cf0: 6c27 2021 3d3d 2024 7468 6973 2d3e 4d61  l' !== $this->Ma
+00017d00: 696c 6572 2920 7b0a 2020 2020 2020 2020  iler) {.        
+00017d10: 2020 2020 6966 2028 2474 6869 732d 3e53      if ($this->S
+00017d20: 696e 676c 6554 6f29 207b 0a20 2020 2020  ingleTo) {.     
+00017d30: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
+00017d40: 6368 2028 2474 6869 732d 3e74 6f20 6173  ch ($this->to as
+00017d50: 2024 746f 6164 6472 2920 7b0a 2020 2020   $toaddr) {.    
+00017d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d70: 2474 6869 732d 3e53 696e 676c 6554 6f41  $this->SingleToA
+00017d80: 7272 6179 5b5d 203d 2024 7468 6973 2d3e  rray[] = $this->
+00017d90: 6164 6472 466f 726d 6174 2824 746f 6164  addrFormat($toad
+00017da0: 6472 293b 0a20 2020 2020 2020 2020 2020  dr);.           
+00017db0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00017dc0: 2020 207d 2065 6c73 6569 6620 2863 6f75     } elseif (cou
+00017dd0: 6e74 2824 7468 6973 2d3e 746f 2920 3e20  nt($this->to) > 
+00017de0: 3029 207b 0a20 2020 2020 2020 2020 2020  0) {.           
+00017df0: 2020 2020 2024 7265 7375 6c74 202e 3d20       $result .= 
+00017e00: 2474 6869 732d 3e61 6464 7241 7070 656e  $this->addrAppen
+00017e10: 6428 2754 6f27 2c20 2474 6869 732d 3e74  d('To', $this->t
+00017e20: 6f29 3b0a 2020 2020 2020 2020 2020 2020  o);.            
+00017e30: 7d20 656c 7365 6966 2028 636f 756e 7428  } elseif (count(
+00017e40: 2474 6869 732d 3e63 6329 203d 3d3d 2030  $this->cc) === 0
+00017e50: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00017e60: 2020 2020 2472 6573 756c 7420 2e3d 2024      $result .= $
+00017e70: 7468 6973 2d3e 6865 6164 6572 4c69 6e65  this->headerLine
+00017e80: 2827 546f 272c 2027 756e 6469 7363 6c6f  ('To', 'undisclo
+00017e90: 7365 642d 7265 6369 7069 656e 7473 3a3b  sed-recipients:;
+00017ea0: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
+00017eb0: 7d0a 2020 2020 2020 2020 7d0a 2020 2020  }.        }.    
+00017ec0: 2020 2020 2472 6573 756c 7420 2e3d 2024      $result .= $
+00017ed0: 7468 6973 2d3e 6164 6472 4170 7065 6e64  this->addrAppend
+00017ee0: 2827 4672 6f6d 272c 205b 5b74 7269 6d28  ('From', [[trim(
+00017ef0: 2474 6869 732d 3e46 726f 6d29 2c20 2474  $this->From), $t
+00017f00: 6869 732d 3e46 726f 6d4e 616d 655d 5d29  his->FromName]])
+00017f10: 3b0a 0a20 2020 2020 2020 202f 2f73 656e  ;..        //sen
+00017f20: 646d 6169 6c20 616e 6420 6d61 696c 2829  dmail and mail()
+00017f30: 2065 7874 7261 6374 2043 6320 6672 6f6d   extract Cc from
+00017f40: 2074 6865 2068 6561 6465 7220 6265 666f   the header befo
+00017f50: 7265 2073 656e 6469 6e67 0a20 2020 2020  re sending.     
+00017f60: 2020 2069 6620 2863 6f75 6e74 2824 7468     if (count($th
+00017f70: 6973 2d3e 6363 2920 3e20 3029 207b 0a20  is->cc) > 0) {. 
+00017f80: 2020 2020 2020 2020 2020 2024 7265 7375             $resu
+00017f90: 6c74 202e 3d20 2474 6869 732d 3e61 6464  lt .= $this->add
+00017fa0: 7241 7070 656e 6428 2743 6327 2c20 2474  rAppend('Cc', $t
+00017fb0: 6869 732d 3e63 6329 3b0a 2020 2020 2020  his->cc);.      
+00017fc0: 2020 7d0a 0a20 2020 2020 2020 202f 2f73    }..        //s
+00017fd0: 656e 646d 6169 6c20 616e 6420 6d61 696c  endmail and mail
+00017fe0: 2829 2065 7874 7261 6374 2042 6363 2066  () extract Bcc f
+00017ff0: 726f 6d20 7468 6520 6865 6164 6572 2062  rom the header b
+00018000: 6566 6f72 6520 7365 6e64 696e 670a 2020  efore sending.  
+00018010: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00018020: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00018030: 2020 2020 2020 2020 2027 7365 6e64 6d61           'sendma
+00018040: 696c 2720 3d3d 3d20 2474 6869 732d 3e4d  il' === $this->M
+00018050: 6169 6c65 7220 7c7c 2027 716d 6169 6c27  ailer || 'qmail'
+00018060: 203d 3d3d 2024 7468 6973 2d3e 4d61 696c   === $this->Mail
+00018070: 6572 207c 7c20 276d 6169 6c27 203d 3d3d  er || 'mail' ===
+00018080: 2024 7468 6973 2d3e 4d61 696c 6572 0a20   $this->Mailer. 
+00018090: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000180a0: 2020 2020 2020 2020 2026 2620 636f 756e           && coun
+000180b0: 7428 2474 6869 732d 3e62 6363 2920 3e20  t($this->bcc) > 
+000180c0: 300a 2020 2020 2020 2020 2920 7b0a 2020  0.        ) {.  
+000180d0: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
+000180e0: 7420 2e3d 2024 7468 6973 2d3e 6164 6472  t .= $this->addr
+000180f0: 4170 7065 6e64 2827 4263 6327 2c20 2474  Append('Bcc', $t
+00018100: 6869 732d 3e62 6363 293b 0a20 2020 2020  his->bcc);.     
+00018110: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
+00018120: 2028 636f 756e 7428 2474 6869 732d 3e52   (count($this->R
+00018130: 6570 6c79 546f 2920 3e20 3029 207b 0a20  eplyTo) > 0) {. 
+00018140: 2020 2020 2020 2020 2020 2024 7265 7375             $resu
+00018150: 6c74 202e 3d20 2474 6869 732d 3e61 6464  lt .= $this->add
+00018160: 7241 7070 656e 6428 2752 6570 6c79 2d54  rAppend('Reply-T
+00018170: 6f27 2c20 2474 6869 732d 3e52 6570 6c79  o', $this->Reply
+00018180: 546f 293b 0a20 2020 2020 2020 207d 0a0a  To);.        }..
+00018190: 2020 2020 2020 2020 2f2f 6d61 696c 2829          //mail()
+000181a0: 2073 6574 7320 7468 6520 7375 626a 6563   sets the subjec
+000181b0: 7420 6974 7365 6c66 0a20 2020 2020 2020  t itself.       
+000181c0: 2069 6620 2827 6d61 696c 2720 213d 3d20   if ('mail' !== 
+000181d0: 2474 6869 732d 3e4d 6169 6c65 7229 207b  $this->Mailer) {
+000181e0: 0a20 2020 2020 2020 2020 2020 2024 7265  .            $re
+000181f0: 7375 6c74 202e 3d20 2474 6869 732d 3e68  sult .= $this->h
+00018200: 6561 6465 724c 696e 6528 2753 7562 6a65  eaderLine('Subje
+00018210: 6374 272c 2024 7468 6973 2d3e 656e 636f  ct', $this->enco
+00018220: 6465 4865 6164 6572 2824 7468 6973 2d3e  deHeader($this->
+00018230: 7365 6375 7265 4865 6164 6572 2824 7468  secureHeader($th
+00018240: 6973 2d3e 5375 626a 6563 7429 2929 3b0a  is->Subject)));.
+00018250: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+00018260: 2020 202f 2f4f 6e6c 7920 616c 6c6f 7720     //Only allow 
+00018270: 6120 6375 7374 6f6d 206d 6573 7361 6765  a custom message
+00018280: 2049 4420 6966 2069 7420 636f 6e66 6f72   ID if it confor
+00018290: 6d73 2074 6f20 5246 4320 3533 3232 2073  ms to RFC 5322 s
+000182a0: 6563 7469 6f6e 2033 2e36 2e34 0a20 2020  ection 3.6.4.   
+000182b0: 2020 2020 202f 2f68 7474 7073 3a2f 2f74       //https://t
+000182c0: 6f6f 6c73 2e69 6574 662e 6f72 672f 6874  ools.ietf.org/ht
+000182d0: 6d6c 2f72 6663 3533 3232 2373 6563 7469  ml/rfc5322#secti
+000182e0: 6f6e 2d33 2e36 2e34 0a20 2020 2020 2020  on-3.6.4.       
+000182f0: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00018300: 2020 2727 2021 3d3d 2024 7468 6973 2d3e    '' !== $this->
+00018310: 4d65 7373 6167 6549 4420 2626 0a20 2020  MessageID &&.   
+00018320: 2020 2020 2020 2020 2070 7265 675f 6d61           preg_ma
+00018330: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
+00018340: 2020 2020 2027 2f5e 3c28 2828 5b61 2d7a       '/^<((([a-z
+00018350: 5c64 2123 2425 265c 272a 2b5c 2f3d 3f5e  \d!#$%&\'*+\/=?^
+00018360: 5f60 7b7c 7d7e 2d5d 2b28 5c2e 5b61 2d7a  _`{|}~-]+(\.[a-z
+00018370: 5c64 2123 2425 265c 272a 2b5c 2f3d 3f5e  \d!#$%&\'*+\/=?^
+00018380: 5f60 7b7c 7d7e 2d5d 2b29 2a29 2720 2e0a  _`{|}~-]+)*)' ..
+00018390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183a0: 277c 2822 2828 5b5c 7830 312d 5c78 3038  '|("(([\x01-\x08
+000183b0: 5c78 3042 5c78 3043 5c78 3045 2d5c 7831  \x0B\x0C\x0E-\x1
+000183c0: 465c 7837 465d 7c5b 5c78 3231 5c78 3233  F\x7F]|[\x21\x23
+000183d0: 2d5c 7835 425c 7835 442d 5c78 3745 5d29  -\x5B\x5D-\x7E])
+000183e0: 2720 2e0a 2020 2020 2020 2020 2020 2020  ' ..            
+000183f0: 2020 2020 277c 285c 5c5b 5c78 3031 2d5c      '|(\\[\x01-\
+00018400: 7830 395c 7830 425c 7830 435c 7830 452d  x09\x0B\x0C\x0E-
+00018410: 5c78 3746 5d29 292a 2229 2940 2828 5b61  \x7F]))*"))@(([a
+00018420: 2d7a 5c64 2123 2425 265c 272a 2b5c 2f3d  -z\d!#$%&\'*+\/=
+00018430: 3f5e 5f60 7b7c 7d7e 2d5d 2b27 202e 0a20  ?^_`{|}~-]+' .. 
+00018440: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00018450: 285c 2e5b 612d 7a5c 6421 2324 2526 5c27  (\.[a-z\d!#$%&\'
+00018460: 2a2b 5c2f 3d3f 5e5f 607b 7c7d 7e2d 5d2b  *+\/=?^_`{|}~-]+
+00018470: 292a 297c 285c 5b28 285b 5c78 3031 2d5c  )*)|(\[(([\x01-\
+00018480: 7830 385c 7830 425c 7830 435c 7830 452d  x08\x0B\x0C\x0E-
+00018490: 5c78 3146 5c78 3746 5d27 202e 0a20 2020  \x1F\x7F]' ..   
+000184a0: 2020 2020 2020 2020 2020 2020 2027 7c5b               '|[
+000184b0: 5c78 3231 2d5c 7835 415c 7835 452d 5c78  \x21-\x5A\x5E-\x
+000184c0: 3745 5d29 7c28 5c5c 5b5c 7830 312d 5c78  7E])|(\\[\x01-\x
+000184d0: 3039 5c78 3042 5c78 3043 5c78 3045 2d5c  09\x0B\x0C\x0E-\
+000184e0: 7837 465d 2929 2a5c 5d29 2929 3e24 2f44  x7F]))*\])))>$/D
+000184f0: 6927 2c0a 2020 2020 2020 2020 2020 2020  i',.            
+00018500: 2020 2020 2474 6869 732d 3e4d 6573 7361      $this->Messa
+00018510: 6765 4944 0a20 2020 2020 2020 2020 2020  geID.           
+00018520: 2029 0a20 2020 2020 2020 2029 207b 0a20   ).        ) {. 
+00018530: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00018540: 2d3e 6c61 7374 4d65 7373 6167 6549 4420  ->lastMessageID 
+00018550: 3d20 2474 6869 732d 3e4d 6573 7361 6765  = $this->Message
+00018560: 4944 3b0a 2020 2020 2020 2020 7d20 656c  ID;.        } el
+00018570: 7365 207b 0a20 2020 2020 2020 2020 2020  se {.           
+00018580: 2024 7468 6973 2d3e 6c61 7374 4d65 7373   $this->lastMess
+00018590: 6167 6549 4420 3d20 7370 7269 6e74 6628  ageID = sprintf(
+000185a0: 273c 2573 4025 733e 272c 2024 7468 6973  '<%s@%s>', $this
+000185b0: 2d3e 756e 6971 7565 6964 2c20 2474 6869  ->uniqueid, $thi
+000185c0: 732d 3e73 6572 7665 7248 6f73 746e 616d  s->serverHostnam
+000185d0: 6528 2929 3b0a 2020 2020 2020 2020 7d0a  e());.        }.
+000185e0: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
+000185f0: 2e3d 2024 7468 6973 2d3e 6865 6164 6572  .= $this->header
+00018600: 4c69 6e65 2827 4d65 7373 6167 652d 4944  Line('Message-ID
+00018610: 272c 2024 7468 6973 2d3e 6c61 7374 4d65  ', $this->lastMe
+00018620: 7373 6167 6549 4429 3b0a 2020 2020 2020  ssageID);.      
+00018630: 2020 6966 2028 6e75 6c6c 2021 3d3d 2024    if (null !== $
+00018640: 7468 6973 2d3e 5072 696f 7269 7479 2920  this->Priority) 
+00018650: 7b0a 2020 2020 2020 2020 2020 2020 2472  {.            $r
+00018660: 6573 756c 7420 2e3d 2024 7468 6973 2d3e  esult .= $this->
+00018670: 6865 6164 6572 4c69 6e65 2827 582d 5072  headerLine('X-Pr
+00018680: 696f 7269 7479 272c 2024 7468 6973 2d3e  iority', $this->
+00018690: 5072 696f 7269 7479 293b 0a20 2020 2020  Priority);.     
+000186a0: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
+000186b0: 2827 2720 3d3d 3d20 2474 6869 732d 3e58  ('' === $this->X
+000186c0: 4d61 696c 6572 2920 7b0a 2020 2020 2020  Mailer) {.      
+000186d0: 2020 2020 2020 2f2f 456d 7074 7920 7374        //Empty st
+000186e0: 7269 6e67 2066 6f72 2064 6566 6175 6c74  ring for default
+000186f0: 2058 2d4d 6169 6c65 7220 6865 6164 6572   X-Mailer header
+00018700: 0a20 2020 2020 2020 2020 2020 2024 7265  .            $re
+00018710: 7375 6c74 202e 3d20 2474 6869 732d 3e68  sult .= $this->h
+00018720: 6561 6465 724c 696e 6528 0a20 2020 2020  eaderLine(.     
+00018730: 2020 2020 2020 2020 2020 2027 582d 4d61             'X-Ma
+00018740: 696c 6572 272c 0a20 2020 2020 2020 2020  iler',.         
+00018750: 2020 2020 2020 2027 5048 504d 6169 6c65         'PHPMaile
+00018760: 7220 2720 2e20 7365 6c66 3a3a 5645 5253  r ' . self::VERS
+00018770: 494f 4e20 2e20 2720 2868 7474 7073 3a2f  ION . ' (https:/
+00018780: 2f67 6974 6875 622e 636f 6d2f 5048 504d  /github.com/PHPM
+00018790: 6169 6c65 722f 5048 504d 6169 6c65 7229  ailer/PHPMailer)
+000187a0: 270a 2020 2020 2020 2020 2020 2020 293b  '.            );
+000187b0: 0a20 2020 2020 2020 207d 2065 6c73 6569  .        } elsei
+000187c0: 6620 2869 735f 7374 7269 6e67 2824 7468  f (is_string($th
+000187d0: 6973 2d3e 584d 6169 6c65 7229 2026 2620  is->XMailer) && 
+000187e0: 7472 696d 2824 7468 6973 2d3e 584d 6169  trim($this->XMai
+000187f0: 6c65 7229 2021 3d3d 2027 2729 207b 0a20  ler) !== '') {. 
+00018800: 2020 2020 2020 2020 2020 202f 2f53 6f6d             //Som
+00018810: 6520 7374 7269 6e67 0a20 2020 2020 2020  e string.       
+00018820: 2020 2020 2024 7265 7375 6c74 202e 3d20       $result .= 
+00018830: 2474 6869 732d 3e68 6561 6465 724c 696e  $this->headerLin
+00018840: 6528 2758 2d4d 6169 6c65 7227 2c20 7472  e('X-Mailer', tr
+00018850: 696d 2824 7468 6973 2d3e 584d 6169 6c65  im($this->XMaile
+00018860: 7229 293b 0a20 2020 2020 2020 207d 202f  r));.        } /
+00018870: 2f4f 7468 6572 2076 616c 7565 7320 7265  /Other values re
+00018880: 7375 6c74 2069 6e20 6e6f 2058 2d4d 6169  sult in no X-Mai
+00018890: 6c65 7220 6865 6164 6572 0a0a 2020 2020  ler header..    
+000188a0: 2020 2020 6966 2028 2727 2021 3d3d 2024      if ('' !== $
+000188b0: 7468 6973 2d3e 436f 6e66 6972 6d52 6561  this->ConfirmRea
+000188c0: 6469 6e67 546f 2920 7b0a 2020 2020 2020  dingTo) {.      
+000188d0: 2020 2020 2020 2472 6573 756c 7420 2e3d        $result .=
+000188e0: 2024 7468 6973 2d3e 6865 6164 6572 4c69   $this->headerLi
+000188f0: 6e65 2827 4469 7370 6f73 6974 696f 6e2d  ne('Disposition-
+00018900: 4e6f 7469 6669 6361 7469 6f6e 2d54 6f27  Notification-To'
+00018910: 2c20 273c 2720 2e20 2474 6869 732d 3e43  , '<' . $this->C
+00018920: 6f6e 6669 726d 5265 6164 696e 6754 6f20  onfirmReadingTo 
+00018930: 2e20 273e 2729 3b0a 2020 2020 2020 2020  . '>');.        
+00018940: 7d0a 0a20 2020 2020 2020 202f 2f41 6464  }..        //Add
+00018950: 2063 7573 746f 6d20 6865 6164 6572 730a   custom headers.
+00018960: 2020 2020 2020 2020 666f 7265 6163 6820          foreach 
+00018970: 2824 7468 6973 2d3e 4375 7374 6f6d 4865  ($this->CustomHe
+00018980: 6164 6572 2061 7320 2468 6561 6465 7229  ader as $header)
+00018990: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+000189a0: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
+000189b0: 3e68 6561 6465 724c 696e 6528 0a20 2020  >headerLine(.   
+000189c0: 2020 2020 2020 2020 2020 2020 2074 7269               tri
+000189d0: 6d28 2468 6561 6465 725b 305d 292c 0a20  m($header[0]),. 
+000189e0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+000189f0: 7468 6973 2d3e 656e 636f 6465 4865 6164  this->encodeHead
+00018a00: 6572 2874 7269 6d28 2468 6561 6465 725b  er(trim($header[
+00018a10: 315d 2929 0a20 2020 2020 2020 2020 2020  1])).           
+00018a20: 2029 3b0a 2020 2020 2020 2020 7d0a 2020   );.        }.  
+00018a30: 2020 2020 2020 6966 2028 2124 7468 6973        if (!$this
+00018a40: 2d3e 7369 676e 5f6b 6579 5f66 696c 6529  ->sign_key_file)
+00018a50: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+00018a60: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
+00018a70: 3e68 6561 6465 724c 696e 6528 274d 494d  >headerLine('MIM
+00018a80: 452d 5665 7273 696f 6e27 2c20 2731 2e30  E-Version', '1.0
+00018a90: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
+00018aa0: 2472 6573 756c 7420 2e3d 2024 7468 6973  $result .= $this
+00018ab0: 2d3e 6765 744d 6169 6c4d 494d 4528 293b  ->getMailMIME();
+00018ac0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00018ad0: 2020 2020 7265 7475 726e 2024 7265 7375      return $resu
+00018ae0: 6c74 3b0a 2020 2020 7d0a 0a20 2020 202f  lt;.    }..    /
+00018af0: 2a2a 0a20 2020 2020 2a20 4765 7420 7468  **.     * Get th
+00018b00: 6520 6d65 7373 6167 6520 4d49 4d45 2074  e message MIME t
+00018b10: 7970 6520 6865 6164 6572 732e 0a20 2020  ype headers..   
+00018b20: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+00018b30: 726e 2073 7472 696e 670a 2020 2020 202a  rn string.     *
+00018b40: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+00018b50: 6374 696f 6e20 6765 744d 6169 6c4d 494d  ction getMailMIM
+00018b60: 4528 290a 2020 2020 7b0a 2020 2020 2020  E().    {.      
+00018b70: 2020 2472 6573 756c 7420 3d20 2727 3b0a    $result = '';.
+00018b80: 2020 2020 2020 2020 2469 736d 756c 7469          $ismulti
+00018b90: 7061 7274 203d 2074 7275 653b 0a20 2020  part = true;.   
+00018ba0: 2020 2020 2073 7769 7463 6820 2824 7468       switch ($th
+00018bb0: 6973 2d3e 6d65 7373 6167 655f 7479 7065  is->message_type
+00018bc0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00018bd0: 6361 7365 2027 696e 6c69 6e65 273a 0a20  case 'inline':. 
+00018be0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00018bf0: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
+00018c00: 3e68 6561 6465 724c 696e 6528 2743 6f6e  >headerLine('Con
+00018c10: 7465 6e74 2d54 7970 6527 2c20 7374 6174  tent-Type', stat
+00018c20: 6963 3a3a 434f 4e54 454e 545f 5459 5045  ic::CONTENT_TYPE
+00018c30: 5f4d 554c 5449 5041 5254 5f52 454c 4154  _MULTIPART_RELAT
+00018c40: 4544 202e 2027 3b27 293b 0a20 2020 2020  ED . ';');.     
+00018c50: 2020 2020 2020 2020 2020 2024 7265 7375             $resu
+00018c60: 6c74 202e 3d20 2474 6869 732d 3e74 6578  lt .= $this->tex
+00018c70: 744c 696e 6528 2720 626f 756e 6461 7279  tLine(' boundary
+00018c80: 3d22 2720 2e20 2474 6869 732d 3e62 6f75  ="' . $this->bou
+00018c90: 6e64 6172 795b 315d 202e 2027 2227 293b  ndary[1] . '"');
+00018ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018cb0: 2062 7265 616b 3b0a 2020 2020 2020 2020   break;.        
+00018cc0: 2020 2020 6361 7365 2027 6174 7461 6368      case 'attach
+00018cd0: 273a 0a20 2020 2020 2020 2020 2020 2063  ':.            c
+00018ce0: 6173 6520 2769 6e6c 696e 655f 6174 7461  ase 'inline_atta
+00018cf0: 6368 273a 0a20 2020 2020 2020 2020 2020  ch':.           
+00018d00: 2063 6173 6520 2761 6c74 5f61 7474 6163   case 'alt_attac
+00018d10: 6827 3a0a 2020 2020 2020 2020 2020 2020  h':.            
+00018d20: 6361 7365 2027 616c 745f 696e 6c69 6e65  case 'alt_inline
+00018d30: 5f61 7474 6163 6827 3a0a 2020 2020 2020  _attach':.      
+00018d40: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
+00018d50: 7420 2e3d 2024 7468 6973 2d3e 6865 6164  t .= $this->head
+00018d60: 6572 4c69 6e65 2827 436f 6e74 656e 742d  erLine('Content-
+00018d70: 5479 7065 272c 2073 7461 7469 633a 3a43  Type', static::C
+00018d80: 4f4e 5445 4e54 5f54 5950 455f 4d55 4c54  ONTENT_TYPE_MULT
+00018d90: 4950 4152 545f 4d49 5845 4420 2e20 273b  IPART_MIXED . ';
+00018da0: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
+00018db0: 2020 2020 2472 6573 756c 7420 2e3d 2024      $result .= $
+00018dc0: 7468 6973 2d3e 7465 7874 4c69 6e65 2827  this->textLine('
+00018dd0: 2062 6f75 6e64 6172 793d 2227 202e 2024   boundary="' . $
+00018de0: 7468 6973 2d3e 626f 756e 6461 7279 5b31  this->boundary[1
+00018df0: 5d20 2e20 2722 2729 3b0a 2020 2020 2020  ] . '"');.      
+00018e00: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
+00018e10: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
+00018e20: 6520 2761 6c74 273a 0a20 2020 2020 2020  e 'alt':.       
+00018e30: 2020 2020 2063 6173 6520 2761 6c74 5f69       case 'alt_i
+00018e40: 6e6c 696e 6527 3a0a 2020 2020 2020 2020  nline':.        
+00018e50: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
+00018e60: 2e3d 2024 7468 6973 2d3e 6865 6164 6572  .= $this->header
+00018e70: 4c69 6e65 2827 436f 6e74 656e 742d 5479  Line('Content-Ty
+00018e80: 7065 272c 2073 7461 7469 633a 3a43 4f4e  pe', static::CON
+00018e90: 5445 4e54 5f54 5950 455f 4d55 4c54 4950  TENT_TYPE_MULTIP
+00018ea0: 4152 545f 414c 5445 524e 4154 4956 4520  ART_ALTERNATIVE 
+00018eb0: 2e20 273b 2729 3b0a 2020 2020 2020 2020  . ';');.        
+00018ec0: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
+00018ed0: 2e3d 2024 7468 6973 2d3e 7465 7874 4c69  .= $this->textLi
+00018ee0: 6e65 2827 2062 6f75 6e64 6172 793d 2227  ne(' boundary="'
+00018ef0: 202e 2024 7468 6973 2d3e 626f 756e 6461   . $this->bounda
+00018f00: 7279 5b31 5d20 2e20 2722 2729 3b0a 2020  ry[1] . '"');.  
+00018f10: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00018f20: 6561 6b3b 0a20 2020 2020 2020 2020 2020  eak;.           
+00018f30: 2064 6566 6175 6c74 3a0a 2020 2020 2020   default:.      
+00018f40: 2020 2020 2020 2020 2020 2f2f 4361 7463            //Catc
+00018f50: 6865 7320 6361 7365 2027 706c 6169 6e27  hes case 'plain'
+00018f60: 3a20 616e 6420 6361 7365 2027 273a 0a20  : and case '':. 
+00018f70: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00018f80: 7265 7375 6c74 202e 3d20 2474 6869 732d  result .= $this-
+00018f90: 3e74 6578 744c 696e 6528 2743 6f6e 7465  >textLine('Conte
+00018fa0: 6e74 2d54 7970 653a 2027 202e 2024 7468  nt-Type: ' . $th
+00018fb0: 6973 2d3e 436f 6e74 656e 7454 7970 6520  is->ContentType 
+00018fc0: 2e20 273b 2063 6861 7273 6574 3d27 202e  . '; charset=' .
+00018fd0: 2024 7468 6973 2d3e 4368 6172 5365 7429   $this->CharSet)
+00018fe0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00018ff0: 2020 2469 736d 756c 7469 7061 7274 203d    $ismultipart =
+00019000: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
+00019010: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+00019020: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00019030: 202f 2f52 4643 3133 3431 2070 6172 7420   //RFC1341 part 
+00019040: 3520 7361 7973 2037 6269 7420 6973 2061  5 says 7bit is a
+00019050: 7373 756d 6564 2069 6620 6e6f 7420 7370  ssumed if not sp
+00019060: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
+00019070: 6966 2028 7374 6174 6963 3a3a 454e 434f  if (static::ENCO
+00019080: 4449 4e47 5f37 4249 5420 213d 3d20 2474  DING_7BIT !== $t
+00019090: 6869 732d 3e45 6e63 6f64 696e 6729 207b  his->Encoding) {
+000190a0: 0a20 2020 2020 2020 2020 2020 202f 2f52  .            //R
+000190b0: 4643 2032 3034 3520 7365 6374 696f 6e20  FC 2045 section 
+000190c0: 362e 3420 7361 7973 206d 756c 7469 7061  6.4 says multipa
+000190d0: 7274 204d 494d 4520 7061 7274 7320 6d61  rt MIME parts ma
+000190e0: 7920 6f6e 6c79 2075 7365 2037 6269 742c  y only use 7bit,
+000190f0: 2038 6269 7420 6f72 2062 696e 6172 7920   8bit or binary 
+00019100: 4354 450a 2020 2020 2020 2020 2020 2020  CTE.            
+00019110: 6966 2028 2469 736d 756c 7469 7061 7274  if ($ismultipart
+00019120: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00019130: 2020 2020 6966 2028 7374 6174 6963 3a3a      if (static::
+00019140: 454e 434f 4449 4e47 5f38 4249 5420 3d3d  ENCODING_8BIT ==
+00019150: 3d20 2474 6869 732d 3e45 6e63 6f64 696e  = $this->Encodin
+00019160: 6729 207b 0a20 2020 2020 2020 2020 2020  g) {.           
+00019170: 2020 2020 2020 2020 2024 7265 7375 6c74           $result
+00019180: 202e 3d20 2474 6869 732d 3e68 6561 6465   .= $this->heade
+00019190: 724c 696e 6528 2743 6f6e 7465 6e74 2d54  rLine('Content-T
+000191a0: 7261 6e73 6665 722d 456e 636f 6469 6e67  ransfer-Encoding
+000191b0: 272c 2073 7461 7469 633a 3a45 4e43 4f44  ', static::ENCOD
+000191c0: 494e 475f 3842 4954 293b 0a20 2020 2020  ING_8BIT);.     
+000191d0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+000191e0: 2020 2020 2020 2020 2020 2020 202f 2f54               //T
+000191f0: 6865 206f 6e6c 7920 7265 6d61 696e 696e  he only remainin
+00019200: 6720 616c 7465 726e 6174 6976 6573 2061  g alternatives a
+00019210: 7265 2071 756f 7465 642d 7072 696e 7461  re quoted-printa
+00019220: 626c 6520 616e 6420 6261 7365 3634 2c20  ble and base64, 
+00019230: 7768 6963 6820 6172 6520 626f 7468 2037  which are both 7
+00019240: 6269 7420 636f 6d70 6174 6962 6c65 0a20  bit compatible. 
+00019250: 2020 2020 2020 2020 2020 207d 2065 6c73             } els
+00019260: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+00019270: 2020 2020 2472 6573 756c 7420 2e3d 2024      $result .= $
+00019280: 7468 6973 2d3e 6865 6164 6572 4c69 6e65  this->headerLine
+00019290: 2827 436f 6e74 656e 742d 5472 616e 7366  ('Content-Transf
+000192a0: 6572 2d45 6e63 6f64 696e 6727 2c20 2474  er-Encoding', $t
+000192b0: 6869 732d 3e45 6e63 6f64 696e 6729 3b0a  his->Encoding);.
+000192c0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+000192d0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+000192e0: 2072 6574 7572 6e20 2472 6573 756c 743b   return $result;
+000192f0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+00019300: 2020 2020 202a 2052 6574 7572 6e73 2074       * Returns t
+00019310: 6865 2077 686f 6c65 204d 494d 4520 6d65  he whole MIME me
+00019320: 7373 6167 652e 0a20 2020 2020 2a20 496e  ssage..     * In
+00019330: 636c 7564 6573 2063 6f6d 706c 6574 6520  cludes complete 
+00019340: 6865 6164 6572 7320 616e 6420 626f 6479  headers and body
+00019350: 2e0a 2020 2020 202a 204f 6e6c 7920 7661  ..     * Only va
+00019360: 6c69 6420 706f 7374 2070 7265 5365 6e64  lid post preSend
+00019370: 2829 2e0a 2020 2020 202a 0a20 2020 2020  ()..     *.     
+00019380: 2a20 4073 6565 2050 4850 4d61 696c 6572  * @see PHPMailer
+00019390: 3a3a 7072 6553 656e 6428 290a 2020 2020  ::preSend().    
+000193a0: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+000193b0: 6e20 7374 7269 6e67 0a20 2020 2020 2a2f  n string.     */
+000193c0: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
+000193d0: 7469 6f6e 2067 6574 5365 6e74 4d49 4d45  tion getSentMIME
+000193e0: 4d65 7373 6167 6528 290a 2020 2020 7b0a  Message().    {.
+000193f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00019400: 7461 7469 633a 3a73 7472 6970 5472 6169  tatic::stripTrai
+00019410: 6c69 6e67 5753 5028 2474 6869 732d 3e4d  lingWSP($this->M
+00019420: 494d 4548 6561 6465 7220 2e20 2474 6869  IMEHeader . $thi
+00019430: 732d 3e6d 6169 6c48 6561 6465 7229 202e  s->mailHeader) .
+00019440: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00019450: 7469 633a 3a24 4c45 202e 2073 7461 7469  tic::$LE . stati
+00019460: 633a 3a24 4c45 202e 2024 7468 6973 2d3e  c::$LE . $this->
+00019470: 4d49 4d45 426f 6479 3b0a 2020 2020 7d0a  MIMEBody;.    }.
+00019480: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00019490: 4372 6561 7465 2061 2075 6e69 7175 6520  Create a unique 
+000194a0: 4944 2074 6f20 7573 6520 666f 7220 626f  ID to use for bo
+000194b0: 756e 6461 7269 6573 2e0a 2020 2020 202a  undaries..     *
+000194c0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+000194d0: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
+000194e0: 2020 2070 726f 7465 6374 6564 2066 756e     protected fun
+000194f0: 6374 696f 6e20 6765 6e65 7261 7465 4964  ction generateId
+00019500: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
+00019510: 2024 6c65 6e20 3d20 3332 3b20 2f2f 3332   $len = 32; //32
+00019520: 2062 7974 6573 203d 2032 3536 2062 6974   bytes = 256 bit
+00019530: 730a 2020 2020 2020 2020 2462 7974 6573  s.        $bytes
+00019540: 203d 2027 273b 0a20 2020 2020 2020 2069   = '';.        i
+00019550: 6620 2866 756e 6374 696f 6e5f 6578 6973  f (function_exis
+00019560: 7473 2827 7261 6e64 6f6d 5f62 7974 6573  ts('random_bytes
+00019570: 2729 2920 7b0a 2020 2020 2020 2020 2020  ')) {.          
+00019580: 2020 7472 7920 7b0a 2020 2020 2020 2020    try {.        
+00019590: 2020 2020 2020 2020 2462 7974 6573 203d          $bytes =
+000195a0: 2072 616e 646f 6d5f 6279 7465 7328 246c   random_bytes($l
+000195b0: 656e 293b 0a20 2020 2020 2020 2020 2020  en);.           
+000195c0: 207d 2063 6174 6368 2028 5c45 7863 6570   } catch (\Excep
+000195d0: 7469 6f6e 2024 6529 207b 0a20 2020 2020  tion $e) {.     
+000195e0: 2020 2020 2020 2020 2020 202f 2f44 6f20             //Do 
+000195f0: 6e6f 7468 696e 670a 2020 2020 2020 2020  nothing.        
+00019600: 2020 2020 7d0a 2020 2020 2020 2020 7d20      }.        } 
+00019610: 656c 7365 6966 2028 6675 6e63 7469 6f6e  elseif (function
+00019620: 5f65 7869 7374 7328 276f 7065 6e73 736c  _exists('openssl
+00019630: 5f72 616e 646f 6d5f 7073 6575 646f 5f62  _random_pseudo_b
+00019640: 7974 6573 2729 2920 7b0a 2020 2020 2020  ytes')) {.      
+00019650: 2020 2020 2020 2f2a 2a20 406e 6f69 6e73        /** @noins
+00019660: 7065 6374 696f 6e20 4372 7970 746f 6772  pection Cryptogr
+00019670: 6170 6869 6361 6c6c 7953 6563 7572 6552  aphicallySecureR
+00019680: 616e 646f 6d6e 6573 7349 6e73 7065 6374  andomnessInspect
+00019690: 696f 6e20 2a2f 0a20 2020 2020 2020 2020  ion */.         
+000196a0: 2020 2024 6279 7465 7320 3d20 6f70 656e     $bytes = open
+000196b0: 7373 6c5f 7261 6e64 6f6d 5f70 7365 7564  ssl_random_pseud
+000196c0: 6f5f 6279 7465 7328 246c 656e 293b 0a20  o_bytes($len);. 
+000196d0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000196e0: 2069 6620 2824 6279 7465 7320 3d3d 3d20   if ($bytes === 
+000196f0: 2727 2920 7b0a 2020 2020 2020 2020 2020  '') {.          
+00019700: 2020 2f2f 5765 2066 6169 6c65 6420 746f    //We failed to
+00019710: 2070 726f 6475 6365 2061 2070 726f 7065   produce a prope
+00019720: 7220 7261 6e64 6f6d 2073 7472 696e 672c  r random string,
+00019730: 2073 6f20 6d61 6b65 2064 6f2e 0a20 2020   so make do..   
+00019740: 2020 2020 2020 2020 202f 2f55 7365 2061           //Use a
+00019750: 2068 6173 6820 746f 2066 6f72 6365 2074   hash to force t
+00019760: 6865 206c 656e 6774 6820 746f 2074 6865  he length to the
+00019770: 2073 616d 6520 6173 2074 6865 206f 7468   same as the oth
+00019780: 6572 206d 6574 686f 6473 0a20 2020 2020  er methods.     
+00019790: 2020 2020 2020 2024 6279 7465 7320 3d20         $bytes = 
+000197a0: 6861 7368 2827 7368 6132 3536 272c 2075  hash('sha256', u
+000197b0: 6e69 7169 6428 2873 7472 696e 6729 206d  niqid((string) m
+000197c0: 745f 7261 6e64 2829 2c20 7472 7565 292c  t_rand(), true),
+000197d0: 2074 7275 6529 3b0a 2020 2020 2020 2020   true);.        
+000197e0: 7d0a 0a20 2020 2020 2020 202f 2f57 6520  }..        //We 
+000197f0: 646f 6e27 7420 6361 7265 2061 626f 7574  don't care about
+00019800: 206d 6573 7369 6e67 2075 7020 6261 7365   messing up base
+00019810: 3634 2066 6f72 6d61 7420 6865 7265 2c20  64 format here, 
+00019820: 6a75 7374 2077 616e 7420 6120 7261 6e64  just want a rand
+00019830: 6f6d 2073 7472 696e 670a 2020 2020 2020  om string.      
+00019840: 2020 7265 7475 726e 2073 7472 5f72 6570    return str_rep
+00019850: 6c61 6365 285b 273d 272c 2027 2b27 2c20  lace(['=', '+', 
+00019860: 272f 275d 2c20 2727 2c20 6261 7365 3634  '/'], '', base64
+00019870: 5f65 6e63 6f64 6528 6861 7368 2827 7368  _encode(hash('sh
+00019880: 6132 3536 272c 2024 6279 7465 732c 2074  a256', $bytes, t
+00019890: 7275 6529 2929 3b0a 2020 2020 7d0a 0a20  rue)));.    }.. 
+000198a0: 2020 202f 2a2a 0a20 2020 2020 2a20 4173     /**.     * As
+000198b0: 7365 6d62 6c65 2074 6865 206d 6573 7361  semble the messa
+000198c0: 6765 2062 6f64 792e 0a20 2020 2020 2a20  ge body..     * 
+000198d0: 5265 7475 726e 7320 616e 2065 6d70 7479  Returns an empty
+000198e0: 2073 7472 696e 6720 6f6e 2066 6169 6c75   string on failu
+000198f0: 7265 2e0a 2020 2020 202a 0a20 2020 2020  re..     *.     
+00019900: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
+00019910: 696f 6e0a 2020 2020 202a 0a20 2020 2020  ion.     *.     
+00019920: 2a20 4072 6574 7572 6e20 7374 7269 6e67  * @return string
+00019930: 2054 6865 2061 7373 656d 626c 6564 206d   The assembled m
+00019940: 6573 7361 6765 2062 6f64 790a 2020 2020  essage body.    
+00019950: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
+00019960: 756e 6374 696f 6e20 6372 6561 7465 426f  unction createBo
+00019970: 6479 2829 0a20 2020 207b 0a20 2020 2020  dy().    {.     
+00019980: 2020 2024 626f 6479 203d 2027 273b 0a20     $body = '';. 
+00019990: 2020 2020 2020 202f 2f43 7265 6174 6520         //Create 
+000199a0: 756e 6971 7565 2049 4473 2061 6e64 2070  unique IDs and p
+000199b0: 7265 7365 7420 626f 756e 6461 7269 6573  reset boundaries
+000199c0: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+000199d0: 7365 7442 6f75 6e64 6172 6965 7328 293b  setBoundaries();
+000199e0: 0a0a 2020 2020 2020 2020 6966 2028 2474  ..        if ($t
+000199f0: 6869 732d 3e73 6967 6e5f 6b65 795f 6669  his->sign_key_fi
+00019a00: 6c65 2920 7b0a 2020 2020 2020 2020 2020  le) {.          
+00019a10: 2020 2462 6f64 7920 2e3d 2024 7468 6973    $body .= $this
+00019a20: 2d3e 6765 744d 6169 6c4d 494d 4528 2920  ->getMailMIME() 
+00019a30: 2e20 7374 6174 6963 3a3a 244c 453b 0a20  . static::$LE;. 
+00019a40: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00019a50: 2020 2474 6869 732d 3e73 6574 576f 7264    $this->setWord
+00019a60: 5772 6170 2829 3b0a 0a20 2020 2020 2020  Wrap();..       
+00019a70: 2024 626f 6479 456e 636f 6469 6e67 203d   $bodyEncoding =
+00019a80: 2024 7468 6973 2d3e 456e 636f 6469 6e67   $this->Encoding
+00019a90: 3b0a 2020 2020 2020 2020 2462 6f64 7943  ;.        $bodyC
+00019aa0: 6861 7253 6574 203d 2024 7468 6973 2d3e  harSet = $this->
+00019ab0: 4368 6172 5365 743b 0a20 2020 2020 2020  CharSet;.       
+00019ac0: 202f 2f43 616e 2077 6520 646f 2061 2037   //Can we do a 7
+00019ad0: 2d62 6974 2064 6f77 6e67 7261 6465 3f0a  -bit downgrade?.
+00019ae0: 2020 2020 2020 2020 6966 2028 7374 6174          if (stat
+00019af0: 6963 3a3a 454e 434f 4449 4e47 5f38 4249  ic::ENCODING_8BI
+00019b00: 5420 3d3d 3d20 2462 6f64 7945 6e63 6f64  T === $bodyEncod
+00019b10: 696e 6720 2626 2021 2474 6869 732d 3e68  ing && !$this->h
+00019b20: 6173 3862 6974 4368 6172 7328 2474 6869  as8bitChars($thi
+00019b30: 732d 3e42 6f64 7929 2920 7b0a 2020 2020  s->Body)) {.    
+00019b40: 2020 2020 2020 2020 2462 6f64 7945 6e63          $bodyEnc
+00019b50: 6f64 696e 6720 3d20 7374 6174 6963 3a3a  oding = static::
+00019b60: 454e 434f 4449 4e47 5f37 4249 543b 0a20  ENCODING_7BIT;. 
+00019b70: 2020 2020 2020 2020 2020 202f 2f41 6c6c             //All
+00019b80: 2049 534f 2038 3835 392c 2057 696e 646f   ISO 8859, Windo
+00019b90: 7773 2063 6f64 6570 6167 6520 616e 6420  ws codepage and 
+00019ba0: 5554 462d 3820 6368 6172 7365 7473 2061  UTF-8 charsets a
+00019bb0: 7265 2061 7363 6969 2063 6f6d 7061 7469  re ascii compati
+00019bc0: 626c 6520 7570 2074 6f20 372d 6269 740a  ble up to 7-bit.
+00019bd0: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
+00019be0: 7943 6861 7253 6574 203d 2073 7461 7469  yCharSet = stati
+00019bf0: 633a 3a43 4841 5253 4554 5f41 5343 4949  c::CHARSET_ASCII
+00019c00: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00019c10: 2020 2020 2f2f 4966 206c 696e 6573 2061      //If lines a
+00019c20: 7265 2074 6f6f 206c 6f6e 672c 2061 6e64  re too long, and
+00019c30: 2077 6527 7265 206e 6f74 2061 6c72 6561   we're not alrea
+00019c40: 6479 2075 7369 6e67 2061 6e20 656e 636f  dy using an enco
+00019c50: 6469 6e67 2074 6861 7420 7769 6c6c 2073  ding that will s
+00019c60: 686f 7274 656e 2074 6865 6d2c 0a20 2020  horten them,.   
+00019c70: 2020 2020 202f 2f63 6861 6e67 6520 746f       //change to
+00019c80: 2071 756f 7465 642d 7072 696e 7461 626c   quoted-printabl
+00019c90: 6520 7472 616e 7366 6572 2065 6e63 6f64  e transfer encod
+00019ca0: 696e 6720 666f 7220 7468 6520 626f 6479  ing for the body
+00019cb0: 2070 6172 7420 6f6e 6c79 0a20 2020 2020   part only.     
+00019cc0: 2020 2069 6620 2873 7461 7469 633a 3a45     if (static::E
+00019cd0: 4e43 4f44 494e 475f 4241 5345 3634 2021  NCODING_BASE64 !
+00019ce0: 3d3d 2024 7468 6973 2d3e 456e 636f 6469  == $this->Encodi
+00019cf0: 6e67 2026 2620 7374 6174 6963 3a3a 6861  ng && static::ha
+00019d00: 734c 696e 654c 6f6e 6765 7254 6861 6e4d  sLineLongerThanM
+00019d10: 6178 2824 7468 6973 2d3e 426f 6479 2929  ax($this->Body))
+00019d20: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+00019d30: 626f 6479 456e 636f 6469 6e67 203d 2073  bodyEncoding = s
+00019d40: 7461 7469 633a 3a45 4e43 4f44 494e 475f  tatic::ENCODING_
+00019d50: 5155 4f54 4544 5f50 5249 4e54 4142 4c45  QUOTED_PRINTABLE
+00019d60: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
+00019d70: 2020 2020 2024 616c 7442 6f64 7945 6e63       $altBodyEnc
+00019d80: 6f64 696e 6720 3d20 2474 6869 732d 3e45  oding = $this->E
+00019d90: 6e63 6f64 696e 673b 0a20 2020 2020 2020  ncoding;.       
+00019da0: 2024 616c 7442 6f64 7943 6861 7253 6574   $altBodyCharSet
+00019db0: 203d 2024 7468 6973 2d3e 4368 6172 5365   = $this->CharSe
+00019dc0: 743b 0a20 2020 2020 2020 202f 2f43 616e  t;.        //Can
+00019dd0: 2077 6520 646f 2061 2037 2d62 6974 2064   we do a 7-bit d
+00019de0: 6f77 6e67 7261 6465 3f0a 2020 2020 2020  owngrade?.      
+00019df0: 2020 6966 2028 7374 6174 6963 3a3a 454e    if (static::EN
+00019e00: 434f 4449 4e47 5f38 4249 5420 3d3d 3d20  CODING_8BIT === 
+00019e10: 2461 6c74 426f 6479 456e 636f 6469 6e67  $altBodyEncoding
+00019e20: 2026 2620 2124 7468 6973 2d3e 6861 7338   && !$this->has8
+00019e30: 6269 7443 6861 7273 2824 7468 6973 2d3e  bitChars($this->
+00019e40: 416c 7442 6f64 7929 2920 7b0a 2020 2020  AltBody)) {.    
+00019e50: 2020 2020 2020 2020 2461 6c74 426f 6479          $altBody
+00019e60: 456e 636f 6469 6e67 203d 2073 7461 7469  Encoding = stati
+00019e70: 633a 3a45 4e43 4f44 494e 475f 3742 4954  c::ENCODING_7BIT
+00019e80: 3b0a 2020 2020 2020 2020 2020 2020 2f2f  ;.            //
+00019e90: 416c 6c20 4953 4f20 3838 3539 2c20 5769  All ISO 8859, Wi
+00019ea0: 6e64 6f77 7320 636f 6465 7061 6765 2061  ndows codepage a
+00019eb0: 6e64 2055 5446 2d38 2063 6861 7273 6574  nd UTF-8 charset
+00019ec0: 7320 6172 6520 6173 6369 6920 636f 6d70  s are ascii comp
+00019ed0: 6174 6962 6c65 2075 7020 746f 2037 2d62  atible up to 7-b
+00019ee0: 6974 0a20 2020 2020 2020 2020 2020 2024  it.            $
+00019ef0: 616c 7442 6f64 7943 6861 7253 6574 203d  altBodyCharSet =
+00019f00: 2073 7461 7469 633a 3a43 4841 5253 4554   static::CHARSET
+00019f10: 5f41 5343 4949 3b0a 2020 2020 2020 2020  _ASCII;.        
+00019f20: 7d0a 2020 2020 2020 2020 2f2f 4966 206c  }.        //If l
+00019f30: 696e 6573 2061 7265 2074 6f6f 206c 6f6e  ines are too lon
+00019f40: 672c 2061 6e64 2077 6527 7265 206e 6f74  g, and we're not
+00019f50: 2061 6c72 6561 6479 2075 7369 6e67 2061   already using a
+00019f60: 6e20 656e 636f 6469 6e67 2074 6861 7420  n encoding that 
+00019f70: 7769 6c6c 2073 686f 7274 656e 2074 6865  will shorten the
+00019f80: 6d2c 0a20 2020 2020 2020 202f 2f63 6861  m,.        //cha
+00019f90: 6e67 6520 746f 2071 756f 7465 642d 7072  nge to quoted-pr
+00019fa0: 696e 7461 626c 6520 7472 616e 7366 6572  intable transfer
+00019fb0: 2065 6e63 6f64 696e 6720 666f 7220 7468   encoding for th
+00019fc0: 6520 616c 7420 626f 6479 2070 6172 7420  e alt body part 
+00019fd0: 6f6e 6c79 0a20 2020 2020 2020 2069 6620  only.        if 
+00019fe0: 2873 7461 7469 633a 3a45 4e43 4f44 494e  (static::ENCODIN
+00019ff0: 475f 4241 5345 3634 2021 3d3d 2024 616c  G_BASE64 !== $al
+0001a000: 7442 6f64 7945 6e63 6f64 696e 6720 2626  tBodyEncoding &&
+0001a010: 2073 7461 7469 633a 3a68 6173 4c69 6e65   static::hasLine
+0001a020: 4c6f 6e67 6572 5468 616e 4d61 7828 2474  LongerThanMax($t
+0001a030: 6869 732d 3e41 6c74 426f 6479 2929 207b  his->AltBody)) {
+0001a040: 0a20 2020 2020 2020 2020 2020 2024 616c  .            $al
+0001a050: 7442 6f64 7945 6e63 6f64 696e 6720 3d20  tBodyEncoding = 
+0001a060: 7374 6174 6963 3a3a 454e 434f 4449 4e47  static::ENCODING
+0001a070: 5f51 554f 5445 445f 5052 494e 5441 424c  _QUOTED_PRINTABL
+0001a080: 453b 0a20 2020 2020 2020 207d 0a20 2020  E;.        }.   
+0001a090: 2020 2020 202f 2f55 7365 2074 6869 7320       //Use this 
+0001a0a0: 6173 2061 2070 7265 616d 626c 6520 696e  as a preamble in
+0001a0b0: 2061 6c6c 206d 756c 7469 7061 7274 206d   all multipart m
+0001a0c0: 6573 7361 6765 2074 7970 6573 0a20 2020  essage types.   
+0001a0d0: 2020 2020 2024 6d69 6d65 7072 6520 3d20       $mimepre = 
+0001a0e0: 2727 3b0a 2020 2020 2020 2020 7377 6974  '';.        swit
+0001a0f0: 6368 2028 2474 6869 732d 3e6d 6573 7361  ch ($this->messa
+0001a100: 6765 5f74 7970 6529 207b 0a20 2020 2020  ge_type) {.     
+0001a110: 2020 2020 2020 2063 6173 6520 2769 6e6c         case 'inl
+0001a120: 696e 6527 3a0a 2020 2020 2020 2020 2020  ine':.          
+0001a130: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
+0001a140: 6d69 6d65 7072 653b 0a20 2020 2020 2020  mimepre;.       
+0001a150: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001a160: 3d20 2474 6869 732d 3e67 6574 426f 756e  = $this->getBoun
+0001a170: 6461 7279 2824 7468 6973 2d3e 626f 756e  dary($this->boun
+0001a180: 6461 7279 5b31 5d2c 2024 626f 6479 4368  dary[1], $bodyCh
+0001a190: 6172 5365 742c 2027 272c 2024 626f 6479  arSet, '', $body
+0001a1a0: 456e 636f 6469 6e67 293b 0a20 2020 2020  Encoding);.     
+0001a1b0: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001a1c0: 202e 3d20 2474 6869 732d 3e65 6e63 6f64   .= $this->encod
+0001a1d0: 6553 7472 696e 6728 2474 6869 732d 3e42  eString($this->B
+0001a1e0: 6f64 792c 2024 626f 6479 456e 636f 6469  ody, $bodyEncodi
+0001a1f0: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
+0001a200: 2020 2020 2024 626f 6479 202e 3d20 7374       $body .= st
+0001a210: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+0001a220: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001a230: 202e 3d20 2474 6869 732d 3e61 7474 6163   .= $this->attac
+0001a240: 6841 6c6c 2827 696e 6c69 6e65 272c 2024  hAll('inline', $
+0001a250: 7468 6973 2d3e 626f 756e 6461 7279 5b31  this->boundary[1
+0001a260: 5d29 3b0a 2020 2020 2020 2020 2020 2020  ]);.            
+0001a270: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
+0001a280: 2020 2020 2020 2063 6173 6520 2761 7474         case 'att
+0001a290: 6163 6827 3a0a 2020 2020 2020 2020 2020  ach':.          
+0001a2a0: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
+0001a2b0: 6d69 6d65 7072 653b 0a20 2020 2020 2020  mimepre;.       
+0001a2c0: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001a2d0: 3d20 2474 6869 732d 3e67 6574 426f 756e  = $this->getBoun
+0001a2e0: 6461 7279 2824 7468 6973 2d3e 626f 756e  dary($this->boun
+0001a2f0: 6461 7279 5b31 5d2c 2024 626f 6479 4368  dary[1], $bodyCh
+0001a300: 6172 5365 742c 2027 272c 2024 626f 6479  arSet, '', $body
+0001a310: 456e 636f 6469 6e67 293b 0a20 2020 2020  Encoding);.     
+0001a320: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001a330: 202e 3d20 2474 6869 732d 3e65 6e63 6f64   .= $this->encod
+0001a340: 6553 7472 696e 6728 2474 6869 732d 3e42  eString($this->B
+0001a350: 6f64 792c 2024 626f 6479 456e 636f 6469  ody, $bodyEncodi
+0001a360: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
+0001a370: 2020 2020 2024 626f 6479 202e 3d20 7374       $body .= st
+0001a380: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+0001a390: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001a3a0: 202e 3d20 2474 6869 732d 3e61 7474 6163   .= $this->attac
+0001a3b0: 6841 6c6c 2827 6174 7461 6368 6d65 6e74  hAll('attachment
+0001a3c0: 272c 2024 7468 6973 2d3e 626f 756e 6461  ', $this->bounda
+0001a3d0: 7279 5b31 5d29 3b0a 2020 2020 2020 2020  ry[1]);.        
+0001a3e0: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+0001a3f0: 2020 2020 2020 2020 2020 2063 6173 6520             case 
+0001a400: 2769 6e6c 696e 655f 6174 7461 6368 273a  'inline_attach':
+0001a410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a420: 2024 626f 6479 202e 3d20 246d 696d 6570   $body .= $mimep
+0001a430: 7265 3b0a 2020 2020 2020 2020 2020 2020  re;.            
+0001a440: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
+0001a450: 6973 2d3e 7465 7874 4c69 6e65 2827 2d2d  is->textLine('--
+0001a460: 2720 2e20 2474 6869 732d 3e62 6f75 6e64  ' . $this->bound
+0001a470: 6172 795b 315d 293b 0a20 2020 2020 2020  ary[1]);.       
+0001a480: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001a490: 3d20 2474 6869 732d 3e68 6561 6465 724c  = $this->headerL
+0001a4a0: 696e 6528 2743 6f6e 7465 6e74 2d54 7970  ine('Content-Typ
+0001a4b0: 6527 2c20 7374 6174 6963 3a3a 434f 4e54  e', static::CONT
+0001a4c0: 454e 545f 5459 5045 5f4d 554c 5449 5041  ENT_TYPE_MULTIPA
+0001a4d0: 5254 5f52 454c 4154 4544 202e 2027 3b27  RT_RELATED . ';'
+0001a4e0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001a4f0: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
+0001a500: 732d 3e74 6578 744c 696e 6528 2720 626f  s->textLine(' bo
+0001a510: 756e 6461 7279 3d22 2720 2e20 2474 6869  undary="' . $thi
+0001a520: 732d 3e62 6f75 6e64 6172 795b 325d 202e  s->boundary[2] .
+0001a530: 2027 223b 2729 3b0a 2020 2020 2020 2020   '";');.        
+0001a540: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
+0001a550: 2024 7468 6973 2d3e 7465 7874 4c69 6e65   $this->textLine
+0001a560: 2827 2074 7970 653d 2227 202e 2073 7461  (' type="' . sta
+0001a570: 7469 633a 3a43 4f4e 5445 4e54 5f54 5950  tic::CONTENT_TYP
+0001a580: 455f 5445 5854 5f48 544d 4c20 2e20 2722  E_TEXT_HTML . '"
+0001a590: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
+0001a5a0: 2020 2020 2462 6f64 7920 2e3d 2073 7461      $body .= sta
+0001a5b0: 7469 633a 3a24 4c45 3b0a 2020 2020 2020  tic::$LE;.      
+0001a5c0: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
+0001a5d0: 2e3d 2024 7468 6973 2d3e 6765 7442 6f75  .= $this->getBou
+0001a5e0: 6e64 6172 7928 2474 6869 732d 3e62 6f75  ndary($this->bou
+0001a5f0: 6e64 6172 795b 325d 2c20 2462 6f64 7943  ndary[2], $bodyC
+0001a600: 6861 7253 6574 2c20 2727 2c20 2462 6f64  harSet, '', $bod
+0001a610: 7945 6e63 6f64 696e 6729 3b0a 2020 2020  yEncoding);.    
+0001a620: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
+0001a630: 7920 2e3d 2024 7468 6973 2d3e 656e 636f  y .= $this->enco
+0001a640: 6465 5374 7269 6e67 2824 7468 6973 2d3e  deString($this->
+0001a650: 426f 6479 2c20 2462 6f64 7945 6e63 6f64  Body, $bodyEncod
+0001a660: 696e 6729 3b0a 2020 2020 2020 2020 2020  ing);.          
+0001a670: 2020 2020 2020 2462 6f64 7920 2e3d 2073        $body .= s
+0001a680: 7461 7469 633a 3a24 4c45 3b0a 2020 2020  tatic::$LE;.    
+0001a690: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
+0001a6a0: 7920 2e3d 2024 7468 6973 2d3e 6174 7461  y .= $this->atta
+0001a6b0: 6368 416c 6c28 2769 6e6c 696e 6527 2c20  chAll('inline', 
+0001a6c0: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
+0001a6d0: 325d 293b 0a20 2020 2020 2020 2020 2020  2]);.           
+0001a6e0: 2020 2020 2024 626f 6479 202e 3d20 7374       $body .= st
+0001a6f0: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+0001a700: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001a710: 202e 3d20 2474 6869 732d 3e61 7474 6163   .= $this->attac
+0001a720: 6841 6c6c 2827 6174 7461 6368 6d65 6e74  hAll('attachment
+0001a730: 272c 2024 7468 6973 2d3e 626f 756e 6461  ', $this->bounda
+0001a740: 7279 5b31 5d29 3b0a 2020 2020 2020 2020  ry[1]);.        
+0001a750: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+0001a760: 2020 2020 2020 2020 2020 2063 6173 6520             case 
+0001a770: 2761 6c74 273a 0a20 2020 2020 2020 2020  'alt':.         
+0001a780: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001a790: 246d 696d 6570 7265 3b0a 2020 2020 2020  $mimepre;.      
+0001a7a0: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
+0001a7b0: 2e3d 2024 7468 6973 2d3e 6765 7442 6f75  .= $this->getBou
+0001a7c0: 6e64 6172 7928 0a20 2020 2020 2020 2020  ndary(.         
+0001a7d0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+0001a7e0: 2d3e 626f 756e 6461 7279 5b31 5d2c 0a20  ->boundary[1],. 
 0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a800: 2020 7374 6174 6963 3a3a 434f 4e54 454e    static::CONTEN
-0001a810: 545f 5459 5045 5f50 4c41 494e 5445 5854  T_TYPE_PLAINTEXT
-0001a820: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a830: 2020 2020 2020 2461 6c74 426f 6479 456e        $altBodyEn
-0001a840: 636f 6469 6e67 0a20 2020 2020 2020 2020  coding.         
-0001a850: 2020 2020 2020 2029 3b0a 2020 2020 2020         );.      
-0001a860: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001a870: 2e3d 2024 7468 6973 2d3e 656e 636f 6465  .= $this->encode
-0001a880: 5374 7269 6e67 2824 7468 6973 2d3e 416c  String($this->Al
-0001a890: 7442 6f64 792c 2024 616c 7442 6f64 7945  tBody, $altBodyE
-0001a8a0: 6e63 6f64 696e 6729 3b0a 2020 2020 2020  ncoding);.      
-0001a8b0: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001a8c0: 2e3d 2073 7461 7469 633a 3a24 4c45 3b0a  .= static::$LE;.
+0001a800: 2020 2024 616c 7442 6f64 7943 6861 7253     $altBodyCharS
+0001a810: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+0001a820: 2020 2020 2020 2020 7374 6174 6963 3a3a          static::
+0001a830: 434f 4e54 454e 545f 5459 5045 5f50 4c41  CONTENT_TYPE_PLA
+0001a840: 494e 5445 5854 2c0a 2020 2020 2020 2020  INTEXT,.        
+0001a850: 2020 2020 2020 2020 2020 2020 2461 6c74              $alt
+0001a860: 426f 6479 456e 636f 6469 6e67 0a20 2020  BodyEncoding.   
+0001a870: 2020 2020 2020 2020 2020 2020 2029 3b0a               );.
+0001a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a890: 2462 6f64 7920 2e3d 2024 7468 6973 2d3e  $body .= $this->
+0001a8a0: 656e 636f 6465 5374 7269 6e67 2824 7468  encodeString($th
+0001a8b0: 6973 2d3e 416c 7442 6f64 792c 2024 616c  is->AltBody, $al
+0001a8c0: 7442 6f64 7945 6e63 6f64 696e 6729 3b0a  tBodyEncoding);.
 0001a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8e0: 2462 6f64 7920 2e3d 2024 7468 6973 2d3e  $body .= $this->
-0001a8f0: 7465 7874 4c69 6e65 2827 2d2d 2720 2e20  textLine('--' . 
-0001a900: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
-0001a910: 315d 293b 0a20 2020 2020 2020 2020 2020  1]);.           
-0001a920: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
-0001a930: 6869 732d 3e68 6561 6465 724c 696e 6528  his->headerLine(
-0001a940: 2743 6f6e 7465 6e74 2d54 7970 6527 2c20  'Content-Type', 
-0001a950: 7374 6174 6963 3a3a 434f 4e54 454e 545f  static::CONTENT_
-0001a960: 5459 5045 5f4d 554c 5449 5041 5254 5f52  TYPE_MULTIPART_R
-0001a970: 454c 4154 4544 202e 2027 3b27 293b 0a20  ELATED . ';');. 
-0001a980: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001a990: 626f 6479 202e 3d20 2474 6869 732d 3e74  body .= $this->t
-0001a9a0: 6578 744c 696e 6528 2720 626f 756e 6461  extLine(' bounda
-0001a9b0: 7279 3d22 2720 2e20 2474 6869 732d 3e62  ry="' . $this->b
-0001a9c0: 6f75 6e64 6172 795b 325d 202e 2027 223b  oundary[2] . '";
-0001a9d0: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
-0001a9e0: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-0001a9f0: 6973 2d3e 7465 7874 4c69 6e65 2827 2074  is->textLine(' t
-0001aa00: 7970 653d 2227 202e 2073 7461 7469 633a  ype="' . static:
-0001aa10: 3a43 4f4e 5445 4e54 5f54 5950 455f 5445  :CONTENT_TYPE_TE
-0001aa20: 5854 5f48 544d 4c20 2e20 2722 2729 3b0a  XT_HTML . '"');.
-0001aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa40: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
-0001aa50: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
-0001aa60: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-0001aa70: 7468 6973 2d3e 6765 7442 6f75 6e64 6172  this->getBoundar
-0001aa80: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
-0001aa90: 2020 2020 2020 2024 7468 6973 2d3e 626f         $this->bo
-0001aaa0: 756e 6461 7279 5b32 5d2c 0a20 2020 2020  undary[2],.     
-0001aab0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001aac0: 626f 6479 4368 6172 5365 742c 0a20 2020  bodyCharSet,.   
-0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aae0: 2073 7461 7469 633a 3a43 4f4e 5445 4e54   static::CONTENT
-0001aaf0: 5f54 5950 455f 5445 5854 5f48 544d 4c2c  _TYPE_TEXT_HTML,
-0001ab00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ab10: 2020 2020 2024 626f 6479 456e 636f 6469       $bodyEncodi
-0001ab20: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0001ab30: 2020 2029 3b0a 2020 2020 2020 2020 2020     );.          
-0001ab40: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-0001ab50: 7468 6973 2d3e 656e 636f 6465 5374 7269  this->encodeStri
-0001ab60: 6e67 2824 7468 6973 2d3e 426f 6479 2c20  ng($this->Body, 
-0001ab70: 2462 6f64 7945 6e63 6f64 696e 6729 3b0a  $bodyEncoding);.
-0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab90: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
-0001aba0: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
-0001abb0: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
-0001abc0: 7468 6973 2d3e 6174 7461 6368 416c 6c28  this->attachAll(
-0001abd0: 2769 6e6c 696e 6527 2c20 2474 6869 732d  'inline', $this-
-0001abe0: 3e62 6f75 6e64 6172 795b 325d 293b 0a20  >boundary[2]);. 
-0001abf0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001ac00: 626f 6479 202e 3d20 7374 6174 6963 3a3a  body .= static::
-0001ac10: 244c 453b 0a20 2020 2020 2020 2020 2020  $LE;.           
-0001ac20: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
-0001ac30: 6869 732d 3e65 6e64 426f 756e 6461 7279  his->endBoundary
-0001ac40: 2824 7468 6973 2d3e 626f 756e 6461 7279  ($this->boundary
-0001ac50: 5b31 5d29 3b0a 2020 2020 2020 2020 2020  [1]);.          
-0001ac60: 2020 2020 2020 6272 6561 6b3b 0a20 2020        break;.   
-0001ac70: 2020 2020 2020 2020 2063 6173 6520 2761           case 'a
-0001ac80: 6c74 5f61 7474 6163 6827 3a0a 2020 2020  lt_attach':.    
-0001ac90: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
-0001aca0: 7920 2e3d 2024 6d69 6d65 7072 653b 0a20  y .= $mimepre;. 
-0001acb0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001acc0: 626f 6479 202e 3d20 2474 6869 732d 3e74  body .= $this->t
-0001acd0: 6578 744c 696e 6528 272d 2d27 202e 2024  extLine('--' . $
-0001ace0: 7468 6973 2d3e 626f 756e 6461 7279 5b31  this->boundary[1
-0001acf0: 5d29 3b0a 2020 2020 2020 2020 2020 2020  ]);.            
-0001ad00: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-0001ad10: 6973 2d3e 6865 6164 6572 4c69 6e65 2827  is->headerLine('
-0001ad20: 436f 6e74 656e 742d 5479 7065 272c 2073  Content-Type', s
-0001ad30: 7461 7469 633a 3a43 4f4e 5445 4e54 5f54  tatic::CONTENT_T
-0001ad40: 5950 455f 4d55 4c54 4950 4152 545f 414c  YPE_MULTIPART_AL
-0001ad50: 5445 524e 4154 4956 4520 2e20 273b 2729  TERNATIVE . ';')
-0001ad60: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001ad70: 2020 2462 6f64 7920 2e3d 2024 7468 6973    $body .= $this
-0001ad80: 2d3e 7465 7874 4c69 6e65 2827 2062 6f75  ->textLine(' bou
-0001ad90: 6e64 6172 793d 2227 202e 2024 7468 6973  ndary="' . $this
-0001ada0: 2d3e 626f 756e 6461 7279 5b32 5d20 2e20  ->boundary[2] . 
-0001adb0: 2722 2729 3b0a 2020 2020 2020 2020 2020  '"');.          
-0001adc0: 2020 2020 2020 2462 6f64 7920 2e3d 2073        $body .= s
-0001add0: 7461 7469 633a 3a24 4c45 3b0a 2020 2020  tatic::$LE;.    
-0001ade0: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
-0001adf0: 7920 2e3d 2024 7468 6973 2d3e 6765 7442  y .= $this->getB
-0001ae00: 6f75 6e64 6172 7928 0a20 2020 2020 2020  oundary(.       
-0001ae10: 2020 2020 2020 2020 2020 2020 2024 7468               $th
-0001ae20: 6973 2d3e 626f 756e 6461 7279 5b32 5d2c  is->boundary[2],
-0001ae30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ae40: 2020 2020 2024 616c 7442 6f64 7943 6861       $altBodyCha
-0001ae50: 7253 6574 2c0a 2020 2020 2020 2020 2020  rSet,.          
-0001ae60: 2020 2020 2020 2020 2020 7374 6174 6963            static
-0001ae70: 3a3a 434f 4e54 454e 545f 5459 5045 5f50  ::CONTENT_TYPE_P
-0001ae80: 4c41 494e 5445 5854 2c0a 2020 2020 2020  LAINTEXT,.      
-0001ae90: 2020 2020 2020 2020 2020 2020 2020 2461                $a
-0001aea0: 6c74 426f 6479 456e 636f 6469 6e67 0a20  ltBodyEncoding. 
-0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001aec0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001aed0: 2020 2462 6f64 7920 2e3d 2024 7468 6973    $body .= $this
-0001aee0: 2d3e 656e 636f 6465 5374 7269 6e67 2824  ->encodeString($
-0001aef0: 7468 6973 2d3e 416c 7442 6f64 792c 2024  this->AltBody, $
-0001af00: 616c 7442 6f64 7945 6e63 6f64 696e 6729  altBodyEncoding)
-0001af10: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001af20: 2020 2462 6f64 7920 2e3d 2073 7461 7469    $body .= stati
-0001af30: 633a 3a24 4c45 3b0a 2020 2020 2020 2020  c::$LE;.        
-0001af40: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
-0001af50: 2024 7468 6973 2d3e 6765 7442 6f75 6e64   $this->getBound
-0001af60: 6172 7928 0a20 2020 2020 2020 2020 2020  ary(.           
-0001af70: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0001af80: 626f 756e 6461 7279 5b32 5d2c 0a20 2020  boundary[2],.   
-0001af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afa0: 2024 626f 6479 4368 6172 5365 742c 0a20   $bodyCharSet,. 
-0001afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afc0: 2020 2073 7461 7469 633a 3a43 4f4e 5445     static::CONTE
-0001afd0: 4e54 5f54 5950 455f 5445 5854 5f48 544d  NT_TYPE_TEXT_HTM
-0001afe0: 4c2c 0a20 2020 2020 2020 2020 2020 2020  L,.             
-0001aff0: 2020 2020 2020 2024 626f 6479 456e 636f         $bodyEnco
-0001b000: 6469 6e67 0a20 2020 2020 2020 2020 2020  ding.           
-0001b010: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-0001b020: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
-0001b030: 2024 7468 6973 2d3e 656e 636f 6465 5374   $this->encodeSt
-0001b040: 7269 6e67 2824 7468 6973 2d3e 426f 6479  ring($this->Body
-0001b050: 2c20 2462 6f64 7945 6e63 6f64 696e 6729  , $bodyEncoding)
-0001b060: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001b070: 2020 2462 6f64 7920 2e3d 2073 7461 7469    $body .= stati
-0001b080: 633a 3a24 4c45 3b0a 2020 2020 2020 2020  c::$LE;.        
-0001b090: 2020 2020 2020 2020 6966 2028 2165 6d70          if (!emp
-0001b0a0: 7479 2824 7468 6973 2d3e 4963 616c 2929  ty($this->Ical))
-0001b0b0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0001b0c0: 2020 2020 2020 2024 6d65 7468 6f64 203d         $method =
-0001b0d0: 2073 7461 7469 633a 3a49 4341 4c5f 4d45   static::ICAL_ME
-0001b0e0: 5448 4f44 5f52 4551 5545 5354 3b0a 2020  THOD_REQUEST;.  
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b100: 2020 666f 7265 6163 6820 2873 7461 7469    foreach (stati
-0001b110: 633a 3a24 4963 616c 4d65 7468 6f64 7320  c::$IcalMethods 
-0001b120: 6173 2024 696d 6574 686f 6429 207b 0a20  as $imethod) {. 
-0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b140: 2020 2020 2020 2069 6620 2873 7472 6970         if (strip
-0001b150: 6f73 2824 7468 6973 2d3e 4963 616c 2c20  os($this->Ical, 
-0001b160: 274d 4554 484f 443a 2720 2e20 2469 6d65  'METHOD:' . $ime
-0001b170: 7468 6f64 2920 213d 3d20 6661 6c73 6529  thod) !== false)
-0001b180: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001b1a0: 6d65 7468 6f64 203d 2024 696d 6574 686f  method = $imetho
-0001b1b0: 643b 0a20 2020 2020 2020 2020 2020 2020  d;.             
-0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001b1d0: 7265 616b 3b0a 2020 2020 2020 2020 2020  reak;.          
-0001b1e0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b200: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0001b210: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001b220: 2e3d 2024 7468 6973 2d3e 6765 7442 6f75  .= $this->getBou
-0001b230: 6e64 6172 7928 0a20 2020 2020 2020 2020  ndary(.         
-0001b240: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001a8e0: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
+0001a8f0: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
+0001a900: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
+0001a910: 7468 6973 2d3e 6765 7442 6f75 6e64 6172  this->getBoundar
+0001a920: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+0001a930: 2020 2020 2020 2024 7468 6973 2d3e 626f         $this->bo
+0001a940: 756e 6461 7279 5b31 5d2c 0a20 2020 2020  undary[1],.     
+0001a950: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001a960: 626f 6479 4368 6172 5365 742c 0a20 2020  bodyCharSet,.   
+0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a980: 2073 7461 7469 633a 3a43 4f4e 5445 4e54   static::CONTENT
+0001a990: 5f54 5950 455f 5445 5854 5f48 544d 4c2c  _TYPE_TEXT_HTML,
+0001a9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a9b0: 2020 2020 2024 626f 6479 456e 636f 6469       $bodyEncodi
+0001a9c0: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+0001a9d0: 2020 2029 3b0a 2020 2020 2020 2020 2020     );.          
+0001a9e0: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
+0001a9f0: 7468 6973 2d3e 656e 636f 6465 5374 7269  this->encodeStri
+0001aa00: 6e67 2824 7468 6973 2d3e 426f 6479 2c20  ng($this->Body, 
+0001aa10: 2462 6f64 7945 6e63 6f64 696e 6729 3b0a  $bodyEncoding);.
+0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa30: 2462 6f64 7920 2e3d 2073 7461 7469 633a  $body .= static:
+0001aa40: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
+0001aa50: 2020 2020 2020 6966 2028 2165 6d70 7479        if (!empty
+0001aa60: 2824 7468 6973 2d3e 4963 616c 2929 207b  ($this->Ical)) {
+0001aa70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aa80: 2020 2020 2024 6d65 7468 6f64 203d 2073       $method = s
+0001aa90: 7461 7469 633a 3a49 4341 4c5f 4d45 5448  tatic::ICAL_METH
+0001aaa0: 4f44 5f52 4551 5545 5354 3b0a 2020 2020  OD_REQUEST;.    
+0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aac0: 666f 7265 6163 6820 2873 7461 7469 633a  foreach (static:
+0001aad0: 3a24 4963 616c 4d65 7468 6f64 7320 6173  :$IcalMethods as
+0001aae0: 2024 696d 6574 686f 6429 207b 0a20 2020   $imethod) {.   
+0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2020 2020 2069 6620 2873 7472 6970 6f73       if (stripos
+0001ab10: 2824 7468 6973 2d3e 4963 616c 2c20 274d  ($this->Ical, 'M
+0001ab20: 4554 484f 443a 2720 2e20 2469 6d65 7468  ETHOD:' . $imeth
+0001ab30: 6f64 2920 213d 3d20 6661 6c73 6529 207b  od) !== false) {
+0001ab40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ab50: 2020 2020 2020 2020 2020 2020 2024 6d65               $me
+0001ab60: 7468 6f64 203d 2024 696d 6574 686f 643b  thod = $imethod;
+0001ab70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ab80: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0001ab90: 616b 3b0a 2020 2020 2020 2020 2020 2020  ak;.            
+0001aba0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+0001abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abc0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+0001abd0: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
+0001abe0: 2024 7468 6973 2d3e 6765 7442 6f75 6e64   $this->getBound
+0001abf0: 6172 7928 0a20 2020 2020 2020 2020 2020  ary(.           
+0001ac00: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+0001ac10: 6973 2d3e 626f 756e 6461 7279 5b31 5d2c  is->boundary[1],
+0001ac20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ac30: 2020 2020 2020 2020 2027 272c 0a20 2020           '',.   
+0001ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac50: 2020 2020 2073 7461 7469 633a 3a43 4f4e       static::CON
+0001ac60: 5445 4e54 5f54 5950 455f 5445 5854 5f43  TENT_TYPE_TEXT_C
+0001ac70: 414c 454e 4441 5220 2e20 273b 206d 6574  ALENDAR . '; met
+0001ac80: 686f 643d 2720 2e20 246d 6574 686f 642c  hod=' . $method,
+0001ac90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aca0: 2020 2020 2020 2020 2027 270a 2020 2020           ''.    
+0001acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acc0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001acd0: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001ace0: 2474 6869 732d 3e65 6e63 6f64 6553 7472  $this->encodeStr
+0001acf0: 696e 6728 2474 6869 732d 3e49 6361 6c2c  ing($this->Ical,
+0001ad00: 2024 7468 6973 2d3e 456e 636f 6469 6e67   $this->Encoding
+0001ad10: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001ad20: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001ad30: 7374 6174 6963 3a3a 244c 453b 0a20 2020  static::$LE;.   
+0001ad40: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0001ad50: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001ad60: 626f 6479 202e 3d20 2474 6869 732d 3e65  body .= $this->e
+0001ad70: 6e64 426f 756e 6461 7279 2824 7468 6973  ndBoundary($this
+0001ad80: 2d3e 626f 756e 6461 7279 5b31 5d29 3b0a  ->boundary[1]);.
+0001ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ada0: 6272 6561 6b3b 0a20 2020 2020 2020 2020  break;.         
+0001adb0: 2020 2063 6173 6520 2761 6c74 5f69 6e6c     case 'alt_inl
+0001adc0: 696e 6527 3a0a 2020 2020 2020 2020 2020  ine':.          
+0001add0: 2020 2020 2020 2462 6f64 7920 2e3d 2024        $body .= $
+0001ade0: 6d69 6d65 7072 653b 0a20 2020 2020 2020  mimepre;.       
+0001adf0: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001ae00: 3d20 2474 6869 732d 3e67 6574 426f 756e  = $this->getBoun
+0001ae10: 6461 7279 280a 2020 2020 2020 2020 2020  dary(.          
+0001ae20: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+0001ae30: 3e62 6f75 6e64 6172 795b 315d 2c0a 2020  >boundary[1],.  
+0001ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae50: 2020 2461 6c74 426f 6479 4368 6172 5365    $altBodyCharSe
+0001ae60: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0001ae70: 2020 2020 2020 2073 7461 7469 633a 3a43         static::C
+0001ae80: 4f4e 5445 4e54 5f54 5950 455f 504c 4149  ONTENT_TYPE_PLAI
+0001ae90: 4e54 4558 542c 0a20 2020 2020 2020 2020  NTEXT,.         
+0001aea0: 2020 2020 2020 2020 2020 2024 616c 7442             $altB
+0001aeb0: 6f64 7945 6e63 6f64 696e 670a 2020 2020  odyEncoding.    
+0001aec0: 2020 2020 2020 2020 2020 2020 293b 0a20              );. 
+0001aed0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001aee0: 626f 6479 202e 3d20 2474 6869 732d 3e65  body .= $this->e
+0001aef0: 6e63 6f64 6553 7472 696e 6728 2474 6869  ncodeString($thi
+0001af00: 732d 3e41 6c74 426f 6479 2c20 2461 6c74  s->AltBody, $alt
+0001af10: 426f 6479 456e 636f 6469 6e67 293b 0a20  BodyEncoding);. 
+0001af20: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001af30: 626f 6479 202e 3d20 7374 6174 6963 3a3a  body .= static::
+0001af40: 244c 453b 0a20 2020 2020 2020 2020 2020  $LE;.           
+0001af50: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
+0001af60: 6869 732d 3e74 6578 744c 696e 6528 272d  his->textLine('-
+0001af70: 2d27 202e 2024 7468 6973 2d3e 626f 756e  -' . $this->boun
+0001af80: 6461 7279 5b31 5d29 3b0a 2020 2020 2020  dary[1]);.      
+0001af90: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
+0001afa0: 2e3d 2024 7468 6973 2d3e 6865 6164 6572  .= $this->header
+0001afb0: 4c69 6e65 2827 436f 6e74 656e 742d 5479  Line('Content-Ty
+0001afc0: 7065 272c 2073 7461 7469 633a 3a43 4f4e  pe', static::CON
+0001afd0: 5445 4e54 5f54 5950 455f 4d55 4c54 4950  TENT_TYPE_MULTIP
+0001afe0: 4152 545f 5245 4c41 5445 4420 2e20 273b  ART_RELATED . ';
+0001aff0: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
+0001b000: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
+0001b010: 6973 2d3e 7465 7874 4c69 6e65 2827 2062  is->textLine(' b
+0001b020: 6f75 6e64 6172 793d 2227 202e 2024 7468  oundary="' . $th
+0001b030: 6973 2d3e 626f 756e 6461 7279 5b32 5d20  is->boundary[2] 
+0001b040: 2e20 2722 3b27 293b 0a20 2020 2020 2020  . '";');.       
+0001b050: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001b060: 3d20 2474 6869 732d 3e74 6578 744c 696e  = $this->textLin
+0001b070: 6528 2720 7479 7065 3d22 2720 2e20 7374  e(' type="' . st
+0001b080: 6174 6963 3a3a 434f 4e54 454e 545f 5459  atic::CONTENT_TY
+0001b090: 5045 5f54 4558 545f 4854 4d4c 202e 2027  PE_TEXT_HTML . '
+0001b0a0: 2227 293b 0a20 2020 2020 2020 2020 2020  "');.           
+0001b0b0: 2020 2020 2024 626f 6479 202e 3d20 7374       $body .= st
+0001b0c0: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+0001b0d0: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001b0e0: 202e 3d20 2474 6869 732d 3e67 6574 426f   .= $this->getBo
+0001b0f0: 756e 6461 7279 280a 2020 2020 2020 2020  undary(.        
+0001b100: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0001b110: 732d 3e62 6f75 6e64 6172 795b 325d 2c0a  s->boundary[2],.
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 2020 2020 2462 6f64 7943 6861 7253 6574      $bodyCharSet
+0001b140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b150: 2020 2020 2020 7374 6174 6963 3a3a 434f        static::CO
+0001b160: 4e54 454e 545f 5459 5045 5f54 4558 545f  NTENT_TYPE_TEXT_
+0001b170: 4854 4d4c 2c0a 2020 2020 2020 2020 2020  HTML,.          
+0001b180: 2020 2020 2020 2020 2020 2462 6f64 7945            $bodyE
+0001b190: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
+0001b1a0: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
+0001b1b0: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001b1c0: 202e 3d20 2474 6869 732d 3e65 6e63 6f64   .= $this->encod
+0001b1d0: 6553 7472 696e 6728 2474 6869 732d 3e42  eString($this->B
+0001b1e0: 6f64 792c 2024 626f 6479 456e 636f 6469  ody, $bodyEncodi
+0001b1f0: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
+0001b200: 2020 2020 2024 626f 6479 202e 3d20 7374       $body .= st
+0001b210: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+0001b220: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001b230: 202e 3d20 2474 6869 732d 3e61 7474 6163   .= $this->attac
+0001b240: 6841 6c6c 2827 696e 6c69 6e65 272c 2024  hAll('inline', $
 0001b250: 7468 6973 2d3e 626f 756e 6461 7279 5b32  this->boundary[2
-0001b260: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001b270: 2020 2020 2020 2020 2020 2027 272c 0a20             '',. 
-0001b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b290: 2020 2020 2020 2073 7461 7469 633a 3a43         static::C
-0001b2a0: 4f4e 5445 4e54 5f54 5950 455f 5445 5854  ONTENT_TYPE_TEXT
-0001b2b0: 5f43 414c 454e 4441 5220 2e20 273b 206d  _CALENDAR . '; m
-0001b2c0: 6574 686f 643d 2720 2e20 246d 6574 686f  ethod=' . $metho
-0001b2d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0001b2e0: 2020 2020 2020 2020 2020 2027 270a 2020             ''.  
-0001b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b300: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
-0001b310: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
-0001b320: 3d20 2474 6869 732d 3e65 6e63 6f64 6553  = $this->encodeS
-0001b330: 7472 696e 6728 2474 6869 732d 3e49 6361  tring($this->Ica
-0001b340: 6c2c 2024 7468 6973 2d3e 456e 636f 6469  l, $this->Encodi
-0001b350: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
-0001b360: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0001b370: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
-0001b380: 2474 6869 732d 3e65 6e64 426f 756e 6461  $this->endBounda
-0001b390: 7279 2824 7468 6973 2d3e 626f 756e 6461  ry($this->bounda
-0001b3a0: 7279 5b32 5d29 3b0a 2020 2020 2020 2020  ry[2]);.        
-0001b3b0: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
-0001b3c0: 2073 7461 7469 633a 3a24 4c45 3b0a 2020   static::$LE;.  
-0001b3d0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-0001b3e0: 6f64 7920 2e3d 2024 7468 6973 2d3e 6174  ody .= $this->at
-0001b3f0: 7461 6368 416c 6c28 2761 7474 6163 686d  tachAll('attachm
-0001b400: 656e 7427 2c20 2474 6869 732d 3e62 6f75  ent', $this->bou
-0001b410: 6e64 6172 795b 315d 293b 0a20 2020 2020  ndary[1]);.     
-0001b420: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0001b430: 3b0a 2020 2020 2020 2020 2020 2020 6361  ;.            ca
-0001b440: 7365 2027 616c 745f 696e 6c69 6e65 5f61  se 'alt_inline_a
-0001b450: 7474 6163 6827 3a0a 2020 2020 2020 2020  ttach':.        
-0001b460: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
-0001b470: 2024 6d69 6d65 7072 653b 0a20 2020 2020   $mimepre;.     
-0001b480: 2020 2020 2020 2020 2020 2024 626f 6479             $body
-0001b490: 202e 3d20 2474 6869 732d 3e74 6578 744c   .= $this->textL
-0001b4a0: 696e 6528 272d 2d27 202e 2024 7468 6973  ine('--' . $this
-0001b4b0: 2d3e 626f 756e 6461 7279 5b31 5d29 3b0a  ->boundary[1]);.
-0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4d0: 2462 6f64 7920 2e3d 2024 7468 6973 2d3e  $body .= $this->
-0001b4e0: 6865 6164 6572 4c69 6e65 2827 436f 6e74  headerLine('Cont
-0001b4f0: 656e 742d 5479 7065 272c 2073 7461 7469  ent-Type', stati
-0001b500: 633a 3a43 4f4e 5445 4e54 5f54 5950 455f  c::CONTENT_TYPE_
-0001b510: 4d55 4c54 4950 4152 545f 414c 5445 524e  MULTIPART_ALTERN
-0001b520: 4154 4956 4520 2e20 273b 2729 3b0a 2020  ATIVE . ';');.  
-0001b530: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-0001b540: 6f64 7920 2e3d 2024 7468 6973 2d3e 7465  ody .= $this->te
-0001b550: 7874 4c69 6e65 2827 2062 6f75 6e64 6172  xtLine(' boundar
-0001b560: 793d 2227 202e 2024 7468 6973 2d3e 626f  y="' . $this->bo
-0001b570: 756e 6461 7279 5b32 5d20 2e20 2722 2729  undary[2] . '"')
-0001b580: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001b590: 2020 2462 6f64 7920 2e3d 2073 7461 7469    $body .= stati
-0001b5a0: 633a 3a24 4c45 3b0a 2020 2020 2020 2020  c::$LE;.        
-0001b5b0: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
-0001b5c0: 2024 7468 6973 2d3e 6765 7442 6f75 6e64   $this->getBound
-0001b5d0: 6172 7928 0a20 2020 2020 2020 2020 2020  ary(.           
-0001b5e0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0001b5f0: 626f 756e 6461 7279 5b32 5d2c 0a20 2020  boundary[2],.   
-0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b610: 2024 616c 7442 6f64 7943 6861 7253 6574   $altBodyCharSet
-0001b620: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b630: 2020 2020 2020 7374 6174 6963 3a3a 434f        static::CO
-0001b640: 4e54 454e 545f 5459 5045 5f50 4c41 494e  NTENT_TYPE_PLAIN
-0001b650: 5445 5854 2c0a 2020 2020 2020 2020 2020  TEXT,.          
-0001b660: 2020 2020 2020 2020 2020 2461 6c74 426f            $altBo
-0001b670: 6479 456e 636f 6469 6e67 0a20 2020 2020  dyEncoding.     
-0001b680: 2020 2020 2020 2020 2020 2029 3b0a 2020             );.  
-0001b690: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-0001b6a0: 6f64 7920 2e3d 2024 7468 6973 2d3e 656e  ody .= $this->en
-0001b6b0: 636f 6465 5374 7269 6e67 2824 7468 6973  codeString($this
-0001b6c0: 2d3e 416c 7442 6f64 792c 2024 616c 7442  ->AltBody, $altB
-0001b6d0: 6f64 7945 6e63 6f64 696e 6729 3b0a 2020  odyEncoding);.  
-0001b6e0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
-0001b6f0: 6f64 7920 2e3d 2073 7461 7469 633a 3a24  ody .= static::$
-0001b700: 4c45 3b0a 2020 2020 2020 2020 2020 2020  LE;.            
-0001b710: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
-0001b720: 6973 2d3e 7465 7874 4c69 6e65 2827 2d2d  is->textLine('--
-0001b730: 2720 2e20 2474 6869 732d 3e62 6f75 6e64  ' . $this->bound
-0001b740: 6172 795b 325d 293b 0a20 2020 2020 2020  ary[2]);.       
-0001b750: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
-0001b760: 3d20 2474 6869 732d 3e68 6561 6465 724c  = $this->headerL
-0001b770: 696e 6528 2743 6f6e 7465 6e74 2d54 7970  ine('Content-Typ
-0001b780: 6527 2c20 7374 6174 6963 3a3a 434f 4e54  e', static::CONT
-0001b790: 454e 545f 5459 5045 5f4d 554c 5449 5041  ENT_TYPE_MULTIPA
-0001b7a0: 5254 5f52 454c 4154 4544 202e 2027 3b27  RT_RELATED . ';'
-0001b7b0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0001b7c0: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
-0001b7d0: 732d 3e74 6578 744c 696e 6528 2720 626f  s->textLine(' bo
-0001b7e0: 756e 6461 7279 3d22 2720 2e20 2474 6869  undary="' . $thi
-0001b7f0: 732d 3e62 6f75 6e64 6172 795b 335d 202e  s->boundary[3] .
-0001b800: 2027 223b 2729 3b0a 2020 2020 2020 2020   '";');.        
-0001b810: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
-0001b820: 2024 7468 6973 2d3e 7465 7874 4c69 6e65   $this->textLine
-0001b830: 2827 2074 7970 653d 2227 202e 2073 7461  (' type="' . sta
-0001b840: 7469 633a 3a43 4f4e 5445 4e54 5f54 5950  tic::CONTENT_TYP
-0001b850: 455f 5445 5854 5f48 544d 4c20 2e20 2722  E_TEXT_HTML . '"
-0001b860: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
-0001b870: 2020 2020 2462 6f64 7920 2e3d 2073 7461      $body .= sta
-0001b880: 7469 633a 3a24 4c45 3b0a 2020 2020 2020  tic::$LE;.      
-0001b890: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001b8a0: 2e3d 2024 7468 6973 2d3e 6765 7442 6f75  .= $this->getBou
-0001b8b0: 6e64 6172 7928 0a20 2020 2020 2020 2020  ndary(.         
-0001b8c0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-0001b8d0: 2d3e 626f 756e 6461 7279 5b33 5d2c 0a20  ->boundary[3],. 
+0001b260: 5d29 3b0a 2020 2020 2020 2020 2020 2020  ]);.            
+0001b270: 2020 2020 2462 6f64 7920 2e3d 2073 7461      $body .= sta
+0001b280: 7469 633a 3a24 4c45 3b0a 2020 2020 2020  tic::$LE;.      
+0001b290: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
+0001b2a0: 2e3d 2024 7468 6973 2d3e 656e 6442 6f75  .= $this->endBou
+0001b2b0: 6e64 6172 7928 2474 6869 732d 3e62 6f75  ndary($this->bou
+0001b2c0: 6e64 6172 795b 315d 293b 0a20 2020 2020  ndary[1]);.     
+0001b2d0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0001b2e0: 3b0a 2020 2020 2020 2020 2020 2020 6361  ;.            ca
+0001b2f0: 7365 2027 616c 745f 6174 7461 6368 273a  se 'alt_attach':
+0001b300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b310: 2024 626f 6479 202e 3d20 246d 696d 6570   $body .= $mimep
+0001b320: 7265 3b0a 2020 2020 2020 2020 2020 2020  re;.            
+0001b330: 2020 2020 2462 6f64 7920 2e3d 2024 7468      $body .= $th
+0001b340: 6973 2d3e 7465 7874 4c69 6e65 2827 2d2d  is->textLine('--
+0001b350: 2720 2e20 2474 6869 732d 3e62 6f75 6e64  ' . $this->bound
+0001b360: 6172 795b 315d 293b 0a20 2020 2020 2020  ary[1]);.       
+0001b370: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001b380: 3d20 2474 6869 732d 3e68 6561 6465 724c  = $this->headerL
+0001b390: 696e 6528 2743 6f6e 7465 6e74 2d54 7970  ine('Content-Typ
+0001b3a0: 6527 2c20 7374 6174 6963 3a3a 434f 4e54  e', static::CONT
+0001b3b0: 454e 545f 5459 5045 5f4d 554c 5449 5041  ENT_TYPE_MULTIPA
+0001b3c0: 5254 5f41 4c54 4552 4e41 5449 5645 202e  RT_ALTERNATIVE .
+0001b3d0: 2027 3b27 293b 0a20 2020 2020 2020 2020   ';');.         
+0001b3e0: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001b3f0: 2474 6869 732d 3e74 6578 744c 696e 6528  $this->textLine(
+0001b400: 2720 626f 756e 6461 7279 3d22 2720 2e20  ' boundary="' . 
+0001b410: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
+0001b420: 325d 202e 2027 2227 293b 0a20 2020 2020  2] . '"');.     
+0001b430: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001b440: 202e 3d20 7374 6174 6963 3a3a 244c 453b   .= static::$LE;
+0001b450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b460: 2024 626f 6479 202e 3d20 2474 6869 732d   $body .= $this-
+0001b470: 3e67 6574 426f 756e 6461 7279 280a 2020  >getBoundary(.  
+0001b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b490: 2020 2474 6869 732d 3e62 6f75 6e64 6172    $this->boundar
+0001b4a0: 795b 325d 2c0a 2020 2020 2020 2020 2020  y[2],.          
+0001b4b0: 2020 2020 2020 2020 2020 2461 6c74 426f            $altBo
+0001b4c0: 6479 4368 6172 5365 742c 0a20 2020 2020  dyCharSet,.     
+0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001b4e0: 7461 7469 633a 3a43 4f4e 5445 4e54 5f54  tatic::CONTENT_T
+0001b4f0: 5950 455f 504c 4149 4e54 4558 542c 0a20  YPE_PLAINTEXT,. 
+0001b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b510: 2020 2024 616c 7442 6f64 7945 6e63 6f64     $altBodyEncod
+0001b520: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0001b530: 2020 2020 293b 0a20 2020 2020 2020 2020      );.         
+0001b540: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001b550: 2474 6869 732d 3e65 6e63 6f64 6553 7472  $this->encodeStr
+0001b560: 696e 6728 2474 6869 732d 3e41 6c74 426f  ing($this->AltBo
+0001b570: 6479 2c20 2461 6c74 426f 6479 456e 636f  dy, $altBodyEnco
+0001b580: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
+0001b590: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001b5a0: 7374 6174 6963 3a3a 244c 453b 0a20 2020  static::$LE;.   
+0001b5b0: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+0001b5c0: 6479 202e 3d20 2474 6869 732d 3e67 6574  dy .= $this->get
+0001b5d0: 426f 756e 6461 7279 280a 2020 2020 2020  Boundary(.      
+0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+0001b5f0: 6869 732d 3e62 6f75 6e64 6172 795b 325d  his->boundary[2]
+0001b600: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b610: 2020 2020 2020 2462 6f64 7943 6861 7253        $bodyCharS
+0001b620: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+0001b630: 2020 2020 2020 2020 7374 6174 6963 3a3a          static::
+0001b640: 434f 4e54 454e 545f 5459 5045 5f54 4558  CONTENT_TYPE_TEX
+0001b650: 545f 4854 4d4c 2c0a 2020 2020 2020 2020  T_HTML,.        
+0001b660: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
+0001b670: 7945 6e63 6f64 696e 670a 2020 2020 2020  yEncoding.      
+0001b680: 2020 2020 2020 2020 2020 293b 0a20 2020            );.   
+0001b690: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+0001b6a0: 6479 202e 3d20 2474 6869 732d 3e65 6e63  dy .= $this->enc
+0001b6b0: 6f64 6553 7472 696e 6728 2474 6869 732d  odeString($this-
+0001b6c0: 3e42 6f64 792c 2024 626f 6479 456e 636f  >Body, $bodyEnco
+0001b6d0: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
+0001b6e0: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001b6f0: 7374 6174 6963 3a3a 244c 453b 0a20 2020  static::$LE;.   
+0001b700: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b710: 2821 656d 7074 7928 2474 6869 732d 3e49  (!empty($this->I
+0001b720: 6361 6c29 2920 7b0a 2020 2020 2020 2020  cal)) {.        
+0001b730: 2020 2020 2020 2020 2020 2020 246d 6574              $met
+0001b740: 686f 6420 3d20 7374 6174 6963 3a3a 4943  hod = static::IC
+0001b750: 414c 5f4d 4554 484f 445f 5245 5155 4553  AL_METHOD_REQUES
+0001b760: 543b 0a20 2020 2020 2020 2020 2020 2020  T;.             
+0001b770: 2020 2020 2020 2066 6f72 6561 6368 2028         foreach (
+0001b780: 7374 6174 6963 3a3a 2449 6361 6c4d 6574  static::$IcalMet
+0001b790: 686f 6473 2061 7320 2469 6d65 7468 6f64  hods as $imethod
+0001b7a0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001b7b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001b7c0: 7374 7269 706f 7328 2474 6869 732d 3e49  stripos($this->I
+0001b7d0: 6361 6c2c 2027 4d45 5448 4f44 3a27 202e  cal, 'METHOD:' .
+0001b7e0: 2024 696d 6574 686f 6429 2021 3d3d 2066   $imethod) !== f
+0001b7f0: 616c 7365 2920 7b0a 2020 2020 2020 2020  alse) {.        
+0001b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b810: 2020 2020 246d 6574 686f 6420 3d20 2469      $method = $i
+0001b820: 6d65 7468 6f64 3b0a 2020 2020 2020 2020  method;.        
+0001b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b840: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
+0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b860: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+0001b870: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+0001b880: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001b890: 626f 6479 202e 3d20 2474 6869 732d 3e67  body .= $this->g
+0001b8a0: 6574 426f 756e 6461 7279 280a 2020 2020  etBoundary(.    
+0001b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8c0: 2020 2020 2474 6869 732d 3e62 6f75 6e64      $this->bound
+0001b8d0: 6172 795b 325d 2c0a 2020 2020 2020 2020  ary[2],.        
 0001b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8f0: 2020 2024 626f 6479 4368 6172 5365 742c     $bodyCharSet,
-0001b900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b910: 2020 2020 2073 7461 7469 633a 3a43 4f4e       static::CON
-0001b920: 5445 4e54 5f54 5950 455f 5445 5854 5f48  TENT_TYPE_TEXT_H
-0001b930: 544d 4c2c 0a20 2020 2020 2020 2020 2020  TML,.           
-0001b940: 2020 2020 2020 2020 2024 626f 6479 456e           $bodyEn
-0001b950: 636f 6469 6e67 0a20 2020 2020 2020 2020  coding.         
-0001b960: 2020 2020 2020 2029 3b0a 2020 2020 2020         );.      
-0001b970: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001b980: 2e3d 2024 7468 6973 2d3e 656e 636f 6465  .= $this->encode
-0001b990: 5374 7269 6e67 2824 7468 6973 2d3e 426f  String($this->Bo
-0001b9a0: 6479 2c20 2462 6f64 7945 6e63 6f64 696e  dy, $bodyEncodin
-0001b9b0: 6729 3b0a 2020 2020 2020 2020 2020 2020  g);.            
-0001b9c0: 2020 2020 2462 6f64 7920 2e3d 2073 7461      $body .= sta
-0001b9d0: 7469 633a 3a24 4c45 3b0a 2020 2020 2020  tic::$LE;.      
-0001b9e0: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001b9f0: 2e3d 2024 7468 6973 2d3e 6174 7461 6368  .= $this->attach
-0001ba00: 416c 6c28 2769 6e6c 696e 6527 2c20 2474  All('inline', $t
-0001ba10: 6869 732d 3e62 6f75 6e64 6172 795b 335d  his->boundary[3]
-0001ba20: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0001ba30: 2020 2024 626f 6479 202e 3d20 7374 6174     $body .= stat
-0001ba40: 6963 3a3a 244c 453b 0a20 2020 2020 2020  ic::$LE;.       
-0001ba50: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
-0001ba60: 3d20 2474 6869 732d 3e65 6e64 426f 756e  = $this->endBoun
-0001ba70: 6461 7279 2824 7468 6973 2d3e 626f 756e  dary($this->boun
-0001ba80: 6461 7279 5b32 5d29 3b0a 2020 2020 2020  dary[2]);.      
-0001ba90: 2020 2020 2020 2020 2020 2462 6f64 7920            $body 
-0001baa0: 2e3d 2073 7461 7469 633a 3a24 4c45 3b0a  .= static::$LE;.
-0001bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bac0: 2462 6f64 7920 2e3d 2024 7468 6973 2d3e  $body .= $this->
-0001bad0: 6174 7461 6368 416c 6c28 2761 7474 6163  attachAll('attac
-0001bae0: 686d 656e 7427 2c20 2474 6869 732d 3e62  hment', $this->b
-0001baf0: 6f75 6e64 6172 795b 315d 293b 0a20 2020  oundary[1]);.   
-0001bb00: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0001bb10: 616b 3b0a 2020 2020 2020 2020 2020 2020  ak;.            
-0001bb20: 6465 6661 756c 743a 0a20 2020 2020 2020  default:.       
-0001bb30: 2020 2020 2020 2020 202f 2f43 6174 6368           //Catch
-0001bb40: 2063 6173 6520 2770 6c61 696e 2720 616e   case 'plain' an
-0001bb50: 6420 6361 7365 2027 272c 2061 7070 6c69  d case '', appli
-0001bb60: 6573 2074 6f20 7369 6d70 6c65 2060 7465  es to simple `te
-0001bb70: 7874 2f70 6c61 696e 6020 616e 6420 6074  xt/plain` and `t
-0001bb80: 6578 742f 6874 6d6c 6020 626f 6479 2063  ext/html` body c
-0001bb90: 6f6e 7465 6e74 2074 7970 6573 0a20 2020  ontent types.   
-0001bba0: 2020 2020 2020 2020 2020 2020 202f 2f52               //R
-0001bbb0: 6573 6574 2074 6865 2060 456e 636f 6469  eset the `Encodi
-0001bbc0: 6e67 6020 7072 6f70 6572 7479 2069 6e20  ng` property in 
-0001bbd0: 6361 7365 2077 6520 6368 616e 6765 6420  case we changed 
-0001bbe0: 6974 2066 6f72 206c 696e 6520 6c65 6e67  it for line leng
-0001bbf0: 7468 2072 6561 736f 6e73 0a20 2020 2020  th reasons.     
-0001bc00: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-0001bc10: 2d3e 456e 636f 6469 6e67 203d 2024 626f  ->Encoding = $bo
-0001bc20: 6479 456e 636f 6469 6e67 3b0a 2020 2020  dyEncoding;.    
-0001bc30: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
-0001bc40: 7920 2e3d 2024 7468 6973 2d3e 656e 636f  y .= $this->enco
-0001bc50: 6465 5374 7269 6e67 2824 7468 6973 2d3e  deString($this->
-0001bc60: 426f 6479 2c20 2474 6869 732d 3e45 6e63  Body, $this->Enc
-0001bc70: 6f64 696e 6729 3b0a 2020 2020 2020 2020  oding);.        
-0001bc80: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
-0001bc90: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-0001bca0: 2020 6966 2028 2474 6869 732d 3e69 7345    if ($this->isE
-0001bcb0: 7272 6f72 2829 2920 7b0a 2020 2020 2020  rror()) {.      
-0001bcc0: 2020 2020 2020 2462 6f64 7920 3d20 2727        $body = ''
-0001bcd0: 3b0a 2020 2020 2020 2020 2020 2020 6966  ;.            if
-0001bce0: 2028 2474 6869 732d 3e65 7863 6570 7469   ($this->excepti
-0001bcf0: 6f6e 7329 207b 0a20 2020 2020 2020 2020  ons) {.         
-0001bd00: 2020 2020 2020 2074 6872 6f77 206e 6577         throw new
-0001bd10: 2045 7863 6570 7469 6f6e 2824 7468 6973   Exception($this
-0001bd20: 2d3e 6c61 6e67 2827 656d 7074 795f 6d65  ->lang('empty_me
-0001bd30: 7373 6167 6527 292c 2073 656c 663a 3a53  ssage'), self::S
-0001bd40: 544f 505f 4352 4954 4943 414c 293b 0a20  TOP_CRITICAL);. 
-0001bd50: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0001bd60: 2020 2020 207d 2065 6c73 6569 6620 2824       } elseif ($
-0001bd70: 7468 6973 2d3e 7369 676e 5f6b 6579 5f66  this->sign_key_f
-0001bd80: 696c 6529 207b 0a20 2020 2020 2020 2020  ile) {.         
-0001bd90: 2020 2074 7279 207b 0a20 2020 2020 2020     try {.       
-0001bda0: 2020 2020 2020 2020 2069 6620 2821 6465           if (!de
-0001bdb0: 6669 6e65 6428 2750 4b43 5337 5f54 4558  fined('PKCS7_TEX
-0001bdc0: 5427 2929 207b 0a20 2020 2020 2020 2020  T')) {.         
-0001bdd0: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
-0001bde0: 206e 6577 2045 7863 6570 7469 6f6e 2824   new Exception($
-0001bdf0: 7468 6973 2d3e 6c61 6e67 2827 6578 7465  this->lang('exte
-0001be00: 6e73 696f 6e5f 6d69 7373 696e 6727 2920  nsion_missing') 
-0001be10: 2e20 276f 7065 6e73 736c 2729 3b0a 2020  . 'openssl');.  
-0001be20: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-0001be30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be40: 2024 6669 6c65 203d 2074 656d 706e 616d   $file = tempnam
-0001be50: 2873 7973 5f67 6574 5f74 656d 705f 6469  (sys_get_temp_di
-0001be60: 7228 292c 2027 7372 6373 6967 6e27 293b  r(), 'srcsign');
-0001be70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be80: 2024 7369 676e 6564 203d 2074 656d 706e   $signed = tempn
-0001be90: 616d 2873 7973 5f67 6574 5f74 656d 705f  am(sys_get_temp_
-0001bea0: 6469 7228 292c 2027 6d61 696c 7369 676e  dir(), 'mailsign
-0001beb0: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
-0001bec0: 2020 2020 6669 6c65 5f70 7574 5f63 6f6e      file_put_con
-0001bed0: 7465 6e74 7328 2466 696c 652c 2024 626f  tents($file, $bo
-0001bee0: 6479 293b 0a0a 2020 2020 2020 2020 2020  dy);..          
-0001bef0: 2020 2020 2020 2f2f 576f 726b 6172 6f75        //Workarou
-0001bf00: 6e64 2066 6f72 2050 4850 2062 7567 2068  nd for PHP bug h
-0001bf10: 7474 7073 3a2f 2f62 7567 732e 7068 702e  ttps://bugs.php.
-0001bf20: 6e65 742f 6275 672e 7068 703f 6964 3d36  net/bug.php?id=6
-0001bf30: 3931 3937 0a20 2020 2020 2020 2020 2020  9197.           
-0001bf40: 2020 2020 2069 6620 2865 6d70 7479 2824       if (empty($
-0001bf50: 7468 6973 2d3e 7369 676e 5f65 7874 7261  this->sign_extra
-0001bf60: 6365 7274 735f 6669 6c65 2929 207b 0a20  certs_file)) {. 
-0001bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf80: 2020 2024 7369 676e 203d 2040 6f70 656e     $sign = @open
-0001bf90: 7373 6c5f 706b 6373 375f 7369 676e 280a  ssl_pkcs7_sign(.
-0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfb0: 2020 2020 2020 2020 2466 696c 652c 0a20          $file,. 
-0001bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfd0: 2020 2020 2020 2024 7369 676e 6564 2c0a         $signed,.
-0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bff0: 2020 2020 2020 2020 2766 696c 653a 2f2f          'file://
-0001c000: 2720 2e20 7265 616c 7061 7468 2824 7468  ' . realpath($th
-0001c010: 6973 2d3e 7369 676e 5f63 6572 745f 6669  is->sign_cert_fi
-0001c020: 6c65 292c 0a20 2020 2020 2020 2020 2020  le),.           
-0001c030: 2020 2020 2020 2020 2020 2020 205b 2766               ['f
-0001c040: 696c 653a 2f2f 2720 2e20 7265 616c 7061  ile://' . realpa
-0001c050: 7468 2824 7468 6973 2d3e 7369 676e 5f6b  th($this->sign_k
-0001c060: 6579 5f66 696c 6529 2c20 2474 6869 732d  ey_file), $this-
-0001c070: 3e73 6967 6e5f 6b65 795f 7061 7373 5d2c  >sign_key_pass],
-0001c080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c090: 2020 2020 2020 2020 205b 5d0a 2020 2020           [].    
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0001c0c0: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-0001c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0e0: 2473 6967 6e20 3d20 406f 7065 6e73 736c  $sign = @openssl
-0001c0f0: 5f70 6b63 7337 5f73 6967 6e28 0a20 2020  _pkcs7_sign(.   
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c110: 2020 2020 2024 6669 6c65 2c0a 2020 2020       $file,.    
-0001c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c130: 2020 2020 2473 6967 6e65 642c 0a20 2020      $signed,.   
-0001c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c150: 2020 2020 2027 6669 6c65 3a2f 2f27 202e       'file://' .
-0001c160: 2072 6561 6c70 6174 6828 2474 6869 732d   realpath($this-
-0001c170: 3e73 6967 6e5f 6365 7274 5f66 696c 6529  >sign_cert_file)
-0001c180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c190: 2020 2020 2020 2020 2020 5b27 6669 6c65            ['file
-0001c1a0: 3a2f 2f27 202e 2072 6561 6c70 6174 6828  ://' . realpath(
-0001c1b0: 2474 6869 732d 3e73 6967 6e5f 6b65 795f  $this->sign_key_
-0001c1c0: 6669 6c65 292c 2024 7468 6973 2d3e 7369  file), $this->si
-0001c1d0: 676e 5f6b 6579 5f70 6173 735d 2c0a 2020  gn_key_pass],.  
-0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1f0: 2020 2020 2020 5b5d 2c0a 2020 2020 2020        [],.      
-0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c210: 2020 504b 4353 375f 4445 5441 4348 4544    PKCS7_DETACHED
-0001c220: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c230: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0001c240: 3e73 6967 6e5f 6578 7472 6163 6572 7473  >sign_extracerts
-0001c250: 5f66 696c 650a 2020 2020 2020 2020 2020  _file.          
-0001c260: 2020 2020 2020 2020 2020 293b 0a20 2020            );.   
-0001c270: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
-0001c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c290: 4075 6e6c 696e 6b28 2466 696c 6529 3b0a  @unlink($file);.
-0001c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2b0: 6966 2028 2473 6967 6e29 207b 0a20 2020  if ($sign) {.   
-0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2d0: 2024 626f 6479 203d 2066 696c 655f 6765   $body = file_ge
-0001c2e0: 745f 636f 6e74 656e 7473 2824 7369 676e  t_contents($sign
-0001c2f0: 6564 293b 0a20 2020 2020 2020 2020 2020  ed);.           
-0001c300: 2020 2020 2020 2020 2040 756e 6c69 6e6b           @unlink
-0001c310: 2824 7369 676e 6564 293b 0a20 2020 2020  ($signed);.     
-0001c320: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-0001c330: 2f54 6865 206d 6573 7361 6765 2072 6574  /The message ret
-0001c340: 7572 6e65 6420 6279 206f 7065 6e73 736c  urned by openssl
-0001c350: 2063 6f6e 7461 696e 7320 626f 7468 2068   contains both h
-0001c360: 6561 6465 7273 2061 6e64 2062 6f64 792c  eaders and body,
-0001c370: 2073 6f20 6e65 6564 2074 6f20 7370 6c69   so need to spli
-0001c380: 7420 7468 656d 2075 700a 2020 2020 2020  t them up.      
-0001c390: 2020 2020 2020 2020 2020 2020 2020 2470                $p
-0001c3a0: 6172 7473 203d 2065 7870 6c6f 6465 2822  arts = explode("
-0001c3b0: 5c6e 5c6e 222c 2024 626f 6479 2c20 3229  \n\n", $body, 2)
-0001c3c0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001c3d0: 2020 2020 2020 2474 6869 732d 3e4d 494d        $this->MIM
-0001c3e0: 4548 6561 6465 7220 2e3d 2024 7061 7274  EHeader .= $part
-0001c3f0: 735b 305d 202e 2073 7461 7469 633a 3a24  s[0] . static::$
-0001c400: 4c45 202e 2073 7461 7469 633a 3a24 4c45  LE . static::$LE
-0001c410: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001c420: 2020 2020 2020 2462 6f64 7920 3d20 2470        $body = $p
-0001c430: 6172 7473 5b31 5d3b 0a20 2020 2020 2020  arts[1];.       
-0001c440: 2020 2020 2020 2020 207d 2065 6c73 6520           } else 
-0001c450: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001c460: 2020 2020 2020 4075 6e6c 696e 6b28 2473        @unlink($s
-0001c470: 6967 6e65 6429 3b0a 2020 2020 2020 2020  igned);.        
-0001c480: 2020 2020 2020 2020 2020 2020 7468 726f              thro
-0001c490: 7720 6e65 7720 4578 6365 7074 696f 6e28  w new Exception(
-0001c4a0: 2474 6869 732d 3e6c 616e 6728 2773 6967  $this->lang('sig
-0001c4b0: 6e69 6e67 2729 202e 206f 7065 6e73 736c  ning') . openssl
-0001c4c0: 5f65 7272 6f72 5f73 7472 696e 6728 2929  _error_string())
-0001c4d0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001c4e0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-0001c4f0: 7d20 6361 7463 6820 2845 7863 6570 7469  } catch (Excepti
-0001c500: 6f6e 2024 6578 6329 207b 0a20 2020 2020  on $exc) {.     
-0001c510: 2020 2020 2020 2020 2020 2024 626f 6479             $body
-0001c520: 203d 2027 273b 0a20 2020 2020 2020 2020   = '';.         
-0001c530: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
-0001c540: 2d3e 6578 6365 7074 696f 6e73 2920 7b0a  ->exceptions) {.
-0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c560: 2020 2020 7468 726f 7720 2465 7863 3b0a      throw $exc;.
-0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c580: 7d0a 2020 2020 2020 2020 2020 2020 7d0a  }.            }.
-0001c590: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0001c5a0: 2020 2072 6574 7572 6e20 2462 6f64 793b     return $body;
-0001c5b0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-0001c5c0: 2020 2020 202a 2052 6574 7572 6e20 7468       * Return th
-0001c5d0: 6520 7374 6172 7420 6f66 2061 206d 6573  e start of a mes
-0001c5e0: 7361 6765 2062 6f75 6e64 6172 792e 0a20  sage boundary.. 
-0001c5f0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-0001c600: 7261 6d20 7374 7269 6e67 2024 626f 756e  ram string $boun
-0001c610: 6461 7279 0a20 2020 2020 2a20 4070 6172  dary.     * @par
-0001c620: 616d 2073 7472 696e 6720 2463 6861 7253  am string $charS
-0001c630: 6574 0a20 2020 2020 2a20 4070 6172 616d  et.     * @param
-0001c640: 2073 7472 696e 6720 2463 6f6e 7465 6e74   string $content
-0001c650: 5479 7065 0a20 2020 2020 2a20 4070 6172  Type.     * @par
-0001c660: 616d 2073 7472 696e 6720 2465 6e63 6f64  am string $encod
-0001c670: 696e 670a 2020 2020 202a 0a20 2020 2020  ing.     *.     
-0001c680: 2a20 4072 6574 7572 6e20 7374 7269 6e67  * @return string
-0001c690: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
-0001c6a0: 7465 6374 6564 2066 756e 6374 696f 6e20  tected function 
-0001c6b0: 6765 7442 6f75 6e64 6172 7928 2462 6f75  getBoundary($bou
-0001c6c0: 6e64 6172 792c 2024 6368 6172 5365 742c  ndary, $charSet,
-0001c6d0: 2024 636f 6e74 656e 7454 7970 652c 2024   $contentType, $
-0001c6e0: 656e 636f 6469 6e67 290a 2020 2020 7b0a  encoding).    {.
-0001c6f0: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
-0001c700: 3d20 2727 3b0a 2020 2020 2020 2020 6966  = '';.        if
-0001c710: 2028 2727 203d 3d3d 2024 6368 6172 5365   ('' === $charSe
-0001c720: 7429 207b 0a20 2020 2020 2020 2020 2020  t) {.           
-0001c730: 2024 6368 6172 5365 7420 3d20 2474 6869   $charSet = $thi
-0001c740: 732d 3e43 6861 7253 6574 3b0a 2020 2020  s->CharSet;.    
-0001c750: 2020 2020 7d0a 2020 2020 2020 2020 6966      }.        if
-0001c760: 2028 2727 203d 3d3d 2024 636f 6e74 656e   ('' === $conten
-0001c770: 7454 7970 6529 207b 0a20 2020 2020 2020  tType) {.       
-0001c780: 2020 2020 2024 636f 6e74 656e 7454 7970       $contentTyp
-0001c790: 6520 3d20 2474 6869 732d 3e43 6f6e 7465  e = $this->Conte
-0001c7a0: 6e74 5479 7065 3b0a 2020 2020 2020 2020  ntType;.        
-0001c7b0: 7d0a 2020 2020 2020 2020 6966 2028 2727  }.        if (''
-0001c7c0: 203d 3d3d 2024 656e 636f 6469 6e67 2920   === $encoding) 
-0001c7d0: 7b0a 2020 2020 2020 2020 2020 2020 2465  {.            $e
-0001c7e0: 6e63 6f64 696e 6720 3d20 2474 6869 732d  ncoding = $this-
-0001c7f0: 3e45 6e63 6f64 696e 673b 0a20 2020 2020  >Encoding;.     
-0001c800: 2020 207d 0a20 2020 2020 2020 2024 7265     }.        $re
-0001c810: 7375 6c74 202e 3d20 2474 6869 732d 3e74  sult .= $this->t
-0001c820: 6578 744c 696e 6528 272d 2d27 202e 2024  extLine('--' . $
-0001c830: 626f 756e 6461 7279 293b 0a20 2020 2020  boundary);.     
-0001c840: 2020 2024 7265 7375 6c74 202e 3d20 7370     $result .= sp
-0001c850: 7269 6e74 6628 2743 6f6e 7465 6e74 2d54  rintf('Content-T
-0001c860: 7970 653a 2025 733b 2063 6861 7273 6574  ype: %s; charset
-0001c870: 3d25 7327 2c20 2463 6f6e 7465 6e74 5479  =%s', $contentTy
-0001c880: 7065 2c20 2463 6861 7253 6574 293b 0a20  pe, $charSet);. 
-0001c890: 2020 2020 2020 2024 7265 7375 6c74 202e         $result .
-0001c8a0: 3d20 7374 6174 6963 3a3a 244c 453b 0a20  = static::$LE;. 
-0001c8b0: 2020 2020 2020 202f 2f52 4643 3133 3431         //RFC1341
-0001c8c0: 2070 6172 7420 3520 7361 7973 2037 6269   part 5 says 7bi
-0001c8d0: 7420 6973 2061 7373 756d 6564 2069 6620  t is assumed if 
-0001c8e0: 6e6f 7420 7370 6563 6966 6965 640a 2020  not specified.  
-0001c8f0: 2020 2020 2020 6966 2028 7374 6174 6963        if (static
-0001c900: 3a3a 454e 434f 4449 4e47 5f37 4249 5420  ::ENCODING_7BIT 
-0001c910: 213d 3d20 2465 6e63 6f64 696e 6729 207b  !== $encoding) {
-0001c920: 0a20 2020 2020 2020 2020 2020 2024 7265  .            $re
-0001c930: 7375 6c74 202e 3d20 2474 6869 732d 3e68  sult .= $this->h
-0001c940: 6561 6465 724c 696e 6528 2743 6f6e 7465  eaderLine('Conte
-0001c950: 6e74 2d54 7261 6e73 6665 722d 456e 636f  nt-Transfer-Enco
-0001c960: 6469 6e67 272c 2024 656e 636f 6469 6e67  ding', $encoding
-0001c970: 293b 0a20 2020 2020 2020 207d 0a20 2020  );.        }.   
-0001c980: 2020 2020 2024 7265 7375 6c74 202e 3d20       $result .= 
-0001c990: 7374 6174 6963 3a3a 244c 453b 0a0a 2020  static::$LE;..  
-0001c9a0: 2020 2020 2020 7265 7475 726e 2024 7265        return $re
-0001c9b0: 7375 6c74 3b0a 2020 2020 7d0a 0a20 2020  sult;.    }..   
-0001c9c0: 202f 2a2a 0a20 2020 2020 2a20 5265 7475   /**.     * Retu
-0001c9d0: 726e 2074 6865 2065 6e64 206f 6620 6120  rn the end of a 
-0001c9e0: 6d65 7373 6167 6520 626f 756e 6461 7279  message boundary
-0001c9f0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-0001ca00: 4070 6172 616d 2073 7472 696e 6720 2462  @param string $b
-0001ca10: 6f75 6e64 6172 790a 2020 2020 202a 0a20  oundary.     *. 
-0001ca20: 2020 2020 2a20 4072 6574 7572 6e20 7374      * @return st
-0001ca30: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
-0001ca40: 2070 726f 7465 6374 6564 2066 756e 6374   protected funct
-0001ca50: 696f 6e20 656e 6442 6f75 6e64 6172 7928  ion endBoundary(
-0001ca60: 2462 6f75 6e64 6172 7929 0a20 2020 207b  $boundary).    {
-0001ca70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001ca80: 7374 6174 6963 3a3a 244c 4520 2e20 272d  static::$LE . '-
-0001ca90: 2d27 202e 2024 626f 756e 6461 7279 202e  -' . $boundary .
-0001caa0: 2027 2d2d 2720 2e20 7374 6174 6963 3a3a   '--' . static::
-0001cab0: 244c 453b 0a20 2020 207d 0a0a 2020 2020  $LE;.    }..    
-0001cac0: 2f2a 2a0a 2020 2020 202a 2053 6574 2074  /**.     * Set t
-0001cad0: 6865 206d 6573 7361 6765 2074 7970 652e  he message type.
-0001cae0: 0a20 2020 2020 2a20 5048 504d 6169 6c65  .     * PHPMaile
-0001caf0: 7220 6f6e 6c79 2073 7570 706f 7274 7320  r only supports 
-0001cb00: 736f 6d65 2070 7265 7365 7420 6d65 7373  some preset mess
-0001cb10: 6167 6520 7479 7065 732c 206e 6f74 2061  age types, not a
-0001cb20: 7262 6974 7261 7279 204d 494d 4520 7374  rbitrary MIME st
-0001cb30: 7275 6374 7572 6573 2e0a 2020 2020 202a  ructures..     *
-0001cb40: 2f0a 2020 2020 7072 6f74 6563 7465 6420  /.    protected 
-0001cb50: 6675 6e63 7469 6f6e 2073 6574 4d65 7373  function setMess
-0001cb60: 6167 6554 7970 6528 290a 2020 2020 7b0a  ageType().    {.
-0001cb70: 2020 2020 2020 2020 2474 7970 6520 3d20          $type = 
-0001cb80: 5b5d 3b0a 2020 2020 2020 2020 6966 2028  [];.        if (
-0001cb90: 2474 6869 732d 3e61 6c74 6572 6e61 7469  $this->alternati
-0001cba0: 7665 4578 6973 7473 2829 2920 7b0a 2020  veExists()) {.  
-0001cbb0: 2020 2020 2020 2020 2020 2474 7970 655b            $type[
-0001cbc0: 5d20 3d20 2761 6c74 273b 0a20 2020 2020  ] = 'alt';.     
-0001cbd0: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
-0001cbe0: 2824 7468 6973 2d3e 696e 6c69 6e65 496d  ($this->inlineIm
-0001cbf0: 6167 6545 7869 7374 7328 2929 207b 0a20  ageExists()) {. 
-0001cc00: 2020 2020 2020 2020 2020 2024 7479 7065             $type
-0001cc10: 5b5d 203d 2027 696e 6c69 6e65 273b 0a20  [] = 'inline';. 
-0001cc20: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0001cc30: 2069 6620 2824 7468 6973 2d3e 6174 7461   if ($this->atta
-0001cc40: 6368 6d65 6e74 4578 6973 7473 2829 2920  chmentExists()) 
-0001cc50: 7b0a 2020 2020 2020 2020 2020 2020 2474  {.            $t
-0001cc60: 7970 655b 5d20 3d20 2761 7474 6163 6827  ype[] = 'attach'
-0001cc70: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
-0001cc80: 2020 2020 2474 6869 732d 3e6d 6573 7361      $this->messa
-0001cc90: 6765 5f74 7970 6520 3d20 696d 706c 6f64  ge_type = implod
-0001cca0: 6528 275f 272c 2024 7479 7065 293b 0a20  e('_', $type);. 
-0001ccb0: 2020 2020 2020 2069 6620 2827 2720 3d3d         if ('' ==
-0001ccc0: 3d20 2474 6869 732d 3e6d 6573 7361 6765  = $this->message
-0001ccd0: 5f74 7970 6529 207b 0a20 2020 2020 2020  _type) {.       
-0001cce0: 2020 2020 202f 2f54 6865 2027 706c 6169       //The 'plai
-0001ccf0: 6e27 206d 6573 7361 6765 5f74 7970 6520  n' message_type 
-0001cd00: 7265 6665 7273 2074 6f20 7468 6520 6d65  refers to the me
-0001cd10: 7373 6167 6520 6861 7669 6e67 2061 2073  ssage having a s
-0001cd20: 696e 676c 6520 626f 6479 2065 6c65 6d65  ingle body eleme
-0001cd30: 6e74 2c20 6e6f 7420 7468 6174 2069 7420  nt, not that it 
-0001cd40: 6973 2070 6c61 696e 2d74 6578 740a 2020  is plain-text.  
-0001cd50: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-0001cd60: 3e6d 6573 7361 6765 5f74 7970 6520 3d20  >message_type = 
-0001cd70: 2770 6c61 696e 273b 0a20 2020 2020 2020  'plain';.       
-0001cd80: 207d 0a20 2020 207d 0a0a 2020 2020 2f2a   }.    }..    /*
-0001cd90: 2a0a 2020 2020 202a 2046 6f72 6d61 7420  *.     * Format 
-0001cda0: 6120 6865 6164 6572 206c 696e 652e 0a20  a header line.. 
-0001cdb0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-0001cdc0: 7261 6d20 7374 7269 6e67 2020 2020 2024  ram string     $
-0001cdd0: 6e61 6d65 0a20 2020 2020 2a20 4070 6172  name.     * @par
-0001cde0: 616d 2073 7472 696e 677c 696e 7420 2476  am string|int $v
-0001cdf0: 616c 7565 0a20 2020 2020 2a0a 2020 2020  alue.     *.    
-0001ce00: 202a 2040 7265 7475 726e 2073 7472 696e   * @return strin
-0001ce10: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
-0001ce20: 626c 6963 2066 756e 6374 696f 6e20 6865  blic function he
-0001ce30: 6164 6572 4c69 6e65 2824 6e61 6d65 2c20  aderLine($name, 
-0001ce40: 2476 616c 7565 290a 2020 2020 7b0a 2020  $value).    {.  
-0001ce50: 2020 2020 2020 7265 7475 726e 2024 6e61        return $na
-0001ce60: 6d65 202e 2027 3a20 2720 2e20 2476 616c  me . ': ' . $val
-0001ce70: 7565 202e 2073 7461 7469 633a 3a24 4c45  ue . static::$LE
-0001ce80: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-0001ce90: 0a20 2020 2020 2a20 5265 7475 726e 2061  .     * Return a
-0001cea0: 2066 6f72 6d61 7474 6564 206d 6169 6c20   formatted mail 
-0001ceb0: 6c69 6e65 2e0a 2020 2020 202a 0a20 2020  line..     *.   
-0001cec0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-0001ced0: 6720 2476 616c 7565 0a20 2020 2020 2a0a  g $value.     *.
-0001cee0: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
-0001cef0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-0001cf00: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
-0001cf10: 6e20 7465 7874 4c69 6e65 2824 7661 6c75  n textLine($valu
-0001cf20: 6529 0a20 2020 207b 0a20 2020 2020 2020  e).    {.       
-0001cf30: 2072 6574 7572 6e20 2476 616c 7565 202e   return $value .
-0001cf40: 2073 7461 7469 633a 3a24 4c45 3b0a 2020   static::$LE;.  
-0001cf50: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-0001cf60: 2020 2a20 4164 6420 616e 2061 7474 6163    * Add an attac
-0001cf70: 686d 656e 7420 6672 6f6d 2061 2070 6174  hment from a pat
-0001cf80: 6820 6f6e 2074 6865 2066 696c 6573 7973  h on the filesys
-0001cf90: 7465 6d2e 0a20 2020 2020 2a20 4e65 7665  tem..     * Neve
-0001cfa0: 7220 7573 6520 6120 7573 6572 2d73 7570  r use a user-sup
-0001cfb0: 706c 6965 6420 7061 7468 2074 6f20 6120  plied path to a 
-0001cfc0: 6669 6c65 210a 2020 2020 202a 2052 6574  file!.     * Ret
-0001cfd0: 7572 6e73 2066 616c 7365 2069 6620 7468  urns false if th
-0001cfe0: 6520 6669 6c65 2063 6f75 6c64 206e 6f74  e file could not
-0001cff0: 2062 6520 666f 756e 6420 6f72 2072 6561   be found or rea
-0001d000: 642e 0a20 2020 2020 2a20 4578 706c 6963  d..     * Explic
-0001d010: 6974 6c79 202a 646f 6573 206e 6f74 2a20  itly *does not* 
-0001d020: 7375 7070 6f72 7420 7061 7373 696e 6720  support passing 
-0001d030: 5552 4c73 3b20 5048 504d 6169 6c65 7220  URLs; PHPMailer 
-0001d040: 6973 206e 6f74 2061 6e20 4854 5450 2063  is not an HTTP c
-0001d050: 6c69 656e 742e 0a20 2020 2020 2a20 4966  lient..     * If
-0001d060: 2079 6f75 206e 6565 6420 746f 2064 6f20   you need to do 
-0001d070: 7468 6174 2c20 6665 7463 6820 7468 6520  that, fetch the 
-0001d080: 7265 736f 7572 6365 2079 6f75 7273 656c  resource yoursel
-0001d090: 6620 616e 6420 7061 7373 2069 7420 696e  f and pass it in
-0001d0a0: 2076 6961 2061 206c 6f63 616c 2066 696c   via a local fil
-0001d0b0: 6520 6f72 2073 7472 696e 672e 0a20 2020  e or string..   
-0001d0c0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-0001d0d0: 6d20 7374 7269 6e67 2024 7061 7468 2020  m string $path  
-0001d0e0: 2020 2020 2020 5061 7468 2074 6f20 7468        Path to th
-0001d0f0: 6520 6174 7461 6368 6d65 6e74 0a20 2020  e attachment.   
-0001d100: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-0001d110: 6720 246e 616d 6520 2020 2020 2020 204f  g $name        O
-0001d120: 7665 7272 6964 6573 2074 6865 2061 7474  verrides the att
-0001d130: 6163 686d 656e 7420 6e61 6d65 0a20 2020  achment name.   
-0001d140: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-0001d150: 6720 2465 6e63 6f64 696e 6720 2020 2046  g $encoding    F
-0001d160: 696c 6520 656e 636f 6469 6e67 2028 7365  ile encoding (se
-0001d170: 6520 2445 6e63 6f64 696e 6729 0a20 2020  e $Encoding).   
-0001d180: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-0001d190: 6720 2474 7970 6520 2020 2020 2020 204d  g $type        M
-0001d1a0: 494d 4520 7479 7065 2c20 652e 672e 2060  IME type, e.g. `
-0001d1b0: 696d 6167 652f 6a70 6567 603b 2064 6574  image/jpeg`; det
-0001d1c0: 6572 6d69 6e65 6420 6175 746f 6d61 7469  ermined automati
-0001d1d0: 6361 6c6c 7920 6672 6f6d 2024 7061 7468  cally from $path
-0001d1e0: 2069 6620 6e6f 7420 7370 6563 6966 6965   if not specifie
-0001d1f0: 640a 2020 2020 202a 2040 7061 7261 6d20  d.     * @param 
-0001d200: 7374 7269 6e67 2024 6469 7370 6f73 6974  string $disposit
-0001d210: 696f 6e20 4469 7370 6f73 6974 696f 6e20  ion Disposition 
-0001d220: 746f 2075 7365 0a20 2020 2020 2a0a 2020  to use.     *.  
-0001d230: 2020 202a 2040 7468 726f 7773 2045 7863     * @throws Exc
-0001d240: 6570 7469 6f6e 0a20 2020 2020 2a0a 2020  eption.     *.  
-0001d250: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
-0001d260: 6c0a 2020 2020 202a 2f0a 2020 2020 7075  l.     */.    pu
-0001d270: 626c 6963 2066 756e 6374 696f 6e20 6164  blic function ad
-0001d280: 6441 7474 6163 686d 656e 7428 0a20 2020  dAttachment(.   
-0001d290: 2020 2020 2024 7061 7468 2c0a 2020 2020       $path,.    
-0001d2a0: 2020 2020 246e 616d 6520 3d20 2727 2c0a      $name = '',.
-0001d2b0: 2020 2020 2020 2020 2465 6e63 6f64 696e          $encodin
-0001d2c0: 6720 3d20 7365 6c66 3a3a 454e 434f 4449  g = self::ENCODI
-0001d2d0: 4e47 5f42 4153 4536 342c 0a20 2020 2020  NG_BASE64,.     
-0001d2e0: 2020 2024 7479 7065 203d 2027 272c 0a20     $type = '',. 
-0001d2f0: 2020 2020 2020 2024 6469 7370 6f73 6974         $disposit
-0001d300: 696f 6e20 3d20 2761 7474 6163 686d 656e  ion = 'attachmen
-0001d310: 7427 0a20 2020 2029 207b 0a20 2020 2020  t'.    ) {.     
-0001d320: 2020 2074 7279 207b 0a20 2020 2020 2020     try {.       
-0001d330: 2020 2020 2069 6620 2821 7374 6174 6963       if (!static
-0001d340: 3a3a 6669 6c65 4973 4163 6365 7373 6962  ::fileIsAccessib
-0001d350: 6c65 2824 7061 7468 2929 207b 0a20 2020  le($path)) {.   
-0001d360: 2020 2020 2020 2020 2020 2020 2074 6872               thr
-0001d370: 6f77 206e 6577 2045 7863 6570 7469 6f6e  ow new Exception
-0001d380: 2824 7468 6973 2d3e 6c61 6e67 2827 6669  ($this->lang('fi
-0001d390: 6c65 5f61 6363 6573 7327 2920 2e20 2470  le_access') . $p
-0001d3a0: 6174 682c 2073 656c 663a 3a53 544f 505f  ath, self::STOP_
-0001d3b0: 434f 4e54 494e 5545 293b 0a20 2020 2020  CONTINUE);.     
-0001d3c0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-0001d3d0: 2020 2020 2020 2f2f 4966 2061 204d 494d        //If a MIM
-0001d3e0: 4520 7479 7065 2069 7320 6e6f 7420 7370  E type is not sp
-0001d3f0: 6563 6966 6965 642c 2074 7279 2074 6f20  ecified, try to 
-0001d400: 776f 726b 2069 7420 6f75 7420 6672 6f6d  work it out from
-0001d410: 2074 6865 2066 696c 6520 6e61 6d65 0a20   the file name. 
-0001d420: 2020 2020 2020 2020 2020 2069 6620 2827             if ('
-0001d430: 2720 3d3d 3d20 2474 7970 6529 207b 0a20  ' === $type) {. 
-0001d440: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001d450: 7479 7065 203d 2073 7461 7469 633a 3a66  type = static::f
-0001d460: 696c 656e 616d 6554 6f54 7970 6528 2470  ilenameToType($p
-0001d470: 6174 6829 3b0a 2020 2020 2020 2020 2020  ath);.          
-0001d480: 2020 7d0a 0a20 2020 2020 2020 2020 2020    }..           
-0001d490: 2024 6669 6c65 6e61 6d65 203d 2028 7374   $filename = (st
-0001d4a0: 7269 6e67 2920 7374 6174 6963 3a3a 6d62  ring) static::mb
-0001d4b0: 5f70 6174 6869 6e66 6f28 2470 6174 682c  _pathinfo($path,
-0001d4c0: 2050 4154 4849 4e46 4f5f 4241 5345 4e41   PATHINFO_BASENA
-0001d4d0: 4d45 293b 0a20 2020 2020 2020 2020 2020  ME);.           
-0001d4e0: 2069 6620 2827 2720 3d3d 3d20 246e 616d   if ('' === $nam
-0001d4f0: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-0001d500: 2020 2020 2024 6e61 6d65 203d 2024 6669       $name = $fi
-0001d510: 6c65 6e61 6d65 3b0a 2020 2020 2020 2020  lename;.        
-0001d520: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0001d530: 2020 6966 2028 2124 7468 6973 2d3e 7661    if (!$this->va
-0001d540: 6c69 6461 7465 456e 636f 6469 6e67 2824  lidateEncoding($
-0001d550: 656e 636f 6469 6e67 2929 207b 0a20 2020  encoding)) {.   
-0001d560: 2020 2020 2020 2020 2020 2020 2074 6872               thr
-0001d570: 6f77 206e 6577 2045 7863 6570 7469 6f6e  ow new Exception
-0001d580: 2824 7468 6973 2d3e 6c61 6e67 2827 656e  ($this->lang('en
-0001d590: 636f 6469 6e67 2729 202e 2024 656e 636f  coding') . $enco
-0001d5a0: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
-0001d5b0: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-0001d5c0: 2020 2474 6869 732d 3e61 7474 6163 686d    $this->attachm
-0001d5d0: 656e 745b 5d20 3d20 5b0a 2020 2020 2020  ent[] = [.      
-0001d5e0: 2020 2020 2020 2020 2020 3020 3d3e 2024            0 => $
-0001d5f0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-0001d600: 2020 2020 2020 3120 3d3e 2024 6669 6c65        1 => $file
-0001d610: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-0001d620: 2020 2020 2020 3220 3d3e 2024 6e61 6d65        2 => $name
-0001d630: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d640: 2020 3320 3d3e 2024 656e 636f 6469 6e67    3 => $encoding
-0001d650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d660: 2020 3420 3d3e 2024 7479 7065 2c0a 2020    4 => $type,.  
-0001d670: 2020 2020 2020 2020 2020 2020 2020 3520                5 
-0001d680: 3d3e 2066 616c 7365 2c20 2f2f 6973 5374  => false, //isSt
-0001d690: 7269 6e67 4174 7461 6368 6d65 6e74 0a20  ringAttachment. 
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2036                 6
-0001d6b0: 203d 3e20 2464 6973 706f 7369 7469 6f6e   => $disposition
-0001d6c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d6d0: 2020 3720 3d3e 2024 6e61 6d65 2c0a 2020    7 => $name,.  
-0001d6e0: 2020 2020 2020 2020 2020 5d3b 0a20 2020            ];.   
-0001d6f0: 2020 2020 207d 2063 6174 6368 2028 4578       } catch (Ex
-0001d700: 6365 7074 696f 6e20 2465 7863 2920 7b0a  ception $exc) {.
-0001d710: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-0001d720: 732d 3e73 6574 4572 726f 7228 2465 7863  s->setError($exc
-0001d730: 2d3e 6765 744d 6573 7361 6765 2829 293b  ->getMessage());
-0001d740: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
-0001d750: 6973 2d3e 6564 6562 7567 2824 6578 632d  is->edebug($exc-
-0001d760: 3e67 6574 4d65 7373 6167 6528 2929 3b0a  >getMessage());.
-0001d770: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0001d780: 2474 6869 732d 3e65 7863 6570 7469 6f6e  $this->exception
-0001d790: 7329 207b 0a20 2020 2020 2020 2020 2020  s) {.           
-0001d7a0: 2020 2020 2074 6872 6f77 2024 6578 633b       throw $exc;
-0001d7b0: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-0001d7c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001d7d0: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
-0001d7e0: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
-0001d7f0: 7572 6e20 7472 7565 3b0a 2020 2020 7d0a  urn true;.    }.
-0001d800: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0001d810: 5265 7475 726e 2074 6865 2061 7272 6179  Return the array
-0001d820: 206f 6620 6174 7461 6368 6d65 6e74 732e   of attachments.
+0001b8f0: 2727 2c0a 2020 2020 2020 2020 2020 2020  '',.            
+0001b900: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+0001b910: 6963 3a3a 434f 4e54 454e 545f 5459 5045  ic::CONTENT_TYPE
+0001b920: 5f54 4558 545f 4341 4c45 4e44 4152 202e  _TEXT_CALENDAR .
+0001b930: 2027 3b20 6d65 7468 6f64 3d27 202e 2024   '; method=' . $
+0001b940: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
+0001b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b960: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+0001b970: 2020 2020 2020 2029 3b0a 2020 2020 2020         );.      
+0001b980: 2020 2020 2020 2020 2020 2020 2020 2462                $b
+0001b990: 6f64 7920 2e3d 2024 7468 6973 2d3e 656e  ody .= $this->en
+0001b9a0: 636f 6465 5374 7269 6e67 2824 7468 6973  codeString($this
+0001b9b0: 2d3e 4963 616c 2c20 2474 6869 732d 3e45  ->Ical, $this->E
+0001b9c0: 6e63 6f64 696e 6729 3b0a 2020 2020 2020  ncoding);.      
+0001b9d0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+0001b9e0: 2020 2020 2020 2020 2020 2020 2462 6f64              $bod
+0001b9f0: 7920 2e3d 2024 7468 6973 2d3e 656e 6442  y .= $this->endB
+0001ba00: 6f75 6e64 6172 7928 2474 6869 732d 3e62  oundary($this->b
+0001ba10: 6f75 6e64 6172 795b 325d 293b 0a20 2020  oundary[2]);.   
+0001ba20: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+0001ba30: 6479 202e 3d20 7374 6174 6963 3a3a 244c  dy .= static::$L
+0001ba40: 453b 0a20 2020 2020 2020 2020 2020 2020  E;.             
+0001ba50: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
+0001ba60: 732d 3e61 7474 6163 6841 6c6c 2827 6174  s->attachAll('at
+0001ba70: 7461 6368 6d65 6e74 272c 2024 7468 6973  tachment', $this
+0001ba80: 2d3e 626f 756e 6461 7279 5b31 5d29 3b0a  ->boundary[1]);.
+0001ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001baa0: 6272 6561 6b3b 0a20 2020 2020 2020 2020  break;.         
+0001bab0: 2020 2063 6173 6520 2761 6c74 5f69 6e6c     case 'alt_inl
+0001bac0: 696e 655f 6174 7461 6368 273a 0a20 2020  ine_attach':.   
+0001bad0: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+0001bae0: 6479 202e 3d20 246d 696d 6570 7265 3b0a  dy .= $mimepre;.
+0001baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb00: 2462 6f64 7920 2e3d 2024 7468 6973 2d3e  $body .= $this->
+0001bb10: 7465 7874 4c69 6e65 2827 2d2d 2720 2e20  textLine('--' . 
+0001bb20: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
+0001bb30: 315d 293b 0a20 2020 2020 2020 2020 2020  1]);.           
+0001bb40: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
+0001bb50: 6869 732d 3e68 6561 6465 724c 696e 6528  his->headerLine(
+0001bb60: 2743 6f6e 7465 6e74 2d54 7970 6527 2c20  'Content-Type', 
+0001bb70: 7374 6174 6963 3a3a 434f 4e54 454e 545f  static::CONTENT_
+0001bb80: 5459 5045 5f4d 554c 5449 5041 5254 5f41  TYPE_MULTIPART_A
+0001bb90: 4c54 4552 4e41 5449 5645 202e 2027 3b27  LTERNATIVE . ';'
+0001bba0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001bbb0: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
+0001bbc0: 732d 3e74 6578 744c 696e 6528 2720 626f  s->textLine(' bo
+0001bbd0: 756e 6461 7279 3d22 2720 2e20 2474 6869  undary="' . $thi
+0001bbe0: 732d 3e62 6f75 6e64 6172 795b 325d 202e  s->boundary[2] .
+0001bbf0: 2027 2227 293b 0a20 2020 2020 2020 2020   '"');.         
+0001bc00: 2020 2020 2020 2024 626f 6479 202e 3d20         $body .= 
+0001bc10: 7374 6174 6963 3a3a 244c 453b 0a20 2020  static::$LE;.   
+0001bc20: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+0001bc30: 6479 202e 3d20 2474 6869 732d 3e67 6574  dy .= $this->get
+0001bc40: 426f 756e 6461 7279 280a 2020 2020 2020  Boundary(.      
+0001bc50: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+0001bc60: 6869 732d 3e62 6f75 6e64 6172 795b 325d  his->boundary[2]
+0001bc70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001bc80: 2020 2020 2020 2461 6c74 426f 6479 4368        $altBodyCh
+0001bc90: 6172 5365 742c 0a20 2020 2020 2020 2020  arSet,.         
+0001bca0: 2020 2020 2020 2020 2020 2073 7461 7469             stati
+0001bcb0: 633a 3a43 4f4e 5445 4e54 5f54 5950 455f  c::CONTENT_TYPE_
+0001bcc0: 504c 4149 4e54 4558 542c 0a20 2020 2020  PLAINTEXT,.     
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001bce0: 616c 7442 6f64 7945 6e63 6f64 696e 670a  altBodyEncoding.
+0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd00: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001bd10: 2020 2024 626f 6479 202e 3d20 2474 6869     $body .= $thi
+0001bd20: 732d 3e65 6e63 6f64 6553 7472 696e 6728  s->encodeString(
+0001bd30: 2474 6869 732d 3e41 6c74 426f 6479 2c20  $this->AltBody, 
+0001bd40: 2461 6c74 426f 6479 456e 636f 6469 6e67  $altBodyEncoding
+0001bd50: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001bd60: 2020 2024 626f 6479 202e 3d20 7374 6174     $body .= stat
+0001bd70: 6963 3a3a 244c 453b 0a20 2020 2020 2020  ic::$LE;.       
+0001bd80: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001bd90: 3d20 2474 6869 732d 3e74 6578 744c 696e  = $this->textLin
+0001bda0: 6528 272d 2d27 202e 2024 7468 6973 2d3e  e('--' . $this->
+0001bdb0: 626f 756e 6461 7279 5b32 5d29 3b0a 2020  boundary[2]);.  
+0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
+0001bdd0: 6f64 7920 2e3d 2024 7468 6973 2d3e 6865  ody .= $this->he
+0001bde0: 6164 6572 4c69 6e65 2827 436f 6e74 656e  aderLine('Conten
+0001bdf0: 742d 5479 7065 272c 2073 7461 7469 633a  t-Type', static:
+0001be00: 3a43 4f4e 5445 4e54 5f54 5950 455f 4d55  :CONTENT_TYPE_MU
+0001be10: 4c54 4950 4152 545f 5245 4c41 5445 4420  LTIPART_RELATED 
+0001be20: 2e20 273b 2729 3b0a 2020 2020 2020 2020  . ';');.        
+0001be30: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
+0001be40: 2024 7468 6973 2d3e 7465 7874 4c69 6e65   $this->textLine
+0001be50: 2827 2062 6f75 6e64 6172 793d 2227 202e  (' boundary="' .
+0001be60: 2024 7468 6973 2d3e 626f 756e 6461 7279   $this->boundary
+0001be70: 5b33 5d20 2e20 2722 3b27 293b 0a20 2020  [3] . '";');.   
+0001be80: 2020 2020 2020 2020 2020 2020 2024 626f               $bo
+0001be90: 6479 202e 3d20 2474 6869 732d 3e74 6578  dy .= $this->tex
+0001bea0: 744c 696e 6528 2720 7479 7065 3d22 2720  tLine(' type="' 
+0001beb0: 2e20 7374 6174 6963 3a3a 434f 4e54 454e  . static::CONTEN
+0001bec0: 545f 5459 5045 5f54 4558 545f 4854 4d4c  T_TYPE_TEXT_HTML
+0001bed0: 202e 2027 2227 293b 0a20 2020 2020 2020   . '"');.       
+0001bee0: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001bef0: 3d20 7374 6174 6963 3a3a 244c 453b 0a20  = static::$LE;. 
+0001bf00: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001bf10: 626f 6479 202e 3d20 2474 6869 732d 3e67  body .= $this->g
+0001bf20: 6574 426f 756e 6461 7279 280a 2020 2020  etBoundary(.    
+0001bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf40: 2474 6869 732d 3e62 6f75 6e64 6172 795b  $this->boundary[
+0001bf50: 335d 2c0a 2020 2020 2020 2020 2020 2020  3],.            
+0001bf60: 2020 2020 2020 2020 2462 6f64 7943 6861          $bodyCha
+0001bf70: 7253 6574 2c0a 2020 2020 2020 2020 2020  rSet,.          
+0001bf80: 2020 2020 2020 2020 2020 7374 6174 6963            static
+0001bf90: 3a3a 434f 4e54 454e 545f 5459 5045 5f54  ::CONTENT_TYPE_T
+0001bfa0: 4558 545f 4854 4d4c 2c0a 2020 2020 2020  EXT_HTML,.      
+0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
+0001bfc0: 6f64 7945 6e63 6f64 696e 670a 2020 2020  odyEncoding.    
+0001bfd0: 2020 2020 2020 2020 2020 2020 293b 0a20              );. 
+0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001bff0: 626f 6479 202e 3d20 2474 6869 732d 3e65  body .= $this->e
+0001c000: 6e63 6f64 6553 7472 696e 6728 2474 6869  ncodeString($thi
+0001c010: 732d 3e42 6f64 792c 2024 626f 6479 456e  s->Body, $bodyEn
+0001c020: 636f 6469 6e67 293b 0a20 2020 2020 2020  coding);.       
+0001c030: 2020 2020 2020 2020 2024 626f 6479 202e           $body .
+0001c040: 3d20 7374 6174 6963 3a3a 244c 453b 0a20  = static::$LE;. 
+0001c050: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001c060: 626f 6479 202e 3d20 2474 6869 732d 3e61  body .= $this->a
+0001c070: 7474 6163 6841 6c6c 2827 696e 6c69 6e65  ttachAll('inline
+0001c080: 272c 2024 7468 6973 2d3e 626f 756e 6461  ', $this->bounda
+0001c090: 7279 5b33 5d29 3b0a 2020 2020 2020 2020  ry[3]);.        
+0001c0a0: 2020 2020 2020 2020 2462 6f64 7920 2e3d          $body .=
+0001c0b0: 2073 7461 7469 633a 3a24 4c45 3b0a 2020   static::$LE;.  
+0001c0c0: 2020 2020 2020 2020 2020 2020 2020 2462                $b
+0001c0d0: 6f64 7920 2e3d 2024 7468 6973 2d3e 656e  ody .= $this->en
+0001c0e0: 6442 6f75 6e64 6172 7928 2474 6869 732d  dBoundary($this-
+0001c0f0: 3e62 6f75 6e64 6172 795b 325d 293b 0a20  >boundary[2]);. 
+0001c100: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001c110: 626f 6479 202e 3d20 7374 6174 6963 3a3a  body .= static::
+0001c120: 244c 453b 0a20 2020 2020 2020 2020 2020  $LE;.           
+0001c130: 2020 2020 2024 626f 6479 202e 3d20 2474       $body .= $t
+0001c140: 6869 732d 3e61 7474 6163 6841 6c6c 2827  his->attachAll('
+0001c150: 6174 7461 6368 6d65 6e74 272c 2024 7468  attachment', $th
+0001c160: 6973 2d3e 626f 756e 6461 7279 5b31 5d29  is->boundary[1])
+0001c170: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0001c180: 2020 6272 6561 6b3b 0a20 2020 2020 2020    break;.       
+0001c190: 2020 2020 2064 6566 6175 6c74 3a0a 2020       default:.  
+0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
+0001c1b0: 4361 7463 6820 6361 7365 2027 706c 6169  Catch case 'plai
+0001c1c0: 6e27 2061 6e64 2063 6173 6520 2727 2c20  n' and case '', 
+0001c1d0: 6170 706c 6965 7320 746f 2073 696d 706c  applies to simpl
+0001c1e0: 6520 6074 6578 742f 706c 6169 6e60 2061  e `text/plain` a
+0001c1f0: 6e64 2060 7465 7874 2f68 746d 6c60 2062  nd `text/html` b
+0001c200: 6f64 7920 636f 6e74 656e 7420 7479 7065  ody content type
+0001c210: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001c220: 2020 2f2f 5265 7365 7420 7468 6520 6045    //Reset the `E
+0001c230: 6e63 6f64 696e 6760 2070 726f 7065 7274  ncoding` propert
+0001c240: 7920 696e 2063 6173 6520 7765 2063 6861  y in case we cha
+0001c250: 6e67 6564 2069 7420 666f 7220 6c69 6e65  nged it for line
+0001c260: 206c 656e 6774 6820 7265 6173 6f6e 730a   length reasons.
+0001c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c280: 2474 6869 732d 3e45 6e63 6f64 696e 6720  $this->Encoding 
+0001c290: 3d20 2462 6f64 7945 6e63 6f64 696e 673b  = $bodyEncoding;
+0001c2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c2b0: 2024 626f 6479 202e 3d20 2474 6869 732d   $body .= $this-
+0001c2c0: 3e65 6e63 6f64 6553 7472 696e 6728 2474  >encodeString($t
+0001c2d0: 6869 732d 3e42 6f64 792c 2024 7468 6973  his->Body, $this
+0001c2e0: 2d3e 456e 636f 6469 6e67 293b 0a20 2020  ->Encoding);.   
+0001c2f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0001c300: 616b 3b0a 2020 2020 2020 2020 7d0a 0a20  ak;.        }.. 
+0001c310: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
+0001c320: 2d3e 6973 4572 726f 7228 2929 207b 0a20  ->isError()) {. 
+0001c330: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001c340: 203d 2027 273b 0a20 2020 2020 2020 2020   = '';.         
+0001c350: 2020 2069 6620 2824 7468 6973 2d3e 6578     if ($this->ex
+0001c360: 6365 7074 696f 6e73 2920 7b0a 2020 2020  ceptions) {.    
+0001c370: 2020 2020 2020 2020 2020 2020 7468 726f              thro
+0001c380: 7720 6e65 7720 4578 6365 7074 696f 6e28  w new Exception(
+0001c390: 2474 6869 732d 3e6c 616e 6728 2765 6d70  $this->lang('emp
+0001c3a0: 7479 5f6d 6573 7361 6765 2729 2c20 7365  ty_message'), se
+0001c3b0: 6c66 3a3a 5354 4f50 5f43 5249 5449 4341  lf::STOP_CRITICA
+0001c3c0: 4c29 3b0a 2020 2020 2020 2020 2020 2020  L);.            
+0001c3d0: 7d0a 2020 2020 2020 2020 7d20 656c 7365  }.        } else
+0001c3e0: 6966 2028 2474 6869 732d 3e73 6967 6e5f  if ($this->sign_
+0001c3f0: 6b65 795f 6669 6c65 2920 7b0a 2020 2020  key_file) {.    
+0001c400: 2020 2020 2020 2020 7472 7920 7b0a 2020          try {.  
+0001c410: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001c420: 2028 2164 6566 696e 6564 2827 504b 4353   (!defined('PKCS
+0001c430: 375f 5445 5854 2729 2920 7b0a 2020 2020  7_TEXT')) {.    
+0001c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c450: 7468 726f 7720 6e65 7720 4578 6365 7074  throw new Except
+0001c460: 696f 6e28 2474 6869 732d 3e6c 616e 6728  ion($this->lang(
+0001c470: 2765 7874 656e 7369 6f6e 5f6d 6973 7369  'extension_missi
+0001c480: 6e67 2729 202e 2027 6f70 656e 7373 6c27  ng') . 'openssl'
+0001c490: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001c4a0: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
+0001c4b0: 2020 2020 2020 2466 696c 6520 3d20 7465        $file = te
+0001c4c0: 6d70 6e61 6d28 7379 735f 6765 745f 7465  mpnam(sys_get_te
+0001c4d0: 6d70 5f64 6972 2829 2c20 2773 7263 7369  mp_dir(), 'srcsi
+0001c4e0: 676e 2729 3b0a 2020 2020 2020 2020 2020  gn');.          
+0001c4f0: 2020 2020 2020 2473 6967 6e65 6420 3d20        $signed = 
+0001c500: 7465 6d70 6e61 6d28 7379 735f 6765 745f  tempnam(sys_get_
+0001c510: 7465 6d70 5f64 6972 2829 2c20 276d 6169  temp_dir(), 'mai
+0001c520: 6c73 6967 6e27 293b 0a20 2020 2020 2020  lsign');.       
+0001c530: 2020 2020 2020 2020 2066 696c 655f 7075           file_pu
+0001c540: 745f 636f 6e74 656e 7473 2824 6669 6c65  t_contents($file
+0001c550: 2c20 2462 6f64 7929 3b0a 0a20 2020 2020  , $body);..     
+0001c560: 2020 2020 2020 2020 2020 202f 2f57 6f72             //Wor
+0001c570: 6b61 726f 756e 6420 666f 7220 5048 5020  karound for PHP 
+0001c580: 6275 6720 6874 7470 733a 2f2f 6275 6773  bug https://bugs
+0001c590: 2e70 6870 2e6e 6574 2f62 7567 2e70 6870  .php.net/bug.php
+0001c5a0: 3f69 643d 3639 3139 370a 2020 2020 2020  ?id=69197.      
+0001c5b0: 2020 2020 2020 2020 2020 6966 2028 656d            if (em
+0001c5c0: 7074 7928 2474 6869 732d 3e73 6967 6e5f  pty($this->sign_
+0001c5d0: 6578 7472 6163 6572 7473 5f66 696c 6529  extracerts_file)
+0001c5e0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001c5f0: 2020 2020 2020 2020 2473 6967 6e20 3d20          $sign = 
+0001c600: 406f 7065 6e73 736c 5f70 6b63 7337 5f73  @openssl_pkcs7_s
+0001c610: 6967 6e28 0a20 2020 2020 2020 2020 2020  ign(.           
+0001c620: 2020 2020 2020 2020 2020 2020 2024 6669               $fi
+0001c630: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+0001c640: 2020 2020 2020 2020 2020 2020 2473 6967              $sig
+0001c650: 6e65 642c 0a20 2020 2020 2020 2020 2020  ned,.           
+0001c660: 2020 2020 2020 2020 2020 2020 2027 6669               'fi
+0001c670: 6c65 3a2f 2f27 202e 2072 6561 6c70 6174  le://' . realpat
+0001c680: 6828 2474 6869 732d 3e73 6967 6e5f 6365  h($this->sign_ce
+0001c690: 7274 5f66 696c 6529 2c0a 2020 2020 2020  rt_file),.      
+0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6b0: 2020 5b27 6669 6c65 3a2f 2f27 202e 2072    ['file://' . r
+0001c6c0: 6561 6c70 6174 6828 2474 6869 732d 3e73  ealpath($this->s
+0001c6d0: 6967 6e5f 6b65 795f 6669 6c65 292c 2024  ign_key_file), $
+0001c6e0: 7468 6973 2d3e 7369 676e 5f6b 6579 5f70  this->sign_key_p
+0001c6f0: 6173 735d 2c0a 2020 2020 2020 2020 2020  ass],.          
+0001c700: 2020 2020 2020 2020 2020 2020 2020 5b5d                []
+0001c710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c720: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
+0001c730: 2020 2020 2020 2020 7d20 656c 7365 207b          } else {
+0001c740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c750: 2020 2020 2024 7369 676e 203d 2040 6f70       $sign = @op
+0001c760: 656e 7373 6c5f 706b 6373 375f 7369 676e  enssl_pkcs7_sign
+0001c770: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001c780: 2020 2020 2020 2020 2020 2466 696c 652c            $file,
+0001c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c7a0: 2020 2020 2020 2020 2024 7369 676e 6564           $signed
+0001c7b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c7c0: 2020 2020 2020 2020 2020 2766 696c 653a            'file:
+0001c7d0: 2f2f 2720 2e20 7265 616c 7061 7468 2824  //' . realpath($
+0001c7e0: 7468 6973 2d3e 7369 676e 5f63 6572 745f  this->sign_cert_
+0001c7f0: 6669 6c65 292c 0a20 2020 2020 2020 2020  file),.         
+0001c800: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0001c810: 2766 696c 653a 2f2f 2720 2e20 7265 616c  'file://' . real
+0001c820: 7061 7468 2824 7468 6973 2d3e 7369 676e  path($this->sign
+0001c830: 5f6b 6579 5f66 696c 6529 2c20 2474 6869  _key_file), $thi
+0001c840: 732d 3e73 6967 6e5f 6b65 795f 7061 7373  s->sign_key_pass
+0001c850: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001c860: 2020 2020 2020 2020 2020 205b 5d2c 0a20             [],. 
+0001c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c880: 2020 2020 2020 2050 4b43 5337 5f44 4554         PKCS7_DET
+0001c890: 4143 4845 442c 0a20 2020 2020 2020 2020  ACHED,.         
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001c8b0: 7468 6973 2d3e 7369 676e 5f65 7874 7261  this->sign_extra
+0001c8c0: 6365 7274 735f 6669 6c65 0a20 2020 2020  certs_file.     
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001c8e0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0001c8f0: 2020 7d0a 0a20 2020 2020 2020 2020 2020    }..           
+0001c900: 2020 2020 2040 756e 6c69 6e6b 2824 6669       @unlink($fi
+0001c910: 6c65 293b 0a20 2020 2020 2020 2020 2020  le);.           
+0001c920: 2020 2020 2069 6620 2824 7369 676e 2920       if ($sign) 
+0001c930: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001c940: 2020 2020 2020 2462 6f64 7920 3d20 6669        $body = fi
+0001c950: 6c65 5f67 6574 5f63 6f6e 7465 6e74 7328  le_get_contents(
+0001c960: 2473 6967 6e65 6429 3b0a 2020 2020 2020  $signed);.      
+0001c970: 2020 2020 2020 2020 2020 2020 2020 4075                @u
+0001c980: 6e6c 696e 6b28 2473 6967 6e65 6429 3b0a  nlink($signed);.
+0001c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9a0: 2020 2020 2f2f 5468 6520 6d65 7373 6167      //The messag
+0001c9b0: 6520 7265 7475 726e 6564 2062 7920 6f70  e returned by op
+0001c9c0: 656e 7373 6c20 636f 6e74 6169 6e73 2062  enssl contains b
+0001c9d0: 6f74 6820 6865 6164 6572 7320 616e 6420  oth headers and 
+0001c9e0: 626f 6479 2c20 736f 206e 6565 6420 746f  body, so need to
+0001c9f0: 2073 706c 6974 2074 6865 6d20 7570 0a20   split them up. 
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2024 7061 7274 7320 3d20 6578 706c     $parts = expl
+0001ca20: 6f64 6528 225c 6e5c 6e22 2c20 2462 6f64  ode("\n\n", $bod
+0001ca30: 792c 2032 293b 0a20 2020 2020 2020 2020  y, 2);.         
+0001ca40: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+0001ca50: 2d3e 4d49 4d45 4865 6164 6572 202e 3d20  ->MIMEHeader .= 
+0001ca60: 2470 6172 7473 5b30 5d20 2e20 7374 6174  $parts[0] . stat
+0001ca70: 6963 3a3a 244c 4520 2e20 7374 6174 6963  ic::$LE . static
+0001ca80: 3a3a 244c 453b 0a20 2020 2020 2020 2020  ::$LE;.         
+0001ca90: 2020 2020 2020 2020 2020 2024 626f 6479             $body
+0001caa0: 203d 2024 7061 7274 735b 315d 3b0a 2020   = $parts[1];.  
+0001cab0: 2020 2020 2020 2020 2020 2020 2020 7d20                } 
+0001cac0: 656c 7365 207b 0a20 2020 2020 2020 2020  else {.         
+0001cad0: 2020 2020 2020 2020 2020 2040 756e 6c69             @unli
+0001cae0: 6e6b 2824 7369 676e 6564 293b 0a20 2020  nk($signed);.   
+0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb00: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+0001cb10: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
+0001cb20: 2827 7369 676e 696e 6727 2920 2e20 6f70  ('signing') . op
+0001cb30: 656e 7373 6c5f 6572 726f 725f 7374 7269  enssl_error_stri
+0001cb40: 6e67 2829 293b 0a20 2020 2020 2020 2020  ng());.         
+0001cb50: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001cb60: 2020 2020 207d 2063 6174 6368 2028 4578       } catch (Ex
+0001cb70: 6365 7074 696f 6e20 2465 7863 2920 7b0a  ception $exc) {.
+0001cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb90: 2462 6f64 7920 3d20 2727 3b0a 2020 2020  $body = '';.    
+0001cba0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001cbb0: 2474 6869 732d 3e65 7863 6570 7469 6f6e  $this->exception
+0001cbc0: 7329 207b 0a20 2020 2020 2020 2020 2020  s) {.           
+0001cbd0: 2020 2020 2020 2020 2074 6872 6f77 2024           throw $
+0001cbe0: 6578 633b 0a20 2020 2020 2020 2020 2020  exc;.           
+0001cbf0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0001cc00: 2020 207d 0a20 2020 2020 2020 207d 0a0a     }.        }..
+0001cc10: 2020 2020 2020 2020 7265 7475 726e 2024          return $
+0001cc20: 626f 6479 3b0a 2020 2020 7d0a 0a20 2020  body;.    }..   
+0001cc30: 202f 2a2a 0a20 2020 2020 2a20 4765 7420   /**.     * Get 
+0001cc40: 7468 6520 626f 756e 6461 7269 6573 2074  the boundaries t
+0001cc50: 6861 7420 7468 6973 206d 6573 7361 6765  hat this message
+0001cc60: 2077 696c 6c20 7573 650a 2020 2020 202a   will use.     *
+0001cc70: 2040 7265 7475 726e 2061 7272 6179 0a20   @return array. 
+0001cc80: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+0001cc90: 6320 6675 6e63 7469 6f6e 2067 6574 426f  c function getBo
+0001cca0: 756e 6461 7269 6573 2829 0a20 2020 207b  undaries().    {
+0001ccb0: 0a20 2020 2020 2020 2069 6620 2865 6d70  .        if (emp
+0001ccc0: 7479 2824 7468 6973 2d3e 626f 756e 6461  ty($this->bounda
+0001ccd0: 7279 2929 207b 0a20 2020 2020 2020 2020  ry)) {.         
+0001cce0: 2020 2024 7468 6973 2d3e 7365 7442 6f75     $this->setBou
+0001ccf0: 6e64 6172 6965 7328 293b 0a20 2020 2020  ndaries();.     
+0001cd00: 2020 207d 0a20 2020 2020 2020 2072 6574     }.        ret
+0001cd10: 7572 6e20 2474 6869 732d 3e62 6f75 6e64  urn $this->bound
+0001cd20: 6172 793b 0a20 2020 207d 0a0a 2020 2020  ary;.    }..    
+0001cd30: 2f2a 2a0a 2020 2020 202a 2052 6574 7572  /**.     * Retur
+0001cd40: 6e20 7468 6520 7374 6172 7420 6f66 2061  n the start of a
+0001cd50: 206d 6573 7361 6765 2062 6f75 6e64 6172   message boundar
+0001cd60: 792e 0a20 2020 2020 2a0a 2020 2020 202a  y..     *.     *
+0001cd70: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+0001cd80: 626f 756e 6461 7279 0a20 2020 2020 2a20  boundary.     * 
+0001cd90: 4070 6172 616d 2073 7472 696e 6720 2463  @param string $c
+0001cda0: 6861 7253 6574 0a20 2020 2020 2a20 4070  harSet.     * @p
+0001cdb0: 6172 616d 2073 7472 696e 6720 2463 6f6e  aram string $con
+0001cdc0: 7465 6e74 5479 7065 0a20 2020 2020 2a20  tentType.     * 
+0001cdd0: 4070 6172 616d 2073 7472 696e 6720 2465  @param string $e
+0001cde0: 6e63 6f64 696e 670a 2020 2020 202a 0a20  ncoding.     *. 
+0001cdf0: 2020 2020 2a20 4072 6574 7572 6e20 7374      * @return st
+0001ce00: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
+0001ce10: 2070 726f 7465 6374 6564 2066 756e 6374   protected funct
+0001ce20: 696f 6e20 6765 7442 6f75 6e64 6172 7928  ion getBoundary(
+0001ce30: 2462 6f75 6e64 6172 792c 2024 6368 6172  $boundary, $char
+0001ce40: 5365 742c 2024 636f 6e74 656e 7454 7970  Set, $contentTyp
+0001ce50: 652c 2024 656e 636f 6469 6e67 290a 2020  e, $encoding).  
+0001ce60: 2020 7b0a 2020 2020 2020 2020 2472 6573    {.        $res
+0001ce70: 756c 7420 3d20 2727 3b0a 2020 2020 2020  ult = '';.      
+0001ce80: 2020 6966 2028 2727 203d 3d3d 2024 6368    if ('' === $ch
+0001ce90: 6172 5365 7429 207b 0a20 2020 2020 2020  arSet) {.       
+0001cea0: 2020 2020 2024 6368 6172 5365 7420 3d20       $charSet = 
+0001ceb0: 2474 6869 732d 3e43 6861 7253 6574 3b0a  $this->CharSet;.
+0001cec0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0001ced0: 2020 6966 2028 2727 203d 3d3d 2024 636f    if ('' === $co
+0001cee0: 6e74 656e 7454 7970 6529 207b 0a20 2020  ntentType) {.   
+0001cef0: 2020 2020 2020 2020 2024 636f 6e74 656e           $conten
+0001cf00: 7454 7970 6520 3d20 2474 6869 732d 3e43  tType = $this->C
+0001cf10: 6f6e 7465 6e74 5479 7065 3b0a 2020 2020  ontentType;.    
+0001cf20: 2020 2020 7d0a 2020 2020 2020 2020 6966      }.        if
+0001cf30: 2028 2727 203d 3d3d 2024 656e 636f 6469   ('' === $encodi
+0001cf40: 6e67 2920 7b0a 2020 2020 2020 2020 2020  ng) {.          
+0001cf50: 2020 2465 6e63 6f64 696e 6720 3d20 2474    $encoding = $t
+0001cf60: 6869 732d 3e45 6e63 6f64 696e 673b 0a20  his->Encoding;. 
+0001cf70: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001cf80: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
+0001cf90: 732d 3e74 6578 744c 696e 6528 272d 2d27  s->textLine('--'
+0001cfa0: 202e 2024 626f 756e 6461 7279 293b 0a20   . $boundary);. 
+0001cfb0: 2020 2020 2020 2024 7265 7375 6c74 202e         $result .
+0001cfc0: 3d20 7370 7269 6e74 6628 2743 6f6e 7465  = sprintf('Conte
+0001cfd0: 6e74 2d54 7970 653a 2025 733b 2063 6861  nt-Type: %s; cha
+0001cfe0: 7273 6574 3d25 7327 2c20 2463 6f6e 7465  rset=%s', $conte
+0001cff0: 6e74 5479 7065 2c20 2463 6861 7253 6574  ntType, $charSet
+0001d000: 293b 0a20 2020 2020 2020 2024 7265 7375  );.        $resu
+0001d010: 6c74 202e 3d20 7374 6174 6963 3a3a 244c  lt .= static::$L
+0001d020: 453b 0a20 2020 2020 2020 202f 2f52 4643  E;.        //RFC
+0001d030: 3133 3431 2070 6172 7420 3520 7361 7973  1341 part 5 says
+0001d040: 2037 6269 7420 6973 2061 7373 756d 6564   7bit is assumed
+0001d050: 2069 6620 6e6f 7420 7370 6563 6966 6965   if not specifie
+0001d060: 640a 2020 2020 2020 2020 6966 2028 7374  d.        if (st
+0001d070: 6174 6963 3a3a 454e 434f 4449 4e47 5f37  atic::ENCODING_7
+0001d080: 4249 5420 213d 3d20 2465 6e63 6f64 696e  BIT !== $encodin
+0001d090: 6729 207b 0a20 2020 2020 2020 2020 2020  g) {.           
+0001d0a0: 2024 7265 7375 6c74 202e 3d20 2474 6869   $result .= $thi
+0001d0b0: 732d 3e68 6561 6465 724c 696e 6528 2743  s->headerLine('C
+0001d0c0: 6f6e 7465 6e74 2d54 7261 6e73 6665 722d  ontent-Transfer-
+0001d0d0: 456e 636f 6469 6e67 272c 2024 656e 636f  Encoding', $enco
+0001d0e0: 6469 6e67 293b 0a20 2020 2020 2020 207d  ding);.        }
+0001d0f0: 0a20 2020 2020 2020 2024 7265 7375 6c74  .        $result
+0001d100: 202e 3d20 7374 6174 6963 3a3a 244c 453b   .= static::$LE;
+0001d110: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001d120: 2024 7265 7375 6c74 3b0a 2020 2020 7d0a   $result;.    }.
+0001d130: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+0001d140: 5265 7475 726e 2074 6865 2065 6e64 206f  Return the end o
+0001d150: 6620 6120 6d65 7373 6167 6520 626f 756e  f a message boun
+0001d160: 6461 7279 2e0a 2020 2020 202a 0a20 2020  dary..     *.   
+0001d170: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+0001d180: 6720 2462 6f75 6e64 6172 790a 2020 2020  g $boundary.    
+0001d190: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+0001d1a0: 6e20 7374 7269 6e67 0a20 2020 2020 2a2f  n string.     */
+0001d1b0: 0a20 2020 2070 726f 7465 6374 6564 2066  .    protected f
+0001d1c0: 756e 6374 696f 6e20 656e 6442 6f75 6e64  unction endBound
+0001d1d0: 6172 7928 2462 6f75 6e64 6172 7929 0a20  ary($boundary). 
+0001d1e0: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
+0001d1f0: 7572 6e20 7374 6174 6963 3a3a 244c 4520  urn static::$LE 
+0001d200: 2e20 272d 2d27 202e 2024 626f 756e 6461  . '--' . $bounda
+0001d210: 7279 202e 2027 2d2d 2720 2e20 7374 6174  ry . '--' . stat
+0001d220: 6963 3a3a 244c 453b 0a20 2020 207d 0a0a  ic::$LE;.    }..
+0001d230: 2020 2020 2f2a 2a0a 2020 2020 202a 2053      /**.     * S
+0001d240: 6574 2074 6865 206d 6573 7361 6765 2074  et the message t
+0001d250: 7970 652e 0a20 2020 2020 2a20 5048 504d  ype..     * PHPM
+0001d260: 6169 6c65 7220 6f6e 6c79 2073 7570 706f  ailer only suppo
+0001d270: 7274 7320 736f 6d65 2070 7265 7365 7420  rts some preset 
+0001d280: 6d65 7373 6167 6520 7479 7065 732c 206e  message types, n
+0001d290: 6f74 2061 7262 6974 7261 7279 204d 494d  ot arbitrary MIM
+0001d2a0: 4520 7374 7275 6374 7572 6573 2e0a 2020  E structures..  
+0001d2b0: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
+0001d2c0: 7465 6420 6675 6e63 7469 6f6e 2073 6574  ted function set
+0001d2d0: 4d65 7373 6167 6554 7970 6528 290a 2020  MessageType().  
+0001d2e0: 2020 7b0a 2020 2020 2020 2020 2474 7970    {.        $typ
+0001d2f0: 6520 3d20 5b5d 3b0a 2020 2020 2020 2020  e = [];.        
+0001d300: 6966 2028 2474 6869 732d 3e61 6c74 6572  if ($this->alter
+0001d310: 6e61 7469 7665 4578 6973 7473 2829 2920  nativeExists()) 
+0001d320: 7b0a 2020 2020 2020 2020 2020 2020 2474  {.            $t
+0001d330: 7970 655b 5d20 3d20 2761 6c74 273b 0a20  ype[] = 'alt';. 
+0001d340: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001d350: 2069 6620 2824 7468 6973 2d3e 696e 6c69   if ($this->inli
+0001d360: 6e65 496d 6167 6545 7869 7374 7328 2929  neImageExists())
+0001d370: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+0001d380: 7479 7065 5b5d 203d 2027 696e 6c69 6e65  type[] = 'inline
+0001d390: 273b 0a20 2020 2020 2020 207d 0a20 2020  ';.        }.   
+0001d3a0: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
+0001d3b0: 6174 7461 6368 6d65 6e74 4578 6973 7473  attachmentExists
+0001d3c0: 2829 2920 7b0a 2020 2020 2020 2020 2020  ()) {.          
+0001d3d0: 2020 2474 7970 655b 5d20 3d20 2761 7474    $type[] = 'att
+0001d3e0: 6163 6827 3b0a 2020 2020 2020 2020 7d0a  ach';.        }.
+0001d3f0: 2020 2020 2020 2020 2474 6869 732d 3e6d          $this->m
+0001d400: 6573 7361 6765 5f74 7970 6520 3d20 696d  essage_type = im
+0001d410: 706c 6f64 6528 275f 272c 2024 7479 7065  plode('_', $type
+0001d420: 293b 0a20 2020 2020 2020 2069 6620 2827  );.        if ('
+0001d430: 2720 3d3d 3d20 2474 6869 732d 3e6d 6573  ' === $this->mes
+0001d440: 7361 6765 5f74 7970 6529 207b 0a20 2020  sage_type) {.   
+0001d450: 2020 2020 2020 2020 202f 2f54 6865 2027           //The '
+0001d460: 706c 6169 6e27 206d 6573 7361 6765 5f74  plain' message_t
+0001d470: 7970 6520 7265 6665 7273 2074 6f20 7468  ype refers to th
+0001d480: 6520 6d65 7373 6167 6520 6861 7669 6e67  e message having
+0001d490: 2061 2073 696e 676c 6520 626f 6479 2065   a single body e
+0001d4a0: 6c65 6d65 6e74 2c20 6e6f 7420 7468 6174  lement, not that
+0001d4b0: 2069 7420 6973 2070 6c61 696e 2d74 6578   it is plain-tex
+0001d4c0: 740a 2020 2020 2020 2020 2020 2020 2474  t.            $t
+0001d4d0: 6869 732d 3e6d 6573 7361 6765 5f74 7970  his->message_typ
+0001d4e0: 6520 3d20 2770 6c61 696e 273b 0a20 2020  e = 'plain';.   
+0001d4f0: 2020 2020 207d 0a20 2020 207d 0a0a 2020       }.    }..  
+0001d500: 2020 2f2a 2a0a 2020 2020 202a 2046 6f72    /**.     * For
+0001d510: 6d61 7420 6120 6865 6164 6572 206c 696e  mat a header lin
+0001d520: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
+0001d530: 2040 7061 7261 6d20 7374 7269 6e67 2020   @param string  
+0001d540: 2020 2024 6e61 6d65 0a20 2020 2020 2a20     $name.     * 
+0001d550: 4070 6172 616d 2073 7472 696e 677c 696e  @param string|in
+0001d560: 7420 2476 616c 7565 0a20 2020 2020 2a0a  t $value.     *.
+0001d570: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
+0001d580: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
+0001d590: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+0001d5a0: 6e20 6865 6164 6572 4c69 6e65 2824 6e61  n headerLine($na
+0001d5b0: 6d65 2c20 2476 616c 7565 290a 2020 2020  me, $value).    
+0001d5c0: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
+0001d5d0: 2024 6e61 6d65 202e 2027 3a20 2720 2e20   $name . ': ' . 
+0001d5e0: 2476 616c 7565 202e 2073 7461 7469 633a  $value . static:
+0001d5f0: 3a24 4c45 3b0a 2020 2020 7d0a 0a20 2020  :$LE;.    }..   
+0001d600: 202f 2a2a 0a20 2020 2020 2a20 5265 7475   /**.     * Retu
+0001d610: 726e 2061 2066 6f72 6d61 7474 6564 206d  rn a formatted m
+0001d620: 6169 6c20 6c69 6e65 2e0a 2020 2020 202a  ail line..     *
+0001d630: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+0001d640: 7472 696e 6720 2476 616c 7565 0a20 2020  tring $value.   
+0001d650: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+0001d660: 726e 2073 7472 696e 670a 2020 2020 202a  rn string.     *
+0001d670: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+0001d680: 6374 696f 6e20 7465 7874 4c69 6e65 2824  ction textLine($
+0001d690: 7661 6c75 6529 0a20 2020 207b 0a20 2020  value).    {.   
+0001d6a0: 2020 2020 2072 6574 7572 6e20 2476 616c       return $val
+0001d6b0: 7565 202e 2073 7461 7469 633a 3a24 4c45  ue . static::$LE
+0001d6c0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+0001d6d0: 0a20 2020 2020 2a20 4164 6420 616e 2061  .     * Add an a
+0001d6e0: 7474 6163 686d 656e 7420 6672 6f6d 2061  ttachment from a
+0001d6f0: 2070 6174 6820 6f6e 2074 6865 2066 696c   path on the fil
+0001d700: 6573 7973 7465 6d2e 0a20 2020 2020 2a20  esystem..     * 
+0001d710: 4e65 7665 7220 7573 6520 6120 7573 6572  Never use a user
+0001d720: 2d73 7570 706c 6965 6420 7061 7468 2074  -supplied path t
+0001d730: 6f20 6120 6669 6c65 210a 2020 2020 202a  o a file!.     *
+0001d740: 2052 6574 7572 6e73 2066 616c 7365 2069   Returns false i
+0001d750: 6620 7468 6520 6669 6c65 2063 6f75 6c64  f the file could
+0001d760: 206e 6f74 2062 6520 666f 756e 6420 6f72   not be found or
+0001d770: 2072 6561 642e 0a20 2020 2020 2a20 4578   read..     * Ex
+0001d780: 706c 6963 6974 6c79 202a 646f 6573 206e  plicitly *does n
+0001d790: 6f74 2a20 7375 7070 6f72 7420 7061 7373  ot* support pass
+0001d7a0: 696e 6720 5552 4c73 3b20 5048 504d 6169  ing URLs; PHPMai
+0001d7b0: 6c65 7220 6973 206e 6f74 2061 6e20 4854  ler is not an HT
+0001d7c0: 5450 2063 6c69 656e 742e 0a20 2020 2020  TP client..     
+0001d7d0: 2a20 4966 2079 6f75 206e 6565 6420 746f  * If you need to
+0001d7e0: 2064 6f20 7468 6174 2c20 6665 7463 6820   do that, fetch 
+0001d7f0: 7468 6520 7265 736f 7572 6365 2079 6f75  the resource you
+0001d800: 7273 656c 6620 616e 6420 7061 7373 2069  rself and pass i
+0001d810: 7420 696e 2076 6961 2061 206c 6f63 616c  t in via a local
+0001d820: 2066 696c 6520 6f72 2073 7472 696e 672e   file or string.
 0001d830: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-0001d840: 7265 7475 726e 2061 7272 6179 0a20 2020  return array.   
-0001d850: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-0001d860: 6675 6e63 7469 6f6e 2067 6574 4174 7461  function getAtta
-0001d870: 6368 6d65 6e74 7328 290a 2020 2020 7b0a  chments().    {.
-0001d880: 2020 2020 2020 2020 7265 7475 726e 2024          return $
-0001d890: 7468 6973 2d3e 6174 7461 6368 6d65 6e74  this->attachment
-0001d8a0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-0001d8b0: 0a20 2020 2020 2a20 4174 7461 6368 2061  .     * Attach a
-0001d8c0: 6c6c 2066 696c 652c 2073 7472 696e 672c  ll file, string,
-0001d8d0: 2061 6e64 2062 696e 6172 7920 6174 7461   and binary atta
-0001d8e0: 6368 6d65 6e74 7320 746f 2074 6865 206d  chments to the m
-0001d8f0: 6573 7361 6765 2e0a 2020 2020 202a 2052  essage..     * R
-0001d900: 6574 7572 6e73 2061 6e20 656d 7074 7920  eturns an empty 
-0001d910: 7374 7269 6e67 206f 6e20 6661 696c 7572  string on failur
-0001d920: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-0001d930: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-0001d940: 6469 7370 6f73 6974 696f 6e5f 7479 7065  disposition_type
-0001d950: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-0001d960: 7472 696e 6720 2462 6f75 6e64 6172 790a  tring $boundary.
-0001d970: 2020 2020 202a 0a20 2020 2020 2a20 4074       *.     * @t
-0001d980: 6872 6f77 7320 4578 6365 7074 696f 6e0a  hrows Exception.
-0001d990: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-0001d9a0: 6574 7572 6e20 7374 7269 6e67 0a20 2020  eturn string.   
-0001d9b0: 2020 2a2f 0a20 2020 2070 726f 7465 6374    */.    protect
-0001d9c0: 6564 2066 756e 6374 696f 6e20 6174 7461  ed function atta
-0001d9d0: 6368 416c 6c28 2464 6973 706f 7369 7469  chAll($dispositi
-0001d9e0: 6f6e 5f74 7970 652c 2024 626f 756e 6461  on_type, $bounda
-0001d9f0: 7279 290a 2020 2020 7b0a 2020 2020 2020  ry).    {.      
-0001da00: 2020 2f2f 5265 7475 726e 2074 6578 7420    //Return text 
-0001da10: 6f66 2062 6f64 790a 2020 2020 2020 2020  of body.        
-0001da20: 246d 696d 6520 3d20 5b5d 3b0a 2020 2020  $mime = [];.    
-0001da30: 2020 2020 2463 6964 556e 6971 203d 205b      $cidUniq = [
-0001da40: 5d3b 0a20 2020 2020 2020 2024 696e 636c  ];.        $incl
-0001da50: 203d 205b 5d3b 0a0a 2020 2020 2020 2020   = [];..        
-0001da60: 2f2f 4164 6420 616c 6c20 6174 7461 6368  //Add all attach
-0001da70: 6d65 6e74 730a 2020 2020 2020 2020 666f  ments.        fo
-0001da80: 7265 6163 6820 2824 7468 6973 2d3e 6174  reach ($this->at
-0001da90: 7461 6368 6d65 6e74 2061 7320 2461 7474  tachment as $att
-0001daa0: 6163 686d 656e 7429 207b 0a20 2020 2020  achment) {.     
-0001dab0: 2020 2020 2020 202f 2f43 6865 636b 2069         //Check i
-0001dac0: 6620 6974 2069 7320 6120 7661 6c69 6420  f it is a valid 
-0001dad0: 6469 7370 6f73 6974 696f 6e5f 6669 6c74  disposition_filt
-0001dae0: 6572 0a20 2020 2020 2020 2020 2020 2069  er.            i
-0001daf0: 6620 2824 6174 7461 6368 6d65 6e74 5b36  f ($attachment[6
-0001db00: 5d20 3d3d 3d20 2464 6973 706f 7369 7469  ] === $dispositi
-0001db10: 6f6e 5f74 7970 6529 207b 0a20 2020 2020  on_type) {.     
-0001db20: 2020 2020 2020 2020 2020 202f 2f43 6865             //Che
-0001db30: 636b 2066 6f72 2073 7472 696e 6720 6174  ck for string at
-0001db40: 7461 6368 6d65 6e74 0a20 2020 2020 2020  tachment.       
-0001db50: 2020 2020 2020 2020 2024 7374 7269 6e67           $string
-0001db60: 203d 2027 273b 0a20 2020 2020 2020 2020   = '';.         
-0001db70: 2020 2020 2020 2024 7061 7468 203d 2027         $path = '
-0001db80: 273b 0a20 2020 2020 2020 2020 2020 2020  ';.             
-0001db90: 2020 2024 6253 7472 696e 6720 3d20 2461     $bString = $a
-0001dba0: 7474 6163 686d 656e 745b 355d 3b0a 2020  ttachment[5];.  
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001dbc0: 2028 2462 5374 7269 6e67 2920 7b0a 2020   ($bString) {.  
-0001dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbe0: 2020 2473 7472 696e 6720 3d20 2461 7474    $string = $att
-0001dbf0: 6163 686d 656e 745b 305d 3b0a 2020 2020  achment[0];.    
-0001dc00: 2020 2020 2020 2020 2020 2020 7d20 656c              } el
-0001dc10: 7365 207b 0a20 2020 2020 2020 2020 2020  se {.           
-0001dc20: 2020 2020 2020 2020 2024 7061 7468 203d           $path =
-0001dc30: 2024 6174 7461 6368 6d65 6e74 5b30 5d3b   $attachment[0];
-0001dc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dc50: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-0001dc60: 2020 2020 2469 6e63 6c68 6173 6820 3d20      $inclhash = 
-0001dc70: 6861 7368 2827 7368 6132 3536 272c 2073  hash('sha256', s
-0001dc80: 6572 6961 6c69 7a65 2824 6174 7461 6368  erialize($attach
-0001dc90: 6d65 6e74 2929 3b0a 2020 2020 2020 2020  ment));.        
-0001dca0: 2020 2020 2020 2020 6966 2028 696e 5f61          if (in_a
-0001dcb0: 7272 6179 2824 696e 636c 6861 7368 2c20  rray($inclhash, 
-0001dcc0: 2469 6e63 6c2c 2074 7275 6529 2920 7b0a  $incl, true)) {.
-0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dce0: 2020 2020 636f 6e74 696e 7565 3b0a 2020      continue;.  
-0001dcf0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-0001dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd10: 2469 6e63 6c5b 5d20 3d20 2469 6e63 6c68  $incl[] = $inclh
-0001dd20: 6173 683b 0a20 2020 2020 2020 2020 2020  ash;.           
-0001dd30: 2020 2020 2024 6e61 6d65 203d 2024 6174       $name = $at
-0001dd40: 7461 6368 6d65 6e74 5b32 5d3b 0a20 2020  tachment[2];.   
-0001dd50: 2020 2020 2020 2020 2020 2020 2024 656e               $en
-0001dd60: 636f 6469 6e67 203d 2024 6174 7461 6368  coding = $attach
-0001dd70: 6d65 6e74 5b33 5d3b 0a20 2020 2020 2020  ment[3];.       
-0001dd80: 2020 2020 2020 2020 2024 7479 7065 203d           $type =
-0001dd90: 2024 6174 7461 6368 6d65 6e74 5b34 5d3b   $attachment[4];
-0001dda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ddb0: 2024 6469 7370 6f73 6974 696f 6e20 3d20   $disposition = 
-0001ddc0: 2461 7474 6163 686d 656e 745b 365d 3b0a  $attachment[6];.
-0001ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dde0: 2463 6964 203d 2024 6174 7461 6368 6d65  $cid = $attachme
-0001ddf0: 6e74 5b37 5d3b 0a20 2020 2020 2020 2020  nt[7];.         
-0001de00: 2020 2020 2020 2069 6620 2827 696e 6c69         if ('inli
-0001de10: 6e65 2720 3d3d 3d20 2464 6973 706f 7369  ne' === $disposi
-0001de20: 7469 6f6e 2026 2620 6172 7261 795f 6b65  tion && array_ke
-0001de30: 795f 6578 6973 7473 2824 6369 642c 2024  y_exists($cid, $
-0001de40: 6369 6455 6e69 7129 2920 7b0a 2020 2020  cidUniq)) {.    
-0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de60: 636f 6e74 696e 7565 3b0a 2020 2020 2020  continue;.      
-0001de70: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0001de80: 2020 2020 2020 2020 2020 2020 2463 6964              $cid
-0001de90: 556e 6971 5b24 6369 645d 203d 2074 7275  Uniq[$cid] = tru
-0001dea0: 653b 0a0a 2020 2020 2020 2020 2020 2020  e;..            
-0001deb0: 2020 2020 246d 696d 655b 5d20 3d20 7370      $mime[] = sp
-0001dec0: 7269 6e74 6628 272d 2d25 7325 7327 2c20  rintf('--%s%s', 
-0001ded0: 2462 6f75 6e64 6172 792c 2073 7461 7469  $boundary, stati
-0001dee0: 633a 3a24 4c45 293b 0a20 2020 2020 2020  c::$LE);.       
-0001def0: 2020 2020 2020 2020 202f 2f4f 6e6c 7920           //Only 
-0001df00: 696e 636c 7564 6520 6120 6669 6c65 6e61  include a filena
-0001df10: 6d65 2070 726f 7065 7274 7920 6966 2077  me property if w
-0001df20: 6520 6861 7665 206f 6e65 0a20 2020 2020  e have one.     
-0001df30: 2020 2020 2020 2020 2020 2069 6620 2821             if (!
-0001df40: 656d 7074 7928 246e 616d 6529 2920 7b0a  empty($name)) {.
-0001df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df60: 2020 2020 246d 696d 655b 5d20 3d20 7370      $mime[] = sp
-0001df70: 7269 6e74 6628 0a20 2020 2020 2020 2020  rintf(.         
-0001df80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001df90: 436f 6e74 656e 742d 5479 7065 3a20 2573  Content-Type: %s
-0001dfa0: 3b20 6e61 6d65 3d25 7325 7327 2c0a 2020  ; name=%s%s',.  
-0001dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfc0: 2020 2020 2020 2474 7970 652c 0a20 2020        $type,.   
-0001dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfe0: 2020 2020 2073 7461 7469 633a 3a71 756f       static::quo
-0001dff0: 7465 6453 7472 696e 6728 2474 6869 732d  tedString($this-
-0001e000: 3e65 6e63 6f64 6548 6561 6465 7228 2474  >encodeHeader($t
-0001e010: 6869 732d 3e73 6563 7572 6548 6561 6465  his->secureHeade
-0001e020: 7228 246e 616d 6529 2929 2c0a 2020 2020  r($name))),.    
-0001e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e040: 2020 2020 7374 6174 6963 3a3a 244c 450a      static::$LE.
-0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e060: 2020 2020 293b 0a20 2020 2020 2020 2020      );.         
-0001e070: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
-0001e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e090: 2020 2020 246d 696d 655b 5d20 3d20 7370      $mime[] = sp
-0001e0a0: 7269 6e74 6628 0a20 2020 2020 2020 2020  rintf(.         
-0001e0b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001e0c0: 436f 6e74 656e 742d 5479 7065 3a20 2573  Content-Type: %s
-0001e0d0: 2573 272c 0a20 2020 2020 2020 2020 2020  %s',.           
-0001e0e0: 2020 2020 2020 2020 2020 2020 2024 7479               $ty
-0001e0f0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-0001e100: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-0001e110: 6963 3a3a 244c 450a 2020 2020 2020 2020  ic::$LE.        
-0001e120: 2020 2020 2020 2020 2020 2020 293b 0a20              );. 
-0001e130: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0001e140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e150: 202f 2f52 4643 3133 3431 2070 6172 7420   //RFC1341 part 
-0001e160: 3520 7361 7973 2037 6269 7420 6973 2061  5 says 7bit is a
-0001e170: 7373 756d 6564 2069 6620 6e6f 7420 7370  ssumed if not sp
-0001e180: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
-0001e190: 2020 2020 2020 2020 6966 2028 7374 6174          if (stat
-0001e1a0: 6963 3a3a 454e 434f 4449 4e47 5f37 4249  ic::ENCODING_7BI
-0001e1b0: 5420 213d 3d20 2465 6e63 6f64 696e 6729  T !== $encoding)
-0001e1c0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0001e1d0: 2020 2020 2020 2024 6d69 6d65 5b5d 203d         $mime[] =
-0001e1e0: 2073 7072 696e 7466 2827 436f 6e74 656e   sprintf('Conten
-0001e1f0: 742d 5472 616e 7366 6572 2d45 6e63 6f64  t-Transfer-Encod
-0001e200: 696e 673a 2025 7325 7327 2c20 2465 6e63  ing: %s%s', $enc
-0001e210: 6f64 696e 672c 2073 7461 7469 633a 3a24  oding, static::$
-0001e220: 4c45 293b 0a20 2020 2020 2020 2020 2020  LE);.           
-0001e230: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-0001e240: 2020 2020 2020 2020 2f2f 4f6e 6c79 2073          //Only s
-0001e250: 6574 2043 6f6e 7465 6e74 2d49 4473 206f  et Content-IDs o
-0001e260: 6e20 696e 6c69 6e65 2061 7474 6163 686d  n inline attachm
-0001e270: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
-0001e280: 2020 2020 2069 6620 2828 7374 7269 6e67       if ((string
-0001e290: 2920 2463 6964 2021 3d3d 2027 2720 2626  ) $cid !== '' &&
-0001e2a0: 2024 6469 7370 6f73 6974 696f 6e20 3d3d   $disposition ==
-0001e2b0: 3d20 2769 6e6c 696e 6527 2920 7b0a 2020  = 'inline') {.  
-0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2d0: 2020 246d 696d 655b 5d20 3d20 2743 6f6e    $mime[] = 'Con
-0001e2e0: 7465 6e74 2d49 443a 203c 2720 2e20 2474  tent-ID: <' . $t
-0001e2f0: 6869 732d 3e65 6e63 6f64 6548 6561 6465  his->encodeHeade
-0001e300: 7228 2474 6869 732d 3e73 6563 7572 6548  r($this->secureH
-0001e310: 6561 6465 7228 2463 6964 2929 202e 2027  eader($cid)) . '
-0001e320: 3e27 202e 2073 7461 7469 633a 3a24 4c45  >' . static::$LE
-0001e330: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001e340: 2020 7d0a 0a20 2020 2020 2020 2020 2020    }..           
-0001e350: 2020 2020 202f 2f41 6c6c 6f77 2066 6f72       //Allow for
-0001e360: 2062 7970 6173 7369 6e67 2074 6865 2043   bypassing the C
-0001e370: 6f6e 7465 6e74 2d44 6973 706f 7369 7469  ontent-Dispositi
-0001e380: 6f6e 2068 6561 6465 720a 2020 2020 2020  on header.      
-0001e390: 2020 2020 2020 2020 2020 6966 2028 2165            if (!e
-0001e3a0: 6d70 7479 2824 6469 7370 6f73 6974 696f  mpty($dispositio
-0001e3b0: 6e29 2920 7b0a 2020 2020 2020 2020 2020  n)) {.          
-0001e3c0: 2020 2020 2020 2020 2020 2465 6e63 6f64            $encod
-0001e3d0: 6564 5f6e 616d 6520 3d20 2474 6869 732d  ed_name = $this-
-0001e3e0: 3e65 6e63 6f64 6548 6561 6465 7228 2474  >encodeHeader($t
-0001e3f0: 6869 732d 3e73 6563 7572 6548 6561 6465  his->secureHeade
-0001e400: 7228 246e 616d 6529 293b 0a20 2020 2020  r($name));.     
-0001e410: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001e420: 6620 2821 656d 7074 7928 2465 6e63 6f64  f (!empty($encod
-0001e430: 6564 5f6e 616d 6529 2920 7b0a 2020 2020  ed_name)) {.    
-0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e450: 2020 2020 246d 696d 655b 5d20 3d20 7370      $mime[] = sp
-0001e460: 7269 6e74 6628 0a20 2020 2020 2020 2020  rintf(.         
-0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e480: 2020 2027 436f 6e74 656e 742d 4469 7370     'Content-Disp
-0001e490: 6f73 6974 696f 6e3a 2025 733b 2066 696c  osition: %s; fil
-0001e4a0: 656e 616d 653d 2573 2573 272c 0a20 2020  ename=%s%s',.   
-0001e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4c0: 2020 2020 2020 2020 2024 6469 7370 6f73           $dispos
-0001e4d0: 6974 696f 6e2c 0a20 2020 2020 2020 2020  ition,.         
-0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4f0: 2020 2073 7461 7469 633a 3a71 756f 7465     static::quote
-0001e500: 6453 7472 696e 6728 2465 6e63 6f64 6564  dString($encoded
-0001e510: 5f6e 616d 6529 2c0a 2020 2020 2020 2020  _name),.        
-0001e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e530: 2020 2020 7374 6174 6963 3a3a 244c 4520      static::$LE 
-0001e540: 2e20 7374 6174 6963 3a3a 244c 450a 2020  . static::$LE.  
-0001e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e560: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
-0001e570: 2020 2020 2020 2020 2020 2020 207d 2065               } e
-0001e580: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-0001e590: 2020 2020 2020 2020 2020 2020 2020 246d                $m
-0001e5a0: 696d 655b 5d20 3d20 7370 7269 6e74 6628  ime[] = sprintf(
-0001e5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e5c0: 2020 2020 2020 2020 2020 2020 2027 436f               'Co
-0001e5d0: 6e74 656e 742d 4469 7370 6f73 6974 696f  ntent-Dispositio
-0001e5e0: 6e3a 2025 7325 7327 2c0a 2020 2020 2020  n: %s%s',.      
+0001d840: 7061 7261 6d20 7374 7269 6e67 2024 7061  param string $pa
+0001d850: 7468 2020 2020 2020 2020 5061 7468 2074  th        Path t
+0001d860: 6f20 7468 6520 6174 7461 6368 6d65 6e74  o the attachment
+0001d870: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+0001d880: 7472 696e 6720 246e 616d 6520 2020 2020  tring $name     
+0001d890: 2020 204f 7665 7272 6964 6573 2074 6865     Overrides the
+0001d8a0: 2061 7474 6163 686d 656e 7420 6e61 6d65   attachment name
+0001d8b0: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+0001d8c0: 7472 696e 6720 2465 6e63 6f64 696e 6720  tring $encoding 
+0001d8d0: 2020 2046 696c 6520 656e 636f 6469 6e67     File encoding
+0001d8e0: 2028 7365 6520 2445 6e63 6f64 696e 6729   (see $Encoding)
+0001d8f0: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+0001d900: 7472 696e 6720 2474 7970 6520 2020 2020  tring $type     
+0001d910: 2020 204d 494d 4520 7479 7065 2c20 652e     MIME type, e.
+0001d920: 672e 2060 696d 6167 652f 6a70 6567 603b  g. `image/jpeg`;
+0001d930: 2064 6574 6572 6d69 6e65 6420 6175 746f   determined auto
+0001d940: 6d61 7469 6361 6c6c 7920 6672 6f6d 2024  matically from $
+0001d950: 7061 7468 2069 6620 6e6f 7420 7370 6563  path if not spec
+0001d960: 6966 6965 640a 2020 2020 202a 2040 7061  ified.     * @pa
+0001d970: 7261 6d20 7374 7269 6e67 2024 6469 7370  ram string $disp
+0001d980: 6f73 6974 696f 6e20 4469 7370 6f73 6974  osition Disposit
+0001d990: 696f 6e20 746f 2075 7365 0a20 2020 2020  ion to use.     
+0001d9a0: 2a0a 2020 2020 202a 2040 7468 726f 7773  *.     * @throws
+0001d9b0: 2045 7863 6570 7469 6f6e 0a20 2020 2020   Exception.     
+0001d9c0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+0001d9d0: 2062 6f6f 6c0a 2020 2020 202a 2f0a 2020   bool.     */.  
+0001d9e0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+0001d9f0: 6e20 6164 6441 7474 6163 686d 656e 7428  n addAttachment(
+0001da00: 0a20 2020 2020 2020 2024 7061 7468 2c0a  .        $path,.
+0001da10: 2020 2020 2020 2020 246e 616d 6520 3d20          $name = 
+0001da20: 2727 2c0a 2020 2020 2020 2020 2465 6e63  '',.        $enc
+0001da30: 6f64 696e 6720 3d20 7365 6c66 3a3a 454e  oding = self::EN
+0001da40: 434f 4449 4e47 5f42 4153 4536 342c 0a20  CODING_BASE64,. 
+0001da50: 2020 2020 2020 2024 7479 7065 203d 2027         $type = '
+0001da60: 272c 0a20 2020 2020 2020 2024 6469 7370  ',.        $disp
+0001da70: 6f73 6974 696f 6e20 3d20 2761 7474 6163  osition = 'attac
+0001da80: 686d 656e 7427 0a20 2020 2029 207b 0a20  hment'.    ) {. 
+0001da90: 2020 2020 2020 2074 7279 207b 0a20 2020         try {.   
+0001daa0: 2020 2020 2020 2020 2069 6620 2821 7374           if (!st
+0001dab0: 6174 6963 3a3a 6669 6c65 4973 4163 6365  atic::fileIsAcce
+0001dac0: 7373 6962 6c65 2824 7061 7468 2929 207b  ssible($path)) {
+0001dad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dae0: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+0001daf0: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
+0001db00: 2827 6669 6c65 5f61 6363 6573 7327 2920  ('file_access') 
+0001db10: 2e20 2470 6174 682c 2073 656c 663a 3a53  . $path, self::S
+0001db20: 544f 505f 434f 4e54 494e 5545 293b 0a20  TOP_CONTINUE);. 
+0001db30: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
+0001db40: 2020 2020 2020 2020 2020 2f2f 4966 2061            //If a
+0001db50: 204d 494d 4520 7479 7065 2069 7320 6e6f   MIME type is no
+0001db60: 7420 7370 6563 6966 6965 642c 2074 7279  t specified, try
+0001db70: 2074 6f20 776f 726b 2069 7420 6f75 7420   to work it out 
+0001db80: 6672 6f6d 2074 6865 2066 696c 6520 6e61  from the file na
+0001db90: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
+0001dba0: 6620 2827 2720 3d3d 3d20 2474 7970 6529  f ('' === $type)
+0001dbb0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0001dbc0: 2020 2024 7479 7065 203d 2073 7461 7469     $type = stati
+0001dbd0: 633a 3a66 696c 656e 616d 6554 6f54 7970  c::filenameToTyp
+0001dbe0: 6528 2470 6174 6829 3b0a 2020 2020 2020  e($path);.      
+0001dbf0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0001dc00: 2020 2020 2024 6669 6c65 6e61 6d65 203d       $filename =
+0001dc10: 2028 7374 7269 6e67 2920 7374 6174 6963   (string) static
+0001dc20: 3a3a 6d62 5f70 6174 6869 6e66 6f28 2470  ::mb_pathinfo($p
+0001dc30: 6174 682c 2050 4154 4849 4e46 4f5f 4241  ath, PATHINFO_BA
+0001dc40: 5345 4e41 4d45 293b 0a20 2020 2020 2020  SENAME);.       
+0001dc50: 2020 2020 2069 6620 2827 2720 3d3d 3d20       if ('' === 
+0001dc60: 246e 616d 6529 207b 0a20 2020 2020 2020  $name) {.       
+0001dc70: 2020 2020 2020 2020 2024 6e61 6d65 203d           $name =
+0001dc80: 2024 6669 6c65 6e61 6d65 3b0a 2020 2020   $filename;.    
+0001dc90: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0001dca0: 2020 2020 2020 6966 2028 2124 7468 6973        if (!$this
+0001dcb0: 2d3e 7661 6c69 6461 7465 456e 636f 6469  ->validateEncodi
+0001dcc0: 6e67 2824 656e 636f 6469 6e67 2929 207b  ng($encoding)) {
+0001dcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dce0: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+0001dcf0: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
+0001dd00: 2827 656e 636f 6469 6e67 2729 202e 2024  ('encoding') . $
+0001dd10: 656e 636f 6469 6e67 293b 0a20 2020 2020  encoding);.     
+0001dd20: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0001dd30: 2020 2020 2020 2474 6869 732d 3e61 7474        $this->att
+0001dd40: 6163 686d 656e 745b 5d20 3d20 5b0a 2020  achment[] = [.  
+0001dd50: 2020 2020 2020 2020 2020 2020 2020 3020                0 
+0001dd60: 3d3e 2024 7061 7468 2c0a 2020 2020 2020  => $path,.      
+0001dd70: 2020 2020 2020 2020 2020 3120 3d3e 2024            1 => $
+0001dd80: 6669 6c65 6e61 6d65 2c0a 2020 2020 2020  filename,.      
+0001dd90: 2020 2020 2020 2020 2020 3220 3d3e 2024            2 => $
+0001dda0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+0001ddb0: 2020 2020 2020 3320 3d3e 2024 656e 636f        3 => $enco
+0001ddc0: 6469 6e67 2c0a 2020 2020 2020 2020 2020  ding,.          
+0001ddd0: 2020 2020 2020 3420 3d3e 2024 7479 7065        4 => $type
+0001dde0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001ddf0: 2020 3520 3d3e 2066 616c 7365 2c20 2f2f    5 => false, //
+0001de00: 6973 5374 7269 6e67 4174 7461 6368 6d65  isStringAttachme
+0001de10: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
+0001de20: 2020 2036 203d 3e20 2464 6973 706f 7369     6 => $disposi
+0001de30: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+0001de40: 2020 2020 2020 3720 3d3e 2024 6e61 6d65        7 => $name
+0001de50: 2c0a 2020 2020 2020 2020 2020 2020 5d3b  ,.            ];
+0001de60: 0a20 2020 2020 2020 207d 2063 6174 6368  .        } catch
+0001de70: 2028 4578 6365 7074 696f 6e20 2465 7863   (Exception $exc
+0001de80: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001de90: 2474 6869 732d 3e73 6574 4572 726f 7228  $this->setError(
+0001dea0: 2465 7863 2d3e 6765 744d 6573 7361 6765  $exc->getMessage
+0001deb0: 2829 293b 0a20 2020 2020 2020 2020 2020  ());.           
+0001dec0: 2024 7468 6973 2d3e 6564 6562 7567 2824   $this->edebug($
+0001ded0: 6578 632d 3e67 6574 4d65 7373 6167 6528  exc->getMessage(
+0001dee0: 2929 3b0a 2020 2020 2020 2020 2020 2020  ));.            
+0001def0: 6966 2028 2474 6869 732d 3e65 7863 6570  if ($this->excep
+0001df00: 7469 6f6e 7329 207b 0a20 2020 2020 2020  tions) {.       
+0001df10: 2020 2020 2020 2020 2074 6872 6f77 2024           throw $
+0001df20: 6578 633b 0a20 2020 2020 2020 2020 2020  exc;.           
+0001df30: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
+0001df40: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
+0001df50: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0001df60: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
+0001df70: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+0001df80: 2020 2a20 5265 7475 726e 2074 6865 2061    * Return the a
+0001df90: 7272 6179 206f 6620 6174 7461 6368 6d65  rray of attachme
+0001dfa0: 6e74 732e 0a20 2020 2020 2a0a 2020 2020  nts..     *.    
+0001dfb0: 202a 2040 7265 7475 726e 2061 7272 6179   * @return array
+0001dfc0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+0001dfd0: 6c69 6320 6675 6e63 7469 6f6e 2067 6574  lic function get
+0001dfe0: 4174 7461 6368 6d65 6e74 7328 290a 2020  Attachments().  
+0001dff0: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
+0001e000: 726e 2024 7468 6973 2d3e 6174 7461 6368  rn $this->attach
+0001e010: 6d65 6e74 3b0a 2020 2020 7d0a 0a20 2020  ment;.    }..   
+0001e020: 202f 2a2a 0a20 2020 2020 2a20 4174 7461   /**.     * Atta
+0001e030: 6368 2061 6c6c 2066 696c 652c 2073 7472  ch all file, str
+0001e040: 696e 672c 2061 6e64 2062 696e 6172 7920  ing, and binary 
+0001e050: 6174 7461 6368 6d65 6e74 7320 746f 2074  attachments to t
+0001e060: 6865 206d 6573 7361 6765 2e0a 2020 2020  he message..    
+0001e070: 202a 2052 6574 7572 6e73 2061 6e20 656d   * Returns an em
+0001e080: 7074 7920 7374 7269 6e67 206f 6e20 6661  pty string on fa
+0001e090: 696c 7572 652e 0a20 2020 2020 2a0a 2020  ilure..     *.  
+0001e0a0: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+0001e0b0: 6e67 2024 6469 7370 6f73 6974 696f 6e5f  ng $disposition_
+0001e0c0: 7479 7065 0a20 2020 2020 2a20 4070 6172  type.     * @par
+0001e0d0: 616d 2073 7472 696e 6720 2462 6f75 6e64  am string $bound
+0001e0e0: 6172 790a 2020 2020 202a 0a20 2020 2020  ary.     *.     
+0001e0f0: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
+0001e100: 696f 6e0a 2020 2020 202a 0a20 2020 2020  ion.     *.     
+0001e110: 2a20 4072 6574 7572 6e20 7374 7269 6e67  * @return string
+0001e120: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+0001e130: 7465 6374 6564 2066 756e 6374 696f 6e20  tected function 
+0001e140: 6174 7461 6368 416c 6c28 2464 6973 706f  attachAll($dispo
+0001e150: 7369 7469 6f6e 5f74 7970 652c 2024 626f  sition_type, $bo
+0001e160: 756e 6461 7279 290a 2020 2020 7b0a 2020  undary).    {.  
+0001e170: 2020 2020 2020 2f2f 5265 7475 726e 2074        //Return t
+0001e180: 6578 7420 6f66 2062 6f64 790a 2020 2020  ext of body.    
+0001e190: 2020 2020 246d 696d 6520 3d20 5b5d 3b0a      $mime = [];.
+0001e1a0: 2020 2020 2020 2020 2463 6964 556e 6971          $cidUniq
+0001e1b0: 203d 205b 5d3b 0a20 2020 2020 2020 2024   = [];.        $
+0001e1c0: 696e 636c 203d 205b 5d3b 0a0a 2020 2020  incl = [];..    
+0001e1d0: 2020 2020 2f2f 4164 6420 616c 6c20 6174      //Add all at
+0001e1e0: 7461 6368 6d65 6e74 730a 2020 2020 2020  tachments.      
+0001e1f0: 2020 666f 7265 6163 6820 2824 7468 6973    foreach ($this
+0001e200: 2d3e 6174 7461 6368 6d65 6e74 2061 7320  ->attachment as 
+0001e210: 2461 7474 6163 686d 656e 7429 207b 0a20  $attachment) {. 
+0001e220: 2020 2020 2020 2020 2020 202f 2f43 6865             //Che
+0001e230: 636b 2069 6620 6974 2069 7320 6120 7661  ck if it is a va
+0001e240: 6c69 6420 6469 7370 6f73 6974 696f 6e5f  lid disposition_
+0001e250: 6669 6c74 6572 0a20 2020 2020 2020 2020  filter.         
+0001e260: 2020 2069 6620 2824 6174 7461 6368 6d65     if ($attachme
+0001e270: 6e74 5b36 5d20 3d3d 3d20 2464 6973 706f  nt[6] === $dispo
+0001e280: 7369 7469 6f6e 5f74 7970 6529 207b 0a20  sition_type) {. 
+0001e290: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+0001e2a0: 2f43 6865 636b 2066 6f72 2073 7472 696e  /Check for strin
+0001e2b0: 6720 6174 7461 6368 6d65 6e74 0a20 2020  g attachment.   
+0001e2c0: 2020 2020 2020 2020 2020 2020 2024 7374               $st
+0001e2d0: 7269 6e67 203d 2027 273b 0a20 2020 2020  ring = '';.     
+0001e2e0: 2020 2020 2020 2020 2020 2024 7061 7468             $path
+0001e2f0: 203d 2027 273b 0a20 2020 2020 2020 2020   = '';.         
+0001e300: 2020 2020 2020 2024 6253 7472 696e 6720         $bString 
+0001e310: 3d20 2461 7474 6163 686d 656e 745b 355d  = $attachment[5]
+0001e320: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0001e330: 2020 6966 2028 2462 5374 7269 6e67 2920    if ($bString) 
+0001e340: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001e350: 2020 2020 2020 2473 7472 696e 6720 3d20        $string = 
+0001e360: 2461 7474 6163 686d 656e 745b 305d 3b0a  $attachment[0];.
+0001e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e380: 7d20 656c 7365 207b 0a20 2020 2020 2020  } else {.       
+0001e390: 2020 2020 2020 2020 2020 2020 2024 7061               $pa
+0001e3a0: 7468 203d 2024 6174 7461 6368 6d65 6e74  th = $attachment
+0001e3b0: 5b30 5d3b 0a20 2020 2020 2020 2020 2020  [0];.           
+0001e3c0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+0001e3d0: 2020 2020 2020 2020 2469 6e63 6c68 6173          $inclhas
+0001e3e0: 6820 3d20 6861 7368 2827 7368 6132 3536  h = hash('sha256
+0001e3f0: 272c 2073 6572 6961 6c69 7a65 2824 6174  ', serialize($at
+0001e400: 7461 6368 6d65 6e74 2929 3b0a 2020 2020  tachment));.    
+0001e410: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001e420: 696e 5f61 7272 6179 2824 696e 636c 6861  in_array($inclha
+0001e430: 7368 2c20 2469 6e63 6c2c 2074 7275 6529  sh, $incl, true)
+0001e440: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001e450: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0001e460: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0001e470: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+0001e480: 2020 2020 2469 6e63 6c5b 5d20 3d20 2469      $incl[] = $i
+0001e490: 6e63 6c68 6173 683b 0a20 2020 2020 2020  nclhash;.       
+0001e4a0: 2020 2020 2020 2020 2024 6e61 6d65 203d           $name =
+0001e4b0: 2024 6174 7461 6368 6d65 6e74 5b32 5d3b   $attachment[2];
+0001e4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e4d0: 2024 656e 636f 6469 6e67 203d 2024 6174   $encoding = $at
+0001e4e0: 7461 6368 6d65 6e74 5b33 5d3b 0a20 2020  tachment[3];.   
+0001e4f0: 2020 2020 2020 2020 2020 2020 2024 7479               $ty
+0001e500: 7065 203d 2024 6174 7461 6368 6d65 6e74  pe = $attachment
+0001e510: 5b34 5d3b 0a20 2020 2020 2020 2020 2020  [4];.           
+0001e520: 2020 2020 2024 6469 7370 6f73 6974 696f       $dispositio
+0001e530: 6e20 3d20 2461 7474 6163 686d 656e 745b  n = $attachment[
+0001e540: 365d 3b0a 2020 2020 2020 2020 2020 2020  6];.            
+0001e550: 2020 2020 2463 6964 203d 2024 6174 7461      $cid = $atta
+0001e560: 6368 6d65 6e74 5b37 5d3b 0a20 2020 2020  chment[7];.     
+0001e570: 2020 2020 2020 2020 2020 2069 6620 2827             if ('
+0001e580: 696e 6c69 6e65 2720 3d3d 3d20 2464 6973  inline' === $dis
+0001e590: 706f 7369 7469 6f6e 2026 2620 6172 7261  position && arra
+0001e5a0: 795f 6b65 795f 6578 6973 7473 2824 6369  y_key_exists($ci
+0001e5b0: 642c 2024 6369 6455 6e69 7129 2920 7b0a  d, $cidUniq)) {.
+0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5d0: 2020 2020 636f 6e74 696e 7565 3b0a 2020      continue;.  
+0001e5e0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
 0001e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e600: 2020 2020 2020 2464 6973 706f 7369 7469        $dispositi
-0001e610: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0001e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e630: 7374 6174 6963 3a3a 244c 4520 2e20 7374  static::$LE . st
-0001e640: 6174 6963 3a3a 244c 450a 2020 2020 2020  atic::$LE.      
-0001e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e660: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
-0001e670: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-0001e680: 2020 2020 2020 2020 2020 207d 2065 6c73             } els
-0001e690: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
-0001e6a0: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
-0001e6b0: 3d20 7374 6174 6963 3a3a 244c 453b 0a20  = static::$LE;. 
-0001e6c0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0001e6d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e6e0: 2020 2f2f 456e 636f 6465 2061 7320 7374    //Encode as st
-0001e6f0: 7269 6e67 2061 7474 6163 686d 656e 740a  ring attachment.
-0001e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e710: 6966 2028 2462 5374 7269 6e67 2920 7b0a  if ($bString) {.
-0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e730: 2020 2020 246d 696d 655b 5d20 3d20 2474      $mime[] = $t
-0001e740: 6869 732d 3e65 6e63 6f64 6553 7472 696e  his->encodeStrin
-0001e750: 6728 2473 7472 696e 672c 2024 656e 636f  g($string, $enco
-0001e760: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
-0001e770: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
-0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e790: 2020 2020 246d 696d 655b 5d20 3d20 2474      $mime[] = $t
-0001e7a0: 6869 732d 3e65 6e63 6f64 6546 696c 6528  his->encodeFile(
-0001e7b0: 2470 6174 682c 2024 656e 636f 6469 6e67  $path, $encoding
-0001e7c0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0001e7d0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0001e7e0: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
-0001e7f0: 6973 4572 726f 7228 2929 207b 0a20 2020  isError()) {.   
-0001e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e810: 2072 6574 7572 6e20 2727 3b0a 2020 2020   return '';.    
-0001e820: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0001e830: 2020 2020 2020 2020 2020 2020 2020 246d                $m
-0001e840: 696d 655b 5d20 3d20 7374 6174 6963 3a3a  ime[] = static::
-0001e850: 244c 453b 0a20 2020 2020 2020 2020 2020  $LE;.           
-0001e860: 207d 0a20 2020 2020 2020 207d 0a0a 2020   }.        }..  
-0001e870: 2020 2020 2020 246d 696d 655b 5d20 3d20        $mime[] = 
-0001e880: 7370 7269 6e74 6628 272d 2d25 732d 2d25  sprintf('--%s--%
-0001e890: 7327 2c20 2462 6f75 6e64 6172 792c 2073  s', $boundary, s
-0001e8a0: 7461 7469 633a 3a24 4c45 293b 0a0a 2020  tatic::$LE);..  
-0001e8b0: 2020 2020 2020 7265 7475 726e 2069 6d70        return imp
-0001e8c0: 6c6f 6465 2827 272c 2024 6d69 6d65 293b  lode('', $mime);
-0001e8d0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-0001e8e0: 2020 2020 202a 2045 6e63 6f64 6520 6120       * Encode a 
-0001e8f0: 6669 6c65 2061 7474 6163 686d 656e 7420  file attachment 
-0001e900: 696e 2072 6571 7565 7374 6564 2066 6f72  in requested for
-0001e910: 6d61 742e 0a20 2020 2020 2a20 5265 7475  mat..     * Retu
-0001e920: 726e 7320 616e 2065 6d70 7479 2073 7472  rns an empty str
-0001e930: 696e 6720 6f6e 2066 6169 6c75 7265 2e0a  ing on failure..
-0001e940: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
-0001e950: 6172 616d 2073 7472 696e 6720 2470 6174  aram string $pat
-0001e960: 6820 2020 2020 5468 6520 6675 6c6c 2070  h     The full p
-0001e970: 6174 6820 746f 2074 6865 2066 696c 650a  ath to the file.
-0001e980: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-0001e990: 7269 6e67 2024 656e 636f 6469 6e67 2054  ring $encoding T
-0001e9a0: 6865 2065 6e63 6f64 696e 6720 746f 2075  he encoding to u
-0001e9b0: 7365 3b20 6f6e 6520 6f66 2027 6261 7365  se; one of 'base
-0001e9c0: 3634 272c 2027 3762 6974 272c 2027 3862  64', '7bit', '8b
-0001e9d0: 6974 272c 2027 6269 6e61 7279 272c 2027  it', 'binary', '
-0001e9e0: 7175 6f74 6564 2d70 7269 6e74 6162 6c65  quoted-printable
-0001e9f0: 270a 2020 2020 202a 0a20 2020 2020 2a20  '.     *.     * 
-0001ea00: 4072 6574 7572 6e20 7374 7269 6e67 0a20  @return string. 
-0001ea10: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-0001ea20: 6374 6564 2066 756e 6374 696f 6e20 656e  cted function en
-0001ea30: 636f 6465 4669 6c65 2824 7061 7468 2c20  codeFile($path, 
-0001ea40: 2465 6e63 6f64 696e 6720 3d20 7365 6c66  $encoding = self
-0001ea50: 3a3a 454e 434f 4449 4e47 5f42 4153 4536  ::ENCODING_BASE6
-0001ea60: 3429 0a20 2020 207b 0a20 2020 2020 2020  4).    {.       
-0001ea70: 2074 7279 207b 0a20 2020 2020 2020 2020   try {.         
-0001ea80: 2020 2069 6620 2821 7374 6174 6963 3a3a     if (!static::
-0001ea90: 6669 6c65 4973 4163 6365 7373 6962 6c65  fileIsAccessible
-0001eaa0: 2824 7061 7468 2929 207b 0a20 2020 2020  ($path)) {.     
-0001eab0: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
-0001eac0: 206e 6577 2045 7863 6570 7469 6f6e 2824   new Exception($
-0001ead0: 7468 6973 2d3e 6c61 6e67 2827 6669 6c65  this->lang('file
-0001eae0: 5f6f 7065 6e27 2920 2e20 2470 6174 682c  _open') . $path,
-0001eaf0: 2073 656c 663a 3a53 544f 505f 434f 4e54   self::STOP_CONT
-0001eb00: 494e 5545 293b 0a20 2020 2020 2020 2020  INUE);.         
-0001eb10: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0001eb20: 2024 6669 6c65 5f62 7566 6665 7220 3d20   $file_buffer = 
-0001eb30: 6669 6c65 5f67 6574 5f63 6f6e 7465 6e74  file_get_content
-0001eb40: 7328 2470 6174 6829 3b0a 2020 2020 2020  s($path);.      
-0001eb50: 2020 2020 2020 6966 2028 6661 6c73 6520        if (false 
-0001eb60: 3d3d 3d20 2466 696c 655f 6275 6666 6572  === $file_buffer
-0001eb70: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0001eb80: 2020 2020 7468 726f 7720 6e65 7720 4578      throw new Ex
-0001eb90: 6365 7074 696f 6e28 2474 6869 732d 3e6c  ception($this->l
-0001eba0: 616e 6728 2766 696c 655f 6f70 656e 2729  ang('file_open')
-0001ebb0: 202e 2024 7061 7468 2c20 7365 6c66 3a3a   . $path, self::
-0001ebc0: 5354 4f50 5f43 4f4e 5449 4e55 4529 3b0a  STOP_CONTINUE);.
-0001ebd0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0001ebe0: 2020 2020 2020 2020 2020 2466 696c 655f            $file_
-0001ebf0: 6275 6666 6572 203d 2024 7468 6973 2d3e  buffer = $this->
-0001ec00: 656e 636f 6465 5374 7269 6e67 2824 6669  encodeString($fi
-0001ec10: 6c65 5f62 7566 6665 722c 2024 656e 636f  le_buffer, $enco
-0001ec20: 6469 6e67 293b 0a0a 2020 2020 2020 2020  ding);..        
-0001ec30: 2020 2020 7265 7475 726e 2024 6669 6c65      return $file
-0001ec40: 5f62 7566 6665 723b 0a20 2020 2020 2020  _buffer;.       
-0001ec50: 207d 2063 6174 6368 2028 4578 6365 7074   } catch (Except
-0001ec60: 696f 6e20 2465 7863 2920 7b0a 2020 2020  ion $exc) {.    
-0001ec70: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
-0001ec80: 6574 4572 726f 7228 2465 7863 2d3e 6765  etError($exc->ge
-0001ec90: 744d 6573 7361 6765 2829 293b 0a20 2020  tMessage());.   
-0001eca0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-0001ecb0: 6564 6562 7567 2824 6578 632d 3e67 6574  edebug($exc->get
-0001ecc0: 4d65 7373 6167 6528 2929 3b0a 2020 2020  Message());.    
-0001ecd0: 2020 2020 2020 2020 6966 2028 2474 6869          if ($thi
-0001ece0: 732d 3e65 7863 6570 7469 6f6e 7329 207b  s->exceptions) {
-0001ecf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ed00: 2074 6872 6f77 2024 6578 633b 0a20 2020   throw $exc;.   
-0001ed10: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-0001ed20: 2020 2020 2020 2020 7265 7475 726e 2027          return '
-0001ed30: 273b 0a20 2020 2020 2020 207d 0a20 2020  ';.        }.   
-0001ed40: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
-0001ed50: 202a 2045 6e63 6f64 6520 6120 7374 7269   * Encode a stri
-0001ed60: 6e67 2069 6e20 7265 7175 6573 7465 6420  ng in requested 
-0001ed70: 666f 726d 6174 2e0a 2020 2020 202a 2052  format..     * R
-0001ed80: 6574 7572 6e73 2061 6e20 656d 7074 7920  eturns an empty 
-0001ed90: 7374 7269 6e67 206f 6e20 6661 696c 7572  string on failur
-0001eda0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-0001edb0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-0001edc0: 7374 7220 2020 2020 2054 6865 2074 6578  str      The tex
-0001edd0: 7420 746f 2065 6e63 6f64 650a 2020 2020  t to encode.    
-0001ede0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
-0001edf0: 2024 656e 636f 6469 6e67 2054 6865 2065   $encoding The e
-0001ee00: 6e63 6f64 696e 6720 746f 2075 7365 3b20  ncoding to use; 
-0001ee10: 6f6e 6520 6f66 2027 6261 7365 3634 272c  one of 'base64',
-0001ee20: 2027 3762 6974 272c 2027 3862 6974 272c   '7bit', '8bit',
-0001ee30: 2027 6269 6e61 7279 272c 2027 7175 6f74   'binary', 'quot
-0001ee40: 6564 2d70 7269 6e74 6162 6c65 270a 2020  ed-printable'.  
-0001ee50: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
-0001ee60: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
-0001ee70: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-0001ee80: 7572 6e20 7374 7269 6e67 0a20 2020 2020  urn string.     
-0001ee90: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-0001eea0: 6e63 7469 6f6e 2065 6e63 6f64 6553 7472  nction encodeStr
-0001eeb0: 696e 6728 2473 7472 2c20 2465 6e63 6f64  ing($str, $encod
-0001eec0: 696e 6720 3d20 7365 6c66 3a3a 454e 434f  ing = self::ENCO
-0001eed0: 4449 4e47 5f42 4153 4536 3429 0a20 2020  DING_BASE64).   
-0001eee0: 207b 0a20 2020 2020 2020 2024 656e 636f   {.        $enco
-0001eef0: 6465 6420 3d20 2727 3b0a 2020 2020 2020  ded = '';.      
-0001ef00: 2020 7377 6974 6368 2028 7374 7274 6f6c    switch (strtol
-0001ef10: 6f77 6572 2824 656e 636f 6469 6e67 2929  ower($encoding))
-0001ef20: 207b 0a20 2020 2020 2020 2020 2020 2063   {.            c
-0001ef30: 6173 6520 7374 6174 6963 3a3a 454e 434f  ase static::ENCO
-0001ef40: 4449 4e47 5f42 4153 4536 343a 0a20 2020  DING_BASE64:.   
-0001ef50: 2020 2020 2020 2020 2020 2020 2024 656e               $en
-0001ef60: 636f 6465 6420 3d20 6368 756e 6b5f 7370  coded = chunk_sp
-0001ef70: 6c69 7428 0a20 2020 2020 2020 2020 2020  lit(.           
-0001ef80: 2020 2020 2020 2020 2062 6173 6536 345f           base64_
-0001ef90: 656e 636f 6465 2824 7374 7229 2c0a 2020  encode($str),.  
-0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efb0: 2020 7374 6174 6963 3a3a 5354 445f 4c49    static::STD_LI
-0001efc0: 4e45 5f4c 454e 4754 482c 0a20 2020 2020  NE_LENGTH,.     
-0001efd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001efe0: 7461 7469 633a 3a24 4c45 0a20 2020 2020  tatic::$LE.     
-0001eff0: 2020 2020 2020 2020 2020 2029 3b0a 2020             );.  
-0001f000: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001f010: 6561 6b3b 0a20 2020 2020 2020 2020 2020  eak;.           
-0001f020: 2063 6173 6520 7374 6174 6963 3a3a 454e   case static::EN
-0001f030: 434f 4449 4e47 5f37 4249 543a 0a20 2020  CODING_7BIT:.   
-0001f040: 2020 2020 2020 2020 2063 6173 6520 7374           case st
-0001f050: 6174 6963 3a3a 454e 434f 4449 4e47 5f38  atic::ENCODING_8
-0001f060: 4249 543a 0a20 2020 2020 2020 2020 2020  BIT:.           
-0001f070: 2020 2020 2024 656e 636f 6465 6420 3d20       $encoded = 
-0001f080: 7374 6174 6963 3a3a 6e6f 726d 616c 697a  static::normaliz
-0001f090: 6542 7265 616b 7328 2473 7472 293b 0a20  eBreaks($str);. 
-0001f0a0: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-0001f0b0: 2f4d 616b 6520 7375 7265 2069 7420 656e  /Make sure it en
-0001f0c0: 6473 2077 6974 6820 6120 6c69 6e65 2062  ds with a line b
-0001f0d0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-0001f0e0: 2020 2020 2069 6620 2873 7562 7374 7228       if (substr(
-0001f0f0: 2465 6e63 6f64 6564 2c20 2d28 7374 726c  $encoded, -(strl
-0001f100: 656e 2873 7461 7469 633a 3a24 4c45 2929  en(static::$LE))
-0001f110: 2920 213d 3d20 7374 6174 6963 3a3a 244c  ) !== static::$L
-0001f120: 4529 207b 0a20 2020 2020 2020 2020 2020  E) {.           
-0001f130: 2020 2020 2020 2020 2024 656e 636f 6465           $encode
-0001f140: 6420 2e3d 2073 7461 7469 633a 3a24 4c45  d .= static::$LE
-0001f150: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001f160: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-0001f170: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
-0001f180: 2020 2020 2020 2063 6173 6520 7374 6174         case stat
-0001f190: 6963 3a3a 454e 434f 4449 4e47 5f42 494e  ic::ENCODING_BIN
-0001f1a0: 4152 593a 0a20 2020 2020 2020 2020 2020  ARY:.           
-0001f1b0: 2020 2020 2024 656e 636f 6465 6420 3d20       $encoded = 
-0001f1c0: 2473 7472 3b0a 2020 2020 2020 2020 2020  $str;.          
-0001f1d0: 2020 2020 2020 6272 6561 6b3b 0a20 2020        break;.   
-0001f1e0: 2020 2020 2020 2020 2063 6173 6520 7374           case st
-0001f1f0: 6174 6963 3a3a 454e 434f 4449 4e47 5f51  atic::ENCODING_Q
-0001f200: 554f 5445 445f 5052 494e 5441 424c 453a  UOTED_PRINTABLE:
-0001f210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f220: 2024 656e 636f 6465 6420 3d20 2474 6869   $encoded = $thi
-0001f230: 732d 3e65 6e63 6f64 6551 5028 2473 7472  s->encodeQP($str
-0001f240: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0001f250: 2020 2062 7265 616b 3b0a 2020 2020 2020     break;.      
-0001f260: 2020 2020 2020 6465 6661 756c 743a 0a20        default:. 
-0001f270: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-0001f280: 7468 6973 2d3e 7365 7445 7272 6f72 2824  this->setError($
-0001f290: 7468 6973 2d3e 6c61 6e67 2827 656e 636f  this->lang('enco
-0001f2a0: 6469 6e67 2729 202e 2024 656e 636f 6469  ding') . $encodi
-0001f2b0: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
-0001f2c0: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
-0001f2d0: 6578 6365 7074 696f 6e73 2920 7b0a 2020  exceptions) {.  
-0001f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2f0: 2020 7468 726f 7720 6e65 7720 4578 6365    throw new Exce
-0001f300: 7074 696f 6e28 2474 6869 732d 3e6c 616e  ption($this->lan
-0001f310: 6728 2765 6e63 6f64 696e 6727 2920 2e20  g('encoding') . 
-0001f320: 2465 6e63 6f64 696e 6729 3b0a 2020 2020  $encoding);.    
-0001f330: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0001f340: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001f350: 6561 6b3b 0a20 2020 2020 2020 207d 0a0a  eak;.        }..
-0001f360: 2020 2020 2020 2020 7265 7475 726e 2024          return $
-0001f370: 656e 636f 6465 643b 0a20 2020 207d 0a0a  encoded;.    }..
-0001f380: 2020 2020 2f2a 2a0a 2020 2020 202a 2045      /**.     * E
-0001f390: 6e63 6f64 6520 6120 6865 6164 6572 2076  ncode a header v
-0001f3a0: 616c 7565 2028 6e6f 7420 696e 636c 7564  alue (not includ
-0001f3b0: 696e 6720 6974 7320 6c61 6265 6c29 206f  ing its label) o
-0001f3c0: 7074 696d 616c 6c79 2e0a 2020 2020 202a  ptimally..     *
-0001f3d0: 2050 6963 6b73 2073 686f 7274 6573 7420   Picks shortest 
-0001f3e0: 6f66 2051 2c20 422c 206f 7220 6e6f 6e65  of Q, B, or none
-0001f3f0: 2e20 5265 7375 6c74 2069 6e63 6c75 6465  . Result include
-0001f400: 7320 666f 6c64 696e 6720 6966 206e 6565  s folding if nee
-0001f410: 6465 642e 0a20 2020 2020 2a20 5365 6520  ded..     * See 
-0001f420: 5246 4338 3232 2064 6566 696e 6974 696f  RFC822 definitio
-0001f430: 6e73 2066 6f72 2070 6872 6173 652c 2063  ns for phrase, c
-0001f440: 6f6d 6d65 6e74 2061 6e64 2074 6578 7420  omment and text 
-0001f450: 706f 7369 7469 6f6e 732e 0a20 2020 2020  positions..     
-0001f460: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-0001f470: 7374 7269 6e67 2024 7374 7220 2020 2020  string $str     
-0001f480: 2054 6865 2068 6561 6465 7220 7661 6c75   The header valu
-0001f490: 6520 746f 2065 6e63 6f64 650a 2020 2020  e to encode.    
-0001f4a0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
-0001f4b0: 2024 706f 7369 7469 6f6e 2057 6861 7420   $position What 
-0001f4c0: 636f 6e74 6578 7420 7468 6520 7374 7269  context the stri
-0001f4d0: 6e67 2077 696c 6c20 6265 2075 7365 6420  ng will be used 
-0001f4e0: 696e 0a20 2020 2020 2a0a 2020 2020 202a  in.     *.     *
-0001f4f0: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
-0001f500: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-0001f510: 6963 2066 756e 6374 696f 6e20 656e 636f  ic function enco
-0001f520: 6465 4865 6164 6572 2824 7374 722c 2024  deHeader($str, $
-0001f530: 706f 7369 7469 6f6e 203d 2027 7465 7874  position = 'text
-0001f540: 2729 0a20 2020 207b 0a20 2020 2020 2020  ').    {.       
-0001f550: 2024 6d61 7463 6863 6f75 6e74 203d 2030   $matchcount = 0
-0001f560: 3b0a 2020 2020 2020 2020 7377 6974 6368  ;.        switch
-0001f570: 2028 7374 7274 6f6c 6f77 6572 2824 706f   (strtolower($po
-0001f580: 7369 7469 6f6e 2929 207b 0a20 2020 2020  sition)) {.     
-0001f590: 2020 2020 2020 2063 6173 6520 2770 6872         case 'phr
-0001f5a0: 6173 6527 3a0a 2020 2020 2020 2020 2020  ase':.          
-0001f5b0: 2020 2020 2020 6966 2028 2170 7265 675f        if (!preg_
-0001f5c0: 6d61 7463 6828 272f 5b5c 3230 302d 5c33  match('/[\200-\3
-0001f5d0: 3737 5d2f 272c 2024 7374 7229 2920 7b0a  77]/', $str)) {.
-0001f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5f0: 2020 2020 2f2f 4361 6e27 7420 7573 6520      //Can't use 
-0001f600: 6164 6473 6c61 7368 6573 2061 7320 7765  addslashes as we
-0001f610: 2064 6f6e 2774 206b 6e6f 7720 7468 6520   don't know the 
-0001f620: 7661 6c75 6520 6f66 206d 6167 6963 5f71  value of magic_q
-0001f630: 756f 7465 735f 7379 6261 7365 0a20 2020  uotes_sybase.   
-0001f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f650: 2024 656e 636f 6465 6420 3d20 6164 6463   $encoded = addc
-0001f660: 736c 6173 6865 7328 2473 7472 2c20 225c  slashes($str, "\
-0001f670: 302e 2e5c 3337 5c31 3737 5c5c 5c22 2229  0..\37\177\\\"")
-0001f680: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001f690: 2020 2020 2020 6966 2028 2824 7374 7220        if (($str 
-0001f6a0: 3d3d 3d20 2465 6e63 6f64 6564 2920 2626  === $encoded) &&
-0001f6b0: 2021 7072 6567 5f6d 6174 6368 2827 2f5b   !preg_match('/[
-0001f6c0: 5e41 2d5a 612d 7a30 2d39 2123 2425 265c  ^A-Za-z0-9!#$%&\
-0001f6d0: 272a 2b5c 2f3d 3f5e 5f60 7b7c 7d7e 202d  '*+\/=?^_`{|}~ -
-0001f6e0: 5d2f 272c 2024 7374 7229 2920 7b0a 2020  ]/', $str)) {.  
-0001f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f700: 2020 2020 2020 7265 7475 726e 2024 656e        return $en
-0001f710: 636f 6465 643b 0a20 2020 2020 2020 2020  coded;.         
-0001f720: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
-0001f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f740: 2020 7265 7475 726e 2022 5c22 2465 6e63    return "\"$enc
-0001f750: 6f64 6564 5c22 223b 0a20 2020 2020 2020  oded\"";.       
-0001f760: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-0001f770: 2020 2020 2020 2020 2020 2024 6d61 7463             $matc
-0001f780: 6863 6f75 6e74 203d 2070 7265 675f 6d61  hcount = preg_ma
-0001f790: 7463 685f 616c 6c28 272f 5b5e 5c30 3430  tch_all('/[^\040
-0001f7a0: 5c30 3431 5c30 3433 2d5c 3133 335c 3133  \041\043-\133\13
-0001f7b0: 352d 5c31 3736 5d2f 272c 2024 7374 722c  5-\176]/', $str,
-0001f7c0: 2024 6d61 7463 6865 7329 3b0a 2020 2020   $matches);.    
-0001f7d0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0001f7e0: 6b3b 0a20 2020 2020 2020 2020 2020 202f  k;.            /
-0001f7f0: 2a20 406e 6f69 6e73 7065 6374 696f 6e20  * @noinspection 
-0001f800: 5068 704d 6973 7369 6e67 4272 6561 6b53  PhpMissingBreakS
-0001f810: 7461 7465 6d65 6e74 496e 7370 6563 7469  tatementInspecti
-0001f820: 6f6e 202a 2f0a 2020 2020 2020 2020 2020  on */.          
-0001f830: 2020 6361 7365 2027 636f 6d6d 656e 7427    case 'comment'
-0001f840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f850: 2020 246d 6174 6368 636f 756e 7420 3d20    $matchcount = 
-0001f860: 7072 6567 5f6d 6174 6368 5f61 6c6c 2827  preg_match_all('
-0001f870: 2f5b 2829 225d 2f27 2c20 2473 7472 2c20  /[()"]/', $str, 
-0001f880: 246d 6174 6368 6573 293b 0a20 2020 2020  $matches);.     
-0001f890: 2020 2020 2020 202f 2f66 616c 6c74 6872         //fallthr
-0001f8a0: 6f75 6768 0a20 2020 2020 2020 2020 2020  ough.           
-0001f8b0: 2063 6173 6520 2774 6578 7427 3a0a 2020   case 'text':.  
-0001f8c0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-0001f8d0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0001f8e0: 2020 2024 6d61 7463 6863 6f75 6e74 202b     $matchcount +
-0001f8f0: 3d20 7072 6567 5f6d 6174 6368 5f61 6c6c  = preg_match_all
-0001f900: 2827 2f5b 5c30 3030 2d5c 3031 305c 3031  ('/[\000-\010\01
-0001f910: 335c 3031 345c 3031 362d 5c30 3337 5c31  3\014\016-\037\1
-0001f920: 3737 2d5c 3337 375d 2f27 2c20 2473 7472  77-\377]/', $str
-0001f930: 2c20 246d 6174 6368 6573 293b 0a20 2020  , $matches);.   
-0001f940: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0001f950: 616b 3b0a 2020 2020 2020 2020 7d0a 0a20  ak;.        }.. 
-0001f960: 2020 2020 2020 2069 6620 2824 7468 6973         if ($this
-0001f970: 2d3e 6861 7338 6269 7443 6861 7273 2824  ->has8bitChars($
-0001f980: 7374 7229 2920 7b0a 2020 2020 2020 2020  str)) {.        
-0001f990: 2020 2020 2463 6861 7273 6574 203d 2024      $charset = $
-0001f9a0: 7468 6973 2d3e 4368 6172 5365 743b 0a20  this->CharSet;. 
-0001f9b0: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
-0001f9c0: 2020 2020 2020 2020 2020 2020 2463 6861              $cha
-0001f9d0: 7273 6574 203d 2073 7461 7469 633a 3a43  rset = static::C
-0001f9e0: 4841 5253 4554 5f41 5343 4949 3b0a 2020  HARSET_ASCII;.  
-0001f9f0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0001fa00: 202f 2f51 2f42 2065 6e63 6f64 696e 6720   //Q/B encoding 
-0001fa10: 6164 6473 2038 2063 6861 7273 2061 6e64  adds 8 chars and
-0001fa20: 2074 6865 2063 6861 7273 6574 2028 2260   the charset ("`
-0001fa30: 203d 3f3c 6368 6172 7365 743e 3f5b 5142   =?<charset>?[QB
-0001fa40: 5d3f 3c63 6f6e 7465 6e74 3e3f 3d60 2229  ]?<content>?=`")
-0001fa50: 2e0a 2020 2020 2020 2020 246f 7665 7268  ..        $overh
-0001fa60: 6561 6420 3d20 3820 2b20 7374 726c 656e  ead = 8 + strlen
-0001fa70: 2824 6368 6172 7365 7429 3b0a 0a20 2020  ($charset);..   
-0001fa80: 2020 2020 2069 6620 2827 6d61 696c 2720       if ('mail' 
-0001fa90: 3d3d 3d20 2474 6869 732d 3e4d 6169 6c65  === $this->Maile
-0001faa0: 7229 207b 0a20 2020 2020 2020 2020 2020  r) {.           
-0001fab0: 2024 6d61 786c 656e 203d 2073 7461 7469   $maxlen = stati
-0001fac0: 633a 3a4d 4149 4c5f 4d41 585f 4c49 4e45  c::MAIL_MAX_LINE
-0001fad0: 5f4c 454e 4754 4820 2d20 246f 7665 7268  _LENGTH - $overh
-0001fae0: 6561 643b 0a20 2020 2020 2020 207d 2065  ead;.        } e
-0001faf0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-0001fb00: 2020 246d 6178 6c65 6e20 3d20 7374 6174    $maxlen = stat
-0001fb10: 6963 3a3a 4d41 585f 4c49 4e45 5f4c 454e  ic::MAX_LINE_LEN
-0001fb20: 4754 4820 2d20 246f 7665 7268 6561 643b  GTH - $overhead;
-0001fb30: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-0001fb40: 2020 2020 2f2f 5365 6c65 6374 2074 6865      //Select the
-0001fb50: 2065 6e63 6f64 696e 6720 7468 6174 2070   encoding that p
-0001fb60: 726f 6475 6365 7320 7468 6520 7368 6f72  roduces the shor
-0001fb70: 7465 7374 206f 7574 7075 7420 616e 642f  test output and/
-0001fb80: 6f72 2070 7265 7665 6e74 7320 636f 7272  or prevents corr
-0001fb90: 7570 7469 6f6e 2e0a 2020 2020 2020 2020  uption..        
-0001fba0: 6966 2028 246d 6174 6368 636f 756e 7420  if ($matchcount 
-0001fbb0: 3e20 7374 726c 656e 2824 7374 7229 202f  > strlen($str) /
-0001fbc0: 2033 2920 7b0a 2020 2020 2020 2020 2020   3) {.          
-0001fbd0: 2020 2f2f 4d6f 7265 2074 6861 6e20 312f    //More than 1/
-0001fbe0: 3320 6f66 2074 6865 2063 6f6e 7465 6e74  3 of the content
-0001fbf0: 206e 6565 6473 2065 6e63 6f64 696e 672c   needs encoding,
-0001fc00: 2075 7365 2042 2d65 6e63 6f64 652e 0a20   use B-encode.. 
-0001fc10: 2020 2020 2020 2020 2020 2024 656e 636f             $enco
-0001fc20: 6469 6e67 203d 2027 4227 3b0a 2020 2020  ding = 'B';.    
-0001fc30: 2020 2020 7d20 656c 7365 6966 2028 246d      } elseif ($m
-0001fc40: 6174 6368 636f 756e 7420 3e20 3029 207b  atchcount > 0) {
-0001fc50: 0a20 2020 2020 2020 2020 2020 202f 2f4c  .            //L
-0001fc60: 6573 7320 7468 616e 2031 2f33 206f 6620  ess than 1/3 of 
-0001fc70: 7468 6520 636f 6e74 656e 7420 6e65 6564  the content need
-0001fc80: 7320 656e 636f 6469 6e67 2c20 7573 6520  s encoding, use 
-0001fc90: 512d 656e 636f 6465 2e0a 2020 2020 2020  Q-encode..      
-0001fca0: 2020 2020 2020 2465 6e63 6f64 696e 6720        $encoding 
-0001fcb0: 3d20 2751 273b 0a20 2020 2020 2020 207d  = 'Q';.        }
-0001fcc0: 2065 6c73 6569 6620 2873 7472 6c65 6e28   elseif (strlen(
-0001fcd0: 2473 7472 2920 3e20 246d 6178 6c65 6e29  $str) > $maxlen)
-0001fce0: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
-0001fcf0: 2f4e 6f20 656e 636f 6469 6e67 206e 6565  /No encoding nee
-0001fd00: 6465 642c 2062 7574 2076 616c 7565 2065  ded, but value e
-0001fd10: 7863 6565 6473 206d 6178 206c 696e 6520  xceeds max line 
-0001fd20: 6c65 6e67 7468 2c20 7573 6520 512d 656e  length, use Q-en
-0001fd30: 636f 6465 2074 6f20 7072 6576 656e 7420  code to prevent 
-0001fd40: 636f 7272 7570 7469 6f6e 2e0a 2020 2020  corruption..    
-0001fd50: 2020 2020 2020 2020 2465 6e63 6f64 696e          $encodin
-0001fd60: 6720 3d20 2751 273b 0a20 2020 2020 2020  g = 'Q';.       
-0001fd70: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
-0001fd80: 2020 2020 2020 2f2f 4e6f 2072 6566 6f72        //No refor
-0001fd90: 6d61 7474 696e 6720 6e65 6564 6564 0a20  matting needed. 
-0001fda0: 2020 2020 2020 2020 2020 2024 656e 636f             $enco
-0001fdb0: 6469 6e67 203d 2066 616c 7365 3b0a 2020  ding = false;.  
-0001fdc0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0001fdd0: 2073 7769 7463 6820 2824 656e 636f 6469   switch ($encodi
-0001fde0: 6e67 2920 7b0a 2020 2020 2020 2020 2020  ng) {.          
-0001fdf0: 2020 6361 7365 2027 4227 3a0a 2020 2020    case 'B':.    
-0001fe00: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0001fe10: 2474 6869 732d 3e68 6173 4d75 6c74 6942  $this->hasMultiB
-0001fe20: 7974 6573 2824 7374 7229 2920 7b0a 2020  ytes($str)) {.  
-0001fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe40: 2020 2f2f 5573 6520 6120 6375 7374 6f6d    //Use a custom
-0001fe50: 2066 756e 6374 696f 6e20 7768 6963 6820   function which 
-0001fe60: 636f 7272 6563 746c 7920 656e 636f 6465  correctly encode
-0001fe70: 7320 616e 6420 7772 6170 7320 6c6f 6e67  s and wraps long
-0001fe80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fe90: 2020 2020 202f 2f6d 756c 7469 6279 7465       //multibyte
-0001fea0: 2073 7472 696e 6773 2077 6974 686f 7574   strings without
-0001feb0: 2062 7265 616b 696e 6720 6c69 6e65 7320   breaking lines 
-0001fec0: 7769 7468 696e 2061 2063 6861 7261 6374  within a charact
-0001fed0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0001fee0: 2020 2020 2020 2024 656e 636f 6465 6420         $encoded 
-0001fef0: 3d20 2474 6869 732d 3e62 6173 6536 3445  = $this->base64E
-0001ff00: 6e63 6f64 6557 7261 704d 4228 2473 7472  ncodeWrapMB($str
-0001ff10: 2c20 225c 6e22 293b 0a20 2020 2020 2020  , "\n");.       
-0001ff20: 2020 2020 2020 2020 207d 2065 6c73 6520           } else 
-0001ff30: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001ff40: 2020 2020 2020 2465 6e63 6f64 6564 203d        $encoded =
-0001ff50: 2062 6173 6536 345f 656e 636f 6465 2824   base64_encode($
-0001ff60: 7374 7229 3b0a 2020 2020 2020 2020 2020  str);.          
-0001ff70: 2020 2020 2020 2020 2020 246d 6178 6c65            $maxle
-0001ff80: 6e20 2d3d 2024 6d61 786c 656e 2025 2034  n -= $maxlen % 4
-0001ff90: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0001ffa0: 2020 2020 2020 2465 6e63 6f64 6564 203d        $encoded =
-0001ffb0: 2074 7269 6d28 6368 756e 6b5f 7370 6c69   trim(chunk_spli
-0001ffc0: 7428 2465 6e63 6f64 6564 2c20 246d 6178  t($encoded, $max
-0001ffd0: 6c65 6e2c 2022 5c6e 2229 293b 0a20 2020  len, "\n"));.   
-0001ffe0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-0001fff0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00020000: 656e 636f 6465 6420 3d20 7072 6567 5f72  encoded = preg_r
-00020010: 6570 6c61 6365 2827 2f5e 282e 2a29 242f  eplace('/^(.*)$/
-00020020: 6d27 2c20 2720 3d3f 2720 2e20 2463 6861  m', ' =?' . $cha
-00020030: 7273 6574 202e 2022 3f24 656e 636f 6469  rset . "?$encodi
-00020040: 6e67 3f5c 5c31 3f3d 222c 2024 656e 636f  ng?\\1?=", $enco
-00020050: 6465 6429 3b0a 2020 2020 2020 2020 2020  ded);.          
-00020060: 2020 2020 2020 6272 6561 6b3b 0a20 2020        break;.   
-00020070: 2020 2020 2020 2020 2063 6173 6520 2751           case 'Q
-00020080: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00020090: 2020 2024 656e 636f 6465 6420 3d20 2474     $encoded = $t
-000200a0: 6869 732d 3e65 6e63 6f64 6551 2824 7374  his->encodeQ($st
-000200b0: 722c 2024 706f 7369 7469 6f6e 293b 0a20  r, $position);. 
-000200c0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-000200d0: 656e 636f 6465 6420 3d20 2474 6869 732d  encoded = $this-
-000200e0: 3e77 7261 7054 6578 7428 2465 6e63 6f64  >wrapText($encod
-000200f0: 6564 2c20 246d 6178 6c65 6e2c 2074 7275  ed, $maxlen, tru
-00020100: 6529 3b0a 2020 2020 2020 2020 2020 2020  e);.            
-00020110: 2020 2020 2465 6e63 6f64 6564 203d 2073      $encoded = s
-00020120: 7472 5f72 6570 6c61 6365 2827 3d27 202e  tr_replace('=' .
-00020130: 2073 7461 7469 633a 3a24 4c45 2c20 225c   static::$LE, "\
-00020140: 6e22 2c20 7472 696d 2824 656e 636f 6465  n", trim($encode
-00020150: 6429 293b 0a20 2020 2020 2020 2020 2020  d));.           
-00020160: 2020 2020 2024 656e 636f 6465 6420 3d20       $encoded = 
-00020170: 7072 6567 5f72 6570 6c61 6365 2827 2f5e  preg_replace('/^
-00020180: 282e 2a29 242f 6d27 2c20 2720 3d3f 2720  (.*)$/m', ' =?' 
-00020190: 2e20 2463 6861 7273 6574 202e 2022 3f24  . $charset . "?$
-000201a0: 656e 636f 6469 6e67 3f5c 5c31 3f3d 222c  encoding?\\1?=",
-000201b0: 2024 656e 636f 6465 6429 3b0a 2020 2020   $encoded);.    
-000201c0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000201d0: 6b3b 0a20 2020 2020 2020 2020 2020 2064  k;.            d
-000201e0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-000201f0: 2020 2020 2020 2020 7265 7475 726e 2024          return $
-00020200: 7374 723b 0a20 2020 2020 2020 207d 0a0a  str;.        }..
-00020210: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00020220: 7269 6d28 7374 6174 6963 3a3a 6e6f 726d  rim(static::norm
-00020230: 616c 697a 6542 7265 616b 7328 2465 6e63  alizeBreaks($enc
-00020240: 6f64 6564 2929 3b0a 2020 2020 7d0a 0a20  oded));.    }.. 
-00020250: 2020 202f 2a2a 0a20 2020 2020 2a20 4368     /**.     * Ch
-00020260: 6563 6b20 6966 2061 2073 7472 696e 6720  eck if a string 
-00020270: 636f 6e74 6169 6e73 206d 756c 7469 2d62  contains multi-b
-00020280: 7974 6520 6368 6172 6163 7465 7273 2e0a  yte characters..
-00020290: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
-000202a0: 6172 616d 2073 7472 696e 6720 2473 7472  aram string $str
-000202b0: 206d 756c 7469 2d62 7974 6520 7465 7874   multi-byte text
-000202c0: 2074 6f20 7772 6170 2065 6e63 6f64 650a   to wrap encode.
-000202d0: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-000202e0: 6574 7572 6e20 626f 6f6c 0a20 2020 2020  eturn bool.     
-000202f0: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-00020300: 6e63 7469 6f6e 2068 6173 4d75 6c74 6942  nction hasMultiB
-00020310: 7974 6573 2824 7374 7229 0a20 2020 207b  ytes($str).    {
-00020320: 0a20 2020 2020 2020 2069 6620 2866 756e  .        if (fun
-00020330: 6374 696f 6e5f 6578 6973 7473 2827 6d62  ction_exists('mb
-00020340: 5f73 7472 6c65 6e27 2929 207b 0a20 2020  _strlen')) {.   
-00020350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00020360: 7374 726c 656e 2824 7374 7229 203e 206d  strlen($str) > m
-00020370: 625f 7374 726c 656e 2824 7374 722c 2024  b_strlen($str, $
-00020380: 7468 6973 2d3e 4368 6172 5365 7429 3b0a  this->CharSet);.
-00020390: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-000203a0: 2020 202f 2f41 7373 756d 6520 6e6f 206d     //Assume no m
-000203b0: 756c 7469 6279 7465 7320 2877 6520 6361  ultibytes (we ca
-000203c0: 6e27 7420 6861 6e64 6c65 2077 6974 686f  n't handle witho
-000203d0: 7574 206d 6273 7472 696e 6720 6675 6e63  ut mbstring func
-000203e0: 7469 6f6e 7320 616e 7977 6179 290a 2020  tions anyway).  
-000203f0: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
-00020400: 7365 3b0a 2020 2020 7d0a 0a20 2020 202f  se;.    }..    /
-00020410: 2a2a 0a20 2020 2020 2a20 446f 6573 2061  **.     * Does a
-00020420: 2073 7472 696e 6720 636f 6e74 6169 6e20   string contain 
-00020430: 616e 7920 382d 6269 7420 6368 6172 7320  any 8-bit chars 
-00020440: 2869 6e20 616e 7920 6368 6172 7365 7429  (in any charset)
-00020450: 3f0a 2020 2020 202a 0a20 2020 2020 2a20  ?.     *.     * 
-00020460: 4070 6172 616d 2073 7472 696e 6720 2474  @param string $t
-00020470: 6578 740a 2020 2020 202a 0a20 2020 2020  ext.     *.     
-00020480: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
-00020490: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-000204a0: 6320 6675 6e63 7469 6f6e 2068 6173 3862  c function has8b
-000204b0: 6974 4368 6172 7328 2474 6578 7429 0a20  itChars($text). 
-000204c0: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
-000204d0: 7572 6e20 2862 6f6f 6c29 2070 7265 675f  urn (bool) preg_
-000204e0: 6d61 7463 6828 272f 5b5c 7838 302d 5c78  match('/[\x80-\x
-000204f0: 4646 5d2f 272c 2024 7465 7874 293b 0a20  FF]/', $text);. 
-00020500: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-00020510: 2020 202a 2045 6e63 6f64 6520 616e 6420     * Encode and 
-00020520: 7772 6170 206c 6f6e 6720 6d75 6c74 6962  wrap long multib
-00020530: 7974 6520 7374 7269 6e67 7320 666f 7220  yte strings for 
-00020540: 6d61 696c 2068 6561 6465 7273 0a20 2020  mail headers.   
-00020550: 2020 2a20 7769 7468 6f75 7420 6272 6561    * without brea
-00020560: 6b69 6e67 206c 696e 6573 2077 6974 6869  king lines withi
-00020570: 6e20 6120 6368 6172 6163 7465 722e 0a20  n a character.. 
-00020580: 2020 2020 2a20 4164 6170 7465 6420 6672      * Adapted fr
-00020590: 6f6d 2061 2066 756e 6374 696f 6e20 6279  om a function by
-000205a0: 2070 6172 6176 6f69 642e 0a20 2020 2020   paravoid..     
-000205b0: 2a0a 2020 2020 202a 2040 7365 6520 6874  *.     * @see ht
-000205c0: 7470 3a2f 2f77 7777 2e70 6870 2e6e 6574  tp://www.php.net
-000205d0: 2f6d 616e 7561 6c2f 656e 2f66 756e 6374  /manual/en/funct
-000205e0: 696f 6e2e 6d62 2d65 6e63 6f64 652d 6d69  ion.mb-encode-mi
-000205f0: 6d65 6865 6164 6572 2e70 6870 2336 3032  meheader.php#602
-00020600: 3833 0a20 2020 2020 2a0a 2020 2020 202a  83.     *.     *
-00020610: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-00020620: 7374 7220 2020 2020 2020 6d75 6c74 692d  str       multi-
-00020630: 6279 7465 2074 6578 7420 746f 2077 7261  byte text to wra
-00020640: 7020 656e 636f 6465 0a20 2020 2020 2a20  p encode.     * 
-00020650: 4070 6172 616d 2073 7472 696e 6720 246c  @param string $l
-00020660: 696e 6562 7265 616b 2073 7472 696e 6720  inebreak string 
-00020670: 746f 2075 7365 2061 7320 6c69 6e65 6665  to use as linefe
-00020680: 6564 2f65 6e64 2d6f 662d 6c69 6e65 0a20  ed/end-of-line. 
-00020690: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-000206a0: 7475 726e 2073 7472 696e 670a 2020 2020  turn string.    
-000206b0: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-000206c0: 756e 6374 696f 6e20 6261 7365 3634 456e  unction base64En
-000206d0: 636f 6465 5772 6170 4d42 2824 7374 722c  codeWrapMB($str,
-000206e0: 2024 6c69 6e65 6272 6561 6b20 3d20 6e75   $linebreak = nu
-000206f0: 6c6c 290a 2020 2020 7b0a 2020 2020 2020  ll).    {.      
-00020700: 2020 2473 7461 7274 203d 2027 3d3f 2720    $start = '=?' 
-00020710: 2e20 2474 6869 732d 3e43 6861 7253 6574  . $this->CharSet
-00020720: 202e 2027 3f42 3f27 3b0a 2020 2020 2020   . '?B?';.      
-00020730: 2020 2465 6e64 203d 2027 3f3d 273b 0a20    $end = '?=';. 
-00020740: 2020 2020 2020 2024 656e 636f 6465 6420         $encoded 
-00020750: 3d20 2727 3b0a 2020 2020 2020 2020 6966  = '';.        if
-00020760: 2028 6e75 6c6c 203d 3d3d 2024 6c69 6e65   (null === $line
-00020770: 6272 6561 6b29 207b 0a20 2020 2020 2020  break) {.       
-00020780: 2020 2020 2024 6c69 6e65 6272 6561 6b20       $linebreak 
-00020790: 3d20 7374 6174 6963 3a3a 244c 453b 0a20  = static::$LE;. 
-000207a0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-000207b0: 2020 246d 625f 6c65 6e67 7468 203d 206d    $mb_length = m
-000207c0: 625f 7374 726c 656e 2824 7374 722c 2024  b_strlen($str, $
-000207d0: 7468 6973 2d3e 4368 6172 5365 7429 3b0a  this->CharSet);.
-000207e0: 2020 2020 2020 2020 2f2f 4561 6368 206c          //Each l
-000207f0: 696e 6520 6d75 7374 2068 6176 6520 6c65  ine must have le
-00020800: 6e67 7468 203c 3d20 3735 2c20 696e 636c  ngth <= 75, incl
-00020810: 7564 696e 6720 2473 7461 7274 2061 6e64  uding $start and
-00020820: 2024 656e 640a 2020 2020 2020 2020 246c   $end.        $l
-00020830: 656e 6774 6820 3d20 3735 202d 2073 7472  ength = 75 - str
-00020840: 6c65 6e28 2473 7461 7274 2920 2d20 7374  len($start) - st
-00020850: 726c 656e 2824 656e 6429 3b0a 2020 2020  rlen($end);.    
-00020860: 2020 2020 2f2f 4176 6572 6167 6520 6d75      //Average mu
-00020870: 6c74 692d 6279 7465 2072 6174 696f 0a20  lti-byte ratio. 
-00020880: 2020 2020 2020 2024 7261 7469 6f20 3d20         $ratio = 
-00020890: 246d 625f 6c65 6e67 7468 202f 2073 7472  $mb_length / str
-000208a0: 6c65 6e28 2473 7472 293b 0a20 2020 2020  len($str);.     
-000208b0: 2020 202f 2f42 6173 6536 3420 6861 7320     //Base64 has 
-000208c0: 6120 343a 3320 7261 7469 6f0a 2020 2020  a 4:3 ratio.    
-000208d0: 2020 2020 2461 7667 4c65 6e67 7468 203d      $avgLength =
-000208e0: 2066 6c6f 6f72 2824 6c65 6e67 7468 202a   floor($length *
-000208f0: 2024 7261 7469 6f20 2a20 2e37 3529 3b0a   $ratio * .75);.
-00020900: 0a20 2020 2020 2020 2024 6f66 6673 6574  .        $offset
-00020910: 203d 2030 3b0a 2020 2020 2020 2020 666f   = 0;.        fo
-00020920: 7220 2824 6920 3d20 303b 2024 6920 3c20  r ($i = 0; $i < 
-00020930: 246d 625f 6c65 6e67 7468 3b20 2469 202b  $mb_length; $i +
-00020940: 3d20 246f 6666 7365 7429 207b 0a20 2020  = $offset) {.   
-00020950: 2020 2020 2020 2020 2024 6c6f 6f6b 4261           $lookBa
-00020960: 636b 203d 2030 3b0a 2020 2020 2020 2020  ck = 0;.        
-00020970: 2020 2020 646f 207b 0a20 2020 2020 2020      do {.       
-00020980: 2020 2020 2020 2020 2024 6f66 6673 6574           $offset
-00020990: 203d 2024 6176 674c 656e 6774 6820 2d20   = $avgLength - 
-000209a0: 246c 6f6f 6b42 6163 6b3b 0a20 2020 2020  $lookBack;.     
-000209b0: 2020 2020 2020 2020 2020 2024 6368 756e             $chun
-000209c0: 6b20 3d20 6d62 5f73 7562 7374 7228 2473  k = mb_substr($s
-000209d0: 7472 2c20 2469 2c20 246f 6666 7365 742c  tr, $i, $offset,
-000209e0: 2024 7468 6973 2d3e 4368 6172 5365 7429   $this->CharSet)
-000209f0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-00020a00: 2020 2463 6875 6e6b 203d 2062 6173 6536    $chunk = base6
-00020a10: 345f 656e 636f 6465 2824 6368 756e 6b29  4_encode($chunk)
-00020a20: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-00020a30: 2020 2b2b 246c 6f6f 6b42 6163 6b3b 0a20    ++$lookBack;. 
-00020a40: 2020 2020 2020 2020 2020 207d 2077 6869             } whi
-00020a50: 6c65 2028 7374 726c 656e 2824 6368 756e  le (strlen($chun
-00020a60: 6b29 203e 2024 6c65 6e67 7468 293b 0a20  k) > $length);. 
-00020a70: 2020 2020 2020 2020 2020 2024 656e 636f             $enco
-00020a80: 6465 6420 2e3d 2024 6368 756e 6b20 2e20  ded .= $chunk . 
-00020a90: 246c 696e 6562 7265 616b 3b0a 2020 2020  $linebreak;.    
-00020aa0: 2020 2020 7d0a 0a20 2020 2020 2020 202f      }..        /
-00020ab0: 2f43 686f 6d70 2074 6865 206c 6173 7420  /Chomp the last 
-00020ac0: 6c69 6e65 6665 6564 0a20 2020 2020 2020  linefeed.       
-00020ad0: 2072 6574 7572 6e20 7375 6273 7472 2824   return substr($
-00020ae0: 656e 636f 6465 642c 2030 2c20 2d73 7472  encoded, 0, -str
-00020af0: 6c65 6e28 246c 696e 6562 7265 616b 2929  len($linebreak))
-00020b00: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-00020b10: 0a20 2020 2020 2a20 456e 636f 6465 2061  .     * Encode a
-00020b20: 2073 7472 696e 6720 696e 2071 756f 7465   string in quote
-00020b30: 642d 7072 696e 7461 626c 6520 666f 726d  d-printable form
-00020b40: 6174 2e0a 2020 2020 202a 2041 6363 6f72  at..     * Accor
-00020b50: 6469 6e67 2074 6f20 5246 4332 3034 3520  ding to RFC2045 
-00020b60: 7365 6374 696f 6e20 362e 372e 0a20 2020  section 6.7..   
-00020b70: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-00020b80: 6d20 7374 7269 6e67 2024 7374 7269 6e67  m string $string
-00020b90: 2054 6865 2074 6578 7420 746f 2065 6e63   The text to enc
-00020ba0: 6f64 650a 2020 2020 202a 0a20 2020 2020  ode.     *.     
-00020bb0: 2a20 4072 6574 7572 6e20 7374 7269 6e67  * @return string
-00020bc0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00020bd0: 6c69 6320 6675 6e63 7469 6f6e 2065 6e63  lic function enc
-00020be0: 6f64 6551 5028 2473 7472 696e 6729 0a20  odeQP($string). 
-00020bf0: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
-00020c00: 7572 6e20 7374 6174 6963 3a3a 6e6f 726d  urn static::norm
-00020c10: 616c 697a 6542 7265 616b 7328 7175 6f74  alizeBreaks(quot
-00020c20: 6564 5f70 7269 6e74 6162 6c65 5f65 6e63  ed_printable_enc
-00020c30: 6f64 6528 2473 7472 696e 6729 293b 0a20  ode($string));. 
-00020c40: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-00020c50: 2020 202a 2045 6e63 6f64 6520 6120 7374     * Encode a st
-00020c60: 7269 6e67 2075 7369 6e67 2051 2065 6e63  ring using Q enc
-00020c70: 6f64 696e 672e 0a20 2020 2020 2a0a 2020  oding..     *.  
-00020c80: 2020 202a 2040 7365 6520 6874 7470 3a2f     * @see http:/
-00020c90: 2f74 6f6f 6c73 2e69 6574 662e 6f72 672f  /tools.ietf.org/
-00020ca0: 6874 6d6c 2f72 6663 3230 3437 2373 6563  html/rfc2047#sec
-00020cb0: 7469 6f6e 2d34 2e32 0a20 2020 2020 2a0a  tion-4.2.     *.
-00020cc0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-00020cd0: 7269 6e67 2024 7374 7220 2020 2020 2074  ring $str      t
-00020ce0: 6865 2074 6578 7420 746f 2065 6e63 6f64  he text to encod
-00020cf0: 650a 2020 2020 202a 2040 7061 7261 6d20  e.     * @param 
-00020d00: 7374 7269 6e67 2024 706f 7369 7469 6f6e  string $position
-00020d10: 2057 6865 7265 2074 6865 2074 6578 7420   Where the text 
-00020d20: 6973 2067 6f69 6e67 2074 6f20 6265 2075  is going to be u
-00020d30: 7365 642c 2073 6565 2074 6865 2052 4643  sed, see the RFC
-00020d40: 2066 6f72 2077 6861 7420 7468 6174 206d   for what that m
-00020d50: 6561 6e73 0a20 2020 2020 2a0a 2020 2020  eans.     *.    
-00020d60: 202a 2040 7265 7475 726e 2073 7472 696e   * @return strin
-00020d70: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
-00020d80: 626c 6963 2066 756e 6374 696f 6e20 656e  blic function en
-00020d90: 636f 6465 5128 2473 7472 2c20 2470 6f73  codeQ($str, $pos
-00020da0: 6974 696f 6e20 3d20 2774 6578 7427 290a  ition = 'text').
-00020db0: 2020 2020 7b0a 2020 2020 2020 2020 2f2f      {.        //
-00020dc0: 5468 6572 6520 7368 6f75 6c64 206e 6f74  There should not
-00020dd0: 2062 6520 616e 7920 454f 4c20 696e 2074   be any EOL in t
-00020de0: 6865 2073 7472 696e 670a 2020 2020 2020  he string.      
-00020df0: 2020 2470 6174 7465 726e 203d 2027 273b    $pattern = '';
-00020e00: 0a20 2020 2020 2020 2024 656e 636f 6465  .        $encode
-00020e10: 6420 3d20 7374 725f 7265 706c 6163 6528  d = str_replace(
-00020e20: 5b22 5c72 222c 2022 5c6e 225d 2c20 2727  ["\r", "\n"], ''
-00020e30: 2c20 2473 7472 293b 0a20 2020 2020 2020  , $str);.       
-00020e40: 2073 7769 7463 6820 2873 7472 746f 6c6f   switch (strtolo
-00020e50: 7765 7228 2470 6f73 6974 696f 6e29 2920  wer($position)) 
-00020e60: 7b0a 2020 2020 2020 2020 2020 2020 6361  {.            ca
-00020e70: 7365 2027 7068 7261 7365 273a 0a20 2020  se 'phrase':.   
-00020e80: 2020 2020 2020 2020 2020 2020 202f 2f52               //R
-00020e90: 4643 2032 3034 3720 7365 6374 696f 6e20  FC 2047 section 
-00020ea0: 352e 330a 2020 2020 2020 2020 2020 2020  5.3.            
-00020eb0: 2020 2020 2470 6174 7465 726e 203d 2027      $pattern = '
-00020ec0: 5e41 2d5a 612d 7a30 2d39 212a 2b5c 2f20  ^A-Za-z0-9!*+\/ 
-00020ed0: 2d27 3b0a 2020 2020 2020 2020 2020 2020  -';.            
-00020ee0: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
-00020ef0: 2020 2020 2020 202f 2a0a 2020 2020 2020         /*.      
-00020f00: 2020 2020 2020 202a 2052 4643 2032 3034         * RFC 204
-00020f10: 3720 7365 6374 696f 6e20 352e 322e 0a20  7 section 5.2.. 
-00020f20: 2020 2020 2020 2020 2020 2020 2a20 4275              * Bu
-00020f30: 696c 6420 2470 6174 7465 726e 2077 6974  ild $pattern wit
-00020f40: 686f 7574 2069 6e63 6c75 6469 6e67 2064  hout including d
-00020f50: 656c 696d 6974 6572 7320 616e 6420 5b5d  elimiters and []
-00020f60: 0a20 2020 2020 2020 2020 2020 2020 2a2f  .             */
-00020f70: 0a20 2020 2020 2020 2020 2020 202f 2a20  .            /* 
-00020f80: 406e 6f69 6e73 7065 6374 696f 6e20 5068  @noinspection Ph
-00020f90: 704d 6973 7369 6e67 4272 6561 6b53 7461  pMissingBreakSta
-00020fa0: 7465 6d65 6e74 496e 7370 6563 7469 6f6e  tementInspection
-00020fb0: 202a 2f0a 2020 2020 2020 2020 2020 2020   */.            
-00020fc0: 6361 7365 2027 636f 6d6d 656e 7427 3a0a  case 'comment':.
-00020fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fe0: 2470 6174 7465 726e 203d 2027 5c28 5c29  $pattern = '\(\)
-00020ff0: 2227 3b0a 2020 2020 2020 2020 2020 2020  "';.            
-00021000: 2f2a 2049 6e74 656e 7469 6f6e 616c 2066  /* Intentional f
-00021010: 616c 6c20 7468 726f 7567 6820 2a2f 0a20  all through */. 
-00021020: 2020 2020 2020 2020 2020 2063 6173 6520             case 
-00021030: 2774 6578 7427 3a0a 2020 2020 2020 2020  'text':.        
-00021040: 2020 2020 6465 6661 756c 743a 0a20 2020      default:.   
-00021050: 2020 2020 2020 2020 2020 2020 202f 2f52               //R
-00021060: 4643 2032 3034 3720 7365 6374 696f 6e20  FC 2047 section 
-00021070: 352e 310a 2020 2020 2020 2020 2020 2020  5.1.            
-00021080: 2020 2020 2f2f 5265 706c 6163 6520 6576      //Replace ev
-00021090: 6572 7920 6869 6768 2061 7363 6969 2c20  ery high ascii, 
-000210a0: 636f 6e74 726f 6c2c 203d 2c20 3f20 616e  control, =, ? an
-000210b0: 6420 5f20 6368 6172 6163 7465 7273 0a20  d _ characters. 
-000210c0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-000210d0: 7061 7474 6572 6e20 3d20 275c 3030 302d  pattern = '\000-
-000210e0: 5c30 3131 5c30 3133 5c30 3134 5c30 3136  \011\013\014\016
-000210f0: 2d5c 3033 375c 3037 355c 3037 375c 3133  -\037\075\077\13
-00021100: 375c 3137 372d 5c33 3737 2720 2e20 2470  7\177-\377' . $p
-00021110: 6174 7465 726e 3b0a 2020 2020 2020 2020  attern;.        
-00021120: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
-00021130: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00021140: 2024 6d61 7463 6865 7320 3d20 5b5d 3b0a   $matches = [];.
-00021150: 2020 2020 2020 2020 6966 2028 7072 6567          if (preg
-00021160: 5f6d 6174 6368 5f61 6c6c 2822 2f5b 7b24  _match_all("/[{$
-00021170: 7061 7474 6572 6e7d 5d2f 222c 2024 656e  pattern}]/", $en
-00021180: 636f 6465 642c 2024 6d61 7463 6865 7329  coded, $matches)
-00021190: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-000211a0: 2f2f 4966 2074 6865 2073 7472 696e 6720  //If the string 
-000211b0: 636f 6e74 6169 6e73 2061 6e20 273d 272c  contains an '=',
-000211c0: 206d 616b 6520 7375 7265 2069 7427 7320   make sure it's 
-000211d0: 7468 6520 6669 7273 7420 7468 696e 6720  the first thing 
-000211e0: 7765 2072 6570 6c61 6365 0a20 2020 2020  we replace.     
-000211f0: 2020 2020 2020 202f 2f73 6f20 6173 2074         //so as t
-00021200: 6f20 6176 6f69 6420 646f 7562 6c65 2d65  o avoid double-e
-00021210: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
-00021220: 2020 2020 2465 716b 6579 203d 2061 7272      $eqkey = arr
-00021230: 6179 5f73 6561 7263 6828 273d 272c 2024  ay_search('=', $
-00021240: 6d61 7463 6865 735b 305d 2c20 7472 7565  matches[0], true
-00021250: 293b 0a20 2020 2020 2020 2020 2020 2069  );.            i
-00021260: 6620 2866 616c 7365 2021 3d3d 2024 6571  f (false !== $eq
-00021270: 6b65 7929 207b 0a20 2020 2020 2020 2020  key) {.         
-00021280: 2020 2020 2020 2075 6e73 6574 2824 6d61         unset($ma
-00021290: 7463 6865 735b 305d 5b24 6571 6b65 795d  tches[0][$eqkey]
-000212a0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-000212b0: 2020 2061 7272 6179 5f75 6e73 6869 6674     array_unshift
-000212c0: 2824 6d61 7463 6865 735b 305d 2c20 273d  ($matches[0], '=
-000212d0: 2729 3b0a 2020 2020 2020 2020 2020 2020  ');.            
-000212e0: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-000212f0: 7265 6163 6820 2861 7272 6179 5f75 6e69  reach (array_uni
-00021300: 7175 6528 246d 6174 6368 6573 5b30 5d29  que($matches[0])
-00021310: 2061 7320 2463 6861 7229 207b 0a20 2020   as $char) {.   
-00021320: 2020 2020 2020 2020 2020 2020 2024 656e               $en
-00021330: 636f 6465 6420 3d20 7374 725f 7265 706c  coded = str_repl
-00021340: 6163 6528 2463 6861 722c 2027 3d27 202e  ace($char, '=' .
-00021350: 2073 7072 696e 7466 2827 2530 3258 272c   sprintf('%02X',
-00021360: 206f 7264 2824 6368 6172 2929 2c20 2465   ord($char)), $e
-00021370: 6e63 6f64 6564 293b 0a20 2020 2020 2020  ncoded);.       
-00021380: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
-00021390: 0a20 2020 2020 2020 202f 2f52 6570 6c61  .        //Repla
-000213a0: 6365 2073 7061 6365 7320 7769 7468 205f  ce spaces with _
-000213b0: 2028 6d6f 7265 2072 6561 6461 626c 6520   (more readable 
-000213c0: 7468 616e 203d 3230 290a 2020 2020 2020  than =20).      
-000213d0: 2020 2f2f 5246 4320 3230 3437 2073 6563    //RFC 2047 sec
-000213e0: 7469 6f6e 2034 2e32 2832 290a 2020 2020  tion 4.2(2).    
-000213f0: 2020 2020 7265 7475 726e 2073 7472 5f72      return str_r
-00021400: 6570 6c61 6365 2827 2027 2c20 275f 272c  eplace(' ', '_',
-00021410: 2024 656e 636f 6465 6429 3b0a 2020 2020   $encoded);.    
-00021420: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-00021430: 2a20 4164 6420 6120 7374 7269 6e67 206f  * Add a string o
-00021440: 7220 6269 6e61 7279 2061 7474 6163 686d  r binary attachm
-00021450: 656e 7420 286e 6f6e 2d66 696c 6573 7973  ent (non-filesys
-00021460: 7465 6d29 2e0a 2020 2020 202a 2054 6869  tem)..     * Thi
-00021470: 7320 6d65 7468 6f64 2063 616e 2062 6520  s method can be 
-00021480: 7573 6564 2074 6f20 6174 7461 6368 2061  used to attach a
-00021490: 7363 6969 206f 7220 6269 6e61 7279 2064  scii or binary d
-000214a0: 6174 612c 0a20 2020 2020 2a20 7375 6368  ata,.     * such
-000214b0: 2061 7320 6120 424c 4f42 2072 6563 6f72   as a BLOB recor
-000214c0: 6420 6672 6f6d 2061 2064 6174 6162 6173  d from a databas
-000214d0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-000214e0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-000214f0: 7374 7269 6e67 2020 2020 2020 5374 7269  string      Stri
-00021500: 6e67 2061 7474 6163 686d 656e 7420 6461  ng attachment da
-00021510: 7461 0a20 2020 2020 2a20 4070 6172 616d  ta.     * @param
-00021520: 2073 7472 696e 6720 2466 696c 656e 616d   string $filenam
-00021530: 6520 2020 204e 616d 6520 6f66 2074 6865  e    Name of the
-00021540: 2061 7474 6163 686d 656e 740a 2020 2020   attachment.    
-00021550: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
-00021560: 2024 656e 636f 6469 6e67 2020 2020 4669   $encoding    Fi
-00021570: 6c65 2065 6e63 6f64 696e 6720 2873 6565  le encoding (see
-00021580: 2024 456e 636f 6469 6e67 290a 2020 2020   $Encoding).    
-00021590: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
-000215a0: 2024 7479 7065 2020 2020 2020 2020 4669   $type        Fi
-000215b0: 6c65 2065 7874 656e 7369 6f6e 2028 4d49  le extension (MI
-000215c0: 4d45 2920 7479 7065 0a20 2020 2020 2a20  ME) type.     * 
-000215d0: 4070 6172 616d 2073 7472 696e 6720 2464  @param string $d
-000215e0: 6973 706f 7369 7469 6f6e 2044 6973 706f  isposition Dispo
-000215f0: 7369 7469 6f6e 2074 6f20 7573 650a 2020  sition to use.  
-00021600: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
-00021610: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
-00021620: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00021630: 7572 6e20 626f 6f6c 2054 7275 6520 6f6e  urn bool True on
-00021640: 2073 7563 6365 7373 6675 6c6c 7920 6164   successfully ad
-00021650: 6469 6e67 2061 6e20 6174 7461 6368 6d65  ding an attachme
-00021660: 6e74 0a20 2020 2020 2a2f 0a20 2020 2070  nt.     */.    p
-00021670: 7562 6c69 6320 6675 6e63 7469 6f6e 2061  ublic function a
-00021680: 6464 5374 7269 6e67 4174 7461 6368 6d65  ddStringAttachme
-00021690: 6e74 280a 2020 2020 2020 2020 2473 7472  nt(.        $str
-000216a0: 696e 672c 0a20 2020 2020 2020 2024 6669  ing,.        $fi
-000216b0: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-000216c0: 2465 6e63 6f64 696e 6720 3d20 7365 6c66  $encoding = self
-000216d0: 3a3a 454e 434f 4449 4e47 5f42 4153 4536  ::ENCODING_BASE6
-000216e0: 342c 0a20 2020 2020 2020 2024 7479 7065  4,.        $type
-000216f0: 203d 2027 272c 0a20 2020 2020 2020 2024   = '',.        $
-00021700: 6469 7370 6f73 6974 696f 6e20 3d20 2761  disposition = 'a
-00021710: 7474 6163 686d 656e 7427 0a20 2020 2029  ttachment'.    )
-00021720: 207b 0a20 2020 2020 2020 2074 7279 207b   {.        try {
-00021730: 0a20 2020 2020 2020 2020 2020 202f 2f49  .            //I
-00021740: 6620 6120 4d49 4d45 2074 7970 6520 6973  f a MIME type is
-00021750: 206e 6f74 2073 7065 6369 6669 6564 2c20   not specified, 
-00021760: 7472 7920 746f 2077 6f72 6b20 6974 206f  try to work it o
-00021770: 7574 2066 726f 6d20 7468 6520 6669 6c65  ut from the file
-00021780: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
-00021790: 2020 6966 2028 2727 203d 3d3d 2024 7479    if ('' === $ty
-000217a0: 7065 2920 7b0a 2020 2020 2020 2020 2020  pe) {.          
-000217b0: 2020 2020 2020 2474 7970 6520 3d20 7374        $type = st
-000217c0: 6174 6963 3a3a 6669 6c65 6e61 6d65 546f  atic::filenameTo
-000217d0: 5479 7065 2824 6669 6c65 6e61 6d65 293b  Type($filename);
-000217e0: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-000217f0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00021800: 2124 7468 6973 2d3e 7661 6c69 6461 7465  !$this->validate
-00021810: 456e 636f 6469 6e67 2824 656e 636f 6469  Encoding($encodi
-00021820: 6e67 2929 207b 0a20 2020 2020 2020 2020  ng)) {.         
-00021830: 2020 2020 2020 2074 6872 6f77 206e 6577         throw new
-00021840: 2045 7863 6570 7469 6f6e 2824 7468 6973   Exception($this
-00021850: 2d3e 6c61 6e67 2827 656e 636f 6469 6e67  ->lang('encoding
-00021860: 2729 202e 2024 656e 636f 6469 6e67 293b  ') . $encoding);
-00021870: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-00021880: 2020 2020 2020 2020 2020 2020 2f2f 4170              //Ap
-00021890: 7065 6e64 2074 6f20 2461 7474 6163 686d  pend to $attachm
-000218a0: 656e 7420 6172 7261 790a 2020 2020 2020  ent array.      
-000218b0: 2020 2020 2020 2474 6869 732d 3e61 7474        $this->att
-000218c0: 6163 686d 656e 745b 5d20 3d20 5b0a 2020  achment[] = [.  
-000218d0: 2020 2020 2020 2020 2020 2020 2020 3020                0 
-000218e0: 3d3e 2024 7374 7269 6e67 2c0a 2020 2020  => $string,.    
-000218f0: 2020 2020 2020 2020 2020 2020 3120 3d3e              1 =>
-00021900: 2024 6669 6c65 6e61 6d65 2c0a 2020 2020   $filename,.    
-00021910: 2020 2020 2020 2020 2020 2020 3220 3d3e              2 =>
-00021920: 2073 7461 7469 633a 3a6d 625f 7061 7468   static::mb_path
-00021930: 696e 666f 2824 6669 6c65 6e61 6d65 2c20  info($filename, 
-00021940: 5041 5448 494e 464f 5f42 4153 454e 414d  PATHINFO_BASENAM
-00021950: 4529 2c0a 2020 2020 2020 2020 2020 2020  E),.            
-00021960: 2020 2020 3320 3d3e 2024 656e 636f 6469      3 => $encodi
-00021970: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-00021980: 2020 2020 3420 3d3e 2024 7479 7065 2c0a      4 => $type,.
-00021990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219a0: 3520 3d3e 2074 7275 652c 202f 2f69 7353  5 => true, //isS
-000219b0: 7472 696e 6741 7474 6163 686d 656e 740a  tringAttachment.
-000219c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219d0: 3620 3d3e 2024 6469 7370 6f73 6974 696f  6 => $dispositio
-000219e0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-000219f0: 2020 2037 203d 3e20 302c 0a20 2020 2020     7 => 0,.     
-00021a00: 2020 2020 2020 205d 3b0a 2020 2020 2020         ];.      
-00021a10: 2020 7d20 6361 7463 6820 2845 7863 6570    } catch (Excep
-00021a20: 7469 6f6e 2024 6578 6329 207b 0a20 2020  tion $exc) {.   
-00021a30: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-00021a40: 7365 7445 7272 6f72 2824 6578 632d 3e67  setError($exc->g
-00021a50: 6574 4d65 7373 6167 6528 2929 3b0a 2020  etMessage());.  
-00021a60: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-00021a70: 3e65 6465 6275 6728 2465 7863 2d3e 6765  >edebug($exc->ge
-00021a80: 744d 6573 7361 6765 2829 293b 0a20 2020  tMessage());.   
-00021a90: 2020 2020 2020 2020 2069 6620 2824 7468           if ($th
-00021aa0: 6973 2d3e 6578 6365 7074 696f 6e73 2920  is->exceptions) 
-00021ab0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00021ac0: 2020 7468 726f 7720 2465 7863 3b0a 2020    throw $exc;.  
-00021ad0: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
-00021ae0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00021af0: 6661 6c73 653b 0a20 2020 2020 2020 207d  false;.        }
-00021b00: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00021b10: 2074 7275 653b 0a20 2020 207d 0a0a 2020   true;.    }..  
-00021b20: 2020 2f2a 2a0a 2020 2020 202a 2041 6464    /**.     * Add
-00021b30: 2061 6e20 656d 6265 6464 6564 2028 696e   an embedded (in
-00021b40: 6c69 6e65 2920 6174 7461 6368 6d65 6e74  line) attachment
-00021b50: 2066 726f 6d20 6120 6669 6c65 2e0a 2020   from a file..  
-00021b60: 2020 202a 2054 6869 7320 6361 6e20 696e     * This can in
-00021b70: 636c 7564 6520 696d 6167 6573 2c20 736f  clude images, so
-00021b80: 756e 6473 2c20 616e 6420 6a75 7374 2061  unds, and just a
-00021b90: 626f 7574 2061 6e79 206f 7468 6572 2064  bout any other d
-00021ba0: 6f63 756d 656e 7420 7479 7065 2e0a 2020  ocument type..  
-00021bb0: 2020 202a 2054 6865 7365 2064 6966 6665     * These diffe
-00021bc0: 7220 6672 6f6d 2027 7265 6775 6c61 7227  r from 'regular'
-00021bd0: 2061 7474 6163 686d 656e 7473 2069 6e20   attachments in 
-00021be0: 7468 6174 2074 6865 7920 6172 6520 696e  that they are in
-00021bf0: 7465 6e64 6564 2074 6f20 6265 0a20 2020  tended to be.   
-00021c00: 2020 2a20 6469 7370 6c61 7965 6420 696e    * displayed in
-00021c10: 6c69 6e65 2077 6974 6820 7468 6520 6d65  line with the me
-00021c20: 7373 6167 652c 206e 6f74 206a 7573 7420  ssage, not just 
-00021c30: 6174 7461 6368 6564 2066 6f72 2064 6f77  attached for dow
-00021c40: 6e6c 6f61 642e 0a20 2020 2020 2a20 5468  nload..     * Th
-00021c50: 6973 2069 7320 7573 6564 2069 6e20 4854  is is used in HT
-00021c60: 4d4c 206d 6573 7361 6765 7320 7468 6174  ML messages that
-00021c70: 2065 6d62 6564 2074 6865 2069 6d61 6765   embed the image
-00021c80: 730a 2020 2020 202a 2074 6865 2048 544d  s.     * the HTM
-00021c90: 4c20 7265 6665 7273 2074 6f20 7573 696e  L refers to usin
-00021ca0: 6720 7468 6520 6024 6369 6460 2076 616c  g the `$cid` val
-00021cb0: 7565 2069 6e20 6069 6d67 6020 7461 6773  ue in `img` tags
-00021cc0: 2c20 666f 7220 6578 616d 706c 6520 603c  , for example `<
-00021cd0: 696d 6720 7372 633d 2263 6964 3a6d 796c  img src="cid:myl
-00021ce0: 6f67 6f22 3e60 2e0a 2020 2020 202a 204e  ogo">`..     * N
-00021cf0: 6576 6572 2075 7365 2061 2075 7365 722d  ever use a user-
-00021d00: 7375 7070 6c69 6564 2070 6174 6820 746f  supplied path to
-00021d10: 2061 2066 696c 6521 0a20 2020 2020 2a0a   a file!.     *.
-00021d20: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-00021d30: 7269 6e67 2024 7061 7468 2020 2020 2020  ring $path      
-00021d40: 2020 5061 7468 2074 6f20 7468 6520 6174    Path to the at
-00021d50: 7461 6368 6d65 6e74 0a20 2020 2020 2a20  tachment.     * 
-00021d60: 4070 6172 616d 2073 7472 696e 6720 2463  @param string $c
-00021d70: 6964 2020 2020 2020 2020 2043 6f6e 7465  id         Conte
-00021d80: 6e74 2049 4420 6f66 2074 6865 2061 7474  nt ID of the att
-00021d90: 6163 686d 656e 743b 2055 7365 2074 6869  achment; Use thi
-00021da0: 7320 746f 2072 6566 6572 656e 6365 0a20  s to reference. 
-00021db0: 2020 2020 2a20 2020 2020 2020 2020 2020      *           
-00021dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021dd0: 2074 6865 2063 6f6e 7465 6e74 2077 6865   the content whe
-00021de0: 6e20 7573 696e 6720 616e 2065 6d62 6564  n using an embed
-00021df0: 6465 6420 696d 6167 6520 696e 2048 544d  ded image in HTM
-00021e00: 4c0a 2020 2020 202a 2040 7061 7261 6d20  L.     * @param 
-00021e10: 7374 7269 6e67 2024 6e61 6d65 2020 2020  string $name    
-00021e20: 2020 2020 4f76 6572 7269 6465 7320 7468      Overrides th
-00021e30: 6520 6174 7461 6368 6d65 6e74 2066 696c  e attachment fil
-00021e40: 656e 616d 650a 2020 2020 202a 2040 7061  ename.     * @pa
-00021e50: 7261 6d20 7374 7269 6e67 2024 656e 636f  ram string $enco
-00021e60: 6469 6e67 2020 2020 4669 6c65 2065 6e63  ding    File enc
-00021e70: 6f64 696e 6720 2873 6565 2024 456e 636f  oding (see $Enco
-00021e80: 6469 6e67 2920 6465 6661 756c 7473 2074  ding) defaults t
-00021e90: 6f20 6062 6173 6536 3460 0a20 2020 2020  o `base64`.     
-00021ea0: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
-00021eb0: 2474 7970 6520 2020 2020 2020 2046 696c  $type        Fil
-00021ec0: 6520 4d49 4d45 2074 7970 6520 2862 7920  e MIME type (by 
-00021ed0: 6465 6661 756c 7420 6d61 7070 6564 2066  default mapped f
-00021ee0: 726f 6d20 7468 6520 6024 7061 7468 6020  rom the `$path` 
-00021ef0: 6669 6c65 6e61 6d65 2773 2065 7874 656e  filename's exten
-00021f00: 7369 6f6e 290a 2020 2020 202a 2040 7061  sion).     * @pa
-00021f10: 7261 6d20 7374 7269 6e67 2024 6469 7370  ram string $disp
-00021f20: 6f73 6974 696f 6e20 4469 7370 6f73 6974  osition Disposit
-00021f30: 696f 6e20 746f 2075 7365 3a20 6069 6e6c  ion to use: `inl
-00021f40: 696e 6560 2028 6465 6661 756c 7429 206f  ine` (default) o
-00021f50: 7220 6061 7474 6163 686d 656e 7460 0a20  r `attachment`. 
-00021f60: 2020 2020 2a20 2020 2020 2020 2020 2020      *           
-00021f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f80: 2028 756e 6c69 6b65 6c79 2079 6f75 2077   (unlikely you w
-00021f90: 616e 7420 7468 6973 20e2 8093 207b 4073  ant this ... {@s
-00021fa0: 6565 2060 6164 6441 7474 6163 686d 656e  ee `addAttachmen
-00021fb0: 7428 2960 7d20 696e 7374 6561 6429 0a20  t()`} instead). 
-00021fc0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-00021fd0: 7475 726e 2062 6f6f 6c20 5472 7565 206f  turn bool True o
-00021fe0: 6e20 7375 6363 6573 7366 756c 6c79 2061  n successfully a
-00021ff0: 6464 696e 6720 616e 2061 7474 6163 686d  dding an attachm
-00022000: 656e 740a 2020 2020 202a 2040 7468 726f  ent.     * @thro
-00022010: 7773 2045 7863 6570 7469 6f6e 0a20 2020  ws Exception.   
-00022020: 2020 2a0a 2020 2020 202a 2f0a 2020 2020    *.     */.    
-00022030: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
-00022040: 6164 6445 6d62 6564 6465 6449 6d61 6765  addEmbeddedImage
-00022050: 280a 2020 2020 2020 2020 2470 6174 682c  (.        $path,
-00022060: 0a20 2020 2020 2020 2024 6369 642c 0a20  .        $cid,. 
-00022070: 2020 2020 2020 2024 6e61 6d65 203d 2027         $name = '
-00022080: 272c 0a20 2020 2020 2020 2024 656e 636f  ',.        $enco
-00022090: 6469 6e67 203d 2073 656c 663a 3a45 4e43  ding = self::ENC
-000220a0: 4f44 494e 475f 4241 5345 3634 2c0a 2020  ODING_BASE64,.  
-000220b0: 2020 2020 2020 2474 7970 6520 3d20 2727        $type = ''
-000220c0: 2c0a 2020 2020 2020 2020 2464 6973 706f  ,.        $dispo
-000220d0: 7369 7469 6f6e 203d 2027 696e 6c69 6e65  sition = 'inline
-000220e0: 270a 2020 2020 2920 7b0a 2020 2020 2020  '.    ) {.      
-000220f0: 2020 7472 7920 7b0a 2020 2020 2020 2020    try {.        
-00022100: 2020 2020 6966 2028 2173 7461 7469 633a      if (!static:
-00022110: 3a66 696c 6549 7341 6363 6573 7369 626c  :fileIsAccessibl
-00022120: 6528 2470 6174 6829 2920 7b0a 2020 2020  e($path)) {.    
-00022130: 2020 2020 2020 2020 2020 2020 7468 726f              thro
-00022140: 7720 6e65 7720 4578 6365 7074 696f 6e28  w new Exception(
-00022150: 2474 6869 732d 3e6c 616e 6728 2766 696c  $this->lang('fil
-00022160: 655f 6163 6365 7373 2729 202e 2024 7061  e_access') . $pa
-00022170: 7468 2c20 7365 6c66 3a3a 5354 4f50 5f43  th, self::STOP_C
-00022180: 4f4e 5449 4e55 4529 3b0a 2020 2020 2020  ONTINUE);.      
-00022190: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-000221a0: 2020 2020 202f 2f49 6620 6120 4d49 4d45       //If a MIME
-000221b0: 2074 7970 6520 6973 206e 6f74 2073 7065   type is not spe
-000221c0: 6369 6669 6564 2c20 7472 7920 746f 2077  cified, try to w
-000221d0: 6f72 6b20 6974 206f 7574 2066 726f 6d20  ork it out from 
-000221e0: 7468 6520 6669 6c65 206e 616d 650a 2020  the file name.  
-000221f0: 2020 2020 2020 2020 2020 6966 2028 2727            if (''
-00022200: 203d 3d3d 2024 7479 7065 2920 7b0a 2020   === $type) {.  
-00022210: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-00022220: 7970 6520 3d20 7374 6174 6963 3a3a 6669  ype = static::fi
-00022230: 6c65 6e61 6d65 546f 5479 7065 2824 7061  lenameToType($pa
-00022240: 7468 293b 0a20 2020 2020 2020 2020 2020  th);.           
-00022250: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-00022260: 6966 2028 2124 7468 6973 2d3e 7661 6c69  if (!$this->vali
-00022270: 6461 7465 456e 636f 6469 6e67 2824 656e  dateEncoding($en
-00022280: 636f 6469 6e67 2929 207b 0a20 2020 2020  coding)) {.     
-00022290: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
-000222a0: 206e 6577 2045 7863 6570 7469 6f6e 2824   new Exception($
-000222b0: 7468 6973 2d3e 6c61 6e67 2827 656e 636f  this->lang('enco
-000222c0: 6469 6e67 2729 202e 2024 656e 636f 6469  ding') . $encodi
-000222d0: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
-000222e0: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-000222f0: 2466 696c 656e 616d 6520 3d20 2873 7472  $filename = (str
-00022300: 696e 6729 2073 7461 7469 633a 3a6d 625f  ing) static::mb_
-00022310: 7061 7468 696e 666f 2824 7061 7468 2c20  pathinfo($path, 
-00022320: 5041 5448 494e 464f 5f42 4153 454e 414d  PATHINFO_BASENAM
-00022330: 4529 3b0a 2020 2020 2020 2020 2020 2020  E);.            
-00022340: 6966 2028 2727 203d 3d3d 2024 6e61 6d65  if ('' === $name
-00022350: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00022360: 2020 2020 246e 616d 6520 3d20 2466 696c      $name = $fil
-00022370: 656e 616d 653b 0a20 2020 2020 2020 2020  ename;.         
-00022380: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-00022390: 2020 2f2f 4170 7065 6e64 2074 6f20 2461    //Append to $a
-000223a0: 7474 6163 686d 656e 7420 6172 7261 790a  ttachment array.
-000223b0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-000223c0: 732d 3e61 7474 6163 686d 656e 745b 5d20  s->attachment[] 
-000223d0: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-000223e0: 2020 2020 3020 3d3e 2024 7061 7468 2c0a      0 => $path,.
-000223f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022400: 3120 3d3e 2024 6669 6c65 6e61 6d65 2c0a  1 => $filename,.
-00022410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022420: 3220 3d3e 2024 6e61 6d65 2c0a 2020 2020  2 => $name,.    
-00022430: 2020 2020 2020 2020 2020 2020 3320 3d3e              3 =>
-00022440: 2024 656e 636f 6469 6e67 2c0a 2020 2020   $encoding,.    
-00022450: 2020 2020 2020 2020 2020 2020 3420 3d3e              4 =>
-00022460: 2024 7479 7065 2c0a 2020 2020 2020 2020   $type,.        
-00022470: 2020 2020 2020 2020 3520 3d3e 2066 616c          5 => fal
-00022480: 7365 2c20 2f2f 6973 5374 7269 6e67 4174  se, //isStringAt
-00022490: 7461 6368 6d65 6e74 0a20 2020 2020 2020  tachment.       
-000224a0: 2020 2020 2020 2020 2036 203d 3e20 2464           6 => $d
-000224b0: 6973 706f 7369 7469 6f6e 2c0a 2020 2020  isposition,.    
-000224c0: 2020 2020 2020 2020 2020 2020 3720 3d3e              7 =>
-000224d0: 2024 6369 642c 0a20 2020 2020 2020 2020   $cid,.         
-000224e0: 2020 205d 3b0a 2020 2020 2020 2020 7d20     ];.        } 
-000224f0: 6361 7463 6820 2845 7863 6570 7469 6f6e  catch (Exception
-00022500: 2024 6578 6329 207b 0a20 2020 2020 2020   $exc) {.       
-00022510: 2020 2020 2024 7468 6973 2d3e 7365 7445       $this->setE
-00022520: 7272 6f72 2824 6578 632d 3e67 6574 4d65  rror($exc->getMe
-00022530: 7373 6167 6528 2929 3b0a 2020 2020 2020  ssage());.      
-00022540: 2020 2020 2020 2474 6869 732d 3e65 6465        $this->ede
-00022550: 6275 6728 2465 7863 2d3e 6765 744d 6573  bug($exc->getMes
-00022560: 7361 6765 2829 293b 0a20 2020 2020 2020  sage());.       
-00022570: 2020 2020 2069 6620 2824 7468 6973 2d3e       if ($this->
-00022580: 6578 6365 7074 696f 6e73 2920 7b0a 2020  exceptions) {.  
-00022590: 2020 2020 2020 2020 2020 2020 2020 7468                th
-000225a0: 726f 7720 2465 7863 3b0a 2020 2020 2020  row $exc;.      
-000225b0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-000225c0: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
-000225d0: 653b 0a20 2020 2020 2020 207d 0a0a 2020  e;.        }..  
-000225e0: 2020 2020 2020 7265 7475 726e 2074 7275        return tru
-000225f0: 653b 0a20 2020 207d 0a0a 2020 2020 2f2a  e;.    }..    /*
-00022600: 2a0a 2020 2020 202a 2041 6464 2061 6e20  *.     * Add an 
-00022610: 656d 6265 6464 6564 2073 7472 696e 6769  embedded stringi
-00022620: 6669 6564 2061 7474 6163 686d 656e 742e  fied attachment.
-00022630: 0a20 2020 2020 2a20 5468 6973 2063 616e  .     * This can
-00022640: 2069 6e63 6c75 6465 2069 6d61 6765 732c   include images,
-00022650: 2073 6f75 6e64 732c 2061 6e64 206a 7573   sounds, and jus
-00022660: 7420 6162 6f75 7420 616e 7920 6f74 6865  t about any othe
-00022670: 7220 646f 6375 6d65 6e74 2074 7970 652e  r document type.
-00022680: 0a20 2020 2020 2a20 4966 2079 6f75 7220  .     * If your 
-00022690: 6669 6c65 6e61 6d65 2064 6f65 736e 2774  filename doesn't
-000226a0: 2063 6f6e 7461 696e 2061 6e20 6578 7465   contain an exte
-000226b0: 6e73 696f 6e2c 2062 6520 7375 7265 2074  nsion, be sure t
-000226c0: 6f20 7365 7420 7468 6520 2474 7970 6520  o set the $type 
-000226d0: 746f 2061 6e20 6170 7072 6f70 7269 6174  to an appropriat
-000226e0: 6520 4d49 4d45 2074 7970 652e 0a20 2020  e MIME type..   
-000226f0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-00022700: 6d20 7374 7269 6e67 2024 7374 7269 6e67  m string $string
-00022710: 2020 2020 2020 5468 6520 6174 7461 6368        The attach
-00022720: 6d65 6e74 2062 696e 6172 7920 6461 7461  ment binary data
-00022730: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00022740: 7472 696e 6720 2463 6964 2020 2020 2020  tring $cid      
-00022750: 2020 2043 6f6e 7465 6e74 2049 4420 6f66     Content ID of
-00022760: 2074 6865 2061 7474 6163 686d 656e 743b   the attachment;
-00022770: 2055 7365 2074 6869 7320 746f 2072 6566   Use this to ref
-00022780: 6572 656e 6365 0a20 2020 2020 2a20 2020  erence.     *   
-00022790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227a0: 2020 2020 2020 2020 2074 6865 2063 6f6e           the con
-000227b0: 7465 6e74 2077 6865 6e20 7573 696e 6720  tent when using 
-000227c0: 616e 2065 6d62 6564 6465 6420 696d 6167  an embedded imag
-000227d0: 6520 696e 2048 544d 4c0a 2020 2020 202a  e in HTML.     *
-000227e0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-000227f0: 6e61 6d65 2020 2020 2020 2020 4120 6669  name        A fi
-00022800: 6c65 6e61 6d65 2066 6f72 2074 6865 2061  lename for the a
-00022810: 7474 6163 686d 656e 742e 2049 6620 7468  ttachment. If th
-00022820: 6973 2063 6f6e 7461 696e 7320 616e 2065  is contains an e
-00022830: 7874 656e 7369 6f6e 2c0a 2020 2020 202a  xtension,.     *
-00022840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022850: 2020 2020 2020 2020 2020 2020 5048 504d              PHPM
-00022860: 6169 6c65 7220 7769 6c6c 2061 7474 656d  ailer will attem
-00022870: 7074 2074 6f20 7365 7420 6120 4d49 4d45  pt to set a MIME
-00022880: 2074 7970 6520 666f 7220 7468 6520 6174   type for the at
-00022890: 7461 6368 6d65 6e74 2e0a 2020 2020 202a  tachment..     *
+0001e600: 2463 6964 556e 6971 5b24 6369 645d 203d  $cidUniq[$cid] =
+0001e610: 2074 7275 653b 0a0a 2020 2020 2020 2020   true;..        
+0001e620: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
+0001e630: 3d20 7370 7269 6e74 6628 272d 2d25 7325  = sprintf('--%s%
+0001e640: 7327 2c20 2462 6f75 6e64 6172 792c 2073  s', $boundary, s
+0001e650: 7461 7469 633a 3a24 4c45 293b 0a20 2020  tatic::$LE);.   
+0001e660: 2020 2020 2020 2020 2020 2020 202f 2f4f               //O
+0001e670: 6e6c 7920 696e 636c 7564 6520 6120 6669  nly include a fi
+0001e680: 6c65 6e61 6d65 2070 726f 7065 7274 7920  lename property 
+0001e690: 6966 2077 6520 6861 7665 206f 6e65 0a20  if we have one. 
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001e6b0: 6620 2821 656d 7074 7928 246e 616d 6529  f (!empty($name)
+0001e6c0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001e6d0: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
+0001e6e0: 3d20 7370 7269 6e74 6628 0a20 2020 2020  = sprintf(.     
+0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e700: 2020 2027 436f 6e74 656e 742d 5479 7065     'Content-Type
+0001e710: 3a20 2573 3b20 6e61 6d65 3d25 7325 7327  : %s; name=%s%s'
+0001e720: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e730: 2020 2020 2020 2020 2020 2474 7970 652c            $type,
+0001e740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e750: 2020 2020 2020 2020 2073 7461 7469 633a           static:
+0001e760: 3a71 756f 7465 6453 7472 696e 6728 2474  :quotedString($t
+0001e770: 6869 732d 3e65 6e63 6f64 6548 6561 6465  his->encodeHeade
+0001e780: 7228 2474 6869 732d 3e73 6563 7572 6548  r($this->secureH
+0001e790: 6561 6465 7228 246e 616d 6529 2929 2c0a  eader($name))),.
+0001e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7b0: 2020 2020 2020 2020 7374 6174 6963 3a3a          static::
+0001e7c0: 244c 450a 2020 2020 2020 2020 2020 2020  $LE.            
+0001e7d0: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
+0001e7e0: 2020 2020 2020 2020 2020 207d 2065 6c73             } els
+0001e7f0: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+0001e800: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
+0001e810: 3d20 7370 7269 6e74 6628 0a20 2020 2020  = sprintf(.     
+0001e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e830: 2020 2027 436f 6e74 656e 742d 5479 7065     'Content-Type
+0001e840: 3a20 2573 2573 272c 0a20 2020 2020 2020  : %s%s',.       
+0001e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e860: 2024 7479 7065 2c0a 2020 2020 2020 2020   $type,.        
+0001e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e880: 7374 6174 6963 3a3a 244c 450a 2020 2020  static::$LE.    
+0001e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8a0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001e8b0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+0001e8c0: 2020 2020 202f 2f52 4643 3133 3431 2070       //RFC1341 p
+0001e8d0: 6172 7420 3520 7361 7973 2037 6269 7420  art 5 says 7bit 
+0001e8e0: 6973 2061 7373 756d 6564 2069 6620 6e6f  is assumed if no
+0001e8f0: 7420 7370 6563 6966 6965 640a 2020 2020  t specified.    
+0001e900: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001e910: 7374 6174 6963 3a3a 454e 434f 4449 4e47  static::ENCODING
+0001e920: 5f37 4249 5420 213d 3d20 2465 6e63 6f64  _7BIT !== $encod
+0001e930: 696e 6729 207b 0a20 2020 2020 2020 2020  ing) {.         
+0001e940: 2020 2020 2020 2020 2020 2024 6d69 6d65             $mime
+0001e950: 5b5d 203d 2073 7072 696e 7466 2827 436f  [] = sprintf('Co
+0001e960: 6e74 656e 742d 5472 616e 7366 6572 2d45  ntent-Transfer-E
+0001e970: 6e63 6f64 696e 673a 2025 7325 7327 2c20  ncoding: %s%s', 
+0001e980: 2465 6e63 6f64 696e 672c 2073 7461 7469  $encoding, stati
+0001e990: 633a 3a24 4c45 293b 0a20 2020 2020 2020  c::$LE);.       
+0001e9a0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+0001e9b0: 2020 2020 2020 2020 2020 2020 2f2f 4f6e              //On
+0001e9c0: 6c79 2073 6574 2043 6f6e 7465 6e74 2d49  ly set Content-I
+0001e9d0: 4473 206f 6e20 696e 6c69 6e65 2061 7474  Ds on inline att
+0001e9e0: 6163 686d 656e 7473 0a20 2020 2020 2020  achments.       
+0001e9f0: 2020 2020 2020 2020 2069 6620 2828 7374           if ((st
+0001ea00: 7269 6e67 2920 2463 6964 2021 3d3d 2027  ring) $cid !== '
+0001ea10: 2720 2626 2024 6469 7370 6f73 6974 696f  ' && $dispositio
+0001ea20: 6e20 3d3d 3d20 2769 6e6c 696e 6527 2920  n === 'inline') 
+0001ea30: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001ea40: 2020 2020 2020 246d 696d 655b 5d20 3d20        $mime[] = 
+0001ea50: 2743 6f6e 7465 6e74 2d49 443a 203c 2720  'Content-ID: <' 
+0001ea60: 2e20 2474 6869 732d 3e65 6e63 6f64 6548  . $this->encodeH
+0001ea70: 6561 6465 7228 2474 6869 732d 3e73 6563  eader($this->sec
+0001ea80: 7572 6548 6561 6465 7228 2463 6964 2929  ureHeader($cid))
+0001ea90: 202e 2027 3e27 202e 2073 7461 7469 633a   . '>' . static:
+0001eaa0: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
+0001eab0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0001eac0: 2020 2020 2020 2020 202f 2f41 6c6c 6f77           //Allow
+0001ead0: 2066 6f72 2062 7970 6173 7369 6e67 2074   for bypassing t
+0001eae0: 6865 2043 6f6e 7465 6e74 2d44 6973 706f  he Content-Dispo
+0001eaf0: 7369 7469 6f6e 2068 6561 6465 720a 2020  sition header.  
+0001eb00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001eb10: 2028 2165 6d70 7479 2824 6469 7370 6f73   (!empty($dispos
+0001eb20: 6974 696f 6e29 2920 7b0a 2020 2020 2020  ition)) {.      
+0001eb30: 2020 2020 2020 2020 2020 2020 2020 2465                $e
+0001eb40: 6e63 6f64 6564 5f6e 616d 6520 3d20 2474  ncoded_name = $t
+0001eb50: 6869 732d 3e65 6e63 6f64 6548 6561 6465  his->encodeHeade
+0001eb60: 7228 2474 6869 732d 3e73 6563 7572 6548  r($this->secureH
+0001eb70: 6561 6465 7228 246e 616d 6529 293b 0a20  eader($name));. 
+0001eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb90: 2020 2069 6620 2821 656d 7074 7928 2465     if (!empty($e
+0001eba0: 6e63 6f64 6564 5f6e 616d 6529 2920 7b0a  ncoded_name)) {.
+0001ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebc0: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
+0001ebd0: 3d20 7370 7269 6e74 6628 0a20 2020 2020  = sprintf(.     
+0001ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebf0: 2020 2020 2020 2027 436f 6e74 656e 742d         'Content-
+0001ec00: 4469 7370 6f73 6974 696f 6e3a 2025 733b  Disposition: %s;
+0001ec10: 2066 696c 656e 616d 653d 2573 2573 272c   filename=%s%s',
+0001ec20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ec30: 2020 2020 2020 2020 2020 2020 2024 6469               $di
+0001ec40: 7370 6f73 6974 696f 6e2c 0a20 2020 2020  sposition,.     
+0001ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec60: 2020 2020 2020 2073 7461 7469 633a 3a71         static::q
+0001ec70: 756f 7465 6453 7472 696e 6728 2465 6e63  uotedString($enc
+0001ec80: 6f64 6564 5f6e 616d 6529 2c0a 2020 2020  oded_name),.    
+0001ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eca0: 2020 2020 2020 2020 7374 6174 6963 3a3a          static::
+0001ecb0: 244c 4520 2e20 7374 6174 6963 3a3a 244c  $LE . static::$L
+0001ecc0: 450a 2020 2020 2020 2020 2020 2020 2020  E.              
+0001ecd0: 2020 2020 2020 2020 2020 293b 0a20 2020            );.   
+0001ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecf0: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
+0001ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed10: 2020 246d 696d 655b 5d20 3d20 7370 7269    $mime[] = spri
+0001ed20: 6e74 6628 0a20 2020 2020 2020 2020 2020  ntf(.           
+0001ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed40: 2027 436f 6e74 656e 742d 4469 7370 6f73   'Content-Dispos
+0001ed50: 6974 696f 6e3a 2025 7325 7327 2c0a 2020  ition: %s%s',.  
+0001ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed70: 2020 2020 2020 2020 2020 2464 6973 706f            $dispo
+0001ed80: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
+0001ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eda0: 2020 2020 7374 6174 6963 3a3a 244c 4520      static::$LE 
+0001edb0: 2e20 7374 6174 6963 3a3a 244c 450a 2020  . static::$LE.  
+0001edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edd0: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
+0001ede0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0001edf0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0001ee00: 2065 6c73 6520 7b0a 2020 2020 2020 2020   else {.        
+0001ee10: 2020 2020 2020 2020 2020 2020 246d 696d              $mim
+0001ee20: 655b 5d20 3d20 7374 6174 6963 3a3a 244c  e[] = static::$L
+0001ee30: 453b 0a20 2020 2020 2020 2020 2020 2020  E;.             
+0001ee40: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
+0001ee50: 2020 2020 2020 2f2f 456e 636f 6465 2061        //Encode a
+0001ee60: 7320 7374 7269 6e67 2061 7474 6163 686d  s string attachm
+0001ee70: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+0001ee80: 2020 2020 6966 2028 2462 5374 7269 6e67      if ($bString
+0001ee90: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001eea0: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
+0001eeb0: 3d20 2474 6869 732d 3e65 6e63 6f64 6553  = $this->encodeS
+0001eec0: 7472 696e 6728 2473 7472 696e 672c 2024  tring($string, $
+0001eed0: 656e 636f 6469 6e67 293b 0a20 2020 2020  encoding);.     
+0001eee0: 2020 2020 2020 2020 2020 207d 2065 6c73             } els
+0001eef0: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+0001ef00: 2020 2020 2020 2020 246d 696d 655b 5d20          $mime[] 
+0001ef10: 3d20 2474 6869 732d 3e65 6e63 6f64 6546  = $this->encodeF
+0001ef20: 696c 6528 2470 6174 682c 2024 656e 636f  ile($path, $enco
+0001ef30: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
+0001ef40: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001ef50: 2020 2020 2020 2020 2069 6620 2824 7468           if ($th
+0001ef60: 6973 2d3e 6973 4572 726f 7228 2929 207b  is->isError()) {
+0001ef70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef80: 2020 2020 2072 6574 7572 6e20 2727 3b0a       return '';.
+0001ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efa0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0001efb0: 2020 246d 696d 655b 5d20 3d20 7374 6174    $mime[] = stat
+0001efc0: 6963 3a3a 244c 453b 0a20 2020 2020 2020  ic::$LE;.       
+0001efd0: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
+0001efe0: 0a0a 2020 2020 2020 2020 246d 696d 655b  ..        $mime[
+0001eff0: 5d20 3d20 7370 7269 6e74 6628 272d 2d25  ] = sprintf('--%
+0001f000: 732d 2d25 7327 2c20 2462 6f75 6e64 6172  s--%s', $boundar
+0001f010: 792c 2073 7461 7469 633a 3a24 4c45 293b  y, static::$LE);
+0001f020: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001f030: 2069 6d70 6c6f 6465 2827 272c 2024 6d69   implode('', $mi
+0001f040: 6d65 293b 0a20 2020 207d 0a0a 2020 2020  me);.    }..    
+0001f050: 2f2a 2a0a 2020 2020 202a 2045 6e63 6f64  /**.     * Encod
+0001f060: 6520 6120 6669 6c65 2061 7474 6163 686d  e a file attachm
+0001f070: 656e 7420 696e 2072 6571 7565 7374 6564  ent in requested
+0001f080: 2066 6f72 6d61 742e 0a20 2020 2020 2a20   format..     * 
+0001f090: 5265 7475 726e 7320 616e 2065 6d70 7479  Returns an empty
+0001f0a0: 2073 7472 696e 6720 6f6e 2066 6169 6c75   string on failu
+0001f0b0: 7265 2e0a 2020 2020 202a 0a20 2020 2020  re..     *.     
+0001f0c0: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+0001f0d0: 2470 6174 6820 2020 2020 5468 6520 6675  $path     The fu
+0001f0e0: 6c6c 2070 6174 6820 746f 2074 6865 2066  ll path to the f
+0001f0f0: 696c 650a 2020 2020 202a 2040 7061 7261  ile.     * @para
+0001f100: 6d20 7374 7269 6e67 2024 656e 636f 6469  m string $encodi
+0001f110: 6e67 2054 6865 2065 6e63 6f64 696e 6720  ng The encoding 
+0001f120: 746f 2075 7365 3b20 6f6e 6520 6f66 2027  to use; one of '
+0001f130: 6261 7365 3634 272c 2027 3762 6974 272c  base64', '7bit',
+0001f140: 2027 3862 6974 272c 2027 6269 6e61 7279   '8bit', 'binary
+0001f150: 272c 2027 7175 6f74 6564 2d70 7269 6e74  ', 'quoted-print
+0001f160: 6162 6c65 270a 2020 2020 202a 0a20 2020  able'.     *.   
+0001f170: 2020 2a20 4072 6574 7572 6e20 7374 7269    * @return stri
+0001f180: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+0001f190: 726f 7465 6374 6564 2066 756e 6374 696f  rotected functio
+0001f1a0: 6e20 656e 636f 6465 4669 6c65 2824 7061  n encodeFile($pa
+0001f1b0: 7468 2c20 2465 6e63 6f64 696e 6720 3d20  th, $encoding = 
+0001f1c0: 7365 6c66 3a3a 454e 434f 4449 4e47 5f42  self::ENCODING_B
+0001f1d0: 4153 4536 3429 0a20 2020 207b 0a20 2020  ASE64).    {.   
+0001f1e0: 2020 2020 2074 7279 207b 0a20 2020 2020       try {.     
+0001f1f0: 2020 2020 2020 2069 6620 2821 7374 6174         if (!stat
+0001f200: 6963 3a3a 6669 6c65 4973 4163 6365 7373  ic::fileIsAccess
+0001f210: 6962 6c65 2824 7061 7468 2929 207b 0a20  ible($path)) {. 
+0001f220: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001f230: 6872 6f77 206e 6577 2045 7863 6570 7469  hrow new Excepti
+0001f240: 6f6e 2824 7468 6973 2d3e 6c61 6e67 2827  on($this->lang('
+0001f250: 6669 6c65 5f6f 7065 6e27 2920 2e20 2470  file_open') . $p
+0001f260: 6174 682c 2073 656c 663a 3a53 544f 505f  ath, self::STOP_
+0001f270: 434f 4e54 494e 5545 293b 0a20 2020 2020  CONTINUE);.     
+0001f280: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001f290: 2020 2020 2024 6669 6c65 5f62 7566 6665       $file_buffe
+0001f2a0: 7220 3d20 6669 6c65 5f67 6574 5f63 6f6e  r = file_get_con
+0001f2b0: 7465 6e74 7328 2470 6174 6829 3b0a 2020  tents($path);.  
+0001f2c0: 2020 2020 2020 2020 2020 6966 2028 6661            if (fa
+0001f2d0: 6c73 6520 3d3d 3d20 2466 696c 655f 6275  lse === $file_bu
+0001f2e0: 6666 6572 2920 7b0a 2020 2020 2020 2020  ffer) {.        
+0001f2f0: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
+0001f300: 7720 4578 6365 7074 696f 6e28 2474 6869  w Exception($thi
+0001f310: 732d 3e6c 616e 6728 2766 696c 655f 6f70  s->lang('file_op
+0001f320: 656e 2729 202e 2024 7061 7468 2c20 7365  en') . $path, se
+0001f330: 6c66 3a3a 5354 4f50 5f43 4f4e 5449 4e55  lf::STOP_CONTINU
+0001f340: 4529 3b0a 2020 2020 2020 2020 2020 2020  E);.            
+0001f350: 7d0a 2020 2020 2020 2020 2020 2020 2466  }.            $f
+0001f360: 696c 655f 6275 6666 6572 203d 2024 7468  ile_buffer = $th
+0001f370: 6973 2d3e 656e 636f 6465 5374 7269 6e67  is->encodeString
+0001f380: 2824 6669 6c65 5f62 7566 6665 722c 2024  ($file_buffer, $
+0001f390: 656e 636f 6469 6e67 293b 0a0a 2020 2020  encoding);..    
+0001f3a0: 2020 2020 2020 2020 7265 7475 726e 2024          return $
+0001f3b0: 6669 6c65 5f62 7566 6665 723b 0a20 2020  file_buffer;.   
+0001f3c0: 2020 2020 207d 2063 6174 6368 2028 4578       } catch (Ex
+0001f3d0: 6365 7074 696f 6e20 2465 7863 2920 7b0a  ception $exc) {.
+0001f3e0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+0001f3f0: 732d 3e73 6574 4572 726f 7228 2465 7863  s->setError($exc
+0001f400: 2d3e 6765 744d 6573 7361 6765 2829 293b  ->getMessage());
+0001f410: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
+0001f420: 6973 2d3e 6564 6562 7567 2824 6578 632d  is->edebug($exc-
+0001f430: 3e67 6574 4d65 7373 6167 6528 2929 3b0a  >getMessage());.
+0001f440: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001f450: 2474 6869 732d 3e65 7863 6570 7469 6f6e  $this->exception
+0001f460: 7329 207b 0a20 2020 2020 2020 2020 2020  s) {.           
+0001f470: 2020 2020 2074 6872 6f77 2024 6578 633b       throw $exc;
+0001f480: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
+0001f490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001f4a0: 726e 2027 273b 0a20 2020 2020 2020 207d  rn '';.        }
+0001f4b0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+0001f4c0: 2020 2020 202a 2045 6e63 6f64 6520 6120       * Encode a 
+0001f4d0: 7374 7269 6e67 2069 6e20 7265 7175 6573  string in reques
+0001f4e0: 7465 6420 666f 726d 6174 2e0a 2020 2020  ted format..    
+0001f4f0: 202a 2052 6574 7572 6e73 2061 6e20 656d   * Returns an em
+0001f500: 7074 7920 7374 7269 6e67 206f 6e20 6661  pty string on fa
+0001f510: 696c 7572 652e 0a20 2020 2020 2a0a 2020  ilure..     *.  
+0001f520: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+0001f530: 6e67 2024 7374 7220 2020 2020 2054 6865  ng $str      The
+0001f540: 2074 6578 7420 746f 2065 6e63 6f64 650a   text to encode.
+0001f550: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+0001f560: 7269 6e67 2024 656e 636f 6469 6e67 2054  ring $encoding T
+0001f570: 6865 2065 6e63 6f64 696e 6720 746f 2075  he encoding to u
+0001f580: 7365 3b20 6f6e 6520 6f66 2027 6261 7365  se; one of 'base
+0001f590: 3634 272c 2027 3762 6974 272c 2027 3862  64', '7bit', '8b
+0001f5a0: 6974 272c 2027 6269 6e61 7279 272c 2027  it', 'binary', '
+0001f5b0: 7175 6f74 6564 2d70 7269 6e74 6162 6c65  quoted-printable
+0001f5c0: 270a 2020 2020 202a 0a20 2020 2020 2a20  '.     *.     * 
+0001f5d0: 4074 6872 6f77 7320 4578 6365 7074 696f  @throws Exceptio
+0001f5e0: 6e0a 2020 2020 202a 0a20 2020 2020 2a20  n.     *.     * 
+0001f5f0: 4072 6574 7572 6e20 7374 7269 6e67 0a20  @return string. 
+0001f600: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+0001f610: 6320 6675 6e63 7469 6f6e 2065 6e63 6f64  c function encod
+0001f620: 6553 7472 696e 6728 2473 7472 2c20 2465  eString($str, $e
+0001f630: 6e63 6f64 696e 6720 3d20 7365 6c66 3a3a  ncoding = self::
+0001f640: 454e 434f 4449 4e47 5f42 4153 4536 3429  ENCODING_BASE64)
+0001f650: 0a20 2020 207b 0a20 2020 2020 2020 2024  .    {.        $
+0001f660: 656e 636f 6465 6420 3d20 2727 3b0a 2020  encoded = '';.  
+0001f670: 2020 2020 2020 7377 6974 6368 2028 7374        switch (st
+0001f680: 7274 6f6c 6f77 6572 2824 656e 636f 6469  rtolower($encodi
+0001f690: 6e67 2929 207b 0a20 2020 2020 2020 2020  ng)) {.         
+0001f6a0: 2020 2063 6173 6520 7374 6174 6963 3a3a     case static::
+0001f6b0: 454e 434f 4449 4e47 5f42 4153 4536 343a  ENCODING_BASE64:
+0001f6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f6d0: 2024 656e 636f 6465 6420 3d20 6368 756e   $encoded = chun
+0001f6e0: 6b5f 7370 6c69 7428 0a20 2020 2020 2020  k_split(.       
+0001f6f0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0001f700: 6536 345f 656e 636f 6465 2824 7374 7229  e64_encode($str)
+0001f710: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f720: 2020 2020 2020 7374 6174 6963 3a3a 5354        static::ST
+0001f730: 445f 4c49 4e45 5f4c 454e 4754 482c 0a20  D_LINE_LENGTH,. 
+0001f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f750: 2020 2073 7461 7469 633a 3a24 4c45 0a20     static::$LE. 
+0001f760: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001f770: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0001f780: 2020 6272 6561 6b3b 0a20 2020 2020 2020    break;.       
+0001f790: 2020 2020 2063 6173 6520 7374 6174 6963       case static
+0001f7a0: 3a3a 454e 434f 4449 4e47 5f37 4249 543a  ::ENCODING_7BIT:
+0001f7b0: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
+0001f7c0: 6520 7374 6174 6963 3a3a 454e 434f 4449  e static::ENCODI
+0001f7d0: 4e47 5f38 4249 543a 0a20 2020 2020 2020  NG_8BIT:.       
+0001f7e0: 2020 2020 2020 2020 2024 656e 636f 6465           $encode
+0001f7f0: 6420 3d20 7374 6174 6963 3a3a 6e6f 726d  d = static::norm
+0001f800: 616c 697a 6542 7265 616b 7328 2473 7472  alizeBreaks($str
+0001f810: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+0001f820: 2020 202f 2f4d 616b 6520 7375 7265 2069     //Make sure i
+0001f830: 7420 656e 6473 2077 6974 6820 6120 6c69  t ends with a li
+0001f840: 6e65 2062 7265 616b 0a20 2020 2020 2020  ne break.       
+0001f850: 2020 2020 2020 2020 2069 6620 2873 7562           if (sub
+0001f860: 7374 7228 2465 6e63 6f64 6564 2c20 2d28  str($encoded, -(
+0001f870: 7374 726c 656e 2873 7461 7469 633a 3a24  strlen(static::$
+0001f880: 4c45 2929 2920 213d 3d20 7374 6174 6963  LE))) !== static
+0001f890: 3a3a 244c 4529 207b 0a20 2020 2020 2020  ::$LE) {.       
+0001f8a0: 2020 2020 2020 2020 2020 2020 2024 656e               $en
+0001f8b0: 636f 6465 6420 2e3d 2073 7461 7469 633a  coded .= static:
+0001f8c0: 3a24 4c45 3b0a 2020 2020 2020 2020 2020  :$LE;.          
+0001f8d0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0001f8e0: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+0001f8f0: 2020 2020 2020 2020 2020 2063 6173 6520             case 
+0001f900: 7374 6174 6963 3a3a 454e 434f 4449 4e47  static::ENCODING
+0001f910: 5f42 494e 4152 593a 0a20 2020 2020 2020  _BINARY:.       
+0001f920: 2020 2020 2020 2020 2024 656e 636f 6465           $encode
+0001f930: 6420 3d20 2473 7472 3b0a 2020 2020 2020  d = $str;.      
+0001f940: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
+0001f950: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
+0001f960: 6520 7374 6174 6963 3a3a 454e 434f 4449  e static::ENCODI
+0001f970: 4e47 5f51 554f 5445 445f 5052 494e 5441  NG_QUOTED_PRINTA
+0001f980: 424c 453a 0a20 2020 2020 2020 2020 2020  BLE:.           
+0001f990: 2020 2020 2024 656e 636f 6465 6420 3d20       $encoded = 
+0001f9a0: 2474 6869 732d 3e65 6e63 6f64 6551 5028  $this->encodeQP(
+0001f9b0: 2473 7472 293b 0a20 2020 2020 2020 2020  $str);.         
+0001f9c0: 2020 2020 2020 2062 7265 616b 3b0a 2020         break;.  
+0001f9d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+0001f9e0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001f9f0: 2020 2024 7468 6973 2d3e 7365 7445 7272     $this->setErr
+0001fa00: 6f72 2824 7468 6973 2d3e 6c61 6e67 2827  or($this->lang('
+0001fa10: 656e 636f 6469 6e67 2729 202e 2024 656e  encoding') . $en
+0001fa20: 636f 6469 6e67 293b 0a20 2020 2020 2020  coding);.       
+0001fa30: 2020 2020 2020 2020 2069 6620 2824 7468           if ($th
+0001fa40: 6973 2d3e 6578 6365 7074 696f 6e73 2920  is->exceptions) 
+0001fa50: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001fa60: 2020 2020 2020 7468 726f 7720 6e65 7720        throw new 
+0001fa70: 4578 6365 7074 696f 6e28 2474 6869 732d  Exception($this-
+0001fa80: 3e6c 616e 6728 2765 6e63 6f64 696e 6727  >lang('encoding'
+0001fa90: 2920 2e20 2465 6e63 6f64 696e 6729 3b0a  ) . $encoding);.
+0001faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fab0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0001fac0: 2020 6272 6561 6b3b 0a20 2020 2020 2020    break;.       
+0001fad0: 207d 0a0a 2020 2020 2020 2020 7265 7475   }..        retu
+0001fae0: 726e 2024 656e 636f 6465 643b 0a20 2020  rn $encoded;.   
+0001faf0: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+0001fb00: 202a 2045 6e63 6f64 6520 6120 6865 6164   * Encode a head
+0001fb10: 6572 2076 616c 7565 2028 6e6f 7420 696e  er value (not in
+0001fb20: 636c 7564 696e 6720 6974 7320 6c61 6265  cluding its labe
+0001fb30: 6c29 206f 7074 696d 616c 6c79 2e0a 2020  l) optimally..  
+0001fb40: 2020 202a 2050 6963 6b73 2073 686f 7274     * Picks short
+0001fb50: 6573 7420 6f66 2051 2c20 422c 206f 7220  est of Q, B, or 
+0001fb60: 6e6f 6e65 2e20 5265 7375 6c74 2069 6e63  none. Result inc
+0001fb70: 6c75 6465 7320 666f 6c64 696e 6720 6966  ludes folding if
+0001fb80: 206e 6565 6465 642e 0a20 2020 2020 2a20   needed..     * 
+0001fb90: 5365 6520 5246 4338 3232 2064 6566 696e  See RFC822 defin
+0001fba0: 6974 696f 6e73 2066 6f72 2070 6872 6173  itions for phras
+0001fbb0: 652c 2063 6f6d 6d65 6e74 2061 6e64 2074  e, comment and t
+0001fbc0: 6578 7420 706f 7369 7469 6f6e 732e 0a20  ext positions.. 
+0001fbd0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+0001fbe0: 7261 6d20 7374 7269 6e67 2024 7374 7220  ram string $str 
+0001fbf0: 2020 2020 2054 6865 2068 6561 6465 7220       The header 
+0001fc00: 7661 6c75 6520 746f 2065 6e63 6f64 650a  value to encode.
+0001fc10: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+0001fc20: 7269 6e67 2024 706f 7369 7469 6f6e 2057  ring $position W
+0001fc30: 6861 7420 636f 6e74 6578 7420 7468 6520  hat context the 
+0001fc40: 7374 7269 6e67 2077 696c 6c20 6265 2075  string will be u
+0001fc50: 7365 6420 696e 0a20 2020 2020 2a0a 2020  sed in.     *.  
+0001fc60: 2020 202a 2040 7265 7475 726e 2073 7472     * @return str
+0001fc70: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
+0001fc80: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+0001fc90: 656e 636f 6465 4865 6164 6572 2824 7374  encodeHeader($st
+0001fca0: 722c 2024 706f 7369 7469 6f6e 203d 2027  r, $position = '
+0001fcb0: 7465 7874 2729 0a20 2020 207b 0a20 2020  text').    {.   
+0001fcc0: 2020 2020 2024 6d61 7463 6863 6f75 6e74       $matchcount
+0001fcd0: 203d 2030 3b0a 2020 2020 2020 2020 7377   = 0;.        sw
+0001fce0: 6974 6368 2028 7374 7274 6f6c 6f77 6572  itch (strtolower
+0001fcf0: 2824 706f 7369 7469 6f6e 2929 207b 0a20  ($position)) {. 
+0001fd00: 2020 2020 2020 2020 2020 2063 6173 6520             case 
+0001fd10: 2770 6872 6173 6527 3a0a 2020 2020 2020  'phrase':.      
+0001fd20: 2020 2020 2020 2020 2020 6966 2028 2170            if (!p
+0001fd30: 7265 675f 6d61 7463 6828 272f 5b5c 3230  reg_match('/[\20
+0001fd40: 302d 5c33 3737 5d2f 272c 2024 7374 7229  0-\377]/', $str)
+0001fd50: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0001fd60: 2020 2020 2020 2020 2f2f 4361 6e27 7420          //Can't 
+0001fd70: 7573 6520 6164 6473 6c61 7368 6573 2061  use addslashes a
+0001fd80: 7320 7765 2064 6f6e 2774 206b 6e6f 7720  s we don't know 
+0001fd90: 7468 6520 7661 6c75 6520 6f66 206d 6167  the value of mag
+0001fda0: 6963 5f71 756f 7465 735f 7379 6261 7365  ic_quotes_sybase
+0001fdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fdc0: 2020 2020 2024 656e 636f 6465 6420 3d20       $encoded = 
+0001fdd0: 6164 6463 736c 6173 6865 7328 2473 7472  addcslashes($str
+0001fde0: 2c20 225c 302e 2e5c 3337 5c31 3737 5c5c  , "\0..\37\177\\
+0001fdf0: 5c22 2229 3b0a 2020 2020 2020 2020 2020  \"");.          
+0001fe00: 2020 2020 2020 2020 2020 6966 2028 2824            if (($
+0001fe10: 7374 7220 3d3d 3d20 2465 6e63 6f64 6564  str === $encoded
+0001fe20: 2920 2626 2021 7072 6567 5f6d 6174 6368  ) && !preg_match
+0001fe30: 2827 2f5b 5e41 2d5a 612d 7a30 2d39 2123  ('/[^A-Za-z0-9!#
+0001fe40: 2425 265c 272a 2b5c 2f3d 3f5e 5f60 7b7c  $%&\'*+\/=?^_`{|
+0001fe50: 7d7e 202d 5d2f 272c 2024 7374 7229 2920  }~ -]/', $str)) 
+0001fe60: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001fe70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001fe80: 2024 656e 636f 6465 643b 0a20 2020 2020   $encoded;.     
+0001fe90: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0001fea0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001feb0: 2020 2020 2020 7265 7475 726e 2022 5c22        return "\"
+0001fec0: 2465 6e63 6f64 6564 5c22 223b 0a20 2020  $encoded\"";.   
+0001fed0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0001fee0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0001fef0: 6d61 7463 6863 6f75 6e74 203d 2070 7265  matchcount = pre
+0001ff00: 675f 6d61 7463 685f 616c 6c28 272f 5b5e  g_match_all('/[^
+0001ff10: 5c30 3430 5c30 3431 5c30 3433 2d5c 3133  \040\041\043-\13
+0001ff20: 335c 3133 352d 5c31 3736 5d2f 272c 2024  3\135-\176]/', $
+0001ff30: 7374 722c 2024 6d61 7463 6865 7329 3b0a  str, $matches);.
+0001ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff50: 6272 6561 6b3b 0a20 2020 2020 2020 2020  break;.         
+0001ff60: 2020 202f 2a20 406e 6f69 6e73 7065 6374     /* @noinspect
+0001ff70: 696f 6e20 5068 704d 6973 7369 6e67 4272  ion PhpMissingBr
+0001ff80: 6561 6b53 7461 7465 6d65 6e74 496e 7370  eakStatementInsp
+0001ff90: 6563 7469 6f6e 202a 2f0a 2020 2020 2020  ection */.      
+0001ffa0: 2020 2020 2020 6361 7365 2027 636f 6d6d        case 'comm
+0001ffb0: 656e 7427 3a0a 2020 2020 2020 2020 2020  ent':.          
+0001ffc0: 2020 2020 2020 246d 6174 6368 636f 756e        $matchcoun
+0001ffd0: 7420 3d20 7072 6567 5f6d 6174 6368 5f61  t = preg_match_a
+0001ffe0: 6c6c 2827 2f5b 2829 225d 2f27 2c20 2473  ll('/[()"]/', $s
+0001fff0: 7472 2c20 246d 6174 6368 6573 293b 0a20  tr, $matches);. 
+00020000: 2020 2020 2020 2020 2020 202f 2f66 616c             //fal
+00020010: 6c74 6872 6f75 6768 0a20 2020 2020 2020  lthrough.       
+00020020: 2020 2020 2063 6173 6520 2774 6578 7427       case 'text'
+00020030: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+00020040: 6661 756c 743a 0a20 2020 2020 2020 2020  fault:.         
+00020050: 2020 2020 2020 2024 6d61 7463 6863 6f75         $matchcou
+00020060: 6e74 202b 3d20 7072 6567 5f6d 6174 6368  nt += preg_match
+00020070: 5f61 6c6c 2827 2f5b 5c30 3030 2d5c 3031  _all('/[\000-\01
+00020080: 305c 3031 335c 3031 345c 3031 362d 5c30  0\013\014\016-\0
+00020090: 3337 5c31 3737 2d5c 3337 375d 2f27 2c20  37\177-\377]/', 
+000200a0: 2473 7472 2c20 246d 6174 6368 6573 293b  $str, $matches);
+000200b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000200c0: 2062 7265 616b 3b0a 2020 2020 2020 2020   break;.        
+000200d0: 7d0a 0a20 2020 2020 2020 2069 6620 2824  }..        if ($
+000200e0: 7468 6973 2d3e 6861 7338 6269 7443 6861  this->has8bitCha
+000200f0: 7273 2824 7374 7229 2920 7b0a 2020 2020  rs($str)) {.    
+00020100: 2020 2020 2020 2020 2463 6861 7273 6574          $charset
+00020110: 203d 2024 7468 6973 2d3e 4368 6172 5365   = $this->CharSe
+00020120: 743b 0a20 2020 2020 2020 207d 2065 6c73  t;.        } els
+00020130: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
+00020140: 2463 6861 7273 6574 203d 2073 7461 7469  $charset = stati
+00020150: 633a 3a43 4841 5253 4554 5f41 5343 4949  c::CHARSET_ASCII
+00020160: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
+00020170: 2020 2020 202f 2f51 2f42 2065 6e63 6f64       //Q/B encod
+00020180: 696e 6720 6164 6473 2038 2063 6861 7273  ing adds 8 chars
+00020190: 2061 6e64 2074 6865 2063 6861 7273 6574   and the charset
+000201a0: 2028 2260 203d 3f3c 6368 6172 7365 743e   ("` =?<charset>
+000201b0: 3f5b 5142 5d3f 3c63 6f6e 7465 6e74 3e3f  ?[QB]?<content>?
+000201c0: 3d60 2229 2e0a 2020 2020 2020 2020 246f  =`")..        $o
+000201d0: 7665 7268 6561 6420 3d20 3820 2b20 7374  verhead = 8 + st
+000201e0: 726c 656e 2824 6368 6172 7365 7429 3b0a  rlen($charset);.
+000201f0: 0a20 2020 2020 2020 2069 6620 2827 6d61  .        if ('ma
+00020200: 696c 2720 3d3d 3d20 2474 6869 732d 3e4d  il' === $this->M
+00020210: 6169 6c65 7229 207b 0a20 2020 2020 2020  ailer) {.       
+00020220: 2020 2020 2024 6d61 786c 656e 203d 2073       $maxlen = s
+00020230: 7461 7469 633a 3a4d 4149 4c5f 4d41 585f  tatic::MAIL_MAX_
+00020240: 4c49 4e45 5f4c 454e 4754 4820 2d20 246f  LINE_LENGTH - $o
+00020250: 7665 7268 6561 643b 0a20 2020 2020 2020  verhead;.       
+00020260: 207d 2065 6c73 6520 7b0a 2020 2020 2020   } else {.      
+00020270: 2020 2020 2020 246d 6178 6c65 6e20 3d20        $maxlen = 
+00020280: 7374 6174 6963 3a3a 4d41 585f 4c49 4e45  static::MAX_LINE
+00020290: 5f4c 454e 4754 4820 2d20 246f 7665 7268  _LENGTH - $overh
+000202a0: 6561 643b 0a20 2020 2020 2020 207d 0a0a  ead;.        }..
+000202b0: 2020 2020 2020 2020 2f2f 5365 6c65 6374          //Select
+000202c0: 2074 6865 2065 6e63 6f64 696e 6720 7468   the encoding th
+000202d0: 6174 2070 726f 6475 6365 7320 7468 6520  at produces the 
+000202e0: 7368 6f72 7465 7374 206f 7574 7075 7420  shortest output 
+000202f0: 616e 642f 6f72 2070 7265 7665 6e74 7320  and/or prevents 
+00020300: 636f 7272 7570 7469 6f6e 2e0a 2020 2020  corruption..    
+00020310: 2020 2020 6966 2028 246d 6174 6368 636f      if ($matchco
+00020320: 756e 7420 3e20 7374 726c 656e 2824 7374  unt > strlen($st
+00020330: 7229 202f 2033 2920 7b0a 2020 2020 2020  r) / 3) {.      
+00020340: 2020 2020 2020 2f2f 4d6f 7265 2074 6861        //More tha
+00020350: 6e20 312f 3320 6f66 2074 6865 2063 6f6e  n 1/3 of the con
+00020360: 7465 6e74 206e 6565 6473 2065 6e63 6f64  tent needs encod
+00020370: 696e 672c 2075 7365 2042 2d65 6e63 6f64  ing, use B-encod
+00020380: 652e 0a20 2020 2020 2020 2020 2020 2024  e..            $
+00020390: 656e 636f 6469 6e67 203d 2027 4227 3b0a  encoding = 'B';.
+000203a0: 2020 2020 2020 2020 7d20 656c 7365 6966          } elseif
+000203b0: 2028 246d 6174 6368 636f 756e 7420 3e20   ($matchcount > 
+000203c0: 3029 207b 0a20 2020 2020 2020 2020 2020  0) {.           
+000203d0: 202f 2f4c 6573 7320 7468 616e 2031 2f33   //Less than 1/3
+000203e0: 206f 6620 7468 6520 636f 6e74 656e 7420   of the content 
+000203f0: 6e65 6564 7320 656e 636f 6469 6e67 2c20  needs encoding, 
+00020400: 7573 6520 512d 656e 636f 6465 2e0a 2020  use Q-encode..  
+00020410: 2020 2020 2020 2020 2020 2465 6e63 6f64            $encod
+00020420: 696e 6720 3d20 2751 273b 0a20 2020 2020  ing = 'Q';.     
+00020430: 2020 207d 2065 6c73 6569 6620 2873 7472     } elseif (str
+00020440: 6c65 6e28 2473 7472 2920 3e20 246d 6178  len($str) > $max
+00020450: 6c65 6e29 207b 0a20 2020 2020 2020 2020  len) {.         
+00020460: 2020 202f 2f4e 6f20 656e 636f 6469 6e67     //No encoding
+00020470: 206e 6565 6465 642c 2062 7574 2076 616c   needed, but val
+00020480: 7565 2065 7863 6565 6473 206d 6178 206c  ue exceeds max l
+00020490: 696e 6520 6c65 6e67 7468 2c20 7573 6520  ine length, use 
+000204a0: 512d 656e 636f 6465 2074 6f20 7072 6576  Q-encode to prev
+000204b0: 656e 7420 636f 7272 7570 7469 6f6e 2e0a  ent corruption..
+000204c0: 2020 2020 2020 2020 2020 2020 2465 6e63              $enc
+000204d0: 6f64 696e 6720 3d20 2751 273b 0a20 2020  oding = 'Q';.   
+000204e0: 2020 2020 207d 2065 6c73 6520 7b0a 2020       } else {.  
+000204f0: 2020 2020 2020 2020 2020 2f2f 4e6f 2072            //No r
+00020500: 6566 6f72 6d61 7474 696e 6720 6e65 6564  eformatting need
+00020510: 6564 0a20 2020 2020 2020 2020 2020 2024  ed.            $
+00020520: 656e 636f 6469 6e67 203d 2066 616c 7365  encoding = false
+00020530: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
+00020540: 2020 2020 2073 7769 7463 6820 2824 656e       switch ($en
+00020550: 636f 6469 6e67 2920 7b0a 2020 2020 2020  coding) {.      
+00020560: 2020 2020 2020 6361 7365 2027 4227 3a0a        case 'B':.
+00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020580: 6966 2028 2474 6869 732d 3e68 6173 4d75  if ($this->hasMu
+00020590: 6c74 6942 7974 6573 2824 7374 7229 2920  ltiBytes($str)) 
+000205a0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000205b0: 2020 2020 2020 2f2f 5573 6520 6120 6375        //Use a cu
+000205c0: 7374 6f6d 2066 756e 6374 696f 6e20 7768  stom function wh
+000205d0: 6963 6820 636f 7272 6563 746c 7920 656e  ich correctly en
+000205e0: 636f 6465 7320 616e 6420 7772 6170 7320  codes and wraps 
+000205f0: 6c6f 6e67 0a20 2020 2020 2020 2020 2020  long.           
+00020600: 2020 2020 2020 2020 202f 2f6d 756c 7469           //multi
+00020610: 6279 7465 2073 7472 696e 6773 2077 6974  byte strings wit
+00020620: 686f 7574 2062 7265 616b 696e 6720 6c69  hout breaking li
+00020630: 6e65 7320 7769 7468 696e 2061 2063 6861  nes within a cha
+00020640: 7261 6374 6572 0a20 2020 2020 2020 2020  racter.         
+00020650: 2020 2020 2020 2020 2020 2024 656e 636f             $enco
+00020660: 6465 6420 3d20 2474 6869 732d 3e62 6173  ded = $this->bas
+00020670: 6536 3445 6e63 6f64 6557 7261 704d 4228  e64EncodeWrapMB(
+00020680: 2473 7472 2c20 225c 6e22 293b 0a20 2020  $str, "\n");.   
+00020690: 2020 2020 2020 2020 2020 2020 207d 2065               } e
+000206a0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
+000206b0: 2020 2020 2020 2020 2020 2465 6e63 6f64            $encod
+000206c0: 6564 203d 2062 6173 6536 345f 656e 636f  ed = base64_enco
+000206d0: 6465 2824 7374 7229 3b0a 2020 2020 2020  de($str);.      
+000206e0: 2020 2020 2020 2020 2020 2020 2020 246d                $m
+000206f0: 6178 6c65 6e20 2d3d 2024 6d61 786c 656e  axlen -= $maxlen
+00020700: 2025 2034 3b0a 2020 2020 2020 2020 2020   % 4;.          
+00020710: 2020 2020 2020 2020 2020 2465 6e63 6f64            $encod
+00020720: 6564 203d 2074 7269 6d28 6368 756e 6b5f  ed = trim(chunk_
+00020730: 7370 6c69 7428 2465 6e63 6f64 6564 2c20  split($encoded, 
+00020740: 246d 6178 6c65 6e2c 2022 5c6e 2229 293b  $maxlen, "\n"));
+00020750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020760: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00020770: 2020 2024 656e 636f 6465 6420 3d20 7072     $encoded = pr
+00020780: 6567 5f72 6570 6c61 6365 2827 2f5e 282e  eg_replace('/^(.
+00020790: 2a29 242f 6d27 2c20 2720 3d3f 2720 2e20  *)$/m', ' =?' . 
+000207a0: 2463 6861 7273 6574 202e 2022 3f24 656e  $charset . "?$en
+000207b0: 636f 6469 6e67 3f5c 5c31 3f3d 222c 2024  coding?\\1?=", $
+000207c0: 656e 636f 6465 6429 3b0a 2020 2020 2020  encoded);.      
+000207d0: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
+000207e0: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
+000207f0: 6520 2751 273a 0a20 2020 2020 2020 2020  e 'Q':.         
+00020800: 2020 2020 2020 2024 656e 636f 6465 6420         $encoded 
+00020810: 3d20 2474 6869 732d 3e65 6e63 6f64 6551  = $this->encodeQ
+00020820: 2824 7374 722c 2024 706f 7369 7469 6f6e  ($str, $position
+00020830: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+00020840: 2020 2024 656e 636f 6465 6420 3d20 2474     $encoded = $t
+00020850: 6869 732d 3e77 7261 7054 6578 7428 2465  his->wrapText($e
+00020860: 6e63 6f64 6564 2c20 246d 6178 6c65 6e2c  ncoded, $maxlen,
+00020870: 2074 7275 6529 3b0a 2020 2020 2020 2020   true);.        
+00020880: 2020 2020 2020 2020 2465 6e63 6f64 6564          $encoded
+00020890: 203d 2073 7472 5f72 6570 6c61 6365 2827   = str_replace('
+000208a0: 3d27 202e 2073 7461 7469 633a 3a24 4c45  =' . static::$LE
+000208b0: 2c20 225c 6e22 2c20 7472 696d 2824 656e  , "\n", trim($en
+000208c0: 636f 6465 6429 293b 0a20 2020 2020 2020  coded));.       
+000208d0: 2020 2020 2020 2020 2024 656e 636f 6465           $encode
+000208e0: 6420 3d20 7072 6567 5f72 6570 6c61 6365  d = preg_replace
+000208f0: 2827 2f5e 282e 2a29 242f 6d27 2c20 2720  ('/^(.*)$/m', ' 
+00020900: 3d3f 2720 2e20 2463 6861 7273 6574 202e  =?' . $charset .
+00020910: 2022 3f24 656e 636f 6469 6e67 3f5c 5c31   "?$encoding?\\1
+00020920: 3f3d 222c 2024 656e 636f 6465 6429 3b0a  ?=", $encoded);.
+00020930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020940: 6272 6561 6b3b 0a20 2020 2020 2020 2020  break;.         
+00020950: 2020 2064 6566 6175 6c74 3a0a 2020 2020     default:.    
+00020960: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00020970: 726e 2024 7374 723b 0a20 2020 2020 2020  rn $str;.       
+00020980: 207d 0a0a 2020 2020 2020 2020 7265 7475   }..        retu
+00020990: 726e 2074 7269 6d28 7374 6174 6963 3a3a  rn trim(static::
+000209a0: 6e6f 726d 616c 697a 6542 7265 616b 7328  normalizeBreaks(
+000209b0: 2465 6e63 6f64 6564 2929 3b0a 2020 2020  $encoded));.    
+000209c0: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+000209d0: 2a20 4368 6563 6b20 6966 2061 2073 7472  * Check if a str
+000209e0: 696e 6720 636f 6e74 6169 6e73 206d 756c  ing contains mul
+000209f0: 7469 2d62 7974 6520 6368 6172 6163 7465  ti-byte characte
+00020a00: 7273 2e0a 2020 2020 202a 0a20 2020 2020  rs..     *.     
+00020a10: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+00020a20: 2473 7472 206d 756c 7469 2d62 7974 6520  $str multi-byte 
+00020a30: 7465 7874 2074 6f20 7772 6170 2065 6e63  text to wrap enc
+00020a40: 6f64 650a 2020 2020 202a 0a20 2020 2020  ode.     *.     
+00020a50: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
+00020a60: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00020a70: 6320 6675 6e63 7469 6f6e 2068 6173 4d75  c function hasMu
+00020a80: 6c74 6942 7974 6573 2824 7374 7229 0a20  ltiBytes($str). 
+00020a90: 2020 207b 0a20 2020 2020 2020 2069 6620     {.        if 
+00020aa0: 2866 756e 6374 696f 6e5f 6578 6973 7473  (function_exists
+00020ab0: 2827 6d62 5f73 7472 6c65 6e27 2929 207b  ('mb_strlen')) {
+00020ac0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00020ad0: 7572 6e20 7374 726c 656e 2824 7374 7229  urn strlen($str)
+00020ae0: 203e 206d 625f 7374 726c 656e 2824 7374   > mb_strlen($st
+00020af0: 722c 2024 7468 6973 2d3e 4368 6172 5365  r, $this->CharSe
+00020b00: 7429 3b0a 2020 2020 2020 2020 7d0a 0a20  t);.        }.. 
+00020b10: 2020 2020 2020 202f 2f41 7373 756d 6520         //Assume 
+00020b20: 6e6f 206d 756c 7469 6279 7465 7320 2877  no multibytes (w
+00020b30: 6520 6361 6e27 7420 6861 6e64 6c65 2077  e can't handle w
+00020b40: 6974 686f 7574 206d 6273 7472 696e 6720  ithout mbstring 
+00020b50: 6675 6e63 7469 6f6e 7320 616e 7977 6179  functions anyway
+00020b60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00020b70: 2066 616c 7365 3b0a 2020 2020 7d0a 0a20   false;.    }.. 
+00020b80: 2020 202f 2a2a 0a20 2020 2020 2a20 446f     /**.     * Do
+00020b90: 6573 2061 2073 7472 696e 6720 636f 6e74  es a string cont
+00020ba0: 6169 6e20 616e 7920 382d 6269 7420 6368  ain any 8-bit ch
+00020bb0: 6172 7320 2869 6e20 616e 7920 6368 6172  ars (in any char
+00020bc0: 7365 7429 3f0a 2020 2020 202a 0a20 2020  set)?.     *.   
+00020bd0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00020be0: 6720 2474 6578 740a 2020 2020 202a 0a20  g $text.     *. 
+00020bf0: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
+00020c00: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
+00020c10: 7562 6c69 6320 6675 6e63 7469 6f6e 2068  ublic function h
+00020c20: 6173 3862 6974 4368 6172 7328 2474 6578  as8bitChars($tex
+00020c30: 7429 0a20 2020 207b 0a20 2020 2020 2020  t).    {.       
+00020c40: 2072 6574 7572 6e20 2862 6f6f 6c29 2070   return (bool) p
+00020c50: 7265 675f 6d61 7463 6828 272f 5b5c 7838  reg_match('/[\x8
+00020c60: 302d 5c78 4646 5d2f 272c 2024 7465 7874  0-\xFF]/', $text
+00020c70: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
+00020c80: 2a0a 2020 2020 202a 2045 6e63 6f64 6520  *.     * Encode 
+00020c90: 616e 6420 7772 6170 206c 6f6e 6720 6d75  and wrap long mu
+00020ca0: 6c74 6962 7974 6520 7374 7269 6e67 7320  ltibyte strings 
+00020cb0: 666f 7220 6d61 696c 2068 6561 6465 7273  for mail headers
+00020cc0: 0a20 2020 2020 2a20 7769 7468 6f75 7420  .     * without 
+00020cd0: 6272 6561 6b69 6e67 206c 696e 6573 2077  breaking lines w
+00020ce0: 6974 6869 6e20 6120 6368 6172 6163 7465  ithin a characte
+00020cf0: 722e 0a20 2020 2020 2a20 4164 6170 7465  r..     * Adapte
+00020d00: 6420 6672 6f6d 2061 2066 756e 6374 696f  d from a functio
+00020d10: 6e20 6279 2070 6172 6176 6f69 642e 0a20  n by paravoid.. 
+00020d20: 2020 2020 2a0a 2020 2020 202a 2040 7365      *.     * @se
+00020d30: 6520 6874 7470 3a2f 2f77 7777 2e70 6870  e http://www.php
+00020d40: 2e6e 6574 2f6d 616e 7561 6c2f 656e 2f66  .net/manual/en/f
+00020d50: 756e 6374 696f 6e2e 6d62 2d65 6e63 6f64  unction.mb-encod
+00020d60: 652d 6d69 6d65 6865 6164 6572 2e70 6870  e-mimeheader.php
+00020d70: 2336 3032 3833 0a20 2020 2020 2a0a 2020  #60283.     *.  
+00020d80: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00020d90: 6e67 2024 7374 7220 2020 2020 2020 6d75  ng $str       mu
+00020da0: 6c74 692d 6279 7465 2074 6578 7420 746f  lti-byte text to
+00020db0: 2077 7261 7020 656e 636f 6465 0a20 2020   wrap encode.   
+00020dc0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00020dd0: 6720 246c 696e 6562 7265 616b 2073 7472  g $linebreak str
+00020de0: 696e 6720 746f 2075 7365 2061 7320 6c69  ing to use as li
+00020df0: 6e65 6665 6564 2f65 6e64 2d6f 662d 6c69  nefeed/end-of-li
+00020e00: 6e65 0a20 2020 2020 2a0a 2020 2020 202a  ne.     *.     *
+00020e10: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
+00020e20: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+00020e30: 6963 2066 756e 6374 696f 6e20 6261 7365  ic function base
+00020e40: 3634 456e 636f 6465 5772 6170 4d42 2824  64EncodeWrapMB($
+00020e50: 7374 722c 2024 6c69 6e65 6272 6561 6b20  str, $linebreak 
+00020e60: 3d20 6e75 6c6c 290a 2020 2020 7b0a 2020  = null).    {.  
+00020e70: 2020 2020 2020 2473 7461 7274 203d 2027        $start = '
+00020e80: 3d3f 2720 2e20 2474 6869 732d 3e43 6861  =?' . $this->Cha
+00020e90: 7253 6574 202e 2027 3f42 3f27 3b0a 2020  rSet . '?B?';.  
+00020ea0: 2020 2020 2020 2465 6e64 203d 2027 3f3d        $end = '?=
+00020eb0: 273b 0a20 2020 2020 2020 2024 656e 636f  ';.        $enco
+00020ec0: 6465 6420 3d20 2727 3b0a 2020 2020 2020  ded = '';.      
+00020ed0: 2020 6966 2028 6e75 6c6c 203d 3d3d 2024    if (null === $
+00020ee0: 6c69 6e65 6272 6561 6b29 207b 0a20 2020  linebreak) {.   
+00020ef0: 2020 2020 2020 2020 2024 6c69 6e65 6272           $linebr
+00020f00: 6561 6b20 3d20 7374 6174 6963 3a3a 244c  eak = static::$L
+00020f10: 453b 0a20 2020 2020 2020 207d 0a0a 2020  E;.        }..  
+00020f20: 2020 2020 2020 246d 625f 6c65 6e67 7468        $mb_length
+00020f30: 203d 206d 625f 7374 726c 656e 2824 7374   = mb_strlen($st
+00020f40: 722c 2024 7468 6973 2d3e 4368 6172 5365  r, $this->CharSe
+00020f50: 7429 3b0a 2020 2020 2020 2020 2f2f 4561  t);.        //Ea
+00020f60: 6368 206c 696e 6520 6d75 7374 2068 6176  ch line must hav
+00020f70: 6520 6c65 6e67 7468 203c 3d20 3735 2c20  e length <= 75, 
+00020f80: 696e 636c 7564 696e 6720 2473 7461 7274  including $start
+00020f90: 2061 6e64 2024 656e 640a 2020 2020 2020   and $end.      
+00020fa0: 2020 246c 656e 6774 6820 3d20 3735 202d    $length = 75 -
+00020fb0: 2073 7472 6c65 6e28 2473 7461 7274 2920   strlen($start) 
+00020fc0: 2d20 7374 726c 656e 2824 656e 6429 3b0a  - strlen($end);.
+00020fd0: 2020 2020 2020 2020 2f2f 4176 6572 6167          //Averag
+00020fe0: 6520 6d75 6c74 692d 6279 7465 2072 6174  e multi-byte rat
+00020ff0: 696f 0a20 2020 2020 2020 2024 7261 7469  io.        $rati
+00021000: 6f20 3d20 246d 625f 6c65 6e67 7468 202f  o = $mb_length /
+00021010: 2073 7472 6c65 6e28 2473 7472 293b 0a20   strlen($str);. 
+00021020: 2020 2020 2020 202f 2f42 6173 6536 3420         //Base64 
+00021030: 6861 7320 6120 343a 3320 7261 7469 6f0a  has a 4:3 ratio.
+00021040: 2020 2020 2020 2020 2461 7667 4c65 6e67          $avgLeng
+00021050: 7468 203d 2066 6c6f 6f72 2824 6c65 6e67  th = floor($leng
+00021060: 7468 202a 2024 7261 7469 6f20 2a20 2e37  th * $ratio * .7
+00021070: 3529 3b0a 0a20 2020 2020 2020 2024 6f66  5);..        $of
+00021080: 6673 6574 203d 2030 3b0a 2020 2020 2020  fset = 0;.      
+00021090: 2020 666f 7220 2824 6920 3d20 303b 2024    for ($i = 0; $
+000210a0: 6920 3c20 246d 625f 6c65 6e67 7468 3b20  i < $mb_length; 
+000210b0: 2469 202b 3d20 246f 6666 7365 7429 207b  $i += $offset) {
+000210c0: 0a20 2020 2020 2020 2020 2020 2024 6c6f  .            $lo
+000210d0: 6f6b 4261 636b 203d 2030 3b0a 2020 2020  okBack = 0;.    
+000210e0: 2020 2020 2020 2020 646f 207b 0a20 2020          do {.   
+000210f0: 2020 2020 2020 2020 2020 2020 2024 6f66               $of
+00021100: 6673 6574 203d 2024 6176 674c 656e 6774  fset = $avgLengt
+00021110: 6820 2d20 246c 6f6f 6b42 6163 6b3b 0a20  h - $lookBack;. 
+00021120: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00021130: 6368 756e 6b20 3d20 6d62 5f73 7562 7374  chunk = mb_subst
+00021140: 7228 2473 7472 2c20 2469 2c20 246f 6666  r($str, $i, $off
+00021150: 7365 742c 2024 7468 6973 2d3e 4368 6172  set, $this->Char
+00021160: 5365 7429 3b0a 2020 2020 2020 2020 2020  Set);.          
+00021170: 2020 2020 2020 2463 6875 6e6b 203d 2062        $chunk = b
+00021180: 6173 6536 345f 656e 636f 6465 2824 6368  ase64_encode($ch
+00021190: 756e 6b29 3b0a 2020 2020 2020 2020 2020  unk);.          
+000211a0: 2020 2020 2020 2b2b 246c 6f6f 6b42 6163        ++$lookBac
+000211b0: 6b3b 0a20 2020 2020 2020 2020 2020 207d  k;.            }
+000211c0: 2077 6869 6c65 2028 7374 726c 656e 2824   while (strlen($
+000211d0: 6368 756e 6b29 203e 2024 6c65 6e67 7468  chunk) > $length
+000211e0: 293b 0a20 2020 2020 2020 2020 2020 2024  );.            $
+000211f0: 656e 636f 6465 6420 2e3d 2024 6368 756e  encoded .= $chun
+00021200: 6b20 2e20 246c 696e 6562 7265 616b 3b0a  k . $linebreak;.
+00021210: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+00021220: 2020 202f 2f43 686f 6d70 2074 6865 206c     //Chomp the l
+00021230: 6173 7420 6c69 6e65 6665 6564 0a20 2020  ast linefeed.   
+00021240: 2020 2020 2072 6574 7572 6e20 7375 6273       return subs
+00021250: 7472 2824 656e 636f 6465 642c 2030 2c20  tr($encoded, 0, 
+00021260: 2d73 7472 6c65 6e28 246c 696e 6562 7265  -strlen($linebre
+00021270: 616b 2929 3b0a 2020 2020 7d0a 0a20 2020  ak));.    }..   
+00021280: 202f 2a2a 0a20 2020 2020 2a20 456e 636f   /**.     * Enco
+00021290: 6465 2061 2073 7472 696e 6720 696e 2071  de a string in q
+000212a0: 756f 7465 642d 7072 696e 7461 626c 6520  uoted-printable 
+000212b0: 666f 726d 6174 2e0a 2020 2020 202a 2041  format..     * A
+000212c0: 6363 6f72 6469 6e67 2074 6f20 5246 4332  ccording to RFC2
+000212d0: 3034 3520 7365 6374 696f 6e20 362e 372e  045 section 6.7.
+000212e0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+000212f0: 7061 7261 6d20 7374 7269 6e67 2024 7374  param string $st
+00021300: 7269 6e67 2054 6865 2074 6578 7420 746f  ring The text to
+00021310: 2065 6e63 6f64 650a 2020 2020 202a 0a20   encode.     *. 
+00021320: 2020 2020 2a20 4072 6574 7572 6e20 7374      * @return st
+00021330: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
+00021340: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+00021350: 2065 6e63 6f64 6551 5028 2473 7472 696e   encodeQP($strin
+00021360: 6729 0a20 2020 207b 0a20 2020 2020 2020  g).    {.       
+00021370: 2072 6574 7572 6e20 7374 6174 6963 3a3a   return static::
+00021380: 6e6f 726d 616c 697a 6542 7265 616b 7328  normalizeBreaks(
+00021390: 7175 6f74 6564 5f70 7269 6e74 6162 6c65  quoted_printable
+000213a0: 5f65 6e63 6f64 6528 2473 7472 696e 6729  _encode($string)
+000213b0: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
+000213c0: 2a0a 2020 2020 202a 2045 6e63 6f64 6520  *.     * Encode 
+000213d0: 6120 7374 7269 6e67 2075 7369 6e67 2051  a string using Q
+000213e0: 2065 6e63 6f64 696e 672e 0a20 2020 2020   encoding..     
+000213f0: 2a0a 2020 2020 202a 2040 7365 6520 6874  *.     * @see ht
+00021400: 7470 3a2f 2f74 6f6f 6c73 2e69 6574 662e  tp://tools.ietf.
+00021410: 6f72 672f 6874 6d6c 2f72 6663 3230 3437  org/html/rfc2047
+00021420: 2373 6563 7469 6f6e 2d34 2e32 0a20 2020  #section-4.2.   
+00021430: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
+00021440: 6d20 7374 7269 6e67 2024 7374 7220 2020  m string $str   
+00021450: 2020 2074 6865 2074 6578 7420 746f 2065     the text to e
+00021460: 6e63 6f64 650a 2020 2020 202a 2040 7061  ncode.     * @pa
+00021470: 7261 6d20 7374 7269 6e67 2024 706f 7369  ram string $posi
+00021480: 7469 6f6e 2057 6865 7265 2074 6865 2074  tion Where the t
+00021490: 6578 7420 6973 2067 6f69 6e67 2074 6f20  ext is going to 
+000214a0: 6265 2075 7365 642c 2073 6565 2074 6865  be used, see the
+000214b0: 2052 4643 2066 6f72 2077 6861 7420 7468   RFC for what th
+000214c0: 6174 206d 6561 6e73 0a20 2020 2020 2a0a  at means.     *.
+000214d0: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
+000214e0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
+000214f0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+00021500: 6e20 656e 636f 6465 5128 2473 7472 2c20  n encodeQ($str, 
+00021510: 2470 6f73 6974 696f 6e20 3d20 2774 6578  $position = 'tex
+00021520: 7427 290a 2020 2020 7b0a 2020 2020 2020  t').    {.      
+00021530: 2020 2f2f 5468 6572 6520 7368 6f75 6c64    //There should
+00021540: 206e 6f74 2062 6520 616e 7920 454f 4c20   not be any EOL 
+00021550: 696e 2074 6865 2073 7472 696e 670a 2020  in the string.  
+00021560: 2020 2020 2020 2470 6174 7465 726e 203d        $pattern =
+00021570: 2027 273b 0a20 2020 2020 2020 2024 656e   '';.        $en
+00021580: 636f 6465 6420 3d20 7374 725f 7265 706c  coded = str_repl
+00021590: 6163 6528 5b22 5c72 222c 2022 5c6e 225d  ace(["\r", "\n"]
+000215a0: 2c20 2727 2c20 2473 7472 293b 0a20 2020  , '', $str);.   
+000215b0: 2020 2020 2073 7769 7463 6820 2873 7472       switch (str
+000215c0: 746f 6c6f 7765 7228 2470 6f73 6974 696f  tolower($positio
+000215d0: 6e29 2920 7b0a 2020 2020 2020 2020 2020  n)) {.          
+000215e0: 2020 6361 7365 2027 7068 7261 7365 273a    case 'phrase':
+000215f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021600: 202f 2f52 4643 2032 3034 3720 7365 6374   //RFC 2047 sect
+00021610: 696f 6e20 352e 330a 2020 2020 2020 2020  ion 5.3.        
+00021620: 2020 2020 2020 2020 2470 6174 7465 726e          $pattern
+00021630: 203d 2027 5e41 2d5a 612d 7a30 2d39 212a   = '^A-Za-z0-9!*
+00021640: 2b5c 2f20 2d27 3b0a 2020 2020 2020 2020  +\/ -';.        
+00021650: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+00021660: 2020 2020 2020 2020 2020 202f 2a0a 2020             /*.  
+00021670: 2020 2020 2020 2020 2020 202a 2052 4643             * RFC
+00021680: 2032 3034 3720 7365 6374 696f 6e20 352e   2047 section 5.
+00021690: 322e 0a20 2020 2020 2020 2020 2020 2020  2..             
+000216a0: 2a20 4275 696c 6420 2470 6174 7465 726e  * Build $pattern
+000216b0: 2077 6974 686f 7574 2069 6e63 6c75 6469   without includi
+000216c0: 6e67 2064 656c 696d 6974 6572 7320 616e  ng delimiters an
+000216d0: 6420 5b5d 0a20 2020 2020 2020 2020 2020  d [].           
+000216e0: 2020 2a2f 0a20 2020 2020 2020 2020 2020    */.           
+000216f0: 202f 2a20 406e 6f69 6e73 7065 6374 696f   /* @noinspectio
+00021700: 6e20 5068 704d 6973 7369 6e67 4272 6561  n PhpMissingBrea
+00021710: 6b53 7461 7465 6d65 6e74 496e 7370 6563  kStatementInspec
+00021720: 7469 6f6e 202a 2f0a 2020 2020 2020 2020  tion */.        
+00021730: 2020 2020 6361 7365 2027 636f 6d6d 656e      case 'commen
+00021740: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+00021750: 2020 2020 2470 6174 7465 726e 203d 2027      $pattern = '
+00021760: 5c28 5c29 2227 3b0a 2020 2020 2020 2020  \(\)"';.        
+00021770: 2020 2020 2f2a 2049 6e74 656e 7469 6f6e      /* Intention
+00021780: 616c 2066 616c 6c20 7468 726f 7567 6820  al fall through 
+00021790: 2a2f 0a20 2020 2020 2020 2020 2020 2063  */.            c
+000217a0: 6173 6520 2774 6578 7427 3a0a 2020 2020  ase 'text':.    
+000217b0: 2020 2020 2020 2020 6465 6661 756c 743a          default:
+000217c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000217d0: 202f 2f52 4643 2032 3034 3720 7365 6374   //RFC 2047 sect
+000217e0: 696f 6e20 352e 310a 2020 2020 2020 2020  ion 5.1.        
+000217f0: 2020 2020 2020 2020 2f2f 5265 706c 6163          //Replac
+00021800: 6520 6576 6572 7920 6869 6768 2061 7363  e every high asc
+00021810: 6969 2c20 636f 6e74 726f 6c2c 203d 2c20  ii, control, =, 
+00021820: 3f20 616e 6420 5f20 6368 6172 6163 7465  ? and _ characte
+00021830: 7273 0a20 2020 2020 2020 2020 2020 2020  rs.             
+00021840: 2020 2024 7061 7474 6572 6e20 3d20 275c     $pattern = '\
+00021850: 3030 302d 5c30 3131 5c30 3133 5c30 3134  000-\011\013\014
+00021860: 5c30 3136 2d5c 3033 375c 3037 355c 3037  \016-\037\075\07
+00021870: 375c 3133 375c 3137 372d 5c33 3737 2720  7\137\177-\377' 
+00021880: 2e20 2470 6174 7465 726e 3b0a 2020 2020  . $pattern;.    
+00021890: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+000218a0: 6b3b 0a20 2020 2020 2020 207d 0a20 2020  k;.        }.   
+000218b0: 2020 2020 2024 6d61 7463 6865 7320 3d20       $matches = 
+000218c0: 5b5d 3b0a 2020 2020 2020 2020 6966 2028  [];.        if (
+000218d0: 7072 6567 5f6d 6174 6368 5f61 6c6c 2822  preg_match_all("
+000218e0: 2f5b 7b24 7061 7474 6572 6e7d 5d2f 222c  /[{$pattern}]/",
+000218f0: 2024 656e 636f 6465 642c 2024 6d61 7463   $encoded, $matc
+00021900: 6865 7329 2920 7b0a 2020 2020 2020 2020  hes)) {.        
+00021910: 2020 2020 2f2f 4966 2074 6865 2073 7472      //If the str
+00021920: 696e 6720 636f 6e74 6169 6e73 2061 6e20  ing contains an 
+00021930: 273d 272c 206d 616b 6520 7375 7265 2069  '=', make sure i
+00021940: 7427 7320 7468 6520 6669 7273 7420 7468  t's the first th
+00021950: 696e 6720 7765 2072 6570 6c61 6365 0a20  ing we replace. 
+00021960: 2020 2020 2020 2020 2020 202f 2f73 6f20             //so 
+00021970: 6173 2074 6f20 6176 6f69 6420 646f 7562  as to avoid doub
+00021980: 6c65 2d65 6e63 6f64 696e 670a 2020 2020  le-encoding.    
+00021990: 2020 2020 2020 2020 2465 716b 6579 203d          $eqkey =
+000219a0: 2061 7272 6179 5f73 6561 7263 6828 273d   array_search('=
+000219b0: 272c 2024 6d61 7463 6865 735b 305d 2c20  ', $matches[0], 
+000219c0: 7472 7565 293b 0a20 2020 2020 2020 2020  true);.         
+000219d0: 2020 2069 6620 2866 616c 7365 2021 3d3d     if (false !==
+000219e0: 2024 6571 6b65 7929 207b 0a20 2020 2020   $eqkey) {.     
+000219f0: 2020 2020 2020 2020 2020 2075 6e73 6574             unset
+00021a00: 2824 6d61 7463 6865 735b 305d 5b24 6571  ($matches[0][$eq
+00021a10: 6b65 795d 293b 0a20 2020 2020 2020 2020  key]);.         
+00021a20: 2020 2020 2020 2061 7272 6179 5f75 6e73         array_uns
+00021a30: 6869 6674 2824 6d61 7463 6865 735b 305d  hift($matches[0]
+00021a40: 2c20 273d 2729 3b0a 2020 2020 2020 2020  , '=');.        
+00021a50: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00021a60: 2020 666f 7265 6163 6820 2861 7272 6179    foreach (array
+00021a70: 5f75 6e69 7175 6528 246d 6174 6368 6573  _unique($matches
+00021a80: 5b30 5d29 2061 7320 2463 6861 7229 207b  [0]) as $char) {
+00021a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021aa0: 2024 656e 636f 6465 6420 3d20 7374 725f   $encoded = str_
+00021ab0: 7265 706c 6163 6528 2463 6861 722c 2027  replace($char, '
+00021ac0: 3d27 202e 2073 7072 696e 7466 2827 2530  =' . sprintf('%0
+00021ad0: 3258 272c 206f 7264 2824 6368 6172 2929  2X', ord($char))
+00021ae0: 2c20 2465 6e63 6f64 6564 293b 0a20 2020  , $encoded);.   
+00021af0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00021b00: 2020 207d 0a20 2020 2020 2020 202f 2f52     }.        //R
+00021b10: 6570 6c61 6365 2073 7061 6365 7320 7769  eplace spaces wi
+00021b20: 7468 205f 2028 6d6f 7265 2072 6561 6461  th _ (more reada
+00021b30: 626c 6520 7468 616e 203d 3230 290a 2020  ble than =20).  
+00021b40: 2020 2020 2020 2f2f 5246 4320 3230 3437        //RFC 2047
+00021b50: 2073 6563 7469 6f6e 2034 2e32 2832 290a   section 4.2(2).
+00021b60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00021b70: 7472 5f72 6570 6c61 6365 2827 2027 2c20  tr_replace(' ', 
+00021b80: 275f 272c 2024 656e 636f 6465 6429 3b0a  '_', $encoded);.
+00021b90: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+00021ba0: 2020 2020 2a20 4164 6420 6120 7374 7269      * Add a stri
+00021bb0: 6e67 206f 7220 6269 6e61 7279 2061 7474  ng or binary att
+00021bc0: 6163 686d 656e 7420 286e 6f6e 2d66 696c  achment (non-fil
+00021bd0: 6573 7973 7465 6d29 2e0a 2020 2020 202a  esystem)..     *
+00021be0: 2054 6869 7320 6d65 7468 6f64 2063 616e   This method can
+00021bf0: 2062 6520 7573 6564 2074 6f20 6174 7461   be used to atta
+00021c00: 6368 2061 7363 6969 206f 7220 6269 6e61  ch ascii or bina
+00021c10: 7279 2064 6174 612c 0a20 2020 2020 2a20  ry data,.     * 
+00021c20: 7375 6368 2061 7320 6120 424c 4f42 2072  such as a BLOB r
+00021c30: 6563 6f72 6420 6672 6f6d 2061 2064 6174  ecord from a dat
+00021c40: 6162 6173 652e 0a20 2020 2020 2a0a 2020  abase..     *.  
+00021c50: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00021c60: 6e67 2024 7374 7269 6e67 2020 2020 2020  ng $string      
+00021c70: 5374 7269 6e67 2061 7474 6163 686d 656e  String attachmen
+00021c80: 7420 6461 7461 0a20 2020 2020 2a20 4070  t data.     * @p
+00021c90: 6172 616d 2073 7472 696e 6720 2466 696c  aram string $fil
+00021ca0: 656e 616d 6520 2020 204e 616d 6520 6f66  ename    Name of
+00021cb0: 2074 6865 2061 7474 6163 686d 656e 740a   the attachment.
+00021cc0: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+00021cd0: 7269 6e67 2024 656e 636f 6469 6e67 2020  ring $encoding  
+00021ce0: 2020 4669 6c65 2065 6e63 6f64 696e 6720    File encoding 
+00021cf0: 2873 6565 2024 456e 636f 6469 6e67 290a  (see $Encoding).
+00021d00: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+00021d10: 7269 6e67 2024 7479 7065 2020 2020 2020  ring $type      
+00021d20: 2020 4669 6c65 2065 7874 656e 7369 6f6e    File extension
+00021d30: 2028 4d49 4d45 2920 7479 7065 0a20 2020   (MIME) type.   
+00021d40: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00021d50: 6720 2464 6973 706f 7369 7469 6f6e 2044  g $disposition D
+00021d60: 6973 706f 7369 7469 6f6e 2074 6f20 7573  isposition to us
+00021d70: 650a 2020 2020 202a 0a20 2020 2020 2a20  e.     *.     * 
+00021d80: 4074 6872 6f77 7320 4578 6365 7074 696f  @throws Exceptio
+00021d90: 6e0a 2020 2020 202a 0a20 2020 2020 2a20  n.     *.     * 
+00021da0: 4072 6574 7572 6e20 626f 6f6c 2054 7275  @return bool Tru
+00021db0: 6520 6f6e 2073 7563 6365 7373 6675 6c6c  e on successfull
+00021dc0: 7920 6164 6469 6e67 2061 6e20 6174 7461  y adding an atta
+00021dd0: 6368 6d65 6e74 0a20 2020 2020 2a2f 0a20  chment.     */. 
+00021de0: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
+00021df0: 6f6e 2061 6464 5374 7269 6e67 4174 7461  on addStringAtta
+00021e00: 6368 6d65 6e74 280a 2020 2020 2020 2020  chment(.        
+00021e10: 2473 7472 696e 672c 0a20 2020 2020 2020  $string,.       
+00021e20: 2024 6669 6c65 6e61 6d65 2c0a 2020 2020   $filename,.    
+00021e30: 2020 2020 2465 6e63 6f64 696e 6720 3d20      $encoding = 
+00021e40: 7365 6c66 3a3a 454e 434f 4449 4e47 5f42  self::ENCODING_B
+00021e50: 4153 4536 342c 0a20 2020 2020 2020 2024  ASE64,.        $
+00021e60: 7479 7065 203d 2027 272c 0a20 2020 2020  type = '',.     
+00021e70: 2020 2024 6469 7370 6f73 6974 696f 6e20     $disposition 
+00021e80: 3d20 2761 7474 6163 686d 656e 7427 0a20  = 'attachment'. 
+00021e90: 2020 2029 207b 0a20 2020 2020 2020 2074     ) {.        t
+00021ea0: 7279 207b 0a20 2020 2020 2020 2020 2020  ry {.           
+00021eb0: 202f 2f49 6620 6120 4d49 4d45 2074 7970   //If a MIME typ
+00021ec0: 6520 6973 206e 6f74 2073 7065 6369 6669  e is not specifi
+00021ed0: 6564 2c20 7472 7920 746f 2077 6f72 6b20  ed, try to work 
+00021ee0: 6974 206f 7574 2066 726f 6d20 7468 6520  it out from the 
+00021ef0: 6669 6c65 206e 616d 650a 2020 2020 2020  file name.      
+00021f00: 2020 2020 2020 6966 2028 2727 203d 3d3d        if ('' ===
+00021f10: 2024 7479 7065 2920 7b0a 2020 2020 2020   $type) {.      
+00021f20: 2020 2020 2020 2020 2020 2474 7970 6520            $type 
+00021f30: 3d20 7374 6174 6963 3a3a 6669 6c65 6e61  = static::filena
+00021f40: 6d65 546f 5479 7065 2824 6669 6c65 6e61  meToType($filena
+00021f50: 6d65 293b 0a20 2020 2020 2020 2020 2020  me);.           
+00021f60: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
+00021f70: 6966 2028 2124 7468 6973 2d3e 7661 6c69  if (!$this->vali
+00021f80: 6461 7465 456e 636f 6469 6e67 2824 656e  dateEncoding($en
+00021f90: 636f 6469 6e67 2929 207b 0a20 2020 2020  coding)) {.     
+00021fa0: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
+00021fb0: 206e 6577 2045 7863 6570 7469 6f6e 2824   new Exception($
+00021fc0: 7468 6973 2d3e 6c61 6e67 2827 656e 636f  this->lang('enco
+00021fd0: 6469 6e67 2729 202e 2024 656e 636f 6469  ding') . $encodi
+00021fe0: 6e67 293b 0a20 2020 2020 2020 2020 2020  ng);.           
+00021ff0: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
+00022000: 2f2f 4170 7065 6e64 2074 6f20 2461 7474  //Append to $att
+00022010: 6163 686d 656e 7420 6172 7261 790a 2020  achment array.  
+00022020: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00022030: 3e61 7474 6163 686d 656e 745b 5d20 3d20  >attachment[] = 
+00022040: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00022050: 2020 3020 3d3e 2024 7374 7269 6e67 2c0a    0 => $string,.
+00022060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022070: 3120 3d3e 2024 6669 6c65 6e61 6d65 2c0a  1 => $filename,.
+00022080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022090: 3220 3d3e 2073 7461 7469 633a 3a6d 625f  2 => static::mb_
+000220a0: 7061 7468 696e 666f 2824 6669 6c65 6e61  pathinfo($filena
+000220b0: 6d65 2c20 5041 5448 494e 464f 5f42 4153  me, PATHINFO_BAS
+000220c0: 454e 414d 4529 2c0a 2020 2020 2020 2020  ENAME),.        
+000220d0: 2020 2020 2020 2020 3320 3d3e 2024 656e          3 => $en
+000220e0: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
+000220f0: 2020 2020 2020 2020 3420 3d3e 2024 7479          4 => $ty
+00022100: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00022110: 2020 2020 3520 3d3e 2074 7275 652c 202f      5 => true, /
+00022120: 2f69 7353 7472 696e 6741 7474 6163 686d  /isStringAttachm
+00022130: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00022140: 2020 2020 3620 3d3e 2024 6469 7370 6f73      6 => $dispos
+00022150: 6974 696f 6e2c 0a20 2020 2020 2020 2020  ition,.         
+00022160: 2020 2020 2020 2037 203d 3e20 302c 0a20         7 => 0,. 
+00022170: 2020 2020 2020 2020 2020 205d 3b0a 2020             ];.  
+00022180: 2020 2020 2020 7d20 6361 7463 6820 2845        } catch (E
+00022190: 7863 6570 7469 6f6e 2024 6578 6329 207b  xception $exc) {
+000221a0: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
+000221b0: 6973 2d3e 7365 7445 7272 6f72 2824 6578  is->setError($ex
+000221c0: 632d 3e67 6574 4d65 7373 6167 6528 2929  c->getMessage())
+000221d0: 3b0a 2020 2020 2020 2020 2020 2020 2474  ;.            $t
+000221e0: 6869 732d 3e65 6465 6275 6728 2465 7863  his->edebug($exc
+000221f0: 2d3e 6765 744d 6573 7361 6765 2829 293b  ->getMessage());
+00022200: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00022210: 2824 7468 6973 2d3e 6578 6365 7074 696f  ($this->exceptio
+00022220: 6e73 2920 7b0a 2020 2020 2020 2020 2020  ns) {.          
+00022230: 2020 2020 2020 7468 726f 7720 2465 7863        throw $exc
+00022240: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
+00022250: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00022260: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
+00022270: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+00022280: 7475 726e 2074 7275 653b 0a20 2020 207d  turn true;.    }
+00022290: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+000222a0: 2041 6464 2061 6e20 656d 6265 6464 6564   Add an embedded
+000222b0: 2028 696e 6c69 6e65 2920 6174 7461 6368   (inline) attach
+000222c0: 6d65 6e74 2066 726f 6d20 6120 6669 6c65  ment from a file
+000222d0: 2e0a 2020 2020 202a 2054 6869 7320 6361  ..     * This ca
+000222e0: 6e20 696e 636c 7564 6520 696d 6167 6573  n include images
+000222f0: 2c20 736f 756e 6473 2c20 616e 6420 6a75  , sounds, and ju
+00022300: 7374 2061 626f 7574 2061 6e79 206f 7468  st about any oth
+00022310: 6572 2064 6f63 756d 656e 7420 7479 7065  er document type
+00022320: 2e0a 2020 2020 202a 2054 6865 7365 2064  ..     * These d
+00022330: 6966 6665 7220 6672 6f6d 2027 7265 6775  iffer from 'regu
+00022340: 6c61 7227 2061 7474 6163 686d 656e 7473  lar' attachments
+00022350: 2069 6e20 7468 6174 2074 6865 7920 6172   in that they ar
+00022360: 6520 696e 7465 6e64 6564 2074 6f20 6265  e intended to be
+00022370: 0a20 2020 2020 2a20 6469 7370 6c61 7965  .     * displaye
+00022380: 6420 696e 6c69 6e65 2077 6974 6820 7468  d inline with th
+00022390: 6520 6d65 7373 6167 652c 206e 6f74 206a  e message, not j
+000223a0: 7573 7420 6174 7461 6368 6564 2066 6f72  ust attached for
+000223b0: 2064 6f77 6e6c 6f61 642e 0a20 2020 2020   download..     
+000223c0: 2a20 5468 6973 2069 7320 7573 6564 2069  * This is used i
+000223d0: 6e20 4854 4d4c 206d 6573 7361 6765 7320  n HTML messages 
+000223e0: 7468 6174 2065 6d62 6564 2074 6865 2069  that embed the i
+000223f0: 6d61 6765 730a 2020 2020 202a 2074 6865  mages.     * the
+00022400: 2048 544d 4c20 7265 6665 7273 2074 6f20   HTML refers to 
+00022410: 7573 696e 6720 7468 6520 6024 6369 6460  using the `$cid`
+00022420: 2076 616c 7565 2069 6e20 6069 6d67 6020   value in `img` 
+00022430: 7461 6773 2c20 666f 7220 6578 616d 706c  tags, for exampl
+00022440: 6520 603c 696d 6720 7372 633d 2263 6964  e `<img src="cid
+00022450: 3a6d 796c 6f67 6f22 3e60 2e0a 2020 2020  :mylogo">`..    
+00022460: 202a 204e 6576 6572 2075 7365 2061 2075   * Never use a u
+00022470: 7365 722d 7375 7070 6c69 6564 2070 6174  ser-supplied pat
+00022480: 6820 746f 2061 2066 696c 6521 0a20 2020  h to a file!.   
+00022490: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
+000224a0: 6d20 7374 7269 6e67 2024 7061 7468 2020  m string $path  
+000224b0: 2020 2020 2020 5061 7468 2074 6f20 7468        Path to th
+000224c0: 6520 6174 7461 6368 6d65 6e74 0a20 2020  e attachment.   
+000224d0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+000224e0: 6720 2463 6964 2020 2020 2020 2020 2043  g $cid         C
+000224f0: 6f6e 7465 6e74 2049 4420 6f66 2074 6865  ontent ID of the
+00022500: 2061 7474 6163 686d 656e 743b 2055 7365   attachment; Use
+00022510: 2074 6869 7320 746f 2072 6566 6572 656e   this to referen
+00022520: 6365 0a20 2020 2020 2a20 2020 2020 2020  ce.     *       
+00022530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022540: 2020 2020 2074 6865 2063 6f6e 7465 6e74       the content
+00022550: 2077 6865 6e20 7573 696e 6720 616e 2065   when using an e
+00022560: 6d62 6564 6465 6420 696d 6167 6520 696e  mbedded image in
+00022570: 2048 544d 4c0a 2020 2020 202a 2040 7061   HTML.     * @pa
+00022580: 7261 6d20 7374 7269 6e67 2024 6e61 6d65  ram string $name
+00022590: 2020 2020 2020 2020 4f76 6572 7269 6465          Override
+000225a0: 7320 7468 6520 6174 7461 6368 6d65 6e74  s the attachment
+000225b0: 2066 696c 656e 616d 650a 2020 2020 202a   filename.     *
+000225c0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+000225d0: 656e 636f 6469 6e67 2020 2020 4669 6c65  encoding    File
+000225e0: 2065 6e63 6f64 696e 6720 2873 6565 2024   encoding (see $
+000225f0: 456e 636f 6469 6e67 2920 6465 6661 756c  Encoding) defaul
+00022600: 7473 2074 6f20 6062 6173 6536 3460 0a20  ts to `base64`. 
+00022610: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00022620: 696e 6720 2474 7970 6520 2020 2020 2020  ing $type       
+00022630: 2046 696c 6520 4d49 4d45 2074 7970 6520   File MIME type 
+00022640: 2862 7920 6465 6661 756c 7420 6d61 7070  (by default mapp
+00022650: 6564 2066 726f 6d20 7468 6520 6024 7061  ed from the `$pa
+00022660: 7468 6020 6669 6c65 6e61 6d65 2773 2065  th` filename's e
+00022670: 7874 656e 7369 6f6e 290a 2020 2020 202a  xtension).     *
+00022680: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+00022690: 6469 7370 6f73 6974 696f 6e20 4469 7370  disposition Disp
+000226a0: 6f73 6974 696f 6e20 746f 2075 7365 3a20  osition to use: 
+000226b0: 6069 6e6c 696e 6560 2028 6465 6661 756c  `inline` (defaul
+000226c0: 7429 206f 7220 6061 7474 6163 686d 656e  t) or `attachmen
+000226d0: 7460 0a20 2020 2020 2a20 2020 2020 2020  t`.     *       
+000226e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226f0: 2020 2020 2028 756e 6c69 6b65 6c79 2079       (unlikely y
+00022700: 6f75 2077 616e 7420 7468 6973 20e2 8093  ou want this ...
+00022710: 207b 4073 6565 2060 6164 6441 7474 6163   {@see `addAttac
+00022720: 686d 656e 7428 2960 7d20 696e 7374 6561  hment()`} instea
+00022730: 6429 0a20 2020 2020 2a0a 2020 2020 202a  d).     *.     *
+00022740: 2040 7265 7475 726e 2062 6f6f 6c20 5472   @return bool Tr
+00022750: 7565 206f 6e20 7375 6363 6573 7366 756c  ue on successful
+00022760: 6c79 2061 6464 696e 6720 616e 2061 7474  ly adding an att
+00022770: 6163 686d 656e 740a 2020 2020 202a 2040  achment.     * @
+00022780: 7468 726f 7773 2045 7863 6570 7469 6f6e  throws Exception
+00022790: 0a20 2020 2020 2a0a 2020 2020 202a 2f0a  .     *.     */.
+000227a0: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+000227b0: 696f 6e20 6164 6445 6d62 6564 6465 6449  ion addEmbeddedI
+000227c0: 6d61 6765 280a 2020 2020 2020 2020 2470  mage(.        $p
+000227d0: 6174 682c 0a20 2020 2020 2020 2024 6369  ath,.        $ci
+000227e0: 642c 0a20 2020 2020 2020 2024 6e61 6d65  d,.        $name
+000227f0: 203d 2027 272c 0a20 2020 2020 2020 2024   = '',.        $
+00022800: 656e 636f 6469 6e67 203d 2073 656c 663a  encoding = self:
+00022810: 3a45 4e43 4f44 494e 475f 4241 5345 3634  :ENCODING_BASE64
+00022820: 2c0a 2020 2020 2020 2020 2474 7970 6520  ,.        $type 
+00022830: 3d20 2727 2c0a 2020 2020 2020 2020 2464  = '',.        $d
+00022840: 6973 706f 7369 7469 6f6e 203d 2027 696e  isposition = 'in
+00022850: 6c69 6e65 270a 2020 2020 2920 7b0a 2020  line'.    ) {.  
+00022860: 2020 2020 2020 7472 7920 7b0a 2020 2020        try {.    
+00022870: 2020 2020 2020 2020 6966 2028 2173 7461          if (!sta
+00022880: 7469 633a 3a66 696c 6549 7341 6363 6573  tic::fileIsAcces
+00022890: 7369 626c 6528 2470 6174 6829 2920 7b0a  sible($path)) {.
 000228a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228b0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
-000228c0: 6578 616d 706c 6520 2766 696c 652e 6a70  example 'file.jp
-000228d0: 6727 2077 6f75 6c64 2067 6574 2061 6e20  g' would get an 
-000228e0: 2769 6d61 6765 2f6a 7065 6727 204d 494d  'image/jpeg' MIM
-000228f0: 4520 7479 7065 2e0a 2020 2020 202a 2040  E type..     * @
-00022900: 7061 7261 6d20 7374 7269 6e67 2024 656e  param string $en
-00022910: 636f 6469 6e67 2020 2020 4669 6c65 2065  coding    File e
-00022920: 6e63 6f64 696e 6720 2873 6565 2024 456e  ncoding (see $En
-00022930: 636f 6469 6e67 292c 2064 6566 6175 6c74  coding), default
-00022940: 7320 746f 2027 6261 7365 3634 270a 2020  s to 'base64'.  
-00022950: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-00022960: 6e67 2024 7479 7065 2020 2020 2020 2020  ng $type        
-00022970: 4d49 4d45 2074 7970 6520 2d20 7769 6c6c  MIME type - will
-00022980: 2062 6520 7573 6564 2069 6e20 7072 6566   be used in pref
-00022990: 6572 656e 6365 2074 6f20 616e 7920 6175  erence to any au
-000229a0: 746f 6d61 7469 6361 6c6c 7920 6465 7269  tomatically deri
-000229b0: 7665 6420 7479 7065 0a20 2020 2020 2a20  ved type.     * 
-000229c0: 4070 6172 616d 2073 7472 696e 6720 2464  @param string $d
-000229d0: 6973 706f 7369 7469 6f6e 2044 6973 706f  isposition Dispo
-000229e0: 7369 7469 6f6e 2074 6f20 7573 650a 2020  sition to use.  
-000229f0: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
-00022a00: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
-00022a10: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00022a20: 7572 6e20 626f 6f6c 2054 7275 6520 6f6e  urn bool True on
-00022a30: 2073 7563 6365 7373 6675 6c6c 7920 6164   successfully ad
-00022a40: 6469 6e67 2061 6e20 6174 7461 6368 6d65  ding an attachme
-00022a50: 6e74 0a20 2020 2020 2a2f 0a20 2020 2070  nt.     */.    p
-00022a60: 7562 6c69 6320 6675 6e63 7469 6f6e 2061  ublic function a
-00022a70: 6464 5374 7269 6e67 456d 6265 6464 6564  ddStringEmbedded
-00022a80: 496d 6167 6528 0a20 2020 2020 2020 2024  Image(.        $
-00022a90: 7374 7269 6e67 2c0a 2020 2020 2020 2020  string,.        
-00022aa0: 2463 6964 2c0a 2020 2020 2020 2020 246e  $cid,.        $n
-00022ab0: 616d 6520 3d20 2727 2c0a 2020 2020 2020  ame = '',.      
-00022ac0: 2020 2465 6e63 6f64 696e 6720 3d20 7365    $encoding = se
-00022ad0: 6c66 3a3a 454e 434f 4449 4e47 5f42 4153  lf::ENCODING_BAS
-00022ae0: 4536 342c 0a20 2020 2020 2020 2024 7479  E64,.        $ty
-00022af0: 7065 203d 2027 272c 0a20 2020 2020 2020  pe = '',.       
-00022b00: 2024 6469 7370 6f73 6974 696f 6e20 3d20   $disposition = 
-00022b10: 2769 6e6c 696e 6527 0a20 2020 2029 207b  'inline'.    ) {
-00022b20: 0a20 2020 2020 2020 2074 7279 207b 0a20  .        try {. 
-00022b30: 2020 2020 2020 2020 2020 202f 2f49 6620             //If 
-00022b40: 6120 4d49 4d45 2074 7970 6520 6973 206e  a MIME type is n
-00022b50: 6f74 2073 7065 6369 6669 6564 2c20 7472  ot specified, tr
-00022b60: 7920 746f 2077 6f72 6b20 6974 206f 7574  y to work it out
-00022b70: 2066 726f 6d20 7468 6520 6e61 6d65 0a20   from the name. 
-00022b80: 2020 2020 2020 2020 2020 2069 6620 2827             if ('
-00022b90: 2720 3d3d 3d20 2474 7970 6520 2626 2021  ' === $type && !
-00022ba0: 656d 7074 7928 246e 616d 6529 2920 7b0a  empty($name)) {.
-00022bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bc0: 2474 7970 6520 3d20 7374 6174 6963 3a3a  $type = static::
-00022bd0: 6669 6c65 6e61 6d65 546f 5479 7065 2824  filenameToType($
-00022be0: 6e61 6d65 293b 0a20 2020 2020 2020 2020  name);.         
-00022bf0: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-00022c00: 2020 6966 2028 2124 7468 6973 2d3e 7661    if (!$this->va
-00022c10: 6c69 6461 7465 456e 636f 6469 6e67 2824  lidateEncoding($
-00022c20: 656e 636f 6469 6e67 2929 207b 0a20 2020  encoding)) {.   
-00022c30: 2020 2020 2020 2020 2020 2020 2074 6872               thr
-00022c40: 6f77 206e 6577 2045 7863 6570 7469 6f6e  ow new Exception
-00022c50: 2824 7468 6973 2d3e 6c61 6e67 2827 656e  ($this->lang('en
-00022c60: 636f 6469 6e67 2729 202e 2024 656e 636f  coding') . $enco
-00022c70: 6469 6e67 293b 0a20 2020 2020 2020 2020  ding);.         
-00022c80: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-00022c90: 2020 2f2f 4170 7065 6e64 2074 6f20 2461    //Append to $a
-00022ca0: 7474 6163 686d 656e 7420 6172 7261 790a  ttachment array.
-00022cb0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-00022cc0: 732d 3e61 7474 6163 686d 656e 745b 5d20  s->attachment[] 
-00022cd0: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-00022ce0: 2020 2020 3020 3d3e 2024 7374 7269 6e67      0 => $string
-00022cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00022d00: 2020 3120 3d3e 2024 6e61 6d65 2c0a 2020    1 => $name,.  
-00022d10: 2020 2020 2020 2020 2020 2020 2020 3220                2 
-00022d20: 3d3e 2024 6e61 6d65 2c0a 2020 2020 2020  => $name,.      
-00022d30: 2020 2020 2020 2020 2020 3320 3d3e 2024            3 => $
-00022d40: 656e 636f 6469 6e67 2c0a 2020 2020 2020  encoding,.      
-00022d50: 2020 2020 2020 2020 2020 3420 3d3e 2024            4 => $
-00022d60: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-00022d70: 2020 2020 2020 3520 3d3e 2074 7275 652c        5 => true,
-00022d80: 202f 2f69 7353 7472 696e 6741 7474 6163   //isStringAttac
-00022d90: 686d 656e 740a 2020 2020 2020 2020 2020  hment.          
-00022da0: 2020 2020 2020 3620 3d3e 2024 6469 7370        6 => $disp
-00022db0: 6f73 6974 696f 6e2c 0a20 2020 2020 2020  osition,.       
-00022dc0: 2020 2020 2020 2020 2037 203d 3e20 2463           7 => $c
-00022dd0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-00022de0: 5d3b 0a20 2020 2020 2020 207d 2063 6174  ];.        } cat
-00022df0: 6368 2028 4578 6365 7074 696f 6e20 2465  ch (Exception $e
-00022e00: 7863 2920 7b0a 2020 2020 2020 2020 2020  xc) {.          
-00022e10: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
-00022e20: 7228 2465 7863 2d3e 6765 744d 6573 7361  r($exc->getMessa
-00022e30: 6765 2829 293b 0a20 2020 2020 2020 2020  ge());.         
-00022e40: 2020 2024 7468 6973 2d3e 6564 6562 7567     $this->edebug
-00022e50: 2824 6578 632d 3e67 6574 4d65 7373 6167  ($exc->getMessag
-00022e60: 6528 2929 3b0a 2020 2020 2020 2020 2020  e());.          
-00022e70: 2020 6966 2028 2474 6869 732d 3e65 7863    if ($this->exc
-00022e80: 6570 7469 6f6e 7329 207b 0a20 2020 2020  eptions) {.     
-00022e90: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
-00022ea0: 2024 6578 633b 0a20 2020 2020 2020 2020   $exc;.         
-00022eb0: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-00022ec0: 2020 7265 7475 726e 2066 616c 7365 3b0a    return false;.
-00022ed0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00022ee0: 2020 2072 6574 7572 6e20 7472 7565 3b0a     return true;.
-00022ef0: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
-00022f00: 2020 2020 2a20 5661 6c69 6461 7465 2065      * Validate e
-00022f10: 6e63 6f64 696e 6773 2e0a 2020 2020 202a  ncodings..     *
-00022f20: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00022f30: 7472 696e 6720 2465 6e63 6f64 696e 670a  tring $encoding.
-00022f40: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00022f50: 6574 7572 6e20 626f 6f6c 0a20 2020 2020  eturn bool.     
-00022f60: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
-00022f70: 2066 756e 6374 696f 6e20 7661 6c69 6461   function valida
-00022f80: 7465 456e 636f 6469 6e67 2824 656e 636f  teEncoding($enco
-00022f90: 6469 6e67 290a 2020 2020 7b0a 2020 2020  ding).    {.    
-00022fa0: 2020 2020 7265 7475 726e 2069 6e5f 6172      return in_ar
-00022fb0: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
-00022fc0: 2024 656e 636f 6469 6e67 2c0a 2020 2020   $encoding,.    
-00022fd0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-00022fe0: 2020 2020 2020 2020 2020 7365 6c66 3a3a            self::
-00022ff0: 454e 434f 4449 4e47 5f37 4249 542c 0a20  ENCODING_7BIT,. 
-00023000: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00023010: 656c 663a 3a45 4e43 4f44 494e 475f 5155  elf::ENCODING_QU
-00023020: 4f54 4544 5f50 5249 4e54 4142 4c45 2c0a  OTED_PRINTABLE,.
-00023030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023040: 7365 6c66 3a3a 454e 434f 4449 4e47 5f42  self::ENCODING_B
-00023050: 4153 4536 342c 0a20 2020 2020 2020 2020  ASE64,.         
-00023060: 2020 2020 2020 2073 656c 663a 3a45 4e43         self::ENC
-00023070: 4f44 494e 475f 3842 4954 2c0a 2020 2020  ODING_8BIT,.    
-00023080: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00023090: 3a3a 454e 434f 4449 4e47 5f42 494e 4152  ::ENCODING_BINAR
-000230a0: 592c 0a20 2020 2020 2020 2020 2020 205d  Y,.            ]
-000230b0: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
-000230c0: 7565 0a20 2020 2020 2020 2029 3b0a 2020  ue.        );.  
-000230d0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-000230e0: 2020 2a20 4368 6563 6b20 6966 2061 6e20    * Check if an 
-000230f0: 656d 6265 6464 6564 2061 7474 6163 686d  embedded attachm
-00023100: 656e 7420 6973 2070 7265 7365 6e74 2077  ent is present w
-00023110: 6974 6820 7468 6973 2063 6964 2e0a 2020  ith this cid..  
-00023120: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
-00023130: 616d 2073 7472 696e 6720 2463 6964 0a20  am string $cid. 
-00023140: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-00023150: 7475 726e 2062 6f6f 6c0a 2020 2020 202a  turn bool.     *
-00023160: 2f0a 2020 2020 7072 6f74 6563 7465 6420  /.    protected 
-00023170: 6675 6e63 7469 6f6e 2063 6964 4578 6973  function cidExis
-00023180: 7473 2824 6369 6429 0a20 2020 207b 0a20  ts($cid).    {. 
-00023190: 2020 2020 2020 2066 6f72 6561 6368 2028         foreach (
-000231a0: 2474 6869 732d 3e61 7474 6163 686d 656e  $this->attachmen
-000231b0: 7420 6173 2024 6174 7461 6368 6d65 6e74  t as $attachment
-000231c0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-000231d0: 6966 2028 2769 6e6c 696e 6527 203d 3d3d  if ('inline' ===
-000231e0: 2024 6174 7461 6368 6d65 6e74 5b36 5d20   $attachment[6] 
-000231f0: 2626 2024 6369 6420 3d3d 3d20 2461 7474  && $cid === $att
-00023200: 6163 686d 656e 745b 375d 2920 7b0a 2020  achment[7]) {.  
-00023210: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00023220: 7475 726e 2074 7275 653b 0a20 2020 2020  turn true;.     
-00023230: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00023240: 207d 0a0a 2020 2020 2020 2020 7265 7475   }..        retu
-00023250: 726e 2066 616c 7365 3b0a 2020 2020 7d0a  rn false;.    }.
-00023260: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00023270: 4368 6563 6b20 6966 2061 6e20 696e 6c69  Check if an inli
-00023280: 6e65 2061 7474 6163 686d 656e 7420 6973  ne attachment is
-00023290: 2070 7265 7365 6e74 2e0a 2020 2020 202a   present..     *
-000232a0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
-000232b0: 626f 6f6c 0a20 2020 2020 2a2f 0a20 2020  bool.     */.   
-000232c0: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-000232d0: 2069 6e6c 696e 6549 6d61 6765 4578 6973   inlineImageExis
-000232e0: 7473 2829 0a20 2020 207b 0a20 2020 2020  ts().    {.     
-000232f0: 2020 2066 6f72 6561 6368 2028 2474 6869     foreach ($thi
-00023300: 732d 3e61 7474 6163 686d 656e 7420 6173  s->attachment as
-00023310: 2024 6174 7461 6368 6d65 6e74 2920 7b0a   $attachment) {.
-00023320: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00023330: 2769 6e6c 696e 6527 203d 3d3d 2024 6174  'inline' === $at
-00023340: 7461 6368 6d65 6e74 5b36 5d29 207b 0a20  tachment[6]) {. 
-00023350: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00023360: 6574 7572 6e20 7472 7565 3b0a 2020 2020  eturn true;.    
-00023370: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00023380: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
-00023390: 7572 6e20 6661 6c73 653b 0a20 2020 207d  urn false;.    }
-000233a0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-000233b0: 2043 6865 636b 2069 6620 616e 2061 7474   Check if an att
-000233c0: 6163 686d 656e 7420 286e 6f6e 2d69 6e6c  achment (non-inl
-000233d0: 696e 6529 2069 7320 7072 6573 656e 742e  ine) is present.
-000233e0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-000233f0: 7265 7475 726e 2062 6f6f 6c0a 2020 2020  return bool.    
-00023400: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-00023410: 756e 6374 696f 6e20 6174 7461 6368 6d65  unction attachme
-00023420: 6e74 4578 6973 7473 2829 0a20 2020 207b  ntExists().    {
-00023430: 0a20 2020 2020 2020 2066 6f72 6561 6368  .        foreach
-00023440: 2028 2474 6869 732d 3e61 7474 6163 686d   ($this->attachm
-00023450: 656e 7420 6173 2024 6174 7461 6368 6d65  ent as $attachme
-00023460: 6e74 2920 7b0a 2020 2020 2020 2020 2020  nt) {.          
-00023470: 2020 6966 2028 2761 7474 6163 686d 656e    if ('attachmen
-00023480: 7427 203d 3d3d 2024 6174 7461 6368 6d65  t' === $attachme
-00023490: 6e74 5b36 5d29 207b 0a20 2020 2020 2020  nt[6]) {.       
-000234a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000234b0: 7472 7565 3b0a 2020 2020 2020 2020 2020  true;.          
-000234c0: 2020 7d0a 2020 2020 2020 2020 7d0a 0a20    }.        }.. 
-000234d0: 2020 2020 2020 2072 6574 7572 6e20 6661         return fa
-000234e0: 6c73 653b 0a20 2020 207d 0a0a 2020 2020  lse;.    }..    
-000234f0: 2f2a 2a0a 2020 2020 202a 2043 6865 636b  /**.     * Check
-00023500: 2069 6620 7468 6973 206d 6573 7361 6765   if this message
-00023510: 2068 6173 2061 6e20 616c 7465 726e 6174   has an alternat
-00023520: 6976 6520 626f 6479 2073 6574 2e0a 2020  ive body set..  
-00023530: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00023540: 7572 6e20 626f 6f6c 0a20 2020 2020 2a2f  urn bool.     */
-00023550: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00023560: 7469 6f6e 2061 6c74 6572 6e61 7469 7665  tion alternative
-00023570: 4578 6973 7473 2829 0a20 2020 207b 0a20  Exists().    {. 
-00023580: 2020 2020 2020 2072 6574 7572 6e20 2165         return !e
-00023590: 6d70 7479 2824 7468 6973 2d3e 416c 7442  mpty($this->AltB
-000235a0: 6f64 7929 3b0a 2020 2020 7d0a 0a20 2020  ody);.    }..   
-000235b0: 202f 2a2a 0a20 2020 2020 2a20 436c 6561   /**.     * Clea
-000235c0: 7220 7175 6575 6564 2061 6464 7265 7373  r queued address
-000235d0: 6573 206f 6620 6769 7665 6e20 6b69 6e64  es of given kind
-000235e0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-000235f0: 4070 6172 616d 2073 7472 696e 6720 246b  @param string $k
-00023600: 696e 6420 2774 6f27 2c20 2763 6327 2c20  ind 'to', 'cc', 
-00023610: 6f72 2027 6263 6327 0a20 2020 2020 2a2f  or 'bcc'.     */
-00023620: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00023630: 7469 6f6e 2063 6c65 6172 5175 6575 6564  tion clearQueued
-00023640: 4164 6472 6573 7365 7328 246b 696e 6429  Addresses($kind)
-00023650: 0a20 2020 207b 0a20 2020 2020 2020 2024  .    {.        $
-00023660: 7468 6973 2d3e 5265 6369 7069 656e 7473  this->Recipients
-00023670: 5175 6575 6520 3d20 6172 7261 795f 6669  Queue = array_fi
-00023680: 6c74 6572 280a 2020 2020 2020 2020 2020  lter(.          
-00023690: 2020 2474 6869 732d 3e52 6563 6970 6965    $this->Recipie
-000236a0: 6e74 7351 7565 7565 2c0a 2020 2020 2020  ntsQueue,.      
-000236b0: 2020 2020 2020 7374 6174 6963 2066 756e        static fun
-000236c0: 6374 696f 6e20 2824 7061 7261 6d73 2920  ction ($params) 
-000236d0: 7573 6520 2824 6b69 6e64 2920 7b0a 2020  use ($kind) {.  
-000236e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000236f0: 7475 726e 2024 7061 7261 6d73 5b30 5d20  turn $params[0] 
-00023700: 213d 3d20 246b 696e 643b 0a20 2020 2020  !== $kind;.     
-00023710: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00023720: 2029 3b0a 2020 2020 7d0a 0a20 2020 202f   );.    }..    /
-00023730: 2a2a 0a20 2020 2020 2a20 436c 6561 7220  **.     * Clear 
-00023740: 616c 6c20 546f 2072 6563 6970 6965 6e74  all To recipient
-00023750: 732e 0a20 2020 2020 2a2f 0a20 2020 2070  s..     */.    p
-00023760: 7562 6c69 6320 6675 6e63 7469 6f6e 2063  ublic function c
-00023770: 6c65 6172 4164 6472 6573 7365 7328 290a  learAddresses().
-00023780: 2020 2020 7b0a 2020 2020 2020 2020 666f      {.        fo
-00023790: 7265 6163 6820 2824 7468 6973 2d3e 746f  reach ($this->to
-000237a0: 2061 7320 2474 6f29 207b 0a20 2020 2020   as $to) {.     
-000237b0: 2020 2020 2020 2075 6e73 6574 2824 7468         unset($th
-000237c0: 6973 2d3e 616c 6c5f 7265 6369 7069 656e  is->all_recipien
-000237d0: 7473 5b73 7472 746f 6c6f 7765 7228 2474  ts[strtolower($t
-000237e0: 6f5b 305d 295d 293b 0a20 2020 2020 2020  o[0])]);.       
-000237f0: 207d 0a20 2020 2020 2020 2024 7468 6973   }.        $this
-00023800: 2d3e 746f 203d 205b 5d3b 0a20 2020 2020  ->to = [];.     
-00023810: 2020 2024 7468 6973 2d3e 636c 6561 7251     $this->clearQ
-00023820: 7565 7565 6441 6464 7265 7373 6573 2827  ueuedAddresses('
-00023830: 746f 2729 3b0a 2020 2020 7d0a 0a20 2020  to');.    }..   
-00023840: 202f 2a2a 0a20 2020 2020 2a20 436c 6561   /**.     * Clea
-00023850: 7220 616c 6c20 4343 2072 6563 6970 6965  r all CC recipie
-00023860: 6e74 732e 0a20 2020 2020 2a2f 0a20 2020  nts..     */.   
-00023870: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-00023880: 2063 6c65 6172 4343 7328 290a 2020 2020   clearCCs().    
-00023890: 7b0a 2020 2020 2020 2020 666f 7265 6163  {.        foreac
-000238a0: 6820 2824 7468 6973 2d3e 6363 2061 7320  h ($this->cc as 
-000238b0: 2463 6329 207b 0a20 2020 2020 2020 2020  $cc) {.         
-000238c0: 2020 2075 6e73 6574 2824 7468 6973 2d3e     unset($this->
-000238d0: 616c 6c5f 7265 6369 7069 656e 7473 5b73  all_recipients[s
-000238e0: 7472 746f 6c6f 7765 7228 2463 635b 305d  trtolower($cc[0]
-000238f0: 295d 293b 0a20 2020 2020 2020 207d 0a20  )]);.        }. 
-00023900: 2020 2020 2020 2024 7468 6973 2d3e 6363         $this->cc
-00023910: 203d 205b 5d3b 0a20 2020 2020 2020 2024   = [];.        $
-00023920: 7468 6973 2d3e 636c 6561 7251 7565 7565  this->clearQueue
-00023930: 6441 6464 7265 7373 6573 2827 6363 2729  dAddresses('cc')
-00023940: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-00023950: 0a20 2020 2020 2a20 436c 6561 7220 616c  .     * Clear al
-00023960: 6c20 4243 4320 7265 6369 7069 656e 7473  l BCC recipients
-00023970: 2e0a 2020 2020 202a 2f0a 2020 2020 7075  ..     */.    pu
-00023980: 626c 6963 2066 756e 6374 696f 6e20 636c  blic function cl
-00023990: 6561 7242 4343 7328 290a 2020 2020 7b0a  earBCCs().    {.
-000239a0: 2020 2020 2020 2020 666f 7265 6163 6820          foreach 
-000239b0: 2824 7468 6973 2d3e 6263 6320 6173 2024  ($this->bcc as $
-000239c0: 6263 6329 207b 0a20 2020 2020 2020 2020  bcc) {.         
-000239d0: 2020 2075 6e73 6574 2824 7468 6973 2d3e     unset($this->
-000239e0: 616c 6c5f 7265 6369 7069 656e 7473 5b73  all_recipients[s
-000239f0: 7472 746f 6c6f 7765 7228 2462 6363 5b30  trtolower($bcc[0
-00023a00: 5d29 5d29 3b0a 2020 2020 2020 2020 7d0a  ])]);.        }.
-00023a10: 2020 2020 2020 2020 2474 6869 732d 3e62          $this->b
-00023a20: 6363 203d 205b 5d3b 0a20 2020 2020 2020  cc = [];.       
-00023a30: 2024 7468 6973 2d3e 636c 6561 7251 7565   $this->clearQue
-00023a40: 7565 6441 6464 7265 7373 6573 2827 6263  uedAddresses('bc
-00023a50: 6327 293b 0a20 2020 207d 0a0a 2020 2020  c');.    }..    
-00023a60: 2f2a 2a0a 2020 2020 202a 2043 6c65 6172  /**.     * Clear
-00023a70: 2061 6c6c 2052 6570 6c79 546f 2072 6563   all ReplyTo rec
-00023a80: 6970 6965 6e74 732e 0a20 2020 2020 2a2f  ipients..     */
-00023a90: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00023aa0: 7469 6f6e 2063 6c65 6172 5265 706c 7954  tion clearReplyT
-00023ab0: 6f73 2829 0a20 2020 207b 0a20 2020 2020  os().    {.     
-00023ac0: 2020 2024 7468 6973 2d3e 5265 706c 7954     $this->ReplyT
-00023ad0: 6f20 3d20 5b5d 3b0a 2020 2020 2020 2020  o = [];.        
-00023ae0: 2474 6869 732d 3e52 6570 6c79 546f 5175  $this->ReplyToQu
-00023af0: 6575 6520 3d20 5b5d 3b0a 2020 2020 7d0a  eue = [];.    }.
-00023b00: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00023b10: 436c 6561 7220 616c 6c20 7265 6369 7069  Clear all recipi
-00023b20: 656e 7420 7479 7065 732e 0a20 2020 2020  ent types..     
-00023b30: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-00023b40: 6e63 7469 6f6e 2063 6c65 6172 416c 6c52  nction clearAllR
-00023b50: 6563 6970 6965 6e74 7328 290a 2020 2020  ecipients().    
-00023b60: 7b0a 2020 2020 2020 2020 2474 6869 732d  {.        $this-
-00023b70: 3e74 6f20 3d20 5b5d 3b0a 2020 2020 2020  >to = [];.      
-00023b80: 2020 2474 6869 732d 3e63 6320 3d20 5b5d    $this->cc = []
-00023b90: 3b0a 2020 2020 2020 2020 2474 6869 732d  ;.        $this-
-00023ba0: 3e62 6363 203d 205b 5d3b 0a20 2020 2020  >bcc = [];.     
-00023bb0: 2020 2024 7468 6973 2d3e 616c 6c5f 7265     $this->all_re
-00023bc0: 6369 7069 656e 7473 203d 205b 5d3b 0a20  cipients = [];. 
-00023bd0: 2020 2020 2020 2024 7468 6973 2d3e 5265         $this->Re
-00023be0: 6369 7069 656e 7473 5175 6575 6520 3d20  cipientsQueue = 
-00023bf0: 5b5d 3b0a 2020 2020 7d0a 0a20 2020 202f  [];.    }..    /
-00023c00: 2a2a 0a20 2020 2020 2a20 436c 6561 7220  **.     * Clear 
-00023c10: 616c 6c20 6669 6c65 7379 7374 656d 2c20  all filesystem, 
-00023c20: 7374 7269 6e67 2c20 616e 6420 6269 6e61  string, and bina
-00023c30: 7279 2061 7474 6163 686d 656e 7473 2e0a  ry attachments..
-00023c40: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00023c50: 6963 2066 756e 6374 696f 6e20 636c 6561  ic function clea
-00023c60: 7241 7474 6163 686d 656e 7473 2829 0a20  rAttachments(). 
-00023c70: 2020 207b 0a20 2020 2020 2020 2024 7468     {.        $th
-00023c80: 6973 2d3e 6174 7461 6368 6d65 6e74 203d  is->attachment =
-00023c90: 205b 5d3b 0a20 2020 207d 0a0a 2020 2020   [];.    }..    
-00023ca0: 2f2a 2a0a 2020 2020 202a 2043 6c65 6172  /**.     * Clear
-00023cb0: 2061 6c6c 2063 7573 746f 6d20 6865 6164   all custom head
-00023cc0: 6572 732e 0a20 2020 2020 2a2f 0a20 2020  ers..     */.   
-00023cd0: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-00023ce0: 2063 6c65 6172 4375 7374 6f6d 4865 6164   clearCustomHead
-00023cf0: 6572 7328 290a 2020 2020 7b0a 2020 2020  ers().    {.    
-00023d00: 2020 2020 2474 6869 732d 3e43 7573 746f      $this->Custo
-00023d10: 6d48 6561 6465 7220 3d20 5b5d 3b0a 2020  mHeader = [];.  
-00023d20: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00023d30: 2020 2a20 4164 6420 616e 2065 7272 6f72    * Add an error
-00023d40: 206d 6573 7361 6765 2074 6f20 7468 6520   message to the 
-00023d50: 6572 726f 7220 636f 6e74 6169 6e65 722e  error container.
-00023d60: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00023d70: 7061 7261 6d20 7374 7269 6e67 2024 6d73  param string $ms
-00023d80: 670a 2020 2020 202a 2f0a 2020 2020 7072  g.     */.    pr
-00023d90: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
-00023da0: 2073 6574 4572 726f 7228 246d 7367 290a   setError($msg).
-00023db0: 2020 2020 7b0a 2020 2020 2020 2020 2b2b      {.        ++
-00023dc0: 2474 6869 732d 3e65 7272 6f72 5f63 6f75  $this->error_cou
-00023dd0: 6e74 3b0a 2020 2020 2020 2020 6966 2028  nt;.        if (
-00023de0: 2773 6d74 7027 203d 3d3d 2024 7468 6973  'smtp' === $this
-00023df0: 2d3e 4d61 696c 6572 2026 2620 6e75 6c6c  ->Mailer && null
-00023e00: 2021 3d3d 2024 7468 6973 2d3e 736d 7470   !== $this->smtp
-00023e10: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00023e20: 246c 6173 7465 7272 6f72 203d 2024 7468  $lasterror = $th
-00023e30: 6973 2d3e 736d 7470 2d3e 6765 7445 7272  is->smtp->getErr
-00023e40: 6f72 2829 3b0a 2020 2020 2020 2020 2020  or();.          
-00023e50: 2020 6966 2028 2165 6d70 7479 2824 6c61    if (!empty($la
-00023e60: 7374 6572 726f 725b 2765 7272 6f72 275d  sterror['error']
-00023e70: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00023e80: 2020 2020 2024 6d73 6720 2e3d 2024 7468       $msg .= $th
-00023e90: 6973 2d3e 6c61 6e67 2827 736d 7470 5f65  is->lang('smtp_e
-00023ea0: 7272 6f72 2729 202e 2024 6c61 7374 6572  rror') . $laster
-00023eb0: 726f 725b 2765 7272 6f72 275d 3b0a 2020  ror['error'];.  
-00023ec0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00023ed0: 2028 2165 6d70 7479 2824 6c61 7374 6572   (!empty($laster
-00023ee0: 726f 725b 2764 6574 6169 6c27 5d29 2920  ror['detail'])) 
-00023ef0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00023f00: 2020 2020 2020 246d 7367 202e 3d20 2720        $msg .= ' 
-00023f10: 2720 2e20 2474 6869 732d 3e6c 616e 6728  ' . $this->lang(
-00023f20: 2773 6d74 705f 6465 7461 696c 2729 202e  'smtp_detail') .
-00023f30: 2024 6c61 7374 6572 726f 725b 2764 6574   $lasterror['det
-00023f40: 6169 6c27 5d3b 0a20 2020 2020 2020 2020  ail'];.         
-00023f50: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00023f60: 2020 2020 2020 2020 2069 6620 2821 656d           if (!em
-00023f70: 7074 7928 246c 6173 7465 7272 6f72 5b27  pty($lasterror['
-00023f80: 736d 7470 5f63 6f64 6527 5d29 2920 7b0a  smtp_code'])) {.
-00023f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023fa0: 2020 2020 246d 7367 202e 3d20 2720 2720      $msg .= ' ' 
-00023fb0: 2e20 2474 6869 732d 3e6c 616e 6728 2773  . $this->lang('s
-00023fc0: 6d74 705f 636f 6465 2729 202e 2024 6c61  mtp_code') . $la
-00023fd0: 7374 6572 726f 725b 2773 6d74 705f 636f  sterror['smtp_co
-00023fe0: 6465 275d 3b0a 2020 2020 2020 2020 2020  de'];.          
-00023ff0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00024000: 2020 2020 2020 2020 6966 2028 2165 6d70          if (!emp
-00024010: 7479 2824 6c61 7374 6572 726f 725b 2773  ty($lasterror['s
-00024020: 6d74 705f 636f 6465 5f65 7827 5d29 2920  mtp_code_ex'])) 
-00024030: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00024040: 2020 2020 2020 246d 7367 202e 3d20 2720        $msg .= ' 
-00024050: 2720 2e20 2474 6869 732d 3e6c 616e 6728  ' . $this->lang(
-00024060: 2773 6d74 705f 636f 6465 5f65 7827 2920  'smtp_code_ex') 
-00024070: 2e20 246c 6173 7465 7272 6f72 5b27 736d  . $lasterror['sm
-00024080: 7470 5f63 6f64 655f 6578 275d 3b0a 2020  tp_code_ex'];.  
-00024090: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-000240a0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-000240b0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000240c0: 2474 6869 732d 3e45 7272 6f72 496e 666f  $this->ErrorInfo
-000240d0: 203d 2024 6d73 673b 0a20 2020 207d 0a0a   = $msg;.    }..
-000240e0: 2020 2020 2f2a 2a0a 2020 2020 202a 2052      /**.     * R
-000240f0: 6574 7572 6e20 616e 2052 4643 2038 3232  eturn an RFC 822
-00024100: 2066 6f72 6d61 7474 6564 2064 6174 652e   formatted date.
-00024110: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00024120: 7265 7475 726e 2073 7472 696e 670a 2020  return string.  
-00024130: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
-00024140: 2073 7461 7469 6320 6675 6e63 7469 6f6e   static function
-00024150: 2072 6663 4461 7465 2829 0a20 2020 207b   rfcDate().    {
-00024160: 0a20 2020 2020 2020 202f 2f53 6574 2074  .        //Set t
-00024170: 6865 2074 696d 6520 7a6f 6e65 2074 6f20  he time zone to 
-00024180: 7768 6174 6576 6572 2074 6865 2064 6566  whatever the def
-00024190: 6175 6c74 2069 7320 746f 2061 766f 6964  ault is to avoid
-000241a0: 2035 3030 2065 7272 6f72 730a 2020 2020   500 errors.    
-000241b0: 2020 2020 2f2f 5769 6c6c 2064 6566 6175      //Will defau
-000241c0: 6c74 2074 6f20 5554 4320 6966 2069 7427  lt to UTC if it'
-000241d0: 7320 6e6f 7420 7365 7420 7072 6f70 6572  s not set proper
-000241e0: 6c79 2069 6e20 7068 702e 696e 690a 2020  ly in php.ini.  
-000241f0: 2020 2020 2020 6461 7465 5f64 6566 6175        date_defau
-00024200: 6c74 5f74 696d 657a 6f6e 655f 7365 7428  lt_timezone_set(
-00024210: 4064 6174 655f 6465 6661 756c 745f 7469  @date_default_ti
-00024220: 6d65 7a6f 6e65 5f67 6574 2829 293b 0a0a  mezone_get());..
-00024230: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00024240: 6174 6528 2744 2c20 6a20 4d20 5920 483a  ate('D, j M Y H:
-00024250: 693a 7320 4f27 293b 0a20 2020 207d 0a0a  i:s O');.    }..
-00024260: 2020 2020 2f2a 2a0a 2020 2020 202a 2047      /**.     * G
-00024270: 6574 2074 6865 2073 6572 7665 7220 686f  et the server ho
-00024280: 7374 6e61 6d65 2e0a 2020 2020 202a 2052  stname..     * R
-00024290: 6574 7572 6e73 2027 6c6f 6361 6c68 6f73  eturns 'localhos
-000242a0: 742e 6c6f 6361 6c64 6f6d 6169 6e27 2069  t.localdomain' i
-000242b0: 6620 756e 6b6e 6f77 6e2e 0a20 2020 2020  f unknown..     
-000242c0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-000242d0: 2073 7472 696e 670a 2020 2020 202a 2f0a   string.     */.
-000242e0: 2020 2020 7072 6f74 6563 7465 6420 6675      protected fu
-000242f0: 6e63 7469 6f6e 2073 6572 7665 7248 6f73  nction serverHos
-00024300: 746e 616d 6528 290a 2020 2020 7b0a 2020  tname().    {.  
-00024310: 2020 2020 2020 2472 6573 756c 7420 3d20        $result = 
-00024320: 2727 3b0a 2020 2020 2020 2020 6966 2028  '';.        if (
-00024330: 2165 6d70 7479 2824 7468 6973 2d3e 486f  !empty($this->Ho
-00024340: 7374 6e61 6d65 2929 207b 0a20 2020 2020  stname)) {.     
-00024350: 2020 2020 2020 2024 7265 7375 6c74 203d         $result =
-00024360: 2024 7468 6973 2d3e 486f 7374 6e61 6d65   $this->Hostname
-00024370: 3b0a 2020 2020 2020 2020 7d20 656c 7365  ;.        } else
-00024380: 6966 2028 6973 7365 7428 245f 5345 5256  if (isset($_SERV
-00024390: 4552 2920 2626 2061 7272 6179 5f6b 6579  ER) && array_key
-000243a0: 5f65 7869 7374 7328 2753 4552 5645 525f  _exists('SERVER_
-000243b0: 4e41 4d45 272c 2024 5f53 4552 5645 5229  NAME', $_SERVER)
-000243c0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-000243d0: 2472 6573 756c 7420 3d20 245f 5345 5256  $result = $_SERV
-000243e0: 4552 5b27 5345 5256 4552 5f4e 414d 4527  ER['SERVER_NAME'
-000243f0: 5d3b 0a20 2020 2020 2020 207d 2065 6c73  ];.        } els
-00024400: 6569 6620 2866 756e 6374 696f 6e5f 6578  eif (function_ex
-00024410: 6973 7473 2827 6765 7468 6f73 746e 616d  ists('gethostnam
-00024420: 6527 2920 2626 2067 6574 686f 7374 6e61  e') && gethostna
-00024430: 6d65 2829 2021 3d3d 2066 616c 7365 2920  me() !== false) 
-00024440: 7b0a 2020 2020 2020 2020 2020 2020 2472  {.            $r
-00024450: 6573 756c 7420 3d20 6765 7468 6f73 746e  esult = gethostn
-00024460: 616d 6528 293b 0a20 2020 2020 2020 207d  ame();.        }
-00024470: 2065 6c73 6569 6620 2870 6870 5f75 6e61   elseif (php_una
-00024480: 6d65 2827 6e27 2920 213d 3d20 6661 6c73  me('n') !== fals
-00024490: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-000244a0: 2024 7265 7375 6c74 203d 2070 6870 5f75   $result = php_u
-000244b0: 6e61 6d65 2827 6e27 293b 0a20 2020 2020  name('n');.     
-000244c0: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
-000244d0: 2821 7374 6174 6963 3a3a 6973 5661 6c69  (!static::isVali
-000244e0: 6448 6f73 7428 2472 6573 756c 7429 2920  dHost($result)) 
-000244f0: 7b0a 2020 2020 2020 2020 2020 2020 7265  {.            re
-00024500: 7475 726e 2027 6c6f 6361 6c68 6f73 742e  turn 'localhost.
-00024510: 6c6f 6361 6c64 6f6d 6169 6e27 3b0a 2020  localdomain';.  
-00024520: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00024530: 2072 6574 7572 6e20 2472 6573 756c 743b   return $result;
-00024540: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00024550: 2020 2020 202a 2056 616c 6964 6174 6520       * Validate 
-00024560: 7768 6574 6865 7220 6120 7374 7269 6e67  whether a string
-00024570: 2063 6f6e 7461 696e 7320 6120 7661 6c69   contains a vali
-00024580: 6420 7661 6c75 6520 746f 2075 7365 2061  d value to use a
-00024590: 7320 6120 686f 7374 6e61 6d65 206f 7220  s a hostname or 
-000245a0: 4950 2061 6464 7265 7373 2e0a 2020 2020  IP address..    
-000245b0: 202a 2049 5076 3620 6164 6472 6573 7365   * IPv6 addresse
-000245c0: 7320 6d75 7374 2069 6e63 6c75 6465 205b  s must include [
-000245d0: 5d2c 2065 2e67 2e20 605b 3a3a 315d 602c  ], e.g. `[::1]`,
-000245e0: 206e 6f74 206a 7573 7420 603a 3a31 602e   not just `::1`.
-000245f0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00024600: 7061 7261 6d20 7374 7269 6e67 2024 686f  param string $ho
-00024610: 7374 2054 6865 2068 6f73 7420 6e61 6d65  st The host name
-00024620: 206f 7220 4950 2061 6464 7265 7373 2074   or IP address t
-00024630: 6f20 6368 6563 6b0a 2020 2020 202a 0a20  o check.     *. 
-00024640: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
-00024650: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
-00024660: 7562 6c69 6320 7374 6174 6963 2066 756e  ublic static fun
-00024670: 6374 696f 6e20 6973 5661 6c69 6448 6f73  ction isValidHos
-00024680: 7428 2468 6f73 7429 0a20 2020 207b 0a20  t($host).    {. 
-00024690: 2020 2020 2020 202f 2f53 696d 706c 6520         //Simple 
-000246a0: 7379 6e74 6178 206c 696d 6974 730a 2020  syntax limits.  
-000246b0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-000246c0: 2020 2020 2020 2065 6d70 7479 2824 686f         empty($ho
-000246d0: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-000246e0: 7c7c 2021 6973 5f73 7472 696e 6728 2468  || !is_string($h
-000246f0: 6f73 7429 0a20 2020 2020 2020 2020 2020  ost).           
-00024700: 207c 7c20 7374 726c 656e 2824 686f 7374   || strlen($host
-00024710: 2920 3e20 3235 360a 2020 2020 2020 2020  ) > 256.        
-00024720: 2020 2020 7c7c 2021 7072 6567 5f6d 6174      || !preg_mat
-00024730: 6368 2827 2f5e 285b 612d 7a41 2d5a 5c64  ch('/^([a-zA-Z\d
-00024740: 2e2d 5d2a 7c5c 5b5b 612d 6641 2d46 5c64  .-]*|\[[a-fA-F\d
-00024750: 3a5d 2b5c 5d29 242f 272c 2024 686f 7374  :]+\])$/', $host
-00024760: 290a 2020 2020 2020 2020 2920 7b0a 2020  ).        ) {.  
-00024770: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00024780: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
-00024790: 7d0a 2020 2020 2020 2020 2f2f 4c6f 6f6b  }.        //Look
-000247a0: 7320 6c69 6b65 2061 2062 7261 636b 6574  s like a bracket
-000247b0: 6564 2049 5076 3620 6164 6472 6573 730a  ed IPv6 address.
-000247c0: 2020 2020 2020 2020 6966 2028 7374 726c          if (strl
-000247d0: 656e 2824 686f 7374 2920 3e20 3220 2626  en($host) > 2 &&
-000247e0: 2073 7562 7374 7228 2468 6f73 742c 2030   substr($host, 0
-000247f0: 2c20 3129 203d 3d3d 2027 5b27 2026 2620  , 1) === '[' && 
-00024800: 7375 6273 7472 2824 686f 7374 2c20 2d31  substr($host, -1
-00024810: 2c20 3129 203d 3d3d 2027 5d27 2920 7b0a  , 1) === ']') {.
-00024820: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00024830: 726e 2066 696c 7465 725f 7661 7228 7375  rn filter_var(su
-00024840: 6273 7472 2824 686f 7374 2c20 312c 202d  bstr($host, 1, -
-00024850: 3129 2c20 4649 4c54 4552 5f56 414c 4944  1), FILTER_VALID
-00024860: 4154 455f 4950 2c20 4649 4c54 4552 5f46  ATE_IP, FILTER_F
-00024870: 4c41 475f 4950 5636 2920 213d 3d20 6661  LAG_IPV6) !== fa
-00024880: 6c73 653b 0a20 2020 2020 2020 207d 0a20  lse;.        }. 
-00024890: 2020 2020 2020 202f 2f49 6620 7265 6d6f         //If remo
-000248a0: 7669 6e67 2061 6c6c 2074 6865 2064 6f74  ving all the dot
-000248b0: 7320 7265 7375 6c74 7320 696e 2061 206e  s results in a n
-000248c0: 756d 6572 6963 2073 7472 696e 672c 2069  umeric string, i
-000248d0: 7420 6d75 7374 2062 6520 616e 2049 5076  t must be an IPv
-000248e0: 3420 6164 6472 6573 732e 0a20 2020 2020  4 address..     
-000248f0: 2020 202f 2f4e 6565 6420 746f 2063 6865     //Need to che
-00024900: 636b 2074 6869 7320 6669 7273 7420 6265  ck this first be
-00024910: 6361 7573 6520 6f74 6865 7277 6973 6520  cause otherwise 
-00024920: 7468 696e 6773 206c 696b 6520 6039 3939  things like `999
-00024930: 2e30 2e30 2e30 6020 6172 6520 636f 6e73  .0.0.0` are cons
-00024940: 6964 6572 6564 2076 616c 6964 2068 6f73  idered valid hos
-00024950: 7420 6e61 6d65 730a 2020 2020 2020 2020  t names.        
-00024960: 6966 2028 6973 5f6e 756d 6572 6963 2873  if (is_numeric(s
-00024970: 7472 5f72 6570 6c61 6365 2827 2e27 2c20  tr_replace('.', 
-00024980: 2727 2c20 2468 6f73 7429 2929 207b 0a20  '', $host))) {. 
-00024990: 2020 2020 2020 2020 2020 202f 2f49 7320             //Is 
-000249a0: 6974 2061 2076 616c 6964 2049 5076 3420  it a valid IPv4 
-000249b0: 6164 6472 6573 733f 0a20 2020 2020 2020  address?.       
-000249c0: 2020 2020 2072 6574 7572 6e20 6669 6c74       return filt
-000249d0: 6572 5f76 6172 2824 686f 7374 2c20 4649  er_var($host, FI
-000249e0: 4c54 4552 5f56 414c 4944 4154 455f 4950  LTER_VALIDATE_IP
-000249f0: 2c20 4649 4c54 4552 5f46 4c41 475f 4950  , FILTER_FLAG_IP
-00024a00: 5634 2920 213d 3d20 6661 6c73 653b 0a20  V4) !== false;. 
-00024a10: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00024a20: 202f 2f49 7320 6974 2061 2073 796e 7461   //Is it a synta
-00024a30: 6374 6963 616c 6c79 2076 616c 6964 2068  ctically valid h
-00024a40: 6f73 746e 616d 6520 2877 6865 6e20 656d  ostname (when em
-00024a50: 6265 6465 6420 696e 2061 2055 524c 293f  beded in a URL)?
-00024a60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00024a70: 6669 6c74 6572 5f76 6172 2827 6874 7470  filter_var('http
-00024a80: 3a2f 2f27 202e 2024 686f 7374 2c20 4649  ://' . $host, FI
-00024a90: 4c54 4552 5f56 414c 4944 4154 455f 5552  LTER_VALIDATE_UR
-00024aa0: 4c29 2021 3d3d 2066 616c 7365 3b0a 2020  L) !== false;.  
-00024ab0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00024ac0: 2020 2a20 4765 7420 616e 2065 7272 6f72    * Get an error
-00024ad0: 206d 6573 7361 6765 2069 6e20 7468 6520   message in the 
-00024ae0: 6375 7272 656e 7420 6c61 6e67 7561 6765  current language
-00024af0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-00024b00: 4070 6172 616d 2073 7472 696e 6720 246b  @param string $k
-00024b10: 6579 0a20 2020 2020 2a0a 2020 2020 202a  ey.     *.     *
-00024b20: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
-00024b30: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
-00024b40: 6563 7465 6420 6675 6e63 7469 6f6e 206c  ected function l
-00024b50: 616e 6728 246b 6579 290a 2020 2020 7b0a  ang($key).    {.
-00024b60: 2020 2020 2020 2020 6966 2028 636f 756e          if (coun
-00024b70: 7428 2474 6869 732d 3e6c 616e 6775 6167  t($this->languag
-00024b80: 6529 203c 2031 2920 7b0a 2020 2020 2020  e) < 1) {.      
-00024b90: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
-00024ba0: 4c61 6e67 7561 6765 2829 3b20 2f2f 5365  Language(); //Se
-00024bb0: 7420 7468 6520 6465 6661 756c 7420 6c61  t the default la
-00024bc0: 6e67 7561 6765 0a20 2020 2020 2020 207d  nguage.        }
-00024bd0: 0a0a 2020 2020 2020 2020 6966 2028 6172  ..        if (ar
-00024be0: 7261 795f 6b65 795f 6578 6973 7473 2824  ray_key_exists($
-00024bf0: 6b65 792c 2024 7468 6973 2d3e 6c61 6e67  key, $this->lang
-00024c00: 7561 6765 2929 207b 0a20 2020 2020 2020  uage)) {.       
-00024c10: 2020 2020 2069 6620 2827 736d 7470 5f63       if ('smtp_c
-00024c20: 6f6e 6e65 6374 5f66 6169 6c65 6427 203d  onnect_failed' =
-00024c30: 3d3d 2024 6b65 7929 207b 0a20 2020 2020  == $key) {.     
-00024c40: 2020 2020 2020 2020 2020 202f 2f49 6e63             //Inc
-00024c50: 6c75 6465 2061 206c 696e 6b20 746f 2074  lude a link to t
-00024c60: 726f 7562 6c65 7368 6f6f 7469 6e67 2064  roubleshooting d
-00024c70: 6f63 7320 6f6e 2053 4d54 5020 636f 6e6e  ocs on SMTP conn
-00024c80: 6563 7469 6f6e 2066 6169 6c75 7265 2e0a  ection failure..
-00024c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ca0: 2f2f 5468 6973 2069 7320 6279 2066 6172  //This is by far
-00024cb0: 2074 6865 2062 6967 6765 7374 2063 6175   the biggest cau
-00024cc0: 7365 206f 6620 7375 7070 6f72 7420 7175  se of support qu
-00024cd0: 6573 7469 6f6e 730a 2020 2020 2020 2020  estions.        
-00024ce0: 2020 2020 2020 2020 2f2f 6275 7420 6974          //but it
-00024cf0: 2773 2075 7375 616c 6c79 206e 6f74 2050  's usually not P
-00024d00: 4850 4d61 696c 6572 2773 2066 6175 6c74  HPMailer's fault
-00024d10: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024d20: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
-00024d30: 6c61 6e67 7561 6765 5b24 6b65 795d 202e  language[$key] .
-00024d40: 2027 2068 7474 7073 3a2f 2f67 6974 6875   ' https://githu
-00024d50: 622e 636f 6d2f 5048 504d 6169 6c65 722f  b.com/PHPMailer/
-00024d60: 5048 504d 6169 6c65 722f 7769 6b69 2f54  PHPMailer/wiki/T
-00024d70: 726f 7562 6c65 7368 6f6f 7469 6e67 273b  roubleshooting';
-00024d80: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-00024d90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00024da0: 726e 2024 7468 6973 2d3e 6c61 6e67 7561  rn $this->langua
-00024db0: 6765 5b24 6b65 795d 3b0a 2020 2020 2020  ge[$key];.      
-00024dc0: 2020 7d0a 0a20 2020 2020 2020 202f 2f52    }..        //R
-00024dd0: 6574 7572 6e20 7468 6520 6b65 7920 6173  eturn the key as
-00024de0: 2061 2066 616c 6c62 6163 6b0a 2020 2020   a fallback.    
-00024df0: 2020 2020 7265 7475 726e 2024 6b65 793b      return $key;
-00024e00: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00024e10: 2020 2020 202a 2042 7569 6c64 2061 6e20       * Build an 
-00024e20: 6572 726f 7220 6d65 7373 6167 6520 7374  error message st
-00024e30: 6172 7469 6e67 2077 6974 6820 6120 6765  arting with a ge
-00024e40: 6e65 7269 6320 6f6e 6520 616e 6420 6164  neric one and ad
-00024e50: 6469 6e67 2064 6574 6169 6c73 2069 6620  ding details if 
-00024e60: 706f 7373 6962 6c65 2e0a 2020 2020 202a  possible..     *
-00024e70: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00024e80: 7472 696e 6720 2462 6173 655f 6b65 790a  tring $base_key.
-00024e90: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
-00024ea0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00024eb0: 2020 7072 6976 6174 6520 6675 6e63 7469    private functi
-00024ec0: 6f6e 2067 6574 536d 7470 4572 726f 724d  on getSmtpErrorM
-00024ed0: 6573 7361 6765 2824 6261 7365 5f6b 6579  essage($base_key
-00024ee0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00024ef0: 246d 6573 7361 6765 203d 2024 7468 6973  $message = $this
-00024f00: 2d3e 6c61 6e67 2824 6261 7365 5f6b 6579  ->lang($base_key
-00024f10: 293b 0a20 2020 2020 2020 2024 6572 726f  );.        $erro
-00024f20: 7220 3d20 2474 6869 732d 3e73 6d74 702d  r = $this->smtp-
-00024f30: 3e67 6574 4572 726f 7228 293b 0a20 2020  >getError();.   
-00024f40: 2020 2020 2069 6620 2821 656d 7074 7928       if (!empty(
-00024f50: 2465 7272 6f72 5b27 6572 726f 7227 5d29  $error['error'])
-00024f60: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00024f70: 246d 6573 7361 6765 202e 3d20 2720 2720  $message .= ' ' 
-00024f80: 2e20 2465 7272 6f72 5b27 6572 726f 7227  . $error['error'
-00024f90: 5d3b 0a20 2020 2020 2020 2020 2020 2069  ];.            i
-00024fa0: 6620 2821 656d 7074 7928 2465 7272 6f72  f (!empty($error
-00024fb0: 5b27 6465 7461 696c 275d 2929 207b 0a20  ['detail'])) {. 
-00024fc0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00024fd0: 6d65 7373 6167 6520 2e3d 2027 2027 202e  message .= ' ' .
-00024fe0: 2024 6572 726f 725b 2764 6574 6169 6c27   $error['detail'
-00024ff0: 5d3b 0a20 2020 2020 2020 2020 2020 207d  ];.            }
-00025000: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00025010: 2020 2020 7265 7475 726e 2024 6d65 7373      return $mess
-00025020: 6167 653b 0a20 2020 207d 0a0a 2020 2020  age;.    }..    
-00025030: 2f2a 2a0a 2020 2020 202a 2043 6865 636b  /**.     * Check
-00025040: 2069 6620 616e 2065 7272 6f72 206f 6363   if an error occ
-00025050: 7572 7265 642e 0a20 2020 2020 2a0a 2020  urred..     *.  
-00025060: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
-00025070: 6c20 5472 7565 2069 6620 616e 2065 7272  l True if an err
-00025080: 6f72 2064 6964 206f 6363 7572 0a20 2020  or did occur.   
-00025090: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-000250a0: 6675 6e63 7469 6f6e 2069 7345 7272 6f72  function isError
-000250b0: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
-000250c0: 2072 6574 7572 6e20 2474 6869 732d 3e65   return $this->e
-000250d0: 7272 6f72 5f63 6f75 6e74 203e 2030 3b0a  rror_count > 0;.
-000250e0: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
-000250f0: 2020 2020 2a20 4164 6420 6120 6375 7374      * Add a cust
-00025100: 6f6d 2068 6561 6465 722e 0a20 2020 2020  om header..     
-00025110: 2a20 246e 616d 6520 7661 6c75 6520 6361  * $name value ca
-00025120: 6e20 6265 206f 7665 726c 6f61 6465 6420  n be overloaded 
-00025130: 746f 2063 6f6e 7461 696e 0a20 2020 2020  to contain.     
-00025140: 2a20 626f 7468 2068 6561 6465 7220 6e61  * both header na
-00025150: 6d65 2061 6e64 2076 616c 7565 2028 6e61  me and value (na
-00025160: 6d65 3a76 616c 7565 292e 0a20 2020 2020  me:value)..     
-00025170: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-00025180: 7374 7269 6e67 2020 2020 2020 246e 616d  string      $nam
-00025190: 6520 2043 7573 746f 6d20 6865 6164 6572  e  Custom header
-000251a0: 206e 616d 650a 2020 2020 202a 2040 7061   name.     * @pa
-000251b0: 7261 6d20 7374 7269 6e67 7c6e 756c 6c20  ram string|null 
-000251c0: 2476 616c 7565 2048 6561 6465 7220 7661  $value Header va
-000251d0: 6c75 650a 2020 2020 202a 0a20 2020 2020  lue.     *.     
-000251e0: 2a20 4074 6872 6f77 7320 4578 6365 7074  * @throws Except
-000251f0: 696f 6e0a 2020 2020 202a 2f0a 2020 2020  ion.     */.    
-00025200: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
-00025210: 6164 6443 7573 746f 6d48 6561 6465 7228  addCustomHeader(
-00025220: 246e 616d 652c 2024 7661 6c75 6520 3d20  $name, $value = 
-00025230: 6e75 6c6c 290a 2020 2020 7b0a 2020 2020  null).    {.    
-00025240: 2020 2020 6966 2028 6e75 6c6c 203d 3d3d      if (null ===
-00025250: 2024 7661 6c75 6520 2626 2073 7472 706f   $value && strpo
-00025260: 7328 246e 616d 652c 2027 3a27 2920 213d  s($name, ':') !=
-00025270: 3d20 6661 6c73 6529 207b 0a20 2020 2020  = false) {.     
-00025280: 2020 2020 2020 202f 2f56 616c 7565 2070         //Value p
-00025290: 6173 7365 6420 696e 2061 7320 6e61 6d65  assed in as name
-000252a0: 3a76 616c 7565 0a20 2020 2020 2020 2020  :value.         
-000252b0: 2020 206c 6973 7428 246e 616d 652c 2024     list($name, $
-000252c0: 7661 6c75 6529 203d 2065 7870 6c6f 6465  value) = explode
-000252d0: 2827 3a27 2c20 246e 616d 652c 2032 293b  (':', $name, 2);
-000252e0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-000252f0: 2020 2024 6e61 6d65 203d 2074 7269 6d28     $name = trim(
-00025300: 246e 616d 6529 3b0a 2020 2020 2020 2020  $name);.        
-00025310: 2476 616c 7565 203d 2028 6e75 6c6c 203d  $value = (null =
-00025320: 3d3d 2024 7661 6c75 6529 203f 2027 2720  == $value) ? '' 
-00025330: 3a20 7472 696d 2824 7661 6c75 6529 3b0a  : trim($value);.
-00025340: 2020 2020 2020 2020 2f2f 456e 7375 7265          //Ensure
-00025350: 206e 616d 6520 6973 206e 6f74 2065 6d70   name is not emp
-00025360: 7479 2c20 616e 6420 7468 6174 206e 6569  ty, and that nei
-00025370: 7468 6572 206e 616d 6520 6e6f 7220 7661  ther name nor va
-00025380: 6c75 6520 636f 6e74 6169 6e20 6c69 6e65  lue contain line
-00025390: 2062 7265 616b 730a 2020 2020 2020 2020   breaks.        
-000253a0: 6966 2028 656d 7074 7928 246e 616d 6529  if (empty($name)
-000253b0: 207c 7c20 7374 7270 6272 6b28 246e 616d   || strpbrk($nam
-000253c0: 6520 2e20 2476 616c 7565 2c20 225c 725c  e . $value, "\r\
-000253d0: 6e22 2920 213d 3d20 6661 6c73 6529 207b  n") !== false) {
-000253e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000253f0: 2824 7468 6973 2d3e 6578 6365 7074 696f  ($this->exceptio
-00025400: 6e73 2920 7b0a 2020 2020 2020 2020 2020  ns) {.          
-00025410: 2020 2020 2020 7468 726f 7720 6e65 7720        throw new 
-00025420: 4578 6365 7074 696f 6e28 2474 6869 732d  Exception($this-
-00025430: 3e6c 616e 6728 2769 6e76 616c 6964 5f68  >lang('invalid_h
-00025440: 6561 6465 7227 2929 3b0a 2020 2020 2020  eader'));.      
-00025450: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00025460: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
-00025470: 653b 0a20 2020 2020 2020 207d 0a20 2020  e;.        }.   
-00025480: 2020 2020 2024 7468 6973 2d3e 4375 7374       $this->Cust
-00025490: 6f6d 4865 6164 6572 5b5d 203d 205b 246e  omHeader[] = [$n
-000254a0: 616d 652c 2024 7661 6c75 655d 3b0a 0a20  ame, $value];.. 
-000254b0: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
-000254c0: 7565 3b0a 2020 2020 7d0a 0a20 2020 202f  ue;.    }..    /
-000254d0: 2a2a 0a20 2020 2020 2a20 5265 7475 726e  **.     * Return
-000254e0: 7320 616c 6c20 6375 7374 6f6d 2068 6561  s all custom hea
-000254f0: 6465 7273 2e0a 2020 2020 202a 0a20 2020  ders..     *.   
-00025500: 2020 2a20 4072 6574 7572 6e20 6172 7261    * @return arra
-00025510: 790a 2020 2020 202a 2f0a 2020 2020 7075  y.     */.    pu
-00025520: 626c 6963 2066 756e 6374 696f 6e20 6765  blic function ge
-00025530: 7443 7573 746f 6d48 6561 6465 7273 2829  tCustomHeaders()
-00025540: 0a20 2020 207b 0a20 2020 2020 2020 2072  .    {.        r
-00025550: 6574 7572 6e20 2474 6869 732d 3e43 7573  eturn $this->Cus
-00025560: 746f 6d48 6561 6465 723b 0a20 2020 207d  tomHeader;.    }
-00025570: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00025580: 2043 7265 6174 6520 6120 6d65 7373 6167   Create a messag
-00025590: 6520 626f 6479 2066 726f 6d20 616e 2048  e body from an H
-000255a0: 544d 4c20 7374 7269 6e67 2e0a 2020 2020  TML string..    
-000255b0: 202a 2041 7574 6f6d 6174 6963 616c 6c79   * Automatically
-000255c0: 2069 6e6c 696e 6573 2069 6d61 6765 7320   inlines images 
-000255d0: 616e 6420 6372 6561 7465 7320 6120 706c  and creates a pl
-000255e0: 6169 6e2d 7465 7874 2076 6572 7369 6f6e  ain-text version
-000255f0: 2062 7920 636f 6e76 6572 7469 6e67 2074   by converting t
-00025600: 6865 2048 544d 4c2c 0a20 2020 2020 2a20  he HTML,.     * 
-00025610: 6f76 6572 7772 6974 696e 6720 616e 7920  overwriting any 
-00025620: 6578 6973 7469 6e67 2076 616c 7565 7320  existing values 
-00025630: 696e 2042 6f64 7920 616e 6420 416c 7442  in Body and AltB
-00025640: 6f64 792e 0a20 2020 2020 2a20 446f 206e  ody..     * Do n
-00025650: 6f74 2073 6f75 7263 6520 246d 6573 7361  ot source $messa
-00025660: 6765 2063 6f6e 7465 6e74 2066 726f 6d20  ge content from 
-00025670: 7573 6572 2069 6e70 7574 210a 2020 2020  user input!.    
-00025680: 202a 2024 6261 7365 6469 7220 6973 2070   * $basedir is p
-00025690: 7265 7065 6e64 6564 2077 6865 6e20 6861  repended when ha
-000256a0: 6e64 6c69 6e67 2072 656c 6174 6976 6520  ndling relative 
-000256b0: 5552 4c73 2c20 652e 672e 203c 696d 6720  URLs, e.g. <img 
-000256c0: 7372 633d 222f 696d 6167 6573 2f61 2e70  src="/images/a.p
-000256d0: 6e67 223e 2061 6e64 206d 7573 7420 6e6f  ng"> and must no
-000256e0: 7420 6265 2065 6d70 7479 0a20 2020 2020  t be empty.     
-000256f0: 2a20 7769 6c6c 206c 6f6f 6b20 666f 7220  * will look for 
-00025700: 616e 2069 6d61 6765 2066 696c 6520 696e  an image file in
-00025710: 2024 6261 7365 6469 722f 696d 6167 6573   $basedir/images
-00025720: 2f61 2e70 6e67 2061 6e64 2063 6f6e 7665  /a.png and conve
-00025730: 7274 2069 7420 746f 2069 6e6c 696e 652e  rt it to inline.
-00025740: 0a20 2020 2020 2a20 4966 2079 6f75 2064  .     * If you d
-00025750: 6f6e 2774 2070 726f 7669 6465 2061 2024  on't provide a $
-00025760: 6261 7365 6469 722c 2072 656c 6174 6976  basedir, relativ
-00025770: 6520 7061 7468 7320 7769 6c6c 2062 6520  e paths will be 
-00025780: 6c65 6674 2075 6e74 6f75 6368 6564 2028  left untouched (
-00025790: 616e 6420 7468 7573 2070 726f 6261 626c  and thus probabl
-000257a0: 7920 6272 6561 6b20 696e 2065 6d61 696c  y break in email
-000257b0: 290a 2020 2020 202a 2043 6f6e 7665 7274  ).     * Convert
-000257c0: 7320 6461 7461 2d75 7269 2069 6d61 6765  s data-uri image
-000257d0: 7320 696e 746f 2065 6d62 6564 6465 6420  s into embedded 
-000257e0: 6174 7461 6368 6d65 6e74 732e 0a20 2020  attachments..   
-000257f0: 2020 2a20 4966 2079 6f75 2064 6f6e 2774    * If you don't
-00025800: 2077 616e 7420 746f 2061 7070 6c79 2074   want to apply t
-00025810: 6865 7365 2074 7261 6e73 666f 726d 6174  hese transformat
-00025820: 696f 6e73 2074 6f20 796f 7572 2048 544d  ions to your HTM
-00025830: 4c2c 206a 7573 7420 7365 7420 426f 6479  L, just set Body
-00025840: 2061 6e64 2041 6c74 426f 6479 2064 6972   and AltBody dir
-00025850: 6563 746c 792e 0a20 2020 2020 2a0a 2020  ectly..     *.  
-00025860: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-00025870: 6e67 2020 2020 2020 2020 246d 6573 7361  ng        $messa
-00025880: 6765 2020 4854 4d4c 206d 6573 7361 6765  ge  HTML message
-00025890: 2073 7472 696e 670a 2020 2020 202a 2040   string.     * @
-000258a0: 7061 7261 6d20 7374 7269 6e67 2020 2020  param string    
-000258b0: 2020 2020 2462 6173 6564 6972 2020 4162      $basedir  Ab
-000258c0: 736f 6c75 7465 2070 6174 6820 746f 2061  solute path to a
-000258d0: 2062 6173 6520 6469 7265 6374 6f72 7920   base directory 
-000258e0: 746f 2070 7265 7065 6e64 2074 6f20 7265  to prepend to re
-000258f0: 6c61 7469 7665 2070 6174 6873 2074 6f20  lative paths to 
-00025900: 696d 6167 6573 0a20 2020 2020 2a20 4070  images.     * @p
-00025910: 6172 616d 2062 6f6f 6c7c 6361 6c6c 6162  aram bool|callab
-00025920: 6c65 2024 6164 7661 6e63 6564 2057 6865  le $advanced Whe
-00025930: 7468 6572 2074 6f20 7573 6520 7468 6520  ther to use the 
-00025940: 696e 7465 726e 616c 2048 544d 4c20 746f  internal HTML to
-00025950: 2074 6578 7420 636f 6e76 6572 7465 720a   text converter.
-00025960: 2020 2020 202a 2020 2020 2020 2020 2020       *          
-00025970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025980: 2020 2020 2020 6f72 2079 6f75 7220 6f77        or your ow
-00025990: 6e20 6375 7374 6f6d 2063 6f6e 7665 7274  n custom convert
-000259a0: 6572 0a20 2020 2020 2a20 4072 6574 7572  er.     * @retur
-000259b0: 6e20 7374 7269 6e67 2054 6865 2074 7261  n string The tra
-000259c0: 6e73 666f 726d 6564 206d 6573 7361 6765  nsformed message
-000259d0: 2062 6f64 790a 2020 2020 202a 0a20 2020   body.     *.   
-000259e0: 2020 2a20 4074 6872 6f77 7320 4578 6365    * @throws Exce
-000259f0: 7074 696f 6e0a 2020 2020 202a 0a20 2020  ption.     *.   
-00025a00: 2020 2a20 4073 6565 2050 4850 4d61 696c    * @see PHPMail
-00025a10: 6572 3a3a 6874 6d6c 3274 6578 7428 290a  er::html2text().
-00025a20: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00025a30: 6963 2066 756e 6374 696f 6e20 6d73 6748  ic function msgH
-00025a40: 544d 4c28 246d 6573 7361 6765 2c20 2462  TML($message, $b
-00025a50: 6173 6564 6972 203d 2027 272c 2024 6164  asedir = '', $ad
-00025a60: 7661 6e63 6564 203d 2066 616c 7365 290a  vanced = false).
-00025a70: 2020 2020 7b0a 2020 2020 2020 2020 7072      {.        pr
-00025a80: 6567 5f6d 6174 6368 5f61 6c6c 2827 2f28  eg_match_all('/(
-00025a90: 3f3c 212d 2928 7372 637c 6261 636b 6772  ?<!-)(src|backgr
-00025aa0: 6f75 6e64 293d 5b22 5c27 5d28 2e2a 295b  ound)=["\'](.*)[
-00025ab0: 225c 275d 2f55 6927 2c20 246d 6573 7361  "\']/Ui', $messa
-00025ac0: 6765 2c20 2469 6d61 6765 7329 3b0a 2020  ge, $images);.  
-00025ad0: 2020 2020 2020 6966 2028 6172 7261 795f        if (array_
-00025ae0: 6b65 795f 6578 6973 7473 2832 2c20 2469  key_exists(2, $i
-00025af0: 6d61 6765 7329 2920 7b0a 2020 2020 2020  mages)) {.      
-00025b00: 2020 2020 2020 6966 2028 7374 726c 656e        if (strlen
-00025b10: 2824 6261 7365 6469 7229 203e 2031 2026  ($basedir) > 1 &
-00025b20: 2620 272f 2720 213d 3d20 7375 6273 7472  & '/' !== substr
-00025b30: 2824 6261 7365 6469 722c 202d 3129 2920  ($basedir, -1)) 
-00025b40: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00025b50: 2020 2f2f 456e 7375 7265 2024 6261 7365    //Ensure $base
-00025b60: 6469 7220 6861 7320 6120 7472 6169 6c69  dir has a traili
-00025b70: 6e67 202f 0a20 2020 2020 2020 2020 2020  ng /.           
-00025b80: 2020 2020 2024 6261 7365 6469 7220 2e3d       $basedir .=
-00025b90: 2027 2f27 3b0a 2020 2020 2020 2020 2020   '/';.          
-00025ba0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00025bb0: 666f 7265 6163 6820 2824 696d 6167 6573  foreach ($images
-00025bc0: 5b32 5d20 6173 2024 696d 6769 6e64 6578  [2] as $imgindex
-00025bd0: 203d 3e20 2475 726c 2920 7b0a 2020 2020   => $url) {.    
-00025be0: 2020 2020 2020 2020 2020 2020 2f2f 436f              //Co
-00025bf0: 6e76 6572 7420 6461 7461 2055 5249 7320  nvert data URIs 
-00025c00: 696e 746f 2065 6d62 6564 6465 6420 696d  into embedded im
-00025c10: 6167 6573 0a20 2020 2020 2020 2020 2020  ages.           
-00025c20: 2020 2020 202f 2f65 2e67 2e20 2264 6174       //e.g. "dat
-00025c30: 613a 696d 6167 652f 6769 663b 6261 7365  a:image/gif;base
-00025c40: 3634 2c52 306c 474f 446c 6841 5141 4241  64,R0lGODlhAQABA
-00025c50: 4141 4141 4348 3542 4145 4b41 4145 414c  AAAACH5BAEKAAEAL
-00025c60: 4141 4141 4141 4241 4145 4141 4149 4354  AAAAAABAAEAAAICT
-00025c70: 4145 414f 773d 3d22 0a20 2020 2020 2020  AEAOw==".       
-00025c80: 2020 2020 2020 2020 2024 6d61 7463 6820           $match 
-00025c90: 3d20 5b5d 3b0a 2020 2020 2020 2020 2020  = [];.          
-00025ca0: 2020 2020 2020 6966 2028 7072 6567 5f6d        if (preg_m
-00025cb0: 6174 6368 2827 235e 6461 7461 3a28 696d  atch('#^data:(im
-00025cc0: 6167 652f 283f 3a6a 7065 3f67 7c67 6966  age/(?:jpe?g|gif
-00025cd0: 7c70 6e67 2929 3b3f 2862 6173 6536 3429  |png));?(base64)
-00025ce0: 3f2c 282e 2b29 2327 2c20 2475 726c 2c20  ?,(.+)#', $url, 
-00025cf0: 246d 6174 6368 2929 207b 0a20 2020 2020  $match)) {.     
-00025d00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00025d10: 6620 2863 6f75 6e74 2824 6d61 7463 6829  f (count($match)
-00025d20: 203d 3d3d 2034 2026 2620 7374 6174 6963   === 4 && static
-00025d30: 3a3a 454e 434f 4449 4e47 5f42 4153 4536  ::ENCODING_BASE6
-00025d40: 3420 3d3d 3d20 246d 6174 6368 5b32 5d29  4 === $match[2])
-00025d50: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00025d60: 2020 2020 2020 2020 2020 2024 6461 7461             $data
-00025d70: 203d 2062 6173 6536 345f 6465 636f 6465   = base64_decode
-00025d80: 2824 6d61 7463 685b 335d 293b 0a20 2020  ($match[3]);.   
-00025d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025da0: 207d 2065 6c73 6569 6620 2827 2720 3d3d   } elseif ('' ==
-00025db0: 3d20 246d 6174 6368 5b32 5d29 207b 0a20  = $match[2]) {. 
-00025dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025dd0: 2020 2020 2020 2024 6461 7461 203d 2072         $data = r
-00025de0: 6177 7572 6c64 6563 6f64 6528 246d 6174  awurldecode($mat
-00025df0: 6368 5b33 5d29 3b0a 2020 2020 2020 2020  ch[3]);.        
-00025e00: 2020 2020 2020 2020 2020 2020 7d20 656c              } el
-00025e10: 7365 207b 0a20 2020 2020 2020 2020 2020  se {.           
-00025e20: 2020 2020 2020 2020 2020 2020 202f 2f4e               //N
-00025e30: 6f74 2072 6563 6f67 6e69 7365 6420 736f  ot recognised so
-00025e40: 206c 6561 7665 2069 7420 616c 6f6e 650a   leave it alone.
-00025e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e60: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00025e70: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-00025e80: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00025e90: 2020 2020 2020 2020 2020 2020 2f2f 4861              //Ha
-00025ea0: 7368 2074 6865 2064 6563 6f64 6564 2064  sh the decoded d
-00025eb0: 6174 612c 206e 6f74 2074 6865 2055 524c  ata, not the URL
-00025ec0: 2c20 736f 2074 6861 7420 7468 6520 7361  , so that the sa
-00025ed0: 6d65 2064 6174 612d 5552 4920 696d 6167  me data-URI imag
-00025ee0: 6520 7573 6564 2069 6e20 6d75 6c74 6970  e used in multip
-00025ef0: 6c65 2070 6c61 6365 730a 2020 2020 2020  le places.      
-00025f00: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00025f10: 7769 6c6c 206f 6e6c 7920 6265 2065 6d62  will only be emb
-00025f20: 6564 6465 6420 6f6e 6365 2c20 6576 656e  edded once, even
-00025f30: 2069 6620 6974 2075 7365 6420 6120 6469   if it used a di
-00025f40: 6666 6572 656e 7420 656e 636f 6469 6e67  fferent encoding
-00025f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025f60: 2020 2020 2024 6369 6420 3d20 7375 6273       $cid = subs
-00025f70: 7472 2868 6173 6828 2773 6861 3235 3627  tr(hash('sha256'
-00025f80: 2c20 2464 6174 6129 2c20 302c 2033 3229  , $data), 0, 32)
-00025f90: 202e 2027 4070 6870 6d61 696c 6572 2e30   . '@phpmailer.0
-00025fa0: 273b 202f 2f52 4643 3233 3932 2053 2032  '; //RFC2392 S 2
-00025fb0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025fc0: 2020 2020 2020 6966 2028 2124 7468 6973        if (!$this
-00025fd0: 2d3e 6369 6445 7869 7374 7328 2463 6964  ->cidExists($cid
-00025fe0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00025ff0: 2020 2020 2020 2020 2020 2020 2024 7468               $th
-00026000: 6973 2d3e 6164 6453 7472 696e 6745 6d62  is->addStringEmb
-00026010: 6564 6465 6449 6d61 6765 280a 2020 2020  eddedImage(.    
-00026020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026030: 2020 2020 2020 2020 2464 6174 612c 0a20          $data,. 
-00026040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026050: 2020 2020 2020 2020 2020 2024 6369 642c             $cid,
-00026060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026070: 2020 2020 2020 2020 2020 2020 2027 656d               'em
-00026080: 6265 6427 202e 2024 696d 6769 6e64 6578  bed' . $imgindex
-00026090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000260a0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-000260b0: 6174 6963 3a3a 454e 434f 4449 4e47 5f42  atic::ENCODING_B
-000260c0: 4153 4536 342c 0a20 2020 2020 2020 2020  ASE64,.         
-000260d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260e0: 2020 2024 6d61 7463 685b 315d 0a20 2020     $match[1].   
-000260f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026100: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-00026110: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00026120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026130: 2020 246d 6573 7361 6765 203d 2073 7472    $message = str
-00026140: 5f72 6570 6c61 6365 280a 2020 2020 2020  _replace(.      
-00026150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026160: 2020 2469 6d61 6765 735b 305d 5b24 696d    $images[0][$im
-00026170: 6769 6e64 6578 5d2c 0a20 2020 2020 2020  gindex],.       
-00026180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026190: 2024 696d 6167 6573 5b31 5d5b 2469 6d67   $images[1][$img
-000261a0: 696e 6465 785d 202e 2027 3d22 6369 643a  index] . '="cid:
-000261b0: 2720 2e20 2463 6964 202e 2027 2227 2c0a  ' . $cid . '"',.
-000261c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261d0: 2020 2020 2020 2020 246d 6573 7361 6765          $message
-000261e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000261f0: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-00026200: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00026210: 696e 7565 3b0a 2020 2020 2020 2020 2020  inue;.          
-00026220: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00026230: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00026240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026250: 202f 2f4f 6e6c 7920 7072 6f63 6573 7320   //Only process 
-00026260: 7265 6c61 7469 7665 2055 524c 7320 6966  relative URLs if
-00026270: 2061 2062 6173 6564 6972 2069 7320 7072   a basedir is pr
-00026280: 6f76 6964 6564 2028 692e 652e 206e 6f20  ovided (i.e. no 
-00026290: 6162 736f 6c75 7465 206c 6f63 616c 2070  absolute local p
-000262a0: 6174 6873 290a 2020 2020 2020 2020 2020  aths).          
-000262b0: 2020 2020 2020 2020 2020 2165 6d70 7479            !empty
-000262c0: 2824 6261 7365 6469 7229 0a20 2020 2020  ($basedir).     
-000262d0: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-000262e0: 2f49 676e 6f72 6520 5552 4c73 2063 6f6e  /Ignore URLs con
-000262f0: 7461 696e 696e 6720 7061 7265 6e74 2064  taining parent d
-00026300: 6972 2074 7261 7665 7273 616c 2028 2e2e  ir traversal (..
-00026310: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00026320: 2020 2020 2020 2626 2028 7374 7270 6f73        && (strpos
-00026330: 2824 7572 6c2c 2027 2e2e 2729 203d 3d3d  ($url, '..') ===
-00026340: 2066 616c 7365 290a 2020 2020 2020 2020   false).        
-00026350: 2020 2020 2020 2020 2020 2020 2f2f 446f              //Do
-00026360: 206e 6f74 2063 6861 6e67 6520 7572 6c73   not change urls
-00026370: 2074 6861 7420 6172 6520 616c 7265 6164   that are alread
-00026380: 7920 696e 6c69 6e65 2069 6d61 6765 730a  y inline images.
-00026390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263a0: 2020 2020 2626 2030 2021 3d3d 2073 7472      && 0 !== str
-000263b0: 706f 7328 2475 726c 2c20 2763 6964 3a27  pos($url, 'cid:'
-000263c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000263d0: 2020 2020 2020 2f2f 446f 206e 6f74 2063        //Do not c
-000263e0: 6861 6e67 6520 6162 736f 6c75 7465 2055  hange absolute U
-000263f0: 524c 732c 2069 6e63 6c75 6469 6e67 2061  RLs, including a
-00026400: 6e6f 6e79 6d6f 7573 2070 726f 746f 636f  nonymous protoco
-00026410: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-00026420: 2020 2020 2020 2626 2021 7072 6567 5f6d        && !preg_m
-00026430: 6174 6368 2827 235e 5b61 2d7a 5d5b 612d  atch('#^[a-z][a-
-00026440: 7a30 2d39 2b2e 2d5d 2a3a 3f2f 2f23 6927  z0-9+.-]*:?//#i'
-00026450: 2c20 2475 726c 290a 2020 2020 2020 2020  , $url).        
-00026460: 2020 2020 2020 2020 2920 7b0a 2020 2020          ) {.    
-00026470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026480: 2466 696c 656e 616d 6520 3d20 7374 6174  $filename = stat
-00026490: 6963 3a3a 6d62 5f70 6174 6869 6e66 6f28  ic::mb_pathinfo(
-000264a0: 2475 726c 2c20 5041 5448 494e 464f 5f42  $url, PATHINFO_B
-000264b0: 4153 454e 414d 4529 3b0a 2020 2020 2020  ASENAME);.      
-000264c0: 2020 2020 2020 2020 2020 2020 2020 2464                $d
-000264d0: 6972 6563 746f 7279 203d 2064 6972 6e61  irectory = dirna
-000264e0: 6d65 2824 7572 6c29 3b0a 2020 2020 2020  me($url);.      
-000264f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00026500: 2028 272e 2720 3d3d 3d20 2464 6972 6563   ('.' === $direc
-00026510: 746f 7279 2920 7b0a 2020 2020 2020 2020  tory) {.        
-00026520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026530: 2464 6972 6563 746f 7279 203d 2027 273b  $directory = '';
-00026540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026550: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00026560: 2020 2020 2020 2020 2020 202f 2f52 4643             //RFC
-00026570: 3233 3932 2053 2032 0a20 2020 2020 2020  2392 S 2.       
-00026580: 2020 2020 2020 2020 2020 2020 2024 6369               $ci
-00026590: 6420 3d20 7375 6273 7472 2868 6173 6828  d = substr(hash(
-000265a0: 2773 6861 3235 3627 2c20 2475 726c 292c  'sha256', $url),
-000265b0: 2030 2c20 3332 2920 2e20 2740 7068 706d   0, 32) . '@phpm
-000265c0: 6169 6c65 722e 3027 3b0a 2020 2020 2020  ailer.0';.      
-000265d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000265e0: 2028 7374 726c 656e 2824 6261 7365 6469   (strlen($basedi
-000265f0: 7229 203e 2031 2026 2620 272f 2720 213d  r) > 1 && '/' !=
-00026600: 3d20 7375 6273 7472 2824 6261 7365 6469  = substr($basedi
-00026610: 722c 202d 3129 2920 7b0a 2020 2020 2020  r, -1)) {.      
-00026620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026630: 2020 2462 6173 6564 6972 202e 3d20 272f    $basedir .= '/
-00026640: 273b 0a20 2020 2020 2020 2020 2020 2020  ';.             
-00026650: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00026660: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00026670: 2873 7472 6c65 6e28 2464 6972 6563 746f  (strlen($directo
-00026680: 7279 2920 3e20 3120 2626 2027 2f27 2021  ry) > 1 && '/' !
-00026690: 3d3d 2073 7562 7374 7228 2464 6972 6563  == substr($direc
-000266a0: 746f 7279 2c20 2d31 2929 207b 0a20 2020  tory, -1)) {.   
-000266b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266c0: 2020 2020 2024 6469 7265 6374 6f72 7920       $directory 
-000266d0: 2e3d 2027 2f27 3b0a 2020 2020 2020 2020  .= '/';.        
-000266e0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-000266f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026700: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00026710: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00026720: 7468 6973 2d3e 6164 6445 6d62 6564 6465  this->addEmbedde
-00026730: 6449 6d61 6765 280a 2020 2020 2020 2020  dImage(.        
-00026740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026750: 2020 2020 2462 6173 6564 6972 202e 2024      $basedir . $
-00026760: 6469 7265 6374 6f72 7920 2e20 2466 696c  directory . $fil
-00026770: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
-00026780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026790: 2020 2024 6369 642c 0a20 2020 2020 2020     $cid,.       
-000267a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267b0: 2020 2020 2024 6669 6c65 6e61 6d65 2c0a       $filename,.
-000267c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267d0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-000267e0: 6963 3a3a 454e 434f 4449 4e47 5f42 4153  ic::ENCODING_BAS
-000267f0: 4536 342c 0a20 2020 2020 2020 2020 2020  E64,.           
-00026800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026810: 2073 7461 7469 633a 3a5f 6d69 6d65 5f74   static::_mime_t
-00026820: 7970 6573 2828 7374 7269 6e67 2920 7374  ypes((string) st
-00026830: 6174 6963 3a3a 6d62 5f70 6174 6869 6e66  atic::mb_pathinf
-00026840: 6f28 2466 696c 656e 616d 652c 2050 4154  o($filename, PAT
-00026850: 4849 4e46 4f5f 4558 5445 4e53 494f 4e29  HINFO_EXTENSION)
-00026860: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00026870: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00026880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026890: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-000268a0: 2020 2020 2020 2020 2020 2020 246d 6573              $mes
-000268b0: 7361 6765 203d 2070 7265 675f 7265 706c  sage = preg_repl
-000268c0: 6163 6528 0a20 2020 2020 2020 2020 2020  ace(.           
-000268d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000268e0: 2027 2f27 202e 2024 696d 6167 6573 5b31   '/' . $images[1
-000268f0: 5d5b 2469 6d67 696e 6465 785d 202e 2027  ][$imgindex] . '
-00026900: 3d5b 225c 275d 2720 2e20 7072 6567 5f71  =["\']' . preg_q
-00026910: 756f 7465 2824 7572 6c2c 2027 2f27 2920  uote($url, '/') 
-00026920: 2e20 275b 225c 275d 2f55 6927 2c0a 2020  . '["\']/Ui',.  
-00026930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026940: 2020 2020 2020 2020 2020 2469 6d61 6765            $image
-00026950: 735b 315d 5b24 696d 6769 6e64 6578 5d20  s[1][$imgindex] 
-00026960: 2e20 273d 2263 6964 3a27 202e 2024 6369  . '="cid:' . $ci
-00026970: 6420 2e20 2722 272c 0a20 2020 2020 2020  d . '"',.       
-00026980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026990: 2020 2020 2024 6d65 7373 6167 650a 2020       $message.  
-000269a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000269b0: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
-000269c0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-000269d0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000269e0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-000269f0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00026a00: 2024 7468 6973 2d3e 6973 4854 4d4c 2829   $this->isHTML()
-00026a10: 3b0a 2020 2020 2020 2020 2f2f 436f 6e76  ;.        //Conv
-00026a20: 6572 7420 616c 6c20 6d65 7373 6167 6520  ert all message 
-00026a30: 626f 6479 206c 696e 6520 6272 6561 6b73  body line breaks
-00026a40: 2074 6f20 4c45 2c20 6d61 6b65 7320 7175   to LE, makes qu
-00026a50: 6f74 6564 2d70 7269 6e74 6162 6c65 2065  oted-printable e
-00026a60: 6e63 6f64 696e 6720 776f 726b 206d 7563  ncoding work muc
-00026a70: 6820 6265 7474 6572 0a20 2020 2020 2020  h better.       
-00026a80: 2024 7468 6973 2d3e 426f 6479 203d 2073   $this->Body = s
-00026a90: 7461 7469 633a 3a6e 6f72 6d61 6c69 7a65  tatic::normalize
-00026aa0: 4272 6561 6b73 2824 6d65 7373 6167 6529  Breaks($message)
-00026ab0: 3b0a 2020 2020 2020 2020 2474 6869 732d  ;.        $this-
-00026ac0: 3e41 6c74 426f 6479 203d 2073 7461 7469  >AltBody = stati
-00026ad0: 633a 3a6e 6f72 6d61 6c69 7a65 4272 6561  c::normalizeBrea
-00026ae0: 6b73 2824 7468 6973 2d3e 6874 6d6c 3274  ks($this->html2t
-00026af0: 6578 7428 246d 6573 7361 6765 2c20 2461  ext($message, $a
-00026b00: 6476 616e 6365 6429 293b 0a20 2020 2020  dvanced));.     
-00026b10: 2020 2069 6620 2821 2474 6869 732d 3e61     if (!$this->a
-00026b20: 6c74 6572 6e61 7469 7665 4578 6973 7473  lternativeExists
-00026b30: 2829 2920 7b0a 2020 2020 2020 2020 2020  ()) {.          
-00026b40: 2020 2474 6869 732d 3e41 6c74 426f 6479    $this->AltBody
-00026b50: 203d 2027 5468 6973 2069 7320 616e 2048   = 'This is an H
-00026b60: 544d 4c2d 6f6e 6c79 206d 6573 7361 6765  TML-only message
-00026b70: 2e20 546f 2076 6965 7720 6974 2c20 6163  . To view it, ac
-00026b80: 7469 7661 7465 2048 544d 4c20 696e 2079  tivate HTML in y
-00026b90: 6f75 7220 656d 6169 6c20 6170 706c 6963  our email applic
-00026ba0: 6174 696f 6e2e 270a 2020 2020 2020 2020  ation.'.        
-00026bb0: 2020 2020 2020 2020 2e20 7374 6174 6963          . static
-00026bc0: 3a3a 244c 453b 0a20 2020 2020 2020 207d  ::$LE;.        }
-00026bd0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00026be0: 2024 7468 6973 2d3e 426f 6479 3b0a 2020   $this->Body;.  
-00026bf0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00026c00: 2020 2a20 436f 6e76 6572 7420 616e 2048    * Convert an H
-00026c10: 544d 4c20 7374 7269 6e67 2069 6e74 6f20  TML string into 
-00026c20: 706c 6169 6e20 7465 7874 2e0a 2020 2020  plain text..    
-00026c30: 202a 2054 6869 7320 6973 2075 7365 6420   * This is used 
-00026c40: 6279 206d 7367 4854 4d4c 2829 2e0a 2020  by msgHTML()..  
-00026c50: 2020 202a 204e 6f74 6520 2d20 6f6c 6465     * Note - olde
-00026c60: 7220 7665 7273 696f 6e73 206f 6620 7468  r versions of th
-00026c70: 6973 2066 756e 6374 696f 6e20 7573 6564  is function used
-00026c80: 2061 2062 756e 646c 6564 2061 6476 616e   a bundled advan
-00026c90: 6365 6420 636f 6e76 6572 7465 720a 2020  ced converter.  
-00026ca0: 2020 202a 2077 6869 6368 2077 6173 2072     * which was r
-00026cb0: 656d 6f76 6564 2066 6f72 206c 6963 656e  emoved for licen
-00026cc0: 7365 2072 6561 736f 6e73 2069 6e20 2332  se reasons in #2
-00026cd0: 3332 2e0a 2020 2020 202a 2045 7861 6d70  32..     * Examp
-00026ce0: 6c65 2075 7361 6765 3a0a 2020 2020 202a  le usage:.     *
-00026cf0: 0a20 2020 2020 2a20 6060 6070 6870 0a20  .     * ```php. 
-00026d00: 2020 2020 2a20 2f2f 5573 6520 6465 6661      * //Use defa
-00026d10: 756c 7420 636f 6e76 6572 7369 6f6e 0a20  ult conversion. 
-00026d20: 2020 2020 2a20 2470 6c61 696e 203d 2024      * $plain = $
-00026d30: 6d61 696c 2d3e 6874 6d6c 3274 6578 7428  mail->html2text(
-00026d40: 2468 746d 6c29 3b0a 2020 2020 202a 202f  $html);.     * /
-00026d50: 2f55 7365 2079 6f75 7220 6f77 6e20 6375  /Use your own cu
-00026d60: 7374 6f6d 2063 6f6e 7665 7274 6572 0a20  stom converter. 
-00026d70: 2020 2020 2a20 2470 6c61 696e 203d 2024      * $plain = $
-00026d80: 6d61 696c 2d3e 6874 6d6c 3274 6578 7428  mail->html2text(
-00026d90: 2468 746d 6c2c 2066 756e 6374 696f 6e28  $html, function(
-00026da0: 2468 746d 6c29 207b 0a20 2020 2020 2a20  $html) {.     * 
-00026db0: 2020 2020 2463 6f6e 7665 7274 6572 203d      $converter =
-00026dc0: 206e 6577 204d 7948 746d 6c32 7465 7874   new MyHtml2text
-00026dd0: 2824 6874 6d6c 293b 0a20 2020 2020 2a20  ($html);.     * 
-00026de0: 2020 2020 7265 7475 726e 2024 636f 6e76      return $conv
-00026df0: 6572 7465 722d 3e67 6574 5f74 6578 7428  erter->get_text(
-00026e00: 293b 0a20 2020 2020 2a20 7d29 3b0a 2020  );.     * });.  
-00026e10: 2020 202a 2060 6060 0a20 2020 2020 2a0a     * ```.     *.
-00026e20: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-00026e30: 7269 6e67 2020 2020 2020 2020 2468 746d  ring        $htm
-00026e40: 6c20 2020 2020 5468 6520 4854 4d4c 2074  l     The HTML t
-00026e50: 6578 7420 746f 2063 6f6e 7665 7274 0a20  ext to convert. 
-00026e60: 2020 2020 2a20 4070 6172 616d 2062 6f6f      * @param boo
-00026e70: 6c7c 6361 6c6c 6162 6c65 2024 6164 7661  l|callable $adva
-00026e80: 6e63 6564 2041 6e79 2062 6f6f 6c65 616e  nced Any boolean
-00026e90: 2076 616c 7565 2074 6f20 7573 6520 7468   value to use th
-00026ea0: 6520 696e 7465 726e 616c 2063 6f6e 7665  e internal conve
-00026eb0: 7274 6572 2c0a 2020 2020 202a 2020 2020  rter,.     *    
-00026ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ed0: 2020 2020 2020 2020 2020 2020 6f72 2070              or p
-00026ee0: 726f 7669 6465 2079 6f75 7220 6f77 6e20  rovide your own 
-00026ef0: 6361 6c6c 6162 6c65 2066 6f72 2063 7573  callable for cus
-00026f00: 746f 6d20 636f 6e76 6572 7369 6f6e 2e0a  tom conversion..
-00026f10: 2020 2020 202a 2020 2020 2020 2020 2020       *          
-00026f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026f30: 2020 2020 2020 2a4e 6576 6572 2a20 7061        *Never* pa
-00026f40: 7373 2075 7365 722d 7375 7070 6c69 6564  ss user-supplied
-00026f50: 2064 6174 6120 696e 746f 2074 6869 7320   data into this 
-00026f60: 7061 7261 6d65 7465 720a 2020 2020 202a  parameter.     *
-00026f70: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
-00026f80: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
-00026f90: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
-00026fa0: 6f6e 2068 746d 6c32 7465 7874 2824 6874  on html2text($ht
-00026fb0: 6d6c 2c20 2461 6476 616e 6365 6420 3d20  ml, $advanced = 
-00026fc0: 6661 6c73 6529 0a20 2020 207b 0a20 2020  false).    {.   
-00026fd0: 2020 2020 2069 6620 2869 735f 6361 6c6c       if (is_call
-00026fe0: 6162 6c65 2824 6164 7661 6e63 6564 2929  able($advanced))
-00026ff0: 207b 0a20 2020 2020 2020 2020 2020 2072   {.            r
-00027000: 6574 7572 6e20 6361 6c6c 5f75 7365 725f  eturn call_user_
-00027010: 6675 6e63 2824 6164 7661 6e63 6564 2c20  func($advanced, 
-00027020: 2468 746d 6c29 3b0a 2020 2020 2020 2020  $html);.        
-00027030: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
-00027040: 6e20 6874 6d6c 5f65 6e74 6974 795f 6465  n html_entity_de
-00027050: 636f 6465 280a 2020 2020 2020 2020 2020  code(.          
-00027060: 2020 7472 696d 2873 7472 6970 5f74 6167    trim(strip_tag
-00027070: 7328 7072 6567 5f72 6570 6c61 6365 2827  s(preg_replace('
-00027080: 2f3c 2868 6561 647c 7469 746c 657c 7374  /<(head|title|st
-00027090: 796c 657c 7363 7269 7074 295b 5e3e 5d2a  yle|script)[^>]*
-000270a0: 3e2e 2a3f 3c5c 2f5c 5c31 3e2f 7369 272c  >.*?<\/\\1>/si',
-000270b0: 2027 272c 2024 6874 6d6c 2929 292c 0a20   '', $html))),. 
-000270c0: 2020 2020 2020 2020 2020 2045 4e54 5f51             ENT_Q
-000270d0: 554f 5445 532c 0a20 2020 2020 2020 2020  UOTES,.         
-000270e0: 2020 2024 7468 6973 2d3e 4368 6172 5365     $this->CharSe
-000270f0: 740a 2020 2020 2020 2020 293b 0a20 2020  t.        );.   
-00027100: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
-00027110: 202a 2047 6574 2074 6865 204d 494d 4520   * Get the MIME 
-00027120: 7479 7065 2066 6f72 2061 2066 696c 6520  type for a file 
-00027130: 6578 7465 6e73 696f 6e2e 0a20 2020 2020  extension..     
-00027140: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-00027150: 7374 7269 6e67 2024 6578 7420 4669 6c65  string $ext File
-00027160: 2065 7874 656e 7369 6f6e 0a20 2020 2020   extension.     
-00027170: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-00027180: 2073 7472 696e 6720 4d49 4d45 2074 7970   string MIME typ
-00027190: 6520 6f66 2066 696c 650a 2020 2020 202a  e of file.     *
-000271a0: 2f0a 2020 2020 7075 626c 6963 2073 7461  /.    public sta
-000271b0: 7469 6320 6675 6e63 7469 6f6e 205f 6d69  tic function _mi
-000271c0: 6d65 5f74 7970 6573 2824 6578 7420 3d20  me_types($ext = 
-000271d0: 2727 290a 2020 2020 7b0a 2020 2020 2020  '').    {.      
-000271e0: 2020 246d 696d 6573 203d 205b 0a20 2020    $mimes = [.   
-000271f0: 2020 2020 2020 2020 2027 786c 2720 3d3e           'xl' =>
-00027200: 2027 6170 706c 6963 6174 696f 6e2f 6578   'application/ex
-00027210: 6365 6c27 2c0a 2020 2020 2020 2020 2020  cel',.          
-00027220: 2020 276a 7327 203d 3e20 2761 7070 6c69    'js' => 'appli
-00027230: 6361 7469 6f6e 2f6a 6176 6173 6372 6970  cation/javascrip
-00027240: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
-00027250: 2768 7178 2720 3d3e 2027 6170 706c 6963  'hqx' => 'applic
-00027260: 6174 696f 6e2f 6d61 632d 6269 6e68 6578  ation/mac-binhex
-00027270: 3430 272c 0a20 2020 2020 2020 2020 2020  40',.           
-00027280: 2027 6370 7427 203d 3e20 2761 7070 6c69   'cpt' => 'appli
-00027290: 6361 7469 6f6e 2f6d 6163 2d63 6f6d 7061  cation/mac-compa
-000272a0: 6374 7072 6f27 2c0a 2020 2020 2020 2020  ctpro',.        
-000272b0: 2020 2020 2762 696e 2720 3d3e 2027 6170      'bin' => 'ap
-000272c0: 706c 6963 6174 696f 6e2f 6d61 6362 696e  plication/macbin
-000272d0: 6172 7927 2c0a 2020 2020 2020 2020 2020  ary',.          
-000272e0: 2020 2764 6f63 2720 3d3e 2027 6170 706c    'doc' => 'appl
-000272f0: 6963 6174 696f 6e2f 6d73 776f 7264 272c  ication/msword',
-00027300: 0a20 2020 2020 2020 2020 2020 2027 776f  .            'wo
-00027310: 7264 2720 3d3e 2027 6170 706c 6963 6174  rd' => 'applicat
-00027320: 696f 6e2f 6d73 776f 7264 272c 0a20 2020  ion/msword',.   
-00027330: 2020 2020 2020 2020 2027 786c 7378 2720           'xlsx' 
-00027340: 3d3e 2027 6170 706c 6963 6174 696f 6e2f  => 'application/
-00027350: 766e 642e 6f70 656e 786d 6c66 6f72 6d61  vnd.openxmlforma
-00027360: 7473 2d6f 6666 6963 6564 6f63 756d 656e  ts-officedocumen
-00027370: 742e 7370 7265 6164 7368 6565 746d 6c2e  t.spreadsheetml.
-00027380: 7368 6565 7427 2c0a 2020 2020 2020 2020  sheet',.        
-00027390: 2020 2020 2778 6c74 7827 203d 3e20 2761      'xltx' => 'a
-000273a0: 7070 6c69 6361 7469 6f6e 2f76 6e64 2e6f  pplication/vnd.o
-000273b0: 7065 6e78 6d6c 666f 726d 6174 732d 6f66  penxmlformats-of
-000273c0: 6669 6365 646f 6375 6d65 6e74 2e73 7072  ficedocument.spr
-000273d0: 6561 6473 6865 6574 6d6c 2e74 656d 706c  eadsheetml.templ
-000273e0: 6174 6527 2c0a 2020 2020 2020 2020 2020  ate',.          
-000273f0: 2020 2770 6f74 7827 203d 3e20 2761 7070    'potx' => 'app
-00027400: 6c69 6361 7469 6f6e 2f76 6e64 2e6f 7065  lication/vnd.ope
-00027410: 6e78 6d6c 666f 726d 6174 732d 6f66 6669  nxmlformats-offi
-00027420: 6365 646f 6375 6d65 6e74 2e70 7265 7365  cedocument.prese
-00027430: 6e74 6174 696f 6e6d 6c2e 7465 6d70 6c61  ntationml.templa
-00027440: 7465 272c 0a20 2020 2020 2020 2020 2020  te',.           
-00027450: 2027 7070 7378 2720 3d3e 2027 6170 706c   'ppsx' => 'appl
-00027460: 6963 6174 696f 6e2f 766e 642e 6f70 656e  ication/vnd.open
-00027470: 786d 6c66 6f72 6d61 7473 2d6f 6666 6963  xmlformats-offic
-00027480: 6564 6f63 756d 656e 742e 7072 6573 656e  edocument.presen
-00027490: 7461 7469 6f6e 6d6c 2e73 6c69 6465 7368  tationml.slidesh
-000274a0: 6f77 272c 0a20 2020 2020 2020 2020 2020  ow',.           
-000274b0: 2027 7070 7478 2720 3d3e 2027 6170 706c   'pptx' => 'appl
-000274c0: 6963 6174 696f 6e2f 766e 642e 6f70 656e  ication/vnd.open
-000274d0: 786d 6c66 6f72 6d61 7473 2d6f 6666 6963  xmlformats-offic
-000274e0: 6564 6f63 756d 656e 742e 7072 6573 656e  edocument.presen
-000274f0: 7461 7469 6f6e 6d6c 2e70 7265 7365 6e74  tationml.present
-00027500: 6174 696f 6e27 2c0a 2020 2020 2020 2020  ation',.        
-00027510: 2020 2020 2773 6c64 7827 203d 3e20 2761      'sldx' => 'a
-00027520: 7070 6c69 6361 7469 6f6e 2f76 6e64 2e6f  pplication/vnd.o
-00027530: 7065 6e78 6d6c 666f 726d 6174 732d 6f66  penxmlformats-of
-00027540: 6669 6365 646f 6375 6d65 6e74 2e70 7265  ficedocument.pre
-00027550: 7365 6e74 6174 696f 6e6d 6c2e 736c 6964  sentationml.slid
-00027560: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
-00027570: 2764 6f63 7827 203d 3e20 2761 7070 6c69  'docx' => 'appli
-00027580: 6361 7469 6f6e 2f76 6e64 2e6f 7065 6e78  cation/vnd.openx
-00027590: 6d6c 666f 726d 6174 732d 6f66 6669 6365  mlformats-office
-000275a0: 646f 6375 6d65 6e74 2e77 6f72 6470 726f  document.wordpro
-000275b0: 6365 7373 696e 676d 6c2e 646f 6375 6d65  cessingml.docume
-000275c0: 6e74 272c 0a20 2020 2020 2020 2020 2020  nt',.           
-000275d0: 2027 646f 7478 2720 3d3e 2027 6170 706c   'dotx' => 'appl
-000275e0: 6963 6174 696f 6e2f 766e 642e 6f70 656e  ication/vnd.open
-000275f0: 786d 6c66 6f72 6d61 7473 2d6f 6666 6963  xmlformats-offic
-00027600: 6564 6f63 756d 656e 742e 776f 7264 7072  edocument.wordpr
-00027610: 6f63 6573 7369 6e67 6d6c 2e74 656d 706c  ocessingml.templ
-00027620: 6174 6527 2c0a 2020 2020 2020 2020 2020  ate',.          
-00027630: 2020 2778 6c61 6d27 203d 3e20 2761 7070    'xlam' => 'app
-00027640: 6c69 6361 7469 6f6e 2f76 6e64 2e6d 732d  lication/vnd.ms-
-00027650: 6578 6365 6c2e 6164 6469 6e2e 6d61 6372  excel.addin.macr
-00027660: 6f45 6e61 626c 6564 2e31 3227 2c0a 2020  oEnabled.12',.  
-00027670: 2020 2020 2020 2020 2020 2778 6c73 6227            'xlsb'
-00027680: 203d 3e20 2761 7070 6c69 6361 7469 6f6e   => 'application
-00027690: 2f76 6e64 2e6d 732d 6578 6365 6c2e 7368  /vnd.ms-excel.sh
-000276a0: 6565 742e 6269 6e61 7279 2e6d 6163 726f  eet.binary.macro
-000276b0: 456e 6162 6c65 642e 3132 272c 0a20 2020  Enabled.12',.   
-000276c0: 2020 2020 2020 2020 2027 636c 6173 7327           'class'
-000276d0: 203d 3e20 2761 7070 6c69 6361 7469 6f6e   => 'application
-000276e0: 2f6f 6374 6574 2d73 7472 6561 6d27 2c0a  /octet-stream',.
-000276f0: 2020 2020 2020 2020 2020 2020 2764 6c6c              'dll
-00027700: 2720 3d3e 2027 6170 706c 6963 6174 696f  ' => 'applicatio
-00027710: 6e2f 6f63 7465 742d 7374 7265 616d 272c  n/octet-stream',
-00027720: 0a20 2020 2020 2020 2020 2020 2027 646d  .            'dm
-00027730: 7327 203d 3e20 2761 7070 6c69 6361 7469  s' => 'applicati
-00027740: 6f6e 2f6f 6374 6574 2d73 7472 6561 6d27  on/octet-stream'
-00027750: 2c0a 2020 2020 2020 2020 2020 2020 2765  ,.            'e
-00027760: 7865 2720 3d3e 2027 6170 706c 6963 6174  xe' => 'applicat
-00027770: 696f 6e2f 6f63 7465 742d 7374 7265 616d  ion/octet-stream
-00027780: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027790: 6c68 6127 203d 3e20 2761 7070 6c69 6361  lha' => 'applica
-000277a0: 7469 6f6e 2f6f 6374 6574 2d73 7472 6561  tion/octet-strea
-000277b0: 6d27 2c0a 2020 2020 2020 2020 2020 2020  m',.            
-000277c0: 276c 7a68 2720 3d3e 2027 6170 706c 6963  'lzh' => 'applic
-000277d0: 6174 696f 6e2f 6f63 7465 742d 7374 7265  ation/octet-stre
-000277e0: 616d 272c 0a20 2020 2020 2020 2020 2020  am',.           
-000277f0: 2027 7073 6427 203d 3e20 2761 7070 6c69   'psd' => 'appli
-00027800: 6361 7469 6f6e 2f6f 6374 6574 2d73 7472  cation/octet-str
-00027810: 6561 6d27 2c0a 2020 2020 2020 2020 2020  eam',.          
-00027820: 2020 2773 6561 2720 3d3e 2027 6170 706c    'sea' => 'appl
-00027830: 6963 6174 696f 6e2f 6f63 7465 742d 7374  ication/octet-st
-00027840: 7265 616d 272c 0a20 2020 2020 2020 2020  ream',.         
-00027850: 2020 2027 736f 2720 3d3e 2027 6170 706c     'so' => 'appl
-00027860: 6963 6174 696f 6e2f 6f63 7465 742d 7374  ication/octet-st
-00027870: 7265 616d 272c 0a20 2020 2020 2020 2020  ream',.         
-00027880: 2020 2027 6f64 6127 203d 3e20 2761 7070     'oda' => 'app
-00027890: 6c69 6361 7469 6f6e 2f6f 6461 272c 0a20  lication/oda',. 
-000278a0: 2020 2020 2020 2020 2020 2027 7064 6627             'pdf'
-000278b0: 203d 3e20 2761 7070 6c69 6361 7469 6f6e   => 'application
-000278c0: 2f70 6466 272c 0a20 2020 2020 2020 2020  /pdf',.         
-000278d0: 2020 2027 6169 2720 3d3e 2027 6170 706c     'ai' => 'appl
-000278e0: 6963 6174 696f 6e2f 706f 7374 7363 7269  ication/postscri
-000278f0: 7074 272c 0a20 2020 2020 2020 2020 2020  pt',.           
-00027900: 2027 6570 7327 203d 3e20 2761 7070 6c69   'eps' => 'appli
-00027910: 6361 7469 6f6e 2f70 6f73 7473 6372 6970  cation/postscrip
-00027920: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
-00027930: 2770 7327 203d 3e20 2761 7070 6c69 6361  'ps' => 'applica
-00027940: 7469 6f6e 2f70 6f73 7473 6372 6970 7427  tion/postscript'
-00027950: 2c0a 2020 2020 2020 2020 2020 2020 2773  ,.            's
-00027960: 6d69 2720 3d3e 2027 6170 706c 6963 6174  mi' => 'applicat
-00027970: 696f 6e2f 736d 696c 272c 0a20 2020 2020  ion/smil',.     
-00027980: 2020 2020 2020 2027 736d 696c 2720 3d3e         'smil' =>
-00027990: 2027 6170 706c 6963 6174 696f 6e2f 736d   'application/sm
-000279a0: 696c 272c 0a20 2020 2020 2020 2020 2020  il',.           
-000279b0: 2027 6d69 6627 203d 3e20 2761 7070 6c69   'mif' => 'appli
-000279c0: 6361 7469 6f6e 2f76 6e64 2e6d 6966 272c  cation/vnd.mif',
-000279d0: 0a20 2020 2020 2020 2020 2020 2027 786c  .            'xl
-000279e0: 7327 203d 3e20 2761 7070 6c69 6361 7469  s' => 'applicati
-000279f0: 6f6e 2f76 6e64 2e6d 732d 6578 6365 6c27  on/vnd.ms-excel'
-00027a00: 2c0a 2020 2020 2020 2020 2020 2020 2770  ,.            'p
-00027a10: 7074 2720 3d3e 2027 6170 706c 6963 6174  pt' => 'applicat
-00027a20: 696f 6e2f 766e 642e 6d73 2d70 6f77 6572  ion/vnd.ms-power
-00027a30: 706f 696e 7427 2c0a 2020 2020 2020 2020  point',.        
-00027a40: 2020 2020 2777 6278 6d6c 2720 3d3e 2027      'wbxml' => '
-00027a50: 6170 706c 6963 6174 696f 6e2f 766e 642e  application/vnd.
-00027a60: 7761 702e 7762 786d 6c27 2c0a 2020 2020  wap.wbxml',.    
-00027a70: 2020 2020 2020 2020 2777 6d6c 6327 203d          'wmlc' =
-00027a80: 3e20 2761 7070 6c69 6361 7469 6f6e 2f76  > 'application/v
-00027a90: 6e64 2e77 6170 2e77 6d6c 6327 2c0a 2020  nd.wap.wmlc',.  
-00027aa0: 2020 2020 2020 2020 2020 2764 6372 2720            'dcr' 
-00027ab0: 3d3e 2027 6170 706c 6963 6174 696f 6e2f  => 'application/
-00027ac0: 782d 6469 7265 6374 6f72 272c 0a20 2020  x-director',.   
-00027ad0: 2020 2020 2020 2020 2027 6469 7227 203d           'dir' =
-00027ae0: 3e20 2761 7070 6c69 6361 7469 6f6e 2f78  > 'application/x
-00027af0: 2d64 6972 6563 746f 7227 2c0a 2020 2020  -director',.    
-00027b00: 2020 2020 2020 2020 2764 7872 2720 3d3e          'dxr' =>
-00027b10: 2027 6170 706c 6963 6174 696f 6e2f 782d   'application/x-
-00027b20: 6469 7265 6374 6f72 272c 0a20 2020 2020  director',.     
-00027b30: 2020 2020 2020 2027 6476 6927 203d 3e20         'dvi' => 
-00027b40: 2761 7070 6c69 6361 7469 6f6e 2f78 2d64  'application/x-d
-00027b50: 7669 272c 0a20 2020 2020 2020 2020 2020  vi',.           
-00027b60: 2027 6774 6172 2720 3d3e 2027 6170 706c   'gtar' => 'appl
-00027b70: 6963 6174 696f 6e2f 782d 6774 6172 272c  ication/x-gtar',
-00027b80: 0a20 2020 2020 2020 2020 2020 2027 7068  .            'ph
-00027b90: 7033 2720 3d3e 2027 6170 706c 6963 6174  p3' => 'applicat
-00027ba0: 696f 6e2f 782d 6874 7470 642d 7068 7027  ion/x-httpd-php'
-00027bb0: 2c0a 2020 2020 2020 2020 2020 2020 2770  ,.            'p
-00027bc0: 6870 3427 203d 3e20 2761 7070 6c69 6361  hp4' => 'applica
-00027bd0: 7469 6f6e 2f78 2d68 7474 7064 2d70 6870  tion/x-httpd-php
-00027be0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027bf0: 7068 7027 203d 3e20 2761 7070 6c69 6361  php' => 'applica
-00027c00: 7469 6f6e 2f78 2d68 7474 7064 2d70 6870  tion/x-httpd-php
-00027c10: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027c20: 7068 746d 6c27 203d 3e20 2761 7070 6c69  phtml' => 'appli
-00027c30: 6361 7469 6f6e 2f78 2d68 7474 7064 2d70  cation/x-httpd-p
-00027c40: 6870 272c 0a20 2020 2020 2020 2020 2020  hp',.           
-00027c50: 2027 7068 7073 2720 3d3e 2027 6170 706c   'phps' => 'appl
-00027c60: 6963 6174 696f 6e2f 782d 6874 7470 642d  ication/x-httpd-
-00027c70: 7068 702d 736f 7572 6365 272c 0a20 2020  php-source',.   
-00027c80: 2020 2020 2020 2020 2027 7377 6627 203d           'swf' =
-00027c90: 3e20 2761 7070 6c69 6361 7469 6f6e 2f78  > 'application/x
-00027ca0: 2d73 686f 636b 7761 7665 2d66 6c61 7368  -shockwave-flash
-00027cb0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027cc0: 7369 7427 203d 3e20 2761 7070 6c69 6361  sit' => 'applica
-00027cd0: 7469 6f6e 2f78 2d73 7475 6666 6974 272c  tion/x-stuffit',
-00027ce0: 0a20 2020 2020 2020 2020 2020 2027 7461  .            'ta
-00027cf0: 7227 203d 3e20 2761 7070 6c69 6361 7469  r' => 'applicati
-00027d00: 6f6e 2f78 2d74 6172 272c 0a20 2020 2020  on/x-tar',.     
-00027d10: 2020 2020 2020 2027 7467 7a27 203d 3e20         'tgz' => 
-00027d20: 2761 7070 6c69 6361 7469 6f6e 2f78 2d74  'application/x-t
-00027d30: 6172 272c 0a20 2020 2020 2020 2020 2020  ar',.           
-00027d40: 2027 7868 7427 203d 3e20 2761 7070 6c69   'xht' => 'appli
-00027d50: 6361 7469 6f6e 2f78 6874 6d6c 2b78 6d6c  cation/xhtml+xml
-00027d60: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027d70: 7868 746d 6c27 203d 3e20 2761 7070 6c69  xhtml' => 'appli
-00027d80: 6361 7469 6f6e 2f78 6874 6d6c 2b78 6d6c  cation/xhtml+xml
-00027d90: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027da0: 7a69 7027 203d 3e20 2761 7070 6c69 6361  zip' => 'applica
-00027db0: 7469 6f6e 2f7a 6970 272c 0a20 2020 2020  tion/zip',.     
-00027dc0: 2020 2020 2020 2027 6d69 6427 203d 3e20         'mid' => 
-00027dd0: 2761 7564 696f 2f6d 6964 6927 2c0a 2020  'audio/midi',.  
-00027de0: 2020 2020 2020 2020 2020 276d 6964 6927            'midi'
-00027df0: 203d 3e20 2761 7564 696f 2f6d 6964 6927   => 'audio/midi'
-00027e00: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-00027e10: 7032 2720 3d3e 2027 6175 6469 6f2f 6d70  p2' => 'audio/mp
-00027e20: 6567 272c 0a20 2020 2020 2020 2020 2020  eg',.           
-00027e30: 2027 6d70 3327 203d 3e20 2761 7564 696f   'mp3' => 'audio
-00027e40: 2f6d 7065 6727 2c0a 2020 2020 2020 2020  /mpeg',.        
-00027e50: 2020 2020 276d 3461 2720 3d3e 2027 6175      'm4a' => 'au
-00027e60: 6469 6f2f 6d70 3427 2c0a 2020 2020 2020  dio/mp4',.      
-00027e70: 2020 2020 2020 276d 7067 6127 203d 3e20        'mpga' => 
-00027e80: 2761 7564 696f 2f6d 7065 6727 2c0a 2020  'audio/mpeg',.  
-00027e90: 2020 2020 2020 2020 2020 2761 6966 2720            'aif' 
-00027ea0: 3d3e 2027 6175 6469 6f2f 782d 6169 6666  => 'audio/x-aiff
-00027eb0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00027ec0: 6169 6663 2720 3d3e 2027 6175 6469 6f2f  aifc' => 'audio/
-00027ed0: 782d 6169 6666 272c 0a20 2020 2020 2020  x-aiff',.       
-00027ee0: 2020 2020 2027 6169 6666 2720 3d3e 2027       'aiff' => '
-00027ef0: 6175 6469 6f2f 782d 6169 6666 272c 0a20  audio/x-aiff',. 
-00027f00: 2020 2020 2020 2020 2020 2027 7261 6d27             'ram'
-00027f10: 203d 3e20 2761 7564 696f 2f78 2d70 6e2d   => 'audio/x-pn-
-00027f20: 7265 616c 6175 6469 6f27 2c0a 2020 2020  realaudio',.    
-00027f30: 2020 2020 2020 2020 2772 6d27 203d 3e20          'rm' => 
-00027f40: 2761 7564 696f 2f78 2d70 6e2d 7265 616c  'audio/x-pn-real
-00027f50: 6175 6469 6f27 2c0a 2020 2020 2020 2020  audio',.        
-00027f60: 2020 2020 2772 706d 2720 3d3e 2027 6175      'rpm' => 'au
-00027f70: 6469 6f2f 782d 706e 2d72 6561 6c61 7564  dio/x-pn-realaud
-00027f80: 696f 2d70 6c75 6769 6e27 2c0a 2020 2020  io-plugin',.    
-00027f90: 2020 2020 2020 2020 2772 6127 203d 3e20          'ra' => 
-00027fa0: 2761 7564 696f 2f78 2d72 6561 6c61 7564  'audio/x-realaud
-00027fb0: 696f 272c 0a20 2020 2020 2020 2020 2020  io',.           
-00027fc0: 2027 7761 7627 203d 3e20 2761 7564 696f   'wav' => 'audio
-00027fd0: 2f78 2d77 6176 272c 0a20 2020 2020 2020  /x-wav',.       
-00027fe0: 2020 2020 2027 6d6b 6127 203d 3e20 2761       'mka' => 'a
-00027ff0: 7564 696f 2f78 2d6d 6174 726f 736b 6127  udio/x-matroska'
-00028000: 2c0a 2020 2020 2020 2020 2020 2020 2762  ,.            'b
-00028010: 6d70 2720 3d3e 2027 696d 6167 652f 626d  mp' => 'image/bm
-00028020: 7027 2c0a 2020 2020 2020 2020 2020 2020  p',.            
-00028030: 2767 6966 2720 3d3e 2027 696d 6167 652f  'gif' => 'image/
-00028040: 6769 6627 2c0a 2020 2020 2020 2020 2020  gif',.          
-00028050: 2020 276a 7065 6727 203d 3e20 2769 6d61    'jpeg' => 'ima
-00028060: 6765 2f6a 7065 6727 2c0a 2020 2020 2020  ge/jpeg',.      
-00028070: 2020 2020 2020 276a 7065 2720 3d3e 2027        'jpe' => '
-00028080: 696d 6167 652f 6a70 6567 272c 0a20 2020  image/jpeg',.   
-00028090: 2020 2020 2020 2020 2027 6a70 6727 203d           'jpg' =
-000280a0: 3e20 2769 6d61 6765 2f6a 7065 6727 2c0a  > 'image/jpeg',.
-000280b0: 2020 2020 2020 2020 2020 2020 2770 6e67              'png
-000280c0: 2720 3d3e 2027 696d 6167 652f 706e 6727  ' => 'image/png'
-000280d0: 2c0a 2020 2020 2020 2020 2020 2020 2774  ,.            't
-000280e0: 6966 6627 203d 3e20 2769 6d61 6765 2f74  iff' => 'image/t
-000280f0: 6966 6627 2c0a 2020 2020 2020 2020 2020  iff',.          
-00028100: 2020 2774 6966 2720 3d3e 2027 696d 6167    'tif' => 'imag
-00028110: 652f 7469 6666 272c 0a20 2020 2020 2020  e/tiff',.       
-00028120: 2020 2020 2027 7765 6270 2720 3d3e 2027       'webp' => '
-00028130: 696d 6167 652f 7765 6270 272c 0a20 2020  image/webp',.   
-00028140: 2020 2020 2020 2020 2027 6176 6966 2720           'avif' 
-00028150: 3d3e 2027 696d 6167 652f 6176 6966 272c  => 'image/avif',
-00028160: 0a20 2020 2020 2020 2020 2020 2027 6865  .            'he
-00028170: 6966 2720 3d3e 2027 696d 6167 652f 6865  if' => 'image/he
-00028180: 6966 272c 0a20 2020 2020 2020 2020 2020  if',.           
-00028190: 2027 6865 6966 7327 203d 3e20 2769 6d61   'heifs' => 'ima
-000281a0: 6765 2f68 6569 662d 7365 7175 656e 6365  ge/heif-sequence
-000281b0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-000281c0: 6865 6963 2720 3d3e 2027 696d 6167 652f  heic' => 'image/
-000281d0: 6865 6963 272c 0a20 2020 2020 2020 2020  heic',.         
-000281e0: 2020 2027 6865 6963 7327 203d 3e20 2769     'heics' => 'i
-000281f0: 6d61 6765 2f68 6569 632d 7365 7175 656e  mage/heic-sequen
-00028200: 6365 272c 0a20 2020 2020 2020 2020 2020  ce',.           
-00028210: 2027 656d 6c27 203d 3e20 276d 6573 7361   'eml' => 'messa
-00028220: 6765 2f72 6663 3832 3227 2c0a 2020 2020  ge/rfc822',.    
-00028230: 2020 2020 2020 2020 2763 7373 2720 3d3e          'css' =>
-00028240: 2027 7465 7874 2f63 7373 272c 0a20 2020   'text/css',.   
-00028250: 2020 2020 2020 2020 2027 6874 6d6c 2720           'html' 
-00028260: 3d3e 2027 7465 7874 2f68 746d 6c27 2c0a  => 'text/html',.
-00028270: 2020 2020 2020 2020 2020 2020 2768 746d              'htm
-00028280: 2720 3d3e 2027 7465 7874 2f68 746d 6c27  ' => 'text/html'
-00028290: 2c0a 2020 2020 2020 2020 2020 2020 2773  ,.            's
-000282a0: 6874 6d6c 2720 3d3e 2027 7465 7874 2f68  html' => 'text/h
-000282b0: 746d 6c27 2c0a 2020 2020 2020 2020 2020  tml',.          
-000282c0: 2020 276c 6f67 2720 3d3e 2027 7465 7874    'log' => 'text
-000282d0: 2f70 6c61 696e 272c 0a20 2020 2020 2020  /plain',.       
-000282e0: 2020 2020 2027 7465 7874 2720 3d3e 2027       'text' => '
-000282f0: 7465 7874 2f70 6c61 696e 272c 0a20 2020  text/plain',.   
-00028300: 2020 2020 2020 2020 2027 7478 7427 203d           'txt' =
-00028310: 3e20 2774 6578 742f 706c 6169 6e27 2c0a  > 'text/plain',.
-00028320: 2020 2020 2020 2020 2020 2020 2772 7478              'rtx
-00028330: 2720 3d3e 2027 7465 7874 2f72 6963 6874  ' => 'text/richt
-00028340: 6578 7427 2c0a 2020 2020 2020 2020 2020  ext',.          
-00028350: 2020 2772 7466 2720 3d3e 2027 7465 7874    'rtf' => 'text
-00028360: 2f72 7466 272c 0a20 2020 2020 2020 2020  /rtf',.         
-00028370: 2020 2027 7663 6627 203d 3e20 2774 6578     'vcf' => 'tex
-00028380: 742f 7663 6172 6427 2c0a 2020 2020 2020  t/vcard',.      
-00028390: 2020 2020 2020 2776 6361 7264 2720 3d3e        'vcard' =>
-000283a0: 2027 7465 7874 2f76 6361 7264 272c 0a20   'text/vcard',. 
-000283b0: 2020 2020 2020 2020 2020 2027 6963 7327             'ics'
-000283c0: 203d 3e20 2774 6578 742f 6361 6c65 6e64   => 'text/calend
-000283d0: 6172 272c 0a20 2020 2020 2020 2020 2020  ar',.           
-000283e0: 2027 786d 6c27 203d 3e20 2774 6578 742f   'xml' => 'text/
-000283f0: 786d 6c27 2c0a 2020 2020 2020 2020 2020  xml',.          
-00028400: 2020 2778 736c 2720 3d3e 2027 7465 7874    'xsl' => 'text
-00028410: 2f78 6d6c 272c 0a20 2020 2020 2020 2020  /xml',.         
-00028420: 2020 2027 6373 7627 203d 3e20 2774 6578     'csv' => 'tex
-00028430: 742f 6373 7627 2c0a 2020 2020 2020 2020  t/csv',.        
-00028440: 2020 2020 2777 6d76 2720 3d3e 2027 7669      'wmv' => 'vi
-00028450: 6465 6f2f 782d 6d73 2d77 6d76 272c 0a20  deo/x-ms-wmv',. 
-00028460: 2020 2020 2020 2020 2020 2027 6d70 6567             'mpeg
-00028470: 2720 3d3e 2027 7669 6465 6f2f 6d70 6567  ' => 'video/mpeg
-00028480: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00028490: 6d70 6527 203d 3e20 2776 6964 656f 2f6d  mpe' => 'video/m
-000284a0: 7065 6727 2c0a 2020 2020 2020 2020 2020  peg',.          
-000284b0: 2020 276d 7067 2720 3d3e 2027 7669 6465    'mpg' => 'vide
-000284c0: 6f2f 6d70 6567 272c 0a20 2020 2020 2020  o/mpeg',.       
-000284d0: 2020 2020 2027 6d70 3427 203d 3e20 2776       'mp4' => 'v
-000284e0: 6964 656f 2f6d 7034 272c 0a20 2020 2020  ideo/mp4',.     
-000284f0: 2020 2020 2020 2027 6d34 7627 203d 3e20         'm4v' => 
-00028500: 2776 6964 656f 2f6d 7034 272c 0a20 2020  'video/mp4',.   
-00028510: 2020 2020 2020 2020 2027 6d6f 7627 203d           'mov' =
-00028520: 3e20 2776 6964 656f 2f71 7569 636b 7469  > 'video/quickti
-00028530: 6d65 272c 0a20 2020 2020 2020 2020 2020  me',.           
-00028540: 2027 7174 2720 3d3e 2027 7669 6465 6f2f   'qt' => 'video/
-00028550: 7175 6963 6b74 696d 6527 2c0a 2020 2020  quicktime',.    
-00028560: 2020 2020 2020 2020 2772 7627 203d 3e20          'rv' => 
-00028570: 2776 6964 656f 2f76 6e64 2e72 6e2d 7265  'video/vnd.rn-re
-00028580: 616c 7669 6465 6f27 2c0a 2020 2020 2020  alvideo',.      
-00028590: 2020 2020 2020 2761 7669 2720 3d3e 2027        'avi' => '
-000285a0: 7669 6465 6f2f 782d 6d73 7669 6465 6f27  video/x-msvideo'
-000285b0: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-000285c0: 6f76 6965 2720 3d3e 2027 7669 6465 6f2f  ovie' => 'video/
-000285d0: 782d 7367 692d 6d6f 7669 6527 2c0a 2020  x-sgi-movie',.  
-000285e0: 2020 2020 2020 2020 2020 2777 6562 6d27            'webm'
-000285f0: 203d 3e20 2776 6964 656f 2f77 6562 6d27   => 'video/webm'
-00028600: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-00028610: 6b76 2720 3d3e 2027 7669 6465 6f2f 782d  kv' => 'video/x-
-00028620: 6d61 7472 6f73 6b61 272c 0a20 2020 2020  matroska',.     
-00028630: 2020 205d 3b0a 2020 2020 2020 2020 2465     ];.        $e
-00028640: 7874 203d 2073 7472 746f 6c6f 7765 7228  xt = strtolower(
-00028650: 2465 7874 293b 0a20 2020 2020 2020 2069  $ext);.        i
-00028660: 6620 2861 7272 6179 5f6b 6579 5f65 7869  f (array_key_exi
-00028670: 7374 7328 2465 7874 2c20 246d 696d 6573  sts($ext, $mimes
-00028680: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00028690: 2072 6574 7572 6e20 246d 696d 6573 5b24   return $mimes[$
-000286a0: 6578 745d 3b0a 2020 2020 2020 2020 7d0a  ext];.        }.
-000286b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000286c0: 2761 7070 6c69 6361 7469 6f6e 2f6f 6374  'application/oct
-000286d0: 6574 2d73 7472 6561 6d27 3b0a 2020 2020  et-stream';.    
-000286e0: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-000286f0: 2a20 4d61 7020 6120 6669 6c65 206e 616d  * Map a file nam
-00028700: 6520 746f 2061 204d 494d 4520 7479 7065  e to a MIME type
-00028710: 2e0a 2020 2020 202a 2044 6566 6175 6c74  ..     * Default
-00028720: 7320 746f 2027 6170 706c 6963 6174 696f  s to 'applicatio
-00028730: 6e2f 6f63 7465 742d 7374 7265 616d 272c  n/octet-stream',
-00028740: 2069 2e65 2e2e 2061 7262 6974 7261 7279   i.e.. arbitrary
-00028750: 2062 696e 6172 7920 6461 7461 2e0a 2020   binary data..  
-00028760: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
-00028770: 616d 2073 7472 696e 6720 2466 696c 656e  am string $filen
-00028780: 616d 6520 4120 6669 6c65 206e 616d 6520  ame A file name 
-00028790: 6f72 2066 756c 6c20 7061 7468 2c20 646f  or full path, do
-000287a0: 6573 206e 6f74 206e 6565 6420 746f 2065  es not need to e
-000287b0: 7869 7374 2061 7320 6120 6669 6c65 0a20  xist as a file. 
-000287c0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-000287d0: 7475 726e 2073 7472 696e 670a 2020 2020  turn string.    
-000287e0: 202a 2f0a 2020 2020 7075 626c 6963 2073   */.    public s
-000287f0: 7461 7469 6320 6675 6e63 7469 6f6e 2066  tatic function f
-00028800: 696c 656e 616d 6554 6f54 7970 6528 2466  ilenameToType($f
-00028810: 696c 656e 616d 6529 0a20 2020 207b 0a20  ilename).    {. 
-00028820: 2020 2020 2020 202f 2f49 6e20 6361 7365         //In case
-00028830: 2074 6865 2070 6174 6820 6973 2061 2055   the path is a U
-00028840: 524c 2c20 7374 7269 7020 616e 7920 7175  RL, strip any qu
-00028850: 6572 7920 7374 7269 6e67 2062 6566 6f72  ery string befor
-00028860: 6520 6765 7474 696e 6720 6578 7465 6e73  e getting extens
-00028870: 696f 6e0a 2020 2020 2020 2020 2471 706f  ion.        $qpo
-00028880: 7320 3d20 7374 7270 6f73 2824 6669 6c65  s = strpos($file
-00028890: 6e61 6d65 2c20 273f 2729 3b0a 2020 2020  name, '?');.    
-000288a0: 2020 2020 6966 2028 6661 6c73 6520 213d      if (false !=
-000288b0: 3d20 2471 706f 7329 207b 0a20 2020 2020  = $qpos) {.     
-000288c0: 2020 2020 2020 2024 6669 6c65 6e61 6d65         $filename
-000288d0: 203d 2073 7562 7374 7228 2466 696c 656e   = substr($filen
-000288e0: 616d 652c 2030 2c20 2471 706f 7329 3b0a  ame, 0, $qpos);.
-000288f0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00028900: 2020 2465 7874 203d 2073 7461 7469 633a    $ext = static:
-00028910: 3a6d 625f 7061 7468 696e 666f 2824 6669  :mb_pathinfo($fi
-00028920: 6c65 6e61 6d65 2c20 5041 5448 494e 464f  lename, PATHINFO
-00028930: 5f45 5854 454e 5349 4f4e 293b 0a0a 2020  _EXTENSION);..  
-00028940: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
-00028950: 7469 633a 3a5f 6d69 6d65 5f74 7970 6573  tic::_mime_types
-00028960: 2824 6578 7429 3b0a 2020 2020 7d0a 0a20  ($ext);.    }.. 
-00028970: 2020 202f 2a2a 0a20 2020 2020 2a20 4d75     /**.     * Mu
-00028980: 6c74 692d 6279 7465 2d73 6166 6520 7061  lti-byte-safe pa
-00028990: 7468 696e 666f 2072 6570 6c61 6365 6d65  thinfo replaceme
-000289a0: 6e74 2e0a 2020 2020 202a 2044 726f 702d  nt..     * Drop-
-000289b0: 696e 2072 6570 6c61 6365 6d65 6e74 2066  in replacement f
-000289c0: 6f72 2070 6174 6869 6e66 6f28 292c 2062  or pathinfo(), b
-000289d0: 7574 206d 756c 7469 6279 7465 2d20 616e  ut multibyte- an
-000289e0: 6420 6372 6f73 732d 706c 6174 666f 726d  d cross-platform
-000289f0: 2d73 6166 652e 0a20 2020 2020 2a0a 2020  -safe..     *.  
-00028a00: 2020 202a 2040 7365 6520 6874 7470 3a2f     * @see http:/
-00028a10: 2f77 7777 2e70 6870 2e6e 6574 2f6d 616e  /www.php.net/man
-00028a20: 7561 6c2f 656e 2f66 756e 6374 696f 6e2e  ual/en/function.
-00028a30: 7061 7468 696e 666f 2e70 6870 2331 3037  pathinfo.php#107
-00028a40: 3436 310a 2020 2020 202a 0a20 2020 2020  461.     *.     
-00028a50: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
-00028a60: 2020 2020 2470 6174 6820 2020 2041 2066      $path    A f
-00028a70: 696c 656e 616d 6520 6f72 2070 6174 682c  ilename or path,
-00028a80: 2064 6f65 7320 6e6f 7420 6e65 6564 2074   does not need t
-00028a90: 6f20 6578 6973 7420 6173 2061 2066 696c  o exist as a fil
-00028aa0: 650a 2020 2020 202a 2040 7061 7261 6d20  e.     * @param 
-00028ab0: 696e 747c 7374 7269 6e67 2024 6f70 7469  int|string $opti
-00028ac0: 6f6e 7320 4569 7468 6572 2061 2050 4154  ons Either a PAT
-00028ad0: 4849 4e46 4f5f 2a20 636f 6e73 7461 6e74  HINFO_* constant
-00028ae0: 2c0a 2020 2020 202a 2020 2020 2020 2020  ,.     *        
-00028af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b00: 2020 2020 6f72 2061 2073 7472 696e 6720      or a string 
-00028b10: 6e61 6d65 2074 6f20 7265 7475 726e 206f  name to return o
-00028b20: 6e6c 7920 7468 6520 7370 6563 6966 6965  nly the specifie
-00028b30: 6420 7069 6563 650a 2020 2020 202a 0a20  d piece.     *. 
-00028b40: 2020 2020 2a20 4072 6574 7572 6e20 7374      * @return st
-00028b50: 7269 6e67 7c61 7272 6179 0a20 2020 2020  ring|array.     
-00028b60: 2a2f 0a20 2020 2070 7562 6c69 6320 7374  */.    public st
-00028b70: 6174 6963 2066 756e 6374 696f 6e20 6d62  atic function mb
-00028b80: 5f70 6174 6869 6e66 6f28 2470 6174 682c  _pathinfo($path,
-00028b90: 2024 6f70 7469 6f6e 7320 3d20 6e75 6c6c   $options = null
-00028ba0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00028bb0: 2472 6574 203d 205b 2764 6972 6e61 6d65  $ret = ['dirname
-00028bc0: 2720 3d3e 2027 272c 2027 6261 7365 6e61  ' => '', 'basena
-00028bd0: 6d65 2720 3d3e 2027 272c 2027 6578 7465  me' => '', 'exte
-00028be0: 6e73 696f 6e27 203d 3e20 2727 2c20 2766  nsion' => '', 'f
-00028bf0: 696c 656e 616d 6527 203d 3e20 2727 5d3b  ilename' => ''];
-00028c00: 0a20 2020 2020 2020 2024 7061 7468 696e  .        $pathin
-00028c10: 666f 203d 205b 5d3b 0a20 2020 2020 2020  fo = [];.       
-00028c20: 2069 6620 2870 7265 675f 6d61 7463 6828   if (preg_match(
-00028c30: 2723 5e28 2e2a 3f29 5b5c 5c5c 5c2f 5d2a  '#^(.*?)[\\\\/]*
-00028c40: 2828 5b5e 2f5c 5c5c 5c5d 2a3f 2928 5c2e  (([^/\\\\]*?)(\.
-00028c50: 285b 5e2e 5c5c 5c5c 2f5d 2b3f 297c 2929  ([^.\\\\/]+?)|))
-00028c60: 5b5c 5c5c 5c2f 2e5d 2a24 236d 272c 2024  [\\\\/.]*$#m', $
-00028c70: 7061 7468 2c20 2470 6174 6869 6e66 6f29  path, $pathinfo)
-00028c80: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00028c90: 6966 2028 6172 7261 795f 6b65 795f 6578  if (array_key_ex
-00028ca0: 6973 7473 2831 2c20 2470 6174 6869 6e66  ists(1, $pathinf
-00028cb0: 6f29 2920 7b0a 2020 2020 2020 2020 2020  o)) {.          
-00028cc0: 2020 2020 2020 2472 6574 5b27 6469 726e        $ret['dirn
-00028cd0: 616d 6527 5d20 3d20 2470 6174 6869 6e66  ame'] = $pathinf
-00028ce0: 6f5b 315d 3b0a 2020 2020 2020 2020 2020  o[1];.          
-00028cf0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00028d00: 6966 2028 6172 7261 795f 6b65 795f 6578  if (array_key_ex
-00028d10: 6973 7473 2832 2c20 2470 6174 6869 6e66  ists(2, $pathinf
-00028d20: 6f29 2920 7b0a 2020 2020 2020 2020 2020  o)) {.          
-00028d30: 2020 2020 2020 2472 6574 5b27 6261 7365        $ret['base
-00028d40: 6e61 6d65 275d 203d 2024 7061 7468 696e  name'] = $pathin
-00028d50: 666f 5b32 5d3b 0a20 2020 2020 2020 2020  fo[2];.         
-00028d60: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00028d70: 2069 6620 2861 7272 6179 5f6b 6579 5f65   if (array_key_e
-00028d80: 7869 7374 7328 352c 2024 7061 7468 696e  xists(5, $pathin
-00028d90: 666f 2929 207b 0a20 2020 2020 2020 2020  fo)) {.         
-00028da0: 2020 2020 2020 2024 7265 745b 2765 7874         $ret['ext
-00028db0: 656e 7369 6f6e 275d 203d 2024 7061 7468  ension'] = $path
-00028dc0: 696e 666f 5b35 5d3b 0a20 2020 2020 2020  info[5];.       
-00028dd0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00028de0: 2020 2069 6620 2861 7272 6179 5f6b 6579     if (array_key
-00028df0: 5f65 7869 7374 7328 332c 2024 7061 7468  _exists(3, $path
-00028e00: 696e 666f 2929 207b 0a20 2020 2020 2020  info)) {.       
-00028e10: 2020 2020 2020 2020 2024 7265 745b 2766           $ret['f
-00028e20: 696c 656e 616d 6527 5d20 3d20 2470 6174  ilename'] = $pat
-00028e30: 6869 6e66 6f5b 335d 3b0a 2020 2020 2020  hinfo[3];.      
-00028e40: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00028e50: 7d0a 2020 2020 2020 2020 7377 6974 6368  }.        switch
-00028e60: 2028 246f 7074 696f 6e73 2920 7b0a 2020   ($options) {.  
-00028e70: 2020 2020 2020 2020 2020 6361 7365 2050            case P
-00028e80: 4154 4849 4e46 4f5f 4449 524e 414d 453a  ATHINFO_DIRNAME:
-00028e90: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
-00028ea0: 6520 2764 6972 6e61 6d65 273a 0a20 2020  e 'dirname':.   
-00028eb0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00028ec0: 7572 6e20 2472 6574 5b27 6469 726e 616d  urn $ret['dirnam
-00028ed0: 6527 5d3b 0a20 2020 2020 2020 2020 2020  e'];.           
-00028ee0: 2063 6173 6520 5041 5448 494e 464f 5f42   case PATHINFO_B
-00028ef0: 4153 454e 414d 453a 0a20 2020 2020 2020  ASENAME:.       
-00028f00: 2020 2020 2063 6173 6520 2762 6173 656e       case 'basen
-00028f10: 616d 6527 3a0a 2020 2020 2020 2020 2020  ame':.          
-00028f20: 2020 2020 2020 7265 7475 726e 2024 7265        return $re
-00028f30: 745b 2762 6173 656e 616d 6527 5d3b 0a20  t['basename'];. 
-00028f40: 2020 2020 2020 2020 2020 2063 6173 6520             case 
-00028f50: 5041 5448 494e 464f 5f45 5854 454e 5349  PATHINFO_EXTENSI
-00028f60: 4f4e 3a0a 2020 2020 2020 2020 2020 2020  ON:.            
-00028f70: 6361 7365 2027 6578 7465 6e73 696f 6e27  case 'extension'
-00028f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028f90: 2020 7265 7475 726e 2024 7265 745b 2765    return $ret['e
-00028fa0: 7874 656e 7369 6f6e 275d 3b0a 2020 2020  xtension'];.    
-00028fb0: 2020 2020 2020 2020 6361 7365 2050 4154          case PAT
-00028fc0: 4849 4e46 4f5f 4649 4c45 4e41 4d45 3a0a  HINFO_FILENAME:.
-00028fd0: 2020 2020 2020 2020 2020 2020 6361 7365              case
-00028fe0: 2027 6669 6c65 6e61 6d65 273a 0a20 2020   'filename':.   
-00028ff0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00029000: 7572 6e20 2472 6574 5b27 6669 6c65 6e61  urn $ret['filena
-00029010: 6d65 275d 3b0a 2020 2020 2020 2020 2020  me'];.          
-00029020: 2020 6465 6661 756c 743a 0a20 2020 2020    default:.     
-00029030: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00029040: 6e20 2472 6574 3b0a 2020 2020 2020 2020  n $ret;.        
-00029050: 7d0a 2020 2020 7d0a 0a20 2020 202f 2a2a  }.    }..    /**
-00029060: 0a20 2020 2020 2a20 5365 7420 6f72 2072  .     * Set or r
-00029070: 6573 6574 2069 6e73 7461 6e63 6520 7072  eset instance pr
-00029080: 6f70 6572 7469 6573 2e0a 2020 2020 202a  operties..     *
-00029090: 2059 6f75 2073 686f 756c 6420 6176 6f69   You should avoi
-000290a0: 6420 7468 6973 2066 756e 6374 696f 6e20  d this function 
-000290b0: 2d20 6974 2773 206d 6f72 6520 7665 7262  - it's more verb
-000290c0: 6f73 652c 206c 6573 7320 6566 6669 6369  ose, less effici
-000290d0: 656e 742c 206d 6f72 6520 6572 726f 722d  ent, more error-
-000290e0: 7072 6f6e 6520 616e 640a 2020 2020 202a  prone and.     *
-000290f0: 2068 6172 6465 7220 746f 2064 6562 7567   harder to debug
-00029100: 2074 6861 6e20 7365 7474 696e 6720 7072   than setting pr
-00029110: 6f70 6572 7469 6573 2064 6972 6563 746c  operties directl
-00029120: 792e 0a20 2020 2020 2a20 5573 6167 6520  y..     * Usage 
-00029130: 4578 616d 706c 653a 0a20 2020 2020 2a20  Example:.     * 
-00029140: 6024 6d61 696c 2d3e 7365 7428 2753 4d54  `$mail->set('SMT
-00029150: 5053 6563 7572 6527 2c20 7374 6174 6963  PSecure', static
-00029160: 3a3a 454e 4352 5950 5449 4f4e 5f53 5441  ::ENCRYPTION_STA
-00029170: 5254 544c 5329 3b60 0a20 2020 2020 2a20  RTTLS);`.     * 
-00029180: 2020 6973 2074 6865 2073 616d 6520 6173    is the same as
-00029190: 3a0a 2020 2020 202a 2060 246d 6169 6c2d  :.     * `$mail-
-000291a0: 3e53 4d54 5053 6563 7572 6520 3d20 7374  >SMTPSecure = st
-000291b0: 6174 6963 3a3a 454e 4352 5950 5449 4f4e  atic::ENCRYPTION
-000291c0: 5f53 5441 5254 544c 533b 602e 0a20 2020  _STARTTLS;`..   
-000291d0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-000291e0: 6d20 7374 7269 6e67 2024 6e61 6d65 2020  m string $name  
-000291f0: 5468 6520 7072 6f70 6572 7479 206e 616d  The property nam
-00029200: 6520 746f 2073 6574 0a20 2020 2020 2a20  e to set.     * 
-00029210: 4070 6172 616d 206d 6978 6564 2020 2476  @param mixed  $v
-00029220: 616c 7565 2054 6865 2076 616c 7565 2074  alue The value t
-00029230: 6f20 7365 7420 7468 6520 7072 6f70 6572  o set the proper
-00029240: 7479 2074 6f0a 2020 2020 202a 0a20 2020  ty to.     *.   
-00029250: 2020 2a20 4072 6574 7572 6e20 626f 6f6c    * @return bool
-00029260: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00029270: 6c69 6320 6675 6e63 7469 6f6e 2073 6574  lic function set
-00029280: 2824 6e61 6d65 2c20 2476 616c 7565 203d  ($name, $value =
-00029290: 2027 2729 0a20 2020 207b 0a20 2020 2020   '').    {.     
-000292a0: 2020 2069 6620 2870 726f 7065 7274 795f     if (property_
-000292b0: 6578 6973 7473 2824 7468 6973 2c20 246e  exists($this, $n
-000292c0: 616d 6529 2920 7b0a 2020 2020 2020 2020  ame)) {.        
-000292d0: 2020 2020 2474 6869 732d 3e7b 246e 616d      $this->{$nam
-000292e0: 657d 203d 2024 7661 6c75 653b 0a0a 2020  e} = $value;..  
-000292f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00029300: 2074 7275 653b 0a20 2020 2020 2020 207d   true;.        }
-00029310: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
-00029320: 7365 7445 7272 6f72 2824 7468 6973 2d3e  setError($this->
-00029330: 6c61 6e67 2827 7661 7269 6162 6c65 5f73  lang('variable_s
-00029340: 6574 2729 202e 2024 6e61 6d65 293b 0a0a  et') . $name);..
-00029350: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00029360: 616c 7365 3b0a 2020 2020 7d0a 0a20 2020  alse;.    }..   
-00029370: 202f 2a2a 0a20 2020 2020 2a20 5374 7269   /**.     * Stri
-00029380: 7020 6e65 776c 696e 6573 2074 6f20 7072  p newlines to pr
-00029390: 6576 656e 7420 6865 6164 6572 2069 6e6a  event header inj
-000293a0: 6563 7469 6f6e 2e0a 2020 2020 202a 0a20  ection..     *. 
-000293b0: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-000293c0: 696e 6720 2473 7472 0a20 2020 2020 2a0a  ing $str.     *.
-000293d0: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
-000293e0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-000293f0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
-00029400: 6e20 7365 6375 7265 4865 6164 6572 2824  n secureHeader($
-00029410: 7374 7229 0a20 2020 207b 0a20 2020 2020  str).    {.     
-00029420: 2020 2072 6574 7572 6e20 7472 696d 2873     return trim(s
-00029430: 7472 5f72 6570 6c61 6365 285b 225c 7222  tr_replace(["\r"
-00029440: 2c20 225c 6e22 5d2c 2027 272c 2024 7374  , "\n"], '', $st
-00029450: 7229 293b 0a20 2020 207d 0a0a 2020 2020  r));.    }..    
-00029460: 2f2a 2a0a 2020 2020 202a 204e 6f72 6d61  /**.     * Norma
-00029470: 6c69 7a65 206c 696e 6520 6272 6561 6b73  lize line breaks
-00029480: 2069 6e20 6120 7374 7269 6e67 2e0a 2020   in a string..  
-00029490: 2020 202a 2043 6f6e 7665 7274 7320 554e     * Converts UN
-000294a0: 4958 204c 462c 204d 6163 2043 5220 616e  IX LF, Mac CR an
-000294b0: 6420 5769 6e64 6f77 7320 4352 4c46 206c  d Windows CRLF l
-000294c0: 696e 6520 6272 6561 6b73 2069 6e74 6f20  ine breaks into 
-000294d0: 6120 7369 6e67 6c65 206c 696e 6520 6272  a single line br
-000294e0: 6561 6b20 666f 726d 6174 2e0a 2020 2020  eak format..    
-000294f0: 202a 2044 6566 6175 6c74 7320 746f 2043   * Defaults to C
-00029500: 524c 4620 2866 6f72 206d 6573 7361 6765  RLF (for message
-00029510: 2062 6f64 6965 7329 2061 6e64 2070 7265   bodies) and pre
-00029520: 7365 7276 6573 2063 6f6e 7365 6375 7469  serves consecuti
-00029530: 7665 2062 7265 616b 732e 0a20 2020 2020  ve breaks..     
-00029540: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-00029550: 7374 7269 6e67 2024 7465 7874 0a20 2020  string $text.   
-00029560: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-00029570: 6720 2462 7265 616b 7479 7065 2057 6861  g $breaktype Wha
-00029580: 7420 6b69 6e64 206f 6620 6c69 6e65 2062  t kind of line b
-00029590: 7265 616b 2074 6f20 7573 653b 2064 6566  reak to use; def
-000295a0: 6175 6c74 7320 746f 2073 7461 7469 633a  aults to static:
-000295b0: 3a24 4c45 0a20 2020 2020 2a0a 2020 2020  :$LE.     *.    
-000295c0: 202a 2040 7265 7475 726e 2073 7472 696e   * @return strin
-000295d0: 670a 2020 2020 202a 2f0a 2020 2020 7075  g.     */.    pu
-000295e0: 626c 6963 2073 7461 7469 6320 6675 6e63  blic static func
-000295f0: 7469 6f6e 206e 6f72 6d61 6c69 7a65 4272  tion normalizeBr
-00029600: 6561 6b73 2824 7465 7874 2c20 2462 7265  eaks($text, $bre
-00029610: 616b 7479 7065 203d 206e 756c 6c29 0a20  aktype = null). 
-00029620: 2020 207b 0a20 2020 2020 2020 2069 6620     {.        if 
-00029630: 286e 756c 6c20 3d3d 3d20 2462 7265 616b  (null === $break
-00029640: 7479 7065 2920 7b0a 2020 2020 2020 2020  type) {.        
-00029650: 2020 2020 2462 7265 616b 7479 7065 203d      $breaktype =
-00029660: 2073 7461 7469 633a 3a24 4c45 3b0a 2020   static::$LE;.  
-00029670: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00029680: 2f2f 4e6f 726d 616c 6973 6520 746f 205c  //Normalise to \
-00029690: 6e0a 2020 2020 2020 2020 2474 6578 7420  n.        $text 
-000296a0: 3d20 7374 725f 7265 706c 6163 6528 5b73  = str_replace([s
-000296b0: 656c 663a 3a43 524c 462c 2022 5c72 225d  elf::CRLF, "\r"]
-000296c0: 2c20 225c 6e22 2c20 2474 6578 7429 3b0a  , "\n", $text);.
-000296d0: 2020 2020 2020 2020 2f2f 4e6f 7720 636f          //Now co
-000296e0: 6e76 6572 7420 4c45 2061 7320 6e65 6564  nvert LE as need
-000296f0: 6564 0a20 2020 2020 2020 2069 6620 2822  ed.        if ("
-00029700: 5c6e 2220 213d 3d20 2462 7265 616b 7479  \n" !== $breakty
-00029710: 7065 2920 7b0a 2020 2020 2020 2020 2020  pe) {.          
-00029720: 2020 2474 6578 7420 3d20 7374 725f 7265    $text = str_re
-00029730: 706c 6163 6528 225c 6e22 2c20 2462 7265  place("\n", $bre
-00029740: 616b 7479 7065 2c20 2474 6578 7429 3b0a  aktype, $text);.
-00029750: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00029760: 2020 2072 6574 7572 6e20 2474 6578 743b     return $text;
-00029770: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00029780: 2020 2020 202a 2052 656d 6f76 6520 7472       * Remove tr
-00029790: 6169 6c69 6e67 2062 7265 616b 7320 6672  ailing breaks fr
-000297a0: 6f6d 2061 2073 7472 696e 672e 0a20 2020  om a string..   
-000297b0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-000297c0: 6d20 7374 7269 6e67 2024 7465 7874 0a20  m string $text. 
-000297d0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-000297e0: 7475 726e 2073 7472 696e 6720 5468 6520  turn string The 
-000297f0: 7465 7874 2074 6f20 7265 6d6f 7665 2062  text to remove b
-00029800: 7265 616b 7320 6672 6f6d 0a20 2020 2020  reaks from.     
-00029810: 2a2f 0a20 2020 2070 7562 6c69 6320 7374  */.    public st
-00029820: 6174 6963 2066 756e 6374 696f 6e20 7374  atic function st
-00029830: 7269 7054 7261 696c 696e 6757 5350 2824  ripTrailingWSP($
-00029840: 7465 7874 290a 2020 2020 7b0a 2020 2020  text).    {.    
-00029850: 2020 2020 7265 7475 726e 2072 7472 696d      return rtrim
-00029860: 2824 7465 7874 2c20 2220 5c72 5c6e 5c74  ($text, " \r\n\t
-00029870: 2229 3b0a 2020 2020 7d0a 0a20 2020 202f  ");.    }..    /
-00029880: 2a2a 0a20 2020 2020 2a20 5265 7475 726e  **.     * Return
-00029890: 2074 6865 2063 7572 7265 6e74 206c 696e   the current lin
-000298a0: 6520 6272 6561 6b20 666f 726d 6174 2073  e break format s
-000298b0: 7472 696e 672e 0a20 2020 2020 2a0a 2020  tring..     *.  
-000298c0: 2020 202a 2040 7265 7475 726e 2073 7472     * @return str
-000298d0: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
-000298e0: 7075 626c 6963 2073 7461 7469 6320 6675  public static fu
-000298f0: 6e63 7469 6f6e 2067 6574 4c45 2829 0a20  nction getLE(). 
-00029900: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
-00029910: 7572 6e20 7374 6174 6963 3a3a 244c 453b  urn static::$LE;
-00029920: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00029930: 2020 2020 202a 2053 6574 2074 6865 206c       * Set the l
-00029940: 696e 6520 6272 6561 6b20 666f 726d 6174  ine break format
-00029950: 2073 7472 696e 672c 2065 2e67 2e20 225c   string, e.g. "\
-00029960: 725c 6e22 2e0a 2020 2020 202a 0a20 2020  r\n"..     *.   
-00029970: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-00029980: 6720 246c 650a 2020 2020 202a 2f0a 2020  g $le.     */.  
-00029990: 2020 7072 6f74 6563 7465 6420 7374 6174    protected stat
-000299a0: 6963 2066 756e 6374 696f 6e20 7365 744c  ic function setL
-000299b0: 4528 246c 6529 0a20 2020 207b 0a20 2020  E($le).    {.   
-000299c0: 2020 2020 2073 7461 7469 633a 3a24 4c45       static::$LE
-000299d0: 203d 2024 6c65 3b0a 2020 2020 7d0a 0a20   = $le;.    }.. 
-000299e0: 2020 202f 2a2a 0a20 2020 2020 2a20 5365     /**.     * Se
-000299f0: 7420 7468 6520 7075 626c 6963 2061 6e64  t the public and
-00029a00: 2070 7269 7661 7465 206b 6579 2066 696c   private key fil
-00029a10: 6573 2061 6e64 2070 6173 7377 6f72 6420  es and password 
-00029a20: 666f 7220 532f 4d49 4d45 2073 6967 6e69  for S/MIME signi
-00029a30: 6e67 2e0a 2020 2020 202a 0a20 2020 2020  ng..     *.     
-00029a40: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
-00029a50: 2463 6572 745f 6669 6c65 6e61 6d65 0a20  $cert_filename. 
-00029a60: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-00029a70: 696e 6720 246b 6579 5f66 696c 656e 616d  ing $key_filenam
-00029a80: 650a 2020 2020 202a 2040 7061 7261 6d20  e.     * @param 
-00029a90: 7374 7269 6e67 2024 6b65 795f 7061 7373  string $key_pass
-00029aa0: 2020 2020 2020 2020 2020 2020 5061 7373              Pass
-00029ab0: 776f 7264 2066 6f72 2070 7269 7661 7465  word for private
-00029ac0: 206b 6579 0a20 2020 2020 2a20 4070 6172   key.     * @par
-00029ad0: 616d 2073 7472 696e 6720 2465 7874 7261  am string $extra
-00029ae0: 6365 7274 735f 6669 6c65 6e61 6d65 204f  certs_filename O
-00029af0: 7074 696f 6e61 6c20 7061 7468 2074 6f20  ptional path to 
-00029b00: 6368 6169 6e20 6365 7274 6966 6963 6174  chain certificat
-00029b10: 650a 2020 2020 202a 2f0a 2020 2020 7075  e.     */.    pu
-00029b20: 626c 6963 2066 756e 6374 696f 6e20 7369  blic function si
-00029b30: 676e 2824 6365 7274 5f66 696c 656e 616d  gn($cert_filenam
-00029b40: 652c 2024 6b65 795f 6669 6c65 6e61 6d65  e, $key_filename
-00029b50: 2c20 246b 6579 5f70 6173 732c 2024 6578  , $key_pass, $ex
-00029b60: 7472 6163 6572 7473 5f66 696c 656e 616d  tracerts_filenam
-00029b70: 6520 3d20 2727 290a 2020 2020 7b0a 2020  e = '').    {.  
-00029b80: 2020 2020 2020 2474 6869 732d 3e73 6967        $this->sig
-00029b90: 6e5f 6365 7274 5f66 696c 6520 3d20 2463  n_cert_file = $c
-00029ba0: 6572 745f 6669 6c65 6e61 6d65 3b0a 2020  ert_filename;.  
-00029bb0: 2020 2020 2020 2474 6869 732d 3e73 6967        $this->sig
-00029bc0: 6e5f 6b65 795f 6669 6c65 203d 2024 6b65  n_key_file = $ke
-00029bd0: 795f 6669 6c65 6e61 6d65 3b0a 2020 2020  y_filename;.    
-00029be0: 2020 2020 2474 6869 732d 3e73 6967 6e5f      $this->sign_
-00029bf0: 6b65 795f 7061 7373 203d 2024 6b65 795f  key_pass = $key_
-00029c00: 7061 7373 3b0a 2020 2020 2020 2020 2474  pass;.        $t
-00029c10: 6869 732d 3e73 6967 6e5f 6578 7472 6163  his->sign_extrac
-00029c20: 6572 7473 5f66 696c 6520 3d20 2465 7874  erts_file = $ext
-00029c30: 7261 6365 7274 735f 6669 6c65 6e61 6d65  racerts_filename
-00029c40: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-00029c50: 0a20 2020 2020 2a20 5175 6f74 6564 2d50  .     * Quoted-P
-00029c60: 7269 6e74 6162 6c65 2d65 6e63 6f64 6520  rintable-encode 
-00029c70: 6120 444b 494d 2068 6561 6465 722e 0a20  a DKIM header.. 
-00029c80: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-00029c90: 7261 6d20 7374 7269 6e67 2024 7478 740a  ram string $txt.
-00029ca0: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00029cb0: 6574 7572 6e20 7374 7269 6e67 0a20 2020  eturn string.   
-00029cc0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-00029cd0: 6675 6e63 7469 6f6e 2044 4b49 4d5f 5150  function DKIM_QP
-00029ce0: 2824 7478 7429 0a20 2020 207b 0a20 2020  ($txt).    {.   
-00029cf0: 2020 2020 2024 6c69 6e65 203d 2027 273b       $line = '';
-00029d00: 0a20 2020 2020 2020 2024 6c65 6e20 3d20  .        $len = 
-00029d10: 7374 726c 656e 2824 7478 7429 3b0a 2020  strlen($txt);.  
-00029d20: 2020 2020 2020 666f 7220 2824 6920 3d20        for ($i = 
-00029d30: 303b 2024 6920 3c20 246c 656e 3b20 2b2b  0; $i < $len; ++
-00029d40: 2469 2920 7b0a 2020 2020 2020 2020 2020  $i) {.          
-00029d50: 2020 246f 7264 203d 206f 7264 2824 7478    $ord = ord($tx
-00029d60: 745b 2469 5d29 3b0a 2020 2020 2020 2020  t[$i]);.        
-00029d70: 2020 2020 6966 2028 2828 3078 3231 203c      if (((0x21 <
-00029d80: 3d20 246f 7264 2920 2626 2028 246f 7264  = $ord) && ($ord
-00029d90: 203c 3d20 3078 3341 2929 207c 7c20 246f   <= 0x3A)) || $o
-00029da0: 7264 203d 3d3d 2030 7833 4320 7c7c 2028  rd === 0x3C || (
-00029db0: 2830 7833 4520 3c3d 2024 6f72 6429 2026  (0x3E <= $ord) &
-00029dc0: 2620 2824 6f72 6420 3c3d 2030 7837 4529  & ($ord <= 0x7E)
-00029dd0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00029de0: 2020 2020 2024 6c69 6e65 202e 3d20 2474       $line .= $t
-00029df0: 7874 5b24 695d 3b0a 2020 2020 2020 2020  xt[$i];.        
-00029e00: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
-00029e10: 2020 2020 2020 2020 2020 2020 2024 6c69               $li
-00029e20: 6e65 202e 3d20 273d 2720 2e20 7370 7269  ne .= '=' . spri
-00029e30: 6e74 6628 2725 3032 5827 2c20 246f 7264  ntf('%02X', $ord
-00029e40: 293b 0a20 2020 2020 2020 2020 2020 207d  );.            }
-00029e50: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00029e60: 2020 2020 7265 7475 726e 2024 6c69 6e65      return $line
-00029e70: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-00029e80: 0a20 2020 2020 2a20 4765 6e65 7261 7465  .     * Generate
-00029e90: 2061 2044 4b49 4d20 7369 676e 6174 7572   a DKIM signatur
-00029ea0: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-00029eb0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-00029ec0: 7369 676e 4865 6164 6572 0a20 2020 2020  signHeader.     
-00029ed0: 2a0a 2020 2020 202a 2040 7468 726f 7773  *.     * @throws
-00029ee0: 2045 7863 6570 7469 6f6e 0a20 2020 2020   Exception.     
-00029ef0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-00029f00: 2073 7472 696e 6720 5468 6520 444b 494d   string The DKIM
-00029f10: 2073 6967 6e61 7475 7265 2076 616c 7565   signature value
-00029f20: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00029f30: 6c69 6320 6675 6e63 7469 6f6e 2044 4b49  lic function DKI
-00029f40: 4d5f 5369 676e 2824 7369 676e 4865 6164  M_Sign($signHead
-00029f50: 6572 290a 2020 2020 7b0a 2020 2020 2020  er).    {.      
-00029f60: 2020 6966 2028 2164 6566 696e 6564 2827    if (!defined('
-00029f70: 504b 4353 375f 5445 5854 2729 2920 7b0a  PKCS7_TEXT')) {.
-00029f80: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00029f90: 2474 6869 732d 3e65 7863 6570 7469 6f6e  $this->exception
-00029fa0: 7329 207b 0a20 2020 2020 2020 2020 2020  s) {.           
-00029fb0: 2020 2020 2074 6872 6f77 206e 6577 2045       throw new E
-00029fc0: 7863 6570 7469 6f6e 2824 7468 6973 2d3e  xception($this->
-00029fd0: 6c61 6e67 2827 6578 7465 6e73 696f 6e5f  lang('extension_
-00029fe0: 6d69 7373 696e 6727 2920 2e20 276f 7065  missing') . 'ope
-00029ff0: 6e73 736c 2729 3b0a 2020 2020 2020 2020  nssl');.        
-0002a000: 2020 2020 7d0a 0a20 2020 2020 2020 2020      }..         
-0002a010: 2020 2072 6574 7572 6e20 2727 3b0a 2020     return '';.  
-0002a020: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0002a030: 2470 7269 764b 6579 5374 7220 3d20 2165  $privKeyStr = !e
-0002a040: 6d70 7479 2824 7468 6973 2d3e 444b 494d  mpty($this->DKIM
-0002a050: 5f70 7269 7661 7465 5f73 7472 696e 6729  _private_string)
-0002a060: 203f 0a20 2020 2020 2020 2020 2020 2024   ?.            $
-0002a070: 7468 6973 2d3e 444b 494d 5f70 7269 7661  this->DKIM_priva
-0002a080: 7465 5f73 7472 696e 6720 3a0a 2020 2020  te_string :.    
-0002a090: 2020 2020 2020 2020 6669 6c65 5f67 6574          file_get
-0002a0a0: 5f63 6f6e 7465 6e74 7328 2474 6869 732d  _contents($this-
-0002a0b0: 3e44 4b49 4d5f 7072 6976 6174 6529 3b0a  >DKIM_private);.
-0002a0c0: 2020 2020 2020 2020 6966 2028 2727 2021          if ('' !
-0002a0d0: 3d3d 2024 7468 6973 2d3e 444b 494d 5f70  == $this->DKIM_p
-0002a0e0: 6173 7370 6872 6173 6529 207b 0a20 2020  assphrase) {.   
-0002a0f0: 2020 2020 2020 2020 2024 7072 6976 4b65           $privKe
-0002a100: 7920 3d20 6f70 656e 7373 6c5f 706b 6579  y = openssl_pkey
-0002a110: 5f67 6574 5f70 7269 7661 7465 2824 7072  _get_private($pr
-0002a120: 6976 4b65 7953 7472 2c20 2474 6869 732d  ivKeyStr, $this-
-0002a130: 3e44 4b49 4d5f 7061 7373 7068 7261 7365  >DKIM_passphrase
-0002a140: 293b 0a20 2020 2020 2020 207d 2065 6c73  );.        } els
-0002a150: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
-0002a160: 2470 7269 764b 6579 203d 206f 7065 6e73  $privKey = opens
-0002a170: 736c 5f70 6b65 795f 6765 745f 7072 6976  sl_pkey_get_priv
-0002a180: 6174 6528 2470 7269 764b 6579 5374 7229  ate($privKeyStr)
-0002a190: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
-0002a1a0: 2020 2020 6966 2028 6f70 656e 7373 6c5f      if (openssl_
-0002a1b0: 7369 676e 2824 7369 676e 4865 6164 6572  sign($signHeader
-0002a1c0: 2c20 2473 6967 6e61 7475 7265 2c20 2470  , $signature, $p
-0002a1d0: 7269 764b 6579 2c20 2773 6861 3235 3657  rivKey, 'sha256W
-0002a1e0: 6974 6852 5341 456e 6372 7970 7469 6f6e  ithRSAEncryption
-0002a1f0: 2729 2920 7b0a 2020 2020 2020 2020 2020  ')) {.          
-0002a200: 2020 6966 2028 5c50 4850 5f4d 414a 4f52    if (\PHP_MAJOR
-0002a210: 5f56 4552 5349 4f4e 203c 2038 2920 7b0a  _VERSION < 8) {.
-0002a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a230: 6f70 656e 7373 6c5f 706b 6579 5f66 7265  openssl_pkey_fre
-0002a240: 6528 2470 7269 764b 6579 293b 0a20 2020  e($privKey);.   
-0002a250: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-0002a260: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-0002a270: 6173 6536 345f 656e 636f 6465 2824 7369  ase64_encode($si
-0002a280: 676e 6174 7572 6529 3b0a 2020 2020 2020  gnature);.      
-0002a290: 2020 7d0a 2020 2020 2020 2020 6966 2028    }.        if (
-0002a2a0: 5c50 4850 5f4d 414a 4f52 5f56 4552 5349  \PHP_MAJOR_VERSI
-0002a2b0: 4f4e 203c 2038 2920 7b0a 2020 2020 2020  ON < 8) {.      
-0002a2c0: 2020 2020 2020 6f70 656e 7373 6c5f 706b        openssl_pk
-0002a2d0: 6579 5f66 7265 6528 2470 7269 764b 6579  ey_free($privKey
-0002a2e0: 293b 0a20 2020 2020 2020 207d 0a0a 2020  );.        }..  
-0002a2f0: 2020 2020 2020 7265 7475 726e 2027 273b        return '';
-0002a300: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-0002a310: 2020 2020 202a 2047 656e 6572 6174 6520       * Generate 
-0002a320: 6120 444b 494d 2063 616e 6f6e 6963 616c  a DKIM canonical
-0002a330: 697a 6174 696f 6e20 6865 6164 6572 2e0a  ization header..
-0002a340: 2020 2020 202a 2055 7365 7320 7468 6520       * Uses the 
-0002a350: 2772 656c 6178 6564 2720 616c 676f 7269  'relaxed' algori
-0002a360: 7468 6d20 6672 6f6d 2052 4643 3633 3736  thm from RFC6376
-0002a370: 2073 6563 7469 6f6e 2033 2e34 2e32 2e0a   section 3.4.2..
-0002a380: 2020 2020 202a 2043 616e 6f6e 6963 616c       * Canonical
-0002a390: 697a 6564 2068 6561 6465 7273 2073 686f  ized headers sho
-0002a3a0: 756c 6420 2a61 6c77 6179 732a 2075 7365  uld *always* use
-0002a3b0: 2043 524c 462c 2072 6567 6172 646c 6573   CRLF, regardles
-0002a3c0: 7320 6f66 206d 6169 6c65 7220 7365 7474  s of mailer sett
-0002a3d0: 696e 672e 0a20 2020 2020 2a0a 2020 2020  ing..     *.    
-0002a3e0: 202a 2040 7365 6520 6874 7470 733a 2f2f   * @see https://
-0002a3f0: 746f 6f6c 732e 6965 7466 2e6f 7267 2f68  tools.ietf.org/h
-0002a400: 746d 6c2f 7266 6336 3337 3623 7365 6374  tml/rfc6376#sect
-0002a410: 696f 6e2d 332e 342e 320a 2020 2020 202a  ion-3.4.2.     *
-0002a420: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-0002a430: 7472 696e 6720 2473 6967 6e48 6561 6465  tring $signHeade
-0002a440: 7220 4865 6164 6572 0a20 2020 2020 2a0a  r Header.     *.
-0002a450: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
-0002a460: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-0002a470: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
-0002a480: 6e20 444b 494d 5f48 6561 6465 7243 2824  n DKIM_HeaderC($
-0002a490: 7369 676e 4865 6164 6572 290a 2020 2020  signHeader).    
-0002a4a0: 7b0a 2020 2020 2020 2020 2f2f 4e6f 726d  {.        //Norm
-0002a4b0: 616c 697a 6520 6272 6561 6b73 2074 6f20  alize breaks to 
-0002a4c0: 4352 4c46 2028 7265 6761 7264 6c65 7373  CRLF (regardless
-0002a4d0: 206f 6620 7468 6520 6d61 696c 6572 290a   of the mailer).
-0002a4e0: 2020 2020 2020 2020 2473 6967 6e48 6561          $signHea
-0002a4f0: 6465 7220 3d20 7374 6174 6963 3a3a 6e6f  der = static::no
-0002a500: 726d 616c 697a 6542 7265 616b 7328 2473  rmalizeBreaks($s
-0002a510: 6967 6e48 6561 6465 722c 2073 656c 663a  ignHeader, self:
-0002a520: 3a43 524c 4629 3b0a 2020 2020 2020 2020  :CRLF);.        
-0002a530: 2f2f 556e 666f 6c64 2068 6561 6465 7220  //Unfold header 
-0002a540: 6c69 6e65 730a 2020 2020 2020 2020 2f2f  lines.        //
-0002a550: 4e6f 7465 2050 4352 4520 5c73 2069 7320  Note PCRE \s is 
-0002a560: 746f 6f20 6272 6f61 6420 6120 6465 6669  too broad a defi
-0002a570: 6e69 7469 6f6e 206f 6620 7768 6974 6573  nition of whites
-0002a580: 7061 6365 3b20 5246 4335 3332 3220 6465  pace; RFC5322 de
-0002a590: 6669 6e65 7320 6974 2061 7320 605b 205c  fines it as `[ \
-0002a5a0: 745d 600a 2020 2020 2020 2020 2f2f 4073  t]`.        //@s
-0002a5b0: 6565 2068 7474 7073 3a2f 2f74 6f6f 6c73  ee https://tools
-0002a5c0: 2e69 6574 662e 6f72 672f 6874 6d6c 2f72  .ietf.org/html/r
-0002a5d0: 6663 3533 3232 2373 6563 7469 6f6e 2d32  fc5322#section-2
-0002a5e0: 2e32 0a20 2020 2020 2020 202f 2f54 6861  .2.        //Tha
-0002a5f0: 7420 6d65 616e 7320 7468 6973 206d 6179  t means this may
-0002a600: 2062 7265 616b 2069 6620 796f 7520 646f   break if you do
-0002a610: 2073 6f6d 6574 6869 6e67 2064 6166 7420   something daft 
-0002a620: 6c69 6b65 2070 7574 2076 6572 7469 6361  like put vertica
-0002a630: 6c20 7461 6273 2069 6e20 796f 7572 2068  l tabs in your h
-0002a640: 6561 6465 7273 2e0a 2020 2020 2020 2020  eaders..        
-0002a650: 2473 6967 6e48 6561 6465 7220 3d20 7072  $signHeader = pr
-0002a660: 6567 5f72 6570 6c61 6365 2827 2f5c 725c  eg_replace('/\r\
-0002a670: 6e5b 205c 745d 2b2f 272c 2027 2027 2c20  n[ \t]+/', ' ', 
-0002a680: 2473 6967 6e48 6561 6465 7229 3b0a 2020  $signHeader);.  
-0002a690: 2020 2020 2020 2f2f 4272 6561 6b20 6865        //Break he
-0002a6a0: 6164 6572 7320 6f75 7420 696e 746f 2061  aders out into a
-0002a6b0: 6e20 6172 7261 790a 2020 2020 2020 2020  n array.        
-0002a6c0: 246c 696e 6573 203d 2065 7870 6c6f 6465  $lines = explode
-0002a6d0: 2873 656c 663a 3a43 524c 462c 2024 7369  (self::CRLF, $si
-0002a6e0: 676e 4865 6164 6572 293b 0a20 2020 2020  gnHeader);.     
-0002a6f0: 2020 2066 6f72 6561 6368 2028 246c 696e     foreach ($lin
-0002a700: 6573 2061 7320 246b 6579 203d 3e20 246c  es as $key => $l
-0002a710: 696e 6529 207b 0a20 2020 2020 2020 2020  ine) {.         
-0002a720: 2020 202f 2f49 6620 7468 6520 6865 6164     //If the head
-0002a730: 6572 2069 7320 6d69 7373 696e 6720 6120  er is missing a 
-0002a740: 3a2c 2073 6b69 7020 6974 2061 7320 6974  :, skip it as it
-0002a750: 2773 2069 6e76 616c 6964 0a20 2020 2020  's invalid.     
-0002a760: 2020 2020 2020 202f 2f54 6869 7320 6973         //This is
-0002a770: 206c 696b 656c 7920 746f 2068 6170 7065   likely to happe
-0002a780: 6e20 6265 6361 7573 6520 7468 6520 6578  n because the ex
-0002a790: 706c 6f64 6528 2920 6162 6f76 6520 7769  plode() above wi
-0002a7a0: 6c6c 2061 6c73 6f20 7370 6c69 740a 2020  ll also split.  
-0002a7b0: 2020 2020 2020 2020 2020 2f2f 6f6e 2074            //on t
-0002a7c0: 6865 2074 7261 696c 696e 6720 4c45 2c20  he trailing LE, 
-0002a7d0: 6c65 6176 696e 6720 616e 2065 6d70 7479  leaving an empty
-0002a7e0: 206c 696e 650a 2020 2020 2020 2020 2020   line.          
-0002a7f0: 2020 6966 2028 7374 7270 6f73 2824 6c69    if (strpos($li
-0002a800: 6e65 2c20 273a 2729 203d 3d3d 2066 616c  ne, ':') === fal
-0002a810: 7365 2920 7b0a 2020 2020 2020 2020 2020  se) {.          
-0002a820: 2020 2020 2020 636f 6e74 696e 7565 3b0a        continue;.
-0002a830: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0002a840: 2020 2020 2020 2020 2020 6c69 7374 2824            list($
-0002a850: 6865 6164 696e 672c 2024 7661 6c75 6529  heading, $value)
-0002a860: 203d 2065 7870 6c6f 6465 2827 3a27 2c20   = explode(':', 
-0002a870: 246c 696e 652c 2032 293b 0a20 2020 2020  $line, 2);.     
-0002a880: 2020 2020 2020 202f 2f4c 6f77 6572 2d63         //Lower-c
-0002a890: 6173 6520 6865 6164 6572 206e 616d 650a  ase header name.
-0002a8a0: 2020 2020 2020 2020 2020 2020 2468 6561              $hea
-0002a8b0: 6469 6e67 203d 2073 7472 746f 6c6f 7765  ding = strtolowe
-0002a8c0: 7228 2468 6561 6469 6e67 293b 0a20 2020  r($heading);.   
-0002a8d0: 2020 2020 2020 2020 202f 2f43 6f6c 6c61           //Colla
-0002a8e0: 7073 6520 7768 6974 6520 7370 6163 6520  pse white space 
-0002a8f0: 7769 7468 696e 2074 6865 2076 616c 7565  within the value
-0002a900: 2c20 616c 736f 2063 6f6e 7665 7274 2057  , also convert W
-0002a910: 5350 2074 6f20 7370 6163 650a 2020 2020  SP to space.    
-0002a920: 2020 2020 2020 2020 2476 616c 7565 203d          $value =
-0002a930: 2070 7265 675f 7265 706c 6163 6528 272f   preg_replace('/
-0002a940: 5b20 5c74 5d2b 2f27 2c20 2720 272c 2024  [ \t]+/', ' ', $
-0002a950: 7661 6c75 6529 3b0a 2020 2020 2020 2020  value);.        
-0002a960: 2020 2020 2f2f 5246 4336 3337 3620 6973      //RFC6376 is
-0002a970: 2073 6c69 6768 746c 7920 756e 636c 6561   slightly unclea
-0002a980: 7220 6865 7265 202d 2069 7420 7361 7973  r here - it says
-0002a990: 2074 6f20 6465 6c65 7465 2073 7061 6365   to delete space
-0002a9a0: 2061 7420 7468 6520 2a65 6e64 2a20 6f66   at the *end* of
-0002a9b0: 2065 6163 6820 7661 6c75 650a 2020 2020   each value.    
-0002a9c0: 2020 2020 2020 2020 2f2f 4275 7420 7468          //But th
-0002a9d0: 656e 2073 6179 7320 746f 2064 656c 6574  en says to delet
-0002a9e0: 6520 7370 6163 6520 6265 666f 7265 2061  e space before a
-0002a9f0: 6e64 2061 6674 6572 2074 6865 2063 6f6c  nd after the col
-0002aa00: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-0002aa10: 2f2f 4e65 7420 7265 7375 6c74 2069 7320  //Net result is 
-0002aa20: 7468 6520 7361 6d65 2061 7320 7472 696d  the same as trim
-0002aa30: 6d69 6e67 2062 6f74 6820 656e 6473 206f  ming both ends o
-0002aa40: 6620 7468 6520 7661 6c75 652e 0a20 2020  f the value..   
-0002aa50: 2020 2020 2020 2020 202f 2f42 7920 656c           //By el
-0002aa60: 696d 696e 6174 696f 6e2c 2074 6865 2073  imination, the s
-0002aa70: 616d 6520 6170 706c 6965 7320 746f 2074  ame applies to t
-0002aa80: 6865 2066 6965 6c64 206e 616d 650a 2020  he field name.  
-0002aa90: 2020 2020 2020 2020 2020 246c 696e 6573            $lines
-0002aaa0: 5b24 6b65 795d 203d 2074 7269 6d28 2468  [$key] = trim($h
-0002aab0: 6561 6469 6e67 2c20 2220 5c74 2229 202e  eading, " \t") .
-0002aac0: 2027 3a27 202e 2074 7269 6d28 2476 616c   ':' . trim($val
-0002aad0: 7565 2c20 2220 5c74 2229 3b0a 2020 2020  ue, " \t");.    
-0002aae0: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
-0002aaf0: 6574 7572 6e20 696d 706c 6f64 6528 7365  eturn implode(se
-0002ab00: 6c66 3a3a 4352 4c46 2c20 246c 696e 6573  lf::CRLF, $lines
-0002ab10: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
-0002ab20: 2a0a 2020 2020 202a 2047 656e 6572 6174  *.     * Generat
-0002ab30: 6520 6120 444b 494d 2063 616e 6f6e 6963  e a DKIM canonic
-0002ab40: 616c 697a 6174 696f 6e20 626f 6479 2e0a  alization body..
-0002ab50: 2020 2020 202a 2055 7365 7320 7468 6520       * Uses the 
-0002ab60: 2773 696d 706c 6527 2061 6c67 6f72 6974  'simple' algorit
-0002ab70: 686d 2066 726f 6d20 5246 4336 3337 3620  hm from RFC6376 
-0002ab80: 7365 6374 696f 6e20 332e 342e 332e 0a20  section 3.4.3.. 
-0002ab90: 2020 2020 2a20 4361 6e6f 6e69 6361 6c69      * Canonicali
-0002aba0: 7a65 6420 626f 6469 6573 2073 686f 756c  zed bodies shoul
-0002abb0: 6420 2a61 6c77 6179 732a 2075 7365 2043  d *always* use C
-0002abc0: 524c 462c 2072 6567 6172 646c 6573 7320  RLF, regardless 
-0002abd0: 6f66 206d 6169 6c65 7220 7365 7474 696e  of mailer settin
-0002abe0: 672e 0a20 2020 2020 2a0a 2020 2020 202a  g..     *.     *
-0002abf0: 2040 7365 6520 6874 7470 733a 2f2f 746f   @see https://to
-0002ac00: 6f6c 732e 6965 7466 2e6f 7267 2f68 746d  ols.ietf.org/htm
-0002ac10: 6c2f 7266 6336 3337 3623 7365 6374 696f  l/rfc6376#sectio
-0002ac20: 6e2d 332e 342e 330a 2020 2020 202a 0a20  n-3.4.3.     *. 
-0002ac30: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-0002ac40: 696e 6720 2462 6f64 7920 4d65 7373 6167  ing $body Messag
-0002ac50: 6520 426f 6479 0a20 2020 2020 2a0a 2020  e Body.     *.  
-0002ac60: 2020 202a 2040 7265 7475 726e 2073 7472     * @return str
-0002ac70: 696e 670a 2020 2020 202a 2f0a 2020 2020  ing.     */.    
-0002ac80: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
-0002ac90: 444b 494d 5f42 6f64 7943 2824 626f 6479  DKIM_BodyC($body
-0002aca0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-0002acb0: 6966 2028 656d 7074 7928 2462 6f64 7929  if (empty($body)
-0002acc0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0002acd0: 7265 7475 726e 2073 656c 663a 3a43 524c  return self::CRL
-0002ace0: 463b 0a20 2020 2020 2020 207d 0a20 2020  F;.        }.   
-0002acf0: 2020 2020 202f 2f4e 6f72 6d61 6c69 7a65       //Normalize
-0002ad00: 206c 696e 6520 656e 6469 6e67 7320 746f   line endings to
-0002ad10: 2043 524c 460a 2020 2020 2020 2020 2462   CRLF.        $b
-0002ad20: 6f64 7920 3d20 7374 6174 6963 3a3a 6e6f  ody = static::no
-0002ad30: 726d 616c 697a 6542 7265 616b 7328 2462  rmalizeBreaks($b
-0002ad40: 6f64 792c 2073 656c 663a 3a43 524c 4629  ody, self::CRLF)
-0002ad50: 3b0a 0a20 2020 2020 2020 202f 2f52 6564  ;..        //Red
-0002ad60: 7563 6520 6d75 6c74 6970 6c65 2074 7261  uce multiple tra
-0002ad70: 696c 696e 6720 6c69 6e65 2062 7265 616b  iling line break
-0002ad80: 7320 746f 2061 2073 696e 676c 6520 6f6e  s to a single on
-0002ad90: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-0002ada0: 2073 7461 7469 633a 3a73 7472 6970 5472   static::stripTr
-0002adb0: 6169 6c69 6e67 5753 5028 2462 6f64 7929  ailingWSP($body)
-0002adc0: 202e 2073 656c 663a 3a43 524c 463b 0a20   . self::CRLF;. 
-0002add0: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-0002ade0: 2020 202a 2043 7265 6174 6520 7468 6520     * Create the 
-0002adf0: 444b 494d 2068 6561 6465 7220 616e 6420  DKIM header and 
-0002ae00: 626f 6479 2069 6e20 6120 6e65 7720 6d65  body in a new me
-0002ae10: 7373 6167 6520 6865 6164 6572 2e0a 2020  ssage header..  
-0002ae20: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
-0002ae30: 616d 2073 7472 696e 6720 2468 6561 6465  am string $heade
-0002ae40: 7273 5f6c 696e 6520 4865 6164 6572 206c  rs_line Header l
-0002ae50: 696e 6573 0a20 2020 2020 2a20 4070 6172  ines.     * @par
-0002ae60: 616d 2073 7472 696e 6720 2473 7562 6a65  am string $subje
-0002ae70: 6374 2020 2020 2020 5375 626a 6563 740a  ct      Subject.
-0002ae80: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-0002ae90: 7269 6e67 2024 626f 6479 2020 2020 2020  ring $body      
-0002aea0: 2020 2042 6f64 790a 2020 2020 202a 0a20     Body.     *. 
-0002aeb0: 2020 2020 2a20 4074 6872 6f77 7320 4578      * @throws Ex
-0002aec0: 6365 7074 696f 6e0a 2020 2020 202a 0a20  ception.     *. 
-0002aed0: 2020 2020 2a20 4072 6574 7572 6e20 7374      * @return st
-0002aee0: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
-0002aef0: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-0002af00: 2044 4b49 4d5f 4164 6428 2468 6561 6465   DKIM_Add($heade
-0002af10: 7273 5f6c 696e 652c 2024 7375 626a 6563  rs_line, $subjec
-0002af20: 742c 2024 626f 6479 290a 2020 2020 7b0a  t, $body).    {.
-0002af30: 2020 2020 2020 2020 2444 4b49 4d73 6967          $DKIMsig
-0002af40: 6e61 7475 7265 5479 7065 203d 2027 7273  natureType = 'rs
-0002af50: 612d 7368 6132 3536 273b 202f 2f53 6967  a-sha256'; //Sig
-0002af60: 6e61 7475 7265 2026 2068 6173 6820 616c  nature & hash al
-0002af70: 676f 7269 7468 6d73 0a20 2020 2020 2020  gorithms.       
-0002af80: 2024 444b 494d 6361 6e6f 6e69 6361 6c69   $DKIMcanonicali
-0002af90: 7a61 7469 6f6e 203d 2027 7265 6c61 7865  zation = 'relaxe
-0002afa0: 642f 7369 6d70 6c65 273b 202f 2f43 616e  d/simple'; //Can
-0002afb0: 6f6e 6963 616c 697a 6174 696f 6e20 6d65  onicalization me
-0002afc0: 7468 6f64 7320 6f66 2068 6561 6465 7220  thods of header 
-0002afd0: 2620 626f 6479 0a20 2020 2020 2020 2024  & body.        $
-0002afe0: 444b 494d 7175 6572 7920 3d20 2764 6e73  DKIMquery = 'dns
-0002aff0: 2f74 7874 273b 202f 2f51 7565 7279 206d  /txt'; //Query m
-0002b000: 6574 686f 640a 2020 2020 2020 2020 2444  ethod.        $D
-0002b010: 4b49 4d74 696d 6520 3d20 7469 6d65 2829  KIMtime = time()
-0002b020: 3b0a 2020 2020 2020 2020 2f2f 416c 7761  ;.        //Alwa
-0002b030: 7973 2073 6967 6e20 7468 6573 6520 6865  ys sign these he
-0002b040: 6164 6572 7320 7769 7468 6f75 7420 6265  aders without be
-0002b050: 696e 6720 6173 6b65 640a 2020 2020 2020  ing asked.      
-0002b060: 2020 2f2f 5265 636f 6d6d 656e 6465 6420    //Recommended 
-0002b070: 6c69 7374 2066 726f 6d20 6874 7470 733a  list from https:
-0002b080: 2f2f 746f 6f6c 732e 6965 7466 2e6f 7267  //tools.ietf.org
-0002b090: 2f68 746d 6c2f 7266 6336 3337 3623 7365  /html/rfc6376#se
-0002b0a0: 6374 696f 6e2d 352e 342e 310a 2020 2020  ction-5.4.1.    
-0002b0b0: 2020 2020 2461 7574 6f53 6967 6e48 6561      $autoSignHea
-0002b0c0: 6465 7273 203d 205b 0a20 2020 2020 2020  ders = [.       
-0002b0d0: 2020 2020 2027 6672 6f6d 272c 0a20 2020       'from',.   
-0002b0e0: 2020 2020 2020 2020 2027 746f 272c 0a20           'to',. 
-0002b0f0: 2020 2020 2020 2020 2020 2027 6363 272c             'cc',
-0002b100: 0a20 2020 2020 2020 2020 2020 2027 6461  .            'da
-0002b110: 7465 272c 0a20 2020 2020 2020 2020 2020  te',.           
-0002b120: 2027 7375 626a 6563 7427 2c0a 2020 2020   'subject',.    
-0002b130: 2020 2020 2020 2020 2772 6570 6c79 2d74          'reply-t
-0002b140: 6f27 2c0a 2020 2020 2020 2020 2020 2020  o',.            
-0002b150: 276d 6573 7361 6765 2d69 6427 2c0a 2020  'message-id',.  
-0002b160: 2020 2020 2020 2020 2020 2763 6f6e 7465            'conte
-0002b170: 6e74 2d74 7970 6527 2c0a 2020 2020 2020  nt-type',.      
-0002b180: 2020 2020 2020 276d 696d 652d 7665 7273        'mime-vers
-0002b190: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
-0002b1a0: 2020 2778 2d6d 6169 6c65 7227 2c0a 2020    'x-mailer',.  
-0002b1b0: 2020 2020 2020 5d3b 0a20 2020 2020 2020        ];.       
-0002b1c0: 2069 6620 2873 7472 6970 6f73 2824 6865   if (stripos($he
-0002b1d0: 6164 6572 735f 6c69 6e65 2c20 2753 7562  aders_line, 'Sub
-0002b1e0: 6a65 6374 2729 203d 3d3d 2066 616c 7365  ject') === false
-0002b1f0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0002b200: 2468 6561 6465 7273 5f6c 696e 6520 2e3d  $headers_line .=
-0002b210: 2027 5375 626a 6563 743a 2027 202e 2024   'Subject: ' . $
-0002b220: 7375 626a 6563 7420 2e20 7374 6174 6963  subject . static
-0002b230: 3a3a 244c 453b 0a20 2020 2020 2020 207d  ::$LE;.        }
-0002b240: 0a20 2020 2020 2020 2024 6865 6164 6572  .        $header
-0002b250: 4c69 6e65 7320 3d20 6578 706c 6f64 6528  Lines = explode(
-0002b260: 7374 6174 6963 3a3a 244c 452c 2024 6865  static::$LE, $he
-0002b270: 6164 6572 735f 6c69 6e65 293b 0a20 2020  aders_line);.   
-0002b280: 2020 2020 2024 6375 7272 656e 7448 6561       $currentHea
-0002b290: 6465 724c 6162 656c 203d 2027 273b 0a20  derLabel = '';. 
-0002b2a0: 2020 2020 2020 2024 6375 7272 656e 7448         $currentH
-0002b2b0: 6561 6465 7256 616c 7565 203d 2027 273b  eaderValue = '';
-0002b2c0: 0a20 2020 2020 2020 2024 7061 7273 6564  .        $parsed
-0002b2d0: 4865 6164 6572 7320 3d20 5b5d 3b0a 2020  Headers = [];.  
-0002b2e0: 2020 2020 2020 2468 6561 6465 724c 696e        $headerLin
-0002b2f0: 6549 6e64 6578 203d 2030 3b0a 2020 2020  eIndex = 0;.    
-0002b300: 2020 2020 2468 6561 6465 724c 696e 6543      $headerLineC
-0002b310: 6f75 6e74 203d 2063 6f75 6e74 2824 6865  ount = count($he
-0002b320: 6164 6572 4c69 6e65 7329 3b0a 2020 2020  aderLines);.    
-0002b330: 2020 2020 666f 7265 6163 6820 2824 6865      foreach ($he
-0002b340: 6164 6572 4c69 6e65 7320 6173 2024 6865  aderLines as $he
-0002b350: 6164 6572 4c69 6e65 2920 7b0a 2020 2020  aderLine) {.    
-0002b360: 2020 2020 2020 2020 246d 6174 6368 6573          $matches
-0002b370: 203d 205b 5d3b 0a20 2020 2020 2020 2020   = [];.         
-0002b380: 2020 2069 6620 2870 7265 675f 6d61 7463     if (preg_matc
-0002b390: 6828 272f 5e28 5b5e 205c 745d 2a3f 2928  h('/^([^ \t]*?)(
-0002b3a0: 3f3a 3a5b 205c 745d 2a29 282e 2a29 242f  ?::[ \t]*)(.*)$/
-0002b3b0: 272c 2024 6865 6164 6572 4c69 6e65 2c20  ', $headerLine, 
-0002b3c0: 246d 6174 6368 6573 2929 207b 0a20 2020  $matches)) {.   
-0002b3d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002b3e0: 2824 6375 7272 656e 7448 6561 6465 724c  ($currentHeaderL
-0002b3f0: 6162 656c 2021 3d3d 2027 2729 207b 0a20  abel !== '') {. 
-0002b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b410: 2020 202f 2f57 6520 7765 7265 2070 7265     //We were pre
-0002b420: 7669 6f75 736c 7920 696e 2061 6e6f 7468  viously in anoth
-0002b430: 6572 2068 6561 6465 723b 2054 6869 7320  er header; This 
-0002b440: 6973 2074 6865 2073 7461 7274 206f 6620  is the start of 
-0002b450: 6120 6e65 7720 6865 6164 6572 2c20 736f  a new header, so
-0002b460: 2073 6176 6520 7468 6520 7072 6576 696f   save the previo
-0002b470: 7573 206f 6e65 0a20 2020 2020 2020 2020  us one.         
-0002b480: 2020 2020 2020 2020 2020 2024 7061 7273             $pars
-0002b490: 6564 4865 6164 6572 735b 5d20 3d20 5b27  edHeaders[] = ['
-0002b4a0: 6c61 6265 6c27 203d 3e20 2463 7572 7265  label' => $curre
-0002b4b0: 6e74 4865 6164 6572 4c61 6265 6c2c 2027  ntHeaderLabel, '
-0002b4c0: 7661 6c75 6527 203d 3e20 2463 7572 7265  value' => $curre
-0002b4d0: 6e74 4865 6164 6572 5661 6c75 655d 3b0a  ntHeaderValue];.
-0002b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b4f0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0002b500: 2020 2463 7572 7265 6e74 4865 6164 6572    $currentHeader
-0002b510: 4c61 6265 6c20 3d20 246d 6174 6368 6573  Label = $matches
-0002b520: 5b31 5d3b 0a20 2020 2020 2020 2020 2020  [1];.           
-0002b530: 2020 2020 2024 6375 7272 656e 7448 6561       $currentHea
-0002b540: 6465 7256 616c 7565 203d 2024 6d61 7463  derValue = $matc
-0002b550: 6865 735b 325d 3b0a 2020 2020 2020 2020  hes[2];.        
-0002b560: 2020 2020 7d20 656c 7365 6966 2028 7072      } elseif (pr
-0002b570: 6567 5f6d 6174 6368 2827 2f5e 5b20 5c74  eg_match('/^[ \t
-0002b580: 5d2b 282e 2a29 242f 272c 2024 6865 6164  ]+(.*)$/', $head
-0002b590: 6572 4c69 6e65 2c20 246d 6174 6368 6573  erLine, $matches
-0002b5a0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-0002b5b0: 2020 2020 202f 2f54 6869 7320 6973 2061       //This is a
-0002b5c0: 2066 6f6c 6465 6420 636f 6e74 696e 7561   folded continua
-0002b5d0: 7469 6f6e 206f 6620 7468 6520 6375 7272  tion of the curr
-0002b5e0: 656e 7420 6865 6164 6572 2c20 736f 2075  ent header, so u
-0002b5f0: 6e66 6f6c 6420 6974 0a20 2020 2020 2020  nfold it.       
-0002b600: 2020 2020 2020 2020 2024 6375 7272 656e           $curren
-0002b610: 7448 6561 6465 7256 616c 7565 202e 3d20  tHeaderValue .= 
-0002b620: 2720 2720 2e20 246d 6174 6368 6573 5b31  ' ' . $matches[1
-0002b630: 5d3b 0a20 2020 2020 2020 2020 2020 207d  ];.            }
-0002b640: 0a20 2020 2020 2020 2020 2020 202b 2b24  .            ++$
-0002b650: 6865 6164 6572 4c69 6e65 496e 6465 783b  headerLineIndex;
-0002b660: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002b670: 2824 6865 6164 6572 4c69 6e65 496e 6465  ($headerLineInde
-0002b680: 7820 3e3d 2024 6865 6164 6572 4c69 6e65  x >= $headerLine
-0002b690: 436f 756e 7429 207b 0a20 2020 2020 2020  Count) {.       
-0002b6a0: 2020 2020 2020 2020 202f 2f54 6869 7320           //This 
-0002b6b0: 7761 7320 7468 6520 6c61 7374 206c 696e  was the last lin
-0002b6c0: 652c 2073 6f20 6669 6e69 7368 206f 6666  e, so finish off
-0002b6d0: 2074 6869 7320 6865 6164 6572 0a20 2020   this header.   
-0002b6e0: 2020 2020 2020 2020 2020 2020 2024 7061               $pa
-0002b6f0: 7273 6564 4865 6164 6572 735b 5d20 3d20  rsedHeaders[] = 
-0002b700: 5b27 6c61 6265 6c27 203d 3e20 2463 7572  ['label' => $cur
-0002b710: 7265 6e74 4865 6164 6572 4c61 6265 6c2c  rentHeaderLabel,
-0002b720: 2027 7661 6c75 6527 203d 3e20 2463 7572   'value' => $cur
-0002b730: 7265 6e74 4865 6164 6572 5661 6c75 655d  rentHeaderValue]
-0002b740: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
-0002b750: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0002b760: 2020 2463 6f70 6965 6448 6561 6465 7273    $copiedHeaders
-0002b770: 203d 205b 5d3b 0a20 2020 2020 2020 2024   = [];.        $
-0002b780: 6865 6164 6572 7354 6f53 6967 6e4b 6579  headersToSignKey
-0002b790: 7320 3d20 5b5d 3b0a 2020 2020 2020 2020  s = [];.        
-0002b7a0: 2468 6561 6465 7273 546f 5369 676e 203d  $headersToSign =
-0002b7b0: 205b 5d3b 0a20 2020 2020 2020 2066 6f72   [];.        for
-0002b7c0: 6561 6368 2028 2470 6172 7365 6448 6561  each ($parsedHea
-0002b7d0: 6465 7273 2061 7320 2468 6561 6465 7229  ders as $header)
-0002b7e0: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
-0002b7f0: 2f49 7320 7468 6973 2068 6561 6465 7220  /Is this header 
-0002b800: 6f6e 6520 7468 6174 206d 7573 7420 6265  one that must be
-0002b810: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
-0002b820: 2044 4b49 4d20 7369 676e 6174 7572 653f   DKIM signature?
-0002b830: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002b840: 2869 6e5f 6172 7261 7928 7374 7274 6f6c  (in_array(strtol
-0002b850: 6f77 6572 2824 6865 6164 6572 5b27 6c61  ower($header['la
-0002b860: 6265 6c27 5d29 2c20 2461 7574 6f53 6967  bel']), $autoSig
-0002b870: 6e48 6561 6465 7273 2c20 7472 7565 2929  nHeaders, true))
-0002b880: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0002b890: 2020 2024 6865 6164 6572 7354 6f53 6967     $headersToSig
-0002b8a0: 6e4b 6579 735b 5d20 3d20 2468 6561 6465  nKeys[] = $heade
-0002b8b0: 725b 276c 6162 656c 275d 3b0a 2020 2020  r['label'];.    
-0002b8c0: 2020 2020 2020 2020 2020 2020 2468 6561              $hea
-0002b8d0: 6465 7273 546f 5369 676e 5b5d 203d 2024  dersToSign[] = $
-0002b8e0: 6865 6164 6572 5b27 6c61 6265 6c27 5d20  header['label'] 
-0002b8f0: 2e20 273a 2027 202e 2024 6865 6164 6572  . ': ' . $header
-0002b900: 5b27 7661 6c75 6527 5d3b 0a20 2020 2020  ['value'];.     
-0002b910: 2020 2020 2020 2020 2020 2069 6620 2824             if ($
-0002b920: 7468 6973 2d3e 444b 494d 5f63 6f70 7948  this->DKIM_copyH
-0002b930: 6561 6465 7246 6965 6c64 7329 207b 0a20  eaderFields) {. 
-0002b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b950: 2020 2024 636f 7069 6564 4865 6164 6572     $copiedHeader
-0002b960: 735b 5d20 3d20 2468 6561 6465 725b 276c  s[] = $header['l
-0002b970: 6162 656c 275d 202e 2027 3a27 202e 202f  abel'] . ':' . /
-0002b980: 2f4e 6f74 6520 6e6f 2073 7061 6365 2061  /Note no space a
-0002b990: 6674 6572 2074 6869 732c 2061 7320 7065  fter this, as pe
-0002b9a0: 7220 5246 430a 2020 2020 2020 2020 2020  r RFC.          
-0002b9b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0002b9c0: 725f 7265 706c 6163 6528 277c 272c 2027  r_replace('|', '
-0002b9d0: 3d37 4327 2c20 2474 6869 732d 3e44 4b49  =7C', $this->DKI
-0002b9e0: 4d5f 5150 2824 6865 6164 6572 5b27 7661  M_QP($header['va
-0002b9f0: 6c75 6527 5d29 293b 0a20 2020 2020 2020  lue']));.       
-0002ba00: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-0002ba10: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0002ba20: 6e75 653b 0a20 2020 2020 2020 2020 2020  nue;.           
-0002ba30: 207d 0a20 2020 2020 2020 2020 2020 202f   }.            /
-0002ba40: 2f49 7320 7468 6973 2061 6e20 6578 7472  /Is this an extr
-0002ba50: 6120 6375 7374 6f6d 2068 6561 6465 7220  a custom header 
-0002ba60: 7765 2776 6520 6265 656e 2061 736b 6564  we've been asked
-0002ba70: 2074 6f20 7369 676e 3f0a 2020 2020 2020   to sign?.      
-0002ba80: 2020 2020 2020 6966 2028 696e 5f61 7272        if (in_arr
-0002ba90: 6179 2824 6865 6164 6572 5b27 6c61 6265  ay($header['labe
-0002baa0: 6c27 5d2c 2024 7468 6973 2d3e 444b 494d  l'], $this->DKIM
-0002bab0: 5f65 7874 7261 4865 6164 6572 732c 2074  _extraHeaders, t
-0002bac0: 7275 6529 2920 7b0a 2020 2020 2020 2020  rue)) {.        
-0002bad0: 2020 2020 2020 2020 2f2f 4669 6e64 2069          //Find i
-0002bae0: 7473 2076 616c 7565 2069 6e20 6375 7374  ts value in cust
-0002baf0: 6f6d 2068 6561 6465 7273 0a20 2020 2020  om headers.     
-0002bb00: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
-0002bb10: 6368 2028 2474 6869 732d 3e43 7573 746f  ch ($this->Custo
-0002bb20: 6d48 6561 6465 7220 6173 2024 6375 7374  mHeader as $cust
-0002bb30: 6f6d 4865 6164 6572 2920 7b0a 2020 2020  omHeader) {.    
-0002bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bb50: 6966 2028 2463 7573 746f 6d48 6561 6465  if ($customHeade
-0002bb60: 725b 305d 203d 3d3d 2024 6865 6164 6572  r[0] === $header
-0002bb70: 5b27 6c61 6265 6c27 5d29 207b 0a20 2020  ['label']) {.   
-0002bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bb90: 2020 2020 2024 6865 6164 6572 7354 6f53       $headersToS
-0002bba0: 6967 6e4b 6579 735b 5d20 3d20 2468 6561  ignKeys[] = $hea
-0002bbb0: 6465 725b 276c 6162 656c 275d 3b0a 2020  der['label'];.  
-0002bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bbd0: 2020 2020 2020 2468 6561 6465 7273 546f        $headersTo
-0002bbe0: 5369 676e 5b5d 203d 2024 6865 6164 6572  Sign[] = $header
-0002bbf0: 5b27 6c61 6265 6c27 5d20 2e20 273a 2027  ['label'] . ': '
-0002bc00: 202e 2024 6865 6164 6572 5b27 7661 6c75   . $header['valu
-0002bc10: 6527 5d3b 0a20 2020 2020 2020 2020 2020  e'];.           
-0002bc20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002bc30: 2824 7468 6973 2d3e 444b 494d 5f63 6f70  ($this->DKIM_cop
-0002bc40: 7948 6561 6465 7246 6965 6c64 7329 207b  yHeaderFields) {
-0002bc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bc60: 2020 2020 2020 2020 2020 2020 2024 636f               $co
-0002bc70: 7069 6564 4865 6164 6572 735b 5d20 3d20  piedHeaders[] = 
-0002bc80: 2468 6561 6465 725b 276c 6162 656c 275d  $header['label']
-0002bc90: 202e 2027 3a27 202e 202f 2f4e 6f74 6520   . ':' . //Note 
-0002bca0: 6e6f 2073 7061 6365 2061 6674 6572 2074  no space after t
-0002bcb0: 6869 732c 2061 7320 7065 7220 5246 430a  his, as per RFC.
-0002bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bce0: 7374 725f 7265 706c 6163 6528 277c 272c  str_replace('|',
-0002bcf0: 2027 3d37 4327 2c20 2474 6869 732d 3e44   '=7C', $this->D
-0002bd00: 4b49 4d5f 5150 2824 6865 6164 6572 5b27  KIM_QP($header['
-0002bd10: 7661 6c75 6527 5d29 293b 0a20 2020 2020  value']));.     
-0002bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd30: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0002bd40: 2020 2020 2020 2020 2020 2020 202f 2f53               //S
-0002bd50: 6b69 7020 7374 7261 6967 6874 2074 6f20  kip straight to 
-0002bd60: 7468 6520 6e65 7874 2068 6561 6465 720a  the next header.
-0002bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd80: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0002bd90: 2032 3b0a 2020 2020 2020 2020 2020 2020   2;.            
-0002bda0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0002bdb0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0002bdc0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0002bdd0: 2020 7d0a 2020 2020 2020 2020 2463 6f70    }.        $cop
-0002bde0: 6965 6448 6561 6465 7246 6965 6c64 7320  iedHeaderFields 
-0002bdf0: 3d20 2727 3b0a 2020 2020 2020 2020 6966  = '';.        if
-0002be00: 2028 2474 6869 732d 3e44 4b49 4d5f 636f   ($this->DKIM_co
-0002be10: 7079 4865 6164 6572 4669 656c 6473 2026  pyHeaderFields &
-0002be20: 2620 636f 756e 7428 2463 6f70 6965 6448  & count($copiedH
-0002be30: 6561 6465 7273 2920 3e20 3029 207b 0a20  eaders) > 0) {. 
-0002be40: 2020 2020 2020 2020 2020 202f 2f41 7373             //Ass
-0002be50: 656d 626c 6520 6120 444b 494d 2027 7a27  emble a DKIM 'z'
-0002be60: 2074 6167 0a20 2020 2020 2020 2020 2020   tag.           
-0002be70: 2024 636f 7069 6564 4865 6164 6572 4669   $copiedHeaderFi
-0002be80: 656c 6473 203d 2027 207a 3d27 3b0a 2020  elds = ' z=';.  
-0002be90: 2020 2020 2020 2020 2020 2466 6972 7374            $first
-0002bea0: 203d 2074 7275 653b 0a20 2020 2020 2020   = true;.       
-0002beb0: 2020 2020 2066 6f72 6561 6368 2028 2463       foreach ($c
-0002bec0: 6f70 6965 6448 6561 6465 7273 2061 7320  opiedHeaders as 
-0002bed0: 2463 6f70 6965 6448 6561 6465 7229 207b  $copiedHeader) {
-0002bee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bef0: 2069 6620 2821 2466 6972 7374 2920 7b0a   if (!$first) {.
-0002bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf10: 2020 2020 2463 6f70 6965 6448 6561 6465      $copiedHeade
-0002bf20: 7246 6965 6c64 7320 2e3d 2073 7461 7469  rFields .= stati
-0002bf30: 633a 3a24 4c45 202e 2027 207c 273b 0a20  c::$LE . ' |';. 
-0002bf40: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0002bf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bf60: 202f 2f46 6f6c 6420 6c6f 6e67 2076 616c   //Fold long val
-0002bf70: 7565 730a 2020 2020 2020 2020 2020 2020  ues.            
-0002bf80: 2020 2020 6966 2028 7374 726c 656e 2824      if (strlen($
-0002bf90: 636f 7069 6564 4865 6164 6572 2920 3e20  copiedHeader) > 
-0002bfa0: 7365 6c66 3a3a 5354 445f 4c49 4e45 5f4c  self::STD_LINE_L
-0002bfb0: 454e 4754 4820 2d20 3329 207b 0a20 2020  ENGTH - 3) {.   
-0002bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bfd0: 2024 636f 7069 6564 4865 6164 6572 4669   $copiedHeaderFi
-0002bfe0: 656c 6473 202e 3d20 7375 6273 7472 280a  elds .= substr(.
-0002bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c000: 2020 2020 2020 2020 6368 756e 6b5f 7370          chunk_sp
-0002c010: 6c69 7428 2463 6f70 6965 6448 6561 6465  lit($copiedHeade
-0002c020: 722c 2073 656c 663a 3a53 5444 5f4c 494e  r, self::STD_LIN
-0002c030: 455f 4c45 4e47 5448 202d 2033 2c20 7374  E_LENGTH - 3, st
-0002c040: 6174 6963 3a3a 244c 4520 2e20 7365 6c66  atic::$LE . self
-0002c050: 3a3a 4657 5329 2c0a 2020 2020 2020 2020  ::FWS),.        
-0002c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c070: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-0002c080: 2020 2020 2020 2020 2020 202d 7374 726c             -strl
-0002c090: 656e 2873 7461 7469 633a 3a24 4c45 202e  en(static::$LE .
-0002c0a0: 2073 656c 663a 3a46 5753 290a 2020 2020   self::FWS).    
-0002c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0c0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
-0002c0d0: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-0002c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0f0: 2463 6f70 6965 6448 6561 6465 7246 6965  $copiedHeaderFie
-0002c100: 6c64 7320 2e3d 2024 636f 7069 6564 4865  lds .= $copiedHe
-0002c110: 6164 6572 3b0a 2020 2020 2020 2020 2020  ader;.          
-0002c120: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0002c130: 2020 2020 2020 2020 2466 6972 7374 203d          $first =
-0002c140: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
-0002c150: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0002c160: 2020 2463 6f70 6965 6448 6561 6465 7246    $copiedHeaderF
-0002c170: 6965 6c64 7320 2e3d 2027 3b27 202e 2073  ields .= ';' . s
-0002c180: 7461 7469 633a 3a24 4c45 3b0a 2020 2020  tatic::$LE;.    
-0002c190: 2020 2020 7d0a 2020 2020 2020 2020 2468      }.        $h
-0002c1a0: 6561 6465 724b 6579 7320 3d20 2720 683d  eaderKeys = ' h=
-0002c1b0: 2720 2e20 696d 706c 6f64 6528 273a 272c  ' . implode(':',
-0002c1c0: 2024 6865 6164 6572 7354 6f53 6967 6e4b   $headersToSignK
-0002c1d0: 6579 7329 202e 2027 3b27 202e 2073 7461  eys) . ';' . sta
-0002c1e0: 7469 633a 3a24 4c45 3b0a 2020 2020 2020  tic::$LE;.      
-0002c1f0: 2020 2468 6561 6465 7256 616c 7565 7320    $headerValues 
-0002c200: 3d20 696d 706c 6f64 6528 7374 6174 6963  = implode(static
-0002c210: 3a3a 244c 452c 2024 6865 6164 6572 7354  ::$LE, $headersT
-0002c220: 6f53 6967 6e29 3b0a 2020 2020 2020 2020  oSign);.        
-0002c230: 2462 6f64 7920 3d20 2474 6869 732d 3e44  $body = $this->D
-0002c240: 4b49 4d5f 426f 6479 4328 2462 6f64 7929  KIM_BodyC($body)
-0002c250: 3b0a 2020 2020 2020 2020 2f2f 4261 7365  ;.        //Base
-0002c260: 3634 206f 6620 7061 636b 6564 2062 696e  64 of packed bin
-0002c270: 6172 7920 5348 412d 3235 3620 6861 7368  ary SHA-256 hash
-0002c280: 206f 6620 626f 6479 0a20 2020 2020 2020   of body.       
-0002c290: 2024 444b 494d 6236 3420 3d20 6261 7365   $DKIMb64 = base
-0002c2a0: 3634 5f65 6e63 6f64 6528 7061 636b 2827  64_encode(pack('
-0002c2b0: 482a 272c 2068 6173 6828 2773 6861 3235  H*', hash('sha25
-0002c2c0: 3627 2c20 2462 6f64 7929 2929 3b0a 2020  6', $body)));.  
-0002c2d0: 2020 2020 2020 2469 6465 6e74 203d 2027        $ident = '
-0002c2e0: 273b 0a20 2020 2020 2020 2069 6620 2827  ';.        if ('
-0002c2f0: 2720 213d 3d20 2474 6869 732d 3e44 4b49  ' !== $this->DKI
-0002c300: 4d5f 6964 656e 7469 7479 2920 7b0a 2020  M_identity) {.  
-0002c310: 2020 2020 2020 2020 2020 2469 6465 6e74            $ident
-0002c320: 203d 2027 2069 3d27 202e 2024 7468 6973   = ' i=' . $this
-0002c330: 2d3e 444b 494d 5f69 6465 6e74 6974 7920  ->DKIM_identity 
-0002c340: 2e20 273b 2720 2e20 7374 6174 6963 3a3a  . ';' . static::
-0002c350: 244c 453b 0a20 2020 2020 2020 207d 0a20  $LE;.        }. 
-0002c360: 2020 2020 2020 202f 2f54 6865 2044 4b49         //The DKI
-0002c370: 4d2d 5369 676e 6174 7572 6520 6865 6164  M-Signature head
-0002c380: 6572 2069 7320 696e 636c 7564 6564 2069  er is included i
-0002c390: 6e20 7468 6520 7369 676e 6174 7572 6520  n the signature 
-0002c3a0: 2a65 7863 6570 7420 666f 722a 2074 6865  *except for* the
-0002c3b0: 2076 616c 7565 206f 6620 7468 6520 6062   value of the `b
-0002c3c0: 6020 7461 670a 2020 2020 2020 2020 2f2f  ` tag.        //
-0002c3d0: 7768 6963 6820 6973 2061 7070 656e 6465  which is appende
-0002c3e0: 6420 6166 7465 7220 6361 6c63 756c 6174  d after calculat
-0002c3f0: 696e 6720 7468 6520 7369 676e 6174 7572  ing the signatur
-0002c400: 650a 2020 2020 2020 2020 2f2f 6874 7470  e.        //http
-0002c410: 733a 2f2f 746f 6f6c 732e 6965 7466 2e6f  s://tools.ietf.o
-0002c420: 7267 2f68 746d 6c2f 7266 6336 3337 3623  rg/html/rfc6376#
-0002c430: 7365 6374 696f 6e2d 332e 350a 2020 2020  section-3.5.    
-0002c440: 2020 2020 2464 6b69 6d53 6967 6e61 7475      $dkimSignatu
-0002c450: 7265 4865 6164 6572 203d 2027 444b 494d  reHeader = 'DKIM
-0002c460: 2d53 6967 6e61 7475 7265 3a20 763d 313b  -Signature: v=1;
-0002c470: 2720 2e0a 2020 2020 2020 2020 2020 2020  ' ..            
-0002c480: 2720 643d 2720 2e20 2474 6869 732d 3e44  ' d=' . $this->D
-0002c490: 4b49 4d5f 646f 6d61 696e 202e 2027 3b27  KIM_domain . ';'
-0002c4a0: 202e 0a20 2020 2020 2020 2020 2020 2027   ..            '
-0002c4b0: 2073 3d27 202e 2024 7468 6973 2d3e 444b   s=' . $this->DK
-0002c4c0: 494d 5f73 656c 6563 746f 7220 2e20 273b  IM_selector . ';
-0002c4d0: 2720 2e20 7374 6174 6963 3a3a 244c 4520  ' . static::$LE 
-0002c4e0: 2e0a 2020 2020 2020 2020 2020 2020 2720  ..            ' 
-0002c4f0: 613d 2720 2e20 2444 4b49 4d73 6967 6e61  a=' . $DKIMsigna
-0002c500: 7475 7265 5479 7065 202e 2027 3b27 202e  tureType . ';' .
-0002c510: 0a20 2020 2020 2020 2020 2020 2027 2071  .            ' q
-0002c520: 3d27 202e 2024 444b 494d 7175 6572 7920  =' . $DKIMquery 
-0002c530: 2e20 273b 2720 2e0a 2020 2020 2020 2020  . ';' ..        
-0002c540: 2020 2020 2720 743d 2720 2e20 2444 4b49      ' t=' . $DKI
-0002c550: 4d74 696d 6520 2e20 273b 2720 2e0a 2020  Mtime . ';' ..  
-0002c560: 2020 2020 2020 2020 2020 2720 633d 2720            ' c=' 
-0002c570: 2e20 2444 4b49 4d63 616e 6f6e 6963 616c  . $DKIMcanonical
-0002c580: 697a 6174 696f 6e20 2e20 273b 2720 2e20  ization . ';' . 
-0002c590: 7374 6174 6963 3a3a 244c 4520 2e0a 2020  static::$LE ..  
-0002c5a0: 2020 2020 2020 2020 2020 2468 6561 6465            $heade
-0002c5b0: 724b 6579 7320 2e0a 2020 2020 2020 2020  rKeys ..        
-0002c5c0: 2020 2020 2469 6465 6e74 202e 0a20 2020      $ident ..   
-0002c5d0: 2020 2020 2020 2020 2024 636f 7069 6564           $copied
-0002c5e0: 4865 6164 6572 4669 656c 6473 202e 0a20  HeaderFields .. 
-0002c5f0: 2020 2020 2020 2020 2020 2027 2062 683d             ' bh=
-0002c600: 2720 2e20 2444 4b49 4d62 3634 202e 2027  ' . $DKIMb64 . '
-0002c610: 3b27 202e 2073 7461 7469 633a 3a24 4c45  ;' . static::$LE
-0002c620: 202e 0a20 2020 2020 2020 2020 2020 2027   ..            '
-0002c630: 2062 3d27 3b0a 2020 2020 2020 2020 2f2f   b=';.        //
-0002c640: 4361 6e6f 6e69 6361 6c69 7a65 2074 6865  Canonicalize the
-0002c650: 2073 6574 206f 6620 6865 6164 6572 730a   set of headers.
-0002c660: 2020 2020 2020 2020 2463 616e 6f6e 6963          $canonic
-0002c670: 616c 697a 6564 4865 6164 6572 7320 3d20  alizedHeaders = 
-0002c680: 2474 6869 732d 3e44 4b49 4d5f 4865 6164  $this->DKIM_Head
-0002c690: 6572 4328 0a20 2020 2020 2020 2020 2020  erC(.           
-0002c6a0: 2024 6865 6164 6572 5661 6c75 6573 202e   $headerValues .
-0002c6b0: 2073 7461 7469 633a 3a24 4c45 202e 2024   static::$LE . $
-0002c6c0: 646b 696d 5369 676e 6174 7572 6548 6561  dkimSignatureHea
-0002c6d0: 6465 720a 2020 2020 2020 2020 293b 0a20  der.        );. 
-0002c6e0: 2020 2020 2020 2024 7369 676e 6174 7572         $signatur
-0002c6f0: 6520 3d20 2474 6869 732d 3e44 4b49 4d5f  e = $this->DKIM_
-0002c700: 5369 676e 2824 6361 6e6f 6e69 6361 6c69  Sign($canonicali
-0002c710: 7a65 6448 6561 6465 7273 293b 0a20 2020  zedHeaders);.   
-0002c720: 2020 2020 2024 7369 676e 6174 7572 6520       $signature 
-0002c730: 3d20 7472 696d 2863 6875 6e6b 5f73 706c  = trim(chunk_spl
-0002c740: 6974 2824 7369 676e 6174 7572 652c 2073  it($signature, s
-0002c750: 656c 663a 3a53 5444 5f4c 494e 455f 4c45  elf::STD_LINE_LE
-0002c760: 4e47 5448 202d 2033 2c20 7374 6174 6963  NGTH - 3, static
-0002c770: 3a3a 244c 4520 2e20 7365 6c66 3a3a 4657  ::$LE . self::FW
-0002c780: 5329 293b 0a0a 2020 2020 2020 2020 7265  S));..        re
-0002c790: 7475 726e 2073 7461 7469 633a 3a6e 6f72  turn static::nor
-0002c7a0: 6d61 6c69 7a65 4272 6561 6b73 2824 646b  malizeBreaks($dk
-0002c7b0: 696d 5369 676e 6174 7572 6548 6561 6465  imSignatureHeade
-0002c7c0: 7220 2e20 2473 6967 6e61 7475 7265 293b  r . $signature);
-0002c7d0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-0002c7e0: 2020 2020 202a 2044 6574 6563 7420 6966       * Detect if
-0002c7f0: 2061 2073 7472 696e 6720 636f 6e74 6169   a string contai
-0002c800: 6e73 2061 206c 696e 6520 6c6f 6e67 6572  ns a line longer
-0002c810: 2074 6861 6e20 7468 6520 6d61 7869 6d75   than the maximu
-0002c820: 6d20 6c69 6e65 206c 656e 6774 680a 2020  m line length.  
-0002c830: 2020 202a 2061 6c6c 6f77 6564 2062 7920     * allowed by 
-0002c840: 5246 4320 3238 3232 2073 6563 7469 6f6e  RFC 2822 section
-0002c850: 2032 2e31 2e31 2e0a 2020 2020 202a 0a20   2.1.1..     *. 
-0002c860: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-0002c870: 696e 6720 2473 7472 0a20 2020 2020 2a0a  ing $str.     *.
-0002c880: 2020 2020 202a 2040 7265 7475 726e 2062       * @return b
-0002c890: 6f6f 6c0a 2020 2020 202a 2f0a 2020 2020  ool.     */.    
-0002c8a0: 7075 626c 6963 2073 7461 7469 6320 6675  public static fu
-0002c8b0: 6e63 7469 6f6e 2068 6173 4c69 6e65 4c6f  nction hasLineLo
-0002c8c0: 6e67 6572 5468 616e 4d61 7828 2473 7472  ngerThanMax($str
-0002c8d0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-0002c8e0: 7265 7475 726e 2028 626f 6f6c 2920 7072  return (bool) pr
-0002c8f0: 6567 5f6d 6174 6368 2827 2f5e 282e 7b27  eg_match('/^(.{'
-0002c900: 202e 2028 7365 6c66 3a3a 4d41 585f 4c49   . (self::MAX_LI
-0002c910: 4e45 5f4c 454e 4754 4820 2b20 7374 726c  NE_LENGTH + strl
-0002c920: 656e 2873 7461 7469 633a 3a24 4c45 2929  en(static::$LE))
-0002c930: 202e 2027 2c7d 292f 6d27 2c20 2473 7472   . ',})/m', $str
-0002c940: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
-0002c950: 2a0a 2020 2020 202a 2049 6620 6120 7374  *.     * If a st
-0002c960: 7269 6e67 2063 6f6e 7461 696e 7320 616e  ring contains an
-0002c970: 7920 2273 7065 6369 616c 2220 6368 6172  y "special" char
-0002c980: 6163 7465 7273 2c20 646f 7562 6c65 2d71  acters, double-q
-0002c990: 756f 7465 2074 6865 206e 616d 652c 0a20  uote the name,. 
-0002c9a0: 2020 2020 2a20 616e 6420 6573 6361 7065      * and escape
-0002c9b0: 2061 6e79 2064 6f75 626c 6520 7175 6f74   any double quot
-0002c9c0: 6573 2077 6974 6820 6120 6261 636b 736c  es with a backsl
-0002c9d0: 6173 682e 0a20 2020 2020 2a0a 2020 2020  ash..     *.    
-0002c9e0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
-0002c9f0: 2024 7374 720a 2020 2020 202a 0a20 2020   $str.     *.   
-0002ca00: 2020 2a20 4072 6574 7572 6e20 7374 7269    * @return stri
-0002ca10: 6e67 0a20 2020 2020 2a0a 2020 2020 202a  ng.     *.     *
-0002ca20: 2040 7365 6520 5246 4338 3232 2033 2e34   @see RFC822 3.4
-0002ca30: 2e31 0a20 2020 2020 2a2f 0a20 2020 2070  .1.     */.    p
-0002ca40: 7562 6c69 6320 7374 6174 6963 2066 756e  ublic static fun
-0002ca50: 6374 696f 6e20 7175 6f74 6564 5374 7269  ction quotedStri
-0002ca60: 6e67 2824 7374 7229 0a20 2020 207b 0a20  ng($str).    {. 
-0002ca70: 2020 2020 2020 2069 6620 2870 7265 675f         if (preg_
-0002ca80: 6d61 7463 6828 272f 5b20 2829 3c3e 402c  match('/[ ()<>@,
-0002ca90: 3b3a 225c 2f5c 5b5c 5d3f 3d5d 2f27 2c20  ;:"\/\[\]?=]/', 
-0002caa0: 2473 7472 2929 207b 0a20 2020 2020 2020  $str)) {.       
-0002cab0: 2020 2020 202f 2f49 6620 7468 6520 7374       //If the st
-0002cac0: 7269 6e67 2063 6f6e 7461 696e 7320 616e  ring contains an
-0002cad0: 7920 6f66 2074 6865 7365 2063 6861 7273  y of these chars
-0002cae0: 2c20 6974 206d 7573 7420 6265 2064 6f75  , it must be dou
-0002caf0: 626c 652d 7175 6f74 6564 0a20 2020 2020  ble-quoted.     
-0002cb00: 2020 2020 2020 202f 2f61 6e64 2061 6e79         //and any
-0002cb10: 2064 6f75 626c 6520 7175 6f74 6573 206d   double quotes m
-0002cb20: 7573 7420 6265 2065 7363 6170 6564 2077  ust be escaped w
-0002cb30: 6974 6820 6120 6261 636b 736c 6173 680a  ith a backslash.
-0002cb40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002cb50: 726e 2027 2227 202e 2073 7472 5f72 6570  rn '"' . str_rep
-0002cb60: 6c61 6365 2827 2227 2c20 275c 5c22 272c  lace('"', '\\"',
-0002cb70: 2024 7374 7229 202e 2027 2227 3b0a 2020   $str) . '"';.  
-0002cb80: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0002cb90: 202f 2f52 6574 7572 6e20 7468 6520 7374   //Return the st
-0002cba0: 7269 6e67 2075 6e74 6f75 6368 6564 2c20  ring untouched, 
-0002cbb0: 6974 2064 6f65 736e 2774 206e 6565 6420  it doesn't need 
-0002cbc0: 7175 6f74 696e 670a 2020 2020 2020 2020  quoting.        
-0002cbd0: 7265 7475 726e 2024 7374 723b 0a20 2020  return $str;.   
-0002cbe0: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
-0002cbf0: 202a 2041 6c6c 6f77 7320 666f 7220 7075   * Allows for pu
-0002cc00: 626c 6963 2072 6561 6420 6163 6365 7373  blic read access
-0002cc10: 2074 6f20 2774 6f27 2070 726f 7065 7274   to 'to' propert
-0002cc20: 792e 0a20 2020 2020 2a20 4265 666f 7265  y..     * Before
-0002cc30: 2074 6865 2073 656e 6428 2920 6361 6c6c   the send() call
-0002cc40: 2c20 7175 6575 6564 2061 6464 7265 7373  , queued address
-0002cc50: 6573 2028 692e 652e 2077 6974 6820 4944  es (i.e. with ID
-0002cc60: 4e29 2061 7265 206e 6f74 2079 6574 2069  N) are not yet i
-0002cc70: 6e63 6c75 6465 642e 0a20 2020 2020 2a0a  ncluded..     *.
-0002cc80: 2020 2020 202a 2040 7265 7475 726e 2061       * @return a
-0002cc90: 7272 6179 0a20 2020 2020 2a2f 0a20 2020  rray.     */.   
-0002cca0: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-0002ccb0: 2067 6574 546f 4164 6472 6573 7365 7328   getToAddresses(
-0002ccc0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-0002ccd0: 7265 7475 726e 2024 7468 6973 2d3e 746f  return $this->to
-0002cce0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-0002ccf0: 0a20 2020 2020 2a20 416c 6c6f 7773 2066  .     * Allows f
-0002cd00: 6f72 2070 7562 6c69 6320 7265 6164 2061  or public read a
-0002cd10: 6363 6573 7320 746f 2027 6363 2720 7072  ccess to 'cc' pr
-0002cd20: 6f70 6572 7479 2e0a 2020 2020 202a 2042  operty..     * B
-0002cd30: 6566 6f72 6520 7468 6520 7365 6e64 2829  efore the send()
-0002cd40: 2063 616c 6c2c 2071 7565 7565 6420 6164   call, queued ad
-0002cd50: 6472 6573 7365 7320 2869 2e65 2e20 7769  dresses (i.e. wi
-0002cd60: 7468 2049 444e 2920 6172 6520 6e6f 7420  th IDN) are not 
-0002cd70: 7965 7420 696e 636c 7564 6564 2e0a 2020  yet included..  
-0002cd80: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-0002cd90: 7572 6e20 6172 7261 790a 2020 2020 202a  urn array.     *
-0002cda0: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
-0002cdb0: 6374 696f 6e20 6765 7443 6341 6464 7265  ction getCcAddre
-0002cdc0: 7373 6573 2829 0a20 2020 207b 0a20 2020  sses().    {.   
-0002cdd0: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
-0002cde0: 732d 3e63 633b 0a20 2020 207d 0a0a 2020  s->cc;.    }..  
-0002cdf0: 2020 2f2a 2a0a 2020 2020 202a 2041 6c6c    /**.     * All
-0002ce00: 6f77 7320 666f 7220 7075 626c 6963 2072  ows for public r
-0002ce10: 6561 6420 6163 6365 7373 2074 6f20 2762  ead access to 'b
-0002ce20: 6363 2720 7072 6f70 6572 7479 2e0a 2020  cc' property..  
-0002ce30: 2020 202a 2042 6566 6f72 6520 7468 6520     * Before the 
-0002ce40: 7365 6e64 2829 2063 616c 6c2c 2071 7565  send() call, que
-0002ce50: 7565 6420 6164 6472 6573 7365 7320 2869  ued addresses (i
-0002ce60: 2e65 2e20 7769 7468 2049 444e 2920 6172  .e. with IDN) ar
-0002ce70: 6520 6e6f 7420 7965 7420 696e 636c 7564  e not yet includ
-0002ce80: 6564 2e0a 2020 2020 202a 0a20 2020 2020  ed..     *.     
-0002ce90: 2a20 4072 6574 7572 6e20 6172 7261 790a  * @return array.
-0002cea0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-0002ceb0: 6963 2066 756e 6374 696f 6e20 6765 7442  ic function getB
-0002cec0: 6363 4164 6472 6573 7365 7328 290a 2020  ccAddresses().  
-0002ced0: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
-0002cee0: 726e 2024 7468 6973 2d3e 6263 633b 0a20  rn $this->bcc;. 
-0002cef0: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-0002cf00: 2020 202a 2041 6c6c 6f77 7320 666f 7220     * Allows for 
-0002cf10: 7075 626c 6963 2072 6561 6420 6163 6365  public read acce
-0002cf20: 7373 2074 6f20 2752 6570 6c79 546f 2720  ss to 'ReplyTo' 
-0002cf30: 7072 6f70 6572 7479 2e0a 2020 2020 202a  property..     *
-0002cf40: 2042 6566 6f72 6520 7468 6520 7365 6e64   Before the send
-0002cf50: 2829 2063 616c 6c2c 2071 7565 7565 6420  () call, queued 
-0002cf60: 6164 6472 6573 7365 7320 2869 2e65 2e20  addresses (i.e. 
-0002cf70: 7769 7468 2049 444e 2920 6172 6520 6e6f  with IDN) are no
-0002cf80: 7420 7965 7420 696e 636c 7564 6564 2e0a  t yet included..
-0002cf90: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-0002cfa0: 6574 7572 6e20 6172 7261 790a 2020 2020  eturn array.    
-0002cfb0: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-0002cfc0: 756e 6374 696f 6e20 6765 7452 6570 6c79  unction getReply
-0002cfd0: 546f 4164 6472 6573 7365 7328 290a 2020  ToAddresses().  
-0002cfe0: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
-0002cff0: 726e 2024 7468 6973 2d3e 5265 706c 7954  rn $this->ReplyT
-0002d000: 6f3b 0a20 2020 207d 0a0a 2020 2020 2f2a  o;.    }..    /*
-0002d010: 2a0a 2020 2020 202a 2041 6c6c 6f77 7320  *.     * Allows 
-0002d020: 666f 7220 7075 626c 6963 2072 6561 6420  for public read 
-0002d030: 6163 6365 7373 2074 6f20 2761 6c6c 5f72  access to 'all_r
-0002d040: 6563 6970 6965 6e74 7327 2070 726f 7065  ecipients' prope
-0002d050: 7274 792e 0a20 2020 2020 2a20 4265 666f  rty..     * Befo
-0002d060: 7265 2074 6865 2073 656e 6428 2920 6361  re the send() ca
-0002d070: 6c6c 2c20 7175 6575 6564 2061 6464 7265  ll, queued addre
-0002d080: 7373 6573 2028 692e 652e 2077 6974 6820  sses (i.e. with 
-0002d090: 4944 4e29 2061 7265 206e 6f74 2079 6574  IDN) are not yet
-0002d0a0: 2069 6e63 6c75 6465 642e 0a20 2020 2020   included..     
-0002d0b0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-0002d0c0: 2061 7272 6179 0a20 2020 2020 2a2f 0a20   array.     */. 
-0002d0d0: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
-0002d0e0: 6f6e 2067 6574 416c 6c52 6563 6970 6965  on getAllRecipie
-0002d0f0: 6e74 4164 6472 6573 7365 7328 290a 2020  ntAddresses().  
-0002d100: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
-0002d110: 726e 2024 7468 6973 2d3e 616c 6c5f 7265  rn $this->all_re
-0002d120: 6369 7069 656e 7473 3b0a 2020 2020 7d0a  cipients;.    }.
-0002d130: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0002d140: 5065 7266 6f72 6d20 6120 6361 6c6c 6261  Perform a callba
-0002d150: 636b 2e0a 2020 2020 202a 0a20 2020 2020  ck..     *.     
-0002d160: 2a20 4070 6172 616d 2062 6f6f 6c20 2020  * @param bool   
-0002d170: 2469 7353 656e 740a 2020 2020 202a 2040  $isSent.     * @
-0002d180: 7061 7261 6d20 6172 7261 7920 2024 746f  param array  $to
-0002d190: 0a20 2020 2020 2a20 4070 6172 616d 2061  .     * @param a
-0002d1a0: 7272 6179 2020 2463 630a 2020 2020 202a  rray  $cc.     *
-0002d1b0: 2040 7061 7261 6d20 6172 7261 7920 2024   @param array  $
-0002d1c0: 6263 630a 2020 2020 202a 2040 7061 7261  bcc.     * @para
-0002d1d0: 6d20 7374 7269 6e67 2024 7375 626a 6563  m string $subjec
-0002d1e0: 740a 2020 2020 202a 2040 7061 7261 6d20  t.     * @param 
-0002d1f0: 7374 7269 6e67 2024 626f 6479 0a20 2020  string $body.   
-0002d200: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-0002d210: 6720 2466 726f 6d0a 2020 2020 202a 2040  g $from.     * @
-0002d220: 7061 7261 6d20 6172 7261 7920 2024 6578  param array  $ex
-0002d230: 7472 610a 2020 2020 202a 2f0a 2020 2020  tra.     */.    
-0002d240: 7072 6f74 6563 7465 6420 6675 6e63 7469  protected functi
-0002d250: 6f6e 2064 6f43 616c 6c62 6163 6b28 2469  on doCallback($i
-0002d260: 7353 656e 742c 2024 746f 2c20 2463 632c  sSent, $to, $cc,
-0002d270: 2024 6263 632c 2024 7375 626a 6563 742c   $bcc, $subject,
-0002d280: 2024 626f 6479 2c20 2466 726f 6d2c 2024   $body, $from, $
-0002d290: 6578 7472 6129 0a20 2020 207b 0a20 2020  extra).    {.   
-0002d2a0: 2020 2020 2069 6620 2821 656d 7074 7928       if (!empty(
-0002d2b0: 2474 6869 732d 3e61 6374 696f 6e5f 6675  $this->action_fu
-0002d2c0: 6e63 7469 6f6e 2920 2626 2069 735f 6361  nction) && is_ca
-0002d2d0: 6c6c 6162 6c65 2824 7468 6973 2d3e 6163  llable($this->ac
-0002d2e0: 7469 6f6e 5f66 756e 6374 696f 6e29 2920  tion_function)) 
-0002d2f0: 7b0a 2020 2020 2020 2020 2020 2020 6361  {.            ca
-0002d300: 6c6c 5f75 7365 725f 6675 6e63 2824 7468  ll_user_func($th
-0002d310: 6973 2d3e 6163 7469 6f6e 5f66 756e 6374  is->action_funct
-0002d320: 696f 6e2c 2024 6973 5365 6e74 2c20 2474  ion, $isSent, $t
-0002d330: 6f2c 2024 6363 2c20 2462 6363 2c20 2473  o, $cc, $bcc, $s
-0002d340: 7562 6a65 6374 2c20 2462 6f64 792c 2024  ubject, $body, $
-0002d350: 6672 6f6d 2c20 2465 7874 7261 293b 0a20  from, $extra);. 
-0002d360: 2020 2020 2020 207d 0a20 2020 207d 0a0a         }.    }..
-0002d370: 2020 2020 2f2a 2a0a 2020 2020 202a 2047      /**.     * G
-0002d380: 6574 2074 6865 204f 4175 7468 546f 6b65  et the OAuthToke
-0002d390: 6e50 726f 7669 6465 7220 696e 7374 616e  nProvider instan
-0002d3a0: 6365 2e0a 2020 2020 202a 0a20 2020 2020  ce..     *.     
-0002d3b0: 2a20 4072 6574 7572 6e20 4f41 7574 6854  * @return OAuthT
-0002d3c0: 6f6b 656e 5072 6f76 6964 6572 0a20 2020  okenProvider.   
-0002d3d0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-0002d3e0: 6675 6e63 7469 6f6e 2067 6574 4f41 7574  function getOAut
-0002d3f0: 6828 290a 2020 2020 7b0a 2020 2020 2020  h().    {.      
-0002d400: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
-0002d410: 6f61 7574 683b 0a20 2020 207d 0a0a 2020  oauth;.    }..  
-0002d420: 2020 2f2a 2a0a 2020 2020 202a 2053 6574    /**.     * Set
-0002d430: 2061 6e20 4f41 7574 6854 6f6b 656e 5072   an OAuthTokenPr
-0002d440: 6f76 6964 6572 2069 6e73 7461 6e63 652e  ovider instance.
-0002d450: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-0002d460: 6c69 6320 6675 6e63 7469 6f6e 2073 6574  lic function set
-0002d470: 4f41 7574 6828 4f41 7574 6854 6f6b 656e  OAuth(OAuthToken
-0002d480: 5072 6f76 6964 6572 2024 6f61 7574 6829  Provider $oauth)
-0002d490: 0a20 2020 207b 0a20 2020 2020 2020 2024  .    {.        $
-0002d4a0: 7468 6973 2d3e 6f61 7574 6820 3d20 246f  this->oauth = $o
-0002d4b0: 6175 7468 3b0a 2020 2020 7d0a 7d0a 0a0a  auth;.    }.}...
-0002d4c0: 2f2a 2a0a 202a 2050 4850 4d61 696c 6572  /**. * PHPMailer
-0002d4d0: 2052 4643 3832 3120 534d 5450 2065 6d61   RFC821 SMTP ema
-0002d4e0: 696c 2074 7261 6e73 706f 7274 2063 6c61  il transport cla
-0002d4f0: 7373 2e0a 202a 2050 4850 2056 6572 7369  ss.. * PHP Versi
-0002d500: 6f6e 2035 2e35 2e0a 202a 0a20 2a20 4073  on 5.5.. *. * @s
-0002d510: 6565 2020 2020 2020 2068 7474 7073 3a2f  ee       https:/
-0002d520: 2f67 6974 6875 622e 636f 6d2f 5048 504d  /github.com/PHPM
-0002d530: 6169 6c65 722f 5048 504d 6169 6c65 722f  ailer/PHPMailer/
-0002d540: 2054 6865 2050 4850 4d61 696c 6572 2047   The PHPMailer G
-0002d550: 6974 4875 6220 7072 6f6a 6563 740a 202a  itHub project. *
-0002d560: 0a20 2a20 4061 7574 686f 7220 2020 204d  . * @author    M
-0002d570: 6172 6375 7320 426f 696e 746f 6e20 2853  arcus Bointon (S
-0002d580: 796e 6368 726f 2f63 6f6f 6c62 7275 2920  ynchro/coolbru) 
-0002d590: 3c70 6870 6d61 696c 6572 4073 796e 6368  <phpmailer@synch
-0002d5a0: 726f 6d65 6469 612e 636f 2e75 6b3e 0a20  romedia.co.uk>. 
-0002d5b0: 2a20 4061 7574 686f 7220 2020 204a 696d  * @author    Jim
-0002d5c0: 204a 6167 6965 6c73 6b69 2028 6a69 6d6a   Jagielski (jimj
-0002d5d0: 6167 2920 3c6a 696d 6a61 6740 676d 6169  ag) <jimjag@gmai
-0002d5e0: 6c2e 636f 6d3e 0a20 2a20 4061 7574 686f  l.com>. * @autho
-0002d5f0: 7220 2020 2041 6e64 7920 5072 6576 6f73  r    Andy Prevos
-0002d600: 7420 2863 6f64 6577 6f72 7874 6563 6829  t (codeworxtech)
-0002d610: 203c 636f 6465 776f 7278 7465 6368 4075   <codeworxtech@u
-0002d620: 7365 7273 2e73 6f75 7263 6566 6f72 6765  sers.sourceforge
-0002d630: 2e6e 6574 3e0a 202a 2040 6175 7468 6f72  .net>. * @author
-0002d640: 2020 2020 4272 656e 7420 522e 204d 6174      Brent R. Mat
-0002d650: 7a65 6c6c 6520 286f 7269 6769 6e61 6c20  zelle (original 
-0002d660: 666f 756e 6465 7229 0a20 2a20 4063 6f70  founder). * @cop
-0002d670: 7972 6967 6874 2032 3031 3220 2d20 3230  yright 2012 - 20
-0002d680: 3230 204d 6172 6375 7320 426f 696e 746f  20 Marcus Bointo
-0002d690: 6e0a 202a 2040 636f 7079 7269 6768 7420  n. * @copyright 
-0002d6a0: 3230 3130 202d 2032 3031 3220 4a69 6d20  2010 - 2012 Jim 
-0002d6b0: 4a61 6769 656c 736b 690a 202a 2040 636f  Jagielski. * @co
-0002d6c0: 7079 7269 6768 7420 3230 3034 202d 2032  pyright 2004 - 2
-0002d6d0: 3030 3920 416e 6479 2050 7265 766f 7374  009 Andy Prevost
-0002d6e0: 0a20 2a20 406c 6963 656e 7365 2020 2068  . * @license   h
-0002d6f0: 7474 703a 2f2f 7777 772e 676e 752e 6f72  ttp://www.gnu.or
-0002d700: 672f 636f 7079 6c65 6674 2f6c 6573 7365  g/copyleft/lesse
-0002d710: 722e 6874 6d6c 2047 4e55 204c 6573 7365  r.html GNU Lesse
-0002d720: 7220 4765 6e65 7261 6c20 5075 626c 6963  r General Public
-0002d730: 204c 6963 656e 7365 0a20 2a20 406e 6f74   License. * @not
-0002d740: 6520 2020 2020 2054 6869 7320 7072 6f67  e      This prog
-0002d750: 7261 6d20 6973 2064 6973 7472 6962 7574  ram is distribut
-0002d760: 6564 2069 6e20 7468 6520 686f 7065 2074  ed in the hope t
-0002d770: 6861 7420 6974 2077 696c 6c20 6265 2075  hat it will be u
-0002d780: 7365 6675 6c20 2d20 5749 5448 4f55 540a  seful - WITHOUT.
-0002d790: 202a 2041 4e59 2057 4152 5241 4e54 593b   * ANY WARRANTY;
-0002d7a0: 2077 6974 686f 7574 2065 7665 6e20 7468   without even th
-0002d7b0: 6520 696d 706c 6965 6420 7761 7272 616e  e implied warran
-0002d7c0: 7479 206f 6620 4d45 5243 4841 4e54 4142  ty of MERCHANTAB
-0002d7d0: 494c 4954 5920 6f72 0a20 2a20 4649 544e  ILITY or. * FITN
-0002d7e0: 4553 5320 464f 5220 4120 5041 5254 4943  ESS FOR A PARTIC
-0002d7f0: 554c 4152 2050 5552 504f 5345 2e0a 202a  ULAR PURPOSE.. *
-0002d800: 2f0a 0a63 6c61 7373 2053 4d54 500a 7b0a  /..class SMTP.{.
-0002d810: 2020 2020 2f2a 2a0a 2020 2020 202a 2054      /**.     * T
-0002d820: 6865 2050 4850 4d61 696c 6572 2053 4d54  he PHPMailer SMT
-0002d830: 5020 7665 7273 696f 6e20 6e75 6d62 6572  P version number
-0002d840: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-0002d850: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-0002d860: 202a 2f0a 2020 2020 636f 6e73 7420 5645   */.    const VE
-0002d870: 5253 494f 4e20 3d20 2736 2e36 2e34 273b  RSION = '6.6.4';
-0002d880: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-0002d890: 2053 4d54 5020 6c69 6e65 2062 7265 616b   SMTP line break
-0002d8a0: 2063 6f6e 7374 616e 742e 0a20 2020 2020   constant..     
-0002d8b0: 2a0a 2020 2020 202a 2040 7661 7220 7374  *.     * @var st
-0002d8c0: 7269 6e67 0a20 2020 2020 2a2f 0a20 2020  ring.     */.   
-0002d8d0: 2063 6f6e 7374 204c 4520 3d20 225c 725c   const LE = "\r\
-0002d8e0: 6e22 3b0a 0a20 2020 202f 2a2a 0a20 2020  n";..    /**.   
-0002d8f0: 2020 2a20 5468 6520 534d 5450 2070 6f72    * The SMTP por
-0002d900: 7420 746f 2075 7365 2069 6620 6f6e 6520  t to use if one 
-0002d910: 6973 206e 6f74 2073 7065 6369 6669 6564  is not specified
-0002d920: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-0002d930: 4076 6172 2069 6e74 0a20 2020 2020 2a2f  @var int.     */
-0002d940: 0a20 2020 2063 6f6e 7374 2044 4546 4155  .    const DEFAU
-0002d950: 4c54 5f50 4f52 5420 3d20 3235 3b0a 0a20  LT_PORT = 25;.. 
-0002d960: 2020 202f 2a2a 0a20 2020 2020 2a20 5468     /**.     * Th
-0002d970: 6520 6d61 7869 6d75 6d20 6c69 6e65 206c  e maximum line l
-0002d980: 656e 6774 6820 616c 6c6f 7765 6420 6279  ength allowed by
-0002d990: 2052 4643 2035 3332 3120 7365 6374 696f   RFC 5321 sectio
-0002d9a0: 6e20 342e 352e 332e 312e 362c 0a20 2020  n 4.5.3.1.6,.   
-0002d9b0: 2020 2a20 2a65 7863 6c75 6469 6e67 2a20    * *excluding* 
-0002d9c0: 6120 7472 6169 6c69 6e67 2043 524c 4620  a trailing CRLF 
-0002d9d0: 6272 6561 6b2e 0a20 2020 2020 2a0a 2020  break..     *.  
-0002d9e0: 2020 202a 2040 7365 6520 6874 7470 733a     * @see https:
-0002d9f0: 2f2f 746f 6f6c 732e 6965 7466 2e6f 7267  //tools.ietf.org
-0002da00: 2f68 746d 6c2f 7266 6335 3332 3123 7365  /html/rfc5321#se
-0002da10: 6374 696f 6e2d 342e 352e 332e 312e 360a  ction-4.5.3.1.6.
-0002da20: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-0002da30: 6172 2069 6e74 0a20 2020 2020 2a2f 0a20  ar int.     */. 
-0002da40: 2020 2063 6f6e 7374 204d 4158 5f4c 494e     const MAX_LIN
-0002da50: 455f 4c45 4e47 5448 203d 2039 3938 3b0a  E_LENGTH = 998;.
-0002da60: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0002da70: 5468 6520 6d61 7869 6d75 6d20 6c69 6e65  The maximum line
-0002da80: 206c 656e 6774 6820 616c 6c6f 7765 6420   length allowed 
-0002da90: 666f 7220 7265 706c 6965 7320 696e 2052  for replies in R
-0002daa0: 4643 2035 3332 3120 7365 6374 696f 6e20  FC 5321 section 
-0002dab0: 342e 352e 332e 312e 352c 0a20 2020 2020  4.5.3.1.5,.     
-0002dac0: 2a20 2a69 6e63 6c75 6469 6e67 2a20 6120  * *including* a 
-0002dad0: 7472 6169 6c69 6e67 2043 524c 4620 6c69  trailing CRLF li
-0002dae0: 6e65 2062 7265 616b 2e0a 2020 2020 202a  ne break..     *
-0002daf0: 0a20 2020 2020 2a20 4073 6565 2068 7474  .     * @see htt
-0002db00: 7073 3a2f 2f74 6f6f 6c73 2e69 6574 662e  ps://tools.ietf.
-0002db10: 6f72 672f 6874 6d6c 2f72 6663 3533 3231  org/html/rfc5321
-0002db20: 2373 6563 7469 6f6e 2d34 2e35 2e33 2e31  #section-4.5.3.1
-0002db30: 2e35 0a20 2020 2020 2a0a 2020 2020 202a  .5.     *.     *
-0002db40: 2040 7661 7220 696e 740a 2020 2020 202a   @var int.     *
-0002db50: 2f0a 2020 2020 636f 6e73 7420 4d41 585f  /.    const MAX_
-0002db60: 5245 504c 595f 4c45 4e47 5448 203d 2035  REPLY_LENGTH = 5
-0002db70: 3132 3b0a 0a20 2020 202f 2a2a 0a20 2020  12;..    /**.   
-0002db80: 2020 2a20 4465 6275 6720 6c65 7665 6c20    * Debug level 
-0002db90: 666f 7220 6e6f 206f 7574 7075 742e 0a20  for no output.. 
-0002dba0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-0002dbb0: 7220 696e 740a 2020 2020 202a 2f0a 2020  r int.     */.  
-0002dbc0: 2020 636f 6e73 7420 4445 4255 475f 4f46    const DEBUG_OF
-0002dbd0: 4620 3d20 303b 0a0a 2020 2020 2f2a 2a0a  F = 0;..    /**.
-0002dbe0: 2020 2020 202a 2044 6562 7567 206c 6576       * Debug lev
-0002dbf0: 656c 2074 6f20 7368 6f77 2063 6c69 656e  el to show clien
-0002dc00: 7420 2d3e 2073 6572 7665 7220 6d65 7373  t -> server mess
-0002dc10: 6167 6573 2e0a 2020 2020 202a 0a20 2020  ages..     *.   
-0002dc20: 2020 2a20 4076 6172 2069 6e74 0a20 2020    * @var int.   
-0002dc30: 2020 2a2f 0a20 2020 2063 6f6e 7374 2044    */.    const D
-0002dc40: 4542 5547 5f43 4c49 454e 5420 3d20 313b  EBUG_CLIENT = 1;
-0002dc50: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-0002dc60: 2044 6562 7567 206c 6576 656c 2074 6f20   Debug level to 
-0002dc70: 7368 6f77 2063 6c69 656e 7420 2d3e 2073  show client -> s
-0002dc80: 6572 7665 7220 616e 6420 7365 7276 6572  erver and server
-0002dc90: 202d 3e20 636c 6965 6e74 206d 6573 7361   -> client messa
-0002dca0: 6765 732e 0a20 2020 2020 2a0a 2020 2020  ges..     *.    
-0002dcb0: 202a 2040 7661 7220 696e 740a 2020 2020   * @var int.    
-0002dcc0: 202a 2f0a 2020 2020 636f 6e73 7420 4445   */.    const DE
-0002dcd0: 4255 475f 5345 5256 4552 203d 2032 3b0a  BUG_SERVER = 2;.
-0002dce0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0002dcf0: 4465 6275 6720 6c65 7665 6c20 746f 2073  Debug level to s
-0002dd00: 686f 7720 636f 6e6e 6563 7469 6f6e 2073  how connection s
-0002dd10: 7461 7475 732c 2063 6c69 656e 7420 2d3e  tatus, client ->
-0002dd20: 2073 6572 7665 7220 616e 6420 7365 7276   server and serv
-0002dd30: 6572 202d 3e20 636c 6965 6e74 206d 6573  er -> client mes
-0002dd40: 7361 6765 732e 0a20 2020 2020 2a0a 2020  sages..     *.  
-0002dd50: 2020 202a 2040 7661 7220 696e 740a 2020     * @var int.  
-0002dd60: 2020 202a 2f0a 2020 2020 636f 6e73 7420     */.    const 
-0002dd70: 4445 4255 475f 434f 4e4e 4543 5449 4f4e  DEBUG_CONNECTION
-0002dd80: 203d 2033 3b0a 0a20 2020 202f 2a2a 0a20   = 3;..    /**. 
-0002dd90: 2020 2020 2a20 4465 6275 6720 6c65 7665      * Debug leve
-0002dda0: 6c20 746f 2073 686f 7720 616c 6c20 6d65  l to show all me
-0002ddb0: 7373 6167 6573 2e0a 2020 2020 202a 0a20  ssages..     *. 
-0002ddc0: 2020 2020 2a20 4076 6172 2069 6e74 0a20      * @var int. 
-0002ddd0: 2020 2020 2a2f 0a20 2020 2063 6f6e 7374      */.    const
-0002dde0: 2044 4542 5547 5f4c 4f57 4c45 5645 4c20   DEBUG_LOWLEVEL 
-0002ddf0: 3d20 343b 0a0a 2020 2020 2f2a 2a0a 2020  = 4;..    /**.  
-0002de00: 2020 202a 2044 6562 7567 206f 7574 7075     * Debug outpu
-0002de10: 7420 6c65 7665 6c2e 0a20 2020 2020 2a20  t level..     * 
-0002de20: 4f70 7469 6f6e 733a 0a20 2020 2020 2a20  Options:.     * 
-0002de30: 2a20 7365 6c66 3a3a 4445 4255 475f 4f46  * self::DEBUG_OF
-0002de40: 4620 2860 3060 2920 4e6f 2064 6562 7567  F (`0`) No debug
-0002de50: 206f 7574 7075 742c 2064 6566 6175 6c74   output, default
-0002de60: 0a20 2020 2020 2a20 2a20 7365 6c66 3a3a  .     * * self::
-0002de70: 4445 4255 475f 434c 4945 4e54 2028 6031  DEBUG_CLIENT (`1
-0002de80: 6029 2043 6c69 656e 7420 636f 6d6d 616e  `) Client comman
-0002de90: 6473 0a20 2020 2020 2a20 2a20 7365 6c66  ds.     * * self
-0002dea0: 3a3a 4445 4255 475f 5345 5256 4552 2028  ::DEBUG_SERVER (
-0002deb0: 6032 6029 2043 6c69 656e 7420 636f 6d6d  `2`) Client comm
-0002dec0: 616e 6473 2061 6e64 2073 6572 7665 7220  ands and server 
-0002ded0: 7265 7370 6f6e 7365 730a 2020 2020 202a  responses.     *
-0002dee0: 202a 2073 656c 663a 3a44 4542 5547 5f43   * self::DEBUG_C
-0002def0: 4f4e 4e45 4354 494f 4e20 2860 3360 2920  ONNECTION (`3`) 
-0002df00: 4173 2044 4542 5547 5f53 4552 5645 5220  As DEBUG_SERVER 
-0002df10: 706c 7573 2063 6f6e 6e65 6374 696f 6e20  plus connection 
-0002df20: 7374 6174 7573 0a20 2020 2020 2a20 2a20  status.     * * 
-0002df30: 7365 6c66 3a3a 4445 4255 475f 4c4f 574c  self::DEBUG_LOWL
-0002df40: 4556 454c 2028 6034 6029 204c 6f77 2d6c  EVEL (`4`) Low-l
-0002df50: 6576 656c 2064 6174 6120 6f75 7470 7574  evel data output
-0002df60: 2c20 616c 6c20 6d65 7373 6167 6573 2e0a  , all messages..
-0002df70: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-0002df80: 6172 2069 6e74 0a20 2020 2020 2a2f 0a20  ar int.     */. 
-0002df90: 2020 2070 7562 6c69 6320 2464 6f5f 6465     public $do_de
-0002dfa0: 6275 6720 3d20 7365 6c66 3a3a 4445 4255  bug = self::DEBU
-0002dfb0: 475f 4f46 463b 0a0a 2020 2020 2f2a 2a0a  G_OFF;..    /**.
-0002dfc0: 2020 2020 202a 2048 6f77 2074 6f20 6861       * How to ha
-0002dfd0: 6e64 6c65 2064 6562 7567 206f 7574 7075  ndle debug outpu
-0002dfe0: 742e 0a20 2020 2020 2a20 4f70 7469 6f6e  t..     * Option
-0002dff0: 733a 0a20 2020 2020 2a20 2a20 6065 6368  s:.     * * `ech
-0002e000: 6f60 204f 7574 7075 7420 706c 6169 6e2d  o` Output plain-
-0002e010: 7465 7874 2061 732d 6973 2c20 6170 7072  text as-is, appr
-0002e020: 6f70 7269 6174 6520 666f 7220 434c 490a  opriate for CLI.
-0002e030: 2020 2020 202a 202a 2060 6874 6d6c 6020       * * `html` 
-0002e040: 4f75 7470 7574 2065 7363 6170 6564 2c20  Output escaped, 
-0002e050: 6c69 6e65 2062 7265 616b 7320 636f 6e76  line breaks conv
-0002e060: 6572 7465 6420 746f 2060 3c62 723e 602c  erted to `<br>`,
-0002e070: 2061 7070 726f 7072 6961 7465 2066 6f72   appropriate for
-0002e080: 2062 726f 7773 6572 206f 7574 7075 740a   browser output.
-0002e090: 2020 2020 202a 202a 2060 6572 726f 725f       * * `error_
-0002e0a0: 6c6f 6760 204f 7574 7075 7420 746f 2065  log` Output to e
-0002e0b0: 7272 6f72 206c 6f67 2061 7320 636f 6e66  rror log as conf
-0002e0c0: 6967 7572 6564 2069 6e20 7068 702e 696e  igured in php.in
-0002e0d0: 690a 2020 2020 202a 2041 6c74 6572 6e61  i.     * Alterna
-0002e0e0: 7469 7665 6c79 2c20 796f 7520 6361 6e20  tively, you can 
-0002e0f0: 7072 6f76 6964 6520 6120 6361 6c6c 6162  provide a callab
-0002e100: 6c65 2065 7870 6563 7469 6e67 2074 776f  le expecting two
-0002e110: 2070 6172 616d 733a 2061 206d 6573 7361   params: a messa
-0002e120: 6765 2073 7472 696e 6720 616e 6420 7468  ge string and th
-0002e130: 6520 6465 6275 6720 6c65 7665 6c3a 0a20  e debug level:. 
-0002e140: 2020 2020 2a0a 2020 2020 202a 2060 6060      *.     * ```
-0002e150: 7068 700a 2020 2020 202a 2024 736d 7470  php.     * $smtp
-0002e160: 2d3e 4465 6275 676f 7574 7075 7420 3d20  ->Debugoutput = 
-0002e170: 6675 6e63 7469 6f6e 2824 7374 722c 2024  function($str, $
-0002e180: 6c65 7665 6c29 207b 6563 686f 2022 6465  level) {echo "de
-0002e190: 6275 6720 6c65 7665 6c20 246c 6576 656c  bug level $level
-0002e1a0: 3b20 6d65 7373 6167 653a 2024 7374 7222  ; message: $str"
-0002e1b0: 3b7d 3b0a 2020 2020 202a 2060 6060 0a20  ;};.     * ```. 
-0002e1c0: 2020 2020 2a0a 2020 2020 202a 2041 6c74      *.     * Alt
-0002e1d0: 6572 6e61 7469 7665 6c79 2c20 796f 7520  ernatively, you 
-0002e1e0: 6361 6e20 7061 7373 2069 6e20 616e 2069  can pass in an i
-0002e1f0: 6e73 7461 6e63 6520 6f66 2061 2050 5352  nstance of a PSR
-0002e200: 2d33 2063 6f6d 7061 7469 626c 6520 6c6f  -3 compatible lo
-0002e210: 6767 6572 2c20 7468 6f75 6768 206f 6e6c  gger, though onl
-0002e220: 7920 6064 6562 7567 600a 2020 2020 202a  y `debug`.     *
-0002e230: 206c 6576 656c 206f 7574 7075 7420 6973   level output is
-0002e240: 2075 7365 643a 0a20 2020 2020 2a0a 2020   used:.     *.  
-0002e250: 2020 202a 2060 6060 7068 700a 2020 2020     * ```php.    
-0002e260: 202a 2024 6d61 696c 2d3e 4465 6275 676f   * $mail->Debugo
-0002e270: 7574 7075 7420 3d20 6e65 7720 6d79 5073  utput = new myPs
-0002e280: 7233 4c6f 6767 6572 3b0a 2020 2020 202a  r3Logger;.     *
-0002e290: 2060 6060 0a20 2020 2020 2a0a 2020 2020   ```.     *.    
-0002e2a0: 202a 2040 7661 7220 7374 7269 6e67 7c63   * @var string|c
-0002e2b0: 616c 6c61 626c 657c 5c50 7372 5c4c 6f67  allable|\Psr\Log
-0002e2c0: 5c4c 6f67 6765 7249 6e74 6572 6661 6365  \LoggerInterface
-0002e2d0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-0002e2e0: 6c69 6320 2444 6562 7567 6f75 7470 7574  lic $Debugoutput
-0002e2f0: 203d 2027 6563 686f 273b 0a0a 2020 2020   = 'echo';..    
-0002e300: 2f2a 2a0a 2020 2020 202a 2057 6865 7468  /**.     * Wheth
-0002e310: 6572 2074 6f20 7573 6520 5645 5250 2e0a  er to use VERP..
-0002e320: 2020 2020 202a 0a20 2020 2020 2a20 4073       *.     * @s
-0002e330: 6565 2068 7474 703a 2f2f 656e 2e77 696b  ee http://en.wik
-0002e340: 6970 6564 6961 2e6f 7267 2f77 696b 692f  ipedia.org/wiki/
-0002e350: 5661 7269 6162 6c65 5f65 6e76 656c 6f70  Variable_envelop
-0002e360: 655f 7265 7475 726e 5f70 6174 680a 2020  e_return_path.  
-0002e370: 2020 202a 2040 7365 6520 6874 7470 3a2f     * @see http:/
-0002e380: 2f77 7777 2e70 6f73 7466 6978 2e6f 7267  /www.postfix.org
-0002e390: 2f56 4552 505f 5245 4144 4d45 2e68 746d  /VERP_README.htm
-0002e3a0: 6c20 496e 666f 206f 6e20 5645 5250 0a20  l Info on VERP. 
-0002e3b0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
-0002e3c0: 7220 626f 6f6c 0a20 2020 2020 2a2f 0a20  r bool.     */. 
-0002e3d0: 2020 2070 7562 6c69 6320 2464 6f5f 7665     public $do_ve
-0002e3e0: 7270 203d 2066 616c 7365 3b0a 0a20 2020  rp = false;..   
-0002e3f0: 202f 2a2a 0a20 2020 2020 2a20 5468 6520   /**.     * The 
-0002e400: 7469 6d65 6f75 7420 7661 6c75 6520 666f  timeout value fo
-0002e410: 7220 636f 6e6e 6563 7469 6f6e 2c20 696e  r connection, in
-0002e420: 2073 6563 6f6e 6473 2e0a 2020 2020 202a   seconds..     *
-0002e430: 2044 6566 6175 6c74 206f 6620 3520 6d69   Default of 5 mi
-0002e440: 6e75 7465 7320 2833 3030 7365 6329 2069  nutes (300sec) i
-0002e450: 7320 6672 6f6d 2052 4643 3238 3231 2073  s from RFC2821 s
-0002e460: 6563 7469 6f6e 2034 2e35 2e33 2e32 2e0a  ection 4.5.3.2..
-0002e470: 2020 2020 202a 2054 6869 7320 6e65 6564       * This need
-0002e480: 7320 746f 2062 6520 7175 6974 6520 6869  s to be quite hi
-0002e490: 6768 2074 6f20 6675 6e63 7469 6f6e 2063  gh to function c
-0002e4a0: 6f72 7265 6374 6c79 2077 6974 6820 686f  orrectly with ho
-0002e4b0: 7374 7320 7573 696e 6720 6772 6565 7464  sts using greetd
-0002e4c0: 656c 6179 2061 7320 616e 2061 6e74 692d  elay as an anti-
-0002e4d0: 7370 616d 206d 6561 7375 7265 2e0a 2020  spam measure..  
-0002e4e0: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
-0002e4f0: 2068 7474 703a 2f2f 746f 6f6c 732e 6965   http://tools.ie
-0002e500: 7466 2e6f 7267 2f68 746d 6c2f 7266 6332  tf.org/html/rfc2
-0002e510: 3832 3123 7365 6374 696f 6e2d 342e 352e  821#section-4.5.
-0002e520: 332e 320a 2020 2020 202a 0a20 2020 2020  3.2.     *.     
-0002e530: 2a20 4076 6172 2069 6e74 0a20 2020 2020  * @var int.     
-0002e540: 2a2f 0a20 2020 2070 7562 6c69 6320 2454  */.    public $T
-0002e550: 696d 656f 7574 203d 2033 3030 3b0a 0a20  imeout = 300;.. 
-0002e560: 2020 202f 2a2a 0a20 2020 2020 2a20 486f     /**.     * Ho
-0002e570: 7720 6c6f 6e67 2074 6f20 7761 6974 2066  w long to wait f
-0002e580: 6f72 2063 6f6d 6d61 6e64 7320 746f 2063  or commands to c
-0002e590: 6f6d 706c 6574 652c 2069 6e20 7365 636f  omplete, in seco
-0002e5a0: 6e64 732e 0a20 2020 2020 2a20 4465 6661  nds..     * Defa
-0002e5b0: 756c 7420 6f66 2035 206d 696e 7574 6573  ult of 5 minutes
-0002e5c0: 2028 3330 3073 6563 2920 6973 2066 726f   (300sec) is fro
-0002e5d0: 6d20 5246 4332 3832 3120 7365 6374 696f  m RFC2821 sectio
-0002e5e0: 6e20 342e 352e 332e 322e 0a20 2020 2020  n 4.5.3.2..     
-0002e5f0: 2a0a 2020 2020 202a 2040 7661 7220 696e  *.     * @var in
-0002e600: 740a 2020 2020 202a 2f0a 2020 2020 7075  t.     */.    pu
-0002e610: 626c 6963 2024 5469 6d65 6c69 6d69 7420  blic $Timelimit 
-0002e620: 3d20 3330 303b 0a0a 2020 2020 2f2a 2a0a  = 300;..    /**.
-0002e630: 2020 2020 202a 2050 6174 7465 726e 7320       * Patterns 
-0002e640: 746f 2065 7874 7261 6374 2061 6e20 534d  to extract an SM
-0002e650: 5450 2074 7261 6e73 6163 7469 6f6e 2069  TP transaction i
-0002e660: 6420 6672 6f6d 2072 6570 6c79 2074 6f20  d from reply to 
-0002e670: 6120 4441 5441 2063 6f6d 6d61 6e64 2e0a  a DATA command..
-0002e680: 2020 2020 202a 2054 6865 2066 6972 7374       * The first
-0002e690: 2063 6170 7475 7265 2067 726f 7570 2069   capture group i
-0002e6a0: 6e20 6561 6368 2072 6567 6578 2077 696c  n each regex wil
-0002e6b0: 6c20 6265 2075 7365 6420 6173 2074 6865  l be used as the
-0002e6c0: 2049 442e 0a20 2020 2020 2a20 4d53 2045   ID..     * MS E
-0002e6d0: 534d 5450 2072 6574 7572 6e73 2074 6865  SMTP returns the
-0002e6e0: 206d 6573 7361 6765 2049 442c 2077 6869   message ID, whi
-0002e6f0: 6368 206d 6179 206e 6f74 2062 6520 636f  ch may not be co
-0002e700: 7272 6563 7420 666f 7220 696e 7465 726e  rrect for intern
-0002e710: 616c 2074 7261 636b 696e 672e 0a20 2020  al tracking..   
-0002e720: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
-0002e730: 7374 7269 6e67 5b5d 0a20 2020 2020 2a2f  string[].     */
-0002e740: 0a20 2020 2070 726f 7465 6374 6564 2024  .    protected $
-0002e750: 736d 7470 5f74 7261 6e73 6163 7469 6f6e  smtp_transaction
-0002e760: 5f69 645f 7061 7474 6572 6e73 203d 205b  _id_patterns = [
-0002e770: 0a20 2020 2020 2020 2027 6578 696d 2720  .        'exim' 
-0002e780: 3d3e 2027 2f5b 5c64 5d7b 337d 204f 4b20  => '/[\d]{3} OK 
-0002e790: 6964 3d28 2e2a 292f 272c 0a20 2020 2020  id=(.*)/',.     
-0002e7a0: 2020 2027 7365 6e64 6d61 696c 2720 3d3e     'sendmail' =>
-0002e7b0: 2027 2f5b 5c64 5d7b 337d 2032 2e30 2e30   '/[\d]{3} 2.0.0
-0002e7c0: 2028 2e2a 2920 4d65 7373 6167 652f 272c   (.*) Message/',
-0002e7d0: 0a20 2020 2020 2020 2027 706f 7374 6669  .        'postfi
-0002e7e0: 7827 203d 3e20 272f 5b5c 645d 7b33 7d20  x' => '/[\d]{3} 
-0002e7f0: 322e 302e 3020 4f6b 3a20 7175 6575 6564  2.0.0 Ok: queued
-0002e800: 2061 7320 282e 2a29 2f27 2c0a 2020 2020   as (.*)/',.    
-0002e810: 2020 2020 274d 6963 726f 736f 6674 5f45      'Microsoft_E
-0002e820: 534d 5450 2720 3d3e 2027 2f5b 302d 395d  SMTP' => '/[0-9]
-0002e830: 7b33 7d20 322e 5b5c 645d 2e30 2028 2e2a  {3} 2.[\d].0 (.*
-0002e840: 2940 283f 3a2e 2a29 2051 7565 7565 6420  )@(?:.*) Queued 
-0002e850: 6d61 696c 2066 6f72 2064 656c 6976 6572  mail for deliver
-0002e860: 792f 272c 0a20 2020 2020 2020 2027 416d  y/',.        'Am
-0002e870: 617a 6f6e 5f53 4553 2720 3d3e 2027 2f5b  azon_SES' => '/[
-0002e880: 5c64 5d7b 337d 204f 6b20 282e 2a29 2f27  \d]{3} Ok (.*)/'
-0002e890: 2c0a 2020 2020 2020 2020 2753 656e 6447  ,.        'SendG
-0002e8a0: 7269 6427 203d 3e20 272f 5b5c 645d 7b33  rid' => '/[\d]{3
-0002e8b0: 7d20 4f6b 3a20 7175 6575 6564 2061 7320  } Ok: queued as 
-0002e8c0: 282e 2a29 2f27 2c0a 2020 2020 2020 2020  (.*)/',.        
-0002e8d0: 2743 616d 7061 6967 6e4d 6f6e 6974 6f72  'CampaignMonitor
-0002e8e0: 2720 3d3e 2027 2f5b 5c64 5d7b 337d 2032  ' => '/[\d]{3} 2
-0002e8f0: 2e30 2e30 204f 4b3a 285b 612d 7a41 2d5a  .0.0 OK:([a-zA-Z
-0002e900: 5c64 5d7b 3438 7d29 2f27 2c0a 2020 2020  \d]{48})/',.    
-0002e910: 2020 2020 2748 6172 616b 6127 203d 3e20      'Haraka' => 
-0002e920: 272f 5b5c 645d 7b33 7d20 4d65 7373 6167  '/[\d]{3} Messag
-0002e930: 6520 5175 6575 6564 205c 2828 2e2a 295c  e Queued \((.*)\
-0002e940: 292f 272c 0a20 2020 2020 2020 2027 4d61  )/',.        'Ma
-0002e950: 696c 6a65 7427 203d 3e20 272f 5b5c 645d  iljet' => '/[\d]
-0002e960: 7b33 7d20 4f4b 2071 7565 7565 6420 6173  {3} OK queued as
-0002e970: 2028 2e2a 292f 272c 0a20 2020 205d 3b0a   (.*)/',.    ];.
-0002e980: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-0002e990: 5468 6520 6c61 7374 2074 7261 6e73 6163  The last transac
-0002e9a0: 7469 6f6e 2049 4420 6973 7375 6564 2069  tion ID issued i
-0002e9b0: 6e20 7265 7370 6f6e 7365 2074 6f20 6120  n response to a 
-0002e9c0: 4441 5441 2063 6f6d 6d61 6e64 2c0a 2020  DATA command,.  
-0002e9d0: 2020 202a 2069 6620 6f6e 6520 7761 7320     * if one was 
-0002e9e0: 6465 7465 6374 6564 2e0a 2020 2020 202a  detected..     *
-0002e9f0: 0a20 2020 2020 2a20 4076 6172 2073 7472  .     * @var str
-0002ea00: 696e 677c 626f 6f6c 7c6e 756c 6c0a 2020  ing|bool|null.  
-0002ea10: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
-0002ea20: 7465 6420 246c 6173 745f 736d 7470 5f74  ted $last_smtp_t
-0002ea30: 7261 6e73 6163 7469 6f6e 5f69 643b 0a0a  ransaction_id;..
-0002ea40: 2020 2020 2f2a 2a0a 2020 2020 202a 2054      /**.     * T
-0002ea50: 6865 2073 6f63 6b65 7420 666f 7220 7468  he socket for th
-0002ea60: 6520 7365 7276 6572 2063 6f6e 6e65 6374  e server connect
-0002ea70: 696f 6e2e 0a20 2020 2020 2a0a 2020 2020  ion..     *.    
-0002ea80: 202a 2040 7661 7220 3f72 6573 6f75 7263   * @var ?resourc
-0002ea90: 650a 2020 2020 202a 2f0a 2020 2020 7072  e.     */.    pr
-0002eaa0: 6f74 6563 7465 6420 2473 6d74 705f 636f  otected $smtp_co
-0002eab0: 6e6e 3b0a 0a20 2020 202f 2a2a 0a20 2020  nn;..    /**.   
-0002eac0: 2020 2a20 4572 726f 7220 696e 666f 726d    * Error inform
-0002ead0: 6174 696f 6e2c 2069 6620 616e 792c 2066  ation, if any, f
-0002eae0: 6f72 2074 6865 206c 6173 7420 534d 5450  or the last SMTP
-0002eaf0: 2063 6f6d 6d61 6e64 2e0a 2020 2020 202a   command..     *
-0002eb00: 0a20 2020 2020 2a20 4076 6172 2061 7272  .     * @var arr
-0002eb10: 6179 0a20 2020 2020 2a2f 0a20 2020 2070  ay.     */.    p
-0002eb20: 726f 7465 6374 6564 2024 6572 726f 7220  rotected $error 
-0002eb30: 3d20 5b0a 2020 2020 2020 2020 2765 7272  = [.        'err
-0002eb40: 6f72 2720 3d3e 2027 272c 0a20 2020 2020  or' => '',.     
-0002eb50: 2020 2027 6465 7461 696c 2720 3d3e 2027     'detail' => '
-0002eb60: 272c 0a20 2020 2020 2020 2027 736d 7470  ',.        'smtp
-0002eb70: 5f63 6f64 6527 203d 3e20 2727 2c0a 2020  _code' => '',.  
-0002eb80: 2020 2020 2020 2773 6d74 705f 636f 6465        'smtp_code
-0002eb90: 5f65 7827 203d 3e20 2727 2c0a 2020 2020  _ex' => '',.    
-0002eba0: 5d3b 0a0a 2020 2020 2f2a 2a0a 2020 2020  ];..    /**.    
-0002ebb0: 202a 2054 6865 2072 6570 6c79 2074 6865   * The reply the
-0002ebc0: 2073 6572 7665 7220 7365 6e74 2074 6f20   server sent to 
-0002ebd0: 7573 2066 6f72 2048 454c 4f2e 0a20 2020  us for HELO..   
-0002ebe0: 2020 2a20 4966 206e 756c 6c2c 206e 6f20    * If null, no 
-0002ebf0: 4845 4c4f 2073 7472 696e 6720 6861 7320  HELO string has 
-0002ec00: 7965 7420 6265 656e 2072 6563 6569 7665  yet been receive
-0002ec10: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
-0002ec20: 2040 7661 7220 7374 7269 6e67 7c6e 756c   @var string|nul
-0002ec30: 6c0a 2020 2020 202a 2f0a 2020 2020 7072  l.     */.    pr
-0002ec40: 6f74 6563 7465 6420 2468 656c 6f5f 7270  otected $helo_rp
-0002ec50: 6c79 3b0a 0a20 2020 202f 2a2a 0a20 2020  ly;..    /**.   
-0002ec60: 2020 2a20 5468 6520 7365 7420 6f66 2053    * The set of S
-0002ec70: 4d54 5020 6578 7465 6e73 696f 6e73 2073  MTP extensions s
-0002ec80: 656e 7420 696e 2072 6570 6c79 2074 6f20  ent in reply to 
-0002ec90: 4548 4c4f 2063 6f6d 6d61 6e64 2e0a 2020  EHLO command..  
-0002eca0: 2020 202a 2049 6e64 6578 6573 206f 6620     * Indexes of 
-0002ecb0: 7468 6520 6172 7261 7920 6172 6520 6578  the array are ex
-0002ecc0: 7465 6e73 696f 6e20 6e61 6d65 732e 0a20  tension names.. 
-0002ecd0: 2020 2020 2a20 5661 6c75 6520 6174 2069      * Value at i
-0002ece0: 6e64 6578 2027 4845 4c4f 2720 6f72 2027  ndex 'HELO' or '
-0002ecf0: 4548 4c4f 2720 2861 6363 6f72 6469 6e67  EHLO' (according
-0002ed00: 2074 6f20 636f 6d6d 616e 6420 7468 6174   to command that
-0002ed10: 2077 6173 2073 656e 7429 0a20 2020 2020   was sent).     
-0002ed20: 2a20 7265 7072 6573 656e 7473 2074 6865  * represents the
-0002ed30: 2073 6572 7665 7220 6e61 6d65 2e20 496e   server name. In
-0002ed40: 2063 6173 6520 6f66 2048 454c 4f20 6974   case of HELO it
-0002ed50: 2069 7320 7468 6520 6f6e 6c79 2065 6c65   is the only ele
-0002ed60: 6d65 6e74 206f 6620 7468 6520 6172 7261  ment of the arra
-0002ed70: 792e 0a20 2020 2020 2a20 4f74 6865 7220  y..     * Other 
-0002ed80: 7661 6c75 6573 2063 616e 2062 6520 626f  values can be bo
-0002ed90: 6f6c 6561 6e20 5452 5545 206f 7220 616e  olean TRUE or an
-0002eda0: 2061 7272 6179 2063 6f6e 7461 696e 696e   array containin
-0002edb0: 6720 6578 7465 6e73 696f 6e20 6f70 7469  g extension opti
-0002edc0: 6f6e 732e 0a20 2020 2020 2a20 4966 206e  ons..     * If n
-0002edd0: 756c 6c2c 206e 6f20 4845 4c4f 2f45 484c  ull, no HELO/EHL
-0002ede0: 4f20 7374 7269 6e67 2068 6173 2079 6574  O string has yet
-0002edf0: 2062 6565 6e20 7265 6365 6976 6564 2e0a   been received..
-0002ee00: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
-0002ee10: 6172 2061 7272 6179 7c6e 756c 6c0a 2020  ar array|null.  
-0002ee20: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
-0002ee30: 7465 6420 2473 6572 7665 725f 6361 7073  ted $server_caps
-0002ee40: 3b0a 0a20 2020 202f 2a2a 0a20 2020 2020  ;..    /**.     
-0002ee50: 2a20 5468 6520 6d6f 7374 2072 6563 656e  * The most recen
-0002ee60: 7420 7265 706c 7920 7265 6365 6976 6564  t reply received
-0002ee70: 2066 726f 6d20 7468 6520 7365 7276 6572   from the server
-0002ee80: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-0002ee90: 4076 6172 2073 7472 696e 670a 2020 2020  @var string.    
-0002eea0: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
-0002eeb0: 6420 246c 6173 745f 7265 706c 7920 3d20  d $last_reply = 
-0002eec0: 2727 3b0a 0a20 2020 202f 2a2a 0a20 2020  '';..    /**.   
-0002eed0: 2020 2a20 4f75 7470 7574 2064 6562 7567    * Output debug
-0002eee0: 6769 6e67 2069 6e66 6f20 7669 6120 6120  ging info via a 
-0002eef0: 7573 6572 2d73 656c 6563 7465 6420 6d65  user-selected me
-0002ef00: 7468 6f64 2e0a 2020 2020 202a 0a20 2020  thod..     *.   
-0002ef10: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-0002ef20: 6720 2473 7472 2020 2044 6562 7567 2073  g $str   Debug s
-0002ef30: 7472 696e 6720 746f 206f 7574 7075 740a  tring to output.
-0002ef40: 2020 2020 202a 2040 7061 7261 6d20 696e       * @param in
-0002ef50: 7420 2020 2024 6c65 7665 6c20 5468 6520  t    $level The 
-0002ef60: 6465 6275 6720 6c65 7665 6c20 6f66 2074  debug level of t
-0002ef70: 6869 7320 6d65 7373 6167 653b 2073 6565  his message; see
-0002ef80: 2044 4542 5547 5f2a 2063 6f6e 7374 616e   DEBUG_* constan
-0002ef90: 7473 0a20 2020 2020 2a0a 2020 2020 202a  ts.     *.     *
-0002efa0: 2040 7365 6520 534d 5450 3a3a 2444 6562   @see SMTP::$Deb
-0002efb0: 7567 6f75 7470 7574 0a20 2020 2020 2a20  ugoutput.     * 
-0002efc0: 4073 6565 2053 4d54 503a 3a24 646f 5f64  @see SMTP::$do_d
-0002efd0: 6562 7567 0a20 2020 2020 2a2f 0a20 2020  ebug.     */.   
-0002efe0: 2070 726f 7465 6374 6564 2066 756e 6374   protected funct
-0002eff0: 696f 6e20 6564 6562 7567 2824 7374 722c  ion edebug($str,
-0002f000: 2024 6c65 7665 6c20 3d20 3029 0a20 2020   $level = 0).   
-0002f010: 207b 0a20 2020 2020 2020 2069 6620 2824   {.        if ($
-0002f020: 6c65 7665 6c20 3e20 2474 6869 732d 3e64  level > $this->d
-0002f030: 6f5f 6465 6275 6729 207b 0a20 2020 2020  o_debug) {.     
-0002f040: 2020 2020 2020 2072 6574 7572 6e3b 0a20         return;. 
-0002f050: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0002f060: 202f 2f49 7320 7468 6973 2061 2050 5352   //Is this a PSR
-0002f070: 2d33 206c 6f67 6765 723f 0a20 2020 2020  -3 logger?.     
-0002f080: 2020 2069 6620 2824 7468 6973 2d3e 4465     if ($this->De
-0002f090: 6275 676f 7574 7075 7420 696e 7374 616e  bugoutput instan
-0002f0a0: 6365 6f66 205c 5073 725c 4c6f 675c 4c6f  ceof \Psr\Log\Lo
-0002f0b0: 6767 6572 496e 7465 7266 6163 6529 207b  ggerInterface) {
-0002f0c0: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
-0002f0d0: 6973 2d3e 4465 6275 676f 7574 7075 742d  is->Debugoutput-
-0002f0e0: 3e64 6562 7567 2824 7374 7229 3b0a 0a20  >debug($str);.. 
-0002f0f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002f100: 6e3b 0a20 2020 2020 2020 207d 0a20 2020  n;.        }.   
-0002f110: 2020 2020 202f 2f41 766f 6964 2063 6c61       //Avoid cla
-0002f120: 7368 2077 6974 6820 6275 696c 742d 696e  sh with built-in
-0002f130: 2066 756e 6374 696f 6e20 6e61 6d65 730a   function names.
-0002f140: 2020 2020 2020 2020 6966 2028 6973 5f63          if (is_c
-0002f150: 616c 6c61 626c 6528 2474 6869 732d 3e44  allable($this->D
-0002f160: 6562 7567 6f75 7470 7574 2920 2626 2021  ebugoutput) && !
-0002f170: 696e 5f61 7272 6179 2824 7468 6973 2d3e  in_array($this->
-0002f180: 4465 6275 676f 7574 7075 742c 205b 2765  Debugoutput, ['e
-0002f190: 7272 6f72 5f6c 6f67 272c 2027 6874 6d6c  rror_log', 'html
-0002f1a0: 272c 2027 6563 686f 275d 2929 207b 0a20  ', 'echo'])) {. 
-0002f1b0: 2020 2020 2020 2020 2020 2063 616c 6c5f             call_
-0002f1c0: 7573 6572 5f66 756e 6328 2474 6869 732d  user_func($this-
-0002f1d0: 3e44 6562 7567 6f75 7470 7574 2c20 2473  >Debugoutput, $s
-0002f1e0: 7472 2c20 246c 6576 656c 293b 0a0a 2020  tr, $level);..  
-0002f1f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002f200: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
-0002f210: 2020 2020 7377 6974 6368 2028 2474 6869      switch ($thi
-0002f220: 732d 3e44 6562 7567 6f75 7470 7574 2920  s->Debugoutput) 
-0002f230: 7b0a 2020 2020 2020 2020 2020 2020 6361  {.            ca
-0002f240: 7365 2027 6572 726f 725f 6c6f 6727 3a0a  se 'error_log':.
-0002f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f260: 2f2f 446f 6e27 7420 6f75 7470 7574 2c20  //Don't output, 
-0002f270: 6a75 7374 206c 6f67 0a20 2020 2020 2020  just log.       
-0002f280: 2020 2020 2020 2020 2065 7272 6f72 5f6c           error_l
-0002f290: 6f67 2824 7374 7229 3b0a 2020 2020 2020  og($str);.      
-0002f2a0: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
-0002f2b0: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
-0002f2c0: 6520 2768 746d 6c27 3a0a 2020 2020 2020  e 'html':.      
-0002f2d0: 2020 2020 2020 2020 2020 2f2f 436c 6561            //Clea
-0002f2e0: 6e73 2075 7020 6f75 7470 7574 2061 2062  ns up output a b
-0002f2f0: 6974 2066 6f72 2061 2062 6574 7465 7220  it for a better 
-0002f300: 6c6f 6f6b 696e 672c 2048 544d 4c2d 7361  looking, HTML-sa
-0002f310: 6665 206f 7574 7075 740a 2020 2020 2020  fe output.      
-0002f320: 2020 2020 2020 2020 2020 6563 686f 2067            echo g
-0002f330: 6d64 6174 6528 2759 2d6d 2d64 2048 3a69  mdate('Y-m-d H:i
-0002f340: 3a73 2729 2c20 2720 272c 2068 746d 6c65  :s'), ' ', htmle
-0002f350: 6e74 6974 6965 7328 0a20 2020 2020 2020  ntities(.       
-0002f360: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0002f370: 675f 7265 706c 6163 6528 272f 5b5c 725c  g_replace('/[\r\
-0002f380: 6e5d 2b2f 272c 2027 272c 2024 7374 7229  n]+/', '', $str)
-0002f390: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002f3a0: 2020 2020 2020 454e 545f 5155 4f54 4553        ENT_QUOTES
-0002f3b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002f3c0: 2020 2020 2020 2755 5446 2d38 270a 2020        'UTF-8'.  
-0002f3d0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-0002f3e0: 2022 3c62 723e 5c6e 223b 0a20 2020 2020   "<br>\n";.     
-0002f3f0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0002f400: 3b0a 2020 2020 2020 2020 2020 2020 6361  ;.            ca
-0002f410: 7365 2027 6563 686f 273a 0a20 2020 2020  se 'echo':.     
-0002f420: 2020 2020 2020 2064 6566 6175 6c74 3a0a         default:.
-0002f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f440: 2f2f 4e6f 726d 616c 697a 6520 6c69 6e65  //Normalize line
-0002f450: 2062 7265 616b 730a 2020 2020 2020 2020   breaks.        
-0002f460: 2020 2020 2020 2020 2473 7472 203d 2070          $str = p
-0002f470: 7265 675f 7265 706c 6163 6528 272f 5c72  reg_replace('/\r
-0002f480: 5c6e 7c5c 722f 6d27 2c20 225c 6e22 2c20  \n|\r/m', "\n", 
-0002f490: 2473 7472 293b 0a20 2020 2020 2020 2020  $str);.         
-0002f4a0: 2020 2020 2020 2065 6368 6f20 676d 6461         echo gmda
-0002f4b0: 7465 2827 592d 6d2d 6420 483a 693a 7327  te('Y-m-d H:i:s'
-0002f4c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0002f4d0: 2020 2022 5c74 222c 0a20 2020 2020 2020     "\t",.       
-0002f4e0: 2020 2020 2020 2020 2020 2020 202f 2f54               //T
-0002f4f0: 7269 6d20 7472 6169 6c69 6e67 2073 7061  rim trailing spa
-0002f500: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-0002f510: 2020 2074 7269 6d28 0a20 2020 2020 2020     trim(.       
-0002f520: 2020 2020 2020 2020 2020 2020 202f 2f49               //I
-0002f530: 6e64 656e 7420 666f 7220 7265 6164 6162  ndent for readab
-0002f540: 696c 6974 792c 2065 7863 6570 7420 666f  ility, except fo
-0002f550: 7220 7472 6169 6c69 6e67 2062 7265 616b  r trailing break
-0002f560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f570: 2020 2020 2073 7472 5f72 6570 6c61 6365       str_replace
-0002f580: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002f590: 2020 2020 2020 2020 2020 225c 6e22 2c0a            "\n",.
-0002f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f5b0: 2020 2020 2020 2020 225c 6e20 2020 2020          "\n     
-0002f5c0: 2020 2020 2020 2020 2020 2020 2020 5c74                \t
-0002f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f5e0: 2020 222c 0a20 2020 2020 2020 2020 2020    ",.           
-0002f5f0: 2020 2020 2020 2020 2020 2020 2074 7269               tri
-0002f600: 6d28 2473 7472 290a 2020 2020 2020 2020  m($str).        
-0002f610: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002f620: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-0002f630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f640: 2022 5c6e 223b 0a20 2020 2020 2020 207d   "\n";.        }
-0002f650: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-0002f660: 2020 2020 202a 2043 6f6e 6e65 6374 2074       * Connect t
-0002f670: 6f20 616e 2053 4d54 5020 7365 7276 6572  o an SMTP server
-0002f680: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-0002f690: 4070 6172 616d 2073 7472 696e 6720 2468  @param string $h
-0002f6a0: 6f73 7420 2020 2053 4d54 5020 7365 7276  ost    SMTP serv
-0002f6b0: 6572 2049 5020 6f72 2068 6f73 7420 6e61  er IP or host na
-0002f6c0: 6d65 0a20 2020 2020 2a20 4070 6172 616d  me.     * @param
-0002f6d0: 2069 6e74 2020 2020 2470 6f72 7420 2020   int    $port   
-0002f6e0: 2054 6865 2070 6f72 7420 6e75 6d62 6572   The port number
-0002f6f0: 2074 6f20 636f 6e6e 6563 7420 746f 0a20   to connect to. 
-0002f700: 2020 2020 2a20 4070 6172 616d 2069 6e74      * @param int
-0002f710: 2020 2020 2474 696d 656f 7574 2048 6f77      $timeout How
-0002f720: 206c 6f6e 6720 746f 2077 6169 7420 666f   long to wait fo
-0002f730: 7220 7468 6520 636f 6e6e 6563 7469 6f6e  r the connection
-0002f740: 2074 6f20 6f70 656e 0a20 2020 2020 2a20   to open.     * 
-0002f750: 4070 6172 616d 2061 7272 6179 2020 246f  @param array  $o
-0002f760: 7074 696f 6e73 2041 6e20 6172 7261 7920  ptions An array 
-0002f770: 6f66 206f 7074 696f 6e73 2066 6f72 2073  of options for s
-0002f780: 7472 6561 6d5f 636f 6e74 6578 745f 6372  tream_context_cr
-0002f790: 6561 7465 2829 0a20 2020 2020 2a0a 2020  eate().     *.  
-0002f7a0: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
-0002f7b0: 6c0a 2020 2020 202a 2f0a 2020 2020 7075  l.     */.    pu
-0002f7c0: 626c 6963 2066 756e 6374 696f 6e20 636f  blic function co
-0002f7d0: 6e6e 6563 7428 2468 6f73 742c 2024 706f  nnect($host, $po
-0002f7e0: 7274 203d 206e 756c 6c2c 2024 7469 6d65  rt = null, $time
-0002f7f0: 6f75 7420 3d20 3330 2c20 246f 7074 696f  out = 30, $optio
-0002f800: 6e73 203d 205b 5d29 0a20 2020 207b 0a20  ns = []).    {. 
-0002f810: 2020 2020 2020 202f 2f43 6c65 6172 2065         //Clear e
-0002f820: 7272 6f72 7320 746f 2061 766f 6964 2063  rrors to avoid c
-0002f830: 6f6e 6675 7369 6f6e 0a20 2020 2020 2020  onfusion.       
-0002f840: 2024 7468 6973 2d3e 7365 7445 7272 6f72   $this->setError
-0002f850: 2827 2729 3b0a 2020 2020 2020 2020 2f2f  ('');.        //
-0002f860: 4d61 6b65 2073 7572 6520 7765 2061 7265  Make sure we are
-0002f870: 205f 5f6e 6f74 5f5f 2063 6f6e 6e65 6374   __not__ connect
-0002f880: 6564 0a20 2020 2020 2020 2069 6620 2824  ed.        if ($
-0002f890: 7468 6973 2d3e 636f 6e6e 6563 7465 6428  this->connected(
-0002f8a0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-0002f8b0: 202f 2f41 6c72 6561 6479 2063 6f6e 6e65   //Already conne
-0002f8c0: 6374 6564 2c20 6765 6e65 7261 7465 2065  cted, generate e
-0002f8d0: 7272 6f72 0a20 2020 2020 2020 2020 2020  rror.           
-0002f8e0: 2024 7468 6973 2d3e 7365 7445 7272 6f72   $this->setError
-0002f8f0: 2827 416c 7265 6164 7920 636f 6e6e 6563  ('Already connec
-0002f900: 7465 6420 746f 2061 2073 6572 7665 7227  ted to a server'
-0002f910: 293b 0a0a 2020 2020 2020 2020 2020 2020  );..            
-0002f920: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
-0002f930: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0002f940: 6966 2028 656d 7074 7928 2470 6f72 7429  if (empty($port)
-0002f950: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-0002f960: 2470 6f72 7420 3d20 7365 6c66 3a3a 4445  $port = self::DE
-0002f970: 4641 554c 545f 504f 5254 3b0a 2020 2020  FAULT_PORT;.    
-0002f980: 2020 2020 7d0a 2020 2020 2020 2020 2f2f      }.        //
-0002f990: 436f 6e6e 6563 7420 746f 2074 6865 2053  Connect to the S
-0002f9a0: 4d54 5020 7365 7276 6572 0a20 2020 2020  MTP server.     
-0002f9b0: 2020 2024 7468 6973 2d3e 6564 6562 7567     $this->edebug
-0002f9c0: 280a 2020 2020 2020 2020 2020 2020 2243  (.            "C
-0002f9d0: 6f6e 6e65 6374 696f 6e3a 206f 7065 6e69  onnection: openi
-0002f9e0: 6e67 2074 6f20 2468 6f73 743a 2470 6f72  ng to $host:$por
-0002f9f0: 742c 2074 696d 656f 7574 3d24 7469 6d65  t, timeout=$time
-0002fa00: 6f75 742c 206f 7074 696f 6e73 3d22 202e  out, options=" .
-0002fa10: 0a20 2020 2020 2020 2020 2020 2028 636f  .            (co
-0002fa20: 756e 7428 246f 7074 696f 6e73 2920 3e20  unt($options) > 
-0002fa30: 3020 3f20 7661 725f 6578 706f 7274 2824  0 ? var_export($
-0002fa40: 6f70 7469 6f6e 732c 2074 7275 6529 203a  options, true) :
-0002fa50: 2027 6172 7261 7928 2927 292c 0a20 2020   'array()'),.   
-0002fa60: 2020 2020 2020 2020 2073 656c 663a 3a44           self::D
-0002fa70: 4542 5547 5f43 4f4e 4e45 4354 494f 4e0a  EBUG_CONNECTION.
-0002fa80: 2020 2020 2020 2020 293b 0a0a 2020 2020          );..    
-0002fa90: 2020 2020 2474 6869 732d 3e73 6d74 705f      $this->smtp_
-0002faa0: 636f 6e6e 203d 2024 7468 6973 2d3e 6765  conn = $this->ge
-0002fab0: 7453 4d54 5043 6f6e 6e65 6374 696f 6e28  tSMTPConnection(
-0002fac0: 2468 6f73 742c 2024 706f 7274 2c20 2474  $host, $port, $t
-0002fad0: 696d 656f 7574 2c20 246f 7074 696f 6e73  imeout, $options
-0002fae0: 293b 0a0a 2020 2020 2020 2020 6966 2028  );..        if (
-0002faf0: 2474 6869 732d 3e73 6d74 705f 636f 6e6e  $this->smtp_conn
-0002fb00: 203d 3d3d 2066 616c 7365 2920 7b0a 2020   === false) {.  
-0002fb10: 2020 2020 2020 2020 2020 2f2f 4572 726f            //Erro
-0002fb20: 7220 696e 666f 2061 6c72 6561 6479 2073  r info already s
-0002fb30: 6574 2069 6e73 6964 6520 6067 6574 534d  et inside `getSM
-0002fb40: 5450 436f 6e6e 6563 7469 6f6e 2829 600a  TPConnection()`.
-0002fb50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002fb60: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
-0002fb70: 2020 7d0a 0a20 2020 2020 2020 2024 7468    }..        $th
-0002fb80: 6973 2d3e 6564 6562 7567 2827 436f 6e6e  is->edebug('Conn
-0002fb90: 6563 7469 6f6e 3a20 6f70 656e 6564 272c  ection: opened',
-0002fba0: 2073 656c 663a 3a44 4542 5547 5f43 4f4e   self::DEBUG_CON
-0002fbb0: 4e45 4354 494f 4e29 3b0a 0a20 2020 2020  NECTION);..     
-0002fbc0: 2020 202f 2f47 6574 2061 6e79 2061 6e6e     //Get any ann
-0002fbd0: 6f75 6e63 656d 656e 740a 2020 2020 2020  ouncement.      
-0002fbe0: 2020 2474 6869 732d 3e6c 6173 745f 7265    $this->last_re
-0002fbf0: 706c 7920 3d20 2474 6869 732d 3e67 6574  ply = $this->get
-0002fc00: 5f6c 696e 6573 2829 3b0a 2020 2020 2020  _lines();.      
-0002fc10: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
-0002fc20: 2753 4552 5645 5220 2d3e 2043 4c49 454e  'SERVER -> CLIEN
-0002fc30: 543a 2027 202e 2024 7468 6973 2d3e 6c61  T: ' . $this->la
-0002fc40: 7374 5f72 6570 6c79 2c20 7365 6c66 3a3a  st_reply, self::
-0002fc50: 4445 4255 475f 5345 5256 4552 293b 0a20  DEBUG_SERVER);. 
-0002fc60: 2020 2020 2020 2024 7265 7370 6f6e 7365         $response
-0002fc70: 436f 6465 203d 2028 696e 7429 7375 6273  Code = (int)subs
-0002fc80: 7472 2824 7468 6973 2d3e 6c61 7374 5f72  tr($this->last_r
-0002fc90: 6570 6c79 2c20 302c 2033 293b 0a20 2020  eply, 0, 3);.   
-0002fca0: 2020 2020 2069 6620 2824 7265 7370 6f6e       if ($respon
-0002fcb0: 7365 436f 6465 203d 3d3d 2032 3230 2920  seCode === 220) 
-0002fcc0: 7b0a 2020 2020 2020 2020 2020 2020 7265  {.            re
-0002fcd0: 7475 726e 2074 7275 653b 0a20 2020 2020  turn true;.     
-0002fce0: 2020 207d 0a20 2020 2020 2020 202f 2f41     }.        //A
-0002fcf0: 6e79 7468 696e 6720 6f74 6865 7220 7468  nything other th
-0002fd00: 616e 2061 2032 3230 2072 6573 706f 6e73  an a 220 respons
-0002fd10: 6520 6d65 616e 7320 736f 6d65 7468 696e  e means somethin
-0002fd20: 6720 7765 6e74 2077 726f 6e67 0a20 2020  g went wrong.   
-0002fd30: 2020 2020 202f 2f52 4643 2035 3332 3120       //RFC 5321 
-0002fd40: 7361 7973 2074 6865 2073 6572 7665 7220  says the server 
-0002fd50: 7769 6c6c 2077 6169 7420 666f 7220 7573  will wait for us
-0002fd60: 2074 6f20 7365 6e64 2061 2051 5549 5420   to send a QUIT 
-0002fd70: 696e 2072 6573 706f 6e73 6520 746f 2061  in response to a
-0002fd80: 2035 3534 2065 7272 6f72 0a20 2020 2020   554 error.     
-0002fd90: 2020 202f 2f68 7474 7073 3a2f 2f74 6f6f     //https://too
-0002fda0: 6c73 2e69 6574 662e 6f72 672f 6874 6d6c  ls.ietf.org/html
-0002fdb0: 2f72 6663 3533 3231 2373 6563 7469 6f6e  /rfc5321#section
-0002fdc0: 2d33 2e31 0a20 2020 2020 2020 2069 6620  -3.1.        if 
-0002fdd0: 2824 7265 7370 6f6e 7365 436f 6465 203d  ($responseCode =
-0002fde0: 3d3d 2035 3534 2920 7b0a 2020 2020 2020  == 554) {.      
-0002fdf0: 2020 2020 2020 2474 6869 732d 3e71 7569        $this->qui
-0002fe00: 7428 293b 0a20 2020 2020 2020 207d 0a20  t();.        }. 
-0002fe10: 2020 2020 2020 202f 2f54 6869 7320 7769         //This wi
-0002fe20: 6c6c 2068 616e 646c 6520 3432 3120 7265  ll handle 421 re
-0002fe30: 7370 6f6e 7365 7320 7768 6963 6820 6d61  sponses which ma
-0002fe40: 7920 6e6f 7420 7761 6974 2066 6f72 2061  y not wait for a
-0002fe50: 2051 5549 5420 2865 2e67 2e20 6966 2074   QUIT (e.g. if t
-0002fe60: 6865 2073 6572 7665 7220 6973 2062 6569  he server is bei
-0002fe70: 6e67 2073 6875 7420 646f 776e 290a 2020  ng shut down).  
-0002fe80: 2020 2020 2020 2474 6869 732d 3e65 6465        $this->ede
-0002fe90: 6275 6728 2743 6f6e 6e65 6374 696f 6e3a  bug('Connection:
-0002fea0: 2063 6c6f 7369 6e67 2064 7565 2074 6f20   closing due to 
-0002feb0: 6572 726f 7227 2c20 7365 6c66 3a3a 4445  error', self::DE
-0002fec0: 4255 475f 434f 4e4e 4543 5449 4f4e 293b  BUG_CONNECTION);
-0002fed0: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
-0002fee0: 636c 6f73 6528 293b 0a20 2020 2020 2020  close();.       
-0002fef0: 2072 6574 7572 6e20 6661 6c73 653b 0a20   return false;. 
-0002ff00: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-0002ff10: 2020 202a 2043 7265 6174 6520 636f 6e6e     * Create conn
-0002ff20: 6563 7469 6f6e 2074 6f20 7468 6520 534d  ection to the SM
-0002ff30: 5450 2073 6572 7665 722e 0a20 2020 2020  TP server..     
-0002ff40: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-0002ff50: 7374 7269 6e67 2024 686f 7374 2020 2020  string $host    
-0002ff60: 534d 5450 2073 6572 7665 7220 4950 206f  SMTP server IP o
-0002ff70: 7220 686f 7374 206e 616d 650a 2020 2020  r host name.    
-0002ff80: 202a 2040 7061 7261 6d20 696e 7420 2020   * @param int   
-0002ff90: 2024 706f 7274 2020 2020 5468 6520 706f   $port    The po
-0002ffa0: 7274 206e 756d 6265 7220 746f 2063 6f6e  rt number to con
-0002ffb0: 6e65 6374 2074 6f0a 2020 2020 202a 2040  nect to.     * @
-0002ffc0: 7061 7261 6d20 696e 7420 2020 2024 7469  param int    $ti
-0002ffd0: 6d65 6f75 7420 486f 7720 6c6f 6e67 2074  meout How long t
-0002ffe0: 6f20 7761 6974 2066 6f72 2074 6865 2063  o wait for the c
-0002fff0: 6f6e 6e65 6374 696f 6e20 746f 206f 7065  onnection to ope
-00030000: 6e0a 2020 2020 202a 2040 7061 7261 6d20  n.     * @param 
-00030010: 6172 7261 7920 2024 6f70 7469 6f6e 7320  array  $options 
-00030020: 416e 2061 7272 6179 206f 6620 6f70 7469  An array of opti
-00030030: 6f6e 7320 666f 7220 7374 7265 616d 5f63  ons for stream_c
-00030040: 6f6e 7465 7874 5f63 7265 6174 6528 290a  ontext_create().
-00030050: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00030060: 6574 7572 6e20 6661 6c73 657c 7265 736f  eturn false|reso
-00030070: 7572 6365 0a20 2020 2020 2a2f 0a20 2020  urce.     */.   
-00030080: 2070 726f 7465 6374 6564 2066 756e 6374   protected funct
-00030090: 696f 6e20 6765 7453 4d54 5043 6f6e 6e65  ion getSMTPConne
-000300a0: 6374 696f 6e28 2468 6f73 742c 2024 706f  ction($host, $po
-000300b0: 7274 203d 206e 756c 6c2c 2024 7469 6d65  rt = null, $time
-000300c0: 6f75 7420 3d20 3330 2c20 246f 7074 696f  out = 30, $optio
-000300d0: 6e73 203d 205b 5d29 0a20 2020 207b 0a20  ns = []).    {. 
-000300e0: 2020 2020 2020 2073 7461 7469 6320 2473         static $s
-000300f0: 7472 6561 6d6f 6b3b 0a20 2020 2020 2020  treamok;.       
-00030100: 202f 2f54 6869 7320 6973 2065 6e61 626c   //This is enabl
-00030110: 6564 2062 7920 6465 6661 756c 7420 7369  ed by default si
-00030120: 6e63 6520 352e 302e 3020 6275 7420 736f  nce 5.0.0 but so
-00030130: 6d65 2070 726f 7669 6465 7273 2064 6973  me providers dis
-00030140: 6162 6c65 2069 740a 2020 2020 2020 2020  able it.        
-00030150: 2f2f 4368 6563 6b20 7468 6973 206f 6e63  //Check this onc
-00030160: 6520 616e 6420 6361 6368 6520 7468 6520  e and cache the 
-00030170: 7265 7375 6c74 0a20 2020 2020 2020 2069  result.        i
-00030180: 6620 286e 756c 6c20 3d3d 3d20 2473 7472  f (null === $str
-00030190: 6561 6d6f 6b29 207b 0a20 2020 2020 2020  eamok) {.       
-000301a0: 2020 2020 2024 7374 7265 616d 6f6b 203d       $streamok =
-000301b0: 2066 756e 6374 696f 6e5f 6578 6973 7473   function_exists
-000301c0: 2827 7374 7265 616d 5f73 6f63 6b65 745f  ('stream_socket_
-000301d0: 636c 6965 6e74 2729 3b0a 2020 2020 2020  client');.      
-000301e0: 2020 7d0a 0a20 2020 2020 2020 2024 6572    }..        $er
-000301f0: 726e 6f20 3d20 303b 0a20 2020 2020 2020  rno = 0;.       
-00030200: 2024 6572 7273 7472 203d 2027 273b 0a20   $errstr = '';. 
-00030210: 2020 2020 2020 2069 6620 2824 7374 7265         if ($stre
-00030220: 616d 6f6b 2920 7b0a 2020 2020 2020 2020  amok) {.        
-00030230: 2020 2020 2473 6f63 6b65 745f 636f 6e74      $socket_cont
-00030240: 6578 7420 3d20 7374 7265 616d 5f63 6f6e  ext = stream_con
-00030250: 7465 7874 5f63 7265 6174 6528 246f 7074  text_create($opt
-00030260: 696f 6e73 293b 0a20 2020 2020 2020 2020  ions);.         
-00030270: 2020 2073 6574 5f65 7272 6f72 5f68 616e     set_error_han
-00030280: 646c 6572 285b 2474 6869 732c 2027 6572  dler([$this, 'er
-00030290: 726f 7248 616e 646c 6572 275d 293b 0a20  rorHandler']);. 
-000302a0: 2020 2020 2020 2020 2020 2024 636f 6e6e             $conn
-000302b0: 6563 7469 6f6e 203d 2073 7472 6561 6d5f  ection = stream_
-000302c0: 736f 636b 6574 5f63 6c69 656e 7428 0a20  socket_client(. 
-000302d0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-000302e0: 686f 7374 202e 2027 3a27 202e 2024 706f  host . ':' . $po
-000302f0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-00030300: 2020 2020 2465 7272 6e6f 2c0a 2020 2020      $errno,.    
-00030310: 2020 2020 2020 2020 2020 2020 2465 7272              $err
-00030320: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
-00030330: 2020 2020 2024 7469 6d65 6f75 742c 0a20       $timeout,. 
-00030340: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-00030350: 5452 4541 4d5f 434c 4945 4e54 5f43 4f4e  TREAM_CLIENT_CON
-00030360: 4e45 4354 2c0a 2020 2020 2020 2020 2020  NECT,.          
-00030370: 2020 2020 2020 2473 6f63 6b65 745f 636f        $socket_co
-00030380: 6e74 6578 740a 2020 2020 2020 2020 2020  ntext.          
-00030390: 2020 293b 0a20 2020 2020 2020 207d 2065    );.        } e
-000303a0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-000303b0: 2020 2f2f 4661 6c6c 2062 6163 6b20 746f    //Fall back to
-000303c0: 2066 736f 636b 6f70 656e 2077 6869 6368   fsockopen which
-000303d0: 2073 686f 756c 6420 776f 726b 2069 6e20   should work in 
-000303e0: 6d6f 7265 2070 6c61 6365 732c 2062 7574  more places, but
-000303f0: 2069 7320 6d69 7373 696e 6720 736f 6d65   is missing some
-00030400: 2066 6561 7475 7265 730a 2020 2020 2020   features.      
-00030410: 2020 2020 2020 2474 6869 732d 3e65 6465        $this->ede
-00030420: 6275 6728 0a20 2020 2020 2020 2020 2020  bug(.           
-00030430: 2020 2020 2027 436f 6e6e 6563 7469 6f6e       'Connection
-00030440: 3a20 7374 7265 616d 5f73 6f63 6b65 745f  : stream_socket_
-00030450: 636c 6965 6e74 206e 6f74 2061 7661 696c  client not avail
-00030460: 6162 6c65 2c20 6661 6c6c 696e 6720 6261  able, falling ba
-00030470: 636b 2074 6f20 6673 6f63 6b6f 7065 6e27  ck to fsockopen'
-00030480: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00030490: 2020 7365 6c66 3a3a 4445 4255 475f 434f    self::DEBUG_CO
-000304a0: 4e4e 4543 5449 4f4e 0a20 2020 2020 2020  NNECTION.       
-000304b0: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-000304c0: 2020 2020 7365 745f 6572 726f 725f 6861      set_error_ha
-000304d0: 6e64 6c65 7228 5b24 7468 6973 2c20 2765  ndler([$this, 'e
-000304e0: 7272 6f72 4861 6e64 6c65 7227 5d29 3b0a  rrorHandler']);.
-000304f0: 2020 2020 2020 2020 2020 2020 2463 6f6e              $con
-00030500: 6e65 6374 696f 6e20 3d20 6673 6f63 6b6f  nection = fsocko
-00030510: 7065 6e28 0a20 2020 2020 2020 2020 2020  pen(.           
-00030520: 2020 2020 2024 686f 7374 2c0a 2020 2020       $host,.    
-00030530: 2020 2020 2020 2020 2020 2020 2470 6f72              $por
-00030540: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00030550: 2020 2024 6572 726e 6f2c 0a20 2020 2020     $errno,.     
-00030560: 2020 2020 2020 2020 2020 2024 6572 7273             $errs
-00030570: 7472 2c0a 2020 2020 2020 2020 2020 2020  tr,.            
-00030580: 2020 2020 2474 696d 656f 7574 0a20 2020      $timeout.   
-00030590: 2020 2020 2020 2020 2029 3b0a 2020 2020           );.    
-000305a0: 2020 2020 7d0a 2020 2020 2020 2020 7265      }.        re
-000305b0: 7374 6f72 655f 6572 726f 725f 6861 6e64  store_error_hand
-000305c0: 6c65 7228 293b 0a0a 2020 2020 2020 2020  ler();..        
-000305d0: 2f2f 5665 7269 6679 2077 6520 636f 6e6e  //Verify we conn
-000305e0: 6563 7465 6420 7072 6f70 6572 6c79 0a20  ected properly. 
-000305f0: 2020 2020 2020 2069 6620 2821 6973 5f72         if (!is_r
-00030600: 6573 6f75 7263 6528 2463 6f6e 6e65 6374  esource($connect
-00030610: 696f 6e29 2920 7b0a 2020 2020 2020 2020  ion)) {.        
-00030620: 2020 2020 2474 6869 732d 3e73 6574 4572      $this->setEr
-00030630: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00030640: 2020 2020 2027 4661 696c 6564 2074 6f20       'Failed to 
-00030650: 636f 6e6e 6563 7420 746f 2073 6572 7665  connect to serve
-00030660: 7227 2c0a 2020 2020 2020 2020 2020 2020  r',.            
-00030670: 2020 2020 2727 2c0a 2020 2020 2020 2020      '',.        
-00030680: 2020 2020 2020 2020 2873 7472 696e 6729          (string)
-00030690: 2024 6572 726e 6f2c 0a20 2020 2020 2020   $errno,.       
-000306a0: 2020 2020 2020 2020 2024 6572 7273 7472           $errstr
-000306b0: 0a20 2020 2020 2020 2020 2020 2029 3b0a  .            );.
-000306c0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-000306d0: 732d 3e65 6465 6275 6728 0a20 2020 2020  s->edebug(.     
-000306e0: 2020 2020 2020 2020 2020 2027 534d 5450             'SMTP
-000306f0: 2045 5252 4f52 3a20 2720 2e20 2474 6869   ERROR: ' . $thi
-00030700: 732d 3e65 7272 6f72 5b27 6572 726f 7227  s->error['error'
-00030710: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00030720: 2020 2e20 223a 2024 6572 7273 7472 2028    . ": $errstr (
-00030730: 2465 7272 6e6f 2922 2c0a 2020 2020 2020  $errno)",.      
-00030740: 2020 2020 2020 2020 2020 7365 6c66 3a3a            self::
-00030750: 4445 4255 475f 434c 4945 4e54 0a20 2020  DEBUG_CLIENT.   
-00030760: 2020 2020 2020 2020 2029 3b0a 0a20 2020           );..   
-00030770: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00030780: 6661 6c73 653b 0a20 2020 2020 2020 207d  false;.        }
-00030790: 0a0a 2020 2020 2020 2020 2f2f 534d 5450  ..        //SMTP
-000307a0: 2073 6572 7665 7220 6361 6e20 7461 6b65   server can take
-000307b0: 206c 6f6e 6765 7220 746f 2072 6573 706f   longer to respo
-000307c0: 6e64 2c20 6769 7665 206c 6f6e 6765 7220  nd, give longer 
-000307d0: 7469 6d65 6f75 7420 666f 7220 6669 7273  timeout for firs
-000307e0: 7420 7265 6164 0a20 2020 2020 2020 202f  t read.        /
-000307f0: 2f57 696e 646f 7773 2064 6f65 7320 6e6f  /Windows does no
-00030800: 7420 6861 7665 2073 7570 706f 7274 2066  t have support f
-00030810: 6f72 2074 6869 7320 7469 6d65 6f75 7420  or this timeout 
-00030820: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00030830: 2069 6620 2873 7472 706f 7328 5048 505f   if (strpos(PHP_
-00030840: 4f53 2c20 2757 494e 2729 2021 3d3d 2030  OS, 'WIN') !== 0
-00030850: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00030860: 246d 6178 203d 2028 696e 7429 696e 695f  $max = (int)ini_
-00030870: 6765 7428 276d 6178 5f65 7865 6375 7469  get('max_executi
-00030880: 6f6e 5f74 696d 6527 293b 0a20 2020 2020  on_time');.     
-00030890: 2020 2020 2020 202f 2f44 6f6e 2774 2062         //Don't b
-000308a0: 6f74 6865 7220 6966 2075 6e6c 696d 6974  other if unlimit
-000308b0: 6564 2c20 6f72 2069 6620 7365 745f 7469  ed, or if set_ti
-000308c0: 6d65 5f6c 696d 6974 2069 7320 6469 7361  me_limit is disa
-000308d0: 626c 6564 0a20 2020 2020 2020 2020 2020  bled.           
-000308e0: 2069 6620 2830 2021 3d3d 2024 6d61 7820   if (0 !== $max 
-000308f0: 2626 2024 7469 6d65 6f75 7420 3e20 246d  && $timeout > $m
-00030900: 6178 2026 2620 7374 7270 6f73 2869 6e69  ax && strpos(ini
-00030910: 5f67 6574 2827 6469 7361 626c 655f 6675  _get('disable_fu
-00030920: 6e63 7469 6f6e 7327 292c 2027 7365 745f  nctions'), 'set_
-00030930: 7469 6d65 5f6c 696d 6974 2729 203d 3d3d  time_limit') ===
-00030940: 2066 616c 7365 2920 7b0a 2020 2020 2020   false) {.      
-00030950: 2020 2020 2020 2020 2020 4073 6574 5f74            @set_t
-00030960: 696d 655f 6c69 6d69 7428 2474 696d 656f  ime_limit($timeo
-00030970: 7574 293b 0a20 2020 2020 2020 2020 2020  ut);.           
-00030980: 207d 0a20 2020 2020 2020 2020 2020 2073   }.            s
-00030990: 7472 6561 6d5f 7365 745f 7469 6d65 6f75  tream_set_timeou
-000309a0: 7428 2463 6f6e 6e65 6374 696f 6e2c 2024  t($connection, $
-000309b0: 7469 6d65 6f75 742c 2030 293b 0a20 2020  timeout, 0);.   
-000309c0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-000309d0: 7265 7475 726e 2024 636f 6e6e 6563 7469  return $connecti
-000309e0: 6f6e 3b0a 2020 2020 7d0a 0a20 2020 202f  on;.    }..    /
-000309f0: 2a2a 0a20 2020 2020 2a20 496e 6974 6961  **.     * Initia
-00030a00: 7465 2061 2054 4c53 2028 656e 6372 7970  te a TLS (encryp
-00030a10: 7465 6429 2073 6573 7369 6f6e 2e0a 2020  ted) session..  
-00030a20: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
-00030a30: 7572 6e20 626f 6f6c 0a20 2020 2020 2a2f  urn bool.     */
-00030a40: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00030a50: 7469 6f6e 2073 7461 7274 544c 5328 290a  tion startTLS().
-00030a60: 2020 2020 7b0a 2020 2020 2020 2020 6966      {.        if
-00030a70: 2028 2124 7468 6973 2d3e 7365 6e64 436f   (!$this->sendCo
-00030a80: 6d6d 616e 6428 2753 5441 5254 544c 5327  mmand('STARTTLS'
-00030a90: 2c20 2753 5441 5254 544c 5327 2c20 3232  , 'STARTTLS', 22
-00030aa0: 3029 2920 7b0a 2020 2020 2020 2020 2020  0)) {.          
-00030ab0: 2020 7265 7475 726e 2066 616c 7365 3b0a    return false;.
-00030ac0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00030ad0: 2020 202f 2f41 6c6c 6f77 2074 6865 2062     //Allow the b
-00030ae0: 6573 7420 544c 5320 7665 7273 696f 6e28  est TLS version(
-00030af0: 7329 2077 6520 6361 6e0a 2020 2020 2020  s) we can.      
-00030b00: 2020 2463 7279 7074 6f5f 6d65 7468 6f64    $crypto_method
-00030b10: 203d 2053 5452 4541 4d5f 4352 5950 544f   = STREAM_CRYPTO
-00030b20: 5f4d 4554 484f 445f 544c 535f 434c 4945  _METHOD_TLS_CLIE
-00030b30: 4e54 3b0a 0a20 2020 2020 2020 202f 2f50  NT;..        //P
-00030b40: 4850 2035 2e36 2e37 2064 726f 7070 6564  HP 5.6.7 dropped
-00030b50: 2069 6e63 6c75 7369 6f6e 206f 6620 544c   inclusion of TL
-00030b60: 5320 312e 3120 616e 6420 312e 3220 696e  S 1.1 and 1.2 in
-00030b70: 2053 5452 4541 4d5f 4352 5950 544f 5f4d   STREAM_CRYPTO_M
-00030b80: 4554 484f 445f 544c 535f 434c 4945 4e54  ETHOD_TLS_CLIENT
-00030b90: 0a20 2020 2020 2020 202f 2f73 6f20 6164  .        //so ad
-00030ba0: 6420 7468 656d 2062 6163 6b20 696e 206d  d them back in m
-00030bb0: 616e 7561 6c6c 7920 6966 2077 6520 6361  anually if we ca
-00030bc0: 6e0a 2020 2020 2020 2020 6966 2028 6465  n.        if (de
-00030bd0: 6669 6e65 6428 2753 5452 4541 4d5f 4352  fined('STREAM_CR
-00030be0: 5950 544f 5f4d 4554 484f 445f 544c 5376  YPTO_METHOD_TLSv
-00030bf0: 315f 325f 434c 4945 4e54 2729 2920 7b0a  1_2_CLIENT')) {.
-00030c00: 2020 2020 2020 2020 2020 2020 2463 7279              $cry
-00030c10: 7074 6f5f 6d65 7468 6f64 207c 3d20 5354  pto_method |= ST
-00030c20: 5245 414d 5f43 5259 5054 4f5f 4d45 5448  REAM_CRYPTO_METH
-00030c30: 4f44 5f54 4c53 7631 5f32 5f43 4c49 454e  OD_TLSv1_2_CLIEN
-00030c40: 543b 0a20 2020 2020 2020 2020 2020 2024  T;.            $
-00030c50: 6372 7970 746f 5f6d 6574 686f 6420 7c3d  crypto_method |=
-00030c60: 2053 5452 4541 4d5f 4352 5950 544f 5f4d   STREAM_CRYPTO_M
-00030c70: 4554 484f 445f 544c 5376 315f 315f 434c  ETHOD_TLSv1_1_CL
-00030c80: 4945 4e54 3b0a 2020 2020 2020 2020 7d0a  IENT;.        }.
-00030c90: 0a20 2020 2020 2020 202f 2f42 6567 696e  .        //Begin
-00030ca0: 2065 6e63 7279 7074 6564 2063 6f6e 6e65   encrypted conne
-00030cb0: 6374 696f 6e0a 2020 2020 2020 2020 7365  ction.        se
-00030cc0: 745f 6572 726f 725f 6861 6e64 6c65 7228  t_error_handler(
-00030cd0: 5b24 7468 6973 2c20 2765 7272 6f72 4861  [$this, 'errorHa
-00030ce0: 6e64 6c65 7227 5d29 3b0a 2020 2020 2020  ndler']);.      
-00030cf0: 2020 2463 7279 7074 6f5f 6f6b 203d 2073    $crypto_ok = s
-00030d00: 7472 6561 6d5f 736f 636b 6574 5f65 6e61  tream_socket_ena
-00030d10: 626c 655f 6372 7970 746f 280a 2020 2020  ble_crypto(.    
-00030d20: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
-00030d30: 6d74 705f 636f 6e6e 2c0a 2020 2020 2020  mtp_conn,.      
-00030d40: 2020 2020 2020 7472 7565 2c0a 2020 2020        true,.    
-00030d50: 2020 2020 2020 2020 2463 7279 7074 6f5f          $crypto_
-00030d60: 6d65 7468 6f64 0a20 2020 2020 2020 2029  method.        )
-00030d70: 3b0a 2020 2020 2020 2020 7265 7374 6f72  ;.        restor
-00030d80: 655f 6572 726f 725f 6861 6e64 6c65 7228  e_error_handler(
-00030d90: 293b 0a0a 2020 2020 2020 2020 7265 7475  );..        retu
-00030da0: 726e 2028 626f 6f6c 2920 2463 7279 7074  rn (bool) $crypt
-00030db0: 6f5f 6f6b 3b0a 2020 2020 7d0a 0a20 2020  o_ok;.    }..   
-00030dc0: 202f 2a2a 0a20 2020 2020 2a20 5065 7266   /**.     * Perf
-00030dd0: 6f72 6d20 534d 5450 2061 7574 6865 6e74  orm SMTP authent
-00030de0: 6963 6174 696f 6e2e 0a20 2020 2020 2a20  ication..     * 
-00030df0: 4d75 7374 2062 6520 7275 6e20 6166 7465  Must be run afte
-00030e00: 7220 6865 6c6c 6f28 292e 0a20 2020 2020  r hello()..     
-00030e10: 2a0a 2020 2020 202a 2040 7365 6520 2020  *.     * @see   
-00030e20: 2068 656c 6c6f 2829 0a20 2020 2020 2a0a   hello().     *.
-00030e30: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-00030e40: 7269 6e67 2024 7573 6572 6e61 6d65 2054  ring $username T
-00030e50: 6865 2075 7365 7220 6e61 6d65 0a20 2020  he user name.   
-00030e60: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
-00030e70: 6720 2470 6173 7377 6f72 6420 5468 6520  g $password The 
-00030e80: 7061 7373 776f 7264 0a20 2020 2020 2a20  password.     * 
-00030e90: 4070 6172 616d 2073 7472 696e 6720 2461  @param string $a
-00030ea0: 7574 6874 7970 6520 5468 6520 6175 7468  uthtype The auth
-00030eb0: 2074 7970 6520 2843 5241 4d2d 4d44 352c   type (CRAM-MD5,
-00030ec0: 2050 4c41 494e 2c20 4c4f 4749 4e2c 2058   PLAIN, LOGIN, X
-00030ed0: 4f41 5554 4832 290a 2020 2020 202a 2040  OAUTH2).     * @
-00030ee0: 7061 7261 6d20 4f41 7574 6854 6f6b 656e  param OAuthToken
-00030ef0: 5072 6f76 6964 6572 2024 4f41 7574 6820  Provider $OAuth 
-00030f00: 416e 206f 7074 696f 6e61 6c20 4f41 7574  An optional OAut
-00030f10: 6854 6f6b 656e 5072 6f76 6964 6572 2069  hTokenProvider i
-00030f20: 6e73 7461 6e63 6520 666f 7220 584f 4155  nstance for XOAU
-00030f30: 5448 3220 6175 7468 656e 7469 6361 7469  TH2 authenticati
-00030f40: 6f6e 0a20 2020 2020 2a0a 2020 2020 202a  on.     *.     *
-00030f50: 2040 7265 7475 726e 2062 6f6f 6c20 5472   @return bool Tr
-00030f60: 7565 2069 6620 7375 6363 6573 7366 756c  ue if successful
-00030f70: 6c79 2061 7574 6865 6e74 6963 6174 6564  ly authenticated
-00030f80: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00030f90: 6c69 6320 6675 6e63 7469 6f6e 2061 7574  lic function aut
-00030fa0: 6865 6e74 6963 6174 6528 0a20 2020 2020  henticate(.     
-00030fb0: 2020 2024 7573 6572 6e61 6d65 2c0a 2020     $username,.  
-00030fc0: 2020 2020 2020 2470 6173 7377 6f72 642c        $password,
-00030fd0: 0a20 2020 2020 2020 2024 6175 7468 7479  .        $authty
-00030fe0: 7065 203d 206e 756c 6c2c 0a20 2020 2020  pe = null,.     
-00030ff0: 2020 2024 4f41 7574 6820 3d20 6e75 6c6c     $OAuth = null
-00031000: 0a20 2020 2029 207b 0a20 2020 2020 2020  .    ) {.       
-00031010: 2069 6620 2821 2474 6869 732d 3e73 6572   if (!$this->ser
-00031020: 7665 725f 6361 7073 2920 7b0a 2020 2020  ver_caps) {.    
-00031030: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
-00031040: 6574 4572 726f 7228 2741 7574 6865 6e74  etError('Authent
-00031050: 6963 6174 696f 6e20 6973 206e 6f74 2061  ication is not a
-00031060: 6c6c 6f77 6564 2062 6566 6f72 6520 4845  llowed before HE
-00031070: 4c4f 2f45 484c 4f27 293b 0a0a 2020 2020  LO/EHLO');..    
-00031080: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00031090: 616c 7365 3b0a 2020 2020 2020 2020 7d0a  alse;.        }.
-000310a0: 0a20 2020 2020 2020 2069 6620 2861 7272  .        if (arr
-000310b0: 6179 5f6b 6579 5f65 7869 7374 7328 2745  ay_key_exists('E
-000310c0: 484c 4f27 2c20 2474 6869 732d 3e73 6572  HLO', $this->ser
-000310d0: 7665 725f 6361 7073 2929 207b 0a20 2020  ver_caps)) {.   
-000310e0: 2020 2020 2020 2020 202f 2f53 4d54 5020           //SMTP 
-000310f0: 6578 7465 6e73 696f 6e73 2061 7265 2061  extensions are a
-00031100: 7661 696c 6162 6c65 3b20 7472 7920 746f  vailable; try to
-00031110: 2066 696e 6420 6120 7072 6f70 6572 2061   find a proper a
-00031120: 7574 6865 6e74 6963 6174 696f 6e20 6d65  uthentication me
-00031130: 7468 6f64 0a20 2020 2020 2020 2020 2020  thod.           
-00031140: 2069 6620 2821 6172 7261 795f 6b65 795f   if (!array_key_
-00031150: 6578 6973 7473 2827 4155 5448 272c 2024  exists('AUTH', $
-00031160: 7468 6973 2d3e 7365 7276 6572 5f63 6170  this->server_cap
-00031170: 7329 2920 7b0a 2020 2020 2020 2020 2020  s)) {.          
-00031180: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
-00031190: 4572 726f 7228 2741 7574 6865 6e74 6963  Error('Authentic
-000311a0: 6174 696f 6e20 6973 206e 6f74 2061 6c6c  ation is not all
-000311b0: 6f77 6564 2061 7420 7468 6973 2073 7461  owed at this sta
-000311c0: 6765 2729 3b0a 2020 2020 2020 2020 2020  ge');.          
-000311d0: 2020 2020 2020 2f2f 2761 7420 7468 6973        //'at this
-000311e0: 2073 7461 6765 2720 6d65 616e 7320 7468   stage' means th
-000311f0: 6174 2061 7574 6820 6d61 7920 6265 2061  at auth may be a
-00031200: 6c6c 6f77 6564 2061 6674 6572 2074 6865  llowed after the
-00031210: 2073 7461 6765 2063 6861 6e67 6573 0a20   stage changes. 
-00031220: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00031230: 2f65 2e67 2e20 6166 7465 7220 5354 4152  /e.g. after STAR
-00031240: 5454 4c53 0a0a 2020 2020 2020 2020 2020  TTLS..          
-00031250: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
-00031260: 7365 3b0a 2020 2020 2020 2020 2020 2020  se;.            
-00031270: 7d0a 0a20 2020 2020 2020 2020 2020 2024  }..            $
-00031280: 7468 6973 2d3e 6564 6562 7567 2827 4175  this->edebug('Au
-00031290: 7468 206d 6574 686f 6420 7265 7175 6573  th method reques
-000312a0: 7465 643a 2027 202e 2028 2461 7574 6874  ted: ' . ($autht
-000312b0: 7970 6520 3f3a 2027 554e 5350 4543 4946  ype ?: 'UNSPECIF
-000312c0: 4945 4427 292c 2073 656c 663a 3a44 4542  IED'), self::DEB
-000312d0: 5547 5f4c 4f57 4c45 5645 4c29 3b0a 2020  UG_LOWLEVEL);.  
-000312e0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-000312f0: 3e65 6465 6275 6728 0a20 2020 2020 2020  >edebug(.       
-00031300: 2020 2020 2020 2020 2027 4175 7468 206d           'Auth m
-00031310: 6574 686f 6473 2061 7661 696c 6162 6c65  ethods available
-00031320: 206f 6e20 7468 6520 7365 7276 6572 3a20   on the server: 
-00031330: 2720 2e20 696d 706c 6f64 6528 272c 272c  ' . implode(',',
-00031340: 2024 7468 6973 2d3e 7365 7276 6572 5f63   $this->server_c
-00031350: 6170 735b 2741 5554 4827 5d29 2c0a 2020  aps['AUTH']),.  
-00031360: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00031370: 6c66 3a3a 4445 4255 475f 4c4f 574c 4556  lf::DEBUG_LOWLEV
-00031380: 454c 0a20 2020 2020 2020 2020 2020 2029  EL.            )
-00031390: 3b0a 0a20 2020 2020 2020 2020 2020 202f  ;..            /
-000313a0: 2f49 6620 7765 2068 6176 6520 7265 7175  /If we have requ
-000313b0: 6573 7465 6420 6120 7370 6563 6966 6963  ested a specific
-000313c0: 2061 7574 6820 7479 7065 2c20 6368 6563   auth type, chec
-000313d0: 6b20 7468 6520 7365 7276 6572 2073 7570  k the server sup
-000313e0: 706f 7274 7320 6974 2062 6566 6f72 6520  ports it before 
-000313f0: 7472 7969 6e67 206f 7468 6572 730a 2020  trying others.  
-00031400: 2020 2020 2020 2020 2020 6966 2028 6e75            if (nu
-00031410: 6c6c 2021 3d3d 2024 6175 7468 7479 7065  ll !== $authtype
-00031420: 2026 2620 2169 6e5f 6172 7261 7928 2461   && !in_array($a
-00031430: 7574 6874 7970 652c 2024 7468 6973 2d3e  uthtype, $this->
-00031440: 7365 7276 6572 5f63 6170 735b 2741 5554  server_caps['AUT
-00031450: 4827 5d2c 2074 7275 6529 2920 7b0a 2020  H'], true)) {.  
-00031460: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-00031470: 6869 732d 3e65 6465 6275 6728 2752 6571  his->edebug('Req
-00031480: 7565 7374 6564 2061 7574 6820 6d65 7468  uested auth meth
-00031490: 6f64 206e 6f74 2061 7661 696c 6162 6c65  od not available
-000314a0: 3a20 2720 2e20 2461 7574 6874 7970 652c  : ' . $authtype,
-000314b0: 2073 656c 663a 3a44 4542 5547 5f4c 4f57   self::DEBUG_LOW
-000314c0: 4c45 5645 4c29 3b0a 2020 2020 2020 2020  LEVEL);.        
-000314d0: 2020 2020 2020 2020 2461 7574 6874 7970          $authtyp
-000314e0: 6520 3d20 6e75 6c6c 3b0a 2020 2020 2020  e = null;.      
-000314f0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00031500: 2020 2020 2069 6620 2865 6d70 7479 2824       if (empty($
-00031510: 6175 7468 7479 7065 2929 207b 0a20 2020  authtype)) {.   
-00031520: 2020 2020 2020 2020 2020 2020 202f 2f49               //I
-00031530: 6620 6e6f 2061 7574 6820 6d65 6368 616e  f no auth mechan
-00031540: 6973 6d20 6973 2073 7065 6369 6669 6564  ism is specified
-00031550: 2c20 6174 7465 6d70 7420 746f 2075 7365  , attempt to use
-00031560: 2074 6865 7365 2c20 696e 2074 6869 7320   these, in this 
-00031570: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
-00031580: 2020 2020 2020 2f2f 5472 7920 4352 414d        //Try CRAM
-00031590: 2d4d 4435 2066 6972 7374 2061 7320 6974  -MD5 first as it
-000315a0: 2773 206d 6f72 6520 7365 6375 7265 2074  's more secure t
-000315b0: 6861 6e20 7468 6520 6f74 6865 7273 0a20  han the others. 
-000315c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000315d0: 6f72 6561 6368 2028 5b27 4352 414d 2d4d  oreach (['CRAM-M
-000315e0: 4435 272c 2027 4c4f 4749 4e27 2c20 2750  D5', 'LOGIN', 'P
-000315f0: 4c41 494e 272c 2027 584f 4155 5448 3227  LAIN', 'XOAUTH2'
-00031600: 5d20 6173 2024 6d65 7468 6f64 2920 7b0a  ] as $method) {.
-00031610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031620: 2020 2020 6966 2028 696e 5f61 7272 6179      if (in_array
-00031630: 2824 6d65 7468 6f64 2c20 2474 6869 732d  ($method, $this-
-00031640: 3e73 6572 7665 725f 6361 7073 5b27 4155  >server_caps['AU
-00031650: 5448 275d 2c20 7472 7565 2929 207b 0a20  TH'], true)) {. 
-00031660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031670: 2020 2020 2020 2024 6175 7468 7479 7065         $authtype
-00031680: 203d 2024 6d65 7468 6f64 3b0a 2020 2020   = $method;.    
-00031690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000316a0: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
-000316b0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000316c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000316d0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-000316e0: 2020 2069 6620 2865 6d70 7479 2824 6175     if (empty($au
-000316f0: 7468 7479 7065 2929 207b 0a20 2020 2020  thtype)) {.     
-00031700: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00031710: 7468 6973 2d3e 7365 7445 7272 6f72 2827  this->setError('
-00031720: 4e6f 2073 7570 706f 7274 6564 2061 7574  No supported aut
-00031730: 6865 6e74 6963 6174 696f 6e20 6d65 7468  hentication meth
-00031740: 6f64 7320 666f 756e 6427 293b 0a0a 2020  ods found');..  
-00031750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031760: 2020 7265 7475 726e 2066 616c 7365 3b0a    return false;.
-00031770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031780: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00031790: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
-000317a0: 2741 7574 6820 6d65 7468 6f64 2073 656c  'Auth method sel
-000317b0: 6563 7465 643a 2027 202e 2024 6175 7468  ected: ' . $auth
-000317c0: 7479 7065 2c20 7365 6c66 3a3a 4445 4255  type, self::DEBU
-000317d0: 475f 4c4f 574c 4556 454c 293b 0a20 2020  G_LOWLEVEL);.   
-000317e0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-000317f0: 2020 2020 2020 2020 6966 2028 2169 6e5f          if (!in_
-00031800: 6172 7261 7928 2461 7574 6874 7970 652c  array($authtype,
-00031810: 2024 7468 6973 2d3e 7365 7276 6572 5f63   $this->server_c
-00031820: 6170 735b 2741 5554 4827 5d2c 2074 7275  aps['AUTH'], tru
-00031830: 6529 2920 7b0a 2020 2020 2020 2020 2020  e)) {.          
-00031840: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
-00031850: 4572 726f 7228 2254 6865 2072 6571 7565  Error("The reque
-00031860: 7374 6564 2061 7574 6865 6e74 6963 6174  sted authenticat
-00031870: 696f 6e20 6d65 7468 6f64 205c 2224 6175  ion method \"$au
-00031880: 7468 7479 7065 5c22 2069 7320 6e6f 7420  thtype\" is not 
-00031890: 7375 7070 6f72 7465 6420 6279 2074 6865  supported by the
-000318a0: 2073 6572 7665 7222 293b 0a0a 2020 2020   server");..    
-000318b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000318c0: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
-000318d0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000318e0: 7d20 656c 7365 6966 2028 656d 7074 7928  } elseif (empty(
-000318f0: 2461 7574 6874 7970 6529 2920 7b0a 2020  $authtype)) {.  
-00031900: 2020 2020 2020 2020 2020 2461 7574 6874            $autht
-00031910: 7970 6520 3d20 274c 4f47 494e 273b 0a20  ype = 'LOGIN';. 
-00031920: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00031930: 2073 7769 7463 6820 2824 6175 7468 7479   switch ($authty
-00031940: 7065 2920 7b0a 2020 2020 2020 2020 2020  pe) {.          
-00031950: 2020 6361 7365 2027 504c 4149 4e27 3a0a    case 'PLAIN':.
-00031960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031970: 2f2f 5374 6172 7420 6175 7468 656e 7469  //Start authenti
-00031980: 6361 7469 6f6e 0a20 2020 2020 2020 2020  cation.         
-00031990: 2020 2020 2020 2069 6620 2821 2474 6869         if (!$thi
-000319a0: 732d 3e73 656e 6443 6f6d 6d61 6e64 2827  s->sendCommand('
-000319b0: 4155 5448 272c 2027 4155 5448 2050 4c41  AUTH', 'AUTH PLA
-000319c0: 494e 272c 2033 3334 2929 207b 0a20 2020  IN', 334)) {.   
-000319d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000319e0: 2072 6574 7572 6e20 6661 6c73 653b 0a20   return false;. 
-000319f0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00031a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031a10: 202f 2f53 656e 6420 656e 636f 6465 6420   //Send encoded 
-00031a20: 7573 6572 6e61 6d65 2061 6e64 2070 6173  username and pas
-00031a30: 7377 6f72 640a 2020 2020 2020 2020 2020  sword.          
-00031a40: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00031a50: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00031a60: 2f46 6f72 6d61 7420 6672 6f6d 2068 7474  /Format from htt
-00031a70: 7073 3a2f 2f74 6f6f 6c73 2e69 6574 662e  ps://tools.ietf.
-00031a80: 6f72 672f 6874 6d6c 2f72 6663 3436 3136  org/html/rfc4616
-00031a90: 2373 6563 7469 6f6e 2d32 0a20 2020 2020  #section-2.     
-00031aa0: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00031ab0: 2f57 6520 736b 6970 2074 6865 2066 6972  /We skip the fir
-00031ac0: 7374 2066 6965 6c64 2028 6974 2773 2066  st field (it's f
-00031ad0: 6f72 6765 7279 292c 2073 6f20 7468 6520  orgery), so the 
-00031ae0: 7374 7269 6e67 2073 7461 7274 7320 7769  string starts wi
-00031af0: 7468 2061 206e 756c 6c20 6279 7465 0a20  th a null byte. 
-00031b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031b10: 2020 2021 2474 6869 732d 3e73 656e 6443     !$this->sendC
-00031b20: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
-00031b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031b40: 2755 7365 7220 2620 5061 7373 776f 7264  'User & Password
-00031b50: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00031b60: 2020 2020 2020 2020 2020 2062 6173 6536             base6
-00031b70: 345f 656e 636f 6465 2822 5c30 2220 2e20  4_encode("\0" . 
-00031b80: 2475 7365 726e 616d 6520 2e20 225c 3022  $username . "\0"
-00031b90: 202e 2024 7061 7373 776f 7264 292c 0a20   . $password),. 
-00031ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031bb0: 2020 2020 2020 2032 3335 0a20 2020 2020         235.     
-00031bc0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00031bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031be0: 2029 207b 0a20 2020 2020 2020 2020 2020   ) {.           
-00031bf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00031c00: 6661 6c73 653b 0a20 2020 2020 2020 2020  false;.         
-00031c10: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00031c20: 2020 2020 2020 2020 2062 7265 616b 3b0a           break;.
-00031c30: 2020 2020 2020 2020 2020 2020 6361 7365              case
-00031c40: 2027 4c4f 4749 4e27 3a0a 2020 2020 2020   'LOGIN':.      
-00031c50: 2020 2020 2020 2020 2020 2f2f 5374 6172            //Star
-00031c60: 7420 6175 7468 656e 7469 6361 7469 6f6e  t authentication
-00031c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031c80: 2069 6620 2821 2474 6869 732d 3e73 656e   if (!$this->sen
-00031c90: 6443 6f6d 6d61 6e64 2827 4155 5448 272c  dCommand('AUTH',
-00031ca0: 2027 4155 5448 204c 4f47 494e 272c 2033   'AUTH LOGIN', 3
-00031cb0: 3334 2929 207b 0a20 2020 2020 2020 2020  34)) {.         
-00031cc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00031cd0: 6e20 6661 6c73 653b 0a20 2020 2020 2020  n false;.       
-00031ce0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00031cf0: 2020 2020 2020 2020 2020 2069 6620 2821             if (!
-00031d00: 2474 6869 732d 3e73 656e 6443 6f6d 6d61  $this->sendComma
-00031d10: 6e64 2827 5573 6572 6e61 6d65 272c 2062  nd('Username', b
-00031d20: 6173 6536 345f 656e 636f 6465 2824 7573  ase64_encode($us
-00031d30: 6572 6e61 6d65 292c 2033 3334 2929 207b  ername), 334)) {
-00031d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031d50: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
-00031d60: 653b 0a20 2020 2020 2020 2020 2020 2020  e;.             
-00031d70: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00031d80: 2020 2020 2069 6620 2821 2474 6869 732d       if (!$this-
-00031d90: 3e73 656e 6443 6f6d 6d61 6e64 2827 5061  >sendCommand('Pa
-00031da0: 7373 776f 7264 272c 2062 6173 6536 345f  ssword', base64_
-00031db0: 656e 636f 6465 2824 7061 7373 776f 7264  encode($password
-00031dc0: 292c 2032 3335 2929 207b 0a20 2020 2020  ), 235)) {.     
-00031dd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00031de0: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
-00031df0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00031e00: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00031e10: 7265 616b 3b0a 2020 2020 2020 2020 2020  reak;.          
-00031e20: 2020 6361 7365 2027 4352 414d 2d4d 4435    case 'CRAM-MD5
-00031e30: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00031e40: 2020 202f 2f53 7461 7274 2061 7574 6865     //Start authe
-00031e50: 6e74 6963 6174 696f 6e0a 2020 2020 2020  ntication.      
-00031e60: 2020 2020 2020 2020 2020 6966 2028 2124            if (!$
-00031e70: 7468 6973 2d3e 7365 6e64 436f 6d6d 616e  this->sendComman
-00031e80: 6428 2741 5554 4820 4352 414d 2d4d 4435  d('AUTH CRAM-MD5
-00031e90: 272c 2027 4155 5448 2043 5241 4d2d 4d44  ', 'AUTH CRAM-MD
-00031ea0: 3527 2c20 3333 3429 2920 7b0a 2020 2020  5', 334)) {.    
-00031eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031ec0: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
-00031ed0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-00031ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031ef0: 2f2f 4765 7420 7468 6520 6368 616c 6c65  //Get the challe
-00031f00: 6e67 650a 2020 2020 2020 2020 2020 2020  nge.            
-00031f10: 2020 2020 2463 6861 6c6c 656e 6765 203d      $challenge =
-00031f20: 2062 6173 6536 345f 6465 636f 6465 2873   base64_decode(s
-00031f30: 7562 7374 7228 2474 6869 732d 3e6c 6173  ubstr($this->las
-00031f40: 745f 7265 706c 792c 2034 2929 3b0a 0a20  t_reply, 4));.. 
-00031f50: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00031f60: 2f42 7569 6c64 2074 6865 2072 6573 706f  /Build the respo
-00031f70: 6e73 650a 2020 2020 2020 2020 2020 2020  nse.            
-00031f80: 2020 2020 2472 6573 706f 6e73 6520 3d20      $response = 
-00031f90: 2475 7365 726e 616d 6520 2e20 2720 2720  $username . ' ' 
-00031fa0: 2e20 2474 6869 732d 3e68 6d61 6328 2463  . $this->hmac($c
-00031fb0: 6861 6c6c 656e 6765 2c20 2470 6173 7377  hallenge, $passw
-00031fc0: 6f72 6429 3b0a 0a20 2020 2020 2020 2020  ord);..         
-00031fd0: 2020 2020 2020 202f 2f73 656e 6420 656e         //send en
-00031fe0: 636f 6465 6420 6372 6564 656e 7469 616c  coded credential
-00031ff0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00032000: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
-00032010: 7365 6e64 436f 6d6d 616e 6428 2755 7365  sendCommand('Use
-00032020: 726e 616d 6527 2c20 6261 7365 3634 5f65  rname', base64_e
-00032030: 6e63 6f64 6528 2472 6573 706f 6e73 6529  ncode($response)
-00032040: 2c20 3233 3529 3b0a 2020 2020 2020 2020  , 235);.        
-00032050: 2020 2020 6361 7365 2027 584f 4155 5448      case 'XOAUTH
-00032060: 3227 3a0a 2020 2020 2020 2020 2020 2020  2':.            
-00032070: 2020 2020 2f2f 5468 6520 4f41 7574 6820      //The OAuth 
-00032080: 696e 7374 616e 6365 206d 7573 7420 6265  instance must be
-00032090: 2073 6574 2075 7020 7072 696f 7220 746f   set up prior to
-000320a0: 2072 6571 7565 7374 696e 6720 6175 7468   requesting auth
-000320b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000320c0: 2020 6966 2028 6e75 6c6c 203d 3d3d 2024    if (null === $
-000320d0: 4f41 7574 6829 207b 0a20 2020 2020 2020  OAuth) {.       
-000320e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000320f0: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
-00032100: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00032110: 2020 2020 2020 2020 2020 2020 2024 6f61               $oa
-00032120: 7574 6820 3d20 244f 4175 7468 2d3e 6765  uth = $OAuth->ge
-00032130: 744f 6175 7468 3634 2829 3b0a 0a20 2020  tOauth64();..   
-00032140: 2020 2020 2020 2020 2020 2020 202f 2f53               //S
-00032150: 7461 7274 2061 7574 6865 6e74 6963 6174  tart authenticat
-00032160: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00032170: 2020 2020 6966 2028 2124 7468 6973 2d3e      if (!$this->
-00032180: 7365 6e64 436f 6d6d 616e 6428 2741 5554  sendCommand('AUT
-00032190: 4827 2c20 2741 5554 4820 584f 4155 5448  H', 'AUTH XOAUTH
-000321a0: 3220 2720 2e20 246f 6175 7468 2c20 3233  2 ' . $oauth, 23
-000321b0: 3529 2920 7b0a 2020 2020 2020 2020 2020  5)) {.          
-000321c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000321d0: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
-000321e0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000321f0: 2020 2020 2020 2020 2020 6272 6561 6b3b            break;
-00032200: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00032210: 6175 6c74 3a0a 2020 2020 2020 2020 2020  ault:.          
-00032220: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
-00032230: 4572 726f 7228 2241 7574 6865 6e74 6963  Error("Authentic
-00032240: 6174 696f 6e20 6d65 7468 6f64 205c 2224  ation method \"$
-00032250: 6175 7468 7479 7065 5c22 2069 7320 6e6f  authtype\" is no
-00032260: 7420 7375 7070 6f72 7465 6422 293b 0a0a  t supported");..
-00032270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032280: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
-00032290: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-000322a0: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
-000322b0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-000322c0: 2020 2a20 4361 6c63 756c 6174 6520 616e    * Calculate an
-000322d0: 204d 4435 2048 4d41 4320 6861 7368 2e0a   MD5 HMAC hash..
-000322e0: 2020 2020 202a 2057 6f72 6b73 206c 696b       * Works lik
-000322f0: 6520 6861 7368 5f68 6d61 6328 276d 6435  e hash_hmac('md5
-00032300: 272c 2024 6461 7461 2c20 246b 6579 290a  ', $data, $key).
-00032310: 2020 2020 202a 2069 6e20 6361 7365 2074       * in case t
-00032320: 6861 7420 6675 6e63 7469 6f6e 2069 7320  hat function is 
-00032330: 6e6f 7420 6176 6169 6c61 626c 652e 0a20  not available.. 
-00032340: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-00032350: 7261 6d20 7374 7269 6e67 2024 6461 7461  ram string $data
-00032360: 2054 6865 2064 6174 6120 746f 2068 6173   The data to has
-00032370: 680a 2020 2020 202a 2040 7061 7261 6d20  h.     * @param 
-00032380: 7374 7269 6e67 2024 6b65 7920 2054 6865  string $key  The
-00032390: 206b 6579 2074 6f20 6861 7368 2077 6974   key to hash wit
-000323a0: 680a 2020 2020 202a 0a20 2020 2020 2a20  h.     *.     * 
-000323b0: 4072 6574 7572 6e20 7374 7269 6e67 0a20  @return string. 
-000323c0: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
-000323d0: 6374 6564 2066 756e 6374 696f 6e20 686d  cted function hm
-000323e0: 6163 2824 6461 7461 2c20 246b 6579 290a  ac($data, $key).
-000323f0: 2020 2020 7b0a 2020 2020 2020 2020 6966      {.        if
-00032400: 2028 6675 6e63 7469 6f6e 5f65 7869 7374   (function_exist
-00032410: 7328 2768 6173 685f 686d 6163 2729 2920  s('hash_hmac')) 
-00032420: 7b0a 2020 2020 2020 2020 2020 2020 7265  {.            re
-00032430: 7475 726e 2068 6173 685f 686d 6163 2827  turn hash_hmac('
-00032440: 6d64 3527 2c20 2464 6174 612c 2024 6b65  md5', $data, $ke
-00032450: 7929 3b0a 2020 2020 2020 2020 7d0a 0a20  y);.        }.. 
-00032460: 2020 2020 2020 202f 2f54 6865 2066 6f6c         //The fol
-00032470: 6c6f 7769 6e67 2062 6f72 726f 7765 6420  lowing borrowed 
-00032480: 6672 6f6d 0a20 2020 2020 2020 202f 2f68  from.        //h
-00032490: 7474 703a 2f2f 7068 702e 6e65 742f 6d61  ttp://php.net/ma
-000324a0: 6e75 616c 2f65 6e2f 6675 6e63 7469 6f6e  nual/en/function
-000324b0: 2e6d 6861 7368 2e70 6870 2332 3732 3235  .mhash.php#27225
-000324c0: 0a0a 2020 2020 2020 2020 2f2f 5246 4320  ..        //RFC 
-000324d0: 3231 3034 2048 4d41 4320 696d 706c 656d  2104 HMAC implem
-000324e0: 656e 7461 7469 6f6e 2066 6f72 2070 6870  entation for php
-000324f0: 2e0a 2020 2020 2020 2020 2f2f 4372 6561  ..        //Crea
-00032500: 7465 7320 616e 206d 6435 2048 4d41 432e  tes an md5 HMAC.
-00032510: 0a20 2020 2020 2020 202f 2f45 6c69 6d69  .        //Elimi
-00032520: 6e61 7465 7320 7468 6520 6e65 6564 2074  nates the need t
-00032530: 6f20 696e 7374 616c 6c20 6d68 6173 6820  o install mhash 
-00032540: 746f 2063 6f6d 7075 7465 2061 2048 4d41  to compute a HMA
-00032550: 430a 2020 2020 2020 2020 2f2f 6279 204c  C.        //by L
-00032560: 616e 6365 2052 7573 6869 6e67 0a0a 2020  ance Rushing..  
-00032570: 2020 2020 2020 2462 7974 656c 656e 203d        $bytelen =
-00032580: 2036 343b 202f 2f62 7974 6520 6c65 6e67   64; //byte leng
-00032590: 7468 2066 6f72 206d 6435 0a20 2020 2020  th for md5.     
-000325a0: 2020 2069 6620 2873 7472 6c65 6e28 246b     if (strlen($k
-000325b0: 6579 2920 3e20 2462 7974 656c 656e 2920  ey) > $bytelen) 
-000325c0: 7b0a 2020 2020 2020 2020 2020 2020 246b  {.            $k
-000325d0: 6579 203d 2070 6163 6b28 2748 2a27 2c20  ey = pack('H*', 
-000325e0: 6d64 3528 246b 6579 2929 3b0a 2020 2020  md5($key));.    
-000325f0: 2020 2020 7d0a 2020 2020 2020 2020 246b      }.        $k
-00032600: 6579 203d 2073 7472 5f70 6164 2824 6b65  ey = str_pad($ke
-00032610: 792c 2024 6279 7465 6c65 6e2c 2063 6872  y, $bytelen, chr
-00032620: 2830 7830 3029 293b 0a20 2020 2020 2020  (0x00));.       
-00032630: 2024 6970 6164 203d 2073 7472 5f70 6164   $ipad = str_pad
-00032640: 2827 272c 2024 6279 7465 6c65 6e2c 2063  ('', $bytelen, c
-00032650: 6872 2830 7833 3629 293b 0a20 2020 2020  hr(0x36));.     
-00032660: 2020 2024 6f70 6164 203d 2073 7472 5f70     $opad = str_p
-00032670: 6164 2827 272c 2024 6279 7465 6c65 6e2c  ad('', $bytelen,
-00032680: 2063 6872 2830 7835 6329 293b 0a20 2020   chr(0x5c));.   
-00032690: 2020 2020 2024 6b5f 6970 6164 203d 2024       $k_ipad = $
-000326a0: 6b65 7920 5e20 2469 7061 643b 0a20 2020  key ^ $ipad;.   
-000326b0: 2020 2020 2024 6b5f 6f70 6164 203d 2024       $k_opad = $
-000326c0: 6b65 7920 5e20 246f 7061 643b 0a0a 2020  key ^ $opad;..  
-000326d0: 2020 2020 2020 7265 7475 726e 206d 6435        return md5
-000326e0: 2824 6b5f 6f70 6164 202e 2070 6163 6b28  ($k_opad . pack(
-000326f0: 2748 2a27 2c20 6d64 3528 246b 5f69 7061  'H*', md5($k_ipa
-00032700: 6420 2e20 2464 6174 6129 2929 3b0a 2020  d . $data)));.  
-00032710: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00032720: 2020 2a20 4368 6563 6b20 636f 6e6e 6563    * Check connec
-00032730: 7469 6f6e 2073 7461 7465 2e0a 2020 2020  tion state..    
-00032740: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
-00032750: 6e20 626f 6f6c 2054 7275 6520 6966 2063  n bool True if c
-00032760: 6f6e 6e65 6374 6564 0a20 2020 2020 2a2f  onnected.     */
-00032770: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
-00032780: 7469 6f6e 2063 6f6e 6e65 6374 6564 2829  tion connected()
-00032790: 0a20 2020 207b 0a20 2020 2020 2020 2069  .    {.        i
-000327a0: 6620 2869 735f 7265 736f 7572 6365 2824  f (is_resource($
-000327b0: 7468 6973 2d3e 736d 7470 5f63 6f6e 6e29  this->smtp_conn)
-000327c0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-000327d0: 2473 6f63 6b5f 7374 6174 7573 203d 2073  $sock_status = s
-000327e0: 7472 6561 6d5f 6765 745f 6d65 7461 5f64  tream_get_meta_d
-000327f0: 6174 6128 2474 6869 732d 3e73 6d74 705f  ata($this->smtp_
-00032800: 636f 6e6e 293b 0a20 2020 2020 2020 2020  conn);.         
-00032810: 2020 2069 6620 2824 736f 636b 5f73 7461     if ($sock_sta
-00032820: 7475 735b 2765 6f66 275d 2920 7b0a 2020  tus['eof']) {.  
-00032830: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
-00032840: 5468 6520 736f 636b 6574 2069 7320 7661  The socket is va
-00032850: 6c69 6420 6275 7420 7765 2061 7265 206e  lid but we are n
-00032860: 6f74 2063 6f6e 6e65 6374 6564 0a20 2020  ot connected.   
-00032870: 2020 2020 2020 2020 2020 2020 2024 7468               $th
-00032880: 6973 2d3e 6564 6562 7567 280a 2020 2020  is->edebug(.    
-00032890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000328a0: 2753 4d54 5020 4e4f 5449 4345 3a20 454f  'SMTP NOTICE: EO
-000328b0: 4620 6361 7567 6874 2077 6869 6c65 2063  F caught while c
-000328c0: 6865 636b 696e 6720 6966 2063 6f6e 6e65  hecking if conne
-000328d0: 6374 6564 272c 0a20 2020 2020 2020 2020  cted',.         
-000328e0: 2020 2020 2020 2020 2020 2073 656c 663a             self:
-000328f0: 3a44 4542 5547 5f43 4c49 454e 540a 2020  :DEBUG_CLIENT.  
-00032900: 2020 2020 2020 2020 2020 2020 2020 293b                );
-00032910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032920: 2024 7468 6973 2d3e 636c 6f73 6528 293b   $this->close();
-00032930: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00032940: 2020 7265 7475 726e 2066 616c 7365 3b0a    return false;.
-00032950: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-00032960: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00032970: 6e20 7472 7565 3b20 2f2f 6576 6572 7974  n true; //everyt
-00032980: 6869 6e67 206c 6f6f 6b73 2067 6f6f 640a  hing looks good.
-00032990: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-000329a0: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
-000329b0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-000329c0: 2020 2020 202a 2043 6c6f 7365 2074 6865       * Close the
-000329d0: 2073 6f63 6b65 7420 616e 6420 636c 6561   socket and clea
-000329e0: 6e20 7570 2074 6865 2073 7461 7465 206f  n up the state o
-000329f0: 6620 7468 6520 636c 6173 732e 0a20 2020  f the class..   
-00032a00: 2020 2a20 446f 6e27 7420 7573 6520 7468    * Don't use th
-00032a10: 6973 2066 756e 6374 696f 6e20 7769 7468  is function with
-00032a20: 6f75 7420 6669 7273 7420 7472 7969 6e67  out first trying
-00032a30: 2074 6f20 7573 6520 5155 4954 2e0a 2020   to use QUIT..  
-00032a40: 2020 202a 0a20 2020 2020 2a20 4073 6565     *.     * @see
-00032a50: 2071 7569 7428 290a 2020 2020 202a 2f0a   quit().     */.
-00032a60: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
-00032a70: 696f 6e20 636c 6f73 6528 290a 2020 2020  ion close().    
-00032a80: 7b0a 2020 2020 2020 2020 2474 6869 732d  {.        $this-
-00032a90: 3e73 6574 4572 726f 7228 2727 293b 0a20  >setError('');. 
-00032aa0: 2020 2020 2020 2024 7468 6973 2d3e 7365         $this->se
-00032ab0: 7276 6572 5f63 6170 7320 3d20 6e75 6c6c  rver_caps = null
-00032ac0: 3b0a 2020 2020 2020 2020 2474 6869 732d  ;.        $this-
-00032ad0: 3e68 656c 6f5f 7270 6c79 203d 206e 756c  >helo_rply = nul
-00032ae0: 6c3b 0a20 2020 2020 2020 2069 6620 2869  l;.        if (i
-00032af0: 735f 7265 736f 7572 6365 2824 7468 6973  s_resource($this
-00032b00: 2d3e 736d 7470 5f63 6f6e 6e29 2920 7b0a  ->smtp_conn)) {.
-00032b10: 2020 2020 2020 2020 2020 2020 2f2f 436c              //Cl
-00032b20: 6f73 6520 7468 6520 636f 6e6e 6563 7469  ose the connecti
-00032b30: 6f6e 2061 6e64 2063 6c65 616e 7570 0a20  on and cleanup. 
-00032b40: 2020 2020 2020 2020 2020 2066 636c 6f73             fclos
-00032b50: 6528 2474 6869 732d 3e73 6d74 705f 636f  e($this->smtp_co
-00032b60: 6e6e 293b 0a20 2020 2020 2020 2020 2020  nn);.           
-00032b70: 2024 7468 6973 2d3e 736d 7470 5f63 6f6e   $this->smtp_con
-00032b80: 6e20 3d20 6e75 6c6c 3b20 2f2f 4d61 6b65  n = null; //Make
-00032b90: 7320 666f 7220 636c 6561 6e65 7220 7365  s for cleaner se
-00032ba0: 7269 616c 697a 6174 696f 6e0a 2020 2020  rialization.    
-00032bb0: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-00032bc0: 6465 6275 6728 2743 6f6e 6e65 6374 696f  debug('Connectio
-00032bd0: 6e3a 2063 6c6f 7365 6427 2c20 7365 6c66  n: closed', self
-00032be0: 3a3a 4445 4255 475f 434f 4e4e 4543 5449  ::DEBUG_CONNECTI
-00032bf0: 4f4e 293b 0a20 2020 2020 2020 207d 0a20  ON);.        }. 
-00032c00: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-00032c10: 2020 202a 2053 656e 6420 616e 2053 4d54     * Send an SMT
-00032c20: 5020 4441 5441 2063 6f6d 6d61 6e64 2e0a  P DATA command..
-00032c30: 2020 2020 202a 2049 7373 7565 7320 6120       * Issues a 
-00032c40: 6461 7461 2063 6f6d 6d61 6e64 2061 6e64  data command and
-00032c50: 2073 656e 6473 2074 6865 206d 7367 5f64   sends the msg_d
-00032c60: 6174 6120 746f 2074 6865 2073 6572 7665  ata to the serve
-00032c70: 722c 0a20 2020 2020 2a20 6669 6e61 6c69  r,.     * finali
-00032c80: 7a69 6e67 2074 6865 206d 6169 6c20 7472  zing the mail tr
-00032c90: 616e 7361 6374 696f 6e2e 2024 6d73 675f  ansaction. $msg_
-00032ca0: 6461 7461 2069 7320 7468 6520 6d65 7373  data is the mess
-00032cb0: 6167 650a 2020 2020 202a 2074 6861 7420  age.     * that 
-00032cc0: 6973 2074 6f20 6265 2073 656e 6420 7769  is to be send wi
-00032cd0: 7468 2074 6865 2068 6561 6465 7273 2e20  th the headers. 
-00032ce0: 4561 6368 2068 6561 6465 7220 6e65 6564  Each header need
-00032cf0: 7320 746f 2062 650a 2020 2020 202a 206f  s to be.     * o
-00032d00: 6e20 6120 7369 6e67 6c65 206c 696e 6520  n a single line 
-00032d10: 666f 6c6c 6f77 6564 2062 7920 6120 3c43  followed by a <C
-00032d20: 524c 463e 2077 6974 6820 7468 6520 6d65  RLF> with the me
-00032d30: 7373 6167 6520 6865 6164 6572 730a 2020  ssage headers.  
-00032d40: 2020 202a 2061 6e64 2074 6865 206d 6573     * and the mes
-00032d50: 7361 6765 2062 6f64 7920 6265 696e 6720  sage body being 
-00032d60: 7365 7061 7261 7465 6420 6279 2061 6e20  separated by an 
-00032d70: 6164 6469 7469 6f6e 616c 203c 4352 4c46  additional <CRLF
-00032d80: 3e2e 0a20 2020 2020 2a20 496d 706c 656d  >..     * Implem
-00032d90: 656e 7473 2052 4643 2038 3231 3a20 4441  ents RFC 821: DA
-00032da0: 5441 203c 4352 4c46 3e2e 0a20 2020 2020  TA <CRLF>..     
-00032db0: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-00032dc0: 7374 7269 6e67 2024 6d73 675f 6461 7461  string $msg_data
-00032dd0: 204d 6573 7361 6765 2064 6174 6120 746f   Message data to
-00032de0: 2073 656e 640a 2020 2020 202a 0a20 2020   send.     *.   
-00032df0: 2020 2a20 4072 6574 7572 6e20 626f 6f6c    * @return bool
-00032e00: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00032e10: 6c69 6320 6675 6e63 7469 6f6e 2064 6174  lic function dat
-00032e20: 6128 246d 7367 5f64 6174 6129 0a20 2020  a($msg_data).   
-00032e30: 207b 0a20 2020 2020 2020 202f 2f54 6869   {.        //Thi
-00032e40: 7320 7769 6c6c 2075 7365 2074 6865 2073  s will use the s
-00032e50: 7461 6e64 6172 6420 7469 6d65 6c69 6d69  tandard timelimi
-00032e60: 740a 2020 2020 2020 2020 6966 2028 2124  t.        if (!$
-00032e70: 7468 6973 2d3e 7365 6e64 436f 6d6d 616e  this->sendComman
-00032e80: 6428 2744 4154 4127 2c20 2744 4154 4127  d('DATA', 'DATA'
-00032e90: 2c20 3335 3429 2920 7b0a 2020 2020 2020  , 354)) {.      
-00032ea0: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
-00032eb0: 7365 3b0a 2020 2020 2020 2020 7d0a 0a20  se;.        }.. 
-00032ec0: 2020 2020 2020 202f 2a20 5468 6520 7365         /* The se
-00032ed0: 7276 6572 2069 7320 7265 6164 7920 746f  rver is ready to
-00032ee0: 2061 6363 6570 7420 6461 7461 210a 2020   accept data!.  
-00032ef0: 2020 2020 2020 202a 2041 6363 6f72 6469         * Accordi
-00032f00: 6e67 2074 6f20 7266 6338 3231 2077 6520  ng to rfc821 we 
-00032f10: 7368 6f75 6c64 206e 6f74 2073 656e 6420  should not send 
-00032f20: 6d6f 7265 2074 6861 6e20 3130 3030 2063  more than 1000 c
-00032f30: 6861 7261 6374 6572 7320 6f6e 2061 2073  haracters on a s
-00032f40: 696e 676c 6520 6c69 6e65 2028 696e 636c  ingle line (incl
-00032f50: 7564 696e 6720 7468 6520 4c45 290a 2020  uding the LE).  
-00032f60: 2020 2020 2020 202a 2073 6f20 7765 2077         * so we w
-00032f70: 696c 6c20 6272 6561 6b20 7468 6520 6461  ill break the da
-00032f80: 7461 2075 7020 696e 746f 206c 696e 6573  ta up into lines
-00032f90: 2062 7920 5c72 2061 6e64 2f6f 7220 5c6e   by \r and/or \n
-00032fa0: 2074 6865 6e20 6966 206e 6565 6465 6420   then if needed 
-00032fb0: 7765 2077 696c 6c20 6272 6561 6b20 6561  we will break ea
-00032fc0: 6368 206f 6620 7468 6f73 6520 696e 746f  ch of those into
-00032fd0: 0a20 2020 2020 2020 2020 2a20 736d 616c  .         * smal
-00032fe0: 6c65 7220 6c69 6e65 7320 746f 2066 6974  ler lines to fit
-00032ff0: 2077 6974 6869 6e20 7468 6520 6c69 6d69   within the limi
-00033000: 742e 0a20 2020 2020 2020 2020 2a20 5765  t..         * We
-00033010: 2077 696c 6c20 616c 736f 206c 6f6f 6b20   will also look 
-00033020: 666f 7220 6c69 6e65 7320 7468 6174 2073  for lines that s
-00033030: 7461 7274 2077 6974 6820 6120 272e 2720  tart with a '.' 
-00033040: 616e 6420 7072 6570 656e 6420 616e 2061  and prepend an a
-00033050: 6464 6974 696f 6e61 6c20 272e 272e 0a20  dditional '.'.. 
-00033060: 2020 2020 2020 2020 2a20 4e4f 5445 3a20          * NOTE: 
-00033070: 7468 6973 2064 6f65 7320 6e6f 7420 636f  this does not co
-00033080: 756e 7420 746f 7761 7264 7320 6c69 6e65  unt towards line
-00033090: 2d6c 656e 6774 6820 6c69 6d69 742e 0a20  -length limit.. 
-000330a0: 2020 2020 2020 2020 2a2f 0a0a 2020 2020          */..    
-000330b0: 2020 2020 2f2f 4e6f 726d 616c 697a 6520      //Normalize 
-000330c0: 6c69 6e65 2062 7265 616b 7320 6265 666f  line breaks befo
-000330d0: 7265 2065 7870 6c6f 6469 6e67 0a20 2020  re exploding.   
-000330e0: 2020 2020 2024 6c69 6e65 7320 3d20 6578       $lines = ex
-000330f0: 706c 6f64 6528 225c 6e22 2c20 7374 725f  plode("\n", str_
-00033100: 7265 706c 6163 6528 5b22 5c72 5c6e 222c  replace(["\r\n",
-00033110: 2022 5c72 225d 2c20 225c 6e22 2c20 246d   "\r"], "\n", $m
-00033120: 7367 5f64 6174 6129 293b 0a0a 2020 2020  sg_data));..    
-00033130: 2020 2020 2f2a 2054 6f20 6469 7374 696e      /* To distin
-00033140: 6775 6973 6820 6265 7477 6565 6e20 6120  guish between a 
-00033150: 636f 6d70 6c65 7465 2052 4643 3832 3220  complete RFC822 
-00033160: 6d65 7373 6167 6520 616e 6420 6120 706c  message and a pl
-00033170: 6169 6e20 6d65 7373 6167 6520 626f 6479  ain message body
-00033180: 2c20 7765 2063 6865 636b 2069 6620 7468  , we check if th
-00033190: 6520 6669 7273 7420 6669 656c 640a 2020  e first field.  
-000331a0: 2020 2020 2020 202a 206f 6620 7468 6520         * of the 
-000331b0: 6669 7273 7420 6c69 6e65 2028 273a 2720  first line (':' 
-000331c0: 7365 7061 7261 7465 6429 2064 6f65 7320  separated) does 
-000331d0: 6e6f 7420 636f 6e74 6169 6e20 6120 7370  not contain a sp
-000331e0: 6163 6520 7468 656e 2069 7420 5f73 686f  ace then it _sho
-000331f0: 756c 645f 2062 6520 6120 6865 6164 6572  uld_ be a header
-00033200: 2061 6e64 2077 6520 7769 6c6c 0a20 2020   and we will.   
-00033210: 2020 2020 2020 2a20 7072 6f63 6573 7320        * process 
-00033220: 616c 6c20 6c69 6e65 7320 6265 666f 7265  all lines before
-00033230: 2061 2062 6c61 6e6b 206c 696e 6520 6173   a blank line as
-00033240: 2068 6561 6465 7273 2e0a 2020 2020 2020   headers..      
-00033250: 2020 202a 2f0a 0a20 2020 2020 2020 2024     */..        $
-00033260: 6669 656c 6420 3d20 7375 6273 7472 2824  field = substr($
-00033270: 6c69 6e65 735b 305d 2c20 302c 2073 7472  lines[0], 0, str
-00033280: 706f 7328 246c 696e 6573 5b30 5d2c 2027  pos($lines[0], '
-00033290: 3a27 2929 3b0a 2020 2020 2020 2020 2469  :'));.        $i
-000332a0: 6e5f 6865 6164 6572 7320 3d20 6661 6c73  n_headers = fals
-000332b0: 653b 0a20 2020 2020 2020 2069 6620 2821  e;.        if (!
-000332c0: 656d 7074 7928 2466 6965 6c64 2920 2626  empty($field) &&
-000332d0: 2073 7472 706f 7328 2466 6965 6c64 2c20   strpos($field, 
-000332e0: 2720 2729 203d 3d3d 2066 616c 7365 2920  ' ') === false) 
-000332f0: 7b0a 2020 2020 2020 2020 2020 2020 2469  {.            $i
-00033300: 6e5f 6865 6164 6572 7320 3d20 7472 7565  n_headers = true
-00033310: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
-00033320: 2020 2020 2066 6f72 6561 6368 2028 246c       foreach ($l
-00033330: 696e 6573 2061 7320 246c 696e 6529 207b  ines as $line) {
-00033340: 0a20 2020 2020 2020 2020 2020 2024 6c69  .            $li
-00033350: 6e65 735f 6f75 7420 3d20 5b5d 3b0a 2020  nes_out = [];.  
-00033360: 2020 2020 2020 2020 2020 6966 2028 2469            if ($i
-00033370: 6e5f 6865 6164 6572 7320 2626 2024 6c69  n_headers && $li
-00033380: 6e65 203d 3d3d 2027 2729 207b 0a20 2020  ne === '') {.   
-00033390: 2020 2020 2020 2020 2020 2020 2024 696e               $in
-000333a0: 5f68 6561 6465 7273 203d 2066 616c 7365  _headers = false
-000333b0: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
-000333c0: 2020 2020 2020 2020 2020 2020 2f2f 4272              //Br
-000333d0: 6561 6b20 7468 6973 206c 696e 6520 7570  eak this line up
-000333e0: 2069 6e74 6f20 7365 7665 7261 6c20 736d   into several sm
-000333f0: 616c 6c65 7220 6c69 6e65 7320 6966 2069  aller lines if i
-00033400: 7427 7320 746f 6f20 6c6f 6e67 0a20 2020  t's too long.   
-00033410: 2020 2020 2020 2020 202f 2f4d 6963 726f           //Micro
-00033420: 2d6f 7074 696d 6973 6174 696f 6e3a 2069  -optimisation: i
-00033430: 7373 6574 2824 7374 725b 246c 656e 5d29  sset($str[$len])
-00033440: 2069 7320 6661 7374 6572 2074 6861 6e20   is faster than 
-00033450: 2873 7472 6c65 6e28 2473 7472 2920 3e20  (strlen($str) > 
-00033460: 246c 656e 292c 0a20 2020 2020 2020 2020  $len),.         
-00033470: 2020 2077 6869 6c65 2028 6973 7365 7428     while (isset(
-00033480: 246c 696e 655b 7365 6c66 3a3a 4d41 585f  $line[self::MAX_
-00033490: 4c49 4e45 5f4c 454e 4754 485d 2929 207b  LINE_LENGTH])) {
-000334a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000334b0: 202f 2f57 6f72 6b69 6e67 2062 6163 6b77   //Working backw
-000334c0: 6172 6473 2c20 7472 7920 746f 2066 696e  ards, try to fin
-000334d0: 6420 6120 7370 6163 6520 7769 7468 696e  d a space within
-000334e0: 2074 6865 206c 6173 7420 4d41 585f 4c49   the last MAX_LI
-000334f0: 4e45 5f4c 454e 4754 4820 6368 6172 7320  NE_LENGTH chars 
-00033500: 6f66 2074 6865 206c 696e 6520 746f 2062  of the line to b
-00033510: 7265 616b 206f 6e0a 2020 2020 2020 2020  reak on.        
-00033520: 2020 2020 2020 2020 2f2f 736f 2061 7320          //so as 
-00033530: 746f 2061 766f 6964 2062 7265 616b 696e  to avoid breakin
-00033540: 6720 696e 2074 6865 206d 6964 646c 6520  g in the middle 
-00033550: 6f66 2061 2077 6f72 640a 2020 2020 2020  of a word.      
-00033560: 2020 2020 2020 2020 2020 2470 6f73 203d            $pos =
-00033570: 2073 7472 7270 6f73 2873 7562 7374 7228   strrpos(substr(
-00033580: 246c 696e 652c 2030 2c20 7365 6c66 3a3a  $line, 0, self::
-00033590: 4d41 585f 4c49 4e45 5f4c 454e 4754 4829  MAX_LINE_LENGTH)
-000335a0: 2c20 2720 2729 3b0a 2020 2020 2020 2020  , ' ');.        
-000335b0: 2020 2020 2020 2020 2f2f 4465 6c69 6265          //Delibe
-000335c0: 7261 7465 6c79 206d 6174 6368 6573 2062  rately matches b
-000335d0: 6f74 6820 6661 6c73 6520 616e 6420 300a  oth false and 0.
-000335e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000335f0: 6966 2028 2124 706f 7329 207b 0a20 2020  if (!$pos) {.   
-00033600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033610: 202f 2f4e 6f20 6e69 6365 2062 7265 616b   //No nice break
-00033620: 2066 6f75 6e64 2c20 6164 6420 6120 6861   found, add a ha
-00033630: 7264 2062 7265 616b 0a20 2020 2020 2020  rd break.       
-00033640: 2020 2020 2020 2020 2020 2020 2024 706f               $po
-00033650: 7320 3d20 7365 6c66 3a3a 4d41 585f 4c49  s = self::MAX_LI
-00033660: 4e45 5f4c 454e 4754 4820 2d20 313b 0a20  NE_LENGTH - 1;. 
-00033670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033680: 2020 2024 6c69 6e65 735f 6f75 745b 5d20     $lines_out[] 
-00033690: 3d20 7375 6273 7472 2824 6c69 6e65 2c20  = substr($line, 
-000336a0: 302c 2024 706f 7329 3b0a 2020 2020 2020  0, $pos);.      
-000336b0: 2020 2020 2020 2020 2020 2020 2020 246c                $l
-000336c0: 696e 6520 3d20 7375 6273 7472 2824 6c69  ine = substr($li
-000336d0: 6e65 2c20 2470 6f73 293b 0a20 2020 2020  ne, $pos);.     
-000336e0: 2020 2020 2020 2020 2020 207d 2065 6c73             } els
-000336f0: 6520 7b0a 2020 2020 2020 2020 2020 2020  e {.            
-00033700: 2020 2020 2020 2020 2f2f 4272 6561 6b20          //Break 
-00033710: 6174 2074 6865 2066 6f75 6e64 2070 6f69  at the found poi
-00033720: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
-00033730: 2020 2020 2020 2024 6c69 6e65 735f 6f75         $lines_ou
-00033740: 745b 5d20 3d20 7375 6273 7472 2824 6c69  t[] = substr($li
-00033750: 6e65 2c20 302c 2024 706f 7329 3b0a 2020  ne, 0, $pos);.  
-00033760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033770: 2020 2f2f 4d6f 7665 2061 6c6f 6e67 2062    //Move along b
-00033780: 7920 7468 6520 616d 6f75 6e74 2077 6520  y the amount we 
-00033790: 6465 616c 7420 7769 7468 0a20 2020 2020  dealt with.     
-000337a0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-000337b0: 6c69 6e65 203d 2073 7562 7374 7228 246c  line = substr($l
-000337c0: 696e 652c 2024 706f 7320 2b20 3129 3b0a  ine, $pos + 1);.
-000337d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000337e0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000337f0: 2020 2f2f 4966 2070 726f 6365 7373 696e    //If processin
-00033800: 6720 6865 6164 6572 7320 6164 6420 6120  g headers add a 
-00033810: 4c57 5350 2d63 6861 7220 746f 2074 6865  LWSP-char to the
-00033820: 2066 726f 6e74 206f 6620 6e65 7720 6c69   front of new li
-00033830: 6e65 2052 4643 3832 3220 7365 6374 696f  ne RFC822 sectio
-00033840: 6e20 332e 312e 310a 2020 2020 2020 2020  n 3.1.1.        
-00033850: 2020 2020 2020 2020 6966 2028 2469 6e5f          if ($in_
-00033860: 6865 6164 6572 7329 207b 0a20 2020 2020  headers) {.     
-00033870: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00033880: 6c69 6e65 203d 2022 5c74 2220 2e20 246c  line = "\t" . $l
-00033890: 696e 653b 0a20 2020 2020 2020 2020 2020  ine;.           
-000338a0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-000338b0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-000338c0: 2024 6c69 6e65 735f 6f75 745b 5d20 3d20   $lines_out[] = 
-000338d0: 246c 696e 653b 0a0a 2020 2020 2020 2020  $line;..        
-000338e0: 2020 2020 2f2f 5365 6e64 2074 6865 206c      //Send the l
-000338f0: 696e 6573 2074 6f20 7468 6520 7365 7276  ines to the serv
-00033900: 6572 0a20 2020 2020 2020 2020 2020 2066  er.            f
-00033910: 6f72 6561 6368 2028 246c 696e 6573 5f6f  oreach ($lines_o
-00033920: 7574 2061 7320 246c 696e 655f 6f75 7429  ut as $line_out)
-00033930: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00033940: 2020 202f 2f44 6f74 2d73 7475 6666 696e     //Dot-stuffin
-00033950: 6720 6173 2070 6572 2052 4643 3533 3231  g as per RFC5321
-00033960: 2073 6563 7469 6f6e 2034 2e35 2e32 0a20   section 4.5.2. 
-00033970: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00033980: 2f68 7474 7073 3a2f 2f74 6f6f 6c73 2e69  /https://tools.i
-00033990: 6574 662e 6f72 672f 6874 6d6c 2f72 6663  etf.org/html/rfc
-000339a0: 3533 3231 2373 6563 7469 6f6e 2d34 2e35  5321#section-4.5
-000339b0: 2e32 0a20 2020 2020 2020 2020 2020 2020  .2.             
-000339c0: 2020 2069 6620 2821 656d 7074 7928 246c     if (!empty($l
-000339d0: 696e 655f 6f75 7429 2026 2620 246c 696e  ine_out) && $lin
-000339e0: 655f 6f75 745b 305d 203d 3d3d 2027 2e27  e_out[0] === '.'
-000339f0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00033a00: 2020 2020 2020 2020 246c 696e 655f 6f75          $line_ou
-00033a10: 7420 3d20 272e 2720 2e20 246c 696e 655f  t = '.' . $line_
-00033a20: 6f75 743b 0a20 2020 2020 2020 2020 2020  out;.           
-00033a30: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00033a40: 2020 2020 2020 2024 7468 6973 2d3e 636c         $this->cl
-00033a50: 6965 6e74 5f73 656e 6428 246c 696e 655f  ient_send($line_
-00033a60: 6f75 7420 2e20 7374 6174 6963 3a3a 4c45  out . static::LE
-00033a70: 2c20 2744 4154 4127 293b 0a20 2020 2020  , 'DATA');.     
-00033a80: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00033a90: 207d 0a0a 2020 2020 2020 2020 2f2f 4d65   }..        //Me
-00033aa0: 7373 6167 6520 6461 7461 2068 6173 2062  ssage data has b
-00033ab0: 6565 6e20 7365 6e74 2c20 636f 6d70 6c65  een sent, comple
-00033ac0: 7465 2074 6865 2063 6f6d 6d61 6e64 0a20  te the command. 
-00033ad0: 2020 2020 2020 202f 2f49 6e63 7265 6173         //Increas
-00033ae0: 6520 7469 6d65 6c69 6d69 7420 666f 7220  e timelimit for 
-00033af0: 656e 6420 6f66 2044 4154 4120 636f 6d6d  end of DATA comm
-00033b00: 616e 640a 2020 2020 2020 2020 2473 6176  and.        $sav
-00033b10: 6574 696d 656c 696d 6974 203d 2024 7468  etimelimit = $th
-00033b20: 6973 2d3e 5469 6d65 6c69 6d69 743b 0a20  is->Timelimit;. 
-00033b30: 2020 2020 2020 2024 7468 6973 2d3e 5469         $this->Ti
-00033b40: 6d65 6c69 6d69 7420 2a3d 2032 3b0a 2020  melimit *= 2;.  
-00033b50: 2020 2020 2020 2472 6573 756c 7420 3d20        $result = 
-00033b60: 2474 6869 732d 3e73 656e 6443 6f6d 6d61  $this->sendComma
-00033b70: 6e64 2827 4441 5441 2045 4e44 272c 2027  nd('DATA END', '
-00033b80: 2e27 2c20 3235 3029 3b0a 2020 2020 2020  .', 250);.      
-00033b90: 2020 2474 6869 732d 3e72 6563 6f72 644c    $this->recordL
-00033ba0: 6173 7454 7261 6e73 6163 7469 6f6e 4944  astTransactionID
-00033bb0: 2829 3b0a 2020 2020 2020 2020 2f2f 5265  ();.        //Re
-00033bc0: 7374 6f72 6520 7469 6d65 6c69 6d69 740a  store timelimit.
-00033bd0: 2020 2020 2020 2020 2474 6869 732d 3e54          $this->T
-00033be0: 696d 656c 696d 6974 203d 2024 7361 7665  imelimit = $save
-00033bf0: 7469 6d65 6c69 6d69 743b 0a0a 2020 2020  timelimit;..    
-00033c00: 2020 2020 7265 7475 726e 2024 7265 7375      return $resu
-00033c10: 6c74 3b0a 2020 2020 7d0a 0a20 2020 202f  lt;.    }..    /
-00033c20: 2a2a 0a20 2020 2020 2a20 5365 6e64 2061  **.     * Send a
-00033c30: 6e20 534d 5450 2048 454c 4f20 6f72 2045  n SMTP HELO or E
-00033c40: 484c 4f20 636f 6d6d 616e 642e 0a20 2020  HLO command..   
-00033c50: 2020 2a20 5573 6564 2074 6f20 6964 656e    * Used to iden
-00033c60: 7469 6679 2074 6865 2073 656e 6469 6e67  tify the sending
-00033c70: 2073 6572 7665 7220 746f 2074 6865 2072   server to the r
-00033c80: 6563 6569 7669 6e67 2073 6572 7665 722e  eceiving server.
-00033c90: 0a20 2020 2020 2a20 5468 6973 206d 616b  .     * This mak
-00033ca0: 6573 2073 7572 6520 7468 6174 2063 6c69  es sure that cli
-00033cb0: 656e 7420 616e 6420 7365 7276 6572 2061  ent and server a
-00033cc0: 7265 2069 6e20 6120 6b6e 6f77 6e20 7374  re in a known st
-00033cd0: 6174 652e 0a20 2020 2020 2a20 496d 706c  ate..     * Impl
-00033ce0: 656d 656e 7473 2052 4643 2038 3231 3a20  ements RFC 821: 
-00033cf0: 4845 4c4f 203c 5350 3e20 3c64 6f6d 6169  HELO <SP> <domai
-00033d00: 6e3e 203c 4352 4c46 3e0a 2020 2020 202a  n> <CRLF>.     *
-00033d10: 2061 6e64 2052 4643 2032 3832 3120 4548   and RFC 2821 EH
-00033d20: 4c4f 2e0a 2020 2020 202a 0a20 2020 2020  LO..     *.     
-00033d30: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
-00033d40: 2468 6f73 7420 5468 6520 686f 7374 206e  $host The host n
-00033d50: 616d 6520 6f72 2049 5020 746f 2063 6f6e  ame or IP to con
-00033d60: 6e65 6374 2074 6f0a 2020 2020 202a 0a20  nect to.     *. 
-00033d70: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
-00033d80: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
-00033d90: 7562 6c69 6320 6675 6e63 7469 6f6e 2068  ublic function h
-00033da0: 656c 6c6f 2824 686f 7374 203d 2027 2729  ello($host = '')
-00033db0: 0a20 2020 207b 0a20 2020 2020 2020 202f  .    {.        /
-00033dc0: 2f54 7279 2065 7874 656e 6465 6420 6865  /Try extended he
-00033dd0: 6c6c 6f20 6669 7273 7420 2852 4643 2032  llo first (RFC 2
-00033de0: 3832 3129 0a20 2020 2020 2020 2069 6620  821).        if 
-00033df0: 2824 7468 6973 2d3e 7365 6e64 4865 6c6c  ($this->sendHell
-00033e00: 6f28 2745 484c 4f27 2c20 2468 6f73 7429  o('EHLO', $host)
-00033e10: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00033e20: 7265 7475 726e 2074 7275 653b 0a20 2020  return true;.   
-00033e30: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00033e40: 2f2f 536f 6d65 2073 6572 7665 7273 2073  //Some servers s
-00033e50: 6875 7420 646f 776e 2074 6865 2053 4d54  hut down the SMT
-00033e60: 5020 7365 7276 6963 6520 6865 7265 2028  P service here (
-00033e70: 5246 4320 3533 3231 290a 2020 2020 2020  RFC 5321).      
-00033e80: 2020 6966 2028 7375 6273 7472 2824 7468    if (substr($th
-00033e90: 6973 2d3e 6865 6c6f 5f72 706c 792c 2030  is->helo_rply, 0
-00033ea0: 2c20 3329 203d 3d20 2734 3231 2729 207b  , 3) == '421') {
-00033eb0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00033ec0: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
-00033ed0: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
-00033ee0: 7475 726e 2024 7468 6973 2d3e 7365 6e64  turn $this->send
-00033ef0: 4865 6c6c 6f28 2748 454c 4f27 2c20 2468  Hello('HELO', $h
-00033f00: 6f73 7429 3b0a 2020 2020 7d0a 0a20 2020  ost);.    }..   
-00033f10: 202f 2a2a 0a20 2020 2020 2a20 5365 6e64   /**.     * Send
-00033f20: 2061 6e20 534d 5450 2048 454c 4f20 6f72   an SMTP HELO or
-00033f30: 2045 484c 4f20 636f 6d6d 616e 642e 0a20   EHLO command.. 
-00033f40: 2020 2020 2a20 4c6f 772d 6c65 7665 6c20      * Low-level 
-00033f50: 696d 706c 656d 656e 7461 7469 6f6e 2075  implementation u
-00033f60: 7365 6420 6279 2068 656c 6c6f 2829 2e0a  sed by hello()..
-00033f70: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
-00033f80: 6172 616d 2073 7472 696e 6720 2468 656c  aram string $hel
-00033f90: 6c6f 2054 6865 2048 454c 4f20 7374 7269  lo The HELO stri
-00033fa0: 6e67 0a20 2020 2020 2a20 4070 6172 616d  ng.     * @param
-00033fb0: 2073 7472 696e 6720 2468 6f73 7420 2054   string $host  T
-00033fc0: 6865 2068 6f73 746e 616d 6520 746f 2073  he hostname to s
-00033fd0: 6179 2077 6520 6172 650a 2020 2020 202a  ay we are.     *
-00033fe0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
-00033ff0: 626f 6f6c 0a20 2020 2020 2a0a 2020 2020  bool.     *.    
-00034000: 202a 2040 7365 6520 6865 6c6c 6f28 290a   * @see hello().
-00034010: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
-00034020: 6563 7465 6420 6675 6e63 7469 6f6e 2073  ected function s
-00034030: 656e 6448 656c 6c6f 2824 6865 6c6c 6f2c  endHello($hello,
-00034040: 2024 686f 7374 290a 2020 2020 7b0a 2020   $host).    {.  
-00034050: 2020 2020 2020 246e 6f65 7272 6f72 203d        $noerror =
-00034060: 2024 7468 6973 2d3e 7365 6e64 436f 6d6d   $this->sendComm
-00034070: 616e 6428 2468 656c 6c6f 2c20 2468 656c  and($hello, $hel
-00034080: 6c6f 202e 2027 2027 202e 2024 686f 7374  lo . ' ' . $host
-00034090: 2c20 3235 3029 3b0a 2020 2020 2020 2020  , 250);.        
-000340a0: 2474 6869 732d 3e68 656c 6f5f 7270 6c79  $this->helo_rply
-000340b0: 203d 2024 7468 6973 2d3e 6c61 7374 5f72   = $this->last_r
-000340c0: 6570 6c79 3b0a 2020 2020 2020 2020 6966  eply;.        if
-000340d0: 2028 246e 6f65 7272 6f72 2920 7b0a 2020   ($noerror) {.  
-000340e0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-000340f0: 3e70 6172 7365 4865 6c6c 6f46 6965 6c64  >parseHelloField
-00034100: 7328 2468 656c 6c6f 293b 0a20 2020 2020  s($hello);.     
-00034110: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-00034120: 2020 2020 2020 2020 2474 6869 732d 3e73          $this->s
-00034130: 6572 7665 725f 6361 7073 203d 206e 756c  erver_caps = nul
-00034140: 6c3b 0a20 2020 2020 2020 207d 0a0a 2020  l;.        }..  
-00034150: 2020 2020 2020 7265 7475 726e 2024 6e6f        return $no
-00034160: 6572 726f 723b 0a20 2020 207d 0a0a 2020  error;.    }..  
-00034170: 2020 2f2a 2a0a 2020 2020 202a 2050 6172    /**.     * Par
-00034180: 7365 2061 2072 6570 6c79 2074 6f20 4845  se a reply to HE
-00034190: 4c4f 2f45 484c 4f20 636f 6d6d 616e 6420  LO/EHLO command 
-000341a0: 746f 2064 6973 636f 7665 7220 7365 7276  to discover serv
-000341b0: 6572 2065 7874 656e 7369 6f6e 732e 0a20  er extensions.. 
-000341c0: 2020 2020 2a20 496e 2063 6173 6520 6f66      * In case of
-000341d0: 2048 454c 4f2c 2074 6865 206f 6e6c 7920   HELO, the only 
-000341e0: 7061 7261 6d65 7465 7220 7468 6174 2063  parameter that c
-000341f0: 616e 2062 6520 6469 7363 6f76 6572 6564  an be discovered
-00034200: 2069 7320 6120 7365 7276 6572 206e 616d   is a server nam
-00034210: 652e 0a20 2020 2020 2a0a 2020 2020 202a  e..     *.     *
-00034220: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-00034230: 7479 7065 2060 4845 4c4f 6020 6f72 2060  type `HELO` or `
-00034240: 4548 4c4f 600a 2020 2020 202a 2f0a 2020  EHLO`.     */.  
-00034250: 2020 7072 6f74 6563 7465 6420 6675 6e63    protected func
-00034260: 7469 6f6e 2070 6172 7365 4865 6c6c 6f46  tion parseHelloF
-00034270: 6965 6c64 7328 2474 7970 6529 0a20 2020  ields($type).   
-00034280: 207b 0a20 2020 2020 2020 2024 7468 6973   {.        $this
-00034290: 2d3e 7365 7276 6572 5f63 6170 7320 3d20  ->server_caps = 
-000342a0: 5b5d 3b0a 2020 2020 2020 2020 246c 696e  [];.        $lin
-000342b0: 6573 203d 2065 7870 6c6f 6465 2822 5c6e  es = explode("\n
-000342c0: 222c 2024 7468 6973 2d3e 6865 6c6f 5f72  ", $this->helo_r
-000342d0: 706c 7929 3b0a 0a20 2020 2020 2020 2066  ply);..        f
-000342e0: 6f72 6561 6368 2028 246c 696e 6573 2061  oreach ($lines a
-000342f0: 7320 246e 203d 3e20 2473 2920 7b0a 2020  s $n => $s) {.  
-00034300: 2020 2020 2020 2020 2020 2f2f 4669 7273            //Firs
-00034310: 7420 3420 6368 6172 7320 636f 6e74 6169  t 4 chars contai
-00034320: 6e20 7265 7370 6f6e 7365 2063 6f64 6520  n response code 
-00034330: 666f 6c6c 6f77 6564 2062 7920 2d20 6f72  followed by - or
-00034340: 2073 7061 6365 0a20 2020 2020 2020 2020   space.         
-00034350: 2020 2024 7320 3d20 7472 696d 2873 7562     $s = trim(sub
-00034360: 7374 7228 2473 2c20 3429 293b 0a20 2020  str($s, 4));.   
-00034370: 2020 2020 2020 2020 2069 6620 2865 6d70           if (emp
-00034380: 7479 2824 7329 2920 7b0a 2020 2020 2020  ty($s)) {.      
-00034390: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000343a0: 7565 3b0a 2020 2020 2020 2020 2020 2020  ue;.            
-000343b0: 7d0a 2020 2020 2020 2020 2020 2020 2466  }.            $f
-000343c0: 6965 6c64 7320 3d20 6578 706c 6f64 6528  ields = explode(
-000343d0: 2720 272c 2024 7329 3b0a 2020 2020 2020  ' ', $s);.      
-000343e0: 2020 2020 2020 6966 2028 2165 6d70 7479        if (!empty
-000343f0: 2824 6669 656c 6473 2929 207b 0a20 2020  ($fields)) {.   
-00034400: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00034410: 2821 246e 2920 7b0a 2020 2020 2020 2020  (!$n) {.        
-00034420: 2020 2020 2020 2020 2020 2020 246e 616d              $nam
-00034430: 6520 3d20 2474 7970 653b 0a20 2020 2020  e = $type;.     
-00034440: 2020 2020 2020 2020 2020 2020 2020 2024                 $
-00034450: 6669 656c 6473 203d 2024 6669 656c 6473  fields = $fields
-00034460: 5b30 5d3b 0a20 2020 2020 2020 2020 2020  [0];.           
-00034470: 2020 2020 207d 2065 6c73 6520 7b0a 2020       } else {.  
-00034480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034490: 2020 246e 616d 6520 3d20 6172 7261 795f    $name = array_
-000344a0: 7368 6966 7428 2466 6965 6c64 7329 3b0a  shift($fields);.
-000344b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000344c0: 2020 2020 7377 6974 6368 2028 246e 616d      switch ($nam
-000344d0: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
-000344e0: 2020 2020 2020 2020 2020 2020 2063 6173               cas
-000344f0: 6520 2753 495a 4527 3a0a 2020 2020 2020  e 'SIZE':.      
-00034500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034510: 2020 2020 2020 2466 6965 6c64 7320 3d20        $fields = 
-00034520: 2824 6669 656c 6473 203f 2024 6669 656c  ($fields ? $fiel
-00034530: 6473 5b30 5d20 3a20 3029 3b0a 2020 2020  ds[0] : 0);.    
-00034540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034550: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
-00034560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034570: 2020 2020 2020 2063 6173 6520 2741 5554         case 'AUT
-00034580: 4827 3a0a 2020 2020 2020 2020 2020 2020  H':.            
-00034590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000345a0: 6966 2028 2169 735f 6172 7261 7928 2466  if (!is_array($f
-000345b0: 6965 6c64 7329 2920 7b0a 2020 2020 2020  ields)) {.      
-000345c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000345d0: 2020 2020 2020 2020 2020 2466 6965 6c64            $field
-000345e0: 7320 3d20 5b5d 3b0a 2020 2020 2020 2020  s = [];.        
-000345f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034600: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00034610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034620: 2020 6272 6561 6b3b 0a20 2020 2020 2020    break;.       
-00034630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034640: 2064 6566 6175 6c74 3a0a 2020 2020 2020   default:.      
-00034650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034660: 2020 2020 2020 2466 6965 6c64 7320 3d20        $fields = 
-00034670: 7472 7565 3b0a 2020 2020 2020 2020 2020  true;.          
-00034680: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-00034690: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-000346a0: 2020 2020 2020 2020 2020 2020 2020 2474                $t
-000346b0: 6869 732d 3e73 6572 7665 725f 6361 7073  his->server_caps
-000346c0: 5b24 6e61 6d65 5d20 3d20 2466 6965 6c64  [$name] = $field
-000346d0: 733b 0a20 2020 2020 2020 2020 2020 207d  s;.            }
-000346e0: 0a20 2020 2020 2020 207d 0a20 2020 207d  .        }.    }
-000346f0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00034700: 2053 656e 6420 616e 2053 4d54 5020 4d41   Send an SMTP MA
-00034710: 494c 2063 6f6d 6d61 6e64 2e0a 2020 2020  IL command..    
-00034720: 202a 2053 7461 7274 7320 6120 6d61 696c   * Starts a mail
-00034730: 2074 7261 6e73 6163 7469 6f6e 2066 726f   transaction fro
-00034740: 6d20 7468 6520 656d 6169 6c20 6164 6472  m the email addr
-00034750: 6573 7320 7370 6563 6966 6965 6420 696e  ess specified in
-00034760: 0a20 2020 2020 2a20 2466 726f 6d2e 2052  .     * $from. R
-00034770: 6574 7572 6e73 2074 7275 6520 6966 2073  eturns true if s
-00034780: 7563 6365 7373 6675 6c20 6f72 2066 616c  uccessful or fal
-00034790: 7365 206f 7468 6572 7769 7365 2e20 4966  se otherwise. If
-000347a0: 2054 7275 650a 2020 2020 202a 2074 6865   True.     * the
-000347b0: 206d 6169 6c20 7472 616e 7361 6374 696f   mail transactio
-000347c0: 6e20 6973 2073 7461 7274 6564 2061 6e64  n is started and
-000347d0: 2074 6865 6e20 6f6e 6520 6f72 206d 6f72   then one or mor
-000347e0: 6520 7265 6369 7069 656e 740a 2020 2020  e recipient.    
-000347f0: 202a 2063 6f6d 6d61 6e64 7320 6d61 7920   * commands may 
-00034800: 6265 2063 616c 6c65 6420 666f 6c6c 6f77  be called follow
-00034810: 6564 2062 7920 6120 6461 7461 2063 6f6d  ed by a data com
-00034820: 6d61 6e64 2e0a 2020 2020 202a 2049 6d70  mand..     * Imp
-00034830: 6c65 6d65 6e74 7320 5246 4320 3832 313a  lements RFC 821:
-00034840: 204d 4149 4c20 3c53 503e 2046 524f 4d3a   MAIL <SP> FROM:
-00034850: 3c72 6576 6572 7365 2d70 6174 683e 203c  <reverse-path> <
-00034860: 4352 4c46 3e2e 0a20 2020 2020 2a0a 2020  CRLF>..     *.  
-00034870: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-00034880: 6e67 2024 6672 6f6d 2053 6f75 7263 6520  ng $from Source 
-00034890: 6164 6472 6573 7320 6f66 2074 6869 7320  address of this 
-000348a0: 6d65 7373 6167 650a 2020 2020 202a 0a20  message.     *. 
-000348b0: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
-000348c0: 6f6c 0a20 2020 2020 2a2f 0a20 2020 2070  ol.     */.    p
-000348d0: 7562 6c69 6320 6675 6e63 7469 6f6e 206d  ublic function m
-000348e0: 6169 6c28 2466 726f 6d29 0a20 2020 207b  ail($from).    {
-000348f0: 0a20 2020 2020 2020 2024 7573 6556 6572  .        $useVer
-00034900: 7020 3d20 2824 7468 6973 2d3e 646f 5f76  p = ($this->do_v
-00034910: 6572 7020 3f20 2720 5856 4552 5027 203a  erp ? ' XVERP' :
-00034920: 2027 2729 3b0a 0a20 2020 2020 2020 2072   '');..        r
-00034930: 6574 7572 6e20 2474 6869 732d 3e73 656e  eturn $this->sen
-00034940: 6443 6f6d 6d61 6e64 280a 2020 2020 2020  dCommand(.      
-00034950: 2020 2020 2020 274d 4149 4c20 4652 4f4d        'MAIL FROM
-00034960: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00034970: 4d41 494c 2046 524f 4d3a 3c27 202e 2024  MAIL FROM:<' . $
-00034980: 6672 6f6d 202e 2027 3e27 202e 2024 7573  from . '>' . $us
-00034990: 6556 6572 702c 0a20 2020 2020 2020 2020  eVerp,.         
-000349a0: 2020 2032 3530 0a20 2020 2020 2020 2029     250.        )
-000349b0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
-000349c0: 0a20 2020 2020 2a20 5365 6e64 2061 6e20  .     * Send an 
-000349d0: 534d 5450 2051 5549 5420 636f 6d6d 616e  SMTP QUIT comman
-000349e0: 642e 0a20 2020 2020 2a20 436c 6f73 6573  d..     * Closes
-000349f0: 2074 6865 2073 6f63 6b65 7420 6966 2074   the socket if t
-00034a00: 6865 7265 2069 7320 6e6f 2065 7272 6f72  here is no error
-00034a10: 206f 7220 7468 6520 2463 6c6f 7365 5f6f   or the $close_o
-00034a20: 6e5f 6572 726f 7220 6172 6775 6d65 6e74  n_error argument
-00034a30: 2069 7320 7472 7565 2e0a 2020 2020 202a   is true..     *
-00034a40: 2049 6d70 6c65 6d65 6e74 7320 6672 6f6d   Implements from
-00034a50: 2052 4643 2038 3231 3a20 5155 4954 203c   RFC 821: QUIT <
-00034a60: 4352 4c46 3e2e 0a20 2020 2020 2a0a 2020  CRLF>..     *.  
-00034a70: 2020 202a 2040 7061 7261 6d20 626f 6f6c     * @param bool
-00034a80: 2024 636c 6f73 655f 6f6e 5f65 7272 6f72   $close_on_error
-00034a90: 2053 686f 756c 6420 7468 6520 636f 6e6e   Should the conn
-00034aa0: 6563 7469 6f6e 2063 6c6f 7365 2069 6620  ection close if 
-00034ab0: 616e 2065 7272 6f72 206f 6363 7572 733f  an error occurs?
-00034ac0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00034ad0: 7265 7475 726e 2062 6f6f 6c0a 2020 2020  return bool.    
-00034ae0: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-00034af0: 756e 6374 696f 6e20 7175 6974 2824 636c  unction quit($cl
-00034b00: 6f73 655f 6f6e 5f65 7272 6f72 203d 2074  ose_on_error = t
-00034b10: 7275 6529 0a20 2020 207b 0a20 2020 2020  rue).    {.     
-00034b20: 2020 2024 6e6f 6572 726f 7220 3d20 2474     $noerror = $t
-00034b30: 6869 732d 3e73 656e 6443 6f6d 6d61 6e64  his->sendCommand
-00034b40: 2827 5155 4954 272c 2027 5155 4954 272c  ('QUIT', 'QUIT',
-00034b50: 2032 3231 293b 0a20 2020 2020 2020 2024   221);.        $
-00034b60: 6572 7220 3d20 2474 6869 732d 3e65 7272  err = $this->err
-00034b70: 6f72 3b20 2f2f 5361 7665 2061 6e79 2065  or; //Save any e
-00034b80: 7272 6f72 0a20 2020 2020 2020 2069 6620  rror.        if 
-00034b90: 2824 6e6f 6572 726f 7220 7c7c 2024 636c  ($noerror || $cl
-00034ba0: 6f73 655f 6f6e 5f65 7272 6f72 2920 7b0a  ose_on_error) {.
-00034bb0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-00034bc0: 732d 3e63 6c6f 7365 2829 3b0a 2020 2020  s->close();.    
-00034bd0: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-00034be0: 7272 6f72 203d 2024 6572 723b 202f 2f52  rror = $err; //R
-00034bf0: 6573 746f 7265 2061 6e79 2065 7272 6f72  estore any error
-00034c00: 2066 726f 6d20 7468 6520 7175 6974 2063   from the quit c
-00034c10: 6f6d 6d61 6e64 0a20 2020 2020 2020 207d  ommand.        }
-00034c20: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00034c30: 2024 6e6f 6572 726f 723b 0a20 2020 207d   $noerror;.    }
-00034c40: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00034c50: 2053 656e 6420 616e 2053 4d54 5020 5243   Send an SMTP RC
-00034c60: 5054 2063 6f6d 6d61 6e64 2e0a 2020 2020  PT command..    
-00034c70: 202a 2053 6574 7320 7468 6520 544f 2061   * Sets the TO a
-00034c80: 7267 756d 656e 7420 746f 2024 746f 6164  rgument to $toad
-00034c90: 6472 2e0a 2020 2020 202a 2052 6574 7572  dr..     * Retur
-00034ca0: 6e73 2074 7275 6520 6966 2074 6865 2072  ns true if the r
-00034cb0: 6563 6970 6965 6e74 2077 6173 2061 6363  ecipient was acc
-00034cc0: 6570 7465 6420 6661 6c73 6520 6966 2069  epted false if i
-00034cd0: 7420 7761 7320 7265 6a65 6374 6564 2e0a  t was rejected..
-00034ce0: 2020 2020 202a 2049 6d70 6c65 6d65 6e74       * Implement
-00034cf0: 7320 6672 6f6d 2052 4643 2038 3231 3a20  s from RFC 821: 
-00034d00: 5243 5054 203c 5350 3e20 544f 3a3c 666f  RCPT <SP> TO:<fo
-00034d10: 7277 6172 642d 7061 7468 3e20 3c43 524c  rward-path> <CRL
-00034d20: 463e 2e0a 2020 2020 202a 0a20 2020 2020  F>..     *.     
-00034d30: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
-00034d40: 2461 6464 7265 7373 2054 6865 2061 6464  $address The add
-00034d50: 7265 7373 2074 6865 206d 6573 7361 6765  ress the message
-00034d60: 2069 7320 6265 696e 6720 7365 6e74 2074   is being sent t
-00034d70: 6f0a 2020 2020 202a 2040 7061 7261 6d20  o.     * @param 
-00034d80: 7374 7269 6e67 2024 6473 6e20 2020 2020  string $dsn     
-00034d90: 436f 6d6d 6120 7365 7061 7261 7465 6420  Comma separated 
-00034da0: 6c69 7374 206f 6620 4453 4e20 6e6f 7469  list of DSN noti
-00034db0: 6669 6361 7469 6f6e 732e 204e 4556 4552  fications. NEVER
-00034dc0: 2c20 5355 4343 4553 532c 2046 4149 4c55  , SUCCESS, FAILU
-00034dd0: 5245 0a20 2020 2020 2a20 2020 2020 2020  RE.     *       
-00034de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034df0: 206f 7220 4445 4c41 592e 2049 6620 796f   or DELAY. If yo
-00034e00: 7520 7370 6563 6966 7920 4e45 5645 5220  u specify NEVER 
-00034e10: 616c 6c20 6f74 6865 7220 6e6f 7469 6669  all other notifi
-00034e20: 6361 7469 6f6e 7320 6172 6520 6967 6e6f  cations are igno
-00034e30: 7265 642e 0a20 2020 2020 2a0a 2020 2020  red..     *.    
-00034e40: 202a 2040 7265 7475 726e 2062 6f6f 6c0a   * @return bool.
-00034e50: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
-00034e60: 6963 2066 756e 6374 696f 6e20 7265 6369  ic function reci
-00034e70: 7069 656e 7428 2461 6464 7265 7373 2c20  pient($address, 
-00034e80: 2464 736e 203d 2027 2729 0a20 2020 207b  $dsn = '').    {
-00034e90: 0a20 2020 2020 2020 2069 6620 2865 6d70  .        if (emp
-00034ea0: 7479 2824 6473 6e29 2920 7b0a 2020 2020  ty($dsn)) {.    
-00034eb0: 2020 2020 2020 2020 2472 6370 7420 3d20          $rcpt = 
-00034ec0: 2752 4350 5420 544f 3a3c 2720 2e20 2461  'RCPT TO:<' . $a
-00034ed0: 6464 7265 7373 202e 2027 3e27 3b0a 2020  ddress . '>';.  
-00034ee0: 2020 2020 2020 7d20 656c 7365 207b 0a20        } else {. 
-00034ef0: 2020 2020 2020 2020 2020 2024 6473 6e20             $dsn 
-00034f00: 3d20 7374 7274 6f75 7070 6572 2824 6473  = strtoupper($ds
-00034f10: 6e29 3b0a 2020 2020 2020 2020 2020 2020  n);.            
-00034f20: 246e 6f74 6966 7920 3d20 5b5d 3b0a 0a20  $notify = [];.. 
-00034f30: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
-00034f40: 7472 706f 7328 2464 736e 2c20 274e 4556  trpos($dsn, 'NEV
-00034f50: 4552 2729 2021 3d3d 2066 616c 7365 2920  ER') !== false) 
-00034f60: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00034f70: 2020 246e 6f74 6966 795b 5d20 3d20 274e    $notify[] = 'N
-00034f80: 4556 4552 273b 0a20 2020 2020 2020 2020  EVER';.         
-00034f90: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-00034fa0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-00034fb0: 6163 6820 285b 2753 5543 4345 5353 272c  ach (['SUCCESS',
-00034fc0: 2027 4641 494c 5552 4527 2c20 2744 454c   'FAILURE', 'DEL
-00034fd0: 4159 275d 2061 7320 2476 616c 7565 2920  AY'] as $value) 
-00034fe0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00034ff0: 2020 2020 2020 6966 2028 7374 7270 6f73        if (strpos
-00035000: 2824 6473 6e2c 2024 7661 6c75 6529 2021  ($dsn, $value) !
-00035010: 3d3d 2066 616c 7365 2920 7b0a 2020 2020  == false) {.    
-00035020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035030: 2020 2020 246e 6f74 6966 795b 5d20 3d20      $notify[] = 
-00035040: 2476 616c 7565 3b0a 2020 2020 2020 2020  $value;.        
-00035050: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00035060: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-00035070: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-00035080: 2020 2020 2020 2020 2020 2024 7263 7074             $rcpt
-00035090: 203d 2027 5243 5054 2054 4f3a 3c27 202e   = 'RCPT TO:<' .
-000350a0: 2024 6164 6472 6573 7320 2e20 273e 204e   $address . '> N
-000350b0: 4f54 4946 593d 2720 2e20 696d 706c 6f64  OTIFY=' . implod
-000350c0: 6528 272c 272c 2024 6e6f 7469 6679 293b  e(',', $notify);
-000350d0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-000350e0: 2020 2020 7265 7475 726e 2024 7468 6973      return $this
-000350f0: 2d3e 7365 6e64 436f 6d6d 616e 6428 0a20  ->sendCommand(. 
-00035100: 2020 2020 2020 2020 2020 2027 5243 5054             'RCPT
-00035110: 2054 4f27 2c0a 2020 2020 2020 2020 2020   TO',.          
-00035120: 2020 2472 6370 742c 0a20 2020 2020 2020    $rcpt,.       
-00035130: 2020 2020 205b 3235 302c 2032 3531 5d0a       [250, 251].
-00035140: 2020 2020 2020 2020 293b 0a20 2020 207d          );.    }
-00035150: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
-00035160: 2053 656e 6420 616e 2053 4d54 5020 5253   Send an SMTP RS
-00035170: 4554 2063 6f6d 6d61 6e64 2e0a 2020 2020  ET command..    
-00035180: 202a 2041 626f 7274 2061 6e79 2074 7261   * Abort any tra
-00035190: 6e73 6163 7469 6f6e 2074 6861 7420 6973  nsaction that is
-000351a0: 2063 7572 7265 6e74 6c79 2069 6e20 7072   currently in pr
-000351b0: 6f67 7265 7373 2e0a 2020 2020 202a 2049  ogress..     * I
-000351c0: 6d70 6c65 6d65 6e74 7320 5246 4320 3832  mplements RFC 82
-000351d0: 313a 2052 5345 5420 3c43 524c 463e 2e0a  1: RSET <CRLF>..
-000351e0: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-000351f0: 6574 7572 6e20 626f 6f6c 2054 7275 6520  eturn bool True 
-00035200: 6f6e 2073 7563 6365 7373 0a20 2020 2020  on success.     
-00035210: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-00035220: 6e63 7469 6f6e 2072 6573 6574 2829 0a20  nction reset(). 
-00035230: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
-00035240: 7572 6e20 2474 6869 732d 3e73 656e 6443  urn $this->sendC
-00035250: 6f6d 6d61 6e64 2827 5253 4554 272c 2027  ommand('RSET', '
-00035260: 5253 4554 272c 2032 3530 293b 0a20 2020  RSET', 250);.   
-00035270: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
-00035280: 202a 2053 656e 6420 6120 636f 6d6d 616e   * Send a comman
-00035290: 6420 746f 2061 6e20 534d 5450 2073 6572  d to an SMTP ser
-000352a0: 7665 7220 616e 6420 6368 6563 6b20 6974  ver and check it
-000352b0: 7320 7265 7475 726e 2063 6f64 652e 0a20  s return code.. 
-000352c0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-000352d0: 7261 6d20 7374 7269 6e67 2020 2020 2463  ram string    $c
-000352e0: 6f6d 6d61 6e64 2020 2020 2020 2054 6865  ommand       The
-000352f0: 2063 6f6d 6d61 6e64 206e 616d 6520 2d20   command name - 
-00035300: 6e6f 7420 7365 6e74 2074 6f20 7468 6520  not sent to the 
-00035310: 7365 7276 6572 0a20 2020 2020 2a20 4070  server.     * @p
-00035320: 6172 616d 2073 7472 696e 6720 2020 2024  aram string    $
-00035330: 636f 6d6d 616e 6473 7472 696e 6720 5468  commandstring Th
-00035340: 6520 6163 7475 616c 2063 6f6d 6d61 6e64  e actual command
-00035350: 2074 6f20 7365 6e64 0a20 2020 2020 2a20   to send.     * 
-00035360: 4070 6172 616d 2069 6e74 7c61 7272 6179  @param int|array
-00035370: 2024 6578 7065 6374 2020 2020 2020 2020   $expect        
-00035380: 4f6e 6520 6f72 206d 6f72 6520 6578 7065  One or more expe
-00035390: 6374 6564 2069 6e74 6567 6572 2073 7563  cted integer suc
-000353a0: 6365 7373 2063 6f64 6573 0a20 2020 2020  cess codes.     
-000353b0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-000353c0: 2062 6f6f 6c20 5472 7565 206f 6e20 7375   bool True on su
-000353d0: 6363 6573 730a 2020 2020 202a 2f0a 2020  ccess.     */.  
-000353e0: 2020 7072 6f74 6563 7465 6420 6675 6e63    protected func
-000353f0: 7469 6f6e 2073 656e 6443 6f6d 6d61 6e64  tion sendCommand
-00035400: 2824 636f 6d6d 616e 642c 2024 636f 6d6d  ($command, $comm
-00035410: 616e 6473 7472 696e 672c 2024 6578 7065  andstring, $expe
-00035420: 6374 290a 2020 2020 7b0a 2020 2020 2020  ct).    {.      
-00035430: 2020 6966 2028 2124 7468 6973 2d3e 636f    if (!$this->co
-00035440: 6e6e 6563 7465 6428 2929 207b 0a20 2020  nnected()) {.   
-00035450: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-00035460: 7365 7445 7272 6f72 2822 4361 6c6c 6564  setError("Called
-00035470: 2024 636f 6d6d 616e 6420 7769 7468 6f75   $command withou
-00035480: 7420 6265 696e 6720 636f 6e6e 6563 7465  t being connecte
-00035490: 6422 293b 0a0a 2020 2020 2020 2020 2020  d");..          
-000354a0: 2020 7265 7475 726e 2066 616c 7365 3b0a    return false;.
-000354b0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000354c0: 2020 2f2f 5265 6a65 6374 206c 696e 6520    //Reject line 
-000354d0: 6272 6561 6b73 2069 6e20 616c 6c20 636f  breaks in all co
-000354e0: 6d6d 616e 6473 0a20 2020 2020 2020 2069  mmands.        i
-000354f0: 6620 2828 7374 7270 6f73 2824 636f 6d6d  f ((strpos($comm
-00035500: 616e 6473 7472 696e 672c 2022 5c6e 2229  andstring, "\n")
-00035510: 2021 3d3d 2066 616c 7365 2920 7c7c 2028   !== false) || (
-00035520: 7374 7270 6f73 2824 636f 6d6d 616e 6473  strpos($commands
-00035530: 7472 696e 672c 2022 5c72 2229 2021 3d3d  tring, "\r") !==
-00035540: 2066 616c 7365 2929 207b 0a20 2020 2020   false)) {.     
-00035550: 2020 2020 2020 2024 7468 6973 2d3e 7365         $this->se
-00035560: 7445 7272 6f72 2822 436f 6d6d 616e 6420  tError("Command 
-00035570: 2724 636f 6d6d 616e 6427 2063 6f6e 7461  '$command' conta
-00035580: 696e 6564 206c 696e 6520 6272 6561 6b73  ined line breaks
-00035590: 2229 3b0a 0a20 2020 2020 2020 2020 2020  ");..           
-000355a0: 2072 6574 7572 6e20 6661 6c73 653b 0a20   return false;. 
-000355b0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000355c0: 2024 7468 6973 2d3e 636c 6965 6e74 5f73   $this->client_s
-000355d0: 656e 6428 2463 6f6d 6d61 6e64 7374 7269  end($commandstri
-000355e0: 6e67 202e 2073 7461 7469 633a 3a4c 452c  ng . static::LE,
-000355f0: 2024 636f 6d6d 616e 6429 3b0a 0a20 2020   $command);..   
-00035600: 2020 2020 2024 7468 6973 2d3e 6c61 7374       $this->last
-00035610: 5f72 6570 6c79 203d 2024 7468 6973 2d3e  _reply = $this->
-00035620: 6765 745f 6c69 6e65 7328 293b 0a20 2020  get_lines();.   
-00035630: 2020 2020 202f 2f46 6574 6368 2053 4d54       //Fetch SMT
-00035640: 5020 636f 6465 2061 6e64 2070 6f73 7369  P code and possi
-00035650: 626c 6520 6572 726f 7220 636f 6465 2065  ble error code e
-00035660: 7870 6c61 6e61 7469 6f6e 0a20 2020 2020  xplanation.     
-00035670: 2020 2024 6d61 7463 6865 7320 3d20 5b5d     $matches = []
-00035680: 3b0a 2020 2020 2020 2020 6966 2028 7072  ;.        if (pr
-00035690: 6567 5f6d 6174 6368 2827 2f5e 285b 5c64  eg_match('/^([\d
-000356a0: 5d7b 337d 295b 202d 5d28 3f3a 285b 5c64  ]{3})[ -](?:([\d
-000356b0: 5d5c 5c2e 5b5c 645d 5c5c 2e5b 5c64 5d7b  ]\\.[\d]\\.[\d]{
-000356c0: 312c 327d 2920 293f 2f27 2c20 2474 6869  1,2}) )?/', $thi
-000356d0: 732d 3e6c 6173 745f 7265 706c 792c 2024  s->last_reply, $
-000356e0: 6d61 7463 6865 7329 2920 7b0a 2020 2020  matches)) {.    
-000356f0: 2020 2020 2020 2020 2463 6f64 6520 3d20          $code = 
-00035700: 2869 6e74 2920 246d 6174 6368 6573 5b31  (int) $matches[1
-00035710: 5d3b 0a20 2020 2020 2020 2020 2020 2024  ];.            $
-00035720: 636f 6465 5f65 7820 3d20 2863 6f75 6e74  code_ex = (count
-00035730: 2824 6d61 7463 6865 7329 203e 2032 203f  ($matches) > 2 ?
-00035740: 2024 6d61 7463 6865 735b 325d 203a 206e   $matches[2] : n
-00035750: 756c 6c29 3b0a 2020 2020 2020 2020 2020  ull);.          
-00035760: 2020 2f2f 4375 7420 6f66 6620 6572 726f    //Cut off erro
-00035770: 7220 636f 6465 2066 726f 6d20 6561 6368  r code from each
-00035780: 2072 6573 706f 6e73 6520 6c69 6e65 0a20   response line. 
-00035790: 2020 2020 2020 2020 2020 2024 6465 7461             $deta
-000357a0: 696c 203d 2070 7265 675f 7265 706c 6163  il = preg_replac
-000357b0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000357c0: 2020 2022 2f7b 2463 6f64 657d 5b20 2d5d     "/{$code}[ -]
-000357d0: 2220 2e0a 2020 2020 2020 2020 2020 2020  " ..            
-000357e0: 2020 2020 2824 636f 6465 5f65 7820 3f20      ($code_ex ? 
-000357f0: 7374 725f 7265 706c 6163 6528 272e 272c  str_replace('.',
-00035800: 2027 5c5c 2e27 2c20 2463 6f64 655f 6578   '\\.', $code_ex
-00035810: 2920 2e20 2720 2720 3a20 2727 2920 2e20  ) . ' ' : '') . 
-00035820: 272f 6d27 2c0a 2020 2020 2020 2020 2020  '/m',.          
-00035830: 2020 2020 2020 2727 2c0a 2020 2020 2020        '',.      
-00035840: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-00035850: 3e6c 6173 745f 7265 706c 790a 2020 2020  >last_reply.    
-00035860: 2020 2020 2020 2020 293b 0a20 2020 2020          );.     
-00035870: 2020 207d 2065 6c73 6520 7b0a 2020 2020     } else {.    
-00035880: 2020 2020 2020 2020 2f2f 4661 6c6c 2062          //Fall b
-00035890: 6163 6b20 746f 2073 696d 706c 6520 7061  ack to simple pa
-000358a0: 7273 696e 6720 6966 2072 6567 6578 2066  rsing if regex f
-000358b0: 6169 6c73 0a20 2020 2020 2020 2020 2020  ails.           
-000358c0: 2024 636f 6465 203d 2028 696e 7429 2073   $code = (int) s
-000358d0: 7562 7374 7228 2474 6869 732d 3e6c 6173  ubstr($this->las
-000358e0: 745f 7265 706c 792c 2030 2c20 3329 3b0a  t_reply, 0, 3);.
-000358f0: 2020 2020 2020 2020 2020 2020 2463 6f64              $cod
-00035900: 655f 6578 203d 206e 756c 6c3b 0a20 2020  e_ex = null;.   
-00035910: 2020 2020 2020 2020 2024 6465 7461 696c           $detail
-00035920: 203d 2073 7562 7374 7228 2474 6869 732d   = substr($this-
-00035930: 3e6c 6173 745f 7265 706c 792c 2034 293b  >last_reply, 4);
-00035940: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00035950: 2020 2020 2474 6869 732d 3e65 6465 6275      $this->edebu
-00035960: 6728 2753 4552 5645 5220 2d3e 2043 4c49  g('SERVER -> CLI
-00035970: 454e 543a 2027 202e 2024 7468 6973 2d3e  ENT: ' . $this->
-00035980: 6c61 7374 5f72 6570 6c79 2c20 7365 6c66  last_reply, self
-00035990: 3a3a 4445 4255 475f 5345 5256 4552 293b  ::DEBUG_SERVER);
-000359a0: 0a0a 2020 2020 2020 2020 6966 2028 2169  ..        if (!i
-000359b0: 6e5f 6172 7261 7928 2463 6f64 652c 2028  n_array($code, (
-000359c0: 6172 7261 7929 2024 6578 7065 6374 2c20  array) $expect, 
-000359d0: 7472 7565 2929 207b 0a20 2020 2020 2020  true)) {.       
-000359e0: 2020 2020 2024 7468 6973 2d3e 7365 7445       $this->setE
-000359f0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00035a00: 2020 2020 2020 2224 636f 6d6d 616e 6420        "$command 
-00035a10: 636f 6d6d 616e 6420 6661 696c 6564 222c  command failed",
-00035a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035a30: 2024 6465 7461 696c 2c0a 2020 2020 2020   $detail,.      
-00035a40: 2020 2020 2020 2020 2020 2463 6f64 652c            $code,
-00035a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035a60: 2024 636f 6465 5f65 780a 2020 2020 2020   $code_ex.      
-00035a70: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
-00035a80: 2020 2020 2024 7468 6973 2d3e 6564 6562       $this->edeb
-00035a90: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
-00035aa0: 2020 2020 2753 4d54 5020 4552 524f 523a      'SMTP ERROR:
-00035ab0: 2027 202e 2024 7468 6973 2d3e 6572 726f   ' . $this->erro
-00035ac0: 725b 2765 7272 6f72 275d 202e 2027 3a20  r['error'] . ': 
-00035ad0: 2720 2e20 2474 6869 732d 3e6c 6173 745f  ' . $this->last_
-00035ae0: 7265 706c 792c 0a20 2020 2020 2020 2020  reply,.         
-00035af0: 2020 2020 2020 2073 656c 663a 3a44 4542         self::DEB
-00035b00: 5547 5f43 4c49 454e 540a 2020 2020 2020  UG_CLIENT.      
-00035b10: 2020 2020 2020 293b 0a0a 2020 2020 2020        );..      
-00035b20: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
-00035b30: 7365 3b0a 2020 2020 2020 2020 7d0a 0a20  se;.        }.. 
-00035b40: 2020 2020 2020 202f 2f44 6f6e 2774 2063         //Don't c
-00035b50: 6c65 6172 2074 6865 2065 7272 6f72 2073  lear the error s
-00035b60: 746f 7265 2077 6865 6e20 7573 696e 6720  tore when using 
-00035b70: 6b65 6570 616c 6976 650a 2020 2020 2020  keepalive.      
-00035b80: 2020 6966 2028 2463 6f6d 6d61 6e64 2021    if ($command !
-00035b90: 3d3d 2027 5253 4554 2729 207b 0a20 2020  == 'RSET') {.   
-00035ba0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-00035bb0: 7365 7445 7272 6f72 2827 2729 3b0a 2020  setError('');.  
-00035bc0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00035bd0: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
-00035be0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00035bf0: 2020 2a20 5365 6e64 2061 6e20 534d 5450    * Send an SMTP
-00035c00: 2053 414d 4c20 636f 6d6d 616e 642e 0a20   SAML command.. 
-00035c10: 2020 2020 2a20 5374 6172 7473 2061 206d      * Starts a m
-00035c20: 6169 6c20 7472 616e 7361 6374 696f 6e20  ail transaction 
-00035c30: 6672 6f6d 2074 6865 2065 6d61 696c 2061  from the email a
-00035c40: 6464 7265 7373 2073 7065 6369 6669 6564  ddress specified
-00035c50: 2069 6e20 2466 726f 6d2e 0a20 2020 2020   in $from..     
-00035c60: 2a20 5265 7475 726e 7320 7472 7565 2069  * Returns true i
-00035c70: 6620 7375 6363 6573 7366 756c 206f 7220  f successful or 
-00035c80: 6661 6c73 6520 6f74 6865 7277 6973 652e  false otherwise.
-00035c90: 2049 6620 5472 7565 0a20 2020 2020 2a20   If True.     * 
-00035ca0: 7468 6520 6d61 696c 2074 7261 6e73 6163  the mail transac
-00035cb0: 7469 6f6e 2069 7320 7374 6172 7465 6420  tion is started 
-00035cc0: 616e 6420 7468 656e 206f 6e65 206f 7220  and then one or 
-00035cd0: 6d6f 7265 2072 6563 6970 6965 6e74 0a20  more recipient. 
-00035ce0: 2020 2020 2a20 636f 6d6d 616e 6473 206d      * commands m
-00035cf0: 6179 2062 6520 6361 6c6c 6564 2066 6f6c  ay be called fol
-00035d00: 6c6f 7765 6420 6279 2061 2064 6174 6120  lowed by a data 
-00035d10: 636f 6d6d 616e 642e 2054 6869 7320 636f  command. This co
-00035d20: 6d6d 616e 640a 2020 2020 202a 2077 696c  mmand.     * wil
-00035d30: 6c20 7365 6e64 2074 6865 206d 6573 7361  l send the messa
-00035d40: 6765 2074 6f20 7468 6520 7573 6572 7320  ge to the users 
-00035d50: 7465 726d 696e 616c 2069 6620 7468 6579  terminal if they
-00035d60: 2061 7265 206c 6f67 6765 640a 2020 2020   are logged.    
-00035d70: 202a 2069 6e20 616e 6420 7365 6e64 2074   * in and send t
-00035d80: 6865 6d20 616e 2065 6d61 696c 2e0a 2020  hem an email..  
-00035d90: 2020 202a 2049 6d70 6c65 6d65 6e74 7320     * Implements 
-00035da0: 5246 4320 3832 313a 2053 414d 4c20 3c53  RFC 821: SAML <S
-00035db0: 503e 2046 524f 4d3a 3c72 6576 6572 7365  P> FROM:<reverse
-00035dc0: 2d70 6174 683e 203c 4352 4c46 3e2e 0a20  -path> <CRLF>.. 
-00035dd0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-00035de0: 7261 6d20 7374 7269 6e67 2024 6672 6f6d  ram string $from
-00035df0: 2054 6865 2061 6464 7265 7373 2074 6865   The address the
-00035e00: 206d 6573 7361 6765 2069 7320 6672 6f6d   message is from
-00035e10: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00035e20: 7265 7475 726e 2062 6f6f 6c0a 2020 2020  return bool.    
-00035e30: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
-00035e40: 756e 6374 696f 6e20 7365 6e64 416e 644d  unction sendAndM
-00035e50: 6169 6c28 2466 726f 6d29 0a20 2020 207b  ail($from).    {
-00035e60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00035e70: 2474 6869 732d 3e73 656e 6443 6f6d 6d61  $this->sendComma
-00035e80: 6e64 2827 5341 4d4c 272c 2022 5341 4d4c  nd('SAML', "SAML
-00035e90: 2046 524f 4d3a 2466 726f 6d22 2c20 3235   FROM:$from", 25
-00035ea0: 3029 3b0a 2020 2020 7d0a 0a20 2020 202f  0);.    }..    /
-00035eb0: 2a2a 0a20 2020 2020 2a20 5365 6e64 2061  **.     * Send a
-00035ec0: 6e20 534d 5450 2056 5246 5920 636f 6d6d  n SMTP VRFY comm
-00035ed0: 616e 642e 0a20 2020 2020 2a0a 2020 2020  and..     *.    
-00035ee0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
-00035ef0: 2024 6e61 6d65 2054 6865 206e 616d 6520   $name The name 
-00035f00: 746f 2076 6572 6966 790a 2020 2020 202a  to verify.     *
-00035f10: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
-00035f20: 626f 6f6c 0a20 2020 2020 2a2f 0a20 2020  bool.     */.   
-00035f30: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
-00035f40: 2076 6572 6966 7928 246e 616d 6529 0a20   verify($name). 
-00035f50: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
-00035f60: 7572 6e20 2474 6869 732d 3e73 656e 6443  urn $this->sendC
-00035f70: 6f6d 6d61 6e64 2827 5652 4659 272c 2022  ommand('VRFY', "
-00035f80: 5652 4659 2024 6e61 6d65 222c 205b 3235  VRFY $name", [25
-00035f90: 302c 2032 3531 5d29 3b0a 2020 2020 7d0a  0, 251]);.    }.
-00035fa0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00035fb0: 5365 6e64 2061 6e20 534d 5450 204e 4f4f  Send an SMTP NOO
-00035fc0: 5020 636f 6d6d 616e 642e 0a20 2020 2020  P command..     
-00035fd0: 2a20 5573 6564 2074 6f20 6b65 6570 206b  * Used to keep k
-00035fe0: 6565 702d 616c 6976 6573 2061 6c69 7665  eep-alives alive
-00035ff0: 2c20 646f 6573 6e27 7420 6163 7475 616c  , doesn't actual
-00036000: 6c79 2064 6f20 616e 7974 6869 6e67 2e0a  ly do anything..
-00036010: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00036020: 6574 7572 6e20 626f 6f6c 0a20 2020 2020  eturn bool.     
-00036030: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
-00036040: 6e63 7469 6f6e 206e 6f6f 7028 290a 2020  nction noop().  
-00036050: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
-00036060: 726e 2024 7468 6973 2d3e 7365 6e64 436f  rn $this->sendCo
-00036070: 6d6d 616e 6428 274e 4f4f 5027 2c20 274e  mmand('NOOP', 'N
-00036080: 4f4f 5027 2c20 3235 3029 3b0a 2020 2020  OOP', 250);.    
-00036090: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-000360a0: 2a20 5365 6e64 2061 6e20 534d 5450 2054  * Send an SMTP T
-000360b0: 5552 4e20 636f 6d6d 616e 642e 0a20 2020  URN command..   
-000360c0: 2020 2a20 5468 6973 2069 7320 616e 206f    * This is an o
-000360d0: 7074 696f 6e61 6c20 636f 6d6d 616e 6420  ptional command 
-000360e0: 666f 7220 534d 5450 2074 6861 7420 7468  for SMTP that th
-000360f0: 6973 2063 6c61 7373 2064 6f65 7320 6e6f  is class does no
-00036100: 7420 7375 7070 6f72 742e 0a20 2020 2020  t support..     
-00036110: 2a20 5468 6973 206d 6574 686f 6420 6973  * This method is
-00036120: 2068 6572 6520 746f 206d 616b 6520 7468   here to make th
-00036130: 6520 5246 4338 3231 2044 6566 696e 6974  e RFC821 Definit
-00036140: 696f 6e20 636f 6d70 6c65 7465 2066 6f72  ion complete for
-00036150: 2074 6869 7320 636c 6173 730a 2020 2020   this class.    
-00036160: 202a 2061 6e64 205f 6d61 795f 2062 6520   * and _may_ be 
-00036170: 696d 706c 656d 656e 7465 6420 696e 2066  implemented in f
-00036180: 7574 7572 652e 0a20 2020 2020 2a20 496d  uture..     * Im
-00036190: 706c 656d 656e 7473 2066 726f 6d20 5246  plements from RF
-000361a0: 4320 3832 313a 2054 5552 4e20 3c43 524c  C 821: TURN <CRL
-000361b0: 463e 2e0a 2020 2020 202a 0a20 2020 2020  F>..     *.     
-000361c0: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
-000361d0: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-000361e0: 6320 6675 6e63 7469 6f6e 2074 7572 6e28  c function turn(
-000361f0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00036200: 2474 6869 732d 3e73 6574 4572 726f 7228  $this->setError(
-00036210: 2754 6865 2053 4d54 5020 5455 524e 2063  'The SMTP TURN c
-00036220: 6f6d 6d61 6e64 2069 7320 6e6f 7420 696d  ommand is not im
-00036230: 706c 656d 656e 7465 6427 293b 0a20 2020  plemented');.   
-00036240: 2020 2020 2024 7468 6973 2d3e 6564 6562       $this->edeb
-00036250: 7567 2827 534d 5450 204e 4f54 4943 453a  ug('SMTP NOTICE:
-00036260: 2027 202e 2024 7468 6973 2d3e 6572 726f   ' . $this->erro
-00036270: 725b 2765 7272 6f72 275d 2c20 7365 6c66  r['error'], self
-00036280: 3a3a 4445 4255 475f 434c 4945 4e54 293b  ::DEBUG_CLIENT);
-00036290: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000362a0: 2066 616c 7365 3b0a 2020 2020 7d0a 0a20   false;.    }.. 
-000362b0: 2020 202f 2a2a 0a20 2020 2020 2a20 5365     /**.     * Se
-000362c0: 6e64 2072 6177 2064 6174 6120 746f 2074  nd raw data to t
-000362d0: 6865 2073 6572 7665 722e 0a20 2020 2020  he server..     
-000362e0: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-000362f0: 7374 7269 6e67 2024 6461 7461 2020 2020  string $data    
-00036300: 5468 6520 6461 7461 2074 6f20 7365 6e64  The data to send
-00036310: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00036320: 7472 696e 6720 2463 6f6d 6d61 6e64 204f  tring $command O
-00036330: 7074 696f 6e61 6c6c 792c 2074 6865 2063  ptionally, the c
-00036340: 6f6d 6d61 6e64 2074 6869 7320 6973 2070  ommand this is p
-00036350: 6172 7420 6f66 2c20 7573 6564 206f 6e6c  art of, used onl
-00036360: 7920 666f 7220 636f 6e74 726f 6c6c 696e  y for controllin
-00036370: 6720 6465 6275 6720 6f75 7470 7574 0a20  g debug output. 
-00036380: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
-00036390: 7475 726e 2069 6e74 7c62 6f6f 6c20 5468  turn int|bool Th
-000363a0: 6520 6e75 6d62 6572 206f 6620 6279 7465  e number of byte
-000363b0: 7320 7365 6e74 2074 6f20 7468 6520 7365  s sent to the se
-000363c0: 7276 6572 206f 7220 6661 6c73 6520 6f6e  rver or false on
-000363d0: 2065 7272 6f72 0a20 2020 2020 2a2f 0a20   error.     */. 
-000363e0: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
-000363f0: 6f6e 2063 6c69 656e 745f 7365 6e64 2824  on client_send($
-00036400: 6461 7461 2c20 2463 6f6d 6d61 6e64 203d  data, $command =
-00036410: 2027 2729 0a20 2020 207b 0a20 2020 2020   '').    {.     
-00036420: 2020 202f 2f49 6620 534d 5450 2074 7261     //If SMTP tra
-00036430: 6e73 6372 6970 7473 2061 7265 206c 6566  nscripts are lef
-00036440: 7420 656e 6162 6c65 642c 206f 7220 6465  t enabled, or de
-00036450: 6275 6720 6f75 7470 7574 2069 7320 706f  bug output is po
-00036460: 7374 6564 206f 6e6c 696e 650a 2020 2020  sted online.    
-00036470: 2020 2020 2f2f 6974 2063 616e 206c 6561      //it can lea
-00036480: 6b20 6372 6564 656e 7469 616c 732c 2073  k credentials, s
-00036490: 6f20 6869 6465 2063 7265 6465 6e74 6961  o hide credentia
-000364a0: 6c73 2069 6e20 616c 6c20 6275 7420 6c6f  ls in all but lo
-000364b0: 7765 7374 206c 6576 656c 0a20 2020 2020  west level.     
-000364c0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-000364d0: 2020 2020 7365 6c66 3a3a 4445 4255 475f      self::DEBUG_
-000364e0: 4c4f 574c 4556 454c 203e 2024 7468 6973  LOWLEVEL > $this
-000364f0: 2d3e 646f 5f64 6562 7567 2026 260a 2020  ->do_debug &&.  
-00036500: 2020 2020 2020 2020 2020 696e 5f61 7272            in_arr
-00036510: 6179 2824 636f 6d6d 616e 642c 205b 2755  ay($command, ['U
-00036520: 7365 7220 2620 5061 7373 776f 7264 272c  ser & Password',
-00036530: 2027 5573 6572 6e61 6d65 272c 2027 5061   'Username', 'Pa
-00036540: 7373 776f 7264 275d 2c20 7472 7565 290a  ssword'], true).
-00036550: 2020 2020 2020 2020 2920 7b0a 2020 2020          ) {.    
-00036560: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-00036570: 6465 6275 6728 2743 4c49 454e 5420 2d3e  debug('CLIENT ->
-00036580: 2053 4552 5645 523a 205b 6372 6564 656e   SERVER: [creden
-00036590: 7469 616c 7320 6869 6464 656e 5d27 2c20  tials hidden]', 
-000365a0: 7365 6c66 3a3a 4445 4255 475f 434c 4945  self::DEBUG_CLIE
-000365b0: 4e54 293b 0a20 2020 2020 2020 207d 2065  NT);.        } e
-000365c0: 6c73 6520 7b0a 2020 2020 2020 2020 2020  lse {.          
-000365d0: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
-000365e0: 2743 4c49 454e 5420 2d3e 2053 4552 5645  'CLIENT -> SERVE
-000365f0: 523a 2027 202e 2024 6461 7461 2c20 7365  R: ' . $data, se
-00036600: 6c66 3a3a 4445 4255 475f 434c 4945 4e54  lf::DEBUG_CLIENT
-00036610: 293b 0a20 2020 2020 2020 207d 0a20 2020  );.        }.   
-00036620: 2020 2020 2073 6574 5f65 7272 6f72 5f68       set_error_h
-00036630: 616e 646c 6572 285b 2474 6869 732c 2027  andler([$this, '
-00036640: 6572 726f 7248 616e 646c 6572 275d 293b  errorHandler']);
-00036650: 0a20 2020 2020 2020 2024 7265 7375 6c74  .        $result
-00036660: 203d 2066 7772 6974 6528 2474 6869 732d   = fwrite($this-
-00036670: 3e73 6d74 705f 636f 6e6e 2c20 2464 6174  >smtp_conn, $dat
-00036680: 6129 3b0a 2020 2020 2020 2020 7265 7374  a);.        rest
-00036690: 6f72 655f 6572 726f 725f 6861 6e64 6c65  ore_error_handle
-000366a0: 7228 293b 0a0a 2020 2020 2020 2020 7265  r();..        re
-000366b0: 7475 726e 2024 7265 7375 6c74 3b0a 2020  turn $result;.  
-000366c0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-000366d0: 2020 2a20 4765 7420 7468 6520 6c61 7465    * Get the late
-000366e0: 7374 2065 7272 6f72 2e0a 2020 2020 202a  st error..     *
-000366f0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
-00036700: 6172 7261 790a 2020 2020 202a 2f0a 2020  array.     */.  
-00036710: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
-00036720: 6e20 6765 7445 7272 6f72 2829 0a20 2020  n getError().   
-00036730: 207b 0a20 2020 2020 2020 2072 6574 7572   {.        retur
-00036740: 6e20 2474 6869 732d 3e65 7272 6f72 3b0a  n $this->error;.
-00036750: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
-00036760: 2020 2020 2a20 4765 7420 534d 5450 2065      * Get SMTP e
-00036770: 7874 656e 7369 6f6e 7320 6176 6169 6c61  xtensions availa
-00036780: 626c 6520 6f6e 2074 6865 2073 6572 7665  ble on the serve
-00036790: 722e 0a20 2020 2020 2a0a 2020 2020 202a  r..     *.     *
-000367a0: 2040 7265 7475 726e 2061 7272 6179 7c6e   @return array|n
-000367b0: 756c 6c0a 2020 2020 202a 2f0a 2020 2020  ull.     */.    
-000367c0: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
-000367d0: 6765 7453 6572 7665 7245 7874 4c69 7374  getServerExtList
-000367e0: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
-000367f0: 2072 6574 7572 6e20 2474 6869 732d 3e73   return $this->s
-00036800: 6572 7665 725f 6361 7073 3b0a 2020 2020  erver_caps;.    
-00036810: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-00036820: 2a20 4765 7420 6d65 7461 6461 7461 2061  * Get metadata a
-00036830: 626f 7574 2074 6865 2053 4d54 5020 7365  bout the SMTP se
-00036840: 7276 6572 2066 726f 6d20 6974 7320 4845  rver from its HE
-00036850: 4c4f 2f45 484c 4f20 7265 7370 6f6e 7365  LO/EHLO response
-00036860: 2e0a 2020 2020 202a 2054 6865 206d 6574  ..     * The met
-00036870: 686f 6420 776f 726b 7320 696e 2074 6872  hod works in thr
-00036880: 6565 2077 6179 732c 2064 6570 656e 6465  ee ways, depende
-00036890: 6e74 206f 6e20 6172 6775 6d65 6e74 2076  nt on argument v
-000368a0: 616c 7565 2061 6e64 2063 7572 7265 6e74  alue and current
-000368b0: 2073 7461 7465 3a0a 2020 2020 202a 2020   state:.     *  
-000368c0: 2031 2e20 4845 4c4f 2f45 484c 4f20 6861   1. HELO/EHLO ha
-000368d0: 7320 6e6f 7420 6265 656e 2073 656e 7420  s not been sent 
-000368e0: 2d20 7265 7475 726e 7320 6e75 6c6c 2061  - returns null a
-000368f0: 6e64 2070 6f70 756c 6174 6573 2024 7468  nd populates $th
-00036900: 6973 2d3e 6572 726f 722e 0a20 2020 2020  is->error..     
-00036910: 2a20 2020 322e 2048 454c 4f20 6861 7320  *   2. HELO has 
-00036920: 6265 656e 2073 656e 7420 2d0a 2020 2020  been sent -.    
-00036930: 202a 2020 2020 2024 6e61 6d65 203d 3d20   *     $name == 
-00036940: 2748 454c 4f27 3a20 7265 7475 726e 7320  'HELO': returns 
-00036950: 7365 7276 6572 206e 616d 650a 2020 2020  server name.    
-00036960: 202a 2020 2020 2024 6e61 6d65 203d 3d20   *     $name == 
-00036970: 2745 484c 4f27 3a20 7265 7475 726e 7320  'EHLO': returns 
-00036980: 626f 6f6c 6561 6e20 6661 6c73 650a 2020  boolean false.  
-00036990: 2020 202a 2020 2020 2024 6e61 6d65 203d     *     $name =
-000369a0: 3d20 616e 7920 6f74 6865 7220 7374 7269  = any other stri
-000369b0: 6e67 3a20 7265 7475 726e 7320 6e75 6c6c  ng: returns null
-000369c0: 2061 6e64 2070 6f70 756c 6174 6573 2024   and populates $
-000369d0: 7468 6973 2d3e 6572 726f 720a 2020 2020  this->error.    
-000369e0: 202a 2020 2033 2e20 4548 4c4f 2068 6173   *   3. EHLO has
-000369f0: 2062 6565 6e20 7365 6e74 202d 0a20 2020   been sent -.   
-00036a00: 2020 2a20 2020 2020 246e 616d 6520 3d3d    *     $name ==
-00036a10: 2027 4845 4c4f 277c 2745 484c 4f27 3a20   'HELO'|'EHLO': 
-00036a20: 7265 7475 726e 7320 7468 6520 7365 7276  returns the serv
-00036a30: 6572 206e 616d 650a 2020 2020 202a 2020  er name.     *  
-00036a40: 2020 2024 6e61 6d65 203d 3d20 616e 7920     $name == any 
-00036a50: 6f74 6865 7220 7374 7269 6e67 3a20 6966  other string: if
-00036a60: 2065 7874 656e 7369 6f6e 2024 6e61 6d65   extension $name
-00036a70: 2065 7869 7374 732c 2072 6574 7572 6e73   exists, returns
-00036a80: 2054 7275 650a 2020 2020 202a 2020 2020   True.     *    
-00036a90: 2020 206f 7220 6974 7320 6f70 7469 6f6e     or its option
-00036aa0: 7320 2865 2e67 2e20 4155 5448 206d 6563  s (e.g. AUTH mec
-00036ab0: 6861 6e69 736d 7320 7375 7070 6f72 7465  hanisms supporte
-00036ac0: 6429 2e20 4f74 6865 7277 6973 6520 7265  d). Otherwise re
-00036ad0: 7475 726e 7320 4661 6c73 652e 0a20 2020  turns False..   
-00036ae0: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
-00036af0: 6d20 7374 7269 6e67 2024 6e61 6d65 204e  m string $name N
-00036b00: 616d 6520 6f66 2053 4d54 5020 6578 7465  ame of SMTP exte
-00036b10: 6e73 696f 6e20 6f72 2027 4845 4c4f 277c  nsion or 'HELO'|
-00036b20: 2745 484c 4f27 0a20 2020 2020 2a0a 2020  'EHLO'.     *.  
-00036b30: 2020 202a 2040 7265 7475 726e 2073 7472     * @return str
-00036b40: 696e 677c 626f 6f6c 7c6e 756c 6c0a 2020  ing|bool|null.  
-00036b50: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
-00036b60: 2066 756e 6374 696f 6e20 6765 7453 6572   function getSer
-00036b70: 7665 7245 7874 2824 6e61 6d65 290a 2020  verExt($name).  
-00036b80: 2020 7b0a 2020 2020 2020 2020 6966 2028    {.        if (
-00036b90: 2124 7468 6973 2d3e 7365 7276 6572 5f63  !$this->server_c
-00036ba0: 6170 7329 207b 0a20 2020 2020 2020 2020  aps) {.         
-00036bb0: 2020 2024 7468 6973 2d3e 7365 7445 7272     $this->setErr
-00036bc0: 6f72 2827 4e6f 2048 454c 4f2f 4548 4c4f  or('No HELO/EHLO
-00036bd0: 2077 6173 2073 656e 7427 293b 0a0a 2020   was sent');..  
-00036be0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00036bf0: 206e 756c 6c3b 0a20 2020 2020 2020 207d   null;.        }
-00036c00: 0a0a 2020 2020 2020 2020 6966 2028 2161  ..        if (!a
-00036c10: 7272 6179 5f6b 6579 5f65 7869 7374 7328  rray_key_exists(
-00036c20: 246e 616d 652c 2024 7468 6973 2d3e 7365  $name, $this->se
-00036c30: 7276 6572 5f63 6170 7329 2920 7b0a 2020  rver_caps)) {.  
-00036c40: 2020 2020 2020 2020 2020 6966 2028 2748            if ('H
-00036c50: 454c 4f27 203d 3d3d 2024 6e61 6d65 2920  ELO' === $name) 
-00036c60: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00036c70: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
-00036c80: 7365 7276 6572 5f63 6170 735b 2745 484c  server_caps['EHL
-00036c90: 4f27 5d3b 0a20 2020 2020 2020 2020 2020  O'];.           
-00036ca0: 207d 0a20 2020 2020 2020 2020 2020 2069   }.            i
-00036cb0: 6620 2827 4548 4c4f 2720 3d3d 3d20 246e  f ('EHLO' === $n
-00036cc0: 616d 6520 7c7c 2061 7272 6179 5f6b 6579  ame || array_key
-00036cd0: 5f65 7869 7374 7328 2745 484c 4f27 2c20  _exists('EHLO', 
-00036ce0: 2474 6869 732d 3e73 6572 7665 725f 6361  $this->server_ca
-00036cf0: 7073 2929 207b 0a20 2020 2020 2020 2020  ps)) {.         
-00036d00: 2020 2020 2020 2072 6574 7572 6e20 6661         return fa
-00036d10: 6c73 653b 0a20 2020 2020 2020 2020 2020  lse;.           
-00036d20: 207d 0a20 2020 2020 2020 2020 2020 2024   }.            $
-00036d30: 7468 6973 2d3e 7365 7445 7272 6f72 2827  this->setError('
-00036d40: 4845 4c4f 2068 616e 6473 6861 6b65 2077  HELO handshake w
-00036d50: 6173 2075 7365 643b 204e 6f20 696e 666f  as used; No info
-00036d60: 726d 6174 696f 6e20 6162 6f75 7420 7365  rmation about se
-00036d70: 7276 6572 2065 7874 656e 7369 6f6e 7320  rver extensions 
-00036d80: 6176 6169 6c61 626c 6527 293b 0a0a 2020  available');..  
-00036d90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00036da0: 206e 756c 6c3b 0a20 2020 2020 2020 207d   null;.        }
-00036db0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00036dc0: 2024 7468 6973 2d3e 7365 7276 6572 5f63   $this->server_c
-00036dd0: 6170 735b 246e 616d 655d 3b0a 2020 2020  aps[$name];.    
-00036de0: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
-00036df0: 2a20 4765 7420 7468 6520 6c61 7374 2072  * Get the last r
-00036e00: 6570 6c79 2066 726f 6d20 7468 6520 7365  eply from the se
-00036e10: 7276 6572 2e0a 2020 2020 202a 0a20 2020  rver..     *.   
-00036e20: 2020 2a20 4072 6574 7572 6e20 7374 7269    * @return stri
-00036e30: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
-00036e40: 7562 6c69 6320 6675 6e63 7469 6f6e 2067  ublic function g
-00036e50: 6574 4c61 7374 5265 706c 7928 290a 2020  etLastReply().  
-00036e60: 2020 7b0a 2020 2020 2020 2020 7265 7475    {.        retu
-00036e70: 726e 2024 7468 6973 2d3e 6c61 7374 5f72  rn $this->last_r
-00036e80: 6570 6c79 3b0a 2020 2020 7d0a 0a20 2020  eply;.    }..   
-00036e90: 202f 2a2a 0a20 2020 2020 2a20 5265 6164   /**.     * Read
-00036ea0: 2074 6865 2053 4d54 5020 7365 7276 6572   the SMTP server
-00036eb0: 2773 2072 6573 706f 6e73 652e 0a20 2020  's response..   
-00036ec0: 2020 2a20 4569 7468 6572 2062 6566 6f72    * Either befor
-00036ed0: 6520 656f 6620 6f72 2073 6f63 6b65 7420  e eof or socket 
-00036ee0: 7469 6d65 6f75 7420 6f63 6375 7273 206f  timeout occurs o
-00036ef0: 6e20 7468 6520 6f70 6572 6174 696f 6e2e  n the operation.
-00036f00: 0a20 2020 2020 2a20 5769 7468 2053 4d54  .     * With SMT
-00036f10: 5020 7765 2063 616e 2074 656c 6c20 6966  P we can tell if
-00036f20: 2077 6520 6861 7665 206d 6f72 6520 6c69   we have more li
-00036f30: 6e65 7320 746f 2072 6561 6420 6966 2074  nes to read if t
-00036f40: 6865 0a20 2020 2020 2a20 3474 6820 6368  he.     * 4th ch
-00036f50: 6172 6163 7465 7220 6973 2027 2d27 2073  aracter is '-' s
-00036f60: 796d 626f 6c2e 2049 6620 6974 2069 7320  ymbol. If it is 
-00036f70: 6120 7370 6163 6520 7468 656e 2077 6520  a space then we 
-00036f80: 646f 6e27 740a 2020 2020 202a 206e 6565  don't.     * nee
-00036f90: 6420 746f 2072 6561 6420 616e 7974 6869  d to read anythi
-00036fa0: 6e67 2065 6c73 652e 0a20 2020 2020 2a0a  ng else..     *.
-00036fb0: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
-00036fc0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
-00036fd0: 2020 7072 6f74 6563 7465 6420 6675 6e63    protected func
-00036fe0: 7469 6f6e 2067 6574 5f6c 696e 6573 2829  tion get_lines()
-00036ff0: 0a20 2020 207b 0a20 2020 2020 2020 202f  .    {.        /
-00037000: 2f49 6620 7468 6520 636f 6e6e 6563 7469  /If the connecti
-00037010: 6f6e 2069 7320 6261 642c 2067 6976 6520  on is bad, give 
-00037020: 7570 2073 7472 6169 6768 7420 6177 6179  up straight away
-00037030: 0a20 2020 2020 2020 2069 6620 2821 6973  .        if (!is
-00037040: 5f72 6573 6f75 7263 6528 2474 6869 732d  _resource($this-
-00037050: 3e73 6d74 705f 636f 6e6e 2929 207b 0a20  >smtp_conn)) {. 
-00037060: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00037070: 6e20 2727 3b0a 2020 2020 2020 2020 7d0a  n '';.        }.
-00037080: 2020 2020 2020 2020 2464 6174 6120 3d20          $data = 
-00037090: 2727 3b0a 2020 2020 2020 2020 2465 6e64  '';.        $end
-000370a0: 7469 6d65 203d 2030 3b0a 2020 2020 2020  time = 0;.      
-000370b0: 2020 7374 7265 616d 5f73 6574 5f74 696d    stream_set_tim
-000370c0: 656f 7574 2824 7468 6973 2d3e 736d 7470  eout($this->smtp
-000370d0: 5f63 6f6e 6e2c 2024 7468 6973 2d3e 5469  _conn, $this->Ti
-000370e0: 6d65 6f75 7429 3b0a 2020 2020 2020 2020  meout);.        
-000370f0: 6966 2028 2474 6869 732d 3e54 696d 656c  if ($this->Timel
-00037100: 696d 6974 203e 2030 2920 7b0a 2020 2020  imit > 0) {.    
-00037110: 2020 2020 2020 2020 2465 6e64 7469 6d65          $endtime
-00037120: 203d 2074 696d 6528 2920 2b20 2474 6869   = time() + $thi
-00037130: 732d 3e54 696d 656c 696d 6974 3b0a 2020  s->Timelimit;.  
-00037140: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00037150: 2473 656c 5220 3d20 5b24 7468 6973 2d3e  $selR = [$this->
-00037160: 736d 7470 5f63 6f6e 6e5d 3b0a 2020 2020  smtp_conn];.    
-00037170: 2020 2020 2473 656c 5720 3d20 6e75 6c6c      $selW = null
-00037180: 3b0a 2020 2020 2020 2020 7768 696c 6520  ;.        while 
-00037190: 2869 735f 7265 736f 7572 6365 2824 7468  (is_resource($th
-000371a0: 6973 2d3e 736d 7470 5f63 6f6e 6e29 2026  is->smtp_conn) &
-000371b0: 2620 2166 656f 6628 2474 6869 732d 3e73  & !feof($this->s
-000371c0: 6d74 705f 636f 6e6e 2929 207b 0a20 2020  mtp_conn)) {.   
-000371d0: 2020 2020 2020 2020 202f 2f4d 7573 7420           //Must 
-000371e0: 7061 7373 2076 6172 7320 696e 2068 6572  pass vars in her
-000371f0: 6520 6173 2070 6172 616d 7320 6172 6520  e as params are 
-00037200: 6279 2072 6566 6572 656e 6365 0a20 2020  by reference.   
-00037210: 2020 2020 2020 2020 202f 2f73 6f6c 7574           //solut
-00037220: 696f 6e20 666f 7220 7369 676e 616c 7320  ion for signals 
-00037230: 696e 7370 6972 6564 2062 7920 6874 7470  inspired by http
-00037240: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f73  s://github.com/s
-00037250: 796d 666f 6e79 2f73 796d 666f 6e79 2f70  ymfony/symfony/p
-00037260: 756c 6c2f 3635 3430 0a20 2020 2020 2020  ull/6540.       
-00037270: 2020 2020 2073 6574 5f65 7272 6f72 5f68       set_error_h
-00037280: 616e 646c 6572 285b 2474 6869 732c 2027  andler([$this, '
-00037290: 6572 726f 7248 616e 646c 6572 275d 293b  errorHandler']);
-000372a0: 0a20 2020 2020 2020 2020 2020 2024 6e20  .            $n 
-000372b0: 3d20 7374 7265 616d 5f73 656c 6563 7428  = stream_select(
-000372c0: 2473 656c 522c 2024 7365 6c57 2c20 2473  $selR, $selW, $s
-000372d0: 656c 572c 2024 7468 6973 2d3e 5469 6d65  elW, $this->Time
-000372e0: 6c69 6d69 7429 3b0a 2020 2020 2020 2020  limit);.        
-000372f0: 2020 2020 7265 7374 6f72 655f 6572 726f      restore_erro
-00037300: 725f 6861 6e64 6c65 7228 293b 0a0a 2020  r_handler();..  
-00037310: 2020 2020 2020 2020 2020 6966 2028 246e            if ($n
-00037320: 203d 3d3d 2066 616c 7365 2920 7b0a 2020   === false) {.  
-00037330: 2020 2020 2020 2020 2020 2020 2020 246d                $m
-00037340: 6573 7361 6765 203d 2024 7468 6973 2d3e  essage = $this->
-00037350: 6765 7445 7272 6f72 2829 5b27 6465 7461  getError()['deta
-00037360: 696c 275d 3b0a 0a20 2020 2020 2020 2020  il'];..         
-00037370: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
-00037380: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
-00037390: 2020 2020 2020 2020 2020 2753 4d54 5020            'SMTP 
-000373a0: 2d3e 2067 6574 5f6c 696e 6573 2829 3a20  -> get_lines(): 
-000373b0: 7365 6c65 6374 2066 6169 6c65 6420 2827  select failed ('
-000373c0: 202e 2024 6d65 7373 6167 6520 2e20 2729   . $message . ')
-000373d0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-000373e0: 2020 2020 2020 2073 656c 663a 3a44 4542         self::DEB
-000373f0: 5547 5f4c 4f57 4c45 5645 4c0a 2020 2020  UG_LOWLEVEL.    
-00037400: 2020 2020 2020 2020 2020 2020 293b 0a0a              );..
-00037410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037420: 2f2f 7374 7265 616d 5f73 656c 6563 7420  //stream_select 
-00037430: 7265 7475 726e 7320 6661 6c73 6520 7768  returns false wh
-00037440: 656e 2074 6865 2060 7365 6c65 6374 6020  en the `select` 
-00037450: 7379 7374 656d 2063 616c 6c20 6973 2069  system call is i
-00037460: 6e74 6572 7275 7074 6564 0a20 2020 2020  nterrupted.     
-00037470: 2020 2020 2020 2020 2020 202f 2f62 7920             //by 
-00037480: 616e 2069 6e63 6f6d 696e 6720 7369 676e  an incoming sign
-00037490: 616c 2c20 7472 7920 7468 6520 7365 6c65  al, try the sele
-000374a0: 6374 2061 6761 696e 0a20 2020 2020 2020  ct again.       
-000374b0: 2020 2020 2020 2020 2069 6620 2873 7472           if (str
-000374c0: 6970 6f73 2824 6d65 7373 6167 652c 2027  ipos($message, '
-000374d0: 696e 7465 7272 7570 7465 6420 7379 7374  interrupted syst
-000374e0: 656d 2063 616c 6c27 2920 213d 3d20 6661  em call') !== fa
-000374f0: 6c73 6529 207b 0a20 2020 2020 2020 2020  lse) {.         
-00037500: 2020 2020 2020 2020 2020 2024 7468 6973             $this
-00037510: 2d3e 6564 6562 7567 280a 2020 2020 2020  ->edebug(.      
-00037520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037530: 2020 2753 4d54 5020 2d3e 2067 6574 5f6c    'SMTP -> get_l
-00037540: 696e 6573 2829 3a20 7265 7472 7969 6e67  ines(): retrying
-00037550: 2073 7472 6561 6d5f 7365 6c65 6374 272c   stream_select',
-00037560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037570: 2020 2020 2020 2020 2073 656c 663a 3a44           self::D
-00037580: 4542 5547 5f4c 4f57 4c45 5645 4c0a 2020  EBUG_LOWLEVEL.  
-00037590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000375a0: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
-000375b0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-000375c0: 7365 7445 7272 6f72 2827 2729 3b0a 2020  setError('');.  
-000375d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000375e0: 2020 636f 6e74 696e 7565 3b0a 2020 2020    continue;.    
-000375f0: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-00037600: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00037610: 7265 616b 3b0a 2020 2020 2020 2020 2020  reak;.          
-00037620: 2020 7d0a 0a20 2020 2020 2020 2020 2020    }..           
-00037630: 2069 6620 2821 246e 2920 7b0a 2020 2020   if (!$n) {.    
-00037640: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-00037650: 732d 3e65 6465 6275 6728 0a20 2020 2020  s->edebug(.     
-00037660: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00037670: 534d 5450 202d 3e20 6765 745f 6c69 6e65  SMTP -> get_line
-00037680: 7328 293a 2073 656c 6563 7420 7469 6d65  s(): select time
-00037690: 642d 6f75 7420 696e 2028 2720 2e20 2474  d-out in (' . $t
-000376a0: 6869 732d 3e54 696d 656c 696d 6974 202e  his->Timelimit .
-000376b0: 2027 2073 6563 2927 2c0a 2020 2020 2020   ' sec)',.      
-000376c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000376d0: 6c66 3a3a 4445 4255 475f 4c4f 574c 4556  lf::DEBUG_LOWLEV
-000376e0: 454c 0a20 2020 2020 2020 2020 2020 2020  EL.             
-000376f0: 2020 2029 3b0a 2020 2020 2020 2020 2020     );.          
-00037700: 2020 2020 2020 6272 6561 6b3b 0a20 2020        break;.   
-00037710: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-00037720: 2020 2020 2020 2020 2f2f 4465 6c69 6265          //Delibe
-00037730: 7261 7465 206e 6f69 7365 2073 7570 7072  rate noise suppr
-00037740: 6573 7369 6f6e 202d 2065 7272 6f72 7320  ession - errors 
-00037750: 6172 6520 6861 6e64 6c65 6420 6166 7465  are handled afte
-00037760: 7277 6172 6473 0a20 2020 2020 2020 2020  rwards.         
-00037770: 2020 2024 7374 7220 3d20 4066 6765 7473     $str = @fgets
-00037780: 2824 7468 6973 2d3e 736d 7470 5f63 6f6e  ($this->smtp_con
-00037790: 6e2c 2073 656c 663a 3a4d 4158 5f52 4550  n, self::MAX_REP
-000377a0: 4c59 5f4c 454e 4754 4829 3b0a 2020 2020  LY_LENGTH);.    
-000377b0: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-000377c0: 6465 6275 6728 2753 4d54 5020 494e 424f  debug('SMTP INBO
-000377d0: 554e 443a 2022 2720 2e20 7472 696d 2824  UND: "' . trim($
-000377e0: 7374 7229 202e 2027 2227 2c20 7365 6c66  str) . '"', self
-000377f0: 3a3a 4445 4255 475f 4c4f 574c 4556 454c  ::DEBUG_LOWLEVEL
-00037800: 293b 0a20 2020 2020 2020 2020 2020 2024  );.            $
-00037810: 6461 7461 202e 3d20 2473 7472 3b0a 2020  data .= $str;.  
-00037820: 2020 2020 2020 2020 2020 2f2f 4966 2072            //If r
-00037830: 6573 706f 6e73 6520 6973 206f 6e6c 7920  esponse is only 
-00037840: 3320 6368 6172 7320 286e 6f74 2076 616c  3 chars (not val
-00037850: 6964 2c20 6275 7420 5246 4335 3332 3120  id, but RFC5321 
-00037860: 5334 2e32 2073 6179 7320 6974 206d 7573  S4.2 says it mus
-00037870: 7420 6265 2068 616e 646c 6564 292c 0a20  t be handled),. 
-00037880: 2020 2020 2020 2020 2020 202f 2f6f 7220             //or 
-00037890: 3474 6820 6368 6172 6163 7465 7220 6973  4th character is
-000378a0: 2061 2073 7061 6365 206f 7220 6120 6c69   a space or a li
-000378b0: 6e65 2062 7265 616b 2063 6861 722c 2077  ne break char, w
-000378c0: 6520 6172 6520 646f 6e65 2072 6561 6469  e are done readi
-000378d0: 6e67 2c20 6272 6561 6b20 7468 6520 6c6f  ng, break the lo
-000378e0: 6f70 2e0a 2020 2020 2020 2020 2020 2020  op..            
-000378f0: 2f2f 5374 7269 6e67 2061 7272 6179 2061  //String array a
-00037900: 6363 6573 7320 6973 2061 2073 6967 6e69  ccess is a signi
-00037910: 6669 6361 6e74 206d 6963 726f 2d6f 7074  ficant micro-opt
-00037920: 696d 6973 6174 696f 6e20 6f76 6572 2073  imisation over s
-00037930: 7472 6c65 6e0a 2020 2020 2020 2020 2020  trlen.          
-00037940: 2020 6966 2028 2169 7373 6574 2824 7374    if (!isset($st
-00037950: 725b 335d 2920 7c7c 2024 7374 725b 335d  r[3]) || $str[3]
-00037960: 203d 3d3d 2027 2027 207c 7c20 2473 7472   === ' ' || $str
-00037970: 5b33 5d20 3d3d 3d20 225c 7222 207c 7c20  [3] === "\r" || 
-00037980: 2473 7472 5b33 5d20 3d3d 3d20 225c 6e22  $str[3] === "\n"
-00037990: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-000379a0: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
-000379b0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000379c0: 2020 2020 202f 2f54 696d 6564 2d6f 7574       //Timed-out
-000379d0: 3f20 4c6f 6720 616e 6420 6272 6561 6b0a  ? Log and break.
-000379e0: 2020 2020 2020 2020 2020 2020 2469 6e66              $inf
-000379f0: 6f20 3d20 7374 7265 616d 5f67 6574 5f6d  o = stream_get_m
-00037a00: 6574 615f 6461 7461 2824 7468 6973 2d3e  eta_data($this->
-00037a10: 736d 7470 5f63 6f6e 6e29 3b0a 2020 2020  smtp_conn);.    
-00037a20: 2020 2020 2020 2020 6966 2028 2469 6e66          if ($inf
-00037a30: 6f5b 2774 696d 6564 5f6f 7574 275d 2920  o['timed_out']) 
-00037a40: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00037a50: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
-00037a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037a70: 2020 2020 2027 534d 5450 202d 3e20 6765       'SMTP -> ge
-00037a80: 745f 6c69 6e65 7328 293a 2073 7472 6561  t_lines(): strea
-00037a90: 6d20 7469 6d65 642d 6f75 7420 2827 202e  m timed-out (' .
-00037aa0: 2024 7468 6973 2d3e 5469 6d65 6f75 7420   $this->Timeout 
-00037ab0: 2e20 2720 7365 6329 272c 0a20 2020 2020  . ' sec)',.     
-00037ac0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00037ad0: 656c 663a 3a44 4542 5547 5f4c 4f57 4c45  elf::DEBUG_LOWLE
-00037ae0: 5645 4c0a 2020 2020 2020 2020 2020 2020  VEL.            
-00037af0: 2020 2020 293b 0a20 2020 2020 2020 2020      );.         
-00037b00: 2020 2020 2020 2062 7265 616b 3b0a 2020         break;.  
-00037b10: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-00037b20: 2020 2020 2020 2020 2f2f 4e6f 7720 6368          //Now ch
-00037b30: 6563 6b20 6966 2072 6561 6473 2074 6f6f  eck if reads too
-00037b40: 6b20 746f 6f20 6c6f 6e67 0a20 2020 2020  k too long.     
-00037b50: 2020 2020 2020 2069 6620 2824 656e 6474         if ($endt
-00037b60: 696d 6520 2626 2074 696d 6528 2920 3e20  ime && time() > 
-00037b70: 2465 6e64 7469 6d65 2920 7b0a 2020 2020  $endtime) {.    
-00037b80: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
-00037b90: 732d 3e65 6465 6275 6728 0a20 2020 2020  s->edebug(.     
-00037ba0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00037bb0: 534d 5450 202d 3e20 6765 745f 6c69 6e65  SMTP -> get_line
-00037bc0: 7328 293a 2074 696d 656c 696d 6974 2072  s(): timelimit r
-00037bd0: 6561 6368 6564 2028 2720 2e0a 2020 2020  eached (' ..    
-00037be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037bf0: 2474 6869 732d 3e54 696d 656c 696d 6974  $this->Timelimit
-00037c00: 202e 2027 2073 6563 2927 2c0a 2020 2020   . ' sec)',.    
-00037c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037c20: 7365 6c66 3a3a 4445 4255 475f 4c4f 574c  self::DEBUG_LOWL
-00037c30: 4556 454c 0a20 2020 2020 2020 2020 2020  EVEL.           
-00037c40: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-00037c50: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
-00037c60: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00037c70: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00037c80: 7265 7475 726e 2024 6461 7461 3b0a 2020  return $data;.  
-00037c90: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
-00037ca0: 2020 2a20 456e 6162 6c65 206f 7220 6469    * Enable or di
-00037cb0: 7361 626c 6520 5645 5250 2061 6464 7265  sable VERP addre
-00037cc0: 7373 2067 656e 6572 6174 696f 6e2e 0a20  ss generation.. 
-00037cd0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
-00037ce0: 7261 6d20 626f 6f6c 2024 656e 6162 6c65  ram bool $enable
-00037cf0: 640a 2020 2020 202a 2f0a 2020 2020 7075  d.     */.    pu
-00037d00: 626c 6963 2066 756e 6374 696f 6e20 7365  blic function se
-00037d10: 7456 6572 7028 2465 6e61 626c 6564 203d  tVerp($enabled =
-00037d20: 2066 616c 7365 290a 2020 2020 7b0a 2020   false).    {.  
-00037d30: 2020 2020 2020 2474 6869 732d 3e64 6f5f        $this->do_
-00037d40: 7665 7270 203d 2024 656e 6162 6c65 643b  verp = $enabled;
-00037d50: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00037d60: 2020 2020 202a 2047 6574 2056 4552 5020       * Get VERP 
-00037d70: 6164 6472 6573 7320 6765 6e65 7261 7469  address generati
-00037d80: 6f6e 206d 6f64 652e 0a20 2020 2020 2a0a  on mode..     *.
-00037d90: 2020 2020 202a 2040 7265 7475 726e 2062       * @return b
-00037da0: 6f6f 6c0a 2020 2020 202a 2f0a 2020 2020  ool.     */.    
-00037db0: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
-00037dc0: 6765 7456 6572 7028 290a 2020 2020 7b0a  getVerp().    {.
-00037dd0: 2020 2020 2020 2020 7265 7475 726e 2024          return $
-00037de0: 7468 6973 2d3e 646f 5f76 6572 703b 0a20  this->do_verp;. 
-00037df0: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-00037e00: 2020 202a 2053 6574 2065 7272 6f72 206d     * Set error m
-00037e10: 6573 7361 6765 7320 616e 6420 636f 6465  essages and code
-00037e20: 732e 0a20 2020 2020 2a0a 2020 2020 202a  s..     *.     *
-00037e30: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
-00037e40: 6d65 7373 6167 6520 2020 2020 2054 6865  message      The
-00037e50: 2065 7272 6f72 206d 6573 7361 6765 0a20   error message. 
-00037e60: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-00037e70: 696e 6720 2464 6574 6169 6c20 2020 2020  ing $detail     
-00037e80: 2020 4675 7274 6865 7220 6465 7461 696c    Further detail
-00037e90: 206f 6e20 7468 6520 6572 726f 720a 2020   on the error.  
-00037ea0: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
-00037eb0: 6e67 2024 736d 7470 5f63 6f64 6520 2020  ng $smtp_code   
-00037ec0: 2041 6e20 6173 736f 6369 6174 6564 2053   An associated S
-00037ed0: 4d54 5020 6572 726f 7220 636f 6465 0a20  MTP error code. 
-00037ee0: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
-00037ef0: 696e 6720 2473 6d74 705f 636f 6465 5f65  ing $smtp_code_e
-00037f00: 7820 4578 7465 6e64 6564 2053 4d54 5020  x Extended SMTP 
-00037f10: 636f 6465 0a20 2020 2020 2a2f 0a20 2020  code.     */.   
-00037f20: 2070 726f 7465 6374 6564 2066 756e 6374   protected funct
-00037f30: 696f 6e20 7365 7445 7272 6f72 2824 6d65  ion setError($me
-00037f40: 7373 6167 652c 2024 6465 7461 696c 203d  ssage, $detail =
-00037f50: 2027 272c 2024 736d 7470 5f63 6f64 6520   '', $smtp_code 
-00037f60: 3d20 2727 2c20 2473 6d74 705f 636f 6465  = '', $smtp_code
-00037f70: 5f65 7820 3d20 2727 290a 2020 2020 7b0a  _ex = '').    {.
-00037f80: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
-00037f90: 7272 6f72 203d 205b 0a20 2020 2020 2020  rror = [.       
-00037fa0: 2020 2020 2027 6572 726f 7227 203d 3e20       'error' => 
-00037fb0: 246d 6573 7361 6765 2c0a 2020 2020 2020  $message,.      
-00037fc0: 2020 2020 2020 2764 6574 6169 6c27 203d        'detail' =
-00037fd0: 3e20 2464 6574 6169 6c2c 0a20 2020 2020  > $detail,.     
-00037fe0: 2020 2020 2020 2027 736d 7470 5f63 6f64         'smtp_cod
-00037ff0: 6527 203d 3e20 2473 6d74 705f 636f 6465  e' => $smtp_code
-00038000: 2c0a 2020 2020 2020 2020 2020 2020 2773  ,.            's
-00038010: 6d74 705f 636f 6465 5f65 7827 203d 3e20  mtp_code_ex' => 
-00038020: 2473 6d74 705f 636f 6465 5f65 782c 0a20  $smtp_code_ex,. 
-00038030: 2020 2020 2020 205d 3b0a 2020 2020 7d0a         ];.    }.
-00038040: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
-00038050: 5365 7420 6465 6275 6720 6f75 7470 7574  Set debug output
-00038060: 206d 6574 686f 642e 0a20 2020 2020 2a0a   method..     *.
-00038070: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
-00038080: 7269 6e67 7c63 616c 6c61 626c 6520 246d  ring|callable $m
-00038090: 6574 686f 6420 5468 6520 6e61 6d65 206f  ethod The name o
-000380a0: 6620 7468 6520 6d65 6368 616e 6973 6d20  f the mechanism 
-000380b0: 746f 2075 7365 2066 6f72 2064 6562 7567  to use for debug
-000380c0: 6769 6e67 206f 7574 7075 742c 206f 7220  ging output, or 
-000380d0: 6120 6361 6c6c 6162 6c65 2074 6f20 6861  a callable to ha
-000380e0: 6e64 6c65 2069 740a 2020 2020 202a 2f0a  ndle it.     */.
-000380f0: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
-00038100: 696f 6e20 7365 7444 6562 7567 4f75 7470  ion setDebugOutp
-00038110: 7574 2824 6d65 7468 6f64 203d 2027 6563  ut($method = 'ec
-00038120: 686f 2729 0a20 2020 207b 0a20 2020 2020  ho').    {.     
-00038130: 2020 2024 7468 6973 2d3e 4465 6275 676f     $this->Debugo
-00038140: 7574 7075 7420 3d20 246d 6574 686f 643b  utput = $method;
-00038150: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00038160: 2020 2020 202a 2047 6574 2064 6562 7567       * Get debug
-00038170: 206f 7574 7075 7420 6d65 7468 6f64 2e0a   output method..
-00038180: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
-00038190: 6574 7572 6e20 7374 7269 6e67 0a20 2020  eturn string.   
-000381a0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
-000381b0: 6675 6e63 7469 6f6e 2067 6574 4465 6275  function getDebu
-000381c0: 674f 7574 7075 7428 290a 2020 2020 7b0a  gOutput().    {.
-000381d0: 2020 2020 2020 2020 7265 7475 726e 2024          return $
-000381e0: 7468 6973 2d3e 4465 6275 676f 7574 7075  this->Debugoutpu
-000381f0: 743b 0a20 2020 207d 0a0a 2020 2020 2f2a  t;.    }..    /*
-00038200: 2a0a 2020 2020 202a 2053 6574 2064 6562  *.     * Set deb
-00038210: 7567 206f 7574 7075 7420 6c65 7665 6c2e  ug output level.
-00038220: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00038230: 7061 7261 6d20 696e 7420 246c 6576 656c  param int $level
-00038240: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
-00038250: 6c69 6320 6675 6e63 7469 6f6e 2073 6574  lic function set
-00038260: 4465 6275 674c 6576 656c 2824 6c65 7665  DebugLevel($leve
-00038270: 6c20 3d20 3029 0a20 2020 207b 0a20 2020  l = 0).    {.   
-00038280: 2020 2020 2024 7468 6973 2d3e 646f 5f64       $this->do_d
-00038290: 6562 7567 203d 2024 6c65 7665 6c3b 0a20  ebug = $level;. 
-000382a0: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
-000382b0: 2020 202a 2047 6574 2064 6562 7567 206f     * Get debug o
-000382c0: 7574 7075 7420 6c65 7665 6c2e 0a20 2020  utput level..   
-000382d0: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
-000382e0: 726e 2069 6e74 0a20 2020 2020 2a2f 0a20  rn int.     */. 
-000382f0: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
-00038300: 6f6e 2067 6574 4465 6275 674c 6576 656c  on getDebugLevel
-00038310: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
-00038320: 2072 6574 7572 6e20 2474 6869 732d 3e64   return $this->d
-00038330: 6f5f 6465 6275 673b 0a20 2020 207d 0a0a  o_debug;.    }..
-00038340: 2020 2020 2f2a 2a0a 2020 2020 202a 2053      /**.     * S
-00038350: 6574 2053 4d54 5020 7469 6d65 6f75 742e  et SMTP timeout.
-00038360: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
-00038370: 7061 7261 6d20 696e 7420 2474 696d 656f  param int $timeo
-00038380: 7574 2054 6865 2074 696d 656f 7574 2064  ut The timeout d
-00038390: 7572 6174 696f 6e20 696e 2073 6563 6f6e  uration in secon
-000383a0: 6473 0a20 2020 2020 2a2f 0a20 2020 2070  ds.     */.    p
-000383b0: 7562 6c69 6320 6675 6e63 7469 6f6e 2073  ublic function s
-000383c0: 6574 5469 6d65 6f75 7428 2474 696d 656f  etTimeout($timeo
-000383d0: 7574 203d 2030 290a 2020 2020 7b0a 2020  ut = 0).    {.  
-000383e0: 2020 2020 2020 2474 6869 732d 3e54 696d        $this->Tim
-000383f0: 656f 7574 203d 2024 7469 6d65 6f75 743b  eout = $timeout;
-00038400: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-00038410: 2020 2020 202a 2047 6574 2053 4d54 5020       * Get SMTP 
-00038420: 7469 6d65 6f75 742e 0a20 2020 2020 2a0a  timeout..     *.
-00038430: 2020 2020 202a 2040 7265 7475 726e 2069       * @return i
-00038440: 6e74 0a20 2020 2020 2a2f 0a20 2020 2070  nt.     */.    p
-00038450: 7562 6c69 6320 6675 6e63 7469 6f6e 2067  ublic function g
-00038460: 6574 5469 6d65 6f75 7428 290a 2020 2020  etTimeout().    
-00038470: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
-00038480: 2024 7468 6973 2d3e 5469 6d65 6f75 743b   $this->Timeout;
-00038490: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
-000384a0: 2020 2020 202a 2052 6570 6f72 7473 2061       * Reports a
-000384b0: 6e20 6572 726f 7220 6e75 6d62 6572 2061  n error number a
-000384c0: 6e64 2073 7472 696e 672e 0a20 2020 2020  nd string..     
-000384d0: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
-000384e0: 696e 7420 2020 2024 6572 726e 6f20 2020  int    $errno   
-000384f0: 5468 6520 6572 726f 7220 6e75 6d62 6572  The error number
-00038500: 2072 6574 7572 6e65 6420 6279 2050 4850   returned by PHP
-00038510: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00038520: 7472 696e 6720 2465 7272 6d73 6720 2054  tring $errmsg  T
-00038530: 6865 2065 7272 6f72 206d 6573 7361 6765  he error message
-00038540: 2072 6574 7572 6e65 6420 6279 2050 4850   returned by PHP
-00038550: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
-00038560: 7472 696e 6720 2465 7272 6669 6c65 2054  tring $errfile T
-00038570: 6865 2066 696c 6520 7468 6520 6572 726f  he file the erro
-00038580: 7220 6f63 6375 7272 6564 2069 6e0a 2020  r occurred in.  
-00038590: 2020 202a 2040 7061 7261 6d20 696e 7420     * @param int 
-000385a0: 2020 2024 6572 726c 696e 6520 5468 6520     $errline The 
-000385b0: 6c69 6e65 206e 756d 6265 7220 7468 6520  line number the 
-000385c0: 6572 726f 7220 6f63 6375 7272 6564 206f  error occurred o
-000385d0: 6e0a 2020 2020 202a 2f0a 2020 2020 7072  n.     */.    pr
-000385e0: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
-000385f0: 2065 7272 6f72 4861 6e64 6c65 7228 2465   errorHandler($e
-00038600: 7272 6e6f 2c20 2465 7272 6d73 672c 2024  rrno, $errmsg, $
-00038610: 6572 7266 696c 6520 3d20 2727 2c20 2465  errfile = '', $e
-00038620: 7272 6c69 6e65 203d 2030 290a 2020 2020  rrline = 0).    
-00038630: 7b0a 2020 2020 2020 2020 246e 6f74 6963  {.        $notic
-00038640: 6520 3d20 2743 6f6e 6e65 6374 696f 6e20  e = 'Connection 
-00038650: 6661 696c 6564 2e27 3b0a 2020 2020 2020  failed.';.      
-00038660: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
-00038670: 7228 0a20 2020 2020 2020 2020 2020 2024  r(.            $
-00038680: 6e6f 7469 6365 2c0a 2020 2020 2020 2020  notice,.        
-00038690: 2020 2020 2465 7272 6d73 672c 0a20 2020      $errmsg,.   
-000386a0: 2020 2020 2020 2020 2028 7374 7269 6e67           (string
-000386b0: 2920 2465 7272 6e6f 0a20 2020 2020 2020  ) $errno.       
-000386c0: 2029 3b0a 2020 2020 2020 2020 2474 6869   );.        $thi
-000386d0: 732d 3e65 6465 6275 6728 0a20 2020 2020  s->edebug(.     
-000386e0: 2020 2020 2020 2022 246e 6f74 6963 6520         "$notice 
-000386f0: 4572 726f 7220 2324 6572 726e 6f3a 2024  Error #$errno: $
-00038700: 6572 726d 7367 205b 2465 7272 6669 6c65  errmsg [$errfile
-00038710: 206c 696e 6520 2465 7272 6c69 6e65 5d22   line $errline]"
-00038720: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-00038730: 6c66 3a3a 4445 4255 475f 434f 4e4e 4543  lf::DEBUG_CONNEC
-00038740: 5449 4f4e 0a20 2020 2020 2020 2029 3b0a  TION.        );.
-00038750: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
-00038760: 2020 2020 2a20 4578 7472 6163 7420 616e      * Extract an
-00038770: 6420 7265 7475 726e 2074 6865 2049 4420  d return the ID 
-00038780: 6f66 2074 6865 206c 6173 7420 534d 5450  of the last SMTP
-00038790: 2074 7261 6e73 6163 7469 6f6e 2062 6173   transaction bas
-000387a0: 6564 206f 6e0a 2020 2020 202a 2061 206c  ed on.     * a l
-000387b0: 6973 7420 6f66 2070 6174 7465 726e 7320  ist of patterns 
-000387c0: 7072 6f76 6964 6564 2069 6e20 534d 5450  provided in SMTP
-000387d0: 3a3a 2473 6d74 705f 7472 616e 7361 6374  ::$smtp_transact
-000387e0: 696f 6e5f 6964 5f70 6174 7465 726e 732e  ion_id_patterns.
-000387f0: 0a20 2020 2020 2a20 5265 6c69 6573 206f  .     * Relies o
-00038800: 6e20 7468 6520 686f 7374 2070 726f 7669  n the host provi
-00038810: 6469 6e67 2074 6865 2049 4420 696e 2072  ding the ID in r
-00038820: 6573 706f 6e73 6520 746f 2061 2044 4154  esponse to a DAT
-00038830: 4120 636f 6d6d 616e 642e 0a20 2020 2020  A command..     
-00038840: 2a20 4966 206e 6f20 7265 706c 7920 6861  * If no reply ha
-00038850: 7320 6265 656e 2072 6563 6569 7665 6420  s been received 
-00038860: 7965 742c 2069 7420 7769 6c6c 2072 6574  yet, it will ret
-00038870: 7572 6e20 6e75 6c6c 2e0a 2020 2020 202a  urn null..     *
-00038880: 2049 6620 6e6f 2070 6174 7465 726e 2077   If no pattern w
-00038890: 6173 206d 6174 6368 6564 2c20 6974 2077  as matched, it w
-000388a0: 696c 6c20 7265 7475 726e 2066 616c 7365  ill return false
-000388b0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
-000388c0: 4072 6574 7572 6e20 626f 6f6c 7c73 7472  @return bool|str
-000388d0: 696e 677c 6e75 6c6c 0a20 2020 2020 2a2f  ing|null.     */
-000388e0: 0a20 2020 2070 726f 7465 6374 6564 2066  .    protected f
-000388f0: 756e 6374 696f 6e20 7265 636f 7264 4c61  unction recordLa
-00038900: 7374 5472 616e 7361 6374 696f 6e49 4428  stTransactionID(
-00038910: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00038920: 2472 6570 6c79 203d 2024 7468 6973 2d3e  $reply = $this->
-00038930: 6765 744c 6173 7452 6570 6c79 2829 3b0a  getLastReply();.
-00038940: 0a20 2020 2020 2020 2069 6620 2865 6d70  .        if (emp
-00038950: 7479 2824 7265 706c 7929 2920 7b0a 2020  ty($reply)) {.  
-00038960: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
-00038970: 3e6c 6173 745f 736d 7470 5f74 7261 6e73  >last_smtp_trans
-00038980: 6163 7469 6f6e 5f69 6420 3d20 6e75 6c6c  action_id = null
-00038990: 3b0a 2020 2020 2020 2020 7d20 656c 7365  ;.        } else
-000389a0: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
-000389b0: 7468 6973 2d3e 6c61 7374 5f73 6d74 705f  this->last_smtp_
-000389c0: 7472 616e 7361 6374 696f 6e5f 6964 203d  transaction_id =
-000389d0: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
-000389e0: 2020 2020 666f 7265 6163 6820 2824 7468      foreach ($th
-000389f0: 6973 2d3e 736d 7470 5f74 7261 6e73 6163  is->smtp_transac
-00038a00: 7469 6f6e 5f69 645f 7061 7474 6572 6e73  tion_id_patterns
-00038a10: 2061 7320 2473 6d74 705f 7472 616e 7361   as $smtp_transa
-00038a20: 6374 696f 6e5f 6964 5f70 6174 7465 726e  ction_id_pattern
-00038a30: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
-00038a40: 2020 2020 246d 6174 6368 6573 203d 205b      $matches = [
-00038a50: 5d3b 0a20 2020 2020 2020 2020 2020 2020  ];.             
-00038a60: 2020 2069 6620 2870 7265 675f 6d61 7463     if (preg_matc
-00038a70: 6828 2473 6d74 705f 7472 616e 7361 6374  h($smtp_transact
-00038a80: 696f 6e5f 6964 5f70 6174 7465 726e 2c20  ion_id_pattern, 
-00038a90: 2472 6570 6c79 2c20 246d 6174 6368 6573  $reply, $matches
-00038aa0: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
-00038ab0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
-00038ac0: 6c61 7374 5f73 6d74 705f 7472 616e 7361  last_smtp_transa
-00038ad0: 6374 696f 6e5f 6964 203d 2074 7269 6d28  ction_id = trim(
-00038ae0: 246d 6174 6368 6573 5b31 5d29 3b0a 2020  $matches[1]);.  
-00038af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038b00: 2020 6272 6561 6b3b 0a20 2020 2020 2020    break;.       
-00038b10: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00038b20: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00038b30: 207d 0a0a 2020 2020 2020 2020 7265 7475   }..        retu
-00038b40: 726e 2024 7468 6973 2d3e 6c61 7374 5f73  rn $this->last_s
-00038b50: 6d74 705f 7472 616e 7361 6374 696f 6e5f  mtp_transaction_
-00038b60: 6964 3b0a 2020 2020 7d0a 0a20 2020 202f  id;.    }..    /
-00038b70: 2a2a 0a20 2020 2020 2a20 4765 7420 7468  **.     * Get th
-00038b80: 6520 7175 6575 652f 7472 616e 7361 6374  e queue/transact
-00038b90: 696f 6e20 4944 206f 6620 7468 6520 6c61  ion ID of the la
-00038ba0: 7374 2053 4d54 5020 7472 616e 7361 6374  st SMTP transact
-00038bb0: 696f 6e0a 2020 2020 202a 2049 6620 6e6f  ion.     * If no
-00038bc0: 2072 6570 6c79 2068 6173 2062 6565 6e20   reply has been 
-00038bd0: 7265 6365 6976 6564 2079 6574 2c20 6974  received yet, it
-00038be0: 2077 696c 6c20 7265 7475 726e 206e 756c   will return nul
-00038bf0: 6c2e 0a20 2020 2020 2a20 4966 206e 6f20  l..     * If no 
-00038c00: 7061 7474 6572 6e20 7761 7320 6d61 7463  pattern was matc
-00038c10: 6865 642c 2069 7420 7769 6c6c 2072 6574  hed, it will ret
-00038c20: 7572 6e20 6661 6c73 652e 0a20 2020 2020  urn false..     
-00038c30: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
-00038c40: 2062 6f6f 6c7c 7374 7269 6e67 7c6e 756c   bool|string|nul
-00038c50: 6c0a 2020 2020 202a 0a20 2020 2020 2a20  l.     *.     * 
-00038c60: 4073 6565 2072 6563 6f72 644c 6173 7454  @see recordLastT
-00038c70: 7261 6e73 6163 7469 6f6e 4944 2829 0a20  ransactionID(). 
-00038c80: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
-00038c90: 6320 6675 6e63 7469 6f6e 2067 6574 4c61  c function getLa
-00038ca0: 7374 5472 616e 7361 6374 696f 6e49 4428  stTransactionID(
-00038cb0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
-00038cc0: 7265 7475 726e 2024 7468 6973 2d3e 6c61  return $this->la
-00038cd0: 7374 5f73 6d74 705f 7472 616e 7361 6374  st_smtp_transact
-00038ce0: 696f 6e5f 6964 3b0a 2020 2020 7d0a 7d0a  ion_id;.    }.}.
+000228b0: 7468 726f 7720 6e65 7720 4578 6365 7074  throw new Except
+000228c0: 696f 6e28 2474 6869 732d 3e6c 616e 6728  ion($this->lang(
+000228d0: 2766 696c 655f 6163 6365 7373 2729 202e  'file_access') .
+000228e0: 2024 7061 7468 2c20 7365 6c66 3a3a 5354   $path, self::ST
+000228f0: 4f50 5f43 4f4e 5449 4e55 4529 3b0a 2020  OP_CONTINUE);.  
+00022900: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+00022910: 2020 2020 2020 2020 202f 2f49 6620 6120           //If a 
+00022920: 4d49 4d45 2074 7970 6520 6973 206e 6f74  MIME type is not
+00022930: 2073 7065 6369 6669 6564 2c20 7472 7920   specified, try 
+00022940: 746f 2077 6f72 6b20 6974 206f 7574 2066  to work it out f
+00022950: 726f 6d20 7468 6520 6669 6c65 206e 616d  rom the file nam
+00022960: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00022970: 2028 2727 203d 3d3d 2024 7479 7065 2920   ('' === $type) 
+00022980: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00022990: 2020 2474 7970 6520 3d20 7374 6174 6963    $type = static
+000229a0: 3a3a 6669 6c65 6e61 6d65 546f 5479 7065  ::filenameToType
+000229b0: 2824 7061 7468 293b 0a20 2020 2020 2020  ($path);.       
+000229c0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+000229d0: 2020 2020 6966 2028 2124 7468 6973 2d3e      if (!$this->
+000229e0: 7661 6c69 6461 7465 456e 636f 6469 6e67  validateEncoding
+000229f0: 2824 656e 636f 6469 6e67 2929 207b 0a20  ($encoding)) {. 
+00022a00: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00022a10: 6872 6f77 206e 6577 2045 7863 6570 7469  hrow new Excepti
+00022a20: 6f6e 2824 7468 6973 2d3e 6c61 6e67 2827  on($this->lang('
+00022a30: 656e 636f 6469 6e67 2729 202e 2024 656e  encoding') . $en
+00022a40: 636f 6469 6e67 293b 0a20 2020 2020 2020  coding);.       
+00022a50: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00022a60: 2020 2020 2466 696c 656e 616d 6520 3d20      $filename = 
+00022a70: 2873 7472 696e 6729 2073 7461 7469 633a  (string) static:
+00022a80: 3a6d 625f 7061 7468 696e 666f 2824 7061  :mb_pathinfo($pa
+00022a90: 7468 2c20 5041 5448 494e 464f 5f42 4153  th, PATHINFO_BAS
+00022aa0: 454e 414d 4529 3b0a 2020 2020 2020 2020  ENAME);.        
+00022ab0: 2020 2020 6966 2028 2727 203d 3d3d 2024      if ('' === $
+00022ac0: 6e61 6d65 2920 7b0a 2020 2020 2020 2020  name) {.        
+00022ad0: 2020 2020 2020 2020 246e 616d 6520 3d20          $name = 
+00022ae0: 2466 696c 656e 616d 653b 0a20 2020 2020  $filename;.     
+00022af0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00022b00: 2020 2020 2020 2f2f 4170 7065 6e64 2074        //Append t
+00022b10: 6f20 2461 7474 6163 686d 656e 7420 6172  o $attachment ar
+00022b20: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00022b30: 2474 6869 732d 3e61 7474 6163 686d 656e  $this->attachmen
+00022b40: 745b 5d20 3d20 5b0a 2020 2020 2020 2020  t[] = [.        
+00022b50: 2020 2020 2020 2020 3020 3d3e 2024 7061          0 => $pa
+00022b60: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00022b70: 2020 2020 3120 3d3e 2024 6669 6c65 6e61      1 => $filena
+00022b80: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00022b90: 2020 2020 3220 3d3e 2024 6e61 6d65 2c0a      2 => $name,.
+00022ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bb0: 3320 3d3e 2024 656e 636f 6469 6e67 2c0a  3 => $encoding,.
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bd0: 3420 3d3e 2024 7479 7065 2c0a 2020 2020  4 => $type,.    
+00022be0: 2020 2020 2020 2020 2020 2020 3520 3d3e              5 =>
+00022bf0: 2066 616c 7365 2c20 2f2f 6973 5374 7269   false, //isStri
+00022c00: 6e67 4174 7461 6368 6d65 6e74 0a20 2020  ngAttachment.   
+00022c10: 2020 2020 2020 2020 2020 2020 2036 203d               6 =
+00022c20: 3e20 2464 6973 706f 7369 7469 6f6e 2c0a  > $disposition,.
+00022c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c40: 3720 3d3e 2024 6369 642c 0a20 2020 2020  7 => $cid,.     
+00022c50: 2020 2020 2020 205d 3b0a 2020 2020 2020         ];.      
+00022c60: 2020 7d20 6361 7463 6820 2845 7863 6570    } catch (Excep
+00022c70: 7469 6f6e 2024 6578 6329 207b 0a20 2020  tion $exc) {.   
+00022c80: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00022c90: 7365 7445 7272 6f72 2824 6578 632d 3e67  setError($exc->g
+00022ca0: 6574 4d65 7373 6167 6528 2929 3b0a 2020  etMessage());.  
+00022cb0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00022cc0: 3e65 6465 6275 6728 2465 7863 2d3e 6765  >edebug($exc->ge
+00022cd0: 744d 6573 7361 6765 2829 293b 0a20 2020  tMessage());.   
+00022ce0: 2020 2020 2020 2020 2069 6620 2824 7468           if ($th
+00022cf0: 6973 2d3e 6578 6365 7074 696f 6e73 2920  is->exceptions) 
+00022d00: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00022d10: 2020 7468 726f 7720 2465 7863 3b0a 2020    throw $exc;.  
+00022d20: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+00022d30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00022d40: 6661 6c73 653b 0a20 2020 2020 2020 207d  false;.        }
+00022d50: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00022d60: 2074 7275 653b 0a20 2020 207d 0a0a 2020   true;.    }..  
+00022d70: 2020 2f2a 2a0a 2020 2020 202a 2041 6464    /**.     * Add
+00022d80: 2061 6e20 656d 6265 6464 6564 2073 7472   an embedded str
+00022d90: 696e 6769 6669 6564 2061 7474 6163 686d  ingified attachm
+00022da0: 656e 742e 0a20 2020 2020 2a20 5468 6973  ent..     * This
+00022db0: 2063 616e 2069 6e63 6c75 6465 2069 6d61   can include ima
+00022dc0: 6765 732c 2073 6f75 6e64 732c 2061 6e64  ges, sounds, and
+00022dd0: 206a 7573 7420 6162 6f75 7420 616e 7920   just about any 
+00022de0: 6f74 6865 7220 646f 6375 6d65 6e74 2074  other document t
+00022df0: 7970 652e 0a20 2020 2020 2a20 4966 2079  ype..     * If y
+00022e00: 6f75 7220 6669 6c65 6e61 6d65 2064 6f65  our filename doe
+00022e10: 736e 2774 2063 6f6e 7461 696e 2061 6e20  sn't contain an 
+00022e20: 6578 7465 6e73 696f 6e2c 2062 6520 7375  extension, be su
+00022e30: 7265 2074 6f20 7365 7420 7468 6520 2474  re to set the $t
+00022e40: 7970 6520 746f 2061 6e20 6170 7072 6f70  ype to an approp
+00022e50: 7269 6174 6520 4d49 4d45 2074 7970 652e  riate MIME type.
+00022e60: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00022e70: 7061 7261 6d20 7374 7269 6e67 2024 7374  param string $st
+00022e80: 7269 6e67 2020 2020 2020 5468 6520 6174  ring      The at
+00022e90: 7461 6368 6d65 6e74 2062 696e 6172 7920  tachment binary 
+00022ea0: 6461 7461 0a20 2020 2020 2a20 4070 6172  data.     * @par
+00022eb0: 616d 2073 7472 696e 6720 2463 6964 2020  am string $cid  
+00022ec0: 2020 2020 2020 2043 6f6e 7465 6e74 2049         Content I
+00022ed0: 4420 6f66 2074 6865 2061 7474 6163 686d  D of the attachm
+00022ee0: 656e 743b 2055 7365 2074 6869 7320 746f  ent; Use this to
+00022ef0: 2072 6566 6572 656e 6365 0a20 2020 2020   reference.     
+00022f00: 2a20 2020 2020 2020 2020 2020 2020 2020  *               
+00022f10: 2020 2020 2020 2020 2020 2020 2074 6865               the
+00022f20: 2063 6f6e 7465 6e74 2077 6865 6e20 7573   content when us
+00022f30: 696e 6720 616e 2065 6d62 6564 6465 6420  ing an embedded 
+00022f40: 696d 6167 6520 696e 2048 544d 4c0a 2020  image in HTML.  
+00022f50: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00022f60: 6e67 2024 6e61 6d65 2020 2020 2020 2020  ng $name        
+00022f70: 4120 6669 6c65 6e61 6d65 2066 6f72 2074  A filename for t
+00022f80: 6865 2061 7474 6163 686d 656e 742e 2049  he attachment. I
+00022f90: 6620 7468 6973 2063 6f6e 7461 696e 7320  f this contains 
+00022fa0: 616e 2065 7874 656e 7369 6f6e 2c0a 2020  an extension,.  
+00022fb0: 2020 202a 2020 2020 2020 2020 2020 2020     *            
+00022fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022fd0: 5048 504d 6169 6c65 7220 7769 6c6c 2061  PHPMailer will a
+00022fe0: 7474 656d 7074 2074 6f20 7365 7420 6120  ttempt to set a 
+00022ff0: 4d49 4d45 2074 7970 6520 666f 7220 7468  MIME type for th
+00023000: 6520 6174 7461 6368 6d65 6e74 2e0a 2020  e attachment..  
+00023010: 2020 202a 2020 2020 2020 2020 2020 2020     *            
+00023020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023030: 466f 7220 6578 616d 706c 6520 2766 696c  For example 'fil
+00023040: 652e 6a70 6727 2077 6f75 6c64 2067 6574  e.jpg' would get
+00023050: 2061 6e20 2769 6d61 6765 2f6a 7065 6727   an 'image/jpeg'
+00023060: 204d 494d 4520 7479 7065 2e0a 2020 2020   MIME type..    
+00023070: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00023080: 2024 656e 636f 6469 6e67 2020 2020 4669   $encoding    Fi
+00023090: 6c65 2065 6e63 6f64 696e 6720 2873 6565  le encoding (see
+000230a0: 2024 456e 636f 6469 6e67 292c 2064 6566   $Encoding), def
+000230b0: 6175 6c74 7320 746f 2027 6261 7365 3634  aults to 'base64
+000230c0: 270a 2020 2020 202a 2040 7061 7261 6d20  '.     * @param 
+000230d0: 7374 7269 6e67 2024 7479 7065 2020 2020  string $type    
+000230e0: 2020 2020 4d49 4d45 2074 7970 6520 2d20      MIME type - 
+000230f0: 7769 6c6c 2062 6520 7573 6564 2069 6e20  will be used in 
+00023100: 7072 6566 6572 656e 6365 2074 6f20 616e  preference to an
+00023110: 7920 6175 746f 6d61 7469 6361 6c6c 7920  y automatically 
+00023120: 6465 7269 7665 6420 7479 7065 0a20 2020  derived type.   
+00023130: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00023140: 6720 2464 6973 706f 7369 7469 6f6e 2044  g $disposition D
+00023150: 6973 706f 7369 7469 6f6e 2074 6f20 7573  isposition to us
+00023160: 650a 2020 2020 202a 0a20 2020 2020 2a20  e.     *.     * 
+00023170: 4074 6872 6f77 7320 4578 6365 7074 696f  @throws Exceptio
+00023180: 6e0a 2020 2020 202a 0a20 2020 2020 2a20  n.     *.     * 
+00023190: 4072 6574 7572 6e20 626f 6f6c 2054 7275  @return bool Tru
+000231a0: 6520 6f6e 2073 7563 6365 7373 6675 6c6c  e on successfull
+000231b0: 7920 6164 6469 6e67 2061 6e20 6174 7461  y adding an atta
+000231c0: 6368 6d65 6e74 0a20 2020 2020 2a2f 0a20  chment.     */. 
+000231d0: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
+000231e0: 6f6e 2061 6464 5374 7269 6e67 456d 6265  on addStringEmbe
+000231f0: 6464 6564 496d 6167 6528 0a20 2020 2020  ddedImage(.     
+00023200: 2020 2024 7374 7269 6e67 2c0a 2020 2020     $string,.    
+00023210: 2020 2020 2463 6964 2c0a 2020 2020 2020      $cid,.      
+00023220: 2020 246e 616d 6520 3d20 2727 2c0a 2020    $name = '',.  
+00023230: 2020 2020 2020 2465 6e63 6f64 696e 6720        $encoding 
+00023240: 3d20 7365 6c66 3a3a 454e 434f 4449 4e47  = self::ENCODING
+00023250: 5f42 4153 4536 342c 0a20 2020 2020 2020  _BASE64,.       
+00023260: 2024 7479 7065 203d 2027 272c 0a20 2020   $type = '',.   
+00023270: 2020 2020 2024 6469 7370 6f73 6974 696f       $dispositio
+00023280: 6e20 3d20 2769 6e6c 696e 6527 0a20 2020  n = 'inline'.   
+00023290: 2029 207b 0a20 2020 2020 2020 2074 7279   ) {.        try
+000232a0: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
+000232b0: 2f49 6620 6120 4d49 4d45 2074 7970 6520  /If a MIME type 
+000232c0: 6973 206e 6f74 2073 7065 6369 6669 6564  is not specified
+000232d0: 2c20 7472 7920 746f 2077 6f72 6b20 6974  , try to work it
+000232e0: 206f 7574 2066 726f 6d20 7468 6520 6e61   out from the na
+000232f0: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
+00023300: 6620 2827 2720 3d3d 3d20 2474 7970 6520  f ('' === $type 
+00023310: 2626 2021 656d 7074 7928 246e 616d 6529  && !empty($name)
+00023320: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00023330: 2020 2020 2474 7970 6520 3d20 7374 6174      $type = stat
+00023340: 6963 3a3a 6669 6c65 6e61 6d65 546f 5479  ic::filenameToTy
+00023350: 7065 2824 6e61 6d65 293b 0a20 2020 2020  pe($name);.     
+00023360: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00023370: 2020 2020 2020 6966 2028 2124 7468 6973        if (!$this
+00023380: 2d3e 7661 6c69 6461 7465 456e 636f 6469  ->validateEncodi
+00023390: 6e67 2824 656e 636f 6469 6e67 2929 207b  ng($encoding)) {
+000233a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000233b0: 2074 6872 6f77 206e 6577 2045 7863 6570   throw new Excep
+000233c0: 7469 6f6e 2824 7468 6973 2d3e 6c61 6e67  tion($this->lang
+000233d0: 2827 656e 636f 6469 6e67 2729 202e 2024  ('encoding') . $
+000233e0: 656e 636f 6469 6e67 293b 0a20 2020 2020  encoding);.     
+000233f0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00023400: 2020 2020 2020 2f2f 4170 7065 6e64 2074        //Append t
+00023410: 6f20 2461 7474 6163 686d 656e 7420 6172  o $attachment ar
+00023420: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00023430: 2474 6869 732d 3e61 7474 6163 686d 656e  $this->attachmen
+00023440: 745b 5d20 3d20 5b0a 2020 2020 2020 2020  t[] = [.        
+00023450: 2020 2020 2020 2020 3020 3d3e 2024 7374          0 => $st
+00023460: 7269 6e67 2c0a 2020 2020 2020 2020 2020  ring,.          
+00023470: 2020 2020 2020 3120 3d3e 2024 6e61 6d65        1 => $name
+00023480: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00023490: 2020 3220 3d3e 2024 6e61 6d65 2c0a 2020    2 => $name,.  
+000234a0: 2020 2020 2020 2020 2020 2020 2020 3320                3 
+000234b0: 3d3e 2024 656e 636f 6469 6e67 2c0a 2020  => $encoding,.  
+000234c0: 2020 2020 2020 2020 2020 2020 2020 3420                4 
+000234d0: 3d3e 2024 7479 7065 2c0a 2020 2020 2020  => $type,.      
+000234e0: 2020 2020 2020 2020 2020 3520 3d3e 2074            5 => t
+000234f0: 7275 652c 202f 2f69 7353 7472 696e 6741  rue, //isStringA
+00023500: 7474 6163 686d 656e 740a 2020 2020 2020  ttachment.      
+00023510: 2020 2020 2020 2020 2020 3620 3d3e 2024            6 => $
+00023520: 6469 7370 6f73 6974 696f 6e2c 0a20 2020  disposition,.   
+00023530: 2020 2020 2020 2020 2020 2020 2037 203d               7 =
+00023540: 3e20 2463 6964 2c0a 2020 2020 2020 2020  > $cid,.        
+00023550: 2020 2020 5d3b 0a20 2020 2020 2020 207d      ];.        }
+00023560: 2063 6174 6368 2028 4578 6365 7074 696f   catch (Exceptio
+00023570: 6e20 2465 7863 2920 7b0a 2020 2020 2020  n $exc) {.      
+00023580: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
+00023590: 4572 726f 7228 2465 7863 2d3e 6765 744d  Error($exc->getM
+000235a0: 6573 7361 6765 2829 293b 0a20 2020 2020  essage());.     
+000235b0: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
+000235c0: 6562 7567 2824 6578 632d 3e67 6574 4d65  ebug($exc->getMe
+000235d0: 7373 6167 6528 2929 3b0a 2020 2020 2020  ssage());.      
+000235e0: 2020 2020 2020 6966 2028 2474 6869 732d        if ($this-
+000235f0: 3e65 7863 6570 7469 6f6e 7329 207b 0a20  >exceptions) {. 
+00023600: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00023610: 6872 6f77 2024 6578 633b 0a20 2020 2020  hrow $exc;.     
+00023620: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00023630: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+00023640: 7365 3b0a 2020 2020 2020 2020 7d0a 0a20  se;.        }.. 
+00023650: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+00023660: 7565 3b0a 2020 2020 7d0a 0a20 2020 202f  ue;.    }..    /
+00023670: 2a2a 0a20 2020 2020 2a20 5661 6c69 6461  **.     * Valida
+00023680: 7465 2065 6e63 6f64 696e 6773 2e0a 2020  te encodings..  
+00023690: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
+000236a0: 616d 2073 7472 696e 6720 2465 6e63 6f64  am string $encod
+000236b0: 696e 670a 2020 2020 202a 0a20 2020 2020  ing.     *.     
+000236c0: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
+000236d0: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
+000236e0: 6374 6564 2066 756e 6374 696f 6e20 7661  cted function va
+000236f0: 6c69 6461 7465 456e 636f 6469 6e67 2824  lidateEncoding($
+00023700: 656e 636f 6469 6e67 290a 2020 2020 7b0a  encoding).    {.
+00023710: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00023720: 6e5f 6172 7261 7928 0a20 2020 2020 2020  n_array(.       
+00023730: 2020 2020 2024 656e 636f 6469 6e67 2c0a       $encoding,.
+00023740: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
+00023750: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00023760: 6c66 3a3a 454e 434f 4449 4e47 5f37 4249  lf::ENCODING_7BI
+00023770: 542c 0a20 2020 2020 2020 2020 2020 2020  T,.             
+00023780: 2020 2073 656c 663a 3a45 4e43 4f44 494e     self::ENCODIN
+00023790: 475f 5155 4f54 4544 5f50 5249 4e54 4142  G_QUOTED_PRINTAB
+000237a0: 4c45 2c0a 2020 2020 2020 2020 2020 2020  LE,.            
+000237b0: 2020 2020 7365 6c66 3a3a 454e 434f 4449      self::ENCODI
+000237c0: 4e47 5f42 4153 4536 342c 0a20 2020 2020  NG_BASE64,.     
+000237d0: 2020 2020 2020 2020 2020 2073 656c 663a             self:
+000237e0: 3a45 4e43 4f44 494e 475f 3842 4954 2c0a  :ENCODING_8BIT,.
+000237f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023800: 7365 6c66 3a3a 454e 434f 4449 4e47 5f42  self::ENCODING_B
+00023810: 494e 4152 592c 0a20 2020 2020 2020 2020  INARY,.         
+00023820: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
+00023830: 2020 7472 7565 0a20 2020 2020 2020 2029    true.        )
+00023840: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+00023850: 0a20 2020 2020 2a20 4368 6563 6b20 6966  .     * Check if
+00023860: 2061 6e20 656d 6265 6464 6564 2061 7474   an embedded att
+00023870: 6163 686d 656e 7420 6973 2070 7265 7365  achment is prese
+00023880: 6e74 2077 6974 6820 7468 6973 2063 6964  nt with this cid
+00023890: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+000238a0: 4070 6172 616d 2073 7472 696e 6720 2463  @param string $c
+000238b0: 6964 0a20 2020 2020 2a0a 2020 2020 202a  id.     *.     *
+000238c0: 2040 7265 7475 726e 2062 6f6f 6c0a 2020   @return bool.  
+000238d0: 2020 202a 2f0a 2020 2020 7072 6f74 6563     */.    protec
+000238e0: 7465 6420 6675 6e63 7469 6f6e 2063 6964  ted function cid
+000238f0: 4578 6973 7473 2824 6369 6429 0a20 2020  Exists($cid).   
+00023900: 207b 0a20 2020 2020 2020 2066 6f72 6561   {.        forea
+00023910: 6368 2028 2474 6869 732d 3e61 7474 6163  ch ($this->attac
+00023920: 686d 656e 7420 6173 2024 6174 7461 6368  hment as $attach
+00023930: 6d65 6e74 2920 7b0a 2020 2020 2020 2020  ment) {.        
+00023940: 2020 2020 6966 2028 2769 6e6c 696e 6527      if ('inline'
+00023950: 203d 3d3d 2024 6174 7461 6368 6d65 6e74   === $attachment
+00023960: 5b36 5d20 2626 2024 6369 6420 3d3d 3d20  [6] && $cid === 
+00023970: 2461 7474 6163 686d 656e 745b 375d 2920  $attachment[7]) 
+00023980: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00023990: 2020 7265 7475 726e 2074 7275 653b 0a20    return true;. 
+000239a0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+000239b0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+000239c0: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
+000239d0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+000239e0: 2020 2a20 4368 6563 6b20 6966 2061 6e20    * Check if an 
+000239f0: 696e 6c69 6e65 2061 7474 6163 686d 656e  inline attachmen
+00023a00: 7420 6973 2070 7265 7365 6e74 2e0a 2020  t is present..  
+00023a10: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
+00023a20: 7572 6e20 626f 6f6c 0a20 2020 2020 2a2f  urn bool.     */
+00023a30: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
+00023a40: 7469 6f6e 2069 6e6c 696e 6549 6d61 6765  tion inlineImage
+00023a50: 4578 6973 7473 2829 0a20 2020 207b 0a20  Exists().    {. 
+00023a60: 2020 2020 2020 2066 6f72 6561 6368 2028         foreach (
+00023a70: 2474 6869 732d 3e61 7474 6163 686d 656e  $this->attachmen
+00023a80: 7420 6173 2024 6174 7461 6368 6d65 6e74  t as $attachment
+00023a90: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00023aa0: 6966 2028 2769 6e6c 696e 6527 203d 3d3d  if ('inline' ===
+00023ab0: 2024 6174 7461 6368 6d65 6e74 5b36 5d29   $attachment[6])
+00023ac0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00023ad0: 2020 2072 6574 7572 6e20 7472 7565 3b0a     return true;.
+00023ae0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00023af0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00023b00: 2072 6574 7572 6e20 6661 6c73 653b 0a20   return false;. 
+00023b10: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
+00023b20: 2020 202a 2043 6865 636b 2069 6620 616e     * Check if an
+00023b30: 2061 7474 6163 686d 656e 7420 286e 6f6e   attachment (non
+00023b40: 2d69 6e6c 696e 6529 2069 7320 7072 6573  -inline) is pres
+00023b50: 656e 742e 0a20 2020 2020 2a0a 2020 2020  ent..     *.    
+00023b60: 202a 2040 7265 7475 726e 2062 6f6f 6c0a   * @return bool.
+00023b70: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+00023b80: 6963 2066 756e 6374 696f 6e20 6174 7461  ic function atta
+00023b90: 6368 6d65 6e74 4578 6973 7473 2829 0a20  chmentExists(). 
+00023ba0: 2020 207b 0a20 2020 2020 2020 2066 6f72     {.        for
+00023bb0: 6561 6368 2028 2474 6869 732d 3e61 7474  each ($this->att
+00023bc0: 6163 686d 656e 7420 6173 2024 6174 7461  achment as $atta
+00023bd0: 6368 6d65 6e74 2920 7b0a 2020 2020 2020  chment) {.      
+00023be0: 2020 2020 2020 6966 2028 2761 7474 6163        if ('attac
+00023bf0: 686d 656e 7427 203d 3d3d 2024 6174 7461  hment' === $atta
+00023c00: 6368 6d65 6e74 5b36 5d29 207b 0a20 2020  chment[6]) {.   
+00023c10: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00023c20: 7572 6e20 7472 7565 3b0a 2020 2020 2020  urn true;.      
+00023c30: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00023c40: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+00023c50: 6e20 6661 6c73 653b 0a20 2020 207d 0a0a  n false;.    }..
+00023c60: 2020 2020 2f2a 2a0a 2020 2020 202a 2043      /**.     * C
+00023c70: 6865 636b 2069 6620 7468 6973 206d 6573  heck if this mes
+00023c80: 7361 6765 2068 6173 2061 6e20 616c 7465  sage has an alte
+00023c90: 726e 6174 6976 6520 626f 6479 2073 6574  rnative body set
+00023ca0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00023cb0: 4072 6574 7572 6e20 626f 6f6c 0a20 2020  @return bool.   
+00023cc0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00023cd0: 6675 6e63 7469 6f6e 2061 6c74 6572 6e61  function alterna
+00023ce0: 7469 7665 4578 6973 7473 2829 0a20 2020  tiveExists().   
+00023cf0: 207b 0a20 2020 2020 2020 2072 6574 7572   {.        retur
+00023d00: 6e20 2165 6d70 7479 2824 7468 6973 2d3e  n !empty($this->
+00023d10: 416c 7442 6f64 7929 3b0a 2020 2020 7d0a  AltBody);.    }.
+00023d20: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00023d30: 436c 6561 7220 7175 6575 6564 2061 6464  Clear queued add
+00023d40: 7265 7373 6573 206f 6620 6769 7665 6e20  resses of given 
+00023d50: 6b69 6e64 2e0a 2020 2020 202a 0a20 2020  kind..     *.   
+00023d60: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00023d70: 6720 246b 696e 6420 2774 6f27 2c20 2763  g $kind 'to', 'c
+00023d80: 6327 2c20 6f72 2027 6263 6327 0a20 2020  c', or 'bcc'.   
+00023d90: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00023da0: 6675 6e63 7469 6f6e 2063 6c65 6172 5175  function clearQu
+00023db0: 6575 6564 4164 6472 6573 7365 7328 246b  euedAddresses($k
+00023dc0: 696e 6429 0a20 2020 207b 0a20 2020 2020  ind).    {.     
+00023dd0: 2020 2024 7468 6973 2d3e 5265 6369 7069     $this->Recipi
+00023de0: 656e 7473 5175 6575 6520 3d20 6172 7261  entsQueue = arra
+00023df0: 795f 6669 6c74 6572 280a 2020 2020 2020  y_filter(.      
+00023e00: 2020 2020 2020 2474 6869 732d 3e52 6563        $this->Rec
+00023e10: 6970 6965 6e74 7351 7565 7565 2c0a 2020  ipientsQueue,.  
+00023e20: 2020 2020 2020 2020 2020 7374 6174 6963            static
+00023e30: 2066 756e 6374 696f 6e20 2824 7061 7261   function ($para
+00023e40: 6d73 2920 7573 6520 2824 6b69 6e64 2920  ms) use ($kind) 
+00023e50: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00023e60: 2020 7265 7475 726e 2024 7061 7261 6d73    return $params
+00023e70: 5b30 5d20 213d 3d20 246b 696e 643b 0a20  [0] !== $kind;. 
+00023e80: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00023e90: 2020 2020 2029 3b0a 2020 2020 7d0a 0a20       );.    }.. 
+00023ea0: 2020 202f 2a2a 0a20 2020 2020 2a20 436c     /**.     * Cl
+00023eb0: 6561 7220 616c 6c20 546f 2072 6563 6970  ear all To recip
+00023ec0: 6965 6e74 732e 0a20 2020 2020 2a2f 0a20  ients..     */. 
+00023ed0: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
+00023ee0: 6f6e 2063 6c65 6172 4164 6472 6573 7365  on clearAddresse
+00023ef0: 7328 290a 2020 2020 7b0a 2020 2020 2020  s().    {.      
+00023f00: 2020 666f 7265 6163 6820 2824 7468 6973    foreach ($this
+00023f10: 2d3e 746f 2061 7320 2474 6f29 207b 0a20  ->to as $to) {. 
+00023f20: 2020 2020 2020 2020 2020 2075 6e73 6574             unset
+00023f30: 2824 7468 6973 2d3e 616c 6c5f 7265 6369  ($this->all_reci
+00023f40: 7069 656e 7473 5b73 7472 746f 6c6f 7765  pients[strtolowe
+00023f50: 7228 2474 6f5b 305d 295d 293b 0a20 2020  r($to[0])]);.   
+00023f60: 2020 2020 207d 0a20 2020 2020 2020 2024       }.        $
+00023f70: 7468 6973 2d3e 746f 203d 205b 5d3b 0a20  this->to = [];. 
+00023f80: 2020 2020 2020 2024 7468 6973 2d3e 636c         $this->cl
+00023f90: 6561 7251 7565 7565 6441 6464 7265 7373  earQueuedAddress
+00023fa0: 6573 2827 746f 2729 3b0a 2020 2020 7d0a  es('to');.    }.
+00023fb0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+00023fc0: 436c 6561 7220 616c 6c20 4343 2072 6563  Clear all CC rec
+00023fd0: 6970 6965 6e74 732e 0a20 2020 2020 2a2f  ipients..     */
+00023fe0: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
+00023ff0: 7469 6f6e 2063 6c65 6172 4343 7328 290a  tion clearCCs().
+00024000: 2020 2020 7b0a 2020 2020 2020 2020 666f      {.        fo
+00024010: 7265 6163 6820 2824 7468 6973 2d3e 6363  reach ($this->cc
+00024020: 2061 7320 2463 6329 207b 0a20 2020 2020   as $cc) {.     
+00024030: 2020 2020 2020 2075 6e73 6574 2824 7468         unset($th
+00024040: 6973 2d3e 616c 6c5f 7265 6369 7069 656e  is->all_recipien
+00024050: 7473 5b73 7472 746f 6c6f 7765 7228 2463  ts[strtolower($c
+00024060: 635b 305d 295d 293b 0a20 2020 2020 2020  c[0])]);.       
+00024070: 207d 0a20 2020 2020 2020 2024 7468 6973   }.        $this
+00024080: 2d3e 6363 203d 205b 5d3b 0a20 2020 2020  ->cc = [];.     
+00024090: 2020 2024 7468 6973 2d3e 636c 6561 7251     $this->clearQ
+000240a0: 7565 7565 6441 6464 7265 7373 6573 2827  ueuedAddresses('
+000240b0: 6363 2729 3b0a 2020 2020 7d0a 0a20 2020  cc');.    }..   
+000240c0: 202f 2a2a 0a20 2020 2020 2a20 436c 6561   /**.     * Clea
+000240d0: 7220 616c 6c20 4243 4320 7265 6369 7069  r all BCC recipi
+000240e0: 656e 7473 2e0a 2020 2020 202a 2f0a 2020  ents..     */.  
+000240f0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+00024100: 6e20 636c 6561 7242 4343 7328 290a 2020  n clearBCCs().  
+00024110: 2020 7b0a 2020 2020 2020 2020 666f 7265    {.        fore
+00024120: 6163 6820 2824 7468 6973 2d3e 6263 6320  ach ($this->bcc 
+00024130: 6173 2024 6263 6329 207b 0a20 2020 2020  as $bcc) {.     
+00024140: 2020 2020 2020 2075 6e73 6574 2824 7468         unset($th
+00024150: 6973 2d3e 616c 6c5f 7265 6369 7069 656e  is->all_recipien
+00024160: 7473 5b73 7472 746f 6c6f 7765 7228 2462  ts[strtolower($b
+00024170: 6363 5b30 5d29 5d29 3b0a 2020 2020 2020  cc[0])]);.      
+00024180: 2020 7d0a 2020 2020 2020 2020 2474 6869    }.        $thi
+00024190: 732d 3e62 6363 203d 205b 5d3b 0a20 2020  s->bcc = [];.   
+000241a0: 2020 2020 2024 7468 6973 2d3e 636c 6561       $this->clea
+000241b0: 7251 7565 7565 6441 6464 7265 7373 6573  rQueuedAddresses
+000241c0: 2827 6263 6327 293b 0a20 2020 207d 0a0a  ('bcc');.    }..
+000241d0: 2020 2020 2f2a 2a0a 2020 2020 202a 2043      /**.     * C
+000241e0: 6c65 6172 2061 6c6c 2052 6570 6c79 546f  lear all ReplyTo
+000241f0: 2072 6563 6970 6965 6e74 732e 0a20 2020   recipients..   
+00024200: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00024210: 6675 6e63 7469 6f6e 2063 6c65 6172 5265  function clearRe
+00024220: 706c 7954 6f73 2829 0a20 2020 207b 0a20  plyTos().    {. 
+00024230: 2020 2020 2020 2024 7468 6973 2d3e 5265         $this->Re
+00024240: 706c 7954 6f20 3d20 5b5d 3b0a 2020 2020  plyTo = [];.    
+00024250: 2020 2020 2474 6869 732d 3e52 6570 6c79      $this->Reply
+00024260: 546f 5175 6575 6520 3d20 5b5d 3b0a 2020  ToQueue = [];.  
+00024270: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+00024280: 2020 2a20 436c 6561 7220 616c 6c20 7265    * Clear all re
+00024290: 6369 7069 656e 7420 7479 7065 732e 0a20  cipient types.. 
+000242a0: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+000242b0: 6320 6675 6e63 7469 6f6e 2063 6c65 6172  c function clear
+000242c0: 416c 6c52 6563 6970 6965 6e74 7328 290a  AllRecipients().
+000242d0: 2020 2020 7b0a 2020 2020 2020 2020 2474      {.        $t
+000242e0: 6869 732d 3e74 6f20 3d20 5b5d 3b0a 2020  his->to = [];.  
+000242f0: 2020 2020 2020 2474 6869 732d 3e63 6320        $this->cc 
+00024300: 3d20 5b5d 3b0a 2020 2020 2020 2020 2474  = [];.        $t
+00024310: 6869 732d 3e62 6363 203d 205b 5d3b 0a20  his->bcc = [];. 
+00024320: 2020 2020 2020 2024 7468 6973 2d3e 616c         $this->al
+00024330: 6c5f 7265 6369 7069 656e 7473 203d 205b  l_recipients = [
+00024340: 5d3b 0a20 2020 2020 2020 2024 7468 6973  ];.        $this
+00024350: 2d3e 5265 6369 7069 656e 7473 5175 6575  ->RecipientsQueu
+00024360: 6520 3d20 5b5d 3b0a 2020 2020 7d0a 0a20  e = [];.    }.. 
+00024370: 2020 202f 2a2a 0a20 2020 2020 2a20 436c     /**.     * Cl
+00024380: 6561 7220 616c 6c20 6669 6c65 7379 7374  ear all filesyst
+00024390: 656d 2c20 7374 7269 6e67 2c20 616e 6420  em, string, and 
+000243a0: 6269 6e61 7279 2061 7474 6163 686d 656e  binary attachmen
+000243b0: 7473 2e0a 2020 2020 202a 2f0a 2020 2020  ts..     */.    
+000243c0: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+000243d0: 636c 6561 7241 7474 6163 686d 656e 7473  clearAttachments
+000243e0: 2829 0a20 2020 207b 0a20 2020 2020 2020  ().    {.       
+000243f0: 2024 7468 6973 2d3e 6174 7461 6368 6d65   $this->attachme
+00024400: 6e74 203d 205b 5d3b 0a20 2020 207d 0a0a  nt = [];.    }..
+00024410: 2020 2020 2f2a 2a0a 2020 2020 202a 2043      /**.     * C
+00024420: 6c65 6172 2061 6c6c 2063 7573 746f 6d20  lear all custom 
+00024430: 6865 6164 6572 732e 0a20 2020 2020 2a2f  headers..     */
+00024440: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
+00024450: 7469 6f6e 2063 6c65 6172 4375 7374 6f6d  tion clearCustom
+00024460: 4865 6164 6572 7328 290a 2020 2020 7b0a  Headers().    {.
+00024470: 2020 2020 2020 2020 2474 6869 732d 3e43          $this->C
+00024480: 7573 746f 6d48 6561 6465 7220 3d20 5b5d  ustomHeader = []
+00024490: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+000244a0: 0a20 2020 2020 2a20 436c 6561 7220 6120  .     * Clear a 
+000244b0: 7370 6563 6966 6963 2063 7573 746f 6d20  specific custom 
+000244c0: 6865 6164 6572 2062 7920 6e61 6d65 206f  header by name o
+000244d0: 7220 6e61 6d65 2061 6e64 2076 616c 7565  r name and value
+000244e0: 2e0a 2020 2020 202a 2024 6e61 6d65 2076  ..     * $name v
+000244f0: 616c 7565 2063 616e 2062 6520 6f76 6572  alue can be over
+00024500: 6c6f 6164 6564 2074 6f20 636f 6e74 6169  loaded to contai
+00024510: 6e0a 2020 2020 202a 2062 6f74 6820 6865  n.     * both he
+00024520: 6164 6572 206e 616d 6520 616e 6420 7661  ader name and va
+00024530: 6c75 6520 286e 616d 653a 7661 6c75 6529  lue (name:value)
+00024540: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00024550: 4070 6172 616d 2073 7472 696e 6720 2020  @param string   
+00024560: 2020 2024 6e61 6d65 2020 4375 7374 6f6d     $name  Custom
+00024570: 2068 6561 6465 7220 6e61 6d65 0a20 2020   header name.   
+00024580: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00024590: 677c 6e75 6c6c 2024 7661 6c75 6520 4865  g|null $value He
+000245a0: 6164 6572 2076 616c 7565 0a20 2020 2020  ader value.     
+000245b0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+000245c0: 2062 6f6f 6c20 5472 7565 2069 6620 6120   bool True if a 
+000245d0: 6865 6164 6572 2077 6173 2072 6570 6c61  header was repla
+000245e0: 6365 6420 7375 6363 6573 7366 756c 6c79  ced successfully
+000245f0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00024600: 6c69 6320 6675 6e63 7469 6f6e 2063 6c65  lic function cle
+00024610: 6172 4375 7374 6f6d 4865 6164 6572 2824  arCustomHeader($
+00024620: 6e61 6d65 2c20 2476 616c 7565 203d 206e  name, $value = n
+00024630: 756c 6c29 0a20 2020 207b 0a20 2020 2020  ull).    {.     
+00024640: 2020 2069 6620 286e 756c 6c20 3d3d 3d20     if (null === 
+00024650: 2476 616c 7565 2026 2620 7374 7270 6f73  $value && strpos
+00024660: 2824 6e61 6d65 2c20 273a 2729 2021 3d3d  ($name, ':') !==
+00024670: 2066 616c 7365 2920 7b0a 2020 2020 2020   false) {.      
+00024680: 2020 2020 2020 2f2f 5661 6c75 6520 7061        //Value pa
+00024690: 7373 6564 2069 6e20 6173 206e 616d 653a  ssed in as name:
+000246a0: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
+000246b0: 2020 6c69 7374 2824 6e61 6d65 2c20 2476    list($name, $v
+000246c0: 616c 7565 2920 3d20 6578 706c 6f64 6528  alue) = explode(
+000246d0: 273a 272c 2024 6e61 6d65 2c20 3229 3b0a  ':', $name, 2);.
+000246e0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000246f0: 2020 246e 616d 6520 3d20 7472 696d 2824    $name = trim($
+00024700: 6e61 6d65 293b 0a20 2020 2020 2020 2024  name);.        $
+00024710: 7661 6c75 6520 3d20 286e 756c 6c20 3d3d  value = (null ==
+00024720: 3d20 2476 616c 7565 2920 3f20 6e75 6c6c  = $value) ? null
+00024730: 203a 2074 7269 6d28 2476 616c 7565 293b   : trim($value);
+00024740: 0a0a 2020 2020 2020 2020 666f 7265 6163  ..        foreac
+00024750: 6820 2824 7468 6973 2d3e 4375 7374 6f6d  h ($this->Custom
+00024760: 4865 6164 6572 2061 7320 246b 203d 3e20  Header as $k => 
+00024770: 2470 6169 7229 207b 0a20 2020 2020 2020  $pair) {.       
+00024780: 2020 2020 2069 6620 2824 7061 6972 5b30       if ($pair[0
+00024790: 5d20 3d3d 2024 6e61 6d65 2920 7b0a 2020  ] == $name) {.  
+000247a0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
+000247b0: 2057 6520 7265 6d6f 7665 2074 6865 2068   We remove the h
+000247c0: 6561 6465 7220 6966 2074 6865 2076 616c  eader if the val
+000247d0: 7565 2069 7320 6e6f 7420 7072 6f76 6964  ue is not provid
+000247e0: 6564 206f 7220 6974 206d 6174 6368 6573  ed or it matches
+000247f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024800: 2020 6966 2028 6e75 6c6c 203d 3d3d 2024    if (null === $
+00024810: 7661 6c75 6520 7c7c 2020 2470 6169 725b  value ||  $pair[
+00024820: 315d 203d 3d20 2476 616c 7565 2920 7b0a  1] == $value) {.
+00024830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024840: 2020 2020 756e 7365 7428 2474 6869 732d      unset($this-
+00024850: 3e43 7573 746f 6d48 6561 6465 725b 246b  >CustomHeader[$k
+00024860: 5d29 3b0a 2020 2020 2020 2020 2020 2020  ]);.            
+00024870: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00024880: 2020 7d0a 2020 2020 2020 2020 7d0a 0a20    }.        }.. 
+00024890: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+000248a0: 7565 3b0a 2020 2020 7d0a 0a20 2020 202f  ue;.    }..    /
+000248b0: 2a2a 0a20 2020 2020 2a20 5265 706c 6163  **.     * Replac
+000248c0: 6520 6120 6375 7374 6f6d 2068 6561 6465  e a custom heade
+000248d0: 722e 0a20 2020 2020 2a20 246e 616d 6520  r..     * $name 
+000248e0: 7661 6c75 6520 6361 6e20 6265 206f 7665  value can be ove
+000248f0: 726c 6f61 6465 6420 746f 2063 6f6e 7461  rloaded to conta
+00024900: 696e 0a20 2020 2020 2a20 626f 7468 2068  in.     * both h
+00024910: 6561 6465 7220 6e61 6d65 2061 6e64 2076  eader name and v
+00024920: 616c 7565 2028 6e61 6d65 3a76 616c 7565  alue (name:value
+00024930: 292e 0a20 2020 2020 2a0a 2020 2020 202a  )..     *.     *
+00024940: 2040 7061 7261 6d20 7374 7269 6e67 2020   @param string  
+00024950: 2020 2020 246e 616d 6520 2043 7573 746f      $name  Custo
+00024960: 6d20 6865 6164 6572 206e 616d 650a 2020  m header name.  
+00024970: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00024980: 6e67 7c6e 756c 6c20 2476 616c 7565 2048  ng|null $value H
+00024990: 6561 6465 7220 7661 6c75 650a 2020 2020  eader value.    
+000249a0: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+000249b0: 6e20 626f 6f6c 2054 7275 6520 6966 2061  n bool True if a
+000249c0: 2068 6561 6465 7220 7761 7320 7265 706c   header was repl
+000249d0: 6163 6564 2073 7563 6365 7373 6675 6c6c  aced successfull
+000249e0: 790a 2020 2020 202a 2040 7468 726f 7773  y.     * @throws
+000249f0: 2045 7863 6570 7469 6f6e 0a20 2020 2020   Exception.     
+00024a00: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+00024a10: 6e63 7469 6f6e 2072 6570 6c61 6365 4375  nction replaceCu
+00024a20: 7374 6f6d 4865 6164 6572 2824 6e61 6d65  stomHeader($name
+00024a30: 2c20 2476 616c 7565 203d 206e 756c 6c29  , $value = null)
+00024a40: 0a20 2020 207b 0a20 2020 2020 2020 2069  .    {.        i
+00024a50: 6620 286e 756c 6c20 3d3d 3d20 2476 616c  f (null === $val
+00024a60: 7565 2026 2620 7374 7270 6f73 2824 6e61  ue && strpos($na
+00024a70: 6d65 2c20 273a 2729 2021 3d3d 2066 616c  me, ':') !== fal
+00024a80: 7365 2920 7b0a 2020 2020 2020 2020 2020  se) {.          
+00024a90: 2020 2f2f 5661 6c75 6520 7061 7373 6564    //Value passed
+00024aa0: 2069 6e20 6173 206e 616d 653a 7661 6c75   in as name:valu
+00024ab0: 650a 2020 2020 2020 2020 2020 2020 6c69  e.            li
+00024ac0: 7374 2824 6e61 6d65 2c20 2476 616c 7565  st($name, $value
+00024ad0: 2920 3d20 6578 706c 6f64 6528 273a 272c  ) = explode(':',
+00024ae0: 2024 6e61 6d65 2c20 3229 3b0a 2020 2020   $name, 2);.    
+00024af0: 2020 2020 7d0a 2020 2020 2020 2020 246e      }.        $n
+00024b00: 616d 6520 3d20 7472 696d 2824 6e61 6d65  ame = trim($name
+00024b10: 293b 0a20 2020 2020 2020 2024 7661 6c75  );.        $valu
+00024b20: 6520 3d20 286e 756c 6c20 3d3d 3d20 2476  e = (null === $v
+00024b30: 616c 7565 2920 3f20 2727 203a 2074 7269  alue) ? '' : tri
+00024b40: 6d28 2476 616c 7565 293b 0a0a 2020 2020  m($value);..    
+00024b50: 2020 2020 2472 6570 6c61 6365 6420 3d20      $replaced = 
+00024b60: 6661 6c73 653b 0a20 2020 2020 2020 2066  false;.        f
+00024b70: 6f72 6561 6368 2028 2474 6869 732d 3e43  oreach ($this->C
+00024b80: 7573 746f 6d48 6561 6465 7220 6173 2024  ustomHeader as $
+00024b90: 6b20 3d3e 2024 7061 6972 2920 7b0a 2020  k => $pair) {.  
+00024ba0: 2020 2020 2020 2020 2020 6966 2028 2470            if ($p
+00024bb0: 6169 725b 305d 203d 3d20 246e 616d 6529  air[0] == $name)
+00024bc0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00024bd0: 2020 2069 6620 2824 7265 706c 6163 6564     if ($replaced
+00024be0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00024bf0: 2020 2020 2020 2020 756e 7365 7428 2474          unset($t
+00024c00: 6869 732d 3e43 7573 746f 6d48 6561 6465  his->CustomHeade
+00024c10: 725b 246b 5d29 3b0a 2020 2020 2020 2020  r[$k]);.        
+00024c20: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00024c30: 696e 7565 3b0a 2020 2020 2020 2020 2020  inue;.          
+00024c40: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00024c50: 2020 2020 2020 2020 6966 2028 7374 7270          if (strp
+00024c60: 6272 6b28 246e 616d 6520 2e20 2476 616c  brk($name . $val
+00024c70: 7565 2c20 225c 725c 6e22 2920 213d 3d20  ue, "\r\n") !== 
+00024c80: 6661 6c73 6529 207b 0a20 2020 2020 2020  false) {.       
+00024c90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00024ca0: 2824 7468 6973 2d3e 6578 6365 7074 696f  ($this->exceptio
+00024cb0: 6e73 2920 7b0a 2020 2020 2020 2020 2020  ns) {.          
+00024cc0: 2020 2020 2020 2020 2020 2020 2020 7468                th
+00024cd0: 726f 7720 6e65 7720 4578 6365 7074 696f  row new Exceptio
+00024ce0: 6e28 2474 6869 732d 3e6c 616e 6728 2769  n($this->lang('i
+00024cf0: 6e76 616c 6964 5f68 6561 6465 7227 2929  nvalid_header'))
+00024d00: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00024d10: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00024d20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00024d30: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
+00024d40: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00024d50: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+00024d60: 6973 2d3e 4375 7374 6f6d 4865 6164 6572  is->CustomHeader
+00024d70: 5b24 6b5d 203d 205b 246e 616d 652c 2024  [$k] = [$name, $
+00024d80: 7661 6c75 655d 3b0a 2020 2020 2020 2020  value];.        
+00024d90: 2020 2020 2020 2020 2472 6570 6c61 6365          $replace
+00024da0: 6420 3d20 7472 7565 3b0a 2020 2020 2020  d = true;.      
+00024db0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00024dc0: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+00024dd0: 6e20 7472 7565 3b0a 2020 2020 7d0a 0a20  n true;.    }.. 
+00024de0: 2020 202f 2a2a 0a20 2020 2020 2a20 4164     /**.     * Ad
+00024df0: 6420 616e 2065 7272 6f72 206d 6573 7361  d an error messa
+00024e00: 6765 2074 6f20 7468 6520 6572 726f 7220  ge to the error 
+00024e10: 636f 6e74 6169 6e65 722e 0a20 2020 2020  container..     
+00024e20: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
+00024e30: 7374 7269 6e67 2024 6d73 670a 2020 2020  string $msg.    
+00024e40: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
+00024e50: 6420 6675 6e63 7469 6f6e 2073 6574 4572  d function setEr
+00024e60: 726f 7228 246d 7367 290a 2020 2020 7b0a  ror($msg).    {.
+00024e70: 2020 2020 2020 2020 2b2b 2474 6869 732d          ++$this-
+00024e80: 3e65 7272 6f72 5f63 6f75 6e74 3b0a 2020  >error_count;.  
+00024e90: 2020 2020 2020 6966 2028 2773 6d74 7027        if ('smtp'
+00024ea0: 203d 3d3d 2024 7468 6973 2d3e 4d61 696c   === $this->Mail
+00024eb0: 6572 2026 2620 6e75 6c6c 2021 3d3d 2024  er && null !== $
+00024ec0: 7468 6973 2d3e 736d 7470 2920 7b0a 2020  this->smtp) {.  
+00024ed0: 2020 2020 2020 2020 2020 246c 6173 7465            $laste
+00024ee0: 7272 6f72 203d 2024 7468 6973 2d3e 736d  rror = $this->sm
+00024ef0: 7470 2d3e 6765 7445 7272 6f72 2829 3b0a  tp->getError();.
+00024f00: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00024f10: 2165 6d70 7479 2824 6c61 7374 6572 726f  !empty($lasterro
+00024f20: 725b 2765 7272 6f72 275d 2929 207b 0a20  r['error'])) {. 
+00024f30: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00024f40: 6d73 6720 2e3d 2024 7468 6973 2d3e 6c61  msg .= $this->la
+00024f50: 6e67 2827 736d 7470 5f65 7272 6f72 2729  ng('smtp_error')
+00024f60: 202e 2024 6c61 7374 6572 726f 725b 2765   . $lasterror['e
+00024f70: 7272 6f72 275d 3b0a 2020 2020 2020 2020  rror'];.        
+00024f80: 2020 2020 2020 2020 6966 2028 2165 6d70          if (!emp
+00024f90: 7479 2824 6c61 7374 6572 726f 725b 2764  ty($lasterror['d
+00024fa0: 6574 6169 6c27 5d29 2920 7b0a 2020 2020  etail'])) {.    
+00024fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024fc0: 246d 7367 202e 3d20 2720 2720 2e20 2474  $msg .= ' ' . $t
+00024fd0: 6869 732d 3e6c 616e 6728 2773 6d74 705f  his->lang('smtp_
+00024fe0: 6465 7461 696c 2729 202e 2024 6c61 7374  detail') . $last
+00024ff0: 6572 726f 725b 2764 6574 6169 6c27 5d3b  error['detail'];
+00025000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025010: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00025020: 2020 2069 6620 2821 656d 7074 7928 246c     if (!empty($l
+00025030: 6173 7465 7272 6f72 5b27 736d 7470 5f63  asterror['smtp_c
+00025040: 6f64 6527 5d29 2920 7b0a 2020 2020 2020  ode'])) {.      
+00025050: 2020 2020 2020 2020 2020 2020 2020 246d                $m
+00025060: 7367 202e 3d20 2720 2720 2e20 2474 6869  sg .= ' ' . $thi
+00025070: 732d 3e6c 616e 6728 2773 6d74 705f 636f  s->lang('smtp_co
+00025080: 6465 2729 202e 2024 6c61 7374 6572 726f  de') . $lasterro
+00025090: 725b 2773 6d74 705f 636f 6465 275d 3b0a  r['smtp_code'];.
+000250a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000250b0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+000250c0: 2020 6966 2028 2165 6d70 7479 2824 6c61    if (!empty($la
+000250d0: 7374 6572 726f 725b 2773 6d74 705f 636f  sterror['smtp_co
+000250e0: 6465 5f65 7827 5d29 2920 7b0a 2020 2020  de_ex'])) {.    
+000250f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025100: 246d 7367 202e 3d20 2720 2720 2e20 2474  $msg .= ' ' . $t
+00025110: 6869 732d 3e6c 616e 6728 2773 6d74 705f  his->lang('smtp_
+00025120: 636f 6465 5f65 7827 2920 2e20 246c 6173  code_ex') . $las
+00025130: 7465 7272 6f72 5b27 736d 7470 5f63 6f64  terror['smtp_cod
+00025140: 655f 6578 275d 3b0a 2020 2020 2020 2020  e_ex'];.        
+00025150: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00025160: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00025170: 7d0a 2020 2020 2020 2020 2474 6869 732d  }.        $this-
+00025180: 3e45 7272 6f72 496e 666f 203d 2024 6d73  >ErrorInfo = $ms
+00025190: 673b 0a20 2020 207d 0a0a 2020 2020 2f2a  g;.    }..    /*
+000251a0: 2a0a 2020 2020 202a 2052 6574 7572 6e20  *.     * Return 
+000251b0: 616e 2052 4643 2038 3232 2066 6f72 6d61  an RFC 822 forma
+000251c0: 7474 6564 2064 6174 652e 0a20 2020 2020  tted date..     
+000251d0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+000251e0: 2073 7472 696e 670a 2020 2020 202a 2f0a   string.     */.
+000251f0: 2020 2020 7075 626c 6963 2073 7461 7469      public stati
+00025200: 6320 6675 6e63 7469 6f6e 2072 6663 4461  c function rfcDa
+00025210: 7465 2829 0a20 2020 207b 0a20 2020 2020  te().    {.     
+00025220: 2020 202f 2f53 6574 2074 6865 2074 696d     //Set the tim
+00025230: 6520 7a6f 6e65 2074 6f20 7768 6174 6576  e zone to whatev
+00025240: 6572 2074 6865 2064 6566 6175 6c74 2069  er the default i
+00025250: 7320 746f 2061 766f 6964 2035 3030 2065  s to avoid 500 e
+00025260: 7272 6f72 730a 2020 2020 2020 2020 2f2f  rrors.        //
+00025270: 5769 6c6c 2064 6566 6175 6c74 2074 6f20  Will default to 
+00025280: 5554 4320 6966 2069 7427 7320 6e6f 7420  UTC if it's not 
+00025290: 7365 7420 7072 6f70 6572 6c79 2069 6e20  set properly in 
+000252a0: 7068 702e 696e 690a 2020 2020 2020 2020  php.ini.        
+000252b0: 6461 7465 5f64 6566 6175 6c74 5f74 696d  date_default_tim
+000252c0: 657a 6f6e 655f 7365 7428 4064 6174 655f  ezone_set(@date_
+000252d0: 6465 6661 756c 745f 7469 6d65 7a6f 6e65  default_timezone
+000252e0: 5f67 6574 2829 293b 0a0a 2020 2020 2020  _get());..      
+000252f0: 2020 7265 7475 726e 2064 6174 6528 2744    return date('D
+00025300: 2c20 6a20 4d20 5920 483a 693a 7320 4f27  , j M Y H:i:s O'
+00025310: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
+00025320: 2a0a 2020 2020 202a 2047 6574 2074 6865  *.     * Get the
+00025330: 2073 6572 7665 7220 686f 7374 6e61 6d65   server hostname
+00025340: 2e0a 2020 2020 202a 2052 6574 7572 6e73  ..     * Returns
+00025350: 2027 6c6f 6361 6c68 6f73 742e 6c6f 6361   'localhost.loca
+00025360: 6c64 6f6d 6169 6e27 2069 6620 756e 6b6e  ldomain' if unkn
+00025370: 6f77 6e2e 0a20 2020 2020 2a0a 2020 2020  own..     *.    
+00025380: 202a 2040 7265 7475 726e 2073 7472 696e   * @return strin
+00025390: 670a 2020 2020 202a 2f0a 2020 2020 7072  g.     */.    pr
+000253a0: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+000253b0: 2073 6572 7665 7248 6f73 746e 616d 6528   serverHostname(
+000253c0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+000253d0: 2472 6573 756c 7420 3d20 2727 3b0a 2020  $result = '';.  
+000253e0: 2020 2020 2020 6966 2028 2165 6d70 7479        if (!empty
+000253f0: 2824 7468 6973 2d3e 486f 7374 6e61 6d65  ($this->Hostname
+00025400: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00025410: 2024 7265 7375 6c74 203d 2024 7468 6973   $result = $this
+00025420: 2d3e 486f 7374 6e61 6d65 3b0a 2020 2020  ->Hostname;.    
+00025430: 2020 2020 7d20 656c 7365 6966 2028 6973      } elseif (is
+00025440: 7365 7428 245f 5345 5256 4552 2920 2626  set($_SERVER) &&
+00025450: 2061 7272 6179 5f6b 6579 5f65 7869 7374   array_key_exist
+00025460: 7328 2753 4552 5645 525f 4e41 4d45 272c  s('SERVER_NAME',
+00025470: 2024 5f53 4552 5645 5229 2920 7b0a 2020   $_SERVER)) {.  
+00025480: 2020 2020 2020 2020 2020 2472 6573 756c            $resul
+00025490: 7420 3d20 245f 5345 5256 4552 5b27 5345  t = $_SERVER['SE
+000254a0: 5256 4552 5f4e 414d 4527 5d3b 0a20 2020  RVER_NAME'];.   
+000254b0: 2020 2020 207d 2065 6c73 6569 6620 2866       } elseif (f
+000254c0: 756e 6374 696f 6e5f 6578 6973 7473 2827  unction_exists('
+000254d0: 6765 7468 6f73 746e 616d 6527 2920 2626  gethostname') &&
+000254e0: 2067 6574 686f 7374 6e61 6d65 2829 2021   gethostname() !
+000254f0: 3d3d 2066 616c 7365 2920 7b0a 2020 2020  == false) {.    
+00025500: 2020 2020 2020 2020 2472 6573 756c 7420          $result 
+00025510: 3d20 6765 7468 6f73 746e 616d 6528 293b  = gethostname();
+00025520: 0a20 2020 2020 2020 207d 2065 6c73 6569  .        } elsei
+00025530: 6620 2870 6870 5f75 6e61 6d65 2827 6e27  f (php_uname('n'
+00025540: 2920 213d 3d20 6661 6c73 6529 207b 0a20  ) !== false) {. 
+00025550: 2020 2020 2020 2020 2020 2024 7265 7375             $resu
+00025560: 6c74 203d 2070 6870 5f75 6e61 6d65 2827  lt = php_uname('
+00025570: 6e27 293b 0a20 2020 2020 2020 207d 0a20  n');.        }. 
+00025580: 2020 2020 2020 2069 6620 2821 7374 6174         if (!stat
+00025590: 6963 3a3a 6973 5661 6c69 6448 6f73 7428  ic::isValidHost(
+000255a0: 2472 6573 756c 7429 2920 7b0a 2020 2020  $result)) {.    
+000255b0: 2020 2020 2020 2020 7265 7475 726e 2027          return '
+000255c0: 6c6f 6361 6c68 6f73 742e 6c6f 6361 6c64  localhost.locald
+000255d0: 6f6d 6169 6e27 3b0a 2020 2020 2020 2020  omain';.        
+000255e0: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+000255f0: 6e20 2472 6573 756c 743b 0a20 2020 207d  n $result;.    }
+00025600: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00025610: 2056 616c 6964 6174 6520 7768 6574 6865   Validate whethe
+00025620: 7220 6120 7374 7269 6e67 2063 6f6e 7461  r a string conta
+00025630: 696e 7320 6120 7661 6c69 6420 7661 6c75  ins a valid valu
+00025640: 6520 746f 2075 7365 2061 7320 6120 686f  e to use as a ho
+00025650: 7374 6e61 6d65 206f 7220 4950 2061 6464  stname or IP add
+00025660: 7265 7373 2e0a 2020 2020 202a 2049 5076  ress..     * IPv
+00025670: 3620 6164 6472 6573 7365 7320 6d75 7374  6 addresses must
+00025680: 2069 6e63 6c75 6465 205b 5d2c 2065 2e67   include [], e.g
+00025690: 2e20 605b 3a3a 315d 602c 206e 6f74 206a  . `[::1]`, not j
+000256a0: 7573 7420 603a 3a31 602e 0a20 2020 2020  ust `::1`..     
+000256b0: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
+000256c0: 7374 7269 6e67 2024 686f 7374 2054 6865  string $host The
+000256d0: 2068 6f73 7420 6e61 6d65 206f 7220 4950   host name or IP
+000256e0: 2061 6464 7265 7373 2074 6f20 6368 6563   address to chec
+000256f0: 6b0a 2020 2020 202a 0a20 2020 2020 2a20  k.     *.     * 
+00025700: 4072 6574 7572 6e20 626f 6f6c 0a20 2020  @return bool.   
+00025710: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00025720: 7374 6174 6963 2066 756e 6374 696f 6e20  static function 
+00025730: 6973 5661 6c69 6448 6f73 7428 2468 6f73  isValidHost($hos
+00025740: 7429 0a20 2020 207b 0a20 2020 2020 2020  t).    {.       
+00025750: 202f 2f53 696d 706c 6520 7379 6e74 6178   //Simple syntax
+00025760: 206c 696d 6974 730a 2020 2020 2020 2020   limits.        
+00025770: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00025780: 2065 6d70 7479 2824 686f 7374 290a 2020   empty($host).  
+00025790: 2020 2020 2020 2020 2020 7c7c 2021 6973            || !is
+000257a0: 5f73 7472 696e 6728 2468 6f73 7429 0a20  _string($host). 
+000257b0: 2020 2020 2020 2020 2020 207c 7c20 7374             || st
+000257c0: 726c 656e 2824 686f 7374 2920 3e20 3235  rlen($host) > 25
+000257d0: 360a 2020 2020 2020 2020 2020 2020 7c7c  6.            ||
+000257e0: 2021 7072 6567 5f6d 6174 6368 2827 2f5e   !preg_match('/^
+000257f0: 285b 612d 7a41 2d5a 5c64 2e2d 5d2a 7c5c  ([a-zA-Z\d.-]*|\
+00025800: 5b5b 612d 6641 2d46 5c64 3a5d 2b5c 5d29  [[a-fA-F\d:]+\])
+00025810: 242f 272c 2024 686f 7374 290a 2020 2020  $/', $host).    
+00025820: 2020 2020 2920 7b0a 2020 2020 2020 2020      ) {.        
+00025830: 2020 2020 7265 7475 726e 2066 616c 7365      return false
+00025840: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00025850: 2020 2020 2f2f 4c6f 6f6b 7320 6c69 6b65      //Looks like
+00025860: 2061 2062 7261 636b 6574 6564 2049 5076   a bracketed IPv
+00025870: 3620 6164 6472 6573 730a 2020 2020 2020  6 address.      
+00025880: 2020 6966 2028 7374 726c 656e 2824 686f    if (strlen($ho
+00025890: 7374 2920 3e20 3220 2626 2073 7562 7374  st) > 2 && subst
+000258a0: 7228 2468 6f73 742c 2030 2c20 3129 203d  r($host, 0, 1) =
+000258b0: 3d3d 2027 5b27 2026 2620 7375 6273 7472  == '[' && substr
+000258c0: 2824 686f 7374 2c20 2d31 2c20 3129 203d  ($host, -1, 1) =
+000258d0: 3d3d 2027 5d27 2920 7b0a 2020 2020 2020  == ']') {.      
+000258e0: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
+000258f0: 7465 725f 7661 7228 7375 6273 7472 2824  ter_var(substr($
+00025900: 686f 7374 2c20 312c 202d 3129 2c20 4649  host, 1, -1), FI
+00025910: 4c54 4552 5f56 414c 4944 4154 455f 4950  LTER_VALIDATE_IP
+00025920: 2c20 4649 4c54 4552 5f46 4c41 475f 4950  , FILTER_FLAG_IP
+00025930: 5636 2920 213d 3d20 6661 6c73 653b 0a20  V6) !== false;. 
+00025940: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00025950: 202f 2f49 6620 7265 6d6f 7669 6e67 2061   //If removing a
+00025960: 6c6c 2074 6865 2064 6f74 7320 7265 7375  ll the dots resu
+00025970: 6c74 7320 696e 2061 206e 756d 6572 6963  lts in a numeric
+00025980: 2073 7472 696e 672c 2069 7420 6d75 7374   string, it must
+00025990: 2062 6520 616e 2049 5076 3420 6164 6472   be an IPv4 addr
+000259a0: 6573 732e 0a20 2020 2020 2020 202f 2f4e  ess..        //N
+000259b0: 6565 6420 746f 2063 6865 636b 2074 6869  eed to check thi
+000259c0: 7320 6669 7273 7420 6265 6361 7573 6520  s first because 
+000259d0: 6f74 6865 7277 6973 6520 7468 696e 6773  otherwise things
+000259e0: 206c 696b 6520 6039 3939 2e30 2e30 2e30   like `999.0.0.0
+000259f0: 6020 6172 6520 636f 6e73 6964 6572 6564  ` are considered
+00025a00: 2076 616c 6964 2068 6f73 7420 6e61 6d65   valid host name
+00025a10: 730a 2020 2020 2020 2020 6966 2028 6973  s.        if (is
+00025a20: 5f6e 756d 6572 6963 2873 7472 5f72 6570  _numeric(str_rep
+00025a30: 6c61 6365 2827 2e27 2c20 2727 2c20 2468  lace('.', '', $h
+00025a40: 6f73 7429 2929 207b 0a20 2020 2020 2020  ost))) {.       
+00025a50: 2020 2020 202f 2f49 7320 6974 2061 2076       //Is it a v
+00025a60: 616c 6964 2049 5076 3420 6164 6472 6573  alid IPv4 addres
+00025a70: 733f 0a20 2020 2020 2020 2020 2020 2072  s?.            r
+00025a80: 6574 7572 6e20 6669 6c74 6572 5f76 6172  eturn filter_var
+00025a90: 2824 686f 7374 2c20 4649 4c54 4552 5f56  ($host, FILTER_V
+00025aa0: 414c 4944 4154 455f 4950 2c20 4649 4c54  ALIDATE_IP, FILT
+00025ab0: 4552 5f46 4c41 475f 4950 5634 2920 213d  ER_FLAG_IPV4) !=
+00025ac0: 3d20 6661 6c73 653b 0a20 2020 2020 2020  = false;.       
+00025ad0: 207d 0a20 2020 2020 2020 202f 2f49 7320   }.        //Is 
+00025ae0: 6974 2061 2073 796e 7461 6374 6963 616c  it a syntactical
+00025af0: 6c79 2076 616c 6964 2068 6f73 746e 616d  ly valid hostnam
+00025b00: 6520 2877 6865 6e20 656d 6265 6465 6420  e (when embeded 
+00025b10: 696e 2061 2055 524c 293f 0a20 2020 2020  in a URL)?.     
+00025b20: 2020 2072 6574 7572 6e20 6669 6c74 6572     return filter
+00025b30: 5f76 6172 2827 6874 7470 3a2f 2f27 202e  _var('http://' .
+00025b40: 2024 686f 7374 2c20 4649 4c54 4552 5f56   $host, FILTER_V
+00025b50: 414c 4944 4154 455f 5552 4c29 2021 3d3d  ALIDATE_URL) !==
+00025b60: 2066 616c 7365 3b0a 2020 2020 7d0a 0a20   false;.    }.. 
+00025b70: 2020 202f 2a2a 0a20 2020 2020 2a20 4765     /**.     * Ge
+00025b80: 7420 616e 2065 7272 6f72 206d 6573 7361  t an error messa
+00025b90: 6765 2069 6e20 7468 6520 6375 7272 656e  ge in the curren
+00025ba0: 7420 6c61 6e67 7561 6765 2e0a 2020 2020  t language..    
+00025bb0: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+00025bc0: 2073 7472 696e 6720 246b 6579 0a20 2020   string $key.   
+00025bd0: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+00025be0: 726e 2073 7472 696e 670a 2020 2020 202a  rn string.     *
+00025bf0: 2f0a 2020 2020 7072 6f74 6563 7465 6420  /.    protected 
+00025c00: 6675 6e63 7469 6f6e 206c 616e 6728 246b  function lang($k
+00025c10: 6579 290a 2020 2020 7b0a 2020 2020 2020  ey).    {.      
+00025c20: 2020 6966 2028 636f 756e 7428 2474 6869    if (count($thi
+00025c30: 732d 3e6c 616e 6775 6167 6529 203c 2031  s->language) < 1
+00025c40: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00025c50: 2474 6869 732d 3e73 6574 4c61 6e67 7561  $this->setLangua
+00025c60: 6765 2829 3b20 2f2f 5365 7420 7468 6520  ge(); //Set the 
+00025c70: 6465 6661 756c 7420 6c61 6e67 7561 6765  default language
+00025c80: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00025c90: 2020 2020 6966 2028 6172 7261 795f 6b65      if (array_ke
+00025ca0: 795f 6578 6973 7473 2824 6b65 792c 2024  y_exists($key, $
+00025cb0: 7468 6973 2d3e 6c61 6e67 7561 6765 2929  this->language))
+00025cc0: 207b 0a20 2020 2020 2020 2020 2020 2069   {.            i
+00025cd0: 6620 2827 736d 7470 5f63 6f6e 6e65 6374  f ('smtp_connect
+00025ce0: 5f66 6169 6c65 6427 203d 3d3d 2024 6b65  _failed' === $ke
+00025cf0: 7929 207b 0a20 2020 2020 2020 2020 2020  y) {.           
+00025d00: 2020 2020 202f 2f49 6e63 6c75 6465 2061       //Include a
+00025d10: 206c 696e 6b20 746f 2074 726f 7562 6c65   link to trouble
+00025d20: 7368 6f6f 7469 6e67 2064 6f63 7320 6f6e  shooting docs on
+00025d30: 2053 4d54 5020 636f 6e6e 6563 7469 6f6e   SMTP connection
+00025d40: 2066 6169 6c75 7265 2e0a 2020 2020 2020   failure..      
+00025d50: 2020 2020 2020 2020 2020 2f2f 5468 6973            //This
+00025d60: 2069 7320 6279 2066 6172 2074 6865 2062   is by far the b
+00025d70: 6967 6765 7374 2063 6175 7365 206f 6620  iggest cause of 
+00025d80: 7375 7070 6f72 7420 7175 6573 7469 6f6e  support question
+00025d90: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00025da0: 2020 2f2f 6275 7420 6974 2773 2075 7375    //but it's usu
+00025db0: 616c 6c79 206e 6f74 2050 4850 4d61 696c  ally not PHPMail
+00025dc0: 6572 2773 2066 6175 6c74 2e0a 2020 2020  er's fault..    
+00025dd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00025de0: 726e 2024 7468 6973 2d3e 6c61 6e67 7561  rn $this->langua
+00025df0: 6765 5b24 6b65 795d 202e 2027 2068 7474  ge[$key] . ' htt
+00025e00: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00025e10: 5048 504d 6169 6c65 722f 5048 504d 6169  PHPMailer/PHPMai
+00025e20: 6c65 722f 7769 6b69 2f54 726f 7562 6c65  ler/wiki/Trouble
+00025e30: 7368 6f6f 7469 6e67 273b 0a20 2020 2020  shooting';.     
+00025e40: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00025e50: 2020 2020 2020 7265 7475 726e 2024 7468        return $th
+00025e60: 6973 2d3e 6c61 6e67 7561 6765 5b24 6b65  is->language[$ke
+00025e70: 795d 3b0a 2020 2020 2020 2020 7d0a 0a20  y];.        }.. 
+00025e80: 2020 2020 2020 202f 2f52 6574 7572 6e20         //Return 
+00025e90: 7468 6520 6b65 7920 6173 2061 2066 616c  the key as a fal
+00025ea0: 6c62 6163 6b0a 2020 2020 2020 2020 7265  lback.        re
+00025eb0: 7475 726e 2024 6b65 793b 0a20 2020 207d  turn $key;.    }
+00025ec0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00025ed0: 2042 7569 6c64 2061 6e20 6572 726f 7220   Build an error 
+00025ee0: 6d65 7373 6167 6520 7374 6172 7469 6e67  message starting
+00025ef0: 2077 6974 6820 6120 6765 6e65 7269 6320   with a generic 
+00025f00: 6f6e 6520 616e 6420 6164 6469 6e67 2064  one and adding d
+00025f10: 6574 6169 6c73 2069 6620 706f 7373 6962  etails if possib
+00025f20: 6c65 2e0a 2020 2020 202a 0a20 2020 2020  le..     *.     
+00025f30: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+00025f40: 2462 6173 655f 6b65 790a 2020 2020 202a  $base_key.     *
+00025f50: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
+00025f60: 2020 2020 202a 2f0a 2020 2020 7072 6976       */.    priv
+00025f70: 6174 6520 6675 6e63 7469 6f6e 2067 6574  ate function get
+00025f80: 536d 7470 4572 726f 724d 6573 7361 6765  SmtpErrorMessage
+00025f90: 2824 6261 7365 5f6b 6579 290a 2020 2020  ($base_key).    
+00025fa0: 7b0a 2020 2020 2020 2020 246d 6573 7361  {.        $messa
+00025fb0: 6765 203d 2024 7468 6973 2d3e 6c61 6e67  ge = $this->lang
+00025fc0: 2824 6261 7365 5f6b 6579 293b 0a20 2020  ($base_key);.   
+00025fd0: 2020 2020 2024 6572 726f 7220 3d20 2474       $error = $t
+00025fe0: 6869 732d 3e73 6d74 702d 3e67 6574 4572  his->smtp->getEr
+00025ff0: 726f 7228 293b 0a20 2020 2020 2020 2069  ror();.        i
+00026000: 6620 2821 656d 7074 7928 2465 7272 6f72  f (!empty($error
+00026010: 5b27 6572 726f 7227 5d29 2920 7b0a 2020  ['error'])) {.  
+00026020: 2020 2020 2020 2020 2020 246d 6573 7361            $messa
+00026030: 6765 202e 3d20 2720 2720 2e20 2465 7272  ge .= ' ' . $err
+00026040: 6f72 5b27 6572 726f 7227 5d3b 0a20 2020  or['error'];.   
+00026050: 2020 2020 2020 2020 2069 6620 2821 656d           if (!em
+00026060: 7074 7928 2465 7272 6f72 5b27 6465 7461  pty($error['deta
+00026070: 696c 275d 2929 207b 0a20 2020 2020 2020  il'])) {.       
+00026080: 2020 2020 2020 2020 2024 6d65 7373 6167           $messag
+00026090: 6520 2e3d 2027 2027 202e 2024 6572 726f  e .= ' ' . $erro
+000260a0: 725b 2764 6574 6169 6c27 5d3b 0a20 2020  r['detail'];.   
+000260b0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+000260c0: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+000260d0: 7475 726e 2024 6d65 7373 6167 653b 0a20  turn $message;. 
+000260e0: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
+000260f0: 2020 202a 2043 6865 636b 2069 6620 616e     * Check if an
+00026100: 2065 7272 6f72 206f 6363 7572 7265 642e   error occurred.
+00026110: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00026120: 7265 7475 726e 2062 6f6f 6c20 5472 7565  return bool True
+00026130: 2069 6620 616e 2065 7272 6f72 2064 6964   if an error did
+00026140: 206f 6363 7572 0a20 2020 2020 2a2f 0a20   occur.     */. 
+00026150: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
+00026160: 6f6e 2069 7345 7272 6f72 2829 0a20 2020  on isError().   
+00026170: 207b 0a20 2020 2020 2020 2072 6574 7572   {.        retur
+00026180: 6e20 2474 6869 732d 3e65 7272 6f72 5f63  n $this->error_c
+00026190: 6f75 6e74 203e 2030 3b0a 2020 2020 7d0a  ount > 0;.    }.
+000261a0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+000261b0: 4164 6420 6120 6375 7374 6f6d 2068 6561  Add a custom hea
+000261c0: 6465 722e 0a20 2020 2020 2a20 246e 616d  der..     * $nam
+000261d0: 6520 7661 6c75 6520 6361 6e20 6265 206f  e value can be o
+000261e0: 7665 726c 6f61 6465 6420 746f 2063 6f6e  verloaded to con
+000261f0: 7461 696e 0a20 2020 2020 2a20 626f 7468  tain.     * both
+00026200: 2068 6561 6465 7220 6e61 6d65 2061 6e64   header name and
+00026210: 2076 616c 7565 2028 6e61 6d65 3a76 616c   value (name:val
+00026220: 7565 292e 0a20 2020 2020 2a0a 2020 2020  ue)..     *.    
+00026230: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00026240: 2020 2020 2020 246e 616d 6520 2043 7573        $name  Cus
+00026250: 746f 6d20 6865 6164 6572 206e 616d 650a  tom header name.
+00026260: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+00026270: 7269 6e67 7c6e 756c 6c20 2476 616c 7565  ring|null $value
+00026280: 2048 6561 6465 7220 7661 6c75 650a 2020   Header value.  
+00026290: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
+000262a0: 7572 6e20 626f 6f6c 2054 7275 6520 6966  urn bool True if
+000262b0: 2061 2068 6561 6465 7220 7761 7320 7365   a header was se
+000262c0: 7420 7375 6363 6573 7366 756c 6c79 0a20  t successfully. 
+000262d0: 2020 2020 2a20 4074 6872 6f77 7320 4578      * @throws Ex
+000262e0: 6365 7074 696f 6e0a 2020 2020 202a 2f0a  ception.     */.
+000262f0: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+00026300: 696f 6e20 6164 6443 7573 746f 6d48 6561  ion addCustomHea
+00026310: 6465 7228 246e 616d 652c 2024 7661 6c75  der($name, $valu
+00026320: 6520 3d20 6e75 6c6c 290a 2020 2020 7b0a  e = null).    {.
+00026330: 2020 2020 2020 2020 6966 2028 6e75 6c6c          if (null
+00026340: 203d 3d3d 2024 7661 6c75 6520 2626 2073   === $value && s
+00026350: 7472 706f 7328 246e 616d 652c 2027 3a27  trpos($name, ':'
+00026360: 2920 213d 3d20 6661 6c73 6529 207b 0a20  ) !== false) {. 
+00026370: 2020 2020 2020 2020 2020 202f 2f56 616c             //Val
+00026380: 7565 2070 6173 7365 6420 696e 2061 7320  ue passed in as 
+00026390: 6e61 6d65 3a76 616c 7565 0a20 2020 2020  name:value.     
+000263a0: 2020 2020 2020 206c 6973 7428 246e 616d         list($nam
+000263b0: 652c 2024 7661 6c75 6529 203d 2065 7870  e, $value) = exp
+000263c0: 6c6f 6465 2827 3a27 2c20 246e 616d 652c  lode(':', $name,
+000263d0: 2032 293b 0a20 2020 2020 2020 207d 0a20   2);.        }. 
+000263e0: 2020 2020 2020 2024 6e61 6d65 203d 2074         $name = t
+000263f0: 7269 6d28 246e 616d 6529 3b0a 2020 2020  rim($name);.    
+00026400: 2020 2020 2476 616c 7565 203d 2028 6e75      $value = (nu
+00026410: 6c6c 203d 3d3d 2024 7661 6c75 6529 203f  ll === $value) ?
+00026420: 2027 2720 3a20 7472 696d 2824 7661 6c75   '' : trim($valu
+00026430: 6529 3b0a 2020 2020 2020 2020 2f2f 456e  e);.        //En
+00026440: 7375 7265 206e 616d 6520 6973 206e 6f74  sure name is not
+00026450: 2065 6d70 7479 2c20 616e 6420 7468 6174   empty, and that
+00026460: 206e 6569 7468 6572 206e 616d 6520 6e6f   neither name no
+00026470: 7220 7661 6c75 6520 636f 6e74 6169 6e20  r value contain 
+00026480: 6c69 6e65 2062 7265 616b 730a 2020 2020  line breaks.    
+00026490: 2020 2020 6966 2028 656d 7074 7928 246e      if (empty($n
+000264a0: 616d 6529 207c 7c20 7374 7270 6272 6b28  ame) || strpbrk(
+000264b0: 246e 616d 6520 2e20 2476 616c 7565 2c20  $name . $value, 
+000264c0: 225c 725c 6e22 2920 213d 3d20 6661 6c73  "\r\n") !== fals
+000264d0: 6529 207b 0a20 2020 2020 2020 2020 2020  e) {.           
+000264e0: 2069 6620 2824 7468 6973 2d3e 6578 6365   if ($this->exce
+000264f0: 7074 696f 6e73 2920 7b0a 2020 2020 2020  ptions) {.      
+00026500: 2020 2020 2020 2020 2020 7468 726f 7720            throw 
+00026510: 6e65 7720 4578 6365 7074 696f 6e28 2474  new Exception($t
+00026520: 6869 732d 3e6c 616e 6728 2769 6e76 616c  his->lang('inval
+00026530: 6964 5f68 6561 6465 7227 2929 3b0a 2020  id_header'));.  
+00026540: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+00026550: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00026560: 6661 6c73 653b 0a20 2020 2020 2020 207d  false;.        }
+00026570: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+00026580: 4375 7374 6f6d 4865 6164 6572 5b5d 203d  CustomHeader[] =
+00026590: 205b 246e 616d 652c 2024 7661 6c75 655d   [$name, $value]
+000265a0: 3b0a 0a20 2020 2020 2020 2072 6574 7572  ;..        retur
+000265b0: 6e20 7472 7565 3b0a 2020 2020 7d0a 0a20  n true;.    }.. 
+000265c0: 2020 202f 2a2a 0a20 2020 2020 2a20 5265     /**.     * Re
+000265d0: 7475 726e 7320 616c 6c20 6375 7374 6f6d  turns all custom
+000265e0: 2068 6561 6465 7273 2e0a 2020 2020 202a   headers..     *
+000265f0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+00026600: 6172 7261 790a 2020 2020 202a 2f0a 2020  array.     */.  
+00026610: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+00026620: 6e20 6765 7443 7573 746f 6d48 6561 6465  n getCustomHeade
+00026630: 7273 2829 0a20 2020 207b 0a20 2020 2020  rs().    {.     
+00026640: 2020 2072 6574 7572 6e20 2474 6869 732d     return $this-
+00026650: 3e43 7573 746f 6d48 6561 6465 723b 0a20  >CustomHeader;. 
+00026660: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
+00026670: 2020 202a 2043 7265 6174 6520 6120 6d65     * Create a me
+00026680: 7373 6167 6520 626f 6479 2066 726f 6d20  ssage body from 
+00026690: 616e 2048 544d 4c20 7374 7269 6e67 2e0a  an HTML string..
+000266a0: 2020 2020 202a 2041 7574 6f6d 6174 6963       * Automatic
+000266b0: 616c 6c79 2069 6e6c 696e 6573 2069 6d61  ally inlines ima
+000266c0: 6765 7320 616e 6420 6372 6561 7465 7320  ges and creates 
+000266d0: 6120 706c 6169 6e2d 7465 7874 2076 6572  a plain-text ver
+000266e0: 7369 6f6e 2062 7920 636f 6e76 6572 7469  sion by converti
+000266f0: 6e67 2074 6865 2048 544d 4c2c 0a20 2020  ng the HTML,.   
+00026700: 2020 2a20 6f76 6572 7772 6974 696e 6720    * overwriting 
+00026710: 616e 7920 6578 6973 7469 6e67 2076 616c  any existing val
+00026720: 7565 7320 696e 2042 6f64 7920 616e 6420  ues in Body and 
+00026730: 416c 7442 6f64 792e 0a20 2020 2020 2a20  AltBody..     * 
+00026740: 446f 206e 6f74 2073 6f75 7263 6520 246d  Do not source $m
+00026750: 6573 7361 6765 2063 6f6e 7465 6e74 2066  essage content f
+00026760: 726f 6d20 7573 6572 2069 6e70 7574 210a  rom user input!.
+00026770: 2020 2020 202a 2024 6261 7365 6469 7220       * $basedir 
+00026780: 6973 2070 7265 7065 6e64 6564 2077 6865  is prepended whe
+00026790: 6e20 6861 6e64 6c69 6e67 2072 656c 6174  n handling relat
+000267a0: 6976 6520 5552 4c73 2c20 652e 672e 203c  ive URLs, e.g. <
+000267b0: 696d 6720 7372 633d 222f 696d 6167 6573  img src="/images
+000267c0: 2f61 2e70 6e67 223e 2061 6e64 206d 7573  /a.png"> and mus
+000267d0: 7420 6e6f 7420 6265 2065 6d70 7479 0a20  t not be empty. 
+000267e0: 2020 2020 2a20 7769 6c6c 206c 6f6f 6b20      * will look 
+000267f0: 666f 7220 616e 2069 6d61 6765 2066 696c  for an image fil
+00026800: 6520 696e 2024 6261 7365 6469 722f 696d  e in $basedir/im
+00026810: 6167 6573 2f61 2e70 6e67 2061 6e64 2063  ages/a.png and c
+00026820: 6f6e 7665 7274 2069 7420 746f 2069 6e6c  onvert it to inl
+00026830: 696e 652e 0a20 2020 2020 2a20 4966 2079  ine..     * If y
+00026840: 6f75 2064 6f6e 2774 2070 726f 7669 6465  ou don't provide
+00026850: 2061 2024 6261 7365 6469 722c 2072 656c   a $basedir, rel
+00026860: 6174 6976 6520 7061 7468 7320 7769 6c6c  ative paths will
+00026870: 2062 6520 6c65 6674 2075 6e74 6f75 6368   be left untouch
+00026880: 6564 2028 616e 6420 7468 7573 2070 726f  ed (and thus pro
+00026890: 6261 626c 7920 6272 6561 6b20 696e 2065  bably break in e
+000268a0: 6d61 696c 290a 2020 2020 202a 2043 6f6e  mail).     * Con
+000268b0: 7665 7274 7320 6461 7461 2d75 7269 2069  verts data-uri i
+000268c0: 6d61 6765 7320 696e 746f 2065 6d62 6564  mages into embed
+000268d0: 6465 6420 6174 7461 6368 6d65 6e74 732e  ded attachments.
+000268e0: 0a20 2020 2020 2a20 4966 2079 6f75 2064  .     * If you d
+000268f0: 6f6e 2774 2077 616e 7420 746f 2061 7070  on't want to app
+00026900: 6c79 2074 6865 7365 2074 7261 6e73 666f  ly these transfo
+00026910: 726d 6174 696f 6e73 2074 6f20 796f 7572  rmations to your
+00026920: 2048 544d 4c2c 206a 7573 7420 7365 7420   HTML, just set 
+00026930: 426f 6479 2061 6e64 2041 6c74 426f 6479  Body and AltBody
+00026940: 2064 6972 6563 746c 792e 0a20 2020 2020   directly..     
+00026950: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
+00026960: 7374 7269 6e67 2020 2020 2020 2020 246d  string        $m
+00026970: 6573 7361 6765 2020 4854 4d4c 206d 6573  essage  HTML mes
+00026980: 7361 6765 2073 7472 696e 670a 2020 2020  sage string.    
+00026990: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+000269a0: 2020 2020 2020 2020 2462 6173 6564 6972          $basedir
+000269b0: 2020 4162 736f 6c75 7465 2070 6174 6820    Absolute path 
+000269c0: 746f 2061 2062 6173 6520 6469 7265 6374  to a base direct
+000269d0: 6f72 7920 746f 2070 7265 7065 6e64 2074  ory to prepend t
+000269e0: 6f20 7265 6c61 7469 7665 2070 6174 6873  o relative paths
+000269f0: 2074 6f20 696d 6167 6573 0a20 2020 2020   to images.     
+00026a00: 2a20 4070 6172 616d 2062 6f6f 6c7c 6361  * @param bool|ca
+00026a10: 6c6c 6162 6c65 2024 6164 7661 6e63 6564  llable $advanced
+00026a20: 2057 6865 7468 6572 2074 6f20 7573 6520   Whether to use 
+00026a30: 7468 6520 696e 7465 726e 616c 2048 544d  the internal HTM
+00026a40: 4c20 746f 2074 6578 7420 636f 6e76 6572  L to text conver
+00026a50: 7465 720a 2020 2020 202a 2020 2020 2020  ter.     *      
+00026a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026a70: 2020 2020 2020 2020 2020 6f72 2079 6f75            or you
+00026a80: 7220 6f77 6e20 6375 7374 6f6d 2063 6f6e  r own custom con
+00026a90: 7665 7274 6572 0a20 2020 2020 2a20 4072  verter.     * @r
+00026aa0: 6574 7572 6e20 7374 7269 6e67 2054 6865  eturn string The
+00026ab0: 2074 7261 6e73 666f 726d 6564 206d 6573   transformed mes
+00026ac0: 7361 6765 2062 6f64 790a 2020 2020 202a  sage body.     *
+00026ad0: 0a20 2020 2020 2a20 4074 6872 6f77 7320  .     * @throws 
+00026ae0: 4578 6365 7074 696f 6e0a 2020 2020 202a  Exception.     *
+00026af0: 0a20 2020 2020 2a20 4073 6565 2050 4850  .     * @see PHP
+00026b00: 4d61 696c 6572 3a3a 6874 6d6c 3274 6578  Mailer::html2tex
+00026b10: 7428 290a 2020 2020 202a 2f0a 2020 2020  t().     */.    
+00026b20: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+00026b30: 6d73 6748 544d 4c28 246d 6573 7361 6765  msgHTML($message
+00026b40: 2c20 2462 6173 6564 6972 203d 2027 272c  , $basedir = '',
+00026b50: 2024 6164 7661 6e63 6564 203d 2066 616c   $advanced = fal
+00026b60: 7365 290a 2020 2020 7b0a 2020 2020 2020  se).    {.      
+00026b70: 2020 7072 6567 5f6d 6174 6368 5f61 6c6c    preg_match_all
+00026b80: 2827 2f28 3f3c 212d 2928 7372 637c 6261  ('/(?<!-)(src|ba
+00026b90: 636b 6772 6f75 6e64 293d 5b22 5c27 5d28  ckground)=["\'](
+00026ba0: 2e2a 295b 225c 275d 2f55 6927 2c20 246d  .*)["\']/Ui', $m
+00026bb0: 6573 7361 6765 2c20 2469 6d61 6765 7329  essage, $images)
+00026bc0: 3b0a 2020 2020 2020 2020 6966 2028 6172  ;.        if (ar
+00026bd0: 7261 795f 6b65 795f 6578 6973 7473 2832  ray_key_exists(2
+00026be0: 2c20 2469 6d61 6765 7329 2920 7b0a 2020  , $images)) {.  
+00026bf0: 2020 2020 2020 2020 2020 6966 2028 7374            if (st
+00026c00: 726c 656e 2824 6261 7365 6469 7229 203e  rlen($basedir) >
+00026c10: 2031 2026 2620 272f 2720 213d 3d20 7375   1 && '/' !== su
+00026c20: 6273 7472 2824 6261 7365 6469 722c 202d  bstr($basedir, -
+00026c30: 3129 2920 7b0a 2020 2020 2020 2020 2020  1)) {.          
+00026c40: 2020 2020 2020 2f2f 456e 7375 7265 2024        //Ensure $
+00026c50: 6261 7365 6469 7220 6861 7320 6120 7472  basedir has a tr
+00026c60: 6169 6c69 6e67 202f 0a20 2020 2020 2020  ailing /.       
+00026c70: 2020 2020 2020 2020 2024 6261 7365 6469           $basedi
+00026c80: 7220 2e3d 2027 2f27 3b0a 2020 2020 2020  r .= '/';.      
+00026c90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00026ca0: 2020 2020 666f 7265 6163 6820 2824 696d      foreach ($im
+00026cb0: 6167 6573 5b32 5d20 6173 2024 696d 6769  ages[2] as $imgi
+00026cc0: 6e64 6578 203d 3e20 2475 726c 2920 7b0a  ndex => $url) {.
+00026cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ce0: 2f2f 436f 6e76 6572 7420 6461 7461 2055  //Convert data U
+00026cf0: 5249 7320 696e 746f 2065 6d62 6564 6465  RIs into embedde
+00026d00: 6420 696d 6167 6573 0a20 2020 2020 2020  d images.       
+00026d10: 2020 2020 2020 2020 202f 2f65 2e67 2e20           //e.g. 
+00026d20: 2264 6174 613a 696d 6167 652f 6769 663b  "data:image/gif;
+00026d30: 6261 7365 3634 2c52 306c 474f 446c 6841  base64,R0lGODlhA
+00026d40: 5141 4241 4141 4141 4348 3542 4145 4b41  QABAAAAACH5BAEKA
+00026d50: 4145 414c 4141 4141 4141 4241 4145 4141  AEALAAAAAABAAEAA
+00026d60: 4149 4354 4145 414f 773d 3d22 0a20 2020  AICTAEAOw==".   
+00026d70: 2020 2020 2020 2020 2020 2020 2024 6d61               $ma
+00026d80: 7463 6820 3d20 5b5d 3b0a 2020 2020 2020  tch = [];.      
+00026d90: 2020 2020 2020 2020 2020 6966 2028 7072            if (pr
+00026da0: 6567 5f6d 6174 6368 2827 235e 6461 7461  eg_match('#^data
+00026db0: 3a28 696d 6167 652f 283f 3a6a 7065 3f67  :(image/(?:jpe?g
+00026dc0: 7c67 6966 7c70 6e67 2929 3b3f 2862 6173  |gif|png));?(bas
+00026dd0: 6536 3429 3f2c 282e 2b29 2327 2c20 2475  e64)?,(.+)#', $u
+00026de0: 726c 2c20 246d 6174 6368 2929 207b 0a20  rl, $match)) {. 
+00026df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e00: 2020 2069 6620 2863 6f75 6e74 2824 6d61     if (count($ma
+00026e10: 7463 6829 203d 3d3d 2034 2026 2620 7374  tch) === 4 && st
+00026e20: 6174 6963 3a3a 454e 434f 4449 4e47 5f42  atic::ENCODING_B
+00026e30: 4153 4536 3420 3d3d 3d20 246d 6174 6368  ASE64 === $match
+00026e40: 5b32 5d29 207b 0a20 2020 2020 2020 2020  [2]) {.         
+00026e50: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00026e60: 6461 7461 203d 2062 6173 6536 345f 6465  data = base64_de
+00026e70: 636f 6465 2824 6d61 7463 685b 335d 293b  code($match[3]);
+00026e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026e90: 2020 2020 207d 2065 6c73 6569 6620 2827       } elseif ('
+00026ea0: 2720 3d3d 3d20 246d 6174 6368 5b32 5d29  ' === $match[2])
+00026eb0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00026ec0: 2020 2020 2020 2020 2020 2024 6461 7461             $data
+00026ed0: 203d 2072 6177 7572 6c64 6563 6f64 6528   = rawurldecode(
+00026ee0: 246d 6174 6368 5b33 5d29 3b0a 2020 2020  $match[3]);.    
+00026ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f00: 7d20 656c 7365 207b 0a20 2020 2020 2020  } else {.       
+00026f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f20: 202f 2f4e 6f74 2072 6563 6f67 6e69 7365   //Not recognise
+00026f30: 6420 736f 206c 6561 7665 2069 7420 616c  d so leave it al
+00026f40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00026f50: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00026f60: 696e 7565 3b0a 2020 2020 2020 2020 2020  inue;.          
+00026f70: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00026f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f90: 2f2f 4861 7368 2074 6865 2064 6563 6f64  //Hash the decod
+00026fa0: 6564 2064 6174 612c 206e 6f74 2074 6865  ed data, not the
+00026fb0: 2055 524c 2c20 736f 2074 6861 7420 7468   URL, so that th
+00026fc0: 6520 7361 6d65 2064 6174 612d 5552 4920  e same data-URI 
+00026fd0: 696d 6167 6520 7573 6564 2069 6e20 6d75  image used in mu
+00026fe0: 6c74 6970 6c65 2070 6c61 6365 730a 2020  ltiple places.  
+00026ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027000: 2020 2f2f 7769 6c6c 206f 6e6c 7920 6265    //will only be
+00027010: 2065 6d62 6564 6465 6420 6f6e 6365 2c20   embedded once, 
+00027020: 6576 656e 2069 6620 6974 2075 7365 6420  even if it used 
+00027030: 6120 6469 6666 6572 656e 7420 656e 636f  a different enco
+00027040: 6469 6e67 0a20 2020 2020 2020 2020 2020  ding.           
+00027050: 2020 2020 2020 2020 2024 6369 6420 3d20           $cid = 
+00027060: 7375 6273 7472 2868 6173 6828 2773 6861  substr(hash('sha
+00027070: 3235 3627 2c20 2464 6174 6129 2c20 302c  256', $data), 0,
+00027080: 2033 3229 202e 2027 4070 6870 6d61 696c   32) . '@phpmail
+00027090: 6572 2e30 273b 202f 2f52 4643 3233 3932  er.0'; //RFC2392
+000270a0: 2053 2032 0a0a 2020 2020 2020 2020 2020   S 2..          
+000270b0: 2020 2020 2020 2020 2020 6966 2028 2124            if (!$
+000270c0: 7468 6973 2d3e 6369 6445 7869 7374 7328  this->cidExists(
+000270d0: 2463 6964 2929 207b 0a20 2020 2020 2020  $cid)) {.       
+000270e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270f0: 2024 7468 6973 2d3e 6164 6453 7472 696e   $this->addStrin
+00027100: 6745 6d62 6564 6465 6449 6d61 6765 280a  gEmbeddedImage(.
+00027110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027120: 2020 2020 2020 2020 2020 2020 2464 6174              $dat
+00027130: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+00027140: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00027150: 6369 642c 0a20 2020 2020 2020 2020 2020  cid,.           
+00027160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027170: 2027 656d 6265 6427 202e 2024 696d 6769   'embed' . $imgi
+00027180: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
+00027190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271a0: 2020 7374 6174 6963 3a3a 454e 434f 4449    static::ENCODI
+000271b0: 4e47 5f42 4153 4536 342c 0a20 2020 2020  NG_BASE64,.     
+000271c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271d0: 2020 2020 2020 2024 6d61 7463 685b 315d         $match[1]
+000271e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000271f0: 2020 2020 2020 2020 2029 3b0a 2020 2020           );.    
+00027200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027210: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00027220: 2020 2020 2020 246d 6573 7361 6765 203d        $message =
+00027230: 2073 7472 5f72 6570 6c61 6365 280a 2020   str_replace(.  
+00027240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027250: 2020 2020 2020 2469 6d61 6765 735b 305d        $images[0]
+00027260: 5b24 696d 6769 6e64 6578 5d2c 0a20 2020  [$imgindex],.   
+00027270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027280: 2020 2020 2024 696d 6167 6573 5b31 5d5b       $images[1][
+00027290: 2469 6d67 696e 6465 785d 202e 2027 3d22  $imgindex] . '="
+000272a0: 6369 643a 2720 2e20 2463 6964 202e 2027  cid:' . $cid . '
+000272b0: 2227 2c0a 2020 2020 2020 2020 2020 2020  "',.            
+000272c0: 2020 2020 2020 2020 2020 2020 246d 6573              $mes
+000272d0: 7361 6765 0a20 2020 2020 2020 2020 2020  sage.           
+000272e0: 2020 2020 2020 2020 2029 3b0a 2020 2020           );.    
+000272f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027300: 636f 6e74 696e 7565 3b0a 2020 2020 2020  continue;.      
+00027310: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00027320: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00027330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027340: 2020 2020 202f 2f4f 6e6c 7920 7072 6f63       //Only proc
+00027350: 6573 7320 7265 6c61 7469 7665 2055 524c  ess relative URL
+00027360: 7320 6966 2061 2062 6173 6564 6972 2069  s if a basedir i
+00027370: 7320 7072 6f76 6964 6564 2028 692e 652e  s provided (i.e.
+00027380: 206e 6f20 6162 736f 6c75 7465 206c 6f63   no absolute loc
+00027390: 616c 2070 6174 6873 290a 2020 2020 2020  al paths).      
+000273a0: 2020 2020 2020 2020 2020 2020 2020 2165                !e
+000273b0: 6d70 7479 2824 6261 7365 6469 7229 0a20  mpty($basedir). 
+000273c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000273d0: 2020 202f 2f49 676e 6f72 6520 5552 4c73     //Ignore URLs
+000273e0: 2063 6f6e 7461 696e 696e 6720 7061 7265   containing pare
+000273f0: 6e74 2064 6972 2074 7261 7665 7273 616c  nt dir traversal
+00027400: 2028 2e2e 290a 2020 2020 2020 2020 2020   (..).          
+00027410: 2020 2020 2020 2020 2020 2626 2028 7374            && (st
+00027420: 7270 6f73 2824 7572 6c2c 2027 2e2e 2729  rpos($url, '..')
+00027430: 203d 3d3d 2066 616c 7365 290a 2020 2020   === false).    
+00027440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027450: 2f2f 446f 206e 6f74 2063 6861 6e67 6520  //Do not change 
+00027460: 7572 6c73 2074 6861 7420 6172 6520 616c  urls that are al
+00027470: 7265 6164 7920 696e 6c69 6e65 2069 6d61  ready inline ima
+00027480: 6765 730a 2020 2020 2020 2020 2020 2020  ges.            
+00027490: 2020 2020 2020 2020 2626 2030 2021 3d3d          && 0 !==
+000274a0: 2073 7472 706f 7328 2475 726c 2c20 2763   strpos($url, 'c
+000274b0: 6964 3a27 290a 2020 2020 2020 2020 2020  id:').          
+000274c0: 2020 2020 2020 2020 2020 2f2f 446f 206e            //Do n
+000274d0: 6f74 2063 6861 6e67 6520 6162 736f 6c75  ot change absolu
+000274e0: 7465 2055 524c 732c 2069 6e63 6c75 6469  te URLs, includi
+000274f0: 6e67 2061 6e6f 6e79 6d6f 7573 2070 726f  ng anonymous pro
+00027500: 746f 636f 6c0a 2020 2020 2020 2020 2020  tocol.          
+00027510: 2020 2020 2020 2020 2020 2626 2021 7072            && !pr
+00027520: 6567 5f6d 6174 6368 2827 235e 5b61 2d7a  eg_match('#^[a-z
+00027530: 5d5b 612d 7a30 2d39 2b2e 2d5d 2a3a 3f2f  ][a-z0-9+.-]*:?/
+00027540: 2f23 6927 2c20 2475 726c 290a 2020 2020  /#i', $url).    
+00027550: 2020 2020 2020 2020 2020 2020 2920 7b0a              ) {.
+00027560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027570: 2020 2020 2466 696c 656e 616d 6520 3d20      $filename = 
+00027580: 7374 6174 6963 3a3a 6d62 5f70 6174 6869  static::mb_pathi
+00027590: 6e66 6f28 2475 726c 2c20 5041 5448 494e  nfo($url, PATHIN
+000275a0: 464f 5f42 4153 454e 414d 4529 3b0a 2020  FO_BASENAME);.  
+000275b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000275c0: 2020 2464 6972 6563 746f 7279 203d 2064    $directory = d
+000275d0: 6972 6e61 6d65 2824 7572 6c29 3b0a 2020  irname($url);.  
+000275e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000275f0: 2020 6966 2028 272e 2720 3d3d 3d20 2464    if ('.' === $d
+00027600: 6972 6563 746f 7279 2920 7b0a 2020 2020  irectory) {.    
+00027610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027620: 2020 2020 2464 6972 6563 746f 7279 203d      $directory =
+00027630: 2027 273b 0a20 2020 2020 2020 2020 2020   '';.           
+00027640: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00027650: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+00027660: 2f52 4643 3233 3932 2053 2032 0a20 2020  /RFC2392 S 2.   
+00027670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027680: 2024 6369 6420 3d20 7375 6273 7472 2868   $cid = substr(h
+00027690: 6173 6828 2773 6861 3235 3627 2c20 2475  ash('sha256', $u
+000276a0: 726c 292c 2030 2c20 3332 2920 2e20 2740  rl), 0, 32) . '@
+000276b0: 7068 706d 6169 6c65 722e 3027 3b0a 2020  phpmailer.0';.  
+000276c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276d0: 2020 6966 2028 7374 726c 656e 2824 6261    if (strlen($ba
+000276e0: 7365 6469 7229 203e 2031 2026 2620 272f  sedir) > 1 && '/
+000276f0: 2720 213d 3d20 7375 6273 7472 2824 6261  ' !== substr($ba
+00027700: 7365 6469 722c 202d 3129 2920 7b0a 2020  sedir, -1)) {.  
+00027710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027720: 2020 2020 2020 2462 6173 6564 6972 202e        $basedir .
+00027730: 3d20 272f 273b 0a20 2020 2020 2020 2020  = '/';.         
+00027740: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00027750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027760: 2069 6620 2873 7472 6c65 6e28 2464 6972   if (strlen($dir
+00027770: 6563 746f 7279 2920 3e20 3120 2626 2027  ectory) > 1 && '
+00027780: 2f27 2021 3d3d 2073 7562 7374 7228 2464  /' !== substr($d
+00027790: 6972 6563 746f 7279 2c20 2d31 2929 207b  irectory, -1)) {
+000277a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000277b0: 2020 2020 2020 2020 2024 6469 7265 6374           $direct
+000277c0: 6f72 7920 2e3d 2027 2f27 3b0a 2020 2020  ory .= '/';.    
+000277d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000277e0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+000277f0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00027800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027810: 2020 2024 7468 6973 2d3e 6164 6445 6d62     $this->addEmb
+00027820: 6564 6465 6449 6d61 6765 280a 2020 2020  eddedImage(.    
+00027830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027840: 2020 2020 2020 2020 2462 6173 6564 6972          $basedir
+00027850: 202e 2024 6469 7265 6374 6f72 7920 2e20   . $directory . 
+00027860: 2466 696c 656e 616d 652c 0a20 2020 2020  $filename,.     
+00027870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027880: 2020 2020 2020 2024 6369 642c 0a20 2020         $cid,.   
+00027890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278a0: 2020 2020 2020 2020 2024 6669 6c65 6e61           $filena
+000278b0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000278c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278d0: 7374 6174 6963 3a3a 454e 434f 4449 4e47  static::ENCODING
+000278e0: 5f42 4153 4536 342c 0a20 2020 2020 2020  _BASE64,.       
+000278f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027900: 2020 2020 2073 7461 7469 633a 3a5f 6d69       static::_mi
+00027910: 6d65 5f74 7970 6573 2828 7374 7269 6e67  me_types((string
+00027920: 2920 7374 6174 6963 3a3a 6d62 5f70 6174  ) static::mb_pat
+00027930: 6869 6e66 6f28 2466 696c 656e 616d 652c  hinfo($filename,
+00027940: 2050 4154 4849 4e46 4f5f 4558 5445 4e53   PATHINFO_EXTENS
+00027950: 494f 4e29 290a 2020 2020 2020 2020 2020  ION)).          
+00027960: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00027970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027980: 2020 2020 2920 7b0a 2020 2020 2020 2020      ) {.        
+00027990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279a0: 246d 6573 7361 6765 203d 2070 7265 675f  $message = preg_
+000279b0: 7265 706c 6163 6528 0a20 2020 2020 2020  replace(.       
+000279c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279d0: 2020 2020 2027 2f27 202e 2024 696d 6167       '/' . $imag
+000279e0: 6573 5b31 5d5b 2469 6d67 696e 6465 785d  es[1][$imgindex]
+000279f0: 202e 2027 3d5b 225c 275d 2720 2e20 7072   . '=["\']' . pr
+00027a00: 6567 5f71 756f 7465 2824 7572 6c2c 2027  eg_quote($url, '
+00027a10: 2f27 2920 2e20 275b 225c 275d 2f55 6927  /') . '["\']/Ui'
+00027a20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00027a30: 2020 2020 2020 2020 2020 2020 2020 2469                $i
+00027a40: 6d61 6765 735b 315d 5b24 696d 6769 6e64  mages[1][$imgind
+00027a50: 6578 5d20 2e20 273d 2263 6964 3a27 202e  ex] . '="cid:' .
+00027a60: 2024 6369 6420 2e20 2722 272c 0a20 2020   $cid . '"',.   
+00027a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a80: 2020 2020 2020 2020 2024 6d65 7373 6167           $messag
+00027a90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00027aa0: 2020 2020 2020 2020 2020 293b 0a20 2020            );.   
+00027ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ac0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00027ad0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00027ae0: 207d 0a20 2020 2020 2020 207d 0a20 2020   }.        }.   
+00027af0: 2020 2020 2024 7468 6973 2d3e 6973 4854       $this->isHT
+00027b00: 4d4c 2829 3b0a 2020 2020 2020 2020 2f2f  ML();.        //
+00027b10: 436f 6e76 6572 7420 616c 6c20 6d65 7373  Convert all mess
+00027b20: 6167 6520 626f 6479 206c 696e 6520 6272  age body line br
+00027b30: 6561 6b73 2074 6f20 4c45 2c20 6d61 6b65  eaks to LE, make
+00027b40: 7320 7175 6f74 6564 2d70 7269 6e74 6162  s quoted-printab
+00027b50: 6c65 2065 6e63 6f64 696e 6720 776f 726b  le encoding work
+00027b60: 206d 7563 6820 6265 7474 6572 0a20 2020   much better.   
+00027b70: 2020 2020 2024 7468 6973 2d3e 426f 6479       $this->Body
+00027b80: 203d 2073 7461 7469 633a 3a6e 6f72 6d61   = static::norma
+00027b90: 6c69 7a65 4272 6561 6b73 2824 6d65 7373  lizeBreaks($mess
+00027ba0: 6167 6529 3b0a 2020 2020 2020 2020 2474  age);.        $t
+00027bb0: 6869 732d 3e41 6c74 426f 6479 203d 2073  his->AltBody = s
+00027bc0: 7461 7469 633a 3a6e 6f72 6d61 6c69 7a65  tatic::normalize
+00027bd0: 4272 6561 6b73 2824 7468 6973 2d3e 6874  Breaks($this->ht
+00027be0: 6d6c 3274 6578 7428 246d 6573 7361 6765  ml2text($message
+00027bf0: 2c20 2461 6476 616e 6365 6429 293b 0a20  , $advanced));. 
+00027c00: 2020 2020 2020 2069 6620 2821 2474 6869         if (!$thi
+00027c10: 732d 3e61 6c74 6572 6e61 7469 7665 4578  s->alternativeEx
+00027c20: 6973 7473 2829 2920 7b0a 2020 2020 2020  ists()) {.      
+00027c30: 2020 2020 2020 2474 6869 732d 3e41 6c74        $this->Alt
+00027c40: 426f 6479 203d 2027 5468 6973 2069 7320  Body = 'This is 
+00027c50: 616e 2048 544d 4c2d 6f6e 6c79 206d 6573  an HTML-only mes
+00027c60: 7361 6765 2e20 546f 2076 6965 7720 6974  sage. To view it
+00027c70: 2c20 6163 7469 7661 7465 2048 544d 4c20  , activate HTML 
+00027c80: 696e 2079 6f75 7220 656d 6169 6c20 6170  in your email ap
+00027c90: 706c 6963 6174 696f 6e2e 270a 2020 2020  plication.'.    
+00027ca0: 2020 2020 2020 2020 2020 2020 2e20 7374              . st
+00027cb0: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+00027cc0: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+00027cd0: 7475 726e 2024 7468 6973 2d3e 426f 6479  turn $this->Body
+00027ce0: 3b0a 2020 2020 7d0a 0a20 2020 202f 2a2a  ;.    }..    /**
+00027cf0: 0a20 2020 2020 2a20 436f 6e76 6572 7420  .     * Convert 
+00027d00: 616e 2048 544d 4c20 7374 7269 6e67 2069  an HTML string i
+00027d10: 6e74 6f20 706c 6169 6e20 7465 7874 2e0a  nto plain text..
+00027d20: 2020 2020 202a 2054 6869 7320 6973 2075       * This is u
+00027d30: 7365 6420 6279 206d 7367 4854 4d4c 2829  sed by msgHTML()
+00027d40: 2e0a 2020 2020 202a 204e 6f74 6520 2d20  ..     * Note - 
+00027d50: 6f6c 6465 7220 7665 7273 696f 6e73 206f  older versions o
+00027d60: 6620 7468 6973 2066 756e 6374 696f 6e20  f this function 
+00027d70: 7573 6564 2061 2062 756e 646c 6564 2061  used a bundled a
+00027d80: 6476 616e 6365 6420 636f 6e76 6572 7465  dvanced converte
+00027d90: 720a 2020 2020 202a 2077 6869 6368 2077  r.     * which w
+00027da0: 6173 2072 656d 6f76 6564 2066 6f72 206c  as removed for l
+00027db0: 6963 656e 7365 2072 6561 736f 6e73 2069  icense reasons i
+00027dc0: 6e20 2332 3332 2e0a 2020 2020 202a 2045  n #232..     * E
+00027dd0: 7861 6d70 6c65 2075 7361 6765 3a0a 2020  xample usage:.  
+00027de0: 2020 202a 0a20 2020 2020 2a20 6060 6070     *.     * ```p
+00027df0: 6870 0a20 2020 2020 2a20 2f2f 5573 6520  hp.     * //Use 
+00027e00: 6465 6661 756c 7420 636f 6e76 6572 7369  default conversi
+00027e10: 6f6e 0a20 2020 2020 2a20 2470 6c61 696e  on.     * $plain
+00027e20: 203d 2024 6d61 696c 2d3e 6874 6d6c 3274   = $mail->html2t
+00027e30: 6578 7428 2468 746d 6c29 3b0a 2020 2020  ext($html);.    
+00027e40: 202a 202f 2f55 7365 2079 6f75 7220 6f77   * //Use your ow
+00027e50: 6e20 6375 7374 6f6d 2063 6f6e 7665 7274  n custom convert
+00027e60: 6572 0a20 2020 2020 2a20 2470 6c61 696e  er.     * $plain
+00027e70: 203d 2024 6d61 696c 2d3e 6874 6d6c 3274   = $mail->html2t
+00027e80: 6578 7428 2468 746d 6c2c 2066 756e 6374  ext($html, funct
+00027e90: 696f 6e28 2468 746d 6c29 207b 0a20 2020  ion($html) {.   
+00027ea0: 2020 2a20 2020 2020 2463 6f6e 7665 7274    *     $convert
+00027eb0: 6572 203d 206e 6577 204d 7948 746d 6c32  er = new MyHtml2
+00027ec0: 7465 7874 2824 6874 6d6c 293b 0a20 2020  text($html);.   
+00027ed0: 2020 2a20 2020 2020 7265 7475 726e 2024    *     return $
+00027ee0: 636f 6e76 6572 7465 722d 3e67 6574 5f74  converter->get_t
+00027ef0: 6578 7428 293b 0a20 2020 2020 2a20 7d29  ext();.     * })
+00027f00: 3b0a 2020 2020 202a 2060 6060 0a20 2020  ;.     * ```.   
+00027f10: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
+00027f20: 6d20 7374 7269 6e67 2020 2020 2020 2020  m string        
+00027f30: 2468 746d 6c20 2020 2020 5468 6520 4854  $html     The HT
+00027f40: 4d4c 2074 6578 7420 746f 2063 6f6e 7665  ML text to conve
+00027f50: 7274 0a20 2020 2020 2a20 4070 6172 616d  rt.     * @param
+00027f60: 2062 6f6f 6c7c 6361 6c6c 6162 6c65 2024   bool|callable $
+00027f70: 6164 7661 6e63 6564 2041 6e79 2062 6f6f  advanced Any boo
+00027f80: 6c65 616e 2076 616c 7565 2074 6f20 7573  lean value to us
+00027f90: 6520 7468 6520 696e 7465 726e 616c 2063  e the internal c
+00027fa0: 6f6e 7665 7274 6572 2c0a 2020 2020 202a  onverter,.     *
+00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fd0: 6f72 2070 726f 7669 6465 2079 6f75 7220  or provide your 
+00027fe0: 6f77 6e20 6361 6c6c 6162 6c65 2066 6f72  own callable for
+00027ff0: 2063 7573 746f 6d20 636f 6e76 6572 7369   custom conversi
+00028000: 6f6e 2e0a 2020 2020 202a 2020 2020 2020  on..     *      
+00028010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028020: 2020 2020 2020 2020 2020 2a4e 6576 6572            *Never
+00028030: 2a20 7061 7373 2075 7365 722d 7375 7070  * pass user-supp
+00028040: 6c69 6564 2064 6174 6120 696e 746f 2074  lied data into t
+00028050: 6869 7320 7061 7261 6d65 7465 720a 2020  his parameter.  
+00028060: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
+00028070: 7572 6e20 7374 7269 6e67 0a20 2020 2020  urn string.     
+00028080: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+00028090: 6e63 7469 6f6e 2068 746d 6c32 7465 7874  nction html2text
+000280a0: 2824 6874 6d6c 2c20 2461 6476 616e 6365  ($html, $advance
+000280b0: 6420 3d20 6661 6c73 6529 0a20 2020 207b  d = false).    {
+000280c0: 0a20 2020 2020 2020 2069 6620 2869 735f  .        if (is_
+000280d0: 6361 6c6c 6162 6c65 2824 6164 7661 6e63  callable($advanc
+000280e0: 6564 2929 207b 0a20 2020 2020 2020 2020  ed)) {.         
+000280f0: 2020 2072 6574 7572 6e20 6361 6c6c 5f75     return call_u
+00028100: 7365 725f 6675 6e63 2824 6164 7661 6e63  ser_func($advanc
+00028110: 6564 2c20 2468 746d 6c29 3b0a 2020 2020  ed, $html);.    
+00028120: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
+00028130: 6574 7572 6e20 6874 6d6c 5f65 6e74 6974  eturn html_entit
+00028140: 795f 6465 636f 6465 280a 2020 2020 2020  y_decode(.      
+00028150: 2020 2020 2020 7472 696d 2873 7472 6970        trim(strip
+00028160: 5f74 6167 7328 7072 6567 5f72 6570 6c61  _tags(preg_repla
+00028170: 6365 2827 2f3c 2868 6561 647c 7469 746c  ce('/<(head|titl
+00028180: 657c 7374 796c 657c 7363 7269 7074 295b  e|style|script)[
+00028190: 5e3e 5d2a 3e2e 2a3f 3c5c 2f5c 5c31 3e2f  ^>]*>.*?<\/\\1>/
+000281a0: 7369 272c 2027 272c 2024 6874 6d6c 2929  si', '', $html))
+000281b0: 292c 0a20 2020 2020 2020 2020 2020 2045  ),.            E
+000281c0: 4e54 5f51 554f 5445 532c 0a20 2020 2020  NT_QUOTES,.     
+000281d0: 2020 2020 2020 2024 7468 6973 2d3e 4368         $this->Ch
+000281e0: 6172 5365 740a 2020 2020 2020 2020 293b  arSet.        );
+000281f0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+00028200: 2020 2020 202a 2047 6574 2074 6865 204d       * Get the M
+00028210: 494d 4520 7479 7065 2066 6f72 2061 2066  IME type for a f
+00028220: 696c 6520 6578 7465 6e73 696f 6e2e 0a20  ile extension.. 
+00028230: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+00028240: 7261 6d20 7374 7269 6e67 2024 6578 7420  ram string $ext 
+00028250: 4669 6c65 2065 7874 656e 7369 6f6e 0a20  File extension. 
+00028260: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
+00028270: 7475 726e 2073 7472 696e 6720 4d49 4d45  turn string MIME
+00028280: 2074 7970 6520 6f66 2066 696c 650a 2020   type of file.  
+00028290: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+000282a0: 2073 7461 7469 6320 6675 6e63 7469 6f6e   static function
+000282b0: 205f 6d69 6d65 5f74 7970 6573 2824 6578   _mime_types($ex
+000282c0: 7420 3d20 2727 290a 2020 2020 7b0a 2020  t = '').    {.  
+000282d0: 2020 2020 2020 246d 696d 6573 203d 205b        $mimes = [
+000282e0: 0a20 2020 2020 2020 2020 2020 2027 786c  .            'xl
+000282f0: 2720 3d3e 2027 6170 706c 6963 6174 696f  ' => 'applicatio
+00028300: 6e2f 6578 6365 6c27 2c0a 2020 2020 2020  n/excel',.      
+00028310: 2020 2020 2020 276a 7327 203d 3e20 2761        'js' => 'a
+00028320: 7070 6c69 6361 7469 6f6e 2f6a 6176 6173  pplication/javas
+00028330: 6372 6970 7427 2c0a 2020 2020 2020 2020  cript',.        
+00028340: 2020 2020 2768 7178 2720 3d3e 2027 6170      'hqx' => 'ap
+00028350: 706c 6963 6174 696f 6e2f 6d61 632d 6269  plication/mac-bi
+00028360: 6e68 6578 3430 272c 0a20 2020 2020 2020  nhex40',.       
+00028370: 2020 2020 2027 6370 7427 203d 3e20 2761       'cpt' => 'a
+00028380: 7070 6c69 6361 7469 6f6e 2f6d 6163 2d63  pplication/mac-c
+00028390: 6f6d 7061 6374 7072 6f27 2c0a 2020 2020  ompactpro',.    
+000283a0: 2020 2020 2020 2020 2762 696e 2720 3d3e          'bin' =>
+000283b0: 2027 6170 706c 6963 6174 696f 6e2f 6d61   'application/ma
+000283c0: 6362 696e 6172 7927 2c0a 2020 2020 2020  cbinary',.      
+000283d0: 2020 2020 2020 2764 6f63 2720 3d3e 2027        'doc' => '
+000283e0: 6170 706c 6963 6174 696f 6e2f 6d73 776f  application/mswo
+000283f0: 7264 272c 0a20 2020 2020 2020 2020 2020  rd',.           
+00028400: 2027 776f 7264 2720 3d3e 2027 6170 706c   'word' => 'appl
+00028410: 6963 6174 696f 6e2f 6d73 776f 7264 272c  ication/msword',
+00028420: 0a20 2020 2020 2020 2020 2020 2027 786c  .            'xl
+00028430: 7378 2720 3d3e 2027 6170 706c 6963 6174  sx' => 'applicat
+00028440: 696f 6e2f 766e 642e 6f70 656e 786d 6c66  ion/vnd.openxmlf
+00028450: 6f72 6d61 7473 2d6f 6666 6963 6564 6f63  ormats-officedoc
+00028460: 756d 656e 742e 7370 7265 6164 7368 6565  ument.spreadshee
+00028470: 746d 6c2e 7368 6565 7427 2c0a 2020 2020  tml.sheet',.    
+00028480: 2020 2020 2020 2020 2778 6c74 7827 203d          'xltx' =
+00028490: 3e20 2761 7070 6c69 6361 7469 6f6e 2f76  > 'application/v
+000284a0: 6e64 2e6f 7065 6e78 6d6c 666f 726d 6174  nd.openxmlformat
+000284b0: 732d 6f66 6669 6365 646f 6375 6d65 6e74  s-officedocument
+000284c0: 2e73 7072 6561 6473 6865 6574 6d6c 2e74  .spreadsheetml.t
+000284d0: 656d 706c 6174 6527 2c0a 2020 2020 2020  emplate',.      
+000284e0: 2020 2020 2020 2770 6f74 7827 203d 3e20        'potx' => 
+000284f0: 2761 7070 6c69 6361 7469 6f6e 2f76 6e64  'application/vnd
+00028500: 2e6f 7065 6e78 6d6c 666f 726d 6174 732d  .openxmlformats-
+00028510: 6f66 6669 6365 646f 6375 6d65 6e74 2e70  officedocument.p
+00028520: 7265 7365 6e74 6174 696f 6e6d 6c2e 7465  resentationml.te
+00028530: 6d70 6c61 7465 272c 0a20 2020 2020 2020  mplate',.       
+00028540: 2020 2020 2027 7070 7378 2720 3d3e 2027       'ppsx' => '
+00028550: 6170 706c 6963 6174 696f 6e2f 766e 642e  application/vnd.
+00028560: 6f70 656e 786d 6c66 6f72 6d61 7473 2d6f  openxmlformats-o
+00028570: 6666 6963 6564 6f63 756d 656e 742e 7072  fficedocument.pr
+00028580: 6573 656e 7461 7469 6f6e 6d6c 2e73 6c69  esentationml.sli
+00028590: 6465 7368 6f77 272c 0a20 2020 2020 2020  deshow',.       
+000285a0: 2020 2020 2027 7070 7478 2720 3d3e 2027       'pptx' => '
+000285b0: 6170 706c 6963 6174 696f 6e2f 766e 642e  application/vnd.
+000285c0: 6f70 656e 786d 6c66 6f72 6d61 7473 2d6f  openxmlformats-o
+000285d0: 6666 6963 6564 6f63 756d 656e 742e 7072  fficedocument.pr
+000285e0: 6573 656e 7461 7469 6f6e 6d6c 2e70 7265  esentationml.pre
+000285f0: 7365 6e74 6174 696f 6e27 2c0a 2020 2020  sentation',.    
+00028600: 2020 2020 2020 2020 2773 6c64 7827 203d          'sldx' =
+00028610: 3e20 2761 7070 6c69 6361 7469 6f6e 2f76  > 'application/v
+00028620: 6e64 2e6f 7065 6e78 6d6c 666f 726d 6174  nd.openxmlformat
+00028630: 732d 6f66 6669 6365 646f 6375 6d65 6e74  s-officedocument
+00028640: 2e70 7265 7365 6e74 6174 696f 6e6d 6c2e  .presentationml.
+00028650: 736c 6964 6527 2c0a 2020 2020 2020 2020  slide',.        
+00028660: 2020 2020 2764 6f63 7827 203d 3e20 2761      'docx' => 'a
+00028670: 7070 6c69 6361 7469 6f6e 2f76 6e64 2e6f  pplication/vnd.o
+00028680: 7065 6e78 6d6c 666f 726d 6174 732d 6f66  penxmlformats-of
+00028690: 6669 6365 646f 6375 6d65 6e74 2e77 6f72  ficedocument.wor
+000286a0: 6470 726f 6365 7373 696e 676d 6c2e 646f  dprocessingml.do
+000286b0: 6375 6d65 6e74 272c 0a20 2020 2020 2020  cument',.       
+000286c0: 2020 2020 2027 646f 7478 2720 3d3e 2027       'dotx' => '
+000286d0: 6170 706c 6963 6174 696f 6e2f 766e 642e  application/vnd.
+000286e0: 6f70 656e 786d 6c66 6f72 6d61 7473 2d6f  openxmlformats-o
+000286f0: 6666 6963 6564 6f63 756d 656e 742e 776f  fficedocument.wo
+00028700: 7264 7072 6f63 6573 7369 6e67 6d6c 2e74  rdprocessingml.t
+00028710: 656d 706c 6174 6527 2c0a 2020 2020 2020  emplate',.      
+00028720: 2020 2020 2020 2778 6c61 6d27 203d 3e20        'xlam' => 
+00028730: 2761 7070 6c69 6361 7469 6f6e 2f76 6e64  'application/vnd
+00028740: 2e6d 732d 6578 6365 6c2e 6164 6469 6e2e  .ms-excel.addin.
+00028750: 6d61 6372 6f45 6e61 626c 6564 2e31 3227  macroEnabled.12'
+00028760: 2c0a 2020 2020 2020 2020 2020 2020 2778  ,.            'x
+00028770: 6c73 6227 203d 3e20 2761 7070 6c69 6361  lsb' => 'applica
+00028780: 7469 6f6e 2f76 6e64 2e6d 732d 6578 6365  tion/vnd.ms-exce
+00028790: 6c2e 7368 6565 742e 6269 6e61 7279 2e6d  l.sheet.binary.m
+000287a0: 6163 726f 456e 6162 6c65 642e 3132 272c  acroEnabled.12',
+000287b0: 0a20 2020 2020 2020 2020 2020 2027 636c  .            'cl
+000287c0: 6173 7327 203d 3e20 2761 7070 6c69 6361  ass' => 'applica
+000287d0: 7469 6f6e 2f6f 6374 6574 2d73 7472 6561  tion/octet-strea
+000287e0: 6d27 2c0a 2020 2020 2020 2020 2020 2020  m',.            
+000287f0: 2764 6c6c 2720 3d3e 2027 6170 706c 6963  'dll' => 'applic
+00028800: 6174 696f 6e2f 6f63 7465 742d 7374 7265  ation/octet-stre
+00028810: 616d 272c 0a20 2020 2020 2020 2020 2020  am',.           
+00028820: 2027 646d 7327 203d 3e20 2761 7070 6c69   'dms' => 'appli
+00028830: 6361 7469 6f6e 2f6f 6374 6574 2d73 7472  cation/octet-str
+00028840: 6561 6d27 2c0a 2020 2020 2020 2020 2020  eam',.          
+00028850: 2020 2765 7865 2720 3d3e 2027 6170 706c    'exe' => 'appl
+00028860: 6963 6174 696f 6e2f 6f63 7465 742d 7374  ication/octet-st
+00028870: 7265 616d 272c 0a20 2020 2020 2020 2020  ream',.         
+00028880: 2020 2027 6c68 6127 203d 3e20 2761 7070     'lha' => 'app
+00028890: 6c69 6361 7469 6f6e 2f6f 6374 6574 2d73  lication/octet-s
+000288a0: 7472 6561 6d27 2c0a 2020 2020 2020 2020  tream',.        
+000288b0: 2020 2020 276c 7a68 2720 3d3e 2027 6170      'lzh' => 'ap
+000288c0: 706c 6963 6174 696f 6e2f 6f63 7465 742d  plication/octet-
+000288d0: 7374 7265 616d 272c 0a20 2020 2020 2020  stream',.       
+000288e0: 2020 2020 2027 7073 6427 203d 3e20 2761       'psd' => 'a
+000288f0: 7070 6c69 6361 7469 6f6e 2f6f 6374 6574  pplication/octet
+00028900: 2d73 7472 6561 6d27 2c0a 2020 2020 2020  -stream',.      
+00028910: 2020 2020 2020 2773 6561 2720 3d3e 2027        'sea' => '
+00028920: 6170 706c 6963 6174 696f 6e2f 6f63 7465  application/octe
+00028930: 742d 7374 7265 616d 272c 0a20 2020 2020  t-stream',.     
+00028940: 2020 2020 2020 2027 736f 2720 3d3e 2027         'so' => '
+00028950: 6170 706c 6963 6174 696f 6e2f 6f63 7465  application/octe
+00028960: 742d 7374 7265 616d 272c 0a20 2020 2020  t-stream',.     
+00028970: 2020 2020 2020 2027 6f64 6127 203d 3e20         'oda' => 
+00028980: 2761 7070 6c69 6361 7469 6f6e 2f6f 6461  'application/oda
+00028990: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+000289a0: 7064 6627 203d 3e20 2761 7070 6c69 6361  pdf' => 'applica
+000289b0: 7469 6f6e 2f70 6466 272c 0a20 2020 2020  tion/pdf',.     
+000289c0: 2020 2020 2020 2027 6169 2720 3d3e 2027         'ai' => '
+000289d0: 6170 706c 6963 6174 696f 6e2f 706f 7374  application/post
+000289e0: 7363 7269 7074 272c 0a20 2020 2020 2020  script',.       
+000289f0: 2020 2020 2027 6570 7327 203d 3e20 2761       'eps' => 'a
+00028a00: 7070 6c69 6361 7469 6f6e 2f70 6f73 7473  pplication/posts
+00028a10: 6372 6970 7427 2c0a 2020 2020 2020 2020  cript',.        
+00028a20: 2020 2020 2770 7327 203d 3e20 2761 7070      'ps' => 'app
+00028a30: 6c69 6361 7469 6f6e 2f70 6f73 7473 6372  lication/postscr
+00028a40: 6970 7427 2c0a 2020 2020 2020 2020 2020  ipt',.          
+00028a50: 2020 2773 6d69 2720 3d3e 2027 6170 706c    'smi' => 'appl
+00028a60: 6963 6174 696f 6e2f 736d 696c 272c 0a20  ication/smil',. 
+00028a70: 2020 2020 2020 2020 2020 2027 736d 696c             'smil
+00028a80: 2720 3d3e 2027 6170 706c 6963 6174 696f  ' => 'applicatio
+00028a90: 6e2f 736d 696c 272c 0a20 2020 2020 2020  n/smil',.       
+00028aa0: 2020 2020 2027 6d69 6627 203d 3e20 2761       'mif' => 'a
+00028ab0: 7070 6c69 6361 7469 6f6e 2f76 6e64 2e6d  pplication/vnd.m
+00028ac0: 6966 272c 0a20 2020 2020 2020 2020 2020  if',.           
+00028ad0: 2027 786c 7327 203d 3e20 2761 7070 6c69   'xls' => 'appli
+00028ae0: 6361 7469 6f6e 2f76 6e64 2e6d 732d 6578  cation/vnd.ms-ex
+00028af0: 6365 6c27 2c0a 2020 2020 2020 2020 2020  cel',.          
+00028b00: 2020 2770 7074 2720 3d3e 2027 6170 706c    'ppt' => 'appl
+00028b10: 6963 6174 696f 6e2f 766e 642e 6d73 2d70  ication/vnd.ms-p
+00028b20: 6f77 6572 706f 696e 7427 2c0a 2020 2020  owerpoint',.    
+00028b30: 2020 2020 2020 2020 2777 6278 6d6c 2720          'wbxml' 
+00028b40: 3d3e 2027 6170 706c 6963 6174 696f 6e2f  => 'application/
+00028b50: 766e 642e 7761 702e 7762 786d 6c27 2c0a  vnd.wap.wbxml',.
+00028b60: 2020 2020 2020 2020 2020 2020 2777 6d6c              'wml
+00028b70: 6327 203d 3e20 2761 7070 6c69 6361 7469  c' => 'applicati
+00028b80: 6f6e 2f76 6e64 2e77 6170 2e77 6d6c 6327  on/vnd.wap.wmlc'
+00028b90: 2c0a 2020 2020 2020 2020 2020 2020 2764  ,.            'd
+00028ba0: 6372 2720 3d3e 2027 6170 706c 6963 6174  cr' => 'applicat
+00028bb0: 696f 6e2f 782d 6469 7265 6374 6f72 272c  ion/x-director',
+00028bc0: 0a20 2020 2020 2020 2020 2020 2027 6469  .            'di
+00028bd0: 7227 203d 3e20 2761 7070 6c69 6361 7469  r' => 'applicati
+00028be0: 6f6e 2f78 2d64 6972 6563 746f 7227 2c0a  on/x-director',.
+00028bf0: 2020 2020 2020 2020 2020 2020 2764 7872              'dxr
+00028c00: 2720 3d3e 2027 6170 706c 6963 6174 696f  ' => 'applicatio
+00028c10: 6e2f 782d 6469 7265 6374 6f72 272c 0a20  n/x-director',. 
+00028c20: 2020 2020 2020 2020 2020 2027 6476 6927             'dvi'
+00028c30: 203d 3e20 2761 7070 6c69 6361 7469 6f6e   => 'application
+00028c40: 2f78 2d64 7669 272c 0a20 2020 2020 2020  /x-dvi',.       
+00028c50: 2020 2020 2027 6774 6172 2720 3d3e 2027       'gtar' => '
+00028c60: 6170 706c 6963 6174 696f 6e2f 782d 6774  application/x-gt
+00028c70: 6172 272c 0a20 2020 2020 2020 2020 2020  ar',.           
+00028c80: 2027 7068 7033 2720 3d3e 2027 6170 706c   'php3' => 'appl
+00028c90: 6963 6174 696f 6e2f 782d 6874 7470 642d  ication/x-httpd-
+00028ca0: 7068 7027 2c0a 2020 2020 2020 2020 2020  php',.          
+00028cb0: 2020 2770 6870 3427 203d 3e20 2761 7070    'php4' => 'app
+00028cc0: 6c69 6361 7469 6f6e 2f78 2d68 7474 7064  lication/x-httpd
+00028cd0: 2d70 6870 272c 0a20 2020 2020 2020 2020  -php',.         
+00028ce0: 2020 2027 7068 7027 203d 3e20 2761 7070     'php' => 'app
+00028cf0: 6c69 6361 7469 6f6e 2f78 2d68 7474 7064  lication/x-httpd
+00028d00: 2d70 6870 272c 0a20 2020 2020 2020 2020  -php',.         
+00028d10: 2020 2027 7068 746d 6c27 203d 3e20 2761     'phtml' => 'a
+00028d20: 7070 6c69 6361 7469 6f6e 2f78 2d68 7474  pplication/x-htt
+00028d30: 7064 2d70 6870 272c 0a20 2020 2020 2020  pd-php',.       
+00028d40: 2020 2020 2027 7068 7073 2720 3d3e 2027       'phps' => '
+00028d50: 6170 706c 6963 6174 696f 6e2f 782d 6874  application/x-ht
+00028d60: 7470 642d 7068 702d 736f 7572 6365 272c  tpd-php-source',
+00028d70: 0a20 2020 2020 2020 2020 2020 2027 7377  .            'sw
+00028d80: 6627 203d 3e20 2761 7070 6c69 6361 7469  f' => 'applicati
+00028d90: 6f6e 2f78 2d73 686f 636b 7761 7665 2d66  on/x-shockwave-f
+00028da0: 6c61 7368 272c 0a20 2020 2020 2020 2020  lash',.         
+00028db0: 2020 2027 7369 7427 203d 3e20 2761 7070     'sit' => 'app
+00028dc0: 6c69 6361 7469 6f6e 2f78 2d73 7475 6666  lication/x-stuff
+00028dd0: 6974 272c 0a20 2020 2020 2020 2020 2020  it',.           
+00028de0: 2027 7461 7227 203d 3e20 2761 7070 6c69   'tar' => 'appli
+00028df0: 6361 7469 6f6e 2f78 2d74 6172 272c 0a20  cation/x-tar',. 
+00028e00: 2020 2020 2020 2020 2020 2027 7467 7a27             'tgz'
+00028e10: 203d 3e20 2761 7070 6c69 6361 7469 6f6e   => 'application
+00028e20: 2f78 2d74 6172 272c 0a20 2020 2020 2020  /x-tar',.       
+00028e30: 2020 2020 2027 7868 7427 203d 3e20 2761       'xht' => 'a
+00028e40: 7070 6c69 6361 7469 6f6e 2f78 6874 6d6c  pplication/xhtml
+00028e50: 2b78 6d6c 272c 0a20 2020 2020 2020 2020  +xml',.         
+00028e60: 2020 2027 7868 746d 6c27 203d 3e20 2761     'xhtml' => 'a
+00028e70: 7070 6c69 6361 7469 6f6e 2f78 6874 6d6c  pplication/xhtml
+00028e80: 2b78 6d6c 272c 0a20 2020 2020 2020 2020  +xml',.         
+00028e90: 2020 2027 7a69 7027 203d 3e20 2761 7070     'zip' => 'app
+00028ea0: 6c69 6361 7469 6f6e 2f7a 6970 272c 0a20  lication/zip',. 
+00028eb0: 2020 2020 2020 2020 2020 2027 6d69 6427             'mid'
+00028ec0: 203d 3e20 2761 7564 696f 2f6d 6964 6927   => 'audio/midi'
+00028ed0: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
+00028ee0: 6964 6927 203d 3e20 2761 7564 696f 2f6d  idi' => 'audio/m
+00028ef0: 6964 6927 2c0a 2020 2020 2020 2020 2020  idi',.          
+00028f00: 2020 276d 7032 2720 3d3e 2027 6175 6469    'mp2' => 'audi
+00028f10: 6f2f 6d70 6567 272c 0a20 2020 2020 2020  o/mpeg',.       
+00028f20: 2020 2020 2027 6d70 3327 203d 3e20 2761       'mp3' => 'a
+00028f30: 7564 696f 2f6d 7065 6727 2c0a 2020 2020  udio/mpeg',.    
+00028f40: 2020 2020 2020 2020 276d 3461 2720 3d3e          'm4a' =>
+00028f50: 2027 6175 6469 6f2f 6d70 3427 2c0a 2020   'audio/mp4',.  
+00028f60: 2020 2020 2020 2020 2020 276d 7067 6127            'mpga'
+00028f70: 203d 3e20 2761 7564 696f 2f6d 7065 6727   => 'audio/mpeg'
+00028f80: 2c0a 2020 2020 2020 2020 2020 2020 2761  ,.            'a
+00028f90: 6966 2720 3d3e 2027 6175 6469 6f2f 782d  if' => 'audio/x-
+00028fa0: 6169 6666 272c 0a20 2020 2020 2020 2020  aiff',.         
+00028fb0: 2020 2027 6169 6663 2720 3d3e 2027 6175     'aifc' => 'au
+00028fc0: 6469 6f2f 782d 6169 6666 272c 0a20 2020  dio/x-aiff',.   
+00028fd0: 2020 2020 2020 2020 2027 6169 6666 2720           'aiff' 
+00028fe0: 3d3e 2027 6175 6469 6f2f 782d 6169 6666  => 'audio/x-aiff
+00028ff0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+00029000: 7261 6d27 203d 3e20 2761 7564 696f 2f78  ram' => 'audio/x
+00029010: 2d70 6e2d 7265 616c 6175 6469 6f27 2c0a  -pn-realaudio',.
+00029020: 2020 2020 2020 2020 2020 2020 2772 6d27              'rm'
+00029030: 203d 3e20 2761 7564 696f 2f78 2d70 6e2d   => 'audio/x-pn-
+00029040: 7265 616c 6175 6469 6f27 2c0a 2020 2020  realaudio',.    
+00029050: 2020 2020 2020 2020 2772 706d 2720 3d3e          'rpm' =>
+00029060: 2027 6175 6469 6f2f 782d 706e 2d72 6561   'audio/x-pn-rea
+00029070: 6c61 7564 696f 2d70 6c75 6769 6e27 2c0a  laudio-plugin',.
+00029080: 2020 2020 2020 2020 2020 2020 2772 6127              'ra'
+00029090: 203d 3e20 2761 7564 696f 2f78 2d72 6561   => 'audio/x-rea
+000290a0: 6c61 7564 696f 272c 0a20 2020 2020 2020  laudio',.       
+000290b0: 2020 2020 2027 7761 7627 203d 3e20 2761       'wav' => 'a
+000290c0: 7564 696f 2f78 2d77 6176 272c 0a20 2020  udio/x-wav',.   
+000290d0: 2020 2020 2020 2020 2027 6d6b 6127 203d           'mka' =
+000290e0: 3e20 2761 7564 696f 2f78 2d6d 6174 726f  > 'audio/x-matro
+000290f0: 736b 6127 2c0a 2020 2020 2020 2020 2020  ska',.          
+00029100: 2020 2762 6d70 2720 3d3e 2027 696d 6167    'bmp' => 'imag
+00029110: 652f 626d 7027 2c0a 2020 2020 2020 2020  e/bmp',.        
+00029120: 2020 2020 2767 6966 2720 3d3e 2027 696d      'gif' => 'im
+00029130: 6167 652f 6769 6627 2c0a 2020 2020 2020  age/gif',.      
+00029140: 2020 2020 2020 276a 7065 6727 203d 3e20        'jpeg' => 
+00029150: 2769 6d61 6765 2f6a 7065 6727 2c0a 2020  'image/jpeg',.  
+00029160: 2020 2020 2020 2020 2020 276a 7065 2720            'jpe' 
+00029170: 3d3e 2027 696d 6167 652f 6a70 6567 272c  => 'image/jpeg',
+00029180: 0a20 2020 2020 2020 2020 2020 2027 6a70  .            'jp
+00029190: 6727 203d 3e20 2769 6d61 6765 2f6a 7065  g' => 'image/jpe
+000291a0: 6727 2c0a 2020 2020 2020 2020 2020 2020  g',.            
+000291b0: 2770 6e67 2720 3d3e 2027 696d 6167 652f  'png' => 'image/
+000291c0: 706e 6727 2c0a 2020 2020 2020 2020 2020  png',.          
+000291d0: 2020 2774 6966 6627 203d 3e20 2769 6d61    'tiff' => 'ima
+000291e0: 6765 2f74 6966 6627 2c0a 2020 2020 2020  ge/tiff',.      
+000291f0: 2020 2020 2020 2774 6966 2720 3d3e 2027        'tif' => '
+00029200: 696d 6167 652f 7469 6666 272c 0a20 2020  image/tiff',.   
+00029210: 2020 2020 2020 2020 2027 7765 6270 2720           'webp' 
+00029220: 3d3e 2027 696d 6167 652f 7765 6270 272c  => 'image/webp',
+00029230: 0a20 2020 2020 2020 2020 2020 2027 6176  .            'av
+00029240: 6966 2720 3d3e 2027 696d 6167 652f 6176  if' => 'image/av
+00029250: 6966 272c 0a20 2020 2020 2020 2020 2020  if',.           
+00029260: 2027 6865 6966 2720 3d3e 2027 696d 6167   'heif' => 'imag
+00029270: 652f 6865 6966 272c 0a20 2020 2020 2020  e/heif',.       
+00029280: 2020 2020 2027 6865 6966 7327 203d 3e20       'heifs' => 
+00029290: 2769 6d61 6765 2f68 6569 662d 7365 7175  'image/heif-sequ
+000292a0: 656e 6365 272c 0a20 2020 2020 2020 2020  ence',.         
+000292b0: 2020 2027 6865 6963 2720 3d3e 2027 696d     'heic' => 'im
+000292c0: 6167 652f 6865 6963 272c 0a20 2020 2020  age/heic',.     
+000292d0: 2020 2020 2020 2027 6865 6963 7327 203d         'heics' =
+000292e0: 3e20 2769 6d61 6765 2f68 6569 632d 7365  > 'image/heic-se
+000292f0: 7175 656e 6365 272c 0a20 2020 2020 2020  quence',.       
+00029300: 2020 2020 2027 656d 6c27 203d 3e20 276d       'eml' => 'm
+00029310: 6573 7361 6765 2f72 6663 3832 3227 2c0a  essage/rfc822',.
+00029320: 2020 2020 2020 2020 2020 2020 2763 7373              'css
+00029330: 2720 3d3e 2027 7465 7874 2f63 7373 272c  ' => 'text/css',
+00029340: 0a20 2020 2020 2020 2020 2020 2027 6874  .            'ht
+00029350: 6d6c 2720 3d3e 2027 7465 7874 2f68 746d  ml' => 'text/htm
+00029360: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
+00029370: 2768 746d 2720 3d3e 2027 7465 7874 2f68  'htm' => 'text/h
+00029380: 746d 6c27 2c0a 2020 2020 2020 2020 2020  tml',.          
+00029390: 2020 2773 6874 6d6c 2720 3d3e 2027 7465    'shtml' => 'te
+000293a0: 7874 2f68 746d 6c27 2c0a 2020 2020 2020  xt/html',.      
+000293b0: 2020 2020 2020 276c 6f67 2720 3d3e 2027        'log' => '
+000293c0: 7465 7874 2f70 6c61 696e 272c 0a20 2020  text/plain',.   
+000293d0: 2020 2020 2020 2020 2027 7465 7874 2720           'text' 
+000293e0: 3d3e 2027 7465 7874 2f70 6c61 696e 272c  => 'text/plain',
+000293f0: 0a20 2020 2020 2020 2020 2020 2027 7478  .            'tx
+00029400: 7427 203d 3e20 2774 6578 742f 706c 6169  t' => 'text/plai
+00029410: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
+00029420: 2772 7478 2720 3d3e 2027 7465 7874 2f72  'rtx' => 'text/r
+00029430: 6963 6874 6578 7427 2c0a 2020 2020 2020  ichtext',.      
+00029440: 2020 2020 2020 2772 7466 2720 3d3e 2027        'rtf' => '
+00029450: 7465 7874 2f72 7466 272c 0a20 2020 2020  text/rtf',.     
+00029460: 2020 2020 2020 2027 7663 6627 203d 3e20         'vcf' => 
+00029470: 2774 6578 742f 7663 6172 6427 2c0a 2020  'text/vcard',.  
+00029480: 2020 2020 2020 2020 2020 2776 6361 7264            'vcard
+00029490: 2720 3d3e 2027 7465 7874 2f76 6361 7264  ' => 'text/vcard
+000294a0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+000294b0: 6963 7327 203d 3e20 2774 6578 742f 6361  ics' => 'text/ca
+000294c0: 6c65 6e64 6172 272c 0a20 2020 2020 2020  lendar',.       
+000294d0: 2020 2020 2027 786d 6c27 203d 3e20 2774       'xml' => 't
+000294e0: 6578 742f 786d 6c27 2c0a 2020 2020 2020  ext/xml',.      
+000294f0: 2020 2020 2020 2778 736c 2720 3d3e 2027        'xsl' => '
+00029500: 7465 7874 2f78 6d6c 272c 0a20 2020 2020  text/xml',.     
+00029510: 2020 2020 2020 2027 6373 7627 203d 3e20         'csv' => 
+00029520: 2774 6578 742f 6373 7627 2c0a 2020 2020  'text/csv',.    
+00029530: 2020 2020 2020 2020 2777 6d76 2720 3d3e          'wmv' =>
+00029540: 2027 7669 6465 6f2f 782d 6d73 2d77 6d76   'video/x-ms-wmv
+00029550: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+00029560: 6d70 6567 2720 3d3e 2027 7669 6465 6f2f  mpeg' => 'video/
+00029570: 6d70 6567 272c 0a20 2020 2020 2020 2020  mpeg',.         
+00029580: 2020 2027 6d70 6527 203d 3e20 2776 6964     'mpe' => 'vid
+00029590: 656f 2f6d 7065 6727 2c0a 2020 2020 2020  eo/mpeg',.      
+000295a0: 2020 2020 2020 276d 7067 2720 3d3e 2027        'mpg' => '
+000295b0: 7669 6465 6f2f 6d70 6567 272c 0a20 2020  video/mpeg',.   
+000295c0: 2020 2020 2020 2020 2027 6d70 3427 203d           'mp4' =
+000295d0: 3e20 2776 6964 656f 2f6d 7034 272c 0a20  > 'video/mp4',. 
+000295e0: 2020 2020 2020 2020 2020 2027 6d34 7627             'm4v'
+000295f0: 203d 3e20 2776 6964 656f 2f6d 7034 272c   => 'video/mp4',
+00029600: 0a20 2020 2020 2020 2020 2020 2027 6d6f  .            'mo
+00029610: 7627 203d 3e20 2776 6964 656f 2f71 7569  v' => 'video/qui
+00029620: 636b 7469 6d65 272c 0a20 2020 2020 2020  cktime',.       
+00029630: 2020 2020 2027 7174 2720 3d3e 2027 7669       'qt' => 'vi
+00029640: 6465 6f2f 7175 6963 6b74 696d 6527 2c0a  deo/quicktime',.
+00029650: 2020 2020 2020 2020 2020 2020 2772 7627              'rv'
+00029660: 203d 3e20 2776 6964 656f 2f76 6e64 2e72   => 'video/vnd.r
+00029670: 6e2d 7265 616c 7669 6465 6f27 2c0a 2020  n-realvideo',.  
+00029680: 2020 2020 2020 2020 2020 2761 7669 2720            'avi' 
+00029690: 3d3e 2027 7669 6465 6f2f 782d 6d73 7669  => 'video/x-msvi
+000296a0: 6465 6f27 2c0a 2020 2020 2020 2020 2020  deo',.          
+000296b0: 2020 276d 6f76 6965 2720 3d3e 2027 7669    'movie' => 'vi
+000296c0: 6465 6f2f 782d 7367 692d 6d6f 7669 6527  deo/x-sgi-movie'
+000296d0: 2c0a 2020 2020 2020 2020 2020 2020 2777  ,.            'w
+000296e0: 6562 6d27 203d 3e20 2776 6964 656f 2f77  ebm' => 'video/w
+000296f0: 6562 6d27 2c0a 2020 2020 2020 2020 2020  ebm',.          
+00029700: 2020 276d 6b76 2720 3d3e 2027 7669 6465    'mkv' => 'vide
+00029710: 6f2f 782d 6d61 7472 6f73 6b61 272c 0a20  o/x-matroska',. 
+00029720: 2020 2020 2020 205d 3b0a 2020 2020 2020         ];.      
+00029730: 2020 2465 7874 203d 2073 7472 746f 6c6f    $ext = strtolo
+00029740: 7765 7228 2465 7874 293b 0a20 2020 2020  wer($ext);.     
+00029750: 2020 2069 6620 2861 7272 6179 5f6b 6579     if (array_key
+00029760: 5f65 7869 7374 7328 2465 7874 2c20 246d  _exists($ext, $m
+00029770: 696d 6573 2929 207b 0a20 2020 2020 2020  imes)) {.       
+00029780: 2020 2020 2072 6574 7572 6e20 246d 696d       return $mim
+00029790: 6573 5b24 6578 745d 3b0a 2020 2020 2020  es[$ext];.      
+000297a0: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
+000297b0: 7572 6e20 2761 7070 6c69 6361 7469 6f6e  urn 'application
+000297c0: 2f6f 6374 6574 2d73 7472 6561 6d27 3b0a  /octet-stream';.
+000297d0: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+000297e0: 2020 2020 2a20 4d61 7020 6120 6669 6c65      * Map a file
+000297f0: 206e 616d 6520 746f 2061 204d 494d 4520   name to a MIME 
+00029800: 7479 7065 2e0a 2020 2020 202a 2044 6566  type..     * Def
+00029810: 6175 6c74 7320 746f 2027 6170 706c 6963  aults to 'applic
+00029820: 6174 696f 6e2f 6f63 7465 742d 7374 7265  ation/octet-stre
+00029830: 616d 272c 2069 2e65 2e2e 2061 7262 6974  am', i.e.. arbit
+00029840: 7261 7279 2062 696e 6172 7920 6461 7461  rary binary data
+00029850: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00029860: 4070 6172 616d 2073 7472 696e 6720 2466  @param string $f
+00029870: 696c 656e 616d 6520 4120 6669 6c65 206e  ilename A file n
+00029880: 616d 6520 6f72 2066 756c 6c20 7061 7468  ame or full path
+00029890: 2c20 646f 6573 206e 6f74 206e 6565 6420  , does not need 
+000298a0: 746f 2065 7869 7374 2061 7320 6120 6669  to exist as a fi
+000298b0: 6c65 0a20 2020 2020 2a0a 2020 2020 202a  le.     *.     *
+000298c0: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
+000298d0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+000298e0: 6963 2073 7461 7469 6320 6675 6e63 7469  ic static functi
+000298f0: 6f6e 2066 696c 656e 616d 6554 6f54 7970  on filenameToTyp
+00029900: 6528 2466 696c 656e 616d 6529 0a20 2020  e($filename).   
+00029910: 207b 0a20 2020 2020 2020 202f 2f49 6e20   {.        //In 
+00029920: 6361 7365 2074 6865 2070 6174 6820 6973  case the path is
+00029930: 2061 2055 524c 2c20 7374 7269 7020 616e   a URL, strip an
+00029940: 7920 7175 6572 7920 7374 7269 6e67 2062  y query string b
+00029950: 6566 6f72 6520 6765 7474 696e 6720 6578  efore getting ex
+00029960: 7465 6e73 696f 6e0a 2020 2020 2020 2020  tension.        
+00029970: 2471 706f 7320 3d20 7374 7270 6f73 2824  $qpos = strpos($
+00029980: 6669 6c65 6e61 6d65 2c20 273f 2729 3b0a  filename, '?');.
+00029990: 2020 2020 2020 2020 6966 2028 6661 6c73          if (fals
+000299a0: 6520 213d 3d20 2471 706f 7329 207b 0a20  e !== $qpos) {. 
+000299b0: 2020 2020 2020 2020 2020 2024 6669 6c65             $file
+000299c0: 6e61 6d65 203d 2073 7562 7374 7228 2466  name = substr($f
+000299d0: 696c 656e 616d 652c 2030 2c20 2471 706f  ilename, 0, $qpo
+000299e0: 7329 3b0a 2020 2020 2020 2020 7d0a 2020  s);.        }.  
+000299f0: 2020 2020 2020 2465 7874 203d 2073 7461        $ext = sta
+00029a00: 7469 633a 3a6d 625f 7061 7468 696e 666f  tic::mb_pathinfo
+00029a10: 2824 6669 6c65 6e61 6d65 2c20 5041 5448  ($filename, PATH
+00029a20: 494e 464f 5f45 5854 454e 5349 4f4e 293b  INFO_EXTENSION);
+00029a30: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00029a40: 2073 7461 7469 633a 3a5f 6d69 6d65 5f74   static::_mime_t
+00029a50: 7970 6573 2824 6578 7429 3b0a 2020 2020  ypes($ext);.    
+00029a60: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00029a70: 2a20 4d75 6c74 692d 6279 7465 2d73 6166  * Multi-byte-saf
+00029a80: 6520 7061 7468 696e 666f 2072 6570 6c61  e pathinfo repla
+00029a90: 6365 6d65 6e74 2e0a 2020 2020 202a 2044  cement..     * D
+00029aa0: 726f 702d 696e 2072 6570 6c61 6365 6d65  rop-in replaceme
+00029ab0: 6e74 2066 6f72 2070 6174 6869 6e66 6f28  nt for pathinfo(
+00029ac0: 292c 2062 7574 206d 756c 7469 6279 7465  ), but multibyte
+00029ad0: 2d20 616e 6420 6372 6f73 732d 706c 6174  - and cross-plat
+00029ae0: 666f 726d 2d73 6166 652e 0a20 2020 2020  form-safe..     
+00029af0: 2a0a 2020 2020 202a 2040 7365 6520 6874  *.     * @see ht
+00029b00: 7470 3a2f 2f77 7777 2e70 6870 2e6e 6574  tp://www.php.net
+00029b10: 2f6d 616e 7561 6c2f 656e 2f66 756e 6374  /manual/en/funct
+00029b20: 696f 6e2e 7061 7468 696e 666f 2e70 6870  ion.pathinfo.php
+00029b30: 2331 3037 3436 310a 2020 2020 202a 0a20  #107461.     *. 
+00029b40: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00029b50: 696e 6720 2020 2020 2470 6174 6820 2020  ing     $path   
+00029b60: 2041 2066 696c 656e 616d 6520 6f72 2070   A filename or p
+00029b70: 6174 682c 2064 6f65 7320 6e6f 7420 6e65  ath, does not ne
+00029b80: 6564 2074 6f20 6578 6973 7420 6173 2061  ed to exist as a
+00029b90: 2066 696c 650a 2020 2020 202a 2040 7061   file.     * @pa
+00029ba0: 7261 6d20 696e 747c 7374 7269 6e67 2024  ram int|string $
+00029bb0: 6f70 7469 6f6e 7320 4569 7468 6572 2061  options Either a
+00029bc0: 2050 4154 4849 4e46 4f5f 2a20 636f 6e73   PATHINFO_* cons
+00029bd0: 7461 6e74 2c0a 2020 2020 202a 2020 2020  tant,.     *    
+00029be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029bf0: 2020 2020 2020 2020 6f72 2061 2073 7472          or a str
+00029c00: 696e 6720 6e61 6d65 2074 6f20 7265 7475  ing name to retu
+00029c10: 726e 206f 6e6c 7920 7468 6520 7370 6563  rn only the spec
+00029c20: 6966 6965 6420 7069 6563 650a 2020 2020  ified piece.    
+00029c30: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+00029c40: 6e20 7374 7269 6e67 7c61 7272 6179 0a20  n string|array. 
+00029c50: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00029c60: 6320 7374 6174 6963 2066 756e 6374 696f  c static functio
+00029c70: 6e20 6d62 5f70 6174 6869 6e66 6f28 2470  n mb_pathinfo($p
+00029c80: 6174 682c 2024 6f70 7469 6f6e 7320 3d20  ath, $options = 
+00029c90: 6e75 6c6c 290a 2020 2020 7b0a 2020 2020  null).    {.    
+00029ca0: 2020 2020 2472 6574 203d 205b 2764 6972      $ret = ['dir
+00029cb0: 6e61 6d65 2720 3d3e 2027 272c 2027 6261  name' => '', 'ba
+00029cc0: 7365 6e61 6d65 2720 3d3e 2027 272c 2027  sename' => '', '
+00029cd0: 6578 7465 6e73 696f 6e27 203d 3e20 2727  extension' => ''
+00029ce0: 2c20 2766 696c 656e 616d 6527 203d 3e20  , 'filename' => 
+00029cf0: 2727 5d3b 0a20 2020 2020 2020 2024 7061  ''];.        $pa
+00029d00: 7468 696e 666f 203d 205b 5d3b 0a20 2020  thinfo = [];.   
+00029d10: 2020 2020 2069 6620 2870 7265 675f 6d61       if (preg_ma
+00029d20: 7463 6828 2723 5e28 2e2a 3f29 5b5c 5c5c  tch('#^(.*?)[\\\
+00029d30: 5c2f 5d2a 2828 5b5e 2f5c 5c5c 5c5d 2a3f  \/]*(([^/\\\\]*?
+00029d40: 2928 5c2e 285b 5e2e 5c5c 5c5c 2f5d 2b3f  )(\.([^.\\\\/]+?
+00029d50: 297c 2929 5b5c 5c5c 5c2f 2e5d 2a24 236d  )|))[\\\\/.]*$#m
+00029d60: 272c 2024 7061 7468 2c20 2470 6174 6869  ', $path, $pathi
+00029d70: 6e66 6f29 2920 7b0a 2020 2020 2020 2020  nfo)) {.        
+00029d80: 2020 2020 6966 2028 6172 7261 795f 6b65      if (array_ke
+00029d90: 795f 6578 6973 7473 2831 2c20 2470 6174  y_exists(1, $pat
+00029da0: 6869 6e66 6f29 2920 7b0a 2020 2020 2020  hinfo)) {.      
+00029db0: 2020 2020 2020 2020 2020 2472 6574 5b27            $ret['
+00029dc0: 6469 726e 616d 6527 5d20 3d20 2470 6174  dirname'] = $pat
+00029dd0: 6869 6e66 6f5b 315d 3b0a 2020 2020 2020  hinfo[1];.      
+00029de0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00029df0: 2020 2020 6966 2028 6172 7261 795f 6b65      if (array_ke
+00029e00: 795f 6578 6973 7473 2832 2c20 2470 6174  y_exists(2, $pat
+00029e10: 6869 6e66 6f29 2920 7b0a 2020 2020 2020  hinfo)) {.      
+00029e20: 2020 2020 2020 2020 2020 2472 6574 5b27            $ret['
+00029e30: 6261 7365 6e61 6d65 275d 203d 2024 7061  basename'] = $pa
+00029e40: 7468 696e 666f 5b32 5d3b 0a20 2020 2020  thinfo[2];.     
+00029e50: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00029e60: 2020 2020 2069 6620 2861 7272 6179 5f6b       if (array_k
+00029e70: 6579 5f65 7869 7374 7328 352c 2024 7061  ey_exists(5, $pa
+00029e80: 7468 696e 666f 2929 207b 0a20 2020 2020  thinfo)) {.     
+00029e90: 2020 2020 2020 2020 2020 2024 7265 745b             $ret[
+00029ea0: 2765 7874 656e 7369 6f6e 275d 203d 2024  'extension'] = $
+00029eb0: 7061 7468 696e 666f 5b35 5d3b 0a20 2020  pathinfo[5];.   
+00029ec0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00029ed0: 2020 2020 2020 2069 6620 2861 7272 6179         if (array
+00029ee0: 5f6b 6579 5f65 7869 7374 7328 332c 2024  _key_exists(3, $
+00029ef0: 7061 7468 696e 666f 2929 207b 0a20 2020  pathinfo)) {.   
+00029f00: 2020 2020 2020 2020 2020 2020 2024 7265               $re
+00029f10: 745b 2766 696c 656e 616d 6527 5d20 3d20  t['filename'] = 
+00029f20: 2470 6174 6869 6e66 6f5b 335d 3b0a 2020  $pathinfo[3];.  
+00029f30: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00029f40: 2020 2020 7d0a 2020 2020 2020 2020 7377      }.        sw
+00029f50: 6974 6368 2028 246f 7074 696f 6e73 2920  itch ($options) 
+00029f60: 7b0a 2020 2020 2020 2020 2020 2020 6361  {.            ca
+00029f70: 7365 2050 4154 4849 4e46 4f5f 4449 524e  se PATHINFO_DIRN
+00029f80: 414d 453a 0a20 2020 2020 2020 2020 2020  AME:.           
+00029f90: 2063 6173 6520 2764 6972 6e61 6d65 273a   case 'dirname':
+00029fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029fb0: 2072 6574 7572 6e20 2472 6574 5b27 6469   return $ret['di
+00029fc0: 726e 616d 6527 5d3b 0a20 2020 2020 2020  rname'];.       
+00029fd0: 2020 2020 2063 6173 6520 5041 5448 494e       case PATHIN
+00029fe0: 464f 5f42 4153 454e 414d 453a 0a20 2020  FO_BASENAME:.   
+00029ff0: 2020 2020 2020 2020 2063 6173 6520 2762           case 'b
+0002a000: 6173 656e 616d 6527 3a0a 2020 2020 2020  asename':.      
+0002a010: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002a020: 2024 7265 745b 2762 6173 656e 616d 6527   $ret['basename'
+0002a030: 5d3b 0a20 2020 2020 2020 2020 2020 2063  ];.            c
+0002a040: 6173 6520 5041 5448 494e 464f 5f45 5854  ase PATHINFO_EXT
+0002a050: 454e 5349 4f4e 3a0a 2020 2020 2020 2020  ENSION:.        
+0002a060: 2020 2020 6361 7365 2027 6578 7465 6e73      case 'extens
+0002a070: 696f 6e27 3a0a 2020 2020 2020 2020 2020  ion':.          
+0002a080: 2020 2020 2020 7265 7475 726e 2024 7265        return $re
+0002a090: 745b 2765 7874 656e 7369 6f6e 275d 3b0a  t['extension'];.
+0002a0a0: 2020 2020 2020 2020 2020 2020 6361 7365              case
+0002a0b0: 2050 4154 4849 4e46 4f5f 4649 4c45 4e41   PATHINFO_FILENA
+0002a0c0: 4d45 3a0a 2020 2020 2020 2020 2020 2020  ME:.            
+0002a0d0: 6361 7365 2027 6669 6c65 6e61 6d65 273a  case 'filename':
+0002a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a0f0: 2072 6574 7572 6e20 2472 6574 5b27 6669   return $ret['fi
+0002a100: 6c65 6e61 6d65 275d 3b0a 2020 2020 2020  lename'];.      
+0002a110: 2020 2020 2020 6465 6661 756c 743a 0a20        default:. 
+0002a120: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002a130: 6574 7572 6e20 2472 6574 3b0a 2020 2020  eturn $ret;.    
+0002a140: 2020 2020 7d0a 2020 2020 7d0a 0a20 2020      }.    }..   
+0002a150: 202f 2a2a 0a20 2020 2020 2a20 5365 7420   /**.     * Set 
+0002a160: 6f72 2072 6573 6574 2069 6e73 7461 6e63  or reset instanc
+0002a170: 6520 7072 6f70 6572 7469 6573 2e0a 2020  e properties..  
+0002a180: 2020 202a 2059 6f75 2073 686f 756c 6420     * You should 
+0002a190: 6176 6f69 6420 7468 6973 2066 756e 6374  avoid this funct
+0002a1a0: 696f 6e20 2d20 6974 2773 206d 6f72 6520  ion - it's more 
+0002a1b0: 7665 7262 6f73 652c 206c 6573 7320 6566  verbose, less ef
+0002a1c0: 6669 6369 656e 742c 206d 6f72 6520 6572  ficient, more er
+0002a1d0: 726f 722d 7072 6f6e 6520 616e 640a 2020  ror-prone and.  
+0002a1e0: 2020 202a 2068 6172 6465 7220 746f 2064     * harder to d
+0002a1f0: 6562 7567 2074 6861 6e20 7365 7474 696e  ebug than settin
+0002a200: 6720 7072 6f70 6572 7469 6573 2064 6972  g properties dir
+0002a210: 6563 746c 792e 0a20 2020 2020 2a20 5573  ectly..     * Us
+0002a220: 6167 6520 4578 616d 706c 653a 0a20 2020  age Example:.   
+0002a230: 2020 2a20 6024 6d61 696c 2d3e 7365 7428    * `$mail->set(
+0002a240: 2753 4d54 5053 6563 7572 6527 2c20 7374  'SMTPSecure', st
+0002a250: 6174 6963 3a3a 454e 4352 5950 5449 4f4e  atic::ENCRYPTION
+0002a260: 5f53 5441 5254 544c 5329 3b60 0a20 2020  _STARTTLS);`.   
+0002a270: 2020 2a20 2020 6973 2074 6865 2073 616d    *   is the sam
+0002a280: 6520 6173 3a0a 2020 2020 202a 2060 246d  e as:.     * `$m
+0002a290: 6169 6c2d 3e53 4d54 5053 6563 7572 6520  ail->SMTPSecure 
+0002a2a0: 3d20 7374 6174 6963 3a3a 454e 4352 5950  = static::ENCRYP
+0002a2b0: 5449 4f4e 5f53 5441 5254 544c 533b 602e  TION_STARTTLS;`.
+0002a2c0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+0002a2d0: 7061 7261 6d20 7374 7269 6e67 2024 6e61  param string $na
+0002a2e0: 6d65 2020 5468 6520 7072 6f70 6572 7479  me  The property
+0002a2f0: 206e 616d 6520 746f 2073 6574 0a20 2020   name to set.   
+0002a300: 2020 2a20 4070 6172 616d 206d 6978 6564    * @param mixed
+0002a310: 2020 2476 616c 7565 2054 6865 2076 616c    $value The val
+0002a320: 7565 2074 6f20 7365 7420 7468 6520 7072  ue to set the pr
+0002a330: 6f70 6572 7479 2074 6f0a 2020 2020 202a  operty to.     *
+0002a340: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+0002a350: 626f 6f6c 0a20 2020 2020 2a2f 0a20 2020  bool.     */.   
+0002a360: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+0002a370: 2073 6574 2824 6e61 6d65 2c20 2476 616c   set($name, $val
+0002a380: 7565 203d 2027 2729 0a20 2020 207b 0a20  ue = '').    {. 
+0002a390: 2020 2020 2020 2069 6620 2870 726f 7065         if (prope
+0002a3a0: 7274 795f 6578 6973 7473 2824 7468 6973  rty_exists($this
+0002a3b0: 2c20 246e 616d 6529 2920 7b0a 2020 2020  , $name)) {.    
+0002a3c0: 2020 2020 2020 2020 2474 6869 732d 3e7b          $this->{
+0002a3d0: 246e 616d 657d 203d 2024 7661 6c75 653b  $name} = $value;
+0002a3e0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0002a3f0: 7475 726e 2074 7275 653b 0a20 2020 2020  turn true;.     
+0002a400: 2020 207d 0a20 2020 2020 2020 2024 7468     }.        $th
+0002a410: 6973 2d3e 7365 7445 7272 6f72 2824 7468  is->setError($th
+0002a420: 6973 2d3e 6c61 6e67 2827 7661 7269 6162  is->lang('variab
+0002a430: 6c65 5f73 6574 2729 202e 2024 6e61 6d65  le_set') . $name
+0002a440: 293b 0a0a 2020 2020 2020 2020 7265 7475  );..        retu
+0002a450: 726e 2066 616c 7365 3b0a 2020 2020 7d0a  rn false;.    }.
+0002a460: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+0002a470: 5374 7269 7020 6e65 776c 696e 6573 2074  Strip newlines t
+0002a480: 6f20 7072 6576 656e 7420 6865 6164 6572  o prevent header
+0002a490: 2069 6e6a 6563 7469 6f6e 2e0a 2020 2020   injection..    
+0002a4a0: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+0002a4b0: 2073 7472 696e 6720 2473 7472 0a20 2020   string $str.   
+0002a4c0: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+0002a4d0: 726e 2073 7472 696e 670a 2020 2020 202a  rn string.     *
+0002a4e0: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+0002a4f0: 6374 696f 6e20 7365 6375 7265 4865 6164  ction secureHead
+0002a500: 6572 2824 7374 7229 0a20 2020 207b 0a20  er($str).    {. 
+0002a510: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+0002a520: 696d 2873 7472 5f72 6570 6c61 6365 285b  im(str_replace([
+0002a530: 225c 7222 2c20 225c 6e22 5d2c 2027 272c  "\r", "\n"], '',
+0002a540: 2024 7374 7229 293b 0a20 2020 207d 0a0a   $str));.    }..
+0002a550: 2020 2020 2f2a 2a0a 2020 2020 202a 204e      /**.     * N
+0002a560: 6f72 6d61 6c69 7a65 206c 696e 6520 6272  ormalize line br
+0002a570: 6561 6b73 2069 6e20 6120 7374 7269 6e67  eaks in a string
+0002a580: 2e0a 2020 2020 202a 2043 6f6e 7665 7274  ..     * Convert
+0002a590: 7320 554e 4958 204c 462c 204d 6163 2043  s UNIX LF, Mac C
+0002a5a0: 5220 616e 6420 5769 6e64 6f77 7320 4352  R and Windows CR
+0002a5b0: 4c46 206c 696e 6520 6272 6561 6b73 2069  LF line breaks i
+0002a5c0: 6e74 6f20 6120 7369 6e67 6c65 206c 696e  nto a single lin
+0002a5d0: 6520 6272 6561 6b20 666f 726d 6174 2e0a  e break format..
+0002a5e0: 2020 2020 202a 2044 6566 6175 6c74 7320       * Defaults 
+0002a5f0: 746f 2043 524c 4620 2866 6f72 206d 6573  to CRLF (for mes
+0002a600: 7361 6765 2062 6f64 6965 7329 2061 6e64  sage bodies) and
+0002a610: 2070 7265 7365 7276 6573 2063 6f6e 7365   preserves conse
+0002a620: 6375 7469 7665 2062 7265 616b 732e 0a20  cutive breaks.. 
+0002a630: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+0002a640: 7261 6d20 7374 7269 6e67 2024 7465 7874  ram string $text
+0002a650: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+0002a660: 7472 696e 6720 2462 7265 616b 7479 7065  tring $breaktype
+0002a670: 2057 6861 7420 6b69 6e64 206f 6620 6c69   What kind of li
+0002a680: 6e65 2062 7265 616b 2074 6f20 7573 653b  ne break to use;
+0002a690: 2064 6566 6175 6c74 7320 746f 2073 7461   defaults to sta
+0002a6a0: 7469 633a 3a24 4c45 0a20 2020 2020 2a0a  tic::$LE.     *.
+0002a6b0: 2020 2020 202a 2040 7265 7475 726e 2073       * @return s
+0002a6c0: 7472 696e 670a 2020 2020 202a 2f0a 2020  tring.     */.  
+0002a6d0: 2020 7075 626c 6963 2073 7461 7469 6320    public static 
+0002a6e0: 6675 6e63 7469 6f6e 206e 6f72 6d61 6c69  function normali
+0002a6f0: 7a65 4272 6561 6b73 2824 7465 7874 2c20  zeBreaks($text, 
+0002a700: 2462 7265 616b 7479 7065 203d 206e 756c  $breaktype = nul
+0002a710: 6c29 0a20 2020 207b 0a20 2020 2020 2020  l).    {.       
+0002a720: 2069 6620 286e 756c 6c20 3d3d 3d20 2462   if (null === $b
+0002a730: 7265 616b 7479 7065 2920 7b0a 2020 2020  reaktype) {.    
+0002a740: 2020 2020 2020 2020 2462 7265 616b 7479          $breakty
+0002a750: 7065 203d 2073 7461 7469 633a 3a24 4c45  pe = static::$LE
+0002a760: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+0002a770: 2020 2020 2f2f 4e6f 726d 616c 6973 6520      //Normalise 
+0002a780: 746f 205c 6e0a 2020 2020 2020 2020 2474  to \n.        $t
+0002a790: 6578 7420 3d20 7374 725f 7265 706c 6163  ext = str_replac
+0002a7a0: 6528 5b73 656c 663a 3a43 524c 462c 2022  e([self::CRLF, "
+0002a7b0: 5c72 225d 2c20 225c 6e22 2c20 2474 6578  \r"], "\n", $tex
+0002a7c0: 7429 3b0a 2020 2020 2020 2020 2f2f 4e6f  t);.        //No
+0002a7d0: 7720 636f 6e76 6572 7420 4c45 2061 7320  w convert LE as 
+0002a7e0: 6e65 6564 6564 0a20 2020 2020 2020 2069  needed.        i
+0002a7f0: 6620 2822 5c6e 2220 213d 3d20 2462 7265  f ("\n" !== $bre
+0002a800: 616b 7479 7065 2920 7b0a 2020 2020 2020  aktype) {.      
+0002a810: 2020 2020 2020 2474 6578 7420 3d20 7374        $text = st
+0002a820: 725f 7265 706c 6163 6528 225c 6e22 2c20  r_replace("\n", 
+0002a830: 2462 7265 616b 7479 7065 2c20 2474 6578  $breaktype, $tex
+0002a840: 7429 3b0a 2020 2020 2020 2020 7d0a 0a20  t);.        }.. 
+0002a850: 2020 2020 2020 2072 6574 7572 6e20 2474         return $t
+0002a860: 6578 743b 0a20 2020 207d 0a0a 2020 2020  ext;.    }..    
+0002a870: 2f2a 2a0a 2020 2020 202a 2052 656d 6f76  /**.     * Remov
+0002a880: 6520 7472 6169 6c69 6e67 2077 6869 7465  e trailing white
+0002a890: 7370 6163 6520 6672 6f6d 2061 2073 7472  space from a str
+0002a8a0: 696e 672e 0a20 2020 2020 2a0a 2020 2020  ing..     *.    
+0002a8b0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+0002a8c0: 2024 7465 7874 0a20 2020 2020 2a0a 2020   $text.     *.  
+0002a8d0: 2020 202a 2040 7265 7475 726e 2073 7472     * @return str
+0002a8e0: 696e 6720 5468 6520 7465 7874 2074 6f20  ing The text to 
+0002a8f0: 7265 6d6f 7665 2077 6869 7465 7370 6163  remove whitespac
+0002a900: 6520 6672 6f6d 0a20 2020 2020 2a2f 0a20  e from.     */. 
+0002a910: 2020 2070 7562 6c69 6320 7374 6174 6963     public static
+0002a920: 2066 756e 6374 696f 6e20 7374 7269 7054   function stripT
+0002a930: 7261 696c 696e 6757 5350 2824 7465 7874  railingWSP($text
+0002a940: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+0002a950: 7265 7475 726e 2072 7472 696d 2824 7465  return rtrim($te
+0002a960: 7874 2c20 2220 5c72 5c6e 5c74 2229 3b0a  xt, " \r\n\t");.
+0002a970: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+0002a980: 2020 2020 2a20 5374 7269 7020 7472 6169      * Strip trai
+0002a990: 6c69 6e67 206c 696e 6520 6272 6561 6b73  ling line breaks
+0002a9a0: 2066 726f 6d20 6120 7374 7269 6e67 2e0a   from a string..
+0002a9b0: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
+0002a9c0: 6172 616d 2073 7472 696e 6720 2474 6578  aram string $tex
+0002a9d0: 740a 2020 2020 202a 0a20 2020 2020 2a20  t.     *.     * 
+0002a9e0: 4072 6574 7572 6e20 7374 7269 6e67 2054  @return string T
+0002a9f0: 6865 2074 6578 7420 746f 2072 656d 6f76  he text to remov
+0002aa00: 6520 6272 6561 6b73 2066 726f 6d0a 2020  e breaks from.  
+0002aa10: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+0002aa20: 2073 7461 7469 6320 6675 6e63 7469 6f6e   static function
+0002aa30: 2073 7472 6970 5472 6169 6c69 6e67 4272   stripTrailingBr
+0002aa40: 6561 6b73 2824 7465 7874 290a 2020 2020  eaks($text).    
+0002aa50: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
+0002aa60: 2072 7472 696d 2824 7465 7874 2c20 225c   rtrim($text, "\
+0002aa70: 725c 6e22 293b 0a20 2020 207d 0a0a 2020  r\n");.    }..  
+0002aa80: 2020 2f2a 2a0a 2020 2020 202a 2052 6574    /**.     * Ret
+0002aa90: 7572 6e20 7468 6520 6375 7272 656e 7420  urn the current 
+0002aaa0: 6c69 6e65 2062 7265 616b 2066 6f72 6d61  line break forma
+0002aab0: 7420 7374 7269 6e67 2e0a 2020 2020 202a  t string..     *
+0002aac0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+0002aad0: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
+0002aae0: 2020 2070 7562 6c69 6320 7374 6174 6963     public static
+0002aaf0: 2066 756e 6374 696f 6e20 6765 744c 4528   function getLE(
+0002ab00: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+0002ab10: 7265 7475 726e 2073 7461 7469 633a 3a24  return static::$
+0002ab20: 4c45 3b0a 2020 2020 7d0a 0a20 2020 202f  LE;.    }..    /
+0002ab30: 2a2a 0a20 2020 2020 2a20 5365 7420 7468  **.     * Set th
+0002ab40: 6520 6c69 6e65 2062 7265 616b 2066 6f72  e line break for
+0002ab50: 6d61 7420 7374 7269 6e67 2c20 652e 672e  mat string, e.g.
+0002ab60: 2022 5c72 5c6e 222e 0a20 2020 2020 2a0a   "\r\n"..     *.
+0002ab70: 2020 2020 202a 2040 7061 7261 6d20 7374       * @param st
+0002ab80: 7269 6e67 2024 6c65 0a20 2020 2020 2a2f  ring $le.     */
+0002ab90: 0a20 2020 2070 726f 7465 6374 6564 2073  .    protected s
+0002aba0: 7461 7469 6320 6675 6e63 7469 6f6e 2073  tatic function s
+0002abb0: 6574 4c45 2824 6c65 290a 2020 2020 7b0a  etLE($le).    {.
+0002abc0: 2020 2020 2020 2020 7374 6174 6963 3a3a          static::
+0002abd0: 244c 4520 3d20 246c 653b 0a20 2020 207d  $LE = $le;.    }
+0002abe0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+0002abf0: 2053 6574 2074 6865 2070 7562 6c69 6320   Set the public 
+0002ac00: 616e 6420 7072 6976 6174 6520 6b65 7920  and private key 
+0002ac10: 6669 6c65 7320 616e 6420 7061 7373 776f  files and passwo
+0002ac20: 7264 2066 6f72 2053 2f4d 494d 4520 7369  rd for S/MIME si
+0002ac30: 676e 696e 672e 0a20 2020 2020 2a0a 2020  gning..     *.  
+0002ac40: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+0002ac50: 6e67 2024 6365 7274 5f66 696c 656e 616d  ng $cert_filenam
+0002ac60: 650a 2020 2020 202a 2040 7061 7261 6d20  e.     * @param 
+0002ac70: 7374 7269 6e67 2024 6b65 795f 6669 6c65  string $key_file
+0002ac80: 6e61 6d65 0a20 2020 2020 2a20 4070 6172  name.     * @par
+0002ac90: 616d 2073 7472 696e 6720 246b 6579 5f70  am string $key_p
+0002aca0: 6173 7320 2020 2020 2020 2020 2020 2050  ass            P
+0002acb0: 6173 7377 6f72 6420 666f 7220 7072 6976  assword for priv
+0002acc0: 6174 6520 6b65 790a 2020 2020 202a 2040  ate key.     * @
+0002acd0: 7061 7261 6d20 7374 7269 6e67 2024 6578  param string $ex
+0002ace0: 7472 6163 6572 7473 5f66 696c 656e 616d  tracerts_filenam
+0002acf0: 6520 4f70 7469 6f6e 616c 2070 6174 6820  e Optional path 
+0002ad00: 746f 2063 6861 696e 2063 6572 7469 6669  to chain certifi
+0002ad10: 6361 7465 0a20 2020 2020 2a2f 0a20 2020  cate.     */.   
+0002ad20: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+0002ad30: 2073 6967 6e28 2463 6572 745f 6669 6c65   sign($cert_file
+0002ad40: 6e61 6d65 2c20 246b 6579 5f66 696c 656e  name, $key_filen
+0002ad50: 616d 652c 2024 6b65 795f 7061 7373 2c20  ame, $key_pass, 
+0002ad60: 2465 7874 7261 6365 7274 735f 6669 6c65  $extracerts_file
+0002ad70: 6e61 6d65 203d 2027 2729 0a20 2020 207b  name = '').    {
+0002ad80: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+0002ad90: 7369 676e 5f63 6572 745f 6669 6c65 203d  sign_cert_file =
+0002ada0: 2024 6365 7274 5f66 696c 656e 616d 653b   $cert_filename;
+0002adb0: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+0002adc0: 7369 676e 5f6b 6579 5f66 696c 6520 3d20  sign_key_file = 
+0002add0: 246b 6579 5f66 696c 656e 616d 653b 0a20  $key_filename;. 
+0002ade0: 2020 2020 2020 2024 7468 6973 2d3e 7369         $this->si
+0002adf0: 676e 5f6b 6579 5f70 6173 7320 3d20 246b  gn_key_pass = $k
+0002ae00: 6579 5f70 6173 733b 0a20 2020 2020 2020  ey_pass;.       
+0002ae10: 2024 7468 6973 2d3e 7369 676e 5f65 7874   $this->sign_ext
+0002ae20: 7261 6365 7274 735f 6669 6c65 203d 2024  racerts_file = $
+0002ae30: 6578 7472 6163 6572 7473 5f66 696c 656e  extracerts_filen
+0002ae40: 616d 653b 0a20 2020 207d 0a0a 2020 2020  ame;.    }..    
+0002ae50: 2f2a 2a0a 2020 2020 202a 2051 756f 7465  /**.     * Quote
+0002ae60: 642d 5072 696e 7461 626c 652d 656e 636f  d-Printable-enco
+0002ae70: 6465 2061 2044 4b49 4d20 6865 6164 6572  de a DKIM header
+0002ae80: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+0002ae90: 4070 6172 616d 2073 7472 696e 6720 2474  @param string $t
+0002aea0: 7874 0a20 2020 2020 2a0a 2020 2020 202a  xt.     *.     *
+0002aeb0: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
+0002aec0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+0002aed0: 6963 2066 756e 6374 696f 6e20 444b 494d  ic function DKIM
+0002aee0: 5f51 5028 2474 7874 290a 2020 2020 7b0a  _QP($txt).    {.
+0002aef0: 2020 2020 2020 2020 246c 696e 6520 3d20          $line = 
+0002af00: 2727 3b0a 2020 2020 2020 2020 246c 656e  '';.        $len
+0002af10: 203d 2073 7472 6c65 6e28 2474 7874 293b   = strlen($txt);
+0002af20: 0a20 2020 2020 2020 2066 6f72 2028 2469  .        for ($i
+0002af30: 203d 2030 3b20 2469 203c 2024 6c65 6e3b   = 0; $i < $len;
+0002af40: 202b 2b24 6929 207b 0a20 2020 2020 2020   ++$i) {.       
+0002af50: 2020 2020 2024 6f72 6420 3d20 6f72 6428       $ord = ord(
+0002af60: 2474 7874 5b24 695d 293b 0a20 2020 2020  $txt[$i]);.     
+0002af70: 2020 2020 2020 2069 6620 2828 2830 7832         if (((0x2
+0002af80: 3120 3c3d 2024 6f72 6429 2026 2620 2824  1 <= $ord) && ($
+0002af90: 6f72 6420 3c3d 2030 7833 4129 2920 7c7c  ord <= 0x3A)) ||
+0002afa0: 2024 6f72 6420 3d3d 3d20 3078 3343 207c   $ord === 0x3C |
+0002afb0: 7c20 2828 3078 3345 203c 3d20 246f 7264  | ((0x3E <= $ord
+0002afc0: 2920 2626 2028 246f 7264 203c 3d20 3078  ) && ($ord <= 0x
+0002afd0: 3745 2929 2920 7b0a 2020 2020 2020 2020  7E))) {.        
+0002afe0: 2020 2020 2020 2020 246c 696e 6520 2e3d          $line .=
+0002aff0: 2024 7478 745b 2469 5d3b 0a20 2020 2020   $txt[$i];.     
+0002b000: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
+0002b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b020: 246c 696e 6520 2e3d 2027 3d27 202e 2073  $line .= '=' . s
+0002b030: 7072 696e 7466 2827 2530 3258 272c 2024  printf('%02X', $
+0002b040: 6f72 6429 3b0a 2020 2020 2020 2020 2020  ord);.          
+0002b050: 2020 7d0a 2020 2020 2020 2020 7d0a 0a20    }.        }.. 
+0002b060: 2020 2020 2020 2072 6574 7572 6e20 246c         return $l
+0002b070: 696e 653b 0a20 2020 207d 0a0a 2020 2020  ine;.    }..    
+0002b080: 2f2a 2a0a 2020 2020 202a 2047 656e 6572  /**.     * Gener
+0002b090: 6174 6520 6120 444b 494d 2073 6967 6e61  ate a DKIM signa
+0002b0a0: 7475 7265 2e0a 2020 2020 202a 0a20 2020  ture..     *.   
+0002b0b0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+0002b0c0: 6720 2473 6967 6e48 6561 6465 720a 2020  g $signHeader.  
+0002b0d0: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
+0002b0e0: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
+0002b0f0: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
+0002b100: 7572 6e20 7374 7269 6e67 2054 6865 2044  urn string The D
+0002b110: 4b49 4d20 7369 676e 6174 7572 6520 7661  KIM signature va
+0002b120: 6c75 650a 2020 2020 202a 2f0a 2020 2020  lue.     */.    
+0002b130: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+0002b140: 444b 494d 5f53 6967 6e28 2473 6967 6e48  DKIM_Sign($signH
+0002b150: 6561 6465 7229 0a20 2020 207b 0a20 2020  eader).    {.   
+0002b160: 2020 2020 2069 6620 2821 6465 6669 6e65       if (!define
+0002b170: 6428 2750 4b43 5337 5f54 4558 5427 2929  d('PKCS7_TEXT'))
+0002b180: 207b 0a20 2020 2020 2020 2020 2020 2069   {.            i
+0002b190: 6620 2824 7468 6973 2d3e 6578 6365 7074  f ($this->except
+0002b1a0: 696f 6e73 2920 7b0a 2020 2020 2020 2020  ions) {.        
+0002b1b0: 2020 2020 2020 2020 7468 726f 7720 6e65          throw ne
+0002b1c0: 7720 4578 6365 7074 696f 6e28 2474 6869  w Exception($thi
+0002b1d0: 732d 3e6c 616e 6728 2765 7874 656e 7369  s->lang('extensi
+0002b1e0: 6f6e 5f6d 6973 7369 6e67 2729 202e 2027  on_missing') . '
+0002b1f0: 6f70 656e 7373 6c27 293b 0a20 2020 2020  openssl');.     
+0002b200: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0002b210: 2020 2020 2020 7265 7475 726e 2027 273b        return '';
+0002b220: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0002b230: 2020 2024 7072 6976 4b65 7953 7472 203d     $privKeyStr =
+0002b240: 2021 656d 7074 7928 2474 6869 732d 3e44   !empty($this->D
+0002b250: 4b49 4d5f 7072 6976 6174 655f 7374 7269  KIM_private_stri
+0002b260: 6e67 2920 3f0a 2020 2020 2020 2020 2020  ng) ?.          
+0002b270: 2020 2474 6869 732d 3e44 4b49 4d5f 7072    $this->DKIM_pr
+0002b280: 6976 6174 655f 7374 7269 6e67 203a 0a20  ivate_string :. 
+0002b290: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0002b2a0: 6765 745f 636f 6e74 656e 7473 2824 7468  get_contents($th
+0002b2b0: 6973 2d3e 444b 494d 5f70 7269 7661 7465  is->DKIM_private
+0002b2c0: 293b 0a20 2020 2020 2020 2069 6620 2827  );.        if ('
+0002b2d0: 2720 213d 3d20 2474 6869 732d 3e44 4b49  ' !== $this->DKI
+0002b2e0: 4d5f 7061 7373 7068 7261 7365 2920 7b0a  M_passphrase) {.
+0002b2f0: 2020 2020 2020 2020 2020 2020 2470 7269              $pri
+0002b300: 764b 6579 203d 206f 7065 6e73 736c 5f70  vKey = openssl_p
+0002b310: 6b65 795f 6765 745f 7072 6976 6174 6528  key_get_private(
+0002b320: 2470 7269 764b 6579 5374 722c 2024 7468  $privKeyStr, $th
+0002b330: 6973 2d3e 444b 494d 5f70 6173 7370 6872  is->DKIM_passphr
+0002b340: 6173 6529 3b0a 2020 2020 2020 2020 7d20  ase);.        } 
+0002b350: 656c 7365 207b 0a20 2020 2020 2020 2020  else {.         
+0002b360: 2020 2024 7072 6976 4b65 7920 3d20 6f70     $privKey = op
+0002b370: 656e 7373 6c5f 706b 6579 5f67 6574 5f70  enssl_pkey_get_p
+0002b380: 7269 7661 7465 2824 7072 6976 4b65 7953  rivate($privKeyS
+0002b390: 7472 293b 0a20 2020 2020 2020 207d 0a20  tr);.        }. 
+0002b3a0: 2020 2020 2020 2069 6620 286f 7065 6e73         if (opens
+0002b3b0: 736c 5f73 6967 6e28 2473 6967 6e48 6561  sl_sign($signHea
+0002b3c0: 6465 722c 2024 7369 676e 6174 7572 652c  der, $signature,
+0002b3d0: 2024 7072 6976 4b65 792c 2027 7368 6132   $privKey, 'sha2
+0002b3e0: 3536 5769 7468 5253 4145 6e63 7279 7074  56WithRSAEncrypt
+0002b3f0: 696f 6e27 2929 207b 0a20 2020 2020 2020  ion')) {.       
+0002b400: 2020 2020 2069 6620 285c 5048 505f 4d41       if (\PHP_MA
+0002b410: 4a4f 525f 5645 5253 494f 4e20 3c20 3829  JOR_VERSION < 8)
+0002b420: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0002b430: 2020 206f 7065 6e73 736c 5f70 6b65 795f     openssl_pkey_
+0002b440: 6672 6565 2824 7072 6976 4b65 7929 3b0a  free($privKey);.
+0002b450: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
+0002b460: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002b470: 6e20 6261 7365 3634 5f65 6e63 6f64 6528  n base64_encode(
+0002b480: 2473 6967 6e61 7475 7265 293b 0a20 2020  $signature);.   
+0002b490: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
+0002b4a0: 6620 285c 5048 505f 4d41 4a4f 525f 5645  f (\PHP_MAJOR_VE
+0002b4b0: 5253 494f 4e20 3c20 3829 207b 0a20 2020  RSION < 8) {.   
+0002b4c0: 2020 2020 2020 2020 206f 7065 6e73 736c           openssl
+0002b4d0: 5f70 6b65 795f 6672 6565 2824 7072 6976  _pkey_free($priv
+0002b4e0: 4b65 7929 3b0a 2020 2020 2020 2020 7d0a  Key);.        }.
+0002b4f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002b500: 2727 3b0a 2020 2020 7d0a 0a20 2020 202f  '';.    }..    /
+0002b510: 2a2a 0a20 2020 2020 2a20 4765 6e65 7261  **.     * Genera
+0002b520: 7465 2061 2044 4b49 4d20 6361 6e6f 6e69  te a DKIM canoni
+0002b530: 6361 6c69 7a61 7469 6f6e 2068 6561 6465  calization heade
+0002b540: 722e 0a20 2020 2020 2a20 5573 6573 2074  r..     * Uses t
+0002b550: 6865 2027 7265 6c61 7865 6427 2061 6c67  he 'relaxed' alg
+0002b560: 6f72 6974 686d 2066 726f 6d20 5246 4336  orithm from RFC6
+0002b570: 3337 3620 7365 6374 696f 6e20 332e 342e  376 section 3.4.
+0002b580: 322e 0a20 2020 2020 2a20 4361 6e6f 6e69  2..     * Canoni
+0002b590: 6361 6c69 7a65 6420 6865 6164 6572 7320  calized headers 
+0002b5a0: 7368 6f75 6c64 202a 616c 7761 7973 2a20  should *always* 
+0002b5b0: 7573 6520 4352 4c46 2c20 7265 6761 7264  use CRLF, regard
+0002b5c0: 6c65 7373 206f 6620 6d61 696c 6572 2073  less of mailer s
+0002b5d0: 6574 7469 6e67 2e0a 2020 2020 202a 0a20  etting..     *. 
+0002b5e0: 2020 2020 2a20 4073 6565 2068 7474 7073      * @see https
+0002b5f0: 3a2f 2f74 6f6f 6c73 2e69 6574 662e 6f72  ://tools.ietf.or
+0002b600: 672f 6874 6d6c 2f72 6663 3633 3736 2373  g/html/rfc6376#s
+0002b610: 6563 7469 6f6e 2d33 2e34 2e32 0a20 2020  ection-3.4.2.   
+0002b620: 2020 2a0a 2020 2020 202a 2040 7061 7261    *.     * @para
+0002b630: 6d20 7374 7269 6e67 2024 7369 676e 4865  m string $signHe
+0002b640: 6164 6572 2048 6561 6465 720a 2020 2020  ader Header.    
+0002b650: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+0002b660: 6e20 7374 7269 6e67 0a20 2020 2020 2a2f  n string.     */
+0002b670: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
+0002b680: 7469 6f6e 2044 4b49 4d5f 4865 6164 6572  tion DKIM_Header
+0002b690: 4328 2473 6967 6e48 6561 6465 7229 0a20  C($signHeader). 
+0002b6a0: 2020 207b 0a20 2020 2020 2020 202f 2f4e     {.        //N
+0002b6b0: 6f72 6d61 6c69 7a65 2062 7265 616b 7320  ormalize breaks 
+0002b6c0: 746f 2043 524c 4620 2872 6567 6172 646c  to CRLF (regardl
+0002b6d0: 6573 7320 6f66 2074 6865 206d 6169 6c65  ess of the maile
+0002b6e0: 7229 0a20 2020 2020 2020 2024 7369 676e  r).        $sign
+0002b6f0: 4865 6164 6572 203d 2073 7461 7469 633a  Header = static:
+0002b700: 3a6e 6f72 6d61 6c69 7a65 4272 6561 6b73  :normalizeBreaks
+0002b710: 2824 7369 676e 4865 6164 6572 2c20 7365  ($signHeader, se
+0002b720: 6c66 3a3a 4352 4c46 293b 0a20 2020 2020  lf::CRLF);.     
+0002b730: 2020 202f 2f55 6e66 6f6c 6420 6865 6164     //Unfold head
+0002b740: 6572 206c 696e 6573 0a20 2020 2020 2020  er lines.       
+0002b750: 202f 2f4e 6f74 6520 5043 5245 205c 7320   //Note PCRE \s 
+0002b760: 6973 2074 6f6f 2062 726f 6164 2061 2064  is too broad a d
+0002b770: 6566 696e 6974 696f 6e20 6f66 2077 6869  efinition of whi
+0002b780: 7465 7370 6163 653b 2052 4643 3533 3232  tespace; RFC5322
+0002b790: 2064 6566 696e 6573 2069 7420 6173 2060   defines it as `
+0002b7a0: 5b20 5c74 5d60 0a20 2020 2020 2020 202f  [ \t]`.        /
+0002b7b0: 2f40 7365 6520 6874 7470 733a 2f2f 746f  /@see https://to
+0002b7c0: 6f6c 732e 6965 7466 2e6f 7267 2f68 746d  ols.ietf.org/htm
+0002b7d0: 6c2f 7266 6335 3332 3223 7365 6374 696f  l/rfc5322#sectio
+0002b7e0: 6e2d 322e 320a 2020 2020 2020 2020 2f2f  n-2.2.        //
+0002b7f0: 5468 6174 206d 6561 6e73 2074 6869 7320  That means this 
+0002b800: 6d61 7920 6272 6561 6b20 6966 2079 6f75  may break if you
+0002b810: 2064 6f20 736f 6d65 7468 696e 6720 6461   do something da
+0002b820: 6674 206c 696b 6520 7075 7420 7665 7274  ft like put vert
+0002b830: 6963 616c 2074 6162 7320 696e 2079 6f75  ical tabs in you
+0002b840: 7220 6865 6164 6572 732e 0a20 2020 2020  r headers..     
+0002b850: 2020 2024 7369 676e 4865 6164 6572 203d     $signHeader =
+0002b860: 2070 7265 675f 7265 706c 6163 6528 272f   preg_replace('/
+0002b870: 5c72 5c6e 5b20 5c74 5d2b 2f27 2c20 2720  \r\n[ \t]+/', ' 
+0002b880: 272c 2024 7369 676e 4865 6164 6572 293b  ', $signHeader);
+0002b890: 0a20 2020 2020 2020 202f 2f42 7265 616b  .        //Break
+0002b8a0: 2068 6561 6465 7273 206f 7574 2069 6e74   headers out int
+0002b8b0: 6f20 616e 2061 7272 6179 0a20 2020 2020  o an array.     
+0002b8c0: 2020 2024 6c69 6e65 7320 3d20 6578 706c     $lines = expl
+0002b8d0: 6f64 6528 7365 6c66 3a3a 4352 4c46 2c20  ode(self::CRLF, 
+0002b8e0: 2473 6967 6e48 6561 6465 7229 3b0a 2020  $signHeader);.  
+0002b8f0: 2020 2020 2020 666f 7265 6163 6820 2824        foreach ($
+0002b900: 6c69 6e65 7320 6173 2024 6b65 7920 3d3e  lines as $key =>
+0002b910: 2024 6c69 6e65 2920 7b0a 2020 2020 2020   $line) {.      
+0002b920: 2020 2020 2020 2f2f 4966 2074 6865 2068        //If the h
+0002b930: 6561 6465 7220 6973 206d 6973 7369 6e67  eader is missing
+0002b940: 2061 203a 2c20 736b 6970 2069 7420 6173   a :, skip it as
+0002b950: 2069 7427 7320 696e 7661 6c69 640a 2020   it's invalid.  
+0002b960: 2020 2020 2020 2020 2020 2f2f 5468 6973            //This
+0002b970: 2069 7320 6c69 6b65 6c79 2074 6f20 6861   is likely to ha
+0002b980: 7070 656e 2062 6563 6175 7365 2074 6865  ppen because the
+0002b990: 2065 7870 6c6f 6465 2829 2061 626f 7665   explode() above
+0002b9a0: 2077 696c 6c20 616c 736f 2073 706c 6974   will also split
+0002b9b0: 0a20 2020 2020 2020 2020 2020 202f 2f6f  .            //o
+0002b9c0: 6e20 7468 6520 7472 6169 6c69 6e67 204c  n the trailing L
+0002b9d0: 452c 206c 6561 7669 6e67 2061 6e20 656d  E, leaving an em
+0002b9e0: 7074 7920 6c69 6e65 0a20 2020 2020 2020  pty line.       
+0002b9f0: 2020 2020 2069 6620 2873 7472 706f 7328       if (strpos(
+0002ba00: 246c 696e 652c 2027 3a27 2920 3d3d 3d20  $line, ':') === 
+0002ba10: 6661 6c73 6529 207b 0a20 2020 2020 2020  false) {.       
+0002ba20: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0002ba30: 653b 0a20 2020 2020 2020 2020 2020 207d  e;.            }
+0002ba40: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
+0002ba50: 7428 2468 6561 6469 6e67 2c20 2476 616c  t($heading, $val
+0002ba60: 7565 2920 3d20 6578 706c 6f64 6528 273a  ue) = explode(':
+0002ba70: 272c 2024 6c69 6e65 2c20 3229 3b0a 2020  ', $line, 2);.  
+0002ba80: 2020 2020 2020 2020 2020 2f2f 4c6f 7765            //Lowe
+0002ba90: 722d 6361 7365 2068 6561 6465 7220 6e61  r-case header na
+0002baa0: 6d65 0a20 2020 2020 2020 2020 2020 2024  me.            $
+0002bab0: 6865 6164 696e 6720 3d20 7374 7274 6f6c  heading = strtol
+0002bac0: 6f77 6572 2824 6865 6164 696e 6729 3b0a  ower($heading);.
+0002bad0: 2020 2020 2020 2020 2020 2020 2f2f 436f              //Co
+0002bae0: 6c6c 6170 7365 2077 6869 7465 2073 7061  llapse white spa
+0002baf0: 6365 2077 6974 6869 6e20 7468 6520 7661  ce within the va
+0002bb00: 6c75 652c 2061 6c73 6f20 636f 6e76 6572  lue, also conver
+0002bb10: 7420 5753 5020 746f 2073 7061 6365 0a20  t WSP to space. 
+0002bb20: 2020 2020 2020 2020 2020 2024 7661 6c75             $valu
+0002bb30: 6520 3d20 7072 6567 5f72 6570 6c61 6365  e = preg_replace
+0002bb40: 2827 2f5b 205c 745d 2b2f 272c 2027 2027  ('/[ \t]+/', ' '
+0002bb50: 2c20 2476 616c 7565 293b 0a20 2020 2020  , $value);.     
+0002bb60: 2020 2020 2020 202f 2f52 4643 3633 3736         //RFC6376
+0002bb70: 2069 7320 736c 6967 6874 6c79 2075 6e63   is slightly unc
+0002bb80: 6c65 6172 2068 6572 6520 2d20 6974 2073  lear here - it s
+0002bb90: 6179 7320 746f 2064 656c 6574 6520 7370  ays to delete sp
+0002bba0: 6163 6520 6174 2074 6865 202a 656e 642a  ace at the *end*
+0002bbb0: 206f 6620 6561 6368 2076 616c 7565 0a20   of each value. 
+0002bbc0: 2020 2020 2020 2020 2020 202f 2f42 7574             //But
+0002bbd0: 2074 6865 6e20 7361 7973 2074 6f20 6465   then says to de
+0002bbe0: 6c65 7465 2073 7061 6365 2062 6566 6f72  lete space befor
+0002bbf0: 6520 616e 6420 6166 7465 7220 7468 6520  e and after the 
+0002bc00: 636f 6c6f 6e2e 0a20 2020 2020 2020 2020  colon..         
+0002bc10: 2020 202f 2f4e 6574 2072 6573 756c 7420     //Net result 
+0002bc20: 6973 2074 6865 2073 616d 6520 6173 2074  is the same as t
+0002bc30: 7269 6d6d 696e 6720 626f 7468 2065 6e64  rimming both end
+0002bc40: 7320 6f66 2074 6865 2076 616c 7565 2e0a  s of the value..
+0002bc50: 2020 2020 2020 2020 2020 2020 2f2f 4279              //By
+0002bc60: 2065 6c69 6d69 6e61 7469 6f6e 2c20 7468   elimination, th
+0002bc70: 6520 7361 6d65 2061 7070 6c69 6573 2074  e same applies t
+0002bc80: 6f20 7468 6520 6669 656c 6420 6e61 6d65  o the field name
+0002bc90: 0a20 2020 2020 2020 2020 2020 2024 6c69  .            $li
+0002bca0: 6e65 735b 246b 6579 5d20 3d20 7472 696d  nes[$key] = trim
+0002bcb0: 2824 6865 6164 696e 672c 2022 205c 7422  ($heading, " \t"
+0002bcc0: 2920 2e20 273a 2720 2e20 7472 696d 2824  ) . ':' . trim($
+0002bcd0: 7661 6c75 652c 2022 205c 7422 293b 0a20  value, " \t");. 
+0002bce0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0002bcf0: 2020 7265 7475 726e 2069 6d70 6c6f 6465    return implode
+0002bd00: 2873 656c 663a 3a43 524c 462c 2024 6c69  (self::CRLF, $li
+0002bd10: 6e65 7329 3b0a 2020 2020 7d0a 0a20 2020  nes);.    }..   
+0002bd20: 202f 2a2a 0a20 2020 2020 2a20 4765 6e65   /**.     * Gene
+0002bd30: 7261 7465 2061 2044 4b49 4d20 6361 6e6f  rate a DKIM cano
+0002bd40: 6e69 6361 6c69 7a61 7469 6f6e 2062 6f64  nicalization bod
+0002bd50: 792e 0a20 2020 2020 2a20 5573 6573 2074  y..     * Uses t
+0002bd60: 6865 2027 7369 6d70 6c65 2720 616c 676f  he 'simple' algo
+0002bd70: 7269 7468 6d20 6672 6f6d 2052 4643 3633  rithm from RFC63
+0002bd80: 3736 2073 6563 7469 6f6e 2033 2e34 2e33  76 section 3.4.3
+0002bd90: 2e0a 2020 2020 202a 2043 616e 6f6e 6963  ..     * Canonic
+0002bda0: 616c 697a 6564 2062 6f64 6965 7320 7368  alized bodies sh
+0002bdb0: 6f75 6c64 202a 616c 7761 7973 2a20 7573  ould *always* us
+0002bdc0: 6520 4352 4c46 2c20 7265 6761 7264 6c65  e CRLF, regardle
+0002bdd0: 7373 206f 6620 6d61 696c 6572 2073 6574  ss of mailer set
+0002bde0: 7469 6e67 2e0a 2020 2020 202a 0a20 2020  ting..     *.   
+0002bdf0: 2020 2a20 4073 6565 2068 7474 7073 3a2f    * @see https:/
+0002be00: 2f74 6f6f 6c73 2e69 6574 662e 6f72 672f  /tools.ietf.org/
+0002be10: 6874 6d6c 2f72 6663 3633 3736 2373 6563  html/rfc6376#sec
+0002be20: 7469 6f6e 2d33 2e34 2e33 0a20 2020 2020  tion-3.4.3.     
+0002be30: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
+0002be40: 7374 7269 6e67 2024 626f 6479 204d 6573  string $body Mes
+0002be50: 7361 6765 2042 6f64 790a 2020 2020 202a  sage Body.     *
+0002be60: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+0002be70: 7374 7269 6e67 0a20 2020 2020 2a2f 0a20  string.     */. 
+0002be80: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
+0002be90: 6f6e 2044 4b49 4d5f 426f 6479 4328 2462  on DKIM_BodyC($b
+0002bea0: 6f64 7929 0a20 2020 207b 0a20 2020 2020  ody).    {.     
+0002beb0: 2020 2069 6620 2865 6d70 7479 2824 626f     if (empty($bo
+0002bec0: 6479 2929 207b 0a20 2020 2020 2020 2020  dy)) {.         
+0002bed0: 2020 2072 6574 7572 6e20 7365 6c66 3a3a     return self::
+0002bee0: 4352 4c46 3b0a 2020 2020 2020 2020 7d0a  CRLF;.        }.
+0002bef0: 2020 2020 2020 2020 2f2f 4e6f 726d 616c          //Normal
+0002bf00: 697a 6520 6c69 6e65 2065 6e64 696e 6773  ize line endings
+0002bf10: 2074 6f20 4352 4c46 0a20 2020 2020 2020   to CRLF.       
+0002bf20: 2024 626f 6479 203d 2073 7461 7469 633a   $body = static:
+0002bf30: 3a6e 6f72 6d61 6c69 7a65 4272 6561 6b73  :normalizeBreaks
+0002bf40: 2824 626f 6479 2c20 7365 6c66 3a3a 4352  ($body, self::CR
+0002bf50: 4c46 293b 0a0a 2020 2020 2020 2020 2f2f  LF);..        //
+0002bf60: 5265 6475 6365 206d 756c 7469 706c 6520  Reduce multiple 
+0002bf70: 7472 6169 6c69 6e67 206c 696e 6520 6272  trailing line br
+0002bf80: 6561 6b73 2074 6f20 6120 7369 6e67 6c65  eaks to a single
+0002bf90: 206f 6e65 0a20 2020 2020 2020 2072 6574   one.        ret
+0002bfa0: 7572 6e20 7374 6174 6963 3a3a 7374 7269  urn static::stri
+0002bfb0: 7054 7261 696c 696e 6742 7265 616b 7328  pTrailingBreaks(
+0002bfc0: 2462 6f64 7929 202e 2073 656c 663a 3a43  $body) . self::C
+0002bfd0: 524c 463b 0a20 2020 207d 0a0a 2020 2020  RLF;.    }..    
+0002bfe0: 2f2a 2a0a 2020 2020 202a 2043 7265 6174  /**.     * Creat
+0002bff0: 6520 7468 6520 444b 494d 2068 6561 6465  e the DKIM heade
+0002c000: 7220 616e 6420 626f 6479 2069 6e20 6120  r and body in a 
+0002c010: 6e65 7720 6d65 7373 6167 6520 6865 6164  new message head
+0002c020: 6572 2e0a 2020 2020 202a 0a20 2020 2020  er..     *.     
+0002c030: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+0002c040: 2468 6561 6465 7273 5f6c 696e 6520 4865  $headers_line He
+0002c050: 6164 6572 206c 696e 6573 0a20 2020 2020  ader lines.     
+0002c060: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+0002c070: 2473 7562 6a65 6374 2020 2020 2020 5375  $subject      Su
+0002c080: 626a 6563 740a 2020 2020 202a 2040 7061  bject.     * @pa
+0002c090: 7261 6d20 7374 7269 6e67 2024 626f 6479  ram string $body
+0002c0a0: 2020 2020 2020 2020 2042 6f64 790a 2020           Body.  
+0002c0b0: 2020 202a 0a20 2020 2020 2a20 4074 6872     *.     * @thr
+0002c0c0: 6f77 7320 4578 6365 7074 696f 6e0a 2020  ows Exception.  
+0002c0d0: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
+0002c0e0: 7572 6e20 7374 7269 6e67 0a20 2020 2020  urn string.     
+0002c0f0: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+0002c100: 6e63 7469 6f6e 2044 4b49 4d5f 4164 6428  nction DKIM_Add(
+0002c110: 2468 6561 6465 7273 5f6c 696e 652c 2024  $headers_line, $
+0002c120: 7375 626a 6563 742c 2024 626f 6479 290a  subject, $body).
+0002c130: 2020 2020 7b0a 2020 2020 2020 2020 2444      {.        $D
+0002c140: 4b49 4d73 6967 6e61 7475 7265 5479 7065  KIMsignatureType
+0002c150: 203d 2027 7273 612d 7368 6132 3536 273b   = 'rsa-sha256';
+0002c160: 202f 2f53 6967 6e61 7475 7265 2026 2068   //Signature & h
+0002c170: 6173 6820 616c 676f 7269 7468 6d73 0a20  ash algorithms. 
+0002c180: 2020 2020 2020 2024 444b 494d 6361 6e6f         $DKIMcano
+0002c190: 6e69 6361 6c69 7a61 7469 6f6e 203d 2027  nicalization = '
+0002c1a0: 7265 6c61 7865 642f 7369 6d70 6c65 273b  relaxed/simple';
+0002c1b0: 202f 2f43 616e 6f6e 6963 616c 697a 6174   //Canonicalizat
+0002c1c0: 696f 6e20 6d65 7468 6f64 7320 6f66 2068  ion methods of h
+0002c1d0: 6561 6465 7220 2620 626f 6479 0a20 2020  eader & body.   
+0002c1e0: 2020 2020 2024 444b 494d 7175 6572 7920       $DKIMquery 
+0002c1f0: 3d20 2764 6e73 2f74 7874 273b 202f 2f51  = 'dns/txt'; //Q
+0002c200: 7565 7279 206d 6574 686f 640a 2020 2020  uery method.    
+0002c210: 2020 2020 2444 4b49 4d74 696d 6520 3d20      $DKIMtime = 
+0002c220: 7469 6d65 2829 3b0a 2020 2020 2020 2020  time();.        
+0002c230: 2f2f 416c 7761 7973 2073 6967 6e20 7468  //Always sign th
+0002c240: 6573 6520 6865 6164 6572 7320 7769 7468  ese headers with
+0002c250: 6f75 7420 6265 696e 6720 6173 6b65 640a  out being asked.
+0002c260: 2020 2020 2020 2020 2f2f 5265 636f 6d6d          //Recomm
+0002c270: 656e 6465 6420 6c69 7374 2066 726f 6d20  ended list from 
+0002c280: 6874 7470 733a 2f2f 746f 6f6c 732e 6965  https://tools.ie
+0002c290: 7466 2e6f 7267 2f68 746d 6c2f 7266 6336  tf.org/html/rfc6
+0002c2a0: 3337 3623 7365 6374 696f 6e2d 352e 342e  376#section-5.4.
+0002c2b0: 310a 2020 2020 2020 2020 2461 7574 6f53  1.        $autoS
+0002c2c0: 6967 6e48 6561 6465 7273 203d 205b 0a20  ignHeaders = [. 
+0002c2d0: 2020 2020 2020 2020 2020 2027 6672 6f6d             'from
+0002c2e0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+0002c2f0: 746f 272c 0a20 2020 2020 2020 2020 2020  to',.           
+0002c300: 2027 6363 272c 0a20 2020 2020 2020 2020   'cc',.         
+0002c310: 2020 2027 6461 7465 272c 0a20 2020 2020     'date',.     
+0002c320: 2020 2020 2020 2027 7375 626a 6563 7427         'subject'
+0002c330: 2c0a 2020 2020 2020 2020 2020 2020 2772  ,.            'r
+0002c340: 6570 6c79 2d74 6f27 2c0a 2020 2020 2020  eply-to',.      
+0002c350: 2020 2020 2020 276d 6573 7361 6765 2d69        'message-i
+0002c360: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
+0002c370: 2763 6f6e 7465 6e74 2d74 7970 6527 2c0a  'content-type',.
+0002c380: 2020 2020 2020 2020 2020 2020 276d 696d              'mim
+0002c390: 652d 7665 7273 696f 6e27 2c0a 2020 2020  e-version',.    
+0002c3a0: 2020 2020 2020 2020 2778 2d6d 6169 6c65          'x-maile
+0002c3b0: 7227 2c0a 2020 2020 2020 2020 5d3b 0a20  r',.        ];. 
+0002c3c0: 2020 2020 2020 2069 6620 2873 7472 6970         if (strip
+0002c3d0: 6f73 2824 6865 6164 6572 735f 6c69 6e65  os($headers_line
+0002c3e0: 2c20 2753 7562 6a65 6374 2729 203d 3d3d  , 'Subject') ===
+0002c3f0: 2066 616c 7365 2920 7b0a 2020 2020 2020   false) {.      
+0002c400: 2020 2020 2020 2468 6561 6465 7273 5f6c        $headers_l
+0002c410: 696e 6520 2e3d 2027 5375 626a 6563 743a  ine .= 'Subject:
+0002c420: 2027 202e 2024 7375 626a 6563 7420 2e20   ' . $subject . 
+0002c430: 7374 6174 6963 3a3a 244c 453b 0a20 2020  static::$LE;.   
+0002c440: 2020 2020 207d 0a20 2020 2020 2020 2024       }.        $
+0002c450: 6865 6164 6572 4c69 6e65 7320 3d20 6578  headerLines = ex
+0002c460: 706c 6f64 6528 7374 6174 6963 3a3a 244c  plode(static::$L
+0002c470: 452c 2024 6865 6164 6572 735f 6c69 6e65  E, $headers_line
+0002c480: 293b 0a20 2020 2020 2020 2024 6375 7272  );.        $curr
+0002c490: 656e 7448 6561 6465 724c 6162 656c 203d  entHeaderLabel =
+0002c4a0: 2027 273b 0a20 2020 2020 2020 2024 6375   '';.        $cu
+0002c4b0: 7272 656e 7448 6561 6465 7256 616c 7565  rrentHeaderValue
+0002c4c0: 203d 2027 273b 0a20 2020 2020 2020 2024   = '';.        $
+0002c4d0: 7061 7273 6564 4865 6164 6572 7320 3d20  parsedHeaders = 
+0002c4e0: 5b5d 3b0a 2020 2020 2020 2020 2468 6561  [];.        $hea
+0002c4f0: 6465 724c 696e 6549 6e64 6578 203d 2030  derLineIndex = 0
+0002c500: 3b0a 2020 2020 2020 2020 2468 6561 6465  ;.        $heade
+0002c510: 724c 696e 6543 6f75 6e74 203d 2063 6f75  rLineCount = cou
+0002c520: 6e74 2824 6865 6164 6572 4c69 6e65 7329  nt($headerLines)
+0002c530: 3b0a 2020 2020 2020 2020 666f 7265 6163  ;.        foreac
+0002c540: 6820 2824 6865 6164 6572 4c69 6e65 7320  h ($headerLines 
+0002c550: 6173 2024 6865 6164 6572 4c69 6e65 2920  as $headerLine) 
+0002c560: 7b0a 2020 2020 2020 2020 2020 2020 246d  {.            $m
+0002c570: 6174 6368 6573 203d 205b 5d3b 0a20 2020  atches = [];.   
+0002c580: 2020 2020 2020 2020 2069 6620 2870 7265           if (pre
+0002c590: 675f 6d61 7463 6828 272f 5e28 5b5e 205c  g_match('/^([^ \
+0002c5a0: 745d 2a3f 2928 3f3a 3a5b 205c 745d 2a29  t]*?)(?::[ \t]*)
+0002c5b0: 282e 2a29 242f 272c 2024 6865 6164 6572  (.*)$/', $header
+0002c5c0: 4c69 6e65 2c20 246d 6174 6368 6573 2929  Line, $matches))
+0002c5d0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0002c5e0: 2020 2069 6620 2824 6375 7272 656e 7448     if ($currentH
+0002c5f0: 6561 6465 724c 6162 656c 2021 3d3d 2027  eaderLabel !== '
+0002c600: 2729 207b 0a20 2020 2020 2020 2020 2020  ') {.           
+0002c610: 2020 2020 2020 2020 202f 2f57 6520 7765           //We we
+0002c620: 7265 2070 7265 7669 6f75 736c 7920 696e  re previously in
+0002c630: 2061 6e6f 7468 6572 2068 6561 6465 723b   another header;
+0002c640: 2054 6869 7320 6973 2074 6865 2073 7461   This is the sta
+0002c650: 7274 206f 6620 6120 6e65 7720 6865 6164  rt of a new head
+0002c660: 6572 2c20 736f 2073 6176 6520 7468 6520  er, so save the 
+0002c670: 7072 6576 696f 7573 206f 6e65 0a20 2020  previous one.   
+0002c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c690: 2024 7061 7273 6564 4865 6164 6572 735b   $parsedHeaders[
+0002c6a0: 5d20 3d20 5b27 6c61 6265 6c27 203d 3e20  ] = ['label' => 
+0002c6b0: 2463 7572 7265 6e74 4865 6164 6572 4c61  $currentHeaderLa
+0002c6c0: 6265 6c2c 2027 7661 6c75 6527 203d 3e20  bel, 'value' => 
+0002c6d0: 2463 7572 7265 6e74 4865 6164 6572 5661  $currentHeaderVa
+0002c6e0: 6c75 655d 3b0a 2020 2020 2020 2020 2020  lue];.          
+0002c6f0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0002c700: 2020 2020 2020 2020 2463 7572 7265 6e74          $current
+0002c710: 4865 6164 6572 4c61 6265 6c20 3d20 246d  HeaderLabel = $m
+0002c720: 6174 6368 6573 5b31 5d3b 0a20 2020 2020  atches[1];.     
+0002c730: 2020 2020 2020 2020 2020 2024 6375 7272             $curr
+0002c740: 656e 7448 6561 6465 7256 616c 7565 203d  entHeaderValue =
+0002c750: 2024 6d61 7463 6865 735b 325d 3b0a 2020   $matches[2];.  
+0002c760: 2020 2020 2020 2020 2020 7d20 656c 7365            } else
+0002c770: 6966 2028 7072 6567 5f6d 6174 6368 2827  if (preg_match('
+0002c780: 2f5e 5b20 5c74 5d2b 282e 2a29 242f 272c  /^[ \t]+(.*)$/',
+0002c790: 2024 6865 6164 6572 4c69 6e65 2c20 246d   $headerLine, $m
+0002c7a0: 6174 6368 6573 2929 207b 0a20 2020 2020  atches)) {.     
+0002c7b0: 2020 2020 2020 2020 2020 202f 2f54 6869             //Thi
+0002c7c0: 7320 6973 2061 2066 6f6c 6465 6420 636f  s is a folded co
+0002c7d0: 6e74 696e 7561 7469 6f6e 206f 6620 7468  ntinuation of th
+0002c7e0: 6520 6375 7272 656e 7420 6865 6164 6572  e current header
+0002c7f0: 2c20 736f 2075 6e66 6f6c 6420 6974 0a20  , so unfold it. 
+0002c800: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+0002c810: 6375 7272 656e 7448 6561 6465 7256 616c  currentHeaderVal
+0002c820: 7565 202e 3d20 2720 2720 2e20 246d 6174  ue .= ' ' . $mat
+0002c830: 6368 6573 5b31 5d3b 0a20 2020 2020 2020  ches[1];.       
+0002c840: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0002c850: 2020 202b 2b24 6865 6164 6572 4c69 6e65     ++$headerLine
+0002c860: 496e 6465 783b 0a20 2020 2020 2020 2020  Index;.         
+0002c870: 2020 2069 6620 2824 6865 6164 6572 4c69     if ($headerLi
+0002c880: 6e65 496e 6465 7820 3e3d 2024 6865 6164  neIndex >= $head
+0002c890: 6572 4c69 6e65 436f 756e 7429 207b 0a20  erLineCount) {. 
+0002c8a0: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+0002c8b0: 2f54 6869 7320 7761 7320 7468 6520 6c61  /This was the la
+0002c8c0: 7374 206c 696e 652c 2073 6f20 6669 6e69  st line, so fini
+0002c8d0: 7368 206f 6666 2074 6869 7320 6865 6164  sh off this head
+0002c8e0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0002c8f0: 2020 2024 7061 7273 6564 4865 6164 6572     $parsedHeader
+0002c900: 735b 5d20 3d20 5b27 6c61 6265 6c27 203d  s[] = ['label' =
+0002c910: 3e20 2463 7572 7265 6e74 4865 6164 6572  > $currentHeader
+0002c920: 4c61 6265 6c2c 2027 7661 6c75 6527 203d  Label, 'value' =
+0002c930: 3e20 2463 7572 7265 6e74 4865 6164 6572  > $currentHeader
+0002c940: 5661 6c75 655d 3b0a 2020 2020 2020 2020  Value];.        
+0002c950: 2020 2020 7d0a 2020 2020 2020 2020 7d0a      }.        }.
+0002c960: 2020 2020 2020 2020 2463 6f70 6965 6448          $copiedH
+0002c970: 6561 6465 7273 203d 205b 5d3b 0a20 2020  eaders = [];.   
+0002c980: 2020 2020 2024 6865 6164 6572 7354 6f53       $headersToS
+0002c990: 6967 6e4b 6579 7320 3d20 5b5d 3b0a 2020  ignKeys = [];.  
+0002c9a0: 2020 2020 2020 2468 6561 6465 7273 546f        $headersTo
+0002c9b0: 5369 676e 203d 205b 5d3b 0a20 2020 2020  Sign = [];.     
+0002c9c0: 2020 2066 6f72 6561 6368 2028 2470 6172     foreach ($par
+0002c9d0: 7365 6448 6561 6465 7273 2061 7320 2468  sedHeaders as $h
+0002c9e0: 6561 6465 7229 207b 0a20 2020 2020 2020  eader) {.       
+0002c9f0: 2020 2020 202f 2f49 7320 7468 6973 2068       //Is this h
+0002ca00: 6561 6465 7220 6f6e 6520 7468 6174 206d  eader one that m
+0002ca10: 7573 7420 6265 2069 6e63 6c75 6465 6420  ust be included 
+0002ca20: 696e 2074 6865 2044 4b49 4d20 7369 676e  in the DKIM sign
+0002ca30: 6174 7572 653f 0a20 2020 2020 2020 2020  ature?.         
+0002ca40: 2020 2069 6620 2869 6e5f 6172 7261 7928     if (in_array(
+0002ca50: 7374 7274 6f6c 6f77 6572 2824 6865 6164  strtolower($head
+0002ca60: 6572 5b27 6c61 6265 6c27 5d29 2c20 2461  er['label']), $a
+0002ca70: 7574 6f53 6967 6e48 6561 6465 7273 2c20  utoSignHeaders, 
+0002ca80: 7472 7565 2929 207b 0a20 2020 2020 2020  true)) {.       
+0002ca90: 2020 2020 2020 2020 2024 6865 6164 6572           $header
+0002caa0: 7354 6f53 6967 6e4b 6579 735b 5d20 3d20  sToSignKeys[] = 
+0002cab0: 2468 6561 6465 725b 276c 6162 656c 275d  $header['label']
+0002cac0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+0002cad0: 2020 2468 6561 6465 7273 546f 5369 676e    $headersToSign
+0002cae0: 5b5d 203d 2024 6865 6164 6572 5b27 6c61  [] = $header['la
+0002caf0: 6265 6c27 5d20 2e20 273a 2027 202e 2024  bel'] . ': ' . $
+0002cb00: 6865 6164 6572 5b27 7661 6c75 6527 5d3b  header['value'];
+0002cb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cb20: 2069 6620 2824 7468 6973 2d3e 444b 494d   if ($this->DKIM
+0002cb30: 5f63 6f70 7948 6561 6465 7246 6965 6c64  _copyHeaderField
+0002cb40: 7329 207b 0a20 2020 2020 2020 2020 2020  s) {.           
+0002cb50: 2020 2020 2020 2020 2024 636f 7069 6564           $copied
+0002cb60: 4865 6164 6572 735b 5d20 3d20 2468 6561  Headers[] = $hea
+0002cb70: 6465 725b 276c 6162 656c 275d 202e 2027  der['label'] . '
+0002cb80: 3a27 202e 202f 2f4e 6f74 6520 6e6f 2073  :' . //Note no s
+0002cb90: 7061 6365 2061 6674 6572 2074 6869 732c  pace after this,
+0002cba0: 2061 7320 7065 7220 5246 430a 2020 2020   as per RFC.    
+0002cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cbc0: 2020 2020 7374 725f 7265 706c 6163 6528      str_replace(
+0002cbd0: 277c 272c 2027 3d37 4327 2c20 2474 6869  '|', '=7C', $thi
+0002cbe0: 732d 3e44 4b49 4d5f 5150 2824 6865 6164  s->DKIM_QP($head
+0002cbf0: 6572 5b27 7661 6c75 6527 5d29 293b 0a20  er['value']));. 
+0002cc00: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0002cc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cc20: 2063 6f6e 7469 6e75 653b 0a20 2020 2020   continue;.     
+0002cc30: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0002cc40: 2020 2020 202f 2f49 7320 7468 6973 2061       //Is this a
+0002cc50: 6e20 6578 7472 6120 6375 7374 6f6d 2068  n extra custom h
+0002cc60: 6561 6465 7220 7765 2776 6520 6265 656e  eader we've been
+0002cc70: 2061 736b 6564 2074 6f20 7369 676e 3f0a   asked to sign?.
+0002cc80: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0002cc90: 696e 5f61 7272 6179 2824 6865 6164 6572  in_array($header
+0002cca0: 5b27 6c61 6265 6c27 5d2c 2024 7468 6973  ['label'], $this
+0002ccb0: 2d3e 444b 494d 5f65 7874 7261 4865 6164  ->DKIM_extraHead
+0002ccc0: 6572 732c 2074 7275 6529 2920 7b0a 2020  ers, true)) {.  
+0002ccd0: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
+0002cce0: 4669 6e64 2069 7473 2076 616c 7565 2069  Find its value i
+0002ccf0: 6e20 6375 7374 6f6d 2068 6561 6465 7273  n custom headers
+0002cd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cd10: 2066 6f72 6561 6368 2028 2474 6869 732d   foreach ($this-
+0002cd20: 3e43 7573 746f 6d48 6561 6465 7220 6173  >CustomHeader as
+0002cd30: 2024 6375 7374 6f6d 4865 6164 6572 2920   $customHeader) 
+0002cd40: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0002cd50: 2020 2020 2020 6966 2028 2463 7573 746f        if ($custo
+0002cd60: 6d48 6561 6465 725b 305d 203d 3d3d 2024  mHeader[0] === $
+0002cd70: 6865 6164 6572 5b27 6c61 6265 6c27 5d29  header['label'])
+0002cd80: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0002cd90: 2020 2020 2020 2020 2020 2024 6865 6164             $head
+0002cda0: 6572 7354 6f53 6967 6e4b 6579 735b 5d20  ersToSignKeys[] 
+0002cdb0: 3d20 2468 6561 6465 725b 276c 6162 656c  = $header['label
+0002cdc0: 275d 3b0a 2020 2020 2020 2020 2020 2020  '];.            
+0002cdd0: 2020 2020 2020 2020 2020 2020 2468 6561              $hea
+0002cde0: 6465 7273 546f 5369 676e 5b5d 203d 2024  dersToSign[] = $
+0002cdf0: 6865 6164 6572 5b27 6c61 6265 6c27 5d20  header['label'] 
+0002ce00: 2e20 273a 2027 202e 2024 6865 6164 6572  . ': ' . $header
+0002ce10: 5b27 7661 6c75 6527 5d3b 0a20 2020 2020  ['value'];.     
+0002ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce30: 2020 2069 6620 2824 7468 6973 2d3e 444b     if ($this->DK
+0002ce40: 494d 5f63 6f70 7948 6561 6465 7246 6965  IM_copyHeaderFie
+0002ce50: 6c64 7329 207b 0a20 2020 2020 2020 2020  lds) {.         
+0002ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce70: 2020 2024 636f 7069 6564 4865 6164 6572     $copiedHeader
+0002ce80: 735b 5d20 3d20 2468 6561 6465 725b 276c  s[] = $header['l
+0002ce90: 6162 656c 275d 202e 2027 3a27 202e 202f  abel'] . ':' . /
+0002cea0: 2f4e 6f74 6520 6e6f 2073 7061 6365 2061  /Note no space a
+0002ceb0: 6674 6572 2074 6869 732c 2061 7320 7065  fter this, as pe
+0002cec0: 7220 5246 430a 2020 2020 2020 2020 2020  r RFC.          
+0002ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cee0: 2020 2020 2020 7374 725f 7265 706c 6163        str_replac
+0002cef0: 6528 277c 272c 2027 3d37 4327 2c20 2474  e('|', '=7C', $t
+0002cf00: 6869 732d 3e44 4b49 4d5f 5150 2824 6865  his->DKIM_QP($he
+0002cf10: 6164 6572 5b27 7661 6c75 6527 5d29 293b  ader['value']));
+0002cf20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cf30: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+0002cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf50: 2020 202f 2f53 6b69 7020 7374 7261 6967     //Skip straig
+0002cf60: 6874 2074 6f20 7468 6520 6e65 7874 2068  ht to the next h
+0002cf70: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
+0002cf80: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0002cf90: 6e74 696e 7565 2032 3b0a 2020 2020 2020  ntinue 2;.      
+0002cfa0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+0002cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cfc0: 7d0a 2020 2020 2020 2020 2020 2020 7d0a  }.            }.
+0002cfd0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0002cfe0: 2020 2463 6f70 6965 6448 6561 6465 7246    $copiedHeaderF
+0002cff0: 6965 6c64 7320 3d20 2727 3b0a 2020 2020  ields = '';.    
+0002d000: 2020 2020 6966 2028 2474 6869 732d 3e44      if ($this->D
+0002d010: 4b49 4d5f 636f 7079 4865 6164 6572 4669  KIM_copyHeaderFi
+0002d020: 656c 6473 2026 2620 636f 756e 7428 2463  elds && count($c
+0002d030: 6f70 6965 6448 6561 6465 7273 2920 3e20  opiedHeaders) > 
+0002d040: 3029 207b 0a20 2020 2020 2020 2020 2020  0) {.           
+0002d050: 202f 2f41 7373 656d 626c 6520 6120 444b   //Assemble a DK
+0002d060: 494d 2027 7a27 2074 6167 0a20 2020 2020  IM 'z' tag.     
+0002d070: 2020 2020 2020 2024 636f 7069 6564 4865         $copiedHe
+0002d080: 6164 6572 4669 656c 6473 203d 2027 207a  aderFields = ' z
+0002d090: 3d27 3b0a 2020 2020 2020 2020 2020 2020  =';.            
+0002d0a0: 2466 6972 7374 203d 2074 7275 653b 0a20  $first = true;. 
+0002d0b0: 2020 2020 2020 2020 2020 2066 6f72 6561             forea
+0002d0c0: 6368 2028 2463 6f70 6965 6448 6561 6465  ch ($copiedHeade
+0002d0d0: 7273 2061 7320 2463 6f70 6965 6448 6561  rs as $copiedHea
+0002d0e0: 6465 7229 207b 0a20 2020 2020 2020 2020  der) {.         
+0002d0f0: 2020 2020 2020 2069 6620 2821 2466 6972         if (!$fir
+0002d100: 7374 2920 7b0a 2020 2020 2020 2020 2020  st) {.          
+0002d110: 2020 2020 2020 2020 2020 2463 6f70 6965            $copie
+0002d120: 6448 6561 6465 7246 6965 6c64 7320 2e3d  dHeaderFields .=
+0002d130: 2073 7461 7469 633a 3a24 4c45 202e 2027   static::$LE . '
+0002d140: 207c 273b 0a20 2020 2020 2020 2020 2020   |';.           
+0002d150: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0002d160: 2020 2020 2020 202f 2f46 6f6c 6420 6c6f         //Fold lo
+0002d170: 6e67 2076 616c 7565 730a 2020 2020 2020  ng values.      
+0002d180: 2020 2020 2020 2020 2020 6966 2028 7374            if (st
+0002d190: 726c 656e 2824 636f 7069 6564 4865 6164  rlen($copiedHead
+0002d1a0: 6572 2920 3e20 7365 6c66 3a3a 5354 445f  er) > self::STD_
+0002d1b0: 4c49 4e45 5f4c 454e 4754 4820 2d20 3329  LINE_LENGTH - 3)
+0002d1c0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0002d1d0: 2020 2020 2020 2024 636f 7069 6564 4865         $copiedHe
+0002d1e0: 6164 6572 4669 656c 6473 202e 3d20 7375  aderFields .= su
+0002d1f0: 6273 7472 280a 2020 2020 2020 2020 2020  bstr(.          
+0002d200: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0002d210: 756e 6b5f 7370 6c69 7428 2463 6f70 6965  unk_split($copie
+0002d220: 6448 6561 6465 722c 2073 656c 663a 3a53  dHeader, self::S
+0002d230: 5444 5f4c 494e 455f 4c45 4e47 5448 202d  TD_LINE_LENGTH -
+0002d240: 2033 2c20 7374 6174 6963 3a3a 244c 4520   3, static::$LE 
+0002d250: 2e20 7365 6c66 3a3a 4657 5329 2c0a 2020  . self::FWS),.  
+0002d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d270: 2020 2020 2020 302c 0a20 2020 2020 2020        0,.       
+0002d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d290: 202d 7374 726c 656e 2873 7461 7469 633a   -strlen(static:
+0002d2a0: 3a24 4c45 202e 2073 656c 663a 3a46 5753  :$LE . self::FWS
+0002d2b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002d2c0: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
+0002d2d0: 2020 2020 2020 2020 207d 2065 6c73 6520           } else 
+0002d2e0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0002d2f0: 2020 2020 2020 2463 6f70 6965 6448 6561        $copiedHea
+0002d300: 6465 7246 6965 6c64 7320 2e3d 2024 636f  derFields .= $co
+0002d310: 7069 6564 4865 6164 6572 3b0a 2020 2020  piedHeader;.    
+0002d320: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+0002d330: 2020 2020 2020 2020 2020 2020 2020 2466                $f
+0002d340: 6972 7374 203d 2066 616c 7365 3b0a 2020  irst = false;.  
+0002d350: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+0002d360: 2020 2020 2020 2020 2463 6f70 6965 6448          $copiedH
+0002d370: 6561 6465 7246 6965 6c64 7320 2e3d 2027  eaderFields .= '
+0002d380: 3b27 202e 2073 7461 7469 633a 3a24 4c45  ;' . static::$LE
+0002d390: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+0002d3a0: 2020 2020 2468 6561 6465 724b 6579 7320      $headerKeys 
+0002d3b0: 3d20 2720 683d 2720 2e20 696d 706c 6f64  = ' h=' . implod
+0002d3c0: 6528 273a 272c 2024 6865 6164 6572 7354  e(':', $headersT
+0002d3d0: 6f53 6967 6e4b 6579 7329 202e 2027 3b27  oSignKeys) . ';'
+0002d3e0: 202e 2073 7461 7469 633a 3a24 4c45 3b0a   . static::$LE;.
+0002d3f0: 2020 2020 2020 2020 2468 6561 6465 7256          $headerV
+0002d400: 616c 7565 7320 3d20 696d 706c 6f64 6528  alues = implode(
+0002d410: 7374 6174 6963 3a3a 244c 452c 2024 6865  static::$LE, $he
+0002d420: 6164 6572 7354 6f53 6967 6e29 3b0a 2020  adersToSign);.  
+0002d430: 2020 2020 2020 2462 6f64 7920 3d20 2474        $body = $t
+0002d440: 6869 732d 3e44 4b49 4d5f 426f 6479 4328  his->DKIM_BodyC(
+0002d450: 2462 6f64 7929 3b0a 2020 2020 2020 2020  $body);.        
+0002d460: 2f2f 4261 7365 3634 206f 6620 7061 636b  //Base64 of pack
+0002d470: 6564 2062 696e 6172 7920 5348 412d 3235  ed binary SHA-25
+0002d480: 3620 6861 7368 206f 6620 626f 6479 0a20  6 hash of body. 
+0002d490: 2020 2020 2020 2024 444b 494d 6236 3420         $DKIMb64 
+0002d4a0: 3d20 6261 7365 3634 5f65 6e63 6f64 6528  = base64_encode(
+0002d4b0: 7061 636b 2827 482a 272c 2068 6173 6828  pack('H*', hash(
+0002d4c0: 2773 6861 3235 3627 2c20 2462 6f64 7929  'sha256', $body)
+0002d4d0: 2929 3b0a 2020 2020 2020 2020 2469 6465  ));.        $ide
+0002d4e0: 6e74 203d 2027 273b 0a20 2020 2020 2020  nt = '';.       
+0002d4f0: 2069 6620 2827 2720 213d 3d20 2474 6869   if ('' !== $thi
+0002d500: 732d 3e44 4b49 4d5f 6964 656e 7469 7479  s->DKIM_identity
+0002d510: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+0002d520: 2469 6465 6e74 203d 2027 2069 3d27 202e  $ident = ' i=' .
+0002d530: 2024 7468 6973 2d3e 444b 494d 5f69 6465   $this->DKIM_ide
+0002d540: 6e74 6974 7920 2e20 273b 2720 2e20 7374  ntity . ';' . st
+0002d550: 6174 6963 3a3a 244c 453b 0a20 2020 2020  atic::$LE;.     
+0002d560: 2020 207d 0a20 2020 2020 2020 202f 2f54     }.        //T
+0002d570: 6865 2044 4b49 4d2d 5369 676e 6174 7572  he DKIM-Signatur
+0002d580: 6520 6865 6164 6572 2069 7320 696e 636c  e header is incl
+0002d590: 7564 6564 2069 6e20 7468 6520 7369 676e  uded in the sign
+0002d5a0: 6174 7572 6520 2a65 7863 6570 7420 666f  ature *except fo
+0002d5b0: 722a 2074 6865 2076 616c 7565 206f 6620  r* the value of 
+0002d5c0: 7468 6520 6062 6020 7461 670a 2020 2020  the `b` tag.    
+0002d5d0: 2020 2020 2f2f 7768 6963 6820 6973 2061      //which is a
+0002d5e0: 7070 656e 6465 6420 6166 7465 7220 6361  ppended after ca
+0002d5f0: 6c63 756c 6174 696e 6720 7468 6520 7369  lculating the si
+0002d600: 676e 6174 7572 650a 2020 2020 2020 2020  gnature.        
+0002d610: 2f2f 6874 7470 733a 2f2f 746f 6f6c 732e  //https://tools.
+0002d620: 6965 7466 2e6f 7267 2f68 746d 6c2f 7266  ietf.org/html/rf
+0002d630: 6336 3337 3623 7365 6374 696f 6e2d 332e  c6376#section-3.
+0002d640: 350a 2020 2020 2020 2020 2464 6b69 6d53  5.        $dkimS
+0002d650: 6967 6e61 7475 7265 4865 6164 6572 203d  ignatureHeader =
+0002d660: 2027 444b 494d 2d53 6967 6e61 7475 7265   'DKIM-Signature
+0002d670: 3a20 763d 313b 2720 2e0a 2020 2020 2020  : v=1;' ..      
+0002d680: 2020 2020 2020 2720 643d 2720 2e20 2474        ' d=' . $t
+0002d690: 6869 732d 3e44 4b49 4d5f 646f 6d61 696e  his->DKIM_domain
+0002d6a0: 202e 2027 3b27 202e 0a20 2020 2020 2020   . ';' ..       
+0002d6b0: 2020 2020 2027 2073 3d27 202e 2024 7468       ' s=' . $th
+0002d6c0: 6973 2d3e 444b 494d 5f73 656c 6563 746f  is->DKIM_selecto
+0002d6d0: 7220 2e20 273b 2720 2e20 7374 6174 6963  r . ';' . static
+0002d6e0: 3a3a 244c 4520 2e0a 2020 2020 2020 2020  ::$LE ..        
+0002d6f0: 2020 2020 2720 613d 2720 2e20 2444 4b49      ' a=' . $DKI
+0002d700: 4d73 6967 6e61 7475 7265 5479 7065 202e  MsignatureType .
+0002d710: 2027 3b27 202e 0a20 2020 2020 2020 2020   ';' ..         
+0002d720: 2020 2027 2071 3d27 202e 2024 444b 494d     ' q=' . $DKIM
+0002d730: 7175 6572 7920 2e20 273b 2720 2e0a 2020  query . ';' ..  
+0002d740: 2020 2020 2020 2020 2020 2720 743d 2720            ' t=' 
+0002d750: 2e20 2444 4b49 4d74 696d 6520 2e20 273b  . $DKIMtime . ';
+0002d760: 2720 2e0a 2020 2020 2020 2020 2020 2020  ' ..            
+0002d770: 2720 633d 2720 2e20 2444 4b49 4d63 616e  ' c=' . $DKIMcan
+0002d780: 6f6e 6963 616c 697a 6174 696f 6e20 2e20  onicalization . 
+0002d790: 273b 2720 2e20 7374 6174 6963 3a3a 244c  ';' . static::$L
+0002d7a0: 4520 2e0a 2020 2020 2020 2020 2020 2020  E ..            
+0002d7b0: 2468 6561 6465 724b 6579 7320 2e0a 2020  $headerKeys ..  
+0002d7c0: 2020 2020 2020 2020 2020 2469 6465 6e74            $ident
+0002d7d0: 202e 0a20 2020 2020 2020 2020 2020 2024   ..            $
+0002d7e0: 636f 7069 6564 4865 6164 6572 4669 656c  copiedHeaderFiel
+0002d7f0: 6473 202e 0a20 2020 2020 2020 2020 2020  ds ..           
+0002d800: 2027 2062 683d 2720 2e20 2444 4b49 4d62   ' bh=' . $DKIMb
+0002d810: 3634 202e 2027 3b27 202e 2073 7461 7469  64 . ';' . stati
+0002d820: 633a 3a24 4c45 202e 0a20 2020 2020 2020  c::$LE ..       
+0002d830: 2020 2020 2027 2062 3d27 3b0a 2020 2020       ' b=';.    
+0002d840: 2020 2020 2f2f 4361 6e6f 6e69 6361 6c69      //Canonicali
+0002d850: 7a65 2074 6865 2073 6574 206f 6620 6865  ze the set of he
+0002d860: 6164 6572 730a 2020 2020 2020 2020 2463  aders.        $c
+0002d870: 616e 6f6e 6963 616c 697a 6564 4865 6164  anonicalizedHead
+0002d880: 6572 7320 3d20 2474 6869 732d 3e44 4b49  ers = $this->DKI
+0002d890: 4d5f 4865 6164 6572 4328 0a20 2020 2020  M_HeaderC(.     
+0002d8a0: 2020 2020 2020 2024 6865 6164 6572 5661         $headerVa
+0002d8b0: 6c75 6573 202e 2073 7461 7469 633a 3a24  lues . static::$
+0002d8c0: 4c45 202e 2024 646b 696d 5369 676e 6174  LE . $dkimSignat
+0002d8d0: 7572 6548 6561 6465 720a 2020 2020 2020  ureHeader.      
+0002d8e0: 2020 293b 0a20 2020 2020 2020 2024 7369    );.        $si
+0002d8f0: 676e 6174 7572 6520 3d20 2474 6869 732d  gnature = $this-
+0002d900: 3e44 4b49 4d5f 5369 676e 2824 6361 6e6f  >DKIM_Sign($cano
+0002d910: 6e69 6361 6c69 7a65 6448 6561 6465 7273  nicalizedHeaders
+0002d920: 293b 0a20 2020 2020 2020 2024 7369 676e  );.        $sign
+0002d930: 6174 7572 6520 3d20 7472 696d 2863 6875  ature = trim(chu
+0002d940: 6e6b 5f73 706c 6974 2824 7369 676e 6174  nk_split($signat
+0002d950: 7572 652c 2073 656c 663a 3a53 5444 5f4c  ure, self::STD_L
+0002d960: 494e 455f 4c45 4e47 5448 202d 2033 2c20  INE_LENGTH - 3, 
+0002d970: 7374 6174 6963 3a3a 244c 4520 2e20 7365  static::$LE . se
+0002d980: 6c66 3a3a 4657 5329 293b 0a0a 2020 2020  lf::FWS));..    
+0002d990: 2020 2020 7265 7475 726e 2073 7461 7469      return stati
+0002d9a0: 633a 3a6e 6f72 6d61 6c69 7a65 4272 6561  c::normalizeBrea
+0002d9b0: 6b73 2824 646b 696d 5369 676e 6174 7572  ks($dkimSignatur
+0002d9c0: 6548 6561 6465 7220 2e20 2473 6967 6e61  eHeader . $signa
+0002d9d0: 7475 7265 293b 0a20 2020 207d 0a0a 2020  ture);.    }..  
+0002d9e0: 2020 2f2a 2a0a 2020 2020 202a 2044 6574    /**.     * Det
+0002d9f0: 6563 7420 6966 2061 2073 7472 696e 6720  ect if a string 
+0002da00: 636f 6e74 6169 6e73 2061 206c 696e 6520  contains a line 
+0002da10: 6c6f 6e67 6572 2074 6861 6e20 7468 6520  longer than the 
+0002da20: 6d61 7869 6d75 6d20 6c69 6e65 206c 656e  maximum line len
+0002da30: 6774 680a 2020 2020 202a 2061 6c6c 6f77  gth.     * allow
+0002da40: 6564 2062 7920 5246 4320 3238 3232 2073  ed by RFC 2822 s
+0002da50: 6563 7469 6f6e 2032 2e31 2e31 2e0a 2020  ection 2.1.1..  
+0002da60: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
+0002da70: 616d 2073 7472 696e 6720 2473 7472 0a20  am string $str. 
+0002da80: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
+0002da90: 7475 726e 2062 6f6f 6c0a 2020 2020 202a  turn bool.     *
+0002daa0: 2f0a 2020 2020 7075 626c 6963 2073 7461  /.    public sta
+0002dab0: 7469 6320 6675 6e63 7469 6f6e 2068 6173  tic function has
+0002dac0: 4c69 6e65 4c6f 6e67 6572 5468 616e 4d61  LineLongerThanMa
+0002dad0: 7828 2473 7472 290a 2020 2020 7b0a 2020  x($str).    {.  
+0002dae0: 2020 2020 2020 7265 7475 726e 2028 626f        return (bo
+0002daf0: 6f6c 2920 7072 6567 5f6d 6174 6368 2827  ol) preg_match('
+0002db00: 2f5e 282e 7b27 202e 2028 7365 6c66 3a3a  /^(.{' . (self::
+0002db10: 4d41 585f 4c49 4e45 5f4c 454e 4754 4820  MAX_LINE_LENGTH 
+0002db20: 2b20 7374 726c 656e 2873 7461 7469 633a  + strlen(static:
+0002db30: 3a24 4c45 2929 202e 2027 2c7d 292f 6d27  :$LE)) . ',})/m'
+0002db40: 2c20 2473 7472 293b 0a20 2020 207d 0a0a  , $str);.    }..
+0002db50: 2020 2020 2f2a 2a0a 2020 2020 202a 2049      /**.     * I
+0002db60: 6620 6120 7374 7269 6e67 2063 6f6e 7461  f a string conta
+0002db70: 696e 7320 616e 7920 2273 7065 6369 616c  ins any "special
+0002db80: 2220 6368 6172 6163 7465 7273 2c20 646f  " characters, do
+0002db90: 7562 6c65 2d71 756f 7465 2074 6865 206e  uble-quote the n
+0002dba0: 616d 652c 0a20 2020 2020 2a20 616e 6420  ame,.     * and 
+0002dbb0: 6573 6361 7065 2061 6e79 2064 6f75 626c  escape any doubl
+0002dbc0: 6520 7175 6f74 6573 2077 6974 6820 6120  e quotes with a 
+0002dbd0: 6261 636b 736c 6173 682e 0a20 2020 2020  backslash..     
+0002dbe0: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
+0002dbf0: 7374 7269 6e67 2024 7374 720a 2020 2020  string $str.    
+0002dc00: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+0002dc10: 6e20 7374 7269 6e67 0a20 2020 2020 2a0a  n string.     *.
+0002dc20: 2020 2020 202a 2040 7365 6520 5246 4338       * @see RFC8
+0002dc30: 3232 2033 2e34 2e31 0a20 2020 2020 2a2f  22 3.4.1.     */
+0002dc40: 0a20 2020 2070 7562 6c69 6320 7374 6174  .    public stat
+0002dc50: 6963 2066 756e 6374 696f 6e20 7175 6f74  ic function quot
+0002dc60: 6564 5374 7269 6e67 2824 7374 7229 0a20  edString($str). 
+0002dc70: 2020 207b 0a20 2020 2020 2020 2069 6620     {.        if 
+0002dc80: 2870 7265 675f 6d61 7463 6828 272f 5b20  (preg_match('/[ 
+0002dc90: 2829 3c3e 402c 3b3a 225c 2f5c 5b5c 5d3f  ()<>@,;:"\/\[\]?
+0002dca0: 3d5d 2f27 2c20 2473 7472 2929 207b 0a20  =]/', $str)) {. 
+0002dcb0: 2020 2020 2020 2020 2020 202f 2f49 6620             //If 
+0002dcc0: 7468 6520 7374 7269 6e67 2063 6f6e 7461  the string conta
+0002dcd0: 696e 7320 616e 7920 6f66 2074 6865 7365  ins any of these
+0002dce0: 2063 6861 7273 2c20 6974 206d 7573 7420   chars, it must 
+0002dcf0: 6265 2064 6f75 626c 652d 7175 6f74 6564  be double-quoted
+0002dd00: 0a20 2020 2020 2020 2020 2020 202f 2f61  .            //a
+0002dd10: 6e64 2061 6e79 2064 6f75 626c 6520 7175  nd any double qu
+0002dd20: 6f74 6573 206d 7573 7420 6265 2065 7363  otes must be esc
+0002dd30: 6170 6564 2077 6974 6820 6120 6261 636b  aped with a back
+0002dd40: 736c 6173 680a 2020 2020 2020 2020 2020  slash.          
+0002dd50: 2020 7265 7475 726e 2027 2227 202e 2073    return '"' . s
+0002dd60: 7472 5f72 6570 6c61 6365 2827 2227 2c20  tr_replace('"', 
+0002dd70: 275c 5c22 272c 2024 7374 7229 202e 2027  '\\"', $str) . '
+0002dd80: 2227 3b0a 2020 2020 2020 2020 7d0a 0a20  "';.        }.. 
+0002dd90: 2020 2020 2020 202f 2f52 6574 7572 6e20         //Return 
+0002dda0: 7468 6520 7374 7269 6e67 2075 6e74 6f75  the string untou
+0002ddb0: 6368 6564 2c20 6974 2064 6f65 736e 2774  ched, it doesn't
+0002ddc0: 206e 6565 6420 7175 6f74 696e 670a 2020   need quoting.  
+0002ddd0: 2020 2020 2020 7265 7475 726e 2024 7374        return $st
+0002dde0: 723b 0a20 2020 207d 0a0a 2020 2020 2f2a  r;.    }..    /*
+0002ddf0: 2a0a 2020 2020 202a 2041 6c6c 6f77 7320  *.     * Allows 
+0002de00: 666f 7220 7075 626c 6963 2072 6561 6420  for public read 
+0002de10: 6163 6365 7373 2074 6f20 2774 6f27 2070  access to 'to' p
+0002de20: 726f 7065 7274 792e 0a20 2020 2020 2a20  roperty..     * 
+0002de30: 4265 666f 7265 2074 6865 2073 656e 6428  Before the send(
+0002de40: 2920 6361 6c6c 2c20 7175 6575 6564 2061  ) call, queued a
+0002de50: 6464 7265 7373 6573 2028 692e 652e 2077  ddresses (i.e. w
+0002de60: 6974 6820 4944 4e29 2061 7265 206e 6f74  ith IDN) are not
+0002de70: 2079 6574 2069 6e63 6c75 6465 642e 0a20   yet included.. 
+0002de80: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
+0002de90: 7475 726e 2061 7272 6179 0a20 2020 2020  turn array.     
+0002dea0: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+0002deb0: 6e63 7469 6f6e 2067 6574 546f 4164 6472  nction getToAddr
+0002dec0: 6573 7365 7328 290a 2020 2020 7b0a 2020  esses().    {.  
+0002ded0: 2020 2020 2020 7265 7475 726e 2024 7468        return $th
+0002dee0: 6973 2d3e 746f 3b0a 2020 2020 7d0a 0a20  is->to;.    }.. 
+0002def0: 2020 202f 2a2a 0a20 2020 2020 2a20 416c     /**.     * Al
+0002df00: 6c6f 7773 2066 6f72 2070 7562 6c69 6320  lows for public 
+0002df10: 7265 6164 2061 6363 6573 7320 746f 2027  read access to '
+0002df20: 6363 2720 7072 6f70 6572 7479 2e0a 2020  cc' property..  
+0002df30: 2020 202a 2042 6566 6f72 6520 7468 6520     * Before the 
+0002df40: 7365 6e64 2829 2063 616c 6c2c 2071 7565  send() call, que
+0002df50: 7565 6420 6164 6472 6573 7365 7320 2869  ued addresses (i
+0002df60: 2e65 2e20 7769 7468 2049 444e 2920 6172  .e. with IDN) ar
+0002df70: 6520 6e6f 7420 7965 7420 696e 636c 7564  e not yet includ
+0002df80: 6564 2e0a 2020 2020 202a 0a20 2020 2020  ed..     *.     
+0002df90: 2a20 4072 6574 7572 6e20 6172 7261 790a  * @return array.
+0002dfa0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+0002dfb0: 6963 2066 756e 6374 696f 6e20 6765 7443  ic function getC
+0002dfc0: 6341 6464 7265 7373 6573 2829 0a20 2020  cAddresses().   
+0002dfd0: 207b 0a20 2020 2020 2020 2072 6574 7572   {.        retur
+0002dfe0: 6e20 2474 6869 732d 3e63 633b 0a20 2020  n $this->cc;.   
+0002dff0: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+0002e000: 202a 2041 6c6c 6f77 7320 666f 7220 7075   * Allows for pu
+0002e010: 626c 6963 2072 6561 6420 6163 6365 7373  blic read access
+0002e020: 2074 6f20 2762 6363 2720 7072 6f70 6572   to 'bcc' proper
+0002e030: 7479 2e0a 2020 2020 202a 2042 6566 6f72  ty..     * Befor
+0002e040: 6520 7468 6520 7365 6e64 2829 2063 616c  e the send() cal
+0002e050: 6c2c 2071 7565 7565 6420 6164 6472 6573  l, queued addres
+0002e060: 7365 7320 2869 2e65 2e20 7769 7468 2049  ses (i.e. with I
+0002e070: 444e 2920 6172 6520 6e6f 7420 7965 7420  DN) are not yet 
+0002e080: 696e 636c 7564 6564 2e0a 2020 2020 202a  included..     *
+0002e090: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+0002e0a0: 6172 7261 790a 2020 2020 202a 2f0a 2020  array.     */.  
+0002e0b0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+0002e0c0: 6e20 6765 7442 6363 4164 6472 6573 7365  n getBccAddresse
+0002e0d0: 7328 290a 2020 2020 7b0a 2020 2020 2020  s().    {.      
+0002e0e0: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
+0002e0f0: 6263 633b 0a20 2020 207d 0a0a 2020 2020  bcc;.    }..    
+0002e100: 2f2a 2a0a 2020 2020 202a 2041 6c6c 6f77  /**.     * Allow
+0002e110: 7320 666f 7220 7075 626c 6963 2072 6561  s for public rea
+0002e120: 6420 6163 6365 7373 2074 6f20 2752 6570  d access to 'Rep
+0002e130: 6c79 546f 2720 7072 6f70 6572 7479 2e0a  lyTo' property..
+0002e140: 2020 2020 202a 2042 6566 6f72 6520 7468       * Before th
+0002e150: 6520 7365 6e64 2829 2063 616c 6c2c 2071  e send() call, q
+0002e160: 7565 7565 6420 6164 6472 6573 7365 7320  ueued addresses 
+0002e170: 2869 2e65 2e20 7769 7468 2049 444e 2920  (i.e. with IDN) 
+0002e180: 6172 6520 6e6f 7420 7965 7420 696e 636c  are not yet incl
+0002e190: 7564 6564 2e0a 2020 2020 202a 0a20 2020  uded..     *.   
+0002e1a0: 2020 2a20 4072 6574 7572 6e20 6172 7261    * @return arra
+0002e1b0: 790a 2020 2020 202a 2f0a 2020 2020 7075  y.     */.    pu
+0002e1c0: 626c 6963 2066 756e 6374 696f 6e20 6765  blic function ge
+0002e1d0: 7452 6570 6c79 546f 4164 6472 6573 7365  tReplyToAddresse
+0002e1e0: 7328 290a 2020 2020 7b0a 2020 2020 2020  s().    {.      
+0002e1f0: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
+0002e200: 5265 706c 7954 6f3b 0a20 2020 207d 0a0a  ReplyTo;.    }..
+0002e210: 2020 2020 2f2a 2a0a 2020 2020 202a 2041      /**.     * A
+0002e220: 6c6c 6f77 7320 666f 7220 7075 626c 6963  llows for public
+0002e230: 2072 6561 6420 6163 6365 7373 2074 6f20   read access to 
+0002e240: 2761 6c6c 5f72 6563 6970 6965 6e74 7327  'all_recipients'
+0002e250: 2070 726f 7065 7274 792e 0a20 2020 2020   property..     
+0002e260: 2a20 4265 666f 7265 2074 6865 2073 656e  * Before the sen
+0002e270: 6428 2920 6361 6c6c 2c20 7175 6575 6564  d() call, queued
+0002e280: 2061 6464 7265 7373 6573 2028 692e 652e   addresses (i.e.
+0002e290: 2077 6974 6820 4944 4e29 2061 7265 206e   with IDN) are n
+0002e2a0: 6f74 2079 6574 2069 6e63 6c75 6465 642e  ot yet included.
+0002e2b0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+0002e2c0: 7265 7475 726e 2061 7272 6179 0a20 2020  return array.   
+0002e2d0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+0002e2e0: 6675 6e63 7469 6f6e 2067 6574 416c 6c52  function getAllR
+0002e2f0: 6563 6970 6965 6e74 4164 6472 6573 7365  ecipientAddresse
+0002e300: 7328 290a 2020 2020 7b0a 2020 2020 2020  s().    {.      
+0002e310: 2020 7265 7475 726e 2024 7468 6973 2d3e    return $this->
+0002e320: 616c 6c5f 7265 6369 7069 656e 7473 3b0a  all_recipients;.
+0002e330: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+0002e340: 2020 2020 2a20 5065 7266 6f72 6d20 6120      * Perform a 
+0002e350: 6361 6c6c 6261 636b 2e0a 2020 2020 202a  callback..     *
+0002e360: 0a20 2020 2020 2a20 4070 6172 616d 2062  .     * @param b
+0002e370: 6f6f 6c20 2020 2469 7353 656e 740a 2020  ool   $isSent.  
+0002e380: 2020 202a 2040 7061 7261 6d20 6172 7261     * @param arra
+0002e390: 7920 2024 746f 0a20 2020 2020 2a20 4070  y  $to.     * @p
+0002e3a0: 6172 616d 2061 7272 6179 2020 2463 630a  aram array  $cc.
+0002e3b0: 2020 2020 202a 2040 7061 7261 6d20 6172       * @param ar
+0002e3c0: 7261 7920 2024 6263 630a 2020 2020 202a  ray  $bcc.     *
+0002e3d0: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+0002e3e0: 7375 626a 6563 740a 2020 2020 202a 2040  subject.     * @
+0002e3f0: 7061 7261 6d20 7374 7269 6e67 2024 626f  param string $bo
+0002e400: 6479 0a20 2020 2020 2a20 4070 6172 616d  dy.     * @param
+0002e410: 2073 7472 696e 6720 2466 726f 6d0a 2020   string $from.  
+0002e420: 2020 202a 2040 7061 7261 6d20 6172 7261     * @param arra
+0002e430: 7920 2024 6578 7472 610a 2020 2020 202a  y  $extra.     *
+0002e440: 2f0a 2020 2020 7072 6f74 6563 7465 6420  /.    protected 
+0002e450: 6675 6e63 7469 6f6e 2064 6f43 616c 6c62  function doCallb
+0002e460: 6163 6b28 2469 7353 656e 742c 2024 746f  ack($isSent, $to
+0002e470: 2c20 2463 632c 2024 6263 632c 2024 7375  , $cc, $bcc, $su
+0002e480: 626a 6563 742c 2024 626f 6479 2c20 2466  bject, $body, $f
+0002e490: 726f 6d2c 2024 6578 7472 6129 0a20 2020  rom, $extra).   
+0002e4a0: 207b 0a20 2020 2020 2020 2069 6620 2821   {.        if (!
+0002e4b0: 656d 7074 7928 2474 6869 732d 3e61 6374  empty($this->act
+0002e4c0: 696f 6e5f 6675 6e63 7469 6f6e 2920 2626  ion_function) &&
+0002e4d0: 2069 735f 6361 6c6c 6162 6c65 2824 7468   is_callable($th
+0002e4e0: 6973 2d3e 6163 7469 6f6e 5f66 756e 6374  is->action_funct
+0002e4f0: 696f 6e29 2920 7b0a 2020 2020 2020 2020  ion)) {.        
+0002e500: 2020 2020 6361 6c6c 5f75 7365 725f 6675      call_user_fu
+0002e510: 6e63 2824 7468 6973 2d3e 6163 7469 6f6e  nc($this->action
+0002e520: 5f66 756e 6374 696f 6e2c 2024 6973 5365  _function, $isSe
+0002e530: 6e74 2c20 2474 6f2c 2024 6363 2c20 2462  nt, $to, $cc, $b
+0002e540: 6363 2c20 2473 7562 6a65 6374 2c20 2462  cc, $subject, $b
+0002e550: 6f64 792c 2024 6672 6f6d 2c20 2465 7874  ody, $from, $ext
+0002e560: 7261 293b 0a20 2020 2020 2020 207d 0a20  ra);.        }. 
+0002e570: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
+0002e580: 2020 202a 2047 6574 2074 6865 204f 4175     * Get the OAu
+0002e590: 7468 546f 6b65 6e50 726f 7669 6465 7220  thTokenProvider 
+0002e5a0: 696e 7374 616e 6365 2e0a 2020 2020 202a  instance..     *
+0002e5b0: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+0002e5c0: 4f41 7574 6854 6f6b 656e 5072 6f76 6964  OAuthTokenProvid
+0002e5d0: 6572 0a20 2020 2020 2a2f 0a20 2020 2070  er.     */.    p
+0002e5e0: 7562 6c69 6320 6675 6e63 7469 6f6e 2067  ublic function g
+0002e5f0: 6574 4f41 7574 6828 290a 2020 2020 7b0a  etOAuth().    {.
+0002e600: 2020 2020 2020 2020 7265 7475 726e 2024          return $
+0002e610: 7468 6973 2d3e 6f61 7574 683b 0a20 2020  this->oauth;.   
+0002e620: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+0002e630: 202a 2053 6574 2061 6e20 4f41 7574 6854   * Set an OAuthT
+0002e640: 6f6b 656e 5072 6f76 6964 6572 2069 6e73  okenProvider ins
+0002e650: 7461 6e63 652e 0a20 2020 2020 2a2f 0a20  tance..     */. 
+0002e660: 2020 2070 7562 6c69 6320 6675 6e63 7469     public functi
+0002e670: 6f6e 2073 6574 4f41 7574 6828 4f41 7574  on setOAuth(OAut
+0002e680: 6854 6f6b 656e 5072 6f76 6964 6572 2024  hTokenProvider $
+0002e690: 6f61 7574 6829 0a20 2020 207b 0a20 2020  oauth).    {.   
+0002e6a0: 2020 2020 2024 7468 6973 2d3e 6f61 7574       $this->oaut
+0002e6b0: 6820 3d20 246f 6175 7468 3b0a 2020 2020  h = $oauth;.    
+0002e6c0: 7d0a 7d0a 0a2f 2a2a 0a20 2a20 5048 504d  }.}../**. * PHPM
+0002e6d0: 6169 6c65 7220 5246 4338 3231 2053 4d54  ailer RFC821 SMT
+0002e6e0: 5020 656d 6169 6c20 7472 616e 7370 6f72  P email transpor
+0002e6f0: 7420 636c 6173 732e 0a20 2a20 5048 5020  t class.. * PHP 
+0002e700: 5665 7273 696f 6e20 352e 352e 0a20 2a0a  Version 5.5.. *.
+0002e710: 202a 2040 7365 6520 2020 2020 2020 6874   * @see       ht
+0002e720: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+0002e730: 2f50 4850 4d61 696c 6572 2f50 4850 4d61  /PHPMailer/PHPMa
+0002e740: 696c 6572 2f20 5468 6520 5048 504d 6169  iler/ The PHPMai
+0002e750: 6c65 7220 4769 7448 7562 2070 726f 6a65  ler GitHub proje
+0002e760: 6374 0a20 2a0a 202a 2040 6175 7468 6f72  ct. *. * @author
+0002e770: 2020 2020 4d61 7263 7573 2042 6f69 6e74      Marcus Boint
+0002e780: 6f6e 2028 5379 6e63 6872 6f2f 636f 6f6c  on (Synchro/cool
+0002e790: 6272 7529 203c 7068 706d 6169 6c65 7240  bru) <phpmailer@
+0002e7a0: 7379 6e63 6872 6f6d 6564 6961 2e63 6f2e  synchromedia.co.
+0002e7b0: 756b 3e0a 202a 2040 6175 7468 6f72 2020  uk>. * @author  
+0002e7c0: 2020 4a69 6d20 4a61 6769 656c 736b 6920    Jim Jagielski 
+0002e7d0: 286a 696d 6a61 6729 203c 6a69 6d6a 6167  (jimjag) <jimjag
+0002e7e0: 4067 6d61 696c 2e63 6f6d 3e0a 202a 2040  @gmail.com>. * @
+0002e7f0: 6175 7468 6f72 2020 2020 416e 6479 2050  author    Andy P
+0002e800: 7265 766f 7374 2028 636f 6465 776f 7278  revost (codeworx
+0002e810: 7465 6368 2920 3c63 6f64 6577 6f72 7874  tech) <codeworxt
+0002e820: 6563 6840 7573 6572 732e 736f 7572 6365  ech@users.source
+0002e830: 666f 7267 652e 6e65 743e 0a20 2a20 4061  forge.net>. * @a
+0002e840: 7574 686f 7220 2020 2042 7265 6e74 2052  uthor    Brent R
+0002e850: 2e20 4d61 747a 656c 6c65 2028 6f72 6967  . Matzelle (orig
+0002e860: 696e 616c 2066 6f75 6e64 6572 290a 202a  inal founder). *
+0002e870: 2040 636f 7079 7269 6768 7420 3230 3132   @copyright 2012
+0002e880: 202d 2032 3032 3020 4d61 7263 7573 2042   - 2020 Marcus B
+0002e890: 6f69 6e74 6f6e 0a20 2a20 4063 6f70 7972  ointon. * @copyr
+0002e8a0: 6967 6874 2032 3031 3020 2d20 3230 3132  ight 2010 - 2012
+0002e8b0: 204a 696d 204a 6167 6965 6c73 6b69 0a20   Jim Jagielski. 
+0002e8c0: 2a20 4063 6f70 7972 6967 6874 2032 3030  * @copyright 200
+0002e8d0: 3420 2d20 3230 3039 2041 6e64 7920 5072  4 - 2009 Andy Pr
+0002e8e0: 6576 6f73 740a 202a 2040 6c69 6365 6e73  evost. * @licens
+0002e8f0: 6520 2020 6874 7470 3a2f 2f77 7777 2e67  e   http://www.g
+0002e900: 6e75 2e6f 7267 2f63 6f70 796c 6566 742f  nu.org/copyleft/
+0002e910: 6c65 7373 6572 2e68 746d 6c20 474e 5520  lesser.html GNU 
+0002e920: 4c65 7373 6572 2047 656e 6572 616c 2050  Lesser General P
+0002e930: 7562 6c69 6320 4c69 6365 6e73 650a 202a  ublic License. *
+0002e940: 2040 6e6f 7465 2020 2020 2020 5468 6973   @note      This
+0002e950: 2070 726f 6772 616d 2069 7320 6469 7374   program is dist
+0002e960: 7269 6275 7465 6420 696e 2074 6865 2068  ributed in the h
+0002e970: 6f70 6520 7468 6174 2069 7420 7769 6c6c  ope that it will
+0002e980: 2062 6520 7573 6566 756c 202d 2057 4954   be useful - WIT
+0002e990: 484f 5554 0a20 2a20 414e 5920 5741 5252  HOUT. * ANY WARR
+0002e9a0: 414e 5459 3b20 7769 7468 6f75 7420 6576  ANTY; without ev
+0002e9b0: 656e 2074 6865 2069 6d70 6c69 6564 2077  en the implied w
+0002e9c0: 6172 7261 6e74 7920 6f66 204d 4552 4348  arranty of MERCH
+0002e9d0: 414e 5441 4249 4c49 5459 206f 720a 202a  ANTABILITY or. *
+0002e9e0: 2046 4954 4e45 5353 2046 4f52 2041 2050   FITNESS FOR A P
+0002e9f0: 4152 5449 4355 4c41 5220 5055 5250 4f53  ARTICULAR PURPOS
+0002ea00: 452e 0a20 2a2f 0a0a 636c 6173 7320 534d  E.. */..class SM
+0002ea10: 5450 0a7b 0a20 2020 202f 2a2a 0a20 2020  TP.{.    /**.   
+0002ea20: 2020 2a20 5468 6520 5048 504d 6169 6c65    * The PHPMaile
+0002ea30: 7220 534d 5450 2076 6572 7369 6f6e 206e  r SMTP version n
+0002ea40: 756d 6265 722e 0a20 2020 2020 2a0a 2020  umber..     *.  
+0002ea50: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+0002ea60: 0a20 2020 2020 2a2f 0a20 2020 2063 6f6e  .     */.    con
+0002ea70: 7374 2056 4552 5349 4f4e 203d 2027 362e  st VERSION = '6.
+0002ea80: 392e 3127 3b0a 0a20 2020 202f 2a2a 0a20  9.1';..    /**. 
+0002ea90: 2020 2020 2a20 534d 5450 206c 696e 6520      * SMTP line 
+0002eaa0: 6272 6561 6b20 636f 6e73 7461 6e74 2e0a  break constant..
+0002eab0: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+0002eac0: 6172 2073 7472 696e 670a 2020 2020 202a  ar string.     *
+0002ead0: 2f0a 2020 2020 636f 6e73 7420 4c45 203d  /.    const LE =
+0002eae0: 2022 5c72 5c6e 223b 0a0a 2020 2020 2f2a   "\r\n";..    /*
+0002eaf0: 2a0a 2020 2020 202a 2054 6865 2053 4d54  *.     * The SMT
+0002eb00: 5020 706f 7274 2074 6f20 7573 6520 6966  P port to use if
+0002eb10: 206f 6e65 2069 7320 6e6f 7420 7370 6563   one is not spec
+0002eb20: 6966 6965 642e 0a20 2020 2020 2a0a 2020  ified..     *.  
+0002eb30: 2020 202a 2040 7661 7220 696e 740a 2020     * @var int.  
+0002eb40: 2020 202a 2f0a 2020 2020 636f 6e73 7420     */.    const 
+0002eb50: 4445 4641 554c 545f 504f 5254 203d 2032  DEFAULT_PORT = 2
+0002eb60: 353b 0a0a 2020 2020 2f2a 2a0a 2020 2020  5;..    /**.    
+0002eb70: 202a 2054 6865 2053 4d54 5073 2070 6f72   * The SMTPs por
+0002eb80: 7420 746f 2075 7365 2069 6620 6f6e 6520  t to use if one 
+0002eb90: 6973 206e 6f74 2073 7065 6369 6669 6564  is not specified
+0002eba0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+0002ebb0: 4076 6172 2069 6e74 0a20 2020 2020 2a2f  @var int.     */
+0002ebc0: 0a20 2020 2063 6f6e 7374 2044 4546 4155  .    const DEFAU
+0002ebd0: 4c54 5f53 4543 5552 455f 504f 5254 203d  LT_SECURE_PORT =
+0002ebe0: 2034 3635 3b0a 0a20 2020 202f 2a2a 0a20   465;..    /**. 
+0002ebf0: 2020 2020 2a20 5468 6520 6d61 7869 6d75      * The maximu
+0002ec00: 6d20 6c69 6e65 206c 656e 6774 6820 616c  m line length al
+0002ec10: 6c6f 7765 6420 6279 2052 4643 2035 3332  lowed by RFC 532
+0002ec20: 3120 7365 6374 696f 6e20 342e 352e 332e  1 section 4.5.3.
+0002ec30: 312e 362c 0a20 2020 2020 2a20 2a65 7863  1.6,.     * *exc
+0002ec40: 6c75 6469 6e67 2a20 6120 7472 6169 6c69  luding* a traili
+0002ec50: 6e67 2043 524c 4620 6272 6561 6b2e 0a20  ng CRLF break.. 
+0002ec60: 2020 2020 2a0a 2020 2020 202a 2040 7365      *.     * @se
+0002ec70: 6520 6874 7470 733a 2f2f 746f 6f6c 732e  e https://tools.
+0002ec80: 6965 7466 2e6f 7267 2f68 746d 6c2f 7266  ietf.org/html/rf
+0002ec90: 6335 3332 3123 7365 6374 696f 6e2d 342e  c5321#section-4.
+0002eca0: 352e 332e 312e 360a 2020 2020 202a 0a20  5.3.1.6.     *. 
+0002ecb0: 2020 2020 2a20 4076 6172 2069 6e74 0a20      * @var int. 
+0002ecc0: 2020 2020 2a2f 0a20 2020 2063 6f6e 7374      */.    const
+0002ecd0: 204d 4158 5f4c 494e 455f 4c45 4e47 5448   MAX_LINE_LENGTH
+0002ece0: 203d 2039 3938 3b0a 0a20 2020 202f 2a2a   = 998;..    /**
+0002ecf0: 0a20 2020 2020 2a20 5468 6520 6d61 7869  .     * The maxi
+0002ed00: 6d75 6d20 6c69 6e65 206c 656e 6774 6820  mum line length 
+0002ed10: 616c 6c6f 7765 6420 666f 7220 7265 706c  allowed for repl
+0002ed20: 6965 7320 696e 2052 4643 2035 3332 3120  ies in RFC 5321 
+0002ed30: 7365 6374 696f 6e20 342e 352e 332e 312e  section 4.5.3.1.
+0002ed40: 352c 0a20 2020 2020 2a20 2a69 6e63 6c75  5,.     * *inclu
+0002ed50: 6469 6e67 2a20 6120 7472 6169 6c69 6e67  ding* a trailing
+0002ed60: 2043 524c 4620 6c69 6e65 2062 7265 616b   CRLF line break
+0002ed70: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+0002ed80: 4073 6565 2068 7474 7073 3a2f 2f74 6f6f  @see https://too
+0002ed90: 6c73 2e69 6574 662e 6f72 672f 6874 6d6c  ls.ietf.org/html
+0002eda0: 2f72 6663 3533 3231 2373 6563 7469 6f6e  /rfc5321#section
+0002edb0: 2d34 2e35 2e33 2e31 2e35 0a20 2020 2020  -4.5.3.1.5.     
+0002edc0: 2a0a 2020 2020 202a 2040 7661 7220 696e  *.     * @var in
+0002edd0: 740a 2020 2020 202a 2f0a 2020 2020 636f  t.     */.    co
+0002ede0: 6e73 7420 4d41 585f 5245 504c 595f 4c45  nst MAX_REPLY_LE
+0002edf0: 4e47 5448 203d 2035 3132 3b0a 0a20 2020  NGTH = 512;..   
+0002ee00: 202f 2a2a 0a20 2020 2020 2a20 4465 6275   /**.     * Debu
+0002ee10: 6720 6c65 7665 6c20 666f 7220 6e6f 206f  g level for no o
+0002ee20: 7574 7075 742e 0a20 2020 2020 2a0a 2020  utput..     *.  
+0002ee30: 2020 202a 2040 7661 7220 696e 740a 2020     * @var int.  
+0002ee40: 2020 202a 2f0a 2020 2020 636f 6e73 7420     */.    const 
+0002ee50: 4445 4255 475f 4f46 4620 3d20 303b 0a0a  DEBUG_OFF = 0;..
+0002ee60: 2020 2020 2f2a 2a0a 2020 2020 202a 2044      /**.     * D
+0002ee70: 6562 7567 206c 6576 656c 2074 6f20 7368  ebug level to sh
+0002ee80: 6f77 2063 6c69 656e 7420 2d3e 2073 6572  ow client -> ser
+0002ee90: 7665 7220 6d65 7373 6167 6573 2e0a 2020  ver messages..  
+0002eea0: 2020 202a 0a20 2020 2020 2a20 4076 6172     *.     * @var
+0002eeb0: 2069 6e74 0a20 2020 2020 2a2f 0a20 2020   int.     */.   
+0002eec0: 2063 6f6e 7374 2044 4542 5547 5f43 4c49   const DEBUG_CLI
+0002eed0: 454e 5420 3d20 313b 0a0a 2020 2020 2f2a  ENT = 1;..    /*
+0002eee0: 2a0a 2020 2020 202a 2044 6562 7567 206c  *.     * Debug l
+0002eef0: 6576 656c 2074 6f20 7368 6f77 2063 6c69  evel to show cli
+0002ef00: 656e 7420 2d3e 2073 6572 7665 7220 616e  ent -> server an
+0002ef10: 6420 7365 7276 6572 202d 3e20 636c 6965  d server -> clie
+0002ef20: 6e74 206d 6573 7361 6765 732e 0a20 2020  nt messages..   
+0002ef30: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
+0002ef40: 696e 740a 2020 2020 202a 2f0a 2020 2020  int.     */.    
+0002ef50: 636f 6e73 7420 4445 4255 475f 5345 5256  const DEBUG_SERV
+0002ef60: 4552 203d 2032 3b0a 0a20 2020 202f 2a2a  ER = 2;..    /**
+0002ef70: 0a20 2020 2020 2a20 4465 6275 6720 6c65  .     * Debug le
+0002ef80: 7665 6c20 746f 2073 686f 7720 636f 6e6e  vel to show conn
+0002ef90: 6563 7469 6f6e 2073 7461 7475 732c 2063  ection status, c
+0002efa0: 6c69 656e 7420 2d3e 2073 6572 7665 7220  lient -> server 
+0002efb0: 616e 6420 7365 7276 6572 202d 3e20 636c  and server -> cl
+0002efc0: 6965 6e74 206d 6573 7361 6765 732e 0a20  ient messages.. 
+0002efd0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+0002efe0: 7220 696e 740a 2020 2020 202a 2f0a 2020  r int.     */.  
+0002eff0: 2020 636f 6e73 7420 4445 4255 475f 434f    const DEBUG_CO
+0002f000: 4e4e 4543 5449 4f4e 203d 2033 3b0a 0a20  NNECTION = 3;.. 
+0002f010: 2020 202f 2a2a 0a20 2020 2020 2a20 4465     /**.     * De
+0002f020: 6275 6720 6c65 7665 6c20 746f 2073 686f  bug level to sho
+0002f030: 7720 616c 6c20 6d65 7373 6167 6573 2e0a  w all messages..
+0002f040: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+0002f050: 6172 2069 6e74 0a20 2020 2020 2a2f 0a20  ar int.     */. 
+0002f060: 2020 2063 6f6e 7374 2044 4542 5547 5f4c     const DEBUG_L
+0002f070: 4f57 4c45 5645 4c20 3d20 343b 0a0a 2020  OWLEVEL = 4;..  
+0002f080: 2020 2f2a 2a0a 2020 2020 202a 2044 6562    /**.     * Deb
+0002f090: 7567 206f 7574 7075 7420 6c65 7665 6c2e  ug output level.
+0002f0a0: 0a20 2020 2020 2a20 4f70 7469 6f6e 733a  .     * Options:
+0002f0b0: 0a20 2020 2020 2a20 2a20 7365 6c66 3a3a  .     * * self::
+0002f0c0: 4445 4255 475f 4f46 4620 2860 3060 2920  DEBUG_OFF (`0`) 
+0002f0d0: 4e6f 2064 6562 7567 206f 7574 7075 742c  No debug output,
+0002f0e0: 2064 6566 6175 6c74 0a20 2020 2020 2a20   default.     * 
+0002f0f0: 2a20 7365 6c66 3a3a 4445 4255 475f 434c  * self::DEBUG_CL
+0002f100: 4945 4e54 2028 6031 6029 2043 6c69 656e  IENT (`1`) Clien
+0002f110: 7420 636f 6d6d 616e 6473 0a20 2020 2020  t commands.     
+0002f120: 2a20 2a20 7365 6c66 3a3a 4445 4255 475f  * * self::DEBUG_
+0002f130: 5345 5256 4552 2028 6032 6029 2043 6c69  SERVER (`2`) Cli
+0002f140: 656e 7420 636f 6d6d 616e 6473 2061 6e64  ent commands and
+0002f150: 2073 6572 7665 7220 7265 7370 6f6e 7365   server response
+0002f160: 730a 2020 2020 202a 202a 2073 656c 663a  s.     * * self:
+0002f170: 3a44 4542 5547 5f43 4f4e 4e45 4354 494f  :DEBUG_CONNECTIO
+0002f180: 4e20 2860 3360 2920 4173 2044 4542 5547  N (`3`) As DEBUG
+0002f190: 5f53 4552 5645 5220 706c 7573 2063 6f6e  _SERVER plus con
+0002f1a0: 6e65 6374 696f 6e20 7374 6174 7573 0a20  nection status. 
+0002f1b0: 2020 2020 2a20 2a20 7365 6c66 3a3a 4445      * * self::DE
+0002f1c0: 4255 475f 4c4f 574c 4556 454c 2028 6034  BUG_LOWLEVEL (`4
+0002f1d0: 6029 204c 6f77 2d6c 6576 656c 2064 6174  `) Low-level dat
+0002f1e0: 6120 6f75 7470 7574 2c20 616c 6c20 6d65  a output, all me
+0002f1f0: 7373 6167 6573 2e0a 2020 2020 202a 0a20  ssages..     *. 
+0002f200: 2020 2020 2a20 4076 6172 2069 6e74 0a20      * @var int. 
+0002f210: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+0002f220: 6320 2464 6f5f 6465 6275 6720 3d20 7365  c $do_debug = se
+0002f230: 6c66 3a3a 4445 4255 475f 4f46 463b 0a0a  lf::DEBUG_OFF;..
+0002f240: 2020 2020 2f2a 2a0a 2020 2020 202a 2048      /**.     * H
+0002f250: 6f77 2074 6f20 6861 6e64 6c65 2064 6562  ow to handle deb
+0002f260: 7567 206f 7574 7075 742e 0a20 2020 2020  ug output..     
+0002f270: 2a20 4f70 7469 6f6e 733a 0a20 2020 2020  * Options:.     
+0002f280: 2a20 2a20 6065 6368 6f60 204f 7574 7075  * * `echo` Outpu
+0002f290: 7420 706c 6169 6e2d 7465 7874 2061 732d  t plain-text as-
+0002f2a0: 6973 2c20 6170 7072 6f70 7269 6174 6520  is, appropriate 
+0002f2b0: 666f 7220 434c 490a 2020 2020 202a 202a  for CLI.     * *
+0002f2c0: 2060 6874 6d6c 6020 4f75 7470 7574 2065   `html` Output e
+0002f2d0: 7363 6170 6564 2c20 6c69 6e65 2062 7265  scaped, line bre
+0002f2e0: 616b 7320 636f 6e76 6572 7465 6420 746f  aks converted to
+0002f2f0: 2060 3c62 723e 602c 2061 7070 726f 7072   `<br>`, appropr
+0002f300: 6961 7465 2066 6f72 2062 726f 7773 6572  iate for browser
+0002f310: 206f 7574 7075 740a 2020 2020 202a 202a   output.     * *
+0002f320: 2060 6572 726f 725f 6c6f 6760 204f 7574   `error_log` Out
+0002f330: 7075 7420 746f 2065 7272 6f72 206c 6f67  put to error log
+0002f340: 2061 7320 636f 6e66 6967 7572 6564 2069   as configured i
+0002f350: 6e20 7068 702e 696e 690a 2020 2020 202a  n php.ini.     *
+0002f360: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
+0002f370: 796f 7520 6361 6e20 7072 6f76 6964 6520  you can provide 
+0002f380: 6120 6361 6c6c 6162 6c65 2065 7870 6563  a callable expec
+0002f390: 7469 6e67 2074 776f 2070 6172 616d 733a  ting two params:
+0002f3a0: 2061 206d 6573 7361 6765 2073 7472 696e   a message strin
+0002f3b0: 6720 616e 6420 7468 6520 6465 6275 6720  g and the debug 
+0002f3c0: 6c65 7665 6c3a 0a20 2020 2020 2a0a 2020  level:.     *.  
+0002f3d0: 2020 202a 2060 6060 7068 700a 2020 2020     * ```php.    
+0002f3e0: 202a 2024 736d 7470 2d3e 4465 6275 676f   * $smtp->Debugo
+0002f3f0: 7574 7075 7420 3d20 6675 6e63 7469 6f6e  utput = function
+0002f400: 2824 7374 722c 2024 6c65 7665 6c29 207b  ($str, $level) {
+0002f410: 6563 686f 2022 6465 6275 6720 6c65 7665  echo "debug leve
+0002f420: 6c20 246c 6576 656c 3b20 6d65 7373 6167  l $level; messag
+0002f430: 653a 2024 7374 7222 3b7d 3b0a 2020 2020  e: $str";};.    
+0002f440: 202a 2060 6060 0a20 2020 2020 2a0a 2020   * ```.     *.  
+0002f450: 2020 202a 2041 6c74 6572 6e61 7469 7665     * Alternative
+0002f460: 6c79 2c20 796f 7520 6361 6e20 7061 7373  ly, you can pass
+0002f470: 2069 6e20 616e 2069 6e73 7461 6e63 6520   in an instance 
+0002f480: 6f66 2061 2050 5352 2d33 2063 6f6d 7061  of a PSR-3 compa
+0002f490: 7469 626c 6520 6c6f 6767 6572 2c20 7468  tible logger, th
+0002f4a0: 6f75 6768 206f 6e6c 7920 6064 6562 7567  ough only `debug
+0002f4b0: 600a 2020 2020 202a 206c 6576 656c 206f  `.     * level o
+0002f4c0: 7574 7075 7420 6973 2075 7365 643a 0a20  utput is used:. 
+0002f4d0: 2020 2020 2a0a 2020 2020 202a 2060 6060      *.     * ```
+0002f4e0: 7068 700a 2020 2020 202a 2024 6d61 696c  php.     * $mail
+0002f4f0: 2d3e 4465 6275 676f 7574 7075 7420 3d20  ->Debugoutput = 
+0002f500: 6e65 7720 6d79 5073 7233 4c6f 6767 6572  new myPsr3Logger
+0002f510: 3b0a 2020 2020 202a 2060 6060 0a20 2020  ;.     * ```.   
+0002f520: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
+0002f530: 7374 7269 6e67 7c63 616c 6c61 626c 657c  string|callable|
+0002f540: 5c50 7372 5c4c 6f67 5c4c 6f67 6765 7249  \Psr\Log\LoggerI
+0002f550: 6e74 6572 6661 6365 0a20 2020 2020 2a2f  nterface.     */
+0002f560: 0a20 2020 2070 7562 6c69 6320 2444 6562  .    public $Deb
+0002f570: 7567 6f75 7470 7574 203d 2027 6563 686f  ugoutput = 'echo
+0002f580: 273b 0a0a 2020 2020 2f2a 2a0a 2020 2020  ';..    /**.    
+0002f590: 202a 2057 6865 7468 6572 2074 6f20 7573   * Whether to us
+0002f5a0: 6520 5645 5250 2e0a 2020 2020 202a 0a20  e VERP..     *. 
+0002f5b0: 2020 2020 2a20 4073 6565 2068 7474 703a      * @see http:
+0002f5c0: 2f2f 656e 2e77 696b 6970 6564 6961 2e6f  //en.wikipedia.o
+0002f5d0: 7267 2f77 696b 692f 5661 7269 6162 6c65  rg/wiki/Variable
+0002f5e0: 5f65 6e76 656c 6f70 655f 7265 7475 726e  _envelope_return
+0002f5f0: 5f70 6174 680a 2020 2020 202a 2040 7365  _path.     * @se
+0002f600: 6520 6874 7470 3a2f 2f77 7777 2e70 6f73  e http://www.pos
+0002f610: 7466 6978 2e6f 7267 2f56 4552 505f 5245  tfix.org/VERP_RE
+0002f620: 4144 4d45 2e68 746d 6c20 496e 666f 206f  ADME.html Info o
+0002f630: 6e20 5645 5250 0a20 2020 2020 2a0a 2020  n VERP.     *.  
+0002f640: 2020 202a 2040 7661 7220 626f 6f6c 0a20     * @var bool. 
+0002f650: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+0002f660: 6320 2464 6f5f 7665 7270 203d 2066 616c  c $do_verp = fal
+0002f670: 7365 3b0a 0a20 2020 202f 2a2a 0a20 2020  se;..    /**.   
+0002f680: 2020 2a20 5468 6520 7469 6d65 6f75 7420    * The timeout 
+0002f690: 7661 6c75 6520 666f 7220 636f 6e6e 6563  value for connec
+0002f6a0: 7469 6f6e 2c20 696e 2073 6563 6f6e 6473  tion, in seconds
+0002f6b0: 2e0a 2020 2020 202a 2044 6566 6175 6c74  ..     * Default
+0002f6c0: 206f 6620 3520 6d69 6e75 7465 7320 2833   of 5 minutes (3
+0002f6d0: 3030 7365 6329 2069 7320 6672 6f6d 2052  00sec) is from R
+0002f6e0: 4643 3238 3231 2073 6563 7469 6f6e 2034  FC2821 section 4
+0002f6f0: 2e35 2e33 2e32 2e0a 2020 2020 202a 2054  .5.3.2..     * T
+0002f700: 6869 7320 6e65 6564 7320 746f 2062 6520  his needs to be 
+0002f710: 7175 6974 6520 6869 6768 2074 6f20 6675  quite high to fu
+0002f720: 6e63 7469 6f6e 2063 6f72 7265 6374 6c79  nction correctly
+0002f730: 2077 6974 6820 686f 7374 7320 7573 696e   with hosts usin
+0002f740: 6720 6772 6565 7464 656c 6179 2061 7320  g greetdelay as 
+0002f750: 616e 2061 6e74 692d 7370 616d 206d 6561  an anti-spam mea
+0002f760: 7375 7265 2e0a 2020 2020 202a 0a20 2020  sure..     *.   
+0002f770: 2020 2a20 4073 6565 2068 7474 703a 2f2f    * @see http://
+0002f780: 746f 6f6c 732e 6965 7466 2e6f 7267 2f68  tools.ietf.org/h
+0002f790: 746d 6c2f 7266 6332 3832 3123 7365 6374  tml/rfc2821#sect
+0002f7a0: 696f 6e2d 342e 352e 332e 320a 2020 2020  ion-4.5.3.2.    
+0002f7b0: 202a 0a20 2020 2020 2a20 4076 6172 2069   *.     * @var i
+0002f7c0: 6e74 0a20 2020 2020 2a2f 0a20 2020 2070  nt.     */.    p
+0002f7d0: 7562 6c69 6320 2454 696d 656f 7574 203d  ublic $Timeout =
+0002f7e0: 2033 3030 3b0a 0a20 2020 202f 2a2a 0a20   300;..    /**. 
+0002f7f0: 2020 2020 2a20 486f 7720 6c6f 6e67 2074      * How long t
+0002f800: 6f20 7761 6974 2066 6f72 2063 6f6d 6d61  o wait for comma
+0002f810: 6e64 7320 746f 2063 6f6d 706c 6574 652c  nds to complete,
+0002f820: 2069 6e20 7365 636f 6e64 732e 0a20 2020   in seconds..   
+0002f830: 2020 2a20 4465 6661 756c 7420 6f66 2035    * Default of 5
+0002f840: 206d 696e 7574 6573 2028 3330 3073 6563   minutes (300sec
+0002f850: 2920 6973 2066 726f 6d20 5246 4332 3832  ) is from RFC282
+0002f860: 3120 7365 6374 696f 6e20 342e 352e 332e  1 section 4.5.3.
+0002f870: 322e 0a20 2020 2020 2a0a 2020 2020 202a  2..     *.     *
+0002f880: 2040 7661 7220 696e 740a 2020 2020 202a   @var int.     *
+0002f890: 2f0a 2020 2020 7075 626c 6963 2024 5469  /.    public $Ti
+0002f8a0: 6d65 6c69 6d69 7420 3d20 3330 303b 0a0a  melimit = 300;..
+0002f8b0: 2020 2020 2f2a 2a0a 2020 2020 202a 2050      /**.     * P
+0002f8c0: 6174 7465 726e 7320 746f 2065 7874 7261  atterns to extra
+0002f8d0: 6374 2061 6e20 534d 5450 2074 7261 6e73  ct an SMTP trans
+0002f8e0: 6163 7469 6f6e 2069 6420 6672 6f6d 2072  action id from r
+0002f8f0: 6570 6c79 2074 6f20 6120 4441 5441 2063  eply to a DATA c
+0002f900: 6f6d 6d61 6e64 2e0a 2020 2020 202a 2054  ommand..     * T
+0002f910: 6865 2066 6972 7374 2063 6170 7475 7265  he first capture
+0002f920: 2067 726f 7570 2069 6e20 6561 6368 2072   group in each r
+0002f930: 6567 6578 2077 696c 6c20 6265 2075 7365  egex will be use
+0002f940: 6420 6173 2074 6865 2049 442e 0a20 2020  d as the ID..   
+0002f950: 2020 2a20 4d53 2045 534d 5450 2072 6574    * MS ESMTP ret
+0002f960: 7572 6e73 2074 6865 206d 6573 7361 6765  urns the message
+0002f970: 2049 442c 2077 6869 6368 206d 6179 206e   ID, which may n
+0002f980: 6f74 2062 6520 636f 7272 6563 7420 666f  ot be correct fo
+0002f990: 7220 696e 7465 726e 616c 2074 7261 636b  r internal track
+0002f9a0: 696e 672e 0a20 2020 2020 2a0a 2020 2020  ing..     *.    
+0002f9b0: 202a 2040 7661 7220 7374 7269 6e67 5b5d   * @var string[]
+0002f9c0: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+0002f9d0: 7465 6374 6564 2024 736d 7470 5f74 7261  tected $smtp_tra
+0002f9e0: 6e73 6163 7469 6f6e 5f69 645f 7061 7474  nsaction_id_patt
+0002f9f0: 6572 6e73 203d 205b 0a20 2020 2020 2020  erns = [.       
+0002fa00: 2027 6578 696d 2720 3d3e 2027 2f5b 5c64   'exim' => '/[\d
+0002fa10: 5d7b 337d 204f 4b20 6964 3d28 2e2a 292f  ]{3} OK id=(.*)/
+0002fa20: 272c 0a20 2020 2020 2020 2027 7365 6e64  ',.        'send
+0002fa30: 6d61 696c 2720 3d3e 2027 2f5b 5c64 5d7b  mail' => '/[\d]{
+0002fa40: 337d 2032 5c2e 305c 2e30 2028 2e2a 2920  3} 2\.0\.0 (.*) 
+0002fa50: 4d65 7373 6167 652f 272c 0a20 2020 2020  Message/',.     
+0002fa60: 2020 2027 706f 7374 6669 7827 203d 3e20     'postfix' => 
+0002fa70: 272f 5b5c 645d 7b33 7d20 325c 2e30 5c2e  '/[\d]{3} 2\.0\.
+0002fa80: 3020 4f6b 3a20 7175 6575 6564 2061 7320  0 Ok: queued as 
+0002fa90: 282e 2a29 2f27 2c0a 2020 2020 2020 2020  (.*)/',.        
+0002faa0: 274d 6963 726f 736f 6674 5f45 534d 5450  'Microsoft_ESMTP
+0002fab0: 2720 3d3e 2027 2f5b 302d 395d 7b33 7d20  ' => '/[0-9]{3} 
+0002fac0: 325c 2e5b 5c64 5d5c 2e30 2028 2e2a 2940  2\.[\d]\.0 (.*)@
+0002fad0: 283f 3a2e 2a29 2051 7565 7565 6420 6d61  (?:.*) Queued ma
+0002fae0: 696c 2066 6f72 2064 656c 6976 6572 792f  il for delivery/
+0002faf0: 272c 0a20 2020 2020 2020 2027 416d 617a  ',.        'Amaz
+0002fb00: 6f6e 5f53 4553 2720 3d3e 2027 2f5b 5c64  on_SES' => '/[\d
+0002fb10: 5d7b 337d 204f 6b20 282e 2a29 2f27 2c0a  ]{3} Ok (.*)/',.
+0002fb20: 2020 2020 2020 2020 2753 656e 6447 7269          'SendGri
+0002fb30: 6427 203d 3e20 272f 5b5c 645d 7b33 7d20  d' => '/[\d]{3} 
+0002fb40: 4f6b 3a20 7175 6575 6564 2061 7320 282e  Ok: queued as (.
+0002fb50: 2a29 2f27 2c0a 2020 2020 2020 2020 2743  *)/',.        'C
+0002fb60: 616d 7061 6967 6e4d 6f6e 6974 6f72 2720  ampaignMonitor' 
+0002fb70: 3d3e 2027 2f5b 5c64 5d7b 337d 2032 5c2e  => '/[\d]{3} 2\.
+0002fb80: 305c 2e30 204f 4b3a 285b 612d 7a41 2d5a  0\.0 OK:([a-zA-Z
+0002fb90: 5c64 5d7b 3438 7d29 2f27 2c0a 2020 2020  \d]{48})/',.    
+0002fba0: 2020 2020 2748 6172 616b 6127 203d 3e20      'Haraka' => 
+0002fbb0: 272f 5b5c 645d 7b33 7d20 4d65 7373 6167  '/[\d]{3} Messag
+0002fbc0: 6520 5175 6575 6564 205c 2828 2e2a 295c  e Queued \((.*)\
+0002fbd0: 292f 272c 0a20 2020 2020 2020 2027 5a6f  )/',.        'Zo
+0002fbe0: 6e65 4d54 4127 203d 3e20 272f 5b5c 645d  neMTA' => '/[\d]
+0002fbf0: 7b33 7d20 4d65 7373 6167 6520 7175 6575  {3} Message queu
+0002fc00: 6564 2061 7320 282e 2a29 2f27 2c0a 2020  ed as (.*)/',.  
+0002fc10: 2020 2020 2020 274d 6169 6c6a 6574 2720        'Mailjet' 
+0002fc20: 3d3e 2027 2f5b 5c64 5d7b 337d 204f 4b20  => '/[\d]{3} OK 
+0002fc30: 7175 6575 6564 2061 7320 282e 2a29 2f27  queued as (.*)/'
+0002fc40: 2c0a 2020 2020 5d3b 0a0a 2020 2020 2f2a  ,.    ];..    /*
+0002fc50: 2a0a 2020 2020 202a 2041 6c6c 6f77 6564  *.     * Allowed
+0002fc60: 2053 4d54 5020 5843 4c49 454e 5420 6174   SMTP XCLIENT at
+0002fc70: 7472 6962 7574 6573 2e0a 2020 2020 202a  tributes..     *
+0002fc80: 204d 7573 7420 6265 2061 6c6c 6f77 6564   Must be allowed
+0002fc90: 2062 7920 7468 6520 534d 5450 2073 6572   by the SMTP ser
+0002fca0: 7665 722e 2045 484c 4f20 7265 7370 6f6e  ver. EHLO respon
+0002fcb0: 7365 2069 7320 6e6f 7420 6368 6563 6b65  se is not checke
+0002fcc0: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
+0002fcd0: 2040 7365 6520 6874 7470 733a 2f2f 7777   @see https://ww
+0002fce0: 772e 706f 7374 6669 782e 6f72 672f 5843  w.postfix.org/XC
+0002fcf0: 4c49 454e 545f 5245 4144 4d45 2e68 746d  LIENT_README.htm
+0002fd00: 6c0a 2020 2020 202a 0a20 2020 2020 2a20  l.     *.     * 
+0002fd10: 4076 6172 2061 7272 6179 0a20 2020 2020  @var array.     
+0002fd20: 2a2f 0a20 2020 2070 7562 6c69 6320 7374  */.    public st
+0002fd30: 6174 6963 2024 7863 6c69 656e 745f 616c  atic $xclient_al
+0002fd40: 6c6f 7765 645f 6174 7472 6962 7574 6573  lowed_attributes
+0002fd50: 203d 205b 0a20 2020 2020 2020 2027 4e41   = [.        'NA
+0002fd60: 4d45 272c 2027 4144 4452 272c 2027 504f  ME', 'ADDR', 'PO
+0002fd70: 5254 272c 2027 5052 4f54 4f27 2c20 2748  RT', 'PROTO', 'H
+0002fd80: 454c 4f27 2c20 274c 4f47 494e 272c 2027  ELO', 'LOGIN', '
+0002fd90: 4445 5354 4144 4452 272c 2027 4445 5354  DESTADDR', 'DEST
+0002fda0: 504f 5254 270a 2020 2020 5d3b 0a0a 2020  PORT'.    ];..  
+0002fdb0: 2020 2f2a 2a0a 2020 2020 202a 2054 6865    /**.     * The
+0002fdc0: 206c 6173 7420 7472 616e 7361 6374 696f   last transactio
+0002fdd0: 6e20 4944 2069 7373 7565 6420 696e 2072  n ID issued in r
+0002fde0: 6573 706f 6e73 6520 746f 2061 2044 4154  esponse to a DAT
+0002fdf0: 4120 636f 6d6d 616e 642c 0a20 2020 2020  A command,.     
+0002fe00: 2a20 6966 206f 6e65 2077 6173 2064 6574  * if one was det
+0002fe10: 6563 7465 642e 0a20 2020 2020 2a0a 2020  ected..     *.  
+0002fe20: 2020 202a 2040 7661 7220 7374 7269 6e67     * @var string
+0002fe30: 7c62 6f6f 6c7c 6e75 6c6c 0a20 2020 2020  |bool|null.     
+0002fe40: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
+0002fe50: 2024 6c61 7374 5f73 6d74 705f 7472 616e   $last_smtp_tran
+0002fe60: 7361 6374 696f 6e5f 6964 3b0a 0a20 2020  saction_id;..   
+0002fe70: 202f 2a2a 0a20 2020 2020 2a20 5468 6520   /**.     * The 
+0002fe80: 736f 636b 6574 2066 6f72 2074 6865 2073  socket for the s
+0002fe90: 6572 7665 7220 636f 6e6e 6563 7469 6f6e  erver connection
+0002fea0: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+0002feb0: 4076 6172 203f 7265 736f 7572 6365 0a20  @var ?resource. 
+0002fec0: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
+0002fed0: 6374 6564 2024 736d 7470 5f63 6f6e 6e3b  cted $smtp_conn;
+0002fee0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+0002fef0: 2045 7272 6f72 2069 6e66 6f72 6d61 7469   Error informati
+0002ff00: 6f6e 2c20 6966 2061 6e79 2c20 666f 7220  on, if any, for 
+0002ff10: 7468 6520 6c61 7374 2053 4d54 5020 636f  the last SMTP co
+0002ff20: 6d6d 616e 642e 0a20 2020 2020 2a0a 2020  mmand..     *.  
+0002ff30: 2020 202a 2040 7661 7220 6172 7261 790a     * @var array.
+0002ff40: 2020 2020 202a 2f0a 2020 2020 7072 6f74       */.    prot
+0002ff50: 6563 7465 6420 2465 7272 6f72 203d 205b  ected $error = [
+0002ff60: 0a20 2020 2020 2020 2027 6572 726f 7227  .        'error'
+0002ff70: 203d 3e20 2727 2c0a 2020 2020 2020 2020   => '',.        
+0002ff80: 2764 6574 6169 6c27 203d 3e20 2727 2c0a  'detail' => '',.
+0002ff90: 2020 2020 2020 2020 2773 6d74 705f 636f          'smtp_co
+0002ffa0: 6465 2720 3d3e 2027 272c 0a20 2020 2020  de' => '',.     
+0002ffb0: 2020 2027 736d 7470 5f63 6f64 655f 6578     'smtp_code_ex
+0002ffc0: 2720 3d3e 2027 272c 0a20 2020 205d 3b0a  ' => '',.    ];.
+0002ffd0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+0002ffe0: 5468 6520 7265 706c 7920 7468 6520 7365  The reply the se
+0002fff0: 7276 6572 2073 656e 7420 746f 2075 7320  rver sent to us 
+00030000: 666f 7220 4845 4c4f 2e0a 2020 2020 202a  for HELO..     *
+00030010: 2049 6620 6e75 6c6c 2c20 6e6f 2048 454c   If null, no HEL
+00030020: 4f20 7374 7269 6e67 2068 6173 2079 6574  O string has yet
+00030030: 2062 6565 6e20 7265 6365 6976 6564 2e0a   been received..
+00030040: 2020 2020 202a 0a20 2020 2020 2a20 4076       *.     * @v
+00030050: 6172 2073 7472 696e 677c 6e75 6c6c 0a20  ar string|null. 
+00030060: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
+00030070: 6374 6564 2024 6865 6c6f 5f72 706c 793b  cted $helo_rply;
+00030080: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00030090: 2054 6865 2073 6574 206f 6620 534d 5450   The set of SMTP
+000300a0: 2065 7874 656e 7369 6f6e 7320 7365 6e74   extensions sent
+000300b0: 2069 6e20 7265 706c 7920 746f 2045 484c   in reply to EHL
+000300c0: 4f20 636f 6d6d 616e 642e 0a20 2020 2020  O command..     
+000300d0: 2a20 496e 6465 7865 7320 6f66 2074 6865  * Indexes of the
+000300e0: 2061 7272 6179 2061 7265 2065 7874 656e   array are exten
+000300f0: 7369 6f6e 206e 616d 6573 2e0a 2020 2020  sion names..    
+00030100: 202a 2056 616c 7565 2061 7420 696e 6465   * Value at inde
+00030110: 7820 2748 454c 4f27 206f 7220 2745 484c  x 'HELO' or 'EHL
+00030120: 4f27 2028 6163 636f 7264 696e 6720 746f  O' (according to
+00030130: 2063 6f6d 6d61 6e64 2074 6861 7420 7761   command that wa
+00030140: 7320 7365 6e74 290a 2020 2020 202a 2072  s sent).     * r
+00030150: 6570 7265 7365 6e74 7320 7468 6520 7365  epresents the se
+00030160: 7276 6572 206e 616d 652e 2049 6e20 6361  rver name. In ca
+00030170: 7365 206f 6620 4845 4c4f 2069 7420 6973  se of HELO it is
+00030180: 2074 6865 206f 6e6c 7920 656c 656d 656e   the only elemen
+00030190: 7420 6f66 2074 6865 2061 7272 6179 2e0a  t of the array..
+000301a0: 2020 2020 202a 204f 7468 6572 2076 616c       * Other val
+000301b0: 7565 7320 6361 6e20 6265 2062 6f6f 6c65  ues can be boole
+000301c0: 616e 2054 5255 4520 6f72 2061 6e20 6172  an TRUE or an ar
+000301d0: 7261 7920 636f 6e74 6169 6e69 6e67 2065  ray containing e
+000301e0: 7874 656e 7369 6f6e 206f 7074 696f 6e73  xtension options
+000301f0: 2e0a 2020 2020 202a 2049 6620 6e75 6c6c  ..     * If null
+00030200: 2c20 6e6f 2048 454c 4f2f 4548 4c4f 2073  , no HELO/EHLO s
+00030210: 7472 696e 6720 6861 7320 7965 7420 6265  tring has yet be
+00030220: 656e 2072 6563 6569 7665 642e 0a20 2020  en received..   
+00030230: 2020 2a0a 2020 2020 202a 2040 7661 7220    *.     * @var 
+00030240: 6172 7261 797c 6e75 6c6c 0a20 2020 2020  array|null.     
+00030250: 2a2f 0a20 2020 2070 726f 7465 6374 6564  */.    protected
+00030260: 2024 7365 7276 6572 5f63 6170 733b 0a0a   $server_caps;..
+00030270: 2020 2020 2f2a 2a0a 2020 2020 202a 2054      /**.     * T
+00030280: 6865 206d 6f73 7420 7265 6365 6e74 2072  he most recent r
+00030290: 6570 6c79 2072 6563 6569 7665 6420 6672  eply received fr
+000302a0: 6f6d 2074 6865 2073 6572 7665 722e 0a20  om the server.. 
+000302b0: 2020 2020 2a0a 2020 2020 202a 2040 7661      *.     * @va
+000302c0: 7220 7374 7269 6e67 0a20 2020 2020 2a2f  r string.     */
+000302d0: 0a20 2020 2070 726f 7465 6374 6564 2024  .    protected $
+000302e0: 6c61 7374 5f72 6570 6c79 203d 2027 273b  last_reply = '';
+000302f0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00030300: 204f 7574 7075 7420 6465 6275 6767 696e   Output debuggin
+00030310: 6720 696e 666f 2076 6961 2061 2075 7365  g info via a use
+00030320: 722d 7365 6c65 6374 6564 206d 6574 686f  r-selected metho
+00030330: 642e 0a20 2020 2020 2a0a 2020 2020 202a  d..     *.     *
+00030340: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+00030350: 7374 7220 2020 4465 6275 6720 7374 7269  str   Debug stri
+00030360: 6e67 2074 6f20 6f75 7470 7574 0a20 2020  ng to output.   
+00030370: 2020 2a20 4070 6172 616d 2069 6e74 2020    * @param int  
+00030380: 2020 246c 6576 656c 2054 6865 2064 6562    $level The deb
+00030390: 7567 206c 6576 656c 206f 6620 7468 6973  ug level of this
+000303a0: 206d 6573 7361 6765 3b20 7365 6520 4445   message; see DE
+000303b0: 4255 475f 2a20 636f 6e73 7461 6e74 730a  BUG_* constants.
+000303c0: 2020 2020 202a 0a20 2020 2020 2a20 4073       *.     * @s
+000303d0: 6565 2053 4d54 503a 3a24 4465 6275 676f  ee SMTP::$Debugo
+000303e0: 7574 7075 740a 2020 2020 202a 2040 7365  utput.     * @se
+000303f0: 6520 534d 5450 3a3a 2464 6f5f 6465 6275  e SMTP::$do_debu
+00030400: 670a 2020 2020 202a 2f0a 2020 2020 7072  g.     */.    pr
+00030410: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+00030420: 2065 6465 6275 6728 2473 7472 2c20 246c   edebug($str, $l
+00030430: 6576 656c 203d 2030 290a 2020 2020 7b0a  evel = 0).    {.
+00030440: 2020 2020 2020 2020 6966 2028 246c 6576          if ($lev
+00030450: 656c 203e 2024 7468 6973 2d3e 646f 5f64  el > $this->do_d
+00030460: 6562 7567 2920 7b0a 2020 2020 2020 2020  ebug) {.        
+00030470: 2020 2020 7265 7475 726e 3b0a 2020 2020      return;.    
+00030480: 2020 2020 7d0a 2020 2020 2020 2020 2f2f      }.        //
+00030490: 4973 2074 6869 7320 6120 5053 522d 3320  Is this a PSR-3 
+000304a0: 6c6f 6767 6572 3f0a 2020 2020 2020 2020  logger?.        
+000304b0: 6966 2028 2474 6869 732d 3e44 6562 7567  if ($this->Debug
+000304c0: 6f75 7470 7574 2069 6e73 7461 6e63 656f  output instanceo
+000304d0: 6620 5c50 7372 5c4c 6f67 5c4c 6f67 6765  f \Psr\Log\Logge
+000304e0: 7249 6e74 6572 6661 6365 2920 7b0a 2020  rInterface) {.  
+000304f0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00030500: 3e44 6562 7567 6f75 7470 7574 2d3e 6465  >Debugoutput->de
+00030510: 6275 6728 2473 7472 293b 0a0a 2020 2020  bug($str);..    
+00030520: 2020 2020 2020 2020 7265 7475 726e 3b0a          return;.
+00030530: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00030540: 2020 2f2f 4176 6f69 6420 636c 6173 6820    //Avoid clash 
+00030550: 7769 7468 2062 7569 6c74 2d69 6e20 6675  with built-in fu
+00030560: 6e63 7469 6f6e 206e 616d 6573 0a20 2020  nction names.   
+00030570: 2020 2020 2069 6620 2869 735f 6361 6c6c       if (is_call
+00030580: 6162 6c65 2824 7468 6973 2d3e 4465 6275  able($this->Debu
+00030590: 676f 7574 7075 7429 2026 2620 2169 6e5f  goutput) && !in_
+000305a0: 6172 7261 7928 2474 6869 732d 3e44 6562  array($this->Deb
+000305b0: 7567 6f75 7470 7574 2c20 5b27 6572 726f  ugoutput, ['erro
+000305c0: 725f 6c6f 6727 2c20 2768 746d 6c27 2c20  r_log', 'html', 
+000305d0: 2765 6368 6f27 5d29 2920 7b0a 2020 2020  'echo'])) {.    
+000305e0: 2020 2020 2020 2020 6361 6c6c 5f75 7365          call_use
+000305f0: 725f 6675 6e63 2824 7468 6973 2d3e 4465  r_func($this->De
+00030600: 6275 676f 7574 7075 742c 2024 7374 722c  bugoutput, $str,
+00030610: 2024 6c65 7665 6c29 3b0a 0a20 2020 2020   $level);..     
+00030620: 2020 2020 2020 2072 6574 7572 6e3b 0a20         return;. 
+00030630: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00030640: 2073 7769 7463 6820 2824 7468 6973 2d3e   switch ($this->
+00030650: 4465 6275 676f 7574 7075 7429 207b 0a20  Debugoutput) {. 
+00030660: 2020 2020 2020 2020 2020 2063 6173 6520             case 
+00030670: 2765 7272 6f72 5f6c 6f67 273a 0a20 2020  'error_log':.   
+00030680: 2020 2020 2020 2020 2020 2020 202f 2f44               //D
+00030690: 6f6e 2774 206f 7574 7075 742c 206a 7573  on't output, jus
+000306a0: 7420 6c6f 670a 2020 2020 2020 2020 2020  t log.          
+000306b0: 2020 2020 2020 6572 726f 725f 6c6f 6728        error_log(
+000306c0: 2473 7472 293b 0a20 2020 2020 2020 2020  $str);.         
+000306d0: 2020 2020 2020 2062 7265 616b 3b0a 2020         break;.  
+000306e0: 2020 2020 2020 2020 2020 6361 7365 2027            case '
+000306f0: 6874 6d6c 273a 0a20 2020 2020 2020 2020  html':.         
+00030700: 2020 2020 2020 202f 2f43 6c65 616e 7320         //Cleans 
+00030710: 7570 206f 7574 7075 7420 6120 6269 7420  up output a bit 
+00030720: 666f 7220 6120 6265 7474 6572 206c 6f6f  for a better loo
+00030730: 6b69 6e67 2c20 4854 4d4c 2d73 6166 6520  king, HTML-safe 
+00030740: 6f75 7470 7574 0a20 2020 2020 2020 2020  output.         
+00030750: 2020 2020 2020 2065 6368 6f20 676d 6461         echo gmda
+00030760: 7465 2827 592d 6d2d 6420 483a 693a 7327  te('Y-m-d H:i:s'
+00030770: 292c 2027 2027 2c20 6874 6d6c 656e 7469  ), ' ', htmlenti
+00030780: 7469 6573 280a 2020 2020 2020 2020 2020  ties(.          
+00030790: 2020 2020 2020 2020 2020 7072 6567 5f72            preg_r
+000307a0: 6570 6c61 6365 2827 2f5b 5c72 5c6e 5d2b  eplace('/[\r\n]+
+000307b0: 2f27 2c20 2727 2c20 2473 7472 292c 0a20  /', '', $str),. 
+000307c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000307d0: 2020 2045 4e54 5f51 554f 5445 532c 0a20     ENT_QUOTES,. 
+000307e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000307f0: 2020 2027 5554 462d 3827 0a20 2020 2020     'UTF-8'.     
+00030800: 2020 2020 2020 2020 2020 2029 2c20 223c             ), "<
+00030810: 6272 3e5c 6e22 3b0a 2020 2020 2020 2020  br>\n";.        
+00030820: 2020 2020 2020 2020 6272 6561 6b3b 0a20          break;. 
+00030830: 2020 2020 2020 2020 2020 2063 6173 6520             case 
+00030840: 2765 6368 6f27 3a0a 2020 2020 2020 2020  'echo':.        
+00030850: 2020 2020 6465 6661 756c 743a 0a20 2020      default:.   
+00030860: 2020 2020 2020 2020 2020 2020 202f 2f4e               //N
+00030870: 6f72 6d61 6c69 7a65 206c 696e 6520 6272  ormalize line br
+00030880: 6561 6b73 0a20 2020 2020 2020 2020 2020  eaks.           
+00030890: 2020 2020 2024 7374 7220 3d20 7072 6567       $str = preg
+000308a0: 5f72 6570 6c61 6365 2827 2f5c 725c 6e7c  _replace('/\r\n|
+000308b0: 5c72 2f6d 272c 2022 5c6e 222c 2024 7374  \r/m', "\n", $st
+000308c0: 7229 3b0a 2020 2020 2020 2020 2020 2020  r);.            
+000308d0: 2020 2020 6563 686f 2067 6d64 6174 6528      echo gmdate(
+000308e0: 2759 2d6d 2d64 2048 3a69 3a73 2729 2c0a  'Y-m-d H:i:s'),.
+000308f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030900: 225c 7422 2c0a 2020 2020 2020 2020 2020  "\t",.          
+00030910: 2020 2020 2020 2020 2020 2f2f 5472 696d            //Trim
+00030920: 2074 7261 696c 696e 6720 7370 6163 650a   trailing space.
+00030930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030940: 7472 696d 280a 2020 2020 2020 2020 2020  trim(.          
+00030950: 2020 2020 2020 2020 2020 2f2f 496e 6465            //Inde
+00030960: 6e74 2066 6f72 2072 6561 6461 6269 6c69  nt for readabili
+00030970: 7479 2c20 6578 6365 7074 2066 6f72 2074  ty, except for t
+00030980: 7261 696c 696e 6720 6272 6561 6b0a 2020  railing break.  
+00030990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000309a0: 2020 7374 725f 7265 706c 6163 6528 0a20    str_replace(. 
+000309b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000309c0: 2020 2020 2020 2022 5c6e 222c 0a20 2020         "\n",.   
+000309d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000309e0: 2020 2020 2022 5c6e 2020 2020 2020 2020       "\n        
+000309f0: 2020 2020 2020 2020 2020 205c 7420 2020             \t   
+00030a00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00030a10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00030a20: 2020 2020 2020 2020 2020 7472 696d 2824            trim($
+00030a30: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
+00030a40: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00030a50: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00030a60: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+00030a70: 6e22 3b0a 2020 2020 2020 2020 7d0a 2020  n";.        }.  
+00030a80: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+00030a90: 2020 2a20 436f 6e6e 6563 7420 746f 2061    * Connect to a
+00030aa0: 6e20 534d 5450 2073 6572 7665 722e 0a20  n SMTP server.. 
+00030ab0: 2020 2020 2a0a 2020 2020 202a 2040 7061      *.     * @pa
+00030ac0: 7261 6d20 7374 7269 6e67 2024 686f 7374  ram string $host
+00030ad0: 2020 2020 534d 5450 2073 6572 7665 7220      SMTP server 
+00030ae0: 4950 206f 7220 686f 7374 206e 616d 650a  IP or host name.
+00030af0: 2020 2020 202a 2040 7061 7261 6d20 696e       * @param in
+00030b00: 7420 2020 2024 706f 7274 2020 2020 5468  t    $port    Th
+00030b10: 6520 706f 7274 206e 756d 6265 7220 746f  e port number to
+00030b20: 2063 6f6e 6e65 6374 2074 6f0a 2020 2020   connect to.    
+00030b30: 202a 2040 7061 7261 6d20 696e 7420 2020   * @param int   
+00030b40: 2024 7469 6d65 6f75 7420 486f 7720 6c6f   $timeout How lo
+00030b50: 6e67 2074 6f20 7761 6974 2066 6f72 2074  ng to wait for t
+00030b60: 6865 2063 6f6e 6e65 6374 696f 6e20 746f  he connection to
+00030b70: 206f 7065 6e0a 2020 2020 202a 2040 7061   open.     * @pa
+00030b80: 7261 6d20 6172 7261 7920 2024 6f70 7469  ram array  $opti
+00030b90: 6f6e 7320 416e 2061 7272 6179 206f 6620  ons An array of 
+00030ba0: 6f70 7469 6f6e 7320 666f 7220 7374 7265  options for stre
+00030bb0: 616d 5f63 6f6e 7465 7874 5f63 7265 6174  am_context_creat
+00030bc0: 6528 290a 2020 2020 202a 0a20 2020 2020  e().     *.     
+00030bd0: 2a20 4072 6574 7572 6e20 626f 6f6c 0a20  * @return bool. 
+00030be0: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00030bf0: 6320 6675 6e63 7469 6f6e 2063 6f6e 6e65  c function conne
+00030c00: 6374 2824 686f 7374 2c20 2470 6f72 7420  ct($host, $port 
+00030c10: 3d20 6e75 6c6c 2c20 2474 696d 656f 7574  = null, $timeout
+00030c20: 203d 2033 302c 2024 6f70 7469 6f6e 7320   = 30, $options 
+00030c30: 3d20 5b5d 290a 2020 2020 7b0a 2020 2020  = []).    {.    
+00030c40: 2020 2020 2f2f 436c 6561 7220 6572 726f      //Clear erro
+00030c50: 7273 2074 6f20 6176 6f69 6420 636f 6e66  rs to avoid conf
+00030c60: 7573 696f 6e0a 2020 2020 2020 2020 2474  usion.        $t
+00030c70: 6869 732d 3e73 6574 4572 726f 7228 2727  his->setError(''
+00030c80: 293b 0a20 2020 2020 2020 202f 2f4d 616b  );.        //Mak
+00030c90: 6520 7375 7265 2077 6520 6172 6520 5f5f  e sure we are __
+00030ca0: 6e6f 745f 5f20 636f 6e6e 6563 7465 640a  not__ connected.
+00030cb0: 2020 2020 2020 2020 6966 2028 2474 6869          if ($thi
+00030cc0: 732d 3e63 6f6e 6e65 6374 6564 2829 2920  s->connected()) 
+00030cd0: 7b0a 2020 2020 2020 2020 2020 2020 2f2f  {.            //
+00030ce0: 416c 7265 6164 7920 636f 6e6e 6563 7465  Already connecte
+00030cf0: 642c 2067 656e 6572 6174 6520 6572 726f  d, generate erro
+00030d00: 720a 2020 2020 2020 2020 2020 2020 2474  r.            $t
+00030d10: 6869 732d 3e73 6574 4572 726f 7228 2741  his->setError('A
+00030d20: 6c72 6561 6479 2063 6f6e 6e65 6374 6564  lready connected
+00030d30: 2074 6f20 6120 7365 7276 6572 2729 3b0a   to a server');.
+00030d40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00030d50: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
+00030d60: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
+00030d70: 2865 6d70 7479 2824 706f 7274 2929 207b  (empty($port)) {
+00030d80: 0a20 2020 2020 2020 2020 2020 2024 706f  .            $po
+00030d90: 7274 203d 2073 656c 663a 3a44 4546 4155  rt = self::DEFAU
+00030da0: 4c54 5f50 4f52 543b 0a20 2020 2020 2020  LT_PORT;.       
+00030db0: 207d 0a20 2020 2020 2020 202f 2f43 6f6e   }.        //Con
+00030dc0: 6e65 6374 2074 6f20 7468 6520 534d 5450  nect to the SMTP
+00030dd0: 2073 6572 7665 720a 2020 2020 2020 2020   server.        
+00030de0: 2474 6869 732d 3e65 6465 6275 6728 0a20  $this->edebug(. 
+00030df0: 2020 2020 2020 2020 2020 2022 436f 6e6e             "Conn
+00030e00: 6563 7469 6f6e 3a20 6f70 656e 696e 6720  ection: opening 
+00030e10: 746f 2024 686f 7374 3a24 706f 7274 2c20  to $host:$port, 
+00030e20: 7469 6d65 6f75 743d 2474 696d 656f 7574  timeout=$timeout
+00030e30: 2c20 6f70 7469 6f6e 733d 2220 2e0a 2020  , options=" ..  
+00030e40: 2020 2020 2020 2020 2020 2863 6f75 6e74            (count
+00030e50: 2824 6f70 7469 6f6e 7329 203e 2030 203f  ($options) > 0 ?
+00030e60: 2076 6172 5f65 7870 6f72 7428 246f 7074   var_export($opt
+00030e70: 696f 6e73 2c20 7472 7565 2920 3a20 2761  ions, true) : 'a
+00030e80: 7272 6179 2829 2729 2c0a 2020 2020 2020  rray()'),.      
+00030e90: 2020 2020 2020 7365 6c66 3a3a 4445 4255        self::DEBU
+00030ea0: 475f 434f 4e4e 4543 5449 4f4e 0a20 2020  G_CONNECTION.   
+00030eb0: 2020 2020 2029 3b0a 0a20 2020 2020 2020       );..       
+00030ec0: 2024 7468 6973 2d3e 736d 7470 5f63 6f6e   $this->smtp_con
+00030ed0: 6e20 3d20 2474 6869 732d 3e67 6574 534d  n = $this->getSM
+00030ee0: 5450 436f 6e6e 6563 7469 6f6e 2824 686f  TPConnection($ho
+00030ef0: 7374 2c20 2470 6f72 742c 2024 7469 6d65  st, $port, $time
+00030f00: 6f75 742c 2024 6f70 7469 6f6e 7329 3b0a  out, $options);.
+00030f10: 0a20 2020 2020 2020 2069 6620 2824 7468  .        if ($th
+00030f20: 6973 2d3e 736d 7470 5f63 6f6e 6e20 3d3d  is->smtp_conn ==
+00030f30: 3d20 6661 6c73 6529 207b 0a20 2020 2020  = false) {.     
+00030f40: 2020 2020 2020 202f 2f45 7272 6f72 2069         //Error i
+00030f50: 6e66 6f20 616c 7265 6164 7920 7365 7420  nfo already set 
+00030f60: 696e 7369 6465 2060 6765 7453 4d54 5043  inside `getSMTPC
+00030f70: 6f6e 6e65 6374 696f 6e28 2960 0a20 2020  onnection()`.   
+00030f80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00030f90: 6661 6c73 653b 0a20 2020 2020 2020 207d  false;.        }
+00030fa0: 0a0a 2020 2020 2020 2020 2474 6869 732d  ..        $this-
+00030fb0: 3e65 6465 6275 6728 2743 6f6e 6e65 6374  >edebug('Connect
+00030fc0: 696f 6e3a 206f 7065 6e65 6427 2c20 7365  ion: opened', se
+00030fd0: 6c66 3a3a 4445 4255 475f 434f 4e4e 4543  lf::DEBUG_CONNEC
+00030fe0: 5449 4f4e 293b 0a0a 2020 2020 2020 2020  TION);..        
+00030ff0: 2f2f 4765 7420 616e 7920 616e 6e6f 756e  //Get any announ
+00031000: 6365 6d65 6e74 0a20 2020 2020 2020 2024  cement.        $
+00031010: 7468 6973 2d3e 6c61 7374 5f72 6570 6c79  this->last_reply
+00031020: 203d 2024 7468 6973 2d3e 6765 745f 6c69   = $this->get_li
+00031030: 6e65 7328 293b 0a20 2020 2020 2020 2024  nes();.        $
+00031040: 7468 6973 2d3e 6564 6562 7567 2827 5345  this->edebug('SE
+00031050: 5256 4552 202d 3e20 434c 4945 4e54 3a20  RVER -> CLIENT: 
+00031060: 2720 2e20 2474 6869 732d 3e6c 6173 745f  ' . $this->last_
+00031070: 7265 706c 792c 2073 656c 663a 3a44 4542  reply, self::DEB
+00031080: 5547 5f53 4552 5645 5229 3b0a 2020 2020  UG_SERVER);.    
+00031090: 2020 2020 2472 6573 706f 6e73 6543 6f64      $responseCod
+000310a0: 6520 3d20 2869 6e74 2973 7562 7374 7228  e = (int)substr(
+000310b0: 2474 6869 732d 3e6c 6173 745f 7265 706c  $this->last_repl
+000310c0: 792c 2030 2c20 3329 3b0a 2020 2020 2020  y, 0, 3);.      
+000310d0: 2020 6966 2028 2472 6573 706f 6e73 6543    if ($responseC
+000310e0: 6f64 6520 3d3d 3d20 3232 3029 207b 0a20  ode === 220) {. 
+000310f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00031100: 6e20 7472 7565 3b0a 2020 2020 2020 2020  n true;.        
+00031110: 7d0a 2020 2020 2020 2020 2f2f 416e 7974  }.        //Anyt
+00031120: 6869 6e67 206f 7468 6572 2074 6861 6e20  hing other than 
+00031130: 6120 3232 3020 7265 7370 6f6e 7365 206d  a 220 response m
+00031140: 6561 6e73 2073 6f6d 6574 6869 6e67 2077  eans something w
+00031150: 656e 7420 7772 6f6e 670a 2020 2020 2020  ent wrong.      
+00031160: 2020 2f2f 5246 4320 3533 3231 2073 6179    //RFC 5321 say
+00031170: 7320 7468 6520 7365 7276 6572 2077 696c  s the server wil
+00031180: 6c20 7761 6974 2066 6f72 2075 7320 746f  l wait for us to
+00031190: 2073 656e 6420 6120 5155 4954 2069 6e20   send a QUIT in 
+000311a0: 7265 7370 6f6e 7365 2074 6f20 6120 3535  response to a 55
+000311b0: 3420 6572 726f 720a 2020 2020 2020 2020  4 error.        
+000311c0: 2f2f 6874 7470 733a 2f2f 746f 6f6c 732e  //https://tools.
+000311d0: 6965 7466 2e6f 7267 2f68 746d 6c2f 7266  ietf.org/html/rf
+000311e0: 6335 3332 3123 7365 6374 696f 6e2d 332e  c5321#section-3.
+000311f0: 310a 2020 2020 2020 2020 6966 2028 2472  1.        if ($r
+00031200: 6573 706f 6e73 6543 6f64 6520 3d3d 3d20  esponseCode === 
+00031210: 3535 3429 207b 0a20 2020 2020 2020 2020  554) {.         
+00031220: 2020 2024 7468 6973 2d3e 7175 6974 2829     $this->quit()
+00031230: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
+00031240: 2020 2020 2f2f 5468 6973 2077 696c 6c20      //This will 
+00031250: 6861 6e64 6c65 2034 3231 2072 6573 706f  handle 421 respo
+00031260: 6e73 6573 2077 6869 6368 206d 6179 206e  nses which may n
+00031270: 6f74 2077 6169 7420 666f 7220 6120 5155  ot wait for a QU
+00031280: 4954 2028 652e 672e 2069 6620 7468 6520  IT (e.g. if the 
+00031290: 7365 7276 6572 2069 7320 6265 696e 6720  server is being 
+000312a0: 7368 7574 2064 6f77 6e29 0a20 2020 2020  shut down).     
+000312b0: 2020 2024 7468 6973 2d3e 6564 6562 7567     $this->edebug
+000312c0: 2827 436f 6e6e 6563 7469 6f6e 3a20 636c  ('Connection: cl
+000312d0: 6f73 696e 6720 6475 6520 746f 2065 7272  osing due to err
+000312e0: 6f72 272c 2073 656c 663a 3a44 4542 5547  or', self::DEBUG
+000312f0: 5f43 4f4e 4e45 4354 494f 4e29 3b0a 2020  _CONNECTION);.  
+00031300: 2020 2020 2020 2474 6869 732d 3e63 6c6f        $this->clo
+00031310: 7365 2829 3b0a 2020 2020 2020 2020 7265  se();.        re
+00031320: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
+00031330: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00031340: 2a20 4372 6561 7465 2063 6f6e 6e65 6374  * Create connect
+00031350: 696f 6e20 746f 2074 6865 2053 4d54 5020  ion to the SMTP 
+00031360: 7365 7276 6572 2e0a 2020 2020 202a 0a20  server..     *. 
+00031370: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00031380: 696e 6720 2468 6f73 7420 2020 2053 4d54  ing $host    SMT
+00031390: 5020 7365 7276 6572 2049 5020 6f72 2068  P server IP or h
+000313a0: 6f73 7420 6e61 6d65 0a20 2020 2020 2a20  ost name.     * 
+000313b0: 4070 6172 616d 2069 6e74 2020 2020 2470  @param int    $p
+000313c0: 6f72 7420 2020 2054 6865 2070 6f72 7420  ort    The port 
+000313d0: 6e75 6d62 6572 2074 6f20 636f 6e6e 6563  number to connec
+000313e0: 7420 746f 0a20 2020 2020 2a20 4070 6172  t to.     * @par
+000313f0: 616d 2069 6e74 2020 2020 2474 696d 656f  am int    $timeo
+00031400: 7574 2048 6f77 206c 6f6e 6720 746f 2077  ut How long to w
+00031410: 6169 7420 666f 7220 7468 6520 636f 6e6e  ait for the conn
+00031420: 6563 7469 6f6e 2074 6f20 6f70 656e 0a20  ection to open. 
+00031430: 2020 2020 2a20 4070 6172 616d 2061 7272      * @param arr
+00031440: 6179 2020 246f 7074 696f 6e73 2041 6e20  ay  $options An 
+00031450: 6172 7261 7920 6f66 206f 7074 696f 6e73  array of options
+00031460: 2066 6f72 2073 7472 6561 6d5f 636f 6e74   for stream_cont
+00031470: 6578 745f 6372 6561 7465 2829 0a20 2020  ext_create().   
+00031480: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+00031490: 726e 2066 616c 7365 7c72 6573 6f75 7263  rn false|resourc
+000314a0: 650a 2020 2020 202a 2f0a 2020 2020 7072  e.     */.    pr
+000314b0: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+000314c0: 2067 6574 534d 5450 436f 6e6e 6563 7469   getSMTPConnecti
+000314d0: 6f6e 2824 686f 7374 2c20 2470 6f72 7420  on($host, $port 
+000314e0: 3d20 6e75 6c6c 2c20 2474 696d 656f 7574  = null, $timeout
+000314f0: 203d 2033 302c 2024 6f70 7469 6f6e 7320   = 30, $options 
+00031500: 3d20 5b5d 290a 2020 2020 7b0a 2020 2020  = []).    {.    
+00031510: 2020 2020 7374 6174 6963 2024 7374 7265      static $stre
+00031520: 616d 6f6b 3b0a 2020 2020 2020 2020 2f2f  amok;.        //
+00031530: 5468 6973 2069 7320 656e 6162 6c65 6420  This is enabled 
+00031540: 6279 2064 6566 6175 6c74 2073 696e 6365  by default since
+00031550: 2035 2e30 2e30 2062 7574 2073 6f6d 6520   5.0.0 but some 
+00031560: 7072 6f76 6964 6572 7320 6469 7361 626c  providers disabl
+00031570: 6520 6974 0a20 2020 2020 2020 202f 2f43  e it.        //C
+00031580: 6865 636b 2074 6869 7320 6f6e 6365 2061  heck this once a
+00031590: 6e64 2063 6163 6865 2074 6865 2072 6573  nd cache the res
+000315a0: 756c 740a 2020 2020 2020 2020 6966 2028  ult.        if (
+000315b0: 6e75 6c6c 203d 3d3d 2024 7374 7265 616d  null === $stream
+000315c0: 6f6b 2920 7b0a 2020 2020 2020 2020 2020  ok) {.          
+000315d0: 2020 2473 7472 6561 6d6f 6b20 3d20 6675    $streamok = fu
+000315e0: 6e63 7469 6f6e 5f65 7869 7374 7328 2773  nction_exists('s
+000315f0: 7472 6561 6d5f 736f 636b 6574 5f63 6c69  tream_socket_cli
+00031600: 656e 7427 293b 0a20 2020 2020 2020 207d  ent');.        }
+00031610: 0a0a 2020 2020 2020 2020 2465 7272 6e6f  ..        $errno
+00031620: 203d 2030 3b0a 2020 2020 2020 2020 2465   = 0;.        $e
+00031630: 7272 7374 7220 3d20 2727 3b0a 2020 2020  rrstr = '';.    
+00031640: 2020 2020 6966 2028 2473 7472 6561 6d6f      if ($streamo
+00031650: 6b29 207b 0a20 2020 2020 2020 2020 2020  k) {.           
+00031660: 2024 736f 636b 6574 5f63 6f6e 7465 7874   $socket_context
+00031670: 203d 2073 7472 6561 6d5f 636f 6e74 6578   = stream_contex
+00031680: 745f 6372 6561 7465 2824 6f70 7469 6f6e  t_create($option
+00031690: 7329 3b0a 2020 2020 2020 2020 2020 2020  s);.            
+000316a0: 7365 745f 6572 726f 725f 6861 6e64 6c65  set_error_handle
+000316b0: 7228 5b24 7468 6973 2c20 2765 7272 6f72  r([$this, 'error
+000316c0: 4861 6e64 6c65 7227 5d29 3b0a 2020 2020  Handler']);.    
+000316d0: 2020 2020 2020 2020 2463 6f6e 6e65 6374          $connect
+000316e0: 696f 6e20 3d20 7374 7265 616d 5f73 6f63  ion = stream_soc
+000316f0: 6b65 745f 636c 6965 6e74 280a 2020 2020  ket_client(.    
+00031700: 2020 2020 2020 2020 2020 2020 2468 6f73              $hos
+00031710: 7420 2e20 273a 2720 2e20 2470 6f72 742c  t . ':' . $port,
+00031720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031730: 2024 6572 726e 6f2c 0a20 2020 2020 2020   $errno,.       
+00031740: 2020 2020 2020 2020 2024 6572 7273 7472           $errstr
+00031750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00031760: 2020 2474 696d 656f 7574 2c0a 2020 2020    $timeout,.    
+00031770: 2020 2020 2020 2020 2020 2020 5354 5245              STRE
+00031780: 414d 5f43 4c49 454e 545f 434f 4e4e 4543  AM_CLIENT_CONNEC
+00031790: 542c 0a20 2020 2020 2020 2020 2020 2020  T,.             
+000317a0: 2020 2024 736f 636b 6574 5f63 6f6e 7465     $socket_conte
+000317b0: 7874 0a20 2020 2020 2020 2020 2020 2029  xt.            )
+000317c0: 3b0a 2020 2020 2020 2020 7d20 656c 7365  ;.        } else
+000317d0: 207b 0a20 2020 2020 2020 2020 2020 202f   {.            /
+000317e0: 2f46 616c 6c20 6261 636b 2074 6f20 6673  /Fall back to fs
+000317f0: 6f63 6b6f 7065 6e20 7768 6963 6820 7368  ockopen which sh
+00031800: 6f75 6c64 2077 6f72 6b20 696e 206d 6f72  ould work in mor
+00031810: 6520 706c 6163 6573 2c20 6275 7420 6973  e places, but is
+00031820: 206d 6973 7369 6e67 2073 6f6d 6520 6665   missing some fe
+00031830: 6174 7572 6573 0a20 2020 2020 2020 2020  atures.         
+00031840: 2020 2024 7468 6973 2d3e 6564 6562 7567     $this->edebug
+00031850: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00031860: 2020 2743 6f6e 6e65 6374 696f 6e3a 2073    'Connection: s
+00031870: 7472 6561 6d5f 736f 636b 6574 5f63 6c69  tream_socket_cli
+00031880: 656e 7420 6e6f 7420 6176 6169 6c61 626c  ent not availabl
+00031890: 652c 2066 616c 6c69 6e67 2062 6163 6b20  e, falling back 
+000318a0: 746f 2066 736f 636b 6f70 656e 272c 0a20  to fsockopen',. 
+000318b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000318c0: 656c 663a 3a44 4542 5547 5f43 4f4e 4e45  elf::DEBUG_CONNE
+000318d0: 4354 494f 4e0a 2020 2020 2020 2020 2020  CTION.          
+000318e0: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
+000318f0: 2073 6574 5f65 7272 6f72 5f68 616e 646c   set_error_handl
+00031900: 6572 285b 2474 6869 732c 2027 6572 726f  er([$this, 'erro
+00031910: 7248 616e 646c 6572 275d 293b 0a20 2020  rHandler']);.   
+00031920: 2020 2020 2020 2020 2024 636f 6e6e 6563           $connec
+00031930: 7469 6f6e 203d 2066 736f 636b 6f70 656e  tion = fsockopen
+00031940: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00031950: 2020 2468 6f73 742c 0a20 2020 2020 2020    $host,.       
+00031960: 2020 2020 2020 2020 2024 706f 7274 2c0a           $port,.
+00031970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031980: 2465 7272 6e6f 2c0a 2020 2020 2020 2020  $errno,.        
+00031990: 2020 2020 2020 2020 2465 7272 7374 722c          $errstr,
+000319a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000319b0: 2024 7469 6d65 6f75 740a 2020 2020 2020   $timeout.      
+000319c0: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
+000319d0: 207d 0a20 2020 2020 2020 2072 6573 746f   }.        resto
+000319e0: 7265 5f65 7272 6f72 5f68 616e 646c 6572  re_error_handler
+000319f0: 2829 3b0a 0a20 2020 2020 2020 202f 2f56  ();..        //V
+00031a00: 6572 6966 7920 7765 2063 6f6e 6e65 6374  erify we connect
+00031a10: 6564 2070 726f 7065 726c 790a 2020 2020  ed properly.    
+00031a20: 2020 2020 6966 2028 2169 735f 7265 736f      if (!is_reso
+00031a30: 7572 6365 2824 636f 6e6e 6563 7469 6f6e  urce($connection
+00031a40: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00031a50: 2024 7468 6973 2d3e 7365 7445 7272 6f72   $this->setError
+00031a60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00031a70: 2020 2746 6169 6c65 6420 746f 2063 6f6e    'Failed to con
+00031a80: 6e65 6374 2074 6f20 7365 7276 6572 272c  nect to server',
+00031a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031aa0: 2027 272c 0a20 2020 2020 2020 2020 2020   '',.           
+00031ab0: 2020 2020 2028 7374 7269 6e67 2920 2465       (string) $e
+00031ac0: 7272 6e6f 2c0a 2020 2020 2020 2020 2020  rrno,.          
+00031ad0: 2020 2020 2020 2465 7272 7374 720a 2020        $errstr.  
+00031ae0: 2020 2020 2020 2020 2020 293b 0a20 2020            );.   
+00031af0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00031b00: 6564 6562 7567 280a 2020 2020 2020 2020  edebug(.        
+00031b10: 2020 2020 2020 2020 2753 4d54 5020 4552          'SMTP ER
+00031b20: 524f 523a 2027 202e 2024 7468 6973 2d3e  ROR: ' . $this->
+00031b30: 6572 726f 725b 2765 7272 6f72 275d 0a20  error['error']. 
+00031b40: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00031b50: 2022 3a20 2465 7272 7374 7220 2824 6572   ": $errstr ($er
+00031b60: 726e 6f29 222c 0a20 2020 2020 2020 2020  rno)",.         
+00031b70: 2020 2020 2020 2073 656c 663a 3a44 4542         self::DEB
+00031b80: 5547 5f43 4c49 454e 540a 2020 2020 2020  UG_CLIENT.      
+00031b90: 2020 2020 2020 293b 0a0a 2020 2020 2020        );..      
+00031ba0: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+00031bb0: 7365 3b0a 2020 2020 2020 2020 7d0a 0a20  se;.        }.. 
+00031bc0: 2020 2020 2020 202f 2f53 4d54 5020 7365         //SMTP se
+00031bd0: 7276 6572 2063 616e 2074 616b 6520 6c6f  rver can take lo
+00031be0: 6e67 6572 2074 6f20 7265 7370 6f6e 642c  nger to respond,
+00031bf0: 2067 6976 6520 6c6f 6e67 6572 2074 696d   give longer tim
+00031c00: 656f 7574 2066 6f72 2066 6972 7374 2072  eout for first r
+00031c10: 6561 640a 2020 2020 2020 2020 2f2f 5769  ead.        //Wi
+00031c20: 6e64 6f77 7320 646f 6573 206e 6f74 2068  ndows does not h
+00031c30: 6176 6520 7375 7070 6f72 7420 666f 7220  ave support for 
+00031c40: 7468 6973 2074 696d 656f 7574 2066 756e  this timeout fun
+00031c50: 6374 696f 6e0a 2020 2020 2020 2020 6966  ction.        if
+00031c60: 2028 7374 7270 6f73 2850 4850 5f4f 532c   (strpos(PHP_OS,
+00031c70: 2027 5749 4e27 2920 213d 3d20 3029 207b   'WIN') !== 0) {
+00031c80: 0a20 2020 2020 2020 2020 2020 2024 6d61  .            $ma
+00031c90: 7820 3d20 2869 6e74 2969 6e69 5f67 6574  x = (int)ini_get
+00031ca0: 2827 6d61 785f 6578 6563 7574 696f 6e5f  ('max_execution_
+00031cb0: 7469 6d65 2729 3b0a 2020 2020 2020 2020  time');.        
+00031cc0: 2020 2020 2f2f 446f 6e27 7420 626f 7468      //Don't both
+00031cd0: 6572 2069 6620 756e 6c69 6d69 7465 642c  er if unlimited,
+00031ce0: 206f 7220 6966 2073 6574 5f74 696d 655f   or if set_time_
+00031cf0: 6c69 6d69 7420 6973 2064 6973 6162 6c65  limit is disable
+00031d00: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+00031d10: 2028 3020 213d 3d20 246d 6178 2026 2620   (0 !== $max && 
+00031d20: 2474 696d 656f 7574 203e 2024 6d61 7820  $timeout > $max 
+00031d30: 2626 2073 7472 706f 7328 696e 695f 6765  && strpos(ini_ge
+00031d40: 7428 2764 6973 6162 6c65 5f66 756e 6374  t('disable_funct
+00031d50: 696f 6e73 2729 2c20 2773 6574 5f74 696d  ions'), 'set_tim
+00031d60: 655f 6c69 6d69 7427 2920 3d3d 3d20 6661  e_limit') === fa
+00031d70: 6c73 6529 207b 0a20 2020 2020 2020 2020  lse) {.         
+00031d80: 2020 2020 2020 2040 7365 745f 7469 6d65         @set_time
+00031d90: 5f6c 696d 6974 2824 7469 6d65 6f75 7429  _limit($timeout)
+00031da0: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
+00031db0: 2020 2020 2020 2020 2020 2020 7374 7265              stre
+00031dc0: 616d 5f73 6574 5f74 696d 656f 7574 2824  am_set_timeout($
+00031dd0: 636f 6e6e 6563 7469 6f6e 2c20 2474 696d  connection, $tim
+00031de0: 656f 7574 2c20 3029 3b0a 2020 2020 2020  eout, 0);.      
+00031df0: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
+00031e00: 7572 6e20 2463 6f6e 6e65 6374 696f 6e3b  urn $connection;
+00031e10: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+00031e20: 2020 2020 202a 2049 6e69 7469 6174 6520       * Initiate 
+00031e30: 6120 544c 5320 2865 6e63 7279 7074 6564  a TLS (encrypted
+00031e40: 2920 7365 7373 696f 6e2e 0a20 2020 2020  ) session..     
+00031e50: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+00031e60: 2062 6f6f 6c0a 2020 2020 202a 2f0a 2020   bool.     */.  
+00031e70: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+00031e80: 6e20 7374 6172 7454 4c53 2829 0a20 2020  n startTLS().   
+00031e90: 207b 0a20 2020 2020 2020 2069 6620 2821   {.        if (!
+00031ea0: 2474 6869 732d 3e73 656e 6443 6f6d 6d61  $this->sendComma
+00031eb0: 6e64 2827 5354 4152 5454 4c53 272c 2027  nd('STARTTLS', '
+00031ec0: 5354 4152 5454 4c53 272c 2032 3230 2929  STARTTLS', 220))
+00031ed0: 207b 0a20 2020 2020 2020 2020 2020 2072   {.            r
+00031ee0: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
+00031ef0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00031f00: 2f2f 416c 6c6f 7720 7468 6520 6265 7374  //Allow the best
+00031f10: 2054 4c53 2076 6572 7369 6f6e 2873 2920   TLS version(s) 
+00031f20: 7765 2063 616e 0a20 2020 2020 2020 2024  we can.        $
+00031f30: 6372 7970 746f 5f6d 6574 686f 6420 3d20  crypto_method = 
+00031f40: 5354 5245 414d 5f43 5259 5054 4f5f 4d45  STREAM_CRYPTO_ME
+00031f50: 5448 4f44 5f54 4c53 5f43 4c49 454e 543b  THOD_TLS_CLIENT;
+00031f60: 0a0a 2020 2020 2020 2020 2f2f 5048 5020  ..        //PHP 
+00031f70: 352e 362e 3720 6472 6f70 7065 6420 696e  5.6.7 dropped in
+00031f80: 636c 7573 696f 6e20 6f66 2054 4c53 2031  clusion of TLS 1
+00031f90: 2e31 2061 6e64 2031 2e32 2069 6e20 5354  .1 and 1.2 in ST
+00031fa0: 5245 414d 5f43 5259 5054 4f5f 4d45 5448  REAM_CRYPTO_METH
+00031fb0: 4f44 5f54 4c53 5f43 4c49 454e 540a 2020  OD_TLS_CLIENT.  
+00031fc0: 2020 2020 2020 2f2f 736f 2061 6464 2074        //so add t
+00031fd0: 6865 6d20 6261 636b 2069 6e20 6d61 6e75  hem back in manu
+00031fe0: 616c 6c79 2069 6620 7765 2063 616e 0a20  ally if we can. 
+00031ff0: 2020 2020 2020 2069 6620 2864 6566 696e         if (defin
+00032000: 6564 2827 5354 5245 414d 5f43 5259 5054  ed('STREAM_CRYPT
+00032010: 4f5f 4d45 5448 4f44 5f54 4c53 7631 5f32  O_METHOD_TLSv1_2
+00032020: 5f43 4c49 454e 5427 2929 207b 0a20 2020  _CLIENT')) {.   
+00032030: 2020 2020 2020 2020 2024 6372 7970 746f           $crypto
+00032040: 5f6d 6574 686f 6420 7c3d 2053 5452 4541  _method |= STREA
+00032050: 4d5f 4352 5950 544f 5f4d 4554 484f 445f  M_CRYPTO_METHOD_
+00032060: 544c 5376 315f 325f 434c 4945 4e54 3b0a  TLSv1_2_CLIENT;.
+00032070: 2020 2020 2020 2020 2020 2020 2463 7279              $cry
+00032080: 7074 6f5f 6d65 7468 6f64 207c 3d20 5354  pto_method |= ST
+00032090: 5245 414d 5f43 5259 5054 4f5f 4d45 5448  REAM_CRYPTO_METH
+000320a0: 4f44 5f54 4c53 7631 5f31 5f43 4c49 454e  OD_TLSv1_1_CLIEN
+000320b0: 543b 0a20 2020 2020 2020 207d 0a0a 2020  T;.        }..  
+000320c0: 2020 2020 2020 2f2f 4265 6769 6e20 656e        //Begin en
+000320d0: 6372 7970 7465 6420 636f 6e6e 6563 7469  crypted connecti
+000320e0: 6f6e 0a20 2020 2020 2020 2073 6574 5f65  on.        set_e
+000320f0: 7272 6f72 5f68 616e 646c 6572 285b 2474  rror_handler([$t
+00032100: 6869 732c 2027 6572 726f 7248 616e 646c  his, 'errorHandl
+00032110: 6572 275d 293b 0a20 2020 2020 2020 2024  er']);.        $
+00032120: 6372 7970 746f 5f6f 6b20 3d20 7374 7265  crypto_ok = stre
+00032130: 616d 5f73 6f63 6b65 745f 656e 6162 6c65  am_socket_enable
+00032140: 5f63 7279 7074 6f28 0a20 2020 2020 2020  _crypto(.       
+00032150: 2020 2020 2024 7468 6973 2d3e 736d 7470       $this->smtp
+00032160: 5f63 6f6e 6e2c 0a20 2020 2020 2020 2020  _conn,.         
+00032170: 2020 2074 7275 652c 0a20 2020 2020 2020     true,.       
+00032180: 2020 2020 2024 6372 7970 746f 5f6d 6574       $crypto_met
+00032190: 686f 640a 2020 2020 2020 2020 293b 0a20  hod.        );. 
+000321a0: 2020 2020 2020 2072 6573 746f 7265 5f65         restore_e
+000321b0: 7272 6f72 5f68 616e 646c 6572 2829 3b0a  rror_handler();.
+000321c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000321d0: 2862 6f6f 6c29 2024 6372 7970 746f 5f6f  (bool) $crypto_o
+000321e0: 6b3b 0a20 2020 207d 0a0a 2020 2020 2f2a  k;.    }..    /*
+000321f0: 2a0a 2020 2020 202a 2050 6572 666f 726d  *.     * Perform
+00032200: 2053 4d54 5020 6175 7468 656e 7469 6361   SMTP authentica
+00032210: 7469 6f6e 2e0a 2020 2020 202a 204d 7573  tion..     * Mus
+00032220: 7420 6265 2072 756e 2061 6674 6572 2068  t be run after h
+00032230: 656c 6c6f 2829 2e0a 2020 2020 202a 0a20  ello()..     *. 
+00032240: 2020 2020 2a20 4073 6565 2020 2020 6865      * @see    he
+00032250: 6c6c 6f28 290a 2020 2020 202a 0a20 2020  llo().     *.   
+00032260: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+00032270: 6720 2475 7365 726e 616d 6520 5468 6520  g $username The 
+00032280: 7573 6572 206e 616d 650a 2020 2020 202a  user name.     *
+00032290: 2040 7061 7261 6d20 7374 7269 6e67 2024   @param string $
+000322a0: 7061 7373 776f 7264 2054 6865 2070 6173  password The pas
+000322b0: 7377 6f72 640a 2020 2020 202a 2040 7061  sword.     * @pa
+000322c0: 7261 6d20 7374 7269 6e67 2024 6175 7468  ram string $auth
+000322d0: 7479 7065 2054 6865 2061 7574 6820 7479  type The auth ty
+000322e0: 7065 2028 4352 414d 2d4d 4435 2c20 504c  pe (CRAM-MD5, PL
+000322f0: 4149 4e2c 204c 4f47 494e 2c20 584f 4155  AIN, LOGIN, XOAU
+00032300: 5448 3229 0a20 2020 2020 2a20 4070 6172  TH2).     * @par
+00032310: 616d 204f 4175 7468 546f 6b65 6e50 726f  am OAuthTokenPro
+00032320: 7669 6465 7220 244f 4175 7468 2041 6e20  vider $OAuth An 
+00032330: 6f70 7469 6f6e 616c 204f 4175 7468 546f  optional OAuthTo
+00032340: 6b65 6e50 726f 7669 6465 7220 696e 7374  kenProvider inst
+00032350: 616e 6365 2066 6f72 2058 4f41 5554 4832  ance for XOAUTH2
+00032360: 2061 7574 6865 6e74 6963 6174 696f 6e0a   authentication.
+00032370: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
+00032380: 6574 7572 6e20 626f 6f6c 2054 7275 6520  eturn bool True 
+00032390: 6966 2073 7563 6365 7373 6675 6c6c 7920  if successfully 
+000323a0: 6175 7468 656e 7469 6361 7465 640a 2020  authenticated.  
+000323b0: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+000323c0: 2066 756e 6374 696f 6e20 6175 7468 656e   function authen
+000323d0: 7469 6361 7465 280a 2020 2020 2020 2020  ticate(.        
+000323e0: 2475 7365 726e 616d 652c 0a20 2020 2020  $username,.     
+000323f0: 2020 2024 7061 7373 776f 7264 2c0a 2020     $password,.  
+00032400: 2020 2020 2020 2461 7574 6874 7970 6520        $authtype 
+00032410: 3d20 6e75 6c6c 2c0a 2020 2020 2020 2020  = null,.        
+00032420: 244f 4175 7468 203d 206e 756c 6c0a 2020  $OAuth = null.  
+00032430: 2020 2920 7b0a 2020 2020 2020 2020 6966    ) {.        if
+00032440: 2028 2124 7468 6973 2d3e 7365 7276 6572   (!$this->server
+00032450: 5f63 6170 7329 207b 0a20 2020 2020 2020  _caps) {.       
+00032460: 2020 2020 2024 7468 6973 2d3e 7365 7445       $this->setE
+00032470: 7272 6f72 2827 4175 7468 656e 7469 6361  rror('Authentica
+00032480: 7469 6f6e 2069 7320 6e6f 7420 616c 6c6f  tion is not allo
+00032490: 7765 6420 6265 666f 7265 2048 454c 4f2f  wed before HELO/
+000324a0: 4548 4c4f 2729 3b0a 0a20 2020 2020 2020  EHLO');..       
+000324b0: 2020 2020 2072 6574 7572 6e20 6661 6c73       return fals
+000324c0: 653b 0a20 2020 2020 2020 207d 0a0a 2020  e;.        }..  
+000324d0: 2020 2020 2020 6966 2028 6172 7261 795f        if (array_
+000324e0: 6b65 795f 6578 6973 7473 2827 4548 4c4f  key_exists('EHLO
+000324f0: 272c 2024 7468 6973 2d3e 7365 7276 6572  ', $this->server
+00032500: 5f63 6170 7329 2920 7b0a 2020 2020 2020  _caps)) {.      
+00032510: 2020 2020 2020 2f2f 534d 5450 2065 7874        //SMTP ext
+00032520: 656e 7369 6f6e 7320 6172 6520 6176 6169  ensions are avai
+00032530: 6c61 626c 653b 2074 7279 2074 6f20 6669  lable; try to fi
+00032540: 6e64 2061 2070 726f 7065 7220 6175 7468  nd a proper auth
+00032550: 656e 7469 6361 7469 6f6e 206d 6574 686f  entication metho
+00032560: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+00032570: 2028 2161 7272 6179 5f6b 6579 5f65 7869   (!array_key_exi
+00032580: 7374 7328 2741 5554 4827 2c20 2474 6869  sts('AUTH', $thi
+00032590: 732d 3e73 6572 7665 725f 6361 7073 2929  s->server_caps))
+000325a0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+000325b0: 2020 2024 7468 6973 2d3e 7365 7445 7272     $this->setErr
+000325c0: 6f72 2827 4175 7468 656e 7469 6361 7469  or('Authenticati
+000325d0: 6f6e 2069 7320 6e6f 7420 616c 6c6f 7765  on is not allowe
+000325e0: 6420 6174 2074 6869 7320 7374 6167 6527  d at this stage'
+000325f0: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+00032600: 2020 202f 2f27 6174 2074 6869 7320 7374     //'at this st
+00032610: 6167 6527 206d 6561 6e73 2074 6861 7420  age' means that 
+00032620: 6175 7468 206d 6179 2062 6520 616c 6c6f  auth may be allo
+00032630: 7765 6420 6166 7465 7220 7468 6520 7374  wed after the st
+00032640: 6167 6520 6368 616e 6765 730a 2020 2020  age changes.    
+00032650: 2020 2020 2020 2020 2020 2020 2f2f 652e              //e.
+00032660: 672e 2061 6674 6572 2053 5441 5254 544c  g. after STARTTL
+00032670: 530a 0a20 2020 2020 2020 2020 2020 2020  S..             
+00032680: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
+00032690: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
+000326a0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+000326b0: 732d 3e65 6465 6275 6728 2741 7574 6820  s->edebug('Auth 
+000326c0: 6d65 7468 6f64 2072 6571 7565 7374 6564  method requested
+000326d0: 3a20 2720 2e20 2824 6175 7468 7479 7065  : ' . ($authtype
+000326e0: 203f 3a20 2755 4e53 5045 4349 4649 4544   ?: 'UNSPECIFIED
+000326f0: 2729 2c20 7365 6c66 3a3a 4445 4255 475f  '), self::DEBUG_
+00032700: 4c4f 574c 4556 454c 293b 0a20 2020 2020  LOWLEVEL);.     
+00032710: 2020 2020 2020 2024 7468 6973 2d3e 6564         $this->ed
+00032720: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
+00032730: 2020 2020 2020 2741 7574 6820 6d65 7468        'Auth meth
+00032740: 6f64 7320 6176 6169 6c61 626c 6520 6f6e  ods available on
+00032750: 2074 6865 2073 6572 7665 723a 2027 202e   the server: ' .
+00032760: 2069 6d70 6c6f 6465 2827 2c27 2c20 2474   implode(',', $t
+00032770: 6869 732d 3e73 6572 7665 725f 6361 7073  his->server_caps
+00032780: 5b27 4155 5448 275d 292c 0a20 2020 2020  ['AUTH']),.     
+00032790: 2020 2020 2020 2020 2020 2073 656c 663a             self:
+000327a0: 3a44 4542 5547 5f4c 4f57 4c45 5645 4c0a  :DEBUG_LOWLEVEL.
+000327b0: 2020 2020 2020 2020 2020 2020 293b 0a0a              );..
+000327c0: 2020 2020 2020 2020 2020 2020 2f2f 4966              //If
+000327d0: 2077 6520 6861 7665 2072 6571 7565 7374   we have request
+000327e0: 6564 2061 2073 7065 6369 6669 6320 6175  ed a specific au
+000327f0: 7468 2074 7970 652c 2063 6865 636b 2074  th type, check t
+00032800: 6865 2073 6572 7665 7220 7375 7070 6f72  he server suppor
+00032810: 7473 2069 7420 6265 666f 7265 2074 7279  ts it before try
+00032820: 696e 6720 6f74 6865 7273 0a20 2020 2020  ing others.     
+00032830: 2020 2020 2020 2069 6620 286e 756c 6c20         if (null 
+00032840: 213d 3d20 2461 7574 6874 7970 6520 2626  !== $authtype &&
+00032850: 2021 696e 5f61 7272 6179 2824 6175 7468   !in_array($auth
+00032860: 7479 7065 2c20 2474 6869 732d 3e73 6572  type, $this->ser
+00032870: 7665 725f 6361 7073 5b27 4155 5448 275d  ver_caps['AUTH']
+00032880: 2c20 7472 7565 2929 207b 0a20 2020 2020  , true)) {.     
+00032890: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+000328a0: 2d3e 6564 6562 7567 2827 5265 7175 6573  ->edebug('Reques
+000328b0: 7465 6420 6175 7468 206d 6574 686f 6420  ted auth method 
+000328c0: 6e6f 7420 6176 6169 6c61 626c 653a 2027  not available: '
+000328d0: 202e 2024 6175 7468 7479 7065 2c20 7365   . $authtype, se
+000328e0: 6c66 3a3a 4445 4255 475f 4c4f 574c 4556  lf::DEBUG_LOWLEV
+000328f0: 454c 293b 0a20 2020 2020 2020 2020 2020  EL);.           
+00032900: 2020 2020 2024 6175 7468 7479 7065 203d       $authtype =
+00032910: 206e 756c 6c3b 0a20 2020 2020 2020 2020   null;.         
+00032920: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
+00032930: 2020 6966 2028 656d 7074 7928 2461 7574    if (empty($aut
+00032940: 6874 7970 6529 2920 7b0a 2020 2020 2020  htype)) {.      
+00032950: 2020 2020 2020 2020 2020 2f2f 4966 206e            //If n
+00032960: 6f20 6175 7468 206d 6563 6861 6e69 736d  o auth mechanism
+00032970: 2069 7320 7370 6563 6966 6965 642c 2061   is specified, a
+00032980: 7474 656d 7074 2074 6f20 7573 6520 7468  ttempt to use th
+00032990: 6573 652c 2069 6e20 7468 6973 206f 7264  ese, in this ord
+000329a0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+000329b0: 2020 202f 2f54 7279 2043 5241 4d2d 4d44     //Try CRAM-MD
+000329c0: 3520 6669 7273 7420 6173 2069 7427 7320  5 first as it's 
+000329d0: 6d6f 7265 2073 6563 7572 6520 7468 616e  more secure than
+000329e0: 2074 6865 206f 7468 6572 730a 2020 2020   the others.    
+000329f0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+00032a00: 6163 6820 285b 2743 5241 4d2d 4d44 3527  ach (['CRAM-MD5'
+00032a10: 2c20 274c 4f47 494e 272c 2027 504c 4149  , 'LOGIN', 'PLAI
+00032a20: 4e27 2c20 2758 4f41 5554 4832 275d 2061  N', 'XOAUTH2'] a
+00032a30: 7320 246d 6574 686f 6429 207b 0a20 2020  s $method) {.   
+00032a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032a50: 2069 6620 2869 6e5f 6172 7261 7928 246d   if (in_array($m
+00032a60: 6574 686f 642c 2024 7468 6973 2d3e 7365  ethod, $this->se
+00032a70: 7276 6572 5f63 6170 735b 2741 5554 4827  rver_caps['AUTH'
+00032a80: 5d2c 2074 7275 6529 2920 7b0a 2020 2020  ], true)) {.    
+00032a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032aa0: 2020 2020 2461 7574 6874 7970 6520 3d20      $authtype = 
+00032ab0: 246d 6574 686f 643b 0a20 2020 2020 2020  $method;.       
+00032ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032ad0: 2062 7265 616b 3b0a 2020 2020 2020 2020   break;.        
+00032ae0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00032af0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00032b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032b10: 6966 2028 656d 7074 7928 2461 7574 6874  if (empty($autht
+00032b20: 7970 6529 2920 7b0a 2020 2020 2020 2020  ype)) {.        
+00032b30: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+00032b40: 732d 3e73 6574 4572 726f 7228 274e 6f20  s->setError('No 
+00032b50: 7375 7070 6f72 7465 6420 6175 7468 656e  supported authen
+00032b60: 7469 6361 7469 6f6e 206d 6574 686f 6473  tication methods
+00032b70: 2066 6f75 6e64 2729 3b0a 0a20 2020 2020   found');..     
+00032b80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00032b90: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
+00032ba0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+00032bb0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00032bc0: 7468 6973 2d3e 6564 6562 7567 2827 4175  this->edebug('Au
+00032bd0: 7468 206d 6574 686f 6420 7365 6c65 6374  th method select
+00032be0: 6564 3a20 2720 2e20 2461 7574 6874 7970  ed: ' . $authtyp
+00032bf0: 652c 2073 656c 663a 3a44 4542 5547 5f4c  e, self::DEBUG_L
+00032c00: 4f57 4c45 5645 4c29 3b0a 2020 2020 2020  OWLEVEL);.      
+00032c10: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00032c20: 2020 2020 2069 6620 2821 696e 5f61 7272       if (!in_arr
+00032c30: 6179 2824 6175 7468 7479 7065 2c20 2474  ay($authtype, $t
+00032c40: 6869 732d 3e73 6572 7665 725f 6361 7073  his->server_caps
+00032c50: 5b27 4155 5448 275d 2c20 7472 7565 2929  ['AUTH'], true))
+00032c60: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00032c70: 2020 2024 7468 6973 2d3e 7365 7445 7272     $this->setErr
+00032c80: 6f72 2822 5468 6520 7265 7175 6573 7465  or("The requeste
+00032c90: 6420 6175 7468 656e 7469 6361 7469 6f6e  d authentication
+00032ca0: 206d 6574 686f 6420 5c22 2461 7574 6874   method \"$autht
+00032cb0: 7970 655c 2220 6973 206e 6f74 2073 7570  ype\" is not sup
+00032cc0: 706f 7274 6564 2062 7920 7468 6520 7365  ported by the se
+00032cd0: 7276 6572 2229 3b0a 0a20 2020 2020 2020  rver");..       
+00032ce0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00032cf0: 6661 6c73 653b 0a20 2020 2020 2020 2020  false;.         
+00032d00: 2020 207d 0a20 2020 2020 2020 207d 2065     }.        } e
+00032d10: 6c73 6569 6620 2865 6d70 7479 2824 6175  lseif (empty($au
+00032d20: 7468 7479 7065 2929 207b 0a20 2020 2020  thtype)) {.     
+00032d30: 2020 2020 2020 2024 6175 7468 7479 7065         $authtype
+00032d40: 203d 2027 4c4f 4749 4e27 3b0a 2020 2020   = 'LOGIN';.    
+00032d50: 2020 2020 7d0a 2020 2020 2020 2020 7377      }.        sw
+00032d60: 6974 6368 2028 2461 7574 6874 7970 6529  itch ($authtype)
+00032d70: 207b 0a20 2020 2020 2020 2020 2020 2063   {.            c
+00032d80: 6173 6520 2750 4c41 494e 273a 0a20 2020  ase 'PLAIN':.   
+00032d90: 2020 2020 2020 2020 2020 2020 202f 2f53               //S
+00032da0: 7461 7274 2061 7574 6865 6e74 6963 6174  tart authenticat
+00032db0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00032dc0: 2020 2020 6966 2028 2124 7468 6973 2d3e      if (!$this->
+00032dd0: 7365 6e64 436f 6d6d 616e 6428 2741 5554  sendCommand('AUT
+00032de0: 4827 2c20 2741 5554 4820 504c 4149 4e27  H', 'AUTH PLAIN'
+00032df0: 2c20 3333 3429 2920 7b0a 2020 2020 2020  , 334)) {.      
+00032e00: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00032e10: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
+00032e20: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00032e30: 2020 2020 2020 2020 2020 2020 2020 2f2f                //
+00032e40: 5365 6e64 2065 6e63 6f64 6564 2075 7365  Send encoded use
+00032e50: 726e 616d 6520 616e 6420 7061 7373 776f  rname and passwo
+00032e60: 7264 0a20 2020 2020 2020 2020 2020 2020  rd.             
+00032e70: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+00032e80: 2020 2020 2020 2020 2020 2020 2f2f 466f              //Fo
+00032e90: 726d 6174 2066 726f 6d20 6874 7470 733a  rmat from https:
+00032ea0: 2f2f 746f 6f6c 732e 6965 7466 2e6f 7267  //tools.ietf.org
+00032eb0: 2f68 746d 6c2f 7266 6334 3631 3623 7365  /html/rfc4616#se
+00032ec0: 6374 696f 6e2d 320a 2020 2020 2020 2020  ction-2.        
+00032ed0: 2020 2020 2020 2020 2020 2020 2f2f 5765              //We
+00032ee0: 2073 6b69 7020 7468 6520 6669 7273 7420   skip the first 
+00032ef0: 6669 656c 6420 2869 7427 7320 666f 7267  field (it's forg
+00032f00: 6572 7929 2c20 736f 2074 6865 2073 7472  ery), so the str
+00032f10: 696e 6720 7374 6172 7473 2077 6974 6820  ing starts with 
+00032f20: 6120 6e75 6c6c 2062 7974 650a 2020 2020  a null byte.    
+00032f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032f40: 2124 7468 6973 2d3e 7365 6e64 436f 6d6d  !$this->sendComm
+00032f50: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
+00032f60: 2020 2020 2020 2020 2020 2020 2027 5573               'Us
+00032f70: 6572 2026 2050 6173 7377 6f72 6427 2c0a  er & Password',.
+00032f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032f90: 2020 2020 2020 2020 6261 7365 3634 5f65          base64_e
+00032fa0: 6e63 6f64 6528 225c 3022 202e 2024 7573  ncode("\0" . $us
+00032fb0: 6572 6e61 6d65 202e 2022 5c30 2220 2e20  ername . "\0" . 
+00032fc0: 2470 6173 7377 6f72 6429 2c0a 2020 2020  $password),.    
+00032fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032fe0: 2020 2020 3233 350a 2020 2020 2020 2020      235.        
+00032ff0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00033000: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
+00033010: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00033020: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+00033030: 7365 3b0a 2020 2020 2020 2020 2020 2020  se;.            
+00033040: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00033050: 2020 2020 2020 6272 6561 6b3b 0a20 2020        break;.   
+00033060: 2020 2020 2020 2020 2063 6173 6520 274c           case 'L
+00033070: 4f47 494e 273a 0a20 2020 2020 2020 2020  OGIN':.         
+00033080: 2020 2020 2020 202f 2f53 7461 7274 2061         //Start a
+00033090: 7574 6865 6e74 6963 6174 696f 6e0a 2020  uthentication.  
+000330a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000330b0: 2028 2124 7468 6973 2d3e 7365 6e64 436f   (!$this->sendCo
+000330c0: 6d6d 616e 6428 2741 5554 4827 2c20 2741  mmand('AUTH', 'A
+000330d0: 5554 4820 4c4f 4749 4e27 2c20 3333 3429  UTH LOGIN', 334)
+000330e0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+000330f0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00033100: 616c 7365 3b0a 2020 2020 2020 2020 2020  alse;.          
+00033110: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00033120: 2020 2020 2020 2020 6966 2028 2124 7468          if (!$th
+00033130: 6973 2d3e 7365 6e64 436f 6d6d 616e 6428  is->sendCommand(
+00033140: 2755 7365 726e 616d 6527 2c20 6261 7365  'Username', base
+00033150: 3634 5f65 6e63 6f64 6528 2475 7365 726e  64_encode($usern
+00033160: 616d 6529 2c20 3333 3429 2920 7b0a 2020  ame), 334)) {.  
+00033170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033180: 2020 7265 7475 726e 2066 616c 7365 3b0a    return false;.
+00033190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000331a0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+000331b0: 2020 6966 2028 2124 7468 6973 2d3e 7365    if (!$this->se
+000331c0: 6e64 436f 6d6d 616e 6428 2750 6173 7377  ndCommand('Passw
+000331d0: 6f72 6427 2c20 6261 7365 3634 5f65 6e63  ord', base64_enc
+000331e0: 6f64 6528 2470 6173 7377 6f72 6429 2c20  ode($password), 
+000331f0: 3233 3529 2920 7b0a 2020 2020 2020 2020  235)) {.        
+00033200: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00033210: 726e 2066 616c 7365 3b0a 2020 2020 2020  rn false;.      
+00033220: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00033230: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00033240: 6b3b 0a20 2020 2020 2020 2020 2020 2063  k;.            c
+00033250: 6173 6520 2743 5241 4d2d 4d44 3527 3a0a  ase 'CRAM-MD5':.
+00033260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033270: 2f2f 5374 6172 7420 6175 7468 656e 7469  //Start authenti
+00033280: 6361 7469 6f6e 0a20 2020 2020 2020 2020  cation.         
+00033290: 2020 2020 2020 2069 6620 2821 2474 6869         if (!$thi
+000332a0: 732d 3e73 656e 6443 6f6d 6d61 6e64 2827  s->sendCommand('
+000332b0: 4155 5448 2043 5241 4d2d 4d44 3527 2c20  AUTH CRAM-MD5', 
+000332c0: 2741 5554 4820 4352 414d 2d4d 4435 272c  'AUTH CRAM-MD5',
+000332d0: 2033 3334 2929 207b 0a20 2020 2020 2020   334)) {.       
+000332e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000332f0: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
+00033300: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00033310: 2020 2020 2020 2020 2020 2020 202f 2f47               //G
+00033320: 6574 2074 6865 2063 6861 6c6c 656e 6765  et the challenge
+00033330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033340: 2024 6368 616c 6c65 6e67 6520 3d20 6261   $challenge = ba
+00033350: 7365 3634 5f64 6563 6f64 6528 7375 6273  se64_decode(subs
+00033360: 7472 2824 7468 6973 2d3e 6c61 7374 5f72  tr($this->last_r
+00033370: 6570 6c79 2c20 3429 293b 0a0a 2020 2020  eply, 4));..    
+00033380: 2020 2020 2020 2020 2020 2020 2f2f 4275              //Bu
+00033390: 696c 6420 7468 6520 7265 7370 6f6e 7365  ild the response
+000333a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000333b0: 2024 7265 7370 6f6e 7365 203d 2024 7573   $response = $us
+000333c0: 6572 6e61 6d65 202e 2027 2027 202e 2024  ername . ' ' . $
+000333d0: 7468 6973 2d3e 686d 6163 2824 6368 616c  this->hmac($chal
+000333e0: 6c65 6e67 652c 2024 7061 7373 776f 7264  lenge, $password
+000333f0: 293b 0a0a 2020 2020 2020 2020 2020 2020  );..            
+00033400: 2020 2020 2f2f 7365 6e64 2065 6e63 6f64      //send encod
+00033410: 6564 2063 7265 6465 6e74 6961 6c73 0a20  ed credentials. 
+00033420: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00033430: 6574 7572 6e20 2474 6869 732d 3e73 656e  eturn $this->sen
+00033440: 6443 6f6d 6d61 6e64 2827 5573 6572 6e61  dCommand('Userna
+00033450: 6d65 272c 2062 6173 6536 345f 656e 636f  me', base64_enco
+00033460: 6465 2824 7265 7370 6f6e 7365 292c 2032  de($response), 2
+00033470: 3335 293b 0a20 2020 2020 2020 2020 2020  35);.           
+00033480: 2063 6173 6520 2758 4f41 5554 4832 273a   case 'XOAUTH2':
+00033490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000334a0: 202f 2f54 6865 204f 4175 7468 2069 6e73   //The OAuth ins
+000334b0: 7461 6e63 6520 6d75 7374 2062 6520 7365  tance must be se
+000334c0: 7420 7570 2070 7269 6f72 2074 6f20 7265  t up prior to re
+000334d0: 7175 6573 7469 6e67 2061 7574 682e 0a20  questing auth.. 
+000334e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000334f0: 6620 286e 756c 6c20 3d3d 3d20 244f 4175  f (null === $OAu
+00033500: 7468 2920 7b0a 2020 2020 2020 2020 2020  th) {.          
+00033510: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00033520: 2066 616c 7365 3b0a 2020 2020 2020 2020   false;.        
+00033530: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00033540: 2020 2020 2020 2020 2020 246f 6175 7468            $oauth
+00033550: 203d 2024 4f41 7574 682d 3e67 6574 4f61   = $OAuth->getOa
+00033560: 7574 6836 3428 293b 0a0a 2020 2020 2020  uth64();..      
+00033570: 2020 2020 2020 2020 2020 2f2f 5374 6172            //Star
+00033580: 7420 6175 7468 656e 7469 6361 7469 6f6e  t authentication
+00033590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000335a0: 2069 6620 2821 2474 6869 732d 3e73 656e   if (!$this->sen
+000335b0: 6443 6f6d 6d61 6e64 2827 4155 5448 272c  dCommand('AUTH',
+000335c0: 2027 4155 5448 2058 4f41 5554 4832 2027   'AUTH XOAUTH2 '
+000335d0: 202e 2024 6f61 7574 682c 2032 3335 2929   . $oauth, 235))
+000335e0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+000335f0: 2020 2020 2020 2072 6574 7572 6e20 6661         return fa
+00033600: 6c73 653b 0a20 2020 2020 2020 2020 2020  lse;.           
+00033610: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00033620: 2020 2020 2020 2062 7265 616b 3b0a 2020         break;.  
+00033630: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00033640: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00033650: 2020 2024 7468 6973 2d3e 7365 7445 7272     $this->setErr
+00033660: 6f72 2822 4175 7468 656e 7469 6361 7469  or("Authenticati
+00033670: 6f6e 206d 6574 686f 6420 5c22 2461 7574  on method \"$aut
+00033680: 6874 7970 655c 2220 6973 206e 6f74 2073  htype\" is not s
+00033690: 7570 706f 7274 6564 2229 3b0a 0a20 2020  upported");..   
+000336a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000336b0: 7572 6e20 6661 6c73 653b 0a20 2020 2020  urn false;.     
+000336c0: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+000336d0: 7475 726e 2074 7275 653b 0a20 2020 207d  turn true;.    }
+000336e0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+000336f0: 2043 616c 6375 6c61 7465 2061 6e20 4d44   Calculate an MD
+00033700: 3520 484d 4143 2068 6173 682e 0a20 2020  5 HMAC hash..   
+00033710: 2020 2a20 576f 726b 7320 6c69 6b65 2068    * Works like h
+00033720: 6173 685f 686d 6163 2827 6d64 3527 2c20  ash_hmac('md5', 
+00033730: 2464 6174 612c 2024 6b65 7929 0a20 2020  $data, $key).   
+00033740: 2020 2a20 696e 2063 6173 6520 7468 6174    * in case that
+00033750: 2066 756e 6374 696f 6e20 6973 206e 6f74   function is not
+00033760: 2061 7661 696c 6162 6c65 2e0a 2020 2020   available..    
+00033770: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+00033780: 2073 7472 696e 6720 2464 6174 6120 5468   string $data Th
+00033790: 6520 6461 7461 2074 6f20 6861 7368 0a20  e data to hash. 
+000337a0: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+000337b0: 696e 6720 246b 6579 2020 5468 6520 6b65  ing $key  The ke
+000337c0: 7920 746f 2068 6173 6820 7769 7468 0a20  y to hash with. 
+000337d0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
+000337e0: 7475 726e 2073 7472 696e 670a 2020 2020  turn string.    
+000337f0: 202a 2f0a 2020 2020 7072 6f74 6563 7465   */.    protecte
+00033800: 6420 6675 6e63 7469 6f6e 2068 6d61 6328  d function hmac(
+00033810: 2464 6174 612c 2024 6b65 7929 0a20 2020  $data, $key).   
+00033820: 207b 0a20 2020 2020 2020 2069 6620 2866   {.        if (f
+00033830: 756e 6374 696f 6e5f 6578 6973 7473 2827  unction_exists('
+00033840: 6861 7368 5f68 6d61 6327 2929 207b 0a20  hash_hmac')) {. 
+00033850: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00033860: 6e20 6861 7368 5f68 6d61 6328 276d 6435  n hash_hmac('md5
+00033870: 272c 2024 6461 7461 2c20 246b 6579 293b  ', $data, $key);
+00033880: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00033890: 2020 2020 2f2f 5468 6520 666f 6c6c 6f77      //The follow
+000338a0: 696e 6720 626f 7272 6f77 6564 2066 726f  ing borrowed fro
+000338b0: 6d0a 2020 2020 2020 2020 2f2f 6874 7470  m.        //http
+000338c0: 3a2f 2f70 6870 2e6e 6574 2f6d 616e 7561  ://php.net/manua
+000338d0: 6c2f 656e 2f66 756e 6374 696f 6e2e 6d68  l/en/function.mh
+000338e0: 6173 682e 7068 7023 3237 3232 350a 0a20  ash.php#27225.. 
+000338f0: 2020 2020 2020 202f 2f52 4643 2032 3130         //RFC 210
+00033900: 3420 484d 4143 2069 6d70 6c65 6d65 6e74  4 HMAC implement
+00033910: 6174 696f 6e20 666f 7220 7068 702e 0a20  ation for php.. 
+00033920: 2020 2020 2020 202f 2f43 7265 6174 6573         //Creates
+00033930: 2061 6e20 6d64 3520 484d 4143 2e0a 2020   an md5 HMAC..  
+00033940: 2020 2020 2020 2f2f 456c 696d 696e 6174        //Eliminat
+00033950: 6573 2074 6865 206e 6565 6420 746f 2069  es the need to i
+00033960: 6e73 7461 6c6c 206d 6861 7368 2074 6f20  nstall mhash to 
+00033970: 636f 6d70 7574 6520 6120 484d 4143 0a20  compute a HMAC. 
+00033980: 2020 2020 2020 202f 2f62 7920 4c61 6e63         //by Lanc
+00033990: 6520 5275 7368 696e 670a 0a20 2020 2020  e Rushing..     
+000339a0: 2020 2024 6279 7465 6c65 6e20 3d20 3634     $bytelen = 64
+000339b0: 3b20 2f2f 6279 7465 206c 656e 6774 6820  ; //byte length 
+000339c0: 666f 7220 6d64 350a 2020 2020 2020 2020  for md5.        
+000339d0: 6966 2028 7374 726c 656e 2824 6b65 7929  if (strlen($key)
+000339e0: 203e 2024 6279 7465 6c65 6e29 207b 0a20   > $bytelen) {. 
+000339f0: 2020 2020 2020 2020 2020 2024 6b65 7920             $key 
+00033a00: 3d20 7061 636b 2827 482a 272c 206d 6435  = pack('H*', md5
+00033a10: 2824 6b65 7929 293b 0a20 2020 2020 2020  ($key));.       
+00033a20: 207d 0a20 2020 2020 2020 2024 6b65 7920   }.        $key 
+00033a30: 3d20 7374 725f 7061 6428 246b 6579 2c20  = str_pad($key, 
+00033a40: 2462 7974 656c 656e 2c20 6368 7228 3078  $bytelen, chr(0x
+00033a50: 3030 2929 3b0a 2020 2020 2020 2020 2469  00));.        $i
+00033a60: 7061 6420 3d20 7374 725f 7061 6428 2727  pad = str_pad(''
+00033a70: 2c20 2462 7974 656c 656e 2c20 6368 7228  , $bytelen, chr(
+00033a80: 3078 3336 2929 3b0a 2020 2020 2020 2020  0x36));.        
+00033a90: 246f 7061 6420 3d20 7374 725f 7061 6428  $opad = str_pad(
+00033aa0: 2727 2c20 2462 7974 656c 656e 2c20 6368  '', $bytelen, ch
+00033ab0: 7228 3078 3563 2929 3b0a 2020 2020 2020  r(0x5c));.      
+00033ac0: 2020 246b 5f69 7061 6420 3d20 246b 6579    $k_ipad = $key
+00033ad0: 205e 2024 6970 6164 3b0a 2020 2020 2020   ^ $ipad;.      
+00033ae0: 2020 246b 5f6f 7061 6420 3d20 246b 6579    $k_opad = $key
+00033af0: 205e 2024 6f70 6164 3b0a 0a20 2020 2020   ^ $opad;..     
+00033b00: 2020 2072 6574 7572 6e20 6d64 3528 246b     return md5($k
+00033b10: 5f6f 7061 6420 2e20 7061 636b 2827 482a  _opad . pack('H*
+00033b20: 272c 206d 6435 2824 6b5f 6970 6164 202e  ', md5($k_ipad .
+00033b30: 2024 6461 7461 2929 293b 0a20 2020 207d   $data)));.    }
+00033b40: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00033b50: 2043 6865 636b 2063 6f6e 6e65 6374 696f   Check connectio
+00033b60: 6e20 7374 6174 652e 0a20 2020 2020 2a0a  n state..     *.
+00033b70: 2020 2020 202a 2040 7265 7475 726e 2062       * @return b
+00033b80: 6f6f 6c20 5472 7565 2069 6620 636f 6e6e  ool True if conn
+00033b90: 6563 7465 640a 2020 2020 202a 2f0a 2020  ected.     */.  
+00033ba0: 2020 7075 626c 6963 2066 756e 6374 696f    public functio
+00033bb0: 6e20 636f 6e6e 6563 7465 6428 290a 2020  n connected().  
+00033bc0: 2020 7b0a 2020 2020 2020 2020 6966 2028    {.        if (
+00033bd0: 6973 5f72 6573 6f75 7263 6528 2474 6869  is_resource($thi
+00033be0: 732d 3e73 6d74 705f 636f 6e6e 2929 207b  s->smtp_conn)) {
+00033bf0: 0a20 2020 2020 2020 2020 2020 2024 736f  .            $so
+00033c00: 636b 5f73 7461 7475 7320 3d20 7374 7265  ck_status = stre
+00033c10: 616d 5f67 6574 5f6d 6574 615f 6461 7461  am_get_meta_data
+00033c20: 2824 7468 6973 2d3e 736d 7470 5f63 6f6e  ($this->smtp_con
+00033c30: 6e29 3b0a 2020 2020 2020 2020 2020 2020  n);.            
+00033c40: 6966 2028 2473 6f63 6b5f 7374 6174 7573  if ($sock_status
+00033c50: 5b27 656f 6627 5d29 207b 0a20 2020 2020  ['eof']) {.     
+00033c60: 2020 2020 2020 2020 2020 202f 2f54 6865             //The
+00033c70: 2073 6f63 6b65 7420 6973 2076 616c 6964   socket is valid
+00033c80: 2062 7574 2077 6520 6172 6520 6e6f 7420   but we are not 
+00033c90: 636f 6e6e 6563 7465 640a 2020 2020 2020  connected.      
+00033ca0: 2020 2020 2020 2020 2020 2474 6869 732d            $this-
+00033cb0: 3e65 6465 6275 6728 0a20 2020 2020 2020  >edebug(.       
+00033cc0: 2020 2020 2020 2020 2020 2020 2027 534d               'SM
+00033cd0: 5450 204e 4f54 4943 453a 2045 4f46 2063  TP NOTICE: EOF c
+00033ce0: 6175 6768 7420 7768 696c 6520 6368 6563  aught while chec
+00033cf0: 6b69 6e67 2069 6620 636f 6e6e 6563 7465  king if connecte
+00033d00: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
+00033d10: 2020 2020 2020 2020 7365 6c66 3a3a 4445          self::DE
+00033d20: 4255 475f 434c 4945 4e54 0a20 2020 2020  BUG_CLIENT.     
+00033d30: 2020 2020 2020 2020 2020 2029 3b0a 2020             );.  
+00033d40: 2020 2020 2020 2020 2020 2020 2020 2474                $t
+00033d50: 6869 732d 3e63 6c6f 7365 2829 3b0a 0a20  his->close();.. 
+00033d60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00033d70: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
+00033d80: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+00033d90: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00033da0: 7275 653b 202f 2f65 7665 7279 7468 696e  rue; //everythin
+00033db0: 6720 6c6f 6f6b 7320 676f 6f64 0a20 2020  g looks good.   
+00033dc0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00033dd0: 7265 7475 726e 2066 616c 7365 3b0a 2020  return false;.  
+00033de0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+00033df0: 2020 2a20 436c 6f73 6520 7468 6520 736f    * Close the so
+00033e00: 636b 6574 2061 6e64 2063 6c65 616e 2075  cket and clean u
+00033e10: 7020 7468 6520 7374 6174 6520 6f66 2074  p the state of t
+00033e20: 6865 2063 6c61 7373 2e0a 2020 2020 202a  he class..     *
+00033e30: 2044 6f6e 2774 2075 7365 2074 6869 7320   Don't use this 
+00033e40: 6675 6e63 7469 6f6e 2077 6974 686f 7574  function without
+00033e50: 2066 6972 7374 2074 7279 696e 6720 746f   first trying to
+00033e60: 2075 7365 2051 5549 542e 0a20 2020 2020   use QUIT..     
+00033e70: 2a0a 2020 2020 202a 2040 7365 6520 7175  *.     * @see qu
+00033e80: 6974 2829 0a20 2020 2020 2a2f 0a20 2020  it().     */.   
+00033e90: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+00033ea0: 2063 6c6f 7365 2829 0a20 2020 207b 0a20   close().    {. 
+00033eb0: 2020 2020 2020 2024 7468 6973 2d3e 7365         $this->se
+00033ec0: 7276 6572 5f63 6170 7320 3d20 6e75 6c6c  rver_caps = null
+00033ed0: 3b0a 2020 2020 2020 2020 2474 6869 732d  ;.        $this-
+00033ee0: 3e68 656c 6f5f 7270 6c79 203d 206e 756c  >helo_rply = nul
+00033ef0: 6c3b 0a20 2020 2020 2020 2069 6620 2869  l;.        if (i
+00033f00: 735f 7265 736f 7572 6365 2824 7468 6973  s_resource($this
+00033f10: 2d3e 736d 7470 5f63 6f6e 6e29 2920 7b0a  ->smtp_conn)) {.
+00033f20: 2020 2020 2020 2020 2020 2020 2f2f 436c              //Cl
+00033f30: 6f73 6520 7468 6520 636f 6e6e 6563 7469  ose the connecti
+00033f40: 6f6e 2061 6e64 2063 6c65 616e 7570 0a20  on and cleanup. 
+00033f50: 2020 2020 2020 2020 2020 2066 636c 6f73             fclos
+00033f60: 6528 2474 6869 732d 3e73 6d74 705f 636f  e($this->smtp_co
+00033f70: 6e6e 293b 0a20 2020 2020 2020 2020 2020  nn);.           
+00033f80: 2024 7468 6973 2d3e 736d 7470 5f63 6f6e   $this->smtp_con
+00033f90: 6e20 3d20 6e75 6c6c 3b20 2f2f 4d61 6b65  n = null; //Make
+00033fa0: 7320 666f 7220 636c 6561 6e65 7220 7365  s for cleaner se
+00033fb0: 7269 616c 697a 6174 696f 6e0a 2020 2020  rialization.    
+00033fc0: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
+00033fd0: 6465 6275 6728 2743 6f6e 6e65 6374 696f  debug('Connectio
+00033fe0: 6e3a 2063 6c6f 7365 6427 2c20 7365 6c66  n: closed', self
+00033ff0: 3a3a 4445 4255 475f 434f 4e4e 4543 5449  ::DEBUG_CONNECTI
+00034000: 4f4e 293b 0a20 2020 2020 2020 207d 0a20  ON);.        }. 
+00034010: 2020 207d 0a0a 2020 2020 2f2a 2a0a 2020     }..    /**.  
+00034020: 2020 202a 2053 656e 6420 616e 2053 4d54     * Send an SMT
+00034030: 5020 4441 5441 2063 6f6d 6d61 6e64 2e0a  P DATA command..
+00034040: 2020 2020 202a 2049 7373 7565 7320 6120       * Issues a 
+00034050: 6461 7461 2063 6f6d 6d61 6e64 2061 6e64  data command and
+00034060: 2073 656e 6473 2074 6865 206d 7367 5f64   sends the msg_d
+00034070: 6174 6120 746f 2074 6865 2073 6572 7665  ata to the serve
+00034080: 722c 0a20 2020 2020 2a20 6669 6e61 6c69  r,.     * finali
+00034090: 7a69 6e67 2074 6865 206d 6169 6c20 7472  zing the mail tr
+000340a0: 616e 7361 6374 696f 6e2e 2024 6d73 675f  ansaction. $msg_
+000340b0: 6461 7461 2069 7320 7468 6520 6d65 7373  data is the mess
+000340c0: 6167 650a 2020 2020 202a 2074 6861 7420  age.     * that 
+000340d0: 6973 2074 6f20 6265 2073 656e 7420 7769  is to be sent wi
+000340e0: 7468 2074 6865 2068 6561 6465 7273 2e20  th the headers. 
+000340f0: 4561 6368 2068 6561 6465 7220 6e65 6564  Each header need
+00034100: 7320 746f 2062 650a 2020 2020 202a 206f  s to be.     * o
+00034110: 6e20 6120 7369 6e67 6c65 206c 696e 6520  n a single line 
+00034120: 666f 6c6c 6f77 6564 2062 7920 6120 3c43  followed by a <C
+00034130: 524c 463e 2077 6974 6820 7468 6520 6d65  RLF> with the me
+00034140: 7373 6167 6520 6865 6164 6572 730a 2020  ssage headers.  
+00034150: 2020 202a 2061 6e64 2074 6865 206d 6573     * and the mes
+00034160: 7361 6765 2062 6f64 7920 6265 696e 6720  sage body being 
+00034170: 7365 7061 7261 7465 6420 6279 2061 6e20  separated by an 
+00034180: 6164 6469 7469 6f6e 616c 203c 4352 4c46  additional <CRLF
+00034190: 3e2e 0a20 2020 2020 2a20 496d 706c 656d  >..     * Implem
+000341a0: 656e 7473 2052 4643 2038 3231 3a20 4441  ents RFC 821: DA
+000341b0: 5441 203c 4352 4c46 3e2e 0a20 2020 2020  TA <CRLF>..     
+000341c0: 2a0a 2020 2020 202a 2040 7061 7261 6d20  *.     * @param 
+000341d0: 7374 7269 6e67 2024 6d73 675f 6461 7461  string $msg_data
+000341e0: 204d 6573 7361 6765 2064 6174 6120 746f   Message data to
+000341f0: 2073 656e 640a 2020 2020 202a 0a20 2020   send.     *.   
+00034200: 2020 2a20 4072 6574 7572 6e20 626f 6f6c    * @return bool
+00034210: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00034220: 6c69 6320 6675 6e63 7469 6f6e 2064 6174  lic function dat
+00034230: 6128 246d 7367 5f64 6174 6129 0a20 2020  a($msg_data).   
+00034240: 207b 0a20 2020 2020 2020 202f 2f54 6869   {.        //Thi
+00034250: 7320 7769 6c6c 2075 7365 2074 6865 2073  s will use the s
+00034260: 7461 6e64 6172 6420 7469 6d65 6c69 6d69  tandard timelimi
+00034270: 740a 2020 2020 2020 2020 6966 2028 2124  t.        if (!$
+00034280: 7468 6973 2d3e 7365 6e64 436f 6d6d 616e  this->sendComman
+00034290: 6428 2744 4154 4127 2c20 2744 4154 4127  d('DATA', 'DATA'
+000342a0: 2c20 3335 3429 2920 7b0a 2020 2020 2020  , 354)) {.      
+000342b0: 2020 2020 2020 7265 7475 726e 2066 616c        return fal
+000342c0: 7365 3b0a 2020 2020 2020 2020 7d0a 0a20  se;.        }.. 
+000342d0: 2020 2020 2020 202f 2a20 5468 6520 7365         /* The se
+000342e0: 7276 6572 2069 7320 7265 6164 7920 746f  rver is ready to
+000342f0: 2061 6363 6570 7420 6461 7461 210a 2020   accept data!.  
+00034300: 2020 2020 2020 202a 2041 6363 6f72 6469         * Accordi
+00034310: 6e67 2074 6f20 7266 6338 3231 2077 6520  ng to rfc821 we 
+00034320: 7368 6f75 6c64 206e 6f74 2073 656e 6420  should not send 
+00034330: 6d6f 7265 2074 6861 6e20 3130 3030 2063  more than 1000 c
+00034340: 6861 7261 6374 6572 7320 6f6e 2061 2073  haracters on a s
+00034350: 696e 676c 6520 6c69 6e65 2028 696e 636c  ingle line (incl
+00034360: 7564 696e 6720 7468 6520 4c45 290a 2020  uding the LE).  
+00034370: 2020 2020 2020 202a 2073 6f20 7765 2077         * so we w
+00034380: 696c 6c20 6272 6561 6b20 7468 6520 6461  ill break the da
+00034390: 7461 2075 7020 696e 746f 206c 696e 6573  ta up into lines
+000343a0: 2062 7920 5c72 2061 6e64 2f6f 7220 5c6e   by \r and/or \n
+000343b0: 2074 6865 6e20 6966 206e 6565 6465 6420   then if needed 
+000343c0: 7765 2077 696c 6c20 6272 6561 6b20 6561  we will break ea
+000343d0: 6368 206f 6620 7468 6f73 6520 696e 746f  ch of those into
+000343e0: 0a20 2020 2020 2020 2020 2a20 736d 616c  .         * smal
+000343f0: 6c65 7220 6c69 6e65 7320 746f 2066 6974  ler lines to fit
+00034400: 2077 6974 6869 6e20 7468 6520 6c69 6d69   within the limi
+00034410: 742e 0a20 2020 2020 2020 2020 2a20 5765  t..         * We
+00034420: 2077 696c 6c20 616c 736f 206c 6f6f 6b20   will also look 
+00034430: 666f 7220 6c69 6e65 7320 7468 6174 2073  for lines that s
+00034440: 7461 7274 2077 6974 6820 6120 272e 2720  tart with a '.' 
+00034450: 616e 6420 7072 6570 656e 6420 616e 2061  and prepend an a
+00034460: 6464 6974 696f 6e61 6c20 272e 272e 0a20  dditional '.'.. 
+00034470: 2020 2020 2020 2020 2a20 4e4f 5445 3a20          * NOTE: 
+00034480: 7468 6973 2064 6f65 7320 6e6f 7420 636f  this does not co
+00034490: 756e 7420 746f 7761 7264 7320 6c69 6e65  unt towards line
+000344a0: 2d6c 656e 6774 6820 6c69 6d69 742e 0a20  -length limit.. 
+000344b0: 2020 2020 2020 2020 2a2f 0a0a 2020 2020          */..    
+000344c0: 2020 2020 2f2f 4e6f 726d 616c 697a 6520      //Normalize 
+000344d0: 6c69 6e65 2062 7265 616b 7320 6265 666f  line breaks befo
+000344e0: 7265 2065 7870 6c6f 6469 6e67 0a20 2020  re exploding.   
+000344f0: 2020 2020 2024 6c69 6e65 7320 3d20 6578       $lines = ex
+00034500: 706c 6f64 6528 225c 6e22 2c20 7374 725f  plode("\n", str_
+00034510: 7265 706c 6163 6528 5b22 5c72 5c6e 222c  replace(["\r\n",
+00034520: 2022 5c72 225d 2c20 225c 6e22 2c20 246d   "\r"], "\n", $m
+00034530: 7367 5f64 6174 6129 293b 0a0a 2020 2020  sg_data));..    
+00034540: 2020 2020 2f2a 2054 6f20 6469 7374 696e      /* To distin
+00034550: 6775 6973 6820 6265 7477 6565 6e20 6120  guish between a 
+00034560: 636f 6d70 6c65 7465 2052 4643 3832 3220  complete RFC822 
+00034570: 6d65 7373 6167 6520 616e 6420 6120 706c  message and a pl
+00034580: 6169 6e20 6d65 7373 6167 6520 626f 6479  ain message body
+00034590: 2c20 7765 2063 6865 636b 2069 6620 7468  , we check if th
+000345a0: 6520 6669 7273 7420 6669 656c 640a 2020  e first field.  
+000345b0: 2020 2020 2020 202a 206f 6620 7468 6520         * of the 
+000345c0: 6669 7273 7420 6c69 6e65 2028 273a 2720  first line (':' 
+000345d0: 7365 7061 7261 7465 6429 2064 6f65 7320  separated) does 
+000345e0: 6e6f 7420 636f 6e74 6169 6e20 6120 7370  not contain a sp
+000345f0: 6163 6520 7468 656e 2069 7420 5f73 686f  ace then it _sho
+00034600: 756c 645f 2062 6520 6120 6865 6164 6572  uld_ be a header
+00034610: 2c20 616e 6420 7765 2077 696c 6c0a 2020  , and we will.  
+00034620: 2020 2020 2020 202a 2070 726f 6365 7373         * process
+00034630: 2061 6c6c 206c 696e 6573 2062 6566 6f72   all lines befor
+00034640: 6520 6120 626c 616e 6b20 6c69 6e65 2061  e a blank line a
+00034650: 7320 6865 6164 6572 732e 0a20 2020 2020  s headers..     
+00034660: 2020 2020 2a2f 0a0a 2020 2020 2020 2020      */..        
+00034670: 2466 6965 6c64 203d 2073 7562 7374 7228  $field = substr(
+00034680: 246c 696e 6573 5b30 5d2c 2030 2c20 7374  $lines[0], 0, st
+00034690: 7270 6f73 2824 6c69 6e65 735b 305d 2c20  rpos($lines[0], 
+000346a0: 273a 2729 293b 0a20 2020 2020 2020 2024  ':'));.        $
+000346b0: 696e 5f68 6561 6465 7273 203d 2066 616c  in_headers = fal
+000346c0: 7365 3b0a 2020 2020 2020 2020 6966 2028  se;.        if (
+000346d0: 2165 6d70 7479 2824 6669 656c 6429 2026  !empty($field) &
+000346e0: 2620 7374 7270 6f73 2824 6669 656c 642c  & strpos($field,
+000346f0: 2027 2027 2920 3d3d 3d20 6661 6c73 6529   ' ') === false)
+00034700: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+00034710: 696e 5f68 6561 6465 7273 203d 2074 7275  in_headers = tru
+00034720: 653b 0a20 2020 2020 2020 207d 0a0a 2020  e;.        }..  
+00034730: 2020 2020 2020 666f 7265 6163 6820 2824        foreach ($
+00034740: 6c69 6e65 7320 6173 2024 6c69 6e65 2920  lines as $line) 
+00034750: 7b0a 2020 2020 2020 2020 2020 2020 246c  {.            $l
+00034760: 696e 6573 5f6f 7574 203d 205b 5d3b 0a20  ines_out = [];. 
+00034770: 2020 2020 2020 2020 2020 2069 6620 2824             if ($
+00034780: 696e 5f68 6561 6465 7273 2026 2620 246c  in_headers && $l
+00034790: 696e 6520 3d3d 3d20 2727 2920 7b0a 2020  ine === '') {.  
+000347a0: 2020 2020 2020 2020 2020 2020 2020 2469                $i
+000347b0: 6e5f 6865 6164 6572 7320 3d20 6661 6c73  n_headers = fals
+000347c0: 653b 0a20 2020 2020 2020 2020 2020 207d  e;.            }
+000347d0: 0a20 2020 2020 2020 2020 2020 202f 2f42  .            //B
+000347e0: 7265 616b 2074 6869 7320 6c69 6e65 2075  reak this line u
+000347f0: 7020 696e 746f 2073 6576 6572 616c 2073  p into several s
+00034800: 6d61 6c6c 6572 206c 696e 6573 2069 6620  maller lines if 
+00034810: 6974 2773 2074 6f6f 206c 6f6e 670a 2020  it's too long.  
+00034820: 2020 2020 2020 2020 2020 2f2f 4d69 6372            //Micr
+00034830: 6f2d 6f70 7469 6d69 7361 7469 6f6e 3a20  o-optimisation: 
+00034840: 6973 7365 7428 2473 7472 5b24 6c65 6e5d  isset($str[$len]
+00034850: 2920 6973 2066 6173 7465 7220 7468 616e  ) is faster than
+00034860: 2028 7374 726c 656e 2824 7374 7229 203e   (strlen($str) >
+00034870: 2024 6c65 6e29 2c0a 2020 2020 2020 2020   $len),.        
+00034880: 2020 2020 7768 696c 6520 2869 7373 6574      while (isset
+00034890: 2824 6c69 6e65 5b73 656c 663a 3a4d 4158  ($line[self::MAX
+000348a0: 5f4c 494e 455f 4c45 4e47 5448 5d29 2920  _LINE_LENGTH])) 
+000348b0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000348c0: 2020 2f2f 576f 726b 696e 6720 6261 636b    //Working back
+000348d0: 7761 7264 732c 2074 7279 2074 6f20 6669  wards, try to fi
+000348e0: 6e64 2061 2073 7061 6365 2077 6974 6869  nd a space withi
+000348f0: 6e20 7468 6520 6c61 7374 204d 4158 5f4c  n the last MAX_L
+00034900: 494e 455f 4c45 4e47 5448 2063 6861 7273  INE_LENGTH chars
+00034910: 206f 6620 7468 6520 6c69 6e65 2074 6f20   of the line to 
+00034920: 6272 6561 6b20 6f6e 0a20 2020 2020 2020  break on.       
+00034930: 2020 2020 2020 2020 202f 2f73 6f20 6173           //so as
+00034940: 2074 6f20 6176 6f69 6420 6272 6561 6b69   to avoid breaki
+00034950: 6e67 2069 6e20 7468 6520 6d69 6464 6c65  ng in the middle
+00034960: 206f 6620 6120 776f 7264 0a20 2020 2020   of a word.     
+00034970: 2020 2020 2020 2020 2020 2024 706f 7320             $pos 
+00034980: 3d20 7374 7272 706f 7328 7375 6273 7472  = strrpos(substr
+00034990: 2824 6c69 6e65 2c20 302c 2073 656c 663a  ($line, 0, self:
+000349a0: 3a4d 4158 5f4c 494e 455f 4c45 4e47 5448  :MAX_LINE_LENGTH
+000349b0: 292c 2027 2027 293b 0a20 2020 2020 2020  ), ' ');.       
+000349c0: 2020 2020 2020 2020 202f 2f44 656c 6962           //Delib
+000349d0: 6572 6174 656c 7920 6d61 7463 6865 7320  erately matches 
+000349e0: 626f 7468 2066 616c 7365 2061 6e64 2030  both false and 0
+000349f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034a00: 2069 6620 2821 2470 6f73 2920 7b0a 2020   if (!$pos) {.  
+00034a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034a20: 2020 2f2f 4e6f 206e 6963 6520 6272 6561    //No nice brea
+00034a30: 6b20 666f 756e 642c 2061 6464 2061 2068  k found, add a h
+00034a40: 6172 6420 6272 6561 6b0a 2020 2020 2020  ard break.      
+00034a50: 2020 2020 2020 2020 2020 2020 2020 2470                $p
+00034a60: 6f73 203d 2073 656c 663a 3a4d 4158 5f4c  os = self::MAX_L
+00034a70: 494e 455f 4c45 4e47 5448 202d 2031 3b0a  INE_LENGTH - 1;.
+00034a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034a90: 2020 2020 246c 696e 6573 5f6f 7574 5b5d      $lines_out[]
+00034aa0: 203d 2073 7562 7374 7228 246c 696e 652c   = substr($line,
+00034ab0: 2030 2c20 2470 6f73 293b 0a20 2020 2020   0, $pos);.     
+00034ac0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00034ad0: 6c69 6e65 203d 2073 7562 7374 7228 246c  line = substr($l
+00034ae0: 696e 652c 2024 706f 7329 3b0a 2020 2020  ine, $pos);.    
+00034af0: 2020 2020 2020 2020 2020 2020 7d20 656c              } el
+00034b00: 7365 207b 0a20 2020 2020 2020 2020 2020  se {.           
+00034b10: 2020 2020 2020 2020 202f 2f42 7265 616b           //Break
+00034b20: 2061 7420 7468 6520 666f 756e 6420 706f   at the found po
+00034b30: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00034b40: 2020 2020 2020 2020 246c 696e 6573 5f6f          $lines_o
+00034b50: 7574 5b5d 203d 2073 7562 7374 7228 246c  ut[] = substr($l
+00034b60: 696e 652c 2030 2c20 2470 6f73 293b 0a20  ine, 0, $pos);. 
+00034b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034b80: 2020 202f 2f4d 6f76 6520 616c 6f6e 6720     //Move along 
+00034b90: 6279 2074 6865 2061 6d6f 756e 7420 7765  by the amount we
+00034ba0: 2064 6561 6c74 2077 6974 680a 2020 2020   dealt with.    
+00034bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034bc0: 246c 696e 6520 3d20 7375 6273 7472 2824  $line = substr($
+00034bd0: 6c69 6e65 2c20 2470 6f73 202b 2031 293b  line, $pos + 1);
+00034be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034bf0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00034c00: 2020 202f 2f49 6620 7072 6f63 6573 7369     //If processi
+00034c10: 6e67 2068 6561 6465 7273 2061 6464 2061  ng headers add a
+00034c20: 204c 5753 502d 6368 6172 2074 6f20 7468   LWSP-char to th
+00034c30: 6520 6672 6f6e 7420 6f66 206e 6577 206c  e front of new l
+00034c40: 696e 6520 5246 4338 3232 2073 6563 7469  ine RFC822 secti
+00034c50: 6f6e 2033 2e31 2e31 0a20 2020 2020 2020  on 3.1.1.       
+00034c60: 2020 2020 2020 2020 2069 6620 2824 696e           if ($in
+00034c70: 5f68 6561 6465 7273 2920 7b0a 2020 2020  _headers) {.    
+00034c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034c90: 246c 696e 6520 3d20 225c 7422 202e 2024  $line = "\t" . $
+00034ca0: 6c69 6e65 3b0a 2020 2020 2020 2020 2020  line;.          
+00034cb0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00034cc0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00034cd0: 2020 246c 696e 6573 5f6f 7574 5b5d 203d    $lines_out[] =
+00034ce0: 2024 6c69 6e65 3b0a 0a20 2020 2020 2020   $line;..       
+00034cf0: 2020 2020 202f 2f53 656e 6420 7468 6520       //Send the 
+00034d00: 6c69 6e65 7320 746f 2074 6865 2073 6572  lines to the ser
+00034d10: 7665 720a 2020 2020 2020 2020 2020 2020  ver.            
+00034d20: 666f 7265 6163 6820 2824 6c69 6e65 735f  foreach ($lines_
+00034d30: 6f75 7420 6173 2024 6c69 6e65 5f6f 7574  out as $line_out
+00034d40: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00034d50: 2020 2020 2f2f 446f 742d 7374 7566 6669      //Dot-stuffi
+00034d60: 6e67 2061 7320 7065 7220 5246 4335 3332  ng as per RFC532
+00034d70: 3120 7365 6374 696f 6e20 342e 352e 320a  1 section 4.5.2.
+00034d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034d90: 2f2f 6874 7470 733a 2f2f 746f 6f6c 732e  //https://tools.
+00034da0: 6965 7466 2e6f 7267 2f68 746d 6c2f 7266  ietf.org/html/rf
+00034db0: 6335 3332 3123 7365 6374 696f 6e2d 342e  c5321#section-4.
+00034dc0: 352e 320a 2020 2020 2020 2020 2020 2020  5.2.            
+00034dd0: 2020 2020 6966 2028 2165 6d70 7479 2824      if (!empty($
+00034de0: 6c69 6e65 5f6f 7574 2920 2626 2024 6c69  line_out) && $li
+00034df0: 6e65 5f6f 7574 5b30 5d20 3d3d 3d20 272e  ne_out[0] === '.
+00034e00: 2729 207b 0a20 2020 2020 2020 2020 2020  ') {.           
+00034e10: 2020 2020 2020 2020 2024 6c69 6e65 5f6f           $line_o
+00034e20: 7574 203d 2027 2e27 202e 2024 6c69 6e65  ut = '.' . $line
+00034e30: 5f6f 7574 3b0a 2020 2020 2020 2020 2020  _out;.          
+00034e40: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00034e50: 2020 2020 2020 2020 2474 6869 732d 3e63          $this->c
+00034e60: 6c69 656e 745f 7365 6e64 2824 6c69 6e65  lient_send($line
+00034e70: 5f6f 7574 202e 2073 7461 7469 633a 3a4c  _out . static::L
+00034e80: 452c 2027 4441 5441 2729 3b0a 2020 2020  E, 'DATA');.    
+00034e90: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00034ea0: 2020 7d0a 0a20 2020 2020 2020 202f 2f4d    }..        //M
+00034eb0: 6573 7361 6765 2064 6174 6120 6861 7320  essage data has 
+00034ec0: 6265 656e 2073 656e 742c 2063 6f6d 706c  been sent, compl
+00034ed0: 6574 6520 7468 6520 636f 6d6d 616e 640a  ete the command.
+00034ee0: 2020 2020 2020 2020 2f2f 496e 6372 6561          //Increa
+00034ef0: 7365 2074 696d 656c 696d 6974 2066 6f72  se timelimit for
+00034f00: 2065 6e64 206f 6620 4441 5441 2063 6f6d   end of DATA com
+00034f10: 6d61 6e64 0a20 2020 2020 2020 2024 7361  mand.        $sa
+00034f20: 7665 7469 6d65 6c69 6d69 7420 3d20 2474  vetimelimit = $t
+00034f30: 6869 732d 3e54 696d 656c 696d 6974 3b0a  his->Timelimit;.
+00034f40: 2020 2020 2020 2020 2474 6869 732d 3e54          $this->T
+00034f50: 696d 656c 696d 6974 202a 3d20 323b 0a20  imelimit *= 2;. 
+00034f60: 2020 2020 2020 2024 7265 7375 6c74 203d         $result =
+00034f70: 2024 7468 6973 2d3e 7365 6e64 436f 6d6d   $this->sendComm
+00034f80: 616e 6428 2744 4154 4120 454e 4427 2c20  and('DATA END', 
+00034f90: 272e 272c 2032 3530 293b 0a20 2020 2020  '.', 250);.     
+00034fa0: 2020 2024 7468 6973 2d3e 7265 636f 7264     $this->record
+00034fb0: 4c61 7374 5472 616e 7361 6374 696f 6e49  LastTransactionI
+00034fc0: 4428 293b 0a20 2020 2020 2020 202f 2f52  D();.        //R
+00034fd0: 6573 746f 7265 2074 696d 656c 696d 6974  estore timelimit
+00034fe0: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+00034ff0: 5469 6d65 6c69 6d69 7420 3d20 2473 6176  Timelimit = $sav
+00035000: 6574 696d 656c 696d 6974 3b0a 0a20 2020  etimelimit;..   
+00035010: 2020 2020 2072 6574 7572 6e20 2472 6573       return $res
+00035020: 756c 743b 0a20 2020 207d 0a0a 2020 2020  ult;.    }..    
+00035030: 2f2a 2a0a 2020 2020 202a 2053 656e 6420  /**.     * Send 
+00035040: 616e 2053 4d54 5020 4845 4c4f 206f 7220  an SMTP HELO or 
+00035050: 4548 4c4f 2063 6f6d 6d61 6e64 2e0a 2020  EHLO command..  
+00035060: 2020 202a 2055 7365 6420 746f 2069 6465     * Used to ide
+00035070: 6e74 6966 7920 7468 6520 7365 6e64 696e  ntify the sendin
+00035080: 6720 7365 7276 6572 2074 6f20 7468 6520  g server to the 
+00035090: 7265 6365 6976 696e 6720 7365 7276 6572  receiving server
+000350a0: 2e0a 2020 2020 202a 2054 6869 7320 6d61  ..     * This ma
+000350b0: 6b65 7320 7375 7265 2074 6861 7420 636c  kes sure that cl
+000350c0: 6965 6e74 2061 6e64 2073 6572 7665 7220  ient and server 
+000350d0: 6172 6520 696e 2061 206b 6e6f 776e 2073  are in a known s
+000350e0: 7461 7465 2e0a 2020 2020 202a 2049 6d70  tate..     * Imp
+000350f0: 6c65 6d65 6e74 7320 5246 4320 3832 313a  lements RFC 821:
+00035100: 2048 454c 4f20 3c53 503e 203c 646f 6d61   HELO <SP> <doma
+00035110: 696e 3e20 3c43 524c 463e 0a20 2020 2020  in> <CRLF>.     
+00035120: 2a20 616e 6420 5246 4320 3238 3231 2045  * and RFC 2821 E
+00035130: 484c 4f2e 0a20 2020 2020 2a0a 2020 2020  HLO..     *.    
+00035140: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00035150: 2024 686f 7374 2054 6865 2068 6f73 7420   $host The host 
+00035160: 6e61 6d65 206f 7220 4950 2074 6f20 636f  name or IP to co
+00035170: 6e6e 6563 7420 746f 0a20 2020 2020 2a0a  nnect to.     *.
+00035180: 2020 2020 202a 2040 7265 7475 726e 2062       * @return b
+00035190: 6f6f 6c0a 2020 2020 202a 2f0a 2020 2020  ool.     */.    
+000351a0: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+000351b0: 6865 6c6c 6f28 2468 6f73 7420 3d20 2727  hello($host = ''
+000351c0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+000351d0: 2f2f 5472 7920 6578 7465 6e64 6564 2068  //Try extended h
+000351e0: 656c 6c6f 2066 6972 7374 2028 5246 4320  ello first (RFC 
+000351f0: 3238 3231 290a 2020 2020 2020 2020 6966  2821).        if
+00035200: 2028 2474 6869 732d 3e73 656e 6448 656c   ($this->sendHel
+00035210: 6c6f 2827 4548 4c4f 272c 2024 686f 7374  lo('EHLO', $host
+00035220: 2929 207b 0a20 2020 2020 2020 2020 2020  )) {.           
+00035230: 2072 6574 7572 6e20 7472 7565 3b0a 2020   return true;.  
+00035240: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00035250: 202f 2f53 6f6d 6520 7365 7276 6572 7320   //Some servers 
+00035260: 7368 7574 2064 6f77 6e20 7468 6520 534d  shut down the SM
+00035270: 5450 2073 6572 7669 6365 2068 6572 6520  TP service here 
+00035280: 2852 4643 2035 3332 3129 0a20 2020 2020  (RFC 5321).     
+00035290: 2020 2069 6620 2873 7562 7374 7228 2474     if (substr($t
+000352a0: 6869 732d 3e68 656c 6f5f 7270 6c79 2c20  his->helo_rply, 
+000352b0: 302c 2033 2920 3d3d 2027 3432 3127 2920  0, 3) == '421') 
+000352c0: 7b0a 2020 2020 2020 2020 2020 2020 7265  {.            re
+000352d0: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
+000352e0: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
+000352f0: 6574 7572 6e20 2474 6869 732d 3e73 656e  eturn $this->sen
+00035300: 6448 656c 6c6f 2827 4845 4c4f 272c 2024  dHello('HELO', $
+00035310: 686f 7374 293b 0a20 2020 207d 0a0a 2020  host);.    }..  
+00035320: 2020 2f2a 2a0a 2020 2020 202a 2053 656e    /**.     * Sen
+00035330: 6420 616e 2053 4d54 5020 4845 4c4f 206f  d an SMTP HELO o
+00035340: 7220 4548 4c4f 2063 6f6d 6d61 6e64 2e0a  r EHLO command..
+00035350: 2020 2020 202a 204c 6f77 2d6c 6576 656c       * Low-level
+00035360: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
+00035370: 7573 6564 2062 7920 6865 6c6c 6f28 292e  used by hello().
+00035380: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00035390: 7061 7261 6d20 7374 7269 6e67 2024 6865  param string $he
+000353a0: 6c6c 6f20 5468 6520 4845 4c4f 2073 7472  llo The HELO str
+000353b0: 696e 670a 2020 2020 202a 2040 7061 7261  ing.     * @para
+000353c0: 6d20 7374 7269 6e67 2024 686f 7374 2020  m string $host  
+000353d0: 5468 6520 686f 7374 6e61 6d65 2074 6f20  The hostname to 
+000353e0: 7361 7920 7765 2061 7265 0a20 2020 2020  say we are.     
+000353f0: 2a0a 2020 2020 202a 2040 7265 7475 726e  *.     * @return
+00035400: 2062 6f6f 6c0a 2020 2020 202a 0a20 2020   bool.     *.   
+00035410: 2020 2a20 4073 6565 2068 656c 6c6f 2829    * @see hello()
+00035420: 0a20 2020 2020 2a2f 0a20 2020 2070 726f  .     */.    pro
+00035430: 7465 6374 6564 2066 756e 6374 696f 6e20  tected function 
+00035440: 7365 6e64 4865 6c6c 6f28 2468 656c 6c6f  sendHello($hello
+00035450: 2c20 2468 6f73 7429 0a20 2020 207b 0a20  , $host).    {. 
+00035460: 2020 2020 2020 2024 6e6f 6572 726f 7220         $noerror 
+00035470: 3d20 2474 6869 732d 3e73 656e 6443 6f6d  = $this->sendCom
+00035480: 6d61 6e64 2824 6865 6c6c 6f2c 2024 6865  mand($hello, $he
+00035490: 6c6c 6f20 2e20 2720 2720 2e20 2468 6f73  llo . ' ' . $hos
+000354a0: 742c 2032 3530 293b 0a20 2020 2020 2020  t, 250);.       
+000354b0: 2024 7468 6973 2d3e 6865 6c6f 5f72 706c   $this->helo_rpl
+000354c0: 7920 3d20 2474 6869 732d 3e6c 6173 745f  y = $this->last_
+000354d0: 7265 706c 793b 0a20 2020 2020 2020 2069  reply;.        i
+000354e0: 6620 2824 6e6f 6572 726f 7229 207b 0a20  f ($noerror) {. 
+000354f0: 2020 2020 2020 2020 2020 2024 7468 6973             $this
+00035500: 2d3e 7061 7273 6548 656c 6c6f 4669 656c  ->parseHelloFiel
+00035510: 6473 2824 6865 6c6c 6f29 3b0a 2020 2020  ds($hello);.    
+00035520: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
+00035530: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00035540: 7365 7276 6572 5f63 6170 7320 3d20 6e75  server_caps = nu
+00035550: 6c6c 3b0a 2020 2020 2020 2020 7d0a 0a20  ll;.        }.. 
+00035560: 2020 2020 2020 2072 6574 7572 6e20 246e         return $n
+00035570: 6f65 7272 6f72 3b0a 2020 2020 7d0a 0a20  oerror;.    }.. 
+00035580: 2020 202f 2a2a 0a20 2020 2020 2a20 5061     /**.     * Pa
+00035590: 7273 6520 6120 7265 706c 7920 746f 2048  rse a reply to H
+000355a0: 454c 4f2f 4548 4c4f 2063 6f6d 6d61 6e64  ELO/EHLO command
+000355b0: 2074 6f20 6469 7363 6f76 6572 2073 6572   to discover ser
+000355c0: 7665 7220 6578 7465 6e73 696f 6e73 2e0a  ver extensions..
+000355d0: 2020 2020 202a 2049 6e20 6361 7365 206f       * In case o
+000355e0: 6620 4845 4c4f 2c20 7468 6520 6f6e 6c79  f HELO, the only
+000355f0: 2070 6172 616d 6574 6572 2074 6861 7420   parameter that 
+00035600: 6361 6e20 6265 2064 6973 636f 7665 7265  can be discovere
+00035610: 6420 6973 2061 2073 6572 7665 7220 6e61  d is a server na
+00035620: 6d65 2e0a 2020 2020 202a 0a20 2020 2020  me..     *.     
+00035630: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+00035640: 2474 7970 6520 6048 454c 4f60 206f 7220  $type `HELO` or 
+00035650: 6045 484c 4f60 0a20 2020 2020 2a2f 0a20  `EHLO`.     */. 
+00035660: 2020 2070 726f 7465 6374 6564 2066 756e     protected fun
+00035670: 6374 696f 6e20 7061 7273 6548 656c 6c6f  ction parseHello
+00035680: 4669 656c 6473 2824 7479 7065 290a 2020  Fields($type).  
+00035690: 2020 7b0a 2020 2020 2020 2020 2474 6869    {.        $thi
+000356a0: 732d 3e73 6572 7665 725f 6361 7073 203d  s->server_caps =
+000356b0: 205b 5d3b 0a20 2020 2020 2020 2024 6c69   [];.        $li
+000356c0: 6e65 7320 3d20 6578 706c 6f64 6528 225c  nes = explode("\
+000356d0: 6e22 2c20 2474 6869 732d 3e68 656c 6f5f  n", $this->helo_
+000356e0: 7270 6c79 293b 0a0a 2020 2020 2020 2020  rply);..        
+000356f0: 666f 7265 6163 6820 2824 6c69 6e65 7320  foreach ($lines 
+00035700: 6173 2024 6e20 3d3e 2024 7329 207b 0a20  as $n => $s) {. 
+00035710: 2020 2020 2020 2020 2020 202f 2f46 6972             //Fir
+00035720: 7374 2034 2063 6861 7273 2063 6f6e 7461  st 4 chars conta
+00035730: 696e 2072 6573 706f 6e73 6520 636f 6465  in response code
+00035740: 2066 6f6c 6c6f 7765 6420 6279 202d 206f   followed by - o
+00035750: 7220 7370 6163 650a 2020 2020 2020 2020  r space.        
+00035760: 2020 2020 2473 203d 2074 7269 6d28 7375      $s = trim(su
+00035770: 6273 7472 2824 732c 2034 2929 3b0a 2020  bstr($s, 4));.  
+00035780: 2020 2020 2020 2020 2020 6966 2028 656d            if (em
+00035790: 7074 7928 2473 2929 207b 0a20 2020 2020  pty($s)) {.     
+000357a0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000357b0: 6e75 653b 0a20 2020 2020 2020 2020 2020  nue;.           
+000357c0: 207d 0a20 2020 2020 2020 2020 2020 2024   }.            $
+000357d0: 6669 656c 6473 203d 2065 7870 6c6f 6465  fields = explode
+000357e0: 2827 2027 2c20 2473 293b 0a20 2020 2020  (' ', $s);.     
+000357f0: 2020 2020 2020 2069 6620 2821 656d 7074         if (!empt
+00035800: 7928 2466 6965 6c64 7329 2920 7b0a 2020  y($fields)) {.  
+00035810: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00035820: 2028 2124 6e29 207b 0a20 2020 2020 2020   (!$n) {.       
+00035830: 2020 2020 2020 2020 2020 2020 2024 6e61               $na
+00035840: 6d65 203d 2024 7479 7065 3b0a 2020 2020  me = $type;.    
+00035850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035860: 2466 6965 6c64 7320 3d20 2466 6965 6c64  $fields = $field
+00035870: 735b 305d 3b0a 2020 2020 2020 2020 2020  s[0];.          
+00035880: 2020 2020 2020 7d20 656c 7365 207b 0a20        } else {. 
+00035890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000358a0: 2020 2024 6e61 6d65 203d 2061 7272 6179     $name = array
+000358b0: 5f73 6869 6674 2824 6669 656c 6473 293b  _shift($fields);
+000358c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000358d0: 2020 2020 2073 7769 7463 6820 2824 6e61       switch ($na
+000358e0: 6d65 2920 7b0a 2020 2020 2020 2020 2020  me) {.          
+000358f0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00035900: 7365 2027 5349 5a45 273a 0a20 2020 2020  se 'SIZE':.     
+00035910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035920: 2020 2020 2020 2024 6669 656c 6473 203d         $fields =
+00035930: 2028 2466 6965 6c64 7320 3f20 2466 6965   ($fields ? $fie
+00035940: 6c64 735b 305d 203a 2030 293b 0a20 2020  lds[0] : 0);.   
+00035950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035960: 2020 2020 2020 2020 2062 7265 616b 3b0a           break;.
+00035970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035980: 2020 2020 2020 2020 6361 7365 2027 4155          case 'AU
+00035990: 5448 273a 0a20 2020 2020 2020 2020 2020  TH':.           
+000359a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000359b0: 2069 6620 2821 6973 5f61 7272 6179 2824   if (!is_array($
+000359c0: 6669 656c 6473 2929 207b 0a20 2020 2020  fields)) {.     
+000359d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000359e0: 2020 2020 2020 2020 2020 2024 6669 656c             $fiel
+000359f0: 6473 203d 205b 5d3b 0a20 2020 2020 2020  ds = [];.       
+00035a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035a10: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00035a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035a30: 2020 2062 7265 616b 3b0a 2020 2020 2020     break;.      
+00035a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035a50: 2020 6465 6661 756c 743a 0a20 2020 2020    default:.     
+00035a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035a70: 2020 2020 2020 2024 6669 656c 6473 203d         $fields =
+00035a80: 2074 7275 653b 0a20 2020 2020 2020 2020   true;.         
+00035a90: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00035aa0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+00035ab0: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00035ac0: 7468 6973 2d3e 7365 7276 6572 5f63 6170  this->server_cap
+00035ad0: 735b 246e 616d 655d 203d 2024 6669 656c  s[$name] = $fiel
+00035ae0: 6473 3b0a 2020 2020 2020 2020 2020 2020  ds;.            
+00035af0: 7d0a 2020 2020 2020 2020 7d0a 2020 2020  }.        }.    
+00035b00: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00035b10: 2a20 5365 6e64 2061 6e20 534d 5450 204d  * Send an SMTP M
+00035b20: 4149 4c20 636f 6d6d 616e 642e 0a20 2020  AIL command..   
+00035b30: 2020 2a20 5374 6172 7473 2061 206d 6169    * Starts a mai
+00035b40: 6c20 7472 616e 7361 6374 696f 6e20 6672  l transaction fr
+00035b50: 6f6d 2074 6865 2065 6d61 696c 2061 6464  om the email add
+00035b60: 7265 7373 2073 7065 6369 6669 6564 2069  ress specified i
+00035b70: 6e0a 2020 2020 202a 2024 6672 6f6d 2e20  n.     * $from. 
+00035b80: 5265 7475 726e 7320 7472 7565 2069 6620  Returns true if 
+00035b90: 7375 6363 6573 7366 756c 206f 7220 6661  successful or fa
+00035ba0: 6c73 6520 6f74 6865 7277 6973 652e 2049  lse otherwise. I
+00035bb0: 6620 5472 7565 0a20 2020 2020 2a20 7468  f True.     * th
+00035bc0: 6520 6d61 696c 2074 7261 6e73 6163 7469  e mail transacti
+00035bd0: 6f6e 2069 7320 7374 6172 7465 6420 616e  on is started an
+00035be0: 6420 7468 656e 206f 6e65 206f 7220 6d6f  d then one or mo
+00035bf0: 7265 2072 6563 6970 6965 6e74 0a20 2020  re recipient.   
+00035c00: 2020 2a20 636f 6d6d 616e 6473 206d 6179    * commands may
+00035c10: 2062 6520 6361 6c6c 6564 2066 6f6c 6c6f   be called follo
+00035c20: 7765 6420 6279 2061 2064 6174 6120 636f  wed by a data co
+00035c30: 6d6d 616e 642e 0a20 2020 2020 2a20 496d  mmand..     * Im
+00035c40: 706c 656d 656e 7473 2052 4643 2038 3231  plements RFC 821
+00035c50: 3a20 4d41 494c 203c 5350 3e20 4652 4f4d  : MAIL <SP> FROM
+00035c60: 3a3c 7265 7665 7273 652d 7061 7468 3e20  :<reverse-path> 
+00035c70: 3c43 524c 463e 2e0a 2020 2020 202a 0a20  <CRLF>..     *. 
+00035c80: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00035c90: 696e 6720 2466 726f 6d20 536f 7572 6365  ing $from Source
+00035ca0: 2061 6464 7265 7373 206f 6620 7468 6973   address of this
+00035cb0: 206d 6573 7361 6765 0a20 2020 2020 2a0a   message.     *.
+00035cc0: 2020 2020 202a 2040 7265 7475 726e 2062       * @return b
+00035cd0: 6f6f 6c0a 2020 2020 202a 2f0a 2020 2020  ool.     */.    
+00035ce0: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+00035cf0: 6d61 696c 2824 6672 6f6d 290a 2020 2020  mail($from).    
+00035d00: 7b0a 2020 2020 2020 2020 2475 7365 5665  {.        $useVe
+00035d10: 7270 203d 2028 2474 6869 732d 3e64 6f5f  rp = ($this->do_
+00035d20: 7665 7270 203f 2027 2058 5645 5250 2720  verp ? ' XVERP' 
+00035d30: 3a20 2727 293b 0a0a 2020 2020 2020 2020  : '');..        
+00035d40: 7265 7475 726e 2024 7468 6973 2d3e 7365  return $this->se
+00035d50: 6e64 436f 6d6d 616e 6428 0a20 2020 2020  ndCommand(.     
+00035d60: 2020 2020 2020 2027 4d41 494c 2046 524f         'MAIL FRO
+00035d70: 4d27 2c0a 2020 2020 2020 2020 2020 2020  M',.            
+00035d80: 274d 4149 4c20 4652 4f4d 3a3c 2720 2e20  'MAIL FROM:<' . 
+00035d90: 2466 726f 6d20 2e20 273e 2720 2e20 2475  $from . '>' . $u
+00035da0: 7365 5665 7270 2c0a 2020 2020 2020 2020  seVerp,.        
+00035db0: 2020 2020 3235 300a 2020 2020 2020 2020      250.        
+00035dc0: 293b 0a20 2020 207d 0a0a 2020 2020 2f2a  );.    }..    /*
+00035dd0: 2a0a 2020 2020 202a 2053 656e 6420 616e  *.     * Send an
+00035de0: 2053 4d54 5020 5155 4954 2063 6f6d 6d61   SMTP QUIT comma
+00035df0: 6e64 2e0a 2020 2020 202a 2043 6c6f 7365  nd..     * Close
+00035e00: 7320 7468 6520 736f 636b 6574 2069 6620  s the socket if 
+00035e10: 7468 6572 6520 6973 206e 6f20 6572 726f  there is no erro
+00035e20: 7220 6f72 2074 6865 2024 636c 6f73 655f  r or the $close_
+00035e30: 6f6e 5f65 7272 6f72 2061 7267 756d 656e  on_error argumen
+00035e40: 7420 6973 2074 7275 652e 0a20 2020 2020  t is true..     
+00035e50: 2a20 496d 706c 656d 656e 7473 2066 726f  * Implements fro
+00035e60: 6d20 5246 4320 3832 313a 2051 5549 5420  m RFC 821: QUIT 
+00035e70: 3c43 524c 463e 2e0a 2020 2020 202a 0a20  <CRLF>..     *. 
+00035e80: 2020 2020 2a20 4070 6172 616d 2062 6f6f      * @param boo
+00035e90: 6c20 2463 6c6f 7365 5f6f 6e5f 6572 726f  l $close_on_erro
+00035ea0: 7220 5368 6f75 6c64 2074 6865 2063 6f6e  r Should the con
+00035eb0: 6e65 6374 696f 6e20 636c 6f73 6520 6966  nection close if
+00035ec0: 2061 6e20 6572 726f 7220 6f63 6375 7273   an error occurs
+00035ed0: 3f0a 2020 2020 202a 0a20 2020 2020 2a20  ?.     *.     * 
+00035ee0: 4072 6574 7572 6e20 626f 6f6c 0a20 2020  @return bool.   
+00035ef0: 2020 2a2f 0a20 2020 2070 7562 6c69 6320    */.    public 
+00035f00: 6675 6e63 7469 6f6e 2071 7569 7428 2463  function quit($c
+00035f10: 6c6f 7365 5f6f 6e5f 6572 726f 7220 3d20  lose_on_error = 
+00035f20: 7472 7565 290a 2020 2020 7b0a 2020 2020  true).    {.    
+00035f30: 2020 2020 246e 6f65 7272 6f72 203d 2024      $noerror = $
+00035f40: 7468 6973 2d3e 7365 6e64 436f 6d6d 616e  this->sendComman
+00035f50: 6428 2751 5549 5427 2c20 2751 5549 5427  d('QUIT', 'QUIT'
+00035f60: 2c20 3232 3129 3b0a 2020 2020 2020 2020  , 221);.        
+00035f70: 2465 7272 203d 2024 7468 6973 2d3e 6572  $err = $this->er
+00035f80: 726f 723b 202f 2f53 6176 6520 616e 7920  ror; //Save any 
+00035f90: 6572 726f 720a 2020 2020 2020 2020 6966  error.        if
+00035fa0: 2028 246e 6f65 7272 6f72 207c 7c20 2463   ($noerror || $c
+00035fb0: 6c6f 7365 5f6f 6e5f 6572 726f 7229 207b  lose_on_error) {
+00035fc0: 0a20 2020 2020 2020 2020 2020 2024 7468  .            $th
+00035fd0: 6973 2d3e 636c 6f73 6528 293b 0a20 2020  is->close();.   
+00035fe0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00035ff0: 6572 726f 7220 3d20 2465 7272 3b20 2f2f  error = $err; //
+00036000: 5265 7374 6f72 6520 616e 7920 6572 726f  Restore any erro
+00036010: 7220 6672 6f6d 2074 6865 2071 7569 7420  r from the quit 
+00036020: 636f 6d6d 616e 640a 2020 2020 2020 2020  command.        
+00036030: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+00036040: 6e20 246e 6f65 7272 6f72 3b0a 2020 2020  n $noerror;.    
+00036050: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00036060: 2a20 5365 6e64 2061 6e20 534d 5450 2052  * Send an SMTP R
+00036070: 4350 5420 636f 6d6d 616e 642e 0a20 2020  CPT command..   
+00036080: 2020 2a20 5365 7473 2074 6865 2054 4f20    * Sets the TO 
+00036090: 6172 6775 6d65 6e74 2074 6f20 2474 6f61  argument to $toa
+000360a0: 6464 722e 0a20 2020 2020 2a20 5265 7475  ddr..     * Retu
+000360b0: 726e 7320 7472 7565 2069 6620 7468 6520  rns true if the 
+000360c0: 7265 6369 7069 656e 7420 7761 7320 6163  recipient was ac
+000360d0: 6365 7074 6564 2066 616c 7365 2069 6620  cepted false if 
+000360e0: 6974 2077 6173 2072 656a 6563 7465 642e  it was rejected.
+000360f0: 0a20 2020 2020 2a20 496d 706c 656d 656e  .     * Implemen
+00036100: 7473 2066 726f 6d20 5246 4320 3832 313a  ts from RFC 821:
+00036110: 2052 4350 5420 3c53 503e 2054 4f3a 3c66   RCPT <SP> TO:<f
+00036120: 6f72 7761 7264 2d70 6174 683e 203c 4352  orward-path> <CR
+00036130: 4c46 3e2e 0a20 2020 2020 2a0a 2020 2020  LF>..     *.    
+00036140: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00036150: 2024 6164 6472 6573 7320 5468 6520 6164   $address The ad
+00036160: 6472 6573 7320 7468 6520 6d65 7373 6167  dress the messag
+00036170: 6520 6973 2062 6569 6e67 2073 656e 7420  e is being sent 
+00036180: 746f 0a20 2020 2020 2a20 4070 6172 616d  to.     * @param
+00036190: 2073 7472 696e 6720 2464 736e 2020 2020   string $dsn    
+000361a0: 2043 6f6d 6d61 2073 6570 6172 6174 6564   Comma separated
+000361b0: 206c 6973 7420 6f66 2044 534e 206e 6f74   list of DSN not
+000361c0: 6966 6963 6174 696f 6e73 2e20 4e45 5645  ifications. NEVE
+000361d0: 522c 2053 5543 4345 5353 2c20 4641 494c  R, SUCCESS, FAIL
+000361e0: 5552 450a 2020 2020 202a 2020 2020 2020  URE.     *      
+000361f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036200: 2020 6f72 2044 454c 4159 2e20 4966 2079    or DELAY. If y
+00036210: 6f75 2073 7065 6369 6679 204e 4556 4552  ou specify NEVER
+00036220: 2061 6c6c 206f 7468 6572 206e 6f74 6966   all other notif
+00036230: 6963 6174 696f 6e73 2061 7265 2069 676e  ications are ign
+00036240: 6f72 6564 2e0a 2020 2020 202a 0a20 2020  ored..     *.   
+00036250: 2020 2a20 4072 6574 7572 6e20 626f 6f6c    * @return bool
+00036260: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00036270: 6c69 6320 6675 6e63 7469 6f6e 2072 6563  lic function rec
+00036280: 6970 6965 6e74 2824 6164 6472 6573 732c  ipient($address,
+00036290: 2024 6473 6e20 3d20 2727 290a 2020 2020   $dsn = '').    
+000362a0: 7b0a 2020 2020 2020 2020 6966 2028 656d  {.        if (em
+000362b0: 7074 7928 2464 736e 2929 207b 0a20 2020  pty($dsn)) {.   
+000362c0: 2020 2020 2020 2020 2024 7263 7074 203d           $rcpt =
+000362d0: 2027 5243 5054 2054 4f3a 3c27 202e 2024   'RCPT TO:<' . $
+000362e0: 6164 6472 6573 7320 2e20 273e 273b 0a20  address . '>';. 
+000362f0: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
+00036300: 2020 2020 2020 2020 2020 2020 2464 736e              $dsn
+00036310: 203d 2073 7472 746f 7570 7065 7228 2464   = strtoupper($d
+00036320: 736e 293b 0a20 2020 2020 2020 2020 2020  sn);.           
+00036330: 2024 6e6f 7469 6679 203d 205b 5d3b 0a0a   $notify = [];..
+00036340: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00036350: 7374 7270 6f73 2824 6473 6e2c 2027 4e45  strpos($dsn, 'NE
+00036360: 5645 5227 2920 213d 3d20 6661 6c73 6529  VER') !== false)
+00036370: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00036380: 2020 2024 6e6f 7469 6679 5b5d 203d 2027     $notify[] = '
+00036390: 4e45 5645 5227 3b0a 2020 2020 2020 2020  NEVER';.        
+000363a0: 2020 2020 7d20 656c 7365 207b 0a20 2020      } else {.   
+000363b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000363c0: 6561 6368 2028 5b27 5355 4343 4553 5327  each (['SUCCESS'
+000363d0: 2c20 2746 4149 4c55 5245 272c 2027 4445  , 'FAILURE', 'DE
+000363e0: 4c41 5927 5d20 6173 2024 7661 6c75 6529  LAY'] as $value)
+000363f0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00036400: 2020 2020 2020 2069 6620 2873 7472 706f         if (strpo
+00036410: 7328 2464 736e 2c20 2476 616c 7565 2920  s($dsn, $value) 
+00036420: 213d 3d20 6661 6c73 6529 207b 0a20 2020  !== false) {.   
+00036430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036440: 2020 2020 2024 6e6f 7469 6679 5b5d 203d       $notify[] =
+00036450: 2024 7661 6c75 653b 0a20 2020 2020 2020   $value;.       
+00036460: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+00036470: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00036480: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
+00036490: 2020 2020 2020 2020 2020 2020 2472 6370              $rcp
+000364a0: 7420 3d20 2752 4350 5420 544f 3a3c 2720  t = 'RCPT TO:<' 
+000364b0: 2e20 2461 6464 7265 7373 202e 2027 3e20  . $address . '> 
+000364c0: 4e4f 5449 4659 3d27 202e 2069 6d70 6c6f  NOTIFY=' . implo
+000364d0: 6465 2827 2c27 2c20 246e 6f74 6966 7929  de(',', $notify)
+000364e0: 3b0a 2020 2020 2020 2020 7d0a 0a20 2020  ;.        }..   
+000364f0: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
+00036500: 732d 3e73 656e 6443 6f6d 6d61 6e64 280a  s->sendCommand(.
+00036510: 2020 2020 2020 2020 2020 2020 2752 4350              'RCP
+00036520: 5420 544f 272c 0a20 2020 2020 2020 2020  T TO',.         
+00036530: 2020 2024 7263 7074 2c0a 2020 2020 2020     $rcpt,.      
+00036540: 2020 2020 2020 5b32 3530 2c20 3235 315d        [250, 251]
+00036550: 0a20 2020 2020 2020 2029 3b0a 2020 2020  .        );.    
+00036560: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00036570: 2a20 5365 6e64 2053 4d54 5020 5843 4c49  * Send SMTP XCLI
+00036580: 454e 5420 636f 6d6d 616e 6420 746f 2073  ENT command to s
+00036590: 6572 7665 7220 616e 6420 6368 6563 6b20  erver and check 
+000365a0: 6974 7320 7265 7475 726e 2063 6f64 652e  its return code.
+000365b0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+000365c0: 7265 7475 726e 2062 6f6f 6c20 5472 7565  return bool True
+000365d0: 206f 6e20 7375 6363 6573 730a 2020 2020   on success.    
+000365e0: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
+000365f0: 756e 6374 696f 6e20 7863 6c69 656e 7428  unction xclient(
+00036600: 6172 7261 7920 2476 6172 7329 0a20 2020  array $vars).   
+00036610: 207b 0a20 2020 2020 2020 2024 7863 6c69   {.        $xcli
+00036620: 656e 745f 6f70 7469 6f6e 7320 3d20 2222  ent_options = ""
+00036630: 3b0a 2020 2020 2020 2020 666f 7265 6163  ;.        foreac
+00036640: 6820 2824 7661 7273 2061 7320 246b 6579  h ($vars as $key
+00036650: 203d 3e20 2476 616c 7565 2920 7b0a 2020   => $value) {.  
+00036660: 2020 2020 2020 2020 2020 6966 2028 696e            if (in
+00036670: 5f61 7272 6179 2824 6b65 792c 2053 4d54  _array($key, SMT
+00036680: 503a 3a24 7863 6c69 656e 745f 616c 6c6f  P::$xclient_allo
+00036690: 7765 645f 6174 7472 6962 7574 6573 2929  wed_attributes))
+000366a0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+000366b0: 2020 2024 7863 6c69 656e 745f 6f70 7469     $xclient_opti
+000366c0: 6f6e 7320 2e3d 2022 207b 246b 6579 7d3d  ons .= " {$key}=
+000366d0: 7b24 7661 6c75 657d 223b 0a20 2020 2020  {$value}";.     
+000366e0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000366f0: 207d 0a20 2020 2020 2020 2069 6620 2821   }.        if (!
+00036700: 2478 636c 6965 6e74 5f6f 7074 696f 6e73  $xclient_options
+00036710: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00036720: 7265 7475 726e 2074 7275 653b 0a20 2020  return true;.   
+00036730: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
+00036740: 6574 7572 6e20 2474 6869 732d 3e73 656e  eturn $this->sen
+00036750: 6443 6f6d 6d61 6e64 2827 5843 4c49 454e  dCommand('XCLIEN
+00036760: 5427 2c20 2758 434c 4945 4e54 2720 2e20  T', 'XCLIENT' . 
+00036770: 2478 636c 6965 6e74 5f6f 7074 696f 6e73  $xclient_options
+00036780: 2c20 3235 3029 3b0a 2020 2020 7d0a 0a20  , 250);.    }.. 
+00036790: 2020 202f 2a2a 0a20 2020 2020 2a20 5365     /**.     * Se
+000367a0: 6e64 2061 6e20 534d 5450 2052 5345 5420  nd an SMTP RSET 
+000367b0: 636f 6d6d 616e 642e 0a20 2020 2020 2a20  command..     * 
+000367c0: 4162 6f72 7420 616e 7920 7472 616e 7361  Abort any transa
+000367d0: 6374 696f 6e20 7468 6174 2069 7320 6375  ction that is cu
+000367e0: 7272 656e 746c 7920 696e 2070 726f 6772  rrently in progr
+000367f0: 6573 732e 0a20 2020 2020 2a20 496d 706c  ess..     * Impl
+00036800: 656d 656e 7473 2052 4643 2038 3231 3a20  ements RFC 821: 
+00036810: 5253 4554 203c 4352 4c46 3e2e 0a20 2020  RSET <CRLF>..   
+00036820: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+00036830: 726e 2062 6f6f 6c20 5472 7565 206f 6e20  rn bool True on 
+00036840: 7375 6363 6573 730a 2020 2020 202a 2f0a  success.     */.
+00036850: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+00036860: 696f 6e20 7265 7365 7428 290a 2020 2020  ion reset().    
+00036870: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
+00036880: 2024 7468 6973 2d3e 7365 6e64 436f 6d6d   $this->sendComm
+00036890: 616e 6428 2752 5345 5427 2c20 2752 5345  and('RSET', 'RSE
+000368a0: 5427 2c20 3235 3029 3b0a 2020 2020 7d0a  T', 250);.    }.
+000368b0: 0a20 2020 202f 2a2a 0a20 2020 2020 2a20  .    /**.     * 
+000368c0: 5365 6e64 2061 2063 6f6d 6d61 6e64 2074  Send a command t
+000368d0: 6f20 616e 2053 4d54 5020 7365 7276 6572  o an SMTP server
+000368e0: 2061 6e64 2063 6865 636b 2069 7473 2072   and check its r
+000368f0: 6574 7572 6e20 636f 6465 2e0a 2020 2020  eturn code..    
+00036900: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+00036910: 2073 7472 696e 6720 2020 2024 636f 6d6d   string    $comm
+00036920: 616e 6420 2020 2020 2020 5468 6520 636f  and       The co
+00036930: 6d6d 616e 6420 6e61 6d65 202d 206e 6f74  mmand name - not
+00036940: 2073 656e 7420 746f 2074 6865 2073 6572   sent to the ser
+00036950: 7665 720a 2020 2020 202a 2040 7061 7261  ver.     * @para
+00036960: 6d20 7374 7269 6e67 2020 2020 2463 6f6d  m string    $com
+00036970: 6d61 6e64 7374 7269 6e67 2054 6865 2061  mandstring The a
+00036980: 6374 7561 6c20 636f 6d6d 616e 6420 746f  ctual command to
+00036990: 2073 656e 640a 2020 2020 202a 2040 7061   send.     * @pa
+000369a0: 7261 6d20 696e 747c 6172 7261 7920 2465  ram int|array $e
+000369b0: 7870 6563 7420 2020 2020 2020 204f 6e65  xpect        One
+000369c0: 206f 7220 6d6f 7265 2065 7870 6563 7465   or more expecte
+000369d0: 6420 696e 7465 6765 7220 7375 6363 6573  d integer succes
+000369e0: 7320 636f 6465 730a 2020 2020 202a 0a20  s codes.     *. 
+000369f0: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
+00036a00: 6f6c 2054 7275 6520 6f6e 2073 7563 6365  ol True on succe
+00036a10: 7373 0a20 2020 2020 2a2f 0a20 2020 2070  ss.     */.    p
+00036a20: 726f 7465 6374 6564 2066 756e 6374 696f  rotected functio
+00036a30: 6e20 7365 6e64 436f 6d6d 616e 6428 2463  n sendCommand($c
+00036a40: 6f6d 6d61 6e64 2c20 2463 6f6d 6d61 6e64  ommand, $command
+00036a50: 7374 7269 6e67 2c20 2465 7870 6563 7429  string, $expect)
+00036a60: 0a20 2020 207b 0a20 2020 2020 2020 2069  .    {.        i
+00036a70: 6620 2821 2474 6869 732d 3e63 6f6e 6e65  f (!$this->conne
+00036a80: 6374 6564 2829 2920 7b0a 2020 2020 2020  cted()) {.      
+00036a90: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
+00036aa0: 4572 726f 7228 2243 616c 6c65 6420 2463  Error("Called $c
+00036ab0: 6f6d 6d61 6e64 2077 6974 686f 7574 2062  ommand without b
+00036ac0: 6569 6e67 2063 6f6e 6e65 6374 6564 2229  eing connected")
+00036ad0: 3b0a 0a20 2020 2020 2020 2020 2020 2072  ;..            r
+00036ae0: 6574 7572 6e20 6661 6c73 653b 0a20 2020  eturn false;.   
+00036af0: 2020 2020 207d 0a20 2020 2020 2020 202f       }.        /
+00036b00: 2f52 656a 6563 7420 6c69 6e65 2062 7265  /Reject line bre
+00036b10: 616b 7320 696e 2061 6c6c 2063 6f6d 6d61  aks in all comma
+00036b20: 6e64 730a 2020 2020 2020 2020 6966 2028  nds.        if (
+00036b30: 2873 7472 706f 7328 2463 6f6d 6d61 6e64  (strpos($command
+00036b40: 7374 7269 6e67 2c20 225c 6e22 2920 213d  string, "\n") !=
+00036b50: 3d20 6661 6c73 6529 207c 7c20 2873 7472  = false) || (str
+00036b60: 706f 7328 2463 6f6d 6d61 6e64 7374 7269  pos($commandstri
+00036b70: 6e67 2c20 225c 7222 2920 213d 3d20 6661  ng, "\r") !== fa
+00036b80: 6c73 6529 2920 7b0a 2020 2020 2020 2020  lse)) {.        
+00036b90: 2020 2020 2474 6869 732d 3e73 6574 4572      $this->setEr
+00036ba0: 726f 7228 2243 6f6d 6d61 6e64 2027 2463  ror("Command '$c
+00036bb0: 6f6d 6d61 6e64 2720 636f 6e74 6169 6e65  ommand' containe
+00036bc0: 6420 6c69 6e65 2062 7265 616b 7322 293b  d line breaks");
+00036bd0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00036be0: 7475 726e 2066 616c 7365 3b0a 2020 2020  turn false;.    
+00036bf0: 2020 2020 7d0a 2020 2020 2020 2020 2474      }.        $t
+00036c00: 6869 732d 3e63 6c69 656e 745f 7365 6e64  his->client_send
+00036c10: 2824 636f 6d6d 616e 6473 7472 696e 6720  ($commandstring 
+00036c20: 2e20 7374 6174 6963 3a3a 4c45 2c20 2463  . static::LE, $c
+00036c30: 6f6d 6d61 6e64 293b 0a0a 2020 2020 2020  ommand);..      
+00036c40: 2020 2474 6869 732d 3e6c 6173 745f 7265    $this->last_re
+00036c50: 706c 7920 3d20 2474 6869 732d 3e67 6574  ply = $this->get
+00036c60: 5f6c 696e 6573 2829 3b0a 2020 2020 2020  _lines();.      
+00036c70: 2020 2f2f 4665 7463 6820 534d 5450 2063    //Fetch SMTP c
+00036c80: 6f64 6520 616e 6420 706f 7373 6962 6c65  ode and possible
+00036c90: 2065 7272 6f72 2063 6f64 6520 6578 706c   error code expl
+00036ca0: 616e 6174 696f 6e0a 2020 2020 2020 2020  anation.        
+00036cb0: 246d 6174 6368 6573 203d 205b 5d3b 0a20  $matches = [];. 
+00036cc0: 2020 2020 2020 2069 6620 2870 7265 675f         if (preg_
+00036cd0: 6d61 7463 6828 272f 5e28 5b5c 645d 7b33  match('/^([\d]{3
+00036ce0: 7d29 5b20 2d5d 283f 3a28 5b5c 645d 5c5c  })[ -](?:([\d]\\
+00036cf0: 2e5b 5c64 5d5c 5c2e 5b5c 645d 7b31 2c32  .[\d]\\.[\d]{1,2
+00036d00: 7d29 2029 3f2f 272c 2024 7468 6973 2d3e  }) )?/', $this->
+00036d10: 6c61 7374 5f72 6570 6c79 2c20 246d 6174  last_reply, $mat
+00036d20: 6368 6573 2929 207b 0a20 2020 2020 2020  ches)) {.       
+00036d30: 2020 2020 2024 636f 6465 203d 2028 696e       $code = (in
+00036d40: 7429 2024 6d61 7463 6865 735b 315d 3b0a  t) $matches[1];.
+00036d50: 2020 2020 2020 2020 2020 2020 2463 6f64              $cod
+00036d60: 655f 6578 203d 2028 636f 756e 7428 246d  e_ex = (count($m
+00036d70: 6174 6368 6573 2920 3e20 3220 3f20 246d  atches) > 2 ? $m
+00036d80: 6174 6368 6573 5b32 5d20 3a20 6e75 6c6c  atches[2] : null
+00036d90: 293b 0a20 2020 2020 2020 2020 2020 202f  );.            /
+00036da0: 2f43 7574 206f 6666 2065 7272 6f72 2063  /Cut off error c
+00036db0: 6f64 6520 6672 6f6d 2065 6163 6820 7265  ode from each re
+00036dc0: 7370 6f6e 7365 206c 696e 650a 2020 2020  sponse line.    
+00036dd0: 2020 2020 2020 2020 2464 6574 6169 6c20          $detail 
+00036de0: 3d20 7072 6567 5f72 6570 6c61 6365 280a  = preg_replace(.
+00036df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036e00: 222f 7b24 636f 6465 7d5b 202d 5d22 202e  "/{$code}[ -]" .
+00036e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036e20: 2028 2463 6f64 655f 6578 203f 2073 7472   ($code_ex ? str
+00036e30: 5f72 6570 6c61 6365 2827 2e27 2c20 275c  _replace('.', '\
+00036e40: 5c2e 272c 2024 636f 6465 5f65 7829 202e  \.', $code_ex) .
+00036e50: 2027 2027 203a 2027 2729 202e 2027 2f6d   ' ' : '') . '/m
+00036e60: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00036e70: 2020 2027 272c 0a20 2020 2020 2020 2020     '',.         
+00036e80: 2020 2020 2020 2024 7468 6973 2d3e 6c61         $this->la
+00036e90: 7374 5f72 6570 6c79 0a20 2020 2020 2020  st_reply.       
+00036ea0: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
+00036eb0: 7d20 656c 7365 207b 0a20 2020 2020 2020  } else {.       
+00036ec0: 2020 2020 202f 2f46 616c 6c20 6261 636b       //Fall back
+00036ed0: 2074 6f20 7369 6d70 6c65 2070 6172 7369   to simple parsi
+00036ee0: 6e67 2069 6620 7265 6765 7820 6661 696c  ng if regex fail
+00036ef0: 730a 2020 2020 2020 2020 2020 2020 2463  s.            $c
+00036f00: 6f64 6520 3d20 2869 6e74 2920 7375 6273  ode = (int) subs
+00036f10: 7472 2824 7468 6973 2d3e 6c61 7374 5f72  tr($this->last_r
+00036f20: 6570 6c79 2c20 302c 2033 293b 0a20 2020  eply, 0, 3);.   
+00036f30: 2020 2020 2020 2020 2024 636f 6465 5f65           $code_e
+00036f40: 7820 3d20 6e75 6c6c 3b0a 2020 2020 2020  x = null;.      
+00036f50: 2020 2020 2020 2464 6574 6169 6c20 3d20        $detail = 
+00036f60: 7375 6273 7472 2824 7468 6973 2d3e 6c61  substr($this->la
+00036f70: 7374 5f72 6570 6c79 2c20 3429 3b0a 2020  st_reply, 4);.  
+00036f80: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00036f90: 2024 7468 6973 2d3e 6564 6562 7567 2827   $this->edebug('
+00036fa0: 5345 5256 4552 202d 3e20 434c 4945 4e54  SERVER -> CLIENT
+00036fb0: 3a20 2720 2e20 2474 6869 732d 3e6c 6173  : ' . $this->las
+00036fc0: 745f 7265 706c 792c 2073 656c 663a 3a44  t_reply, self::D
+00036fd0: 4542 5547 5f53 4552 5645 5229 3b0a 0a20  EBUG_SERVER);.. 
+00036fe0: 2020 2020 2020 2069 6620 2821 696e 5f61         if (!in_a
+00036ff0: 7272 6179 2824 636f 6465 2c20 2861 7272  rray($code, (arr
+00037000: 6179 2920 2465 7870 6563 742c 2074 7275  ay) $expect, tru
+00037010: 6529 2920 7b0a 2020 2020 2020 2020 2020  e)) {.          
+00037020: 2020 2474 6869 732d 3e73 6574 4572 726f    $this->setErro
+00037030: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00037040: 2020 2022 2463 6f6d 6d61 6e64 2063 6f6d     "$command com
+00037050: 6d61 6e64 2066 6169 6c65 6422 2c0a 2020  mand failed",.  
+00037060: 2020 2020 2020 2020 2020 2020 2020 2464                $d
+00037070: 6574 6169 6c2c 0a20 2020 2020 2020 2020  etail,.         
+00037080: 2020 2020 2020 2024 636f 6465 2c0a 2020         $code,.  
+00037090: 2020 2020 2020 2020 2020 2020 2020 2463                $c
+000370a0: 6f64 655f 6578 0a20 2020 2020 2020 2020  ode_ex.         
+000370b0: 2020 2029 3b0a 2020 2020 2020 2020 2020     );.          
+000370c0: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
+000370d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000370e0: 2027 534d 5450 2045 5252 4f52 3a20 2720   'SMTP ERROR: ' 
+000370f0: 2e20 2474 6869 732d 3e65 7272 6f72 5b27  . $this->error['
+00037100: 6572 726f 7227 5d20 2e20 273a 2027 202e  error'] . ': ' .
+00037110: 2024 7468 6973 2d3e 6c61 7374 5f72 6570   $this->last_rep
+00037120: 6c79 2c0a 2020 2020 2020 2020 2020 2020  ly,.            
+00037130: 2020 2020 7365 6c66 3a3a 4445 4255 475f      self::DEBUG_
+00037140: 434c 4945 4e54 0a20 2020 2020 2020 2020  CLIENT.         
+00037150: 2020 2029 3b0a 0a20 2020 2020 2020 2020     );..         
+00037160: 2020 2072 6574 7572 6e20 6661 6c73 653b     return false;
+00037170: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00037180: 2020 2020 2f2f 446f 6e27 7420 636c 6561      //Don't clea
+00037190: 7220 7468 6520 6572 726f 7220 7374 6f72  r the error stor
+000371a0: 6520 7768 656e 2075 7369 6e67 206b 6565  e when using kee
+000371b0: 7061 6c69 7665 0a20 2020 2020 2020 2069  palive.        i
+000371c0: 6620 2824 636f 6d6d 616e 6420 213d 3d20  f ($command !== 
+000371d0: 2752 5345 5427 2920 7b0a 2020 2020 2020  'RSET') {.      
+000371e0: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
+000371f0: 4572 726f 7228 2727 293b 0a20 2020 2020  Error('');.     
+00037200: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+00037210: 7475 726e 2074 7275 653b 0a20 2020 207d  turn true;.    }
+00037220: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00037230: 2053 656e 6420 616e 2053 4d54 5020 5341   Send an SMTP SA
+00037240: 4d4c 2063 6f6d 6d61 6e64 2e0a 2020 2020  ML command..    
+00037250: 202a 2053 7461 7274 7320 6120 6d61 696c   * Starts a mail
+00037260: 2074 7261 6e73 6163 7469 6f6e 2066 726f   transaction fro
+00037270: 6d20 7468 6520 656d 6169 6c20 6164 6472  m the email addr
+00037280: 6573 7320 7370 6563 6966 6965 6420 696e  ess specified in
+00037290: 2024 6672 6f6d 2e0a 2020 2020 202a 2052   $from..     * R
+000372a0: 6574 7572 6e73 2074 7275 6520 6966 2073  eturns true if s
+000372b0: 7563 6365 7373 6675 6c20 6f72 2066 616c  uccessful or fal
+000372c0: 7365 206f 7468 6572 7769 7365 2e20 4966  se otherwise. If
+000372d0: 2054 7275 650a 2020 2020 202a 2074 6865   True.     * the
+000372e0: 206d 6169 6c20 7472 616e 7361 6374 696f   mail transactio
+000372f0: 6e20 6973 2073 7461 7274 6564 2061 6e64  n is started and
+00037300: 2074 6865 6e20 6f6e 6520 6f72 206d 6f72   then one or mor
+00037310: 6520 7265 6369 7069 656e 740a 2020 2020  e recipient.    
+00037320: 202a 2063 6f6d 6d61 6e64 7320 6d61 7920   * commands may 
+00037330: 6265 2063 616c 6c65 6420 666f 6c6c 6f77  be called follow
+00037340: 6564 2062 7920 6120 6461 7461 2063 6f6d  ed by a data com
+00037350: 6d61 6e64 2e20 5468 6973 2063 6f6d 6d61  mand. This comma
+00037360: 6e64 0a20 2020 2020 2a20 7769 6c6c 2073  nd.     * will s
+00037370: 656e 6420 7468 6520 6d65 7373 6167 6520  end the message 
+00037380: 746f 2074 6865 2075 7365 7273 2074 6572  to the users ter
+00037390: 6d69 6e61 6c20 6966 2074 6865 7920 6172  minal if they ar
+000373a0: 6520 6c6f 6767 6564 0a20 2020 2020 2a20  e logged.     * 
+000373b0: 696e 2061 6e64 2073 656e 6420 7468 656d  in and send them
+000373c0: 2061 6e20 656d 6169 6c2e 0a20 2020 2020   an email..     
+000373d0: 2a20 496d 706c 656d 656e 7473 2052 4643  * Implements RFC
+000373e0: 2038 3231 3a20 5341 4d4c 203c 5350 3e20   821: SAML <SP> 
+000373f0: 4652 4f4d 3a3c 7265 7665 7273 652d 7061  FROM:<reverse-pa
+00037400: 7468 3e20 3c43 524c 463e 2e0a 2020 2020  th> <CRLF>..    
+00037410: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+00037420: 2073 7472 696e 6720 2466 726f 6d20 5468   string $from Th
+00037430: 6520 6164 6472 6573 7320 7468 6520 6d65  e address the me
+00037440: 7373 6167 6520 6973 2066 726f 6d0a 2020  ssage is from.  
+00037450: 2020 202a 0a20 2020 2020 2a20 4072 6574     *.     * @ret
+00037460: 7572 6e20 626f 6f6c 0a20 2020 2020 2a2f  urn bool.     */
+00037470: 0a20 2020 2070 7562 6c69 6320 6675 6e63  .    public func
+00037480: 7469 6f6e 2073 656e 6441 6e64 4d61 696c  tion sendAndMail
+00037490: 2824 6672 6f6d 290a 2020 2020 7b0a 2020  ($from).    {.  
+000374a0: 2020 2020 2020 7265 7475 726e 2024 7468        return $th
+000374b0: 6973 2d3e 7365 6e64 436f 6d6d 616e 6428  is->sendCommand(
+000374c0: 2753 414d 4c27 2c20 2253 414d 4c20 4652  'SAML', "SAML FR
+000374d0: 4f4d 3a24 6672 6f6d 222c 2032 3530 293b  OM:$from", 250);
+000374e0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+000374f0: 2020 2020 202a 2053 656e 6420 616e 2053       * Send an S
+00037500: 4d54 5020 5652 4659 2063 6f6d 6d61 6e64  MTP VRFY command
+00037510: 2e0a 2020 2020 202a 0a20 2020 2020 2a20  ..     *.     * 
+00037520: 4070 6172 616d 2073 7472 696e 6720 246e  @param string $n
+00037530: 616d 6520 5468 6520 6e61 6d65 2074 6f20  ame The name to 
+00037540: 7665 7269 6679 0a20 2020 2020 2a0a 2020  verify.     *.  
+00037550: 2020 202a 2040 7265 7475 726e 2062 6f6f     * @return boo
+00037560: 6c0a 2020 2020 202a 2f0a 2020 2020 7075  l.     */.    pu
+00037570: 626c 6963 2066 756e 6374 696f 6e20 7665  blic function ve
+00037580: 7269 6679 2824 6e61 6d65 290a 2020 2020  rify($name).    
+00037590: 7b0a 2020 2020 2020 2020 7265 7475 726e  {.        return
+000375a0: 2024 7468 6973 2d3e 7365 6e64 436f 6d6d   $this->sendComm
+000375b0: 616e 6428 2756 5246 5927 2c20 2256 5246  and('VRFY', "VRF
+000375c0: 5920 246e 616d 6522 2c20 5b32 3530 2c20  Y $name", [250, 
+000375d0: 3235 315d 293b 0a20 2020 207d 0a0a 2020  251]);.    }..  
+000375e0: 2020 2f2a 2a0a 2020 2020 202a 2053 656e    /**.     * Sen
+000375f0: 6420 616e 2053 4d54 5020 4e4f 4f50 2063  d an SMTP NOOP c
+00037600: 6f6d 6d61 6e64 2e0a 2020 2020 202a 2055  ommand..     * U
+00037610: 7365 6420 746f 206b 6565 7020 6b65 6570  sed to keep keep
+00037620: 2d61 6c69 7665 7320 616c 6976 652c 2064  -alives alive, d
+00037630: 6f65 736e 2774 2061 6374 7561 6c6c 7920  oesn't actually 
+00037640: 646f 2061 6e79 7468 696e 672e 0a20 2020  do anything..   
+00037650: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+00037660: 726e 2062 6f6f 6c0a 2020 2020 202a 2f0a  rn bool.     */.
+00037670: 2020 2020 7075 626c 6963 2066 756e 6374      public funct
+00037680: 696f 6e20 6e6f 6f70 2829 0a20 2020 207b  ion noop().    {
+00037690: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000376a0: 2474 6869 732d 3e73 656e 6443 6f6d 6d61  $this->sendComma
+000376b0: 6e64 2827 4e4f 4f50 272c 2027 4e4f 4f50  nd('NOOP', 'NOOP
+000376c0: 272c 2032 3530 293b 0a20 2020 207d 0a0a  ', 250);.    }..
+000376d0: 2020 2020 2f2a 2a0a 2020 2020 202a 2053      /**.     * S
+000376e0: 656e 6420 616e 2053 4d54 5020 5455 524e  end an SMTP TURN
+000376f0: 2063 6f6d 6d61 6e64 2e0a 2020 2020 202a   command..     *
+00037700: 2054 6869 7320 6973 2061 6e20 6f70 7469   This is an opti
+00037710: 6f6e 616c 2063 6f6d 6d61 6e64 2066 6f72  onal command for
+00037720: 2053 4d54 5020 7468 6174 2074 6869 7320   SMTP that this 
+00037730: 636c 6173 7320 646f 6573 206e 6f74 2073  class does not s
+00037740: 7570 706f 7274 2e0a 2020 2020 202a 2054  upport..     * T
+00037750: 6869 7320 6d65 7468 6f64 2069 7320 6865  his method is he
+00037760: 7265 2074 6f20 6d61 6b65 2074 6865 2052  re to make the R
+00037770: 4643 3832 3120 4465 6669 6e69 7469 6f6e  FC821 Definition
+00037780: 2063 6f6d 706c 6574 6520 666f 7220 7468   complete for th
+00037790: 6973 2063 6c61 7373 0a20 2020 2020 2a20  is class.     * 
+000377a0: 616e 6420 5f6d 6179 5f20 6265 2069 6d70  and _may_ be imp
+000377b0: 6c65 6d65 6e74 6564 2069 6e20 6675 7475  lemented in futu
+000377c0: 7265 2e0a 2020 2020 202a 2049 6d70 6c65  re..     * Imple
+000377d0: 6d65 6e74 7320 6672 6f6d 2052 4643 2038  ments from RFC 8
+000377e0: 3231 3a20 5455 524e 203c 4352 4c46 3e2e  21: TURN <CRLF>.
+000377f0: 0a20 2020 2020 2a0a 2020 2020 202a 2040  .     *.     * @
+00037800: 7265 7475 726e 2062 6f6f 6c0a 2020 2020  return bool.    
+00037810: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
+00037820: 756e 6374 696f 6e20 7475 726e 2829 0a20  unction turn(). 
+00037830: 2020 207b 0a20 2020 2020 2020 2024 7468     {.        $th
+00037840: 6973 2d3e 7365 7445 7272 6f72 2827 5468  is->setError('Th
+00037850: 6520 534d 5450 2054 5552 4e20 636f 6d6d  e SMTP TURN comm
+00037860: 616e 6420 6973 206e 6f74 2069 6d70 6c65  and is not imple
+00037870: 6d65 6e74 6564 2729 3b0a 2020 2020 2020  mented');.      
+00037880: 2020 2474 6869 732d 3e65 6465 6275 6728    $this->edebug(
+00037890: 2753 4d54 5020 4e4f 5449 4345 3a20 2720  'SMTP NOTICE: ' 
+000378a0: 2e20 2474 6869 732d 3e65 7272 6f72 5b27  . $this->error['
+000378b0: 6572 726f 7227 5d2c 2073 656c 663a 3a44  error'], self::D
+000378c0: 4542 5547 5f43 4c49 454e 5429 3b0a 0a20  EBUG_CLIENT);.. 
+000378d0: 2020 2020 2020 2072 6574 7572 6e20 6661         return fa
+000378e0: 6c73 653b 0a20 2020 207d 0a0a 2020 2020  lse;.    }..    
+000378f0: 2f2a 2a0a 2020 2020 202a 2053 656e 6420  /**.     * Send 
+00037900: 7261 7720 6461 7461 2074 6f20 7468 6520  raw data to the 
+00037910: 7365 7276 6572 2e0a 2020 2020 202a 0a20  server..     *. 
+00037920: 2020 2020 2a20 4070 6172 616d 2073 7472      * @param str
+00037930: 696e 6720 2464 6174 6120 2020 2054 6865  ing $data    The
+00037940: 2064 6174 6120 746f 2073 656e 640a 2020   data to send.  
+00037950: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00037960: 6e67 2024 636f 6d6d 616e 6420 4f70 7469  ng $command Opti
+00037970: 6f6e 616c 6c79 2c20 7468 6520 636f 6d6d  onally, the comm
+00037980: 616e 6420 7468 6973 2069 7320 7061 7274  and this is part
+00037990: 206f 662c 2075 7365 6420 6f6e 6c79 2066   of, used only f
+000379a0: 6f72 2063 6f6e 7472 6f6c 6c69 6e67 2064  or controlling d
+000379b0: 6562 7567 206f 7574 7075 740a 2020 2020  ebug output.    
+000379c0: 202a 0a20 2020 2020 2a20 4072 6574 7572   *.     * @retur
+000379d0: 6e20 696e 747c 626f 6f6c 2054 6865 206e  n int|bool The n
+000379e0: 756d 6265 7220 6f66 2062 7974 6573 2073  umber of bytes s
+000379f0: 656e 7420 746f 2074 6865 2073 6572 7665  ent to the serve
+00037a00: 7220 6f72 2066 616c 7365 206f 6e20 6572  r or false on er
+00037a10: 726f 720a 2020 2020 202a 2f0a 2020 2020  ror.     */.    
+00037a20: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+00037a30: 636c 6965 6e74 5f73 656e 6428 2464 6174  client_send($dat
+00037a40: 612c 2024 636f 6d6d 616e 6420 3d20 2727  a, $command = ''
+00037a50: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+00037a60: 2f2f 4966 2053 4d54 5020 7472 616e 7363  //If SMTP transc
+00037a70: 7269 7074 7320 6172 6520 6c65 6674 2065  ripts are left e
+00037a80: 6e61 626c 6564 2c20 6f72 2064 6562 7567  nabled, or debug
+00037a90: 206f 7574 7075 7420 6973 2070 6f73 7465   output is poste
+00037aa0: 6420 6f6e 6c69 6e65 0a20 2020 2020 2020  d online.       
+00037ab0: 202f 2f69 7420 6361 6e20 6c65 616b 2063   //it can leak c
+00037ac0: 7265 6465 6e74 6961 6c73 2c20 736f 2068  redentials, so h
+00037ad0: 6964 6520 6372 6564 656e 7469 616c 7320  ide credentials 
+00037ae0: 696e 2061 6c6c 2062 7574 206c 6f77 6573  in all but lowes
+00037af0: 7420 6c65 7665 6c0a 2020 2020 2020 2020  t level.        
+00037b00: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00037b10: 2073 656c 663a 3a44 4542 5547 5f4c 4f57   self::DEBUG_LOW
+00037b20: 4c45 5645 4c20 3e20 2474 6869 732d 3e64  LEVEL > $this->d
+00037b30: 6f5f 6465 6275 6720 2626 0a20 2020 2020  o_debug &&.     
+00037b40: 2020 2020 2020 2069 6e5f 6172 7261 7928         in_array(
+00037b50: 2463 6f6d 6d61 6e64 2c20 5b27 5573 6572  $command, ['User
+00037b60: 2026 2050 6173 7377 6f72 6427 2c20 2755   & Password', 'U
+00037b70: 7365 726e 616d 6527 2c20 2750 6173 7377  sername', 'Passw
+00037b80: 6f72 6427 5d2c 2074 7275 6529 0a20 2020  ord'], true).   
+00037b90: 2020 2020 2029 207b 0a20 2020 2020 2020       ) {.       
+00037ba0: 2020 2020 2024 7468 6973 2d3e 6564 6562       $this->edeb
+00037bb0: 7567 2827 434c 4945 4e54 202d 3e20 5345  ug('CLIENT -> SE
+00037bc0: 5256 4552 3a20 5b63 7265 6465 6e74 6961  RVER: [credentia
+00037bd0: 6c73 2068 6964 6465 6e5d 272c 2073 656c  ls hidden]', sel
+00037be0: 663a 3a44 4542 5547 5f43 4c49 454e 5429  f::DEBUG_CLIENT)
+00037bf0: 3b0a 2020 2020 2020 2020 7d20 656c 7365  ;.        } else
+00037c00: 207b 0a20 2020 2020 2020 2020 2020 2024   {.            $
+00037c10: 7468 6973 2d3e 6564 6562 7567 2827 434c  this->edebug('CL
+00037c20: 4945 4e54 202d 3e20 5345 5256 4552 3a20  IENT -> SERVER: 
+00037c30: 2720 2e20 2464 6174 612c 2073 656c 663a  ' . $data, self:
+00037c40: 3a44 4542 5547 5f43 4c49 454e 5429 3b0a  :DEBUG_CLIENT);.
+00037c50: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00037c60: 2020 7365 745f 6572 726f 725f 6861 6e64    set_error_hand
+00037c70: 6c65 7228 5b24 7468 6973 2c20 2765 7272  ler([$this, 'err
+00037c80: 6f72 4861 6e64 6c65 7227 5d29 3b0a 2020  orHandler']);.  
+00037c90: 2020 2020 2020 2472 6573 756c 7420 3d20        $result = 
+00037ca0: 6677 7269 7465 2824 7468 6973 2d3e 736d  fwrite($this->sm
+00037cb0: 7470 5f63 6f6e 6e2c 2024 6461 7461 293b  tp_conn, $data);
+00037cc0: 0a20 2020 2020 2020 2072 6573 746f 7265  .        restore
+00037cd0: 5f65 7272 6f72 5f68 616e 646c 6572 2829  _error_handler()
+00037ce0: 3b0a 0a20 2020 2020 2020 2072 6574 7572  ;..        retur
+00037cf0: 6e20 2472 6573 756c 743b 0a20 2020 207d  n $result;.    }
+00037d00: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+00037d10: 2047 6574 2074 6865 206c 6174 6573 7420   Get the latest 
+00037d20: 6572 726f 722e 0a20 2020 2020 2a0a 2020  error..     *.  
+00037d30: 2020 202a 2040 7265 7475 726e 2061 7272     * @return arr
+00037d40: 6179 0a20 2020 2020 2a2f 0a20 2020 2070  ay.     */.    p
+00037d50: 7562 6c69 6320 6675 6e63 7469 6f6e 2067  ublic function g
+00037d60: 6574 4572 726f 7228 290a 2020 2020 7b0a  etError().    {.
+00037d70: 2020 2020 2020 2020 7265 7475 726e 2024          return $
+00037d80: 7468 6973 2d3e 6572 726f 723b 0a20 2020  this->error;.   
+00037d90: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+00037da0: 202a 2047 6574 2053 4d54 5020 6578 7465   * Get SMTP exte
+00037db0: 6e73 696f 6e73 2061 7661 696c 6162 6c65  nsions available
+00037dc0: 206f 6e20 7468 6520 7365 7276 6572 2e0a   on the server..
+00037dd0: 2020 2020 202a 0a20 2020 2020 2a20 4072       *.     * @r
+00037de0: 6574 7572 6e20 6172 7261 797c 6e75 6c6c  eturn array|null
+00037df0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+00037e00: 6c69 6320 6675 6e63 7469 6f6e 2067 6574  lic function get
+00037e10: 5365 7276 6572 4578 744c 6973 7428 290a  ServerExtList().
+00037e20: 2020 2020 7b0a 2020 2020 2020 2020 7265      {.        re
+00037e30: 7475 726e 2024 7468 6973 2d3e 7365 7276  turn $this->serv
+00037e40: 6572 5f63 6170 733b 0a20 2020 207d 0a0a  er_caps;.    }..
+00037e50: 2020 2020 2f2a 2a0a 2020 2020 202a 2047      /**.     * G
+00037e60: 6574 206d 6574 6164 6174 6120 6162 6f75  et metadata abou
+00037e70: 7420 7468 6520 534d 5450 2073 6572 7665  t the SMTP serve
+00037e80: 7220 6672 6f6d 2069 7473 2048 454c 4f2f  r from its HELO/
+00037e90: 4548 4c4f 2072 6573 706f 6e73 652e 0a20  EHLO response.. 
+00037ea0: 2020 2020 2a20 5468 6520 6d65 7468 6f64      * The method
+00037eb0: 2077 6f72 6b73 2069 6e20 7468 7265 6520   works in three 
+00037ec0: 7761 7973 2c20 6465 7065 6e64 656e 7420  ways, dependent 
+00037ed0: 6f6e 2061 7267 756d 656e 7420 7661 6c75  on argument valu
+00037ee0: 6520 616e 6420 6375 7272 656e 7420 7374  e and current st
+00037ef0: 6174 653a 0a20 2020 2020 2a20 2020 312e  ate:.     *   1.
+00037f00: 2048 454c 4f2f 4548 4c4f 2068 6173 206e   HELO/EHLO has n
+00037f10: 6f74 2062 6565 6e20 7365 6e74 202d 2072  ot been sent - r
+00037f20: 6574 7572 6e73 206e 756c 6c20 616e 6420  eturns null and 
+00037f30: 706f 7075 6c61 7465 7320 2474 6869 732d  populates $this-
+00037f40: 3e65 7272 6f72 2e0a 2020 2020 202a 2020  >error..     *  
+00037f50: 2032 2e20 4845 4c4f 2068 6173 2062 6565   2. HELO has bee
+00037f60: 6e20 7365 6e74 202d 0a20 2020 2020 2a20  n sent -.     * 
+00037f70: 2020 2020 246e 616d 6520 3d3d 2027 4845      $name == 'HE
+00037f80: 4c4f 273a 2072 6574 7572 6e73 2073 6572  LO': returns ser
+00037f90: 7665 7220 6e61 6d65 0a20 2020 2020 2a20  ver name.     * 
+00037fa0: 2020 2020 246e 616d 6520 3d3d 2027 4548      $name == 'EH
+00037fb0: 4c4f 273a 2072 6574 7572 6e73 2062 6f6f  LO': returns boo
+00037fc0: 6c65 616e 2066 616c 7365 0a20 2020 2020  lean false.     
+00037fd0: 2a20 2020 2020 246e 616d 6520 3d3d 2061  *     $name == a
+00037fe0: 6e79 206f 7468 6572 2073 7472 696e 673a  ny other string:
+00037ff0: 2072 6574 7572 6e73 206e 756c 6c20 616e   returns null an
+00038000: 6420 706f 7075 6c61 7465 7320 2474 6869  d populates $thi
+00038010: 732d 3e65 7272 6f72 0a20 2020 2020 2a20  s->error.     * 
+00038020: 2020 332e 2045 484c 4f20 6861 7320 6265    3. EHLO has be
+00038030: 656e 2073 656e 7420 2d0a 2020 2020 202a  en sent -.     *
+00038040: 2020 2020 2024 6e61 6d65 203d 3d20 2748       $name == 'H
+00038050: 454c 4f27 7c27 4548 4c4f 273a 2072 6574  ELO'|'EHLO': ret
+00038060: 7572 6e73 2074 6865 2073 6572 7665 7220  urns the server 
+00038070: 6e61 6d65 0a20 2020 2020 2a20 2020 2020  name.     *     
+00038080: 246e 616d 6520 3d3d 2061 6e79 206f 7468  $name == any oth
+00038090: 6572 2073 7472 696e 673a 2069 6620 6578  er string: if ex
+000380a0: 7465 6e73 696f 6e20 246e 616d 6520 6578  tension $name ex
+000380b0: 6973 7473 2c20 7265 7475 726e 7320 5472  ists, returns Tr
+000380c0: 7565 0a20 2020 2020 2a20 2020 2020 2020  ue.     *       
+000380d0: 6f72 2069 7473 206f 7074 696f 6e73 2028  or its options (
+000380e0: 652e 672e 2041 5554 4820 6d65 6368 616e  e.g. AUTH mechan
+000380f0: 6973 6d73 2073 7570 706f 7274 6564 292e  isms supported).
+00038100: 204f 7468 6572 7769 7365 2072 6574 7572   Otherwise retur
+00038110: 6e73 2046 616c 7365 2e0a 2020 2020 202a  ns False..     *
+00038120: 0a20 2020 2020 2a20 4070 6172 616d 2073  .     * @param s
+00038130: 7472 696e 6720 246e 616d 6520 4e61 6d65  tring $name Name
+00038140: 206f 6620 534d 5450 2065 7874 656e 7369   of SMTP extensi
+00038150: 6f6e 206f 7220 2748 454c 4f27 7c27 4548  on or 'HELO'|'EH
+00038160: 4c4f 270a 2020 2020 202a 0a20 2020 2020  LO'.     *.     
+00038170: 2a20 4072 6574 7572 6e20 7374 7269 6e67  * @return string
+00038180: 7c62 6f6f 6c7c 6e75 6c6c 0a20 2020 2020  |bool|null.     
+00038190: 2a2f 0a20 2020 2070 7562 6c69 6320 6675  */.    public fu
+000381a0: 6e63 7469 6f6e 2067 6574 5365 7276 6572  nction getServer
+000381b0: 4578 7428 246e 616d 6529 0a20 2020 207b  Ext($name).    {
+000381c0: 0a20 2020 2020 2020 2069 6620 2821 2474  .        if (!$t
+000381d0: 6869 732d 3e73 6572 7665 725f 6361 7073  his->server_caps
+000381e0: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+000381f0: 2474 6869 732d 3e73 6574 4572 726f 7228  $this->setError(
+00038200: 274e 6f20 4845 4c4f 2f45 484c 4f20 7761  'No HELO/EHLO wa
+00038210: 7320 7365 6e74 2729 3b0a 0a20 2020 2020  s sent');..     
+00038220: 2020 2020 2020 2072 6574 7572 6e20 6e75         return nu
+00038230: 6c6c 3b0a 2020 2020 2020 2020 7d0a 0a20  ll;.        }.. 
+00038240: 2020 2020 2020 2069 6620 2821 6172 7261         if (!arra
+00038250: 795f 6b65 795f 6578 6973 7473 2824 6e61  y_key_exists($na
+00038260: 6d65 2c20 2474 6869 732d 3e73 6572 7665  me, $this->serve
+00038270: 725f 6361 7073 2929 207b 0a20 2020 2020  r_caps)) {.     
+00038280: 2020 2020 2020 2069 6620 2827 4845 4c4f         if ('HELO
+00038290: 2720 3d3d 3d20 246e 616d 6529 207b 0a20  ' === $name) {. 
+000382a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000382b0: 6574 7572 6e20 2474 6869 732d 3e73 6572  eturn $this->ser
+000382c0: 7665 725f 6361 7073 5b27 4548 4c4f 275d  ver_caps['EHLO']
+000382d0: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
+000382e0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000382f0: 2745 484c 4f27 203d 3d3d 2024 6e61 6d65  'EHLO' === $name
+00038300: 207c 7c20 6172 7261 795f 6b65 795f 6578   || array_key_ex
+00038310: 6973 7473 2827 4548 4c4f 272c 2024 7468  ists('EHLO', $th
+00038320: 6973 2d3e 7365 7276 6572 5f63 6170 7329  is->server_caps)
+00038330: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00038340: 2020 2020 7265 7475 726e 2066 616c 7365      return false
+00038350: 3b0a 2020 2020 2020 2020 2020 2020 7d0a  ;.            }.
+00038360: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+00038370: 732d 3e73 6574 4572 726f 7228 2748 454c  s->setError('HEL
+00038380: 4f20 6861 6e64 7368 616b 6520 7761 7320  O handshake was 
+00038390: 7573 6564 3b20 4e6f 2069 6e66 6f72 6d61  used; No informa
+000383a0: 7469 6f6e 2061 626f 7574 2073 6572 7665  tion about serve
+000383b0: 7220 6578 7465 6e73 696f 6e73 2061 7661  r extensions ava
+000383c0: 696c 6162 6c65 2729 3b0a 0a20 2020 2020  ilable');..     
+000383d0: 2020 2020 2020 2072 6574 7572 6e20 6e75         return nu
+000383e0: 6c6c 3b0a 2020 2020 2020 2020 7d0a 0a20  ll;.        }.. 
+000383f0: 2020 2020 2020 2072 6574 7572 6e20 2474         return $t
+00038400: 6869 732d 3e73 6572 7665 725f 6361 7073  his->server_caps
+00038410: 5b24 6e61 6d65 5d3b 0a20 2020 207d 0a0a  [$name];.    }..
+00038420: 2020 2020 2f2a 2a0a 2020 2020 202a 2047      /**.     * G
+00038430: 6574 2074 6865 206c 6173 7420 7265 706c  et the last repl
+00038440: 7920 6672 6f6d 2074 6865 2073 6572 7665  y from the serve
+00038450: 722e 0a20 2020 2020 2a0a 2020 2020 202a  r..     *.     *
+00038460: 2040 7265 7475 726e 2073 7472 696e 670a   @return string.
+00038470: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+00038480: 6963 2066 756e 6374 696f 6e20 6765 744c  ic function getL
+00038490: 6173 7452 6570 6c79 2829 0a20 2020 207b  astReply().    {
+000384a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000384b0: 2474 6869 732d 3e6c 6173 745f 7265 706c  $this->last_repl
+000384c0: 793b 0a20 2020 207d 0a0a 2020 2020 2f2a  y;.    }..    /*
+000384d0: 2a0a 2020 2020 202a 2052 6561 6420 7468  *.     * Read th
+000384e0: 6520 534d 5450 2073 6572 7665 7227 7320  e SMTP server's 
+000384f0: 7265 7370 6f6e 7365 2e0a 2020 2020 202a  response..     *
+00038500: 2045 6974 6865 7220 6265 666f 7265 2065   Either before e
+00038510: 6f66 206f 7220 736f 636b 6574 2074 696d  of or socket tim
+00038520: 656f 7574 206f 6363 7572 7320 6f6e 2074  eout occurs on t
+00038530: 6865 206f 7065 7261 7469 6f6e 2e0a 2020  he operation..  
+00038540: 2020 202a 2057 6974 6820 534d 5450 2077     * With SMTP w
+00038550: 6520 6361 6e20 7465 6c6c 2069 6620 7765  e can tell if we
+00038560: 2068 6176 6520 6d6f 7265 206c 696e 6573   have more lines
+00038570: 2074 6f20 7265 6164 2069 6620 7468 650a   to read if the.
+00038580: 2020 2020 202a 2034 7468 2063 6861 7261       * 4th chara
+00038590: 6374 6572 2069 7320 272d 2720 7379 6d62  cter is '-' symb
+000385a0: 6f6c 2e20 4966 2069 7420 6973 2061 2073  ol. If it is a s
+000385b0: 7061 6365 2074 6865 6e20 7765 2064 6f6e  pace then we don
+000385c0: 2774 0a20 2020 2020 2a20 6e65 6564 2074  't.     * need t
+000385d0: 6f20 7265 6164 2061 6e79 7468 696e 6720  o read anything 
+000385e0: 656c 7365 2e0a 2020 2020 202a 0a20 2020  else..     *.   
+000385f0: 2020 2a20 4072 6574 7572 6e20 7374 7269    * @return stri
+00038600: 6e67 0a20 2020 2020 2a2f 0a20 2020 2070  ng.     */.    p
+00038610: 726f 7465 6374 6564 2066 756e 6374 696f  rotected functio
+00038620: 6e20 6765 745f 6c69 6e65 7328 290a 2020  n get_lines().  
+00038630: 2020 7b0a 2020 2020 2020 2020 2f2f 4966    {.        //If
+00038640: 2074 6865 2063 6f6e 6e65 6374 696f 6e20   the connection 
+00038650: 6973 2062 6164 2c20 6769 7665 2075 7020  is bad, give up 
+00038660: 7374 7261 6967 6874 2061 7761 790a 2020  straight away.  
+00038670: 2020 2020 2020 6966 2028 2169 735f 7265        if (!is_re
+00038680: 736f 7572 6365 2824 7468 6973 2d3e 736d  source($this->sm
+00038690: 7470 5f63 6f6e 6e29 2920 7b0a 2020 2020  tp_conn)) {.    
+000386a0: 2020 2020 2020 2020 7265 7475 726e 2027          return '
+000386b0: 273b 0a20 2020 2020 2020 207d 0a20 2020  ';.        }.   
+000386c0: 2020 2020 2024 6461 7461 203d 2027 273b       $data = '';
+000386d0: 0a20 2020 2020 2020 2024 656e 6474 696d  .        $endtim
+000386e0: 6520 3d20 303b 0a20 2020 2020 2020 2073  e = 0;.        s
+000386f0: 7472 6561 6d5f 7365 745f 7469 6d65 6f75  tream_set_timeou
+00038700: 7428 2474 6869 732d 3e73 6d74 705f 636f  t($this->smtp_co
+00038710: 6e6e 2c20 2474 6869 732d 3e54 696d 656f  nn, $this->Timeo
+00038720: 7574 293b 0a20 2020 2020 2020 2069 6620  ut);.        if 
+00038730: 2824 7468 6973 2d3e 5469 6d65 6c69 6d69  ($this->Timelimi
+00038740: 7420 3e20 3029 207b 0a20 2020 2020 2020  t > 0) {.       
+00038750: 2020 2020 2024 656e 6474 696d 6520 3d20       $endtime = 
+00038760: 7469 6d65 2829 202b 2024 7468 6973 2d3e  time() + $this->
+00038770: 5469 6d65 6c69 6d69 743b 0a20 2020 2020  Timelimit;.     
+00038780: 2020 207d 0a20 2020 2020 2020 2024 7365     }.        $se
+00038790: 6c52 203d 205b 2474 6869 732d 3e73 6d74  lR = [$this->smt
+000387a0: 705f 636f 6e6e 5d3b 0a20 2020 2020 2020  p_conn];.       
+000387b0: 2024 7365 6c57 203d 206e 756c 6c3b 0a20   $selW = null;. 
+000387c0: 2020 2020 2020 2077 6869 6c65 2028 6973         while (is
+000387d0: 5f72 6573 6f75 7263 6528 2474 6869 732d  _resource($this-
+000387e0: 3e73 6d74 705f 636f 6e6e 2920 2626 2021  >smtp_conn) && !
+000387f0: 6665 6f66 2824 7468 6973 2d3e 736d 7470  feof($this->smtp
+00038800: 5f63 6f6e 6e29 2920 7b0a 2020 2020 2020  _conn)) {.      
+00038810: 2020 2020 2020 2f2f 4d75 7374 2070 6173        //Must pas
+00038820: 7320 7661 7273 2069 6e20 6865 7265 2061  s vars in here a
+00038830: 7320 7061 7261 6d73 2061 7265 2062 7920  s params are by 
+00038840: 7265 6665 7265 6e63 650a 2020 2020 2020  reference.      
+00038850: 2020 2020 2020 2f2f 736f 6c75 7469 6f6e        //solution
+00038860: 2066 6f72 2073 6967 6e61 6c73 2069 6e73   for signals ins
+00038870: 7069 7265 6420 6279 2068 7474 7073 3a2f  pired by https:/
+00038880: 2f67 6974 6875 622e 636f 6d2f 7379 6d66  /github.com/symf
+00038890: 6f6e 792f 7379 6d66 6f6e 792f 7075 6c6c  ony/symfony/pull
+000388a0: 2f36 3534 300a 2020 2020 2020 2020 2020  /6540.          
+000388b0: 2020 7365 745f 6572 726f 725f 6861 6e64    set_error_hand
+000388c0: 6c65 7228 5b24 7468 6973 2c20 2765 7272  ler([$this, 'err
+000388d0: 6f72 4861 6e64 6c65 7227 5d29 3b0a 2020  orHandler']);.  
+000388e0: 2020 2020 2020 2020 2020 246e 203d 2073            $n = s
+000388f0: 7472 6561 6d5f 7365 6c65 6374 2824 7365  tream_select($se
+00038900: 6c52 2c20 2473 656c 572c 2024 7365 6c57  lR, $selW, $selW
+00038910: 2c20 2474 6869 732d 3e54 696d 656c 696d  , $this->Timelim
+00038920: 6974 293b 0a20 2020 2020 2020 2020 2020  it);.           
+00038930: 2072 6573 746f 7265 5f65 7272 6f72 5f68   restore_error_h
+00038940: 616e 646c 6572 2829 3b0a 0a20 2020 2020  andler();..     
+00038950: 2020 2020 2020 2069 6620 2824 6e20 3d3d         if ($n ==
+00038960: 3d20 6661 6c73 6529 207b 0a20 2020 2020  = false) {.     
+00038970: 2020 2020 2020 2020 2020 2024 6d65 7373             $mess
+00038980: 6167 6520 3d20 2474 6869 732d 3e67 6574  age = $this->get
+00038990: 4572 726f 7228 295b 2764 6574 6169 6c27  Error()['detail'
+000389a0: 5d3b 0a0a 2020 2020 2020 2020 2020 2020  ];..            
+000389b0: 2020 2020 2474 6869 732d 3e65 6465 6275      $this->edebu
+000389c0: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+000389d0: 2020 2020 2020 2027 534d 5450 202d 3e20         'SMTP -> 
+000389e0: 6765 745f 6c69 6e65 7328 293a 2073 656c  get_lines(): sel
+000389f0: 6563 7420 6661 696c 6564 2028 2720 2e20  ect failed (' . 
+00038a00: 246d 6573 7361 6765 202e 2027 2927 2c0a  $message . ')',.
+00038a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038a20: 2020 2020 7365 6c66 3a3a 4445 4255 475f      self::DEBUG_
+00038a30: 4c4f 574c 4556 454c 0a20 2020 2020 2020  LOWLEVEL.       
+00038a40: 2020 2020 2020 2020 2029 3b0a 0a20 2020           );..   
+00038a50: 2020 2020 2020 2020 2020 2020 202f 2f73               //s
+00038a60: 7472 6561 6d5f 7365 6c65 6374 2072 6574  tream_select ret
+00038a70: 7572 6e73 2066 616c 7365 2077 6865 6e20  urns false when 
+00038a80: 7468 6520 6073 656c 6563 7460 2073 7973  the `select` sys
+00038a90: 7465 6d20 6361 6c6c 2069 7320 696e 7465  tem call is inte
+00038aa0: 7272 7570 7465 640a 2020 2020 2020 2020  rrupted.        
+00038ab0: 2020 2020 2020 2020 2f2f 6279 2061 6e20          //by an 
+00038ac0: 696e 636f 6d69 6e67 2073 6967 6e61 6c2c  incoming signal,
+00038ad0: 2074 7279 2074 6865 2073 656c 6563 7420   try the select 
+00038ae0: 6167 6169 6e0a 2020 2020 2020 2020 2020  again.          
+00038af0: 2020 2020 2020 6966 2028 7374 7269 706f        if (stripo
+00038b00: 7328 246d 6573 7361 6765 2c20 2769 6e74  s($message, 'int
+00038b10: 6572 7275 7074 6564 2073 7973 7465 6d20  errupted system 
+00038b20: 6361 6c6c 2729 2021 3d3d 2066 616c 7365  call') !== false
+00038b30: 2920 7b0a 2020 2020 2020 2020 2020 2020  ) {.            
+00038b40: 2020 2020 2020 2020 2474 6869 732d 3e65          $this->e
+00038b50: 6465 6275 6728 0a20 2020 2020 2020 2020  debug(.         
+00038b60: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00038b70: 534d 5450 202d 3e20 6765 745f 6c69 6e65  SMTP -> get_line
+00038b80: 7328 293a 2072 6574 7279 696e 6720 7374  s(): retrying st
+00038b90: 7265 616d 5f73 656c 6563 7427 2c0a 2020  ream_select',.  
+00038ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038bb0: 2020 2020 2020 7365 6c66 3a3a 4445 4255        self::DEBU
+00038bc0: 475f 4c4f 574c 4556 454c 0a20 2020 2020  G_LOWLEVEL.     
+00038bd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00038be0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00038bf0: 2020 2020 2020 2474 6869 732d 3e73 6574        $this->set
+00038c00: 4572 726f 7228 2727 293b 0a20 2020 2020  Error('');.     
+00038c10: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00038c20: 6f6e 7469 6e75 653b 0a20 2020 2020 2020  ontinue;.       
+00038c30: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+00038c40: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00038c50: 6b3b 0a20 2020 2020 2020 2020 2020 207d  k;.            }
+00038c60: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00038c70: 2028 2124 6e29 207b 0a20 2020 2020 2020   (!$n) {.       
+00038c80: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+00038c90: 6564 6562 7567 280a 2020 2020 2020 2020  edebug(.        
+00038ca0: 2020 2020 2020 2020 2020 2020 2753 4d54              'SMT
+00038cb0: 5020 2d3e 2067 6574 5f6c 696e 6573 2829  P -> get_lines()
+00038cc0: 3a20 7365 6c65 6374 2074 696d 6564 2d6f  : select timed-o
+00038cd0: 7574 2069 6e20 2827 202e 2024 7468 6973  ut in (' . $this
+00038ce0: 2d3e 5469 6d65 6c69 6d69 7420 2e20 2720  ->Timelimit . ' 
+00038cf0: 7365 6329 272c 0a20 2020 2020 2020 2020  sec)',.         
+00038d00: 2020 2020 2020 2020 2020 2073 656c 663a             self:
+00038d10: 3a44 4542 5547 5f4c 4f57 4c45 5645 4c0a  :DEBUG_LOWLEVEL.
+00038d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038d30: 293b 0a20 2020 2020 2020 2020 2020 2020  );.             
+00038d40: 2020 2062 7265 616b 3b0a 2020 2020 2020     break;.      
+00038d50: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00038d60: 2020 2020 202f 2f44 656c 6962 6572 6174       //Deliberat
+00038d70: 6520 6e6f 6973 6520 7375 7070 7265 7373  e noise suppress
+00038d80: 696f 6e20 2d20 6572 726f 7273 2061 7265  ion - errors are
+00038d90: 2068 616e 646c 6564 2061 6674 6572 7761   handled afterwa
+00038da0: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
+00038db0: 2473 7472 203d 2040 6667 6574 7328 2474  $str = @fgets($t
+00038dc0: 6869 732d 3e73 6d74 705f 636f 6e6e 2c20  his->smtp_conn, 
+00038dd0: 7365 6c66 3a3a 4d41 585f 5245 504c 595f  self::MAX_REPLY_
+00038de0: 4c45 4e47 5448 293b 0a20 2020 2020 2020  LENGTH);.       
+00038df0: 2020 2020 2024 7468 6973 2d3e 6564 6562       $this->edeb
+00038e00: 7567 2827 534d 5450 2049 4e42 4f55 4e44  ug('SMTP INBOUND
+00038e10: 3a20 2227 202e 2074 7269 6d28 2473 7472  : "' . trim($str
+00038e20: 2920 2e20 2722 272c 2073 656c 663a 3a44  ) . '"', self::D
+00038e30: 4542 5547 5f4c 4f57 4c45 5645 4c29 3b0a  EBUG_LOWLEVEL);.
+00038e40: 2020 2020 2020 2020 2020 2020 2464 6174              $dat
+00038e50: 6120 2e3d 2024 7374 723b 0a20 2020 2020  a .= $str;.     
+00038e60: 2020 2020 2020 202f 2f49 6620 7265 7370         //If resp
+00038e70: 6f6e 7365 2069 7320 6f6e 6c79 2033 2063  onse is only 3 c
+00038e80: 6861 7273 2028 6e6f 7420 7661 6c69 642c  hars (not valid,
+00038e90: 2062 7574 2052 4643 3533 3231 2053 342e   but RFC5321 S4.
+00038ea0: 3220 7361 7973 2069 7420 6d75 7374 2062  2 says it must b
+00038eb0: 6520 6861 6e64 6c65 6429 2c0a 2020 2020  e handled),.    
+00038ec0: 2020 2020 2020 2020 2f2f 6f72 2034 7468          //or 4th
+00038ed0: 2063 6861 7261 6374 6572 2069 7320 6120   character is a 
+00038ee0: 7370 6163 6520 6f72 2061 206c 696e 6520  space or a line 
+00038ef0: 6272 6561 6b20 6368 6172 2c20 7765 2061  break char, we a
+00038f00: 7265 2064 6f6e 6520 7265 6164 696e 672c  re done reading,
+00038f10: 2062 7265 616b 2074 6865 206c 6f6f 702e   break the loop.
+00038f20: 0a20 2020 2020 2020 2020 2020 202f 2f53  .            //S
+00038f30: 7472 696e 6720 6172 7261 7920 6163 6365  tring array acce
+00038f40: 7373 2069 7320 6120 7369 676e 6966 6963  ss is a signific
+00038f50: 616e 7420 6d69 6372 6f2d 6f70 7469 6d69  ant micro-optimi
+00038f60: 7361 7469 6f6e 206f 7665 7220 7374 726c  sation over strl
+00038f70: 656e 0a20 2020 2020 2020 2020 2020 2069  en.            i
+00038f80: 6620 2821 6973 7365 7428 2473 7472 5b33  f (!isset($str[3
+00038f90: 5d29 207c 7c20 2473 7472 5b33 5d20 3d3d  ]) || $str[3] ==
+00038fa0: 3d20 2720 2720 7c7c 2024 7374 725b 335d  = ' ' || $str[3]
+00038fb0: 203d 3d3d 2022 5c72 2220 7c7c 2024 7374   === "\r" || $st
+00038fc0: 725b 335d 203d 3d3d 2022 5c6e 2229 207b  r[3] === "\n") {
+00038fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00038fe0: 2062 7265 616b 3b0a 2020 2020 2020 2020   break;.        
+00038ff0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00039000: 2020 2f2f 5469 6d65 642d 6f75 743f 204c    //Timed-out? L
+00039010: 6f67 2061 6e64 2062 7265 616b 0a20 2020  og and break.   
+00039020: 2020 2020 2020 2020 2024 696e 666f 203d           $info =
+00039030: 2073 7472 6561 6d5f 6765 745f 6d65 7461   stream_get_meta
+00039040: 5f64 6174 6128 2474 6869 732d 3e73 6d74  _data($this->smt
+00039050: 705f 636f 6e6e 293b 0a20 2020 2020 2020  p_conn);.       
+00039060: 2020 2020 2069 6620 2824 696e 666f 5b27       if ($info['
+00039070: 7469 6d65 645f 6f75 7427 5d29 207b 0a20  timed_out']) {. 
+00039080: 2020 2020 2020 2020 2020 2020 2020 2024                 $
+00039090: 7468 6973 2d3e 6564 6562 7567 280a 2020  this->edebug(.  
+000390a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000390b0: 2020 2753 4d54 5020 2d3e 2067 6574 5f6c    'SMTP -> get_l
+000390c0: 696e 6573 2829 3a20 7374 7265 616d 2074  ines(): stream t
+000390d0: 696d 6564 2d6f 7574 2028 2720 2e20 2474  imed-out (' . $t
+000390e0: 6869 732d 3e54 696d 656f 7574 202e 2027  his->Timeout . '
+000390f0: 2073 6563 2927 2c0a 2020 2020 2020 2020   sec)',.        
+00039100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00039110: 3a3a 4445 4255 475f 4c4f 574c 4556 454c  ::DEBUG_LOWLEVEL
+00039120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039130: 2029 3b0a 2020 2020 2020 2020 2020 2020   );.            
+00039140: 2020 2020 6272 6561 6b3b 0a20 2020 2020      break;.     
+00039150: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00039160: 2020 2020 202f 2f4e 6f77 2063 6865 636b       //Now check
+00039170: 2069 6620 7265 6164 7320 746f 6f6b 2074   if reads took t
+00039180: 6f6f 206c 6f6e 670a 2020 2020 2020 2020  oo long.        
+00039190: 2020 2020 6966 2028 2465 6e64 7469 6d65      if ($endtime
+000391a0: 2026 2620 7469 6d65 2829 203e 2024 656e   && time() > $en
+000391b0: 6474 696d 6529 207b 0a20 2020 2020 2020  dtime) {.       
+000391c0: 2020 2020 2020 2020 2024 7468 6973 2d3e           $this->
+000391d0: 6564 6562 7567 280a 2020 2020 2020 2020  edebug(.        
+000391e0: 2020 2020 2020 2020 2020 2020 2753 4d54              'SMT
+000391f0: 5020 2d3e 2067 6574 5f6c 696e 6573 2829  P -> get_lines()
+00039200: 3a20 7469 6d65 6c69 6d69 7420 7265 6163  : timelimit reac
+00039210: 6865 6420 2827 202e 0a20 2020 2020 2020  hed (' ..       
+00039220: 2020 2020 2020 2020 2020 2020 2024 7468               $th
+00039230: 6973 2d3e 5469 6d65 6c69 6d69 7420 2e20  is->Timelimit . 
+00039240: 2720 7365 6329 272c 0a20 2020 2020 2020  ' sec)',.       
+00039250: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00039260: 663a 3a44 4542 5547 5f4c 4f57 4c45 5645  f::DEBUG_LOWLEVE
+00039270: 4c0a 2020 2020 2020 2020 2020 2020 2020  L.              
+00039280: 2020 293b 0a20 2020 2020 2020 2020 2020    );.           
+00039290: 2020 2020 2062 7265 616b 3b0a 2020 2020       break;.    
+000392a0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000392b0: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
+000392c0: 7572 6e20 2464 6174 613b 0a20 2020 207d  urn $data;.    }
+000392d0: 0a0a 2020 2020 2f2a 2a0a 2020 2020 202a  ..    /**.     *
+000392e0: 2045 6e61 626c 6520 6f72 2064 6973 6162   Enable or disab
+000392f0: 6c65 2056 4552 5020 6164 6472 6573 7320  le VERP address 
+00039300: 6765 6e65 7261 7469 6f6e 2e0a 2020 2020  generation..    
+00039310: 202a 0a20 2020 2020 2a20 4070 6172 616d   *.     * @param
+00039320: 2062 6f6f 6c20 2465 6e61 626c 6564 0a20   bool $enabled. 
+00039330: 2020 2020 2a2f 0a20 2020 2070 7562 6c69      */.    publi
+00039340: 6320 6675 6e63 7469 6f6e 2073 6574 5665  c function setVe
+00039350: 7270 2824 656e 6162 6c65 6420 3d20 6661  rp($enabled = fa
+00039360: 6c73 6529 0a20 2020 207b 0a20 2020 2020  lse).    {.     
+00039370: 2020 2024 7468 6973 2d3e 646f 5f76 6572     $this->do_ver
+00039380: 7020 3d20 2465 6e61 626c 6564 3b0a 2020  p = $enabled;.  
+00039390: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+000393a0: 2020 2a20 4765 7420 5645 5250 2061 6464    * Get VERP add
+000393b0: 7265 7373 2067 656e 6572 6174 696f 6e20  ress generation 
+000393c0: 6d6f 6465 2e0a 2020 2020 202a 0a20 2020  mode..     *.   
+000393d0: 2020 2a20 4072 6574 7572 6e20 626f 6f6c    * @return bool
+000393e0: 0a20 2020 2020 2a2f 0a20 2020 2070 7562  .     */.    pub
+000393f0: 6c69 6320 6675 6e63 7469 6f6e 2067 6574  lic function get
+00039400: 5665 7270 2829 0a20 2020 207b 0a20 2020  Verp().    {.   
+00039410: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
+00039420: 732d 3e64 6f5f 7665 7270 3b0a 2020 2020  s->do_verp;.    
+00039430: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+00039440: 2a20 5365 7420 6572 726f 7220 6d65 7373  * Set error mess
+00039450: 6167 6573 2061 6e64 2063 6f64 6573 2e0a  ages and codes..
+00039460: 2020 2020 202a 0a20 2020 2020 2a20 4070       *.     * @p
+00039470: 6172 616d 2073 7472 696e 6720 246d 6573  aram string $mes
+00039480: 7361 6765 2020 2020 2020 5468 6520 6572  sage      The er
+00039490: 726f 7220 6d65 7373 6167 650a 2020 2020  ror message.    
+000394a0: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+000394b0: 2024 6465 7461 696c 2020 2020 2020 2046   $detail       F
+000394c0: 7572 7468 6572 2064 6574 6169 6c20 6f6e  urther detail on
+000394d0: 2074 6865 2065 7272 6f72 0a20 2020 2020   the error.     
+000394e0: 2a20 4070 6172 616d 2073 7472 696e 6720  * @param string 
+000394f0: 2473 6d74 705f 636f 6465 2020 2020 416e  $smtp_code    An
+00039500: 2061 7373 6f63 6961 7465 6420 534d 5450   associated SMTP
+00039510: 2065 7272 6f72 2063 6f64 650a 2020 2020   error code.    
+00039520: 202a 2040 7061 7261 6d20 7374 7269 6e67   * @param string
+00039530: 2024 736d 7470 5f63 6f64 655f 6578 2045   $smtp_code_ex E
+00039540: 7874 656e 6465 6420 534d 5450 2063 6f64  xtended SMTP cod
+00039550: 650a 2020 2020 202a 2f0a 2020 2020 7072  e.     */.    pr
+00039560: 6f74 6563 7465 6420 6675 6e63 7469 6f6e  otected function
+00039570: 2073 6574 4572 726f 7228 246d 6573 7361   setError($messa
+00039580: 6765 2c20 2464 6574 6169 6c20 3d20 2727  ge, $detail = ''
+00039590: 2c20 2473 6d74 705f 636f 6465 203d 2027  , $smtp_code = '
+000395a0: 272c 2024 736d 7470 5f63 6f64 655f 6578  ', $smtp_code_ex
+000395b0: 203d 2027 2729 0a20 2020 207b 0a20 2020   = '').    {.   
+000395c0: 2020 2020 2024 7468 6973 2d3e 6572 726f       $this->erro
+000395d0: 7220 3d20 5b0a 2020 2020 2020 2020 2020  r = [.          
+000395e0: 2020 2765 7272 6f72 2720 3d3e 2024 6d65    'error' => $me
+000395f0: 7373 6167 652c 0a20 2020 2020 2020 2020  ssage,.         
+00039600: 2020 2027 6465 7461 696c 2720 3d3e 2024     'detail' => $
+00039610: 6465 7461 696c 2c0a 2020 2020 2020 2020  detail,.        
+00039620: 2020 2020 2773 6d74 705f 636f 6465 2720      'smtp_code' 
+00039630: 3d3e 2024 736d 7470 5f63 6f64 652c 0a20  => $smtp_code,. 
+00039640: 2020 2020 2020 2020 2020 2027 736d 7470             'smtp
+00039650: 5f63 6f64 655f 6578 2720 3d3e 2024 736d  _code_ex' => $sm
+00039660: 7470 5f63 6f64 655f 6578 2c0a 2020 2020  tp_code_ex,.    
+00039670: 2020 2020 5d3b 0a20 2020 207d 0a0a 2020      ];.    }..  
+00039680: 2020 2f2a 2a0a 2020 2020 202a 2053 6574    /**.     * Set
+00039690: 2064 6562 7567 206f 7574 7075 7420 6d65   debug output me
+000396a0: 7468 6f64 2e0a 2020 2020 202a 0a20 2020  thod..     *.   
+000396b0: 2020 2a20 4070 6172 616d 2073 7472 696e    * @param strin
+000396c0: 677c 6361 6c6c 6162 6c65 2024 6d65 7468  g|callable $meth
+000396d0: 6f64 2054 6865 206e 616d 6520 6f66 2074  od The name of t
+000396e0: 6865 206d 6563 6861 6e69 736d 2074 6f20  he mechanism to 
+000396f0: 7573 6520 666f 7220 6465 6275 6767 696e  use for debuggin
+00039700: 6720 6f75 7470 7574 2c20 6f72 2061 2063  g output, or a c
+00039710: 616c 6c61 626c 6520 746f 2068 616e 646c  allable to handl
+00039720: 6520 6974 0a20 2020 2020 2a2f 0a20 2020  e it.     */.   
+00039730: 2070 7562 6c69 6320 6675 6e63 7469 6f6e   public function
+00039740: 2073 6574 4465 6275 674f 7574 7075 7428   setDebugOutput(
+00039750: 246d 6574 686f 6420 3d20 2765 6368 6f27  $method = 'echo'
+00039760: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+00039770: 2474 6869 732d 3e44 6562 7567 6f75 7470  $this->Debugoutp
+00039780: 7574 203d 2024 6d65 7468 6f64 3b0a 2020  ut = $method;.  
+00039790: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+000397a0: 2020 2a20 4765 7420 6465 6275 6720 6f75    * Get debug ou
+000397b0: 7470 7574 206d 6574 686f 642e 0a20 2020  tput method..   
+000397c0: 2020 2a0a 2020 2020 202a 2040 7265 7475    *.     * @retu
+000397d0: 726e 2073 7472 696e 670a 2020 2020 202a  rn string.     *
+000397e0: 2f0a 2020 2020 7075 626c 6963 2066 756e  /.    public fun
+000397f0: 6374 696f 6e20 6765 7444 6562 7567 4f75  ction getDebugOu
+00039800: 7470 7574 2829 0a20 2020 207b 0a20 2020  tput().    {.   
+00039810: 2020 2020 2072 6574 7572 6e20 2474 6869       return $thi
+00039820: 732d 3e44 6562 7567 6f75 7470 7574 3b0a  s->Debugoutput;.
+00039830: 2020 2020 7d0a 0a20 2020 202f 2a2a 0a20      }..    /**. 
+00039840: 2020 2020 2a20 5365 7420 6465 6275 6720      * Set debug 
+00039850: 6f75 7470 7574 206c 6576 656c 2e0a 2020  output level..  
+00039860: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
+00039870: 616d 2069 6e74 2024 6c65 7665 6c0a 2020  am int $level.  
+00039880: 2020 202a 2f0a 2020 2020 7075 626c 6963     */.    public
+00039890: 2066 756e 6374 696f 6e20 7365 7444 6562   function setDeb
+000398a0: 7567 4c65 7665 6c28 246c 6576 656c 203d  ugLevel($level =
+000398b0: 2030 290a 2020 2020 7b0a 2020 2020 2020   0).    {.      
+000398c0: 2020 2474 6869 732d 3e64 6f5f 6465 6275    $this->do_debu
+000398d0: 6720 3d20 246c 6576 656c 3b0a 2020 2020  g = $level;.    
+000398e0: 7d0a 0a20 2020 202f 2a2a 0a20 2020 2020  }..    /**.     
+000398f0: 2a20 4765 7420 6465 6275 6720 6f75 7470  * Get debug outp
+00039900: 7574 206c 6576 656c 2e0a 2020 2020 202a  ut level..     *
+00039910: 0a20 2020 2020 2a20 4072 6574 7572 6e20  .     * @return 
+00039920: 696e 740a 2020 2020 202a 2f0a 2020 2020  int.     */.    
+00039930: 7075 626c 6963 2066 756e 6374 696f 6e20  public function 
+00039940: 6765 7444 6562 7567 4c65 7665 6c28 290a  getDebugLevel().
+00039950: 2020 2020 7b0a 2020 2020 2020 2020 7265      {.        re
+00039960: 7475 726e 2024 7468 6973 2d3e 646f 5f64  turn $this->do_d
+00039970: 6562 7567 3b0a 2020 2020 7d0a 0a20 2020  ebug;.    }..   
+00039980: 202f 2a2a 0a20 2020 2020 2a20 5365 7420   /**.     * Set 
+00039990: 534d 5450 2074 696d 656f 7574 2e0a 2020  SMTP timeout..  
+000399a0: 2020 202a 0a20 2020 2020 2a20 4070 6172     *.     * @par
+000399b0: 616d 2069 6e74 2024 7469 6d65 6f75 7420  am int $timeout 
+000399c0: 5468 6520 7469 6d65 6f75 7420 6475 7261  The timeout dura
+000399d0: 7469 6f6e 2069 6e20 7365 636f 6e64 730a  tion in seconds.
+000399e0: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+000399f0: 6963 2066 756e 6374 696f 6e20 7365 7454  ic function setT
+00039a00: 696d 656f 7574 2824 7469 6d65 6f75 7420  imeout($timeout 
+00039a10: 3d20 3029 0a20 2020 207b 0a20 2020 2020  = 0).    {.     
+00039a20: 2020 2024 7468 6973 2d3e 5469 6d65 6f75     $this->Timeou
+00039a30: 7420 3d20 2474 696d 656f 7574 3b0a 2020  t = $timeout;.  
+00039a40: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+00039a50: 2020 2a20 4765 7420 534d 5450 2074 696d    * Get SMTP tim
+00039a60: 656f 7574 2e0a 2020 2020 202a 0a20 2020  eout..     *.   
+00039a70: 2020 2a20 4072 6574 7572 6e20 696e 740a    * @return int.
+00039a80: 2020 2020 202a 2f0a 2020 2020 7075 626c       */.    publ
+00039a90: 6963 2066 756e 6374 696f 6e20 6765 7454  ic function getT
+00039aa0: 696d 656f 7574 2829 0a20 2020 207b 0a20  imeout().    {. 
+00039ab0: 2020 2020 2020 2072 6574 7572 6e20 2474         return $t
+00039ac0: 6869 732d 3e54 696d 656f 7574 3b0a 2020  his->Timeout;.  
+00039ad0: 2020 7d0a 0a20 2020 202f 2a2a 0a20 2020    }..    /**.   
+00039ae0: 2020 2a20 5265 706f 7274 7320 616e 2065    * Reports an e
+00039af0: 7272 6f72 206e 756d 6265 7220 616e 6420  rror number and 
+00039b00: 7374 7269 6e67 2e0a 2020 2020 202a 0a20  string..     *. 
+00039b10: 2020 2020 2a20 4070 6172 616d 2069 6e74      * @param int
+00039b20: 2020 2020 2465 7272 6e6f 2020 2054 6865      $errno   The
+00039b30: 2065 7272 6f72 206e 756d 6265 7220 7265   error number re
+00039b40: 7475 726e 6564 2062 7920 5048 500a 2020  turned by PHP.  
+00039b50: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00039b60: 6e67 2024 6572 726d 7367 2020 5468 6520  ng $errmsg  The 
+00039b70: 6572 726f 7220 6d65 7373 6167 6520 7265  error message re
+00039b80: 7475 726e 6564 2062 7920 5048 500a 2020  turned by PHP.  
+00039b90: 2020 202a 2040 7061 7261 6d20 7374 7269     * @param stri
+00039ba0: 6e67 2024 6572 7266 696c 6520 5468 6520  ng $errfile The 
+00039bb0: 6669 6c65 2074 6865 2065 7272 6f72 206f  file the error o
+00039bc0: 6363 7572 7265 6420 696e 0a20 2020 2020  ccurred in.     
+00039bd0: 2a20 4070 6172 616d 2069 6e74 2020 2020  * @param int    
+00039be0: 2465 7272 6c69 6e65 2054 6865 206c 696e  $errline The lin
+00039bf0: 6520 6e75 6d62 6572 2074 6865 2065 7272  e number the err
+00039c00: 6f72 206f 6363 7572 7265 6420 6f6e 0a20  or occurred on. 
+00039c10: 2020 2020 2a2f 0a20 2020 2070 726f 7465      */.    prote
+00039c20: 6374 6564 2066 756e 6374 696f 6e20 6572  cted function er
+00039c30: 726f 7248 616e 646c 6572 2824 6572 726e  rorHandler($errn
+00039c40: 6f2c 2024 6572 726d 7367 2c20 2465 7272  o, $errmsg, $err
+00039c50: 6669 6c65 203d 2027 272c 2024 6572 726c  file = '', $errl
+00039c60: 696e 6520 3d20 3029 0a20 2020 207b 0a20  ine = 0).    {. 
+00039c70: 2020 2020 2020 2024 6e6f 7469 6365 203d         $notice =
+00039c80: 2027 436f 6e6e 6563 7469 6f6e 2066 6169   'Connection fai
+00039c90: 6c65 642e 273b 0a20 2020 2020 2020 2024  led.';.        $
+00039ca0: 7468 6973 2d3e 7365 7445 7272 6f72 280a  this->setError(.
+00039cb0: 2020 2020 2020 2020 2020 2020 246e 6f74              $not
+00039cc0: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
+00039cd0: 2024 6572 726d 7367 2c0a 2020 2020 2020   $errmsg,.      
+00039ce0: 2020 2020 2020 2873 7472 696e 6729 2024        (string) $
+00039cf0: 6572 726e 6f0a 2020 2020 2020 2020 293b  errno.        );
+00039d00: 0a20 2020 2020 2020 2024 7468 6973 2d3e  .        $this->
+00039d10: 6564 6562 7567 280a 2020 2020 2020 2020  edebug(.        
+00039d20: 2020 2020 2224 6e6f 7469 6365 2045 7272      "$notice Err
+00039d30: 6f72 2023 2465 7272 6e6f 3a20 2465 7272  or #$errno: $err
+00039d40: 6d73 6720 5b24 6572 7266 696c 6520 6c69  msg [$errfile li
+00039d50: 6e65 2024 6572 726c 696e 655d 222c 0a20  ne $errline]",. 
+00039d60: 2020 2020 2020 2020 2020 2073 656c 663a             self:
+00039d70: 3a44 4542 5547 5f43 4f4e 4e45 4354 494f  :DEBUG_CONNECTIO
+00039d80: 4e0a 2020 2020 2020 2020 293b 0a20 2020  N.        );.   
+00039d90: 207d 0a0a 2020 2020 2f2a 2a0a 2020 2020   }..    /**.    
+00039da0: 202a 2045 7874 7261 6374 2061 6e64 2072   * Extract and r
+00039db0: 6574 7572 6e20 7468 6520 4944 206f 6620  eturn the ID of 
+00039dc0: 7468 6520 6c61 7374 2053 4d54 5020 7472  the last SMTP tr
+00039dd0: 616e 7361 6374 696f 6e20 6261 7365 6420  ansaction based 
+00039de0: 6f6e 0a20 2020 2020 2a20 6120 6c69 7374  on.     * a list
+00039df0: 206f 6620 7061 7474 6572 6e73 2070 726f   of patterns pro
+00039e00: 7669 6465 6420 696e 2053 4d54 503a 3a24  vided in SMTP::$
+00039e10: 736d 7470 5f74 7261 6e73 6163 7469 6f6e  smtp_transaction
+00039e20: 5f69 645f 7061 7474 6572 6e73 2e0a 2020  _id_patterns..  
+00039e30: 2020 202a 2052 656c 6965 7320 6f6e 2074     * Relies on t
+00039e40: 6865 2068 6f73 7420 7072 6f76 6964 696e  he host providin
+00039e50: 6720 7468 6520 4944 2069 6e20 7265 7370  g the ID in resp
+00039e60: 6f6e 7365 2074 6f20 6120 4441 5441 2063  onse to a DATA c
+00039e70: 6f6d 6d61 6e64 2e0a 2020 2020 202a 2049  ommand..     * I
+00039e80: 6620 6e6f 2072 6570 6c79 2068 6173 2062  f no reply has b
+00039e90: 6565 6e20 7265 6365 6976 6564 2079 6574  een received yet
+00039ea0: 2c20 6974 2077 696c 6c20 7265 7475 726e  , it will return
+00039eb0: 206e 756c 6c2e 0a20 2020 2020 2a20 4966   null..     * If
+00039ec0: 206e 6f20 7061 7474 6572 6e20 7761 7320   no pattern was 
+00039ed0: 6d61 7463 6865 642c 2069 7420 7769 6c6c  matched, it will
+00039ee0: 2072 6574 7572 6e20 6661 6c73 652e 0a20   return false.. 
+00039ef0: 2020 2020 2a0a 2020 2020 202a 2040 7265      *.     * @re
+00039f00: 7475 726e 2062 6f6f 6c7c 7374 7269 6e67  turn bool|string
+00039f10: 7c6e 756c 6c0a 2020 2020 202a 2f0a 2020  |null.     */.  
+00039f20: 2020 7072 6f74 6563 7465 6420 6675 6e63    protected func
+00039f30: 7469 6f6e 2072 6563 6f72 644c 6173 7454  tion recordLastT
+00039f40: 7261 6e73 6163 7469 6f6e 4944 2829 0a20  ransactionID(). 
+00039f50: 2020 207b 0a20 2020 2020 2020 2024 7265     {.        $re
+00039f60: 706c 7920 3d20 2474 6869 732d 3e67 6574  ply = $this->get
+00039f70: 4c61 7374 5265 706c 7928 293b 0a0a 2020  LastReply();..  
+00039f80: 2020 2020 2020 6966 2028 656d 7074 7928        if (empty(
+00039f90: 2472 6570 6c79 2929 207b 0a20 2020 2020  $reply)) {.     
+00039fa0: 2020 2020 2020 2024 7468 6973 2d3e 6c61         $this->la
+00039fb0: 7374 5f73 6d74 705f 7472 616e 7361 6374  st_smtp_transact
+00039fc0: 696f 6e5f 6964 203d 206e 756c 6c3b 0a20  ion_id = null;. 
+00039fd0: 2020 2020 2020 207d 2065 6c73 6520 7b0a         } else {.
+00039fe0: 2020 2020 2020 2020 2020 2020 2474 6869              $thi
+00039ff0: 732d 3e6c 6173 745f 736d 7470 5f74 7261  s->last_smtp_tra
+0003a000: 6e73 6163 7469 6f6e 5f69 6420 3d20 6661  nsaction_id = fa
+0003a010: 6c73 653b 0a20 2020 2020 2020 2020 2020  lse;.           
+0003a020: 2066 6f72 6561 6368 2028 2474 6869 732d   foreach ($this-
+0003a030: 3e73 6d74 705f 7472 616e 7361 6374 696f  >smtp_transactio
+0003a040: 6e5f 6964 5f70 6174 7465 726e 7320 6173  n_id_patterns as
+0003a050: 2024 736d 7470 5f74 7261 6e73 6163 7469   $smtp_transacti
+0003a060: 6f6e 5f69 645f 7061 7474 6572 6e29 207b  on_id_pattern) {
+0003a070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a080: 2024 6d61 7463 6865 7320 3d20 5b5d 3b0a   $matches = [];.
+0003a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a0a0: 6966 2028 7072 6567 5f6d 6174 6368 2824  if (preg_match($
+0003a0b0: 736d 7470 5f74 7261 6e73 6163 7469 6f6e  smtp_transaction
+0003a0c0: 5f69 645f 7061 7474 6572 6e2c 2024 7265  _id_pattern, $re
+0003a0d0: 706c 792c 2024 6d61 7463 6865 7329 2920  ply, $matches)) 
+0003a0e0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0003a0f0: 2020 2020 2020 2474 6869 732d 3e6c 6173        $this->las
+0003a100: 745f 736d 7470 5f74 7261 6e73 6163 7469  t_smtp_transacti
+0003a110: 6f6e 5f69 6420 3d20 7472 696d 2824 6d61  on_id = trim($ma
+0003a120: 7463 6865 735b 315d 293b 0a20 2020 2020  tches[1]);.     
+0003a130: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0003a140: 7265 616b 3b0a 2020 2020 2020 2020 2020  reak;.          
+0003a150: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0003a160: 2020 2020 7d0a 2020 2020 2020 2020 7d0a      }.        }.
+0003a170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003a180: 2474 6869 732d 3e6c 6173 745f 736d 7470  $this->last_smtp
+0003a190: 5f74 7261 6e73 6163 7469 6f6e 5f69 643b  _transaction_id;
+0003a1a0: 0a20 2020 207d 0a0a 2020 2020 2f2a 2a0a  .    }..    /**.
+0003a1b0: 2020 2020 202a 2047 6574 2074 6865 2071       * Get the q
+0003a1c0: 7565 7565 2f74 7261 6e73 6163 7469 6f6e  ueue/transaction
+0003a1d0: 2049 4420 6f66 2074 6865 206c 6173 7420   ID of the last 
+0003a1e0: 534d 5450 2074 7261 6e73 6163 7469 6f6e  SMTP transaction
+0003a1f0: 0a20 2020 2020 2a20 4966 206e 6f20 7265  .     * If no re
+0003a200: 706c 7920 6861 7320 6265 656e 2072 6563  ply has been rec
+0003a210: 6569 7665 6420 7965 742c 2069 7420 7769  eived yet, it wi
+0003a220: 6c6c 2072 6574 7572 6e20 6e75 6c6c 2e0a  ll return null..
+0003a230: 2020 2020 202a 2049 6620 6e6f 2070 6174       * If no pat
+0003a240: 7465 726e 2077 6173 206d 6174 6368 6564  tern was matched
+0003a250: 2c20 6974 2077 696c 6c20 7265 7475 726e  , it will return
+0003a260: 2066 616c 7365 2e0a 2020 2020 202a 0a20   false..     *. 
+0003a270: 2020 2020 2a20 4072 6574 7572 6e20 626f      * @return bo
+0003a280: 6f6c 7c73 7472 696e 677c 6e75 6c6c 0a20  ol|string|null. 
+0003a290: 2020 2020 2a0a 2020 2020 202a 2040 7365      *.     * @se
+0003a2a0: 6520 7265 636f 7264 4c61 7374 5472 616e  e recordLastTran
+0003a2b0: 7361 6374 696f 6e49 4428 290a 2020 2020  sactionID().    
+0003a2c0: 202a 2f0a 2020 2020 7075 626c 6963 2066   */.    public f
+0003a2d0: 756e 6374 696f 6e20 6765 744c 6173 7454  unction getLastT
+0003a2e0: 7261 6e73 6163 7469 6f6e 4944 2829 0a20  ransactionID(). 
+0003a2f0: 2020 207b 0a20 2020 2020 2020 2072 6574     {.        ret
+0003a300: 7572 6e20 2474 6869 732d 3e6c 6173 745f  urn $this->last_
+0003a310: 736d 7470 5f74 7261 6e73 6163 7469 6f6e  smtp_transaction
+0003a320: 5f69 643b 0a20 2020 207d 0a7d 0a         _id;.    }.}.
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/php-email-form/validate.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/php-email-form/validate.js`

 * *Files 4% similar despite different names*

#### js-beautify {}

```diff
@@ -1,9 +1,9 @@
 /**
- * PHP Email Form Validation - v3.5
+ * PHP Email Form Validation - v3.7
  * URL: https://bootstrapmade.com/php-email-form/
  * Author: BootstrapMade.com
  */
 (function() {
     "use strict";
 
     let forms = document.querySelectorAll('.php-email-form');
@@ -14,15 +14,15 @@
 
             let thisForm = this;
 
             let action = thisForm.getAttribute('action');
             let recaptcha = thisForm.getAttribute('data-recaptcha-site-key');
 
             if (!action) {
-                displayError(thisForm, 'The form action property is not set!')
+                displayError(thisForm, 'The form action property is not set!');
                 return;
             }
             thisForm.querySelector('.loading').classList.add('d-block');
             thisForm.querySelector('.error-message').classList.remove('d-block');
             thisForm.querySelector('.sent-message').classList.remove('d-block');
 
             let formData = new FormData(thisForm);
@@ -35,15 +35,15 @@
                                     action: 'php_email_form_submit'
                                 })
                                 .then(token => {
                                     formData.set('recaptcha-response', token);
                                     php_email_form_submit(thisForm, action, formData);
                                 })
                         } catch (error) {
-                            displayError(thisForm, error)
+                            displayError(thisForm, error);
                         }
                     });
                 } else {
                     displayError(thisForm, 'The reCaptcha javascript API url is not loaded!')
                 }
             } else {
                 php_email_form_submit(thisForm, action, formData);
@@ -56,15 +56,19 @@
                 method: 'POST',
                 body: formData,
                 headers: {
                     'X-Requested-With': 'XMLHttpRequest'
                 }
             })
             .then(response => {
-                return response.text();
+                if (response.ok) {
+                    return response.text();
+                } else {
+                    throw new Error(`${response.status} ${response.statusText} ${response.url}`);
+                }
             })
             .then(data => {
                 thisForm.querySelector('.loading').classList.remove('d-block');
                 if (data.trim() == 'OK') {
                     thisForm.querySelector('.sent-message').classList.add('d-block');
                     thisForm.reset();
                 } else {
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.css` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.css`

 * *Files 18% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 /**
- * Swiper 8.4.3
+ * Swiper 11.0.7
  * Most modern mobile touch slider and framework with hardware accelerated transitions
  * https://swiperjs.com
  *
- * Copyright 2014-2022 Vladimir Kharlampidi
+ * Copyright 2014-2024 Vladimir Kharlampidi
  *
  * Released under the MIT License
  *
- * Released on: October 6, 2022
+ * Released on: February 27, 2024
  */
 
-@font-face{font-family:swiper-icons;src:url('data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA');font-weight:400;font-style:normal}:root{--swiper-theme-color:#007aff}.swiper{margin-left:auto;margin-right:auto;position:relative;overflow:hidden;list-style:none;padding:0;z-index:1}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{position:relative;width:100%;height:100%;z-index:1;display:flex;transition-property:transform;box-sizing:content-box}.swiper-android .swiper-slide,.swiper-wrapper{transform:translate3d(0px,0,0)}.swiper-pointer-events{touch-action:pan-y}.swiper-pointer-events.swiper-vertical{touch-action:pan-x}.swiper-slide{flex-shrink:0;width:100%;height:100%;position:relative;transition-property:transform}.swiper-slide-invisible-blank{visibility:hidden}.swiper-autoheight,.swiper-autoheight .swiper-slide{height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden .swiper-slide{transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-3d,.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d .swiper-slide,.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top,.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:10}.swiper-3d .swiper-slide-shadow{background:rgba(0,0,0,.15)}.swiper-3d .swiper-slide-shadow-left{background-image:linear-gradient(to left,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-right{background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-top{background-image:linear-gradient(to top,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-bottom{background-image:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-css-mode>.swiper-wrapper{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:start start}.swiper-horizontal.swiper-css-mode>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-vertical.swiper-css-mode>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-centered>.swiper-wrapper::before{content:'';flex-shrink:0;order:9999}.swiper-centered.swiper-horizontal>.swiper-wrapper>.swiper-slide:first-child{margin-inline-start:var(--swiper-centered-offset-before)}.swiper-centered.swiper-horizontal>.swiper-wrapper::before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-centered.swiper-vertical>.swiper-wrapper>.swiper-slide:first-child{margin-block-start:var(--swiper-centered-offset-before)}.swiper-centered.swiper-vertical>.swiper-wrapper::before{width:100%;min-width:1px;height:var(--swiper-centered-offset-after)}.swiper-centered>.swiper-wrapper>.swiper-slide{scroll-snap-align:center center}.swiper-virtual .swiper-slide{-webkit-backface-visibility:hidden;transform:translateZ(0)}.swiper-virtual.swiper-css-mode .swiper-wrapper::after{content:'';position:absolute;left:0;top:0;pointer-events:none}.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after{height:1px;width:var(--swiper-virtual-size)}.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after{width:1px;height:var(--swiper-virtual-size)}:root{--swiper-navigation-size:44px}.swiper-button-next,.swiper-button-prev{position:absolute;top:50%;width:calc(var(--swiper-navigation-size)/ 44 * 27);height:var(--swiper-navigation-size);margin-top:calc(0px - (var(--swiper-navigation-size)/ 2));z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--swiper-navigation-color,var(--swiper-theme-color))}.swiper-button-next.swiper-button-disabled,.swiper-button-prev.swiper-button-disabled{opacity:.35;cursor:auto;pointer-events:none}.swiper-button-next.swiper-button-hidden,.swiper-button-prev.swiper-button-hidden{opacity:0;cursor:auto;pointer-events:none}.swiper-navigation-disabled .swiper-button-next,.swiper-navigation-disabled .swiper-button-prev{display:none!important}.swiper-button-next:after,.swiper-button-prev:after{font-family:swiper-icons;font-size:var(--swiper-navigation-size);text-transform:none!important;letter-spacing:0;font-variant:initial;line-height:1}.swiper-button-prev,.swiper-rtl .swiper-button-next{left:10px;right:auto}.swiper-button-prev:after,.swiper-rtl .swiper-button-next:after{content:'prev'}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:10px;left:auto}.swiper-button-next:after,.swiper-rtl .swiper-button-prev:after{content:'next'}.swiper-button-lock{display:none}.swiper-pagination{position:absolute;text-align:center;transition:.3s opacity;transform:translate3d(0,0,0);z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:10px;left:0;width:100%}.swiper-pagination-bullets-dynamic{overflow:hidden;font-size:0}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transform:scale(.33);position:relative}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px));height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));display:inline-block;border-radius:50%;background:var(--swiper-pagination-bullet-inactive-color,#000);opacity:var(--swiper-pagination-bullet-inactive-opacity, .2)}button.swiper-pagination-bullet{border:none;margin:0;padding:0;box-shadow:none;-webkit-appearance:none;appearance:none}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{opacity:var(--swiper-pagination-bullet-opacity, 1);background:var(--swiper-pagination-color,var(--swiper-theme-color))}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:10px;top:50%;transform:translate3d(0px,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0;display:block}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:.2s transform,.2s top}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s left}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s right}.swiper-pagination-progressbar{background:rgba(0,0,0,.25);position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));position:absolute;left:0;top:0;width:100%;height:100%;transform:scale(0);transform-origin:left top}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{width:100%;height:4px;left:0;top:0}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{width:4px;height:100%;left:0;top:0}.swiper-pagination-lock{display:none}.swiper-scrollbar{border-radius:10px;position:relative;-ms-touch-action:none;background:rgba(0,0,0,.1)}.swiper-scrollbar-disabled>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-disabled{display:none!important}.swiper-horizontal>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-horizontal{position:absolute;left:1%;bottom:3px;z-index:50;height:5px;width:98%}.swiper-scrollbar.swiper-scrollbar-vertical,.swiper-vertical>.swiper-scrollbar{position:absolute;right:3px;top:1%;z-index:50;width:5px;height:98%}.swiper-scrollbar-drag{height:100%;width:100%;position:relative;background:rgba(0,0,0,.5);border-radius:10px;left:0;top:0}.swiper-scrollbar-cursor-drag{cursor:move}.swiper-scrollbar-lock{display:none}.swiper-zoom-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center}.swiper-zoom-container>canvas,.swiper-zoom-container>img,.swiper-zoom-container>svg{max-width:100%;max-height:100%;object-fit:contain}.swiper-slide-zoomed{cursor:move}.swiper-lazy-preloader{width:42px;height:42px;position:absolute;left:50%;top:50%;margin-left:-21px;margin-top:-21px;z-index:10;transform-origin:50%;box-sizing:border-box;border:4px solid var(--swiper-preloader-color,var(--swiper-theme-color));border-radius:50%;border-top-color:transparent}.swiper-watch-progress .swiper-slide-visible .swiper-lazy-preloader,.swiper:not(.swiper-watch-progress) .swiper-lazy-preloader{animation:swiper-preloader-spin 1s infinite linear}.swiper-lazy-preloader-white{--swiper-preloader-color:#fff}.swiper-lazy-preloader-black{--swiper-preloader-color:#000}@keyframes swiper-preloader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.swiper .swiper-notification{position:absolute;left:0;top:0;pointer-events:none;opacity:0;z-index:-1000}.swiper-free-mode>.swiper-wrapper{transition-timing-function:ease-out;margin:0 auto}.swiper-grid>.swiper-wrapper{flex-wrap:wrap}.swiper-grid-column>.swiper-wrapper{flex-wrap:wrap;flex-direction:column}.swiper-fade.swiper-free-mode .swiper-slide{transition-timing-function:ease-out}.swiper-fade .swiper-slide{pointer-events:none;transition-property:opacity}.swiper-fade .swiper-slide .swiper-slide{pointer-events:none}.swiper-fade .swiper-slide-active,.swiper-fade .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-cube{overflow:visible}.swiper-cube .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1;visibility:hidden;transform-origin:0 0;width:100%;height:100%}.swiper-cube .swiper-slide .swiper-slide{pointer-events:none}.swiper-cube.swiper-rtl .swiper-slide{transform-origin:100% 0}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-next,.swiper-cube .swiper-slide-next+.swiper-slide,.swiper-cube .swiper-slide-prev{pointer-events:auto;visibility:visible}.swiper-cube .swiper-slide-shadow-bottom,.swiper-cube .swiper-slide-shadow-left,.swiper-cube .swiper-slide-shadow-right,.swiper-cube .swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-cube .swiper-cube-shadow{position:absolute;left:0;bottom:0px;width:100%;height:100%;opacity:.6;z-index:0}.swiper-cube .swiper-cube-shadow:before{content:'';background:#000;position:absolute;left:0;top:0;bottom:0;right:0;filter:blur(50px)}.swiper-flip{overflow:visible}.swiper-flip .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1}.swiper-flip .swiper-slide .swiper-slide{pointer-events:none}.swiper-flip .swiper-slide-active,.swiper-flip .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-flip .swiper-slide-shadow-bottom,.swiper-flip .swiper-slide-shadow-left,.swiper-flip .swiper-slide-shadow-right,.swiper-flip .swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-creative .swiper-slide{-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden;transition-property:transform,opacity,height}.swiper-cards{overflow:visible}.swiper-cards .swiper-slide{transform-origin:center bottom;-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden}
+@font-face{font-family:swiper-icons;src:url('data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA');font-weight:400;font-style:normal}:root{--swiper-theme-color:#007aff}:host{position:relative;display:block;margin-left:auto;margin-right:auto;z-index:1}.swiper{margin-left:auto;margin-right:auto;position:relative;overflow:hidden;list-style:none;padding:0;z-index:1;display:block}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{position:relative;width:100%;height:100%;z-index:1;display:flex;transition-property:transform;transition-timing-function:var(--swiper-wrapper-transition-timing-function,initial);box-sizing:content-box}.swiper-android .swiper-slide,.swiper-ios .swiper-slide,.swiper-wrapper{transform:translate3d(0px,0,0)}.swiper-horizontal{touch-action:pan-y}.swiper-vertical{touch-action:pan-x}.swiper-slide{flex-shrink:0;width:100%;height:100%;position:relative;transition-property:transform;display:block}.swiper-slide-invisible-blank{visibility:hidden}.swiper-autoheight,.swiper-autoheight .swiper-slide{height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden .swiper-slide{transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d .swiper-slide{transform-style:preserve-3d}.swiper-css-mode>.swiper-wrapper{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:start start}.swiper-css-mode.swiper-horizontal>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-css-mode.swiper-vertical>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-css-mode.swiper-free-mode>.swiper-wrapper{scroll-snap-type:none}.swiper-css-mode.swiper-free-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:none}.swiper-css-mode.swiper-centered>.swiper-wrapper::before{content:'';flex-shrink:0;order:9999}.swiper-css-mode.swiper-centered>.swiper-wrapper>.swiper-slide{scroll-snap-align:center center;scroll-snap-stop:always}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper>.swiper-slide:first-child{margin-inline-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper::before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper>.swiper-slide:first-child{margin-block-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper::before{width:100%;min-width:1px;height:var(--swiper-centered-offset-after)}.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:10}.swiper-3d .swiper-slide-shadow{background:rgba(0,0,0,.15)}.swiper-3d .swiper-slide-shadow-left{background-image:linear-gradient(to left,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-right{background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-top{background-image:linear-gradient(to top,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-bottom{background-image:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-lazy-preloader{width:42px;height:42px;position:absolute;left:50%;top:50%;margin-left:-21px;margin-top:-21px;z-index:10;transform-origin:50%;box-sizing:border-box;border:4px solid var(--swiper-preloader-color,var(--swiper-theme-color));border-radius:50%;border-top-color:transparent}.swiper-watch-progress .swiper-slide-visible .swiper-lazy-preloader,.swiper:not(.swiper-watch-progress) .swiper-lazy-preloader{animation:swiper-preloader-spin 1s infinite linear}.swiper-lazy-preloader-white{--swiper-preloader-color:#fff}.swiper-lazy-preloader-black{--swiper-preloader-color:#000}@keyframes swiper-preloader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.swiper-virtual .swiper-slide{-webkit-backface-visibility:hidden;transform:translateZ(0)}.swiper-virtual.swiper-css-mode .swiper-wrapper::after{content:'';position:absolute;left:0;top:0;pointer-events:none}.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after{height:1px;width:var(--swiper-virtual-size)}.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after{width:1px;height:var(--swiper-virtual-size)}:root{--swiper-navigation-size:44px}.swiper-button-next,.swiper-button-prev{position:absolute;top:var(--swiper-navigation-top-offset,50%);width:calc(var(--swiper-navigation-size)/ 44 * 27);height:var(--swiper-navigation-size);margin-top:calc(0px - (var(--swiper-navigation-size)/ 2));z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--swiper-navigation-color,var(--swiper-theme-color))}.swiper-button-next.swiper-button-disabled,.swiper-button-prev.swiper-button-disabled{opacity:.35;cursor:auto;pointer-events:none}.swiper-button-next.swiper-button-hidden,.swiper-button-prev.swiper-button-hidden{opacity:0;cursor:auto;pointer-events:none}.swiper-navigation-disabled .swiper-button-next,.swiper-navigation-disabled .swiper-button-prev{display:none!important}.swiper-button-next svg,.swiper-button-prev svg{width:100%;height:100%;object-fit:contain;transform-origin:center}.swiper-rtl .swiper-button-next svg,.swiper-rtl .swiper-button-prev svg{transform:rotate(180deg)}.swiper-button-prev,.swiper-rtl .swiper-button-next{left:var(--swiper-navigation-sides-offset,10px);right:auto}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-lock{display:none}.swiper-button-next:after,.swiper-button-prev:after{font-family:swiper-icons;font-size:var(--swiper-navigation-size);text-transform:none!important;letter-spacing:0;font-variant:initial;line-height:1}.swiper-button-prev:after,.swiper-rtl .swiper-button-next:after{content:'prev'}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-next:after,.swiper-rtl .swiper-button-prev:after{content:'next'}.swiper-pagination{position:absolute;text-align:center;transition:.3s opacity;transform:translate3d(0,0,0);z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:var(--swiper-pagination-bottom,8px);top:var(--swiper-pagination-top,auto);left:0;width:100%}.swiper-pagination-bullets-dynamic{overflow:hidden;font-size:0}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transform:scale(.33);position:relative}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px));height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));display:inline-block;border-radius:var(--swiper-pagination-bullet-border-radius,50%);background:var(--swiper-pagination-bullet-inactive-color,#000);opacity:var(--swiper-pagination-bullet-inactive-opacity, .2)}button.swiper-pagination-bullet{border:none;margin:0;padding:0;box-shadow:none;-webkit-appearance:none;appearance:none}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{opacity:var(--swiper-pagination-bullet-opacity, 1);background:var(--swiper-pagination-color,var(--swiper-theme-color))}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:var(--swiper-pagination-right,8px);left:var(--swiper-pagination-left,auto);top:50%;transform:translate3d(0px,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0;display:block}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:.2s transform,.2s top}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s left}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s right}.swiper-pagination-fraction{color:var(--swiper-pagination-fraction-color,inherit)}.swiper-pagination-progressbar{background:var(--swiper-pagination-progressbar-bg-color,rgba(0,0,0,.25));position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));position:absolute;left:0;top:0;width:100%;height:100%;transform:scale(0);transform-origin:left top}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{width:100%;height:var(--swiper-pagination-progressbar-size,4px);left:0;top:0}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{width:var(--swiper-pagination-progressbar-size,4px);height:100%;left:0;top:0}.swiper-pagination-lock{display:none}.swiper-scrollbar{border-radius:var(--swiper-scrollbar-border-radius,10px);position:relative;touch-action:none;background:var(--swiper-scrollbar-bg-color,rgba(0,0,0,.1))}.swiper-scrollbar-disabled>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-disabled{display:none!important}.swiper-horizontal>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-horizontal{position:absolute;left:var(--swiper-scrollbar-sides-offset,1%);bottom:var(--swiper-scrollbar-bottom,4px);top:var(--swiper-scrollbar-top,auto);z-index:50;height:var(--swiper-scrollbar-size,4px);width:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar.swiper-scrollbar-vertical,.swiper-vertical>.swiper-scrollbar{position:absolute;left:var(--swiper-scrollbar-left,auto);right:var(--swiper-scrollbar-right,4px);top:var(--swiper-scrollbar-sides-offset,1%);z-index:50;width:var(--swiper-scrollbar-size,4px);height:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar-drag{height:100%;width:100%;position:relative;background:var(--swiper-scrollbar-drag-bg-color,rgba(0,0,0,.5));border-radius:var(--swiper-scrollbar-border-radius,10px);left:0;top:0}.swiper-scrollbar-cursor-drag{cursor:move}.swiper-scrollbar-lock{display:none}.swiper-zoom-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center}.swiper-zoom-container>canvas,.swiper-zoom-container>img,.swiper-zoom-container>svg{max-width:100%;max-height:100%;object-fit:contain}.swiper-slide-zoomed{cursor:move;touch-action:none}.swiper .swiper-notification{position:absolute;left:0;top:0;pointer-events:none;opacity:0;z-index:-1000}.swiper-free-mode>.swiper-wrapper{transition-timing-function:ease-out;margin:0 auto}.swiper-grid>.swiper-wrapper{flex-wrap:wrap}.swiper-grid-column>.swiper-wrapper{flex-wrap:wrap;flex-direction:column}.swiper-fade.swiper-free-mode .swiper-slide{transition-timing-function:ease-out}.swiper-fade .swiper-slide{pointer-events:none;transition-property:opacity}.swiper-fade .swiper-slide .swiper-slide{pointer-events:none}.swiper-fade .swiper-slide-active{pointer-events:auto}.swiper-fade .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-cube{overflow:visible}.swiper-cube .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1;visibility:hidden;transform-origin:0 0;width:100%;height:100%}.swiper-cube .swiper-slide .swiper-slide{pointer-events:none}.swiper-cube.swiper-rtl .swiper-slide{transform-origin:100% 0}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-next,.swiper-cube .swiper-slide-prev{pointer-events:auto;visibility:visible}.swiper-cube .swiper-cube-shadow{position:absolute;left:0;bottom:0px;width:100%;height:100%;opacity:.6;z-index:0}.swiper-cube .swiper-cube-shadow:before{content:'';background:#000;position:absolute;left:0;top:0;bottom:0;right:0;filter:blur(50px)}.swiper-cube .swiper-slide-next+.swiper-slide{pointer-events:auto;visibility:visible}.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-bottom,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-left,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-right,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-flip{overflow:visible}.swiper-flip .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1}.swiper-flip .swiper-slide .swiper-slide{pointer-events:none}.swiper-flip .swiper-slide-active,.swiper-flip .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-bottom,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-left,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-right,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-creative .swiper-slide{-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden;transition-property:transform,opacity,height}.swiper-cards{overflow:visible}.swiper-cards .swiper-slide{transform-origin:center bottom;-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.js` & `django_herobiz_ds-2.0.3/django_herobiz_ds/static/herobizds/vendor/swiper/swiper-bundle.min.js`

 * *Files 10% similar despite different names*

#### js-beautify {}

```diff
@@ -1,22 +1,20 @@
 /**
- * Swiper 8.4.3
+ * Swiper 11.0.7
  * Most modern mobile touch slider and framework with hardware accelerated transitions
  * https://swiperjs.com
  *
- * Copyright 2014-2022 Vladimir Kharlampidi
+ * Copyright 2014-2024 Vladimir Kharlampidi
  *
  * Released under the MIT License
  *
- * Released on: October 6, 2022
+ * Released on: February 27, 2024
  */
 
-! function(e, t) {
-    "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (e = "undefined" != typeof globalThis ? globalThis : e || self).Swiper = t()
-}(this, (function() {
+var Swiper = function() {
     "use strict";
 
     function e(e) {
         return null !== e && "object" == typeof e && "constructor" in e && e.constructor === Object
     }
 
     function t(s, a) {
@@ -104,473 +102,66 @@
         }
     };
 
     function r() {
         const e = "undefined" != typeof window ? window : {};
         return t(e, i), e
     }
-    class n extends Array {
-        constructor(e) {
-            "number" == typeof e ? super(e) : (super(...e || []), function(e) {
-                const t = e.__proto__;
-                Object.defineProperty(e, "__proto__", {
-                    get: () => t,
-                    set(e) {
-                        t.__proto__ = e
-                    }
-                })
-            }(this))
-        }
-    }
-
-    function l(e) {
-        void 0 === e && (e = []);
-        const t = [];
-        return e.forEach((e => {
-            Array.isArray(e) ? t.push(...l(e)) : t.push(e)
-        })), t
-    }
 
-    function o(e, t) {
-        return Array.prototype.filter.call(e, t)
+    function n(e) {
+        return void 0 === e && (e = ""), e.trim().split(" ").filter((e => !!e.trim()))
     }
 
-    function d(e, t) {
-        const s = r(),
-            i = a();
-        let l = [];
-        if (!t && e instanceof n) return e;
-        if (!e) return new n(l);
-        if ("string" == typeof e) {
-            const s = e.trim();
-            if (s.indexOf("<") >= 0 && s.indexOf(">") >= 0) {
-                let e = "div";
-                0 === s.indexOf("<li") && (e = "ul"), 0 === s.indexOf("<tr") && (e = "tbody"), 0 !== s.indexOf("<td") && 0 !== s.indexOf("<th") || (e = "tr"), 0 === s.indexOf("<tbody") && (e = "table"), 0 === s.indexOf("<option") && (e = "select");
-                const t = i.createElement(e);
-                t.innerHTML = s;
-                for (let e = 0; e < t.childNodes.length; e += 1) l.push(t.childNodes[e])
-            } else l = function(e, t) {
-                if ("string" != typeof e) return [e];
-                const s = [],
-                    a = t.querySelectorAll(e);
-                for (let e = 0; e < a.length; e += 1) s.push(a[e]);
-                return s
-            }(e.trim(), t || i)
-        } else if (e.nodeType || e === s || e === i) l.push(e);
-        else if (Array.isArray(e)) {
-            if (e instanceof n) return e;
-            l = e
-        }
-        return new n(function(e) {
-            const t = [];
-            for (let s = 0; s < e.length; s += 1) - 1 === t.indexOf(e[s]) && t.push(e[s]);
-            return t
-        }(l))
-    }
-    d.fn = n.prototype;
-    const c = {
-        addClass: function() {
-            for (var e = arguments.length, t = new Array(e), s = 0; s < e; s++) t[s] = arguments[s];
-            const a = l(t.map((e => e.split(" "))));
-            return this.forEach((e => {
-                e.classList.add(...a)
-            })), this
-        },
-        removeClass: function() {
-            for (var e = arguments.length, t = new Array(e), s = 0; s < e; s++) t[s] = arguments[s];
-            const a = l(t.map((e => e.split(" "))));
-            return this.forEach((e => {
-                e.classList.remove(...a)
-            })), this
-        },
-        hasClass: function() {
-            for (var e = arguments.length, t = new Array(e), s = 0; s < e; s++) t[s] = arguments[s];
-            const a = l(t.map((e => e.split(" "))));
-            return o(this, (e => a.filter((t => e.classList.contains(t))).length > 0)).length > 0
-        },
-        toggleClass: function() {
-            for (var e = arguments.length, t = new Array(e), s = 0; s < e; s++) t[s] = arguments[s];
-            const a = l(t.map((e => e.split(" "))));
-            this.forEach((e => {
-                a.forEach((t => {
-                    e.classList.toggle(t)
-                }))
-            }))
-        },
-        attr: function(e, t) {
-            if (1 === arguments.length && "string" == typeof e) return this[0] ? this[0].getAttribute(e) : void 0;
-            for (let s = 0; s < this.length; s += 1)
-                if (2 === arguments.length) this[s].setAttribute(e, t);
-                else
-                    for (const t in e) this[s][t] = e[t], this[s].setAttribute(t, e[t]);
-            return this
-        },
-        removeAttr: function(e) {
-            for (let t = 0; t < this.length; t += 1) this[t].removeAttribute(e);
-            return this
-        },
-        transform: function(e) {
-            for (let t = 0; t < this.length; t += 1) this[t].style.transform = e;
-            return this
-        },
-        transition: function(e) {
-            for (let t = 0; t < this.length; t += 1) this[t].style.transitionDuration = "string" != typeof e ? `${e}ms` : e;
-            return this
-        },
-        on: function() {
-            for (var e = arguments.length, t = new Array(e), s = 0; s < e; s++) t[s] = arguments[s];
-            let [a, i, r, n] = t;
-
-            function l(e) {
-                const t = e.target;
-                if (!t) return;
-                const s = e.target.dom7EventData || [];
-                if (s.indexOf(e) < 0 && s.unshift(e), d(t).is(i)) r.apply(t, s);
-                else {
-                    const e = d(t).parents();
-                    for (let t = 0; t < e.length; t += 1) d(e[t]).is(i) && r.apply(e[t], s)
-                }
-            }
-
-            function o(e) {
-                const t = e && e.target && e.target.dom7EventData || [];
-                t.indexOf(e) < 0 && t.unshift(e), r.apply(this, t)
-            }
-            "function" == typeof t[1] && ([a, r, n] = t, i = void 0), n || (n = !1);
-            const c = a.split(" ");
-            let p;
-            for (let e = 0; e < this.length; e += 1) {
-                const t = this[e];
-                if (i)
-                    for (p = 0; p < c.length; p += 1) {
-                        const e = c[p];
-                        t.dom7LiveListeners || (t.dom7LiveListeners = {}), t.dom7LiveListeners[e] || (t.dom7LiveListeners[e] = []), t.dom7LiveListeners[e].push({
-                            listener: r,
-                            proxyListener: l
-                        }), t.addEventListener(e, l, n)
-                    } else
-                        for (p = 0; p < c.length; p += 1) {
-                            const e = c[p];
-                            t.dom7Listeners || (t.dom7Listeners = {}), t.dom7Listeners[e] || (t.dom7Listeners[e] = []), t.dom7Listeners[e].push({
-                                listener: r,
-                                proxyListener: o
-                            }), t.addEventListener(e, o, n)
-                        }
-            }
-            return this
-        },
-        off: function() {
-            for (var e = arguments.length, t = new Array(e), s = 0; s < e; s++) t[s] = arguments[s];
-            let [a, i, r, n] = t;
-            "function" == typeof t[1] && ([a, r, n] = t, i = void 0), n || (n = !1);
-            const l = a.split(" ");
-            for (let e = 0; e < l.length; e += 1) {
-                const t = l[e];
-                for (let e = 0; e < this.length; e += 1) {
-                    const s = this[e];
-                    let a;
-                    if (!i && s.dom7Listeners ? a = s.dom7Listeners[t] : i && s.dom7LiveListeners && (a = s.dom7LiveListeners[t]), a && a.length)
-                        for (let e = a.length - 1; e >= 0; e -= 1) {
-                            const i = a[e];
-                            r && i.listener === r || r && i.listener && i.listener.dom7proxy && i.listener.dom7proxy === r ? (s.removeEventListener(t, i.proxyListener, n), a.splice(e, 1)) : r || (s.removeEventListener(t, i.proxyListener, n), a.splice(e, 1))
-                        }
-                }
-            }
-            return this
-        },
-        trigger: function() {
-            const e = r();
-            for (var t = arguments.length, s = new Array(t), a = 0; a < t; a++) s[a] = arguments[a];
-            const i = s[0].split(" "),
-                n = s[1];
-            for (let t = 0; t < i.length; t += 1) {
-                const a = i[t];
-                for (let t = 0; t < this.length; t += 1) {
-                    const i = this[t];
-                    if (e.CustomEvent) {
-                        const t = new e.CustomEvent(a, {
-                            detail: n,
-                            bubbles: !0,
-                            cancelable: !0
-                        });
-                        i.dom7EventData = s.filter(((e, t) => t > 0)), i.dispatchEvent(t), i.dom7EventData = [], delete i.dom7EventData
-                    }
-                }
-            }
-            return this
-        },
-        transitionEnd: function(e) {
-            const t = this;
-            return e && t.on("transitionend", (function s(a) {
-                a.target === this && (e.call(this, a), t.off("transitionend", s))
-            })), this
-        },
-        outerWidth: function(e) {
-            if (this.length > 0) {
-                if (e) {
-                    const e = this.styles();
-                    return this[0].offsetWidth + parseFloat(e.getPropertyValue("margin-right")) + parseFloat(e.getPropertyValue("margin-left"))
-                }
-                return this[0].offsetWidth
-            }
-            return null
-        },
-        outerHeight: function(e) {
-            if (this.length > 0) {
-                if (e) {
-                    const e = this.styles();
-                    return this[0].offsetHeight + parseFloat(e.getPropertyValue("margin-top")) + parseFloat(e.getPropertyValue("margin-bottom"))
-                }
-                return this[0].offsetHeight
-            }
-            return null
-        },
-        styles: function() {
-            const e = r();
-            return this[0] ? e.getComputedStyle(this[0], null) : {}
-        },
-        offset: function() {
-            if (this.length > 0) {
-                const e = r(),
-                    t = a(),
-                    s = this[0],
-                    i = s.getBoundingClientRect(),
-                    n = t.body,
-                    l = s.clientTop || n.clientTop || 0,
-                    o = s.clientLeft || n.clientLeft || 0,
-                    d = s === e ? e.scrollY : s.scrollTop,
-                    c = s === e ? e.scrollX : s.scrollLeft;
-                return {
-                    top: i.top + d - l,
-                    left: i.left + c - o
-                }
-            }
-            return null
-        },
-        css: function(e, t) {
-            const s = r();
-            let a;
-            if (1 === arguments.length) {
-                if ("string" != typeof e) {
-                    for (a = 0; a < this.length; a += 1)
-                        for (const t in e) this[a].style[t] = e[t];
-                    return this
-                }
-                if (this[0]) return s.getComputedStyle(this[0], null).getPropertyValue(e)
-            }
-            if (2 === arguments.length && "string" == typeof e) {
-                for (a = 0; a < this.length; a += 1) this[a].style[e] = t;
-                return this
-            }
-            return this
-        },
-        each: function(e) {
-            return e ? (this.forEach(((t, s) => {
-                e.apply(t, [t, s])
-            })), this) : this
-        },
-        html: function(e) {
-            if (void 0 === e) return this[0] ? this[0].innerHTML : null;
-            for (let t = 0; t < this.length; t += 1) this[t].innerHTML = e;
-            return this
-        },
-        text: function(e) {
-            if (void 0 === e) return this[0] ? this[0].textContent.trim() : null;
-            for (let t = 0; t < this.length; t += 1) this[t].textContent = e;
-            return this
-        },
-        is: function(e) {
-            const t = r(),
-                s = a(),
-                i = this[0];
-            let l, o;
-            if (!i || void 0 === e) return !1;
-            if ("string" == typeof e) {
-                if (i.matches) return i.matches(e);
-                if (i.webkitMatchesSelector) return i.webkitMatchesSelector(e);
-                if (i.msMatchesSelector) return i.msMatchesSelector(e);
-                for (l = d(e), o = 0; o < l.length; o += 1)
-                    if (l[o] === i) return !0;
-                return !1
-            }
-            if (e === s) return i === s;
-            if (e === t) return i === t;
-            if (e.nodeType || e instanceof n) {
-                for (l = e.nodeType ? [e] : e, o = 0; o < l.length; o += 1)
-                    if (l[o] === i) return !0;
-                return !1
-            }
-            return !1
-        },
-        index: function() {
-            let e, t = this[0];
-            if (t) {
-                for (e = 0; null !== (t = t.previousSibling);) 1 === t.nodeType && (e += 1);
-                return e
-            }
-        },
-        eq: function(e) {
-            if (void 0 === e) return this;
-            const t = this.length;
-            if (e > t - 1) return d([]);
-            if (e < 0) {
-                const s = t + e;
-                return d(s < 0 ? [] : [this[s]])
-            }
-            return d([this[e]])
-        },
-        append: function() {
-            let e;
-            const t = a();
-            for (let s = 0; s < arguments.length; s += 1) {
-                e = s < 0 || arguments.length <= s ? void 0 : arguments[s];
-                for (let s = 0; s < this.length; s += 1)
-                    if ("string" == typeof e) {
-                        const a = t.createElement("div");
-                        for (a.innerHTML = e; a.firstChild;) this[s].appendChild(a.firstChild)
-                    } else if (e instanceof n)
-                    for (let t = 0; t < e.length; t += 1) this[s].appendChild(e[t]);
-                else this[s].appendChild(e)
-            }
-            return this
-        },
-        prepend: function(e) {
-            const t = a();
-            let s, i;
-            for (s = 0; s < this.length; s += 1)
-                if ("string" == typeof e) {
-                    const a = t.createElement("div");
-                    for (a.innerHTML = e, i = a.childNodes.length - 1; i >= 0; i -= 1) this[s].insertBefore(a.childNodes[i], this[s].childNodes[0])
-                } else if (e instanceof n)
-                for (i = 0; i < e.length; i += 1) this[s].insertBefore(e[i], this[s].childNodes[0]);
-            else this[s].insertBefore(e, this[s].childNodes[0]);
-            return this
-        },
-        next: function(e) {
-            return this.length > 0 ? e ? this[0].nextElementSibling && d(this[0].nextElementSibling).is(e) ? d([this[0].nextElementSibling]) : d([]) : this[0].nextElementSibling ? d([this[0].nextElementSibling]) : d([]) : d([])
-        },
-        nextAll: function(e) {
-            const t = [];
-            let s = this[0];
-            if (!s) return d([]);
-            for (; s.nextElementSibling;) {
-                const a = s.nextElementSibling;
-                e ? d(a).is(e) && t.push(a) : t.push(a), s = a
-            }
-            return d(t)
-        },
-        prev: function(e) {
-            if (this.length > 0) {
-                const t = this[0];
-                return e ? t.previousElementSibling && d(t.previousElementSibling).is(e) ? d([t.previousElementSibling]) : d([]) : t.previousElementSibling ? d([t.previousElementSibling]) : d([])
-            }
-            return d([])
-        },
-        prevAll: function(e) {
-            const t = [];
-            let s = this[0];
-            if (!s) return d([]);
-            for (; s.previousElementSibling;) {
-                const a = s.previousElementSibling;
-                e ? d(a).is(e) && t.push(a) : t.push(a), s = a
-            }
-            return d(t)
-        },
-        parent: function(e) {
-            const t = [];
-            for (let s = 0; s < this.length; s += 1) null !== this[s].parentNode && (e ? d(this[s].parentNode).is(e) && t.push(this[s].parentNode) : t.push(this[s].parentNode));
-            return d(t)
-        },
-        parents: function(e) {
-            const t = [];
-            for (let s = 0; s < this.length; s += 1) {
-                let a = this[s].parentNode;
-                for (; a;) e ? d(a).is(e) && t.push(a) : t.push(a), a = a.parentNode
-            }
-            return d(t)
-        },
-        closest: function(e) {
-            let t = this;
-            return void 0 === e ? d([]) : (t.is(e) || (t = t.parents(e).eq(0)), t)
-        },
-        find: function(e) {
-            const t = [];
-            for (let s = 0; s < this.length; s += 1) {
-                const a = this[s].querySelectorAll(e);
-                for (let e = 0; e < a.length; e += 1) t.push(a[e])
-            }
-            return d(t)
-        },
-        children: function(e) {
-            const t = [];
-            for (let s = 0; s < this.length; s += 1) {
-                const a = this[s].children;
-                for (let s = 0; s < a.length; s += 1) e && !d(a[s]).is(e) || t.push(a[s])
-            }
-            return d(t)
-        },
-        filter: function(e) {
-            return d(o(this, e))
-        },
-        remove: function() {
-            for (let e = 0; e < this.length; e += 1) this[e].parentNode && this[e].parentNode.removeChild(this[e]);
-            return this
-        }
-    };
-
-    function p(e, t) {
+    function l(e, t) {
         return void 0 === t && (t = 0), setTimeout(e, t)
     }
 
-    function u() {
+    function o() {
         return Date.now()
     }
 
-    function h(e, t) {
+    function d(e, t) {
         void 0 === t && (t = "x");
         const s = r();
         let a, i, n;
         const l = function(e) {
             const t = r();
             let s;
             return t.getComputedStyle && (s = t.getComputedStyle(e, null)), !s && e.currentStyle && (s = e.currentStyle), s || (s = e.style), s
         }(e);
         return s.WebKitCSSMatrix ? (i = l.transform || l.webkitTransform, i.split(",").length > 6 && (i = i.split(", ").map((e => e.replace(",", "."))).join(", ")), n = new s.WebKitCSSMatrix("none" === i ? "" : i)) : (n = l.MozTransform || l.OTransform || l.MsTransform || l.msTransform || l.transform || l.getPropertyValue("transform").replace("translate(", "matrix(1, 0, 0, 1,"), a = n.toString().split(",")), "x" === t && (i = s.WebKitCSSMatrix ? n.m41 : 16 === a.length ? parseFloat(a[12]) : parseFloat(a[4])), "y" === t && (i = s.WebKitCSSMatrix ? n.m42 : 16 === a.length ? parseFloat(a[13]) : parseFloat(a[5])), i || 0
     }
 
-    function m(e) {
+    function c(e) {
         return "object" == typeof e && null !== e && e.constructor && "Object" === Object.prototype.toString.call(e).slice(8, -1)
     }
 
-    function f(e) {
-        return "undefined" != typeof window && void 0 !== window.HTMLElement ? e instanceof HTMLElement : e && (1 === e.nodeType || 11 === e.nodeType)
-    }
-
-    function g() {
+    function p() {
         const e = Object(arguments.length <= 0 ? void 0 : arguments[0]),
             t = ["__proto__", "constructor", "prototype"];
-        for (let s = 1; s < arguments.length; s += 1) {
-            const a = s < 0 || arguments.length <= s ? void 0 : arguments[s];
-            if (null != a && !f(a)) {
-                const s = Object.keys(Object(a)).filter((e => t.indexOf(e) < 0));
-                for (let t = 0, i = s.length; t < i; t += 1) {
-                    const i = s[t],
-                        r = Object.getOwnPropertyDescriptor(a, i);
-                    void 0 !== r && r.enumerable && (m(e[i]) && m(a[i]) ? a[i].__swiper__ ? e[i] = a[i] : g(e[i], a[i]) : !m(e[i]) && m(a[i]) ? (e[i] = {}, a[i].__swiper__ ? e[i] = a[i] : g(e[i], a[i])) : e[i] = a[i])
+        for (let a = 1; a < arguments.length; a += 1) {
+            const i = a < 0 || arguments.length <= a ? void 0 : arguments[a];
+            if (null != i && (s = i, !("undefined" != typeof window && void 0 !== window.HTMLElement ? s instanceof HTMLElement : s && (1 === s.nodeType || 11 === s.nodeType)))) {
+                const s = Object.keys(Object(i)).filter((e => t.indexOf(e) < 0));
+                for (let t = 0, a = s.length; t < a; t += 1) {
+                    const a = s[t],
+                        r = Object.getOwnPropertyDescriptor(i, a);
+                    void 0 !== r && r.enumerable && (c(e[a]) && c(i[a]) ? i[a].__swiper__ ? e[a] = i[a] : p(e[a], i[a]) : !c(e[a]) && c(i[a]) ? (e[a] = {}, i[a].__swiper__ ? e[a] = i[a] : p(e[a], i[a])) : e[a] = i[a])
                 }
             }
         }
+        var s;
         return e
     }
 
-    function v(e, t, s) {
+    function u(e, t, s) {
         e.style.setProperty(t, s)
     }
 
-    function w(e) {
+    function m(e) {
         let {
             swiper: t,
             targetPosition: s,
             side: a
         } = e;
         const i = r(),
             n = -t.translate;
@@ -591,84 +182,149 @@
                         [a]: c
                     })
                 })), void i.cancelAnimationFrame(t.cssModeFrameID);
                 t.cssModeFrameID = i.requestAnimationFrame(u)
             };
         u()
     }
-    let b, x, y;
 
-    function E() {
-        return b || (b = function() {
+    function h(e) {
+        return e.querySelector(".swiper-slide-transform") || e.shadowRoot && e.shadowRoot.querySelector(".swiper-slide-transform") || e
+    }
+
+    function f(e, t) {
+        return void 0 === t && (t = ""), [...e.children].filter((e => e.matches(t)))
+    }
+
+    function g(e) {
+        try {
+            return void console.warn(e)
+        } catch (e) {}
+    }
+
+    function v(e, t) {
+        void 0 === t && (t = []);
+        const s = document.createElement(e);
+        return s.classList.add(...Array.isArray(t) ? t : n(t)), s
+    }
+
+    function w(e) {
+        const t = r(),
+            s = a(),
+            i = e.getBoundingClientRect(),
+            n = s.body,
+            l = e.clientTop || n.clientTop || 0,
+            o = e.clientLeft || n.clientLeft || 0,
+            d = e === t ? t.scrollY : e.scrollTop,
+            c = e === t ? t.scrollX : e.scrollLeft;
+        return {
+            top: i.top + d - l,
+            left: i.left + c - o
+        }
+    }
+
+    function b(e, t) {
+        return r().getComputedStyle(e, null).getPropertyValue(t)
+    }
+
+    function y(e) {
+        let t, s = e;
+        if (s) {
+            for (t = 0; null !== (s = s.previousSibling);) 1 === s.nodeType && (t += 1);
+            return t
+        }
+    }
+
+    function E(e, t) {
+        const s = [];
+        let a = e.parentElement;
+        for (; a;) t ? a.matches(t) && s.push(a) : s.push(a), a = a.parentElement;
+        return s
+    }
+
+    function x(e, t) {
+        t && e.addEventListener("transitionend", (function s(a) {
+            a.target === e && (t.call(e, a), e.removeEventListener("transitionend", s))
+        }))
+    }
+
+    function S(e, t, s) {
+        const a = r();
+        return s ? e["width" === t ? "offsetWidth" : "offsetHeight"] + parseFloat(a.getComputedStyle(e, null).getPropertyValue("width" === t ? "margin-right" : "margin-top")) + parseFloat(a.getComputedStyle(e, null).getPropertyValue("width" === t ? "margin-left" : "margin-bottom")) : e.offsetWidth
+    }
+
+    function T(e) {
+        return (Array.isArray(e) ? e : [e]).filter((e => !!e))
+    }
+    let M, C, P;
+
+    function L() {
+        return M || (M = function() {
             const e = r(),
                 t = a();
             return {
-                smoothScroll: t.documentElement && "scrollBehavior" in t.documentElement.style,
-                touch: !!("ontouchstart" in e || e.DocumentTouch && t instanceof e.DocumentTouch),
-                passiveListener: function() {
-                    let t = !1;
-                    try {
-                        const s = Object.defineProperty({}, "passive", {
-                            get() {
-                                t = !0
-                            }
-                        });
-                        e.addEventListener("testPassiveListener", null, s)
-                    } catch (e) {}
-                    return t
-                }(),
-                gestures: "ongesturestart" in e
+                smoothScroll: t.documentElement && t.documentElement.style && "scrollBehavior" in t.documentElement.style,
+                touch: !!("ontouchstart" in e || e.DocumentTouch && t instanceof e.DocumentTouch)
             }
-        }()), b
+        }()), M
     }
 
-    function C(e) {
-        return void 0 === e && (e = {}), x || (x = function(e) {
+    function I(e) {
+        return void 0 === e && (e = {}), C || (C = function(e) {
             let {
                 userAgent: t
             } = void 0 === e ? {} : e;
-            const s = E(),
+            const s = L(),
                 a = r(),
                 i = a.navigator.platform,
                 n = t || a.navigator.userAgent,
                 l = {
                     ios: !1,
                     android: !1
                 },
                 o = a.screen.width,
                 d = a.screen.height,
                 c = n.match(/(Android);?[\s\/]+([\d.]+)?/);
             let p = n.match(/(iPad).*OS\s([\d_]+)/);
             const u = n.match(/(iPod)(.*OS\s([\d_]+))?/),
-                h = !p && n.match(/(iPhone\sOS|iOS)\s([\d_]+)/),
-                m = "Win32" === i;
+                m = !p && n.match(/(iPhone\sOS|iOS)\s([\d_]+)/),
+                h = "Win32" === i;
             let f = "MacIntel" === i;
-            return !p && f && s.touch && ["1024x1366", "1366x1024", "834x1194", "1194x834", "834x1112", "1112x834", "768x1024", "1024x768", "820x1180", "1180x820", "810x1080", "1080x810"].indexOf(`${o}x${d}`) >= 0 && (p = n.match(/(Version)\/([\d.]+)/), p || (p = [0, 1, "13_0_0"]), f = !1), c && !m && (l.os = "android", l.android = !0), (p || h || u) && (l.os = "ios", l.ios = !0), l
-        }(e)), x
+            return !p && f && s.touch && ["1024x1366", "1366x1024", "834x1194", "1194x834", "834x1112", "1112x834", "768x1024", "1024x768", "820x1180", "1180x820", "810x1080", "1080x810"].indexOf(`${o}x${d}`) >= 0 && (p = n.match(/(Version)\/([\d.]+)/), p || (p = [0, 1, "13_0_0"]), f = !1), c && !h && (l.os = "android", l.android = !0), (p || m || u) && (l.os = "ios", l.ios = !0), l
+        }(e)), C
     }
 
-    function T() {
-        return y || (y = function() {
-            const e = r();
+    function z() {
+        return P || (P = function() {
+            const e = r(),
+                t = I();
+            let s = !1;
+
+            function a() {
+                const t = e.navigator.userAgent.toLowerCase();
+                return t.indexOf("safari") >= 0 && t.indexOf("chrome") < 0 && t.indexOf("android") < 0
+            }
+            if (a()) {
+                const t = String(e.navigator.userAgent);
+                if (t.includes("Version/")) {
+                    const [e, a] = t.split("Version/")[1].split(" ")[0].split(".").map((e => Number(e)));
+                    s = e < 16 || 16 === e && a < 2
+                }
+            }
+            const i = /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent),
+                n = a();
             return {
-                isSafari: function() {
-                    const t = e.navigator.userAgent.toLowerCase();
-                    return t.indexOf("safari") >= 0 && t.indexOf("chrome") < 0 && t.indexOf("android") < 0
-                }(),
-                isWebView: /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent)
-            }
-        }()), y
-    }
-    Object.keys(c).forEach((e => {
-        Object.defineProperty(d.fn, e, {
-            value: c[e],
-            writable: !0
-        })
-    }));
-    var $ = {
+                isSafari: s || n,
+                needPerspectiveFix: s,
+                need3dFix: n || i && t.ios,
+                isWebView: i
+            }
+        }()), P
+    }
+    var A = {
         on(e, t, s) {
             const a = this;
             if (!a.eventsListeners || a.destroyed) return a;
             if ("function" != typeof t) return a;
             const i = s ? "unshift" : "push";
             return e.split(" ").forEach((e => {
                 a.eventsListeners[e] || (a.eventsListeners[e] = []), a.eventsListeners[e][i](t)
@@ -720,332 +376,422 @@
                     e.apply(a, [t, ...s])
                 })), e.eventsListeners && e.eventsListeners[t] && e.eventsListeners[t].forEach((e => {
                     e.apply(a, s)
                 }))
             })), e
         }
     };
-    var S = {
+    const $ = (e, t) => {
+            if (!e || e.destroyed || !e.params) return;
+            const s = t.closest(e.isElement ? "swiper-slide" : `.${e.params.slideClass}`);
+            if (s) {
+                let t = s.querySelector(`.${e.params.lazyPreloaderClass}`);
+                !t && e.isElement && (s.shadowRoot ? t = s.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`) : requestAnimationFrame((() => {
+                    s.shadowRoot && (t = s.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`), t && t.remove())
+                }))), t && t.remove()
+            }
+        },
+        k = (e, t) => {
+            if (!e.slides[t]) return;
+            const s = e.slides[t].querySelector('[loading="lazy"]');
+            s && s.removeAttribute("loading")
+        },
+        O = e => {
+            if (!e || e.destroyed || !e.params) return;
+            let t = e.params.lazyPreloadPrevNext;
+            const s = e.slides.length;
+            if (!s || !t || t < 0) return;
+            t = Math.min(t, s);
+            const a = "auto" === e.params.slidesPerView ? e.slidesPerViewDynamic() : Math.ceil(e.params.slidesPerView),
+                i = e.activeIndex;
+            if (e.params.grid && e.params.grid.rows > 1) {
+                const s = i,
+                    r = [s - t];
+                return r.push(...Array.from({
+                    length: t
+                }).map(((e, t) => s + a + t))), void e.slides.forEach(((t, s) => {
+                    r.includes(t.column) && k(e, s)
+                }))
+            }
+            const r = i + a - 1;
+            if (e.params.rewind || e.params.loop)
+                for (let a = i - t; a <= r + t; a += 1) {
+                    const t = (a % s + s) % s;
+                    (t < i || t > r) && k(e, t)
+                } else
+                    for (let a = Math.max(i - t, 0); a <= Math.min(r + t, s - 1); a += 1) a !== i && (a > r || a < i) && k(e, a)
+        };
+    var D = {
         updateSize: function() {
             const e = this;
             let t, s;
-            const a = e.$el;
-            t = void 0 !== e.params.width && null !== e.params.width ? e.params.width : a[0].clientWidth, s = void 0 !== e.params.height && null !== e.params.height ? e.params.height : a[0].clientHeight, 0 === t && e.isHorizontal() || 0 === s && e.isVertical() || (t = t - parseInt(a.css("padding-left") || 0, 10) - parseInt(a.css("padding-right") || 0, 10), s = s - parseInt(a.css("padding-top") || 0, 10) - parseInt(a.css("padding-bottom") || 0, 10), Number.isNaN(t) && (t = 0), Number.isNaN(s) && (s = 0), Object.assign(e, {
+            const a = e.el;
+            t = void 0 !== e.params.width && null !== e.params.width ? e.params.width : a.clientWidth, s = void 0 !== e.params.height && null !== e.params.height ? e.params.height : a.clientHeight, 0 === t && e.isHorizontal() || 0 === s && e.isVertical() || (t = t - parseInt(b(a, "padding-left") || 0, 10) - parseInt(b(a, "padding-right") || 0, 10), s = s - parseInt(b(a, "padding-top") || 0, 10) - parseInt(b(a, "padding-bottom") || 0, 10), Number.isNaN(t) && (t = 0), Number.isNaN(s) && (s = 0), Object.assign(e, {
                 width: t,
                 height: s,
                 size: e.isHorizontal() ? t : s
             }))
         },
         updateSlides: function() {
             const e = this;
 
-            function t(t) {
-                return e.isHorizontal() ? t : {
-                    width: "height",
-                    "margin-top": "margin-left",
-                    "margin-bottom ": "margin-right",
-                    "margin-left": "margin-top",
-                    "margin-right": "margin-bottom",
-                    "padding-left": "padding-top",
-                    "padding-right": "padding-bottom",
-                    marginRight: "marginBottom"
-                } [t]
-            }
-
-            function s(e, s) {
-                return parseFloat(e.getPropertyValue(t(s)) || 0)
+            function t(t, s) {
+                return parseFloat(t.getPropertyValue(e.getDirectionLabel(s)) || 0)
             }
-            const a = e.params,
+            const s = e.params,
                 {
-                    $wrapperEl: i,
+                    wrapperEl: a,
+                    slidesEl: i,
                     size: r,
                     rtlTranslate: n,
                     wrongRTL: l
                 } = e,
-                o = e.virtual && a.virtual.enabled,
+                o = e.virtual && s.virtual.enabled,
                 d = o ? e.virtual.slides.length : e.slides.length,
-                c = i.children(`.${e.params.slideClass}`),
+                c = f(i, `.${e.params.slideClass}, swiper-slide`),
                 p = o ? e.virtual.slides.length : c.length;
-            let u = [];
+            let m = [];
             const h = [],
-                m = [];
-            let f = a.slidesOffsetBefore;
-            "function" == typeof f && (f = a.slidesOffsetBefore.call(e));
-            let g = a.slidesOffsetAfter;
-            "function" == typeof g && (g = a.slidesOffsetAfter.call(e));
-            const w = e.snapGrid.length,
-                b = e.slidesGrid.length;
-            let x = a.spaceBetween,
-                y = -f,
-                E = 0,
+                g = [];
+            let v = s.slidesOffsetBefore;
+            "function" == typeof v && (v = s.slidesOffsetBefore.call(e));
+            let w = s.slidesOffsetAfter;
+            "function" == typeof w && (w = s.slidesOffsetAfter.call(e));
+            const y = e.snapGrid.length,
+                E = e.slidesGrid.length;
+            let x = s.spaceBetween,
+                T = -v,
+                M = 0,
                 C = 0;
             if (void 0 === r) return;
-            "string" == typeof x && x.indexOf("%") >= 0 && (x = parseFloat(x.replace("%", "")) / 100 * r), e.virtualSize = -x, n ? c.css({
-                marginLeft: "",
-                marginBottom: "",
-                marginTop: ""
-            }) : c.css({
-                marginRight: "",
-                marginBottom: "",
-                marginTop: ""
-            }), a.centeredSlides && a.cssMode && (v(e.wrapperEl, "--swiper-centered-offset-before", ""), v(e.wrapperEl, "--swiper-centered-offset-after", ""));
-            const T = a.grid && a.grid.rows > 1 && e.grid;
-            let $;
-            T && e.grid.initSlides(p);
-            const S = "auto" === a.slidesPerView && a.breakpoints && Object.keys(a.breakpoints).filter((e => void 0 !== a.breakpoints[e].slidesPerView)).length > 0;
-            for (let i = 0; i < p; i += 1) {
-                $ = 0;
-                const n = c.eq(i);
-                if (T && e.grid.updateSlide(i, n, p, t), "none" !== n.css("display")) {
-                    if ("auto" === a.slidesPerView) {
-                        S && (c[i].style[t("width")] = "");
-                        const r = getComputedStyle(n[0]),
-                            l = n[0].style.transform,
-                            o = n[0].style.webkitTransform;
-                        if (l && (n[0].style.transform = "none"), o && (n[0].style.webkitTransform = "none"), a.roundLengths) $ = e.isHorizontal() ? n.outerWidth(!0) : n.outerHeight(!0);
+            "string" == typeof x && x.indexOf("%") >= 0 ? x = parseFloat(x.replace("%", "")) / 100 * r : "string" == typeof x && (x = parseFloat(x)), e.virtualSize = -x, c.forEach((e => {
+                n ? e.style.marginLeft = "" : e.style.marginRight = "", e.style.marginBottom = "", e.style.marginTop = ""
+            })), s.centeredSlides && s.cssMode && (u(a, "--swiper-centered-offset-before", ""), u(a, "--swiper-centered-offset-after", ""));
+            const P = s.grid && s.grid.rows > 1 && e.grid;
+            let L;
+            P ? e.grid.initSlides(c) : e.grid && e.grid.unsetSlides();
+            const I = "auto" === s.slidesPerView && s.breakpoints && Object.keys(s.breakpoints).filter((e => void 0 !== s.breakpoints[e].slidesPerView)).length > 0;
+            for (let a = 0; a < p; a += 1) {
+                let i;
+                if (L = 0, c[a] && (i = c[a]), P && e.grid.updateSlide(a, i, c), !c[a] || "none" !== b(i, "display")) {
+                    if ("auto" === s.slidesPerView) {
+                        I && (c[a].style[e.getDirectionLabel("width")] = "");
+                        const r = getComputedStyle(i),
+                            n = i.style.transform,
+                            l = i.style.webkitTransform;
+                        if (n && (i.style.transform = "none"), l && (i.style.webkitTransform = "none"), s.roundLengths) L = e.isHorizontal() ? S(i, "width", !0) : S(i, "height", !0);
                         else {
-                            const e = s(r, "width"),
-                                t = s(r, "padding-left"),
-                                a = s(r, "padding-right"),
-                                i = s(r, "margin-left"),
-                                l = s(r, "margin-right"),
+                            const e = t(r, "width"),
+                                s = t(r, "padding-left"),
+                                a = t(r, "padding-right"),
+                                n = t(r, "margin-left"),
+                                l = t(r, "margin-right"),
                                 o = r.getPropertyValue("box-sizing");
-                            if (o && "border-box" === o) $ = e + i + l;
+                            if (o && "border-box" === o) L = e + n + l;
                             else {
                                 const {
-                                    clientWidth: s,
+                                    clientWidth: t,
                                     offsetWidth: r
-                                } = n[0];
-                                $ = e + t + a + i + l + (r - s)
+                                } = i;
+                                L = e + s + a + n + l + (r - t)
                             }
                         }
-                        l && (n[0].style.transform = l), o && (n[0].style.webkitTransform = o), a.roundLengths && ($ = Math.floor($))
-                    } else $ = (r - (a.slidesPerView - 1) * x) / a.slidesPerView, a.roundLengths && ($ = Math.floor($)), c[i] && (c[i].style[t("width")] = `${$}px`);
-                    c[i] && (c[i].swiperSlideSize = $), m.push($), a.centeredSlides ? (y = y + $ / 2 + E / 2 + x, 0 === E && 0 !== i && (y = y - r / 2 - x), 0 === i && (y = y - r / 2 - x), Math.abs(y) < .001 && (y = 0), a.roundLengths && (y = Math.floor(y)), C % a.slidesPerGroup == 0 && u.push(y), h.push(y)) : (a.roundLengths && (y = Math.floor(y)), (C - Math.min(e.params.slidesPerGroupSkip, C)) % e.params.slidesPerGroup == 0 && u.push(y), h.push(y), y = y + $ + x), e.virtualSize += $ + x, E = $, C += 1
+                        n && (i.style.transform = n), l && (i.style.webkitTransform = l), s.roundLengths && (L = Math.floor(L))
+                    } else L = (r - (s.slidesPerView - 1) * x) / s.slidesPerView, s.roundLengths && (L = Math.floor(L)), c[a] && (c[a].style[e.getDirectionLabel("width")] = `${L}px`);
+                    c[a] && (c[a].swiperSlideSize = L), g.push(L), s.centeredSlides ? (T = T + L / 2 + M / 2 + x, 0 === M && 0 !== a && (T = T - r / 2 - x), 0 === a && (T = T - r / 2 - x), Math.abs(T) < .001 && (T = 0), s.roundLengths && (T = Math.floor(T)), C % s.slidesPerGroup == 0 && m.push(T), h.push(T)) : (s.roundLengths && (T = Math.floor(T)), (C - Math.min(e.params.slidesPerGroupSkip, C)) % e.params.slidesPerGroup == 0 && m.push(T), h.push(T), T = T + L + x), e.virtualSize += L + x, M = L, C += 1
                 }
             }
-            if (e.virtualSize = Math.max(e.virtualSize, r) + g, n && l && ("slide" === a.effect || "coverflow" === a.effect) && i.css({
-                    width: `${e.virtualSize+a.spaceBetween}px`
-                }), a.setWrapperSize && i.css({
-                    [t("width")]: `${e.virtualSize+a.spaceBetween}px`
-                }), T && e.grid.updateWrapperSize($, u, t), !a.centeredSlides) {
+            if (e.virtualSize = Math.max(e.virtualSize, r) + w, n && l && ("slide" === s.effect || "coverflow" === s.effect) && (a.style.width = `${e.virtualSize+x}px`), s.setWrapperSize && (a.style[e.getDirectionLabel("width")] = `${e.virtualSize+x}px`), P && e.grid.updateWrapperSize(L, m), !s.centeredSlides) {
                 const t = [];
-                for (let s = 0; s < u.length; s += 1) {
-                    let i = u[s];
-                    a.roundLengths && (i = Math.floor(i)), u[s] <= e.virtualSize - r && t.push(i)
-                }
-                u = t, Math.floor(e.virtualSize - r) - Math.floor(u[u.length - 1]) > 1 && u.push(e.virtualSize - r)
-            }
-            if (0 === u.length && (u = [0]), 0 !== a.spaceBetween) {
-                const s = e.isHorizontal() && n ? "marginLeft" : t("marginRight");
-                c.filter(((e, t) => !a.cssMode || t !== c.length - 1)).css({
-                    [s]: `${x}px`
-                })
+                for (let a = 0; a < m.length; a += 1) {
+                    let i = m[a];
+                    s.roundLengths && (i = Math.floor(i)), m[a] <= e.virtualSize - r && t.push(i)
+                }
+                m = t, Math.floor(e.virtualSize - r) - Math.floor(m[m.length - 1]) > 1 && m.push(e.virtualSize - r)
+            }
+            if (o && s.loop) {
+                const t = g[0] + x;
+                if (s.slidesPerGroup > 1) {
+                    const a = Math.ceil((e.virtual.slidesBefore + e.virtual.slidesAfter) / s.slidesPerGroup),
+                        i = t * s.slidesPerGroup;
+                    for (let e = 0; e < a; e += 1) m.push(m[m.length - 1] + i)
+                }
+                for (let a = 0; a < e.virtual.slidesBefore + e.virtual.slidesAfter; a += 1) 1 === s.slidesPerGroup && m.push(m[m.length - 1] + t), h.push(h[h.length - 1] + t), e.virtualSize += t
+            }
+            if (0 === m.length && (m = [0]), 0 !== x) {
+                const t = e.isHorizontal() && n ? "marginLeft" : e.getDirectionLabel("marginRight");
+                c.filter(((e, t) => !(s.cssMode && !s.loop) || t !== c.length - 1)).forEach((e => {
+                    e.style[t] = `${x}px`
+                }))
             }
-            if (a.centeredSlides && a.centeredSlidesBounds) {
+            if (s.centeredSlides && s.centeredSlidesBounds) {
                 let e = 0;
-                m.forEach((t => {
-                    e += t + (a.spaceBetween ? a.spaceBetween : 0)
-                })), e -= a.spaceBetween;
+                g.forEach((t => {
+                    e += t + (x || 0)
+                })), e -= x;
                 const t = e - r;
-                u = u.map((e => e < 0 ? -f : e > t ? t + g : e))
+                m = m.map((e => e <= 0 ? -v : e > t ? t + w : e))
             }
-            if (a.centerInsufficientSlides) {
+            if (s.centerInsufficientSlides) {
                 let e = 0;
-                if (m.forEach((t => {
-                        e += t + (a.spaceBetween ? a.spaceBetween : 0)
-                    })), e -= a.spaceBetween, e < r) {
+                if (g.forEach((t => {
+                        e += t + (x || 0)
+                    })), e -= x, e < r) {
                     const t = (r - e) / 2;
-                    u.forEach(((e, s) => {
-                        u[s] = e - t
+                    m.forEach(((e, s) => {
+                        m[s] = e - t
                     })), h.forEach(((e, s) => {
                         h[s] = e + t
                     }))
                 }
             }
             if (Object.assign(e, {
                     slides: c,
-                    snapGrid: u,
+                    snapGrid: m,
                     slidesGrid: h,
-                    slidesSizesGrid: m
-                }), a.centeredSlides && a.cssMode && !a.centeredSlidesBounds) {
-                v(e.wrapperEl, "--swiper-centered-offset-before", -u[0] + "px"), v(e.wrapperEl, "--swiper-centered-offset-after", e.size / 2 - m[m.length - 1] / 2 + "px");
+                    slidesSizesGrid: g
+                }), s.centeredSlides && s.cssMode && !s.centeredSlidesBounds) {
+                u(a, "--swiper-centered-offset-before", -m[0] + "px"), u(a, "--swiper-centered-offset-after", e.size / 2 - g[g.length - 1] / 2 + "px");
                 const t = -e.snapGrid[0],
                     s = -e.slidesGrid[0];
                 e.snapGrid = e.snapGrid.map((e => e + t)), e.slidesGrid = e.slidesGrid.map((e => e + s))
             }
-            if (p !== d && e.emit("slidesLengthChange"), u.length !== w && (e.params.watchOverflow && e.checkOverflow(), e.emit("snapGridLengthChange")), h.length !== b && e.emit("slidesGridLengthChange"), a.watchSlidesProgress && e.updateSlidesOffset(), !(o || a.cssMode || "slide" !== a.effect && "fade" !== a.effect)) {
-                const t = `${a.containerModifierClass}backface-hidden`,
-                    s = e.$el.hasClass(t);
-                p <= a.maxBackfaceHiddenSlides ? s || e.$el.addClass(t) : s && e.$el.removeClass(t)
+            if (p !== d && e.emit("slidesLengthChange"), m.length !== y && (e.params.watchOverflow && e.checkOverflow(), e.emit("snapGridLengthChange")), h.length !== E && e.emit("slidesGridLengthChange"), s.watchSlidesProgress && e.updateSlidesOffset(), e.emit("slidesUpdated"), !(o || s.cssMode || "slide" !== s.effect && "fade" !== s.effect)) {
+                const t = `${s.containerModifierClass}backface-hidden`,
+                    a = e.el.classList.contains(t);
+                p <= s.maxBackfaceHiddenSlides ? a || e.el.classList.add(t) : a && e.el.classList.remove(t)
             }
         },
         updateAutoHeight: function(e) {
             const t = this,
                 s = [],
                 a = t.virtual && t.params.virtual.enabled;
             let i, r = 0;
             "number" == typeof e ? t.setTransition(e) : !0 === e && t.setTransition(t.params.speed);
-            const n = e => a ? t.slides.filter((t => parseInt(t.getAttribute("data-swiper-slide-index"), 10) === e))[0] : t.slides.eq(e)[0];
+            const n = e => a ? t.slides[t.getSlideIndexByData(e)] : t.slides[e];
             if ("auto" !== t.params.slidesPerView && t.params.slidesPerView > 1)
-                if (t.params.centeredSlides)(t.visibleSlides || d([])).each((e => {
+                if (t.params.centeredSlides)(t.visibleSlides || []).forEach((e => {
                     s.push(e)
                 }));
                 else
                     for (i = 0; i < Math.ceil(t.params.slidesPerView); i += 1) {
                         const e = t.activeIndex + i;
                         if (e > t.slides.length && !a) break;
                         s.push(n(e))
                     } else s.push(n(t.activeIndex));
             for (i = 0; i < s.length; i += 1)
                 if (void 0 !== s[i]) {
                     const e = s[i].offsetHeight;
                     r = e > r ? e : r
-                }(r || 0 === r) && t.$wrapperEl.css("height", `${r}px`)
+                }(r || 0 === r) && (t.wrapperEl.style.height = `${r}px`)
         },
         updateSlidesOffset: function() {
             const e = this,
-                t = e.slides;
-            for (let s = 0; s < t.length; s += 1) t[s].swiperSlideOffset = e.isHorizontal() ? t[s].offsetLeft : t[s].offsetTop
+                t = e.slides,
+                s = e.isElement ? e.isHorizontal() ? e.wrapperEl.offsetLeft : e.wrapperEl.offsetTop : 0;
+            for (let a = 0; a < t.length; a += 1) t[a].swiperSlideOffset = (e.isHorizontal() ? t[a].offsetLeft : t[a].offsetTop) - s - e.cssOverflowAdjustment()
         },
         updateSlidesProgress: function(e) {
             void 0 === e && (e = this && this.translate || 0);
             const t = this,
                 s = t.params,
                 {
                     slides: a,
                     rtlTranslate: i,
                     snapGrid: r
                 } = t;
             if (0 === a.length) return;
             void 0 === a[0].swiperSlideOffset && t.updateSlidesOffset();
             let n = -e;
-            i && (n = e), a.removeClass(s.slideVisibleClass), t.visibleSlidesIndexes = [], t.visibleSlides = [];
+            i && (n = e), a.forEach((e => {
+                e.classList.remove(s.slideVisibleClass, s.slideFullyVisibleClass)
+            })), t.visibleSlidesIndexes = [], t.visibleSlides = [];
+            let l = s.spaceBetween;
+            "string" == typeof l && l.indexOf("%") >= 0 ? l = parseFloat(l.replace("%", "")) / 100 * t.size : "string" == typeof l && (l = parseFloat(l));
             for (let e = 0; e < a.length; e += 1) {
-                const l = a[e];
-                let o = l.swiperSlideOffset;
-                s.cssMode && s.centeredSlides && (o -= a[0].swiperSlideOffset);
-                const d = (n + (s.centeredSlides ? t.minTranslate() : 0) - o) / (l.swiperSlideSize + s.spaceBetween),
-                    c = (n - r[0] + (s.centeredSlides ? t.minTranslate() : 0) - o) / (l.swiperSlideSize + s.spaceBetween),
-                    p = -(n - o),
-                    u = p + t.slidesSizesGrid[e];
-                (p >= 0 && p < t.size - 1 || u > 1 && u <= t.size || p <= 0 && u >= t.size) && (t.visibleSlides.push(l), t.visibleSlidesIndexes.push(e), a.eq(e).addClass(s.slideVisibleClass)), l.progress = i ? -d : d, l.originalProgress = i ? -c : c
+                const o = a[e];
+                let d = o.swiperSlideOffset;
+                s.cssMode && s.centeredSlides && (d -= a[0].swiperSlideOffset);
+                const c = (n + (s.centeredSlides ? t.minTranslate() : 0) - d) / (o.swiperSlideSize + l),
+                    p = (n - r[0] + (s.centeredSlides ? t.minTranslate() : 0) - d) / (o.swiperSlideSize + l),
+                    u = -(n - d),
+                    m = u + t.slidesSizesGrid[e],
+                    h = u >= 0 && u <= t.size - t.slidesSizesGrid[e];
+                (u >= 0 && u < t.size - 1 || m > 1 && m <= t.size || u <= 0 && m >= t.size) && (t.visibleSlides.push(o), t.visibleSlidesIndexes.push(e), a[e].classList.add(s.slideVisibleClass)), h && a[e].classList.add(s.slideFullyVisibleClass), o.progress = i ? -c : c, o.originalProgress = i ? -p : p
             }
-            t.visibleSlides = d(t.visibleSlides)
         },
         updateProgress: function(e) {
             const t = this;
             if (void 0 === e) {
                 const s = t.rtlTranslate ? -1 : 1;
                 e = t && t.translate && t.translate * s || 0
             }
             const s = t.params,
                 a = t.maxTranslate() - t.minTranslate();
             let {
                 progress: i,
                 isBeginning: r,
-                isEnd: n
+                isEnd: n,
+                progressLoop: l
             } = t;
-            const l = r,
-                o = n;
-            0 === a ? (i = 0, r = !0, n = !0) : (i = (e - t.minTranslate()) / a, r = i <= 0, n = i >= 1), Object.assign(t, {
+            const o = r,
+                d = n;
+            if (0 === a) i = 0, r = !0, n = !0;
+            else {
+                i = (e - t.minTranslate()) / a;
+                const s = Math.abs(e - t.minTranslate()) < 1,
+                    l = Math.abs(e - t.maxTranslate()) < 1;
+                r = s || i <= 0, n = l || i >= 1, s && (i = 0), l && (i = 1)
+            }
+            if (s.loop) {
+                const s = t.getSlideIndexByData(0),
+                    a = t.getSlideIndexByData(t.slides.length - 1),
+                    i = t.slidesGrid[s],
+                    r = t.slidesGrid[a],
+                    n = t.slidesGrid[t.slidesGrid.length - 1],
+                    o = Math.abs(e);
+                l = o >= i ? (o - i) / n : (o + n - r) / n, l > 1 && (l -= 1)
+            }
+            Object.assign(t, {
                 progress: i,
+                progressLoop: l,
                 isBeginning: r,
                 isEnd: n
-            }), (s.watchSlidesProgress || s.centeredSlides && s.autoHeight) && t.updateSlidesProgress(e), r && !l && t.emit("reachBeginning toEdge"), n && !o && t.emit("reachEnd toEdge"), (l && !r || o && !n) && t.emit("fromEdge"), t.emit("progress", i)
+            }), (s.watchSlidesProgress || s.centeredSlides && s.autoHeight) && t.updateSlidesProgress(e), r && !o && t.emit("reachBeginning toEdge"), n && !d && t.emit("reachEnd toEdge"), (o && !r || d && !n) && t.emit("fromEdge"), t.emit("progress", i)
         },
         updateSlidesClasses: function() {
             const e = this,
                 {
                     slides: t,
                     params: s,
-                    $wrapperEl: a,
-                    activeIndex: i,
-                    realIndex: r
+                    slidesEl: a,
+                    activeIndex: i
                 } = e,
-                n = e.virtual && s.virtual.enabled;
-            let l;
-            t.removeClass(`${s.slideActiveClass} ${s.slideNextClass} ${s.slidePrevClass} ${s.slideDuplicateActiveClass} ${s.slideDuplicateNextClass} ${s.slideDuplicatePrevClass}`), l = n ? e.$wrapperEl.find(`.${s.slideClass}[data-swiper-slide-index="${i}"]`) : t.eq(i), l.addClass(s.slideActiveClass), s.loop && (l.hasClass(s.slideDuplicateClass) ? a.children(`.${s.slideClass}:not(.${s.slideDuplicateClass})[data-swiper-slide-index="${r}"]`).addClass(s.slideDuplicateActiveClass) : a.children(`.${s.slideClass}.${s.slideDuplicateClass}[data-swiper-slide-index="${r}"]`).addClass(s.slideDuplicateActiveClass));
-            let o = l.nextAll(`.${s.slideClass}`).eq(0).addClass(s.slideNextClass);
-            s.loop && 0 === o.length && (o = t.eq(0), o.addClass(s.slideNextClass));
-            let d = l.prevAll(`.${s.slideClass}`).eq(0).addClass(s.slidePrevClass);
-            s.loop && 0 === d.length && (d = t.eq(-1), d.addClass(s.slidePrevClass)), s.loop && (o.hasClass(s.slideDuplicateClass) ? a.children(`.${s.slideClass}:not(.${s.slideDuplicateClass})[data-swiper-slide-index="${o.attr("data-swiper-slide-index")}"]`).addClass(s.slideDuplicateNextClass) : a.children(`.${s.slideClass}.${s.slideDuplicateClass}[data-swiper-slide-index="${o.attr("data-swiper-slide-index")}"]`).addClass(s.slideDuplicateNextClass), d.hasClass(s.slideDuplicateClass) ? a.children(`.${s.slideClass}:not(.${s.slideDuplicateClass})[data-swiper-slide-index="${d.attr("data-swiper-slide-index")}"]`).addClass(s.slideDuplicatePrevClass) : a.children(`.${s.slideClass}.${s.slideDuplicateClass}[data-swiper-slide-index="${d.attr("data-swiper-slide-index")}"]`).addClass(s.slideDuplicatePrevClass)), e.emitSlidesClasses()
+                r = e.virtual && s.virtual.enabled,
+                n = e.grid && s.grid && s.grid.rows > 1,
+                l = e => f(a, `.${s.slideClass}${e}, swiper-slide${e}`)[0];
+            let o, d, c;
+            if (t.forEach((e => {
+                    e.classList.remove(s.slideActiveClass, s.slideNextClass, s.slidePrevClass)
+                })), r)
+                if (s.loop) {
+                    let t = i - e.virtual.slidesBefore;
+                    t < 0 && (t = e.virtual.slides.length + t), t >= e.virtual.slides.length && (t -= e.virtual.slides.length), o = l(`[data-swiper-slide-index="${t}"]`)
+                } else o = l(`[data-swiper-slide-index="${i}"]`);
+            else n ? (o = t.filter((e => e.column === i))[0], c = t.filter((e => e.column === i + 1))[0], d = t.filter((e => e.column === i - 1))[0]) : o = t[i];
+            o && (o.classList.add(s.slideActiveClass), n ? (c && c.classList.add(s.slideNextClass), d && d.classList.add(s.slidePrevClass)) : (c = function(e, t) {
+                const s = [];
+                for (; e.nextElementSibling;) {
+                    const a = e.nextElementSibling;
+                    t ? a.matches(t) && s.push(a) : s.push(a), e = a
+                }
+                return s
+            }(o, `.${s.slideClass}, swiper-slide`)[0], s.loop && !c && (c = t[0]), c && c.classList.add(s.slideNextClass), d = function(e, t) {
+                const s = [];
+                for (; e.previousElementSibling;) {
+                    const a = e.previousElementSibling;
+                    t ? a.matches(t) && s.push(a) : s.push(a), e = a
+                }
+                return s
+            }(o, `.${s.slideClass}, swiper-slide`)[0], s.loop && 0 === !d && (d = t[t.length - 1]), d && d.classList.add(s.slidePrevClass))), e.emitSlidesClasses()
         },
         updateActiveIndex: function(e) {
             const t = this,
                 s = t.rtlTranslate ? t.translate : -t.translate,
                 {
-                    slidesGrid: a,
-                    snapGrid: i,
-                    params: r,
-                    activeIndex: n,
-                    realIndex: l,
-                    snapIndex: o
+                    snapGrid: a,
+                    params: i,
+                    activeIndex: r,
+                    realIndex: n,
+                    snapIndex: l
                 } = t;
-            let d, c = e;
-            if (void 0 === c) {
-                for (let e = 0; e < a.length; e += 1) void 0 !== a[e + 1] ? s >= a[e] && s < a[e + 1] - (a[e + 1] - a[e]) / 2 ? c = e : s >= a[e] && s < a[e + 1] && (c = e + 1) : s >= a[e] && (c = e);
-                r.normalizeSlideIndex && (c < 0 || void 0 === c) && (c = 0)
-            }
-            if (i.indexOf(s) >= 0) d = i.indexOf(s);
+            let o, d = e;
+            const c = e => {
+                let s = e - t.virtual.slidesBefore;
+                return s < 0 && (s = t.virtual.slides.length + s), s >= t.virtual.slides.length && (s -= t.virtual.slides.length), s
+            };
+            if (void 0 === d && (d = function(e) {
+                    const {
+                        slidesGrid: t,
+                        params: s
+                    } = e, a = e.rtlTranslate ? e.translate : -e.translate;
+                    let i;
+                    for (let e = 0; e < t.length; e += 1) void 0 !== t[e + 1] ? a >= t[e] && a < t[e + 1] - (t[e + 1] - t[e]) / 2 ? i = e : a >= t[e] && a < t[e + 1] && (i = e + 1) : a >= t[e] && (i = e);
+                    return s.normalizeSlideIndex && (i < 0 || void 0 === i) && (i = 0), i
+                }(t)), a.indexOf(s) >= 0) o = a.indexOf(s);
             else {
-                const e = Math.min(r.slidesPerGroupSkip, c);
-                d = e + Math.floor((c - e) / r.slidesPerGroup)
+                const e = Math.min(i.slidesPerGroupSkip, d);
+                o = e + Math.floor((d - e) / i.slidesPerGroup)
             }
-            if (d >= i.length && (d = i.length - 1), c === n) return void(d !== o && (t.snapIndex = d, t.emit("snapIndexChange")));
-            const p = parseInt(t.slides.eq(c).attr("data-swiper-slide-index") || c, 10);
+            if (o >= a.length && (o = a.length - 1), d === r && !t.params.loop) return void(o !== l && (t.snapIndex = o, t.emit("snapIndexChange")));
+            if (d === r && t.params.loop && t.virtual && t.params.virtual.enabled) return void(t.realIndex = c(d));
+            const p = t.grid && i.grid && i.grid.rows > 1;
+            let u;
+            if (t.virtual && i.virtual.enabled && i.loop) u = c(d);
+            else if (p) {
+                const e = t.slides.filter((e => e.column === d))[0];
+                let s = parseInt(e.getAttribute("data-swiper-slide-index"), 10);
+                Number.isNaN(s) && (s = Math.max(t.slides.indexOf(e), 0)), u = Math.floor(s / i.grid.rows)
+            } else if (t.slides[d]) {
+                const e = t.slides[d].getAttribute("data-swiper-slide-index");
+                u = e ? parseInt(e, 10) : d
+            } else u = d;
             Object.assign(t, {
-                snapIndex: d,
-                realIndex: p,
-                previousIndex: n,
-                activeIndex: c
-            }), t.emit("activeIndexChange"), t.emit("snapIndexChange"), l !== p && t.emit("realIndexChange"), (t.initialized || t.params.runCallbacksOnInit) && t.emit("slideChange")
+                previousSnapIndex: l,
+                snapIndex: o,
+                previousRealIndex: n,
+                realIndex: u,
+                previousIndex: r,
+                activeIndex: d
+            }), t.initialized && O(t), t.emit("activeIndexChange"), t.emit("snapIndexChange"), (t.initialized || t.params.runCallbacksOnInit) && (n !== u && t.emit("realIndexChange"), t.emit("slideChange"))
         },
-        updateClickedSlide: function(e) {
-            const t = this,
-                s = t.params,
-                a = d(e).closest(`.${s.slideClass}`)[0];
-            let i, r = !1;
-            if (a)
-                for (let e = 0; e < t.slides.length; e += 1)
-                    if (t.slides[e] === a) {
-                        r = !0, i = e;
+        updateClickedSlide: function(e, t) {
+            const s = this,
+                a = s.params;
+            let i = e.closest(`.${a.slideClass}, swiper-slide`);
+            !i && s.isElement && t && t.length > 1 && t.includes(e) && [...t.slice(t.indexOf(e) + 1, t.length)].forEach((e => {
+                !i && e.matches && e.matches(`.${a.slideClass}, swiper-slide`) && (i = e)
+            }));
+            let r, n = !1;
+            if (i)
+                for (let e = 0; e < s.slides.length; e += 1)
+                    if (s.slides[e] === i) {
+                        n = !0, r = e;
                         break
-                    } if (!a || !r) return t.clickedSlide = void 0, void(t.clickedIndex = void 0);
-            t.clickedSlide = a, t.virtual && t.params.virtual.enabled ? t.clickedIndex = parseInt(d(a).attr("data-swiper-slide-index"), 10) : t.clickedIndex = i, s.slideToClickedSlide && void 0 !== t.clickedIndex && t.clickedIndex !== t.activeIndex && t.slideToClickedSlide()
+                    } if (!i || !n) return s.clickedSlide = void 0, void(s.clickedIndex = void 0);
+            s.clickedSlide = i, s.virtual && s.params.virtual.enabled ? s.clickedIndex = parseInt(i.getAttribute("data-swiper-slide-index"), 10) : s.clickedIndex = r, a.slideToClickedSlide && void 0 !== s.clickedIndex && s.clickedIndex !== s.activeIndex && s.slideToClickedSlide()
         }
     };
-    var M = {
+    var G = {
         getTranslate: function(e) {
             void 0 === e && (e = this.isHorizontal() ? "x" : "y");
             const {
                 params: t,
                 rtlTranslate: s,
                 translate: a,
-                $wrapperEl: i
+                wrapperEl: i
             } = this;
             if (t.virtualTranslate) return s ? -a : a;
             if (t.cssMode) return a;
-            let r = h(i[0], e);
-            return s && (r = -r), r || 0
+            let r = d(i, e);
+            return r += this.cssOverflowAdjustment(), s && (r = -r), r || 0
         },
         setTranslate: function(e, t) {
             const s = this,
                 {
                     rtlTranslate: a,
                     params: i,
-                    $wrapperEl: r,
-                    wrapperEl: n,
-                    progress: l
+                    wrapperEl: r,
+                    progress: n
                 } = s;
-            let o, d = 0,
-                c = 0;
-            s.isHorizontal() ? d = a ? -e : e : c = e, i.roundLengths && (d = Math.floor(d), c = Math.floor(c)), i.cssMode ? n[s.isHorizontal() ? "scrollLeft" : "scrollTop"] = s.isHorizontal() ? -d : -c : i.virtualTranslate || r.transform(`translate3d(${d}px, ${c}px, 0px)`), s.previousTranslate = s.translate, s.translate = s.isHorizontal() ? d : c;
-            const p = s.maxTranslate() - s.minTranslate();
-            o = 0 === p ? 0 : (e - s.minTranslate()) / p, o !== l && s.updateProgress(e), s.emit("setTranslate", s.translate, t)
+            let l, o = 0,
+                d = 0;
+            s.isHorizontal() ? o = a ? -e : e : d = e, i.roundLengths && (o = Math.floor(o), d = Math.floor(d)), s.previousTranslate = s.translate, s.translate = s.isHorizontal() ? o : d, i.cssMode ? r[s.isHorizontal() ? "scrollLeft" : "scrollTop"] = s.isHorizontal() ? -o : -d : i.virtualTranslate || (s.isHorizontal() ? o -= s.cssOverflowAdjustment() : d -= s.cssOverflowAdjustment(), r.style.transform = `translate3d(${o}px, ${d}px, 0px)`);
+            const c = s.maxTranslate() - s.minTranslate();
+            l = 0 === c ? 0 : (e - s.minTranslate()) / c, l !== n && s.updateProgress(e), s.emit("setTranslate", s.translate, t)
         },
         minTranslate: function() {
             return -this.snapGrid[0]
         },
         maxTranslate: function() {
             return -this.snapGrid[this.snapGrid.length - 1]
         },
@@ -1060,33 +806,33 @@
             const o = r.minTranslate(),
                 d = r.maxTranslate();
             let c;
             if (c = a && e > o ? o : a && e < d ? d : e, r.updateProgress(c), n.cssMode) {
                 const e = r.isHorizontal();
                 if (0 === t) l[e ? "scrollLeft" : "scrollTop"] = -c;
                 else {
-                    if (!r.support.smoothScroll) return w({
+                    if (!r.support.smoothScroll) return m({
                         swiper: r,
                         targetPosition: -c,
                         side: e ? "left" : "top"
                     }), !0;
                     l.scrollTo({
                         [e ? "left" : "top"]: -c,
                         behavior: "smooth"
                     })
                 }
                 return !0
             }
             return 0 === t ? (r.setTransition(0), r.setTranslate(c), s && (r.emit("beforeTransitionStart", t, i), r.emit("transitionEnd"))) : (r.setTransition(t), r.setTranslate(c), s && (r.emit("beforeTransitionStart", t, i), r.emit("transitionStart")), r.animating || (r.animating = !0, r.onTranslateToWrapperTransitionEnd || (r.onTranslateToWrapperTransitionEnd = function(e) {
-                r && !r.destroyed && e.target === this && (r.$wrapperEl[0].removeEventListener("transitionend", r.onTranslateToWrapperTransitionEnd), r.$wrapperEl[0].removeEventListener("webkitTransitionEnd", r.onTranslateToWrapperTransitionEnd), r.onTranslateToWrapperTransitionEnd = null, delete r.onTranslateToWrapperTransitionEnd, s && r.emit("transitionEnd"))
-            }), r.$wrapperEl[0].addEventListener("transitionend", r.onTranslateToWrapperTransitionEnd), r.$wrapperEl[0].addEventListener("webkitTransitionEnd", r.onTranslateToWrapperTransitionEnd))), !0
+                r && !r.destroyed && e.target === this && (r.wrapperEl.removeEventListener("transitionend", r.onTranslateToWrapperTransitionEnd), r.onTranslateToWrapperTransitionEnd = null, delete r.onTranslateToWrapperTransitionEnd, s && r.emit("transitionEnd"))
+            }), r.wrapperEl.addEventListener("transitionend", r.onTranslateToWrapperTransitionEnd))), !0
         }
     };
 
-    function P(e) {
+    function N(e) {
         let {
             swiper: t,
             runCallbacks: s,
             direction: a,
             step: i
         } = e;
         const {
@@ -1095,545 +841,707 @@
         } = t;
         let l = a;
         if (l || (l = r > n ? "next" : r < n ? "prev" : "reset"), t.emit(`transition${i}`), s && r !== n) {
             if ("reset" === l) return void t.emit(`slideResetTransition${i}`);
             t.emit(`slideChangeTransition${i}`), "next" === l ? t.emit(`slideNextTransition${i}`) : t.emit(`slidePrevTransition${i}`)
         }
     }
-    var k = {
+    var H = {
         slideTo: function(e, t, s, a, i) {
-            if (void 0 === e && (e = 0), void 0 === t && (t = this.params.speed), void 0 === s && (s = !0), "number" != typeof e && "string" != typeof e) throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof e}] given.`);
-            if ("string" == typeof e) {
-                const t = parseInt(e, 10);
-                if (!isFinite(t)) throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);
-                e = t
-            }
+            void 0 === e && (e = 0), void 0 === t && (t = this.params.speed), void 0 === s && (s = !0), "string" == typeof e && (e = parseInt(e, 10));
             const r = this;
             let n = e;
             n < 0 && (n = 0);
             const {
                 params: l,
                 snapGrid: o,
                 slidesGrid: d,
                 previousIndex: c,
                 activeIndex: p,
                 rtlTranslate: u,
                 wrapperEl: h,
-                enabled: m
+                enabled: f
             } = r;
-            if (r.animating && l.preventInteractionOnTransition || !m && !a && !i) return !1;
-            const f = Math.min(r.params.slidesPerGroupSkip, n);
-            let g = f + Math.floor((n - f) / r.params.slidesPerGroup);
-            g >= o.length && (g = o.length - 1);
-            const v = -o[g];
+            if (r.animating && l.preventInteractionOnTransition || !f && !a && !i || r.destroyed) return !1;
+            const g = Math.min(r.params.slidesPerGroupSkip, n);
+            let v = g + Math.floor((n - g) / r.params.slidesPerGroup);
+            v >= o.length && (v = o.length - 1);
+            const w = -o[v];
             if (l.normalizeSlideIndex)
                 for (let e = 0; e < d.length; e += 1) {
-                    const t = -Math.floor(100 * v),
+                    const t = -Math.floor(100 * w),
                         s = Math.floor(100 * d[e]),
                         a = Math.floor(100 * d[e + 1]);
                     void 0 !== d[e + 1] ? t >= s && t < a - (a - s) / 2 ? n = e : t >= s && t < a && (n = e + 1) : t >= s && (n = e)
                 }
             if (r.initialized && n !== p) {
-                if (!r.allowSlideNext && v < r.translate && v < r.minTranslate()) return !1;
-                if (!r.allowSlidePrev && v > r.translate && v > r.maxTranslate() && (p || 0) !== n) return !1
+                if (!r.allowSlideNext && (u ? w > r.translate && w > r.minTranslate() : w < r.translate && w < r.minTranslate())) return !1;
+                if (!r.allowSlidePrev && w > r.translate && w > r.maxTranslate() && (p || 0) !== n) return !1
             }
             let b;
-            if (n !== (c || 0) && s && r.emit("beforeSlideChangeStart"), r.updateProgress(v), b = n > p ? "next" : n < p ? "prev" : "reset", u && -v === r.translate || !u && v === r.translate) return r.updateActiveIndex(n), l.autoHeight && r.updateAutoHeight(), r.updateSlidesClasses(), "slide" !== l.effect && r.setTranslate(v), "reset" !== b && (r.transitionStart(s, b), r.transitionEnd(s, b)), !1;
+            if (n !== (c || 0) && s && r.emit("beforeSlideChangeStart"), r.updateProgress(w), b = n > p ? "next" : n < p ? "prev" : "reset", u && -w === r.translate || !u && w === r.translate) return r.updateActiveIndex(n), l.autoHeight && r.updateAutoHeight(), r.updateSlidesClasses(), "slide" !== l.effect && r.setTranslate(w), "reset" !== b && (r.transitionStart(s, b), r.transitionEnd(s, b)), !1;
             if (l.cssMode) {
                 const e = r.isHorizontal(),
-                    s = u ? v : -v;
+                    s = u ? w : -w;
                 if (0 === t) {
                     const t = r.virtual && r.params.virtual.enabled;
-                    t && (r.wrapperEl.style.scrollSnapType = "none", r._immediateVirtual = !0), h[e ? "scrollLeft" : "scrollTop"] = s, t && requestAnimationFrame((() => {
-                        r.wrapperEl.style.scrollSnapType = "", r._swiperImmediateVirtual = !1
+                    t && (r.wrapperEl.style.scrollSnapType = "none", r._immediateVirtual = !0), t && !r._cssModeVirtualInitialSet && r.params.initialSlide > 0 ? (r._cssModeVirtualInitialSet = !0, requestAnimationFrame((() => {
+                        h[e ? "scrollLeft" : "scrollTop"] = s
+                    }))) : h[e ? "scrollLeft" : "scrollTop"] = s, t && requestAnimationFrame((() => {
+                        r.wrapperEl.style.scrollSnapType = "", r._immediateVirtual = !1
                     }))
                 } else {
-                    if (!r.support.smoothScroll) return w({
+                    if (!r.support.smoothScroll) return m({
                         swiper: r,
                         targetPosition: s,
                         side: e ? "left" : "top"
                     }), !0;
                     h.scrollTo({
                         [e ? "left" : "top"]: s,
                         behavior: "smooth"
                     })
                 }
                 return !0
             }
-            return r.setTransition(t), r.setTranslate(v), r.updateActiveIndex(n), r.updateSlidesClasses(), r.emit("beforeTransitionStart", t, a), r.transitionStart(s, b), 0 === t ? r.transitionEnd(s, b) : r.animating || (r.animating = !0, r.onSlideToWrapperTransitionEnd || (r.onSlideToWrapperTransitionEnd = function(e) {
-                r && !r.destroyed && e.target === this && (r.$wrapperEl[0].removeEventListener("transitionend", r.onSlideToWrapperTransitionEnd), r.$wrapperEl[0].removeEventListener("webkitTransitionEnd", r.onSlideToWrapperTransitionEnd), r.onSlideToWrapperTransitionEnd = null, delete r.onSlideToWrapperTransitionEnd, r.transitionEnd(s, b))
-            }), r.$wrapperEl[0].addEventListener("transitionend", r.onSlideToWrapperTransitionEnd), r.$wrapperEl[0].addEventListener("webkitTransitionEnd", r.onSlideToWrapperTransitionEnd)), !0
+            return r.setTransition(t), r.setTranslate(w), r.updateActiveIndex(n), r.updateSlidesClasses(), r.emit("beforeTransitionStart", t, a), r.transitionStart(s, b), 0 === t ? r.transitionEnd(s, b) : r.animating || (r.animating = !0, r.onSlideToWrapperTransitionEnd || (r.onSlideToWrapperTransitionEnd = function(e) {
+                r && !r.destroyed && e.target === this && (r.wrapperEl.removeEventListener("transitionend", r.onSlideToWrapperTransitionEnd), r.onSlideToWrapperTransitionEnd = null, delete r.onSlideToWrapperTransitionEnd, r.transitionEnd(s, b))
+            }), r.wrapperEl.addEventListener("transitionend", r.onSlideToWrapperTransitionEnd)), !0
         },
         slideToLoop: function(e, t, s, a) {
             if (void 0 === e && (e = 0), void 0 === t && (t = this.params.speed), void 0 === s && (s = !0), "string" == typeof e) {
-                const t = parseInt(e, 10);
-                if (!isFinite(t)) throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);
-                e = t
+                e = parseInt(e, 10)
             }
             const i = this;
-            let r = e;
-            return i.params.loop && (r += i.loopedSlides), i.slideTo(r, t, s, a)
+            if (i.destroyed) return;
+            const r = i.grid && i.params.grid && i.params.grid.rows > 1;
+            let n = e;
+            if (i.params.loop)
+                if (i.virtual && i.params.virtual.enabled) n += i.virtual.slidesBefore;
+                else {
+                    let e;
+                    if (r) {
+                        const t = n * i.params.grid.rows;
+                        e = i.slides.filter((e => 1 * e.getAttribute("data-swiper-slide-index") === t))[0].column
+                    } else e = i.getSlideIndexByData(n);
+                    const t = r ? Math.ceil(i.slides.length / i.params.grid.rows) : i.slides.length,
+                        {
+                            centeredSlides: s
+                        } = i.params;
+                    let a = i.params.slidesPerView;
+                    "auto" === a ? a = i.slidesPerViewDynamic() : (a = Math.ceil(parseFloat(i.params.slidesPerView, 10)), s && a % 2 == 0 && (a += 1));
+                    let l = t - e < a;
+                    if (s && (l = l || e < Math.ceil(a / 2)), l) {
+                        const a = s ? e < i.activeIndex ? "prev" : "next" : e - i.activeIndex - 1 < i.params.slidesPerView ? "next" : "prev";
+                        i.loopFix({
+                            direction: a,
+                            slideTo: !0,
+                            activeSlideIndex: "next" === a ? e + 1 : e - t + 1,
+                            slideRealIndex: "next" === a ? i.realIndex : void 0
+                        })
+                    }
+                    if (r) {
+                        const e = n * i.params.grid.rows;
+                        n = i.slides.filter((t => 1 * t.getAttribute("data-swiper-slide-index") === e))[0].column
+                    } else n = i.getSlideIndexByData(n)
+                } return requestAnimationFrame((() => {
+                i.slideTo(n, t, s, a)
+            })), i
         },
         slideNext: function(e, t, s) {
             void 0 === e && (e = this.params.speed), void 0 === t && (t = !0);
             const a = this,
                 {
-                    animating: i,
-                    enabled: r,
-                    params: n
+                    enabled: i,
+                    params: r,
+                    animating: n
                 } = a;
-            if (!r) return a;
-            let l = n.slidesPerGroup;
-            "auto" === n.slidesPerView && 1 === n.slidesPerGroup && n.slidesPerGroupAuto && (l = Math.max(a.slidesPerViewDynamic("current", !0), 1));
-            const o = a.activeIndex < n.slidesPerGroupSkip ? 1 : l;
-            if (n.loop) {
-                if (i && n.loopPreventsSlide) return !1;
-                a.loopFix(), a._clientLeft = a.$wrapperEl[0].clientLeft
+            if (!i || a.destroyed) return a;
+            let l = r.slidesPerGroup;
+            "auto" === r.slidesPerView && 1 === r.slidesPerGroup && r.slidesPerGroupAuto && (l = Math.max(a.slidesPerViewDynamic("current", !0), 1));
+            const o = a.activeIndex < r.slidesPerGroupSkip ? 1 : l,
+                d = a.virtual && r.virtual.enabled;
+            if (r.loop) {
+                if (n && !d && r.loopPreventsSliding) return !1;
+                if (a.loopFix({
+                        direction: "next"
+                    }), a._clientLeft = a.wrapperEl.clientLeft, a.activeIndex === a.slides.length - 1 && r.cssMode) return requestAnimationFrame((() => {
+                    a.slideTo(a.activeIndex + o, e, t, s)
+                })), !0
             }
-            return n.rewind && a.isEnd ? a.slideTo(0, e, t, s) : a.slideTo(a.activeIndex + o, e, t, s)
+            return r.rewind && a.isEnd ? a.slideTo(0, e, t, s) : a.slideTo(a.activeIndex + o, e, t, s)
         },
         slidePrev: function(e, t, s) {
             void 0 === e && (e = this.params.speed), void 0 === t && (t = !0);
             const a = this,
                 {
                     params: i,
-                    animating: r,
-                    snapGrid: n,
-                    slidesGrid: l,
-                    rtlTranslate: o,
-                    enabled: d
+                    snapGrid: r,
+                    slidesGrid: n,
+                    rtlTranslate: l,
+                    enabled: o,
+                    animating: d
                 } = a;
-            if (!d) return a;
+            if (!o || a.destroyed) return a;
+            const c = a.virtual && i.virtual.enabled;
             if (i.loop) {
-                if (r && i.loopPreventsSlide) return !1;
-                a.loopFix(), a._clientLeft = a.$wrapperEl[0].clientLeft
+                if (d && !c && i.loopPreventsSliding) return !1;
+                a.loopFix({
+                    direction: "prev"
+                }), a._clientLeft = a.wrapperEl.clientLeft
             }
 
-            function c(e) {
+            function p(e) {
                 return e < 0 ? -Math.floor(Math.abs(e)) : Math.floor(e)
             }
-            const p = c(o ? a.translate : -a.translate),
-                u = n.map((e => c(e)));
-            let h = n[u.indexOf(p) - 1];
+            const u = p(l ? a.translate : -a.translate),
+                m = r.map((e => p(e)));
+            let h = r[m.indexOf(u) - 1];
             if (void 0 === h && i.cssMode) {
                 let e;
-                n.forEach(((t, s) => {
-                    p >= t && (e = s)
-                })), void 0 !== e && (h = n[e > 0 ? e - 1 : e])
+                r.forEach(((t, s) => {
+                    u >= t && (e = s)
+                })), void 0 !== e && (h = r[e > 0 ? e - 1 : e])
             }
-            let m = 0;
-            if (void 0 !== h && (m = l.indexOf(h), m < 0 && (m = a.activeIndex - 1), "auto" === i.slidesPerView && 1 === i.slidesPerGroup && i.slidesPerGroupAuto && (m = m - a.slidesPerViewDynamic("previous", !0) + 1, m = Math.max(m, 0))), i.rewind && a.isBeginning) {
+            let f = 0;
+            if (void 0 !== h && (f = n.indexOf(h), f < 0 && (f = a.activeIndex - 1), "auto" === i.slidesPerView && 1 === i.slidesPerGroup && i.slidesPerGroupAuto && (f = f - a.slidesPerViewDynamic("previous", !0) + 1, f = Math.max(f, 0))), i.rewind && a.isBeginning) {
                 const i = a.params.virtual && a.params.virtual.enabled && a.virtual ? a.virtual.slides.length - 1 : a.slides.length - 1;
                 return a.slideTo(i, e, t, s)
             }
-            return a.slideTo(m, e, t, s)
+            return i.loop && 0 === a.activeIndex && i.cssMode ? (requestAnimationFrame((() => {
+                a.slideTo(f, e, t, s)
+            })), !0) : a.slideTo(f, e, t, s)
         },
         slideReset: function(e, t, s) {
-            return void 0 === e && (e = this.params.speed), void 0 === t && (t = !0), this.slideTo(this.activeIndex, e, t, s)
+            void 0 === e && (e = this.params.speed), void 0 === t && (t = !0);
+            const a = this;
+            if (!a.destroyed) return a.slideTo(a.activeIndex, e, t, s)
         },
         slideToClosest: function(e, t, s, a) {
             void 0 === e && (e = this.params.speed), void 0 === t && (t = !0), void 0 === a && (a = .5);
             const i = this;
+            if (i.destroyed) return;
             let r = i.activeIndex;
             const n = Math.min(i.params.slidesPerGroupSkip, r),
                 l = n + Math.floor((r - n) / i.params.slidesPerGroup),
                 o = i.rtlTranslate ? i.translate : -i.translate;
             if (o >= i.snapGrid[l]) {
                 const e = i.snapGrid[l];
                 o - e > (i.snapGrid[l + 1] - e) * a && (r += i.params.slidesPerGroup)
             } else {
                 const e = i.snapGrid[l - 1];
                 o - e <= (i.snapGrid[l] - e) * a && (r -= i.params.slidesPerGroup)
             }
             return r = Math.max(r, 0), r = Math.min(r, i.slidesGrid.length - 1), i.slideTo(r, e, t, s)
         },
         slideToClickedSlide: function() {
-            const e = this,
-                {
-                    params: t,
-                    $wrapperEl: s
-                } = e,
-                a = "auto" === t.slidesPerView ? e.slidesPerViewDynamic() : t.slidesPerView;
+            const e = this;
+            if (e.destroyed) return;
+            const {
+                params: t,
+                slidesEl: s
+            } = e, a = "auto" === t.slidesPerView ? e.slidesPerViewDynamic() : t.slidesPerView;
             let i, r = e.clickedIndex;
+            const n = e.isElement ? "swiper-slide" : `.${t.slideClass}`;
             if (t.loop) {
                 if (e.animating) return;
-                i = parseInt(d(e.clickedSlide).attr("data-swiper-slide-index"), 10), t.centeredSlides ? r < e.loopedSlides - a / 2 || r > e.slides.length - e.loopedSlides + a / 2 ? (e.loopFix(), r = s.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(), p((() => {
+                i = parseInt(e.clickedSlide.getAttribute("data-swiper-slide-index"), 10), t.centeredSlides ? r < e.loopedSlides - a / 2 || r > e.slides.length - e.loopedSlides + a / 2 ? (e.loopFix(), r = e.getSlideIndex(f(s, `${n}[data-swiper-slide-index="${i}"]`)[0]), l((() => {
                     e.slideTo(r)
-                }))) : e.slideTo(r) : r > e.slides.length - a ? (e.loopFix(), r = s.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(), p((() => {
+                }))) : e.slideTo(r) : r > e.slides.length - a ? (e.loopFix(), r = e.getSlideIndex(f(s, `${n}[data-swiper-slide-index="${i}"]`)[0]), l((() => {
                     e.slideTo(r)
                 }))) : e.slideTo(r)
             } else e.slideTo(r)
         }
     };
-    var z = {
-        loopCreate: function() {
-            const e = this,
-                t = a(),
+    var X = {
+        loopCreate: function(e) {
+            const t = this,
                 {
                     params: s,
-                    $wrapperEl: i
-                } = e,
-                r = i.children().length > 0 ? d(i.children()[0].parentNode) : i;
-            r.children(`.${s.slideClass}.${s.slideDuplicateClass}`).remove();
-            let n = r.children(`.${s.slideClass}`);
-            if (s.loopFillGroupWithBlank) {
-                const e = s.slidesPerGroup - n.length % s.slidesPerGroup;
-                if (e !== s.slidesPerGroup) {
+                    slidesEl: a
+                } = t;
+            if (!s.loop || t.virtual && t.params.virtual.enabled) return;
+            const i = () => {
+                    f(a, `.${s.slideClass}, swiper-slide`).forEach(((e, t) => {
+                        e.setAttribute("data-swiper-slide-index", t)
+                    }))
+                },
+                r = t.grid && s.grid && s.grid.rows > 1,
+                n = s.slidesPerGroup * (r ? s.grid.rows : 1),
+                l = t.slides.length % n != 0,
+                o = r && t.slides.length % s.grid.rows != 0,
+                d = e => {
                     for (let a = 0; a < e; a += 1) {
-                        const e = d(t.createElement("div")).addClass(`${s.slideClass} ${s.slideBlankClass}`);
-                        r.append(e)
+                        const e = t.isElement ? v("swiper-slide", [s.slideBlankClass]) : v("div", [s.slideClass, s.slideBlankClass]);
+                        t.slidesEl.append(e)
                     }
-                    n = r.children(`.${s.slideClass}`)
-                }
-            }
-            "auto" !== s.slidesPerView || s.loopedSlides || (s.loopedSlides = n.length), e.loopedSlides = Math.ceil(parseFloat(s.loopedSlides || s.slidesPerView, 10)), e.loopedSlides += s.loopAdditionalSlides, e.loopedSlides > n.length && e.params.loopedSlidesLimit && (e.loopedSlides = n.length);
-            const l = [],
-                o = [];
-            n.each(((e, t) => {
-                d(e).attr("data-swiper-slide-index", t)
-            }));
-            for (let t = 0; t < e.loopedSlides; t += 1) {
-                const e = t - Math.floor(t / n.length) * n.length;
-                o.push(n.eq(e)[0]), l.unshift(n.eq(n.length - e - 1)[0])
-            }
-            for (let e = 0; e < o.length; e += 1) r.append(d(o[e].cloneNode(!0)).addClass(s.slideDuplicateClass));
-            for (let e = l.length - 1; e >= 0; e -= 1) r.prepend(d(l[e].cloneNode(!0)).addClass(s.slideDuplicateClass))
+                };
+            if (l) {
+                if (s.loopAddBlankSlides) {
+                    d(n - t.slides.length % n), t.recalcSlides(), t.updateSlides()
+                } else g("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");
+                i()
+            } else if (o) {
+                if (s.loopAddBlankSlides) {
+                    d(s.grid.rows - t.slides.length % s.grid.rows), t.recalcSlides(), t.updateSlides()
+                } else g("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");
+                i()
+            } else i();
+            t.loopFix({
+                slideRealIndex: e,
+                direction: s.centeredSlides ? void 0 : "next"
+            })
         },
-        loopFix: function() {
-            const e = this;
-            e.emit("beforeLoopFix");
+        loopFix: function(e) {
+            let {
+                slideRealIndex: t,
+                slideTo: s = !0,
+                direction: a,
+                setTranslate: i,
+                activeSlideIndex: r,
+                byController: n,
+                byMousewheel: l
+            } = void 0 === e ? {} : e;
+            const o = this;
+            if (!o.params.loop) return;
+            o.emit("beforeLoopFix");
             const {
-                activeIndex: t,
-                slides: s,
-                loopedSlides: a,
-                allowSlidePrev: i,
-                allowSlideNext: r,
-                snapGrid: n,
-                rtlTranslate: l
-            } = e;
-            let o;
-            e.allowSlidePrev = !0, e.allowSlideNext = !0;
-            const d = -n[t] - e.getTranslate();
-            if (t < a) {
-                o = s.length - 3 * a + t, o += a;
-                e.slideTo(o, 0, !1, !0) && 0 !== d && e.setTranslate((l ? -e.translate : e.translate) - d)
-            } else if (t >= s.length - a) {
-                o = -s.length + t + a, o += a;
-                e.slideTo(o, 0, !1, !0) && 0 !== d && e.setTranslate((l ? -e.translate : e.translate) - d)
+                slides: d,
+                allowSlidePrev: c,
+                allowSlideNext: p,
+                slidesEl: u,
+                params: m
+            } = o, {
+                centeredSlides: h
+            } = m;
+            if (o.allowSlidePrev = !0, o.allowSlideNext = !0, o.virtual && m.virtual.enabled) return s && (m.centeredSlides || 0 !== o.snapIndex ? m.centeredSlides && o.snapIndex < m.slidesPerView ? o.slideTo(o.virtual.slides.length + o.snapIndex, 0, !1, !0) : o.snapIndex === o.snapGrid.length - 1 && o.slideTo(o.virtual.slidesBefore, 0, !1, !0) : o.slideTo(o.virtual.slides.length, 0, !1, !0)), o.allowSlidePrev = c, o.allowSlideNext = p, void o.emit("loopFix");
+            let f = m.slidesPerView;
+            "auto" === f ? f = o.slidesPerViewDynamic() : (f = Math.ceil(parseFloat(m.slidesPerView, 10)), h && f % 2 == 0 && (f += 1));
+            const v = m.slidesPerGroupAuto ? f : m.slidesPerGroup;
+            let w = v;
+            w % v != 0 && (w += v - w % v), w += m.loopAdditionalSlides, o.loopedSlides = w;
+            const b = o.grid && m.grid && m.grid.rows > 1;
+            d.length < f + w ? g("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters") : b && "row" === m.grid.fill && g("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");
+            const y = [],
+                E = [];
+            let x = o.activeIndex;
+            void 0 === r ? r = o.getSlideIndex(d.filter((e => e.classList.contains(m.slideActiveClass)))[0]) : x = r;
+            const S = "next" === a || !a,
+                T = "prev" === a || !a;
+            let M = 0,
+                C = 0;
+            const P = b ? Math.ceil(d.length / m.grid.rows) : d.length,
+                L = (b ? d[r].column : r) + (h && void 0 === i ? -f / 2 + .5 : 0);
+            if (L < w) {
+                M = Math.max(w - L, v);
+                for (let e = 0; e < w - L; e += 1) {
+                    const t = e - Math.floor(e / P) * P;
+                    if (b) {
+                        const e = P - t - 1;
+                        for (let t = d.length - 1; t >= 0; t -= 1) d[t].column === e && y.push(t)
+                    } else y.push(P - t - 1)
+                }
+            } else if (L + f > P - w) {
+                C = Math.max(L - (P - 2 * w), v);
+                for (let e = 0; e < C; e += 1) {
+                    const t = e - Math.floor(e / P) * P;
+                    b ? d.forEach(((e, s) => {
+                        e.column === t && E.push(s)
+                    })) : E.push(t)
+                }
+            }
+            if (o.__preventObserver__ = !0, requestAnimationFrame((() => {
+                    o.__preventObserver__ = !1
+                })), T && y.forEach((e => {
+                    d[e].swiperLoopMoveDOM = !0, u.prepend(d[e]), d[e].swiperLoopMoveDOM = !1
+                })), S && E.forEach((e => {
+                    d[e].swiperLoopMoveDOM = !0, u.append(d[e]), d[e].swiperLoopMoveDOM = !1
+                })), o.recalcSlides(), "auto" === m.slidesPerView ? o.updateSlides() : b && (y.length > 0 && T || E.length > 0 && S) && o.slides.forEach(((e, t) => {
+                    o.grid.updateSlide(t, e, o.slides)
+                })), m.watchSlidesProgress && o.updateSlidesOffset(), s)
+                if (y.length > 0 && T) {
+                    if (void 0 === t) {
+                        const e = o.slidesGrid[x],
+                            t = o.slidesGrid[x + M] - e;
+                        l ? o.setTranslate(o.translate - t) : (o.slideTo(x + Math.ceil(M), 0, !1, !0), i && (o.touchEventsData.startTranslate = o.touchEventsData.startTranslate - t, o.touchEventsData.currentTranslate = o.touchEventsData.currentTranslate - t))
+                    } else if (i) {
+                        const e = b ? y.length / m.grid.rows : y.length;
+                        o.slideTo(o.activeIndex + e, 0, !1, !0), o.touchEventsData.currentTranslate = o.translate
+                    }
+                } else if (E.length > 0 && S)
+                if (void 0 === t) {
+                    const e = o.slidesGrid[x],
+                        t = o.slidesGrid[x - C] - e;
+                    l ? o.setTranslate(o.translate - t) : (o.slideTo(x - C, 0, !1, !0), i && (o.touchEventsData.startTranslate = o.touchEventsData.startTranslate - t, o.touchEventsData.currentTranslate = o.touchEventsData.currentTranslate - t))
+                } else {
+                    const e = b ? E.length / m.grid.rows : E.length;
+                    o.slideTo(o.activeIndex - e, 0, !1, !0)
+                } if (o.allowSlidePrev = c, o.allowSlideNext = p, o.controller && o.controller.control && !n) {
+                const e = {
+                    slideRealIndex: t,
+                    direction: a,
+                    setTranslate: i,
+                    activeSlideIndex: r,
+                    byController: !0
+                };
+                Array.isArray(o.controller.control) ? o.controller.control.forEach((t => {
+                    !t.destroyed && t.params.loop && t.loopFix({
+                        ...e,
+                        slideTo: t.params.slidesPerView === m.slidesPerView && s
+                    })
+                })) : o.controller.control instanceof o.constructor && o.controller.control.params.loop && o.controller.control.loopFix({
+                    ...e,
+                    slideTo: o.controller.control.params.slidesPerView === m.slidesPerView && s
+                })
             }
-            e.allowSlidePrev = i, e.allowSlideNext = r, e.emit("loopFix")
+            o.emit("loopFix")
         },
         loopDestroy: function() {
-            const {
-                $wrapperEl: e,
-                params: t,
-                slides: s
-            } = this;
-            e.children(`.${t.slideClass}.${t.slideDuplicateClass},.${t.slideClass}.${t.slideBlankClass}`).remove(), s.removeAttr("data-swiper-slide-index")
+            const e = this,
+                {
+                    params: t,
+                    slidesEl: s
+                } = e;
+            if (!t.loop || e.virtual && e.params.virtual.enabled) return;
+            e.recalcSlides();
+            const a = [];
+            e.slides.forEach((e => {
+                const t = void 0 === e.swiperSlideIndex ? 1 * e.getAttribute("data-swiper-slide-index") : e.swiperSlideIndex;
+                a[t] = e
+            })), e.slides.forEach((e => {
+                e.removeAttribute("data-swiper-slide-index")
+            })), a.forEach((e => {
+                s.append(e)
+            })), e.recalcSlides(), e.slideTo(e.realIndex, 0)
         }
     };
 
-    function L(e) {
-        const t = this,
-            s = a(),
-            i = r(),
-            n = t.touchEventsData,
+    function Y(e, t, s) {
+        const a = r(),
             {
-                params: l,
-                touches: o,
-                enabled: c
-            } = t;
+                params: i
+            } = e,
+            n = i.edgeSwipeDetection,
+            l = i.edgeSwipeThreshold;
+        return !n || !(s <= l || s >= a.innerWidth - l) || "prevent" === n && (t.preventDefault(), !0)
+    }
+
+    function B(e) {
+        const t = this,
+            s = a();
+        let i = e;
+        i.originalEvent && (i = i.originalEvent);
+        const n = t.touchEventsData;
+        if ("pointerdown" === i.type) {
+            if (null !== n.pointerId && n.pointerId !== i.pointerId) return;
+            n.pointerId = i.pointerId
+        } else "touchstart" === i.type && 1 === i.targetTouches.length && (n.touchId = i.targetTouches[0].identifier);
+        if ("touchstart" === i.type) return void Y(t, i, i.targetTouches[0].pageX);
+        const {
+            params: l,
+            touches: d,
+            enabled: c
+        } = t;
         if (!c) return;
+        if (!l.simulateTouch && "mouse" === i.pointerType) return;
         if (t.animating && l.preventInteractionOnTransition) return;
         !t.animating && l.cssMode && l.loop && t.loopFix();
-        let p = e;
-        p.originalEvent && (p = p.originalEvent);
-        let h = d(p.target);
-        if ("wrapper" === l.touchEventsTarget && !h.closest(t.wrapperEl).length) return;
-        if (n.isTouchEvent = "touchstart" === p.type, !n.isTouchEvent && "which" in p && 3 === p.which) return;
-        if (!n.isTouchEvent && "button" in p && p.button > 0) return;
+        let p = i.target;
+        if ("wrapper" === l.touchEventsTarget && !t.wrapperEl.contains(p)) return;
+        if ("which" in i && 3 === i.which) return;
+        if ("button" in i && i.button > 0) return;
         if (n.isTouched && n.isMoved) return;
-        const m = !!l.noSwipingClass && "" !== l.noSwipingClass,
-            f = e.composedPath ? e.composedPath() : e.path;
-        m && p.target && p.target.shadowRoot && f && (h = d(f[0]));
-        const g = l.noSwipingSelector ? l.noSwipingSelector : `.${l.noSwipingClass}`,
-            v = !(!p.target || !p.target.shadowRoot);
-        if (l.noSwiping && (v ? function(e, t) {
+        const u = !!l.noSwipingClass && "" !== l.noSwipingClass,
+            m = i.composedPath ? i.composedPath() : i.path;
+        u && i.target && i.target.shadowRoot && m && (p = m[0]);
+        const h = l.noSwipingSelector ? l.noSwipingSelector : `.${l.noSwipingClass}`,
+            f = !(!i.target || !i.target.shadowRoot);
+        if (l.noSwiping && (f ? function(e, t) {
                 return void 0 === t && (t = this),
                     function t(s) {
                         if (!s || s === a() || s === r()) return null;
                         s.assignedSlot && (s = s.assignedSlot);
                         const i = s.closest(e);
                         return i || s.getRootNode ? i || t(s.getRootNode().host) : null
                     }(t)
-            }(g, h[0]) : h.closest(g)[0])) return void(t.allowClick = !0);
-        if (l.swipeHandler && !h.closest(l.swipeHandler)[0]) return;
-        o.currentX = "touchstart" === p.type ? p.targetTouches[0].pageX : p.pageX, o.currentY = "touchstart" === p.type ? p.targetTouches[0].pageY : p.pageY;
-        const w = o.currentX,
-            b = o.currentY,
-            x = l.edgeSwipeDetection || l.iOSEdgeSwipeDetection,
-            y = l.edgeSwipeThreshold || l.iOSEdgeSwipeThreshold;
-        if (x && (w <= y || w >= i.innerWidth - y)) {
-            if ("prevent" !== x) return;
-            e.preventDefault()
-        }
-        if (Object.assign(n, {
-                isTouched: !0,
-                isMoved: !1,
-                allowTouchCallbacks: !0,
-                isScrolling: void 0,
-                startMoving: void 0
-            }), o.startX = w, o.startY = b, n.touchStartTime = u(), t.allowClick = !0, t.updateSize(), t.swipeDirection = void 0, l.threshold > 0 && (n.allowThresholdMove = !1), "touchstart" !== p.type) {
-            let e = !0;
-            h.is(n.focusableElements) && (e = !1, "SELECT" === h[0].nodeName && (n.isTouched = !1)), s.activeElement && d(s.activeElement).is(n.focusableElements) && s.activeElement !== h[0] && s.activeElement.blur();
-            const a = e && t.allowTouchMove && l.touchStartPreventDefault;
-            !l.touchStartForcePreventDefault && !a || h[0].isContentEditable || p.preventDefault()
-        }
-        t.params.freeMode && t.params.freeMode.enabled && t.freeMode && t.animating && !l.cssMode && t.freeMode.onTouchStart(), t.emit("touchStart", p)
+            }(h, p) : p.closest(h))) return void(t.allowClick = !0);
+        if (l.swipeHandler && !p.closest(l.swipeHandler)) return;
+        d.currentX = i.pageX, d.currentY = i.pageY;
+        const g = d.currentX,
+            v = d.currentY;
+        if (!Y(t, i, g)) return;
+        Object.assign(n, {
+            isTouched: !0,
+            isMoved: !1,
+            allowTouchCallbacks: !0,
+            isScrolling: void 0,
+            startMoving: void 0
+        }), d.startX = g, d.startY = v, n.touchStartTime = o(), t.allowClick = !0, t.updateSize(), t.swipeDirection = void 0, l.threshold > 0 && (n.allowThresholdMove = !1);
+        let w = !0;
+        p.matches(n.focusableElements) && (w = !1, "SELECT" === p.nodeName && (n.isTouched = !1)), s.activeElement && s.activeElement.matches(n.focusableElements) && s.activeElement !== p && s.activeElement.blur();
+        const b = w && t.allowTouchMove && l.touchStartPreventDefault;
+        !l.touchStartForcePreventDefault && !b || p.isContentEditable || i.preventDefault(), l.freeMode && l.freeMode.enabled && t.freeMode && t.animating && !l.cssMode && t.freeMode.onTouchStart(), t.emit("touchStart", i)
     }
 
-    function O(e) {
+    function R(e) {
         const t = a(),
             s = this,
             i = s.touchEventsData,
             {
                 params: r,
                 touches: n,
                 rtlTranslate: l,
-                enabled: o
+                enabled: d
             } = s;
-        if (!o) return;
-        let c = e;
-        if (c.originalEvent && (c = c.originalEvent), !i.isTouched) return void(i.startMoving && i.isScrolling && s.emit("touchMoveOpposite", c));
-        if (i.isTouchEvent && "touchmove" !== c.type) return;
-        const p = "touchmove" === c.type && c.targetTouches && (c.targetTouches[0] || c.changedTouches[0]),
-            h = "touchmove" === c.type ? p.pageX : c.pageX,
-            m = "touchmove" === c.type ? p.pageY : c.pageY;
-        if (c.preventedByNestedSwiper) return n.startX = h, void(n.startY = m);
-        if (!s.allowTouchMove) return d(c.target).is(i.focusableElements) || (s.allowClick = !1), void(i.isTouched && (Object.assign(n, {
-            startX: h,
+        if (!d) return;
+        if (!r.simulateTouch && "mouse" === e.pointerType) return;
+        let c, p = e;
+        if (p.originalEvent && (p = p.originalEvent), "pointermove" === p.type) {
+            if (null !== i.touchId) return;
+            if (p.pointerId !== i.pointerId) return
+        }
+        if ("touchmove" === p.type) {
+            if (c = [...p.changedTouches].filter((e => e.identifier === i.touchId))[0], !c || c.identifier !== i.touchId) return
+        } else c = p;
+        if (!i.isTouched) return void(i.startMoving && i.isScrolling && s.emit("touchMoveOpposite", p));
+        const u = c.pageX,
+            m = c.pageY;
+        if (p.preventedByNestedSwiper) return n.startX = u, void(n.startY = m);
+        if (!s.allowTouchMove) return p.target.matches(i.focusableElements) || (s.allowClick = !1), void(i.isTouched && (Object.assign(n, {
+            startX: u,
             startY: m,
-            currentX: h,
+            currentX: u,
             currentY: m
-        }), i.touchStartTime = u()));
-        if (i.isTouchEvent && r.touchReleaseOnEdges && !r.loop)
+        }), i.touchStartTime = o()));
+        if (r.touchReleaseOnEdges && !r.loop)
             if (s.isVertical()) {
                 if (m < n.startY && s.translate <= s.maxTranslate() || m > n.startY && s.translate >= s.minTranslate()) return i.isTouched = !1, void(i.isMoved = !1)
-            } else if (h < n.startX && s.translate <= s.maxTranslate() || h > n.startX && s.translate >= s.minTranslate()) return;
-        if (i.isTouchEvent && t.activeElement && c.target === t.activeElement && d(c.target).is(i.focusableElements)) return i.isMoved = !0, void(s.allowClick = !1);
-        if (i.allowTouchCallbacks && s.emit("touchMove", c), c.targetTouches && c.targetTouches.length > 1) return;
-        n.currentX = h, n.currentY = m;
-        const f = n.currentX - n.startX,
-            g = n.currentY - n.startY;
-        if (s.params.threshold && Math.sqrt(f ** 2 + g ** 2) < s.params.threshold) return;
+            } else if (u < n.startX && s.translate <= s.maxTranslate() || u > n.startX && s.translate >= s.minTranslate()) return;
+        if (t.activeElement && p.target === t.activeElement && p.target.matches(i.focusableElements)) return i.isMoved = !0, void(s.allowClick = !1);
+        i.allowTouchCallbacks && s.emit("touchMove", p), n.previousX = n.currentX, n.previousY = n.currentY, n.currentX = u, n.currentY = m;
+        const h = n.currentX - n.startX,
+            f = n.currentY - n.startY;
+        if (s.params.threshold && Math.sqrt(h ** 2 + f ** 2) < s.params.threshold) return;
         if (void 0 === i.isScrolling) {
             let e;
-            s.isHorizontal() && n.currentY === n.startY || s.isVertical() && n.currentX === n.startX ? i.isScrolling = !1 : f * f + g * g >= 25 && (e = 180 * Math.atan2(Math.abs(g), Math.abs(f)) / Math.PI, i.isScrolling = s.isHorizontal() ? e > r.touchAngle : 90 - e > r.touchAngle)
+            s.isHorizontal() && n.currentY === n.startY || s.isVertical() && n.currentX === n.startX ? i.isScrolling = !1 : h * h + f * f >= 25 && (e = 180 * Math.atan2(Math.abs(f), Math.abs(h)) / Math.PI, i.isScrolling = s.isHorizontal() ? e > r.touchAngle : 90 - e > r.touchAngle)
         }
-        if (i.isScrolling && s.emit("touchMoveOpposite", c), void 0 === i.startMoving && (n.currentX === n.startX && n.currentY === n.startY || (i.startMoving = !0)), i.isScrolling) return void(i.isTouched = !1);
+        if (i.isScrolling && s.emit("touchMoveOpposite", p), void 0 === i.startMoving && (n.currentX === n.startX && n.currentY === n.startY || (i.startMoving = !0)), i.isScrolling) return void(i.isTouched = !1);
         if (!i.startMoving) return;
-        s.allowClick = !1, !r.cssMode && c.cancelable && c.preventDefault(), r.touchMoveStopPropagation && !r.nested && c.stopPropagation(), i.isMoved || (r.loop && !r.cssMode && s.loopFix(), i.startTranslate = s.getTranslate(), s.setTransition(0), s.animating && s.$wrapperEl.trigger("webkitTransitionEnd transitionend"), i.allowMomentumBounce = !1, !r.grabCursor || !0 !== s.allowSlideNext && !0 !== s.allowSlidePrev || s.setGrabCursor(!0), s.emit("sliderFirstMove", c)), s.emit("sliderMove", c), i.isMoved = !0;
-        let v = s.isHorizontal() ? f : g;
-        n.diff = v, v *= r.touchRatio, l && (v = -v), s.swipeDirection = v > 0 ? "prev" : "next", i.currentTranslate = v + i.startTranslate;
-        let w = !0,
-            b = r.resistanceRatio;
-        if (r.touchReleaseOnEdges && (b = 0), v > 0 && i.currentTranslate > s.minTranslate() ? (w = !1, r.resistance && (i.currentTranslate = s.minTranslate() - 1 + (-s.minTranslate() + i.startTranslate + v) ** b)) : v < 0 && i.currentTranslate < s.maxTranslate() && (w = !1, r.resistance && (i.currentTranslate = s.maxTranslate() + 1 - (s.maxTranslate() - i.startTranslate - v) ** b)), w && (c.preventedByNestedSwiper = !0), !s.allowSlideNext && "next" === s.swipeDirection && i.currentTranslate < i.startTranslate && (i.currentTranslate = i.startTranslate), !s.allowSlidePrev && "prev" === s.swipeDirection && i.currentTranslate > i.startTranslate && (i.currentTranslate = i.startTranslate), s.allowSlidePrev || s.allowSlideNext || (i.currentTranslate = i.startTranslate), r.threshold > 0) {
-            if (!(Math.abs(v) > r.threshold || i.allowThresholdMove)) return void(i.currentTranslate = i.startTranslate);
+        s.allowClick = !1, !r.cssMode && p.cancelable && p.preventDefault(), r.touchMoveStopPropagation && !r.nested && p.stopPropagation();
+        let g = s.isHorizontal() ? h : f,
+            v = s.isHorizontal() ? n.currentX - n.previousX : n.currentY - n.previousY;
+        r.oneWayMovement && (g = Math.abs(g) * (l ? 1 : -1), v = Math.abs(v) * (l ? 1 : -1)), n.diff = g, g *= r.touchRatio, l && (g = -g, v = -v);
+        const w = s.touchesDirection;
+        s.swipeDirection = g > 0 ? "prev" : "next", s.touchesDirection = v > 0 ? "prev" : "next";
+        const b = s.params.loop && !r.cssMode,
+            y = "next" === s.touchesDirection && s.allowSlideNext || "prev" === s.touchesDirection && s.allowSlidePrev;
+        if (!i.isMoved) {
+            if (b && y && s.loopFix({
+                    direction: s.swipeDirection
+                }), i.startTranslate = s.getTranslate(), s.setTransition(0), s.animating) {
+                const e = new window.CustomEvent("transitionend", {
+                    bubbles: !0,
+                    cancelable: !0
+                });
+                s.wrapperEl.dispatchEvent(e)
+            }
+            i.allowMomentumBounce = !1, !r.grabCursor || !0 !== s.allowSlideNext && !0 !== s.allowSlidePrev || s.setGrabCursor(!0), s.emit("sliderFirstMove", p)
+        }
+        if ((new Date).getTime(), i.isMoved && i.allowThresholdMove && w !== s.touchesDirection && b && y && Math.abs(g) >= 1) return Object.assign(n, {
+            startX: u,
+            startY: m,
+            currentX: u,
+            currentY: m,
+            startTranslate: i.currentTranslate
+        }), i.loopSwapReset = !0, void(i.startTranslate = i.currentTranslate);
+        s.emit("sliderMove", p), i.isMoved = !0, i.currentTranslate = g + i.startTranslate;
+        let E = !0,
+            x = r.resistanceRatio;
+        if (r.touchReleaseOnEdges && (x = 0), g > 0 ? (b && y && i.allowThresholdMove && i.currentTranslate > (r.centeredSlides ? s.minTranslate() - s.slidesSizesGrid[s.activeIndex + 1] : s.minTranslate()) && s.loopFix({
+                direction: "prev",
+                setTranslate: !0,
+                activeSlideIndex: 0
+            }), i.currentTranslate > s.minTranslate() && (E = !1, r.resistance && (i.currentTranslate = s.minTranslate() - 1 + (-s.minTranslate() + i.startTranslate + g) ** x))) : g < 0 && (b && y && i.allowThresholdMove && i.currentTranslate < (r.centeredSlides ? s.maxTranslate() + s.slidesSizesGrid[s.slidesSizesGrid.length - 1] : s.maxTranslate()) && s.loopFix({
+                direction: "next",
+                setTranslate: !0,
+                activeSlideIndex: s.slides.length - ("auto" === r.slidesPerView ? s.slidesPerViewDynamic() : Math.ceil(parseFloat(r.slidesPerView, 10)))
+            }), i.currentTranslate < s.maxTranslate() && (E = !1, r.resistance && (i.currentTranslate = s.maxTranslate() + 1 - (s.maxTranslate() - i.startTranslate - g) ** x))), E && (p.preventedByNestedSwiper = !0), !s.allowSlideNext && "next" === s.swipeDirection && i.currentTranslate < i.startTranslate && (i.currentTranslate = i.startTranslate), !s.allowSlidePrev && "prev" === s.swipeDirection && i.currentTranslate > i.startTranslate && (i.currentTranslate = i.startTranslate), s.allowSlidePrev || s.allowSlideNext || (i.currentTranslate = i.startTranslate), r.threshold > 0) {
+            if (!(Math.abs(g) > r.threshold || i.allowThresholdMove)) return void(i.currentTranslate = i.startTranslate);
             if (!i.allowThresholdMove) return i.allowThresholdMove = !0, n.startX = n.currentX, n.startY = n.currentY, i.currentTranslate = i.startTranslate, void(n.diff = s.isHorizontal() ? n.currentX - n.startX : n.currentY - n.startY)
         }
-        r.followFinger && !r.cssMode && ((r.freeMode && r.freeMode.enabled && s.freeMode || r.watchSlidesProgress) && (s.updateActiveIndex(), s.updateSlidesClasses()), s.params.freeMode && r.freeMode.enabled && s.freeMode && s.freeMode.onTouchMove(), s.updateProgress(i.currentTranslate), s.setTranslate(i.currentTranslate))
+        r.followFinger && !r.cssMode && ((r.freeMode && r.freeMode.enabled && s.freeMode || r.watchSlidesProgress) && (s.updateActiveIndex(), s.updateSlidesClasses()), r.freeMode && r.freeMode.enabled && s.freeMode && s.freeMode.onTouchMove(), s.updateProgress(i.currentTranslate), s.setTranslate(i.currentTranslate))
     }
 
-    function I(e) {
+    function q(e) {
         const t = this,
-            s = t.touchEventsData,
-            {
-                params: a,
-                touches: i,
-                rtlTranslate: r,
-                slidesGrid: n,
-                enabled: l
-            } = t;
-        if (!l) return;
-        let o = e;
-        if (o.originalEvent && (o = o.originalEvent), s.allowTouchCallbacks && t.emit("touchEnd", o), s.allowTouchCallbacks = !1, !s.isTouched) return s.isMoved && a.grabCursor && t.setGrabCursor(!1), s.isMoved = !1, void(s.startMoving = !1);
-        a.grabCursor && s.isMoved && s.isTouched && (!0 === t.allowSlideNext || !0 === t.allowSlidePrev) && t.setGrabCursor(!1);
-        const d = u(),
-            c = d - s.touchStartTime;
+            s = t.touchEventsData;
+        let a, i = e;
+        i.originalEvent && (i = i.originalEvent);
+        if ("touchend" === i.type || "touchcancel" === i.type) {
+            if (a = [...i.changedTouches].filter((e => e.identifier === s.touchId))[0], !a || a.identifier !== s.touchId) return
+        } else {
+            if (null !== s.touchId) return;
+            if (i.pointerId !== s.pointerId) return;
+            a = i
+        }
+        if (["pointercancel", "pointerout", "pointerleave", "contextmenu"].includes(i.type)) {
+            if (!(["pointercancel", "contextmenu"].includes(i.type) && (t.browser.isSafari || t.browser.isWebView))) return
+        }
+        s.pointerId = null, s.touchId = null;
+        const {
+            params: r,
+            touches: n,
+            rtlTranslate: d,
+            slidesGrid: c,
+            enabled: p
+        } = t;
+        if (!p) return;
+        if (!r.simulateTouch && "mouse" === i.pointerType) return;
+        if (s.allowTouchCallbacks && t.emit("touchEnd", i), s.allowTouchCallbacks = !1, !s.isTouched) return s.isMoved && r.grabCursor && t.setGrabCursor(!1), s.isMoved = !1, void(s.startMoving = !1);
+        r.grabCursor && s.isMoved && s.isTouched && (!0 === t.allowSlideNext || !0 === t.allowSlidePrev) && t.setGrabCursor(!1);
+        const u = o(),
+            m = u - s.touchStartTime;
         if (t.allowClick) {
-            const e = o.path || o.composedPath && o.composedPath();
-            t.updateClickedSlide(e && e[0] || o.target), t.emit("tap click", o), c < 300 && d - s.lastClickTime < 300 && t.emit("doubleTap doubleClick", o)
+            const e = i.path || i.composedPath && i.composedPath();
+            t.updateClickedSlide(e && e[0] || i.target, e), t.emit("tap click", i), m < 300 && u - s.lastClickTime < 300 && t.emit("doubleTap doubleClick", i)
         }
-        if (s.lastClickTime = u(), p((() => {
+        if (s.lastClickTime = o(), l((() => {
                 t.destroyed || (t.allowClick = !0)
-            })), !s.isTouched || !s.isMoved || !t.swipeDirection || 0 === i.diff || s.currentTranslate === s.startTranslate) return s.isTouched = !1, s.isMoved = !1, void(s.startMoving = !1);
+            })), !s.isTouched || !s.isMoved || !t.swipeDirection || 0 === n.diff && !s.loopSwapReset || s.currentTranslate === s.startTranslate && !s.loopSwapReset) return s.isTouched = !1, s.isMoved = !1, void(s.startMoving = !1);
         let h;
-        if (s.isTouched = !1, s.isMoved = !1, s.startMoving = !1, h = a.followFinger ? r ? t.translate : -t.translate : -s.currentTranslate, a.cssMode) return;
-        if (t.params.freeMode && a.freeMode.enabled) return void t.freeMode.onTouchEnd({
+        if (s.isTouched = !1, s.isMoved = !1, s.startMoving = !1, h = r.followFinger ? d ? t.translate : -t.translate : -s.currentTranslate, r.cssMode) return;
+        if (r.freeMode && r.freeMode.enabled) return void t.freeMode.onTouchEnd({
             currentPos: h
         });
-        let m = 0,
-            f = t.slidesSizesGrid[0];
-        for (let e = 0; e < n.length; e += e < a.slidesPerGroupSkip ? 1 : a.slidesPerGroup) {
-            const t = e < a.slidesPerGroupSkip - 1 ? 1 : a.slidesPerGroup;
-            void 0 !== n[e + t] ? h >= n[e] && h < n[e + t] && (m = e, f = n[e + t] - n[e]) : h >= n[e] && (m = e, f = n[n.length - 1] - n[n.length - 2])
-        }
-        let g = null,
-            v = null;
-        a.rewind && (t.isBeginning ? v = t.params.virtual && t.params.virtual.enabled && t.virtual ? t.virtual.slides.length - 1 : t.slides.length - 1 : t.isEnd && (g = 0));
-        const w = (h - n[m]) / f,
-            b = m < a.slidesPerGroupSkip - 1 ? 1 : a.slidesPerGroup;
-        if (c > a.longSwipesMs) {
-            if (!a.longSwipes) return void t.slideTo(t.activeIndex);
-            "next" === t.swipeDirection && (w >= a.longSwipesRatio ? t.slideTo(a.rewind && t.isEnd ? g : m + b) : t.slideTo(m)), "prev" === t.swipeDirection && (w > 1 - a.longSwipesRatio ? t.slideTo(m + b) : null !== v && w < 0 && Math.abs(w) > a.longSwipesRatio ? t.slideTo(v) : t.slideTo(m))
+        const f = h >= -t.maxTranslate() && !t.params.loop;
+        let g = 0,
+            v = t.slidesSizesGrid[0];
+        for (let e = 0; e < c.length; e += e < r.slidesPerGroupSkip ? 1 : r.slidesPerGroup) {
+            const t = e < r.slidesPerGroupSkip - 1 ? 1 : r.slidesPerGroup;
+            void 0 !== c[e + t] ? (f || h >= c[e] && h < c[e + t]) && (g = e, v = c[e + t] - c[e]) : (f || h >= c[e]) && (g = e, v = c[c.length - 1] - c[c.length - 2])
+        }
+        let w = null,
+            b = null;
+        r.rewind && (t.isBeginning ? b = r.virtual && r.virtual.enabled && t.virtual ? t.virtual.slides.length - 1 : t.slides.length - 1 : t.isEnd && (w = 0));
+        const y = (h - c[g]) / v,
+            E = g < r.slidesPerGroupSkip - 1 ? 1 : r.slidesPerGroup;
+        if (m > r.longSwipesMs) {
+            if (!r.longSwipes) return void t.slideTo(t.activeIndex);
+            "next" === t.swipeDirection && (y >= r.longSwipesRatio ? t.slideTo(r.rewind && t.isEnd ? w : g + E) : t.slideTo(g)), "prev" === t.swipeDirection && (y > 1 - r.longSwipesRatio ? t.slideTo(g + E) : null !== b && y < 0 && Math.abs(y) > r.longSwipesRatio ? t.slideTo(b) : t.slideTo(g))
         } else {
-            if (!a.shortSwipes) return void t.slideTo(t.activeIndex);
-            t.navigation && (o.target === t.navigation.nextEl || o.target === t.navigation.prevEl) ? o.target === t.navigation.nextEl ? t.slideTo(m + b) : t.slideTo(m) : ("next" === t.swipeDirection && t.slideTo(null !== g ? g : m + b), "prev" === t.swipeDirection && t.slideTo(null !== v ? v : m))
+            if (!r.shortSwipes) return void t.slideTo(t.activeIndex);
+            t.navigation && (i.target === t.navigation.nextEl || i.target === t.navigation.prevEl) ? i.target === t.navigation.nextEl ? t.slideTo(g + E) : t.slideTo(g) : ("next" === t.swipeDirection && t.slideTo(null !== w ? w : g + E), "prev" === t.swipeDirection && t.slideTo(null !== b ? b : g))
         }
     }
 
-    function A() {
+    function F() {
         const e = this,
             {
                 params: t,
                 el: s
             } = e;
         if (s && 0 === s.offsetWidth) return;
         t.breakpoints && e.setBreakpoint();
         const {
             allowSlideNext: a,
             allowSlidePrev: i,
             snapGrid: r
-        } = e;
-        e.allowSlideNext = !0, e.allowSlidePrev = !0, e.updateSize(), e.updateSlides(), e.updateSlidesClasses(), ("auto" === t.slidesPerView || t.slidesPerView > 1) && e.isEnd && !e.isBeginning && !e.params.centeredSlides ? e.slideTo(e.slides.length - 1, 0, !1, !0) : e.slideTo(e.activeIndex, 0, !1, !0), e.autoplay && e.autoplay.running && e.autoplay.paused && e.autoplay.run(), e.allowSlidePrev = i, e.allowSlideNext = a, e.params.watchOverflow && r !== e.snapGrid && e.checkOverflow()
+        } = e, n = e.virtual && e.params.virtual.enabled;
+        e.allowSlideNext = !0, e.allowSlidePrev = !0, e.updateSize(), e.updateSlides(), e.updateSlidesClasses();
+        const l = n && t.loop;
+        !("auto" === t.slidesPerView || t.slidesPerView > 1) || !e.isEnd || e.isBeginning || e.params.centeredSlides || l ? e.params.loop && !n ? e.slideToLoop(e.realIndex, 0, !1, !0) : e.slideTo(e.activeIndex, 0, !1, !0) : e.slideTo(e.slides.length - 1, 0, !1, !0), e.autoplay && e.autoplay.running && e.autoplay.paused && (clearTimeout(e.autoplay.resizeTimeout), e.autoplay.resizeTimeout = setTimeout((() => {
+            e.autoplay && e.autoplay.running && e.autoplay.paused && e.autoplay.resume()
+        }), 500)), e.allowSlidePrev = i, e.allowSlideNext = a, e.params.watchOverflow && r !== e.snapGrid && e.checkOverflow()
     }
 
-    function D(e) {
+    function V(e) {
         const t = this;
         t.enabled && (t.allowClick || (t.params.preventClicks && e.preventDefault(), t.params.preventClicksPropagation && t.animating && (e.stopPropagation(), e.stopImmediatePropagation())))
     }
 
-    function G() {
+    function _() {
         const e = this,
             {
                 wrapperEl: t,
                 rtlTranslate: s,
                 enabled: a
             } = e;
         if (!a) return;
         let i;
         e.previousTranslate = e.translate, e.isHorizontal() ? e.translate = -t.scrollLeft : e.translate = -t.scrollTop, 0 === e.translate && (e.translate = 0), e.updateActiveIndex(), e.updateSlidesClasses();
         const r = e.maxTranslate() - e.minTranslate();
         i = 0 === r ? 0 : (e.translate - e.minTranslate()) / r, i !== e.progress && e.updateProgress(s ? -e.translate : e.translate), e.emit("setTranslate", e.translate, !1)
     }
-    let N = !1;
 
-    function B() {}
-    const H = (e, t) => {
+    function W(e) {
+        const t = this;
+        $(t, e.target), t.params.cssMode || "auto" !== t.params.slidesPerView && !t.params.autoHeight || t.update()
+    }
+
+    function j() {
+        const e = this;
+        e.documentTouchHandlerProceeded || (e.documentTouchHandlerProceeded = !0, e.params.touchReleaseOnEdges && (e.el.style.touchAction = "auto"))
+    }
+    const U = (e, t) => {
         const s = a(),
             {
                 params: i,
-                touchEvents: r,
-                el: n,
-                wrapperEl: l,
-                device: o,
-                support: d
+                el: r,
+                wrapperEl: n,
+                device: l
             } = e,
-            c = !!i.nested,
-            p = "on" === t ? "addEventListener" : "removeEventListener",
-            u = t;
-        if (d.touch) {
-            const t = !("touchstart" !== r.start || !d.passiveListener || !i.passiveListeners) && {
-                passive: !0,
-                capture: !1
-            };
-            n[p](r.start, e.onTouchStart, t), n[p](r.move, e.onTouchMove, d.passiveListener ? {
-                passive: !1,
-                capture: c
-            } : c), n[p](r.end, e.onTouchEnd, t), r.cancel && n[p](r.cancel, e.onTouchEnd, t)
-        } else n[p](r.start, e.onTouchStart, !1), s[p](r.move, e.onTouchMove, c), s[p](r.end, e.onTouchEnd, !1);
-        (i.preventClicks || i.preventClicksPropagation) && n[p]("click", e.onClick, !0), i.cssMode && l[p]("scroll", e.onScroll), i.updateOnWindowResize ? e[u](o.ios || o.android ? "resize orientationchange observerUpdate" : "resize observerUpdate", A, !0) : e[u]("observerUpdate", A, !0)
-    };
-    var X = {
-        attachEvents: function() {
-            const e = this,
-                t = a(),
-                {
-                    params: s,
-                    support: i
-                } = e;
-            e.onTouchStart = L.bind(e), e.onTouchMove = O.bind(e), e.onTouchEnd = I.bind(e), s.cssMode && (e.onScroll = G.bind(e)), e.onClick = D.bind(e), i.touch && !N && (t.addEventListener("touchstart", B), N = !0), H(e, "on")
-        },
-        detachEvents: function() {
-            H(this, "off")
-        }
-    };
-    const Y = (e, t) => e.grid && t.grid && t.grid.rows > 1;
-    var R = {
-        addClasses: function() {
-            const e = this,
-                {
-                    classNames: t,
-                    params: s,
-                    rtl: a,
-                    $el: i,
-                    device: r,
-                    support: n
-                } = e,
-                l = function(e, t) {
-                    const s = [];
-                    return e.forEach((e => {
-                        "object" == typeof e ? Object.keys(e).forEach((a => {
-                            e[a] && s.push(t + a)
-                        })) : "string" == typeof e && s.push(t + e)
-                    })), s
-                }(["initialized", s.direction, {
-                    "pointer-events": !n.touch
-                }, {
-                    "free-mode": e.params.freeMode && s.freeMode.enabled
-                }, {
-                    autoheight: s.autoHeight
-                }, {
-                    rtl: a
-                }, {
-                    grid: s.grid && s.grid.rows > 1
-                }, {
-                    "grid-column": s.grid && s.grid.rows > 1 && "column" === s.grid.fill
-                }, {
-                    android: r.android
-                }, {
-                    ios: r.ios
-                }, {
-                    "css-mode": s.cssMode
-                }, {
-                    centered: s.cssMode && s.centeredSlides
-                }, {
-                    "watch-progress": s.watchSlidesProgress
-                }], s.containerModifierClass);
-            t.push(...l), i.addClass([...t].join(" ")), e.emitContainerClasses()
-        },
-        removeClasses: function() {
-            const {
-                $el: e,
-                classNames: t
-            } = this;
-            e.removeClass(t.join(" ")), this.emitContainerClasses()
-        }
+            o = !!i.nested,
+            d = "on" === t ? "addEventListener" : "removeEventListener",
+            c = t;
+        s[d]("touchstart", e.onDocumentTouchStart, {
+            passive: !1,
+            capture: o
+        }), r[d]("touchstart", e.onTouchStart, {
+            passive: !1
+        }), r[d]("pointerdown", e.onTouchStart, {
+            passive: !1
+        }), s[d]("touchmove", e.onTouchMove, {
+            passive: !1,
+            capture: o
+        }), s[d]("pointermove", e.onTouchMove, {
+            passive: !1,
+            capture: o
+        }), s[d]("touchend", e.onTouchEnd, {
+            passive: !0
+        }), s[d]("pointerup", e.onTouchEnd, {
+            passive: !0
+        }), s[d]("pointercancel", e.onTouchEnd, {
+            passive: !0
+        }), s[d]("touchcancel", e.onTouchEnd, {
+            passive: !0
+        }), s[d]("pointerout", e.onTouchEnd, {
+            passive: !0
+        }), s[d]("pointerleave", e.onTouchEnd, {
+            passive: !0
+        }), s[d]("contextmenu", e.onTouchEnd, {
+            passive: !0
+        }), (i.preventClicks || i.preventClicksPropagation) && r[d]("click", e.onClick, !0), i.cssMode && n[d]("scroll", e.onScroll), i.updateOnWindowResize ? e[c](l.ios || l.android ? "resize orientationchange observerUpdate" : "resize observerUpdate", F, !0) : e[c]("observerUpdate", F, !0), r[d]("load", e.onLoad, {
+            capture: !0
+        })
     };
-    var W = {
+    const K = (e, t) => e.grid && t.grid && t.grid.rows > 1;
+    var Z = {
         init: !0,
         direction: "horizontal",
+        oneWayMovement: !1,
+        swiperElementNodeName: "SWIPER-CONTAINER",
         touchEventsTarget: "wrapper",
         initialSlide: 0,
         speed: 300,
         cssMode: !1,
         updateOnWindowResize: !0,
         resizeObserver: !0,
         nested: !1,
         createElements: !1,
+        eventsPrefix: "swiper",
         enabled: !0,
         focusableElements: "input, select, option, textarea, button, video, label",
         width: null,
         height: null,
         preventInteractionOnTransition: !1,
         userAgent: null,
         url: null,
@@ -1663,157 +1571,167 @@
         simulateTouch: !0,
         shortSwipes: !0,
         longSwipes: !0,
         longSwipesRatio: .5,
         longSwipesMs: 300,
         followFinger: !0,
         allowTouchMove: !0,
-        threshold: 0,
+        threshold: 5,
         touchMoveStopPropagation: !1,
         touchStartPreventDefault: !0,
         touchStartForcePreventDefault: !1,
         touchReleaseOnEdges: !1,
         uniqueNavElements: !0,
         resistance: !0,
         resistanceRatio: .85,
         watchSlidesProgress: !1,
         grabCursor: !1,
         preventClicks: !0,
         preventClicksPropagation: !0,
         slideToClickedSlide: !1,
-        preloadImages: !0,
-        updateOnImagesReady: !0,
         loop: !1,
+        loopAddBlankSlides: !0,
         loopAdditionalSlides: 0,
-        loopedSlides: null,
-        loopedSlidesLimit: !0,
-        loopFillGroupWithBlank: !1,
-        loopPreventsSlide: !0,
+        loopPreventsSliding: !0,
         rewind: !1,
         allowSlidePrev: !0,
         allowSlideNext: !0,
         swipeHandler: null,
         noSwiping: !0,
         noSwipingClass: "swiper-no-swiping",
         noSwipingSelector: null,
         passiveListeners: !0,
         maxBackfaceHiddenSlides: 10,
         containerModifierClass: "swiper-",
         slideClass: "swiper-slide",
-        slideBlankClass: "swiper-slide-invisible-blank",
+        slideBlankClass: "swiper-slide-blank",
         slideActiveClass: "swiper-slide-active",
-        slideDuplicateActiveClass: "swiper-slide-duplicate-active",
         slideVisibleClass: "swiper-slide-visible",
-        slideDuplicateClass: "swiper-slide-duplicate",
+        slideFullyVisibleClass: "swiper-slide-fully-visible",
         slideNextClass: "swiper-slide-next",
-        slideDuplicateNextClass: "swiper-slide-duplicate-next",
         slidePrevClass: "swiper-slide-prev",
-        slideDuplicatePrevClass: "swiper-slide-duplicate-prev",
         wrapperClass: "swiper-wrapper",
+        lazyPreloaderClass: "swiper-lazy-preloader",
+        lazyPreloadPrevNext: 0,
         runCallbacksOnInit: !0,
         _emitClasses: !1
     };
 
-    function q(e, t) {
+    function Q(e, t) {
         return function(s) {
             void 0 === s && (s = {});
             const a = Object.keys(s)[0],
                 i = s[a];
-            "object" == typeof i && null !== i ? (["navigation", "pagination", "scrollbar"].indexOf(a) >= 0 && !0 === e[a] && (e[a] = {
-                auto: !0
-            }), a in e && "enabled" in i ? (!0 === e[a] && (e[a] = {
+            "object" == typeof i && null !== i ? (!0 === e[a] && (e[a] = {
                 enabled: !0
-            }), "object" != typeof e[a] || "enabled" in e[a] || (e[a].enabled = !0), e[a] || (e[a] = {
+            }), "navigation" === a && e[a] && e[a].enabled && !e[a].prevEl && !e[a].nextEl && (e[a].auto = !0), ["pagination", "scrollbar"].indexOf(a) >= 0 && e[a] && e[a].enabled && !e[a].el && (e[a].auto = !0), a in e && "enabled" in i ? ("object" != typeof e[a] || "enabled" in e[a] || (e[a].enabled = !0), e[a] || (e[a] = {
                 enabled: !1
-            }), g(t, s)) : g(t, s)) : g(t, s)
+            }), p(t, s)) : p(t, s)) : p(t, s)
         }
     }
-    const j = {
-            eventsEmitter: $,
-            update: S,
-            translate: M,
+    const J = {
+            eventsEmitter: A,
+            update: D,
+            translate: G,
             transition: {
                 setTransition: function(e, t) {
                     const s = this;
-                    s.params.cssMode || s.$wrapperEl.transition(e), s.emit("setTransition", e, t)
+                    s.params.cssMode || (s.wrapperEl.style.transitionDuration = `${e}ms`, s.wrapperEl.style.transitionDelay = 0 === e ? "0ms" : ""), s.emit("setTransition", e, t)
                 },
                 transitionStart: function(e, t) {
                     void 0 === e && (e = !0);
                     const s = this,
                         {
                             params: a
                         } = s;
-                    a.cssMode || (a.autoHeight && s.updateAutoHeight(), P({
+                    a.cssMode || (a.autoHeight && s.updateAutoHeight(), N({
                         swiper: s,
                         runCallbacks: e,
                         direction: t,
                         step: "Start"
                     }))
                 },
                 transitionEnd: function(e, t) {
                     void 0 === e && (e = !0);
                     const s = this,
                         {
                             params: a
                         } = s;
-                    s.animating = !1, a.cssMode || (s.setTransition(0), P({
+                    s.animating = !1, a.cssMode || (s.setTransition(0), N({
                         swiper: s,
                         runCallbacks: e,
                         direction: t,
                         step: "End"
                     }))
                 }
             },
-            slide: k,
-            loop: z,
+            slide: H,
+            loop: X,
             grabCursor: {
                 setGrabCursor: function(e) {
                     const t = this;
-                    if (t.support.touch || !t.params.simulateTouch || t.params.watchOverflow && t.isLocked || t.params.cssMode) return;
+                    if (!t.params.simulateTouch || t.params.watchOverflow && t.isLocked || t.params.cssMode) return;
                     const s = "container" === t.params.touchEventsTarget ? t.el : t.wrapperEl;
-                    s.style.cursor = "move", s.style.cursor = e ? "grabbing" : "grab"
+                    t.isElement && (t.__preventObserver__ = !0), s.style.cursor = "move", s.style.cursor = e ? "grabbing" : "grab", t.isElement && requestAnimationFrame((() => {
+                        t.__preventObserver__ = !1
+                    }))
                 },
                 unsetGrabCursor: function() {
                     const e = this;
-                    e.support.touch || e.params.watchOverflow && e.isLocked || e.params.cssMode || (e["container" === e.params.touchEventsTarget ? "el" : "wrapperEl"].style.cursor = "")
+                    e.params.watchOverflow && e.isLocked || e.params.cssMode || (e.isElement && (e.__preventObserver__ = !0), e["container" === e.params.touchEventsTarget ? "el" : "wrapperEl"].style.cursor = "", e.isElement && requestAnimationFrame((() => {
+                        e.__preventObserver__ = !1
+                    })))
+                }
+            },
+            events: {
+                attachEvents: function() {
+                    const e = this,
+                        {
+                            params: t
+                        } = e;
+                    e.onTouchStart = B.bind(e), e.onTouchMove = R.bind(e), e.onTouchEnd = q.bind(e), e.onDocumentTouchStart = j.bind(e), t.cssMode && (e.onScroll = _.bind(e)), e.onClick = V.bind(e), e.onLoad = W.bind(e), U(e, "on")
+                },
+                detachEvents: function() {
+                    U(this, "off")
                 }
             },
-            events: X,
             breakpoints: {
                 setBreakpoint: function() {
                     const e = this,
                         {
-                            activeIndex: t,
+                            realIndex: t,
                             initialized: s,
-                            loopedSlides: a = 0,
-                            params: i,
-                            $el: r
+                            params: a,
+                            el: i
                         } = e,
-                        n = i.breakpoints;
-                    if (!n || n && 0 === Object.keys(n).length) return;
-                    const l = e.getBreakpoint(n, e.params.breakpointsBase, e.el);
-                    if (!l || e.currentBreakpoint === l) return;
-                    const o = (l in n ? n[l] : void 0) || e.originalParams,
-                        d = Y(e, i),
-                        c = Y(e, o),
-                        p = i.enabled;
-                    d && !c ? (r.removeClass(`${i.containerModifierClass}grid ${i.containerModifierClass}grid-column`), e.emitContainerClasses()) : !d && c && (r.addClass(`${i.containerModifierClass}grid`), (o.grid.fill && "column" === o.grid.fill || !o.grid.fill && "column" === i.grid.fill) && r.addClass(`${i.containerModifierClass}grid-column`), e.emitContainerClasses()), ["navigation", "pagination", "scrollbar"].forEach((t => {
-                        const s = i[t] && i[t].enabled,
-                            a = o[t] && o[t].enabled;
-                        s && !a && e[t].disable(), !s && a && e[t].enable()
+                        r = a.breakpoints;
+                    if (!r || r && 0 === Object.keys(r).length) return;
+                    const n = e.getBreakpoint(r, e.params.breakpointsBase, e.el);
+                    if (!n || e.currentBreakpoint === n) return;
+                    const l = (n in r ? r[n] : void 0) || e.originalParams,
+                        o = K(e, a),
+                        d = K(e, l),
+                        c = a.enabled;
+                    o && !d ? (i.classList.remove(`${a.containerModifierClass}grid`, `${a.containerModifierClass}grid-column`), e.emitContainerClasses()) : !o && d && (i.classList.add(`${a.containerModifierClass}grid`), (l.grid.fill && "column" === l.grid.fill || !l.grid.fill && "column" === a.grid.fill) && i.classList.add(`${a.containerModifierClass}grid-column`), e.emitContainerClasses()), ["navigation", "pagination", "scrollbar"].forEach((t => {
+                        if (void 0 === l[t]) return;
+                        const s = a[t] && a[t].enabled,
+                            i = l[t] && l[t].enabled;
+                        s && !i && e[t].disable(), !s && i && e[t].enable()
                     }));
-                    const u = o.direction && o.direction !== i.direction,
-                        h = i.loop && (o.slidesPerView !== i.slidesPerView || u);
-                    u && s && e.changeDirection(), g(e.params, o);
-                    const m = e.params.enabled;
+                    const u = l.direction && l.direction !== a.direction,
+                        m = a.loop && (l.slidesPerView !== a.slidesPerView || u),
+                        h = a.loop;
+                    u && s && e.changeDirection(), p(e.params, l);
+                    const f = e.params.enabled,
+                        g = e.params.loop;
                     Object.assign(e, {
                         allowTouchMove: e.params.allowTouchMove,
                         allowSlideNext: e.params.allowSlideNext,
                         allowSlidePrev: e.params.allowSlidePrev
-                    }), p && !m ? e.disable() : !p && m && e.enable(), e.currentBreakpoint = l, e.emit("_beforeBreakpoint", o), h && s && (e.loopDestroy(), e.loopCreate(), e.updateSlides(), e.slideTo(t - a + e.loopedSlides, 0, !1)), e.emit("breakpoint", o)
+                    }), c && !f ? e.disable() : !c && f && e.enable(), e.currentBreakpoint = n, e.emit("_beforeBreakpoint", l), s && (m ? (e.loopDestroy(), e.loopCreate(t), e.updateSlides()) : !h && g ? (e.loopCreate(t), e.updateSlides()) : h && !g && e.loopDestroy()), e.emit("breakpoint", l)
                 },
                 getBreakpoint: function(e, t, s) {
                     if (void 0 === t && (t = "window"), !e || "container" === t && !s) return;
                     let a = !1;
                     const i = r(),
                         n = "window" === t ? i.innerHeight : s.clientHeight,
                         l = Object.keys(e).map((e => {
@@ -1854,135 +1772,181 @@
                         const t = e.slides.length - 1,
                             s = e.slidesGrid[t] + e.slidesSizesGrid[t] + 2 * a;
                         e.isLocked = e.size > s
                     } else e.isLocked = 1 === e.snapGrid.length;
                     !0 === s.allowSlideNext && (e.allowSlideNext = !e.isLocked), !0 === s.allowSlidePrev && (e.allowSlidePrev = !e.isLocked), t && t !== e.isLocked && (e.isEnd = !1), t !== e.isLocked && e.emit(e.isLocked ? "lock" : "unlock")
                 }
             },
-            classes: R,
-            images: {
-                loadImage: function(e, t, s, a, i, n) {
-                    const l = r();
-                    let o;
-
-                    function c() {
-                        n && n()
-                    }
-                    d(e).parent("picture")[0] || e.complete && i ? c() : t ? (o = new l.Image, o.onload = c, o.onerror = c, a && (o.sizes = a), s && (o.srcset = s), t && (o.src = t)) : c()
+            classes: {
+                addClasses: function() {
+                    const e = this,
+                        {
+                            classNames: t,
+                            params: s,
+                            rtl: a,
+                            el: i,
+                            device: r
+                        } = e,
+                        n = function(e, t) {
+                            const s = [];
+                            return e.forEach((e => {
+                                "object" == typeof e ? Object.keys(e).forEach((a => {
+                                    e[a] && s.push(t + a)
+                                })) : "string" == typeof e && s.push(t + e)
+                            })), s
+                        }(["initialized", s.direction, {
+                            "free-mode": e.params.freeMode && s.freeMode.enabled
+                        }, {
+                            autoheight: s.autoHeight
+                        }, {
+                            rtl: a
+                        }, {
+                            grid: s.grid && s.grid.rows > 1
+                        }, {
+                            "grid-column": s.grid && s.grid.rows > 1 && "column" === s.grid.fill
+                        }, {
+                            android: r.android
+                        }, {
+                            ios: r.ios
+                        }, {
+                            "css-mode": s.cssMode
+                        }, {
+                            centered: s.cssMode && s.centeredSlides
+                        }, {
+                            "watch-progress": s.watchSlidesProgress
+                        }], s.containerModifierClass);
+                    t.push(...n), i.classList.add(...t), e.emitContainerClasses()
                 },
-                preloadImages: function() {
-                    const e = this;
-
-                    function t() {
-                        null != e && e && !e.destroyed && (void 0 !== e.imagesLoaded && (e.imagesLoaded += 1), e.imagesLoaded === e.imagesToLoad.length && (e.params.updateOnImagesReady && e.update(), e.emit("imagesReady")))
-                    }
-                    e.imagesToLoad = e.$el.find("img");
-                    for (let s = 0; s < e.imagesToLoad.length; s += 1) {
-                        const a = e.imagesToLoad[s];
-                        e.loadImage(a, a.currentSrc || a.getAttribute("src"), a.srcset || a.getAttribute("srcset"), a.sizes || a.getAttribute("sizes"), !0, t)
-                    }
+                removeClasses: function() {
+                    const {
+                        el: e,
+                        classNames: t
+                    } = this;
+                    e.classList.remove(...t), this.emitContainerClasses()
                 }
             }
         },
-        _ = {};
-    class V {
+        ee = {};
+    class te {
         constructor() {
             let e, t;
-            for (var s = arguments.length, a = new Array(s), i = 0; i < s; i++) a[i] = arguments[i];
-            if (1 === a.length && a[0].constructor && "Object" === Object.prototype.toString.call(a[0]).slice(8, -1) ? t = a[0] : [e, t] = a, t || (t = {}), t = g({}, t), e && !t.el && (t.el = e), t.el && d(t.el).length > 1) {
+            for (var s = arguments.length, i = new Array(s), r = 0; r < s; r++) i[r] = arguments[r];
+            1 === i.length && i[0].constructor && "Object" === Object.prototype.toString.call(i[0]).slice(8, -1) ? t = i[0] : [e, t] = i, t || (t = {}), t = p({}, t), e && !t.el && (t.el = e);
+            const n = a();
+            if (t.el && "string" == typeof t.el && n.querySelectorAll(t.el).length > 1) {
                 const e = [];
-                return d(t.el).each((s => {
-                    const a = g({}, t, {
+                return n.querySelectorAll(t.el).forEach((s => {
+                    const a = p({}, t, {
                         el: s
                     });
-                    e.push(new V(a))
+                    e.push(new te(a))
                 })), e
             }
-            const r = this;
-            r.__swiper__ = !0, r.support = E(), r.device = C({
+            const l = this;
+            l.__swiper__ = !0, l.support = L(), l.device = I({
                 userAgent: t.userAgent
-            }), r.browser = T(), r.eventsListeners = {}, r.eventsAnyListeners = [], r.modules = [...r.__modules__], t.modules && Array.isArray(t.modules) && r.modules.push(...t.modules);
-            const n = {};
-            r.modules.forEach((e => {
+            }), l.browser = z(), l.eventsListeners = {}, l.eventsAnyListeners = [], l.modules = [...l.__modules__], t.modules && Array.isArray(t.modules) && l.modules.push(...t.modules);
+            const o = {};
+            l.modules.forEach((e => {
                 e({
-                    swiper: r,
-                    extendParams: q(t, n),
-                    on: r.on.bind(r),
-                    once: r.once.bind(r),
-                    off: r.off.bind(r),
-                    emit: r.emit.bind(r)
+                    params: t,
+                    swiper: l,
+                    extendParams: Q(t, o),
+                    on: l.on.bind(l),
+                    once: l.once.bind(l),
+                    off: l.off.bind(l),
+                    emit: l.emit.bind(l)
                 })
             }));
-            const l = g({}, W, n);
-            return r.params = g({}, l, _, t), r.originalParams = g({}, r.params), r.passedParams = g({}, t), r.params && r.params.on && Object.keys(r.params.on).forEach((e => {
-                r.on(e, r.params.on[e])
-            })), r.params && r.params.onAny && r.onAny(r.params.onAny), r.$ = d, Object.assign(r, {
-                enabled: r.params.enabled,
+            const d = p({}, Z, o);
+            return l.params = p({}, d, ee, t), l.originalParams = p({}, l.params), l.passedParams = p({}, t), l.params && l.params.on && Object.keys(l.params.on).forEach((e => {
+                l.on(e, l.params.on[e])
+            })), l.params && l.params.onAny && l.onAny(l.params.onAny), Object.assign(l, {
+                enabled: l.params.enabled,
                 el: e,
                 classNames: [],
-                slides: d(),
+                slides: [],
                 slidesGrid: [],
                 snapGrid: [],
                 slidesSizesGrid: [],
-                isHorizontal: () => "horizontal" === r.params.direction,
-                isVertical: () => "vertical" === r.params.direction,
+                isHorizontal: () => "horizontal" === l.params.direction,
+                isVertical: () => "vertical" === l.params.direction,
                 activeIndex: 0,
                 realIndex: 0,
                 isBeginning: !0,
                 isEnd: !1,
                 translate: 0,
                 previousTranslate: 0,
                 progress: 0,
                 velocity: 0,
                 animating: !1,
-                allowSlideNext: r.params.allowSlideNext,
-                allowSlidePrev: r.params.allowSlidePrev,
-                touchEvents: function() {
-                    const e = ["touchstart", "touchmove", "touchend", "touchcancel"],
-                        t = ["pointerdown", "pointermove", "pointerup"];
-                    return r.touchEventsTouch = {
-                        start: e[0],
-                        move: e[1],
-                        end: e[2],
-                        cancel: e[3]
-                    }, r.touchEventsDesktop = {
-                        start: t[0],
-                        move: t[1],
-                        end: t[2]
-                    }, r.support.touch || !r.params.simulateTouch ? r.touchEventsTouch : r.touchEventsDesktop
-                }(),
+                cssOverflowAdjustment() {
+                    return Math.trunc(this.translate / 2 ** 23) * 2 ** 23
+                },
+                allowSlideNext: l.params.allowSlideNext,
+                allowSlidePrev: l.params.allowSlidePrev,
                 touchEventsData: {
                     isTouched: void 0,
                     isMoved: void 0,
                     allowTouchCallbacks: void 0,
                     touchStartTime: void 0,
                     isScrolling: void 0,
                     currentTranslate: void 0,
                     startTranslate: void 0,
                     allowThresholdMove: void 0,
-                    focusableElements: r.params.focusableElements,
-                    lastClickTime: u(),
+                    focusableElements: l.params.focusableElements,
+                    lastClickTime: 0,
                     clickTimeout: void 0,
                     velocities: [],
                     allowMomentumBounce: void 0,
-                    isTouchEvent: void 0,
-                    startMoving: void 0
+                    startMoving: void 0,
+                    pointerId: null,
+                    touchId: null
                 },
                 allowClick: !0,
-                allowTouchMove: r.params.allowTouchMove,
+                allowTouchMove: l.params.allowTouchMove,
                 touches: {
                     startX: 0,
                     startY: 0,
                     currentX: 0,
                     currentY: 0,
                     diff: 0
                 },
                 imagesToLoad: [],
                 imagesLoaded: 0
-            }), r.emit("_swiper"), r.params.init && r.init(), r
+            }), l.emit("_swiper"), l.params.init && l.init(), l
+        }
+        getDirectionLabel(e) {
+            return this.isHorizontal() ? e : {
+                width: "height",
+                "margin-top": "margin-left",
+                "margin-bottom ": "margin-right",
+                "margin-left": "margin-top",
+                "margin-right": "margin-bottom",
+                "padding-left": "padding-top",
+                "padding-right": "padding-bottom",
+                marginRight: "marginBottom"
+            } [e]
+        }
+        getSlideIndex(e) {
+            const {
+                slidesEl: t,
+                params: s
+            } = this, a = y(f(t, `.${s.slideClass}, swiper-slide`)[0]);
+            return y(e) - a
+        }
+        getSlideIndexByData(e) {
+            return this.getSlideIndex(this.slides.filter((t => 1 * t.getAttribute("data-swiper-slide-index") === e))[0])
+        }
+        recalcSlides() {
+            const {
+                slidesEl: e,
+                params: t
+            } = this;
+            this.slides = f(e, `.${t.slideClass}, swiper-slide`)
         }
         enable() {
             const e = this;
             e.enabled || (e.enabled = !0, e.params.grabCursor && e.setGrabCursor(), e.emit("enable"))
         }
         disable() {
             const e = this;
@@ -2005,15 +1969,15 @@
             const t = this;
             return t.destroyed ? "" : e.className.split(" ").filter((e => 0 === e.indexOf("swiper-slide") || 0 === e.indexOf(t.params.slideClass))).join(" ")
         }
         emitSlidesClasses() {
             const e = this;
             if (!e.params._emitClasses || !e.el) return;
             const t = [];
-            e.slides.each((s => {
+            e.slides.forEach((s => {
                 const a = e.getSlideClasses(s);
                 t.push({
                     slideEl: s,
                     classNames: a
                 }), e.emit("_slideClass", s, a)
             })), e.emit("_slideClasses", t)
         }
@@ -2024,17 +1988,18 @@
                 slides: a,
                 slidesGrid: i,
                 slidesSizesGrid: r,
                 size: n,
                 activeIndex: l
             } = this;
             let o = 1;
+            if ("number" == typeof s.slidesPerView) return s.slidesPerView;
             if (s.centeredSlides) {
-                let e, t = a[l].swiperSlideSize;
-                for (let s = l + 1; s < a.length; s += 1) a[s] && !e && (t += a[s].swiperSlideSize, o += 1, t > n && (e = !0));
+                let e, t = a[l] ? Math.ceil(a[l].swiperSlideSize) : 0;
+                for (let s = l + 1; s < a.length; s += 1) a[s] && !e && (t += Math.ceil(a[s].swiperSlideSize), o += 1, t > n && (e = !0));
                 for (let s = l - 1; s >= 0; s -= 1) a[s] && !e && (t += a[s].swiperSlideSize, o += 1, t > n && (e = !0))
             } else if ("current" === e)
                 for (let e = l + 1; e < a.length; e += 1) {
                     (t ? i[e] + r[e] - i[l] < n : i[e] - i[l] < n) && (o += 1)
                 } else
                     for (let e = l - 1; e >= 0; e -= 1) {
                         i[l] - i[e] < n && (o += 1)
@@ -2051,199 +2016,224 @@
 
             function a() {
                 const t = e.rtlTranslate ? -1 * e.translate : e.translate,
                     s = Math.min(Math.max(t, e.maxTranslate()), e.minTranslate());
                 e.setTranslate(s), e.updateActiveIndex(), e.updateSlidesClasses()
             }
             let i;
-            s.breakpoints && e.setBreakpoint(), e.updateSize(), e.updateSlides(), e.updateProgress(), e.updateSlidesClasses(), e.params.freeMode && e.params.freeMode.enabled ? (a(), e.params.autoHeight && e.updateAutoHeight()) : (i = ("auto" === e.params.slidesPerView || e.params.slidesPerView > 1) && e.isEnd && !e.params.centeredSlides ? e.slideTo(e.slides.length - 1, 0, !1, !0) : e.slideTo(e.activeIndex, 0, !1, !0), i || a()), s.watchOverflow && t !== e.snapGrid && e.checkOverflow(), e.emit("update")
+            if (s.breakpoints && e.setBreakpoint(), [...e.el.querySelectorAll('[loading="lazy"]')].forEach((t => {
+                    t.complete && $(e, t)
+                })), e.updateSize(), e.updateSlides(), e.updateProgress(), e.updateSlidesClasses(), s.freeMode && s.freeMode.enabled && !s.cssMode) a(), s.autoHeight && e.updateAutoHeight();
+            else {
+                if (("auto" === s.slidesPerView || s.slidesPerView > 1) && e.isEnd && !s.centeredSlides) {
+                    const t = e.virtual && s.virtual.enabled ? e.virtual.slides : e.slides;
+                    i = e.slideTo(t.length - 1, 0, !1, !0)
+                } else i = e.slideTo(e.activeIndex, 0, !1, !0);
+                i || a()
+            }
+            s.watchOverflow && t !== e.snapGrid && e.checkOverflow(), e.emit("update")
         }
         changeDirection(e, t) {
             void 0 === t && (t = !0);
             const s = this,
                 a = s.params.direction;
-            return e || (e = "horizontal" === a ? "vertical" : "horizontal"), e === a || "horizontal" !== e && "vertical" !== e || (s.$el.removeClass(`${s.params.containerModifierClass}${a}`).addClass(`${s.params.containerModifierClass}${e}`), s.emitContainerClasses(), s.params.direction = e, s.slides.each((t => {
+            return e || (e = "horizontal" === a ? "vertical" : "horizontal"), e === a || "horizontal" !== e && "vertical" !== e || (s.el.classList.remove(`${s.params.containerModifierClass}${a}`), s.el.classList.add(`${s.params.containerModifierClass}${e}`), s.emitContainerClasses(), s.params.direction = e, s.slides.forEach((t => {
                 "vertical" === e ? t.style.width = "" : t.style.height = ""
             })), s.emit("changeDirection"), t && s.update()), s
         }
         changeLanguageDirection(e) {
             const t = this;
-            t.rtl && "rtl" === e || !t.rtl && "ltr" === e || (t.rtl = "rtl" === e, t.rtlTranslate = "horizontal" === t.params.direction && t.rtl, t.rtl ? (t.$el.addClass(`${t.params.containerModifierClass}rtl`), t.el.dir = "rtl") : (t.$el.removeClass(`${t.params.containerModifierClass}rtl`), t.el.dir = "ltr"), t.update())
+            t.rtl && "rtl" === e || !t.rtl && "ltr" === e || (t.rtl = "rtl" === e, t.rtlTranslate = "horizontal" === t.params.direction && t.rtl, t.rtl ? (t.el.classList.add(`${t.params.containerModifierClass}rtl`), t.el.dir = "rtl") : (t.el.classList.remove(`${t.params.containerModifierClass}rtl`), t.el.dir = "ltr"), t.update())
         }
         mount(e) {
             const t = this;
             if (t.mounted) return !0;
-            const s = d(e || t.params.el);
-            if (!(e = s[0])) return !1;
-            e.swiper = t;
-            const i = () => `.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`;
-            let r = (() => {
-                if (e && e.shadowRoot && e.shadowRoot.querySelector) {
-                    const t = d(e.shadowRoot.querySelector(i()));
-                    return t.children = e => s.children(e), t
+            let s = e || t.params.el;
+            if ("string" == typeof s && (s = document.querySelector(s)), !s) return !1;
+            s.swiper = t, s.parentNode && s.parentNode.host && s.parentNode.host.nodeName === t.params.swiperElementNodeName.toUpperCase() && (t.isElement = !0);
+            const a = () => `.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`;
+            let i = (() => {
+                if (s && s.shadowRoot && s.shadowRoot.querySelector) {
+                    return s.shadowRoot.querySelector(a())
                 }
-                return s.children ? s.children(i()) : d(s).children(i())
+                return f(s, a())[0]
             })();
-            if (0 === r.length && t.params.createElements) {
-                const e = a().createElement("div");
-                r = d(e), e.className = t.params.wrapperClass, s.append(e), s.children(`.${t.params.slideClass}`).each((e => {
-                    r.append(e)
-                }))
-            }
-            return Object.assign(t, {
-                $el: s,
-                el: e,
-                $wrapperEl: r,
-                wrapperEl: r[0],
+            return !i && t.params.createElements && (i = v("div", t.params.wrapperClass), s.append(i), f(s, `.${t.params.slideClass}`).forEach((e => {
+                i.append(e)
+            }))), Object.assign(t, {
+                el: s,
+                wrapperEl: i,
+                slidesEl: t.isElement && !s.parentNode.host.slideSlots ? s.parentNode.host : i,
+                hostEl: t.isElement ? s.parentNode.host : s,
                 mounted: !0,
-                rtl: "rtl" === e.dir.toLowerCase() || "rtl" === s.css("direction"),
-                rtlTranslate: "horizontal" === t.params.direction && ("rtl" === e.dir.toLowerCase() || "rtl" === s.css("direction")),
-                wrongRTL: "-webkit-box" === r.css("display")
+                rtl: "rtl" === s.dir.toLowerCase() || "rtl" === b(s, "direction"),
+                rtlTranslate: "horizontal" === t.params.direction && ("rtl" === s.dir.toLowerCase() || "rtl" === b(s, "direction")),
+                wrongRTL: "-webkit-box" === b(i, "display")
             }), !0
         }
         init(e) {
             const t = this;
             if (t.initialized) return t;
-            return !1 === t.mount(e) || (t.emit("beforeInit"), t.params.breakpoints && t.setBreakpoint(), t.addClasses(), t.params.loop && t.loopCreate(), t.updateSize(), t.updateSlides(), t.params.watchOverflow && t.checkOverflow(), t.params.grabCursor && t.enabled && t.setGrabCursor(), t.params.preloadImages && t.preloadImages(), t.params.loop ? t.slideTo(t.params.initialSlide + t.loopedSlides, 0, t.params.runCallbacksOnInit, !1, !0) : t.slideTo(t.params.initialSlide, 0, t.params.runCallbacksOnInit, !1, !0), t.attachEvents(), t.initialized = !0, t.emit("init"), t.emit("afterInit")), t
+            if (!1 === t.mount(e)) return t;
+            t.emit("beforeInit"), t.params.breakpoints && t.setBreakpoint(), t.addClasses(), t.updateSize(), t.updateSlides(), t.params.watchOverflow && t.checkOverflow(), t.params.grabCursor && t.enabled && t.setGrabCursor(), t.params.loop && t.virtual && t.params.virtual.enabled ? t.slideTo(t.params.initialSlide + t.virtual.slidesBefore, 0, t.params.runCallbacksOnInit, !1, !0) : t.slideTo(t.params.initialSlide, 0, t.params.runCallbacksOnInit, !1, !0), t.params.loop && t.loopCreate(), t.attachEvents();
+            const s = [...t.el.querySelectorAll('[loading="lazy"]')];
+            return t.isElement && s.push(...t.hostEl.querySelectorAll('[loading="lazy"]')), s.forEach((e => {
+                e.complete ? $(t, e) : e.addEventListener("load", (e => {
+                    $(t, e.target)
+                }))
+            })), O(t), t.initialized = !0, O(t), t.emit("init"), t.emit("afterInit"), t
         }
         destroy(e, t) {
             void 0 === e && (e = !0), void 0 === t && (t = !0);
             const s = this,
                 {
                     params: a,
-                    $el: i,
-                    $wrapperEl: r,
+                    el: i,
+                    wrapperEl: r,
                     slides: n
                 } = s;
-            return void 0 === s.params || s.destroyed || (s.emit("beforeDestroy"), s.initialized = !1, s.detachEvents(), a.loop && s.loopDestroy(), t && (s.removeClasses(), i.removeAttr("style"), r.removeAttr("style"), n && n.length && n.removeClass([a.slideVisibleClass, a.slideActiveClass, a.slideNextClass, a.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")), s.emit("destroy"), Object.keys(s.eventsListeners).forEach((e => {
+            return void 0 === s.params || s.destroyed || (s.emit("beforeDestroy"), s.initialized = !1, s.detachEvents(), a.loop && s.loopDestroy(), t && (s.removeClasses(), i.removeAttribute("style"), r.removeAttribute("style"), n && n.length && n.forEach((e => {
+                e.classList.remove(a.slideVisibleClass, a.slideFullyVisibleClass, a.slideActiveClass, a.slideNextClass, a.slidePrevClass), e.removeAttribute("style"), e.removeAttribute("data-swiper-slide-index")
+            }))), s.emit("destroy"), Object.keys(s.eventsListeners).forEach((e => {
                 s.off(e)
-            })), !1 !== e && (s.$el[0].swiper = null, function(e) {
+            })), !1 !== e && (s.el.swiper = null, function(e) {
                 const t = e;
                 Object.keys(t).forEach((e => {
                     try {
                         t[e] = null
                     } catch (e) {}
                     try {
                         delete t[e]
                     } catch (e) {}
                 }))
             }(s)), s.destroyed = !0), null
         }
         static extendDefaults(e) {
-            g(_, e)
+            p(ee, e)
         }
         static get extendedDefaults() {
-            return _
+            return ee
         }
         static get defaults() {
-            return W
+            return Z
         }
         static installModule(e) {
-            V.prototype.__modules__ || (V.prototype.__modules__ = []);
-            const t = V.prototype.__modules__;
+            te.prototype.__modules__ || (te.prototype.__modules__ = []);
+            const t = te.prototype.__modules__;
             "function" == typeof e && t.indexOf(e) < 0 && t.push(e)
         }
         static use(e) {
-            return Array.isArray(e) ? (e.forEach((e => V.installModule(e))), V) : (V.installModule(e), V)
+            return Array.isArray(e) ? (e.forEach((e => te.installModule(e))), te) : (te.installModule(e), te)
         }
     }
 
-    function F(e, t, s, i) {
-        const r = a();
-        return e.params.createElements && Object.keys(i).forEach((a => {
-            if (!s[a] && !0 === s.auto) {
-                let n = e.$el.children(`.${i[a]}`)[0];
-                n || (n = r.createElement("div"), n.className = i[a], e.$el.append(n)), s[a] = n, t[a] = n
+    function se(e, t, s, a) {
+        return e.params.createElements && Object.keys(a).forEach((i => {
+            if (!s[i] && !0 === s.auto) {
+                let r = f(e.el, `.${a[i]}`)[0];
+                r || (r = v("div", a[i]), r.className = a[i], e.el.append(r)), s[i] = r, t[i] = r
             }
         })), s
     }
 
-    function U(e) {
-        return void 0 === e && (e = ""), `.${e.trim().replace(/([\.:!\/])/g,"\\$1").replace(/ /g,".")}`
+    function ae(e) {
+        return void 0 === e && (e = ""), `.${e.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`
     }
 
-    function K(e) {
+    function ie(e) {
         const t = this,
             {
-                $wrapperEl: s,
-                params: a
+                params: s,
+                slidesEl: a
             } = t;
-        if (a.loop && t.loopDestroy(), "object" == typeof e && "length" in e)
-            for (let t = 0; t < e.length; t += 1) e[t] && s.append(e[t]);
-        else s.append(e);
-        a.loop && t.loopCreate(), a.observer || t.update()
+        s.loop && t.loopDestroy();
+        const i = e => {
+            if ("string" == typeof e) {
+                const t = document.createElement("div");
+                t.innerHTML = e, a.append(t.children[0]), t.innerHTML = ""
+            } else a.append(e)
+        };
+        if ("object" == typeof e && "length" in e)
+            for (let t = 0; t < e.length; t += 1) e[t] && i(e[t]);
+        else i(e);
+        t.recalcSlides(), s.loop && t.loopCreate(), s.observer && !t.isElement || t.update()
     }
 
-    function Z(e) {
+    function re(e) {
         const t = this,
             {
                 params: s,
-                $wrapperEl: a,
-                activeIndex: i
+                activeIndex: a,
+                slidesEl: i
             } = t;
         s.loop && t.loopDestroy();
-        let r = i + 1;
+        let r = a + 1;
+        const n = e => {
+            if ("string" == typeof e) {
+                const t = document.createElement("div");
+                t.innerHTML = e, i.prepend(t.children[0]), t.innerHTML = ""
+            } else i.prepend(e)
+        };
         if ("object" == typeof e && "length" in e) {
-            for (let t = 0; t < e.length; t += 1) e[t] && a.prepend(e[t]);
-            r = i + e.length
-        } else a.prepend(e);
-        s.loop && t.loopCreate(), s.observer || t.update(), t.slideTo(r, 0, !1)
+            for (let t = 0; t < e.length; t += 1) e[t] && n(e[t]);
+            r = a + e.length
+        } else n(e);
+        t.recalcSlides(), s.loop && t.loopCreate(), s.observer && !t.isElement || t.update(), t.slideTo(r, 0, !1)
     }
 
-    function Q(e, t) {
+    function ne(e, t) {
         const s = this,
             {
-                $wrapperEl: a,
-                params: i,
-                activeIndex: r
+                params: a,
+                activeIndex: i,
+                slidesEl: r
             } = s;
-        let n = r;
-        i.loop && (n -= s.loopedSlides, s.loopDestroy(), s.slides = a.children(`.${i.slideClass}`));
+        let n = i;
+        a.loop && (n -= s.loopedSlides, s.loopDestroy(), s.recalcSlides());
         const l = s.slides.length;
         if (e <= 0) return void s.prependSlide(t);
         if (e >= l) return void s.appendSlide(t);
         let o = n > e ? n + 1 : n;
         const d = [];
         for (let t = l - 1; t >= e; t -= 1) {
-            const e = s.slides.eq(t);
+            const e = s.slides[t];
             e.remove(), d.unshift(e)
         }
         if ("object" == typeof t && "length" in t) {
-            for (let e = 0; e < t.length; e += 1) t[e] && a.append(t[e]);
+            for (let e = 0; e < t.length; e += 1) t[e] && r.append(t[e]);
             o = n > e ? n + t.length : n
-        } else a.append(t);
-        for (let e = 0; e < d.length; e += 1) a.append(d[e]);
-        i.loop && s.loopCreate(), i.observer || s.update(), i.loop ? s.slideTo(o + s.loopedSlides, 0, !1) : s.slideTo(o, 0, !1)
+        } else r.append(t);
+        for (let e = 0; e < d.length; e += 1) r.append(d[e]);
+        s.recalcSlides(), a.loop && s.loopCreate(), a.observer && !s.isElement || s.update(), a.loop ? s.slideTo(o + s.loopedSlides, 0, !1) : s.slideTo(o, 0, !1)
     }
 
-    function J(e) {
+    function le(e) {
         const t = this,
             {
                 params: s,
-                $wrapperEl: a,
-                activeIndex: i
+                activeIndex: a
             } = t;
-        let r = i;
-        s.loop && (r -= t.loopedSlides, t.loopDestroy(), t.slides = a.children(`.${s.slideClass}`));
-        let n, l = r;
+        let i = a;
+        s.loop && (i -= t.loopedSlides, t.loopDestroy());
+        let r, n = i;
         if ("object" == typeof e && "length" in e) {
-            for (let s = 0; s < e.length; s += 1) n = e[s], t.slides[n] && t.slides.eq(n).remove(), n < l && (l -= 1);
-            l = Math.max(l, 0)
-        } else n = e, t.slides[n] && t.slides.eq(n).remove(), n < l && (l -= 1), l = Math.max(l, 0);
-        s.loop && t.loopCreate(), s.observer || t.update(), s.loop ? t.slideTo(l + t.loopedSlides, 0, !1) : t.slideTo(l, 0, !1)
+            for (let s = 0; s < e.length; s += 1) r = e[s], t.slides[r] && t.slides[r].remove(), r < n && (n -= 1);
+            n = Math.max(n, 0)
+        } else r = e, t.slides[r] && t.slides[r].remove(), r < n && (n -= 1), n = Math.max(n, 0);
+        t.recalcSlides(), s.loop && t.loopCreate(), s.observer && !t.isElement || t.update(), s.loop ? t.slideTo(n + t.loopedSlides, 0, !1) : t.slideTo(n, 0, !1)
     }
 
-    function ee() {
+    function oe() {
         const e = this,
             t = [];
         for (let s = 0; s < e.slides.length; s += 1) t.push(s);
         e.removeSlide(t)
     }
 
-    function te(e) {
+    function de(e) {
         const {
             effect: t,
             swiper: s,
             on: a,
             setTranslate: i,
             setTransition: r,
             overwriteParams: n,
@@ -2260,67 +2250,74 @@
         })), a("setTranslate", (() => {
             s.params.effect === t && i()
         })), a("setTransition", ((e, a) => {
             s.params.effect === t && r(a)
         })), a("transitionEnd", (() => {
             if (s.params.effect === t && o) {
                 if (!d || !d().slideShadows) return;
-                s.slides.each((e => {
-                    s.$(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").remove()
+                s.slides.forEach((e => {
+                    e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((e => e.remove()))
                 })), o()
             }
         })), a("virtualUpdate", (() => {
             s.params.effect === t && (s.slides.length || (c = !0), requestAnimationFrame((() => {
                 c && s.slides && s.slides.length && (i(), c = !1)
             })))
         }))
     }
 
-    function se(e, t) {
-        return e.transformEl ? t.find(e.transformEl).css({
-            "backface-visibility": "hidden",
-            "-webkit-backface-visibility": "hidden"
-        }) : t
+    function ce(e, t) {
+        const s = h(t);
+        return s !== t && (s.style.backfaceVisibility = "hidden", s.style["-webkit-backface-visibility"] = "hidden"), s
     }
 
-    function ae(e) {
+    function pe(e) {
         let {
             swiper: t,
             duration: s,
-            transformEl: a,
+            transformElements: a,
             allSlides: i
         } = e;
         const {
-            slides: r,
-            activeIndex: n,
-            $wrapperEl: l
+            activeIndex: r
         } = t;
         if (t.params.virtualTranslate && 0 !== s) {
             let e, s = !1;
-            e = i ? a ? r.find(a) : r : a ? r.eq(n).find(a) : r.eq(n), e.transitionEnd((() => {
-                if (s) return;
-                if (!t || t.destroyed) return;
-                s = !0, t.animating = !1;
-                const e = ["webkitTransitionEnd", "transitionend"];
-                for (let t = 0; t < e.length; t += 1) l.trigger(e[t])
+            e = i ? a : a.filter((e => {
+                const s = e.classList.contains("swiper-slide-transform") ? (e => {
+                    if (!e.parentElement) return t.slides.filter((t => t.shadowRoot && t.shadowRoot === e.parentNode))[0];
+                    return e.parentElement
+                })(e) : e;
+                return t.getSlideIndex(s) === r
+            })), e.forEach((e => {
+                x(e, (() => {
+                    if (s) return;
+                    if (!t || t.destroyed) return;
+                    s = !0, t.animating = !1;
+                    const e = new window.CustomEvent("transitionend", {
+                        bubbles: !0,
+                        cancelable: !0
+                    });
+                    t.wrapperEl.dispatchEvent(e)
+                }))
             }))
         }
     }
 
-    function ie(e, t, s) {
-        const a = "swiper-slide-shadow" + (s ? `-${s}` : ""),
-            i = e.transformEl ? t.find(e.transformEl) : t;
-        let r = i.children(`.${a}`);
-        return r.length || (r = d(`<div class="swiper-slide-shadow${s?`-${s}`:""}"></div>`), i.append(r)), r
-    }
-    Object.keys(j).forEach((e => {
-        Object.keys(j[e]).forEach((t => {
-            V.prototype[t] = j[e][t]
+    function ue(e, t, s) {
+        const a = `swiper-slide-shadow${s?`-${s}`:""}${e?` swiper-slide-shadow-${e}`:""}`,
+            i = h(t);
+        let r = i.querySelector(`.${a.split(" ").join(".")}`);
+        return r || (r = v("div", a.split(" ")), i.append(r)), r
+    }
+    Object.keys(J).forEach((e => {
+        Object.keys(J[e]).forEach((t => {
+            te.prototype[t] = J[e][t]
         }))
-    })), V.use([function(e) {
+    })), te.use([function(e) {
         let {
             swiper: t,
             on: s,
             emit: a
         } = e;
         const i = r();
         let n = null,
@@ -2358,223 +2355,269 @@
             swiper: t,
             extendParams: s,
             on: a,
             emit: i
         } = e;
         const n = [],
             l = r(),
-            o = function(e, t) {
-                void 0 === t && (t = {});
-                const s = new(l.MutationObserver || l.WebkitMutationObserver)((e => {
+            o = function(e, s) {
+                void 0 === s && (s = {});
+                const a = new(l.MutationObserver || l.WebkitMutationObserver)((e => {
+                    if (t.__preventObserver__) return;
                     if (1 === e.length) return void i("observerUpdate", e[0]);
-                    const t = function() {
+                    const s = function() {
                         i("observerUpdate", e[0])
                     };
-                    l.requestAnimationFrame ? l.requestAnimationFrame(t) : l.setTimeout(t, 0)
+                    l.requestAnimationFrame ? l.requestAnimationFrame(s) : l.setTimeout(s, 0)
                 }));
-                s.observe(e, {
-                    attributes: void 0 === t.attributes || t.attributes,
-                    childList: void 0 === t.childList || t.childList,
-                    characterData: void 0 === t.characterData || t.characterData
-                }), n.push(s)
+                a.observe(e, {
+                    attributes: void 0 === s.attributes || s.attributes,
+                    childList: void 0 === s.childList || s.childList,
+                    characterData: void 0 === s.characterData || s.characterData
+                }), n.push(a)
             };
         s({
             observer: !1,
             observeParents: !1,
             observeSlideChildren: !1
         }), a("init", (() => {
             if (t.params.observer) {
                 if (t.params.observeParents) {
-                    const e = t.$el.parents();
+                    const e = E(t.hostEl);
                     for (let t = 0; t < e.length; t += 1) o(e[t])
                 }
-                o(t.$el[0], {
+                o(t.hostEl, {
                     childList: t.params.observeSlideChildren
-                }), o(t.$wrapperEl[0], {
+                }), o(t.wrapperEl, {
                     attributes: !1
                 })
             }
         })), a("destroy", (() => {
             n.forEach((e => {
                 e.disconnect()
             })), n.splice(0, n.length)
         }))
     }]);
-    const re = [function(e) {
+    const me = [function(e) {
         let t, {
             swiper: s,
-            extendParams: a,
-            on: i,
-            emit: r
+            extendParams: i,
+            on: r,
+            emit: n
         } = e;
+        i({
+            virtual: {
+                enabled: !1,
+                slides: [],
+                cache: !0,
+                renderSlide: null,
+                renderExternal: null,
+                renderExternalUpdate: !0,
+                addSlidesBefore: 0,
+                addSlidesAfter: 0
+            }
+        });
+        const l = a();
+        s.virtual = {
+            cache: {},
+            from: void 0,
+            to: void 0,
+            slides: [],
+            offset: 0,
+            slidesGrid: []
+        };
+        const o = l.createElement("div");
 
-        function n(e, t) {
+        function d(e, t) {
             const a = s.params.virtual;
             if (a.cache && s.virtual.cache[t]) return s.virtual.cache[t];
-            const i = a.renderSlide ? d(a.renderSlide.call(s, e, t)) : d(`<div class="${s.params.slideClass}" data-swiper-slide-index="${t}">${e}</div>`);
-            return i.attr("data-swiper-slide-index") || i.attr("data-swiper-slide-index", t), a.cache && (s.virtual.cache[t] = i), i
+            let i;
+            return a.renderSlide ? (i = a.renderSlide.call(s, e, t), "string" == typeof i && (o.innerHTML = i, i = o.children[0])) : i = s.isElement ? v("swiper-slide") : v("div", s.params.slideClass), i.setAttribute("data-swiper-slide-index", t), a.renderSlide || (i.innerHTML = e), a.cache && (s.virtual.cache[t] = i), i
         }
 
-        function l(e) {
+        function c(e) {
             const {
                 slidesPerView: t,
                 slidesPerGroup: a,
-                centeredSlides: i
+                centeredSlides: i,
+                loop: r
             } = s.params, {
                 addSlidesBefore: l,
                 addSlidesAfter: o
             } = s.params.virtual, {
-                from: d,
-                to: c,
-                slides: p,
-                slidesGrid: u,
+                from: c,
+                to: p,
+                slides: u,
+                slidesGrid: m,
                 offset: h
             } = s.virtual;
             s.params.cssMode || s.updateActiveIndex();
-            const m = s.activeIndex || 0;
-            let f, g, v;
-            f = s.rtlTranslate ? "right" : s.isHorizontal() ? "left" : "top", i ? (g = Math.floor(t / 2) + a + o, v = Math.floor(t / 2) + a + l) : (g = t + (a - 1) + o, v = a + l);
-            const w = Math.max((m || 0) - v, 0),
-                b = Math.min((m || 0) + g, p.length - 1),
-                x = (s.slidesGrid[w] || 0) - (s.slidesGrid[0] || 0);
-
-            function y() {
-                s.updateSlides(), s.updateProgress(), s.updateSlidesClasses(), s.lazy && s.params.lazy.enabled && s.lazy.load(), r("virtualUpdate")
-            }
-            if (Object.assign(s.virtual, {
-                    from: w,
-                    to: b,
+            const g = s.activeIndex || 0;
+            let v, w, b;
+            v = s.rtlTranslate ? "right" : s.isHorizontal() ? "left" : "top", i ? (w = Math.floor(t / 2) + a + o, b = Math.floor(t / 2) + a + l) : (w = t + (a - 1) + o, b = (r ? t : a) + l);
+            let y = g - b,
+                E = g + w;
+            r || (y = Math.max(y, 0), E = Math.min(E, u.length - 1));
+            let x = (s.slidesGrid[y] || 0) - (s.slidesGrid[0] || 0);
+
+            function S() {
+                s.updateSlides(), s.updateProgress(), s.updateSlidesClasses(), n("virtualUpdate")
+            }
+            if (r && g >= b ? (y -= b, i || (x += s.slidesGrid[0])) : r && g < b && (y = -b, i && (x += s.slidesGrid[0])), Object.assign(s.virtual, {
+                    from: y,
+                    to: E,
                     offset: x,
-                    slidesGrid: s.slidesGrid
-                }), d === w && c === b && !e) return s.slidesGrid !== u && x !== h && s.slides.css(f, `${x}px`), s.updateProgress(), void r("virtualUpdate");
+                    slidesGrid: s.slidesGrid,
+                    slidesBefore: b,
+                    slidesAfter: w
+                }), c === y && p === E && !e) return s.slidesGrid !== m && x !== h && s.slides.forEach((e => {
+                e.style[v] = x - Math.abs(s.cssOverflowAdjustment()) + "px"
+            })), s.updateProgress(), void n("virtualUpdate");
             if (s.params.virtual.renderExternal) return s.params.virtual.renderExternal.call(s, {
                 offset: x,
-                from: w,
-                to: b,
+                from: y,
+                to: E,
                 slides: function() {
                     const e = [];
-                    for (let t = w; t <= b; t += 1) e.push(p[t]);
+                    for (let t = y; t <= E; t += 1) e.push(u[t]);
                     return e
                 }()
-            }), void(s.params.virtual.renderExternalUpdate ? y() : r("virtualUpdate"));
-            const E = [],
-                C = [];
-            if (e) s.$wrapperEl.find(`.${s.params.slideClass}`).remove();
+            }), void(s.params.virtual.renderExternalUpdate ? S() : n("virtualUpdate"));
+            const T = [],
+                M = [],
+                C = e => {
+                    let t = e;
+                    return e < 0 ? t = u.length + e : t >= u.length && (t -= u.length), t
+                };
+            if (e) s.slides.filter((e => e.matches(`.${s.params.slideClass}, swiper-slide`))).forEach((e => {
+                e.remove()
+            }));
             else
-                for (let e = d; e <= c; e += 1)(e < w || e > b) && s.$wrapperEl.find(`.${s.params.slideClass}[data-swiper-slide-index="${e}"]`).remove();
-            for (let t = 0; t < p.length; t += 1) t >= w && t <= b && (void 0 === c || e ? C.push(t) : (t > c && C.push(t), t < d && E.push(t)));
-            C.forEach((e => {
-                s.$wrapperEl.append(n(p[e], e))
-            })), E.sort(((e, t) => t - e)).forEach((e => {
-                s.$wrapperEl.prepend(n(p[e], e))
-            })), s.$wrapperEl.children(".swiper-slide").css(f, `${x}px`), y()
+                for (let e = c; e <= p; e += 1)
+                    if (e < y || e > E) {
+                        const t = C(e);
+                        s.slides.filter((e => e.matches(`.${s.params.slideClass}[data-swiper-slide-index="${t}"], swiper-slide[data-swiper-slide-index="${t}"]`))).forEach((e => {
+                            e.remove()
+                        }))
+                    } const P = r ? -u.length : 0,
+                L = r ? 2 * u.length : u.length;
+            for (let t = P; t < L; t += 1)
+                if (t >= y && t <= E) {
+                    const s = C(t);
+                    void 0 === p || e ? M.push(s) : (t > p && M.push(s), t < c && T.push(s))
+                } if (M.forEach((e => {
+                    s.slidesEl.append(d(u[e], e))
+                })), r)
+                for (let e = T.length - 1; e >= 0; e -= 1) {
+                    const t = T[e];
+                    s.slidesEl.prepend(d(u[t], t))
+                } else T.sort(((e, t) => t - e)), T.forEach((e => {
+                    s.slidesEl.prepend(d(u[e], e))
+                }));
+            f(s.slidesEl, ".swiper-slide, swiper-slide").forEach((e => {
+                e.style[v] = x - Math.abs(s.cssOverflowAdjustment()) + "px"
+            })), S()
         }
-        a({
-            virtual: {
-                enabled: !1,
-                slides: [],
-                cache: !0,
-                renderSlide: null,
-                renderExternal: null,
-                renderExternalUpdate: !0,
-                addSlidesBefore: 0,
-                addSlidesAfter: 0
+        r("beforeInit", (() => {
+            if (!s.params.virtual.enabled) return;
+            let e;
+            if (void 0 === s.passedParams.virtual.slides) {
+                const t = [...s.slidesEl.children].filter((e => e.matches(`.${s.params.slideClass}, swiper-slide`)));
+                t && t.length && (s.virtual.slides = [...t], e = !0, t.forEach(((e, t) => {
+                    e.setAttribute("data-swiper-slide-index", t), s.virtual.cache[t] = e, e.remove()
+                })))
             }
-        }), s.virtual = {
-            cache: {},
-            from: void 0,
-            to: void 0,
-            slides: [],
-            offset: 0,
-            slidesGrid: []
-        }, i("beforeInit", (() => {
-            s.params.virtual.enabled && (s.virtual.slides = s.params.virtual.slides, s.classNames.push(`${s.params.containerModifierClass}virtual`), s.params.watchSlidesProgress = !0, s.originalParams.watchSlidesProgress = !0, s.params.initialSlide || l())
-        })), i("setTranslate", (() => {
+            e || (s.virtual.slides = s.params.virtual.slides), s.classNames.push(`${s.params.containerModifierClass}virtual`), s.params.watchSlidesProgress = !0, s.originalParams.watchSlidesProgress = !0, c()
+        })), r("setTranslate", (() => {
             s.params.virtual.enabled && (s.params.cssMode && !s._immediateVirtual ? (clearTimeout(t), t = setTimeout((() => {
-                l()
-            }), 100)) : l())
-        })), i("init update resize", (() => {
-            s.params.virtual.enabled && s.params.cssMode && v(s.wrapperEl, "--swiper-virtual-size", `${s.virtualSize}px`)
+                c()
+            }), 100)) : c())
+        })), r("init update resize", (() => {
+            s.params.virtual.enabled && s.params.cssMode && u(s.wrapperEl, "--swiper-virtual-size", `${s.virtualSize}px`)
         })), Object.assign(s.virtual, {
             appendSlide: function(e) {
                 if ("object" == typeof e && "length" in e)
                     for (let t = 0; t < e.length; t += 1) e[t] && s.virtual.slides.push(e[t]);
                 else s.virtual.slides.push(e);
-                l(!0)
+                c(!0)
             },
             prependSlide: function(e) {
                 const t = s.activeIndex;
                 let a = t + 1,
                     i = 1;
                 if (Array.isArray(e)) {
                     for (let t = 0; t < e.length; t += 1) e[t] && s.virtual.slides.unshift(e[t]);
                     a = t + e.length, i = e.length
                 } else s.virtual.slides.unshift(e);
                 if (s.params.virtual.cache) {
                     const e = s.virtual.cache,
                         t = {};
                     Object.keys(e).forEach((s => {
                         const a = e[s],
-                            r = a.attr("data-swiper-slide-index");
-                        r && a.attr("data-swiper-slide-index", parseInt(r, 10) + i), t[parseInt(s, 10) + i] = a
+                            r = a.getAttribute("data-swiper-slide-index");
+                        r && a.setAttribute("data-swiper-slide-index", parseInt(r, 10) + i), t[parseInt(s, 10) + i] = a
                     })), s.virtual.cache = t
                 }
-                l(!0), s.slideTo(a, 0)
+                c(!0), s.slideTo(a, 0)
             },
             removeSlide: function(e) {
                 if (null == e) return;
                 let t = s.activeIndex;
                 if (Array.isArray(e))
-                    for (let a = e.length - 1; a >= 0; a -= 1) s.virtual.slides.splice(e[a], 1), s.params.virtual.cache && delete s.virtual.cache[e[a]], e[a] < t && (t -= 1), t = Math.max(t, 0);
-                else s.virtual.slides.splice(e, 1), s.params.virtual.cache && delete s.virtual.cache[e], e < t && (t -= 1), t = Math.max(t, 0);
-                l(!0), s.slideTo(t, 0)
+                    for (let a = e.length - 1; a >= 0; a -= 1) s.params.virtual.cache && (delete s.virtual.cache[e[a]], Object.keys(s.virtual.cache).forEach((t => {
+                        t > e && (s.virtual.cache[t - 1] = s.virtual.cache[t], s.virtual.cache[t - 1].setAttribute("data-swiper-slide-index", t - 1), delete s.virtual.cache[t])
+                    }))), s.virtual.slides.splice(e[a], 1), e[a] < t && (t -= 1), t = Math.max(t, 0);
+                else s.params.virtual.cache && (delete s.virtual.cache[e], Object.keys(s.virtual.cache).forEach((t => {
+                    t > e && (s.virtual.cache[t - 1] = s.virtual.cache[t], s.virtual.cache[t - 1].setAttribute("data-swiper-slide-index", t - 1), delete s.virtual.cache[t])
+                }))), s.virtual.slides.splice(e, 1), e < t && (t -= 1), t = Math.max(t, 0);
+                c(!0), s.slideTo(t, 0)
             },
             removeAllSlides: function() {
-                s.virtual.slides = [], s.params.virtual.cache && (s.virtual.cache = {}), l(!0), s.slideTo(0, 0)
+                s.virtual.slides = [], s.params.virtual.cache && (s.virtual.cache = {}), c(!0), s.slideTo(0, 0)
             },
-            update: l
+            update: c
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: i,
             emit: n
         } = e;
         const l = a(),
             o = r();
 
-        function c(e) {
+        function d(e) {
             if (!t.enabled) return;
             const {
                 rtlTranslate: s
             } = t;
             let a = e;
             a.originalEvent && (a = a.originalEvent);
             const i = a.keyCode || a.charCode,
                 r = t.params.keyboard.pageUpDown,
                 d = r && 33 === i,
                 c = r && 34 === i,
                 p = 37 === i,
                 u = 39 === i,
-                h = 38 === i,
-                m = 40 === i;
-            if (!t.allowSlideNext && (t.isHorizontal() && u || t.isVertical() && m || c)) return !1;
-            if (!t.allowSlidePrev && (t.isHorizontal() && p || t.isVertical() && h || d)) return !1;
+                m = 38 === i,
+                h = 40 === i;
+            if (!t.allowSlideNext && (t.isHorizontal() && u || t.isVertical() && h || c)) return !1;
+            if (!t.allowSlidePrev && (t.isHorizontal() && p || t.isVertical() && m || d)) return !1;
             if (!(a.shiftKey || a.altKey || a.ctrlKey || a.metaKey || l.activeElement && l.activeElement.nodeName && ("input" === l.activeElement.nodeName.toLowerCase() || "textarea" === l.activeElement.nodeName.toLowerCase()))) {
-                if (t.params.keyboard.onlyInViewport && (d || c || p || u || h || m)) {
+                if (t.params.keyboard.onlyInViewport && (d || c || p || u || m || h)) {
                     let e = !1;
-                    if (t.$el.parents(`.${t.params.slideClass}`).length > 0 && 0 === t.$el.parents(`.${t.params.slideActiveClass}`).length) return;
-                    const a = t.$el,
-                        i = a[0].clientWidth,
-                        r = a[0].clientHeight,
+                    if (E(t.el, `.${t.params.slideClass}, swiper-slide`).length > 0 && 0 === E(t.el, `.${t.params.slideActiveClass}`).length) return;
+                    const a = t.el,
+                        i = a.clientWidth,
+                        r = a.clientHeight,
                         n = o.innerWidth,
                         l = o.innerHeight,
-                        d = t.$el.offset();
-                    s && (d.left -= t.$el[0].scrollLeft);
+                        d = w(a);
+                    s && (d.left -= a.scrollLeft);
                     const c = [
                         [d.left, d.top],
                         [d.left + i, d.top],
                         [d.left, d.top + r],
                         [d.left + i, d.top + r]
                     ];
                     for (let t = 0; t < c.length; t += 1) {
@@ -2582,290 +2625,305 @@
                         if (s[0] >= 0 && s[0] <= n && s[1] >= 0 && s[1] <= l) {
                             if (0 === s[0] && 0 === s[1]) continue;
                             e = !0
                         }
                     }
                     if (!e) return
                 }
-                t.isHorizontal() ? ((d || c || p || u) && (a.preventDefault ? a.preventDefault() : a.returnValue = !1), ((c || u) && !s || (d || p) && s) && t.slideNext(), ((d || p) && !s || (c || u) && s) && t.slidePrev()) : ((d || c || h || m) && (a.preventDefault ? a.preventDefault() : a.returnValue = !1), (c || m) && t.slideNext(), (d || h) && t.slidePrev()), n("keyPress", i)
+                t.isHorizontal() ? ((d || c || p || u) && (a.preventDefault ? a.preventDefault() : a.returnValue = !1), ((c || u) && !s || (d || p) && s) && t.slideNext(), ((d || p) && !s || (c || u) && s) && t.slidePrev()) : ((d || c || m || h) && (a.preventDefault ? a.preventDefault() : a.returnValue = !1), (c || h) && t.slideNext(), (d || m) && t.slidePrev()), n("keyPress", i)
             }
         }
 
-        function p() {
-            t.keyboard.enabled || (d(l).on("keydown", c), t.keyboard.enabled = !0)
+        function c() {
+            t.keyboard.enabled || (l.addEventListener("keydown", d), t.keyboard.enabled = !0)
         }
 
-        function u() {
-            t.keyboard.enabled && (d(l).off("keydown", c), t.keyboard.enabled = !1)
+        function p() {
+            t.keyboard.enabled && (l.removeEventListener("keydown", d), t.keyboard.enabled = !1)
         }
         t.keyboard = {
             enabled: !1
         }, s({
             keyboard: {
                 enabled: !1,
                 onlyInViewport: !0,
                 pageUpDown: !0
             }
         }), i("init", (() => {
-            t.params.keyboard.enabled && p()
+            t.params.keyboard.enabled && c()
         })), i("destroy", (() => {
-            t.keyboard.enabled && u()
+            t.keyboard.enabled && p()
         })), Object.assign(t.keyboard, {
-            enable: p,
-            disable: u
+            enable: c,
+            disable: p
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a,
             emit: i
         } = e;
         const n = r();
-        let l;
+        let d;
         s({
             mousewheel: {
                 enabled: !1,
                 releaseOnEdges: !1,
                 invert: !1,
                 forceToAxis: !1,
                 sensitivity: 1,
                 eventsTarget: "container",
                 thresholdDelta: null,
-                thresholdTime: null
+                thresholdTime: null,
+                noMousewheelClass: "swiper-no-mousewheel"
             }
         }), t.mousewheel = {
             enabled: !1
         };
-        let o, c = u();
-        const h = [];
+        let c, p = o();
+        const u = [];
 
         function m() {
             t.enabled && (t.mouseEntered = !0)
         }
 
-        function f() {
+        function h() {
             t.enabled && (t.mouseEntered = !1)
         }
 
-        function g(e) {
-            return !(t.params.mousewheel.thresholdDelta && e.delta < t.params.mousewheel.thresholdDelta) && (!(t.params.mousewheel.thresholdTime && u() - c < t.params.mousewheel.thresholdTime) && (e.delta >= 6 && u() - c < 60 || (e.direction < 0 ? t.isEnd && !t.params.loop || t.animating || (t.slideNext(), i("scroll", e.raw)) : t.isBeginning && !t.params.loop || t.animating || (t.slidePrev(), i("scroll", e.raw)), c = (new n.Date).getTime(), !1)))
+        function f(e) {
+            return !(t.params.mousewheel.thresholdDelta && e.delta < t.params.mousewheel.thresholdDelta) && (!(t.params.mousewheel.thresholdTime && o() - p < t.params.mousewheel.thresholdTime) && (e.delta >= 6 && o() - p < 60 || (e.direction < 0 ? t.isEnd && !t.params.loop || t.animating || (t.slideNext(), i("scroll", e.raw)) : t.isBeginning && !t.params.loop || t.animating || (t.slidePrev(), i("scroll", e.raw)), p = (new n.Date).getTime(), !1)))
         }
 
-        function v(e) {
+        function g(e) {
             let s = e,
                 a = !0;
             if (!t.enabled) return;
+            if (e.target.closest(`.${t.params.mousewheel.noMousewheelClass}`)) return;
             const r = t.params.mousewheel;
             t.params.cssMode && s.preventDefault();
-            let n = t.$el;
-            if ("container" !== t.params.mousewheel.eventsTarget && (n = d(t.params.mousewheel.eventsTarget)), !t.mouseEntered && !n[0].contains(s.target) && !r.releaseOnEdges) return !0;
+            let n = t.el;
+            "container" !== t.params.mousewheel.eventsTarget && (n = document.querySelector(t.params.mousewheel.eventsTarget));
+            const p = n && n.contains(s.target);
+            if (!t.mouseEntered && !p && !r.releaseOnEdges) return !0;
             s.originalEvent && (s = s.originalEvent);
-            let c = 0;
-            const m = t.rtlTranslate ? -1 : 1,
-                f = function(e) {
+            let m = 0;
+            const h = t.rtlTranslate ? -1 : 1,
+                g = function(e) {
                     let t = 0,
                         s = 0,
                         a = 0,
                         i = 0;
                     return "detail" in e && (s = e.detail), "wheelDelta" in e && (s = -e.wheelDelta / 120), "wheelDeltaY" in e && (s = -e.wheelDeltaY / 120), "wheelDeltaX" in e && (t = -e.wheelDeltaX / 120), "axis" in e && e.axis === e.HORIZONTAL_AXIS && (t = s, s = 0), a = 10 * t, i = 10 * s, "deltaY" in e && (i = e.deltaY), "deltaX" in e && (a = e.deltaX), e.shiftKey && !a && (a = i, i = 0), (a || i) && e.deltaMode && (1 === e.deltaMode ? (a *= 40, i *= 40) : (a *= 800, i *= 800)), a && !t && (t = a < 1 ? -1 : 1), i && !s && (s = i < 1 ? -1 : 1), {
                         spinX: t,
                         spinY: s,
                         pixelX: a,
                         pixelY: i
                     }
                 }(s);
             if (r.forceToAxis)
                 if (t.isHorizontal()) {
-                    if (!(Math.abs(f.pixelX) > Math.abs(f.pixelY))) return !0;
-                    c = -f.pixelX * m
+                    if (!(Math.abs(g.pixelX) > Math.abs(g.pixelY))) return !0;
+                    m = -g.pixelX * h
                 } else {
-                    if (!(Math.abs(f.pixelY) > Math.abs(f.pixelX))) return !0;
-                    c = -f.pixelY
+                    if (!(Math.abs(g.pixelY) > Math.abs(g.pixelX))) return !0;
+                    m = -g.pixelY
                 }
-            else c = Math.abs(f.pixelX) > Math.abs(f.pixelY) ? -f.pixelX * m : -f.pixelY;
-            if (0 === c) return !0;
-            r.invert && (c = -c);
-            let v = t.getTranslate() + c * r.sensitivity;
+            else m = Math.abs(g.pixelX) > Math.abs(g.pixelY) ? -g.pixelX * h : -g.pixelY;
+            if (0 === m) return !0;
+            r.invert && (m = -m);
+            let v = t.getTranslate() + m * r.sensitivity;
             if (v >= t.minTranslate() && (v = t.minTranslate()), v <= t.maxTranslate() && (v = t.maxTranslate()), a = !!t.params.loop || !(v === t.minTranslate() || v === t.maxTranslate()), a && t.params.nested && s.stopPropagation(), t.params.freeMode && t.params.freeMode.enabled) {
                 const e = {
-                        time: u(),
-                        delta: Math.abs(c),
-                        direction: Math.sign(c)
+                        time: o(),
+                        delta: Math.abs(m),
+                        direction: Math.sign(m)
                     },
-                    a = o && e.time < o.time + 500 && e.delta <= o.delta && e.direction === o.direction;
+                    a = c && e.time < c.time + 500 && e.delta <= c.delta && e.direction === c.direction;
                 if (!a) {
-                    o = void 0, t.params.loop && t.loopFix();
-                    let n = t.getTranslate() + c * r.sensitivity;
-                    const d = t.isBeginning,
-                        u = t.isEnd;
-                    if (n >= t.minTranslate() && (n = t.minTranslate()), n <= t.maxTranslate() && (n = t.maxTranslate()), t.setTransition(0), t.setTranslate(n), t.updateProgress(), t.updateActiveIndex(), t.updateSlidesClasses(), (!d && t.isBeginning || !u && t.isEnd) && t.updateSlidesClasses(), t.params.freeMode.sticky) {
-                        clearTimeout(l), l = void 0, h.length >= 15 && h.shift();
-                        const s = h.length ? h[h.length - 1] : void 0,
-                            a = h[0];
-                        if (h.push(e), s && (e.delta > s.delta || e.direction !== s.direction)) h.splice(0);
-                        else if (h.length >= 15 && e.time - a.time < 500 && a.delta - e.delta >= 1 && e.delta <= 6) {
-                            const s = c > 0 ? .8 : .2;
-                            o = e, h.splice(0), l = p((() => {
+                    c = void 0;
+                    let n = t.getTranslate() + m * r.sensitivity;
+                    const o = t.isBeginning,
+                        p = t.isEnd;
+                    if (n >= t.minTranslate() && (n = t.minTranslate()), n <= t.maxTranslate() && (n = t.maxTranslate()), t.setTransition(0), t.setTranslate(n), t.updateProgress(), t.updateActiveIndex(), t.updateSlidesClasses(), (!o && t.isBeginning || !p && t.isEnd) && t.updateSlidesClasses(), t.params.loop && t.loopFix({
+                            direction: e.direction < 0 ? "next" : "prev",
+                            byMousewheel: !0
+                        }), t.params.freeMode.sticky) {
+                        clearTimeout(d), d = void 0, u.length >= 15 && u.shift();
+                        const s = u.length ? u[u.length - 1] : void 0,
+                            a = u[0];
+                        if (u.push(e), s && (e.delta > s.delta || e.direction !== s.direction)) u.splice(0);
+                        else if (u.length >= 15 && e.time - a.time < 500 && a.delta - e.delta >= 1 && e.delta <= 6) {
+                            const s = m > 0 ? .8 : .2;
+                            c = e, u.splice(0), d = l((() => {
                                 t.slideToClosest(t.params.speed, !0, void 0, s)
                             }), 0)
                         }
-                        l || (l = p((() => {
-                            o = e, h.splice(0), t.slideToClosest(t.params.speed, !0, void 0, .5)
+                        d || (d = l((() => {
+                            c = e, u.splice(0), t.slideToClosest(t.params.speed, !0, void 0, .5)
                         }), 500))
                     }
-                    if (a || i("scroll", s), t.params.autoplay && t.params.autoplayDisableOnInteraction && t.autoplay.stop(), n === t.minTranslate() || n === t.maxTranslate()) return !0
+                    if (a || i("scroll", s), t.params.autoplay && t.params.autoplayDisableOnInteraction && t.autoplay.stop(), r.releaseOnEdges && (n === t.minTranslate() || n === t.maxTranslate())) return !0
                 }
             } else {
                 const s = {
-                    time: u(),
-                    delta: Math.abs(c),
-                    direction: Math.sign(c),
+                    time: o(),
+                    delta: Math.abs(m),
+                    direction: Math.sign(m),
                     raw: e
                 };
-                h.length >= 2 && h.shift();
-                const a = h.length ? h[h.length - 1] : void 0;
-                if (h.push(s), a ? (s.direction !== a.direction || s.delta > a.delta || s.time > a.time + 150) && g(s) : g(s), function(e) {
+                u.length >= 2 && u.shift();
+                const a = u.length ? u[u.length - 1] : void 0;
+                if (u.push(s), a ? (s.direction !== a.direction || s.delta > a.delta || s.time > a.time + 150) && f(s) : f(s), function(e) {
                         const s = t.params.mousewheel;
                         if (e.direction < 0) {
                             if (t.isEnd && !t.params.loop && s.releaseOnEdges) return !0
                         } else if (t.isBeginning && !t.params.loop && s.releaseOnEdges) return !0;
                         return !1
                     }(s)) return !0
             }
             return s.preventDefault ? s.preventDefault() : s.returnValue = !1, !1
         }
 
-        function w(e) {
-            let s = t.$el;
-            "container" !== t.params.mousewheel.eventsTarget && (s = d(t.params.mousewheel.eventsTarget)), s[e]("mouseenter", m), s[e]("mouseleave", f), s[e]("wheel", v)
+        function v(e) {
+            let s = t.el;
+            "container" !== t.params.mousewheel.eventsTarget && (s = document.querySelector(t.params.mousewheel.eventsTarget)), s[e]("mouseenter", m), s[e]("mouseleave", h), s[e]("wheel", g)
         }
 
-        function b() {
-            return t.params.cssMode ? (t.wrapperEl.removeEventListener("wheel", v), !0) : !t.mousewheel.enabled && (w("on"), t.mousewheel.enabled = !0, !0)
+        function w() {
+            return t.params.cssMode ? (t.wrapperEl.removeEventListener("wheel", g), !0) : !t.mousewheel.enabled && (v("addEventListener"), t.mousewheel.enabled = !0, !0)
         }
 
-        function x() {
-            return t.params.cssMode ? (t.wrapperEl.addEventListener(event, v), !0) : !!t.mousewheel.enabled && (w("off"), t.mousewheel.enabled = !1, !0)
+        function b() {
+            return t.params.cssMode ? (t.wrapperEl.addEventListener(event, g), !0) : !!t.mousewheel.enabled && (v("removeEventListener"), t.mousewheel.enabled = !1, !0)
         }
         a("init", (() => {
-            !t.params.mousewheel.enabled && t.params.cssMode && x(), t.params.mousewheel.enabled && b()
+            !t.params.mousewheel.enabled && t.params.cssMode && b(), t.params.mousewheel.enabled && w()
         })), a("destroy", (() => {
-            t.params.cssMode && b(), t.mousewheel.enabled && x()
+            t.params.cssMode && w(), t.mousewheel.enabled && b()
         })), Object.assign(t.mousewheel, {
-            enable: b,
-            disable: x
+            enable: w,
+            disable: b
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a,
             emit: i
         } = e;
 
         function r(e) {
             let s;
-            return e && (s = d(e), t.params.uniqueNavElements && "string" == typeof e && s.length > 1 && 1 === t.$el.find(e).length && (s = t.$el.find(e))), s
+            return e && "string" == typeof e && t.isElement && (s = t.el.querySelector(e), s) ? s : (e && ("string" == typeof e && (s = [...document.querySelectorAll(e)]), t.params.uniqueNavElements && "string" == typeof e && s.length > 1 && 1 === t.el.querySelectorAll(e).length && (s = t.el.querySelector(e))), e && !s ? e : s)
         }
 
         function n(e, s) {
             const a = t.params.navigation;
-            e && e.length > 0 && (e[s ? "addClass" : "removeClass"](a.disabledClass), e[0] && "BUTTON" === e[0].tagName && (e[0].disabled = s), t.params.watchOverflow && t.enabled && e[t.isLocked ? "addClass" : "removeClass"](a.lockClass))
+            (e = T(e)).forEach((e => {
+                e && (e.classList[s ? "add" : "remove"](...a.disabledClass.split(" ")), "BUTTON" === e.tagName && (e.disabled = s), t.params.watchOverflow && t.enabled && e.classList[t.isLocked ? "add" : "remove"](a.lockClass))
+            }))
         }
 
         function l() {
-            if (t.params.loop) return;
             const {
-                $nextEl: e,
-                $prevEl: s
+                nextEl: e,
+                prevEl: s
             } = t.navigation;
+            if (t.params.loop) return n(s, !1), void n(e, !1);
             n(s, t.isBeginning && !t.params.rewind), n(e, t.isEnd && !t.params.rewind)
         }
 
         function o(e) {
             e.preventDefault(), (!t.isBeginning || t.params.loop || t.params.rewind) && (t.slidePrev(), i("navigationPrev"))
         }
 
-        function c(e) {
+        function d(e) {
             e.preventDefault(), (!t.isEnd || t.params.loop || t.params.rewind) && (t.slideNext(), i("navigationNext"))
         }
 
-        function p() {
+        function c() {
             const e = t.params.navigation;
-            if (t.params.navigation = F(t, t.originalParams.navigation, t.params.navigation, {
+            if (t.params.navigation = se(t, t.originalParams.navigation, t.params.navigation, {
                     nextEl: "swiper-button-next",
                     prevEl: "swiper-button-prev"
                 }), !e.nextEl && !e.prevEl) return;
-            const s = r(e.nextEl),
+            let s = r(e.nextEl),
                 a = r(e.prevEl);
-            s && s.length > 0 && s.on("click", c), a && a.length > 0 && a.on("click", o), Object.assign(t.navigation, {
-                $nextEl: s,
-                nextEl: s && s[0],
-                $prevEl: a,
-                prevEl: a && a[0]
-            }), t.enabled || (s && s.addClass(e.lockClass), a && a.addClass(e.lockClass))
+            Object.assign(t.navigation, {
+                nextEl: s,
+                prevEl: a
+            }), s = T(s), a = T(a);
+            const i = (s, a) => {
+                s && s.addEventListener("click", "next" === a ? d : o), !t.enabled && s && s.classList.add(...e.lockClass.split(" "))
+            };
+            s.forEach((e => i(e, "next"))), a.forEach((e => i(e, "prev")))
         }
 
-        function u() {
-            const {
-                $nextEl: e,
-                $prevEl: s
+        function p() {
+            let {
+                nextEl: e,
+                prevEl: s
             } = t.navigation;
-            e && e.length && (e.off("click", c), e.removeClass(t.params.navigation.disabledClass)), s && s.length && (s.off("click", o), s.removeClass(t.params.navigation.disabledClass))
+            e = T(e), s = T(s);
+            const a = (e, s) => {
+                e.removeEventListener("click", "next" === s ? d : o), e.classList.remove(...t.params.navigation.disabledClass.split(" "))
+            };
+            e.forEach((e => a(e, "next"))), s.forEach((e => a(e, "prev")))
         }
         s({
             navigation: {
                 nextEl: null,
                 prevEl: null,
                 hideOnClick: !1,
                 disabledClass: "swiper-button-disabled",
                 hiddenClass: "swiper-button-hidden",
                 lockClass: "swiper-button-lock",
                 navigationDisabledClass: "swiper-navigation-disabled"
             }
         }), t.navigation = {
             nextEl: null,
-            $nextEl: null,
-            prevEl: null,
-            $prevEl: null
+            prevEl: null
         }, a("init", (() => {
-            !1 === t.params.navigation.enabled ? h() : (p(), l())
+            !1 === t.params.navigation.enabled ? u() : (c(), l())
         })), a("toEdge fromEdge lock unlock", (() => {
             l()
         })), a("destroy", (() => {
-            u()
+            p()
         })), a("enable disable", (() => {
-            const {
-                $nextEl: e,
-                $prevEl: s
+            let {
+                nextEl: e,
+                prevEl: s
             } = t.navigation;
-            e && e[t.enabled ? "removeClass" : "addClass"](t.params.navigation.lockClass), s && s[t.enabled ? "removeClass" : "addClass"](t.params.navigation.lockClass)
+            e = T(e), s = T(s), t.enabled ? l() : [...e, ...s].filter((e => !!e)).forEach((e => e.classList.add(t.params.navigation.lockClass)))
         })), a("click", ((e, s) => {
-            const {
-                $nextEl: a,
-                $prevEl: r
-            } = t.navigation, n = s.target;
-            if (t.params.navigation.hideOnClick && !d(n).is(r) && !d(n).is(a)) {
+            let {
+                nextEl: a,
+                prevEl: r
+            } = t.navigation;
+            a = T(a), r = T(r);
+            const n = s.target;
+            if (t.params.navigation.hideOnClick && !r.includes(n) && !a.includes(n)) {
                 if (t.pagination && t.params.pagination && t.params.pagination.clickable && (t.pagination.el === n || t.pagination.el.contains(n))) return;
                 let e;
-                a ? e = a.hasClass(t.params.navigation.hiddenClass) : r && (e = r.hasClass(t.params.navigation.hiddenClass)), i(!0 === e ? "navigationShow" : "navigationHide"), a && a.toggleClass(t.params.navigation.hiddenClass), r && r.toggleClass(t.params.navigation.hiddenClass)
+                a.length ? e = a[0].classList.contains(t.params.navigation.hiddenClass) : r.length && (e = r[0].classList.contains(t.params.navigation.hiddenClass)), i(!0 === e ? "navigationShow" : "navigationHide"), [...a, ...r].filter((e => !!e)).forEach((e => e.classList.toggle(t.params.navigation.hiddenClass)))
             }
         }));
-        const h = () => {
-            t.$el.addClass(t.params.navigation.navigationDisabledClass), u()
+        const u = () => {
+            t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")), p()
         };
         Object.assign(t.navigation, {
             enable: () => {
-                t.$el.removeClass(t.params.navigation.navigationDisabledClass), p(), l()
+                t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")), c(), l()
             },
-            disable: h,
+            disable: u,
             update: l,
-            init: p,
-            destroy: u
+            init: c,
+            destroy: p
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a,
             emit: i
@@ -2900,303 +2958,331 @@
                 lockClass: `${r}-lock`,
                 horizontalClass: `${r}-horizontal`,
                 verticalClass: `${r}-vertical`,
                 paginationDisabledClass: `${r}-disabled`
             }
         }), t.pagination = {
             el: null,
-            $el: null,
             bullets: []
         };
         let l = 0;
 
         function o() {
-            return !t.params.pagination.el || !t.pagination.el || !t.pagination.$el || 0 === t.pagination.$el.length
+            return !t.params.pagination.el || !t.pagination.el || Array.isArray(t.pagination.el) && 0 === t.pagination.el.length
         }
 
-        function c(e, s) {
+        function d(e, s) {
             const {
                 bulletActiveClass: a
             } = t.params.pagination;
-            e[s]().addClass(`${a}-${s}`)[s]().addClass(`${a}-${s}-${s}`)
+            e && (e = e[("prev" === s ? "previous" : "next") + "ElementSibling"]) && (e.classList.add(`${a}-${s}`), (e = e[("prev" === s ? "previous" : "next") + "ElementSibling"]) && e.classList.add(`${a}-${s}-${s}`))
+        }
+
+        function c(e) {
+            const s = e.target.closest(ae(t.params.pagination.bulletClass));
+            if (!s) return;
+            e.preventDefault();
+            const a = y(s) * t.params.slidesPerGroup;
+            if (t.params.loop) {
+                if (t.realIndex === a) return;
+                t.slideToLoop(a)
+            } else t.slideTo(a)
         }
 
         function p() {
             const e = t.rtl,
                 s = t.params.pagination;
             if (o()) return;
-            const a = t.virtual && t.params.virtual.enabled ? t.virtual.slides.length : t.slides.length,
-                r = t.pagination.$el;
-            let p;
-            const u = t.params.loop ? Math.ceil((a - 2 * t.loopedSlides) / t.params.slidesPerGroup) : t.snapGrid.length;
-            if (t.params.loop ? (p = Math.ceil((t.activeIndex - t.loopedSlides) / t.params.slidesPerGroup), p > a - 1 - 2 * t.loopedSlides && (p -= a - 2 * t.loopedSlides), p > u - 1 && (p -= u), p < 0 && "bullets" !== t.params.paginationType && (p = u + p)) : p = void 0 !== t.snapIndex ? t.snapIndex : t.activeIndex || 0, "bullets" === s.type && t.pagination.bullets && t.pagination.bullets.length > 0) {
-                const a = t.pagination.bullets;
-                let i, o, u;
-                if (s.dynamicBullets && (n = a.eq(0)[t.isHorizontal() ? "outerWidth" : "outerHeight"](!0), r.css(t.isHorizontal() ? "width" : "height", n * (s.dynamicMainBullets + 4) + "px"), s.dynamicMainBullets > 1 && void 0 !== t.previousIndex && (l += p - (t.previousIndex - t.loopedSlides || 0), l > s.dynamicMainBullets - 1 ? l = s.dynamicMainBullets - 1 : l < 0 && (l = 0)), i = Math.max(p - l, 0), o = i + (Math.min(a.length, s.dynamicMainBullets) - 1), u = (o + i) / 2), a.removeClass(["", "-next", "-next-next", "-prev", "-prev-prev", "-main"].map((e => `${s.bulletActiveClass}${e}`)).join(" ")), r.length > 1) a.each((e => {
-                    const t = d(e),
-                        a = t.index();
-                    a === p && t.addClass(s.bulletActiveClass), s.dynamicBullets && (a >= i && a <= o && t.addClass(`${s.bulletActiveClass}-main`), a === i && c(t, "prev"), a === o && c(t, "next"))
+            let a, r, c = t.pagination.el;
+            c = T(c);
+            const p = t.virtual && t.params.virtual.enabled ? t.virtual.slides.length : t.slides.length,
+                u = t.params.loop ? Math.ceil(p / t.params.slidesPerGroup) : t.snapGrid.length;
+            if (t.params.loop ? (r = t.previousRealIndex || 0, a = t.params.slidesPerGroup > 1 ? Math.floor(t.realIndex / t.params.slidesPerGroup) : t.realIndex) : void 0 !== t.snapIndex ? (a = t.snapIndex, r = t.previousSnapIndex) : (r = t.previousIndex || 0, a = t.activeIndex || 0), "bullets" === s.type && t.pagination.bullets && t.pagination.bullets.length > 0) {
+                const i = t.pagination.bullets;
+                let o, p, u;
+                if (s.dynamicBullets && (n = S(i[0], t.isHorizontal() ? "width" : "height", !0), c.forEach((e => {
+                        e.style[t.isHorizontal() ? "width" : "height"] = n * (s.dynamicMainBullets + 4) + "px"
+                    })), s.dynamicMainBullets > 1 && void 0 !== r && (l += a - (r || 0), l > s.dynamicMainBullets - 1 ? l = s.dynamicMainBullets - 1 : l < 0 && (l = 0)), o = Math.max(a - l, 0), p = o + (Math.min(i.length, s.dynamicMainBullets) - 1), u = (p + o) / 2), i.forEach((e => {
+                        const t = [...["", "-next", "-next-next", "-prev", "-prev-prev", "-main"].map((e => `${s.bulletActiveClass}${e}`))].map((e => "string" == typeof e && e.includes(" ") ? e.split(" ") : e)).flat();
+                        e.classList.remove(...t)
+                    })), c.length > 1) i.forEach((e => {
+                    const i = y(e);
+                    i === a ? e.classList.add(...s.bulletActiveClass.split(" ")) : t.isElement && e.setAttribute("part", "bullet"), s.dynamicBullets && (i >= o && i <= p && e.classList.add(...`${s.bulletActiveClass}-main`.split(" ")), i === o && d(e, "prev"), i === p && d(e, "next"))
                 }));
                 else {
-                    const e = a.eq(p),
-                        r = e.index();
-                    if (e.addClass(s.bulletActiveClass), s.dynamicBullets) {
-                        const e = a.eq(i),
-                            n = a.eq(o);
-                        for (let e = i; e <= o; e += 1) a.eq(e).addClass(`${s.bulletActiveClass}-main`);
-                        if (t.params.loop)
-                            if (r >= a.length) {
-                                for (let e = s.dynamicMainBullets; e >= 0; e -= 1) a.eq(a.length - e).addClass(`${s.bulletActiveClass}-main`);
-                                a.eq(a.length - s.dynamicMainBullets - 1).addClass(`${s.bulletActiveClass}-prev`)
-                            } else c(e, "prev"), c(n, "next");
-                        else c(e, "prev"), c(n, "next")
+                    const e = i[a];
+                    if (e && e.classList.add(...s.bulletActiveClass.split(" ")), t.isElement && i.forEach(((e, t) => {
+                            e.setAttribute("part", t === a ? "bullet-active" : "bullet")
+                        })), s.dynamicBullets) {
+                        const e = i[o],
+                            t = i[p];
+                        for (let e = o; e <= p; e += 1) i[e] && i[e].classList.add(...`${s.bulletActiveClass}-main`.split(" "));
+                        d(e, "prev"), d(t, "next")
                     }
                 }
                 if (s.dynamicBullets) {
-                    const i = Math.min(a.length, s.dynamicMainBullets + 4),
-                        r = (n * i - n) / 2 - u * n,
+                    const a = Math.min(i.length, s.dynamicMainBullets + 4),
+                        r = (n * a - n) / 2 - u * n,
                         l = e ? "right" : "left";
-                    a.css(t.isHorizontal() ? l : "top", `${r}px`)
+                    i.forEach((e => {
+                        e.style[t.isHorizontal() ? l : "top"] = `${r}px`
+                    }))
                 }
             }
-            if ("fraction" === s.type && (r.find(U(s.currentClass)).text(s.formatFractionCurrent(p + 1)), r.find(U(s.totalClass)).text(s.formatFractionTotal(u))), "progressbar" === s.type) {
-                let e;
-                e = s.progressbarOpposite ? t.isHorizontal() ? "vertical" : "horizontal" : t.isHorizontal() ? "horizontal" : "vertical";
-                const a = (p + 1) / u;
-                let i = 1,
-                    n = 1;
-                "horizontal" === e ? i = a : n = a, r.find(U(s.progressbarFillClass)).transform(`translate3d(0,0,0) scaleX(${i}) scaleY(${n})`).transition(t.params.speed)
-            }
-            "custom" === s.type && s.renderCustom ? (r.html(s.renderCustom(t, p + 1, u)), i("paginationRender", r[0])) : i("paginationUpdate", r[0]), t.params.watchOverflow && t.enabled && r[t.isLocked ? "addClass" : "removeClass"](s.lockClass)
+            c.forEach(((e, r) => {
+                if ("fraction" === s.type && (e.querySelectorAll(ae(s.currentClass)).forEach((e => {
+                        e.textContent = s.formatFractionCurrent(a + 1)
+                    })), e.querySelectorAll(ae(s.totalClass)).forEach((e => {
+                        e.textContent = s.formatFractionTotal(u)
+                    }))), "progressbar" === s.type) {
+                    let i;
+                    i = s.progressbarOpposite ? t.isHorizontal() ? "vertical" : "horizontal" : t.isHorizontal() ? "horizontal" : "vertical";
+                    const r = (a + 1) / u;
+                    let n = 1,
+                        l = 1;
+                    "horizontal" === i ? n = r : l = r, e.querySelectorAll(ae(s.progressbarFillClass)).forEach((e => {
+                        e.style.transform = `translate3d(0,0,0) scaleX(${n}) scaleY(${l})`, e.style.transitionDuration = `${t.params.speed}ms`
+                    }))
+                }
+                "custom" === s.type && s.renderCustom ? (e.innerHTML = s.renderCustom(t, a + 1, u), 0 === r && i("paginationRender", e)) : (0 === r && i("paginationRender", e), i("paginationUpdate", e)), t.params.watchOverflow && t.enabled && e.classList[t.isLocked ? "add" : "remove"](s.lockClass)
+            }))
         }
 
         function u() {
             const e = t.params.pagination;
             if (o()) return;
-            const s = t.virtual && t.params.virtual.enabled ? t.virtual.slides.length : t.slides.length,
-                a = t.pagination.$el;
+            const s = t.virtual && t.params.virtual.enabled ? t.virtual.slides.length : t.grid && t.params.grid.rows > 1 ? t.slides.length / Math.ceil(t.params.grid.rows) : t.slides.length;
+            let a = t.pagination.el;
+            a = T(a);
             let r = "";
             if ("bullets" === e.type) {
-                let i = t.params.loop ? Math.ceil((s - 2 * t.loopedSlides) / t.params.slidesPerGroup) : t.snapGrid.length;
-                t.params.freeMode && t.params.freeMode.enabled && !t.params.loop && i > s && (i = s);
-                for (let s = 0; s < i; s += 1) e.renderBullet ? r += e.renderBullet.call(t, s, e.bulletClass) : r += `<${e.bulletElement} class="${e.bulletClass}"></${e.bulletElement}>`;
-                a.html(r), t.pagination.bullets = a.find(U(e.bulletClass))
-            }
-            "fraction" === e.type && (r = e.renderFraction ? e.renderFraction.call(t, e.currentClass, e.totalClass) : `<span class="${e.currentClass}"></span> / <span class="${e.totalClass}"></span>`, a.html(r)), "progressbar" === e.type && (r = e.renderProgressbar ? e.renderProgressbar.call(t, e.progressbarFillClass) : `<span class="${e.progressbarFillClass}"></span>`, a.html(r)), "custom" !== e.type && i("paginationRender", t.pagination.$el[0])
+                let a = t.params.loop ? Math.ceil(s / t.params.slidesPerGroup) : t.snapGrid.length;
+                t.params.freeMode && t.params.freeMode.enabled && a > s && (a = s);
+                for (let s = 0; s < a; s += 1) e.renderBullet ? r += e.renderBullet.call(t, s, e.bulletClass) : r += `<${e.bulletElement} ${t.isElement?'part="bullet"':""} class="${e.bulletClass}"></${e.bulletElement}>`
+            }
+            "fraction" === e.type && (r = e.renderFraction ? e.renderFraction.call(t, e.currentClass, e.totalClass) : `<span class="${e.currentClass}"></span> / <span class="${e.totalClass}"></span>`), "progressbar" === e.type && (r = e.renderProgressbar ? e.renderProgressbar.call(t, e.progressbarFillClass) : `<span class="${e.progressbarFillClass}"></span>`), t.pagination.bullets = [], a.forEach((s => {
+                "custom" !== e.type && (s.innerHTML = r || ""), "bullets" === e.type && t.pagination.bullets.push(...s.querySelectorAll(ae(e.bulletClass)))
+            })), "custom" !== e.type && i("paginationRender", a[0])
         }
 
-        function h() {
-            t.params.pagination = F(t, t.originalParams.pagination, t.params.pagination, {
+        function m() {
+            t.params.pagination = se(t, t.originalParams.pagination, t.params.pagination, {
                 el: "swiper-pagination"
             });
             const e = t.params.pagination;
             if (!e.el) return;
-            let s = d(e.el);
-            0 !== s.length && (t.params.uniqueNavElements && "string" == typeof e.el && s.length > 1 && (s = t.$el.find(e.el), s.length > 1 && (s = s.filter((e => d(e).parents(".swiper")[0] === t.el)))), "bullets" === e.type && e.clickable && s.addClass(e.clickableClass), s.addClass(e.modifierClass + e.type), s.addClass(t.isHorizontal() ? e.horizontalClass : e.verticalClass), "bullets" === e.type && e.dynamicBullets && (s.addClass(`${e.modifierClass}${e.type}-dynamic`), l = 0, e.dynamicMainBullets < 1 && (e.dynamicMainBullets = 1)), "progressbar" === e.type && e.progressbarOpposite && s.addClass(e.progressbarOppositeClass), e.clickable && s.on("click", U(e.bulletClass), (function(e) {
-                e.preventDefault();
-                let s = d(this).index() * t.params.slidesPerGroup;
-                t.params.loop && (s += t.loopedSlides), t.slideTo(s)
-            })), Object.assign(t.pagination, {
-                $el: s,
-                el: s[0]
-            }), t.enabled || s.addClass(e.lockClass))
+            let s;
+            "string" == typeof e.el && t.isElement && (s = t.el.querySelector(e.el)), s || "string" != typeof e.el || (s = [...document.querySelectorAll(e.el)]), s || (s = e.el), s && 0 !== s.length && (t.params.uniqueNavElements && "string" == typeof e.el && Array.isArray(s) && s.length > 1 && (s = [...t.el.querySelectorAll(e.el)], s.length > 1 && (s = s.filter((e => E(e, ".swiper")[0] === t.el))[0])), Array.isArray(s) && 1 === s.length && (s = s[0]), Object.assign(t.pagination, {
+                el: s
+            }), s = T(s), s.forEach((s => {
+                "bullets" === e.type && e.clickable && s.classList.add(...(e.clickableClass || "").split(" ")), s.classList.add(e.modifierClass + e.type), s.classList.add(t.isHorizontal() ? e.horizontalClass : e.verticalClass), "bullets" === e.type && e.dynamicBullets && (s.classList.add(`${e.modifierClass}${e.type}-dynamic`), l = 0, e.dynamicMainBullets < 1 && (e.dynamicMainBullets = 1)), "progressbar" === e.type && e.progressbarOpposite && s.classList.add(e.progressbarOppositeClass), e.clickable && s.addEventListener("click", c), t.enabled || s.classList.add(e.lockClass)
+            })))
         }
 
-        function m() {
+        function h() {
             const e = t.params.pagination;
             if (o()) return;
-            const s = t.pagination.$el;
-            s.removeClass(e.hiddenClass), s.removeClass(e.modifierClass + e.type), s.removeClass(t.isHorizontal() ? e.horizontalClass : e.verticalClass), t.pagination.bullets && t.pagination.bullets.removeClass && t.pagination.bullets.removeClass(e.bulletActiveClass), e.clickable && s.off("click", U(e.bulletClass))
+            let s = t.pagination.el;
+            s && (s = T(s), s.forEach((s => {
+                s.classList.remove(e.hiddenClass), s.classList.remove(e.modifierClass + e.type), s.classList.remove(t.isHorizontal() ? e.horizontalClass : e.verticalClass), e.clickable && (s.classList.remove(...(e.clickableClass || "").split(" ")), s.removeEventListener("click", c))
+            }))), t.pagination.bullets && t.pagination.bullets.forEach((t => t.classList.remove(...e.bulletActiveClass.split(" "))))
         }
-        a("init", (() => {
-            !1 === t.params.pagination.enabled ? f() : (h(), u(), p())
+        a("changeDirection", (() => {
+            if (!t.pagination || !t.pagination.el) return;
+            const e = t.params.pagination;
+            let {
+                el: s
+            } = t.pagination;
+            s = T(s), s.forEach((s => {
+                s.classList.remove(e.horizontalClass, e.verticalClass), s.classList.add(t.isHorizontal() ? e.horizontalClass : e.verticalClass)
+            }))
+        })), a("init", (() => {
+            !1 === t.params.pagination.enabled ? f() : (m(), u(), p())
         })), a("activeIndexChange", (() => {
-            (t.params.loop || void 0 === t.snapIndex) && p()
+            void 0 === t.snapIndex && p()
         })), a("snapIndexChange", (() => {
-            t.params.loop || p()
-        })), a("slidesLengthChange", (() => {
-            t.params.loop && (u(), p())
+            p()
         })), a("snapGridLengthChange", (() => {
-            t.params.loop || (u(), p())
+            u(), p()
         })), a("destroy", (() => {
-            m()
+            h()
         })), a("enable disable", (() => {
-            const {
-                $el: e
+            let {
+                el: e
             } = t.pagination;
-            e && e[t.enabled ? "removeClass" : "addClass"](t.params.pagination.lockClass)
+            e && (e = T(e), e.forEach((e => e.classList[t.enabled ? "remove" : "add"](t.params.pagination.lockClass))))
         })), a("lock unlock", (() => {
             p()
         })), a("click", ((e, s) => {
             const a = s.target,
-                {
-                    $el: r
-                } = t.pagination;
-            if (t.params.pagination.el && t.params.pagination.hideOnClick && r && r.length > 0 && !d(a).hasClass(t.params.pagination.bulletClass)) {
+                r = T(t.pagination.el);
+            if (t.params.pagination.el && t.params.pagination.hideOnClick && r && r.length > 0 && !a.classList.contains(t.params.pagination.bulletClass)) {
                 if (t.navigation && (t.navigation.nextEl && a === t.navigation.nextEl || t.navigation.prevEl && a === t.navigation.prevEl)) return;
-                const e = r.hasClass(t.params.pagination.hiddenClass);
-                i(!0 === e ? "paginationShow" : "paginationHide"), r.toggleClass(t.params.pagination.hiddenClass)
+                const e = r[0].classList.contains(t.params.pagination.hiddenClass);
+                i(!0 === e ? "paginationShow" : "paginationHide"), r.forEach((e => e.classList.toggle(t.params.pagination.hiddenClass)))
             }
         }));
         const f = () => {
-            t.$el.addClass(t.params.pagination.paginationDisabledClass), t.pagination.$el && t.pagination.$el.addClass(t.params.pagination.paginationDisabledClass), m()
+            t.el.classList.add(t.params.pagination.paginationDisabledClass);
+            let {
+                el: e
+            } = t.pagination;
+            e && (e = T(e), e.forEach((e => e.classList.add(t.params.pagination.paginationDisabledClass)))), h()
         };
         Object.assign(t.pagination, {
             enable: () => {
-                t.$el.removeClass(t.params.pagination.paginationDisabledClass), t.pagination.$el && t.pagination.$el.removeClass(t.params.pagination.paginationDisabledClass), h(), u(), p()
+                t.el.classList.remove(t.params.pagination.paginationDisabledClass);
+                let {
+                    el: e
+                } = t.pagination;
+                e && (e = T(e), e.forEach((e => e.classList.remove(t.params.pagination.paginationDisabledClass)))), m(), u(), p()
             },
             disable: f,
             render: u,
             update: p,
-            init: h,
-            destroy: m
+            init: m,
+            destroy: h
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: i,
             emit: r
         } = e;
-        const n = a();
-        let l, o, c, u, h = !1,
-            m = null,
+        const o = a();
+        let d, c, p, u, m = !1,
+            h = null,
             f = null;
 
         function g() {
             if (!t.params.scrollbar.el || !t.scrollbar.el) return;
             const {
                 scrollbar: e,
-                rtlTranslate: s,
-                progress: a
+                rtlTranslate: s
             } = t, {
-                $dragEl: i,
-                $el: r
-            } = e, n = t.params.scrollbar;
-            let l = o,
-                d = (c - o) * a;
-            s ? (d = -d, d > 0 ? (l = o - d, d = 0) : -d + o > c && (l = c + d)) : d < 0 ? (l = o + d, d = 0) : d + o > c && (l = c - d), t.isHorizontal() ? (i.transform(`translate3d(${d}px, 0, 0)`), i[0].style.width = `${l}px`) : (i.transform(`translate3d(0px, ${d}px, 0)`), i[0].style.height = `${l}px`), n.hide && (clearTimeout(m), r[0].style.opacity = 1, m = setTimeout((() => {
-                r[0].style.opacity = 0, r.transition(400)
+                dragEl: a,
+                el: i
+            } = e, r = t.params.scrollbar, n = t.params.loop ? t.progressLoop : t.progress;
+            let l = c,
+                o = (p - c) * n;
+            s ? (o = -o, o > 0 ? (l = c - o, o = 0) : -o + c > p && (l = p + o)) : o < 0 ? (l = c + o, o = 0) : o + c > p && (l = p - o), t.isHorizontal() ? (a.style.transform = `translate3d(${o}px, 0, 0)`, a.style.width = `${l}px`) : (a.style.transform = `translate3d(0px, ${o}px, 0)`, a.style.height = `${l}px`), r.hide && (clearTimeout(h), i.style.opacity = 1, h = setTimeout((() => {
+                i.style.opacity = 0, i.style.transitionDuration = "400ms"
             }), 1e3))
         }
 
-        function v() {
+        function b() {
             if (!t.params.scrollbar.el || !t.scrollbar.el) return;
             const {
                 scrollbar: e
             } = t, {
-                $dragEl: s,
-                $el: a
+                dragEl: s,
+                el: a
             } = e;
-            s[0].style.width = "", s[0].style.height = "", c = t.isHorizontal() ? a[0].offsetWidth : a[0].offsetHeight, u = t.size / (t.virtualSize + t.params.slidesOffsetBefore - (t.params.centeredSlides ? t.snapGrid[0] : 0)), o = "auto" === t.params.scrollbar.dragSize ? c * u : parseInt(t.params.scrollbar.dragSize, 10), t.isHorizontal() ? s[0].style.width = `${o}px` : s[0].style.height = `${o}px`, a[0].style.display = u >= 1 ? "none" : "", t.params.scrollbar.hide && (a[0].style.opacity = 0), t.params.watchOverflow && t.enabled && e.$el[t.isLocked ? "addClass" : "removeClass"](t.params.scrollbar.lockClass)
+            s.style.width = "", s.style.height = "", p = t.isHorizontal() ? a.offsetWidth : a.offsetHeight, u = t.size / (t.virtualSize + t.params.slidesOffsetBefore - (t.params.centeredSlides ? t.snapGrid[0] : 0)), c = "auto" === t.params.scrollbar.dragSize ? p * u : parseInt(t.params.scrollbar.dragSize, 10), t.isHorizontal() ? s.style.width = `${c}px` : s.style.height = `${c}px`, a.style.display = u >= 1 ? "none" : "", t.params.scrollbar.hide && (a.style.opacity = 0), t.params.watchOverflow && t.enabled && e.el.classList[t.isLocked ? "add" : "remove"](t.params.scrollbar.lockClass)
         }
 
-        function w(e) {
-            return t.isHorizontal() ? "touchstart" === e.type || "touchmove" === e.type ? e.targetTouches[0].clientX : e.clientX : "touchstart" === e.type || "touchmove" === e.type ? e.targetTouches[0].clientY : e.clientY
+        function y(e) {
+            return t.isHorizontal() ? e.clientX : e.clientY
         }
 
-        function b(e) {
+        function E(e) {
             const {
                 scrollbar: s,
                 rtlTranslate: a
             } = t, {
-                $el: i
+                el: i
             } = s;
             let r;
-            r = (w(e) - i.offset()[t.isHorizontal() ? "left" : "top"] - (null !== l ? l : o / 2)) / (c - o), r = Math.max(Math.min(r, 1), 0), a && (r = 1 - r);
+            r = (y(e) - w(i)[t.isHorizontal() ? "left" : "top"] - (null !== d ? d : c / 2)) / (p - c), r = Math.max(Math.min(r, 1), 0), a && (r = 1 - r);
             const n = t.minTranslate() + (t.maxTranslate() - t.minTranslate()) * r;
             t.updateProgress(n), t.setTranslate(n), t.updateActiveIndex(), t.updateSlidesClasses()
         }
 
         function x(e) {
             const s = t.params.scrollbar,
                 {
                     scrollbar: a,
-                    $wrapperEl: i
+                    wrapperEl: i
                 } = t,
                 {
-                    $el: n,
-                    $dragEl: o
+                    el: n,
+                    dragEl: l
                 } = a;
-            h = !0, l = e.target === o[0] || e.target === o ? w(e) - e.target.getBoundingClientRect()[t.isHorizontal() ? "left" : "top"] : null, e.preventDefault(), e.stopPropagation(), i.transition(100), o.transition(100), b(e), clearTimeout(f), n.transition(0), s.hide && n.css("opacity", 1), t.params.cssMode && t.$wrapperEl.css("scroll-snap-type", "none"), r("scrollbarDragStart", e)
+            m = !0, d = e.target === l ? y(e) - e.target.getBoundingClientRect()[t.isHorizontal() ? "left" : "top"] : null, e.preventDefault(), e.stopPropagation(), i.style.transitionDuration = "100ms", l.style.transitionDuration = "100ms", E(e), clearTimeout(f), n.style.transitionDuration = "0ms", s.hide && (n.style.opacity = 1), t.params.cssMode && (t.wrapperEl.style["scroll-snap-type"] = "none"), r("scrollbarDragStart", e)
         }
 
-        function y(e) {
+        function S(e) {
             const {
                 scrollbar: s,
-                $wrapperEl: a
+                wrapperEl: a
             } = t, {
-                $el: i,
-                $dragEl: n
+                el: i,
+                dragEl: n
             } = s;
-            h && (e.preventDefault ? e.preventDefault() : e.returnValue = !1, b(e), a.transition(0), i.transition(0), n.transition(0), r("scrollbarDragMove", e))
+            m && (e.preventDefault ? e.preventDefault() : e.returnValue = !1, E(e), a.style.transitionDuration = "0ms", i.style.transitionDuration = "0ms", n.style.transitionDuration = "0ms", r("scrollbarDragMove", e))
         }
 
-        function E(e) {
+        function M(e) {
             const s = t.params.scrollbar,
                 {
                     scrollbar: a,
-                    $wrapperEl: i
+                    wrapperEl: i
                 } = t,
                 {
-                    $el: n
+                    el: n
                 } = a;
-            h && (h = !1, t.params.cssMode && (t.$wrapperEl.css("scroll-snap-type", ""), i.transition("")), s.hide && (clearTimeout(f), f = p((() => {
-                n.css("opacity", 0), n.transition(400)
+            m && (m = !1, t.params.cssMode && (t.wrapperEl.style["scroll-snap-type"] = "", i.style.transitionDuration = ""), s.hide && (clearTimeout(f), f = l((() => {
+                n.style.opacity = 0, n.style.transitionDuration = "400ms"
             }), 1e3)), r("scrollbarDragEnd", e), s.snapOnRelease && t.slideToClosest())
         }
 
         function C(e) {
             const {
                 scrollbar: s,
-                touchEventsTouch: a,
-                touchEventsDesktop: i,
-                params: r,
-                support: l
-            } = t, o = s.$el;
-            if (!o) return;
-            const d = o[0],
-                c = !(!l.passiveListener || !r.passiveListeners) && {
+                params: a
+            } = t, i = s.el;
+            if (!i) return;
+            const r = i,
+                n = !!a.passiveListeners && {
                     passive: !1,
                     capture: !1
                 },
-                p = !(!l.passiveListener || !r.passiveListeners) && {
+                l = !!a.passiveListeners && {
                     passive: !0,
                     capture: !1
                 };
-            if (!d) return;
-            const u = "on" === e ? "addEventListener" : "removeEventListener";
-            l.touch ? (d[u](a.start, x, c), d[u](a.move, y, c), d[u](a.end, E, p)) : (d[u](i.start, x, c), n[u](i.move, y, c), n[u](i.end, E, p))
+            if (!r) return;
+            const d = "on" === e ? "addEventListener" : "removeEventListener";
+            r[d]("pointerdown", x, n), o[d]("pointermove", S, n), o[d]("pointerup", M, l)
         }
 
-        function T() {
+        function P() {
             const {
                 scrollbar: e,
-                $el: s
+                el: s
             } = t;
-            t.params.scrollbar = F(t, t.originalParams.scrollbar, t.params.scrollbar, {
+            t.params.scrollbar = se(t, t.originalParams.scrollbar, t.params.scrollbar, {
                 el: "swiper-scrollbar"
             });
             const a = t.params.scrollbar;
             if (!a.el) return;
-            let i = d(a.el);
-            t.params.uniqueNavElements && "string" == typeof a.el && i.length > 1 && 1 === s.find(a.el).length && (i = s.find(a.el)), i.addClass(t.isHorizontal() ? a.horizontalClass : a.verticalClass);
-            let r = i.find(`.${t.params.scrollbar.dragClass}`);
-            0 === r.length && (r = d(`<div class="${t.params.scrollbar.dragClass}"></div>`), i.append(r)), Object.assign(e, {
-                $el: i,
-                el: i[0],
-                $dragEl: r,
-                dragEl: r[0]
-            }), a.draggable && t.params.scrollbar.el && t.scrollbar.el && C("on"), i && i[t.enabled ? "removeClass" : "addClass"](t.params.scrollbar.lockClass)
+            let i, r;
+            if ("string" == typeof a.el && t.isElement && (i = t.el.querySelector(a.el)), i || "string" != typeof a.el) i || (i = a.el);
+            else if (i = o.querySelectorAll(a.el), !i.length) return;
+            t.params.uniqueNavElements && "string" == typeof a.el && i.length > 1 && 1 === s.querySelectorAll(a.el).length && (i = s.querySelector(a.el)), i.length > 0 && (i = i[0]), i.classList.add(t.isHorizontal() ? a.horizontalClass : a.verticalClass), i && (r = i.querySelector(ae(t.params.scrollbar.dragClass)), r || (r = v("div", t.params.scrollbar.dragClass), i.append(r))), Object.assign(e, {
+                el: i,
+                dragEl: r
+            }), a.draggable && t.params.scrollbar.el && t.scrollbar.el && C("on"), i && i.classList[t.enabled ? "remove" : "add"](...n(t.params.scrollbar.lockClass))
         }
 
-        function $() {
+        function L() {
             const e = t.params.scrollbar,
-                s = t.scrollbar.$el;
-            s && s.removeClass(t.isHorizontal() ? e.horizontalClass : e.verticalClass), t.params.scrollbar.el && t.scrollbar.el && C("off")
+                s = t.scrollbar.el;
+            s && s.classList.remove(...n(t.isHorizontal() ? e.horizontalClass : e.verticalClass)), t.params.scrollbar.el && t.scrollbar.el && C("off")
         }
         s({
             scrollbar: {
                 el: null,
                 dragSize: "auto",
                 hide: !1,
                 draggable: !1,
@@ -3205,143 +3291,160 @@
                 dragClass: "swiper-scrollbar-drag",
                 scrollbarDisabledClass: "swiper-scrollbar-disabled",
                 horizontalClass: "swiper-scrollbar-horizontal",
                 verticalClass: "swiper-scrollbar-vertical"
             }
         }), t.scrollbar = {
             el: null,
-            dragEl: null,
-            $el: null,
-            $dragEl: null
-        }, i("init", (() => {
-            !1 === t.params.scrollbar.enabled ? S() : (T(), v(), g())
-        })), i("update resize observerUpdate lock unlock", (() => {
-            v()
+            dragEl: null
+        }, i("changeDirection", (() => {
+            if (!t.scrollbar || !t.scrollbar.el) return;
+            const e = t.params.scrollbar;
+            let {
+                el: s
+            } = t.scrollbar;
+            s = T(s), s.forEach((s => {
+                s.classList.remove(e.horizontalClass, e.verticalClass), s.classList.add(t.isHorizontal() ? e.horizontalClass : e.verticalClass)
+            }))
+        })), i("init", (() => {
+            !1 === t.params.scrollbar.enabled ? I() : (P(), b(), g())
+        })), i("update resize observerUpdate lock unlock changeDirection", (() => {
+            b()
         })), i("setTranslate", (() => {
             g()
         })), i("setTransition", ((e, s) => {
             ! function(e) {
-                t.params.scrollbar.el && t.scrollbar.el && t.scrollbar.$dragEl.transition(e)
+                t.params.scrollbar.el && t.scrollbar.el && (t.scrollbar.dragEl.style.transitionDuration = `${e}ms`)
             }(s)
         })), i("enable disable", (() => {
             const {
-                $el: e
+                el: e
             } = t.scrollbar;
-            e && e[t.enabled ? "removeClass" : "addClass"](t.params.scrollbar.lockClass)
+            e && e.classList[t.enabled ? "remove" : "add"](...n(t.params.scrollbar.lockClass))
         })), i("destroy", (() => {
-            $()
+            L()
         }));
-        const S = () => {
-            t.$el.addClass(t.params.scrollbar.scrollbarDisabledClass), t.scrollbar.$el && t.scrollbar.$el.addClass(t.params.scrollbar.scrollbarDisabledClass), $()
+        const I = () => {
+            t.el.classList.add(...n(t.params.scrollbar.scrollbarDisabledClass)), t.scrollbar.el && t.scrollbar.el.classList.add(...n(t.params.scrollbar.scrollbarDisabledClass)), L()
         };
         Object.assign(t.scrollbar, {
             enable: () => {
-                t.$el.removeClass(t.params.scrollbar.scrollbarDisabledClass), t.scrollbar.$el && t.scrollbar.$el.removeClass(t.params.scrollbar.scrollbarDisabledClass), T(), v(), g()
+                t.el.classList.remove(...n(t.params.scrollbar.scrollbarDisabledClass)), t.scrollbar.el && t.scrollbar.el.classList.remove(...n(t.params.scrollbar.scrollbarDisabledClass)), P(), b(), g()
             },
-            disable: S,
-            updateSize: v,
+            disable: I,
+            updateSize: b,
             setTranslate: g,
-            init: T,
-            destroy: $
+            init: P,
+            destroy: L
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a
         } = e;
         s({
             parallax: {
                 enabled: !1
             }
         });
-        const i = (e, s) => {
+        const i = "[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]",
+            r = (e, s) => {
                 const {
                     rtl: a
-                } = t, i = d(e), r = a ? -1 : 1, n = i.attr("data-swiper-parallax") || "0";
-                let l = i.attr("data-swiper-parallax-x"),
-                    o = i.attr("data-swiper-parallax-y");
-                const c = i.attr("data-swiper-parallax-scale"),
-                    p = i.attr("data-swiper-parallax-opacity");
-                if (l || o ? (l = l || "0", o = o || "0") : t.isHorizontal() ? (l = n, o = "0") : (o = n, l = "0"), l = l.indexOf("%") >= 0 ? parseInt(l, 10) * s * r + "%" : l * s * r + "px", o = o.indexOf("%") >= 0 ? parseInt(o, 10) * s + "%" : o * s + "px", null != p) {
-                    const e = p - (p - 1) * (1 - Math.abs(s));
-                    i[0].style.opacity = e
+                } = t, i = a ? -1 : 1, r = e.getAttribute("data-swiper-parallax") || "0";
+                let n = e.getAttribute("data-swiper-parallax-x"),
+                    l = e.getAttribute("data-swiper-parallax-y");
+                const o = e.getAttribute("data-swiper-parallax-scale"),
+                    d = e.getAttribute("data-swiper-parallax-opacity"),
+                    c = e.getAttribute("data-swiper-parallax-rotate");
+                if (n || l ? (n = n || "0", l = l || "0") : t.isHorizontal() ? (n = r, l = "0") : (l = r, n = "0"), n = n.indexOf("%") >= 0 ? parseInt(n, 10) * s * i + "%" : n * s * i + "px", l = l.indexOf("%") >= 0 ? parseInt(l, 10) * s + "%" : l * s + "px", null != d) {
+                    const t = d - (d - 1) * (1 - Math.abs(s));
+                    e.style.opacity = t
+                }
+                let p = `translate3d(${n}, ${l}, 0px)`;
+                if (null != o) {
+                    p += ` scale(${o-(o-1)*(1-Math.abs(s))})`
                 }
-                if (null == c) i.transform(`translate3d(${l}, ${o}, 0px)`);
-                else {
-                    const e = c - (c - 1) * (1 - Math.abs(s));
-                    i.transform(`translate3d(${l}, ${o}, 0px) scale(${e})`)
+                if (c && null != c) {
+                    p += ` rotate(${c*s*-1}deg)`
                 }
+                e.style.transform = p
             },
-            r = () => {
+            n = () => {
                 const {
-                    $el: e,
+                    el: e,
                     slides: s,
                     progress: a,
-                    snapGrid: r
-                } = t;
-                e.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]").each((e => {
-                    i(e, a)
-                })), s.each(((e, s) => {
-                    let n = e.progress;
-                    t.params.slidesPerGroup > 1 && "auto" !== t.params.slidesPerView && (n += Math.ceil(s / 2) - a * (r.length - 1)), n = Math.min(Math.max(n, -1), 1), d(e).find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]").each((e => {
-                        i(e, n)
+                    snapGrid: n,
+                    isElement: l
+                } = t, o = f(e, i);
+                t.isElement && o.push(...f(t.hostEl, i)), o.forEach((e => {
+                    r(e, a)
+                })), s.forEach(((e, s) => {
+                    let l = e.progress;
+                    t.params.slidesPerGroup > 1 && "auto" !== t.params.slidesPerView && (l += Math.ceil(s / 2) - a * (n.length - 1)), l = Math.min(Math.max(l, -1), 1), e.querySelectorAll(`${i}, [data-swiper-parallax-rotate]`).forEach((e => {
+                        r(e, l)
                     }))
                 }))
             };
         a("beforeInit", (() => {
             t.params.parallax.enabled && (t.params.watchSlidesProgress = !0, t.originalParams.watchSlidesProgress = !0)
         })), a("init", (() => {
-            t.params.parallax.enabled && r()
+            t.params.parallax.enabled && n()
         })), a("setTranslate", (() => {
-            t.params.parallax.enabled && r()
+            t.params.parallax.enabled && n()
         })), a("setTransition", ((e, s) => {
             t.params.parallax.enabled && function(e) {
                 void 0 === e && (e = t.params.speed);
                 const {
-                    $el: s
-                } = t;
-                s.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]").each((t => {
-                    const s = d(t);
-                    let a = parseInt(s.attr("data-swiper-parallax-duration"), 10) || e;
-                    0 === e && (a = 0), s.transition(a)
+                    el: s,
+                    hostEl: a
+                } = t, r = [...s.querySelectorAll(i)];
+                t.isElement && r.push(...a.querySelectorAll(i)), r.forEach((t => {
+                    let s = parseInt(t.getAttribute("data-swiper-parallax-duration"), 10) || e;
+                    0 === e && (s = 0), t.style.transitionDuration = `${s}ms`
                 }))
             }(s)
         }))
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a,
             emit: i
         } = e;
         const n = r();
         s({
             zoom: {
                 enabled: !1,
+                limitToOriginalSize: !1,
                 maxRatio: 3,
                 minRatio: 1,
                 toggle: !0,
                 containerClass: "swiper-zoom-container",
                 zoomedSlideClass: "swiper-slide-zoomed"
             }
         }), t.zoom = {
             enabled: !1
         };
-        let l, o, c, p = 1,
-            u = !1;
-        const m = {
-                $slideEl: void 0,
+        let l, o, c = 1,
+            p = !1;
+        const u = [],
+            m = {
+                originX: 0,
+                originY: 0,
+                slideEl: void 0,
                 slideWidth: void 0,
                 slideHeight: void 0,
-                $imageEl: void 0,
-                $imageWrapEl: void 0,
+                imageEl: void 0,
+                imageWrapEl: void 0,
                 maxRatio: 3
             },
-            f = {
+            h = {
                 isTouched: void 0,
                 isMoved: void 0,
                 currentX: void 0,
                 currentY: void 0,
                 minX: void 0,
                 minY: void 0,
                 maxX: void 0,
@@ -3358,362 +3461,236 @@
                 y: void 0,
                 prevPositionX: void 0,
                 prevPositionY: void 0,
                 prevTime: void 0
             };
         let v = 1;
 
-        function w(e) {
-            if (e.targetTouches.length < 2) return 1;
-            const t = e.targetTouches[0].pageX,
-                s = e.targetTouches[0].pageY,
-                a = e.targetTouches[1].pageX,
-                i = e.targetTouches[1].pageY;
-            return Math.sqrt((a - t) ** 2 + (i - s) ** 2)
-        }
-
-        function b(e) {
-            const s = t.support,
-                a = t.params.zoom;
-            if (o = !1, c = !1, !s.gestures) {
-                if ("touchstart" !== e.type || "touchstart" === e.type && e.targetTouches.length < 2) return;
-                o = !0, m.scaleStart = w(e)
+        function b() {
+            if (u.length < 2) return 1;
+            const e = u[0].pageX,
+                t = u[0].pageY,
+                s = u[1].pageX,
+                a = u[1].pageY;
+            return Math.sqrt((s - e) ** 2 + (a - t) ** 2)
+        }
+
+        function y() {
+            const e = t.params.zoom,
+                s = m.imageWrapEl.getAttribute("data-swiper-zoom") || e.maxRatio;
+            if (e.limitToOriginalSize && m.imageEl && m.imageEl.naturalWidth) {
+                const e = m.imageEl.naturalWidth / m.imageEl.offsetWidth;
+                return Math.min(e, s)
             }
-            m.$slideEl && m.$slideEl.length || (m.$slideEl = d(e.target).closest(`.${t.params.slideClass}`), 0 === m.$slideEl.length && (m.$slideEl = t.slides.eq(t.activeIndex)), m.$imageEl = m.$slideEl.find(`.${a.containerClass}`).eq(0).find("picture, img, svg, canvas, .swiper-zoom-target").eq(0), m.$imageWrapEl = m.$imageEl.parent(`.${a.containerClass}`), m.maxRatio = m.$imageWrapEl.attr("data-swiper-zoom") || a.maxRatio, 0 !== m.$imageWrapEl.length) ? (m.$imageEl && m.$imageEl.transition(0), u = !0) : m.$imageEl = void 0
+            return s
         }
 
         function x(e) {
-            const s = t.support,
-                a = t.params.zoom,
-                i = t.zoom;
-            if (!s.gestures) {
-                if ("touchmove" !== e.type || "touchmove" === e.type && e.targetTouches.length < 2) return;
-                c = !0, m.scaleMove = w(e)
-            }
-            m.$imageEl && 0 !== m.$imageEl.length ? (s.gestures ? i.scale = e.scale * p : i.scale = m.scaleMove / m.scaleStart * p, i.scale > m.maxRatio && (i.scale = m.maxRatio - 1 + (i.scale - m.maxRatio + 1) ** .5), i.scale < a.minRatio && (i.scale = a.minRatio + 1 - (a.minRatio - i.scale + 1) ** .5), m.$imageEl.transform(`translate3d(0,0,0) scale(${i.scale})`)) : "gesturechange" === e.type && b(e)
+            const s = t.isElement ? "swiper-slide" : `.${t.params.slideClass}`;
+            return !!e.target.matches(s) || t.slides.filter((t => t.contains(e.target))).length > 0
         }
 
-        function y(e) {
-            const s = t.device,
-                a = t.support,
-                i = t.params.zoom,
-                r = t.zoom;
-            if (!a.gestures) {
-                if (!o || !c) return;
-                if ("touchend" !== e.type || "touchend" === e.type && e.changedTouches.length < 2 && !s.android) return;
-                o = !1, c = !1
+        function S(e) {
+            if ("mouse" === e.pointerType && u.splice(0, u.length), !x(e)) return;
+            const s = t.params.zoom;
+            if (l = !1, o = !1, u.push(e), !(u.length < 2)) {
+                if (l = !0, m.scaleStart = b(), !m.slideEl) {
+                    m.slideEl = e.target.closest(`.${t.params.slideClass}, swiper-slide`), m.slideEl || (m.slideEl = t.slides[t.activeIndex]);
+                    let a = m.slideEl.querySelector(`.${s.containerClass}`);
+                    if (a && (a = a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]), m.imageEl = a, m.imageWrapEl = a ? E(m.imageEl, `.${s.containerClass}`)[0] : void 0, !m.imageWrapEl) return void(m.imageEl = void 0);
+                    m.maxRatio = y()
+                }
+                if (m.imageEl) {
+                    const [e, t] = function() {
+                        if (u.length < 2) return {
+                            x: null,
+                            y: null
+                        };
+                        const e = m.imageEl.getBoundingClientRect();
+                        return [(u[0].pageX + (u[1].pageX - u[0].pageX) / 2 - e.x - n.scrollX) / c, (u[0].pageY + (u[1].pageY - u[0].pageY) / 2 - e.y - n.scrollY) / c]
+                    }();
+                    m.originX = e, m.originY = t, m.imageEl.style.transitionDuration = "0ms"
+                }
+                p = !0
             }
-            m.$imageEl && 0 !== m.$imageEl.length && (r.scale = Math.max(Math.min(r.scale, m.maxRatio), i.minRatio), m.$imageEl.transition(t.params.speed).transform(`translate3d(0,0,0) scale(${r.scale})`), p = r.scale, u = !1, 1 === r.scale && (m.$slideEl = void 0))
         }
 
-        function E(e) {
+        function T(e) {
+            if (!x(e)) return;
+            const s = t.params.zoom,
+                a = t.zoom,
+                i = u.findIndex((t => t.pointerId === e.pointerId));
+            i >= 0 && (u[i] = e), u.length < 2 || (o = !0, m.scaleMove = b(), m.imageEl && (a.scale = m.scaleMove / m.scaleStart * c, a.scale > m.maxRatio && (a.scale = m.maxRatio - 1 + (a.scale - m.maxRatio + 1) ** .5), a.scale < s.minRatio && (a.scale = s.minRatio + 1 - (s.minRatio - a.scale + 1) ** .5), m.imageEl.style.transform = `translate3d(0,0,0) scale(${a.scale})`))
+        }
+
+        function M(e) {
+            if (!x(e)) return;
+            if ("mouse" === e.pointerType && "pointerout" === e.type) return;
+            const s = t.params.zoom,
+                a = t.zoom,
+                i = u.findIndex((t => t.pointerId === e.pointerId));
+            i >= 0 && u.splice(i, 1), l && o && (l = !1, o = !1, m.imageEl && (a.scale = Math.max(Math.min(a.scale, m.maxRatio), s.minRatio), m.imageEl.style.transitionDuration = `${t.params.speed}ms`, m.imageEl.style.transform = `translate3d(0,0,0) scale(${a.scale})`, c = a.scale, p = !1, a.scale > 1 && m.slideEl ? m.slideEl.classList.add(`${s.zoomedSlideClass}`) : a.scale <= 1 && m.slideEl && m.slideEl.classList.remove(`${s.zoomedSlideClass}`), 1 === a.scale && (m.originX = 0, m.originY = 0, m.slideEl = void 0)))
+        }
+
+        function C(e) {
+            if (!x(e) || ! function(e) {
+                    const s = `.${t.params.zoom.containerClass}`;
+                    return !!e.target.matches(s) || [...t.hostEl.querySelectorAll(s)].filter((t => t.contains(e.target))).length > 0
+                }(e)) return;
             const s = t.zoom;
-            if (!m.$imageEl || 0 === m.$imageEl.length) return;
-            if (t.allowClick = !1, !f.isTouched || !m.$slideEl) return;
-            f.isMoved || (f.width = m.$imageEl[0].offsetWidth, f.height = m.$imageEl[0].offsetHeight, f.startX = h(m.$imageWrapEl[0], "x") || 0, f.startY = h(m.$imageWrapEl[0], "y") || 0, m.slideWidth = m.$slideEl[0].offsetWidth, m.slideHeight = m.$slideEl[0].offsetHeight, m.$imageWrapEl.transition(0));
-            const a = f.width * s.scale,
-                i = f.height * s.scale;
-            if (!(a < m.slideWidth && i < m.slideHeight)) {
-                if (f.minX = Math.min(m.slideWidth / 2 - a / 2, 0), f.maxX = -f.minX, f.minY = Math.min(m.slideHeight / 2 - i / 2, 0), f.maxY = -f.minY, f.touchesCurrent.x = "touchmove" === e.type ? e.targetTouches[0].pageX : e.pageX, f.touchesCurrent.y = "touchmove" === e.type ? e.targetTouches[0].pageY : e.pageY, !f.isMoved && !u) {
-                    if (t.isHorizontal() && (Math.floor(f.minX) === Math.floor(f.startX) && f.touchesCurrent.x < f.touchesStart.x || Math.floor(f.maxX) === Math.floor(f.startX) && f.touchesCurrent.x > f.touchesStart.x)) return void(f.isTouched = !1);
-                    if (!t.isHorizontal() && (Math.floor(f.minY) === Math.floor(f.startY) && f.touchesCurrent.y < f.touchesStart.y || Math.floor(f.maxY) === Math.floor(f.startY) && f.touchesCurrent.y > f.touchesStart.y)) return void(f.isTouched = !1)
-                }
-                e.cancelable && e.preventDefault(), e.stopPropagation(), f.isMoved = !0, f.currentX = f.touchesCurrent.x - f.touchesStart.x + f.startX, f.currentY = f.touchesCurrent.y - f.touchesStart.y + f.startY, f.currentX < f.minX && (f.currentX = f.minX + 1 - (f.minX - f.currentX + 1) ** .8), f.currentX > f.maxX && (f.currentX = f.maxX - 1 + (f.currentX - f.maxX + 1) ** .8), f.currentY < f.minY && (f.currentY = f.minY + 1 - (f.minY - f.currentY + 1) ** .8), f.currentY > f.maxY && (f.currentY = f.maxY - 1 + (f.currentY - f.maxY + 1) ** .8), g.prevPositionX || (g.prevPositionX = f.touchesCurrent.x), g.prevPositionY || (g.prevPositionY = f.touchesCurrent.y), g.prevTime || (g.prevTime = Date.now()), g.x = (f.touchesCurrent.x - g.prevPositionX) / (Date.now() - g.prevTime) / 2, g.y = (f.touchesCurrent.y - g.prevPositionY) / (Date.now() - g.prevTime) / 2, Math.abs(f.touchesCurrent.x - g.prevPositionX) < 2 && (g.x = 0), Math.abs(f.touchesCurrent.y - g.prevPositionY) < 2 && (g.y = 0), g.prevPositionX = f.touchesCurrent.x, g.prevPositionY = f.touchesCurrent.y, g.prevTime = Date.now(), m.$imageWrapEl.transform(`translate3d(${f.currentX}px, ${f.currentY}px,0)`)
+            if (!m.imageEl) return;
+            if (!h.isTouched || !m.slideEl) return;
+            h.isMoved || (h.width = m.imageEl.offsetWidth, h.height = m.imageEl.offsetHeight, h.startX = d(m.imageWrapEl, "x") || 0, h.startY = d(m.imageWrapEl, "y") || 0, m.slideWidth = m.slideEl.offsetWidth, m.slideHeight = m.slideEl.offsetHeight, m.imageWrapEl.style.transitionDuration = "0ms");
+            const a = h.width * s.scale,
+                i = h.height * s.scale;
+            if (a < m.slideWidth && i < m.slideHeight) return;
+            h.minX = Math.min(m.slideWidth / 2 - a / 2, 0), h.maxX = -h.minX, h.minY = Math.min(m.slideHeight / 2 - i / 2, 0), h.maxY = -h.minY, h.touchesCurrent.x = u.length > 0 ? u[0].pageX : e.pageX, h.touchesCurrent.y = u.length > 0 ? u[0].pageY : e.pageY;
+            if (Math.max(Math.abs(h.touchesCurrent.x - h.touchesStart.x), Math.abs(h.touchesCurrent.y - h.touchesStart.y)) > 5 && (t.allowClick = !1), !h.isMoved && !p) {
+                if (t.isHorizontal() && (Math.floor(h.minX) === Math.floor(h.startX) && h.touchesCurrent.x < h.touchesStart.x || Math.floor(h.maxX) === Math.floor(h.startX) && h.touchesCurrent.x > h.touchesStart.x)) return void(h.isTouched = !1);
+                if (!t.isHorizontal() && (Math.floor(h.minY) === Math.floor(h.startY) && h.touchesCurrent.y < h.touchesStart.y || Math.floor(h.maxY) === Math.floor(h.startY) && h.touchesCurrent.y > h.touchesStart.y)) return void(h.isTouched = !1)
             }
+            e.cancelable && e.preventDefault(), e.stopPropagation(), h.isMoved = !0;
+            const r = (s.scale - c) / (m.maxRatio - t.params.zoom.minRatio),
+                {
+                    originX: n,
+                    originY: l
+                } = m;
+            h.currentX = h.touchesCurrent.x - h.touchesStart.x + h.startX + r * (h.width - 2 * n), h.currentY = h.touchesCurrent.y - h.touchesStart.y + h.startY + r * (h.height - 2 * l), h.currentX < h.minX && (h.currentX = h.minX + 1 - (h.minX - h.currentX + 1) ** .8), h.currentX > h.maxX && (h.currentX = h.maxX - 1 + (h.currentX - h.maxX + 1) ** .8), h.currentY < h.minY && (h.currentY = h.minY + 1 - (h.minY - h.currentY + 1) ** .8), h.currentY > h.maxY && (h.currentY = h.maxY - 1 + (h.currentY - h.maxY + 1) ** .8), g.prevPositionX || (g.prevPositionX = h.touchesCurrent.x), g.prevPositionY || (g.prevPositionY = h.touchesCurrent.y), g.prevTime || (g.prevTime = Date.now()), g.x = (h.touchesCurrent.x - g.prevPositionX) / (Date.now() - g.prevTime) / 2, g.y = (h.touchesCurrent.y - g.prevPositionY) / (Date.now() - g.prevTime) / 2, Math.abs(h.touchesCurrent.x - g.prevPositionX) < 2 && (g.x = 0), Math.abs(h.touchesCurrent.y - g.prevPositionY) < 2 && (g.y = 0), g.prevPositionX = h.touchesCurrent.x, g.prevPositionY = h.touchesCurrent.y, g.prevTime = Date.now(), m.imageWrapEl.style.transform = `translate3d(${h.currentX}px, ${h.currentY}px,0)`
         }
 
-        function C() {
+        function P() {
             const e = t.zoom;
-            m.$slideEl && t.previousIndex !== t.activeIndex && (m.$imageEl && m.$imageEl.transform("translate3d(0,0,0) scale(1)"), m.$imageWrapEl && m.$imageWrapEl.transform("translate3d(0,0,0)"), e.scale = 1, p = 1, m.$slideEl = void 0, m.$imageEl = void 0, m.$imageWrapEl = void 0)
+            m.slideEl && t.activeIndex !== t.slides.indexOf(m.slideEl) && (m.imageEl && (m.imageEl.style.transform = "translate3d(0,0,0) scale(1)"), m.imageWrapEl && (m.imageWrapEl.style.transform = "translate3d(0,0,0)"), m.slideEl.classList.remove(`${t.params.zoom.zoomedSlideClass}`), e.scale = 1, c = 1, m.slideEl = void 0, m.imageEl = void 0, m.imageWrapEl = void 0, m.originX = 0, m.originY = 0)
         }
 
-        function T(e) {
+        function L(e) {
             const s = t.zoom,
                 a = t.params.zoom;
-            if (m.$slideEl || (e && e.target && (m.$slideEl = d(e.target).closest(`.${t.params.slideClass}`)), m.$slideEl || (t.params.virtual && t.params.virtual.enabled && t.virtual ? m.$slideEl = t.$wrapperEl.children(`.${t.params.slideActiveClass}`) : m.$slideEl = t.slides.eq(t.activeIndex)), m.$imageEl = m.$slideEl.find(`.${a.containerClass}`).eq(0).find("picture, img, svg, canvas, .swiper-zoom-target").eq(0), m.$imageWrapEl = m.$imageEl.parent(`.${a.containerClass}`)), !m.$imageEl || 0 === m.$imageEl.length || !m.$imageWrapEl || 0 === m.$imageWrapEl.length) return;
-            let i, r, l, o, c, u, h, g, v, w, b, x, y, E, C, T, $, S;
-            t.params.cssMode && (t.wrapperEl.style.overflow = "hidden", t.wrapperEl.style.touchAction = "none"), m.$slideEl.addClass(`${a.zoomedSlideClass}`), void 0 === f.touchesStart.x && e ? (i = "touchend" === e.type ? e.changedTouches[0].pageX : e.pageX, r = "touchend" === e.type ? e.changedTouches[0].pageY : e.pageY) : (i = f.touchesStart.x, r = f.touchesStart.y), s.scale = m.$imageWrapEl.attr("data-swiper-zoom") || a.maxRatio, p = m.$imageWrapEl.attr("data-swiper-zoom") || a.maxRatio, e ? ($ = m.$slideEl[0].offsetWidth, S = m.$slideEl[0].offsetHeight, l = m.$slideEl.offset().left + n.scrollX, o = m.$slideEl.offset().top + n.scrollY, c = l + $ / 2 - i, u = o + S / 2 - r, v = m.$imageEl[0].offsetWidth, w = m.$imageEl[0].offsetHeight, b = v * s.scale, x = w * s.scale, y = Math.min($ / 2 - b / 2, 0), E = Math.min(S / 2 - x / 2, 0), C = -y, T = -E, h = c * s.scale, g = u * s.scale, h < y && (h = y), h > C && (h = C), g < E && (g = E), g > T && (g = T)) : (h = 0, g = 0), m.$imageWrapEl.transition(300).transform(`translate3d(${h}px, ${g}px,0)`), m.$imageEl.transition(300).transform(`translate3d(0,0,0) scale(${s.scale})`)
+            if (!m.slideEl) {
+                e && e.target && (m.slideEl = e.target.closest(`.${t.params.slideClass}, swiper-slide`)), m.slideEl || (t.params.virtual && t.params.virtual.enabled && t.virtual ? m.slideEl = f(t.slidesEl, `.${t.params.slideActiveClass}`)[0] : m.slideEl = t.slides[t.activeIndex]);
+                let s = m.slideEl.querySelector(`.${a.containerClass}`);
+                s && (s = s.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]), m.imageEl = s, m.imageWrapEl = s ? E(m.imageEl, `.${a.containerClass}`)[0] : void 0
+            }
+            if (!m.imageEl || !m.imageWrapEl) return;
+            let i, r, l, o, d, p, u, g, v, b, x, S, T, M, C, P, L, I;
+            t.params.cssMode && (t.wrapperEl.style.overflow = "hidden", t.wrapperEl.style.touchAction = "none"), m.slideEl.classList.add(`${a.zoomedSlideClass}`), void 0 === h.touchesStart.x && e ? (i = e.pageX, r = e.pageY) : (i = h.touchesStart.x, r = h.touchesStart.y);
+            const z = "number" == typeof e ? e : null;
+            1 === c && z && (i = void 0, r = void 0);
+            const A = y();
+            s.scale = z || A, c = z || A, !e || 1 === c && z ? (u = 0, g = 0) : (L = m.slideEl.offsetWidth, I = m.slideEl.offsetHeight, l = w(m.slideEl).left + n.scrollX, o = w(m.slideEl).top + n.scrollY, d = l + L / 2 - i, p = o + I / 2 - r, v = m.imageEl.offsetWidth, b = m.imageEl.offsetHeight, x = v * s.scale, S = b * s.scale, T = Math.min(L / 2 - x / 2, 0), M = Math.min(I / 2 - S / 2, 0), C = -T, P = -M, u = d * s.scale, g = p * s.scale, u < T && (u = T), u > C && (u = C), g < M && (g = M), g > P && (g = P)), z && 1 === s.scale && (m.originX = 0, m.originY = 0), m.imageWrapEl.style.transitionDuration = "300ms", m.imageWrapEl.style.transform = `translate3d(${u}px, ${g}px,0)`, m.imageEl.style.transitionDuration = "300ms", m.imageEl.style.transform = `translate3d(0,0,0) scale(${s.scale})`
         }
 
-        function $() {
+        function I() {
             const e = t.zoom,
                 s = t.params.zoom;
-            m.$slideEl || (t.params.virtual && t.params.virtual.enabled && t.virtual ? m.$slideEl = t.$wrapperEl.children(`.${t.params.slideActiveClass}`) : m.$slideEl = t.slides.eq(t.activeIndex), m.$imageEl = m.$slideEl.find(`.${s.containerClass}`).eq(0).find("picture, img, svg, canvas, .swiper-zoom-target").eq(0), m.$imageWrapEl = m.$imageEl.parent(`.${s.containerClass}`)), m.$imageEl && 0 !== m.$imageEl.length && m.$imageWrapEl && 0 !== m.$imageWrapEl.length && (t.params.cssMode && (t.wrapperEl.style.overflow = "", t.wrapperEl.style.touchAction = ""), e.scale = 1, p = 1, m.$imageWrapEl.transition(300).transform("translate3d(0,0,0)"), m.$imageEl.transition(300).transform("translate3d(0,0,0) scale(1)"), m.$slideEl.removeClass(`${s.zoomedSlideClass}`), m.$slideEl = void 0)
+            if (!m.slideEl) {
+                t.params.virtual && t.params.virtual.enabled && t.virtual ? m.slideEl = f(t.slidesEl, `.${t.params.slideActiveClass}`)[0] : m.slideEl = t.slides[t.activeIndex];
+                let e = m.slideEl.querySelector(`.${s.containerClass}`);
+                e && (e = e.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]), m.imageEl = e, m.imageWrapEl = e ? E(m.imageEl, `.${s.containerClass}`)[0] : void 0
+            }
+            m.imageEl && m.imageWrapEl && (t.params.cssMode && (t.wrapperEl.style.overflow = "", t.wrapperEl.style.touchAction = ""), e.scale = 1, c = 1, m.imageWrapEl.style.transitionDuration = "300ms", m.imageWrapEl.style.transform = "translate3d(0,0,0)", m.imageEl.style.transitionDuration = "300ms", m.imageEl.style.transform = "translate3d(0,0,0) scale(1)", m.slideEl.classList.remove(`${s.zoomedSlideClass}`), m.slideEl = void 0, m.originX = 0, m.originY = 0)
         }
 
-        function S(e) {
+        function z(e) {
             const s = t.zoom;
-            s.scale && 1 !== s.scale ? $() : T(e)
+            s.scale && 1 !== s.scale ? I() : L(e)
         }
 
-        function M() {
-            const e = t.support;
+        function A() {
             return {
-                passiveListener: !("touchstart" !== t.touchEvents.start || !e.passiveListener || !t.params.passiveListeners) && {
+                passiveListener: !!t.params.passiveListeners && {
                     passive: !0,
                     capture: !1
                 },
-                activeListenerWithCapture: !e.passiveListener || {
+                activeListenerWithCapture: !t.params.passiveListeners || {
                     passive: !1,
                     capture: !0
                 }
             }
         }
 
-        function P() {
-            return `.${t.params.slideClass}`
-        }
-
-        function k(e) {
-            const {
-                passiveListener: s
-            } = M(), a = P();
-            t.$wrapperEl[e]("gesturestart", a, b, s), t.$wrapperEl[e]("gesturechange", a, x, s), t.$wrapperEl[e]("gestureend", a, y, s)
-        }
-
-        function z() {
-            l || (l = !0, k("on"))
-        }
-
-        function L() {
-            l && (l = !1, k("off"))
-        }
-
-        function O() {
+        function $() {
             const e = t.zoom;
             if (e.enabled) return;
             e.enabled = !0;
-            const s = t.support,
-                {
-                    passiveListener: a,
-                    activeListenerWithCapture: i
-                } = M(),
-                r = P();
-            s.gestures ? (t.$wrapperEl.on(t.touchEvents.start, z, a), t.$wrapperEl.on(t.touchEvents.end, L, a)) : "touchstart" === t.touchEvents.start && (t.$wrapperEl.on(t.touchEvents.start, r, b, a), t.$wrapperEl.on(t.touchEvents.move, r, x, i), t.$wrapperEl.on(t.touchEvents.end, r, y, a), t.touchEvents.cancel && t.$wrapperEl.on(t.touchEvents.cancel, r, y, a)), t.$wrapperEl.on(t.touchEvents.move, `.${t.params.zoom.containerClass}`, E, i)
+            const {
+                passiveListener: s,
+                activeListenerWithCapture: a
+            } = A();
+            t.wrapperEl.addEventListener("pointerdown", S, s), t.wrapperEl.addEventListener("pointermove", T, a), ["pointerup", "pointercancel", "pointerout"].forEach((e => {
+                t.wrapperEl.addEventListener(e, M, s)
+            })), t.wrapperEl.addEventListener("pointermove", C, a)
         }
 
-        function I() {
+        function k() {
             const e = t.zoom;
             if (!e.enabled) return;
-            const s = t.support;
             e.enabled = !1;
             const {
-                passiveListener: a,
-                activeListenerWithCapture: i
-            } = M(), r = P();
-            s.gestures ? (t.$wrapperEl.off(t.touchEvents.start, z, a), t.$wrapperEl.off(t.touchEvents.end, L, a)) : "touchstart" === t.touchEvents.start && (t.$wrapperEl.off(t.touchEvents.start, r, b, a), t.$wrapperEl.off(t.touchEvents.move, r, x, i), t.$wrapperEl.off(t.touchEvents.end, r, y, a), t.touchEvents.cancel && t.$wrapperEl.off(t.touchEvents.cancel, r, y, a)), t.$wrapperEl.off(t.touchEvents.move, `.${t.params.zoom.containerClass}`, E, i)
+                passiveListener: s,
+                activeListenerWithCapture: a
+            } = A();
+            t.wrapperEl.removeEventListener("pointerdown", S, s), t.wrapperEl.removeEventListener("pointermove", T, a), ["pointerup", "pointercancel", "pointerout"].forEach((e => {
+                t.wrapperEl.removeEventListener(e, M, s)
+            })), t.wrapperEl.removeEventListener("pointermove", C, a)
         }
         Object.defineProperty(t.zoom, "scale", {
             get: () => v,
             set(e) {
                 if (v !== e) {
-                    const t = m.$imageEl ? m.$imageEl[0] : void 0,
-                        s = m.$slideEl ? m.$slideEl[0] : void 0;
+                    const t = m.imageEl,
+                        s = m.slideEl;
                     i("zoomChange", e, t, s)
                 }
                 v = e
             }
         }), a("init", (() => {
-            t.params.zoom.enabled && O()
+            t.params.zoom.enabled && $()
         })), a("destroy", (() => {
-            I()
+            k()
         })), a("touchStart", ((e, s) => {
             t.zoom.enabled && function(e) {
                 const s = t.device;
-                m.$imageEl && 0 !== m.$imageEl.length && (f.isTouched || (s.android && e.cancelable && e.preventDefault(), f.isTouched = !0, f.touchesStart.x = "touchstart" === e.type ? e.targetTouches[0].pageX : e.pageX, f.touchesStart.y = "touchstart" === e.type ? e.targetTouches[0].pageY : e.pageY))
+                if (!m.imageEl) return;
+                if (h.isTouched) return;
+                s.android && e.cancelable && e.preventDefault(), h.isTouched = !0;
+                const a = u.length > 0 ? u[0] : e;
+                h.touchesStart.x = a.pageX, h.touchesStart.y = a.pageY
             }(s)
         })), a("touchEnd", ((e, s) => {
             t.zoom.enabled && function() {
                 const e = t.zoom;
-                if (!m.$imageEl || 0 === m.$imageEl.length) return;
-                if (!f.isTouched || !f.isMoved) return f.isTouched = !1, void(f.isMoved = !1);
-                f.isTouched = !1, f.isMoved = !1;
+                if (!m.imageEl) return;
+                if (!h.isTouched || !h.isMoved) return h.isTouched = !1, void(h.isMoved = !1);
+                h.isTouched = !1, h.isMoved = !1;
                 let s = 300,
                     a = 300;
                 const i = g.x * s,
-                    r = f.currentX + i,
+                    r = h.currentX + i,
                     n = g.y * a,
-                    l = f.currentY + n;
-                0 !== g.x && (s = Math.abs((r - f.currentX) / g.x)), 0 !== g.y && (a = Math.abs((l - f.currentY) / g.y));
+                    l = h.currentY + n;
+                0 !== g.x && (s = Math.abs((r - h.currentX) / g.x)), 0 !== g.y && (a = Math.abs((l - h.currentY) / g.y));
                 const o = Math.max(s, a);
-                f.currentX = r, f.currentY = l;
-                const d = f.width * e.scale,
-                    c = f.height * e.scale;
-                f.minX = Math.min(m.slideWidth / 2 - d / 2, 0), f.maxX = -f.minX, f.minY = Math.min(m.slideHeight / 2 - c / 2, 0), f.maxY = -f.minY, f.currentX = Math.max(Math.min(f.currentX, f.maxX), f.minX), f.currentY = Math.max(Math.min(f.currentY, f.maxY), f.minY), m.$imageWrapEl.transition(o).transform(`translate3d(${f.currentX}px, ${f.currentY}px,0)`)
+                h.currentX = r, h.currentY = l;
+                const d = h.width * e.scale,
+                    c = h.height * e.scale;
+                h.minX = Math.min(m.slideWidth / 2 - d / 2, 0), h.maxX = -h.minX, h.minY = Math.min(m.slideHeight / 2 - c / 2, 0), h.maxY = -h.minY, h.currentX = Math.max(Math.min(h.currentX, h.maxX), h.minX), h.currentY = Math.max(Math.min(h.currentY, h.maxY), h.minY), m.imageWrapEl.style.transitionDuration = `${o}ms`, m.imageWrapEl.style.transform = `translate3d(${h.currentX}px, ${h.currentY}px,0)`
             }()
         })), a("doubleTap", ((e, s) => {
-            !t.animating && t.params.zoom.enabled && t.zoom.enabled && t.params.zoom.toggle && S(s)
+            !t.animating && t.params.zoom.enabled && t.zoom.enabled && t.params.zoom.toggle && z(s)
         })), a("transitionEnd", (() => {
-            t.zoom.enabled && t.params.zoom.enabled && C()
+            t.zoom.enabled && t.params.zoom.enabled && P()
         })), a("slideChange", (() => {
-            t.zoom.enabled && t.params.zoom.enabled && t.params.cssMode && C()
+            t.zoom.enabled && t.params.zoom.enabled && t.params.cssMode && P()
         })), Object.assign(t.zoom, {
-            enable: O,
-            disable: I,
-            in: T,
-            out: $,
-            toggle: S
-        })
-    }, function(e) {
-        let {
-            swiper: t,
-            extendParams: s,
-            on: a,
-            emit: i
-        } = e;
-        s({
-            lazy: {
-                checkInView: !1,
-                enabled: !1,
-                loadPrevNext: !1,
-                loadPrevNextAmount: 1,
-                loadOnTransitionStart: !1,
-                scrollingElement: "",
-                elementClass: "swiper-lazy",
-                loadingClass: "swiper-lazy-loading",
-                loadedClass: "swiper-lazy-loaded",
-                preloaderClass: "swiper-lazy-preloader"
-            }
-        }), t.lazy = {};
-        let n = !1,
-            l = !1;
-
-        function o(e, s) {
-            void 0 === s && (s = !0);
-            const a = t.params.lazy;
-            if (void 0 === e) return;
-            if (0 === t.slides.length) return;
-            const r = t.virtual && t.params.virtual.enabled ? t.$wrapperEl.children(`.${t.params.slideClass}[data-swiper-slide-index="${e}"]`) : t.slides.eq(e),
-                n = r.find(`.${a.elementClass}:not(.${a.loadedClass}):not(.${a.loadingClass})`);
-            !r.hasClass(a.elementClass) || r.hasClass(a.loadedClass) || r.hasClass(a.loadingClass) || n.push(r[0]), 0 !== n.length && n.each((e => {
-                const n = d(e);
-                n.addClass(a.loadingClass);
-                const l = n.attr("data-background"),
-                    c = n.attr("data-src"),
-                    p = n.attr("data-srcset"),
-                    u = n.attr("data-sizes"),
-                    h = n.parent("picture");
-                t.loadImage(n[0], c || l, p, u, !1, (() => {
-                    if (null != t && t && (!t || t.params) && !t.destroyed) {
-                        if (l ? (n.css("background-image", `url("${l}")`), n.removeAttr("data-background")) : (p && (n.attr("srcset", p), n.removeAttr("data-srcset")), u && (n.attr("sizes", u), n.removeAttr("data-sizes")), h.length && h.children("source").each((e => {
-                                const t = d(e);
-                                t.attr("data-srcset") && (t.attr("srcset", t.attr("data-srcset")), t.removeAttr("data-srcset"))
-                            })), c && (n.attr("src", c), n.removeAttr("data-src"))), n.addClass(a.loadedClass).removeClass(a.loadingClass), r.find(`.${a.preloaderClass}`).remove(), t.params.loop && s) {
-                            const e = r.attr("data-swiper-slide-index");
-                            if (r.hasClass(t.params.slideDuplicateClass)) {
-                                o(t.$wrapperEl.children(`[data-swiper-slide-index="${e}"]:not(.${t.params.slideDuplicateClass})`).index(), !1)
-                            } else {
-                                o(t.$wrapperEl.children(`.${t.params.slideDuplicateClass}[data-swiper-slide-index="${e}"]`).index(), !1)
-                            }
-                        }
-                        i("lazyImageReady", r[0], n[0]), t.params.autoHeight && t.updateAutoHeight()
-                    }
-                })), i("lazyImageLoad", r[0], n[0])
-            }))
-        }
-
-        function c() {
-            const {
-                $wrapperEl: e,
-                params: s,
-                slides: a,
-                activeIndex: i
-            } = t, r = t.virtual && s.virtual.enabled, n = s.lazy;
-            let c = s.slidesPerView;
-
-            function p(t) {
-                if (r) {
-                    if (e.children(`.${s.slideClass}[data-swiper-slide-index="${t}"]`).length) return !0
-                } else if (a[t]) return !0;
-                return !1
-            }
-
-            function u(e) {
-                return r ? d(e).attr("data-swiper-slide-index") : d(e).index()
-            }
-            if ("auto" === c && (c = 0), l || (l = !0), t.params.watchSlidesProgress) e.children(`.${s.slideVisibleClass}`).each((e => {
-                o(r ? d(e).attr("data-swiper-slide-index") : d(e).index())
-            }));
-            else if (c > 1)
-                for (let e = i; e < i + c; e += 1) p(e) && o(e);
-            else o(i);
-            if (n.loadPrevNext)
-                if (c > 1 || n.loadPrevNextAmount && n.loadPrevNextAmount > 1) {
-                    const e = n.loadPrevNextAmount,
-                        t = Math.ceil(c),
-                        s = Math.min(i + t + Math.max(e, t), a.length),
-                        r = Math.max(i - Math.max(t, e), 0);
-                    for (let e = i + t; e < s; e += 1) p(e) && o(e);
-                    for (let e = r; e < i; e += 1) p(e) && o(e)
-                } else {
-                    const t = e.children(`.${s.slideNextClass}`);
-                    t.length > 0 && o(u(t));
-                    const a = e.children(`.${s.slidePrevClass}`);
-                    a.length > 0 && o(u(a))
-                }
-        }
-
-        function p() {
-            const e = r();
-            if (!t || t.destroyed) return;
-            const s = t.params.lazy.scrollingElement ? d(t.params.lazy.scrollingElement) : d(e),
-                a = s[0] === e,
-                i = a ? e.innerWidth : s[0].offsetWidth,
-                l = a ? e.innerHeight : s[0].offsetHeight,
-                o = t.$el.offset(),
-                {
-                    rtlTranslate: u
-                } = t;
-            let h = !1;
-            u && (o.left -= t.$el[0].scrollLeft);
-            const m = [
-                [o.left, o.top],
-                [o.left + t.width, o.top],
-                [o.left, o.top + t.height],
-                [o.left + t.width, o.top + t.height]
-            ];
-            for (let e = 0; e < m.length; e += 1) {
-                const t = m[e];
-                if (t[0] >= 0 && t[0] <= i && t[1] >= 0 && t[1] <= l) {
-                    if (0 === t[0] && 0 === t[1]) continue;
-                    h = !0
-                }
-            }
-            const f = !("touchstart" !== t.touchEvents.start || !t.support.passiveListener || !t.params.passiveListeners) && {
-                passive: !0,
-                capture: !1
-            };
-            h ? (c(), s.off("scroll", p, f)) : n || (n = !0, s.on("scroll", p, f))
-        }
-        a("beforeInit", (() => {
-            t.params.lazy.enabled && t.params.preloadImages && (t.params.preloadImages = !1)
-        })), a("init", (() => {
-            t.params.lazy.enabled && (t.params.lazy.checkInView ? p() : c())
-        })), a("scroll", (() => {
-            t.params.freeMode && t.params.freeMode.enabled && !t.params.freeMode.sticky && c()
-        })), a("scrollbarDragMove resize _freeModeNoMomentumRelease", (() => {
-            t.params.lazy.enabled && (t.params.lazy.checkInView ? p() : c())
-        })), a("transitionStart", (() => {
-            t.params.lazy.enabled && (t.params.lazy.loadOnTransitionStart || !t.params.lazy.loadOnTransitionStart && !l) && (t.params.lazy.checkInView ? p() : c())
-        })), a("transitionEnd", (() => {
-            t.params.lazy.enabled && !t.params.lazy.loadOnTransitionStart && (t.params.lazy.checkInView ? p() : c())
-        })), a("slideChange", (() => {
-            const {
-                lazy: e,
-                cssMode: s,
-                watchSlidesProgress: a,
-                touchReleaseOnEdges: i,
-                resistanceRatio: r
-            } = t.params;
-            e.enabled && (s || a && (i || 0 === r)) && c()
-        })), a("destroy", (() => {
-            t.$el && t.$el.find(`.${t.params.lazy.loadingClass}`).removeClass(t.params.lazy.loadingClass)
-        })), Object.assign(t.lazy, {
-            load: c,
-            loadInSlide: o
+            enable: $,
+            disable: k,
+            in: L,
+            out: I,
+            toggle: z
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a
         } = e;
@@ -3740,52 +3717,62 @@
                 control: void 0,
                 inverse: !1,
                 by: "slide"
             }
         }), t.controller = {
             control: void 0
         }, a("beforeInit", (() => {
-            t.controller.control = t.params.controller.control
+            if ("undefined" != typeof window && ("string" == typeof t.params.controller.control || t.params.controller.control instanceof HTMLElement)) {
+                const e = document.querySelector(t.params.controller.control);
+                if (e && e.swiper) t.controller.control = e.swiper;
+                else if (e) {
+                    const s = a => {
+                        t.controller.control = a.detail[0], t.update(), e.removeEventListener("init", s)
+                    };
+                    e.addEventListener("init", s)
+                }
+            } else t.controller.control = t.params.controller.control
         })), a("update", (() => {
             r()
         })), a("resize", (() => {
             r()
         })), a("observerUpdate", (() => {
             r()
         })), a("setTranslate", ((e, s, a) => {
-            t.controller.control && t.controller.setTranslate(s, a)
+            t.controller.control && !t.controller.control.destroyed && t.controller.setTranslate(s, a)
         })), a("setTransition", ((e, s, a) => {
-            t.controller.control && t.controller.setTransition(s, a)
+            t.controller.control && !t.controller.control.destroyed && t.controller.setTransition(s, a)
         })), Object.assign(t.controller, {
             setTranslate: function(e, s) {
                 const a = t.controller.control;
                 let r, n;
                 const l = t.constructor;
 
                 function o(e) {
+                    if (e.destroyed) return;
                     const s = t.rtlTranslate ? -t.translate : t.translate;
                     "slide" === t.params.controller.by && (! function(e) {
-                        t.controller.spline || (t.controller.spline = t.params.loop ? new i(t.slidesGrid, e.slidesGrid) : new i(t.snapGrid, e.snapGrid))
-                    }(e), n = -t.controller.spline.interpolate(-s)), n && "container" !== t.params.controller.by || (r = (e.maxTranslate() - e.minTranslate()) / (t.maxTranslate() - t.minTranslate()), n = (s - t.minTranslate()) * r + e.minTranslate()), t.params.controller.inverse && (n = e.maxTranslate() - n), e.updateProgress(n), e.setTranslate(n, t), e.updateActiveIndex(), e.updateSlidesClasses()
+                        t.controller.spline = t.params.loop ? new i(t.slidesGrid, e.slidesGrid) : new i(t.snapGrid, e.snapGrid)
+                    }(e), n = -t.controller.spline.interpolate(-s)), n && "container" !== t.params.controller.by || (r = (e.maxTranslate() - e.minTranslate()) / (t.maxTranslate() - t.minTranslate()), !Number.isNaN(r) && Number.isFinite(r) || (r = 1), n = (s - t.minTranslate()) * r + e.minTranslate()), t.params.controller.inverse && (n = e.maxTranslate() - n), e.updateProgress(n), e.setTranslate(n, t), e.updateActiveIndex(), e.updateSlidesClasses()
                 }
                 if (Array.isArray(a))
                     for (let e = 0; e < a.length; e += 1) a[e] !== s && a[e] instanceof l && o(a[e]);
                 else a instanceof l && s !== a && o(a)
             },
             setTransition: function(e, s) {
                 const a = t.constructor,
                     i = t.controller.control;
                 let r;
 
                 function n(s) {
-                    s.setTransition(e, t), 0 !== e && (s.transitionStart(), s.params.autoHeight && p((() => {
+                    s.destroyed || (s.setTransition(e, t), 0 !== e && (s.transitionStart(), s.params.autoHeight && l((() => {
                         s.updateAutoHeight()
-                    })), s.$wrapperEl.transitionEnd((() => {
-                        i && (s.params.loop && "slide" === t.params.controller.by && s.loopFix(), s.transitionEnd())
-                    })))
+                    })), x(s.wrapperEl, (() => {
+                        i && s.transitionEnd()
+                    }))))
                 }
                 if (Array.isArray(i))
                     for (r = 0; r < i.length; r += 1) i[r] !== s && i[r] instanceof a && n(i[r]);
                 else i instanceof a && s !== i && n(i)
             }
         })
     }, function(e) {
@@ -3813,136 +3800,170 @@
         }), t.a11y = {
             clicked: !1
         };
         let i = null;
 
         function r(e) {
             const t = i;
-            0 !== t.length && (t.html(""), t.html(e))
+            0 !== t.length && (t.innerHTML = "", t.innerHTML = e)
         }
 
         function n(e) {
-            e.attr("tabIndex", "0")
+            (e = T(e)).forEach((e => {
+                e.setAttribute("tabIndex", "0")
+            }))
         }
 
         function l(e) {
-            e.attr("tabIndex", "-1")
+            (e = T(e)).forEach((e => {
+                e.setAttribute("tabIndex", "-1")
+            }))
         }
 
         function o(e, t) {
-            e.attr("role", t)
+            (e = T(e)).forEach((e => {
+                e.setAttribute("role", t)
+            }))
         }
 
-        function c(e, t) {
-            e.attr("aria-roledescription", t)
+        function d(e, t) {
+            (e = T(e)).forEach((e => {
+                e.setAttribute("aria-roledescription", t)
+            }))
         }
 
-        function p(e, t) {
-            e.attr("aria-label", t)
+        function c(e, t) {
+            (e = T(e)).forEach((e => {
+                e.setAttribute("aria-label", t)
+            }))
         }
 
-        function u(e) {
-            e.attr("aria-disabled", !0)
+        function p(e) {
+            (e = T(e)).forEach((e => {
+                e.setAttribute("aria-disabled", !0)
+            }))
         }
 
-        function h(e) {
-            e.attr("aria-disabled", !1)
+        function u(e) {
+            (e = T(e)).forEach((e => {
+                e.setAttribute("aria-disabled", !1)
+            }))
         }
 
         function m(e) {
             if (13 !== e.keyCode && 32 !== e.keyCode) return;
             const s = t.params.a11y,
-                a = d(e.target);
-            t.navigation && t.navigation.$nextEl && a.is(t.navigation.$nextEl) && (t.isEnd && !t.params.loop || t.slideNext(), t.isEnd ? r(s.lastSlideMessage) : r(s.nextSlideMessage)), t.navigation && t.navigation.$prevEl && a.is(t.navigation.$prevEl) && (t.isBeginning && !t.params.loop || t.slidePrev(), t.isBeginning ? r(s.firstSlideMessage) : r(s.prevSlideMessage)), t.pagination && a.is(U(t.params.pagination.bulletClass)) && a[0].click()
+                a = e.target;
+            t.pagination && t.pagination.el && (a === t.pagination.el || t.pagination.el.contains(e.target)) && !e.target.matches(ae(t.params.pagination.bulletClass)) || (t.navigation && t.navigation.nextEl && a === t.navigation.nextEl && (t.isEnd && !t.params.loop || t.slideNext(), t.isEnd ? r(s.lastSlideMessage) : r(s.nextSlideMessage)), t.navigation && t.navigation.prevEl && a === t.navigation.prevEl && (t.isBeginning && !t.params.loop || t.slidePrev(), t.isBeginning ? r(s.firstSlideMessage) : r(s.prevSlideMessage)), t.pagination && a.matches(ae(t.params.pagination.bulletClass)) && a.click())
         }
 
-        function f() {
+        function h() {
             return t.pagination && t.pagination.bullets && t.pagination.bullets.length
         }
 
-        function g() {
-            return f() && t.params.pagination.clickable
+        function f() {
+            return h() && t.params.pagination.clickable
         }
-        const v = (e, t, s) => {
-                n(e), "BUTTON" !== e[0].tagName && (o(e, "button"), e.on("keydown", m)), p(e, s),
+        const g = (e, t, s) => {
+                n(e), "BUTTON" !== e.tagName && (o(e, "button"), e.addEventListener("keydown", m)), c(e, s),
                     function(e, t) {
-                        e.attr("aria-controls", t)
+                        (e = T(e)).forEach((e => {
+                            e.setAttribute("aria-controls", t)
+                        }))
                     }(e, t)
             },
             w = () => {
                 t.a11y.clicked = !0
             },
             b = () => {
                 requestAnimationFrame((() => {
                     requestAnimationFrame((() => {
-                        t.a11y.clicked = !1
+                        t.destroyed || (t.a11y.clicked = !1)
                     }))
                 }))
             },
-            x = e => {
+            E = e => {
                 if (t.a11y.clicked) return;
-                const s = e.target.closest(`.${t.params.slideClass}`);
+                const s = e.target.closest(`.${t.params.slideClass}, swiper-slide`);
                 if (!s || !t.slides.includes(s)) return;
                 const a = t.slides.indexOf(s) === t.activeIndex,
                     i = t.params.watchSlidesProgress && t.visibleSlides && t.visibleSlides.includes(s);
-                a || i || (t.isHorizontal() ? t.el.scrollLeft = 0 : t.el.scrollTop = 0, t.slideTo(t.slides.indexOf(s), 0))
+                a || i || e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents || (t.isHorizontal() ? t.el.scrollLeft = 0 : t.el.scrollTop = 0, t.slideTo(t.slides.indexOf(s), 0))
             },
-            y = () => {
+            x = () => {
                 const e = t.params.a11y;
-                e.itemRoleDescriptionMessage && c(d(t.slides), e.itemRoleDescriptionMessage), e.slideRole && o(d(t.slides), e.slideRole);
-                const s = t.params.loop ? t.slides.filter((e => !e.classList.contains(t.params.slideDuplicateClass))).length : t.slides.length;
-                e.slideLabelMessage && t.slides.each(((a, i) => {
-                    const r = d(a),
-                        n = t.params.loop ? parseInt(r.attr("data-swiper-slide-index"), 10) : i;
-                    p(r, e.slideLabelMessage.replace(/\{\{index\}\}/, n + 1).replace(/\{\{slidesLength\}\}/, s))
+                e.itemRoleDescriptionMessage && d(t.slides, e.itemRoleDescriptionMessage), e.slideRole && o(t.slides, e.slideRole);
+                const s = t.slides.length;
+                e.slideLabelMessage && t.slides.forEach(((a, i) => {
+                    const r = t.params.loop ? parseInt(a.getAttribute("data-swiper-slide-index"), 10) : i;
+                    c(a, e.slideLabelMessage.replace(/\{\{index\}\}/, r + 1).replace(/\{\{slidesLength\}\}/, s))
                 }))
             },
-            E = () => {
+            S = () => {
                 const e = t.params.a11y;
-                t.$el.append(i);
-                const s = t.$el;
-                e.containerRoleDescriptionMessage && c(s, e.containerRoleDescriptionMessage), e.containerMessage && p(s, e.containerMessage);
-                const a = t.$wrapperEl,
-                    r = e.id || a.attr("id") || `swiper-wrapper-${n=16,void 0===n&&(n=16),"x".repeat(n).replace(/x/g,(()=>Math.round(16*Math.random()).toString(16)))}`;
+                t.el.append(i);
+                const s = t.el;
+                e.containerRoleDescriptionMessage && d(s, e.containerRoleDescriptionMessage), e.containerMessage && c(s, e.containerMessage);
+                const a = t.wrapperEl,
+                    r = e.id || a.getAttribute("id") || `swiper-wrapper-${n=16,void 0===n&&(n=16),"x".repeat(n).replace(/x/g,(()=>Math.round(16*Math.random()).toString(16)))}`;
                 var n;
                 const l = t.params.autoplay && t.params.autoplay.enabled ? "off" : "polite";
                 var o;
-                let d, u;
-                o = r, a.attr("id", o),
+                o = r, T(a).forEach((e => {
+                        e.setAttribute("id", o)
+                    })),
                     function(e, t) {
-                        e.attr("aria-live", t)
-                    }(a, l), y(), t.navigation && t.navigation.$nextEl && (d = t.navigation.$nextEl), t.navigation && t.navigation.$prevEl && (u = t.navigation.$prevEl), d && d.length && v(d, r, e.nextSlideMessage), u && u.length && v(u, r, e.prevSlideMessage), g() && t.pagination.$el.on("keydown", U(t.params.pagination.bulletClass), m), t.$el.on("focus", x, !0), t.$el.on("pointerdown", w, !0), t.$el.on("pointerup", b, !0)
+                        (e = T(e)).forEach((e => {
+                            e.setAttribute("aria-live", t)
+                        }))
+                    }(a, l), x();
+                let {
+                    nextEl: p,
+                    prevEl: u
+                } = t.navigation ? t.navigation : {};
+                if (p = T(p), u = T(u), p && p.forEach((t => g(t, r, e.nextSlideMessage))), u && u.forEach((t => g(t, r, e.prevSlideMessage))), f()) {
+                    T(t.pagination.el).forEach((e => {
+                        e.addEventListener("keydown", m)
+                    }))
+                }
+                t.el.addEventListener("focus", E, !0), t.el.addEventListener("pointerdown", w, !0), t.el.addEventListener("pointerup", b, !0)
             };
         a("beforeInit", (() => {
-            i = d(`<span class="${t.params.a11y.notificationClass}" aria-live="assertive" aria-atomic="true"></span>`)
+            i = v("span", t.params.a11y.notificationClass), i.setAttribute("aria-live", "assertive"), i.setAttribute("aria-atomic", "true")
         })), a("afterInit", (() => {
-            t.params.a11y.enabled && E()
+            t.params.a11y.enabled && S()
         })), a("slidesLengthChange snapGridLengthChange slidesGridLengthChange", (() => {
-            t.params.a11y.enabled && y()
+            t.params.a11y.enabled && x()
         })), a("fromEdge toEdge afterInit lock unlock", (() => {
             t.params.a11y.enabled && function() {
                 if (t.params.loop || t.params.rewind || !t.navigation) return;
                 const {
-                    $nextEl: e,
-                    $prevEl: s
+                    nextEl: e,
+                    prevEl: s
                 } = t.navigation;
-                s && s.length > 0 && (t.isBeginning ? (u(s), l(s)) : (h(s), n(s))), e && e.length > 0 && (t.isEnd ? (u(e), l(e)) : (h(e), n(e)))
+                s && (t.isBeginning ? (p(s), l(s)) : (u(s), n(s))), e && (t.isEnd ? (p(e), l(e)) : (u(e), n(e)))
             }()
         })), a("paginationUpdate", (() => {
             t.params.a11y.enabled && function() {
                 const e = t.params.a11y;
-                f() && t.pagination.bullets.each((s => {
-                    const a = d(s);
-                    t.params.pagination.clickable && (n(a), t.params.pagination.renderBullet || (o(a, "button"), p(a, e.paginationBulletMessage.replace(/\{\{index\}\}/, a.index() + 1)))), a.is(`.${t.params.pagination.bulletActiveClass}`) ? a.attr("aria-current", "true") : a.removeAttr("aria-current")
+                h() && t.pagination.bullets.forEach((s => {
+                    t.params.pagination.clickable && (n(s), t.params.pagination.renderBullet || (o(s, "button"), c(s, e.paginationBulletMessage.replace(/\{\{index\}\}/, y(s) + 1)))), s.matches(ae(t.params.pagination.bulletActiveClass)) ? s.setAttribute("aria-current", "true") : s.removeAttribute("aria-current")
                 }))
             }()
         })), a("destroy", (() => {
             t.params.a11y.enabled && function() {
-                let e, s;
-                i && i.length > 0 && i.remove(), t.navigation && t.navigation.$nextEl && (e = t.navigation.$nextEl), t.navigation && t.navigation.$prevEl && (s = t.navigation.$prevEl), e && e.off("keydown", m), s && s.off("keydown", m), g() && t.pagination.$el.off("keydown", U(t.params.pagination.bulletClass), m), t.$el.off("focus", x, !0), t.$el.off("pointerdown", w, !0), t.$el.off("pointerup", b, !0)
+                i && i.remove();
+                let {
+                    nextEl: e,
+                    prevEl: s
+                } = t.navigation ? t.navigation : {};
+                e = T(e), s = T(s), e && e.forEach((e => e.removeEventListener("keydown", m))), s && s.forEach((e => e.removeEventListener("keydown", m))), f() && T(t.pagination.el).forEach((e => {
+                    e.removeEventListener("keydown", m)
+                }));
+                t.el.removeEventListener("focus", E, !0), t.el.removeEventListener("pointerdown", w, !0), t.el.removeEventListener("pointerup", b, !0)
             }()
         }))
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a
@@ -3971,47 +3992,47 @@
                 }
             },
             d = (e, s) => {
                 const a = r();
                 if (!i || !t.params.history.enabled) return;
                 let n;
                 n = t.params.url ? new URL(t.params.url) : a.location;
-                const o = t.slides.eq(s);
-                let d = l(o.attr("data-history"));
+                const o = t.virtual && t.params.virtual.enabled ? t.slidesEl.querySelector(`[data-swiper-slide-index="${s}"]`) : t.slides[s];
+                let d = l(o.getAttribute("data-history"));
                 if (t.params.history.root.length > 0) {
                     let s = t.params.history.root;
-                    "/" === s[s.length - 1] && (s = s.slice(0, s.length - 1)), d = `${s}/${e}/${d}`
-                } else n.pathname.includes(e) || (d = `${e}/${d}`);
+                    "/" === s[s.length - 1] && (s = s.slice(0, s.length - 1)), d = `${s}/${e?`${e}/`:""}${d}`
+                } else n.pathname.includes(e) || (d = `${e?`${e}/`:""}${d}`);
                 t.params.history.keepQuery && (d += n.search);
                 const c = a.history.state;
                 c && c.value === d || (t.params.history.replaceState ? a.history.replaceState({
                     value: d
                 }, null, d) : a.history.pushState({
                     value: d
                 }, null, d))
             },
             c = (e, s, a) => {
                 if (s)
                     for (let i = 0, r = t.slides.length; i < r; i += 1) {
-                        const r = t.slides.eq(i);
-                        if (l(r.attr("data-history")) === s && !r.hasClass(t.params.slideDuplicateClass)) {
-                            const s = r.index();
+                        const r = t.slides[i];
+                        if (l(r.getAttribute("data-history")) === s) {
+                            const s = t.getSlideIndex(r);
                             t.slideTo(s, e, a)
                         }
                     } else t.slideTo(0, e, a)
             },
             p = () => {
                 n = o(t.params.url), c(t.params.speed, n.value, !1)
             };
         a("init", (() => {
             t.params.history.enabled && (() => {
                 const e = r();
                 if (t.params.history) {
                     if (!e.history || !e.history.pushState) return t.params.history.enabled = !1, void(t.params.hashNavigation.enabled = !0);
-                    i = !0, n = o(t.params.url), (n.key || n.value) && (c(0, n.value, t.params.runCallbacksOnInit), t.params.history.replaceState || e.addEventListener("popstate", p))
+                    i = !0, n = o(t.params.url), n.key || n.value ? (c(0, n.value, t.params.runCallbacksOnInit), t.params.history.replaceState || e.addEventListener("popstate", p)) : t.params.history.replaceState || e.addEventListener("popstate", p)
                 }
             })()
         })), a("destroy", (() => {
             t.params.history.enabled && (() => {
                 const e = r();
                 t.params.history.replaceState || e.removeEventListener("popstate", p)
             })()
@@ -4024,250 +4045,297 @@
         let {
             swiper: t,
             extendParams: s,
             emit: i,
             on: n
         } = e, l = !1;
         const o = a(),
-            c = r();
+            d = r();
         s({
             hashNavigation: {
                 enabled: !1,
                 replaceState: !1,
-                watchState: !1
+                watchState: !1,
+                getSlideIndex(e, s) {
+                    if (t.virtual && t.params.virtual.enabled) {
+                        const e = t.slides.filter((e => e.getAttribute("data-hash") === s))[0];
+                        if (!e) return 0;
+                        return parseInt(e.getAttribute("data-swiper-slide-index"), 10)
+                    }
+                    return t.getSlideIndex(f(t.slidesEl, `.${t.params.slideClass}[data-hash="${s}"], swiper-slide[data-hash="${s}"]`)[0])
+                }
             }
         });
-        const p = () => {
+        const c = () => {
                 i("hashChange");
-                const e = o.location.hash.replace("#", "");
-                if (e !== t.slides.eq(t.activeIndex).attr("data-hash")) {
-                    const s = t.$wrapperEl.children(`.${t.params.slideClass}[data-hash="${e}"]`).index();
-                    if (void 0 === s) return;
+                const e = o.location.hash.replace("#", ""),
+                    s = t.virtual && t.params.virtual.enabled ? t.slidesEl.querySelector(`[data-swiper-slide-index="${t.activeIndex}"]`) : t.slides[t.activeIndex];
+                if (e !== (s ? s.getAttribute("data-hash") : "")) {
+                    const s = t.params.hashNavigation.getSlideIndex(t, e);
+                    if (void 0 === s || Number.isNaN(s)) return;
                     t.slideTo(s)
                 }
             },
-            u = () => {
-                if (l && t.params.hashNavigation.enabled)
-                    if (t.params.hashNavigation.replaceState && c.history && c.history.replaceState) c.history.replaceState(null, null, `#${t.slides.eq(t.activeIndex).attr("data-hash")}` || ""), i("hashSet");
-                    else {
-                        const e = t.slides.eq(t.activeIndex),
-                            s = e.attr("data-hash") || e.attr("data-history");
-                        o.location.hash = s || "", i("hashSet")
-                    }
+            p = () => {
+                if (!l || !t.params.hashNavigation.enabled) return;
+                const e = t.virtual && t.params.virtual.enabled ? t.slidesEl.querySelector(`[data-swiper-slide-index="${t.activeIndex}"]`) : t.slides[t.activeIndex],
+                    s = e ? e.getAttribute("data-hash") || e.getAttribute("data-history") : "";
+                t.params.hashNavigation.replaceState && d.history && d.history.replaceState ? (d.history.replaceState(null, null, `#${s}` || ""), i("hashSet")) : (o.location.hash = s || "", i("hashSet"))
             };
         n("init", (() => {
             t.params.hashNavigation.enabled && (() => {
                 if (!t.params.hashNavigation.enabled || t.params.history && t.params.history.enabled) return;
                 l = !0;
                 const e = o.location.hash.replace("#", "");
                 if (e) {
-                    const s = 0;
-                    for (let a = 0, i = t.slides.length; a < i; a += 1) {
-                        const i = t.slides.eq(a);
-                        if ((i.attr("data-hash") || i.attr("data-history")) === e && !i.hasClass(t.params.slideDuplicateClass)) {
-                            const e = i.index();
-                            t.slideTo(e, s, t.params.runCallbacksOnInit, !0)
-                        }
-                    }
+                    const s = 0,
+                        a = t.params.hashNavigation.getSlideIndex(t, e);
+                    t.slideTo(a || 0, s, t.params.runCallbacksOnInit, !0)
                 }
-                t.params.hashNavigation.watchState && d(c).on("hashchange", p)
+                t.params.hashNavigation.watchState && d.addEventListener("hashchange", c)
             })()
         })), n("destroy", (() => {
-            t.params.hashNavigation.enabled && t.params.hashNavigation.watchState && d(c).off("hashchange", p)
+            t.params.hashNavigation.enabled && t.params.hashNavigation.watchState && d.removeEventListener("hashchange", c)
         })), n("transitionEnd _freeModeNoMomentumRelease", (() => {
-            l && u()
+            l && p()
         })), n("slideChange", (() => {
-            l && t.params.cssMode && u()
+            l && t.params.cssMode && p()
         }))
     }, function(e) {
-        let t, {
-            swiper: s,
-            extendParams: i,
-            on: r,
-            emit: n
+        let t, s, {
+            swiper: i,
+            extendParams: r,
+            on: n,
+            emit: l,
+            params: o
         } = e;
-
-        function l() {
-            if (!s.size) return s.autoplay.running = !1, void(s.autoplay.paused = !1);
-            const e = s.slides.eq(s.activeIndex);
-            let a = s.params.autoplay.delay;
-            e.attr("data-swiper-autoplay") && (a = e.attr("data-swiper-autoplay") || s.params.autoplay.delay), clearTimeout(t), t = p((() => {
-                let e;
-                s.params.autoplay.reverseDirection ? s.params.loop ? (s.loopFix(), e = s.slidePrev(s.params.speed, !0, !0), n("autoplay")) : s.isBeginning ? s.params.autoplay.stopOnLastSlide ? d() : (e = s.slideTo(s.slides.length - 1, s.params.speed, !0, !0), n("autoplay")) : (e = s.slidePrev(s.params.speed, !0, !0), n("autoplay")) : s.params.loop ? (s.loopFix(), e = s.slideNext(s.params.speed, !0, !0), n("autoplay")) : s.isEnd ? s.params.autoplay.stopOnLastSlide ? d() : (e = s.slideTo(0, s.params.speed, !0, !0), n("autoplay")) : (e = s.slideNext(s.params.speed, !0, !0), n("autoplay")), (s.params.cssMode && s.autoplay.running || !1 === e) && l()
-            }), a)
-        }
-
-        function o() {
-            return void 0 === t && (!s.autoplay.running && (s.autoplay.running = !0, n("autoplayStart"), l(), !0))
-        }
-
-        function d() {
-            return !!s.autoplay.running && (void 0 !== t && (t && (clearTimeout(t), t = void 0), s.autoplay.running = !1, n("autoplayStop"), !0))
-        }
-
-        function c(e) {
-            s.autoplay.running && (s.autoplay.paused || (t && clearTimeout(t), s.autoplay.paused = !0, 0 !== e && s.params.autoplay.waitForTransition ? ["transitionend", "webkitTransitionEnd"].forEach((e => {
-                s.$wrapperEl[0].addEventListener(e, h)
-            })) : (s.autoplay.paused = !1, l())))
-        }
-
-        function u() {
-            const e = a();
-            "hidden" === e.visibilityState && s.autoplay.running && c(), "visible" === e.visibilityState && s.autoplay.paused && (l(), s.autoplay.paused = !1)
-        }
-
-        function h(e) {
-            s && !s.destroyed && s.$wrapperEl && e.target === s.$wrapperEl[0] && (["transitionend", "webkitTransitionEnd"].forEach((e => {
-                s.$wrapperEl[0].removeEventListener(e, h)
-            })), s.autoplay.paused = !1, s.autoplay.running ? l() : d())
-        }
-
-        function m() {
-            s.params.autoplay.disableOnInteraction ? d() : (n("autoplayPause"), c()), ["transitionend", "webkitTransitionEnd"].forEach((e => {
-                s.$wrapperEl[0].removeEventListener(e, h)
-            }))
-        }
-
-        function f() {
-            s.params.autoplay.disableOnInteraction || (s.autoplay.paused = !1, n("autoplayResume"), l())
-        }
-        s.autoplay = {
+        i.autoplay = {
             running: !1,
-            paused: !1
-        }, i({
+            paused: !1,
+            timeLeft: 0
+        }, r({
             autoplay: {
                 enabled: !1,
                 delay: 3e3,
                 waitForTransition: !0,
-                disableOnInteraction: !0,
+                disableOnInteraction: !1,
                 stopOnLastSlide: !1,
                 reverseDirection: !1,
                 pauseOnMouseEnter: !1
             }
-        }), r("init", (() => {
-            if (s.params.autoplay.enabled) {
-                o();
-                a().addEventListener("visibilitychange", u), s.params.autoplay.pauseOnMouseEnter && (s.$el.on("mouseenter", m), s.$el.on("mouseleave", f))
-            }
-        })), r("beforeTransitionStart", ((e, t, a) => {
-            s.autoplay.running && (a || !s.params.autoplay.disableOnInteraction ? s.autoplay.pause(t) : d())
-        })), r("sliderFirstMove", (() => {
-            s.autoplay.running && (s.params.autoplay.disableOnInteraction ? d() : c())
-        })), r("touchEnd", (() => {
-            s.params.cssMode && s.autoplay.paused && !s.params.autoplay.disableOnInteraction && l()
-        })), r("destroy", (() => {
-            s.$el.off("mouseenter", m), s.$el.off("mouseleave", f), s.autoplay.running && d();
-            a().removeEventListener("visibilitychange", u)
-        })), Object.assign(s.autoplay, {
-            pause: c,
-            run: l,
-            start: o,
-            stop: d
+        });
+        let d, c, p, u, m, h, f, g, v = o && o.autoplay ? o.autoplay.delay : 3e3,
+            w = o && o.autoplay ? o.autoplay.delay : 3e3,
+            b = (new Date).getTime();
+
+        function y(e) {
+            i && !i.destroyed && i.wrapperEl && e.target === i.wrapperEl && (i.wrapperEl.removeEventListener("transitionend", y), g || C())
+        }
+        const E = () => {
+                if (i.destroyed || !i.autoplay.running) return;
+                i.autoplay.paused ? c = !0 : c && (w = d, c = !1);
+                const e = i.autoplay.paused ? d : b + w - (new Date).getTime();
+                i.autoplay.timeLeft = e, l("autoplayTimeLeft", e, e / v), s = requestAnimationFrame((() => {
+                    E()
+                }))
+            },
+            x = e => {
+                if (i.destroyed || !i.autoplay.running) return;
+                cancelAnimationFrame(s), E();
+                let a = void 0 === e ? i.params.autoplay.delay : e;
+                v = i.params.autoplay.delay, w = i.params.autoplay.delay;
+                const r = (() => {
+                    let e;
+                    if (e = i.virtual && i.params.virtual.enabled ? i.slides.filter((e => e.classList.contains("swiper-slide-active")))[0] : i.slides[i.activeIndex], !e) return;
+                    return parseInt(e.getAttribute("data-swiper-autoplay"), 10)
+                })();
+                !Number.isNaN(r) && r > 0 && void 0 === e && (a = r, v = r, w = r), d = a;
+                const n = i.params.speed,
+                    o = () => {
+                        i && !i.destroyed && (i.params.autoplay.reverseDirection ? !i.isBeginning || i.params.loop || i.params.rewind ? (i.slidePrev(n, !0, !0), l("autoplay")) : i.params.autoplay.stopOnLastSlide || (i.slideTo(i.slides.length - 1, n, !0, !0), l("autoplay")) : !i.isEnd || i.params.loop || i.params.rewind ? (i.slideNext(n, !0, !0), l("autoplay")) : i.params.autoplay.stopOnLastSlide || (i.slideTo(0, n, !0, !0), l("autoplay")), i.params.cssMode && (b = (new Date).getTime(), requestAnimationFrame((() => {
+                            x()
+                        }))))
+                    };
+                return a > 0 ? (clearTimeout(t), t = setTimeout((() => {
+                    o()
+                }), a)) : requestAnimationFrame((() => {
+                    o()
+                })), a
+            },
+            S = () => {
+                b = (new Date).getTime(), i.autoplay.running = !0, x(), l("autoplayStart")
+            },
+            T = () => {
+                i.autoplay.running = !1, clearTimeout(t), cancelAnimationFrame(s), l("autoplayStop")
+            },
+            M = (e, s) => {
+                if (i.destroyed || !i.autoplay.running) return;
+                clearTimeout(t), e || (f = !0);
+                const a = () => {
+                    l("autoplayPause"), i.params.autoplay.waitForTransition ? i.wrapperEl.addEventListener("transitionend", y) : C()
+                };
+                if (i.autoplay.paused = !0, s) return h && (d = i.params.autoplay.delay), h = !1, void a();
+                const r = d || i.params.autoplay.delay;
+                d = r - ((new Date).getTime() - b), i.isEnd && d < 0 && !i.params.loop || (d < 0 && (d = 0), a())
+            },
+            C = () => {
+                i.isEnd && d < 0 && !i.params.loop || i.destroyed || !i.autoplay.running || (b = (new Date).getTime(), f ? (f = !1, x(d)) : x(), i.autoplay.paused = !1, l("autoplayResume"))
+            },
+            P = () => {
+                if (i.destroyed || !i.autoplay.running) return;
+                const e = a();
+                "hidden" === e.visibilityState && (f = !0, M(!0)), "visible" === e.visibilityState && C()
+            },
+            L = e => {
+                "mouse" === e.pointerType && (f = !0, g = !0, i.animating || i.autoplay.paused || M(!0))
+            },
+            I = e => {
+                "mouse" === e.pointerType && (g = !1, i.autoplay.paused && C())
+            };
+        n("init", (() => {
+            i.params.autoplay.enabled && (i.params.autoplay.pauseOnMouseEnter && (i.el.addEventListener("pointerenter", L), i.el.addEventListener("pointerleave", I)), a().addEventListener("visibilitychange", P), S())
+        })), n("destroy", (() => {
+            i.el.removeEventListener("pointerenter", L), i.el.removeEventListener("pointerleave", I), a().removeEventListener("visibilitychange", P), i.autoplay.running && T()
+        })), n("_freeModeStaticRelease", (() => {
+            (u || f) && C()
+        })), n("_freeModeNoMomentumRelease", (() => {
+            i.params.autoplay.disableOnInteraction ? T() : M(!0, !0)
+        })), n("beforeTransitionStart", ((e, t, s) => {
+            !i.destroyed && i.autoplay.running && (s || !i.params.autoplay.disableOnInteraction ? M(!0, !0) : T())
+        })), n("sliderFirstMove", (() => {
+            !i.destroyed && i.autoplay.running && (i.params.autoplay.disableOnInteraction ? T() : (p = !0, u = !1, f = !1, m = setTimeout((() => {
+                f = !0, u = !0, M(!0)
+            }), 200)))
+        })), n("touchEnd", (() => {
+            if (!i.destroyed && i.autoplay.running && p) {
+                if (clearTimeout(m), clearTimeout(t), i.params.autoplay.disableOnInteraction) return u = !1, void(p = !1);
+                u && i.params.cssMode && C(), u = !1, p = !1
+            }
+        })), n("slideChange", (() => {
+            !i.destroyed && i.autoplay.running && (h = !0)
+        })), Object.assign(i.autoplay, {
+            start: S,
+            stop: T,
+            pause: M,
+            resume: C
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
-            on: a
+            on: i
         } = e;
         s({
             thumbs: {
                 swiper: null,
                 multipleActiveThumbs: !0,
                 autoScrollOffset: 0,
                 slideThumbActiveClass: "swiper-slide-thumb-active",
                 thumbsContainerClass: "swiper-thumbs"
             }
         });
-        let i = !1,
-            r = !1;
+        let r = !1,
+            n = !1;
 
-        function n() {
+        function l() {
             const e = t.thumbs.swiper;
             if (!e || e.destroyed) return;
             const s = e.clickedIndex,
                 a = e.clickedSlide;
-            if (a && d(a).hasClass(t.params.thumbs.slideThumbActiveClass)) return;
+            if (a && a.classList.contains(t.params.thumbs.slideThumbActiveClass)) return;
             if (null == s) return;
             let i;
-            if (i = e.params.loop ? parseInt(d(e.clickedSlide).attr("data-swiper-slide-index"), 10) : s, t.params.loop) {
-                let e = t.activeIndex;
-                t.slides.eq(e).hasClass(t.params.slideDuplicateClass) && (t.loopFix(), t._clientLeft = t.$wrapperEl[0].clientLeft, e = t.activeIndex);
-                const s = t.slides.eq(e).prevAll(`[data-swiper-slide-index="${i}"]`).eq(0).index(),
-                    a = t.slides.eq(e).nextAll(`[data-swiper-slide-index="${i}"]`).eq(0).index();
-                i = void 0 === s ? a : void 0 === a ? s : a - e < e - s ? a : s
-            }
-            t.slideTo(i)
+            i = e.params.loop ? parseInt(e.clickedSlide.getAttribute("data-swiper-slide-index"), 10) : s, t.params.loop ? t.slideToLoop(i) : t.slideTo(i)
         }
 
-        function l() {
+        function o() {
             const {
                 thumbs: e
             } = t.params;
-            if (i) return !1;
-            i = !0;
+            if (r) return !1;
+            r = !0;
             const s = t.constructor;
             if (e.swiper instanceof s) t.thumbs.swiper = e.swiper, Object.assign(t.thumbs.swiper.originalParams, {
                 watchSlidesProgress: !0,
                 slideToClickedSlide: !1
             }), Object.assign(t.thumbs.swiper.params, {
                 watchSlidesProgress: !0,
                 slideToClickedSlide: !1
-            });
-            else if (m(e.swiper)) {
+            }), t.thumbs.swiper.update();
+            else if (c(e.swiper)) {
                 const a = Object.assign({}, e.swiper);
                 Object.assign(a, {
                     watchSlidesProgress: !0,
                     slideToClickedSlide: !1
-                }), t.thumbs.swiper = new s(a), r = !0
+                }), t.thumbs.swiper = new s(a), n = !0
             }
-            return t.thumbs.swiper.$el.addClass(t.params.thumbs.thumbsContainerClass), t.thumbs.swiper.on("tap", n), !0
+            return t.thumbs.swiper.el.classList.add(t.params.thumbs.thumbsContainerClass), t.thumbs.swiper.on("tap", l), !0
         }
 
-        function o(e) {
+        function d(e) {
             const s = t.thumbs.swiper;
             if (!s || s.destroyed) return;
             const a = "auto" === s.params.slidesPerView ? s.slidesPerViewDynamic() : s.params.slidesPerView;
             let i = 1;
             const r = t.params.thumbs.slideThumbActiveClass;
-            if (t.params.slidesPerView > 1 && !t.params.centeredSlides && (i = t.params.slidesPerView), t.params.thumbs.multipleActiveThumbs || (i = 1), i = Math.floor(i), s.slides.removeClass(r), s.params.loop || s.params.virtual && s.params.virtual.enabled)
-                for (let e = 0; e < i; e += 1) s.$wrapperEl.children(`[data-swiper-slide-index="${t.realIndex+e}"]`).addClass(r);
+            if (t.params.slidesPerView > 1 && !t.params.centeredSlides && (i = t.params.slidesPerView), t.params.thumbs.multipleActiveThumbs || (i = 1), i = Math.floor(i), s.slides.forEach((e => e.classList.remove(r))), s.params.loop || s.params.virtual && s.params.virtual.enabled)
+                for (let e = 0; e < i; e += 1) f(s.slidesEl, `[data-swiper-slide-index="${t.realIndex+e}"]`).forEach((e => {
+                    e.classList.add(r)
+                }));
             else
-                for (let e = 0; e < i; e += 1) s.slides.eq(t.realIndex + e).addClass(r);
+                for (let e = 0; e < i; e += 1) s.slides[t.realIndex + e] && s.slides[t.realIndex + e].classList.add(r);
             const n = t.params.thumbs.autoScrollOffset,
                 l = n && !s.params.loop;
             if (t.realIndex !== s.realIndex || l) {
-                let i, r, o = s.activeIndex;
+                const i = s.activeIndex;
+                let r, o;
                 if (s.params.loop) {
-                    s.slides.eq(o).hasClass(s.params.slideDuplicateClass) && (s.loopFix(), s._clientLeft = s.$wrapperEl[0].clientLeft, o = s.activeIndex);
-                    const e = s.slides.eq(o).prevAll(`[data-swiper-slide-index="${t.realIndex}"]`).eq(0).index(),
-                        a = s.slides.eq(o).nextAll(`[data-swiper-slide-index="${t.realIndex}"]`).eq(0).index();
-                    i = void 0 === e ? a : void 0 === a ? e : a - o == o - e ? s.params.slidesPerGroup > 1 ? a : o : a - o < o - e ? a : e, r = t.activeIndex > t.previousIndex ? "next" : "prev"
-                } else i = t.realIndex, r = i > t.previousIndex ? "next" : "prev";
-                l && (i += "next" === r ? n : -1 * n), s.visibleSlidesIndexes && s.visibleSlidesIndexes.indexOf(i) < 0 && (s.params.centeredSlides ? i = i > o ? i - Math.floor(a / 2) + 1 : i + Math.floor(a / 2) - 1 : i > o && s.params.slidesPerGroup, s.slideTo(i, e ? 0 : void 0))
+                    const e = s.slides.filter((e => e.getAttribute("data-swiper-slide-index") === `${t.realIndex}`))[0];
+                    r = s.slides.indexOf(e), o = t.activeIndex > t.previousIndex ? "next" : "prev"
+                } else r = t.realIndex, o = r > t.previousIndex ? "next" : "prev";
+                l && (r += "next" === o ? n : -1 * n), s.visibleSlidesIndexes && s.visibleSlidesIndexes.indexOf(r) < 0 && (s.params.centeredSlides ? r = r > i ? r - Math.floor(a / 2) + 1 : r + Math.floor(a / 2) - 1 : r > i && s.params.slidesPerGroup, s.slideTo(r, e ? 0 : void 0))
             }
         }
         t.thumbs = {
             swiper: null
-        }, a("beforeInit", (() => {
+        }, i("beforeInit", (() => {
             const {
                 thumbs: e
             } = t.params;
-            e && e.swiper && (l(), o(!0))
-        })), a("slideChange update resize observerUpdate", (() => {
-            o()
-        })), a("setTransition", ((e, s) => {
+            if (e && e.swiper)
+                if ("string" == typeof e.swiper || e.swiper instanceof HTMLElement) {
+                    const s = a(),
+                        i = () => {
+                            const a = "string" == typeof e.swiper ? s.querySelector(e.swiper) : e.swiper;
+                            if (a && a.swiper) e.swiper = a.swiper, o(), d(!0);
+                            else if (a) {
+                                const s = i => {
+                                    e.swiper = i.detail[0], a.removeEventListener("init", s), o(), d(!0), e.swiper.update(), t.update()
+                                };
+                                a.addEventListener("init", s)
+                            }
+                            return a
+                        },
+                        r = () => {
+                            if (t.destroyed) return;
+                            i() || requestAnimationFrame(r)
+                        };
+                    requestAnimationFrame(r)
+                } else o(), d(!0)
+        })), i("slideChange update resize observerUpdate", (() => {
+            d()
+        })), i("setTransition", ((e, s) => {
             const a = t.thumbs.swiper;
             a && !a.destroyed && a.setTransition(s)
-        })), a("beforeDestroy", (() => {
+        })), i("beforeDestroy", (() => {
             const e = t.thumbs.swiper;
-            e && !e.destroyed && r && e.destroy()
+            e && !e.destroyed && n && e.destroy()
         })), Object.assign(t.thumbs, {
-            init: l,
-            update: o
+            init: o,
+            update: d
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             emit: a,
             once: i
@@ -4282,209 +4350,222 @@
                 momentumVelocityRatio: 1,
                 sticky: !1,
                 minimumVelocity: .02
             }
         }), Object.assign(t, {
             freeMode: {
                 onTouchStart: function() {
+                    if (t.params.cssMode) return;
                     const e = t.getTranslate();
                     t.setTranslate(e), t.setTransition(0), t.touchEventsData.velocities.length = 0, t.freeMode.onTouchEnd({
                         currentPos: t.rtl ? t.translate : -t.translate
                     })
                 },
                 onTouchMove: function() {
+                    if (t.params.cssMode) return;
                     const {
                         touchEventsData: e,
                         touches: s
                     } = t;
                     0 === e.velocities.length && e.velocities.push({
                         position: s[t.isHorizontal() ? "startX" : "startY"],
                         time: e.touchStartTime
                     }), e.velocities.push({
                         position: s[t.isHorizontal() ? "currentX" : "currentY"],
-                        time: u()
+                        time: o()
                     })
                 },
                 onTouchEnd: function(e) {
                     let {
                         currentPos: s
                     } = e;
+                    if (t.params.cssMode) return;
                     const {
                         params: r,
-                        $wrapperEl: n,
+                        wrapperEl: n,
                         rtlTranslate: l,
-                        snapGrid: o,
-                        touchEventsData: d
-                    } = t, c = u() - d.touchStartTime;
+                        snapGrid: d,
+                        touchEventsData: c
+                    } = t, p = o() - c.touchStartTime;
                     if (s < -t.minTranslate()) t.slideTo(t.activeIndex);
-                    else if (s > -t.maxTranslate()) t.slides.length < o.length ? t.slideTo(o.length - 1) : t.slideTo(t.slides.length - 1);
+                    else if (s > -t.maxTranslate()) t.slides.length < d.length ? t.slideTo(d.length - 1) : t.slideTo(t.slides.length - 1);
                     else {
                         if (r.freeMode.momentum) {
-                            if (d.velocities.length > 1) {
-                                const e = d.velocities.pop(),
-                                    s = d.velocities.pop(),
+                            if (c.velocities.length > 1) {
+                                const e = c.velocities.pop(),
+                                    s = c.velocities.pop(),
                                     a = e.position - s.position,
                                     i = e.time - s.time;
-                                t.velocity = a / i, t.velocity /= 2, Math.abs(t.velocity) < r.freeMode.minimumVelocity && (t.velocity = 0), (i > 150 || u() - e.time > 300) && (t.velocity = 0)
+                                t.velocity = a / i, t.velocity /= 2, Math.abs(t.velocity) < r.freeMode.minimumVelocity && (t.velocity = 0), (i > 150 || o() - e.time > 300) && (t.velocity = 0)
                             } else t.velocity = 0;
-                            t.velocity *= r.freeMode.momentumVelocityRatio, d.velocities.length = 0;
+                            t.velocity *= r.freeMode.momentumVelocityRatio, c.velocities.length = 0;
                             let e = 1e3 * r.freeMode.momentumRatio;
                             const s = t.velocity * e;
-                            let c = t.translate + s;
-                            l && (c = -c);
-                            let p, h = !1;
-                            const m = 20 * Math.abs(t.velocity) * r.freeMode.momentumBounceRatio;
+                            let p = t.translate + s;
+                            l && (p = -p);
+                            let u, m = !1;
+                            const h = 20 * Math.abs(t.velocity) * r.freeMode.momentumBounceRatio;
                             let f;
-                            if (c < t.maxTranslate()) r.freeMode.momentumBounce ? (c + t.maxTranslate() < -m && (c = t.maxTranslate() - m), p = t.maxTranslate(), h = !0, d.allowMomentumBounce = !0) : c = t.maxTranslate(), r.loop && r.centeredSlides && (f = !0);
-                            else if (c > t.minTranslate()) r.freeMode.momentumBounce ? (c - t.minTranslate() > m && (c = t.minTranslate() + m), p = t.minTranslate(), h = !0, d.allowMomentumBounce = !0) : c = t.minTranslate(), r.loop && r.centeredSlides && (f = !0);
+                            if (p < t.maxTranslate()) r.freeMode.momentumBounce ? (p + t.maxTranslate() < -h && (p = t.maxTranslate() - h), u = t.maxTranslate(), m = !0, c.allowMomentumBounce = !0) : p = t.maxTranslate(), r.loop && r.centeredSlides && (f = !0);
+                            else if (p > t.minTranslate()) r.freeMode.momentumBounce ? (p - t.minTranslate() > h && (p = t.minTranslate() + h), u = t.minTranslate(), m = !0, c.allowMomentumBounce = !0) : p = t.minTranslate(), r.loop && r.centeredSlides && (f = !0);
                             else if (r.freeMode.sticky) {
                                 let e;
-                                for (let t = 0; t < o.length; t += 1)
-                                    if (o[t] > -c) {
+                                for (let t = 0; t < d.length; t += 1)
+                                    if (d[t] > -p) {
                                         e = t;
                                         break
-                                    } c = Math.abs(o[e] - c) < Math.abs(o[e - 1] - c) || "next" === t.swipeDirection ? o[e] : o[e - 1], c = -c
+                                    } p = Math.abs(d[e] - p) < Math.abs(d[e - 1] - p) || "next" === t.swipeDirection ? d[e] : d[e - 1], p = -p
                             }
                             if (f && i("transitionEnd", (() => {
                                     t.loopFix()
                                 })), 0 !== t.velocity) {
-                                if (e = l ? Math.abs((-c - t.translate) / t.velocity) : Math.abs((c - t.translate) / t.velocity), r.freeMode.sticky) {
-                                    const s = Math.abs((l ? -c : c) - t.translate),
+                                if (e = l ? Math.abs((-p - t.translate) / t.velocity) : Math.abs((p - t.translate) / t.velocity), r.freeMode.sticky) {
+                                    const s = Math.abs((l ? -p : p) - t.translate),
                                         a = t.slidesSizesGrid[t.activeIndex];
                                     e = s < a ? r.speed : s < 2 * a ? 1.5 * r.speed : 2.5 * r.speed
                                 }
                             } else if (r.freeMode.sticky) return void t.slideToClosest();
-                            r.freeMode.momentumBounce && h ? (t.updateProgress(p), t.setTransition(e), t.setTranslate(c), t.transitionStart(!0, t.swipeDirection), t.animating = !0, n.transitionEnd((() => {
-                                t && !t.destroyed && d.allowMomentumBounce && (a("momentumBounce"), t.setTransition(r.speed), setTimeout((() => {
-                                    t.setTranslate(p), n.transitionEnd((() => {
+                            r.freeMode.momentumBounce && m ? (t.updateProgress(u), t.setTransition(e), t.setTranslate(p), t.transitionStart(!0, t.swipeDirection), t.animating = !0, x(n, (() => {
+                                t && !t.destroyed && c.allowMomentumBounce && (a("momentumBounce"), t.setTransition(r.speed), setTimeout((() => {
+                                    t.setTranslate(u), x(n, (() => {
                                         t && !t.destroyed && t.transitionEnd()
                                     }))
                                 }), 0))
-                            }))) : t.velocity ? (a("_freeModeNoMomentumRelease"), t.updateProgress(c), t.setTransition(e), t.setTranslate(c), t.transitionStart(!0, t.swipeDirection), t.animating || (t.animating = !0, n.transitionEnd((() => {
+                            }))) : t.velocity ? (a("_freeModeNoMomentumRelease"), t.updateProgress(p), t.setTransition(e), t.setTranslate(p), t.transitionStart(!0, t.swipeDirection), t.animating || (t.animating = !0, x(n, (() => {
                                 t && !t.destroyed && t.transitionEnd()
-                            })))) : t.updateProgress(c), t.updateActiveIndex(), t.updateSlidesClasses()
+                            })))) : t.updateProgress(p), t.updateActiveIndex(), t.updateSlidesClasses()
                         } else {
                             if (r.freeMode.sticky) return void t.slideToClosest();
                             r.freeMode && a("_freeModeNoMomentumRelease")
-                        }(!r.freeMode.momentum || c >= r.longSwipesMs) && (t.updateProgress(), t.updateActiveIndex(), t.updateSlidesClasses())
+                        }(!r.freeMode.momentum || p >= r.longSwipesMs) && (a("_freeModeStaticRelease"), t.updateProgress(), t.updateActiveIndex(), t.updateSlidesClasses())
                     }
                 }
             }
         })
     }, function(e) {
-        let t, s, a, {
-            swiper: i,
-            extendParams: r
+        let t, s, a, i, {
+            swiper: r,
+            extendParams: n,
+            on: l
         } = e;
-        r({
+        n({
             grid: {
                 rows: 1,
                 fill: "column"
             }
-        }), i.grid = {
+        });
+        const o = () => {
+            let e = r.params.spaceBetween;
+            return "string" == typeof e && e.indexOf("%") >= 0 ? e = parseFloat(e.replace("%", "")) / 100 * r.size : "string" == typeof e && (e = parseFloat(e)), e
+        };
+        l("init", (() => {
+            i = r.params.grid && r.params.grid.rows > 1
+        })), l("update", (() => {
+            const {
+                params: e,
+                el: t
+            } = r, s = e.grid && e.grid.rows > 1;
+            i && !s ? (t.classList.remove(`${e.containerModifierClass}grid`, `${e.containerModifierClass}grid-column`), a = 1, r.emitContainerClasses()) : !i && s && (t.classList.add(`${e.containerModifierClass}grid`), "column" === e.grid.fill && t.classList.add(`${e.containerModifierClass}grid-column`), r.emitContainerClasses()), i = s
+        })), r.grid = {
             initSlides: e => {
                 const {
-                    slidesPerView: r
-                } = i.params, {
+                    slidesPerView: i
+                } = r.params, {
                     rows: n,
                     fill: l
-                } = i.params.grid;
-                s = t / n, a = Math.floor(e / n), t = Math.floor(e / n) === e / n ? e : Math.ceil(e / n) * n, "auto" !== r && "row" === l && (t = Math.max(t, r * n))
+                } = r.params.grid, o = r.virtual && r.params.virtual.enabled ? r.virtual.slides.length : e.length;
+                a = Math.floor(o / n), t = Math.floor(o / n) === o / n ? o : Math.ceil(o / n) * n, "auto" !== i && "row" === l && (t = Math.max(t, i * n)), s = t / n
+            },
+            unsetSlides: () => {
+                r.slides && r.slides.forEach((e => {
+                    e.swiperSlideGridSet && (e.style.height = "", e.style[r.getDirectionLabel("margin-top")] = "")
+                }))
             },
-            updateSlide: (e, r, n, l) => {
+            updateSlide: (e, i, n) => {
                 const {
-                    slidesPerGroup: o,
-                    spaceBetween: d
-                } = i.params, {
+                    slidesPerGroup: l
+                } = r.params, d = o(), {
                     rows: c,
                     fill: p
-                } = i.params.grid;
-                let u, h, m;
-                if ("row" === p && o > 1) {
-                    const s = Math.floor(e / (o * c)),
-                        a = e - c * o * s,
-                        i = 0 === s ? o : Math.min(Math.ceil((n - s * c * o) / c), o);
-                    m = Math.floor(a / i), h = a - m * i + s * o, u = h + m * t / c, r.css({
-                        "-webkit-order": u,
-                        order: u
-                    })
-                } else "column" === p ? (h = Math.floor(e / c), m = e - h * c, (h > a || h === a && m === c - 1) && (m += 1, m >= c && (m = 0, h += 1))) : (m = Math.floor(e / s), h = e - m * s);
-                r.css(l("margin-top"), 0 !== m ? d && `${d}px` : "")
+                } = r.params.grid, u = r.virtual && r.params.virtual.enabled ? r.virtual.slides.length : n.length;
+                let m, h, f;
+                if ("row" === p && l > 1) {
+                    const s = Math.floor(e / (l * c)),
+                        a = e - c * l * s,
+                        r = 0 === s ? l : Math.min(Math.ceil((u - s * c * l) / c), l);
+                    f = Math.floor(a / r), h = a - f * r + s * l, m = h + f * t / c, i.style.order = m
+                } else "column" === p ? (h = Math.floor(e / c), f = e - h * c, (h > a || h === a && f === c - 1) && (f += 1, f >= c && (f = 0, h += 1))) : (f = Math.floor(e / s), h = e - f * s);
+                i.row = f, i.column = h, i.style.height = `calc((100% - ${(c-1)*d}px) / ${c})`, i.style[r.getDirectionLabel("margin-top")] = 0 !== f ? d && `${d}px` : "", i.swiperSlideGridSet = !0
             },
-            updateWrapperSize: (e, s, a) => {
+            updateWrapperSize: (e, s) => {
                 const {
-                    spaceBetween: r,
-                    centeredSlides: n,
-                    roundLengths: l
-                } = i.params, {
-                    rows: o
-                } = i.params.grid;
-                if (i.virtualSize = (e + r) * t, i.virtualSize = Math.ceil(i.virtualSize / o) - r, i.$wrapperEl.css({
-                        [a("width")]: `${i.virtualSize+r}px`
-                    }), n) {
-                    s.splice(0, s.length);
+                    centeredSlides: a,
+                    roundLengths: i
+                } = r.params, n = o(), {
+                    rows: l
+                } = r.params.grid;
+                if (r.virtualSize = (e + n) * t, r.virtualSize = Math.ceil(r.virtualSize / l) - n, r.params.cssMode || (r.wrapperEl.style[r.getDirectionLabel("width")] = `${r.virtualSize+n}px`), a) {
                     const e = [];
                     for (let t = 0; t < s.length; t += 1) {
                         let a = s[t];
-                        l && (a = Math.floor(a)), s[t] < i.virtualSize + s[0] && e.push(a)
+                        i && (a = Math.floor(a)), s[t] < r.virtualSize + s[0] && e.push(a)
                     }
-                    s.push(...e)
+                    s.splice(0, s.length), s.push(...e)
                 }
             }
         }
     }, function(e) {
         let {
             swiper: t
         } = e;
         Object.assign(t, {
-            appendSlide: K.bind(t),
-            prependSlide: Z.bind(t),
-            addSlide: Q.bind(t),
-            removeSlide: J.bind(t),
-            removeAllSlides: ee.bind(t)
+            appendSlide: ie.bind(t),
+            prependSlide: re.bind(t),
+            addSlide: ne.bind(t),
+            removeSlide: le.bind(t),
+            removeAllSlides: oe.bind(t)
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a
         } = e;
         s({
             fadeEffect: {
-                crossFade: !1,
-                transformEl: null
+                crossFade: !1
             }
-        }), te({
+        }), de({
             effect: "fade",
             swiper: t,
             on: a,
             setTranslate: () => {
                 const {
                     slides: e
-                } = t, s = t.params.fadeEffect;
-                for (let a = 0; a < e.length; a += 1) {
-                    const e = t.slides.eq(a);
-                    let i = -e[0].swiperSlideOffset;
-                    t.params.virtualTranslate || (i -= t.translate);
-                    let r = 0;
-                    t.isHorizontal() || (r = i, i = 0);
-                    const n = t.params.fadeEffect.crossFade ? Math.max(1 - Math.abs(e[0].progress), 0) : 1 + Math.min(Math.max(e[0].progress, -1), 0);
-                    se(s, e).css({
-                        opacity: n
-                    }).transform(`translate3d(${i}px, ${r}px, 0px)`)
+                } = t;
+                t.params.fadeEffect;
+                for (let s = 0; s < e.length; s += 1) {
+                    const e = t.slides[s];
+                    let a = -e.swiperSlideOffset;
+                    t.params.virtualTranslate || (a -= t.translate);
+                    let i = 0;
+                    t.isHorizontal() || (i = a, a = 0);
+                    const r = t.params.fadeEffect.crossFade ? Math.max(1 - Math.abs(e.progress), 0) : 1 + Math.min(Math.max(e.progress, -1), 0),
+                        n = ce(0, e);
+                    n.style.opacity = r, n.style.transform = `translate3d(${a}px, ${i}px, 0px)`
                 }
             },
             setTransition: e => {
-                const {
-                    transformEl: s
-                } = t.params.fadeEffect;
-                (s ? t.slides.find(s) : t.slides).transition(e), ae({
+                const s = t.slides.map((e => h(e)));
+                s.forEach((t => {
+                    t.style.transitionDuration = `${e}ms`
+                })), pe({
                     swiper: t,
                     duration: e,
-                    transformEl: s,
+                    transformElements: s,
                     allSlides: !0
                 })
             },
             overwriteParams: () => ({
                 slidesPerView: 1,
                 slidesPerGroup: 1,
                 watchSlidesProgress: !0,
@@ -4503,79 +4584,81 @@
                 slideShadows: !0,
                 shadow: !0,
                 shadowOffset: 20,
                 shadowScale: .94
             }
         });
         const i = (e, t, s) => {
-            let a = s ? e.find(".swiper-slide-shadow-left") : e.find(".swiper-slide-shadow-top"),
-                i = s ? e.find(".swiper-slide-shadow-right") : e.find(".swiper-slide-shadow-bottom");
-            0 === a.length && (a = d(`<div class="swiper-slide-shadow-${s?"left":"top"}"></div>`), e.append(a)), 0 === i.length && (i = d(`<div class="swiper-slide-shadow-${s?"right":"bottom"}"></div>`), e.append(i)), a.length && (a[0].style.opacity = Math.max(-t, 0)), i.length && (i[0].style.opacity = Math.max(t, 0))
+            let a = s ? e.querySelector(".swiper-slide-shadow-left") : e.querySelector(".swiper-slide-shadow-top"),
+                i = s ? e.querySelector(".swiper-slide-shadow-right") : e.querySelector(".swiper-slide-shadow-bottom");
+            a || (a = v("div", ("swiper-slide-shadow-cube swiper-slide-shadow-" + (s ? "left" : "top")).split(" ")), e.append(a)), i || (i = v("div", ("swiper-slide-shadow-cube swiper-slide-shadow-" + (s ? "right" : "bottom")).split(" ")), e.append(i)), a && (a.style.opacity = Math.max(-t, 0)), i && (i.style.opacity = Math.max(t, 0))
         };
-        te({
+        de({
             effect: "cube",
             swiper: t,
             on: a,
             setTranslate: () => {
                 const {
-                    $el: e,
-                    $wrapperEl: s,
+                    el: e,
+                    wrapperEl: s,
                     slides: a,
                     width: r,
                     height: n,
                     rtlTranslate: l,
                     size: o,
-                    browser: c
-                } = t, p = t.params.cubeEffect, u = t.isHorizontal(), h = t.virtual && t.params.virtual.enabled;
-                let m, f = 0;
-                p.shadow && (u ? (m = s.find(".swiper-cube-shadow"), 0 === m.length && (m = d('<div class="swiper-cube-shadow"></div>'), s.append(m)), m.css({
-                    height: `${r}px`
-                })) : (m = e.find(".swiper-cube-shadow"), 0 === m.length && (m = d('<div class="swiper-cube-shadow"></div>'), e.append(m))));
+                    browser: d
+                } = t, c = t.params.cubeEffect, p = t.isHorizontal(), u = t.virtual && t.params.virtual.enabled;
+                let m, h = 0;
+                c.shadow && (p ? (m = t.wrapperEl.querySelector(".swiper-cube-shadow"), m || (m = v("div", "swiper-cube-shadow"), t.wrapperEl.append(m)), m.style.height = `${r}px`) : (m = e.querySelector(".swiper-cube-shadow"), m || (m = v("div", "swiper-cube-shadow"), e.append(m))));
                 for (let e = 0; e < a.length; e += 1) {
-                    const t = a.eq(e);
-                    let s = e;
-                    h && (s = parseInt(t.attr("data-swiper-slide-index"), 10));
-                    let r = 90 * s,
-                        n = Math.floor(r / 360);
-                    l && (r = -r, n = Math.floor(-r / 360));
-                    const d = Math.max(Math.min(t[0].progress, 1), -1);
-                    let c = 0,
-                        m = 0,
-                        g = 0;
-                    s % 4 == 0 ? (c = 4 * -n * o, g = 0) : (s - 1) % 4 == 0 ? (c = 0, g = 4 * -n * o) : (s - 2) % 4 == 0 ? (c = o + 4 * n * o, g = o) : (s - 3) % 4 == 0 && (c = -o, g = 3 * o + 4 * o * n), l && (c = -c), u || (m = c, c = 0);
-                    const v = `rotateX(${u?0:-r}deg) rotateY(${u?r:0}deg) translate3d(${c}px, ${m}px, ${g}px)`;
-                    d <= 1 && d > -1 && (f = 90 * s + 90 * d, l && (f = 90 * -s - 90 * d)), t.transform(v), p.slideShadows && i(t, d, u)
-                }
-                if (s.css({
-                        "-webkit-transform-origin": `50% 50% -${o/2}px`,
-                        "transform-origin": `50% 50% -${o/2}px`
-                    }), p.shadow)
-                    if (u) m.transform(`translate3d(0px, ${r/2+p.shadowOffset}px, ${-r/2}px) rotateX(90deg) rotateZ(0deg) scale(${p.shadowScale})`);
+                    const s = a[e];
+                    let r = e;
+                    u && (r = parseInt(s.getAttribute("data-swiper-slide-index"), 10));
+                    let n = 90 * r,
+                        d = Math.floor(n / 360);
+                    l && (n = -n, d = Math.floor(-n / 360));
+                    const m = Math.max(Math.min(s.progress, 1), -1);
+                    let f = 0,
+                        g = 0,
+                        v = 0;
+                    r % 4 == 0 ? (f = 4 * -d * o, v = 0) : (r - 1) % 4 == 0 ? (f = 0, v = 4 * -d * o) : (r - 2) % 4 == 0 ? (f = o + 4 * d * o, v = o) : (r - 3) % 4 == 0 && (f = -o, v = 3 * o + 4 * o * d), l && (f = -f), p || (g = f, f = 0);
+                    const w = `rotateX(${p?0:-n}deg) rotateY(${p?n:0}deg) translate3d(${f}px, ${g}px, ${v}px)`;
+                    m <= 1 && m > -1 && (h = 90 * r + 90 * m, l && (h = 90 * -r - 90 * m), t.browser && t.browser.need3dFix && Math.abs(h) / 90 % 2 == 1 && (h += .001)), s.style.transform = w, c.slideShadows && i(s, m, p)
+                }
+                if (s.style.transformOrigin = `50% 50% -${o/2}px`, s.style["-webkit-transform-origin"] = `50% 50% -${o/2}px`, c.shadow)
+                    if (p) m.style.transform = `translate3d(0px, ${r/2+c.shadowOffset}px, ${-r/2}px) rotateX(89.99deg) rotateZ(0deg) scale(${c.shadowScale})`;
                     else {
-                        const e = Math.abs(f) - 90 * Math.floor(Math.abs(f) / 90),
+                        const e = Math.abs(h) - 90 * Math.floor(Math.abs(h) / 90),
                             t = 1.5 - (Math.sin(2 * e * Math.PI / 360) / 2 + Math.cos(2 * e * Math.PI / 360) / 2),
-                            s = p.shadowScale,
-                            a = p.shadowScale / t,
-                            i = p.shadowOffset;
-                        m.transform(`scale3d(${s}, 1, ${a}) translate3d(0px, ${n/2+i}px, ${-n/2/a}px) rotateX(-90deg)`)
-                    } const g = c.isSafari || c.isWebView ? -o / 2 : 0;
-                s.transform(`translate3d(0px,0,${g}px) rotateX(${t.isHorizontal()?0:f}deg) rotateY(${t.isHorizontal()?-f:0}deg)`), s[0].style.setProperty("--swiper-cube-translate-z", `${g}px`)
+                            s = c.shadowScale,
+                            a = c.shadowScale / t,
+                            i = c.shadowOffset;
+                        m.style.transform = `scale3d(${s}, 1, ${a}) translate3d(0px, ${n/2+i}px, ${-n/2/a}px) rotateX(-89.99deg)`
+                    } const f = (d.isSafari || d.isWebView) && d.needPerspectiveFix ? -o / 2 : 0;
+                s.style.transform = `translate3d(0px,0,${f}px) rotateX(${t.isHorizontal()?0:h}deg) rotateY(${t.isHorizontal()?-h:0}deg)`, s.style.setProperty("--swiper-cube-translate-z", `${f}px`)
             },
             setTransition: e => {
                 const {
-                    $el: s,
+                    el: s,
                     slides: a
                 } = t;
-                a.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e), t.params.cubeEffect.shadow && !t.isHorizontal() && s.find(".swiper-cube-shadow").transition(e)
+                if (a.forEach((t => {
+                        t.style.transitionDuration = `${e}ms`, t.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((t => {
+                            t.style.transitionDuration = `${e}ms`
+                        }))
+                    })), t.params.cubeEffect.shadow && !t.isHorizontal()) {
+                    const t = s.querySelector(".swiper-cube-shadow");
+                    t && (t.style.transitionDuration = `${e}ms`)
+                }
             },
             recreateShadows: () => {
                 const e = t.isHorizontal();
-                t.slides.each((t => {
+                t.slides.forEach((t => {
                     const s = Math.max(Math.min(t.progress, 1), -1);
-                    i(d(t), s, e)
+                    i(t, s, e)
                 }))
             },
             getEffectParams: () => t.params.cubeEffect,
             perspective: () => !0,
             overwriteParams: () => ({
                 slidesPerView: 1,
                 slidesPerGroup: 1,
@@ -4591,62 +4674,61 @@
             swiper: t,
             extendParams: s,
             on: a
         } = e;
         s({
             flipEffect: {
                 slideShadows: !0,
-                limitRotation: !0,
-                transformEl: null
+                limitRotation: !0
             }
         });
-        const i = (e, s, a) => {
-            let i = t.isHorizontal() ? e.find(".swiper-slide-shadow-left") : e.find(".swiper-slide-shadow-top"),
-                r = t.isHorizontal() ? e.find(".swiper-slide-shadow-right") : e.find(".swiper-slide-shadow-bottom");
-            0 === i.length && (i = ie(a, e, t.isHorizontal() ? "left" : "top")), 0 === r.length && (r = ie(a, e, t.isHorizontal() ? "right" : "bottom")), i.length && (i[0].style.opacity = Math.max(-s, 0)), r.length && (r[0].style.opacity = Math.max(s, 0))
+        const i = (e, s) => {
+            let a = t.isHorizontal() ? e.querySelector(".swiper-slide-shadow-left") : e.querySelector(".swiper-slide-shadow-top"),
+                i = t.isHorizontal() ? e.querySelector(".swiper-slide-shadow-right") : e.querySelector(".swiper-slide-shadow-bottom");
+            a || (a = ue("flip", e, t.isHorizontal() ? "left" : "top")), i || (i = ue("flip", e, t.isHorizontal() ? "right" : "bottom")), a && (a.style.opacity = Math.max(-s, 0)), i && (i.style.opacity = Math.max(s, 0))
         };
-        te({
+        de({
             effect: "flip",
             swiper: t,
             on: a,
             setTranslate: () => {
                 const {
                     slides: e,
                     rtlTranslate: s
                 } = t, a = t.params.flipEffect;
                 for (let r = 0; r < e.length; r += 1) {
-                    const n = e.eq(r);
-                    let l = n[0].progress;
-                    t.params.flipEffect.limitRotation && (l = Math.max(Math.min(n[0].progress, 1), -1));
-                    const o = n[0].swiperSlideOffset;
+                    const n = e[r];
+                    let l = n.progress;
+                    t.params.flipEffect.limitRotation && (l = Math.max(Math.min(n.progress, 1), -1));
+                    const o = n.swiperSlideOffset;
                     let d = -180 * l,
                         c = 0,
                         p = t.params.cssMode ? -o - t.translate : -o,
                         u = 0;
-                    t.isHorizontal() ? s && (d = -d) : (u = p, p = 0, c = -d, d = 0), n[0].style.zIndex = -Math.abs(Math.round(l)) + e.length, a.slideShadows && i(n, l, a);
-                    const h = `translate3d(${p}px, ${u}px, 0px) rotateX(${c}deg) rotateY(${d}deg)`;
-                    se(a, n).transform(h)
+                    t.isHorizontal() ? s && (d = -d) : (u = p, p = 0, c = -d, d = 0), t.browser && t.browser.need3dFix && (Math.abs(d) / 90 % 2 == 1 && (d += .001), Math.abs(c) / 90 % 2 == 1 && (c += .001)), n.style.zIndex = -Math.abs(Math.round(l)) + e.length, a.slideShadows && i(n, l);
+                    const m = `translate3d(${p}px, ${u}px, 0px) rotateX(${c}deg) rotateY(${d}deg)`;
+                    ce(0, n).style.transform = m
                 }
             },
             setTransition: e => {
-                const {
-                    transformEl: s
-                } = t.params.flipEffect;
-                (s ? t.slides.find(s) : t.slides).transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e), ae({
+                const s = t.slides.map((e => h(e)));
+                s.forEach((t => {
+                    t.style.transitionDuration = `${e}ms`, t.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((t => {
+                        t.style.transitionDuration = `${e}ms`
+                    }))
+                })), pe({
                     swiper: t,
                     duration: e,
-                    transformEl: s
+                    transformElements: s
                 })
             },
             recreateShadows: () => {
-                const e = t.params.flipEffect;
-                t.slides.each((s => {
-                    const a = d(s);
-                    let r = a[0].progress;
-                    t.params.flipEffect.limitRotation && (r = Math.max(Math.min(s.progress, 1), -1)), i(a, r, e)
+                t.params.flipEffect, t.slides.forEach((e => {
+                    let s = e.progress;
+                    t.params.flipEffect.limitRotation && (s = Math.max(Math.min(e.progress, 1), -1)), i(e, s)
                 }))
             },
             getEffectParams: () => t.params.flipEffect,
             perspective: () => !0,
             overwriteParams: () => ({
                 slidesPerView: 1,
                 slidesPerGroup: 1,
@@ -4664,70 +4746,69 @@
         s({
             coverflowEffect: {
                 rotate: 50,
                 stretch: 0,
                 depth: 100,
                 scale: 1,
                 modifier: 1,
-                slideShadows: !0,
-                transformEl: null
+                slideShadows: !0
             }
-        }), te({
+        }), de({
             effect: "coverflow",
             swiper: t,
             on: a,
             setTranslate: () => {
                 const {
                     width: e,
                     height: s,
                     slides: a,
                     slidesSizesGrid: i
                 } = t, r = t.params.coverflowEffect, n = t.isHorizontal(), l = t.translate, o = n ? e / 2 - l : s / 2 - l, d = n ? r.rotate : -r.rotate, c = r.depth;
-                for (let e = 0, t = a.length; e < t; e += 1) {
-                    const t = a.eq(e),
-                        s = i[e],
-                        l = (o - t[0].swiperSlideOffset - s / 2) / s,
-                        p = "function" == typeof r.modifier ? r.modifier(l) : l * r.modifier;
-                    let u = n ? d * p : 0,
-                        h = n ? 0 : d * p,
-                        m = -c * Math.abs(p),
-                        f = r.stretch;
-                    "string" == typeof f && -1 !== f.indexOf("%") && (f = parseFloat(r.stretch) / 100 * s);
-                    let g = n ? 0 : f * p,
-                        v = n ? f * p : 0,
-                        w = 1 - (1 - r.scale) * Math.abs(p);
-                    Math.abs(v) < .001 && (v = 0), Math.abs(g) < .001 && (g = 0), Math.abs(m) < .001 && (m = 0), Math.abs(u) < .001 && (u = 0), Math.abs(h) < .001 && (h = 0), Math.abs(w) < .001 && (w = 0);
-                    const b = `translate3d(${v}px,${g}px,${m}px)  rotateX(${h}deg) rotateY(${u}deg) scale(${w})`;
-                    if (se(r, t).transform(b), t[0].style.zIndex = 1 - Math.abs(Math.round(p)), r.slideShadows) {
-                        let e = n ? t.find(".swiper-slide-shadow-left") : t.find(".swiper-slide-shadow-top"),
-                            s = n ? t.find(".swiper-slide-shadow-right") : t.find(".swiper-slide-shadow-bottom");
-                        0 === e.length && (e = ie(r, t, n ? "left" : "top")), 0 === s.length && (s = ie(r, t, n ? "right" : "bottom")), e.length && (e[0].style.opacity = p > 0 ? p : 0), s.length && (s[0].style.opacity = -p > 0 ? -p : 0)
+                for (let e = 0, s = a.length; e < s; e += 1) {
+                    const s = a[e],
+                        l = i[e],
+                        p = (o - s.swiperSlideOffset - l / 2) / l,
+                        u = "function" == typeof r.modifier ? r.modifier(p) : p * r.modifier;
+                    let m = n ? d * u : 0,
+                        h = n ? 0 : d * u,
+                        f = -c * Math.abs(u),
+                        g = r.stretch;
+                    "string" == typeof g && -1 !== g.indexOf("%") && (g = parseFloat(r.stretch) / 100 * l);
+                    let v = n ? 0 : g * u,
+                        w = n ? g * u : 0,
+                        b = 1 - (1 - r.scale) * Math.abs(u);
+                    Math.abs(w) < .001 && (w = 0), Math.abs(v) < .001 && (v = 0), Math.abs(f) < .001 && (f = 0), Math.abs(m) < .001 && (m = 0), Math.abs(h) < .001 && (h = 0), Math.abs(b) < .001 && (b = 0), t.browser && t.browser.need3dFix && (Math.abs(m) / 90 % 2 == 1 && (m += .001), Math.abs(h) / 90 % 2 == 1 && (h += .001));
+                    const y = `translate3d(${w}px,${v}px,${f}px)  rotateX(${h}deg) rotateY(${m}deg) scale(${b})`;
+                    if (ce(0, s).style.transform = y, s.style.zIndex = 1 - Math.abs(Math.round(u)), r.slideShadows) {
+                        let e = n ? s.querySelector(".swiper-slide-shadow-left") : s.querySelector(".swiper-slide-shadow-top"),
+                            t = n ? s.querySelector(".swiper-slide-shadow-right") : s.querySelector(".swiper-slide-shadow-bottom");
+                        e || (e = ue("coverflow", s, n ? "left" : "top")), t || (t = ue("coverflow", s, n ? "right" : "bottom")), e && (e.style.opacity = u > 0 ? u : 0), t && (t.style.opacity = -u > 0 ? -u : 0)
                     }
                 }
             },
             setTransition: e => {
-                const {
-                    transformEl: s
-                } = t.params.coverflowEffect;
-                (s ? t.slides.find(s) : t.slides).transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)
+                t.slides.map((e => h(e))).forEach((t => {
+                    t.style.transitionDuration = `${e}ms`, t.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((t => {
+                        t.style.transitionDuration = `${e}ms`
+                    }))
+                }))
             },
             perspective: () => !0,
             overwriteParams: () => ({
                 watchSlidesProgress: !0
             })
         })
     }, function(e) {
         let {
             swiper: t,
             extendParams: s,
             on: a
         } = e;
         s({
             creativeEffect: {
-                transformEl: null,
                 limitProgress: 1,
                 shadowPerProgress: !1,
                 progressMultiplier: 1,
                 perspective: !0,
                 prev: {
                     translate: [0, 0, 0],
                     rotate: [0, 0, 0],
@@ -4739,78 +4820,79 @@
                     rotate: [0, 0, 0],
                     opacity: 1,
                     scale: 1
                 }
             }
         });
         const i = e => "string" == typeof e ? e : `${e}px`;
-        te({
+        de({
             effect: "creative",
             swiper: t,
             on: a,
             setTranslate: () => {
                 const {
                     slides: e,
-                    $wrapperEl: s,
+                    wrapperEl: s,
                     slidesSizesGrid: a
                 } = t, r = t.params.creativeEffect, {
                     progressMultiplier: n
                 } = r, l = t.params.centeredSlides;
                 if (l) {
                     const e = a[0] / 2 - t.params.slidesOffsetBefore || 0;
-                    s.transform(`translateX(calc(50% - ${e}px))`)
+                    s.style.transform = `translateX(calc(50% - ${e}px))`
                 }
                 for (let s = 0; s < e.length; s += 1) {
-                    const a = e.eq(s),
-                        o = a[0].progress,
-                        d = Math.min(Math.max(a[0].progress, -r.limitProgress), r.limitProgress);
+                    const a = e[s],
+                        o = a.progress,
+                        d = Math.min(Math.max(a.progress, -r.limitProgress), r.limitProgress);
                     let c = d;
-                    l || (c = Math.min(Math.max(a[0].originalProgress, -r.limitProgress), r.limitProgress));
-                    const p = a[0].swiperSlideOffset,
+                    l || (c = Math.min(Math.max(a.originalProgress, -r.limitProgress), r.limitProgress));
+                    const p = a.swiperSlideOffset,
                         u = [t.params.cssMode ? -p - t.translate : -p, 0, 0],
-                        h = [0, 0, 0];
-                    let m = !1;
+                        m = [0, 0, 0];
+                    let h = !1;
                     t.isHorizontal() || (u[1] = u[0], u[0] = 0);
                     let f = {
                         translate: [0, 0, 0],
                         rotate: [0, 0, 0],
                         scale: 1,
                         opacity: 1
                     };
-                    d < 0 ? (f = r.next, m = !0) : d > 0 && (f = r.prev, m = !0), u.forEach(((e, t) => {
+                    d < 0 ? (f = r.next, h = !0) : d > 0 && (f = r.prev, h = !0), u.forEach(((e, t) => {
                         u[t] = `calc(${e}px + (${i(f.translate[t])} * ${Math.abs(d*n)}))`
-                    })), h.forEach(((e, t) => {
-                        h[t] = f.rotate[t] * Math.abs(d * n)
-                    })), a[0].style.zIndex = -Math.abs(Math.round(o)) + e.length;
+                    })), m.forEach(((e, s) => {
+                        let a = f.rotate[s] * Math.abs(d * n);
+                        t.browser && t.browser.need3dFix && Math.abs(a) / 90 % 2 == 1 && (a += .001), m[s] = a
+                    })), a.style.zIndex = -Math.abs(Math.round(o)) + e.length;
                     const g = u.join(", "),
-                        v = `rotateX(${h[0]}deg) rotateY(${h[1]}deg) rotateZ(${h[2]}deg)`,
+                        v = `rotateX(${m[0]}deg) rotateY(${m[1]}deg) rotateZ(${m[2]}deg)`,
                         w = c < 0 ? `scale(${1+(1-f.scale)*c*n})` : `scale(${1-(1-f.scale)*c*n})`,
                         b = c < 0 ? 1 + (1 - f.opacity) * c * n : 1 - (1 - f.opacity) * c * n,
-                        x = `translate3d(${g}) ${v} ${w}`;
-                    if (m && f.shadow || !m) {
-                        let e = a.children(".swiper-slide-shadow");
-                        if (0 === e.length && f.shadow && (e = ie(r, a)), e.length) {
+                        y = `translate3d(${g}) ${v} ${w}`;
+                    if (h && f.shadow || !h) {
+                        let e = a.querySelector(".swiper-slide-shadow");
+                        if (!e && f.shadow && (e = ue("creative", a)), e) {
                             const t = r.shadowPerProgress ? d * (1 / r.limitProgress) : d;
-                            e[0].style.opacity = Math.min(Math.max(Math.abs(t), 0), 1)
+                            e.style.opacity = Math.min(Math.max(Math.abs(t), 0), 1)
                         }
                     }
-                    const y = se(r, a);
-                    y.transform(x).css({
-                        opacity: b
-                    }), f.origin && y.css("transform-origin", f.origin)
+                    const E = ce(0, a);
+                    E.style.transform = y, E.style.opacity = b, f.origin && (E.style.transformOrigin = f.origin)
                 }
             },
             setTransition: e => {
-                const {
-                    transformEl: s
-                } = t.params.creativeEffect;
-                (s ? t.slides.find(s) : t.slides).transition(e).find(".swiper-slide-shadow").transition(e), ae({
+                const s = t.slides.map((e => h(e)));
+                s.forEach((t => {
+                    t.style.transitionDuration = `${e}ms`, t.querySelectorAll(".swiper-slide-shadow").forEach((t => {
+                        t.style.transitionDuration = `${e}ms`
+                    }))
+                })), pe({
                     swiper: t,
                     duration: e,
-                    transformEl: s,
+                    transformElements: s,
                     allSlides: !0
                 })
             },
             perspective: () => t.params.creativeEffect.perspective,
             overwriteParams: () => ({
                 watchSlidesProgress: !0,
                 virtualTranslate: !t.params.cssMode
@@ -4821,77 +4903,79 @@
             swiper: t,
             extendParams: s,
             on: a
         } = e;
         s({
             cardsEffect: {
                 slideShadows: !0,
-                transformEl: null,
                 rotate: !0,
                 perSlideRotate: 2,
                 perSlideOffset: 8
             }
-        }), te({
+        }), de({
             effect: "cards",
             swiper: t,
             on: a,
             setTranslate: () => {
                 const {
                     slides: e,
-                    activeIndex: s
-                } = t, a = t.params.cardsEffect, {
-                    startTranslate: i,
-                    isTouched: r
-                } = t.touchEventsData, n = t.translate;
-                for (let l = 0; l < e.length; l += 1) {
-                    const o = e.eq(l),
-                        d = o[0].progress,
-                        c = Math.min(Math.max(d, -4), 4);
-                    let p = o[0].swiperSlideOffset;
-                    t.params.centeredSlides && !t.params.cssMode && t.$wrapperEl.transform(`translateX(${t.minTranslate()}px)`), t.params.centeredSlides && t.params.cssMode && (p -= e[0].swiperSlideOffset);
-                    let u = t.params.cssMode ? -p - t.translate : -p,
+                    activeIndex: s,
+                    rtlTranslate: a
+                } = t, i = t.params.cardsEffect, {
+                    startTranslate: r,
+                    isTouched: n
+                } = t.touchEventsData, l = a ? -t.translate : t.translate;
+                for (let o = 0; o < e.length; o += 1) {
+                    const d = e[o],
+                        c = d.progress,
+                        p = Math.min(Math.max(c, -4), 4);
+                    let u = d.swiperSlideOffset;
+                    t.params.centeredSlides && !t.params.cssMode && (t.wrapperEl.style.transform = `translateX(${t.minTranslate()}px)`), t.params.centeredSlides && t.params.cssMode && (u -= e[0].swiperSlideOffset);
+                    let m = t.params.cssMode ? -u - t.translate : -u,
                         h = 0;
-                    const m = -100 * Math.abs(c);
-                    let f = 1,
-                        g = -a.perSlideRotate * c,
-                        v = a.perSlideOffset - .75 * Math.abs(c);
-                    const w = t.virtual && t.params.virtual.enabled ? t.virtual.from + l : l,
-                        b = (w === s || w === s - 1) && c > 0 && c < 1 && (r || t.params.cssMode) && n < i,
-                        x = (w === s || w === s + 1) && c < 0 && c > -1 && (r || t.params.cssMode) && n > i;
-                    if (b || x) {
-                        const e = (1 - Math.abs((Math.abs(c) - .5) / .5)) ** .5;
-                        g += -28 * c * e, f += -.5 * e, v += 96 * e, h = -25 * e * Math.abs(c) + "%"
+                    const f = -100 * Math.abs(p);
+                    let g = 1,
+                        v = -i.perSlideRotate * p,
+                        w = i.perSlideOffset - .75 * Math.abs(p);
+                    const b = t.virtual && t.params.virtual.enabled ? t.virtual.from + o : o,
+                        y = (b === s || b === s - 1) && p > 0 && p < 1 && (n || t.params.cssMode) && l < r,
+                        E = (b === s || b === s + 1) && p < 0 && p > -1 && (n || t.params.cssMode) && l > r;
+                    if (y || E) {
+                        const e = (1 - Math.abs((Math.abs(p) - .5) / .5)) ** .5;
+                        v += -28 * p * e, g += -.5 * e, w += 96 * e, h = -25 * e * Math.abs(p) + "%"
                     }
-                    if (u = c < 0 ? `calc(${u}px + (${v*Math.abs(c)}%))` : c > 0 ? `calc(${u}px + (-${v*Math.abs(c)}%))` : `${u}px`, !t.isHorizontal()) {
+                    if (m = p < 0 ? `calc(${m}px ${a?"-":"+"} (${w*Math.abs(p)}%))` : p > 0 ? `calc(${m}px ${a?"-":"+"} (-${w*Math.abs(p)}%))` : `${m}px`, !t.isHorizontal()) {
                         const e = h;
-                        h = u, u = e
+                        h = m, m = e
                     }
-                    const y = c < 0 ? "" + (1 + (1 - f) * c) : "" + (1 - (1 - f) * c),
-                        E = `\n        translate3d(${u}, ${h}, ${m}px)\n        rotateZ(${a.rotate?g:0}deg)\n        scale(${y})\n      `;
-                    if (a.slideShadows) {
-                        let e = o.find(".swiper-slide-shadow");
-                        0 === e.length && (e = ie(a, o)), e.length && (e[0].style.opacity = Math.min(Math.max((Math.abs(c) - .5) / .5, 0), 1))
+                    const x = p < 0 ? "" + (1 + (1 - g) * p) : "" + (1 - (1 - g) * p),
+                        S = `\n        translate3d(${m}, ${h}, ${f}px)\n        rotateZ(${i.rotate?a?-v:v:0}deg)\n        scale(${x})\n      `;
+                    if (i.slideShadows) {
+                        let e = d.querySelector(".swiper-slide-shadow");
+                        e || (e = ue("cards", d)), e && (e.style.opacity = Math.min(Math.max((Math.abs(p) - .5) / .5, 0), 1))
                     }
-                    o[0].style.zIndex = -Math.abs(Math.round(d)) + e.length;
-                    se(a, o).transform(E)
+                    d.style.zIndex = -Math.abs(Math.round(c)) + e.length;
+                    ce(0, d).style.transform = S
                 }
             },
             setTransition: e => {
-                const {
-                    transformEl: s
-                } = t.params.cardsEffect;
-                (s ? t.slides.find(s) : t.slides).transition(e).find(".swiper-slide-shadow").transition(e), ae({
+                const s = t.slides.map((e => h(e)));
+                s.forEach((t => {
+                    t.style.transitionDuration = `${e}ms`, t.querySelectorAll(".swiper-slide-shadow").forEach((t => {
+                        t.style.transitionDuration = `${e}ms`
+                    }))
+                })), pe({
                     swiper: t,
                     duration: e,
-                    transformEl: s
+                    transformElements: s
                 })
             },
             perspective: () => !0,
             overwriteParams: () => ({
                 watchSlidesProgress: !0,
                 virtualTranslate: !t.params.cssMode
             })
         })
     }];
-    return V.use(re), V
-}));
+    return te.use(me), te
+}();
 //# sourceMappingURL=swiper-bundle.min.js.map
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/__blog.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_blog.html`

 * *Files 14% similar despite different names*

```diff
@@ -1,56 +1,57 @@
-<!-- ======= Recent Blog Posts Section ======= -->
-<section id="recent-blog-posts" class="recent-blog-posts">
-
-  <div class="container" data-aos="fade-up">
-
-    <div class="section-header">
-      <h2>Blog</h2>
-      <p>Recent posts form our Blog</p>
-    </div>
-
-    <div class="row">
-
-      <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
-        <div class="post-box">
-          <div class="post-img"><img src="{% static 'img/herobizds/blog/blog-1.jpg' %}" class="img-fluid" alt=""></div>
-          <div class="meta">
-            <span class="post-date">Tue, December 12</span>
-            <span class="post-author"> / Julia Parker</span>
-          </div>
-          <h3 class="post-title">Eum ad dolor et. Autem aut fugiat debitis voluptatem consequuntur sit</h3>
-          <p>Illum voluptas ab enim placeat. Adipisci enim velit nulla. Vel omnis laudantium. Asperiores eum ipsa est officiis. Modi cupiditate exercitationem qui magni est...</p>
-          <a href="blog-details.html" class="readmore stretched-link"><span>Read More</span><i class="bi bi-arrow-right"></i></a>
-        </div>
-      </div>
-
-      <div class="col-lg-4" data-aos="fade-up" data-aos-delay="400">
-        <div class="post-box">
-          <div class="post-img"><img src="{% static 'img/herobizds/blog/blog-2.jpg' %}" class="img-fluid" alt=""></div>
-          <div class="meta">
-            <span class="post-date">Fri, September 05</span>
-            <span class="post-author"> / Mario Douglas</span>
-          </div>
-          <h3 class="post-title">Et repellendus molestiae qui est sed omnis voluptates magnam</h3>
-          <p>Voluptatem nesciunt omnis libero autem tempora enim ut ipsam id. Odit quia ab eum assumenda. Quisquam omnis aliquid necessitatibus tempora consectetur doloribus...</p>
-          <a href="blog-details.html" class="readmore stretched-link"><span>Read More</span><i class="bi bi-arrow-right"></i></a>
-        </div>
-      </div>
-
-      <div class="col-lg-4" data-aos="fade-up" data-aos-delay="600">
-        <div class="post-box">
-          <div class="post-img"><img src="{% static 'img/herobizds/blog/blog-3.jpg' %}" class="img-fluid" alt=""></div>
-          <div class="meta">
-            <span class="post-date">Tue, July 27</span>
-            <span class="post-author"> / Lisa Hunter</span>
-          </div>
-          <h3 class="post-title">Quia assumenda est et veritatis aut quae</h3>
-          <p>Quia nam eaque omnis explicabo similique eum quaerat similique laboriosam. Quis omnis repellat sed quae consectetur magnam veritatis dicta nihil...</p>
-          <a href="blog-details.html" class="readmore stretched-link"><span>Read More</span><i class="bi bi-arrow-right"></i></a>
-        </div>
-      </div>
-
-    </div>
-
-  </div>
-
-</section><!-- End Recent Blog Posts Section -->
+{% load static %}
+
+<section id="recent-blog-posts" class="recent-blog-posts">
+
+  <div class="container" data-aos="fade-up">
+
+    <div class="section-header">
+      <h2>Blog</h2>
+      <p>Recent posts form our Blog</p>
+    </div>
+
+    <div class="row">
+
+      <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
+        <div class="post-box">
+          <div class="post-img"><img src="{% static 'img/herobizds/blog/blog-1.jpg' %}" class="img-fluid" alt=""></div>
+          <div class="meta">
+            <span class="post-date">Tue, December 12</span>
+            <span class="post-author"> / Julia Parker</span>
+          </div>
+          <h3 class="post-title">Eum ad dolor et. Autem aut fugiat debitis voluptatem consequuntur sit</h3>
+          <p>Illum voluptas ab enim placeat. Adipisci enim velit nulla. Vel omnis laudantium. Asperiores eum ipsa est officiis. Modi cupiditate exercitationem qui magni est...</p>
+          <a href="blog-details.html" class="readmore stretched-link"><span>Read More</span><i class="bi bi-arrow-right"></i></a>
+        </div>
+      </div>
+
+      <div class="col-lg-4" data-aos="fade-up" data-aos-delay="400">
+        <div class="post-box">
+          <div class="post-img"><img src="{% static 'img/herobizds/blog/blog-2.jpg' %}" class="img-fluid" alt=""></div>
+          <div class="meta">
+            <span class="post-date">Fri, September 05</span>
+            <span class="post-author"> / Mario Douglas</span>
+          </div>
+          <h3 class="post-title">Et repellendus molestiae qui est sed omnis voluptates magnam</h3>
+          <p>Voluptatem nesciunt omnis libero autem tempora enim ut ipsam id. Odit quia ab eum assumenda. Quisquam omnis aliquid necessitatibus tempora consectetur doloribus...</p>
+          <a href="blog-details.html" class="readmore stretched-link"><span>Read More</span><i class="bi bi-arrow-right"></i></a>
+        </div>
+      </div>
+
+      <div class="col-lg-4" data-aos="fade-up" data-aos-delay="600">
+        <div class="post-box">
+          <div class="post-img"><img src="{% static 'img/herobizds/blog/blog-3.jpg' %}" class="img-fluid" alt=""></div>
+          <div class="meta">
+            <span class="post-date">Tue, July 27</span>
+            <span class="post-author"> / Lisa Hunter</span>
+          </div>
+          <h3 class="post-title">Quia assumenda est et veritatis aut quae</h3>
+          <p>Quia nam eaque omnis explicabo similique eum quaerat similique laboriosam. Quis omnis repellat sed quae consectetur magnam veritatis dicta nihil...</p>
+          <a href="blog-details.html" class="readmore stretched-link"><span>Read More</span><i class="bi bi-arrow-right"></i></a>
+        </div>
+      </div>
+
+    </div>
+
+  </div>
+
+</section>
```

#### html2text {}

```diff
@@ -1,7 +1,8 @@
+{% load static %}
 ********** BBlloogg **********
 Recent posts form our Blog
 Tue, December 12 / Julia Parker
 ******** EEuumm aadd ddoolloorr eett.. AAuutteemm aauutt ffuuggiiaatt ddeebbiittiiss vvoolluuppttaatteemm ccoonnsseeqquuuunnttuurr ssiitt ********
 Illum voluptas ab enim placeat. Adipisci enim velit nulla. Vel omnis
 laudantium. Asperiores eum ipsa est officiis. Modi cupiditate exercitationem
 qui magni est...
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_about.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_features.html`

 * *Files 20% similar despite different names*

```diff
@@ -1,138 +1,128 @@
 00000000: 7b25 206c 6f61 6420 7374 6174 6963 2025  {% load static %
-00000010: 7d0d 0a0d 0a3c 7374 796c 653e 0d0a 2e61  }....<style>...a
-00000020: 626f 7574 202e 6162 6f75 742d 696d 673a  bout .about-img:
-00000030: 6265 666f 7265 207b 0d0a 2020 706f 7369  before {..  posi
-00000040: 7469 6f6e 3a20 6162 736f 6c75 7465 3b0d  tion: absolute;.
-00000050: 0a20 2069 6e73 6574 3a20 2d36 3070 7820  .  inset: -60px 
-00000060: 3020 3020 2d36 3070 783b 0d0a 2020 7a2d  0 0 -60px;..  z-
-00000070: 696e 6465 783a 202d 313b 0d0a 2020 636f  index: -1;..  co
-00000080: 6e74 656e 743a 2022 223b 0d0a 2020 6261  ntent: "";..  ba
-00000090: 636b 6772 6f75 6e64 3a20 7572 6c28 227b  ckground: url("{
-000000a0: 2520 7374 6174 6963 2027 696d 672f 6865  % static 'img/he
-000000b0: 726f 6269 7a64 732f 6162 6f75 742d 6267  robizds/about-bg
-000000c0: 2e70 6e67 2720 257d 2229 2074 6f70 206c  .png' %}") top l
-000000d0: 6566 743b 0d0a 2020 6261 636b 6772 6f75  eft;..  backgrou
-000000e0: 6e64 2d72 6570 6561 743a 206e 6f2d 7265  nd-repeat: no-re
-000000f0: 7065 6174 3b0d 0a7d 0d0a 3c2f 7374 796c  peat;..}..</styl
-00000100: 653e 0d0a 0d0a 3c73 6563 7469 6f6e 2069  e>....<section i
-00000110: 643d 2261 626f 7574 2220 636c 6173 733d  d="about" class=
-00000120: 2261 626f 7574 223e 0d0a 2020 3c64 6976  "about">..  <div
-00000130: 2063 6c61 7373 3d22 636f 6e74 6169 6e65   class="containe
-00000140: 7222 2064 6174 612d 616f 733d 2266 6164  r" data-aos="fad
-00000150: 652d 7570 223e 0d0a 0d0a 2020 2020 3c64  e-up">....    <d
-00000160: 6976 2063 6c61 7373 3d22 7365 6374 696f  iv class="sectio
-00000170: 6e2d 6865 6164 6572 223e 0d0a 2020 2020  n-header">..    
-00000180: 2020 3c68 323e 4162 6f75 7420 5573 3c2f    <h2>About Us</
-00000190: 6832 3e0d 0a20 2020 2020 203c 703e 7b7b  h2>..      <p>{{
-000001a0: 2061 626f 7574 2e74 6974 6c65 207d 7d3c   about.title }}<
-000001b0: 2f70 3e0d 0a20 2020 203c 2f64 6976 3e0d  /p>..    </div>.
-000001c0: 0a0d 0a20 2020 203c 6469 7620 636c 6173  ...    <div clas
-000001d0: 733d 2272 6f77 2067 2d34 2067 2d6c 672d  s="row g-4 g-lg-
-000001e0: 3522 2064 6174 612d 616f 733d 2266 6164  5" data-aos="fad
-000001f0: 652d 7570 2220 6461 7461 2d61 6f73 2d64  e-up" data-aos-d
-00000200: 656c 6179 3d22 3230 3022 3e0d 0a0d 0a20  elay="200">.... 
-00000210: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
-00000220: 2263 6f6c 2d6c 672d 3522 3e0d 0a20 2020  "col-lg-5">..   
-00000230: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
-00000240: 2261 626f 7574 2d69 6d67 223e 0d0a 2020  "about-img">..  
-00000250: 2020 2020 2020 2020 3c69 6d67 2073 7263          <img src
-00000260: 3d22 7b25 2073 7461 7469 6320 2769 6d67  ="{% static 'img
-00000270: 2f68 6572 6f62 697a 6473 2f61 626f 7574  /herobizds/about
-00000280: 2f27 7c61 6464 3a61 626f 7574 2e69 6d61  /'|add:about.ima
-00000290: 6765 5f66 696c 656e 616d 6520 257d 2220  ge_filename %}" 
-000002a0: 636c 6173 733d 2269 6d67 2d66 6c75 6964  class="img-fluid
-000002b0: 2220 616c 743d 2222 3e0d 0a20 2020 2020  " alt="">..     
-000002c0: 2020 203c 2f64 6976 3e0d 0a20 2020 2020     </div>..     
-000002d0: 203c 2f64 6976 3e0d 0a0d 0a20 2020 2020   </div>....     
-000002e0: 203c 6469 7620 636c 6173 733d 2263 6f6c   <div class="col
-000002f0: 2d6c 672d 3722 3e0d 0a20 2020 2020 2020  -lg-7">..       
-00000300: 207b 2520 6175 746f 6573 6361 7065 206f   {% autoescape o
-00000310: 6666 2025 7d0d 0a20 2020 2020 2020 203c  ff %}..        <
-00000320: 6834 2063 6c61 7373 3d22 7074 2d30 2070  h4 class="pt-0 p
-00000330: 742d 6c67 2d35 223e 7b7b 2061 626f 7574  t-lg-5">{{ about
-00000340: 2e73 7562 7469 746c 6520 7d7d 3c2f 6834  .subtitle }}</h4
-00000350: 3e0d 0a0d 0a20 2020 2020 2020 203c 212d  >....        <!-
-00000360: 2d20 5461 6273 202d 2d3e 0d0a 2020 2020  - Tabs -->..    
-00000370: 2020 2020 3c75 6c20 636c 6173 733d 226e      <ul class="n
-00000380: 6176 206e 6176 2d70 696c 6c73 206d 622d  av nav-pills mb-
-00000390: 3322 3e0d 0a20 2020 2020 2020 2020 207b  3">..          {
-000003a0: 2520 666f 7220 6974 656d 2069 6e20 6162  % for item in ab
-000003b0: 6f75 742e 7461 6220 257d 0d0a 2020 2020  out.tab %}..    
-000003c0: 2020 2020 2020 3c6c 693e 3c61 2063 6c61        <li><a cla
-000003d0: 7373 3d22 6e61 762d 6c69 6e6b 0d0a 2020  ss="nav-link..  
-000003e0: 2020 2020 2020 2020 7b25 2069 6620 666f          {% if fo
-000003f0: 726c 6f6f 702e 6669 7273 7420 257d 2061  rloop.first %} a
-00000400: 6374 6976 657b 2520 656e 6469 6620 257d  ctive{% endif %}
-00000410: 0d0a 2020 2020 2020 2020 2020 2220 6461  ..          " da
-00000420: 7461 2d62 732d 746f 6767 6c65 3d22 7069  ta-bs-toggle="pi
-00000430: 6c6c 2220 6872 6566 3d22 2374 6162 7b25  ll" href="#tab{%
-00000440: 2063 7963 6c65 2027 3127 2027 3227 2027   cycle '1' '2' '
-00000450: 3327 2027 3427 2027 3527 2025 7d22 3e7b  3' '4' '5' %}">{
-00000460: 7b20 6974 656d 2e74 6974 6c65 207d 7d3c  { item.title }}<
-00000470: 2f61 3e3c 2f6c 693e 0d0a 2020 2020 2020  /a></li>..      
-00000480: 2020 2020 7b25 2065 6e64 666f 7220 257d      {% endfor %}
-00000490: 0d0a 2020 2020 2020 2020 3c2f 756c 3e3c  ..        </ul><
-000004a0: 212d 2d20 456e 6420 5461 6273 202d 2d3e  !-- End Tabs -->
-000004b0: 0d0a 0d0a 2020 2020 2020 2020 3c21 2d2d  ....        <!--
-000004c0: 2054 6162 2043 6f6e 7465 6e74 202d 2d3e   Tab Content -->
-000004d0: 0d0a 2020 2020 2020 2020 3c64 6976 2063  ..        <div c
-000004e0: 6c61 7373 3d22 7461 622d 636f 6e74 656e  lass="tab-conten
-000004f0: 7422 3e0d 0a20 2020 2020 2020 2020 207b  t">..          {
-00000500: 2520 666f 7220 6974 656d 2069 6e20 6162  % for item in ab
-00000510: 6f75 742e 7461 6220 257d 0d0a 2020 2020  out.tab %}..    
-00000520: 2020 2020 2020 7b25 2069 6620 666f 726c        {% if forl
-00000530: 6f6f 702e 6669 7273 7420 257d 0d0a 2020  oop.first %}..  
-00000540: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
-00000550: 7373 3d22 7461 622d 7061 6e65 2066 6164  ss="tab-pane fad
-00000560: 6520 7368 6f77 2061 6374 6976 6522 2069  e show active" i
-00000570: 643d 2274 6162 3122 3e0d 0a20 2020 2020  d="tab1">..     
-00000580: 2020 2020 207b 2520 656c 7365 2025 7d0d       {% else %}.
-00000590: 0a20 2020 2020 2020 2020 203c 6469 7620  .          <div 
-000005a0: 636c 6173 733d 2274 6162 2d70 616e 6520  class="tab-pane 
-000005b0: 6661 6465 2073 686f 7722 2069 643d 2274  fade show" id="t
-000005c0: 6162 7b25 2063 7963 6c65 2027 3227 2027  ab{% cycle '2' '
-000005d0: 3327 2027 3427 2027 3527 2025 7d22 3e0d  3' '4' '5' %}">.
-000005e0: 0a20 2020 2020 2020 2020 207b 2520 656e  .          {% en
-000005f0: 6469 6620 257d 0d0a 2020 2020 2020 2020  dif %}..        
-00000600: 2020 2020 7b25 2069 6620 6974 656d 2e73      {% if item.s
-00000610: 7562 7469 746c 6520 257d 0d0a 2020 2020  ubtitle %}..    
-00000620: 2020 2020 2020 2020 3c70 2063 6c61 7373          <p class
-00000630: 3d22 6673 742d 6974 616c 6963 223e 7b7b  ="fst-italic">{{
-00000640: 2069 7465 6d2e 7375 6274 6974 6c65 207d   item.subtitle }
-00000650: 7d3c 2f70 3e0d 0a20 2020 2020 2020 2020  }</p>..         
-00000660: 2020 207b 2520 656e 6469 6620 257d 0d0a     {% endif %}..
-00000670: 2020 2020 2020 2020 2020 2020 7b25 2066              {% f
-00000680: 6f72 2063 686b 5f69 7465 6d20 696e 2069  or chk_item in i
-00000690: 7465 6d2e 6368 6563 6b20 257d 0d0a 2020  tem.check %}..  
-000006a0: 2020 2020 2020 2020 2020 2020 7b25 2069              {% i
-000006b0: 6620 6368 6b5f 6974 656d 2e68 3420 257d  f chk_item.h4 %}
-000006c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000006d0: 3c64 6976 2063 6c61 7373 3d22 642d 666c  <div class="d-fl
-000006e0: 6578 2061 6c69 676e 2d69 7465 6d73 2d63  ex align-items-c
-000006f0: 656e 7465 7220 6d74 2d34 223e 0d0a 2020  enter mt-4">..  
-00000700: 2020 2020 2020 2020 2020 2020 2020 3c69                <i
-00000710: 2063 6c61 7373 3d22 6269 2062 692d 6368   class="bi bi-ch
-00000720: 6563 6b32 223e 3c2f 693e 0d0a 2020 2020  eck2"></i>..    
-00000730: 2020 2020 2020 2020 2020 2020 3c68 343e              <h4>
-00000740: 7b7b 2063 686b 5f69 7465 6d2e 6834 207d  {{ chk_item.h4 }
-00000750: 7d3c 2f68 343e 0d0a 2020 2020 2020 2020  }</h4>..        
-00000760: 2020 2020 2020 3c2f 6469 763e 0d0a 2020        </div>..  
-00000770: 2020 2020 2020 2020 2020 2020 7b25 2065              {% e
-00000780: 6e64 6966 2025 7d0d 0a20 2020 2020 2020  ndif %}..       
-00000790: 2020 2020 2020 207b 2520 6966 2063 686b         {% if chk
-000007a0: 5f69 7465 6d2e 7020 257d 0d0a 2020 2020  _item.p %}..    
-000007b0: 2020 2020 2020 2020 2020 3c70 3e7b 7b20            <p>{{ 
-000007c0: 6368 6b5f 6974 656d 2e70 207d 7d3c 2f70  chk_item.p }}</p
-000007d0: 3e0d 0a20 2020 2020 2020 2020 2020 2020  >..             
-000007e0: 207b 2520 656e 6469 6620 257d 0d0a 2020   {% endif %}..  
-000007f0: 2020 2020 2020 2020 2020 7b25 2065 6e64            {% end
-00000800: 666f 7220 257d 0d0a 2020 2020 2020 2020  for %}..        
-00000810: 2020 3c2f 6469 763e 0d0a 2020 2020 2020    </div>..      
-00000820: 2020 2020 7b25 2065 6e64 666f 7220 257d      {% endfor %}
-00000830: 0d0a 2020 2020 2020 2020 3c2f 6469 763e  ..        </div>
-00000840: 0d0a 2020 2020 2020 2020 7b25 2065 6e64  ..        {% end
-00000850: 6175 746f 6573 6361 7065 2025 7d0d 0a20  autoescape %}.. 
-00000860: 2020 2020 203c 2f64 6976 3e0d 0a0d 0a20       </div>.... 
-00000870: 2020 203c 2f64 6976 3e0d 0a0d 0a20 203c     </div>....  <
-00000880: 2f64 6976 3e0d 0a3c 2f73 6563 7469 6f6e  /div>..</section
-00000890: 3e0d 0a                                  >..
+00000010: 7d0a 0a3c 7365 6374 696f 6e20 6964 3d22  }..<section id="
+00000020: 6665 6174 7572 6573 2220 636c 6173 733d  features" class=
+00000030: 2266 6561 7475 7265 7322 3e0a 2020 3c64  "features">.  <d
+00000040: 6976 2063 6c61 7373 3d22 636f 6e74 6169  iv class="contai
+00000050: 6e65 7222 2064 6174 612d 616f 733d 2266  ner" data-aos="f
+00000060: 6164 652d 7570 223e 0a0a 2020 2020 3c75  ade-up">..    <u
+00000070: 6c20 636c 6173 733d 226e 6176 206e 6176  l class="nav nav
+00000080: 2d74 6162 7320 726f 7720 6779 2d34 2064  -tabs row gy-4 d
+00000090: 2d66 6c65 7822 3e0a 2020 2020 2020 7b25  -flex">.      {%
+000000a0: 2066 6f72 2069 7465 6d20 696e 2066 6561   for item in fea
+000000b0: 7475 7265 7320 257d 0a20 2020 2020 203c  tures %}.      <
+000000c0: 6c69 2063 6c61 7373 3d22 6e61 762d 6974  li class="nav-it
+000000d0: 656d 2063 6f6c 2d36 2063 6f6c 2d6d 642d  em col-6 col-md-
+000000e0: 3420 636f 6c2d 6c67 2d32 223e 0a20 2020  4 col-lg-2">.   
+000000f0: 2020 2020 207b 2520 6966 2066 6f72 6c6f       {% if forlo
+00000100: 6f70 2e66 6972 7374 2025 7d0a 2020 2020  op.first %}.    
+00000110: 2020 2020 3c61 2063 6c61 7373 3d22 6e61      <a class="na
+00000120: 762d 6c69 6e6b 2061 6374 6976 6520 7368  v-link active sh
+00000130: 6f77 2220 6461 7461 2d62 732d 746f 6767  ow" data-bs-togg
+00000140: 6c65 3d22 7461 6222 2064 6174 612d 6273  le="tab" data-bs
+00000150: 2d74 6172 6765 743d 2223 7461 622d 3122  -target="#tab-1"
+00000160: 3e0a 2020 2020 2020 2020 7b25 2065 6c73  >.        {% els
+00000170: 6520 257d 0a20 2020 2020 2020 203c 6120  e %}.        <a 
+00000180: 636c 6173 733d 226e 6176 2d6c 696e 6b22  class="nav-link"
+00000190: 2064 6174 612d 6273 2d74 6f67 676c 653d   data-bs-toggle=
+000001a0: 2274 6162 2220 6461 7461 2d62 732d 7461  "tab" data-bs-ta
+000001b0: 7267 6574 3d22 2374 6162 2d7b 2520 6379  rget="#tab-{% cy
+000001c0: 636c 6520 2732 2720 2733 2720 2734 2720  cle '2' '3' '4' 
+000001d0: 2735 2720 2736 2720 257d 223e 0a20 2020  '5' '6' %}">.   
+000001e0: 2020 2020 207b 2520 656e 6469 6620 257d       {% endif %}
+000001f0: 0a20 2020 2020 2020 2020 203c 6920 636c  .          <i cl
+00000200: 6173 733d 2262 6920 7b7b 2069 7465 6d2e  ass="bi {{ item.
+00000210: 6963 6f6e 207d 7d20 636f 6c6f 722d 7b25  icon }} color-{%
+00000220: 2063 7963 6c65 2027 6379 616e 2720 2769   cycle 'cyan' 'i
+00000230: 6e64 6967 6f27 2027 7465 616c 2720 2772  ndigo' 'teal' 'r
+00000240: 6564 2720 2762 6c75 6527 2027 6f72 616e  ed' 'blue' 'oran
+00000250: 6765 2720 257d 223e 3c2f 693e 0a20 2020  ge' %}"></i>.   
+00000260: 2020 2020 2020 203c 6834 3e7b 7b20 6974         <h4>{{ it
+00000270: 656d 2e74 6974 6c65 207d 7d3c 2f68 343e  em.title }}</h4>
+00000280: 0a20 2020 2020 2020 203c 2f61 3e0a 2020  .        </a>.  
+00000290: 2020 2020 3c2f 6c69 3e0a 2020 2020 2020      </li>.      
+000002a0: 7b25 2065 6e64 666f 7220 257d 0a0a 2020  {% endfor %}..  
+000002b0: 2020 3c2f 756c 3e0a 0a20 2020 203c 6469    </ul>..    <di
+000002c0: 7620 636c 6173 733d 2274 6162 2d63 6f6e  v class="tab-con
+000002d0: 7465 6e74 223e 0a20 2020 2020 207b 2520  tent">.      {% 
+000002e0: 666f 7220 6974 656d 2069 6e20 6665 6174  for item in feat
+000002f0: 7572 6573 2025 7d0a 2020 2020 2020 7b25  ures %}.      {%
+00000300: 2069 6620 666f 726c 6f6f 702e 6669 7273   if forloop.firs
+00000310: 7420 257d 0a20 2020 2020 203c 6469 7620  t %}.      <div 
+00000320: 636c 6173 733d 2274 6162 2d70 616e 6520  class="tab-pane 
+00000330: 6163 7469 7665 2073 686f 7722 2069 643d  active show" id=
+00000340: 2274 6162 2d31 223e 0a20 2020 2020 207b  "tab-1">.      {
+00000350: 2520 656c 7365 2025 7d0a 2020 2020 2020  % else %}.      
+00000360: 3c64 6976 2063 6c61 7373 3d22 7461 622d  <div class="tab-
+00000370: 7061 6e65 2220 6964 3d22 7461 622d 7b25  pane" id="tab-{%
+00000380: 2063 7963 6c65 2027 3227 2027 3327 2027   cycle '2' '3' '
+00000390: 3427 2027 3527 2027 3627 2025 7d22 3e0a  4' '5' '6' %}">.
+000003a0: 2020 2020 2020 7b25 2065 6e64 6966 2025        {% endif %
+000003b0: 7d0a 2020 2020 2020 2020 3c64 6976 2063  }.        <div c
+000003c0: 6c61 7373 3d22 726f 7720 6779 2d34 223e  lass="row gy-4">
+000003d0: 0a20 2020 2020 2020 2020 207b 2520 6966  .          {% if
+000003e0: 2066 6f72 6c6f 6f70 2e66 6972 7374 2025   forloop.first %
+000003f0: 7d0a 2020 2020 2020 2020 2020 3c64 6976  }.          <div
+00000400: 2063 6c61 7373 3d22 636f 6c2d 6c67 2d38   class="col-lg-8
+00000410: 206f 7264 6572 2d32 206f 7264 6572 2d6c   order-2 order-l
+00000420: 672d 3122 2064 6174 612d 616f 733d 2266  g-1" data-aos="f
+00000430: 6164 652d 7570 2220 6461 7461 2d61 6f73  ade-up" data-aos
+00000440: 2d64 656c 6179 3d22 3130 3022 3e0a 2020  -delay="100">.  
+00000450: 2020 2020 2020 2020 7b25 2065 6c73 6520          {% else 
+00000460: 257d 0a20 2020 2020 2020 2020 203c 6469  %}.          <di
+00000470: 7620 636c 6173 733d 2263 6f6c 2d6c 672d  v class="col-lg-
+00000480: 3820 6f72 6465 722d 3220 6f72 6465 722d  8 order-2 order-
+00000490: 6c67 2d31 223e 0a20 2020 2020 2020 2020  lg-1">.         
+000004a0: 207b 2520 656e 6469 6620 257d 0a20 2020   {% endif %}.   
+000004b0: 2020 2020 2020 2020 203c 6833 3e7b 7b20           <h3>{{ 
+000004c0: 6974 656d 2e74 6974 6c65 207d 7d3c 2f68  item.title }}</h
+000004d0: 333e 0a20 2020 2020 2020 2020 2020 203c  3>.            <
+000004e0: 7020 636c 6173 733d 2266 7374 2d69 7461  p class="fst-ita
+000004f0: 6c69 6322 3e0a 2020 2020 2020 2020 2020  lic">.          
+00000500: 2020 2020 7b7b 2069 7465 6d2e 705f 7570      {{ item.p_up
+00000510: 7065 7220 7d7d 0a20 2020 2020 2020 2020  per }}.         
+00000520: 2020 203c 2f70 3e0a 2020 2020 2020 2020     </p>.        
+00000530: 2020 2020 3c75 6c3e 0a20 2020 2020 2020      <ul>.       
+00000540: 2020 2020 2020 207b 2520 666f 7220 6c69         {% for li
+00000550: 2069 6e20 6974 656d 2e6c 6920 257d 0a20   in item.li %}. 
+00000560: 2020 2020 2020 2020 2020 2020 203c 6c69               <li
+00000570: 3e3c 6920 636c 6173 733d 2262 6920 6269  ><i class="bi bi
+00000580: 2d63 6865 636b 2d63 6972 636c 652d 6669  -check-circle-fi
+00000590: 6c6c 223e 3c2f 693e 207b 7b20 6c69 207d  ll"></i> {{ li }
+000005a0: 7d3c 2f6c 693e 0a20 2020 2020 2020 2020  }</li>.         
+000005b0: 2020 2020 207b 2520 656e 6466 6f72 2025       {% endfor %
+000005c0: 7d0a 2020 2020 2020 2020 2020 2020 3c2f  }.            </
+000005d0: 756c 3e0a 2020 2020 2020 2020 2020 2020  ul>.            
+000005e0: 3c70 2063 6c61 7373 3d22 6673 742d 6974  <p class="fst-it
+000005f0: 616c 6963 223e 0a20 2020 2020 2020 2020  alic">.         
+00000600: 2020 2020 207b 7b20 6974 656d 2e70 5f6c       {{ item.p_l
+00000610: 6f77 6572 207d 7d0a 2020 2020 2020 2020  ower }}.        
+00000620: 2020 2020 3c2f 703e 0a20 2020 2020 2020      </p>.       
+00000630: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+00000640: 2020 2020 7b25 2069 6620 666f 726c 6f6f      {% if forloo
+00000650: 702e 6669 7273 7420 257d 0a20 2020 2020  p.first %}.     
+00000660: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
+00000670: 2263 6f6c 2d6c 672d 3420 6f72 6465 722d  "col-lg-4 order-
+00000680: 3120 6f72 6465 722d 6c67 2d32 2074 6578  1 order-lg-2 tex
+00000690: 742d 6365 6e74 6572 2220 6461 7461 2d61  t-center" data-a
+000006a0: 6f73 3d22 6661 6465 2d75 7022 2064 6174  os="fade-up" dat
+000006b0: 612d 616f 732d 6465 6c61 793d 2232 3030  a-aos-delay="200
+000006c0: 223e 0a20 2020 2020 2020 2020 207b 2520  ">.          {% 
+000006d0: 656c 7365 2025 7d0a 2020 2020 2020 2020  else %}.        
+000006e0: 2020 3c64 6976 2063 6c61 7373 3d22 636f    <div class="co
+000006f0: 6c2d 6c67 2d34 206f 7264 6572 2d31 206f  l-lg-4 order-1 o
+00000700: 7264 6572 2d6c 672d 3220 7465 7874 2d63  rder-lg-2 text-c
+00000710: 656e 7465 7222 3e0a 2020 2020 2020 2020  enter">.        
+00000720: 2020 7b25 2065 6e64 6966 2025 7d0a 2020    {% endif %}.  
+00000730: 2020 2020 2020 2020 2020 3c69 6d67 2073            <img s
+00000740: 7263 3d22 7b25 2073 7461 7469 6320 2769  rc="{% static 'i
+00000750: 6d67 2f68 6572 6f62 697a 6473 2f66 6561  mg/herobizds/fea
+00000760: 7475 7265 732f 277c 6164 643a 6974 656d  tures/'|add:item
+00000770: 2e69 6d61 6765 2025 7d22 2061 6c74 3d22  .image %}" alt="
+00000780: 2220 636c 6173 733d 2269 6d67 2d66 6c75  " class="img-flu
+00000790: 6964 223e 0a20 2020 2020 2020 2020 203c  id">.          <
+000007a0: 2f64 6976 3e0a 2020 2020 2020 2020 3c2f  /div>.        </
+000007b0: 6469 763e 0a20 2020 2020 203c 2f64 6976  div>.      </div
+000007c0: 3e0a 2020 2020 2020 7b25 2065 6e64 666f  >.      {% endfo
+000007d0: 7220 257d 0a20 2020 203c 2f64 6976 3e0a  r %}.    </div>.
+000007e0: 2020 3c2f 6469 763e 0a3c 2f73 6563 7469    </div>.</secti
+000007f0: 6f6e 3e                                  on>
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_cta.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_cta.html`

 * *Files 15% similar despite different names*

```diff
@@ -1,36 +1,34 @@
-{% load static %}
-{% block cta %}
-<section id="cta" class="cta">
-  <div class="container" data-aos="zoom-out">
-
-    <div class="row g-5">
-
-      <div class="col-lg-8 col-md-6 content d-flex flex-column justify-content-center order-last order-md-first">
-        {% autoescape off %}
-        <h3>{{ cta.title }}</h3>
-        <p>{{ cta.desc }}</p>
-        <div class="row row-cols-auto">
-          {% for btn in cta.btns %}
-          <div class="col">
-            {% if btn.type == 'onclick' %}
-            <a class="cta-btn align-self-start" onclick="cta{{ forloop.counter }}_gtag_report_conversion('{{ btn.link }}')">{{ btn.title }}</a>
-            {% elif btn.type == 'href' %}
-            <a class="cta-btn align-self-start" href="{{ btn.link }}" target="_blank">{{ btn.title }}</a>
-            {% endif %}
-          </div>
-          {% endfor %}
-        </div>
-        {% endautoescape %}
-      </div>
-
-      <div class="col-lg-4 col-md-6 order-first order-md-last d-flex align-items-center">
-        <div class="img">
-          <img src="{% static 'img/herobizds/cta/'|add:cta.image_filename %}" alt="" class="img-fluid">
-        </div>
-      </div>
-
-    </div>
-
-  </div>
-</section>
-{% endblock %}
+{% load static %}
+
+<section id="cta" class="cta">
+  <div class="container" data-aos="zoom-out">
+
+    <div class="row g-5">
+      {% autoescape off %}
+      <div class="col-lg-8 col-md-6 content d-flex flex-column justify-content-center order-last order-md-first">
+        <h3>{{ cta.h3 }}</h3>
+        <p> {{ cta.p }}</p>
+        <div class="row row-cols-auto">
+        {% for btn in cta.btns %}
+          <div class="col">
+            {% if btn.type == 'onclick' %}
+            <a class="cta-btn align-self-start" onclick="cta{{ forloop.counter }}_gtag_report_conversion('{{ btn.link }}')">{{ btn.title }}</a>
+            {% elif btn.type == 'href' %}
+            <a class="cta-btn align-self-start" href="{{ btn.link }}" target="_blank">{{ btn.title }}</a>
+            {% endif %}
+          </div>
+        {% endfor %}
+        </div>
+        {% endautoescape %}
+      </div>
+
+      <div class="col-lg-4 col-md-6 order-first order-md-last d-flex align-items-center">
+        <div class="img">
+          <img src="{% static 'img/herobizds/'|add:cta.image_filename %}" alt="" class="img-fluid">
+        </div>
+      </div>
+
+    </div>
+
+  </div>
+</section>
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_features.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_about.html`

 * *Files 22% similar despite different names*

```diff
@@ -1,117 +1,130 @@
 00000000: 7b25 206c 6f61 6420 7374 6174 6963 2025  {% load static %
-00000010: 7d0d 0a0d 0a3c 7365 6374 696f 6e20 6964  }....<section id
-00000020: 3d22 6665 6174 7572 6573 2220 636c 6173  ="features" clas
-00000030: 733d 2266 6561 7475 7265 7322 3e0d 0a20  s="features">.. 
-00000040: 203c 6469 7620 636c 6173 733d 2263 6f6e   <div class="con
-00000050: 7461 696e 6572 2220 6461 7461 2d61 6f73  tainer" data-aos
-00000060: 3d22 6661 6465 2d75 7022 3e0d 0a0d 0a20  ="fade-up">.... 
-00000070: 2020 203c 756c 2063 6c61 7373 3d22 6e61     <ul class="na
-00000080: 7620 6e61 762d 7461 6273 2072 6f77 2067  v nav-tabs row g
-00000090: 792d 3420 642d 666c 6578 223e 0d0a 2020  y-4 d-flex">..  
-000000a0: 2020 2020 7b25 2066 6f72 2069 7465 6d20      {% for item 
-000000b0: 696e 2064 6570 6172 746d 656e 7473 2e69  in departments.i
-000000c0: 7465 6d73 2025 7d0d 0a20 2020 2020 203c  tems %}..      <
-000000d0: 6c69 2063 6c61 7373 3d22 6e61 762d 6974  li class="nav-it
-000000e0: 656d 2063 6f6c 2d36 2063 6f6c 2d6d 642d  em col-6 col-md-
-000000f0: 3420 636f 6c2d 6c67 2d32 223e 0d0a 2020  4 col-lg-2">..  
-00000100: 2020 2020 2020 7b25 2069 6620 666f 726c        {% if forl
-00000110: 6f6f 702e 6669 7273 7420 257d 0d0a 2020  oop.first %}..  
-00000120: 2020 2020 2020 3c61 2063 6c61 7373 3d22        <a class="
-00000130: 6e61 762d 6c69 6e6b 2061 6374 6976 6520  nav-link active 
-00000140: 7368 6f77 2220 6461 7461 2d62 732d 746f  show" data-bs-to
-00000150: 6767 6c65 3d22 7461 6222 2064 6174 612d  ggle="tab" data-
-00000160: 6273 2d74 6172 6765 743d 2223 7461 622d  bs-target="#tab-
-00000170: 3122 3e0d 0a20 2020 2020 2020 207b 2520  1">..        {% 
-00000180: 656c 7365 2025 7d0d 0a20 2020 2020 2020  else %}..       
-00000190: 203c 6120 636c 6173 733d 226e 6176 2d6c   <a class="nav-l
-000001a0: 696e 6b22 2064 6174 612d 6273 2d74 6f67  ink" data-bs-tog
-000001b0: 676c 653d 2274 6162 2220 6461 7461 2d62  gle="tab" data-b
-000001c0: 732d 7461 7267 6574 3d22 2374 6162 2d7b  s-target="#tab-{
-000001d0: 2520 6379 636c 6520 2732 2720 2733 2720  % cycle '2' '3' 
-000001e0: 2734 2720 2735 2720 2736 2720 257d 223e  '4' '5' '6' %}">
-000001f0: 0d0a 2020 2020 2020 2020 7b25 2065 6e64  ..        {% end
-00000200: 6966 2025 7d0d 0a20 2020 2020 2020 2020  if %}..         
-00000210: 203c 6920 636c 6173 733d 2262 6920 7b7b   <i class="bi {{
-00000220: 2069 7465 6d2e 6963 6f6e 207d 7d20 636f   item.icon }} co
-00000230: 6c6f 722d 7b25 2063 7963 6c65 2027 6379  lor-{% cycle 'cy
-00000240: 616e 2720 2769 6e64 6967 6f27 2027 7465  an' 'indigo' 'te
-00000250: 616c 2720 2772 6564 2720 2762 6c75 6527  al' 'red' 'blue'
-00000260: 2027 6f72 616e 6765 2720 257d 223e 3c2f   'orange' %}"></
-00000270: 693e 0d0a 2020 2020 2020 2020 2020 3c68  i>..          <h
-00000280: 343e 7b7b 2069 7465 6d2e 7469 746c 6520  4>{{ item.title 
-00000290: 7d7d 3c2f 6834 3e0d 0a20 2020 2020 2020  }}</h4>..       
-000002a0: 203c 2f61 3e0d 0a20 2020 2020 203c 2f6c   </a>..      </l
-000002b0: 693e 0d0a 2020 2020 2020 7b25 2065 6e64  i>..      {% end
-000002c0: 666f 7220 257d 0d0a 2020 2020 3c2f 756c  for %}..    </ul
-000002d0: 3e0d 0a0d 0a20 2020 203c 6469 7620 636c  >....    <div cl
-000002e0: 6173 733d 2274 6162 2d63 6f6e 7465 6e74  ass="tab-content
-000002f0: 223e 0d0a 2020 2020 2020 7b25 2066 6f72  ">..      {% for
-00000300: 2069 7465 6d20 696e 2064 6570 6172 746d   item in departm
-00000310: 656e 7473 2e69 7465 6d73 2025 7d0d 0a20  ents.items %}.. 
-00000320: 2020 2020 207b 2520 6966 2066 6f72 6c6f       {% if forlo
-00000330: 6f70 2e66 6972 7374 2025 7d0d 0a20 2020  op.first %}..   
-00000340: 2020 203c 6469 7620 636c 6173 733d 2274     <div class="t
-00000350: 6162 2d70 616e 6520 6163 7469 7665 2073  ab-pane active s
-00000360: 686f 7722 2069 643d 2274 6162 2d31 223e  how" id="tab-1">
-00000370: 0d0a 2020 2020 2020 7b25 2065 6c73 6520  ..      {% else 
-00000380: 257d 0d0a 2020 2020 2020 3c64 6976 2063  %}..      <div c
-00000390: 6c61 7373 3d22 7461 622d 7061 6e65 2220  lass="tab-pane" 
-000003a0: 6964 3d22 7461 622d 7b25 2063 7963 6c65  id="tab-{% cycle
-000003b0: 2027 3227 2027 3327 2027 3427 2027 3527   '2' '3' '4' '5'
-000003c0: 2027 3627 2025 7d22 3e0d 0a20 2020 2020   '6' %}">..     
-000003d0: 207b 2520 656e 6469 6620 257d 0d0a 2020   {% endif %}..  
-000003e0: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
-000003f0: 3d22 726f 7720 6779 2d34 223e 0d0a 2020  ="row gy-4">..  
-00000400: 2020 2020 2020 2020 7b25 2069 6620 666f          {% if fo
-00000410: 726c 6f6f 702e 6669 7273 7420 257d 0d0a  rloop.first %}..
-00000420: 2020 2020 2020 2020 2020 3c64 6976 2063            <div c
-00000430: 6c61 7373 3d22 636f 6c2d 6c67 2d38 206f  lass="col-lg-8 o
-00000440: 7264 6572 2d32 206f 7264 6572 2d6c 672d  rder-2 order-lg-
-00000450: 3122 2064 6174 612d 616f 733d 2266 6164  1" data-aos="fad
-00000460: 652d 7570 2220 6461 7461 2d61 6f73 2d64  e-up" data-aos-d
-00000470: 656c 6179 3d22 3130 3022 3e0d 0a20 2020  elay="100">..   
-00000480: 2020 2020 2020 207b 2520 656c 7365 2025         {% else %
-00000490: 7d0d 0a20 2020 2020 2020 2020 203c 6469  }..          <di
-000004a0: 7620 636c 6173 733d 2263 6f6c 2d6c 672d  v class="col-lg-
-000004b0: 3820 6f72 6465 722d 3220 6f72 6465 722d  8 order-2 order-
-000004c0: 6c67 2d31 223e 0d0a 2020 2020 2020 2020  lg-1">..        
-000004d0: 2020 7b25 2065 6e64 6966 2025 7d0d 0a20    {% endif %}.. 
-000004e0: 2020 2020 2020 2020 2020 203c 6833 3e7b             <h3>{
-000004f0: 7b20 6974 656d 2e73 7562 7469 746c 6520  { item.subtitle 
-00000500: 7d7d 3c2f 6833 3e0d 0a20 2020 2020 2020  }}</h3>..       
-00000510: 2020 2020 207b 2520 666f 7220 7020 696e       {% for p in
-00000520: 2069 7465 6d2e 6465 7363 2025 7d0d 0a20   item.desc %}.. 
-00000530: 2020 2020 2020 2020 2020 203c 703e 7b7b             <p>{{
-00000540: 2070 207d 7d3c 2f70 3e0d 0a20 2020 2020   p }}</p>..     
-00000550: 2020 2020 2020 207b 2520 656e 6466 6f72         {% endfor
-00000560: 2025 7d0d 0a20 2020 2020 2020 2020 203c   %}..          <
-00000570: 2f64 6976 3e0d 0a20 2020 2020 2020 2020  /div>..         
-00000580: 207b 2520 6966 2066 6f72 6c6f 6f70 2e66   {% if forloop.f
-00000590: 6972 7374 2025 7d0d 0a20 2020 2020 2020  irst %}..       
-000005a0: 2020 203c 6469 7620 636c 6173 733d 2263     <div class="c
-000005b0: 6f6c 2d6c 672d 3420 6f72 6465 722d 3120  ol-lg-4 order-1 
-000005c0: 6f72 6465 722d 6c67 2d32 2074 6578 742d  order-lg-2 text-
-000005d0: 6365 6e74 6572 2220 6461 7461 2d61 6f73  center" data-aos
-000005e0: 3d22 6661 6465 2d75 7022 2064 6174 612d  ="fade-up" data-
-000005f0: 616f 732d 6465 6c61 793d 2232 3030 223e  aos-delay="200">
-00000600: 0d0a 2020 2020 2020 2020 2020 7b25 2065  ..          {% e
-00000610: 6c73 6520 257d 0d0a 2020 2020 2020 2020  lse %}..        
-00000620: 2020 3c64 6976 2063 6c61 7373 3d22 636f    <div class="co
-00000630: 6c2d 6c67 2d34 206f 7264 6572 2d31 206f  l-lg-4 order-1 o
-00000640: 7264 6572 2d6c 672d 3220 7465 7874 2d63  rder-lg-2 text-c
-00000650: 656e 7465 7222 3e0d 0a20 2020 2020 2020  enter">..       
-00000660: 2020 207b 2520 656e 6469 6620 257d 0d0a     {% endif %}..
-00000670: 2020 2020 2020 2020 2020 2020 3c69 6d67              <img
-00000680: 2073 7263 3d22 7b25 2073 7461 7469 6320   src="{% static 
-00000690: 2769 6d67 2f68 6572 6f62 697a 6473 2f64  'img/herobizds/d
-000006a0: 6570 6172 746d 656e 7473 2f27 7c61 6464  epartments/'|add
-000006b0: 3a69 7465 6d2e 7068 6f74 6f7c 6164 643a  :item.photo|add:
-000006c0: 272e 6a70 6727 2025 7d22 2061 6c74 3d22  '.jpg' %}" alt="
-000006d0: 2220 636c 6173 733d 2269 6d67 2d66 6c75  " class="img-flu
-000006e0: 6964 223e 0d0a 2020 2020 2020 2020 2020  id">..          
-000006f0: 3c2f 6469 763e 0d0a 2020 2020 2020 2020  </div>..        
-00000700: 3c2f 6469 763e 0d0a 2020 2020 2020 3c2f  </div>..      </
-00000710: 6469 763e 0d0a 2020 2020 2020 7b25 2065  div>..      {% e
-00000720: 6e64 666f 7220 257d 0d0a 0d0a 2020 2020  ndfor %}....    
-00000730: 3c2f 6469 763e 0d0a 0d0a 2020 3c2f 6469  </div>....  </di
-00000740: 763e 0d0a 3c2f 7365 6374 696f 6e3e       v>..</section>
+00000010: 7d0a 0a3c 7374 796c 653e 0a20 202e 6162  }..<style>.  .ab
+00000020: 6f75 7420 2e61 626f 7574 2d69 6d67 3a62  out .about-img:b
+00000030: 6566 6f72 6520 7b0a 2020 706f 7369 7469  efore {.  positi
+00000040: 6f6e 3a20 6162 736f 6c75 7465 3b0a 2020  on: absolute;.  
+00000050: 696e 7365 743a 202d 3630 7078 2030 2030  inset: -60px 0 0
+00000060: 202d 3630 7078 3b0a 2020 7a2d 696e 6465   -60px;.  z-inde
+00000070: 783a 202d 313b 0a20 2063 6f6e 7465 6e74  x: -1;.  content
+00000080: 3a20 2222 3b0a 2020 6261 636b 6772 6f75  : "";.  backgrou
+00000090: 6e64 3a20 7572 6c28 227b 2520 7374 6174  nd: url("{% stat
+000000a0: 6963 2027 6865 726f 6269 7a64 732f 696d  ic 'herobizds/im
+000000b0: 672f 6162 6f75 742d 6267 2e70 6e67 2720  g/about-bg.png' 
+000000c0: 257d 2229 2074 6f70 206c 6566 743b 0a20  %}") top left;. 
+000000d0: 2062 6163 6b67 726f 756e 642d 7265 7065   background-repe
+000000e0: 6174 3a20 6e6f 2d72 6570 6561 743b 0a7d  at: no-repeat;.}
+000000f0: 0a3c 2f73 7479 6c65 3e0a 0a3c 7365 6374  .</style>..<sect
+00000100: 696f 6e20 6964 3d22 6162 6f75 7422 2063  ion id="about" c
+00000110: 6c61 7373 3d22 6162 6f75 7422 3e0a 2020  lass="about">.  
+00000120: 3c64 6976 2063 6c61 7373 3d22 636f 6e74  <div class="cont
+00000130: 6169 6e65 7222 2064 6174 612d 616f 733d  ainer" data-aos=
+00000140: 2266 6164 652d 7570 223e 0a0a 2020 2020  "fade-up">..    
+00000150: 3c64 6976 2063 6c61 7373 3d22 7365 6374  <div class="sect
+00000160: 696f 6e2d 6865 6164 6572 223e 0a20 2020  ion-header">.   
+00000170: 2020 203c 6832 3e41 626f 7574 2055 733c     <h2>About Us<
+00000180: 2f68 323e 0a20 2020 2020 203c 703e 7b7b  /h2>.      <p>{{
+00000190: 2061 626f 7574 5f70 207d 7d3c 2f70 3e0a   about_p }}</p>.
+000001a0: 2020 2020 3c2f 6469 763e 0a0a 2020 2020      </div>..    
+000001b0: 3c64 6976 2063 6c61 7373 3d22 726f 7720  <div class="row 
+000001c0: 672d 3420 672d 6c67 2d35 2220 6461 7461  g-4 g-lg-5" data
+000001d0: 2d61 6f73 3d22 6661 6465 2d75 7022 2064  -aos="fade-up" d
+000001e0: 6174 612d 616f 732d 6465 6c61 793d 2232  ata-aos-delay="2
+000001f0: 3030 223e 0a0a 2020 2020 2020 3c64 6976  00">..      <div
+00000200: 2063 6c61 7373 3d22 636f 6c2d 6c67 2d35   class="col-lg-5
+00000210: 223e 0a20 2020 2020 2020 203c 6469 7620  ">.        <div 
+00000220: 636c 6173 733d 2261 626f 7574 2d69 6d67  class="about-img
+00000230: 223e 0a20 2020 2020 2020 2020 203c 696d  ">.          <im
+00000240: 6720 7372 633d 227b 2520 7374 6174 6963  g src="{% static
+00000250: 2027 696d 672f 6865 726f 6269 7a64 732f   'img/herobizds/
+00000260: 6162 6f75 742e 6a70 6727 2025 7d22 2063  about.jpg' %}" c
+00000270: 6c61 7373 3d22 696d 672d 666c 7569 6422  lass="img-fluid"
+00000280: 2061 6c74 3d22 223e 0a20 2020 2020 2020   alt="">.       
+00000290: 203c 2f64 6976 3e0a 2020 2020 2020 3c2f   </div>.      </
+000002a0: 6469 763e 0a0a 2020 2020 2020 3c64 6976  div>..      <div
+000002b0: 2063 6c61 7373 3d22 636f 6c2d 6c67 2d37   class="col-lg-7
+000002c0: 223e 0a20 2020 2020 2020 207b 2520 6175  ">.        {% au
+000002d0: 746f 6573 6361 7065 206f 6666 2025 7d0a  toescape off %}.
+000002e0: 2020 2020 2020 2020 3c68 3320 636c 6173          <h3 clas
+000002f0: 733d 2270 742d 3020 7074 2d6c 672d 3522  s="pt-0 pt-lg-5"
+00000300: 3e7b 7b20 6162 6f75 745f 6833 207d 7d3c  >{{ about_h3 }}<
+00000310: 2f68 333e 0a0a 2020 2020 2020 2020 3c21  /h3>..        <!
+00000320: 2d2d 2054 6162 7320 2d2d 3e0a 2020 2020  -- Tabs -->.    
+00000330: 2020 2020 3c75 6c20 636c 6173 733d 226e      <ul class="n
+00000340: 6176 206e 6176 2d70 696c 6c73 206d 622d  av nav-pills mb-
+00000350: 3322 3e0a 2020 2020 2020 2020 2020 7b25  3">.          {%
+00000360: 2066 6f72 2069 7465 6d20 696e 2061 626f   for item in abo
+00000370: 7574 2025 7d0a 2020 2020 2020 2020 2020  ut %}.          
+00000380: 3c6c 693e 3c61 2063 6c61 7373 3d22 6e61  <li><a class="na
+00000390: 762d 6c69 6e6b 0a20 2020 2020 2020 2020  v-link.         
+000003a0: 207b 2520 6966 2066 6f72 6c6f 6f70 2e66   {% if forloop.f
+000003b0: 6972 7374 2025 7d20 6163 7469 7665 7b25  irst %} active{%
+000003c0: 2065 6e64 6966 2025 7d0a 2020 2020 2020   endif %}.      
+000003d0: 2020 2020 2220 6461 7461 2d62 732d 746f      " data-bs-to
+000003e0: 6767 6c65 3d22 7069 6c6c 2220 6872 6566  ggle="pill" href
+000003f0: 3d22 2374 6162 7b25 2063 7963 6c65 2027  ="#tab{% cycle '
+00000400: 3127 2027 3227 2027 3327 2027 3427 2027  1' '2' '3' '4' '
+00000410: 3527 2025 7d22 3e7b 7b20 6974 656d 2e74  5' %}">{{ item.t
+00000420: 6974 6c65 207d 7d3c 2f61 3e3c 2f6c 693e  itle }}</a></li>
+00000430: 0a20 2020 2020 2020 2020 207b 2520 656e  .          {% en
+00000440: 6466 6f72 2025 7d0a 2020 2020 2020 2020  dfor %}.        
+00000450: 3c2f 756c 3e3c 212d 2d20 456e 6420 5461  </ul><!-- End Ta
+00000460: 6273 202d 2d3e 0a0a 2020 2020 2020 2020  bs -->..        
+00000470: 3c21 2d2d 2054 6162 2043 6f6e 7465 6e74  <!-- Tab Content
+00000480: 202d 2d3e 0a20 2020 2020 2020 203c 6469   -->.        <di
+00000490: 7620 636c 6173 733d 2274 6162 2d63 6f6e  v class="tab-con
+000004a0: 7465 6e74 223e 0a20 2020 2020 2020 2020  tent">.         
+000004b0: 207b 2520 666f 7220 6974 656d 2069 6e20   {% for item in 
+000004c0: 6162 6f75 7420 257d 0a20 2020 2020 2020  about %}.       
+000004d0: 2020 207b 2520 6966 2066 6f72 6c6f 6f70     {% if forloop
+000004e0: 2e66 6972 7374 2025 7d0a 2020 2020 2020  .first %}.      
+000004f0: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00000500: 7461 622d 7061 6e65 2066 6164 6520 7368  tab-pane fade sh
+00000510: 6f77 2061 6374 6976 6522 2069 643d 2274  ow active" id="t
+00000520: 6162 3122 3e0a 2020 2020 2020 2020 2020  ab1">.          
+00000530: 7b25 2065 6c73 6520 257d 0a20 2020 2020  {% else %}.     
+00000540: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
+00000550: 2274 6162 2d70 616e 6520 6661 6465 2073  "tab-pane fade s
+00000560: 686f 7722 2069 643d 2274 6162 7b25 2063  how" id="tab{% c
+00000570: 7963 6c65 2027 3227 2027 3327 2027 3427  ycle '2' '3' '4'
+00000580: 2027 3527 2025 7d22 3e0a 2020 2020 2020   '5' %}">.      
+00000590: 2020 2020 7b25 2065 6e64 6966 2025 7d0a      {% endif %}.
+000005a0: 2020 2020 2020 2020 2020 2020 7b25 2069              {% i
+000005b0: 6620 6974 656d 2e70 5f69 7461 6c69 6320  f item.p_italic 
+000005c0: 257d 0a20 2020 2020 2020 2020 2020 203c  %}.            <
+000005d0: 7020 636c 6173 733d 2266 7374 2d69 7461  p class="fst-ita
+000005e0: 6c69 6322 3e7b 7b20 6974 656d 2e70 5f69  lic">{{ item.p_i
+000005f0: 7461 6c69 6320 7d7d 3c2f 703e 0a20 2020  talic }}</p>.   
+00000600: 2020 2020 2020 2020 207b 2520 656e 6469           {% endi
+00000610: 6620 257d 0a20 2020 2020 2020 2020 2020  f %}.           
+00000620: 207b 2520 666f 7220 6368 6b5f 6974 656d   {% for chk_item
+00000630: 2069 6e20 6974 656d 2e63 6865 636b 2025   in item.check %
+00000640: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00000650: 7b25 2069 6620 6368 6b5f 6974 656d 2e68  {% if chk_item.h
+00000660: 3420 257d 0a20 2020 2020 2020 2020 2020  4 %}.           
+00000670: 2020 203c 6469 7620 636c 6173 733d 2264     <div class="d
+00000680: 2d66 6c65 7820 616c 6967 6e2d 6974 656d  -flex align-item
+00000690: 732d 6365 6e74 6572 206d 742d 3422 3e0a  s-center mt-4">.
+000006a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000006b0: 3c69 2063 6c61 7373 3d22 6269 2062 692d  <i class="bi bi-
+000006c0: 6368 6563 6b32 223e 3c2f 693e 0a20 2020  check2"></i>.   
+000006d0: 2020 2020 2020 2020 2020 2020 203c 6834               <h4
+000006e0: 3e7b 7b20 6368 6b5f 6974 656d 2e68 3420  >{{ chk_item.h4 
+000006f0: 7d7d 3c2f 6834 3e0a 2020 2020 2020 2020  }}</h4>.        
+00000700: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00000710: 2020 2020 2020 2020 2020 207b 2520 656e             {% en
+00000720: 6469 6620 257d 0a20 2020 2020 2020 2020  dif %}.         
+00000730: 2020 2020 207b 2520 6966 2063 686b 5f69       {% if chk_i
+00000740: 7465 6d2e 7020 257d 0a20 2020 2020 2020  tem.p %}.       
+00000750: 2020 2020 2020 203c 703e 7b7b 2063 686b         <p>{{ chk
+00000760: 5f69 7465 6d2e 7020 7d7d 3c2f 703e 0a20  _item.p }}</p>. 
+00000770: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00000780: 656e 6469 6620 257d 0a20 2020 2020 2020  endif %}.       
+00000790: 2020 2020 207b 2520 656e 6466 6f72 2025       {% endfor %
+000007a0: 7d0a 2020 2020 2020 2020 2020 3c2f 6469  }.          </di
+000007b0: 763e 0a20 2020 2020 2020 2020 207b 2520  v>.          {% 
+000007c0: 656e 6466 6f72 2025 7d0a 2020 2020 2020  endfor %}.      
+000007d0: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
+000007e0: 207b 2520 656e 6461 7574 6f65 7363 6170   {% endautoescap
+000007f0: 6520 257d 0a20 2020 2020 203c 2f64 6976  e %}.      </div
+00000800: 3e0a 2020 2020 3c2f 6469 763e 0a20 203c  >.    </div>.  <
+00000810: 2f64 6976 3e0a 3c2f 7365 6374 696f 6e3e  /div>.</section>
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_hero1.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_hero_animated.html`

 * *Files 16% similar despite different names*

```diff
@@ -1,27 +1,25 @@
-{% load static %}
-
-<style>
-  .hero-animated {
-  width: 100%;
-  min-height: 50vh;
-  background: url("{% static 'img/herobizds/hero-bg.png' %}") center center;
-  background-size: cover;
-  position: relative;
-  padding: 120px 0 60px;
-
-}
-</style>
-
-<section id="hero-animated" class="hero-animated d-flex align-items-center">
-  <div class="container d-flex flex-column justify-content-center align-items-center text-center position-relative" data-aos="zoom-out">
-    <img src="{% static 'img/herobizds/hero/'|add:hero.0.bg|add:'.svg' %}" class="img-fluid animated">
-    {% autoescape off %}
-    <h2>{{ hero.0.title }}</h2>
-    <p>{{ hero.0.slogan }}</p>
-    {% endautoescape %}
-    <div class="d-flex">
-      <a href="{{ hero.0.btn.link }}" class="btn-get-started scrollto">{{ hero.0.btn.title }}</a>
-      <a href="{{ hero.0.video_link }}" class="glightbox btn-watch-video d-flex align-items-center"><i class="bi bi-play-circle"></i><span>Watch Video</span></a>
-    </div>
-  </div>
+{% load static %}
+<style>
+  .hero-animated {
+  width: 100%;
+  min-height: 50vh;
+  background: url("{% static 'herobizds/img/hero-bg.png' %}") center center;
+  background-size: cover;
+  position: relative;
+  padding: 120px 0 60px;
+}
+
+</style>
+<section id="hero-animated" class="hero-animated d-flex align-items-center">
+  <div class="container d-flex flex-column justify-content-center align-items-center text-center position-relative" data-aos="zoom-out">
+    <img src="{% static 'img/herobizds/hero-carousel/hero-carousel-3.svg' %}" class="img-fluid animated">
+    {% autoescape off %}
+    <h2>{{ hero.title }}</h2>
+    <p>{{ hero.slogan }}</p>
+    {% endautoescape %}
+    <div class="d-flex">
+      <a href="{{ hero.btn.link }}" class="btn-get-started scrollto">{{ hero.btn.title }}</a>
+      <a href="{{ hero.video_link }}" class="glightbox btn-watch-video d-flex align-items-center"><i class="bi bi-play-circle"></i><span>Watch Video</span></a>
+    </div>
+  </div>
 </section>
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
 {% load static %}
-[{% static 'img/herobizds/hero/'|add:hero.0.bg|add:'.svg' %}]{% autoescape off
-%}
-********** {{{{ hheerroo..00..ttiittllee }}}} **********
-{{ hero.0.slogan }}
+[{% static 'img/herobizds/hero-carousel/hero-carousel-3.svg' %}]{% autoescape
+off %}
+********** {{{{ hheerroo..ttiittllee }}}} **********
+{{ hero.slogan }}
 {% endautoescape %}
-_{_{_ _h_e_r_o_._0_._b_t_n_._t_i_t_l_e_ _}_}
+_{_{_ _h_e_r_o_._b_t_n_._t_i_t_l_e_ _}_}
 _W_a_t_c_h_ _V_i_d_e_o
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_hero2.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_hero_carousel.html`

 * *Files 18% similar despite different names*

```diff
@@ -1,57 +1,60 @@
-{% load static %}
-
-<style>
-  .hero {
-  width: 100%;
-  min-height: 60vh;
-  padding: 0;
-  background: var(--color-black);
-  background: url("{% static 'img/herobizds/hero-bg.png' %}") center center;
-  background-size: cover;
-  background-position: center;
-  background-repeat: no-repeat;
-  position: relative;
-  display: flex;
-  flex-direction: column;
-  justify-content: center;
-  padding: 140px 0 60px 0;
-}
-</style>
-
-<section id="hero" class="hero carousel  carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
-{% for item in hero %}
-  {% if forloop.first %}
-  <div class="carousel-item active">
-  {% else %}
-  <div class="carousel-item">
-  {% endif %}
-    <div class="container">
-      <div class="row justify-content-center gy-6">
-        <div class="col-lg-5 col-md-8">
-          <img src="{% static 'img/herobizds/hero/'|add:item.bg|add:'.svg' %}" alt="" class="img-fluid img">
-        </div>
-
-        <div class="col-lg-9 text-center">
-          {% autoescape off %}
-          <h2>{{ item.title }}</h2>
-          <p>{{ item.slogan }}</p>
-          {% endautoescape %}
-          <a href="{{ item.btn.link }}" class="btn-get-started scrollto ">{{ item.btn.title }}</a>
-        </div>
-      </div>
-    </div>
-  </div><!-- End Carousel Item -->
-{% endfor %}
-
-
-  <a class="carousel-control-prev" href="#hero" role="button" data-bs-slide="prev">
-    <span class="carousel-control-prev-icon bi bi-chevron-left" aria-hidden="true"></span>
-  </a>
-
-  <a class="carousel-control-next" href="#hero" role="button" data-bs-slide="next">
-    <span class="carousel-control-next-icon bi bi-chevron-right" aria-hidden="true"></span>
-  </a>
-
-  <ol class="carousel-indicators"></ol>
-
-</section>
+{% load static %}
+
+<style>
+  .hero {
+  width: 100%;
+  padding: 0;
+  background: #000000;
+  background: url("{% static 'herobizds/img/hero-bg.png' %}") center center;
+  background-size: cover;
+  background-position: center;
+  background-repeat: no-repeat;
+  position: relative;
+  display: flex;
+  flex-direction: column;
+  justify-content: center;
+  padding: 140px 0 60px 0;
+}
+
+</style>
+<section id="hero" class="hero carousel  carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
+
+    <div class="carousel-inner">
+      {% for item in carousel %}
+      {% if forloop.first %}
+      <div class="carousel-item active">
+      {% else %}
+      <div class="carousel-item">
+      {% endif %}
+
+        <div class="container">
+          <div class="row justify-content-center gy-6">
+            <div class="col-lg-5 col-md-8">
+              <img src="{% static 'img/herobizds/hero-carousel/'|add:item.image' %}" alt="" class="img-fluid img">
+            </div>
+
+            <div class="col-lg-9 text-center">
+              {% autoescape off %}
+              <h2>{{ item.title }}</h2>
+              <p>{{ item.slogan }}</p>
+              {% endautoescape %}
+              <a href="{{ item.btn.link }}" class="btn-get-started scrollto ">{{ item.btn.title }}</a>
+            </div>
+
+          </div>
+        </div>
+      </div><!-- End Carousel Item -->
+      {% endfor %}
+    </div>
+
+    <a class="carousel-control-prev" href="#hero" role="button" data-bs-slide="prev">
+      <span class="carousel-control-prev-icon bi bi-chevron-left" aria-hidden="true"></span>
+    </a>
+
+    <a class="carousel-control-next" href="#hero" role="button" data-bs-slide="next">
+      <span class="carousel-control-next-icon bi bi-chevron-right" aria-hidden="true"></span>
+    </a>
+
+    <ol class="carousel-indicators"></ol>
+
+  </section>
```

#### html2text {}

```diff
@@ -1,9 +1,9 @@
 {% load static %}
-{% for item in hero %} {% if forloop.first %}
+{% for item in carousel %} {% if forloop.first %}
 {% else %}
 {% endif %}
 {% autoescape off %}
 ********** {{{{ iitteemm..ttiittllee }}}} **********
 {{ item.slogan }}
 {% endautoescape %} _{_{_ _i_t_e_m_._b_t_n_._t_i_t_l_e_ _}_}
 {% endfor %}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_portfolio-details.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_portfolio-details.html`

 * *Files 14% similar despite different names*

```diff
@@ -1,20 +1,23 @@
 {% load static %}
-{% load compress %}
-{% load herobiz_tags %}
+{% load herobizds_tags %}
+{% load django_calendards_tags %}
+{% load django_modalds_tags %}
+{% load django_analyticsds_tags %}
 
 <!DOCTYPE html>
 <html lang="en">
 
 <head>
   <!-- ======= SEO ======= -->{% include 'herobizds/seo.html' %}<!-- End SEO -->
 
   <!-- Vendor CSS Files -->
-  <link href="{% static 'herobizds/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
-  <link href="{% static 'herobizds/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
+  <link rel="stylesheet"
+        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous">
+  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
   <link href="{% static 'herobizds/vendor/aos/aos.css' %}" rel="stylesheet">
   <link href="{% static 'herobizds/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
   <link href="{% static 'herobizds/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">
 
   <!-- Variables CSS Files. Uncomment your preferred color scheme -->
   <link href="{% static 'herobizds/css/variables'|add:color|add:'.css' %}" rel="stylesheet">
   <!-- <link href="{% static 'herobizds/css/variables-blue.css' %}" rel="stylesheet"> -->
@@ -22,123 +25,102 @@
   <!-- <link href="{% static 'herobizds/css/variables-orange.css' %}" rel="stylesheet"> -->
   <!-- <link href="{% static 'herobizds/css/variables-purple.css' %}" rel="stylesheet"> -->
   <!-- <link href="{% static 'herobizds/css/variables-red.css' %}" rel="stylesheet"> -->
   <!-- <link href="{% static 'herobizds/css/variables-pink.css' %}" rel="stylesheet"> -->
 
   <!-- Template Main CSS File -->
   <link href="{% static 'herobizds/css/main.css' %}" rel="stylesheet">
+
 </head>
 
 <body>
-
-  <header id="header" class="header fixed-top" data-scrollto-offset="0">
-    <div class="container-fluid d-flex align-items-center justify-content-between">
-
-      <!-- 로고 -->
-      <a href="{% url 'herobizds:home' %}" class="logo d-flex align-items-center scrollto me-auto me-lg-0">
-      {% if use_logo %}
-        <img src="{% static 'img/herobizds/logo.png' %}" alt="">
-      {% else %}
-        <h1>{{ basic_info.company_name }}<span>.</span></h1>
-      {% endif %}
-      </a>
-
-    </div>
-  </header>
-
+  <!-- ======= Header ======= -->{% include 'herobizds/header.html' %}<!-- End Header -->
   <main id="main">
-    <!-- ======= Breadcrumbs ======= -->
-    <div class="breadcrumbs">
-      <div class="container">
-
-        <div class="d-flex justify-content-between align-items-center">
-          <h2>{{ portfolio.title }}</h2>
-          <ol>
-            <li><a href="{% url 'herobizds:home' %}">Home</a></li>
-            <li>{{ obj.title }}</li>
-          </ol>
-        </div>
-
-      </div>
-    </div><!-- End Breadcrumbs -->
+    <!-- ======= Breadcrumbs ======= -->{% include 'herobizds/breadcrumb.html' %}<!-- End Breadcrumbs -->
 
     <!-- ======= Portfolio Details Section ======= -->
     <section id="portfolio-details" class="portfolio-details">
       <div class="container" data-aos="fade-up">
 
         <div class="row gy-4">
 
           <div class="col-lg-8">
             <div class="portfolio-details-slider swiper">
               <div class="swiper-wrapper align-items-center">
+
                 <div class="swiper-slide">
                   <img src="{{ obj.image1.url }}" alt="">
                 </div>
+
                 {% if obj.image2 %}
                 <div class="swiper-slide">
                   <img src="{{ obj.image2.url }}" alt="">
                 </div>
                 {% endif %}
+
                 {% if obj.image3 %}
                 <div class="swiper-slide">
                   <img src="{{ obj.image3.url }}" alt="">
                 </div>
                 {% endif %}
+
                 {% if obj.image4 %}
                 <div class="swiper-slide">
                   <img src="{{ obj.image4.url }}" alt="">
                 </div>
                 {% endif %}
+
                 {% if obj.image5 %}
                 <div class="swiper-slide">
                   <img src="{{ obj.image5.url }}" alt="">
                 </div>
                 {% endif %}
+
               </div>
               <div class="swiper-pagination"></div>
             </div>
           </div>
 
           <div class="col-lg-4">
             <div class="portfolio-info">
               <h3>{{ obj.title }}</h3>
               <ul>
                 <li><strong>Category</strong>: {{ obj.filter }}</li>
-                {# <li><strong>Doctor</strong>: {{ doctor }}</li> #}
+                {% if obj.client %}
+                <li><strong>Client</strong>: {{ obj.client }}</li>
+                {% endif %}
+                <li><strong>Project date</strong>: {{ obj.reg_time|date:"d M, Y" }}</li>
                 {% if obj.url %}
-                <li><strong>Link</strong>: <a href="{{ obj.url }}" target="_blank">{{ obj.url|truncatechars:30 }}</a></li>
+                <li><strong>Project URL</strong>: {{ obj.url|urlize }}</li>
                 {% endif %}
               </ul>
             </div>
             <div class="portfolio-description">
               <h2>{{ obj.subtitle }}</h2>
-              <p>{{ obj.description|linebreaks }}</p>
+              <p>{{ obj.description|linebreaksbr }}</p>
             </div>
           </div>
-
         </div>
-
       </div>
     </section><!-- End Portfolio Details Section -->
 
   </main><!-- End #main -->
 
   <!-- ======= Footer ======= -->{% include 'herobizds/footer.html' %}<!-- End Footer -->
 
   <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
 
   <div id="preloader"></div>
 
   <!-- Vendor JS Files -->
-  <script src="{% static 'herobizds/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
+          crossorigin="anonymous"></script>
   <script src="{% static 'herobizds/vendor/aos/aos.js' %}"></script>
   <script src="{% static 'herobizds/vendor/glightbox/js/glightbox.min.js' %}"></script>
   <script src="{% static 'herobizds/vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
   <script src="{% static 'herobizds/vendor/swiper/swiper-bundle.min.js' %}"></script>
-  <!--<script src="{% static 'herobizds/vendor/php-email-form/validate.js' %}"></script>-->
+  <!-- <script src="{% static 'herobizds/vendor/php-email-form/validate.js' %}"></script> -->
 
   <!-- Template Main JS File -->
   <script src="{% static 'herobizds/js/main.js' %}"></script>
-
 </body>
-
 </html>
```

#### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

#### html2text {}

```diff
@@ -1,23 +1,21 @@
-{% load static %} {% load compress %} {% load herobiz_tags %}
+{% load static %} {% load herobizds_tags %} {% load django_calendards_tags %}
+{% load django_modalds_tags %} {% load django_analyticsds_tags %}
 {% include 'herobizds/seo.html' %}
-_{_%_ _i_f_ _u_s_e___l_o_g_o_ _%_}_ _{_%_ _e_l_s_e_ _%_}
-_**_**_**_**_**_**_ _{{_{{_ _bb_aa_ss_ii_cc____ii_nn_ff_oo_.._cc_oo_mm_pp_aa_nn_yy____nn_aa_mm_ee_ _}}_}}_.._ _**_**_**_**_**_**
-_{_%_ _e_n_d_i_f_ _%_}
-********** {{{{ ppoorrttffoolliioo..ttiittllee }}}} **********
-   1. _H_o_m_e
-   2. {{ obj.title }}
+{% include 'herobizds/header.html' %} {% include 'herobizds/breadcrumb.html' %}
 {% if obj.image2 %}
 {% endif %} {% if obj.image3 %}
 {% endif %} {% if obj.image4 %}
 {% endif %} {% if obj.image5 %}
 {% endif %}
 ******** {{{{ oobbjj..ttiittllee }}}} ********
     * CCaatteeggoorryy: {{ obj.filter }}
-    * {#
-    * DDooccttoorr: {{ doctor }}
-    * #} {% if obj.url %}
-    * LLiinnkk: _{_{_ _o_b_j_._u_r_l_|_t_r_u_n_c_a_t_e_c_h_a_r_s_:_3_0_ _}_}
+    * {% if obj.client %}
+    * CClliieenntt: {{ obj.client }}
+    * {% endif %}
+    * PPrroojjeecctt ddaattee: {{ obj.reg_time|date:"d M, Y" }}
+    * {% if obj.url %}
+    * PPrroojjeecctt UURRLL: {{ obj.url|urlize }}
     * {% endif %}
 ********** {{{{ oobbjj..ssuubbttiittllee }}}} **********
-{{ obj.description|linebreaks }}
+{{ obj.description|linebreaksbr }}
 {% include 'herobizds/footer.html' %}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_portfolio.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_portfolio.html`

 * *Files 12% similar despite different names*

```diff
@@ -1,41 +1,39 @@
-{% load static %}
-
-<section id="portfolio" class="portfolio" data-aos="fade-up">
-
-  <div class="container">
-
-    <div class="section-header">
-      <h2>{{ portfolio.title }}</h2>
-      <p>{{ portfolio.subtitle }}</p>
-    </div>
-
-  </div>
-
-  <div class="container-fluid" data-aos="fade-up" data-aos-delay="200">
-
-    <div class="portfolio-isotope" data-portfolio-filter="*" data-portfolio-layout="masonry" data-portfolio-sort="original-order">
-
-      <ul class="portfolio-flters">
-        <li data-filter="*" class="filter-active">All</li>
-        {% for filter in categories.all %}
-          <li data-filter=".filter-{{ filter }}">{{ filter }}</li>
-        {% endfor %}
-      </ul><!-- End Portfolio Filters -->
-
-      <div class="row g-0 portfolio-container">
-        {% for item in items.all %}
-        <div class="col-xl-3 col-lg-4 col-md-6 portfolio-item filter-{{ item.filter }}">
-          <img src="{{ item.image1.url }}" class="img-fluid" alt="">
-          <div class="portfolio-info">
-            <h4>{{ item.title }}</h4>
-            <!--<a href="{{ item.image1.url }}" title="App 1" data-gallery="portfolio-gallery" class="glightbox preview-link"><i class="bi bi-zoom-in"></i></a>-->
-            <a href="{% url 'herobizds:details' item.id %}" title="More Details" class="details-link" target="_blank"><i class="bi bi-link-45deg"></i></a>
-          </div>
-        </div>
-        {% endfor %}
-      </div><!-- End Portfolio Container -->
-
-    </div>
-
-  </div>
+{% load static %}
+
+<section id="portfolio" class="portfolio" data-aos="fade-up">
+
+  <div class="container">
+
+    <div class="section-header">
+      <h2>{{ portfolio.title }}</h2>
+      <p>{{ portfolio.subtitle }}</p>
+    </div>
+
+  </div>
+
+  <div class="container-fluid" data-aos="fade-up" data-aos-delay="200">
+
+    <div class="portfolio-isotope" data-portfolio-filter="*" data-portfolio-layout="masonry" data-portfolio-sort="original-order">
+
+      <ul class="portfolio-flters">
+        <li data-filter="*" class="filter-active">All</li>
+        {% for filter in categories.all %}
+          <li data-filter=".filter-{{ filter }}">{{ filter }}</li>
+        {% endfor %}
+      </ul><!-- End Portfolio Filters -->
+
+      <div class="row g-0 portfolio-container">
+        {% for item in items.all %}
+        <div class="col-xl-3 col-lg-4 col-md-6 portfolio-item filter-{{ item.filter }}">
+          <img src="{{ item.image1.url }}" class="img-fluid" alt="">
+          <div class="portfolio-info">
+            <h4>{{ item.title }}</h4>
+            <a href="{{ item.image1.url }}" title="{{ item.title }}" data-gallery="portfolio-gallery" class="glightbox preview-link"><i class="bi bi-zoom-in"></i></a>
+            <a href="{% url 'herobizds:details' item.id %}" title="More Details" class="details-link" target="_blank"><i class="bi bi-link-45deg"></i></a>
+          </div>
+        </div>
+        {% endfor %}
+      </div><!-- End Portfolio Container -->
+    </div>
+  </div>
 </section>
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_testimonials.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_testimonials.html`

 * *Files 20% similar despite different names*

```diff
@@ -1,36 +1,41 @@
-{% load static %}
-<style>
-  .testimonials {
-  background: url("{% static 'img/herobizds/testimonials-bg.jpg' %}") no-repeat;
-}
-</style>
-<section id="testimonials" class="testimonials">
-  <div class="container" data-aos="fade-up">
-
-    <div class="testimonials-slider swiper">
-      <div class="swiper-wrapper">
-        {% for story in testimonials.stories %}
-        <div class="swiper-slide">
-          <div class="testimonial-item">
-            <img src="{% static 'img/herobizds/testimonials/'|add:story.photo|add:'.jpg' %}" class="testimonial-img" alt="">
-            <h3>{{ story.name }}</h3>
-            {% autoescape off %}
-            <h4>{{ story.job }}</h4>
-            {% endautoescape %}
-            <div class="stars">
-              <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
-            </div>
-            <p>
-              <i class="bi bi-quote quote-icon-left"></i>
-              {{ story.desc }}
-              <i class="bi bi-quote quote-icon-right"></i>
-            </p>
-          </div>
-        </div>
-        {% endfor %}
-      </div>
-      <div class="swiper-pagination"></div>
-    </div>
-
-  </div>
+{% load static %}
+<style>
+  .testimonials {
+  padding: 80px 0;
+  background: url("{% static 'img/herobizds/testimonials-bg.jpg' %}") no-repeat;
+  background-position: center center;
+  background-size: cover;
+  position: relative;
+}
+</style>
+
+<section id="testimonials" class="testimonials">
+  <div class="container" data-aos="fade-up">
+
+    <div class="testimonials-slider swiper">
+      <div class="swiper-wrapper">
+        {% for item in testimonials %}
+        <div class="swiper-slide">
+          <div class="testimonial-item">
+            <img src="{% static 'img/herobizds/testimonials/'|add:item.photo %}" class="testimonial-img" alt="">
+            <h3>{{ item.name }}</h3>
+            {% autoescape off %}
+            <h4>{{ item.job }}</h4>
+            {% endautoescape %}
+            <div class="stars">
+              <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
+            </div>
+            <p>
+              <i class="bi bi-quote quote-icon-left"></i>
+              {{ item.desc }}
+              <i class="bi bi-quote quote-icon-right"></i>
+            </p>
+          </div>
+        </div>
+        {% endfor %}
+      </div>
+      <div class="swiper-pagination"></div>
+    </div>
+
+  </div>
 </section>
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
 {% load static %}
-{% for story in testimonials.stories %}
-******** {{{{ ssttoorryy..nnaammee }}}} ********
+{% for item in testimonials %}
+******** {{{{ iitteemm..nnaammee }}}} ********
 {% autoescape off %}
-****** {{{{ ssttoorryy..jjoobb }}}} ******
+****** {{{{ iitteemm..jjoobb }}}} ******
 {% endautoescape %}
-{{ story.desc }}
+{{ item.desc }}
 {% endfor %}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/_why_us.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/_featured_services.html`

 * *Files 23% similar despite different names*

```diff
@@ -1,29 +1,21 @@
-{% load static %}
-
-<section id="featured-services" class="featured-services">
-  <div class="container">
-
-    <div class="row gy-4">
-      {% autoescape off %}
-      <div class="col-xl-3 col-md-6 d-flex" data-aos="zoom-out">
-        <div class="service-item position-relative">
-          <div class="icon"><i class="bi {{ whyus.major.icon }} icon"></i></div>
-          <h4><a href="" class="stretched-link">{{ whyus.major.title }}</a></h4>
-          <p>{{ whyus.major.contents.0 }}</p>
-        </div>
-      </div><!-- End Service Item -->
-
-      {% for item in whyus.minor %}
-      <div class="col-xl-3 col-md-6 d-flex" data-aos="zoom-out" data-aos-delay="{% cycle '200' '400' '600' '800' %}">
-        <div class="service-item position-relative">
-          <div class="icon"><i class="bi {{ item.icon }} icon"></i></div>
-          <h4><a href="" class="stretched-link">{{ item.title }}</a></h4>
-          <p>{{ item.contents }}</p>
-        </div>
-      </div><!-- End Service Item -->
-      {% endfor %}
-      {% endautoescape %}
-    </div>
-
-  </div>
+<section id="featured-services" class="featured-services">
+  <div class="container">
+    <div class="row gy-4">
+      {% autoescape off %}
+      {% for item in featured_services %}
+      {% if forloop.first %}
+      <div class="col-xl-3 col-md-6 d-flex" data-aos="zoom-out">
+      {% else %}
+      <div class="col-xl-3 col-md-6 d-flex" data-aos="zoom-out" data-aos-delay="{% cycle '200' '400' '600' '800' %}">
+      {% endif %}
+        <div class="service-item position-relative">
+          <div class="icon"><i class="bi {{ item.icon }} icon"></i></div>
+          <h4><a href="" class="stretched-link">{{ item.title }}</a></h4>
+          <p>{{ item.contents }}</p>
+        </div>
+      </div><!-- End Service Item -->
+      {% endfor %}
+      {% endautoescape %}
+    </div>
+  </div>
 </section>
```

#### html2text {}

```diff
@@ -1,8 +1,6 @@
-{% load static %}
-{% autoescape off %}
-****** {{{{ wwhhyyuuss..mmaajjoorr..ttiittllee }}}} ******
-{{ whyus.major.contents.0 }}
-{% for item in whyus.minor %}
+{% autoescape off %} {% for item in featured_services %} {% if forloop.first %}
+{% else %}
+{% endif %}
 ****** {{{{ iitteemm..ttiittllee }}}} ******
 {{ item.contents }}
 {% endfor %} {% endautoescape %}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/forms/contact.php` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/forms/contact.php`

 * *Files identical despite different names*

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/header.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/header.html`

 * *Files 24% similar despite different names*

```diff
@@ -1,39 +1,34 @@
-{% load static %}
-
-<header id="header" class="header fixed-top" data-scrollto-offset="0">
-  <div class="container-fluid d-flex align-items-center justify-content-between">
-
-    <!-- 로고 -->
-    <a href="{% url 'herobizds:home' %}" class="logo d-flex align-items-center scrollto me-auto me-lg-0">
-    {% if use_logo %}
-      <img src="{% static 'img/herobizds/logo.png' %}" alt="">
-    {% else %}
-      <h1>{{ basic_info.company_name }}<span>.</span></h1>
-    {% endif %}
-    </a>
-
-    <nav id="navbar" class="navbar">
-      <ul>
-        <li><a class="nav-link scrollto" href="#">Home</a></li>
-        <!-- 메뉴 -->
-        {% for component, etc, title, is_show in components %}
-          {% if is_show %}
-            {% if component == 'direct_link' %}
-              <li><a class="nav-link scrollto" href="{{ etc }}" target="_blank">{{ title }}</a></li>
-            {% else %}
-              <li><a class="nav-link scrollto" href="{% url 'herobizds:home' %}#{{ component }}">{{ title }}</a></li>
-            {% endif %}
-          {% endif %}
-        {% endfor %}
-      </ul>
-      <i class="bi bi-list mobile-nav-toggle d-none"></i>
-    </nav><!-- .navbar -->
-
-    {% for component, is_use, _, _ in components %}
-    {% if component == top_menu_btn.component and is_use %}
-      <a class="btn-getstarted scrollto" href="#{{ top_menu_btn.component }}">{{ top_menu_btn.title }}</a>
-    {% endif %}
-    {% endfor %}
-
-  </div>
-</header>
+{% load static %}
+
+<header id="header" class="header fixed-top" data-scrollto-offset="0">
+  <div class="container-fluid d-flex align-items-center justify-content-between">
+    <a href="{% url 'herobizds:home' %}" class="logo d-flex align-items-center scrollto me-auto me-lg-0">
+      {% if use_logo %}
+      <img src="{% static 'img/herobizds/logo.png' %}" alt="">
+      {% else %}
+      <h1>{{ logo_text }}<span>.</span></h1>
+      {% endif %}
+    </a>
+
+    <nav id="navbar" class="navbar">
+      <ul>
+        <!-- 메뉴 -->
+        {% for component, etc, title, is_show in components %}
+          {% if is_show %}
+            {% if component == 'direct_link' %}
+              <li><a class="nav-link scrollto" href="{{ etc }}">{{ title }}</a></li>
+            {% else %}
+              <li><a class="nav-link scrollto" href="{% url 'herobizds:home' %}#{{ component }}">{{ title }}</a></li>
+            {% endif %}
+          {% endif %}
+        {% endfor %}
+      </ul>
+      <i class="bi bi-list mobile-nav-toggle d-none"></i>
+    </nav><!-- .navbar -->
+    {% for component, is_use, _, _ in components %}
+    {% if component == menu_btn.component and is_use %}
+    <a class="btn-getstarted scrollto" href="#{{ menu_btn.component }}">{{ menu_btn.title }}</a>
+    {% endif %}
+    {% endfor %}
+  </div>
+</header>
```

#### html2text {}

```diff
@@ -1,14 +1,12 @@
 {% load static %}
 _{_%_ _i_f_ _u_s_e___l_o_g_o_ _%_}_ _{_%_ _e_l_s_e_ _%_}
-_**_**_**_**_**_**_ _{{_{{_ _bb_aa_ss_ii_cc____ii_nn_ff_oo_.._cc_oo_mm_pp_aa_nn_yy____nn_aa_mm_ee_ _}}_}}_.._ _**_**_**_**_**_**
+_**_**_**_**_**_**_ _{{_{{_ _ll_oo_gg_oo____tt_ee_xx_tt_ _}}_}}_.._ _**_**_**_**_**_**
 _{_%_ _e_n_d_i_f_ _%_}
-    * _H_o_m_e
     * {% for component, etc, title, is_show in components %} {% if is_show %}
       {% if component == 'direct_link' %}
     * _{_{_ _t_i_t_l_e_ _}_}
     * {% else %}
     * _{_{_ _t_i_t_l_e_ _}_}
     * {% endif %} {% endif %} {% endfor %}
 {% for component, is_use, _, _ in components %} {% if component ==
-top_menu_btn.component and is_use %} _{_{_ _t_o_p___m_e_n_u___b_t_n_._t_i_t_l_e_ _}_} {% endif %} {%
-endfor %}
+menu_btn.component and is_use %} _{_{_ _m_e_n_u___b_t_n_._t_i_t_l_e_ _}_} {% endif %} {% endfor %}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/templates/herobizds/index.html` & `django_herobiz_ds-2.0.3/django_herobiz_ds/templates/herobizds/index.html`

 * *Files 3% similar despite different names*

```diff
@@ -25,57 +25,59 @@
   <!-- <link href="{% static 'herobizds/css/variables-orange.css' %}" rel="stylesheet"> -->
   <!-- <link href="{% static 'herobizds/css/variables-purple.css' %}" rel="stylesheet"> -->
   <!-- <link href="{% static 'herobizds/css/variables-red.css' %}" rel="stylesheet"> -->
   <!-- <link href="{% static 'herobizds/css/variables-pink.css' %}" rel="stylesheet"> -->
 
   <!-- Template Main CSS File -->
   <link href="{% static 'herobizds/css/main.css' %}" rel="stylesheet">
+
 </head>
 
 <body>
-
   <!-- ======= Header ======= -->{% include 'herobizds/header.html' %}<!-- End Header -->
-
   <!-- ======= Hero Section ======= -->{% hero %}<!-- End Hero -->
 
   <main id="main">
     {% show_calendar %}
     {% show_modal %}
     {% make_analytics %}
 
     {% for component, is_use, _, _ in components %}
       {% if is_use %}
-        {% if component == 'why-us' %}
-          <!-- ======= Featured Services Section ======= -->{% why_us %}<!-- End Featured Services Section -->
+        {% if component == 'featured_services' %}
+          <!-- ======= Featured Services Section ======= -->{% featured_services %}<!-- End Featured Services Section -->
         {% elif component == 'about' %}
           <!-- ======= About Section ======= -->{% about %}<!-- End About Section -->
         {% elif component == 'clients' %}
           <!-- ======= Clients Section ======= -->{% clients %}<!-- End Clients Section -->
         {% elif component == 'cta' %}
           <!-- ======= Call To Action Section ======= -->{% cta %}<!-- End Call To Action Section -->
         {% elif component == 'onfocus' %}
-          <!-- ======= On Focus Section ======= -->{% include 'herobizds/_onfocus.html' %}<!-- End On Focus Section -->
+          <!-- ======= On Focus Section ======= -->{% onfocus %}<!-- End On Focus Section -->
         {% elif component == 'features' %}
           <!-- ======= Features Section ======= -->{% features %}<!-- End Features Section -->
         {% elif component == 'services' %}
           <!-- ======= Services Section ======= -->{% services %}<!-- End Services Section -->
         {% elif component == 'testimonials' %}
           <!-- ======= Testimonials Section ======= -->{% testimonials %}<!-- End Testimonials Section -->
+        {% elif component == 'pricing' %}
+          <!-- ======= Pricing Section ======= -->{% pricing %}<!-- End Pricing Section -->
         {% elif component == 'faq' %}
           <!-- ======= F.A.Q Section ======= -->{% faq %}<!-- End F.A.Q Section -->
         {% elif component == 'portfolio' %}
           <!-- ======= Portfolio Section ======= -->{% portfolio %}<!-- End Portfolio Section -->
         {% elif component == 'team' %}
           <!-- ======= Team Section ======= -->{% team %}<!-- End Team Section -->
+        {% elif component == 'blog' %}
+          <!-- ======= Recent Blog Posts Section ======= -->{% blog %}<!-- End Recent Blog Posts Section -->
         {% elif component == 'contact' %}
           <!-- ======= Contact Section ======= -->{% contact %}<!-- End Contact Section -->
         {% endif %}
       {% endif %}
     {% endfor %}
-
   </main><!-- End #main -->
 
   <!-- ======= Footer ======= -->{% include 'herobizds/footer.html' %}<!-- End Footer -->
 
   <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
 
   <div id="preloader"></div>
@@ -83,14 +85,13 @@
   <!-- Vendor JS Files -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
           crossorigin="anonymous"></script>
   <script src="{% static 'herobizds/vendor/aos/aos.js' %}"></script>
   <script src="{% static 'herobizds/vendor/glightbox/js/glightbox.min.js' %}"></script>
   <script src="{% static 'herobizds/vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
   <script src="{% static 'herobizds/vendor/swiper/swiper-bundle.min.js' %}"></script>
-  <!--<script src="{% static 'herobizds/vendor/php-email-form/validate.js' %}"></script>-->
+  <!-- <script src="{% static 'herobizds/vendor/php-email-form/validate.js' %}"></script> -->
 
   <!-- Template Main JS File -->
   <script src="{% static 'herobizds/js/main.js' %}"></script>
 </body>
-
 </html>
```

#### html2text {}

```diff
@@ -1,14 +1,16 @@
 {% load static %} {% load herobizds_tags %} {% load django_calendards_tags %}
 {% load django_modalds_tags %} {% load django_analyticsds_tags %}
 {% include 'herobizds/seo.html' %}
 {% include 'herobizds/header.html' %} {% hero %} {% show_calendar %} {%
 show_modal %} {% make_analytics %} {% for component, is_use, _, _ in components
-%} {% if is_use %} {% if component == 'why-us' %} {% why_us %} {% elif
-component == 'about' %} {% about %} {% elif component == 'clients' %} {%
-clients %} {% elif component == 'cta' %} {% cta %} {% elif component ==
-'onfocus' %} {% include 'herobizds/_onfocus.html' %} {% elif component ==
-'features' %} {% features %} {% elif component == 'services' %} {% services %}
-{% elif component == 'testimonials' %} {% testimonials %} {% elif component ==
-'faq' %} {% faq %} {% elif component == 'portfolio' %} {% portfolio %} {% elif
-component == 'team' %} {% team %} {% elif component == 'contact' %} {% contact
-%} {% endif %} {% endif %} {% endfor %} {% include 'herobizds/footer.html' %}
+%} {% if is_use %} {% if component == 'featured_services' %} {%
+featured_services %} {% elif component == 'about' %} {% about %} {% elif
+component == 'clients' %} {% clients %} {% elif component == 'cta' %} {% cta %}
+{% elif component == 'onfocus' %} {% onfocus %} {% elif component == 'features'
+%} {% features %} {% elif component == 'services' %} {% services %} {% elif
+component == 'testimonials' %} {% testimonials %} {% elif component ==
+'pricing' %} {% pricing %} {% elif component == 'faq' %} {% faq %} {% elif
+component == 'portfolio' %} {% portfolio %} {% elif component == 'team' %} {%
+team %} {% elif component == 'blog' %} {% blog %} {% elif component ==
+'contact' %} {% contact %} {% endif %} {% endif %} {% endfor %} {% include
+'herobizds/footer.html' %}
```

### Comparing `django_herobiz_ds-2.0.2/django_herobiz_ds/views.py` & `django_herobiz_ds-2.0.3/django_herobiz_ds/views.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,82 +1,121 @@
-from django.shortcuts import render, get_object_or_404
-from django_utilsds import utils
-from .forms import AppointmentForm
-from _data import herobizds
-from .models import Portfolio
-
-import logging
-logger = logging.getLogger(__name__)
-formatter = logging.Formatter('%(levelname)s: [%(name)s] %(message)s')
-ch = logging.StreamHandler()
-ch.setFormatter(formatter)
-logger.addHandler(ch)
-logger.setLevel(logging.ERROR)
-
-
-def robots(request):
-    from django.shortcuts import HttpResponse
-    file_content = utils.make_robots()
-    return HttpResponse(file_content, content_type="text/plain")
-
-
-def home(request):
-    """
-    컨텍스트를 이곳에서 만들지 않고 _data 폴더의 contents.py에서 만들어진 것을 가져다 쓴다.
-    """
-    c = herobizds.context
-
-    # _variables.scss에서 한글 폰트를 추가해주고 여기에 적절한 폰트 링크를 적용한다.
-    c['font_link'] = "https://fonts.googleapis.com/css2?" \
-                     "family=Hahmlet:wght@100;200;300;400;500;600;700;800;900&" \
-                     "family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&" \
-                     "family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&" \
-                     "family=Noto+Sans+KR:wght@100;300;400;500;700;900&" \
-                     "family=Noto+Serif+KR:wght@200;300;400;500;600;700;900&" \
-                     "family=Gugi&" \
-                     "family=Source+Sans+Pro:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&display=swap"
-
-    logger.info(c)
-    if request.method == 'GET':
-        c.update({'form': AppointmentForm()})
-        # 메일 전송 후에도 한동안 유지되는 anchor와 post_message를 바로 없애기 위해
-        c['anchor'] = None
-        c['post_message'] = None
-        return render(request, 'herobizds/index.html', c)
-    elif request.method == "POST":
-        c.update(make_post_context(request.POST, c['basic_info']['consult_email']))
-        return render(request, 'herobizds/index.html', c)
-
-
-def make_post_context(request_post, consult_mail, anchor='appointment'):
-    logger.info(request_post)
-    context = {}
-    # appointment 앱에서 post 요청을 처리함.
-    logger.info(f'request.POST : {request_post}')
-    form = AppointmentForm(request_post)
-    # 템플릿 렌더링 후 바로 appointment 앵커로 이동시키기 위해 설정
-    context['anchor'] = anchor
-    if form.is_valid():
-        name = form.cleaned_data['name']
-        phone = form.cleaned_data['phone']
-        date = form.cleaned_data['date']
-        message = form.cleaned_data['message']
-        logger.info(f'Pass validation test -  {name} {phone} {date} {message}')
-        is_sendmail = utils.mail_to(title=f'{name} 고객 상담 문의',
-                                    text=f'이름: {name}\n연락처: {phone}\n예약일: {date}\n메시지: {message}',
-                                    mail_addr=consult_mail)
-        if is_sendmail:
-            context['post_message'] = '담당자에게 예약신청이 전달되었습니다. 확인 후 바로 연락드리겠습니다. 감사합니다.'
-        else:
-            context['post_message'] = '메일 전송에서 오류가 발생하였습니다. 카카오톡이나 전화로 문의주시면 감사하겠습니다. 죄송합니다.'
-        return context
-    else:
-        logger.error('Fail form validation test')
-        context['post_message'] = '입력 항목이 유효하지 않습니다. 다시 입력해 주십시요.'
-        return context
-
-
-def details(request, id: int):
-    c = herobizds.context
-    c.update({'obj': get_object_or_404(Portfolio, pk=id)})
-    logger.debug(c)
-    return render(request, "herobizds/_portfolio-details.html", c)
+from django.shortcuts import render, get_object_or_404
+from django_utilsds import utils
+from .forms import AppointmentForm
+from _data import herobizds
+from .models import Portfolio
+
+import logging
+logger = logging.getLogger(__name__)
+formatter = logging.Formatter('%(levelname)s: [%(name)s] %(message)s')
+ch = logging.StreamHandler()
+ch.setFormatter(formatter)
+logger.addHandler(ch)
+logger.setLevel(logging.ERROR)
+
+
+def robots(request):
+    from django.shortcuts import HttpResponse
+    file_content = utils.make_robots()
+    return HttpResponse(file_content, content_type="text/plain")
+
+
+def home(request):
+    c = herobizds.context
+
+    logger.info(c)
+    if request.method == 'GET':
+        c.update({'form': AppointmentForm()})
+        c['post_message'] = None
+        return render(request, 'herobizds/index.html', c)
+    elif request.method == "POST":
+        c.update(make_post_context(request.POST, c['basic_info']['consult_email']))
+        return render(request, 'herobizds/index.html', c)
+
+
+def make_post_context(request_post, consult_mail):
+    logger.info(request_post)
+    context = {}
+    # appointment 앱에서 post 요청을 처리함.
+    logger.info(f'request.POST : {request_post}')
+    form = AppointmentForm(request_post)
+
+    if form.is_valid():
+        name = form.cleaned_data['name']
+        email = form.cleaned_data['email']
+        subject = form.cleaned_data['subject']
+        message = form.cleaned_data['message']
+        logger.info(f'Pass validation test -  {name} {email} {subject} {message}')
+        is_sendmail = utils.mail_to(title=f'{name} 고객 상담 문의',
+                                    text=f'이름: {name}\n메일: {email}\n제목: {subject}\n메시지: {message}',
+                                    mail_addr=consult_mail)
+        if is_sendmail:
+            context['post_message'] = '담당자에게 예약 신청이 전달되었습니다. 확인 후 바로 연락 드리겠습니다. 감사합니다.'
+        else:
+            context['post_message'] = '메일 전송에서 오류가 발생하였습니다. 카카오톡이나 전화로 문의주시면 감사하겠습니다. 죄송합니다.'
+        return context
+    else:
+        logger.error('Fail form validation test')
+        context['post_message'] = '입력 항목이 유효하지 않습니다. 다시 입력해 주십시요.'
+        return context
+
+
+def details(request, id: int):
+    c = herobizds.context
+    c.update(
+        {
+            "obj": get_object_or_404(Portfolio, pk=id),
+            "breadcrumb": {
+                "title": c['portfolio']['title'],
+            },
+        }
+    )
+    logger.debug(c)
+    return render(request, "herobizds/_portfolio-details.html", c)
+
+
+def terms(request):
+    c = herobizds.context
+    c.update(
+        {
+            "breadcrumb": {
+                "title": "Terms of Use",
+            },
+            "terms": {
+                "company_name": c['basic_info']['company_name'],
+                "sdate": c['basic_info']['sdate'],
+            },
+        }
+    )
+    return render(request, "herobizds/_terms.html", c)
+
+
+def privacy(request):
+    c = herobizds.context
+    c.update(
+        {
+            "breadcrumb": {
+                "title": "Privacy Policy",
+            },
+            "privacy": {
+                "company_name": c['basic_info']['company_name'],
+                "assigned_company_name": "데미안소프트",
+                "owner": c['basic_info']['owner'],
+                "position": "담당자",
+                "phone": c['basic_info']['phone'],
+                "email": c['basic_info']['owner_email'],
+                "sdate": c['basic_info']['sdate'],
+            },
+        }
+    )
+    return render(request, "herobizds/_privacy.html", c)
+
+
+def blog(request):
+    return render(request, "herobizds/blog.html", herobizds.context)
+
+
+def blog_details(request):
+    return render(request, "herobizds/blog-details.html", herobizds.context)
+
+
+
```

### Comparing `django_herobiz_ds-2.0.2/pyproject.toml` & `django_herobiz_ds-2.0.3/pyproject.toml`

 * *Files 14% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 [build-system]
 requires = ["flit_core >=3.2,<4"]
 build-backend = "flit_core.buildapi"
 
 [project]
 name = "django_herobiz_ds"
-version = "2.0.2"
+version = "2.0.3"
 description = "my demiansoft templates"
 authors = [{name = "Hyungjin Kim", email = "hj3415@gmail.com"}]
 readme = "README.md"
 license = {file = "LICENSE"}
 classifiers = ["License :: OSI Approved :: MIT License"]
 dependencies = [
     "Django >= 5.0.3",
```

