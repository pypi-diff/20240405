# Comparing `tmp/airfold_common-0.6.8-py3-none-any.whl.zip` & `tmp/airfold_common-0.7.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,27 +1,27 @@
-Zip file size: 17392 bytes, number of entries: 25
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-21 19:46 airfold_common/__init__.py
--rw-r--r--  2.0 unx      208 b- defN 24-Mar-21 19:46 airfold_common/clickhouse.py
--rw-r--r--  2.0 unx      832 b- defN 24-Mar-21 19:46 airfold_common/config.py
--rw-r--r--  2.0 unx     1165 b- defN 24-Mar-21 19:46 airfold_common/data.py
--rw-r--r--  2.0 unx      666 b- defN 24-Mar-21 19:46 airfold_common/error.py
--rw-r--r--  2.0 unx     3504 b- defN 24-Mar-21 19:46 airfold_common/format.py
--rw-r--r--  2.0 unx      515 b- defN 24-Mar-21 19:46 airfold_common/log.py
--rw-r--r--  2.0 unx      946 b- defN 24-Mar-21 19:46 airfold_common/models.py
--rw-r--r--  2.0 unx      901 b- defN 24-Mar-21 19:46 airfold_common/parse.py
--rw-r--r--  2.0 unx     4102 b- defN 24-Mar-21 19:46 airfold_common/plan.py
--rw-r--r--  2.0 unx     4021 b- defN 24-Mar-21 19:46 airfold_common/project.py
--rw-r--r--  2.0 unx     1361 b- defN 24-Mar-21 19:46 airfold_common/provider.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-21 19:46 airfold_common/py.typed
--rw-r--r--  2.0 unx     7322 b- defN 24-Mar-21 19:46 airfold_common/schema.py
--rw-r--r--  2.0 unx      599 b- defN 24-Mar-21 19:46 airfold_common/singleton.py
--rw-r--r--  2.0 unx     2420 b- defN 24-Mar-21 19:46 airfold_common/spec.py
--rw-r--r--  2.0 unx      335 b- defN 24-Mar-21 19:46 airfold_common/type.py
--rw-r--r--  2.0 unx     5317 b- defN 24-Mar-21 19:46 airfold_common/utils.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-21 19:46 airfold_common/ai/__init__.py
--rw-r--r--  2.0 unx      497 b- defN 24-Mar-21 19:46 airfold_common/ai/ai.py
--rw-r--r--  2.0 unx     4960 b- defN 24-Mar-21 19:46 airfold_common/ai/template.py
--rw-r--r--  2.0 unx     1174 b- defN 24-Mar-21 19:46 airfold_common-0.6.8.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Mar-21 19:46 airfold_common-0.6.8.dist-info/WHEEL
--rw-r--r--  2.0 unx       15 b- defN 24-Mar-21 19:46 airfold_common-0.6.8.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2015 b- defN 24-Mar-21 19:46 airfold_common-0.6.8.dist-info/RECORD
-25 files, 42967 bytes uncompressed, 14138 bytes compressed:  67.1%
+Zip file size: 17911 bytes, number of entries: 25
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-04 23:40 airfold_common/__init__.py
+-rw-r--r--  2.0 unx      208 b- defN 24-Apr-04 23:40 airfold_common/clickhouse.py
+-rw-r--r--  2.0 unx      832 b- defN 24-Apr-04 23:40 airfold_common/config.py
+-rw-r--r--  2.0 unx     1165 b- defN 24-Apr-04 23:40 airfold_common/data.py
+-rw-r--r--  2.0 unx      666 b- defN 24-Apr-04 23:40 airfold_common/error.py
+-rw-r--r--  2.0 unx     3504 b- defN 24-Apr-04 23:40 airfold_common/format.py
+-rw-r--r--  2.0 unx      515 b- defN 24-Apr-04 23:40 airfold_common/log.py
+-rw-r--r--  2.0 unx      946 b- defN 24-Apr-04 23:40 airfold_common/models.py
+-rw-r--r--  2.0 unx      901 b- defN 24-Apr-04 23:40 airfold_common/parse.py
+-rw-r--r--  2.0 unx     4102 b- defN 24-Apr-04 23:40 airfold_common/plan.py
+-rw-r--r--  2.0 unx     4021 b- defN 24-Apr-04 23:40 airfold_common/project.py
+-rw-r--r--  2.0 unx     1361 b- defN 24-Apr-04 23:40 airfold_common/provider.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-04 23:40 airfold_common/py.typed
+-rw-r--r--  2.0 unx    10607 b- defN 24-Apr-04 23:40 airfold_common/schema.py
+-rw-r--r--  2.0 unx      599 b- defN 24-Apr-04 23:40 airfold_common/singleton.py
+-rw-r--r--  2.0 unx     2420 b- defN 24-Apr-04 23:40 airfold_common/spec.py
+-rw-r--r--  2.0 unx      335 b- defN 24-Apr-04 23:40 airfold_common/type.py
+-rw-r--r--  2.0 unx     5317 b- defN 24-Apr-04 23:40 airfold_common/utils.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-04 23:40 airfold_common/ai/__init__.py
+-rw-r--r--  2.0 unx      497 b- defN 24-Apr-04 23:40 airfold_common/ai/ai.py
+-rw-r--r--  2.0 unx     4960 b- defN 24-Apr-04 23:40 airfold_common/ai/template.py
+-rw-r--r--  2.0 unx     1181 b- defN 24-Apr-04 23:41 airfold_common-0.7.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-04 23:41 airfold_common-0.7.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       15 b- defN 24-Apr-04 23:41 airfold_common-0.7.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2016 b- defN 24-Apr-04 23:41 airfold_common-0.7.0.dist-info/RECORD
+25 files, 46260 bytes uncompressed, 14657 bytes compressed:  68.3%
```

## zipnote {}

```diff
@@ -57,20 +57,20 @@
 
 Filename: airfold_common/ai/ai.py
 Comment: 
 
 Filename: airfold_common/ai/template.py
 Comment: 
 
-Filename: airfold_common-0.6.8.dist-info/METADATA
+Filename: airfold_common-0.7.0.dist-info/METADATA
 Comment: 
 
-Filename: airfold_common-0.6.8.dist-info/WHEEL
+Filename: airfold_common-0.7.0.dist-info/WHEEL
 Comment: 
 
-Filename: airfold_common-0.6.8.dist-info/top_level.txt
+Filename: airfold_common-0.7.0.dist-info/top_level.txt
 Comment: 
 
-Filename: airfold_common-0.6.8.dist-info/RECORD
+Filename: airfold_common-0.7.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## airfold_common/schema.py

```diff
@@ -171,7 +171,88 @@
                 res["properties"][name] = convert_schema(nested_types, dialect, openapi=openapi)
             else:
                 res["properties"][name] = convert_type(data_type, constraints, dialect, openapi=openapi)
         else:
             raise AirfoldCastError(f"Unsupported data type: {col.sql(dialect)}")
     res["required"] = required
     return res
+
+
+def schema_diff(type1: str, type2: str, dialect: str = "clickhouse") -> str:
+    create_table = f"CREATE TABLE t (a {type1}, b {type2})"
+    sql_exp = parse_one(create_table, dialect=dialect)
+    cols = []
+    for col in sql_exp.this.expressions:
+        if isinstance(col, ColumnDef):
+            assert col.kind
+            cols.append(col.kind)
+    if cols[0] == cols[1]:
+        return ""
+    if cols[0].this in [DataType.Type.LOWCARDINALITY, DataType.Type.NULLABLE]:
+        return schema_diff(cols[0].expressions[0].sql(dialect), type2)
+    if cols[1].this in [DataType.Type.LOWCARDINALITY]:
+        return schema_diff(type1, cols[1].expressions[0].sql(dialect))
+    if cols[0].this in DataType.NESTED_TYPES and cols[0].this == cols[1].this:
+        diff = schema_diff(cols[0].expressions[0].sql(dialect), cols[1].expressions[0].sql(dialect))
+        if diff:
+            return f"{cols[0].this}({diff})"
+        else:
+            return ""
+    if (cols[1].this in DataType.SIGNED_INTEGER_TYPES or cols[1].this in DataType.UNSIGNED_INTEGER_TYPES) and (  # type: ignore
+        (cols[0].this in [DataType.Type.UTINYINT] and cols[1].this not in [DataType.Type.TINYINT])
+        or (cols[0].this in [DataType.Type.TINYINT] and cols[1].this not in [DataType.Type.UTINYINT])
+        or (
+            cols[0].this in [DataType.Type.SMALLINT]
+            and cols[1].this not in [DataType.Type.UTINYINT, DataType.Type.TINYINT, DataType.Type.USMALLINT]
+        )
+        or (
+            cols[0].this in [DataType.Type.USMALLINT]
+            and cols[1].this not in [DataType.Type.UTINYINT, DataType.Type.TINYINT, DataType.Type.SMALLINT]
+        )
+        or (
+            cols[0].this in [DataType.Type.INT, DataType.Type.MEDIUMINT]
+            and cols[1].this
+            not in [
+                DataType.Type.UTINYINT,
+                DataType.Type.TINYINT,
+                DataType.Type.USMALLINT,
+                DataType.Type.SMALLINT,
+                DataType.Type.UINT,
+                DataType.Type.UMEDIUMINT,
+            ]
+        )
+        or (
+            cols[0].this in [DataType.Type.UINT, DataType.Type.UMEDIUMINT]
+            and cols[1].this
+            not in [
+                DataType.Type.UTINYINT,
+                DataType.Type.TINYINT,
+                DataType.Type.USMALLINT,
+                DataType.Type.SMALLINT,
+                DataType.Type.INT,
+                DataType.Type.MEDIUMINT,
+            ]
+        )
+        or (cols[0].this in [DataType.Type.BIGINT] and cols[1].this in [DataType.Type.BIGINT])
+        or (cols[0].this in [DataType.Type.UBIGINT] and cols[1].this in [DataType.Type.UBIGINT])
+    ):
+        return ""
+    return f"{type1} -> {type2}"
+
+
+def match_schema(schema1: dict[str, str], schema2: dict[str, str]) -> str | None:
+    result = ""
+    if schema1 == schema2:
+        return None
+    for key in sorted(schema1.keys()):
+        if not schema2.get(key):
+            result += f"- {key}: {schema1[key]}\n"
+        else:
+            diff = schema_diff(schema1[key], schema2[key])
+            if diff:
+                result += f"> {key}: {diff}\n"
+    for key in sorted(schema2.keys()):
+        if not schema1.get(key):
+            result += f"+ {key}: {schema2[key]}\n"
+    if not result:
+        return None
+    return result
```

## Comparing `airfold_common-0.6.8.dist-info/METADATA` & `airfold_common-0.7.0.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 Metadata-Version: 2.1
 Name: airfold-common
-Version: 0.6.8
+Version: 0.7.0
 Summary: Airfold Common
 Author-email: Constantine Peresypkin <pconstantine@gmail.com>, Oleksandr Bazna <oleksandr.bazna@gmail.com>
 Classifier: Development Status :: 3 - Alpha
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Operating System :: OS Independent
 Requires-Python: <4,>=3.10
 Description-Content-Type: text/markdown
 Requires-Dist: pydantic <2.0,>=1.10.4
 Requires-Dist: pyyaml ==5.3.1
 Requires-Dist: typer >=0.9.0
 Requires-Dist: rich
-Requires-Dist: sqlglot
+Requires-Dist: sqlglot >=23.7
 Provides-Extra: test
 Requires-Dist: build ; extra == 'test'
 Requires-Dist: isort ; extra == 'test'
 Requires-Dist: black ~=23.3 ; extra == 'test'
 Requires-Dist: mypy ; extra == 'test'
 Requires-Dist: pytest ; extra == 'test'
 Requires-Dist: pytest-docker-compose ; extra == 'test'
```

## Comparing `airfold_common-0.6.8.dist-info/RECORD` & `airfold_common-0.7.0.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -7,19 +7,19 @@
 airfold_common/log.py,sha256=rDZiv06Q5ObbbqYAJ_3eHpKXy0UdrPcVSC2nse0InR0,515
 airfold_common/models.py,sha256=D9pz822LQ81_ojaew_J8IVbT3RUvYUGGG310dsra078,946
 airfold_common/parse.py,sha256=J70QusEPJdu-A6r04LTUDh3t69a0KDFCqeOjMkHSEhE,901
 airfold_common/plan.py,sha256=m38kHPEwELyyDuo2p-aHEA9CLdykKkhn6Yds6iNj7-E,4102
 airfold_common/project.py,sha256=xSwjZKWep4i0qFYS-EeHtEErkkNi9qK52m1JBriCHDc,4021
 airfold_common/provider.py,sha256=nSIaUr3fNVuGjn4mMy_l658G6fGaX4qeYQ2OZVZFMRM,1361
 airfold_common/py.typed,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-airfold_common/schema.py,sha256=dm5-PqFICpvhdWjIUAt_loSafINZ1dUEbQO7rluGv3o,7322
+airfold_common/schema.py,sha256=jBO4kqSZpMwh7Mqy4BkY6mApqt5BKbVLWoiH5Z7r0Pc,10607
 airfold_common/singleton.py,sha256=IVClXGZLiYdSSEa6N0TRpJRHOJbFNxSwlO3UhNA37ZI,599
 airfold_common/spec.py,sha256=2594FIuwexfS2hsvcwN57y_pce7ULBk7RSgT-L4ox_c,2420
 airfold_common/type.py,sha256=fMGthqezESYQ0BN0NzgpaVYUfOQOFVB8HLsR6D7PYt0,335
 airfold_common/utils.py,sha256=qw05k91S3O7MNVktANE1nBOSbs4O-xJVPTx7K6pW5Ks,5317
 airfold_common/ai/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 airfold_common/ai/ai.py,sha256=lIl87rzAjg7jsi3wN04yL7-PesWSFsk4uWY7by4mk6k,497
 airfold_common/ai/template.py,sha256=jXK2PobnImijwxjjCCEMcywYD6qcps4gzQ4MYb_p7qs,4960
-airfold_common-0.6.8.dist-info/METADATA,sha256=-141EHmuDXD-7AZMHKuvAE0p_WMMw2R-bdRGnGXauQs,1174
-airfold_common-0.6.8.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-airfold_common-0.6.8.dist-info/top_level.txt,sha256=dbGzfMf41X9_z-SeqXW2WYRhmTREyf0IvvU8g4a83Sg,15
-airfold_common-0.6.8.dist-info/RECORD,,
+airfold_common-0.7.0.dist-info/METADATA,sha256=K4MP4Ovd5_l5APi2DscuTZWYqQyvRDV88m2IdeileeY,1181
+airfold_common-0.7.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+airfold_common-0.7.0.dist-info/top_level.txt,sha256=dbGzfMf41X9_z-SeqXW2WYRhmTREyf0IvvU8g4a83Sg,15
+airfold_common-0.7.0.dist-info/RECORD,,
```

