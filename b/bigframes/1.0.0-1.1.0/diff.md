# Comparing `tmp/bigframes-1.0.0.tar.gz` & `tmp/bigframes-1.1.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "bigframes-1.0.0.tar", last modified: Mon Mar 25 17:20:43 2024, max compression
+gzip compressed data, was "bigframes-1.1.0.tar", last modified: Thu Apr  4 23:04:28 2024, max compression
```

## Comparing `bigframes-1.0.0.tar` & `bigframes-1.1.0.tar`

### file list

```diff
@@ -1,357 +1,377 @@
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.688334 bigframes-1.0.0/
--rw-rw-r--   0 root         (0)     1003    11358 2024-03-25 17:18:08.000000 bigframes-1.0.0/LICENSE
--rw-rw-r--   0 root         (0)     1003      914 2024-03-25 17:18:08.000000 bigframes-1.0.0/MANIFEST.in
--rw-r--r--   0 root         (0)     1003    23282 2024-03-25 17:20:43.688334 bigframes-1.0.0/PKG-INFO
--rw-rw-r--   0 root         (0)     1003    20930 2024-03-25 17:18:08.000000 bigframes-1.0.0/README.rst
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.604288 bigframes-1.0.0/bigframes/
--rw-rw-r--   0 root         (0)     1003     1111 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.608291 bigframes-1.0.0/bigframes/_config/
--rw-rw-r--   0 root         (0)     1003     2453 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/_config/__init__.py
--rw-rw-r--   0 root         (0)     1003     7720 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/_config/bigquery_options.py
--rw-rw-r--   0 root         (0)     1003     1780 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/_config/compute_options.py
--rw-rw-r--   0 root         (0)     1003     1661 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/_config/display_options.py
--rw-rw-r--   0 root         (0)     1003     1892 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/_config/sampling_options.py
--rw-rw-r--   0 root         (0)     1003     7152 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/clients.py
--rw-rw-r--   0 root         (0)     1003     1079 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/constants.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.612293 bigframes-1.0.0/bigframes/core/
--rw-rw-r--   0 root         (0)     1003    14866 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/__init__.py
--rw-rw-r--   0 root         (0)     1003    29614 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/block_transforms.py
--rw-rw-r--   0 root         (0)     1003    89094 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/blocks.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.616295 bigframes-1.0.0/bigframes/core/compile/
--rw-rw-r--   0 root         (0)     1003      832 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/__init__.py
--rw-rw-r--   0 root         (0)     1003    17291 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/aggregate_compiler.py
--rw-rw-r--   0 root         (0)     1003    58734 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/compiled.py
--rw-rw-r--   0 root         (0)     1003     6529 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/compiler.py
--rw-rw-r--   0 root         (0)     1003     3356 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/concat.py
--rw-rw-r--   0 root         (0)     1003    45709 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/scalar_op_compiler.py
--rw-rw-r--   0 root         (0)     1003     7057 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/compile/single_column.py
--rw-rw-r--   0 root         (0)     1003     6554 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/expression.py
--rw-rw-r--   0 root         (0)     1003     1846 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/global_session.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.616295 bigframes-1.0.0/bigframes/core/groupby/
--rw-rw-r--   0 root         (0)     1003    22543 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/groupby/__init__.py
--rw-rw-r--   0 root         (0)     1003      716 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/guid.py
--rw-rw-r--   0 root         (0)     1003    17649 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/indexers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.616295 bigframes-1.0.0/bigframes/core/indexes/
--rw-rw-r--   0 root         (0)     1003      650 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/indexes/__init__.py
--rw-rw-r--   0 root         (0)     1003    16123 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/indexes/index.py
--rw-rw-r--   0 root         (0)     1003     1597 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/join_def.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.616295 bigframes-1.0.0/bigframes/core/joins/
--rw-rw-r--   0 root         (0)     1003      770 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/joins/__init__.py
--rw-rw-r--   0 root         (0)     1003     2132 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/joins/merge.py
--rw-rw-r--   0 root         (0)     1003     1883 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/joins/name_resolution.py
--rw-rw-r--   0 root         (0)     1003     2218 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/local_data.py
--rw-rw-r--   0 root         (0)     1003     2255 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/log_adapter.py
--rw-rw-r--   0 root         (0)     1003    15046 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/nodes.py
--rw-rw-r--   0 root         (0)     1003     9392 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/ordering.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.620297 bigframes-1.0.0/bigframes/core/reshape/
--rw-rw-r--   0 root         (0)     1003     5965 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/reshape/__init__.py
--rw-rw-r--   0 root         (0)     1003    10722 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/rewrite.py
--rw-rw-r--   0 root         (0)     1003      746 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/scalar.py
--rw-rw-r--   0 root         (0)     1003     2144 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/schema.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.620297 bigframes-1.0.0/bigframes/core/tools/
--rw-rw-r--   0 root         (0)     1003      664 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/tools/__init__.py
--rw-rw-r--   0 root         (0)     1003     3342 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/tools/datetimes.py
--rw-rw-r--   0 root         (0)     1003     1051 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/traversal.py
--rw-rw-r--   0 root         (0)     1003     5483 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/utils.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.620297 bigframes-1.0.0/bigframes/core/window/
--rw-rw-r--   0 root         (0)     1003     3075 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/window/__init__.py
--rw-rw-r--   0 root         (0)     1003     1286 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/core/window_spec.py
--rw-rw-r--   0 root         (0)     1003   120725 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/dataframe.py
--rw-rw-r--   0 root         (0)     1003    25130 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/dtypes.py
--rw-rw-r--   0 root         (0)     1003     1273 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/features.py
--rw-rw-r--   0 root         (0)     1003    11179 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/formatting_helpers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.620297 bigframes-1.0.0/bigframes/functions/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/functions/__init__.py
--rw-rw-r--   0 root         (0)     1003    39370 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/functions/remote_function.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.624299 bigframes-1.0.0/bigframes/ml/
--rw-rw-r--   0 root         (0)     1003      877 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/__init__.py
--rw-rw-r--   0 root         (0)     1003     7690 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/base.py
--rw-rw-r--   0 root         (0)     1003     6649 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/cluster.py
--rw-rw-r--   0 root         (0)     1003     4954 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/compose.py
--rw-rw-r--   0 root         (0)     1003    16005 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/core.py
--rw-rw-r--   0 root         (0)     1003     6797 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/decomposition.py
--rw-rw-r--   0 root         (0)     1003    24706 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/ensemble.py
--rw-rw-r--   0 root         (0)     1003    15801 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/forecasting.py
--rw-rw-r--   0 root         (0)     1003     1141 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/globals.py
--rw-rw-r--   0 root         (0)     1003    10858 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/imported.py
--rw-rw-r--   0 root         (0)     1003    13798 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/linear_model.py
--rw-rw-r--   0 root         (0)     1003    26446 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/llm.py
--rw-rw-r--   0 root         (0)     1003     4035 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/loader.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.628301 bigframes-1.0.0/bigframes/ml/metrics/
--rw-rw-r--   0 root         (0)     1003     1016 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/metrics/__init__.py
--rw-rw-r--   0 root         (0)     1003    10840 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/metrics/_metrics.py
--rw-rw-r--   0 root         (0)     1003     2373 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/metrics/pairwise.py
--rw-rw-r--   0 root         (0)     1003     3747 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/model_selection.py
--rw-rw-r--   0 root         (0)     1003     8777 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/pipeline.py
--rw-rw-r--   0 root         (0)     1003    22521 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/preprocessing.py
--rw-rw-r--   0 root         (0)     1003     5754 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/remote.py
--rw-rw-r--   0 root         (0)     1003    13327 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/sql.py
--rw-rw-r--   0 root         (0)     1003     2403 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/ml/utils.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.628301 bigframes-1.0.0/bigframes/operations/
--rw-rw-r--   0 root         (0)     1003    18159 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.628301 bigframes-1.0.0/bigframes/operations/_matplotlib/
--rw-rw-r--   0 root         (0)     1003     1022 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/_matplotlib/__init__.py
--rw-rw-r--   0 root         (0)     1003     3856 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/_matplotlib/core.py
--rw-rw-r--   0 root         (0)     1003     5970 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/_matplotlib/hist.py
--rw-rw-r--   0 root         (0)     1003    10530 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/aggregations.py
--rw-rw-r--   0 root         (0)     1003     8273 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/base.py
--rw-rw-r--   0 root         (0)     1003     3079 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/datetimes.py
--rw-rw-r--   0 root         (0)     1003     2814 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/plotting.py
--rw-rw-r--   0 root         (0)     1003     8493 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/strings.py
--rw-rw-r--   0 root         (0)     1003     1679 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/structs.py
--rw-rw-r--   0 root         (0)     1003     2299 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/operations/type.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.628301 bigframes-1.0.0/bigframes/pandas/
--rw-rw-r--   0 root         (0)     1003    22645 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/pandas/__init__.py
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/py.typed
--rw-rw-r--   0 root         (0)     1003    59766 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/series.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.632304 bigframes-1.0.0/bigframes/session/
--rw-rw-r--   0 root         (0)     1003    77385 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/session/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.632304 bigframes-1.0.0/bigframes/session/_io/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/session/_io/__init__.py
--rw-rw-r--   0 root         (0)     1003     8040 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/session/_io/bigquery.py
--rw-rw-r--   0 root         (0)     1003     4345 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/session/_io/pandas.py
--rw-rw-r--   0 root         (0)     1003     8001 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/session/clients.py
--rw-rw-r--   0 root         (0)     1003      597 2024-03-25 17:18:08.000000 bigframes-1.0.0/bigframes/version.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.684332 bigframes-1.0.0/bigframes.egg-info/
--rw-r--r--   0 root         (0)     1003    23282 2024-03-25 17:20:43.000000 bigframes-1.0.0/bigframes.egg-info/PKG-INFO
--rw-r--r--   0 root         (0)     1003    11336 2024-03-25 17:20:43.000000 bigframes-1.0.0/bigframes.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0)     1003        1 2024-03-25 17:20:43.000000 bigframes-1.0.0/bigframes.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0)     1003        1 2024-03-25 17:20:43.000000 bigframes-1.0.0/bigframes.egg-info/not-zip-safe
--rw-r--r--   0 root         (0)     1003      717 2024-03-25 17:20:43.000000 bigframes-1.0.0/bigframes.egg-info/requires.txt
--rw-r--r--   0 root         (0)     1003       29 2024-03-25 17:20:43.000000 bigframes-1.0.0/bigframes.egg-info/top_level.txt
--rw-rw-r--   0 root         (0)     1003       81 2024-03-25 17:18:08.000000 bigframes-1.0.0/pyproject.toml
--rw-rw-r--   0 root         (0)     1003       67 2024-03-25 17:20:43.688334 bigframes-1.0.0/setup.cfg
--rw-rw-r--   0 root         (0)     1003     4393 2024-03-25 17:18:08.000000 bigframes-1.0.0/setup.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.632304 bigframes-1.0.0/tests/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.636306 bigframes-1.0.0/tests/data/
--rw-rw-r--   0 root         (0)     1003      619 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/hockey_players.json
--rw-rw-r--   0 root         (0)     1003     1250 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/hockey_players.jsonl
--rw-rw-r--   0 root         (0)     1003      340 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/matrix_2by3.json
--rw-rw-r--   0 root         (0)     1003       80 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/matrix_2by3.jsonl
--rw-rw-r--   0 root         (0)     1003      421 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/matrix_3by4.json
--rw-rw-r--   0 root         (0)     1003      154 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/matrix_3by4.jsonl
--rw-rw-r--   0 root         (0)     1003    33350 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/nested.jsonl
--rw-rw-r--   0 root         (0)     1003      966 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/nested_schema.json
--rw-rw-r--   0 root         (0)     1003    58869 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/penguins.jsonl
--rw-rw-r--   0 root         (0)     1003      636 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/penguins_schema.json
--rw-rw-r--   0 root         (0)     1003     3909 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/scalars.jsonl
--rw-rw-r--   0 root         (0)     1003     1458 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/scalars_schema.json
--rw-rw-r--   0 root         (0)     1003    23424 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/time_series.jsonl
--rw-rw-r--   0 root         (0)     1003      192 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/data/time_series_schema.json
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.636306 bigframes-1.0.0/tests/system/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/__init__.py
--rw-rw-r--   0 root         (0)     1003    36715 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/conftest.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.636306 bigframes-1.0.0/tests/system/large/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.640308 bigframes-1.0.0/tests/system/large/ml/
--rw-rw-r--   0 root         (0)     1003     5411 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_cluster.py
--rw-rw-r--   0 root         (0)     1003     4357 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_compose.py
--rw-rw-r--   0 root         (0)     1003     6401 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_core.py
--rw-rw-r--   0 root         (0)     1003     6487 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_decomposition.py
--rw-rw-r--   0 root         (0)     1003    14451 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_ensemble.py
--rw-rw-r--   0 root         (0)     1003     4366 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_forecasting.py
--rw-rw-r--   0 root         (0)     1003     8408 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_linear_model.py
--rw-rw-r--   0 root         (0)     1003    30395 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/ml/test_pipeline.py
--rw-rw-r--   0 root         (0)     1003    49163 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/test_remote_function.py
--rw-rw-r--   0 root         (0)     1003     1908 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/large/test_session.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.640308 bigframes-1.0.0/tests/system/load/
--rw-rw-r--   0 root         (0)     1003     2865 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/load/test_large_tables.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.644310 bigframes-1.0.0/tests/system/small/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.652314 bigframes-1.0.0/tests/system/small/ml/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/__init__.py
--rw-rw-r--   0 root         (0)     1003    11759 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/conftest.py
--rw-rw-r--   0 root         (0)     1003     7074 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_cluster.py
--rw-rw-r--   0 root         (0)     1003    13821 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_core.py
--rw-rw-r--   0 root         (0)     1003     6764 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_decomposition.py
--rw-rw-r--   0 root         (0)     1003    17015 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_ensemble.py
--rw-rw-r--   0 root         (0)     1003     6859 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_forecasting.py
--rw-rw-r--   0 root         (0)     1003     4983 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_imported.py
--rw-rw-r--   0 root         (0)     1003     8788 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_linear_model.py
--rw-rw-r--   0 root         (0)     1003    11673 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_llm.py
--rw-rw-r--   0 root         (0)     1003    25611 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_metrics.py
--rw-rw-r--   0 root         (0)     1003     2224 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_metrics_pairwise.py
--rw-rw-r--   0 root         (0)     1003     6197 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_model_selection.py
--rw-rw-r--   0 root         (0)     1003    26351 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_preprocessing.py
--rw-rw-r--   0 root         (0)     1003     2570 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_register.py
--rw-rw-r--   0 root         (0)     1003     1205 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/ml/test_remote.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.652314 bigframes-1.0.0/tests/system/small/operations/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/operations/__init__.py
--rw-rw-r--   0 root         (0)     1003     8490 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/operations/test_datetimes.py
--rw-rw-r--   0 root         (0)     1003    11472 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/operations/test_plotting.py
--rw-rw-r--   0 root         (0)     1003    15770 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/operations/test_strings.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.652314 bigframes-1.0.0/tests/system/small/regression/
--rw-rw-r--   0 root         (0)     1003     1999 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/regression/test_issue355_merge_after_filter.py
--rw-rw-r--   0 root         (0)     1003   131687 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_dataframe.py
--rw-rw-r--   0 root         (0)     1003    19620 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_dataframe_io.py
--rw-rw-r--   0 root         (0)     1003    10210 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_encryption.py
--rw-rw-r--   0 root         (0)     1003    12965 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_groupby.py
--rw-rw-r--   0 root         (0)     1003     1558 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_ibis.py
--rw-rw-r--   0 root         (0)     1003    12158 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_index.py
--rw-rw-r--   0 root         (0)     1003     1205 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_ipython.py
--rw-rw-r--   0 root         (0)     1003    40539 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_multiindex.py
--rw-rw-r--   0 root         (0)     1003     3569 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_numpy.py
--rw-rw-r--   0 root         (0)     1003    17980 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_pandas.py
--rw-rw-r--   0 root         (0)     1003     9533 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_pandas_options.py
--rw-rw-r--   0 root         (0)     1003     4560 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_progress_bar.py
--rw-rw-r--   0 root         (0)     1003    25513 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_remote_function.py
--rw-rw-r--   0 root         (0)     1003      913 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_scalar.py
--rw-rw-r--   0 root         (0)     1003   103861 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_series.py
--rw-rw-r--   0 root         (0)     1003    39912 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_session.py
--rw-rw-r--   0 root         (0)     1003     3343 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/small/test_window.py
--rw-rw-r--   0 root         (0)     1003    12113 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/system/utils.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.656316 bigframes-1.0.0/tests/unit/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.656316 bigframes-1.0.0/tests/unit/_config/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/_config/__init__.py
--rw-rw-r--   0 root         (0)     1003     2733 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/_config/test_bigquery_options.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.656316 bigframes-1.0.0/tests/unit/core/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/core/__init__.py
--rw-rw-r--   0 root         (0)     1003     1619 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/core/test_bf_utils.py
--rw-rw-r--   0 root         (0)     1003     2966 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/core/test_blocks.py
--rw-rw-r--   0 root         (0)     1003     1553 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/core/test_expression.py
--rw-rw-r--   0 root         (0)     1003     1813 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/core/test_log_adapter.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.660319 bigframes-1.0.0/tests/unit/ml/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/ml/__init__.py
--rw-rw-r--   0 root         (0)     1003     2323 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/ml/test_api_primitives.py
--rw-rw-r--   0 root         (0)     1003     6555 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/ml/test_compose.py
--rw-rw-r--   0 root         (0)     1003     7426 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/ml/test_golden_sql.py
--rw-rw-r--   0 root         (0)     1003     4058 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/ml/test_pipeline.py
--rw-rw-r--   0 root         (0)     1003    13078 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/ml/test_sql.py
--rw-rw-r--   0 root         (0)     1003     4842 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/resources.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.660319 bigframes-1.0.0/tests/unit/session/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/session/__init__.py
--rw-rw-r--   0 root         (0)     1003     4347 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/session/test_clients.py
--rw-rw-r--   0 root         (0)     1003     7809 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/session/test_io_bigquery.py
--rw-rw-r--   0 root         (0)     1003    18664 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/session/test_io_pandas.py
--rw-rw-r--   0 root         (0)     1003     6619 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/session/test_session.py
--rw-rw-r--   0 root         (0)     1003     1744 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_clients.py
--rw-rw-r--   0 root         (0)     1003     1056 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_compute_options.py
--rw-rw-r--   0 root         (0)     1003     6648 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_core.py
--rw-rw-r--   0 root         (0)     1003     2136 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_dataframe.py
--rw-rw-r--   0 root         (0)     1003     8819 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_dtypes.py
--rw-rw-r--   0 root         (0)     1003     1577 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_features.py
--rw-rw-r--   0 root         (0)     1003      528 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_formatting_helper.py
--rw-rw-r--   0 root         (0)     1003     1655 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_formatting_helpers.py
--rw-rw-r--   0 root         (0)     1003     4055 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_pandas.py
--rw-rw-r--   0 root         (0)     1003     1207 2024-03-25 17:18:08.000000 bigframes-1.0.0/tests/unit/test_remote_function.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.596284 bigframes-1.0.0/third_party/
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.660319 bigframes-1.0.0/third_party/bigframes_vendored/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.660319 bigframes-1.0.0/third_party/bigframes_vendored/cpython/
--rw-rw-r--   0 root         (0)     1003     2339 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/cpython/LICENSE
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/cpython/__init__.py
--rw-rw-r--   0 root         (0)     1003    18853 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/cpython/_pprint.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.664321 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/
--rw-rw-r--   0 root         (0)     1003    11358 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003     5290 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.664321 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.664321 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/
--rw-rw-r--   0 root         (0)     1003      574 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py
--rw-rw-r--   0 root         (0)     1003    14045 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.664321 bigframes-1.0.0/third_party/bigframes_vendored/ibis/
--rw-rw-r--   0 root         (0)     1003    11358 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/LICENSE.txt
--rw-rw-r--   0 root         (0)     1003    11663 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/README.md
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.664321 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.664321 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/
--rw-rw-r--   0 root         (0)     1003      184 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003     2091 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py
--rw-rw-r--   0 root         (0)     1003     6600 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py
--rw-rw-r--   0 root         (0)     1003     1363 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.668323 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.668323 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/
--rw-rw-r--   0 root         (0)     1003      383 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/__init__.py
--rw-rw-r--   0 root         (0)     1003      536 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py
--rw-rw-r--   0 root         (0)     1003      263 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/json.py
--rw-rw-r--   0 root         (0)     1003      690 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.668323 bigframes-1.0.0/third_party/bigframes_vendored/pandas/
--rw-rw-r--   0 root         (0)     1003     2284 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/AUTHORS.md
--rw-rw-r--   0 root         (0)     1003     1634 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/LICENSE
--rw-rw-r--   0 root         (0)     1003    10620 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/README.md
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.668323 bigframes-1.0.0/third_party/bigframes_vendored/pandas/_config/
--rw-rw-r--   0 root         (0)     1003     1347 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/_config/config.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.672325 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.672325 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.672325 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/__init__.py
--rw-rw-r--   0 root         (0)     1003     2824 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py
--rw-rw-r--   0 root         (0)     1003     3681 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py
--rw-rw-r--   0 root         (0)     1003     1567 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/common.py
--rw-rw-r--   0 root         (0)     1003     3976 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/config_init.py
--rw-rw-r--   0 root         (0)     1003   185036 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/frame.py
--rw-rw-r--   0 root         (0)     1003    38558 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/generic.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.672325 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/groupby/
--rw-rw-r--   0 root         (0)     1003    12968 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.672325 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexes/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexes/__init__.py
--rw-rw-r--   0 root         (0)     1003     3129 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py
--rw-rw-r--   0 root         (0)     1003    10943 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexes/base.py
--rw-rw-r--   0 root         (0)     1003     2909 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexing.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.676327 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/__init__.py
--rw-rw-r--   0 root         (0)     1003     4372 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py
--rw-rw-r--   0 root         (0)     1003     3804 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py
--rw-rw-r--   0 root         (0)     1003     3220 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py
--rw-rw-r--   0 root         (0)     1003     5276 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py
--rw-rw-r--   0 root         (0)     1003   108567 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/series.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.676327 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/strings/
--rw-rw-r--   0 root         (0)     1003    20170 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.676327 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/tools/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/tools/__init__.py
--rw-rw-r--   0 root         (0)     1003     2867 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.676327 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/window/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/window/__init__.py
--rw-rw-r--   0 root         (0)     1003     1350 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/window/rolling.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.676327 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/__init__.py
--rw-rw-r--   0 root         (0)     1003     1269 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/common.py
--rw-rw-r--   0 root         (0)     1003     6612 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/gbq.py
--rw-rw-r--   0 root         (0)     1003     1428 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/parquet.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/parsers/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/parsers/__init__.py
--rw-rw-r--   0 root         (0)     1003    10553 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py
--rw-rw-r--   0 root         (0)     1003     3130 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/pickle.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/pandas/pandas/
--rw-rw-r--   0 root         (0)     1003    12353 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/pandas/_typing.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/pandas/plotting/
--rw-rw-r--   0 root         (0)     1003    11348 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/pandas/plotting/_core.py
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/py.typed
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/
--rw-rw-r--   0 root         (0)     1003     1532 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/COPYING
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/__init__.py
--rw-rw-r--   0 root         (0)     1003     6210 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/base.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/cluster/
--rw-rw-r--   0 root         (0)     1003     5924 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/compose/
--rw-rw-r--   0 root         (0)     1003     2014 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/decomposition/
--rw-rw-r--   0 root         (0)     1003     5387 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.680329 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/ensemble/
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/ensemble/__init__.py
--rw-rw-r--   0 root         (0)     1003     8979 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.684332 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/linear_model/
--rw-rw-r--   0 root         (0)     1003     5417 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py
--rw-rw-r--   0 root         (0)     1003     4352 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.684332 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/
--rw-rw-r--   0 root         (0)     1003     9779 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py
--rw-rw-r--   0 root         (0)     1003     4173 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/_ranking.py
--rw-rw-r--   0 root         (0)     1003     2745 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py
--rw-rw-r--   0 root         (0)     1003     2121 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py
--rw-rw-r--   0 root         (0)     1003     2973 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/pipeline.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.684332 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/
--rw-rw-r--   0 root         (0)     1003     4980 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py
--rw-rw-r--   0 root         (0)     1003     1527 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py
--rw-rw-r--   0 root         (0)     1003     3753 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py
--rw-rw-r--   0 root         (0)     1003     2085 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-03-25 17:20:43.684332 bigframes-1.0.0/third_party/bigframes_vendored/xgboost/
--rw-rw-r--   0 root         (0)     1003    11348 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/xgboost/LICENSE
--rw-rw-r--   0 root         (0)     1003        0 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/xgboost/__init__.py
--rw-rw-r--   0 root         (0)     1003     6921 2024-03-25 17:18:08.000000 bigframes-1.0.0/third_party/bigframes_vendored/xgboost/sklearn.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.092995 bigframes-1.1.0/
+-rw-rw-r--   0 root         (0)     1003    11358 2024-04-04 23:02:01.000000 bigframes-1.1.0/LICENSE
+-rw-rw-r--   0 root         (0)     1003      914 2024-04-04 23:02:01.000000 bigframes-1.1.0/MANIFEST.in
+-rw-r--r--   0 root         (0)     1003     4650 2024-04-04 23:04:28.092995 bigframes-1.1.0/PKG-INFO
+-rw-rw-r--   0 root         (0)     1003     2256 2024-04-04 23:02:01.000000 bigframes-1.1.0/README.rst
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.020990 bigframes-1.1.0/bigframes/
+-rw-rw-r--   0 root         (0)     1003     1111 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.020990 bigframes-1.1.0/bigframes/_config/
+-rw-rw-r--   0 root         (0)     1003     2453 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/_config/__init__.py
+-rw-rw-r--   0 root         (0)     1003     8228 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/_config/bigquery_options.py
+-rw-rw-r--   0 root         (0)     1003     2139 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/_config/compute_options.py
+-rw-rw-r--   0 root         (0)     1003     1661 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/_config/display_options.py
+-rw-rw-r--   0 root         (0)     1003     1892 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/_config/sampling_options.py
+-rw-rw-r--   0 root         (0)     1003     7152 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/clients.py
+-rw-rw-r--   0 root         (0)     1003     1079 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/constants.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.028991 bigframes-1.1.0/bigframes/core/
+-rw-rw-r--   0 root         (0)     1003    15360 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/__init__.py
+-rw-rw-r--   0 root         (0)     1003    29614 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/block_transforms.py
+-rw-rw-r--   0 root         (0)     1003    90329 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/blocks.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.028991 bigframes-1.1.0/bigframes/core/compile/
+-rw-rw-r--   0 root         (0)     1003      832 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/__init__.py
+-rw-rw-r--   0 root         (0)     1003    17255 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/aggregate_compiler.py
+-rw-rw-r--   0 root         (0)     1003    62857 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/compiled.py
+-rw-rw-r--   0 root         (0)     1003     6694 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/compiler.py
+-rw-rw-r--   0 root         (0)     1003     3356 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/concat.py
+-rw-rw-r--   0 root         (0)     1003    47517 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/scalar_op_compiler.py
+-rw-rw-r--   0 root         (0)     1003     7057 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/compile/single_column.py
+-rw-rw-r--   0 root         (0)     1003     1746 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/convert.py
+-rw-rw-r--   0 root         (0)     1003     2495 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/eval.py
+-rw-rw-r--   0 root         (0)     1003     6768 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/expression.py
+-rw-rw-r--   0 root         (0)     1003     1846 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/global_session.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.028991 bigframes-1.1.0/bigframes/core/groupby/
+-rw-rw-r--   0 root         (0)     1003    22543 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/groupby/__init__.py
+-rw-rw-r--   0 root         (0)     1003      716 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/guid.py
+-rw-rw-r--   0 root         (0)     1003    17649 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/indexers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.028991 bigframes-1.1.0/bigframes/core/indexes/
+-rw-rw-r--   0 root         (0)     1003      649 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/indexes/__init__.py
+-rw-rw-r--   0 root         (0)     1003    16107 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/indexes/base.py
+-rw-rw-r--   0 root         (0)     1003     1597 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/join_def.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.028991 bigframes-1.1.0/bigframes/core/joins/
+-rw-rw-r--   0 root         (0)     1003      770 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/joins/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2132 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/joins/merge.py
+-rw-rw-r--   0 root         (0)     1003     1883 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/joins/name_resolution.py
+-rw-rw-r--   0 root         (0)     1003     2218 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/local_data.py
+-rw-rw-r--   0 root         (0)     1003     2255 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/log_adapter.py
+-rw-rw-r--   0 root         (0)     1003    21172 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/nodes.py
+-rw-rw-r--   0 root         (0)     1003     9392 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/ordering.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.028991 bigframes-1.1.0/bigframes/core/reshape/
+-rw-rw-r--   0 root         (0)     1003     5965 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/reshape/__init__.py
+-rw-rw-r--   0 root         (0)     1003    10722 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/rewrite.py
+-rw-rw-r--   0 root         (0)     1003      746 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/scalar.py
+-rw-rw-r--   0 root         (0)     1003     2144 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/schema.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.032991 bigframes-1.1.0/bigframes/core/tools/
+-rw-rw-r--   0 root         (0)     1003      664 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/tools/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2515 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/tools/datetimes.py
+-rw-rw-r--   0 root         (0)     1003     3002 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/tree_properties.py
+-rw-rw-r--   0 root         (0)     1003     5483 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/utils.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.032991 bigframes-1.1.0/bigframes/core/window/
+-rw-rw-r--   0 root         (0)     1003     3075 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/window/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1286 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/core/window_spec.py
+-rw-rw-r--   0 root         (0)     1003   125145 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/dataframe.py
+-rw-rw-r--   0 root         (0)     1003    27294 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/dtypes.py
+-rw-rw-r--   0 root         (0)     1003     1273 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/features.py
+-rw-rw-r--   0 root         (0)     1003    11179 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/formatting_helpers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.032991 bigframes-1.1.0/bigframes/functions/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/functions/__init__.py
+-rw-rw-r--   0 root         (0)     1003    39370 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/functions/remote_function.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.036991 bigframes-1.1.0/bigframes/ml/
+-rw-rw-r--   0 root         (0)     1003      877 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/__init__.py
+-rw-rw-r--   0 root         (0)     1003     8532 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/base.py
+-rw-rw-r--   0 root         (0)     1003     6649 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/cluster.py
+-rw-rw-r--   0 root         (0)     1003     7984 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/compose.py
+-rw-rw-r--   0 root         (0)     1003    15995 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/core.py
+-rw-rw-r--   0 root         (0)     1003     6797 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/decomposition.py
+-rw-rw-r--   0 root         (0)     1003    24706 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/ensemble.py
+-rw-rw-r--   0 root         (0)     1003    15988 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/forecasting.py
+-rw-rw-r--   0 root         (0)     1003     1141 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/globals.py
+-rw-rw-r--   0 root         (0)     1003    10861 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/imported.py
+-rw-rw-r--   0 root         (0)     1003    13798 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/linear_model.py
+-rw-rw-r--   0 root         (0)     1003    27142 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/llm.py
+-rw-rw-r--   0 root         (0)     1003     4899 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/loader.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.036991 bigframes-1.1.0/bigframes/ml/metrics/
+-rw-rw-r--   0 root         (0)     1003     1066 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/metrics/__init__.py
+-rw-rw-r--   0 root         (0)     1003    11096 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/metrics/_metrics.py
+-rw-rw-r--   0 root         (0)     1003     2373 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/metrics/pairwise.py
+-rw-rw-r--   0 root         (0)     1003     3747 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/model_selection.py
+-rw-rw-r--   0 root         (0)     1003     5067 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/pipeline.py
+-rw-rw-r--   0 root         (0)     1003    22667 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/preprocessing.py
+-rw-rw-r--   0 root         (0)     1003     5754 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/remote.py
+-rw-rw-r--   0 root         (0)     1003    13312 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/sql.py
+-rw-rw-r--   0 root         (0)     1003     2403 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/ml/utils.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.040992 bigframes-1.1.0/bigframes/operations/
+-rw-rw-r--   0 root         (0)     1003    23014 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.040992 bigframes-1.1.0/bigframes/operations/_matplotlib/
+-rw-rw-r--   0 root         (0)     1003     1022 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/_matplotlib/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4477 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/_matplotlib/core.py
+-rw-rw-r--   0 root         (0)     1003     5970 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/_matplotlib/hist.py
+-rw-rw-r--   0 root         (0)     1003    10425 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/aggregations.py
+-rw-rw-r--   0 root         (0)     1003     8273 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/base.py
+-rw-rw-r--   0 root         (0)     1003     3079 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/datetimes.py
+-rw-rw-r--   0 root         (0)     1003     2814 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/plotting.py
+-rw-rw-r--   0 root         (0)     1003     8493 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/strings.py
+-rw-rw-r--   0 root         (0)     1003     1679 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/structs.py
+-rw-rw-r--   0 root         (0)     1003     7613 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/operations/type.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.040992 bigframes-1.1.0/bigframes/pandas/
+-rw-rw-r--   0 root         (0)     1003    23131 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/pandas/__init__.py
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/py.typed
+-rw-rw-r--   0 root         (0)     1003    60577 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/series.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.040992 bigframes-1.1.0/bigframes/session/
+-rw-rw-r--   0 root         (0)     1003    80945 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/session/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.040992 bigframes-1.1.0/bigframes/session/_io/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/session/_io/__init__.py
+-rw-rw-r--   0 root         (0)     1003     8040 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/session/_io/bigquery.py
+-rw-rw-r--   0 root         (0)     1003     4345 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/session/_io/pandas.py
+-rw-rw-r--   0 root         (0)     1003     8043 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/session/clients.py
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/typing.py
+-rw-rw-r--   0 root         (0)     1003      597 2024-04-04 23:02:01.000000 bigframes-1.1.0/bigframes/version.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.088995 bigframes-1.1.0/bigframes.egg-info/
+-rw-r--r--   0 root         (0)     1003     4650 2024-04-04 23:04:27.000000 bigframes-1.1.0/bigframes.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0)     1003    12217 2024-04-04 23:04:27.000000 bigframes-1.1.0/bigframes.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0)     1003        1 2024-04-04 23:04:27.000000 bigframes-1.1.0/bigframes.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0)     1003        1 2024-04-04 23:04:27.000000 bigframes-1.1.0/bigframes.egg-info/not-zip-safe
+-rw-r--r--   0 root         (0)     1003      732 2024-04-04 23:04:27.000000 bigframes-1.1.0/bigframes.egg-info/requires.txt
+-rw-r--r--   0 root         (0)     1003       29 2024-04-04 23:04:27.000000 bigframes-1.1.0/bigframes.egg-info/top_level.txt
+-rw-rw-r--   0 root         (0)     1003       81 2024-04-04 23:02:01.000000 bigframes-1.1.0/pyproject.toml
+-rw-rw-r--   0 root         (0)     1003       67 2024-04-04 23:04:28.092995 bigframes-1.1.0/setup.cfg
+-rw-rw-r--   0 root         (0)     1003     4428 2024-04-04 23:02:01.000000 bigframes-1.1.0/setup.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.040992 bigframes-1.1.0/tests/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1785 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/config.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.044992 bigframes-1.1.0/tests/data/
+-rw-rw-r--   0 root         (0)     1003      619 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/hockey_players.json
+-rw-rw-r--   0 root         (0)     1003     1250 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/hockey_players.jsonl
+-rw-rw-r--   0 root         (0)     1003      340 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/matrix_2by3.json
+-rw-rw-r--   0 root         (0)     1003       80 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/matrix_2by3.jsonl
+-rw-rw-r--   0 root         (0)     1003      421 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/matrix_3by4.json
+-rw-rw-r--   0 root         (0)     1003      154 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/matrix_3by4.jsonl
+-rw-rw-r--   0 root         (0)     1003    33350 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/nested.jsonl
+-rw-rw-r--   0 root         (0)     1003      966 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/nested_schema.json
+-rw-rw-r--   0 root         (0)     1003    58869 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/penguins.jsonl
+-rw-rw-r--   0 root         (0)     1003      636 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/penguins_schema.json
+-rw-rw-r--   0 root         (0)     1003     3909 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/scalars.jsonl
+-rw-rw-r--   0 root         (0)     1003     1458 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/scalars_schema.json
+-rw-rw-r--   0 root         (0)     1003    23424 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/time_series.jsonl
+-rw-rw-r--   0 root         (0)     1003      192 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/data/time_series_schema.json
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.044992 bigframes-1.1.0/tests/system/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/__init__.py
+-rw-rw-r--   0 root         (0)     1003    37000 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/conftest.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.048992 bigframes-1.1.0/tests/system/large/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.048992 bigframes-1.1.0/tests/system/large/ml/
+-rw-rw-r--   0 root         (0)     1003     5411 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_cluster.py
+-rw-rw-r--   0 root         (0)     1003     5391 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_compose.py
+-rw-rw-r--   0 root         (0)     1003     6401 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_core.py
+-rw-rw-r--   0 root         (0)     1003     6487 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_decomposition.py
+-rw-rw-r--   0 root         (0)     1003    14451 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_ensemble.py
+-rw-rw-r--   0 root         (0)     1003     4366 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_forecasting.py
+-rw-rw-r--   0 root         (0)     1003     8408 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_linear_model.py
+-rw-rw-r--   0 root         (0)     1003    30362 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/ml/test_pipeline.py
+-rw-rw-r--   0 root         (0)     1003     3871 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/test_location.py
+-rw-rw-r--   0 root         (0)     1003    49163 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/test_remote_function.py
+-rw-rw-r--   0 root         (0)     1003     1908 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/large/test_session.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.048992 bigframes-1.1.0/tests/system/load/
+-rw-rw-r--   0 root         (0)     1003     2664 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/load/test_large_tables.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.052992 bigframes-1.1.0/tests/system/small/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.056993 bigframes-1.1.0/tests/system/small/ml/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/__init__.py
+-rw-rw-r--   0 root         (0)     1003    11773 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/conftest.py
+-rw-rw-r--   0 root         (0)     1003     7074 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_cluster.py
+-rw-rw-r--   0 root         (0)     1003    13810 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_core.py
+-rw-rw-r--   0 root         (0)     1003     6764 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_decomposition.py
+-rw-rw-r--   0 root         (0)     1003    17015 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_ensemble.py
+-rw-rw-r--   0 root         (0)     1003     6859 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_forecasting.py
+-rw-rw-r--   0 root         (0)     1003     4983 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_imported.py
+-rw-rw-r--   0 root         (0)     1003     8788 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_linear_model.py
+-rw-rw-r--   0 root         (0)     1003    11541 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_llm.py
+-rw-rw-r--   0 root         (0)     1003    25138 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_metrics.py
+-rw-rw-r--   0 root         (0)     1003     2224 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_metrics_pairwise.py
+-rw-rw-r--   0 root         (0)     1003     6197 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_model_selection.py
+-rw-rw-r--   0 root         (0)     1003    27150 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_preprocessing.py
+-rw-rw-r--   0 root         (0)     1003     2570 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_register.py
+-rw-rw-r--   0 root         (0)     1003     1205 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/ml/test_remote.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.056993 bigframes-1.1.0/tests/system/small/operations/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/operations/__init__.py
+-rw-rw-r--   0 root         (0)     1003    10399 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/operations/test_datetimes.py
+-rw-rw-r--   0 root         (0)     1003    12557 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/operations/test_plotting.py
+-rw-rw-r--   0 root         (0)     1003    15770 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/operations/test_strings.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.056993 bigframes-1.1.0/tests/system/small/regression/
+-rw-rw-r--   0 root         (0)     1003     1999 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/regression/test_issue355_merge_after_filter.py
+-rw-rw-r--   0 root         (0)     1003   138484 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_dataframe.py
+-rw-rw-r--   0 root         (0)     1003    19620 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_dataframe_io.py
+-rw-rw-r--   0 root         (0)     1003    10210 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_encryption.py
+-rw-rw-r--   0 root         (0)     1003    12922 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_groupby.py
+-rw-rw-r--   0 root         (0)     1003     1558 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_ibis.py
+-rw-rw-r--   0 root         (0)     1003    13328 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_index.py
+-rw-rw-r--   0 root         (0)     1003     1205 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_ipython.py
+-rw-rw-r--   0 root         (0)     1003    41054 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_multiindex.py
+-rw-rw-r--   0 root         (0)     1003     4190 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_numpy.py
+-rw-rw-r--   0 root         (0)     1003    17980 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_pandas.py
+-rw-rw-r--   0 root         (0)     1003     9533 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_pandas_options.py
+-rw-rw-r--   0 root         (0)     1003     4562 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_progress_bar.py
+-rw-rw-r--   0 root         (0)     1003    25513 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_remote_function.py
+-rw-rw-r--   0 root         (0)     1003      913 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_scalar.py
+-rw-rw-r--   0 root         (0)     1003   107376 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_series.py
+-rw-rw-r--   0 root         (0)     1003    40409 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_session.py
+-rw-rw-r--   0 root         (0)     1003     3343 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/small/test_window.py
+-rw-rw-r--   0 root         (0)     1003    12113 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/system/utils.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.060993 bigframes-1.1.0/tests/unit/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.060993 bigframes-1.1.0/tests/unit/_config/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/_config/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2733 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/_config/test_bigquery_options.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.064993 bigframes-1.1.0/tests/unit/core/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/core/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1619 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/core/test_bf_utils.py
+-rw-rw-r--   0 root         (0)     1003     2966 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/core/test_blocks.py
+-rw-rw-r--   0 root         (0)     1003     1553 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/core/test_expression.py
+-rw-rw-r--   0 root         (0)     1003     1813 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/core/test_log_adapter.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.064993 bigframes-1.1.0/tests/unit/ml/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/ml/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2323 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/ml/test_api_primitives.py
+-rw-rw-r--   0 root         (0)     1003     6555 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/ml/test_compose.py
+-rw-rw-r--   0 root         (0)     1003     7426 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/ml/test_golden_sql.py
+-rw-rw-r--   0 root         (0)     1003     4058 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/ml/test_pipeline.py
+-rw-rw-r--   0 root         (0)     1003    13063 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/ml/test_sql.py
+-rw-rw-r--   0 root         (0)     1003     4842 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/resources.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.064993 bigframes-1.1.0/tests/unit/session/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/session/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4347 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/session/test_clients.py
+-rw-rw-r--   0 root         (0)     1003     7809 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/session/test_io_bigquery.py
+-rw-rw-r--   0 root         (0)     1003    18664 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/session/test_io_pandas.py
+-rw-rw-r--   0 root         (0)     1003     6619 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/session/test_session.py
+-rw-rw-r--   0 root         (0)     1003     1744 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_clients.py
+-rw-rw-r--   0 root         (0)     1003     1056 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_compute_options.py
+-rw-rw-r--   0 root         (0)     1003     6648 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_core.py
+-rw-rw-r--   0 root         (0)     1003     2136 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_dataframe.py
+-rw-rw-r--   0 root         (0)     1003     8819 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_dtypes.py
+-rw-rw-r--   0 root         (0)     1003     1577 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_features.py
+-rw-rw-r--   0 root         (0)     1003      528 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_formatting_helper.py
+-rw-rw-r--   0 root         (0)     1003     1655 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_formatting_helpers.py
+-rw-rw-r--   0 root         (0)     1003     4055 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_pandas.py
+-rw-rw-r--   0 root         (0)     1003     1207 2024-04-04 23:02:01.000000 bigframes-1.1.0/tests/unit/test_remote_function.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.008990 bigframes-1.1.0/third_party/
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.064993 bigframes-1.1.0/third_party/bigframes_vendored/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.064993 bigframes-1.1.0/third_party/bigframes_vendored/cpython/
+-rw-rw-r--   0 root         (0)     1003     2339 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/cpython/LICENSE
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/cpython/__init__.py
+-rw-rw-r--   0 root         (0)     1003    18853 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/cpython/_pprint.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/
+-rw-rw-r--   0 root         (0)     1003    11358 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003     5290 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/
+-rw-rw-r--   0 root         (0)     1003      574 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py
+-rw-rw-r--   0 root         (0)     1003    14045 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/ibis/
+-rw-rw-r--   0 root         (0)     1003    11358 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/LICENSE.txt
+-rw-rw-r--   0 root         (0)     1003    11663 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/README.md
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/
+-rw-rw-r--   0 root         (0)     1003      184 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2091 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py
+-rw-rw-r--   0 root         (0)     1003     6600 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py
+-rw-rw-r--   0 root         (0)     1003     1582 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.068993 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.072994 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/
+-rw-rw-r--   0 root         (0)     1003      464 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/__init__.py
+-rw-rw-r--   0 root         (0)     1003      536 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py
+-rw-rw-r--   0 root         (0)     1003      276 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/generic.py
+-rw-rw-r--   0 root         (0)     1003      263 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/json.py
+-rw-rw-r--   0 root         (0)     1003      690 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.072994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/
+-rw-rw-r--   0 root         (0)     1003     2284 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/AUTHORS.md
+-rw-rw-r--   0 root         (0)     1003     1634 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/LICENSE
+-rw-rw-r--   0 root         (0)     1003    10620 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/README.md
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.072994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/_config/
+-rw-rw-r--   0 root         (0)     1003     1347 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/_config/config.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.072994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.076994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.076994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2824 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py
+-rw-rw-r--   0 root         (0)     1003     3672 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py
+-rw-rw-r--   0 root         (0)     1003     2086 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/common.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.076994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/
+-rw-rw-r--   0 root         (0)     1003     6944 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/align.py
+-rw-rw-r--   0 root         (0)     1003     1543 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/common.py
+-rw-rw-r--   0 root         (0)     1003     2295 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/engines.py
+-rw-rw-r--   0 root         (0)     1003    12685 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/eval.py
+-rw-rw-r--   0 root         (0)     1003    25132 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/expr.py
+-rw-rw-r--   0 root         (0)     1003    16244 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/ops.py
+-rw-rw-r--   0 root         (0)     1003     6477 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/parsing.py
+-rw-rw-r--   0 root         (0)     1003    10303 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/computation/scope.py
+-rw-rw-r--   0 root         (0)     1003     4386 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/config_init.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.076994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/dtypes/
+-rw-rw-r--   0 root         (0)     1003      707 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/dtypes/inference.py
+-rw-rw-r--   0 root         (0)     1003   191651 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/frame.py
+-rw-rw-r--   0 root         (0)     1003    38558 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/generic.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.076994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/groupby/
+-rw-rw-r--   0 root         (0)     1003    12987 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.076994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexes/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexes/__init__.py
+-rw-rw-r--   0 root         (0)     1003     3129 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py
+-rw-rw-r--   0 root         (0)     1003    11448 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexes/base.py
+-rw-rw-r--   0 root         (0)     1003     2909 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexing.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.080994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4372 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py
+-rw-rw-r--   0 root         (0)     1003     3804 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py
+-rw-rw-r--   0 root         (0)     1003     3220 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py
+-rw-rw-r--   0 root         (0)     1003     5276 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py
+-rw-rw-r--   0 root         (0)     1003   109453 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/series.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.080994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/strings/
+-rw-rw-r--   0 root         (0)     1003    20170 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.080994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/tools/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/tools/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2858 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.080994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/window/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/window/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1350 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/window/rolling.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.080994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1269 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/common.py
+-rw-rw-r--   0 root         (0)     1003     6612 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/gbq.py
+-rw-rw-r--   0 root         (0)     1003     1428 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/parquet.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/parsers/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/parsers/__init__.py
+-rw-rw-r--   0 root         (0)     1003    10553 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py
+-rw-rw-r--   0 root         (0)     1003     3130 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/pickle.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/pandas/
+-rw-rw-r--   0 root         (0)     1003    12353 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/pandas/_typing.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/plotting/
+-rw-rw-r--   0 root         (0)     1003    11128 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/plotting/_core.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/pandas/util/
+-rw-rw-r--   0 root         (0)     1003      765 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/util/_exceptions.py
+-rw-rw-r--   0 root         (0)     1003     1573 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/pandas/util/_validators.py
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/py.typed
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/
+-rw-rw-r--   0 root         (0)     1003     1532 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/COPYING
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/__init__.py
+-rw-rw-r--   0 root         (0)     1003     6210 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/base.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/cluster/
+-rw-rw-r--   0 root         (0)     1003     5924 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/compose/
+-rw-rw-r--   0 root         (0)     1003     2014 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/decomposition/
+-rw-rw-r--   0 root         (0)     1003     5387 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/ensemble/
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/ensemble/__init__.py
+-rw-rw-r--   0 root         (0)     1003     8979 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.084994 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/linear_model/
+-rw-rw-r--   0 root         (0)     1003     5417 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py
+-rw-rw-r--   0 root         (0)     1003     4348 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.088995 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/
+-rw-rw-r--   0 root         (0)     1003     9779 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py
+-rw-rw-r--   0 root         (0)     1003     6347 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/_ranking.py
+-rw-rw-r--   0 root         (0)     1003     3550 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py
+-rw-rw-r--   0 root         (0)     1003     2121 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py
+-rw-rw-r--   0 root         (0)     1003     2973 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/pipeline.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.088995 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/
+-rw-rw-r--   0 root         (0)     1003     4980 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py
+-rw-rw-r--   0 root         (0)     1003     1523 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py
+-rw-rw-r--   0 root         (0)     1003     3753 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py
+-rw-rw-r--   0 root         (0)     1003     2085 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-04-04 23:04:28.088995 bigframes-1.1.0/third_party/bigframes_vendored/xgboost/
+-rw-rw-r--   0 root         (0)     1003    11348 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/xgboost/LICENSE
+-rw-rw-r--   0 root         (0)     1003        0 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/xgboost/__init__.py
+-rw-rw-r--   0 root         (0)     1003     6921 2024-04-04 23:02:01.000000 bigframes-1.1.0/third_party/bigframes_vendored/xgboost/sklearn.py
```

### Comparing `bigframes-1.0.0/LICENSE` & `bigframes-1.1.0/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/MANIFEST.in` & `bigframes-1.1.0/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/__init__.py` & `bigframes-1.1.0/bigframes/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/_config/__init__.py` & `bigframes-1.1.0/bigframes/_config/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/_config/bigquery_options.py` & `bigframes-1.1.0/bigframes/_config/bigquery_options.py`

 * *Files 10% similar despite different names*

```diff
@@ -52,43 +52,44 @@
         self._skip_bq_connection_check = skip_bq_connection_check
         self._session_started = False
 
     @property
     def application_name(self) -> Optional[str]:
         """The application name to amend to the user-agent sent to Google APIs.
 
-        Recommended format is ``"appplication-name/major.minor.patch_version"``
+        The application name to amend to the user agent sent to Google APIs.
+        The recommended format is  ``"application-name/major.minor.patch_version"``
         or ``"(gpn:PartnerName;)"`` for official Google partners.
         """
         return self._application_name
 
     @application_name.setter
     def application_name(self, value: Optional[str]):
         if self._session_started and self._application_name != value:
             raise ValueError(
                 SESSION_STARTED_MESSAGE.format(attribute="application_name")
             )
         self._application_name = value
 
     @property
     def credentials(self) -> Optional[google.auth.credentials.Credentials]:
-        """The OAuth2 Credentials to use for this client."""
+        """The OAuth2 credentials to use for this client."""
         return self._credentials
 
     @credentials.setter
     def credentials(self, value: Optional[google.auth.credentials.Credentials]):
         if self._session_started and self._credentials is not value:
             raise ValueError(SESSION_STARTED_MESSAGE.format(attribute="credentials"))
         self._credentials = value
 
     @property
     def location(self) -> Optional[str]:
         """Default location for job, datasets, and tables.
 
-        See: https://cloud.google.com/bigquery/docs/locations
+        For more information, see https://cloud.google.com/bigquery/docs/locations BigQuery locations.
         """
         return self._location
 
     @location.setter
     def location(self, value: Optional[str]):
         if self._session_started and self._location != value:
             raise ValueError(SESSION_STARTED_MESSAGE.format(attribute="location"))
@@ -103,21 +104,23 @@
     def project(self, value: Optional[str]):
         if self._session_started and self._project != value:
             raise ValueError(SESSION_STARTED_MESSAGE.format(attribute="project"))
         self._project = value
 
     @property
     def bq_connection(self) -> Optional[str]:
-        """Name of the BigQuery connection to use. Should be of the form
+        """Name of the BigQuery connection to use in the form
         <PROJECT_NUMBER/PROJECT_ID>.<LOCATION>.<CONNECTION_ID>.
 
-        You should either have the connection already created in the
-        <code>location</code> you have chosen, or you should have the Project IAM
-        Admin role to enable the service to create the connection for you if you
-        need it.
+        You either need to create the connection in a location of your choice, or
+        you need the Project Admin IAM role to enable the service to create the
+        connection for you.
+
+        If this option isn't available, or the project or location isn't provided,
+        then the default connection project/location/connection_id is used in the session.
 
         If this option isn't provided, or project or location aren't provided,
         session will use its default project/location/connection_id as default connection.
         """
         return self._bq_connection
 
     @bq_connection.setter
@@ -147,20 +150,20 @@
         self._skip_bq_connection_check = value
 
     @property
     def use_regional_endpoints(self) -> bool:
         """Flag to connect to regional API endpoints.
 
         .. deprecated:: 0.13.0
-            Use of regional endpoints is a feature in preview and
+            Use of regional endpoints is a feature in Preview and
             available only in selected regions and projects.
 
-        Requires ``location`` to also be set. For example, set
-        ``location='asia-northeast1'`` and ``use_regional_endpoints=True`` to
-        connect to asia-northeast1-bigquery.googleapis.com.
+        Requires that ``location`` is set. For example, to connect to
+        asia-northeast1-bigquery.googleapis.com, specify
+        ``location='asia-northeast1'`` and ``use_regional_endpoints=True``.
         """
         return self._use_regional_endpoints
 
     @use_regional_endpoints.setter
     def use_regional_endpoints(self, value: bool):
         if self._session_started and self._use_regional_endpoints != value:
             raise ValueError(
@@ -173,25 +176,30 @@
                 "available only in selected regions and projects. "
             )
 
         self._use_regional_endpoints = value
 
     @property
     def kms_key_name(self) -> Optional[str]:
-        """Customer managed encryption key used to control encryption of the
+        """
+        Customer-managed encryption key
+        used to control encryption of the data at rest in BigQuery. This key
+        takes the format projects/PROJECT_ID/locations/LOCATION/keyRings/KEYRING/cryptoKeys/KEY
+
+        Customer managed encryption key used to control encryption of the
         data-at-rest in BigQuery. This is of the format
         projects/PROJECT_ID/locations/LOCATION/keyRings/KEYRING/cryptoKeys/KEY
 
-        See https://cloud.google.com/bigquery/docs/customer-managed-encryption
-        for more details.
+        For more information, see https://cloud.google.com/bigquery/docs/customer-managed-encryption
+        Customer-managed Cloud KMS keys
 
-        Please make sure the project used for Bigquery DataFrames has "Cloud KMS
-        CryptoKey Encrypter/Decrypter" role in the key's project, See
-        https://cloud.google.com/bigquery/docs/customer-managed-encryption#assign_role
-        for steps on how to ensure that.
+        Make sure the project used for Bigquery DataFrames has the
+        Cloud KMS CryptoKey Encrypter/Decrypter IAM role in the key's project.
+        For more information, see https://cloud.google.com/bigquery/docs/customer-managed-encryption#assign_role
+        Assign the Encrypter/Decrypter.
         """
         return self._kms_key_name
 
     @kms_key_name.setter
     def kms_key_name(self, value: str):
         if self._session_started and self._kms_key_name != value:
             raise ValueError(SESSION_STARTED_MESSAGE.format(attribute="kms_key_name"))
```

### Comparing `bigframes-1.0.0/bigframes/_config/compute_options.py` & `bigframes-1.1.0/bigframes/_config/compute_options.py`

 * *Files 16% similar despite different names*

```diff
@@ -36,11 +36,15 @@
 
     Attributes:
         maximum_bytes_billed (int, Options):
             Limits the bytes billed for query jobs. Queries that will have
             bytes billed beyond this limit will fail (without incurring a
             charge). If unspecified, this will be set to your project default.
             See `maximum_bytes_billed <https://cloud.google.com/python/docs/reference/bigquery/latest/google.cloud.bigquery.job.QueryJobConfig#google_cloud_bigquery_job_QueryJobConfig_maximum_bytes_billed>`_.
-
+        enable_multi_query_execution (bool, Options):
+            If enabled, large queries may be factored into multiple smaller queries
+            in order to avoid generating queries that are too complex for the query
+            engine to handle. However this comes at the cost of increase cost and latency.
     """
 
     maximum_bytes_billed: Optional[int] = None
+    enable_multi_query_execution: bool = False
```

### Comparing `bigframes-1.0.0/bigframes/_config/display_options.py` & `bigframes-1.1.0/bigframes/_config/display_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/_config/sampling_options.py` & `bigframes-1.1.0/bigframes/_config/sampling_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/clients.py` & `bigframes-1.1.0/bigframes/clients.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/constants.py` & `bigframes-1.1.0/bigframes/constants.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/__init__.py` & `bigframes-1.1.0/bigframes/core/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -225,14 +225,18 @@
 
     def assign_constant(
         self,
         destination_id: str,
         value: typing.Any,
         dtype: typing.Optional[bigframes.dtypes.Dtype],
     ) -> ArrayValue:
+        if pandas.isna(value):
+            # Need to assign a data type when value is NaN.
+            dtype = dtype or bigframes.dtypes.DEFAULT_DTYPE
+
         if destination_id in self.column_ids:  # Mutate case
             exprs = [
                 (
                     (
                         ex.const(value, dtype)
                         if (col_id == destination_id)
                         else ex.free_var(col_id)
@@ -393,14 +397,23 @@
             join=join_def,
             allow_row_identity_join=allow_row_identity_join,
         )
         if allow_row_identity_join:
             return ArrayValue(bigframes.core.rewrite.maybe_rewrite_join(join_node))
         return ArrayValue(join_node)
 
+    def explode(self, column_ids: typing.Sequence[str]) -> ArrayValue:
+        assert len(column_ids) > 0
+        for column_id in column_ids:
+            assert bigframes.dtypes.is_array_like(self.get_column_type(column_id))
+
+        return ArrayValue(
+            nodes.ExplodeNode(child=self.node, column_ids=tuple(column_ids))
+        )
+
     def _uniform_sampling(self, fraction: float) -> ArrayValue:
         """Sampling the table on given fraction.
 
         .. warning::
             The row numbers of result is non-deterministic, avoid to use.
         """
         return ArrayValue(nodes.RandomSampleNode(self.node, fraction))
```

### Comparing `bigframes-1.0.0/bigframes/core/block_transforms.py` & `bigframes-1.1.0/bigframes/core/block_transforms.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/blocks.py` & `bigframes-1.1.0/bigframes/core/blocks.py`

 * *Files 0% similar despite different names*

```diff
@@ -37,14 +37,15 @@
 import bigframes.constants as constants
 import bigframes.core as core
 import bigframes.core.expression as ex
 import bigframes.core.expression as scalars
 import bigframes.core.guid as guid
 import bigframes.core.join_def as join_defs
 import bigframes.core.ordering as ordering
+import bigframes.core.tree_properties as tree_properties
 import bigframes.core.utils
 import bigframes.core.utils as utils
 import bigframes.dtypes
 import bigframes.operations as ops
 import bigframes.operations.aggregations as agg_ops
 import bigframes.session._io.pandas
 
@@ -439,16 +440,18 @@
             materialize_options=MaterializationOptions(
                 downsampling=sampling, ordered=ordered
             )
         )
         df.set_axis(self.column_labels, axis=1, copy=False)
         return df, query_job
 
-    def try_peek(self, n: int = 20) -> typing.Optional[pd.DataFrame]:
-        if self.expr.node.peekable:
+    def try_peek(
+        self, n: int = 20, force: bool = False
+    ) -> typing.Optional[pd.DataFrame]:
+        if force or tree_properties.peekable(self.expr.node):
             iterator, _ = self.session._peek(self.expr, n)
             df = self._to_dataframe(iterator)
             self._copy_index_to_pandas(df)
             return df
         else:
             return None
 
@@ -1155,14 +1158,44 @@
         return Block(
             expr,
             column_labels=self.column_labels,
             index_columns=index_col_ids,
             index_labels=self.column_labels.names,
         )
 
+    def explode(
+        self,
+        column_ids: typing.Sequence[str],
+        ignore_index: Optional[bool],
+    ) -> Block:
+        column_ids = [
+            column_id
+            for column_id in column_ids
+            if bigframes.dtypes.is_array_like(self.expr.get_column_type(column_id))
+        ]
+        if len(column_ids) == 0:
+            expr = self.expr
+        else:
+            expr = self.expr.explode(column_ids)
+
+        if ignore_index:
+            return Block(
+                expr.drop_columns(self.index_columns),
+                column_labels=self.column_labels,
+                # Initiates default index creation using the block constructor.
+                index_columns=[],
+            )
+        else:
+            return Block(
+                expr,
+                column_labels=self.column_labels,
+                index_columns=self.index_columns,
+                index_labels=self.column_labels.names,
+            )
+
     def _standard_stats(self, column_id) -> typing.Sequence[agg_ops.UnaryAggregateOp]:
         """
         Gets a standard set of stats to preemptively fetch for a column if
         any other stat is fetched.
         Helps prevent repeat scanning of the same column to fetch statistics.
         Standard stats should be:
             - commonly used
@@ -1307,16 +1340,16 @@
         count = self.shape[0]
         if count > max_results:
             head_block = self.slice(0, max_results)
         else:
             head_block = self
         computed_df, query_job = head_block.to_pandas()
         formatted_df = computed_df.set_axis(self.column_labels, axis=1)
-        # we reset the axis and substitute the bf index name for the default
-        formatted_df.index.name = self.index.name
+        # we reset the axis and substitute the bf index name(s) for the default
+        formatted_df.index.names = self.index.names  # type: ignore
         return formatted_df, count, query_job
 
     def promote_offsets(self, label: Label = None) -> typing.Tuple[Block, str]:
         result_id = guid.generate_guid()
         expr = self._expr.promote_offsets(result_id)
         return (
             Block(
@@ -1836,14 +1869,18 @@
             return self
         if optimize_offsets:
             expr = self.session._cache_with_offsets(self.expr)
         else:
             expr = self.session._cache_with_cluster_cols(
                 self.expr, cluster_cols=self.index_columns
             )
+        return self.swap_array_expr(expr)
+
+    def swap_array_expr(self, expr: core.ArrayValue) -> Block:
+        # TODO: Validate schema unchanged
         return Block(
             expr,
             index_columns=self.index_columns,
             column_labels=self.column_labels,
             index_labels=self.index.names,
         )
```

### Comparing `bigframes-1.0.0/bigframes/core/compile/__init__.py` & `bigframes-1.1.0/bigframes/core/compile/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/compile/aggregate_compiler.py` & `bigframes-1.1.0/bigframes/core/compile/aggregate_compiler.py`

 * *Files 0% similar despite different names*

```diff
@@ -186,15 +186,15 @@
     any_zeroes = _apply_window_if_present(is_zero.any(), window)
     float_result = (
         ibis.case()
         .when(any_zeroes, ibis_types.literal(0))
         .else_(magnitude * pow(-1, negative_count_parity))
         .end()
     )
-    return float_result.cast(column.type())  # type: ignore
+    return float_result
 
 
 @compile_unary_agg.register
 def _(op: agg_ops.MaxOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
     return _apply_window_if_present(column.max(), window)
```

### Comparing `bigframes-1.0.0/bigframes/core/compile/compiled.py` & `bigframes-1.1.0/bigframes/core/compile/compiled.py`

 * *Files 3% similar despite different names*

```diff
@@ -16,14 +16,15 @@
 import abc
 import functools
 import itertools
 import textwrap
 import typing
 from typing import Collection, Iterable, Literal, Optional, Sequence
 
+import bigframes_vendored.ibis.expr.operations as vendored_ibis_ops
 import ibis
 import ibis.backends.bigquery as ibis_bigquery
 import ibis.common.deferred  # type: ignore
 import ibis.expr.datatypes as ibis_dtypes
 import ibis.expr.types as ibis_types
 import pandas
 
@@ -498,14 +499,59 @@
         table = self._to_ibis_expr(fraction=fraction)
         columns = [table[column_name] for column_name in self._column_names]
         return UnorderedIR(
             table,
             columns=columns,
         )
 
+    def explode(self, column_ids: typing.Sequence[str]) -> UnorderedIR:
+        table = self._to_ibis_expr()
+
+        # The offset array ensures null represents empty arrays after unnesting.
+        offset_array_id = bigframes.core.guid.generate_guid("offset_array_")
+        offset_array = (
+            vendored_ibis_ops.GenerateArray(
+                ibis.greatest(
+                    0,
+                    ibis.least(
+                        *[table[column_id].length() - 1 for column_id in column_ids]
+                    ),
+                )
+            )
+            .to_expr()
+            .name(offset_array_id),
+        )
+        table_w_offset_array = table.select(
+            offset_array,
+            *self._column_names,
+        )
+
+        unnest_offset_id = bigframes.core.guid.generate_guid("unnest_offset_")
+        unnest_offset = (
+            table_w_offset_array[offset_array_id].unnest().name(unnest_offset_id)
+        )
+        table_w_offset = table_w_offset_array.select(
+            unnest_offset,
+            *self._column_names,
+        )
+
+        unnested_columns = [
+            table_w_offset[column_id][table_w_offset[unnest_offset_id]].name(column_id)
+            if column_id in column_ids
+            else table_w_offset[column_id]
+            for column_id in self._column_names
+        ]
+        table_w_unnest = table_w_offset.select(*unnested_columns)
+
+        columns = [table_w_unnest[column_name] for column_name in self._column_names]
+        return UnorderedIR(
+            table_w_unnest,
+            columns=columns,
+        )
+
     ## Helpers
     def _set_or_replace_by_id(
         self, id: str, new_value: ibis_types.Value
     ) -> UnorderedIR:
         builder = self.builder()
         if id in self.column_ids:
             builder.columns = [
@@ -715,14 +761,86 @@
         return OrderedIR(
             table,
             columns=columns,
             hidden_ordering_columns=hidden_ordering_columns,
             ordering=self._ordering,
         )
 
+    def explode(self, column_ids: typing.Sequence[str]) -> OrderedIR:
+        table = self._to_ibis_expr(ordering_mode="unordered", expose_hidden_cols=True)
+
+        offset_array_id = bigframes.core.guid.generate_guid("offset_array_")
+        offset_array = (
+            vendored_ibis_ops.GenerateArray(
+                ibis.greatest(
+                    0,
+                    ibis.least(
+                        *[table[column_id].length() - 1 for column_id in column_ids]
+                    ),
+                )
+            )
+            .to_expr()
+            .name(offset_array_id),
+        )
+        table_w_offset_array = table.select(
+            offset_array,
+            *self._column_names,
+            *self._hidden_ordering_column_names,
+        )
+
+        unnest_offset_id = bigframes.core.guid.generate_guid("unnest_offset_")
+        unnest_offset = (
+            table_w_offset_array[offset_array_id].unnest().name(unnest_offset_id)
+        )
+        table_w_offset = table_w_offset_array.select(
+            unnest_offset,
+            *self._column_names,
+            *self._hidden_ordering_column_names,
+        )
+
+        unnested_columns = [
+            table_w_offset[column_id][table_w_offset[unnest_offset_id]].name(column_id)
+            if column_id in column_ids
+            else table_w_offset[column_id]
+            for column_id in self._column_names
+        ]
+
+        table_w_unnest = table_w_offset.select(
+            table_w_offset[unnest_offset_id],
+            *unnested_columns,
+            *self._hidden_ordering_column_names,
+        )
+
+        columns = [table_w_unnest[column_name] for column_name in self._column_names]
+        hidden_ordering_columns = [
+            *[
+                table_w_unnest[column_name]
+                for column_name in self._hidden_ordering_column_names
+            ],
+            table_w_unnest[unnest_offset_id],
+        ]
+        ordering = ExpressionOrdering(
+            ordering_value_columns=tuple(
+                [
+                    *self._ordering.ordering_value_columns,
+                    ascending_over(unnest_offset_id),
+                ]
+            ),
+            total_ordering_columns=frozenset(
+                [*self._ordering.total_ordering_columns, unnest_offset_id]
+            ),
+        )
+
+        return OrderedIR(
+            table_w_unnest,
+            columns=columns,
+            hidden_ordering_columns=hidden_ordering_columns,
+            ordering=ordering,
+        )
+
     def promote_offsets(self, col_id: str) -> OrderedIR:
         """
         Convenience function to promote copy of column offsets to a value column. Can be used to reset index.
         """
         # Special case: offsets already exist
         ordering = self._ordering
```

### Comparing `bigframes-1.0.0/bigframes/core/compile/compiler.py` & `bigframes-1.1.0/bigframes/core/compile/compiler.py`

 * *Files 1% similar despite different names*

```diff
@@ -188,9 +188,14 @@
         index_col_ids=node.index_col_ids,
         dtype=node.dtype,
         how=node.how,
     )
 
 
 @_compile_node.register
+def compiler_explode(node: nodes.ExplodeNode, ordered: bool = True):
+    return compile_node(node.child, ordered).explode(node.column_ids)
+
+
+@_compile_node.register
 def compiler_random_sample(node: nodes.RandomSampleNode, ordered: bool = True):
     return compile_node(node.child, ordered)._uniform_sampling(node.fraction)
```

### Comparing `bigframes-1.0.0/bigframes/core/compile/concat.py` & `bigframes-1.1.0/bigframes/core/compile/concat.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/compile/scalar_op_compiler.py` & `bigframes-1.1.0/bigframes/core/compile/scalar_op_compiler.py`

 * *Files 1% similar despite different names*

```diff
@@ -253,14 +253,21 @@
 
 
 @scalar_op_compiler.register_unary_op(ops.arctan_op)
 def arctan_op_impl(x: ibis_types.Value):
     return typing.cast(ibis_types.NumericValue, x).atan()
 
 
+@scalar_op_compiler.register_binary_op(ops.arctan2_op)
+def arctan2_op_impl(x: ibis_types.Value, y: ibis_types.Value):
+    return typing.cast(ibis_types.NumericValue, x).atan2(
+        typing.cast(ibis_types.NumericValue, y)
+    )
+
+
 # Hyperbolic trig functions
 # BQ has these functions, but Ibis doesn't
 @scalar_op_compiler.register_unary_op(ops.sinh_op)
 def sinh_op_impl(x: ibis_types.Value):
     numeric_value = typing.cast(ibis_types.NumericValue, x)
     sinh_result = (numeric_value.exp() - (numeric_value.negate()).exp()) / _ibis_num(2)
     domain = numeric_value.abs() < _FLOAT64_EXP_BOUND
@@ -315,14 +322,38 @@
         _INF * numeric_value, _NAN
     )
 
     return (~domain).ifelse(out_of_domain, atanh_result)
 
 
 # Numeric Ops
+@scalar_op_compiler.register_unary_op(ops.floor_op)
+def floor_op_impl(x: ibis_types.Value):
+    x_numeric = typing.cast(ibis_types.NumericValue, x)
+    if x_numeric.type().is_integer():
+        return x_numeric.cast(ibis_dtypes.Float64())
+    if x_numeric.type().is_floating():
+        # Default ibis impl tries to cast to integer, which doesn't match pandas and can overflow
+        return float_floor(x_numeric)
+    else:  # numeric
+        return x_numeric.floor()
+
+
+@scalar_op_compiler.register_unary_op(ops.ceil_op)
+def ceil_op_impl(x: ibis_types.Value):
+    x_numeric = typing.cast(ibis_types.NumericValue, x)
+    if x_numeric.type().is_integer():
+        return x_numeric.cast(ibis_dtypes.Float64())
+    if x_numeric.type().is_floating():
+        # Default ibis impl tries to cast to integer, which doesn't match pandas and can overflow
+        return float_ceil(x_numeric)
+    else:  # numeric
+        return x_numeric.ceil()
+
+
 @scalar_op_compiler.register_unary_op(ops.abs_op)
 def abs_op_impl(x: ibis_types.Value):
     return typing.cast(ibis_types.NumericValue, x).abs()
 
 
 @scalar_op_compiler.register_unary_op(ops.sqrt_op)
 def sqrt_op_impl(x: ibis_types.Value):
@@ -343,21 +374,31 @@
 def ln_op_impl(x: ibis_types.Value):
     numeric_value = typing.cast(ibis_types.NumericValue, x)
     domain = numeric_value > _ZERO
     out_of_domain = (numeric_value == _ZERO).ifelse(_NEG_INF, _NAN)
     return (~domain).ifelse(out_of_domain, numeric_value.ln())
 
 
+@scalar_op_compiler.register_unary_op(ops.log1p_op)
+def log1p_op_impl(x: ibis_types.Value):
+    return ln_op_impl(_ibis_num(1) + x)
+
+
 @scalar_op_compiler.register_unary_op(ops.exp_op)
 def exp_op_impl(x: ibis_types.Value):
     numeric_value = typing.cast(ibis_types.NumericValue, x)
     domain = numeric_value < _FLOAT64_EXP_BOUND
     return (~domain).ifelse(_INF, numeric_value.exp())
 
 
+@scalar_op_compiler.register_unary_op(ops.expm1_op)
+def expm1_op_impl(x: ibis_types.Value):
+    return exp_op_impl(x) - _ibis_num(1)
+
+
 @scalar_op_compiler.register_unary_op(ops.invert_op)
 def invert_op_impl(x: ibis_types.Value):
     return typing.cast(ibis_types.NumericValue, x).negate()
 
 
 ## String Operation
 @scalar_op_compiler.register_unary_op(ops.len_op)
@@ -1314,7 +1355,20 @@
 def _ibis_num(number: float):
     return typing.cast(ibis_types.NumericValue, ibis_types.literal(number))
 
 
 @ibis.udf.scalar.builtin
 def timestamp(a: str) -> ibis_dtypes.timestamp:
     """Convert string to timestamp."""
+
+
+# Need these because ibis otherwise tries to do casts to int that can fail
+@ibis.udf.scalar.builtin(name="floor")
+def float_floor(a: float) -> float:
+    """Convert string to timestamp."""
+    return 0  # pragma: NO COVER
+
+
+@ibis.udf.scalar.builtin(name="ceil")
+def float_ceil(a: float) -> float:
+    """Convert string to timestamp."""
+    return 0  # pragma: NO COVER
```

### Comparing `bigframes-1.0.0/bigframes/core/compile/single_column.py` & `bigframes-1.1.0/bigframes/core/compile/single_column.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/expression.py` & `bigframes-1.1.0/bigframes/core/expression.py`

 * *Files 2% similar despite different names*

```diff
@@ -104,14 +104,19 @@
         """Replace all variables with expression given in `bindings`."""
         ...
 
     @property
     def is_bijective(self) -> bool:
         return False
 
+    @property
+    def is_identity(self) -> bool:
+        """True for identity operation that does not transform input."""
+        return False
+
 
 @dataclasses.dataclass(frozen=True)
 class ScalarConstantExpression(Expression):
     """An expression representing a scalar constant."""
 
     # TODO: Further constrain?
     value: typing.Hashable
@@ -169,14 +174,18 @@
         else:
             raise ValueError(f"Variable {self.id} remains unbound")
 
     @property
     def is_bijective(self) -> bool:
         return True
 
+    @property
+    def is_identity(self) -> bool:
+        return True
+
 
 @dataclasses.dataclass(frozen=True)
 class OpExpression(Expression):
     """An expression representing a scalar operation applied to 1 or more argument sub-expressions."""
 
     op: bigframes.operations.RowOp
     inputs: typing.Tuple[Expression, ...]
```

### Comparing `bigframes-1.0.0/bigframes/core/global_session.py` & `bigframes-1.1.0/bigframes/core/global_session.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/groupby/__init__.py` & `bigframes-1.1.0/bigframes/core/groupby/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/guid.py` & `bigframes-1.1.0/bigframes/core/guid.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/indexers.py` & `bigframes-1.1.0/bigframes/core/indexers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/indexes/__init__.py` & `bigframes-1.1.0/bigframes/core/indexes/__init__.py`

 * *Files 4% similar despite different names*

```diff
@@ -8,12 +8,12 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-from bigframes.core.indexes.index import Index
+from bigframes.core.indexes.base import Index
 
 __all__ = [
     "Index",
 ]
```

### Comparing `bigframes-1.0.0/bigframes/core/indexes/index.py` & `bigframes-1.1.0/bigframes/core/indexes/base.py`

 * *Files 1% similar despite different names*

```diff
@@ -84,15 +84,20 @@
     def from_frame(
         cls, frame: Union[bigframes.series.Series, bigframes.dataframe.DataFrame]
     ) -> Index:
         return FrameIndex(frame)
 
     @property
     def name(self) -> blocks.Label:
-        return self.names[0]
+        names = self.names
+        if len(names) == 1:
+            return self.names[0]
+        else:
+            # pandas returns None for MultiIndex.name.
+            return None
 
     @name.setter
     def name(self, value: blocks.Label):
         self.names = [value]
 
     @property
     def names(self) -> typing.Sequence[blocks.Label]:
@@ -457,22 +462,14 @@
             bigframes.series.Series, bigframes.dataframe.DataFrame
         ],
     ):
         super().__init__(series_or_dataframe._block)
         self._whole_frame = series_or_dataframe
 
     @property
-    def name(self) -> blocks.Label:
-        return self.names[0]
-
-    @name.setter
-    def name(self, value: blocks.Label):
-        self.names = [value]
-
-    @property
     def names(self) -> typing.Sequence[blocks.Label]:
         """Returns the names of the Index."""
         return self._block._index_labels
 
     @names.setter
     def names(self, values: typing.Sequence[blocks.Label]):
         new_block = self._whole_frame._get_block().with_index_labels(values)
```

### Comparing `bigframes-1.0.0/bigframes/core/join_def.py` & `bigframes-1.1.0/bigframes/core/join_def.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/joins/__init__.py` & `bigframes-1.1.0/bigframes/core/joins/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/joins/merge.py` & `bigframes-1.1.0/bigframes/core/joins/merge.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/joins/name_resolution.py` & `bigframes-1.1.0/bigframes/core/joins/name_resolution.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/local_data.py` & `bigframes-1.1.0/bigframes/core/local_data.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/log_adapter.py` & `bigframes-1.1.0/bigframes/core/log_adapter.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/nodes.py` & `bigframes-1.1.0/bigframes/core/nodes.py`

 * *Files 21% similar despite different names*

```diff
@@ -11,19 +11,19 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 from __future__ import annotations
 
 import abc
-from dataclasses import dataclass, field, fields
+from dataclasses import dataclass, field, fields, replace
 import functools
 import itertools
 import typing
-from typing import Tuple
+from typing import Callable, Tuple
 
 import pandas
 
 import bigframes.core.expression as ex
 import bigframes.core.guid
 from bigframes.core.join_def import JoinColumnMapping, JoinDefinition, JoinSide
 from bigframes.core.ordering import OrderingExpression
@@ -35,14 +35,18 @@
 if typing.TYPE_CHECKING:
     import ibis.expr.types as ibis_types
 
     import bigframes.core.ordering as orderings
     import bigframes.session
 
 
+# A fixed number of variable to assume for overhead on some operations
+OVERHEAD_VARIABLES = 5
+
+
 @dataclass(frozen=True)
 class BigFrameNode:
     """
     Immutable node for representing 2D typed array as a tree of operators.
 
     All subclasses must be hashable so as to be usable as caching key.
     """
@@ -87,43 +91,97 @@
     # Each subclass of BigFrameNode should use this property to implement __hash__
     # The default dataclass-generated __hash__ method is not cached
     @functools.cached_property
     def _node_hash(self):
         return hash(tuple(hash(getattr(self, field.name)) for field in fields(self)))
 
     @property
-    def peekable(self) -> bool:
-        """Indicates whether the node can be sampled efficiently"""
-        return all(child.peekable for child in self.child_nodes)
-
-    @property
     def roots(self) -> typing.Set[BigFrameNode]:
         roots = itertools.chain.from_iterable(
             map(lambda child: child.roots, self.child_nodes)
         )
         return set(roots)
 
     @property
     @abc.abstractmethod
     def schema(self) -> schemata.ArraySchema:
         ...
 
+    @property
+    @abc.abstractmethod
+    def variables_introduced(self) -> int:
+        """
+        Defines number of values created by the current node. Helps represent the "width" of a query
+        """
+        ...
+
+    @property
+    def relation_ops_created(self) -> int:
+        """
+        Defines the number of relational ops generated by the current node. Used to estimate query planning complexity.
+        """
+        return 1
+
+    @property
+    def joins(self) -> bool:
+        """
+        Defines whether the node joins data.
+        """
+        return False
+
+    @functools.cached_property
+    def total_variables(self) -> int:
+        return self.variables_introduced + sum(
+            map(lambda x: x.total_variables, self.child_nodes)
+        )
+
+    @functools.cached_property
+    def total_relational_ops(self) -> int:
+        return self.relation_ops_created + sum(
+            map(lambda x: x.total_relational_ops, self.child_nodes)
+        )
+
+    @functools.cached_property
+    def total_joins(self) -> int:
+        return int(self.joins) + sum(map(lambda x: x.total_joins, self.child_nodes))
+
+    @property
+    def planning_complexity(self) -> int:
+        """
+        Empirical heuristic measure of planning complexity.
+
+        Used to determine when to decompose overly complex computations. May require tuning.
+        """
+        return self.total_variables * self.total_relational_ops * (1 + self.total_joins)
+
+    @abc.abstractmethod
+    def transform_children(
+        self, t: Callable[[BigFrameNode], BigFrameNode]
+    ) -> BigFrameNode:
+        """Apply a function to each child node."""
+        ...
+
 
 @dataclass(frozen=True)
 class UnaryNode(BigFrameNode):
     child: BigFrameNode
 
     @property
     def child_nodes(self) -> typing.Sequence[BigFrameNode]:
         return (self.child,)
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         return self.child.schema
 
+    def transform_children(
+        self, t: Callable[[BigFrameNode], BigFrameNode]
+    ) -> BigFrameNode:
+        return replace(self, child=t(self.child))
+
 
 @dataclass(frozen=True)
 class JoinNode(BigFrameNode):
     left_child: BigFrameNode
     right_child: BigFrameNode
     join: JoinDefinition
     allow_row_identity_join: bool = False
@@ -139,20 +197,14 @@
     @property
     def child_nodes(self) -> typing.Sequence[BigFrameNode]:
         return (self.left_child, self.right_child)
 
     def __hash__(self):
         return self._node_hash
 
-    @property
-    def peekable(self) -> bool:
-        children_peekable = all(child.peekable for child in self.child_nodes)
-        single_root = len(self.roots) == 1
-        return children_peekable and single_root
-
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         def join_mapping_to_schema_item(mapping: JoinColumnMapping):
             result_id = mapping.destination_id
             result_dtype = (
                 self.left_child.schema.get_type(mapping.source_id)
                 if mapping.source_table == JoinSide.LEFT
@@ -161,14 +213,30 @@
             return schemata.SchemaItem(result_id, result_dtype)
 
         items = tuple(
             join_mapping_to_schema_item(mapping) for mapping in self.join.mappings
         )
         return schemata.ArraySchema(items)
 
+    @functools.cached_property
+    def variables_introduced(self) -> int:
+        """Defines the number of variables generated by the current node. Used to estimate query planning complexity."""
+        return OVERHEAD_VARIABLES
+
+    @property
+    def joins(self) -> bool:
+        return True
+
+    def transform_children(
+        self, t: Callable[[BigFrameNode], BigFrameNode]
+    ) -> BigFrameNode:
+        return replace(
+            self, left_child=t(self.left_child), right_child=t(self.right_child)
+        )
+
 
 @dataclass(frozen=True)
 class ConcatNode(BigFrameNode):
     children: Tuple[BigFrameNode, ...]
 
     def __post_init__(self):
         if len(self.children) == 0:
@@ -189,37 +257,53 @@
         # TODO: Output names should probably be aligned beforehand or be part of concat definition
         items = tuple(
             schemata.SchemaItem(f"column_{i}", dtype)
             for i, dtype in enumerate(self.children[0].schema.dtypes)
         )
         return schemata.ArraySchema(items)
 
+    @functools.cached_property
+    def variables_introduced(self) -> int:
+        """Defines the number of variables generated by the current node. Used to estimate query planning complexity."""
+        return len(self.schema.items) + OVERHEAD_VARIABLES
+
+    def transform_children(
+        self, t: Callable[[BigFrameNode], BigFrameNode]
+    ) -> BigFrameNode:
+        return replace(self, children=tuple(t(child) for child in self.children))
+
 
 # Input Nodex
 @dataclass(frozen=True)
 class ReadLocalNode(BigFrameNode):
     feather_bytes: bytes
     data_schema: schemata.ArraySchema
     session: typing.Optional[bigframes.session.Session] = None
 
     def __hash__(self):
         return self._node_hash
 
     @property
-    def peekable(self) -> bool:
-        return True
-
-    @property
     def roots(self) -> typing.Set[BigFrameNode]:
         return {self}
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         return self.data_schema
 
+    @functools.cached_property
+    def variables_introduced(self) -> int:
+        """Defines the number of variables generated by the current node. Used to estimate query planning complexity."""
+        return len(self.schema.items) + 1
+
+    def transform_children(
+        self, t: Callable[[BigFrameNode], BigFrameNode]
+    ) -> BigFrameNode:
+        return self
+
 
 # TODO: Refactor to take raw gbq object reference
 @dataclass(frozen=True)
 class ReadGbqNode(BigFrameNode):
     table: ibis_types.Table = field()
     table_session: bigframes.session.Session = field()
     columns: Tuple[ibis_types.Value, ...] = field()
@@ -230,67 +314,85 @@
     def session(self):
         return self.table_session
 
     def __hash__(self):
         return self._node_hash
 
     @property
-    def peekable(self) -> bool:
-        return True
-
-    @property
     def roots(self) -> typing.Set[BigFrameNode]:
         return {self}
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         items = tuple(
             schemata.SchemaItem(
                 value.get_name(),
                 bigframes.dtypes.ibis_dtype_to_bigframes_dtype(value.type()),
             )
             for value in self.columns
         )
         return schemata.ArraySchema(items)
 
+    @functools.cached_property
+    def variables_introduced(self) -> int:
+        return len(self.columns) + len(self.hidden_ordering_columns)
+
+    @property
+    def relation_ops_created(self) -> int:
+        # Assume worst case, where readgbq actually has baked in analytic operation to generate index
+        return 2
+
+    def transform_children(
+        self, t: Callable[[BigFrameNode], BigFrameNode]
+    ) -> BigFrameNode:
+        return self
+
 
 # Unary nodes
 @dataclass(frozen=True)
 class PromoteOffsetsNode(UnaryNode):
     col_id: str
 
     def __hash__(self):
         return self._node_hash
 
     @property
-    def peekable(self) -> bool:
-        return False
-
-    @property
     def non_local(self) -> bool:
-        return False
+        return True
 
     @property
     def schema(self) -> schemata.ArraySchema:
         return self.child.schema.prepend(
             schemata.SchemaItem(self.col_id, bigframes.dtypes.INT_DTYPE)
         )
 
+    @property
+    def relation_ops_created(self) -> int:
+        return 2
+
+    @functools.cached_property
+    def variables_introduced(self) -> int:
+        return 1
+
 
 @dataclass(frozen=True)
 class FilterNode(UnaryNode):
     predicate: ex.Expression
 
     @property
     def row_preserving(self) -> bool:
         return False
 
     def __hash__(self):
         return self._node_hash
 
+    @property
+    def variables_introduced(self) -> int:
+        return 1
+
 
 @dataclass(frozen=True)
 class OrderByNode(UnaryNode):
     by: Tuple[OrderingExpression, ...]
 
     def __post_init__(self):
         available_variables = self.child.schema.names
@@ -300,42 +402,72 @@
                     raise ValueError(
                         f"Cannot over unknown id:{variable}, columns are {available_variables}"
                     )
 
     def __hash__(self):
         return self._node_hash
 
+    @property
+    def variables_introduced(self) -> int:
+        return 0
+
+    @property
+    def relation_ops_created(self) -> int:
+        # Doesnt directly create any relational operations
+        return 0
+
 
 @dataclass(frozen=True)
 class ReversedNode(UnaryNode):
     # useless field to make sure has distinct hash
     reversed: bool = True
 
     def __hash__(self):
         return self._node_hash
 
+    @property
+    def variables_introduced(self) -> int:
+        return 0
+
+    @property
+    def relation_ops_created(self) -> int:
+        # Doesnt directly create any relational operations
+        return 0
+
 
 @dataclass(frozen=True)
 class ProjectionNode(UnaryNode):
     assignments: typing.Tuple[typing.Tuple[ex.Expression, str], ...]
 
+    def __post_init__(self):
+        input_types = self.child.schema._mapping
+        for expression, id in self.assignments:
+            # throws TypeError if invalid
+            _ = expression.output_type(input_types)
+
     def __hash__(self):
         return self._node_hash
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         input_types = self.child.schema._mapping
         items = tuple(
             schemata.SchemaItem(
                 id, bigframes.dtypes.dtype_for_etype(ex.output_type(input_types))
             )
             for ex, id in self.assignments
         )
         return schemata.ArraySchema(items)
 
+    @property
+    def variables_introduced(self) -> int:
+        # ignore passthrough expressions
+        new_vars = sum(1 for i in self.assignments if not i[0].is_identity)
+        return new_vars
+
 
 # TODO: Merge RowCount into Aggregate Node?
 # Row count can be compute from table metadata sometimes, so it is a bit special.
 @dataclass(frozen=True)
 class RowCountNode(UnaryNode):
     @property
     def row_preserving(self) -> bool:
@@ -347,14 +479,18 @@
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         return schemata.ArraySchema(
             (schemata.SchemaItem("count", bigframes.dtypes.INT_DTYPE),)
         )
 
+    @property
+    def variables_introduced(self) -> int:
+        return 1
+
 
 @dataclass(frozen=True)
 class AggregateNode(UnaryNode):
     aggregations: typing.Tuple[typing.Tuple[ex.Aggregation, str], ...]
     by_column_ids: typing.Tuple[str, ...] = tuple([])
     dropna: bool = True
 
@@ -362,18 +498,14 @@
     def row_preserving(self) -> bool:
         return False
 
     def __hash__(self):
         return self._node_hash
 
     @property
-    def peekable(self) -> bool:
-        return False
-
-    @property
     def non_local(self) -> bool:
         return True
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         by_items = tuple(
             schemata.SchemaItem(id, self.child.schema.get_type(id))
@@ -384,32 +516,32 @@
             schemata.SchemaItem(
                 id, bigframes.dtypes.dtype_for_etype(agg.output_type(input_types))
             )
             for agg, id in self.aggregations
         )
         return schemata.ArraySchema(tuple([*by_items, *agg_items]))
 
+    @property
+    def variables_introduced(self) -> int:
+        return len(self.aggregations) + len(self.by_column_ids)
+
 
 @dataclass(frozen=True)
 class WindowOpNode(UnaryNode):
     column_name: str
     op: agg_ops.UnaryWindowOp
     window_spec: window.WindowSpec
     output_name: typing.Optional[str] = None
     never_skip_nulls: bool = False
     skip_reproject_unsafe: bool = False
 
     def __hash__(self):
         return self._node_hash
 
     @property
-    def peekable(self) -> bool:
-        return False
-
-    @property
     def non_local(self) -> bool:
         return True
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         input_type = self.child.schema.get_type(self.column_name)
         new_item_dtype = self.op.output_type(input_type)
@@ -417,20 +549,39 @@
             return self.child.schema.update_dtype(self.column_name, new_item_dtype)
         if self.output_name in self.child.schema.names:
             return self.child.schema.update_dtype(self.output_name, new_item_dtype)
         return self.child.schema.append(
             schemata.SchemaItem(self.output_name, new_item_dtype)
         )
 
+    @property
+    def variables_introduced(self) -> int:
+        return 1
+
+    @property
+    def relation_ops_created(self) -> int:
+        # Assume that if not reprojecting, that there is a sequence of window operations sharing the same window
+        return 0 if self.skip_reproject_unsafe else 4
+
 
+# TODO: Remove this op
 @dataclass(frozen=True)
 class ReprojectOpNode(UnaryNode):
     def __hash__(self):
         return self._node_hash
 
+    @property
+    def variables_introduced(self) -> int:
+        return 0
+
+    @property
+    def relation_ops_created(self) -> int:
+        # This op is not a real transformation, just a hint to the sql generator
+        return 0
+
 
 @dataclass(frozen=True)
 class UnpivotNode(UnaryNode):
     # TODO: Refactor unpivot
     row_labels: typing.Tuple[typing.Hashable, ...]
     unpivot_columns: typing.Tuple[
         typing.Tuple[str, typing.Tuple[typing.Optional[str], ...]], ...
@@ -450,16 +601,16 @@
         return False
 
     @property
     def non_local(self) -> bool:
         return True
 
     @property
-    def peekable(self) -> bool:
-        return False
+    def joins(self) -> bool:
+        return True
 
     @functools.cached_property
     def schema(self) -> schemata.ArraySchema:
         def infer_dtype(
             values: typing.Iterable[typing.Hashable],
         ) -> bigframes.dtypes.Dtype:
             item_types = map(lambda x: bigframes.dtypes.infer_literal_type(x), values)
@@ -494,14 +645,25 @@
         ]
         passthrough_items = [
             schemata.SchemaItem(id, self.child.schema.get_type(id))
             for id in self.passthrough_columns
         ]
         return schemata.ArraySchema((*index_items, *value_items, *passthrough_items))
 
+    @property
+    def variables_introduced(self) -> int:
+        return (
+            len(self.schema.items) - len(self.passthrough_columns) + OVERHEAD_VARIABLES
+        )
+
+    @property
+    def relation_ops_created(self) -> int:
+        # Unpivot is essentially a cross join and a projection.
+        return 2
+
 
 @dataclass(frozen=True)
 class RandomSampleNode(UnaryNode):
     fraction: float
 
     @property
     def deterministic(self) -> bool:
@@ -509,7 +671,46 @@
 
     @property
     def row_preserving(self) -> bool:
         return False
 
     def __hash__(self):
         return self._node_hash
+
+    @property
+    def variables_introduced(self) -> int:
+        return 1
+
+
+@dataclass(frozen=True)
+class ExplodeNode(UnaryNode):
+    column_ids: typing.Tuple[str, ...]
+
+    @property
+    def row_preserving(self) -> bool:
+        return False
+
+    def __hash__(self):
+        return self._node_hash
+
+    @functools.cached_property
+    def schema(self) -> schemata.ArraySchema:
+        items = tuple(
+            schemata.SchemaItem(
+                name,
+                bigframes.dtypes.arrow_dtype_to_bigframes_dtype(
+                    self.child.schema.get_type(name).pyarrow_dtype.value_type
+                ),
+            )
+            if name in self.column_ids
+            else schemata.SchemaItem(name, self.child.schema.get_type(name))
+            for name in self.child.schema.names
+        )
+        return schemata.ArraySchema(items)
+
+    @property
+    def relation_ops_created(self) -> int:
+        return 3
+
+    @functools.cached_property
+    def variables_introduced(self) -> int:
+        return len(self.column_ids) + 1
```

### Comparing `bigframes-1.0.0/bigframes/core/ordering.py` & `bigframes-1.1.0/bigframes/core/ordering.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/reshape/__init__.py` & `bigframes-1.1.0/bigframes/core/reshape/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/rewrite.py` & `bigframes-1.1.0/bigframes/core/rewrite.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/scalar.py` & `bigframes-1.1.0/bigframes/core/scalar.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/schema.py` & `bigframes-1.1.0/bigframes/core/schema.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/tools/__init__.py` & `bigframes-1.1.0/bigframes/core/tools/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/tools/datetimes.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,90 +1,77 @@
-# Copyright 2024 Google LLC
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#     http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
+# Contains code from https://github.com/pandas-dev/pandas/blob/main/pandas/core/tools/datetimes.py
 
-from collections.abc import Mapping
 from datetime import datetime
-from typing import Optional, Union
+from typing import Iterable, Mapping, Union
 
-import bigframes_vendored.pandas.core.tools.datetimes as vendored_pandas_datetimes
 import pandas as pd
 
-import bigframes.constants as constants
-import bigframes.core.global_session as global_session
-import bigframes.dataframe
-import bigframes.operations as ops
-import bigframes.series
+from bigframes import constants, series
+
+local_scalars = Union[int, float, str, datetime]
+local_iterables = Union[Iterable, pd.Series, pd.DataFrame, Mapping]
 
 
 def to_datetime(
-    arg: Union[
-        vendored_pandas_datetimes.local_scalars,
-        vendored_pandas_datetimes.local_iterables,
-        bigframes.series.Series,
-        bigframes.dataframe.DataFrame,
-    ],
+    arg,
     *,
-    utc: bool = False,
-    format: Optional[str] = None,
-    unit: Optional[str] = None,
-) -> Union[pd.Timestamp, datetime, bigframes.series.Series]:
-    if isinstance(arg, (int, float, str, datetime)):
-        return pd.to_datetime(
-            arg,
-            utc=utc,
-            format=format,
-            unit=unit,
-        )
-
-    if isinstance(arg, (Mapping, pd.DataFrame, bigframes.dataframe.DataFrame)):
-        raise NotImplementedError(
-            "Conversion of Mapping, pandas.DataFrame, or bigframes.dataframe.DataFrame "
-            f"to datetime is not implemented. {constants.FEEDBACK_LINK}"
-        )
-
-    if not isinstance(arg, bigframes.series.Series):
-        # This block ensures compatibility with local data formats, including
-        # iterables and pandas.Series
-        # TODO: Currently, data upload is performed using pandas DataFrames
-        # combined with the `read_pandas` method due to the BigFrames DataFrame
-        # constructor's limitations in handling various data types. Plan to update
-        # the upload process to utilize the BigFrames DataFrame constructor directly
-        # once it is enhanced for more related datatypes.
-        arg = global_session.with_default_session(
-            bigframes.session.Session.read_pandas, pd.DataFrame(arg)
-        )
-        if len(arg.columns) != 1:
-            raise ValueError("Input must be 1-dimensional.")
-
-        arg = arg[arg.columns[0]]
-
-    if not utc and arg.dtype not in ("Int64", "Float64"):  # type: ignore
-        raise NotImplementedError(
-            f"String and Timestamp requires utc=True. {constants.FEEDBACK_LINK}"
-        )
-
-    if format and unit and arg.dtype in ("Int64", "Float64"):  # type: ignore
-        raise ValueError("cannot specify both format and unit")
-
-    if unit and arg.dtype not in ("Int64", "Float64"):  # type: ignore
-        raise NotImplementedError(
-            f"Unit parameter is not supported for non-numerical input types. {constants.FEEDBACK_LINK}"
-        )
-
-    return arg._apply_unary_op(  # type: ignore
-        ops.ToDatetimeOp(
-            utc=utc,
-            format=format,
-            unit=unit,
-        )
-    )
+    utc=False,
+    format=None,
+    unit=None,
+) -> Union[pd.Timestamp, datetime, series.Series]:
+    """
+    This function converts a scalar, array-like or Series to a datetime object.
+
+    .. note::
+        BigQuery only supports precision up to microseconds (us). Therefore, when working
+        with timestamps that have a finer granularity than microseconds, be aware that
+        the additional precision will not be represented in BigQuery.
+
+    .. note::
+        The format strings for specifying datetime representations in BigQuery and pandas
+        are not completely identical. Ensure that the format string provided is compatible
+        with BigQuery.
+
+    **Examples:**
+
+        >>> import bigframes.pandas as bpd
+        >>> bpd.options.display.progress_bar = None
+
+    Converting a Scalar to datetime:
+
+        >>> scalar = 123456.789
+        >>> bpd.to_datetime(scalar, unit = 's')
+        Timestamp('1970-01-02 10:17:36.789000')
+
+    Converting a List of Strings without Timezone Information:
+
+        >>> list_str = ["01-31-2021 14:30", "02-28-2021 15:45"]
+        >>> bpd.to_datetime(list_str, format="%m-%d-%Y %H:%M", utc=True)
+        0    2021-01-31 14:30:00+00:00
+        1    2021-02-28 15:45:00+00:00
+        dtype: timestamp[us, tz=UTC][pyarrow]
+
+    Converting a Series of Strings with Timezone Information:
+
+        >>> series_str = bpd.Series(["01-31-2021 14:30+08:00", "02-28-2021 15:45+00:00"])
+        >>> bpd.to_datetime(series_str, format="%m-%d-%Y %H:%M%Z", utc=True)
+        0    2021-01-31 06:30:00+00:00
+        1    2021-02-28 15:45:00+00:00
+        dtype: timestamp[us, tz=UTC][pyarrow]
+
+    Args:
+        arg (int, float, str, datetime, list, tuple, 1-d array, Series):
+            The object to convert to a datetime.
+        utc (bool, default False):
+            Control timezone-related parsing, localization and conversion. If True, the
+            function always returns a timezone-aware UTC-localized timestamp or series.
+            If False (default), inputs will not be coerced to UTC.
+        format (str, default None):
+            The strftime to parse time, e.g. "%d/%m/%Y".
+        unit (str, default 'ns'):
+            The unit of the arg (D,s,ms,us,ns) denote the unit, which is an integer or
+            float number.
+
+    Returns:
+        Timestamp, datetime.datetime or bigframes.series.Series: Return type depends on input.
+    """
+    raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
```

### Comparing `bigframes-1.0.0/bigframes/core/utils.py` & `bigframes-1.1.0/bigframes/core/utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/window/__init__.py` & `bigframes-1.1.0/bigframes/core/window/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/core/window_spec.py` & `bigframes-1.1.0/bigframes/core/window_spec.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/dataframe.py` & `bigframes-1.1.0/bigframes/dataframe.py`

 * *Files 2% similar despite different names*

```diff
@@ -46,14 +46,15 @@
 import bigframes
 import bigframes._config.display_options as display_options
 import bigframes.constants as constants
 import bigframes.core
 from bigframes.core import log_adapter
 import bigframes.core.block_transforms as block_ops
 import bigframes.core.blocks as blocks
+import bigframes.core.convert
 import bigframes.core.expression as ex
 import bigframes.core.groupby as groupby
 import bigframes.core.guid
 import bigframes.core.indexers as indexers
 import bigframes.core.indexes as indexes
 import bigframes.core.ordering as order
 import bigframes.core.utils as utils
@@ -303,14 +304,19 @@
         return self.size == 0
 
     @property
     def values(self) -> numpy.ndarray:
         return self.to_numpy()
 
     @property
+    def bqclient(self) -> bigframes.Session:
+        """BigQuery REST API Client the DataFrame uses for operations."""
+        return self._session.bqclient
+
+    @property
     def _session(self) -> bigframes.Session:
         return self._get_block().expr.session
 
     def __len__(self):
         rows, _ = self.shape
         return rows
 
@@ -654,30 +660,28 @@
         self,
         other: float | int | bigframes.series.Series | DataFrame,
         op,
         axis: str | int = "columns",
         how: str = "outer",
         reverse: bool = False,
     ):
-        if isinstance(other, (float, int)):
+        if isinstance(other, (float, int, bool)):
             return self._apply_scalar_binop(other, op, reverse=reverse)
-        elif isinstance(other, indexes.Index):
-            return self._apply_series_binop(
-                other.to_series(index=self.index),
-                op,
-                axis=axis,
-                how=how,
-                reverse=reverse,
-            )
-        elif isinstance(other, bigframes.series.Series):
-            return self._apply_series_binop(
-                other, op, axis=axis, how=how, reverse=reverse
-            )
         elif isinstance(other, DataFrame):
             return self._apply_dataframe_binop(other, op, how=how, reverse=reverse)
+        elif isinstance(other, pandas.DataFrame):
+            return self._apply_dataframe_binop(
+                DataFrame(other), op, how=how, reverse=reverse
+            )
+        elif utils.get_axis_number(axis) == 0:
+            bf_series = bigframes.core.convert.to_bf_series(other, self.index)
+            return self._apply_series_binop_axis_0(bf_series, op, how, reverse)
+        elif utils.get_axis_number(axis) == 1:
+            pd_series = bigframes.core.convert.to_pd_series(other, self.columns)
+            return self._apply_series_binop_axis_1(pd_series, op, how, reverse)
         raise NotImplementedError(
             f"binary operation is not implemented on the second operand of type {type(other).__name__}."
             f"{constants.FEEDBACK_LINK}"
         )
 
     def _apply_scalar_binop(
         self, other: float | int, op: ops.BinaryOp, reverse: bool = False
@@ -691,30 +695,21 @@
                 if reverse
                 else op.as_expr(column_id, ex.const(other))
             )
             block, _ = block.project_expr(expr, label)
             block = block.drop_columns([column_id])
         return DataFrame(block)
 
-    def _apply_series_binop(
+    def _apply_series_binop_axis_0(
         self,
         other: bigframes.series.Series,
         op: ops.BinaryOp,
-        axis: str | int = "columns",
         how: str = "outer",
         reverse: bool = False,
     ) -> DataFrame:
-        if axis not in ("columns", "index", 0, 1):
-            raise ValueError(f"Invalid input: axis {axis}.")
-
-        if axis in ("columns", 1):
-            raise NotImplementedError(
-                f"Row Series operations haven't been supported. {constants.FEEDBACK_LINK}"
-            )
-
         block, (get_column_left, get_column_right) = self._block.join(
             other._block, how=how
         )
 
         series_column_id = other._value_column
         series_col = get_column_right[series_column_id]
         for column_id, label in zip(
@@ -729,14 +724,71 @@
             block, _ = block.project_expr(expr, label)
             block = block.drop_columns([get_column_left[column_id]])
 
         block = block.drop_columns([series_col])
         block = block.with_index_labels(self.index.names)
         return DataFrame(block)
 
+    def _apply_series_binop_axis_1(
+        self,
+        other: pandas.Series,
+        op: ops.BinaryOp,
+        how: str = "outer",
+        reverse: bool = False,
+    ) -> DataFrame:
+        # Somewhat different alignment than df-df so separate codepath for now.
+        if self.columns.equals(other.index):
+            columns, lcol_indexer, rcol_indexer = self.columns, None, None
+        else:
+            if not (self.columns.is_unique and other.index.is_unique):
+                raise ValueError("Cannot align non-unique indices")
+            columns, lcol_indexer, rcol_indexer = self.columns.join(
+                other.index, how=how, return_indexers=True
+            )
+
+        binop_result_ids = []
+
+        column_indices = zip(
+            lcol_indexer if (lcol_indexer is not None) else range(len(columns)),
+            rcol_indexer if (rcol_indexer is not None) else range(len(columns)),
+        )
+
+        block = self._block
+        for left_index, right_index in column_indices:
+            if left_index >= 0 and right_index >= 0:  # -1 indices indicate missing
+                self_col_id = self._block.value_columns[left_index]
+                other_scalar = other.iloc[right_index]
+                expr = (
+                    op.as_expr(ex.const(other_scalar), self_col_id)
+                    if reverse
+                    else op.as_expr(self_col_id, ex.const(other_scalar))
+                )
+            elif left_index >= 0:
+                self_col_id = self._block.value_columns[left_index]
+                expr = (
+                    op.as_expr(ex.const(None), self_col_id)
+                    if reverse
+                    else op.as_expr(self_col_id, ex.const(None))
+                )
+            elif right_index >= 0:
+                other_scalar = other.iloc[right_index]
+                expr = (
+                    op.as_expr(ex.const(other_scalar), ex.const(None))
+                    if reverse
+                    else op.as_expr(ex.const(None), ex.const(other_scalar))
+                )
+            else:
+                # Should not be possible
+                raise ValueError("No right or left index.")
+            block, result_col_id = block.project_expr(expr)
+            binop_result_ids.append(result_col_id)
+
+        block = block.select_columns(binop_result_ids)
+        return DataFrame(block.with_column_labels(columns))
+
     def _apply_dataframe_binop(
         self,
         other: DataFrame,
         op: ops.BinaryOp,
         how: str = "outer",
         reverse: bool = False,
     ) -> DataFrame:
@@ -1067,26 +1119,27 @@
 
         Returns:
             pandas.DataFrame: A pandas DataFrame with all rows and columns of this DataFrame if the
                 data_sampling_threshold_mb is not exceeded; otherwise, a pandas DataFrame with
                 downsampled rows and all columns of this DataFrame.
         """
         # TODO(orrbradford): Optimize this in future. Potentially some cases where we can return the stored query job
-
+        self._optimize_query_complexity()
         df, query_job = self._block.to_pandas(
             max_download_size=max_download_size,
             sampling_method=sampling_method,
             random_state=random_state,
             ordered=ordered,
         )
         self._set_internal_query_job(query_job)
         return df.set_axis(self._block.column_labels, axis=1, copy=False)
 
     def to_pandas_batches(self) -> Iterable[pandas.DataFrame]:
         """Stream DataFrame results to an iterable of pandas DataFrame"""
+        self._optimize_query_complexity()
         return self._block.to_pandas_batches()
 
     def _compute_dry_run(self) -> bigquery.QueryJob:
         return self._block._compute_dry_run()
 
     def copy(self) -> DataFrame:
         return DataFrame(self._block)
@@ -1116,15 +1169,15 @@
         Raises:
             ValueError: If force=False and data cannot be efficiently peeked.
         """
         maybe_result = self._block.try_peek(n)
         if maybe_result is None:
             if force:
                 self._cached()
-                maybe_result = self._block.try_peek(n)
+                maybe_result = self._block.try_peek(n, force=True)
                 assert maybe_result is not None
             else:
                 raise ValueError(
                     "Cannot peek efficiently when data has aggregates, joins or window functions applied. Use force=True to fully compute dataframe."
                 )
         return maybe_result.set_axis(self._block.column_labels, axis=1, copy=False)
 
@@ -1489,14 +1542,25 @@
             ordering.append(
                 order.ascending_over(column_id, na_last)
                 if is_ascending
                 else order.descending_over(column_id, na_last)
             )
         return DataFrame(self._block.order_by(ordering))
 
+    def eval(self, expr: str) -> DataFrame:
+        import bigframes.core.eval as bf_eval
+
+        return bf_eval.eval(self, expr, target=self)
+
+    def query(self, expr: str) -> DataFrame:
+        import bigframes.core.eval as bf_eval
+
+        eval_result = bf_eval.eval(self, expr, target=None)
+        return self[eval_result]
+
     def value_counts(
         self,
         subset: typing.Union[blocks.Label, typing.Sequence[blocks.Label]] = None,
         normalize: bool = False,
         sort: bool = True,
         ascending: bool = False,
         dropna: bool = True,
@@ -2512,14 +2576,44 @@
         fracs = (frac,) if frac is not None else ()
         return DataFrame(
             self._block._split(
                 ns=ns, fracs=fracs, random_state=random_state, sort=sort
             )[0]
         )
 
+    def explode(
+        self,
+        column: typing.Union[blocks.Label, typing.Sequence[blocks.Label]],
+        *,
+        ignore_index: Optional[bool] = False,
+    ) -> DataFrame:
+        if not utils.is_list_like(column):
+            column_labels = typing.cast(typing.Sequence[blocks.Label], (column,))
+        else:
+            column_labels = typing.cast(typing.Sequence[blocks.Label], tuple(column))
+
+        if not column_labels:
+            raise ValueError("column must be nonempty")
+        if len(column_labels) > len(set(column_labels)):
+            raise ValueError("column must be unique")
+
+        column_ids = [self._resolve_label_exact(label) for label in column_labels]
+        missing = [
+            column_labels[i] for i in range(len(column_ids)) if column_ids[i] is None
+        ]
+        if len(missing) > 0:
+            raise KeyError(f"None of {missing} are in the columns")
+
+        return DataFrame(
+            self._block.explode(
+                column_ids=typing.cast(typing.Sequence[str], tuple(column_ids)),
+                ignore_index=ignore_index,
+            )
+        )
+
     def _split(
         self,
         ns: Iterable[int] = (),
         fracs: Iterable[float] = (),
         *,
         random_state: Optional[int] = None,
     ) -> List[DataFrame]:
@@ -2982,14 +3076,15 @@
         index: bool,
         ordering_id: Optional[str] = None,
         job_config: Optional[bigquery.job.QueryJobConfig] = None,
     ) -> bigquery.TableReference:
         """Executes a query job presenting this dataframe and returns the destination
         table."""
         session = self._block.expr.session
+        self._optimize_query_complexity()
         export_array, id_overrides = self._prepare_export(
             index=index, ordering_id=ordering_id
         )
 
         _, query_job = session._execute(
             export_array,
             job_config=job_config,
@@ -3118,14 +3213,22 @@
         """Materialize dataframe to a temporary table.
         No-op if the dataframe represents a trivial transformation of an existing materialization.
         Force=True is used for BQML integration where need to copy data rather than use snapshot.
         """
         self._set_block(self._block.cached(force=force))
         return self
 
+    def _optimize_query_complexity(self):
+        """Reduce query complexity by caching repeated subtrees and recursively materializing maximum-complexity subtrees.
+        May generate many queries and take substantial time to execute.
+        """
+        # TODO: Move all this to session
+        new_expr = self._session._simplify_with_caching(self._block.expr)
+        self._set_block(self._block.swap_array_expr(new_expr))
+
     _DataFrameOrSeries = typing.TypeVar("_DataFrameOrSeries")
 
     def dot(self, other: _DataFrameOrSeries) -> _DataFrameOrSeries:
         if not isinstance(other, (DataFrame, bf_series.Series)):
             raise NotImplementedError(
                 f"Only DataFrame or Series operand is supported. {constants.FEEDBACK_LINK}"
             )
```

### Comparing `bigframes-1.0.0/bigframes/dtypes.py` & `bigframes-1.1.0/bigframes/dtypes.py`

 * *Files 6% similar despite different names*

```diff
@@ -43,21 +43,27 @@
     pd.ArrowDtype,
     gpd.array.GeometryDtype,
 ]
 # Represents both column types (dtypes) and local-only types
 # None represents the type of a None scalar.
 ExpressionType = typing.Optional[Dtype]
 
-# Used when storing Null expressions
-DEFAULT_DTYPE = pd.Float64Dtype()
 
 INT_DTYPE = pd.Int64Dtype()
 FLOAT_DTYPE = pd.Float64Dtype()
 BOOL_DTYPE = pd.BooleanDtype()
 STRING_DTYPE = pd.StringDtype(storage="pyarrow")
+BYTES_DTYPE = pd.ArrowDtype(pa.binary())
+DATE_DTYPE = pd.ArrowDtype(pa.date32())
+TIME_DTYPE = pd.ArrowDtype(pa.time64("us"))
+DATETIME_DTYPE = pd.ArrowDtype(pa.timestamp("us"))
+TIMESTAMP_DTYPE = pd.ArrowDtype(pa.timestamp("us", tz="UTC"))
+
+# Used when storing Null expressions
+DEFAULT_DTYPE = FLOAT_DTYPE
 
 # On BQ side, ARRAY, STRUCT, GEOGRAPHY, JSON are not orderable
 UNORDERED_DTYPES = [gpd.array.GeometryDtype()]
 
 # Type hints for dtype strings supported by BigQuery DataFrame
 DtypeString = Literal[
     "boolean",
@@ -96,14 +102,54 @@
 ]
 NUMERIC_BIGFRAMES_TYPES_PERMISSIVE = NUMERIC_BIGFRAMES_TYPES_RESTRICTIVE + [
     pd.BooleanDtype(),
     pd.ArrowDtype(pa.decimal128(38, 9)),
     pd.ArrowDtype(pa.decimal256(76, 38)),
 ]
 
+
+## dtype predicates - use these to maintain consistency
+def is_datetime_like(type: ExpressionType) -> bool:
+    return type in (DATETIME_DTYPE, TIMESTAMP_DTYPE)
+
+
+def is_date_like(type: ExpressionType) -> bool:
+    return type in (DATETIME_DTYPE, TIMESTAMP_DTYPE, DATE_DTYPE)
+
+
+def is_time_like(type: ExpressionType) -> bool:
+    return type in (DATETIME_DTYPE, TIMESTAMP_DTYPE, TIME_DTYPE)
+
+
+def is_binary_like(type: ExpressionType) -> bool:
+    return type in (BOOL_DTYPE, BYTES_DTYPE, INT_DTYPE)
+
+
+def is_string_like(type: ExpressionType) -> bool:
+    return type in (STRING_DTYPE, BYTES_DTYPE)
+
+
+def is_array_like(type: ExpressionType) -> bool:
+    return isinstance(type, pd.ArrowDtype) and isinstance(
+        type.pyarrow_dtype, pa.ListType
+    )
+
+
+def is_numeric(type: ExpressionType) -> bool:
+    return type in NUMERIC_BIGFRAMES_TYPES_PERMISSIVE
+
+
+def is_iterable(type: ExpressionType) -> bool:
+    return type in (STRING_DTYPE, BYTES_DTYPE) or is_array_like(type)
+
+
+def is_comparable(type: ExpressionType) -> bool:
+    return (type is not None) and (type not in UNORDERED_DTYPES)
+
+
 # Type hints for Ibis data types that can be read to Python objects by BigQuery DataFrame
 ReadOnlyIbisDtype = Union[
     ibis_dtypes.Binary,
     ibis_dtypes.JSON,
     ibis_dtypes.Decimal,
     ibis_dtypes.GeoSpatial,
     ibis_dtypes.Array,
@@ -301,14 +347,18 @@
         return ibis_dtypes.float64
     else:
         raise ValueError(
             f"Unexpected Arrow data type {arrow_dtype}. {constants.FEEDBACK_LINK}"
         )
 
 
+def arrow_dtype_to_bigframes_dtype(arrow_dtype: pa.DataType) -> Dtype:
+    return ibis_dtype_to_bigframes_dtype(arrow_dtype_to_ibis_dtype(arrow_dtype))
+
+
 def bigframes_dtype_to_ibis_dtype(
     bigframes_dtype: Union[DtypeString, Dtype, np.dtype[Any]]
 ) -> ibis_dtypes.DataType:
     """Converts a BigQuery DataFrames supported dtype to an Ibis dtype.
 
     Args:
         bigframes_dtype:
@@ -601,14 +651,15 @@
         if isinstance(scalar, decimal.Decimal):
             # TODO: Check context to see if can use NUMERIC instead of BIGNUMERIC
             return lcd_type(pd.ArrowDtype(pa.decimal256(76, 38)), dtype)
     return None
 
 
 def lcd_type(dtype1: Dtype, dtype2: Dtype) -> Dtype:
+    """Get the supertype of the two types."""
     if dtype1 == dtype2:
         return dtype1
     # Implicit conversion currently only supported for numeric types
     hierarchy: list[Dtype] = [
         pd.BooleanDtype(),
         pd.Int64Dtype(),
         pd.ArrowDtype(pa.decimal128(38, 9)),
@@ -617,20 +668,34 @@
     ]
     if (dtype1 not in hierarchy) or (dtype2 not in hierarchy):
         return None
     lcd_index = max(hierarchy.index(dtype1), hierarchy.index(dtype2))
     return hierarchy[lcd_index]
 
 
-def lcd_etype(etype1: ExpressionType, etype2: ExpressionType) -> ExpressionType:
-    if etype1 is None:
+def coerce_to_common(etype1: ExpressionType, etype2: ExpressionType) -> ExpressionType:
+    """Coerce types to a common type or throw a TypeError"""
+    if etype1 is not None and etype2 is not None:
+        common_supertype = lcd_type(etype1, etype2)
+        if common_supertype is not None:
+            return common_supertype
+    if can_coerce(etype1, etype2):
         return etype2
-    if etype2 is None:
+    if can_coerce(etype2, etype1):
         return etype1
-    return lcd_type_or_throw(etype1, etype2)
+    raise TypeError(f"Cannot coerce {etype1} and {etype2} to a common type.")
+
+
+def can_coerce(source_type: ExpressionType, target_type: ExpressionType) -> bool:
+    if source_type is None:
+        return True  # None can be coerced to any supported type
+    else:
+        return (source_type == STRING_DTYPE) and (
+            target_type in (DATETIME_DTYPE, TIMESTAMP_DTYPE, TIME_DTYPE, DATE_DTYPE)
+        )
 
 
 def lcd_type_or_throw(dtype1: Dtype, dtype2: Dtype) -> Dtype:
     result = lcd_type(dtype1, dtype2)
     if result is None:
         raise NotImplementedError(
             f"BigFrames cannot upcast {dtype1} and {dtype2} to common type. {constants.FEEDBACK_LINK}"
```

### Comparing `bigframes-1.0.0/bigframes/features.py` & `bigframes-1.1.0/bigframes/features.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/formatting_helpers.py` & `bigframes-1.1.0/bigframes/formatting_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/functions/__init__.py` & `bigframes-1.1.0/bigframes/functions/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/functions/remote_function.py` & `bigframes-1.1.0/bigframes/functions/remote_function.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/__init__.py` & `bigframes-1.1.0/bigframes/ml/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/base.py` & `bigframes-1.1.0/bigframes/ml/base.py`

 * *Files 6% similar despite different names*

```diff
@@ -73,15 +73,15 @@
 
             def fit_transform(self, x_train: Union[DataFrame, Series], y_train: Union[DataFrame, Series]):
                 '''Perform both fit() and transform()'''
                 ...
     """
 
     def __repr__(self):
-        """Print the estimator's constructor with all non-default parameter values"""
+        """Print the estimator's constructor with all non-default parameter values."""
 
         # Estimator pretty printer adapted from Sklearn's, which is in turn an adaption of
         # the inbuilt pretty-printer in CPython
         import bigframes_vendored.cpython._pprint as adapted_pprint
 
         prettyprinter = adapted_pprint._EstimatorPrettyPrinter(
             compact=True, indent=1, indent_at_name=True, n_max_elements_to_show=30
@@ -102,21 +102,21 @@
         pass
 
     _T = TypeVar("_T", bound="Predictor")
 
     def register(self: _T, vertex_ai_model_id: Optional[str] = None) -> _T:
         """Register the model to Vertex AI.
 
-        After register, go to Google Cloud Console (https://console.cloud.google.com/vertex-ai/models)
+        After register, go to the Google Cloud console (https://console.cloud.google.com/vertex-ai/models)
         to manage the model registries.
         Refer to https://cloud.google.com/vertex-ai/docs/model-registry/introduction for more options.
 
         Args:
             vertex_ai_model_id (Optional[str], default None):
-                optional string id as model id in Vertex. If not set, will by default to 'bigframes_{bq_model_id}'.
+                Optional string id as model id in Vertex. If not set, will default to 'bigframes_{bq_model_id}'.
                 Vertex Ai model id will be truncated to 63 characters due to its limitation.
 
         Returns:
             BigQuery DataFrames Model after register.
         """
         if not self._bqml_model:
             # TODO(garrettwu): find a more elegant way to do this.
@@ -174,15 +174,41 @@
         self: _T,
         X: Union[bpd.DataFrame, bpd.Series],
         y: Optional[Union[bpd.DataFrame, bpd.Series]] = None,
     ) -> _T:
         return self._fit(X, y)
 
 
-class Transformer(BaseEstimator):
+class BaseTransformer(BaseEstimator):
+    """Transformer base class."""
+
+    def __init__(self):
+        self._bqml_model: Optional[core.BqmlModel] = None
+
+    _T = TypeVar("_T", bound="BaseTransformer")
+
+    def to_gbq(self: _T, model_name: str, replace: bool = False) -> _T:
+        """Save the transformer as a BigQuery model.
+
+        Args:
+            model_name (str):
+                The name of the model.
+            replace (bool, default False):
+                Whether to replace if the model already exists. Default to False.
+
+        Returns:
+            Saved transformer."""
+        if not self._bqml_model:
+            raise RuntimeError("A transformer must be fitted before it can be saved")
+
+        new_model = self._bqml_model.copy(model_name, replace)
+        return new_model.session.read_gbq_model(model_name)
+
+
+class Transformer(BaseTransformer):
     """A BigQuery DataFrames Transformer base class that transforms data.
 
     Also the transformers can be attached to a pipeline with a predictor."""
 
     @abc.abstractmethod
     def fit(self, X, y):
         pass
@@ -195,15 +221,15 @@
         self,
         X: Union[bpd.DataFrame, bpd.Series],
         y: Optional[Union[bpd.DataFrame, bpd.Series]] = None,
     ) -> bpd.DataFrame:
         return self.fit(X, y).transform(X)
 
 
-class LabelTransformer(BaseEstimator):
+class LabelTransformer(BaseTransformer):
     """A BigQuery DataFrames Label Transformer base class that transforms data.
 
     Also the transformers can be attached to a pipeline with a predictor."""
 
     @abc.abstractmethod
     def fit(self, y):
         pass
```

### Comparing `bigframes-1.0.0/bigframes/ml/cluster.py` & `bigframes-1.1.0/bigframes/ml/cluster.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/core.py` & `bigframes-1.1.0/bigframes/ml/core.py`

 * *Files 1% similar despite different names*

```diff
@@ -148,22 +148,22 @@
             input_data,
             lambda source_df: self._model_manipulation_sql_generator.ml_generate_text(
                 source_df=source_df,
                 struct_options=options,
             ),
         )
 
-    def generate_text_embedding(
+    def generate_embedding(
         self,
         input_data: bpd.DataFrame,
         options: Mapping[str, int | float],
     ) -> bpd.DataFrame:
         return self._apply_sql(
             input_data,
-            lambda source_df: self._model_manipulation_sql_generator.ml_generate_text_embedding(
+            lambda source_df: self._model_manipulation_sql_generator.ml_generate_embedding(
                 source_df=source_df,
                 struct_options=options,
             ),
         )
 
     def detect_anomalies(
         self, input_data: bpd.DataFrame, options: Mapping[str, int | float]
```

### Comparing `bigframes-1.0.0/bigframes/ml/decomposition.py` & `bigframes-1.1.0/bigframes/ml/decomposition.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/ensemble.py` & `bigframes-1.1.0/bigframes/ml/ensemble.py`

 * *Files 0% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-"""Ensemble models. This module is styled after Scikit-Learn's ensemble module:
+"""Ensemble models. This module is styled after scikit-learn's ensemble module:
 https://scikit-learn.org/stable/modules/ensemble.html"""
 
 from __future__ import annotations
 
 from typing import Dict, List, Literal, Optional, Union
 
 import bigframes_vendored.sklearn.ensemble._forest
@@ -186,17 +186,17 @@
         return self._bqml_model.evaluate(input_data)
 
     def to_gbq(self, model_name: str, replace: bool = False) -> XGBRegressor:
         """Save the model to BigQuery.
 
         Args:
             model_name (str):
-                the name of the model.
+                The name of the model.
             replace (bool, default False):
-                whether to replace if the model already exists. Default to False.
+                Whether to replace if the model already exists. Default to False.
 
         Returns: saved model."""
         if not self._bqml_model:
             raise RuntimeError("A model must be fitted before it can be saved")
 
         new_model = self._bqml_model.copy(model_name, replace)
         return new_model.session.read_gbq_model(model_name)
@@ -339,17 +339,17 @@
         return self._bqml_model.evaluate(input_data)
 
     def to_gbq(self, model_name: str, replace: bool = False) -> XGBClassifier:
         """Save the model to BigQuery.
 
         Args:
             model_name (str):
-                the name of the model.
+                The name of the model.
             replace (bool, default False):
-                whether to replace if the model already exists. Default to False.
+                Whether to replace if the model already exists. Default to False.
 
         Returns:
             XGBClassifier: saved model."""
         if not self._bqml_model:
             raise RuntimeError("A model must be fitted before it can be saved")
 
         new_model = self._bqml_model.copy(model_name, replace)
@@ -502,17 +502,17 @@
         return self._bqml_model.evaluate(input_data)
 
     def to_gbq(self, model_name: str, replace: bool = False) -> RandomForestRegressor:
         """Save the model to BigQuery.
 
         Args:
             model_name (str):
-                the name of the model.
+                The name of the model.
             replace (bool, default False):
-                whether to replace if the model already exists. Default to False.
+                Whether to replace if the model already exists. Default to False.
 
         Returns:
             RandomForestRegressor: saved model."""
         if not self._bqml_model:
             raise RuntimeError("A model must be fitted before it can be saved")
 
         new_model = self._bqml_model.copy(model_name, replace)
@@ -665,17 +665,17 @@
         return self._bqml_model.evaluate(input_data)
 
     def to_gbq(self, model_name: str, replace: bool = False) -> RandomForestClassifier:
         """Save the model to BigQuery.
 
         Args:
             model_name (str):
-                the name of the model.
+                The name of the model.
             replace (bool, default False):
-                whether to replace if the model already exists. Default to False.
+                Whether to replace if the model already exists. Default to False.
 
         Returns:
             RandomForestClassifier: saved model."""
         if not self._bqml_model:
             raise RuntimeError("A model must be fitted before it can be saved")
 
         new_model = self._bqml_model.copy(model_name, replace)
```

### Comparing `bigframes-1.0.0/bigframes/ml/forecasting.py` & `bigframes-1.1.0/bigframes/ml/forecasting.py`

 * *Files 1% similar despite different names*

```diff
@@ -230,29 +230,34 @@
             transforms=transforms,
             options=self._bqml_options,
         )
 
     def predict(
         self, X=None, *, horizon: int = 3, confidence_level: float = 0.95
     ) -> bpd.DataFrame:
-        """Predict the closest cluster for each sample in X.
+        """Forecast time series at future horizon.
+
+        .. note::
+
+            Output matches that of the BigQuery ML.FORECAST function.
+            See: https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-forecast
 
         Args:
             X (default None):
                 ignored, to be compatible with other APIs.
             horizon (int, default: 3):
                 an int value that specifies the number of time points to forecast.
                 The default value is 3, and the maximum value is 1000.
             confidence_level (float, default 0.95):
-                a float value that specifies percentage of the future values that fall in the prediction interval.
+                A float value that specifies percentage of the future values that fall in the prediction interval.
                 The valid input range is [0.0, 1.0).
 
         Returns:
             bigframes.dataframe.DataFrame: The predicted DataFrames. Which
-                contains 2 columns "forecast_timestamp" and "forecast_value".
+                contains 2 columns: "forecast_timestamp" and "forecast_value".
         """
         if horizon < 1 or horizon > 1000:
             raise ValueError(f"horizon must be [1, 1000], but is {horizon}.")
         if confidence_level < 0.0 or confidence_level >= 1.0:
             raise ValueError(
                 f"confidence_level must be [0.0, 1.0), but is {confidence_level}."
             )
@@ -275,15 +280,15 @@
         Args:
             X (bigframes.dataframe.DataFrame or bigframes.series.Series):
                 Series or a DataFrame to detect anomalies.
             anomaly_prob_threshold (float, default 0.95):
                 Identifies the custom threshold to use for anomaly detection. The value must be in the range [0, 1), with a default value of 0.95.
 
         Returns:
-            bigframes.dataframe.DataFrame: detected DataFrame."""
+            bigframes.dataframe.DataFrame: Detected DataFrame."""
         if anomaly_prob_threshold < 0.0 or anomaly_prob_threshold >= 1.0:
             raise ValueError(
                 f"anomaly_prob_threshold must be [0.0, 1.0), but is {anomaly_prob_threshold}."
             )
 
         if not self._bqml_model:
             raise RuntimeError("A model must be fitted before detect_anomalies")
```

### Comparing `bigframes-1.0.0/bigframes/ml/globals.py` & `bigframes-1.1.0/bigframes/ml/globals.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/imported.py` & `bigframes-1.1.0/bigframes/ml/imported.py`

 * *Files 0% similar despite different names*

```diff
@@ -30,15 +30,15 @@
 class TensorFlowModel(base.Predictor):
     """Imported TensorFlow model.
 
     Args:
         model_path (str):
             GCS path that holds the model files.
         session (BigQuery Session):
-            BQ session to create the model
+            BQ session to create the model.
     """
 
     def __init__(
         self,
         model_path: str,
         *,
         session: Optional[bigframes.Session] = None,
@@ -109,15 +109,15 @@
 class ONNXModel(base.Predictor):
     """Imported Open Neural Network Exchange (ONNX) model.
 
     Args:
         model_path (str):
             Cloud Storage path that holds the model files.
         session (BigQuery Session):
-            BQ session to create the model
+            BQ session to create the model.
     """
 
     def __init__(
         self,
         model_path: str,
         *,
         session: Optional[bigframes.Session] = None,
@@ -203,15 +203,15 @@
         output (Dict, default None):
             Specify the model output schema information when you
             create the XGBoost model. The input should be the format of
             {field_name: field_type}. Output is optional only if feature_names
             and feature_types are both specified in the model file. Supported types
             are "bool", "string", "int64", "float64", "array<bool>", "array<string>", "array<int64>", "array<float64>".
         session (BigQuery Session):
-            BQ session to create the model
+            BQ session to create the model.
     """
 
     def __init__(
         self,
         model_path: str,
         *,
         input: Mapping[str, str] = {},
```

### Comparing `bigframes-1.0.0/bigframes/ml/linear_model.py` & `bigframes-1.1.0/bigframes/ml/linear_model.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/llm.py` & `bigframes-1.1.0/bigframes/ml/llm.py`

 * *Files 1% similar despite different names*

```diff
@@ -385,15 +385,22 @@
         col_label = cast(blocks.Label, X.columns[0])
         X = X.rename(columns={col_label: "content"})
 
         options = {
             "flatten_json_output": True,
         }
 
-        df = self._bqml_model.generate_text_embedding(X, options)
+        df = self._bqml_model.generate_embedding(X, options)
+        df = df.rename(
+            columns={
+                "ml_generate_embedding_result": "text_embedding",
+                "ml_generate_embedding_statistics": "statistics",
+                "ml_generate_embedding_status": _ML_EMBED_TEXT_STATUS,
+            }
+        )
 
         if (df[_ML_EMBED_TEXT_STATUS] != "").any():
             warnings.warn(
                 f"Some predictions failed. Check column {_ML_EMBED_TEXT_STATUS} for detailed status. You may want to filter the failed rows and retry.",
                 RuntimeWarning,
             )
 
@@ -417,14 +424,20 @@
         return new_model.session.read_gbq_model(model_name)
 
 
 @log_adapter.class_logger
 class GeminiTextGenerator(base.BaseEstimator):
     """Gemini text generator LLM model.
 
+    .. note::
+        This product or feature is subject to the "Pre-GA Offerings Terms" in the General Service Terms section of the
+        Service Specific Terms(https://cloud.google.com/terms/service-terms#1). Pre-GA products and features are available "as is"
+        and might have limited support. For more information, see the launch stage descriptions
+        (https://cloud.google.com/products#product-launch-stages).
+
     Args:
         session (bigframes.Session or None):
             BQ session to create the model. If None, use the global default session.
         connection_name (str or None):
             Connection to connect with remote service. str of the format <PROJECT_NUMBER/PROJECT_ID>.<LOCATION>.<CONNECTION_ID>.
             if None, use default connection in session context. BigQuery DataFrame will try to create the connection and attach
             permission if the connection isn't fully setup.
```

### Comparing `bigframes-1.0.0/bigframes/ml/loader.py` & `bigframes-1.1.0/bigframes/ml/loader.py`

 * *Files 27% similar despite different names*

```diff
@@ -19,21 +19,24 @@
 
 from google.cloud import bigquery
 
 import bigframes
 import bigframes.constants as constants
 from bigframes.ml import (
     cluster,
+    compose,
+    core,
     decomposition,
     ensemble,
     forecasting,
     imported,
     linear_model,
     llm,
     pipeline,
+    preprocessing,
     utils,
 )
 
 _BQML_MODEL_TYPE_MAPPING = MappingProxyType(
     {
         "LINEAR_REGRESSION": linear_model.LinearRegression,
         "LOGISTIC_REGRESSION": linear_model.LogisticRegression,
@@ -75,40 +78,56 @@
     ensemble.RandomForestClassifier,
     imported.TensorFlowModel,
     imported.ONNXModel,
     imported.XGBoostModel,
     llm.PaLM2TextGenerator,
     llm.PaLM2TextEmbeddingGenerator,
     pipeline.Pipeline,
+    compose.ColumnTransformer,
+    preprocessing.PreprocessingType,
 ]:
     """Load a BQML model to BigQuery DataFrames ML.
 
     Args:
         session: a BigQuery DataFrames session.
         bq_model: a BigQuery model.
 
     Returns:
         A BigQuery DataFrames ML model object.
     """
+    # TODO(garrettwu): the entire condition only to TRANSFORM_ONLY when b/331679273 is fixed.
+    if (
+        bq_model.model_type == "TRANSFORM_ONLY"
+        or bq_model.model_type == "MODEL_TYPE_UNSPECIFIED"
+        and "transformColumns" in bq_model._properties
+        and not _is_bq_model_remote(bq_model)
+    ):
+        return _transformer_from_bq(session, bq_model)
+
     if _is_bq_model_pipeline(bq_model):
         return pipeline.Pipeline._from_bq(session, bq_model)
 
     return _model_from_bq(session, bq_model)
 
 
+def _transformer_from_bq(session: bigframes.Session, bq_model: bigquery.Model):
+    transformer = compose.ColumnTransformer._extract_from_bq_model(bq_model)._merge(
+        bq_model
+    )
+    transformer._bqml_model = core.BqmlModel(session, bq_model)
+
+    return transformer
+
+
 def _model_from_bq(session: bigframes.Session, bq_model: bigquery.Model):
     if bq_model.model_type in _BQML_MODEL_TYPE_MAPPING:
         return _BQML_MODEL_TYPE_MAPPING[bq_model.model_type]._from_bq(  # type: ignore
             session=session, model=bq_model
         )
-    if (
-        bq_model.model_type == "MODEL_TYPE_UNSPECIFIED"
-        and "remoteModelInfo" in bq_model._properties
-        and "endpoint" in bq_model._properties["remoteModelInfo"]
-    ):
+    if _is_bq_model_remote(bq_model):
         # Parse the remote model endpoint
         bqml_endpoint = bq_model._properties["remoteModelInfo"]["endpoint"]
         model_endpoint = bqml_endpoint.split("/")[-1]
         model_name, _ = utils.parse_model_endpoint(model_endpoint)
 
         return _BQML_ENDPOINT_TYPE_MAPPING[model_name]._from_bq(  # type: ignore
             session=session, model=bq_model
@@ -117,7 +136,15 @@
     raise NotImplementedError(
         f"Model type {bq_model.model_type} is not yet supported by BigQuery DataFrames. {constants.FEEDBACK_LINK}"
     )
 
 
 def _is_bq_model_pipeline(bq_model: bigquery.Model) -> bool:
     return "transformColumns" in bq_model._properties
+
+
+def _is_bq_model_remote(bq_model: bigquery.Model) -> bool:
+    return (
+        bq_model.model_type == "MODEL_TYPE_UNSPECIFIED"
+        and "remoteModelInfo" in bq_model._properties
+        and "endpoint" in bq_model._properties["remoteModelInfo"]
+    )
```

### Comparing `bigframes-1.0.0/bigframes/ml/metrics/__init__.py` & `bigframes-1.1.0/bigframes/ml/metrics/__init__.py`

 * *Files 20% similar despite different names*

```diff
@@ -14,14 +14,15 @@
 
 from bigframes.ml.metrics import pairwise
 from bigframes.ml.metrics._metrics import (
     accuracy_score,
     auc,
     confusion_matrix,
     f1_score,
+    mean_squared_error,
     precision_score,
     r2_score,
     recall_score,
     roc_auc_score,
     roc_curve,
 )
 
@@ -31,9 +32,10 @@
     "accuracy_score",
     "roc_curve",
     "roc_auc_score",
     "auc",
     "confusion_matrix",
     "precision_score",
     "f1_score",
+    "mean_squared_error",
     "pairwise",
 ]
```

### Comparing `bigframes-1.0.0/bigframes/ml/metrics/_metrics.py` & `bigframes-1.1.0/bigframes/ml/metrics/_metrics.py`

 * *Files 4% similar despite different names*

```diff
@@ -9,22 +9,22 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 """Metrics functions for evaluating models. This module is styled after
-Scikit-Learn's metrics module: https://scikit-learn.org/stable/modules/metrics.html."""
+scikit-learn's metrics module: https://scikit-learn.org/stable/modules/metrics.html."""
 
 import inspect
 import typing
 from typing import Tuple, Union
 
-import bigframes_vendored.sklearn.metrics._classification as vendored_mertics_classification
-import bigframes_vendored.sklearn.metrics._ranking as vendored_mertics_ranking
+import bigframes_vendored.sklearn.metrics._classification as vendored_metrics_classification
+import bigframes_vendored.sklearn.metrics._ranking as vendored_metrics_ranking
 import bigframes_vendored.sklearn.metrics._regression as vendored_metrics_regression
 import numpy as np
 import pandas as pd
 import sklearn.metrics as sklearn_metrics  # type: ignore
 
 import bigframes.constants as constants
 from bigframes.ml import utils
@@ -75,15 +75,15 @@
 
     if normalize:
         return score.mean()
     else:
         return score.sum()
 
 
-accuracy_score.__doc__ = inspect.getdoc(vendored_mertics_classification.accuracy_score)
+accuracy_score.__doc__ = inspect.getdoc(vendored_metrics_classification.accuracy_score)
 
 
 def roc_curve(
     y_true: Union[bpd.DataFrame, bpd.Series],
     y_score: Union[bpd.DataFrame, bpd.Series],
     *,
     drop_intermediate: bool = True,
@@ -145,51 +145,47 @@
     return (
         typing.cast(bpd.Series, df["fpr"]),
         typing.cast(bpd.Series, df["tpr"]),
         typing.cast(bpd.Series, df["thresholds"]),
     )
 
 
-roc_curve.__doc__ = inspect.getdoc(vendored_mertics_ranking.roc_curve)
+roc_curve.__doc__ = inspect.getdoc(vendored_metrics_ranking.roc_curve)
 
 
 def roc_auc_score(
     y_true: Union[bpd.DataFrame, bpd.Series], y_score: Union[bpd.DataFrame, bpd.Series]
 ) -> float:
     # TODO(bmil): Add multi-class support
     # TODO(bmil): Add multi-label support
     y_true_series, y_score_series = utils.convert_to_series(y_true, y_score)
 
     fpr, tpr, _ = roc_curve(y_true_series, y_score_series, drop_intermediate=False)
 
-    # TODO(bmil): remove this once bigframes supports the necessary operations
-    pd_fpr = fpr.to_pandas()
-    pd_tpr = tpr.to_pandas()
-
     # Use the trapezoid rule to compute the area under the ROC curve
-    width_diff = pd_fpr.diff().iloc[1:].reset_index(drop=True)
-    height_avg = (pd_tpr.iloc[:-1] + pd_tpr.iloc[1:].reset_index(drop=True)) / 2
-    return (width_diff * height_avg).sum()
+    width_diff = fpr.diff().iloc[1:].reset_index(drop=True)
+    height_avg = (tpr.iloc[:-1] + tpr.iloc[1:].reset_index(drop=True)) / 2
+    return typing.cast(float, (width_diff * height_avg).sum())
 
 
-roc_auc_score.__doc__ = inspect.getdoc(vendored_mertics_ranking.roc_auc_score)
+roc_auc_score.__doc__ = inspect.getdoc(vendored_metrics_ranking.roc_auc_score)
 
 
 def auc(
     x: Union[bpd.DataFrame, bpd.Series],
     y: Union[bpd.DataFrame, bpd.Series],
 ) -> float:
     x_series, y_series = utils.convert_to_series(x, y)
 
     # TODO(b/286410053) Support ML exceptions and error handling.
     auc = sklearn_metrics.auc(x_series.to_pandas(), y_series.to_pandas())
     return auc
 
 
-auc.__doc__ = inspect.getdoc(vendored_mertics_ranking.auc)
+auc.__doc__ = inspect.getdoc(vendored_metrics_ranking.auc)
 
 
 def confusion_matrix(
     y_true: Union[bpd.DataFrame, bpd.Series],
     y_pred: Union[bpd.DataFrame, bpd.Series],
 ) -> pd.DataFrame:
     # TODO(ashleyxu): support labels and sample_weight parameters
@@ -219,15 +215,15 @@
         count = row["dummy"]
         confusion_matrix[y_pred][y_true] = count
 
     return confusion_matrix
 
 
 confusion_matrix.__doc__ = inspect.getdoc(
-    vendored_mertics_classification.confusion_matrix
+    vendored_metrics_classification.confusion_matrix
 )
 
 
 def recall_score(
     y_true: Union[bpd.DataFrame, bpd.Series],
     y_pred: Union[bpd.DataFrame, bpd.Series],
     *,
@@ -257,15 +253,15 @@
     recall_score = pd.Series(0, index=index)
     for i in recall_score.index:
         recall_score.loc[i] = recall.loc[i]
 
     return recall_score
 
 
-recall_score.__doc__ = inspect.getdoc(vendored_mertics_classification.recall_score)
+recall_score.__doc__ = inspect.getdoc(vendored_metrics_classification.recall_score)
 
 
 def precision_score(
     y_true: Union[bpd.DataFrame, bpd.Series],
     y_pred: Union[bpd.DataFrame, bpd.Series],
     *,
     average: str = "binary",
@@ -295,15 +291,15 @@
     for i in precision.index:
         precision_score.loc[i] = precision.loc[i]
 
     return precision_score
 
 
 precision_score.__doc__ = inspect.getdoc(
-    vendored_mertics_classification.precision_score
+    vendored_metrics_classification.precision_score
 )
 
 
 def f1_score(
     y_true: Union[bpd.DataFrame, bpd.Series],
     y_pred: Union[bpd.DataFrame, bpd.Series],
     *,
@@ -330,8 +326,22 @@
             )
         else:
             f1_score[index] = 0
 
     return f1_score
 
 
-f1_score.__doc__ = inspect.getdoc(vendored_mertics_classification.f1_score)
+f1_score.__doc__ = inspect.getdoc(vendored_metrics_classification.f1_score)
+
+
+def mean_squared_error(
+    y_true: Union[bpd.DataFrame, bpd.Series],
+    y_pred: Union[bpd.DataFrame, bpd.Series],
+) -> float:
+    y_true_series, y_pred_series = utils.convert_to_series(y_true, y_pred)
+
+    return (y_pred_series - y_true_series).pow(2).sum() / len(y_true_series)
+
+
+mean_squared_error.__doc__ = inspect.getdoc(
+    vendored_metrics_regression.mean_squared_error
+)
```

### Comparing `bigframes-1.0.0/bigframes/ml/metrics/pairwise.py` & `bigframes-1.1.0/bigframes/ml/metrics/pairwise.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/model_selection.py` & `bigframes-1.1.0/bigframes/ml/model_selection.py`

 * *Files 0% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 """Functions for test/train split and model tuning. This module is styled after
-Scikit-Learn's model_selection module:
+scikit-learn's model_selection module:
 https://scikit-learn.org/stable/modules/classes.html#module-sklearn.model_selection."""
 
 
 import typing
 from typing import List, Union
 
 from bigframes.ml import utils
@@ -47,15 +47,15 @@
             A seed to use for randomly choosing the rows of the split. If not
             set, a random split will be generated each time.
 
     Returns:
         List[Union[bigframes.dataframe.DataFrame, bigframes.series.Series]]: A list of BigQuery DataFrames or Series.
     """
 
-    # TODO(garrettwu): Scikit-Learn throws an error when the dataframes don't have the same
+    # TODO(garrettwu): scikit-learn throws an error when the dataframes don't have the same
     # number of rows. We probably want to do something similar. Now the implementation is based
     # on index. We'll move to based on ordering first.
 
     if test_size is None:
         if train_size is None:
             test_size = 0.25
         else:
```

### Comparing `bigframes-1.0.0/bigframes/ml/preprocessing.py` & `bigframes-1.1.0/bigframes/ml/preprocessing.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 """Transformers that prepare data for other estimators. This module is styled after
-Scikit-Learn's preprocessing module: https://scikit-learn.org/stable/modules/preprocessing.html."""
+scikit-learn's preprocessing module: https://scikit-learn.org/stable/modules/preprocessing.html."""
 
 from __future__ import annotations
 
 import typing
 from typing import Any, cast, List, Literal, Optional, Tuple, Union
 
 import bigframes_vendored.sklearn.preprocessing._data
@@ -635,7 +635,17 @@
         (y,) = utils.convert_to_dataframe(y)
 
         df = self._bqml_model.transform(y)
         return typing.cast(
             bpd.DataFrame,
             df[self._output_names],
         )
+
+
+PreprocessingType = Union[
+    OneHotEncoder,
+    StandardScaler,
+    MaxAbsScaler,
+    MinMaxScaler,
+    KBinsDiscretizer,
+    LabelEncoder,
+]
```

### Comparing `bigframes-1.0.0/bigframes/ml/remote.py` & `bigframes-1.1.0/bigframes/ml/remote.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/ml/sql.py` & `bigframes-1.1.0/bigframes/ml/sql.py`

 * *Files 1% similar despite different names*

```diff
@@ -266,20 +266,20 @@
         self, source_df: bpd.DataFrame, struct_options: Mapping[str, Union[int, float]]
     ) -> str:
         """Encode ML.GENERATE_TEXT for BQML"""
         struct_options_sql = self.struct_options(**struct_options)
         return f"""SELECT * FROM ML.GENERATE_TEXT(MODEL `{self._model_name}`,
   ({self._source_sql(source_df)}), {struct_options_sql})"""
 
-    def ml_generate_text_embedding(
+    def ml_generate_embedding(
         self, source_df: bpd.DataFrame, struct_options: Mapping[str, Union[int, float]]
     ) -> str:
-        """Encode ML.GENERATE_TEXT_EMBEDDING for BQML"""
+        """Encode ML.GENERATE_EMBEDDING for BQML"""
         struct_options_sql = self.struct_options(**struct_options)
-        return f"""SELECT * FROM ML.GENERATE_TEXT_EMBEDDING(MODEL `{self._model_name}`,
+        return f"""SELECT * FROM ML.GENERATE_EMBEDDING(MODEL `{self._model_name}`,
   ({self._source_sql(source_df)}), {struct_options_sql})"""
 
     def ml_detect_anomalies(
         self, source_df: bpd.DataFrame, struct_options: Mapping[str, Union[int, float]]
     ) -> str:
         """Encode ML.DETECT_ANOMALIES for BQML"""
         struct_options_sql = self.struct_options(**struct_options)
```

### Comparing `bigframes-1.0.0/bigframes/ml/utils.py` & `bigframes-1.1.0/bigframes/ml/utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/__init__.py` & `bigframes-1.1.0/bigframes/operations/__init__.py`

 * *Files 27% similar despite different names*

```diff
@@ -157,243 +157,320 @@
     if isinstance(input, str):
         return bigframes.core.expression.UnboundVariableExpression(input)
     else:
         return input
 
 
 # Operation Factories
-def create_unary_op(
-    name: str, type_rule: op_typing.OpTypeRule = op_typing.INPUT_TYPE
-) -> UnaryOp:
+def create_unary_op(name: str, type_signature: op_typing.UnaryTypeSignature) -> UnaryOp:
     return dataclasses.make_dataclass(
         name,
-        [("name", typing.ClassVar[str], name), ("output_type", typing.ClassVar[typing.Callable], type_rule.as_method)],  # type: ignore
+        [("name", typing.ClassVar[str], name), ("output_type", typing.ClassVar[typing.Callable], type_signature.as_method)],  # type: ignore
         bases=(UnaryOp,),
         frozen=True,
     )()
 
 
 def create_binary_op(
-    name: str, type_rule: op_typing.OpTypeRule = op_typing.Supertype()
+    name: str, type_signature: op_typing.BinaryTypeSignature
 ) -> BinaryOp:
     return dataclasses.make_dataclass(
         name,
-        [("name", typing.ClassVar[str], name), ("output_type", typing.ClassVar[typing.Callable], type_rule.as_method)],  # type: ignore
+        [("name", typing.ClassVar[str], name), ("output_type", typing.ClassVar[typing.Callable], type_signature.as_method)],  # type: ignore
         bases=(BinaryOp,),
         frozen=True,
     )()
 
 
-def create_ternary_op(
-    name: str, type_rule: op_typing.OpTypeRule = op_typing.Supertype()
-) -> TernaryOp:
-    return dataclasses.make_dataclass(
-        name,
-        [("name", typing.ClassVar[str], name), ("output_type", typing.ClassVar[typing.Callable], type_rule.as_method)],  # type: ignore
-        bases=(TernaryOp,),
-        frozen=True,
-    )()
-
-
 # Unary Ops
 ## Generic Ops
-invert_op = create_unary_op(name="invert", type_rule=op_typing.INPUT_TYPE)
-isnull_op = create_unary_op(name="isnull", type_rule=op_typing.PREDICATE)
-notnull_op = create_unary_op(name="notnull", type_rule=op_typing.PREDICATE)
-hash_op = create_unary_op(name="hash", type_rule=op_typing.INTEGER)
+invert_op = create_unary_op(
+    name="invert",
+    type_signature=op_typing.TypePreserving(
+        dtypes.is_binary_like,
+        description="binary-like",
+    ),
+)  # numeric
+isnull_op = create_unary_op(
+    name="isnull",
+    type_signature=op_typing.FixedOutputType(
+        lambda x: True, dtypes.BOOL_DTYPE, description="nullable"
+    ),
+)
+notnull_op = create_unary_op(
+    name="notnull",
+    type_signature=op_typing.FixedOutputType(
+        lambda x: True, dtypes.BOOL_DTYPE, description="nullable"
+    ),
+)
+hash_op = create_unary_op(
+    name="hash",
+    type_signature=op_typing.FixedOutputType(
+        dtypes.is_string_like, dtypes.INT_DTYPE, description="string-like"
+    ),
+)
 ## String Ops
-len_op = create_unary_op(name="len", type_rule=op_typing.INTEGER)
-reverse_op = create_unary_op(name="reverse", type_rule=op_typing.STRING)
-lower_op = create_unary_op(name="lower", type_rule=op_typing.STRING)
-upper_op = create_unary_op(name="upper", type_rule=op_typing.STRING)
-strip_op = create_unary_op(name="strip", type_rule=op_typing.STRING)
-isalnum_op = create_unary_op(name="isalnum", type_rule=op_typing.PREDICATE)
-isalpha_op = create_unary_op(name="isalpha", type_rule=op_typing.PREDICATE)
-isdecimal_op = create_unary_op(name="isdecimal", type_rule=op_typing.PREDICATE)
-isdigit_op = create_unary_op(name="isdigit", type_rule=op_typing.PREDICATE)
-isnumeric_op = create_unary_op(name="isnumeric", type_rule=op_typing.PREDICATE)
-isspace_op = create_unary_op(name="isspace", type_rule=op_typing.PREDICATE)
-islower_op = create_unary_op(name="islower", type_rule=op_typing.PREDICATE)
-isupper_op = create_unary_op(name="isupper", type_rule=op_typing.PREDICATE)
-rstrip_op = create_unary_op(name="rstrip", type_rule=op_typing.STRING)
-lstrip_op = create_unary_op(name="lstrip", type_rule=op_typing.STRING)
-capitalize_op = create_unary_op(name="capitalize", type_rule=op_typing.STRING)
+len_op = create_unary_op(
+    name="len",
+    type_signature=op_typing.FixedOutputType(
+        dtypes.is_iterable, dtypes.INT_DTYPE, description="iterable"
+    ),
+)
+reverse_op = create_unary_op(name="reverse", type_signature=op_typing.STRING_TRANSFORM)
+lower_op = create_unary_op(name="lower", type_signature=op_typing.STRING_TRANSFORM)
+upper_op = create_unary_op(name="upper", type_signature=op_typing.STRING_TRANSFORM)
+strip_op = create_unary_op(name="strip", type_signature=op_typing.STRING_TRANSFORM)
+isalnum_op = create_unary_op(name="isalnum", type_signature=op_typing.STRING_PREDICATE)
+isalpha_op = create_unary_op(name="isalpha", type_signature=op_typing.STRING_PREDICATE)
+isdecimal_op = create_unary_op(
+    name="isdecimal", type_signature=op_typing.STRING_PREDICATE
+)
+isdigit_op = create_unary_op(name="isdigit", type_signature=op_typing.STRING_PREDICATE)
+isnumeric_op = create_unary_op(
+    name="isnumeric", type_signature=op_typing.STRING_PREDICATE
+)
+isspace_op = create_unary_op(name="isspace", type_signature=op_typing.STRING_PREDICATE)
+islower_op = create_unary_op(name="islower", type_signature=op_typing.STRING_PREDICATE)
+isupper_op = create_unary_op(name="isupper", type_signature=op_typing.STRING_PREDICATE)
+rstrip_op = create_unary_op(name="rstrip", type_signature=op_typing.STRING_TRANSFORM)
+lstrip_op = create_unary_op(name="lstrip", type_signature=op_typing.STRING_TRANSFORM)
+capitalize_op = create_unary_op(
+    name="capitalize", type_signature=op_typing.STRING_TRANSFORM
+)
 ## DateTime Ops
-day_op = create_unary_op(name="day", type_rule=op_typing.INTEGER)
-dayofweek_op = create_unary_op(name="dayofweek", type_rule=op_typing.INTEGER)
+### datelike accessors
+day_op = create_unary_op(
+    name="day",
+    type_signature=op_typing.DATELIKE_ACCESSOR,
+)
+month_op = create_unary_op(
+    name="month",
+    type_signature=op_typing.DATELIKE_ACCESSOR,
+)
+year_op = create_unary_op(
+    name="year",
+    type_signature=op_typing.DATELIKE_ACCESSOR,
+)
+dayofweek_op = create_unary_op(
+    name="dayofweek",
+    type_signature=op_typing.DATELIKE_ACCESSOR,
+)
+quarter_op = create_unary_op(
+    name="quarter",
+    type_signature=op_typing.DATELIKE_ACCESSOR,
+)
+### timelike accessors
+hour_op = create_unary_op(
+    name="hour",
+    type_signature=op_typing.TIMELIKE_ACCESSOR,
+)
+minute_op = create_unary_op(
+    name="minute",
+    type_signature=op_typing.TIMELIKE_ACCESSOR,
+)
+second_op = create_unary_op(
+    name="second",
+    type_signature=op_typing.TIMELIKE_ACCESSOR,
+)
+normalize_op = create_unary_op(
+    name="normalize",
+    type_signature=op_typing.TypePreserving(
+        dtypes.is_time_like,
+        description="time-like",
+    ),
+)
+### datetimelike accessors
 date_op = create_unary_op(
-    name="date", type_rule=op_typing.Fixed(pd.ArrowDtype(pa.date32()))
+    name="date",
+    type_signature=op_typing.FixedOutputType(
+        dtypes.is_date_like, dtypes.DATE_DTYPE, description="date-like"
+    ),
 )
-hour_op = create_unary_op(name="hour", type_rule=op_typing.INTEGER)
-minute_op = create_unary_op(name="minute", type_rule=op_typing.INTEGER)
-month_op = create_unary_op(name="month", type_rule=op_typing.INTEGER)
-quarter_op = create_unary_op(name="quarter", type_rule=op_typing.INTEGER)
-second_op = create_unary_op(name="second", type_rule=op_typing.INTEGER)
 time_op = create_unary_op(
-    name="time", type_rule=op_typing.Fixed(pd.ArrowDtype(pa.time64("us")))
+    name="time",
+    type_signature=op_typing.FixedOutputType(
+        dtypes.is_time_like, dtypes.TIME_DTYPE, description="time-like"
+    ),
 )
-year_op = create_unary_op(name="year", type_rule=op_typing.INTEGER)
-normalize_op = create_unary_op(name="normalize")
 ## Trigonometry Ops
-sin_op = create_unary_op(name="sin", type_rule=op_typing.REAL_NUMERIC)
-cos_op = create_unary_op(name="cos", type_rule=op_typing.REAL_NUMERIC)
-tan_op = create_unary_op(name="tan", type_rule=op_typing.REAL_NUMERIC)
-arcsin_op = create_unary_op(name="arcsin", type_rule=op_typing.REAL_NUMERIC)
-arccos_op = create_unary_op(name="arccos", type_rule=op_typing.REAL_NUMERIC)
-arctan_op = create_unary_op(name="arctan", type_rule=op_typing.REAL_NUMERIC)
-sinh_op = create_unary_op(name="sinh", type_rule=op_typing.REAL_NUMERIC)
-cosh_op = create_unary_op(name="cosh", type_rule=op_typing.REAL_NUMERIC)
-tanh_op = create_unary_op(name="tanh", type_rule=op_typing.REAL_NUMERIC)
-arcsinh_op = create_unary_op(name="arcsinh", type_rule=op_typing.REAL_NUMERIC)
-arccosh_op = create_unary_op(name="arccosh", type_rule=op_typing.REAL_NUMERIC)
-arctanh_op = create_unary_op(name="arctanh", type_rule=op_typing.REAL_NUMERIC)
+sin_op = create_unary_op(name="sin", type_signature=op_typing.UNARY_REAL_NUMERIC)
+cos_op = create_unary_op(name="cos", type_signature=op_typing.UNARY_REAL_NUMERIC)
+tan_op = create_unary_op(name="tan", type_signature=op_typing.UNARY_REAL_NUMERIC)
+arcsin_op = create_unary_op(name="arcsin", type_signature=op_typing.UNARY_REAL_NUMERIC)
+arccos_op = create_unary_op(name="arccos", type_signature=op_typing.UNARY_REAL_NUMERIC)
+arctan_op = create_unary_op(name="arctan", type_signature=op_typing.UNARY_REAL_NUMERIC)
+sinh_op = create_unary_op(name="sinh", type_signature=op_typing.UNARY_REAL_NUMERIC)
+cosh_op = create_unary_op(name="cosh", type_signature=op_typing.UNARY_REAL_NUMERIC)
+tanh_op = create_unary_op(name="tanh", type_signature=op_typing.UNARY_REAL_NUMERIC)
+arcsinh_op = create_unary_op(
+    name="arcsinh", type_signature=op_typing.UNARY_REAL_NUMERIC
+)
+arccosh_op = create_unary_op(
+    name="arccosh", type_signature=op_typing.UNARY_REAL_NUMERIC
+)
+arctanh_op = create_unary_op(
+    name="arctanh", type_signature=op_typing.UNARY_REAL_NUMERIC
+)
 ## Numeric Ops
-abs_op = create_unary_op(name="abs", type_rule=op_typing.INPUT_TYPE)
-exp_op = create_unary_op(name="exp", type_rule=op_typing.REAL_NUMERIC)
-ln_op = create_unary_op(name="log", type_rule=op_typing.REAL_NUMERIC)
-log10_op = create_unary_op(name="log10", type_rule=op_typing.REAL_NUMERIC)
-sqrt_op = create_unary_op(name="sqrt", type_rule=op_typing.REAL_NUMERIC)
+floor_op = create_unary_op(name="floor", type_signature=op_typing.UNARY_REAL_NUMERIC)
+ceil_op = create_unary_op(name="ceil", type_signature=op_typing.UNARY_REAL_NUMERIC)
+abs_op = create_unary_op(name="abs", type_signature=op_typing.UNARY_NUMERIC)
+exp_op = create_unary_op(name="exp", type_signature=op_typing.UNARY_REAL_NUMERIC)
+expm1_op = create_unary_op(name="expm1", type_signature=op_typing.UNARY_REAL_NUMERIC)
+ln_op = create_unary_op(name="log", type_signature=op_typing.UNARY_REAL_NUMERIC)
+log10_op = create_unary_op(name="log10", type_signature=op_typing.UNARY_REAL_NUMERIC)
+log1p_op = create_unary_op(name="log1p", type_signature=op_typing.UNARY_REAL_NUMERIC)
+sqrt_op = create_unary_op(name="sqrt", type_signature=op_typing.UNARY_REAL_NUMERIC)
 
 
 # Parameterized unary ops
 @dataclasses.dataclass(frozen=True)
 class StrContainsOp(UnaryOp):
     name: typing.ClassVar[str] = "str_contains"
     pat: str
 
     def output_type(self, *input_types):
-        return dtypes.BOOL_DTYPE
+        return op_typing.STRING_PREDICATE.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrContainsRegexOp(UnaryOp):
     name: typing.ClassVar[str] = "str_contains_regex"
     pat: str
 
     def output_type(self, *input_types):
-        return dtypes.BOOL_DTYPE
+        return op_typing.STRING_PREDICATE.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrGetOp(UnaryOp):
     name: typing.ClassVar[str] = "str_get"
     i: int
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrPadOp(UnaryOp):
     name: typing.ClassVar[str] = "str_pad"
     length: int
     fillchar: str
     side: typing.Literal["both", "left", "right"]
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class ReplaceStrOp(UnaryOp):
     name: typing.ClassVar[str] = "str_replace"
     pat: str
     repl: str
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class RegexReplaceStrOp(UnaryOp):
     name: typing.ClassVar[str] = "str_rereplace"
     pat: str
     repl: str
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StartsWithOp(UnaryOp):
     name: typing.ClassVar[str] = "str_startswith"
     pat: typing.Sequence[str]
 
     def output_type(self, *input_types):
-        return dtypes.BOOL_DTYPE
+        return op_typing.STRING_PREDICATE.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class EndsWithOp(UnaryOp):
     name: typing.ClassVar[str] = "str_endswith"
     pat: typing.Sequence[str]
 
     def output_type(self, *input_types):
-        return dtypes.BOOL_DTYPE
+        return op_typing.STRING_PREDICATE.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class ZfillOp(UnaryOp):
     name: typing.ClassVar[str] = "str_zfill"
     width: int
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrFindOp(UnaryOp):
     name: typing.ClassVar[str] = "str_find"
     substr: str
     start: typing.Optional[int]
     end: typing.Optional[int]
 
     def output_type(self, *input_types):
-        return dtypes.INT_DTYPE
+        signature = op_typing.FixedOutputType(
+            dtypes.is_string_like, dtypes.INT_DTYPE, "string-like"
+        )
+        return signature.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrExtractOp(UnaryOp):
     name: typing.ClassVar[str] = "str_extract"
     pat: str
     n: int = 1
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrSliceOp(UnaryOp):
     name: typing.ClassVar[str] = "str_slice"
     start: typing.Optional[int]
     end: typing.Optional[int]
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class StrRepeatOp(UnaryOp):
     name: typing.ClassVar[str] = "str_repeat"
     repeats: int
 
     def output_type(self, *input_types):
-        return dtypes.STRING_DTYPE
+        return op_typing.STRING_TRANSFORM.output_type(input_types[0])
 
 
 # Other parameterized unary operations
 @dataclasses.dataclass(frozen=True)
 class StructFieldOp(UnaryOp):
     name: typing.ClassVar[str] = "struct_field"
     name_or_index: str | int
 
     def output_type(self, *input_types):
-        pd_type = typing.cast(pd.ArrowDtype, input_types[0])
-        pa_struct_t = typing.cast(pa.StructType, pd_type.pyarrow_dtype)
-        pa_result_type = pa_struct_t[self.name_or_index].type
+        input_type = input_types[0]
+        if not isinstance(input_type, pd.ArrowDtype):
+            raise TypeError("field accessor input must be a struct type")
+
+        pa_type = input_type.pyarrow_dtype
+        if not isinstance(pa_type, pa.StructType):
+            raise TypeError("field accessor input must be a struct type")
+
+        pa_result_type = pa_type[self.name_or_index].type
         # TODO: Directly convert from arrow to pandas type
         ibis_result_type = dtypes.arrow_dtype_to_ibis_dtype(pa_result_type)
         return dtypes.ibis_dtype_to_bigframes_dtype(ibis_result_type)
 
 
 @dataclasses.dataclass(frozen=True)
 class AsTypeOp(UnaryOp):
@@ -467,62 +544,129 @@
     freq: str
 
     def output_type(self, *input_types):
         return input_types[0]
 
 
 # Binary Ops
-fillna_op = create_binary_op(name="fillna")
-cliplower_op = create_binary_op(name="clip_lower")
-clipupper_op = create_binary_op(name="clip_upper")
-coalesce_op = create_binary_op(name="coalesce")
+fillna_op = create_binary_op(name="fillna", type_signature=op_typing.COERCE)
+cliplower_op = create_binary_op(name="clip_lower", type_signature=op_typing.COERCE)
+clipupper_op = create_binary_op(name="clip_upper", type_signature=op_typing.COERCE)
+coalesce_op = create_binary_op(name="coalesce", type_signature=op_typing.COERCE)
+
+
 ## Math Ops
-add_op = create_binary_op(name="add", type_rule=op_typing.NUMERIC)
-sub_op = create_binary_op(name="sub", type_rule=op_typing.NUMERIC)
-mul_op = create_binary_op(name="mul", type_rule=op_typing.NUMERIC)
-div_op = create_binary_op(name="div", type_rule=op_typing.REAL_NUMERIC)
-floordiv_op = create_binary_op(name="floordiv", type_rule=op_typing.NUMERIC)
-pow_op = create_binary_op(name="pow", type_rule=op_typing.NUMERIC)
-mod_op = create_binary_op(name="mod", type_rule=op_typing.NUMERIC)
-round_op = create_binary_op(name="round", type_rule=op_typing.REAL_NUMERIC)
-unsafe_pow_op = create_binary_op(name="unsafe_pow_op", type_rule=op_typing.REAL_NUMERIC)
+@dataclasses.dataclass(frozen=True)
+class AddOp(BinaryOp):
+    name: typing.ClassVar[str] = "add"
+
+    def output_type(self, *input_types):
+        left_type = input_types[0]
+        right_type = input_types[1]
+        if all(map(dtypes.is_string_like, input_types)) and len(set(input_types)) == 1:
+            # String addition
+            return input_types[0]
+        if (left_type is None or dtypes.is_numeric(left_type)) and (
+            right_type is None or dtypes.is_numeric(right_type)
+        ):
+            # Numeric addition
+            return dtypes.coerce_to_common(left_type, right_type)
+        # TODO: Add temporal addition once delta types supported
+        raise TypeError(f"Cannot add dtypes {left_type} and {right_type}")
+
+
+@dataclasses.dataclass(frozen=True)
+class SubOp(BinaryOp):
+    name: typing.ClassVar[str] = "sub"
+
+    # Note: this is actualyl a vararg op, but we don't model that yet
+    def output_type(self, *input_types):
+        left_type = input_types[0]
+        right_type = input_types[1]
+        if (left_type is None or dtypes.is_numeric(left_type)) and (
+            right_type is None or dtypes.is_numeric(right_type)
+        ):
+            # Numeric subtraction
+            return dtypes.coerce_to_common(left_type, right_type)
+        # TODO: Add temporal addition once delta types supported
+        raise TypeError(f"Cannot subtract dtypes {left_type} and {right_type}")
+
+
+add_op = AddOp()
+sub_op = SubOp()
+mul_op = create_binary_op(name="mul", type_signature=op_typing.BINARY_NUMERIC)
+div_op = create_binary_op(name="div", type_signature=op_typing.BINARY_REAL_NUMERIC)
+floordiv_op = create_binary_op(name="floordiv", type_signature=op_typing.BINARY_NUMERIC)
+pow_op = create_binary_op(name="pow", type_signature=op_typing.BINARY_NUMERIC)
+mod_op = create_binary_op(name="mod", type_signature=op_typing.BINARY_NUMERIC)
+arctan2_op = create_binary_op(
+    name="arctan2", type_signature=op_typing.BINARY_REAL_NUMERIC
+)
+round_op = create_binary_op(name="round", type_signature=op_typing.BINARY_REAL_NUMERIC)
+unsafe_pow_op = create_binary_op(
+    name="unsafe_pow_op", type_signature=op_typing.BINARY_REAL_NUMERIC
+)
 # Logical Ops
-and_op = create_binary_op(name="and")
-or_op = create_binary_op(name="or")
+and_op = create_binary_op(name="and", type_signature=op_typing.LOGICAL)
+or_op = create_binary_op(name="or", type_signature=op_typing.LOGICAL)
 
 ## Comparison Ops
-eq_op = create_binary_op(name="eq", type_rule=op_typing.PREDICATE)
+eq_op = create_binary_op(name="eq", type_signature=op_typing.COMPARISON)
 eq_null_match_op = create_binary_op(
-    name="eq_nulls_match", type_rule=op_typing.PREDICATE
+    name="eq_nulls_match", type_signature=op_typing.COMPARISON
 )
-ne_op = create_binary_op(name="ne", type_rule=op_typing.PREDICATE)
-lt_op = create_binary_op(name="lt", type_rule=op_typing.PREDICATE)
-gt_op = create_binary_op(name="gt", type_rule=op_typing.PREDICATE)
-le_op = create_binary_op(name="le", type_rule=op_typing.PREDICATE)
-ge_op = create_binary_op(name="ge", type_rule=op_typing.PREDICATE)
+ne_op = create_binary_op(name="ne", type_signature=op_typing.COMPARISON)
+lt_op = create_binary_op(name="lt", type_signature=op_typing.COMPARISON)
+gt_op = create_binary_op(name="gt", type_signature=op_typing.COMPARISON)
+le_op = create_binary_op(name="le", type_signature=op_typing.COMPARISON)
+ge_op = create_binary_op(name="ge", type_signature=op_typing.COMPARISON)
+
 
 ## String Ops
-strconcat_op = create_binary_op(name="strconcat", type_rule=op_typing.STRING)
+@dataclasses.dataclass(frozen=True)
+class StrConcatOp(BinaryOp):
+    name: typing.ClassVar[str] = "str_concat"
+
+    # Note: this is actualyl a vararg op, but we don't model that yet
+    def output_type(self, *input_types):
+        if not all(map(dtypes.is_string_like, input_types)):
+            raise TypeError("string concat requires string-like arguments")
+        if len(set(input_types)) != 1:
+            raise TypeError("string concat requires like-typed arguments")
+        return input_types[0]
+
+
+strconcat_op = StrConcatOp()
 
 
 # Ternary Ops
 @dataclasses.dataclass(frozen=True)
 class WhereOp(TernaryOp):
     name: typing.ClassVar[str] = "where"
 
     def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
-        # Second input is boolean and doesn't affect output type
-        return dtypes.lcd_etype(input_types[0], input_types[2])
+        if input_types[1] != dtypes.BOOL_DTYPE:
+            raise TypeError("where condition must be a boolean")
+        return dtypes.coerce_to_common(input_types[0], input_types[2])
 
 
 where_op = WhereOp()
 
 
-clip_op = create_ternary_op(name="clip", type_rule=op_typing.Supertype())
+@dataclasses.dataclass(frozen=True)
+class ClipOp(TernaryOp):
+    name: typing.ClassVar[str] = "clip"
+
+    def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
+        return dtypes.coerce_to_common(
+            input_types[0], dtypes.coerce_to_common(input_types[1], input_types[2])
+        )
+
 
+clip_op = ClipOp()
 
 # Just parameterless unary ops for now
 # TODO: Parameter mappings
 NUMPY_TO_OP: typing.Final = {
     np.sin: sin_op,
     np.cos: cos_op,
     np.tan: tan_op,
@@ -536,17 +680,22 @@
     np.arccosh: arccosh_op,
     np.arctanh: arctanh_op,
     np.exp: exp_op,
     np.log: ln_op,
     np.log10: log10_op,
     np.sqrt: sqrt_op,
     np.abs: abs_op,
+    np.floor: floor_op,
+    np.ceil: ceil_op,
+    np.log1p: log1p_op,
+    np.expm1: expm1_op,
 }
 
 
 NUMPY_TO_BINOP: typing.Final = {
     np.add: add_op,
     np.subtract: sub_op,
     np.multiply: mul_op,
     np.divide: div_op,
     np.power: pow_op,
+    np.arctan2: arctan2_op,
 }
```

### Comparing `bigframes-1.0.0/bigframes/operations/_matplotlib/__init__.py` & `bigframes-1.1.0/bigframes/operations/_matplotlib/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/_matplotlib/core.py` & `bigframes-1.1.0/bigframes/operations/_matplotlib/core.py`

 * *Files 10% similar despite different names*

```diff
@@ -10,15 +10,14 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import abc
 import typing
-import uuid
 
 import pandas as pd
 
 import bigframes.constants as constants
 import bigframes.dtypes as dtypes
 
 DEFAULT_SAMPLING_N = 1000
@@ -94,25 +93,43 @@
 
         c = self.kwargs.get("c", None)
         if self._is_sequence_arg(c):
             raise NotImplementedError(
                 f"Only support a single color string or a column name/posision. {constants.FEEDBACK_LINK}"
             )
 
+        s = self.kwargs.get("s", None)
+        if self._is_sequence_arg(s):
+            raise NotImplementedError(
+                f"Only support a single color string or a column name/posision. {constants.FEEDBACK_LINK}"
+            )
+
     def _compute_plot_data(self):
         sample = self._compute_sample_data(self.data)
 
         # Works around a pandas bug:
         # https://github.com/pandas-dev/pandas/commit/45b937d64f6b7b6971856a47e379c7c87af7e00a
         c = self.kwargs.get("c", None)
         if pd.core.dtypes.common.is_integer(c):
             c = self.data.columns[c]
         if self._is_column_name(c, sample) and sample[c].dtype == dtypes.STRING_DTYPE:
             sample[c] = sample[c].astype("object")
 
+        # To avoid Matplotlib's automatic conversion of `Float64` or `Int64` columns
+        # to `object` types (which breaks float-like behavior), this code proactively
+        # converts the column to a compatible format.
+        s = self.kwargs.get("s", None)
+        if pd.core.dtypes.common.is_integer(s):
+            s = self.data.columns[s]
+        if self._is_column_name(s, sample):
+            if sample[s].dtype == dtypes.INT_DTYPE:
+                sample[s] = sample[s].astype("int64")
+            elif sample[s].dtype == dtypes.FLOAT_DTYPE:
+                sample[s] = sample[s].astype("float64")
+
         return sample
 
     def _is_sequence_arg(self, arg):
         return (
             arg is not None
             and not isinstance(arg, str)
             and isinstance(arg, typing.Iterable)
@@ -120,13 +137,7 @@
 
     def _is_column_name(self, arg, data):
         return (
             arg is not None
             and pd.core.dtypes.common.is_hashable(arg)
             and arg in data.columns
         )
-
-    def _generate_new_column_name(self, data):
-        col_name = None
-        while col_name is None or col_name in data.columns:
-            col_name = f"plot_temp_{str(uuid.uuid4())[:8]}"
-        return col_name
```

### Comparing `bigframes-1.0.0/bigframes/operations/_matplotlib/hist.py` & `bigframes-1.1.0/bigframes/operations/_matplotlib/hist.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/aggregations.py` & `bigframes-1.1.0/bigframes/operations/aggregations.py`

 * *Files 2% similar despite different names*

```diff
@@ -135,18 +135,15 @@
 
 
 @dataclasses.dataclass(frozen=True)
 class ProductOp(UnaryAggregateOp):
     name: ClassVar[str] = "product"
 
     def output_type(self, *input_types: dtypes.ExpressionType):
-        if pd.api.types.is_bool_dtype(input_types[0]):
-            return dtypes.INT_DTYPE
-        else:
-            return input_types[0]
+        return dtypes.FLOAT_DTYPE
 
 
 @dataclasses.dataclass(frozen=True)
 class MaxOp(UnaryAggregateOp):
     name: ClassVar[str] = "max"
```

### Comparing `bigframes-1.0.0/bigframes/operations/base.py` & `bigframes-1.1.0/bigframes/operations/base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/datetimes.py` & `bigframes-1.1.0/bigframes/operations/datetimes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/plotting.py` & `bigframes-1.1.0/bigframes/operations/plotting.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/strings.py` & `bigframes-1.1.0/bigframes/operations/strings.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/operations/structs.py` & `bigframes-1.1.0/bigframes/operations/structs.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/pandas/__init__.py` & `bigframes-1.1.0/bigframes/pandas/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -573,15 +573,30 @@
         col_order=col_order,
     )
 
 
 read_gbq_table.__doc__ = inspect.getdoc(bigframes.session.Session.read_gbq_table)
 
 
+@typing.overload
 def read_pandas(pandas_dataframe: pandas.DataFrame) -> bigframes.dataframe.DataFrame:
+    ...
+
+
+@typing.overload
+def read_pandas(pandas_dataframe: pandas.Series) -> bigframes.series.Series:
+    ...
+
+
+@typing.overload
+def read_pandas(pandas_dataframe: pandas.Index) -> bigframes.core.indexes.Index:
+    ...
+
+
+def read_pandas(pandas_dataframe: Union[pandas.DataFrame, pandas.Series, pandas.Index]):
     return global_session.with_default_session(
         bigframes.session.Session.read_pandas,
         pandas_dataframe,
     )
 
 
 read_pandas.__doc__ = inspect.getdoc(bigframes.session.Session.read_pandas)
@@ -710,17 +725,21 @@
 
 # SQL Compilation uses recursive algorithms on deep trees
 # 10M tree depth should be sufficient to generate any sql that is under bigquery limit
 # Note: This limit does not have the desired effect on Python 3.12 in
 # which the applicable limit is now hard coded. See:
 # https://github.com/python/cpython/issues/112282
 sys.setrecursionlimit(max(10000000, sys.getrecursionlimit()))
-resource.setrlimit(
-    resource.RLIMIT_STACK, (resource.RLIM_INFINITY, resource.RLIM_INFINITY)
-)
+
+soft_limit, hard_limit = resource.getrlimit(resource.RLIMIT_STACK)
+if soft_limit < hard_limit or hard_limit == resource.RLIM_INFINITY:
+    try:
+        resource.setrlimit(resource.RLIMIT_STACK, (hard_limit, hard_limit))
+    except Exception:
+        pass
 
 # Use __all__ to let type checkers know what is part of the public API.
 __all___ = [
     # Functions
     "concat",
     "merge",
     "read_csv",
```

### Comparing `bigframes-1.0.0/bigframes/series.py` & `bigframes-1.1.0/bigframes/series.py`

 * *Files 1% similar despite different names*

```diff
@@ -172,14 +172,15 @@
     def _set_internal_query_job(self, query_job: bigquery.QueryJob):
         self._query_job = query_job
 
     def __len__(self):
         return self.shape[0]
 
     def __iter__(self) -> typing.Iterator:
+        self._optimize_query_complexity()
         return itertools.chain.from_iterable(
             map(lambda x: x.squeeze(axis=1), self._block.to_pandas_batches())
         )
 
     def copy(self) -> Series:
         return Series(self._block)
 
@@ -324,14 +325,15 @@
                 In some cases, unordered may result in a faster-executing query.
 
 
         Returns:
             pandas.Series: A pandas Series with all rows of this Series if the data_sampling_threshold_mb
                 is not exceeded; otherwise, a pandas Series with downsampled rows of the DataFrame.
         """
+        self._optimize_query_complexity()
         df, query_job = self._block.to_pandas(
             max_download_size=max_download_size,
             sampling_method=sampling_method,
             random_state=random_state,
             ordered=ordered,
         )
         self._set_internal_query_job(query_job)
@@ -347,17 +349,19 @@
         labels: typing.Any = None,
         *,
         axis: typing.Union[int, str] = 0,
         index: typing.Any = None,
         columns: Union[blocks.Label, typing.Iterable[blocks.Label]] = None,
         level: typing.Optional[LevelType] = None,
     ) -> Series:
-        if labels and index:
-            raise ValueError("Must specify exacly one of 'labels' or 'index'")
-        index = labels or index
+        if (labels is None) == (index is None):
+            raise ValueError("Must specify exactly one of 'labels' or 'index'")
+
+        if labels is not None:
+            index = labels
 
         # ignore axis, columns params
         block = self._block
         level_id = self._resolve_levels(level or 0)[0]
         if _is_list_like(index):
             block, inverse_condition_id = block.apply_unary_op(
                 level_id, ops.IsInOp(values=tuple(index), match_nulls=True)
@@ -1510,15 +1514,15 @@
             if verify_integrity:
                 error_message = "When verify_integrity is True in Series.map, index of arg parameter must not have duplicate entries."
                 arg._throw_if_index_contains_duplicates(error_message=error_message)
             map_df = bigframes.dataframe.DataFrame(arg._block)
             map_df = map_df.rename(columns={arg.name: self.name})
         elif isinstance(arg, Mapping):
             map_df = bigframes.dataframe.DataFrame(
-                {"keys": list(arg.keys()), self.name: list(arg.values())},
+                {"keys": list(arg.keys()), self.name: list(arg.values())},  # type: ignore
                 session=self._get_block().expr.session,
             )
             map_df = map_df.set_index("keys")
         elif callable(arg):
             return self.apply(arg)
         else:
             # Mirroring pandas, call the uncallable object
@@ -1543,14 +1547,21 @@
         fracs = (frac,) if frac is not None else ()
         return Series(
             self._block._split(
                 ns=ns, fracs=fracs, random_state=random_state, sort=sort
             )[0]
         )
 
+    def explode(self, *, ignore_index: Optional[bool] = False) -> Series:
+        return Series(
+            self._block.explode(
+                column_ids=[self._value_column], ignore_index=ignore_index
+            )
+        )
+
     def __array_ufunc__(
         self, ufunc: numpy.ufunc, method: str, *inputs, **kwargs
     ) -> Series:
         """Used to support numpy ufuncs.
         See: https://numpy.org/doc/stable/reference/ufuncs.html
         """
         # Only __call__ supported with zero arguments
@@ -1590,10 +1601,18 @@
             ),
         )
 
     def _cached(self, *, force: bool = True) -> Series:
         self._set_block(self._block.cached(force=force))
         return self
 
+    def _optimize_query_complexity(self):
+        """Reduce query complexity by caching repeated subtrees and recursively materializing maximum-complexity subtrees.
+        May generate many queries and take substantial time to execute.
+        """
+        # TODO: Move all this to session
+        new_expr = self._block.session._simplify_with_caching(self._block.expr)
+        self._set_block(self._block.swap_array_expr(new_expr))
+
 
 def _is_list_like(obj: typing.Any) -> typing_extensions.TypeGuard[typing.Sequence]:
     return pandas.api.types.is_list_like(obj)
```

### Comparing `bigframes-1.0.0/bigframes/session/__init__.py` & `bigframes-1.1.0/bigframes/session/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -151,4687 +151,4910 @@
 00000960: 6f72 6520 6173 2063 6f72 650a 696d 706f  ore as core.impo
 00000970: 7274 2062 6967 6672 616d 6573 2e63 6f72  rt bigframes.cor
 00000980: 652e 626c 6f63 6b73 2061 7320 626c 6f63  e.blocks as bloc
 00000990: 6b73 0a69 6d70 6f72 7420 6269 6766 7261  ks.import bigfra
 000009a0: 6d65 732e 636f 7265 2e63 6f6d 7069 6c65  mes.core.compile
 000009b0: 0a69 6d70 6f72 7420 6269 6766 7261 6d65  .import bigframe
 000009c0: 732e 636f 7265 2e67 7569 6420 6173 2067  s.core.guid as g
-000009d0: 7569 640a 6672 6f6d 2062 6967 6672 616d  uid.from bigfram
-000009e0: 6573 2e63 6f72 652e 6f72 6465 7269 6e67  es.core.ordering
-000009f0: 2069 6d70 6f72 7420 496e 7465 6765 7245   import IntegerE
-00000a00: 6e63 6f64 696e 670a 696d 706f 7274 2062  ncoding.import b
-00000a10: 6967 6672 616d 6573 2e63 6f72 652e 6f72  igframes.core.or
-00000a20: 6465 7269 6e67 2061 7320 6f72 6465 720a  dering as order.
-00000a30: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
-00000a40: 2e63 6f72 652e 7472 6176 6572 7361 6c20  .core.traversal 
-00000a50: 6173 2074 7261 7665 7273 616c 730a 696d  as traversals.im
-00000a60: 706f 7274 2062 6967 6672 616d 6573 2e63  port bigframes.c
-00000a70: 6f72 652e 7574 696c 7320 6173 2075 7469  ore.utils as uti
-00000a80: 6c73 0a69 6d70 6f72 7420 6269 6766 7261  ls.import bigfra
-00000a90: 6d65 732e 6474 7970 6573 0a69 6d70 6f72  mes.dtypes.impor
-00000aa0: 7420 6269 6766 7261 6d65 732e 666f 726d  t bigframes.form
-00000ab0: 6174 7469 6e67 5f68 656c 7065 7273 2061  atting_helpers a
-00000ac0: 7320 666f 726d 6174 7469 6e67 5f68 656c  s formatting_hel
-00000ad0: 7065 7273 0a66 726f 6d20 6269 6766 7261  pers.from bigfra
-00000ae0: 6d65 732e 6675 6e63 7469 6f6e 732e 7265  mes.functions.re
-00000af0: 6d6f 7465 5f66 756e 6374 696f 6e20 696d  mote_function im
-00000b00: 706f 7274 2072 6561 645f 6762 715f 6675  port read_gbq_fu
-00000b10: 6e63 7469 6f6e 2061 7320 6269 6766 7261  nction as bigfra
-00000b20: 6d65 735f 7267 660a 6672 6f6d 2062 6967  mes_rgf.from big
-00000b30: 6672 616d 6573 2e66 756e 6374 696f 6e73  frames.functions
-00000b40: 2e72 656d 6f74 655f 6675 6e63 7469 6f6e  .remote_function
-00000b50: 2069 6d70 6f72 7420 7265 6d6f 7465 5f66   import remote_f
-00000b60: 756e 6374 696f 6e20 6173 2062 6967 6672  unction as bigfr
-00000b70: 616d 6573 5f72 660a 696d 706f 7274 2062  ames_rf.import b
-00000b80: 6967 6672 616d 6573 2e73 6573 7369 6f6e  igframes.session
-00000b90: 2e5f 696f 2e62 6967 7175 6572 7920 6173  ._io.bigquery as
-00000ba0: 2062 6967 6672 616d 6573 5f69 6f0a 696d   bigframes_io.im
-00000bb0: 706f 7274 2062 6967 6672 616d 6573 2e73  port bigframes.s
-00000bc0: 6573 7369 6f6e 2e63 6c69 656e 7473 0a69  ession.clients.i
-00000bd0: 6d70 6f72 7420 6269 6766 7261 6d65 732e  mport bigframes.
-00000be0: 7665 7273 696f 6e0a 0a23 2041 766f 6964  version..# Avoid
-00000bf0: 2063 6972 6375 6c61 7220 696d 706f 7274   circular import
-00000c00: 732e 0a69 6620 7479 7069 6e67 2e54 5950  s..if typing.TYP
-00000c10: 455f 4348 4543 4b49 4e47 3a0a 2020 2020  E_CHECKING:.    
-00000c20: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
-00000c30: 2e64 6174 6166 7261 6d65 2061 7320 6461  .dataframe as da
-00000c40: 7461 6672 616d 650a 0a5f 4249 4746 5241  taframe.._BIGFRA
-00000c50: 4d45 535f 4445 4641 554c 545f 434f 4e4e  MES_DEFAULT_CONN
-00000c60: 4543 5449 4f4e 5f49 4420 3d20 2262 6967  ECTION_ID = "big
-00000c70: 6672 616d 6573 2d64 6566 6175 6c74 2d63  frames-default-c
-00000c80: 6f6e 6e65 6374 696f 6e22 0a0a 5f4d 4158  onnection".._MAX
-00000c90: 5f43 4c55 5354 4552 5f43 4f4c 554d 4e53  _CLUSTER_COLUMNS
-00000ca0: 203d 2034 0a0a 2320 544f 444f 2873 7761   = 4..# TODO(swa
-00000cb0: 7374 293a 204e 6565 6420 746f 2063 6f6e  st): Need to con
-00000cc0: 6e65 6374 2074 6f20 7265 6769 6f6e 616c  nect to regional
-00000cd0: 2065 6e64 706f 696e 7473 2077 6865 6e20   endpoints when 
-00000ce0: 7065 7266 6f72 6d69 6e67 2072 656d 6f74  performing remot
-00000cf0: 650a 2320 6675 6e63 7469 6f6e 7320 6f70  e.# functions op
-00000d00: 6572 6174 696f 6e73 2028 4251 2043 6f6e  erations (BQ Con
-00000d10: 6e65 6374 696f 6e20 4941 4d2c 2043 6c6f  nection IAM, Clo
-00000d20: 7564 2052 756e 202f 2043 6c6f 7564 2046  ud Run / Cloud F
-00000d30: 756e 6374 696f 6e73 292e 0a23 2041 6c73  unctions)..# Als
-00000d40: 6f20 7365 6520 6966 2072 6573 6f75 7263  o see if resourc
-00000d50: 6520 6d61 6e61 6765 7220 636c 6965 6e74  e manager client
-00000d60: 206c 6962 7261 7279 2073 7570 706f 7274   library support
-00000d70: 7320 7265 6769 6f6e 616c 2065 6e64 706f  s regional endpo
-00000d80: 696e 7473 2e0a 0a5f 5641 4c49 445f 454e  ints..._VALID_EN
-00000d90: 434f 4449 4e47 5320 3d20 7b0a 2020 2020  CODINGS = {.    
-00000da0: 2255 5446 2d38 222c 0a20 2020 2022 4953  "UTF-8",.    "IS
-00000db0: 4f2d 3838 3539 2d31 222c 0a20 2020 2022  O-8859-1",.    "
-00000dc0: 5554 462d 3136 4245 222c 0a20 2020 2022  UTF-16BE",.    "
-00000dd0: 5554 462d 3136 4c45 222c 0a20 2020 2022  UTF-16LE",.    "
-00000de0: 5554 462d 3332 4245 222c 0a20 2020 2022  UTF-32BE",.    "
-00000df0: 5554 462d 3332 4c45 222c 0a7d 0a0a 2320  UTF-32LE",.}..# 
-00000e00: 4269 6751 7565 7279 2068 6173 2031 204d  BigQuery has 1 M
-00000e10: 4220 7175 6572 7920 7369 7a65 206c 696d  B query size lim
-00000e20: 6974 2c20 3530 3030 2069 7465 6d73 2073  it, 5000 items s
-00000e30: 686f 756c 646e 2774 2074 616b 6520 6d6f  houldn't take mo
-00000e40: 7265 2074 6861 6e20 3130 2520 6f66 2074  re than 10% of t
-00000e50: 6869 7320 6465 7065 6e64 696e 6720 6f6e  his depending on
-00000e60: 2064 6174 6120 7479 7065 2e0a 2320 544f   data type..# TO
-00000e70: 444f 2874 6265 7267 6572 6f6e 293a 2043  DO(tbergeron): C
-00000e80: 6f6e 7665 7274 2074 6f20 6279 7465 732d  onvert to bytes-
-00000e90: 6261 7365 6420 6c69 6d69 740a 4d41 585f  based limit.MAX_
-00000ea0: 494e 4c49 4e45 5f44 465f 5349 5a45 203d  INLINE_DF_SIZE =
-00000eb0: 2035 3030 300a 0a6c 6f67 6765 7220 3d20   5000..logger = 
-00000ec0: 6c6f 6767 696e 672e 6765 744c 6f67 6765  logging.getLogge
-00000ed0: 7228 5f5f 6e61 6d65 5f5f 290a 0a23 2045  r(__name__)..# E
-00000ee0: 7863 6c75 6465 7320 6765 6f67 7261 7068  xcludes geograph
-00000ef0: 792c 2062 7974 6573 2c20 616e 6420 6e65  y, bytes, and ne
-00000f00: 7374 6564 2028 6172 7261 792c 2073 7472  sted (array, str
-00000f10: 7563 7429 2064 6174 6174 7970 6573 0a49  uct) datatypes.I
-00000f20: 4e4c 494e 4142 4c45 5f44 5459 5045 533a  NLINABLE_DTYPES:
-00000f30: 2053 6571 7565 6e63 655b 6269 6766 7261   Sequence[bigfra
-00000f40: 6d65 732e 6474 7970 6573 2e44 7479 7065  mes.dtypes.Dtype
-00000f50: 5d20 3d20 280a 2020 2020 7061 6e64 6173  ] = (.    pandas
-00000f60: 2e42 6f6f 6c65 616e 4474 7970 6528 292c  .BooleanDtype(),
-00000f70: 0a20 2020 2070 616e 6461 732e 466c 6f61  .    pandas.Floa
-00000f80: 7436 3444 7479 7065 2829 2c0a 2020 2020  t64Dtype(),.    
-00000f90: 7061 6e64 6173 2e49 6e74 3634 4474 7970  pandas.Int64Dtyp
-00000fa0: 6528 292c 0a20 2020 2070 616e 6461 732e  e(),.    pandas.
-00000fb0: 5374 7269 6e67 4474 7970 6528 7374 6f72  StringDtype(stor
-00000fc0: 6167 653d 2270 7961 7272 6f77 2229 2c0a  age="pyarrow"),.
-00000fd0: 2020 2020 7061 6e64 6173 2e41 7272 6f77      pandas.Arrow
-00000fe0: 4474 7970 6528 7061 2e64 6174 6533 3228  Dtype(pa.date32(
-00000ff0: 2929 2c0a 2020 2020 7061 6e64 6173 2e41  )),.    pandas.A
-00001000: 7272 6f77 4474 7970 6528 7061 2e74 696d  rrowDtype(pa.tim
-00001010: 6536 3428 2275 7322 2929 2c0a 2020 2020  e64("us")),.    
-00001020: 7061 6e64 6173 2e41 7272 6f77 4474 7970  pandas.ArrowDtyp
-00001030: 6528 7061 2e74 696d 6573 7461 6d70 2822  e(pa.timestamp("
-00001040: 7573 2229 292c 0a20 2020 2070 616e 6461  us")),.    panda
-00001050: 732e 4172 726f 7744 7479 7065 2870 612e  s.ArrowDtype(pa.
-00001060: 7469 6d65 7374 616d 7028 2275 7322 2c20  timestamp("us", 
-00001070: 747a 3d22 5554 4322 2929 2c0a 2020 2020  tz="UTC")),.    
-00001080: 7061 6e64 6173 2e41 7272 6f77 4474 7970  pandas.ArrowDtyp
-00001090: 6528 7061 2e64 6563 696d 616c 3132 3828  e(pa.decimal128(
-000010a0: 3338 2c20 3929 292c 0a20 2020 2070 616e  38, 9)),.    pan
-000010b0: 6461 732e 4172 726f 7744 7479 7065 2870  das.ArrowDtype(p
-000010c0: 612e 6465 6369 6d61 6c32 3536 2837 362c  a.decimal256(76,
-000010d0: 2033 3829 292c 0a29 0a0a 0a64 6566 205f   38)),.)...def _
-000010e0: 6973 5f71 7565 7279 2871 7565 7279 5f6f  is_query(query_o
-000010f0: 725f 7461 626c 653a 2073 7472 2920 2d3e  r_table: str) ->
-00001100: 2062 6f6f 6c3a 0a20 2020 2022 2222 4465   bool:.    """De
-00001110: 7465 726d 696e 6520 6966 2060 7175 6572  termine if `quer
-00001120: 795f 6f72 5f74 6162 6c65 6020 6973 2061  y_or_table` is a
-00001130: 2074 6162 6c65 2049 4420 6f72 2061 2053   table ID or a S
-00001140: 514c 2073 7472 696e 6722 2222 0a20 2020  QL string""".   
-00001150: 2072 6574 7572 6e20 7265 2e73 6561 7263   return re.searc
-00001160: 6828 7222 5c73 222c 2071 7565 7279 5f6f  h(r"\s", query_o
-00001170: 725f 7461 626c 652e 7374 7269 7028 292c  r_table.strip(),
-00001180: 2072 652e 4d55 4c54 494c 494e 4529 2069   re.MULTILINE) i
-00001190: 7320 6e6f 7420 4e6f 6e65 0a0a 0a64 6566  s not None...def
-000011a0: 205f 6973 5f74 6162 6c65 5f77 6974 685f   _is_table_with_
-000011b0: 7769 6c64 6361 7264 5f73 7566 6669 7828  wildcard_suffix(
-000011c0: 7175 6572 795f 6f72 5f74 6162 6c65 3a20  query_or_table: 
-000011d0: 7374 7229 202d 3e20 626f 6f6c 3a0a 2020  str) -> bool:.  
-000011e0: 2020 2222 2244 6574 6572 6d69 6e65 2069    """Determine i
-000011f0: 6620 6071 7565 7279 5f6f 725f 7461 626c  f `query_or_tabl
-00001200: 6560 2069 7320 6120 7461 626c 6520 616e  e` is a table an
-00001210: 6420 636f 6e74 6169 6e73 2061 2077 696c  d contains a wil
-00001220: 6463 6172 6420 7375 6666 6978 2e22 2222  dcard suffix."""
-00001230: 0a20 2020 2072 6574 7572 6e20 6e6f 7420  .    return not 
-00001240: 5f69 735f 7175 6572 7928 7175 6572 795f  _is_query(query_
-00001250: 6f72 5f74 6162 6c65 2920 616e 6420 7175  or_table) and qu
-00001260: 6572 795f 6f72 5f74 6162 6c65 2e65 6e64  ery_or_table.end
-00001270: 7377 6974 6828 222a 2229 0a0a 0a63 6c61  swith("*")...cla
-00001280: 7373 2053 6573 7369 6f6e 280a 2020 2020  ss Session(.    
-00001290: 7468 6972 645f 7061 7274 795f 7061 6e64  third_party_pand
-000012a0: 6173 5f67 6271 2e47 4251 494f 4d69 7869  as_gbq.GBQIOMixi
-000012b0: 6e2c 0a20 2020 2074 6869 7264 5f70 6172  n,.    third_par
-000012c0: 7479 5f70 616e 6461 735f 7061 7271 7565  ty_pandas_parque
-000012d0: 742e 5061 7271 7565 7449 4f4d 6978 696e  t.ParquetIOMixin
-000012e0: 2c0a 2020 2020 7468 6972 645f 7061 7274  ,.    third_part
-000012f0: 795f 7061 6e64 6173 5f70 6963 6b6c 652e  y_pandas_pickle.
-00001300: 5069 636b 6c65 494f 4d69 7869 6e2c 0a20  PickleIOMixin,. 
-00001310: 2020 2074 6869 7264 5f70 6172 7479 5f70     third_party_p
-00001320: 616e 6461 735f 7265 6164 6572 732e 5265  andas_readers.Re
-00001330: 6164 6572 494f 4d69 7869 6e2c 0a29 3a0a  aderIOMixin,.):.
-00001340: 2020 2020 2222 2245 7374 6162 6c69 7368      """Establish
-00001350: 6573 2061 2042 6967 5175 6572 7920 636f  es a BigQuery co
-00001360: 6e6e 6563 7469 6f6e 2074 6f20 6361 7074  nnection to capt
-00001370: 7572 6520 6120 6772 6f75 7020 6f66 206a  ure a group of j
-00001380: 6f62 2061 6374 6976 6974 6965 7320 7265  ob activities re
-00001390: 6c61 7465 6420 746f 0a20 2020 2044 6174  lated to.    Dat
-000013a0: 6146 7261 6d65 732e 0a0a 2020 2020 4172  aFrames...    Ar
-000013b0: 6773 3a0a 2020 2020 2020 2020 636f 6e74  gs:.        cont
-000013c0: 6578 7420 2862 6967 6672 616d 6573 2e5f  ext (bigframes._
-000013d0: 636f 6e66 6967 2e62 6967 7175 6572 795f  config.bigquery_
-000013e0: 6f70 7469 6f6e 732e 4269 6751 7565 7279  options.BigQuery
-000013f0: 4f70 7469 6f6e 7329 3a0a 2020 2020 2020  Options):.      
-00001400: 2020 2020 2020 436f 6e66 6967 7572 6174        Configurat
-00001410: 696f 6e20 6164 6a75 7374 696e 6720 686f  ion adjusting ho
-00001420: 7720 746f 2063 6f6e 6e65 6374 2074 6f20  w to connect to 
-00001430: 4269 6751 7565 7279 2061 6e64 2072 656c  BigQuery and rel
-00001440: 6174 6564 0a20 2020 2020 2020 2020 2020  ated.           
-00001450: 2041 5049 732e 204e 6f74 6520 7468 6174   APIs. Note that
-00001460: 2073 6f6d 6520 6f70 7469 6f6e 7320 6172   some options ar
-00001470: 6520 6967 6e6f 7265 6420 6966 2060 6063  e ignored if ``c
-00001480: 6c69 656e 7473 5f70 726f 7669 6465 7260  lients_provider`
-00001490: 6020 6973 0a20 2020 2020 2020 2020 2020  ` is.           
-000014a0: 2073 6574 2e0a 2020 2020 2020 2020 636c   set..        cl
-000014b0: 6965 6e74 735f 7072 6f76 6964 6572 2028  ients_provider (
-000014c0: 6269 6766 7261 6d65 732e 7365 7373 696f  bigframes.sessio
-000014d0: 6e2e 636c 6965 6e74 732e 436c 6965 6e74  n.clients.Client
-000014e0: 7350 726f 7669 6465 7229 3a0a 2020 2020  sProvider):.    
-000014f0: 2020 2020 2020 2020 416e 206f 626a 6563          An objec
-00001500: 7420 7072 6f76 6964 696e 6720 636c 6965  t providing clie
-00001510: 6e74 206c 6962 7261 7279 206f 626a 6563  nt library objec
-00001520: 7473 2e0a 2020 2020 2222 220a 0a20 2020  ts..    """..   
-00001530: 2064 6566 205f 5f69 6e69 745f 5f28 0a20   def __init__(. 
-00001540: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00001550: 2020 2020 2063 6f6e 7465 7874 3a20 4f70       context: Op
-00001560: 7469 6f6e 616c 5b62 6967 7175 6572 795f  tional[bigquery_
-00001570: 6f70 7469 6f6e 732e 4269 6751 7565 7279  options.BigQuery
-00001580: 4f70 7469 6f6e 735d 203d 204e 6f6e 652c  Options] = None,
-00001590: 0a20 2020 2020 2020 2063 6c69 656e 7473  .        clients
-000015a0: 5f70 726f 7669 6465 723a 204f 7074 696f  _provider: Optio
-000015b0: 6e61 6c5b 6269 6766 7261 6d65 732e 7365  nal[bigframes.se
-000015c0: 7373 696f 6e2e 636c 6965 6e74 732e 436c  ssion.clients.Cl
-000015d0: 6965 6e74 7350 726f 7669 6465 725d 203d  ientsProvider] =
-000015e0: 204e 6f6e 652c 0a20 2020 2029 3a0a 2020   None,.    ):.  
-000015f0: 2020 2020 2020 6966 2063 6f6e 7465 7874        if context
-00001600: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00001610: 2020 2020 2020 636f 6e74 6578 7420 3d20        context = 
-00001620: 6269 6771 7565 7279 5f6f 7074 696f 6e73  bigquery_options
-00001630: 2e42 6967 5175 6572 794f 7074 696f 6e73  .BigQueryOptions
-00001640: 2829 0a0a 2020 2020 2020 2020 2320 544f  ()..        # TO
-00001650: 444f 2873 7761 7374 293a 2047 6574 206c  DO(swast): Get l
-00001660: 6f63 6174 696f 6e20 6672 6f6d 2074 6865  ocation from the
-00001670: 2065 6e76 6972 6f6e 6d65 6e74 2e0a 2020   environment..  
-00001680: 2020 2020 2020 6966 2063 6f6e 7465 7874        if context
-00001690: 2e6c 6f63 6174 696f 6e20 6973 204e 6f6e  .location is Non
-000016a0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-000016b0: 656c 662e 5f6c 6f63 6174 696f 6e20 3d20  elf._location = 
-000016c0: 2255 5322 0a20 2020 2020 2020 2020 2020  "US".           
-000016d0: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-000016e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016f0: 6622 4e6f 2065 7870 6c69 6369 7420 6c6f  f"No explicit lo
-00001700: 6361 7469 6f6e 2069 7320 7365 742c 2073  cation is set, s
-00001710: 6f20 7573 696e 6720 6c6f 6361 7469 6f6e  o using location
-00001720: 207b 7365 6c66 2e5f 6c6f 6361 7469 6f6e   {self._location
-00001730: 7d20 666f 7220 7468 6520 7365 7373 696f  } for the sessio
-00001740: 6e2e 222c 0a20 2020 2020 2020 2020 2020  n.",.           
-00001750: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
-00001760: 322c 0a20 2020 2020 2020 2020 2020 2029  2,.            )
-00001770: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00001780: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001790: 5f6c 6f63 6174 696f 6e20 3d20 636f 6e74  _location = cont
-000017a0: 6578 742e 6c6f 6361 7469 6f6e 0a0a 2020  ext.location..  
-000017b0: 2020 2020 2020 7365 6c66 2e5f 6271 5f6b        self._bq_k
-000017c0: 6d73 5f6b 6579 5f6e 616d 6520 3d20 636f  ms_key_name = co
-000017d0: 6e74 6578 742e 6b6d 735f 6b65 795f 6e61  ntext.kms_key_na
-000017e0: 6d65 0a0a 2020 2020 2020 2020 2320 496e  me..        # In
-000017f0: 7374 616e 7469 6174 6520 6120 636c 6965  stantiate a clie
-00001800: 6e74 7320 7072 6f76 6964 6572 2074 6f20  nts provider to 
-00001810: 6865 6c70 2077 6974 6820 636c 6f75 6420  help with cloud 
-00001820: 636c 6965 6e74 7320 7468 6174 2077 696c  clients that wil
-00001830: 6c20 6265 0a20 2020 2020 2020 2023 2075  l be.        # u
-00001840: 7365 6420 696e 2074 6865 2066 7574 7572  sed in the futur
-00001850: 6520 6f70 6572 6174 696f 6e73 2069 6e20  e operations in 
-00001860: 7468 6520 7365 7373 696f 6e0a 2020 2020  the session.    
-00001870: 2020 2020 6966 2063 6c69 656e 7473 5f70      if clients_p
-00001880: 726f 7669 6465 723a 0a20 2020 2020 2020  rovider:.       
-00001890: 2020 2020 2073 656c 662e 5f63 6c69 656e       self._clien
-000018a0: 7473 5f70 726f 7669 6465 7220 3d20 636c  ts_provider = cl
-000018b0: 6965 6e74 735f 7072 6f76 6964 6572 0a20  ients_provider. 
-000018c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000018d0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-000018e0: 6c69 656e 7473 5f70 726f 7669 6465 7220  lients_provider 
-000018f0: 3d20 6269 6766 7261 6d65 732e 7365 7373  = bigframes.sess
-00001900: 696f 6e2e 636c 6965 6e74 732e 436c 6965  ion.clients.Clie
-00001910: 6e74 7350 726f 7669 6465 7228 0a20 2020  ntsProvider(.   
-00001920: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-00001930: 6a65 6374 3d63 6f6e 7465 7874 2e70 726f  ject=context.pro
-00001940: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
-00001950: 2020 2020 2020 6c6f 6361 7469 6f6e 3d73        location=s
-00001960: 656c 662e 5f6c 6f63 6174 696f 6e2c 0a20  elf._location,. 
-00001970: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00001980: 7365 5f72 6567 696f 6e61 6c5f 656e 6470  se_regional_endp
-00001990: 6f69 6e74 733d 636f 6e74 6578 742e 7573  oints=context.us
-000019a0: 655f 7265 6769 6f6e 616c 5f65 6e64 706f  e_regional_endpo
-000019b0: 696e 7473 2c0a 2020 2020 2020 2020 2020  ints,.          
-000019c0: 2020 2020 2020 6372 6564 656e 7469 616c        credential
-000019d0: 733d 636f 6e74 6578 742e 6372 6564 656e  s=context.creden
-000019e0: 7469 616c 732c 0a20 2020 2020 2020 2020  tials,.         
-000019f0: 2020 2020 2020 2061 7070 6c69 6361 7469         applicati
-00001a00: 6f6e 5f6e 616d 653d 636f 6e74 6578 742e  on_name=context.
-00001a10: 6170 706c 6963 6174 696f 6e5f 6e61 6d65  application_name
-00001a20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001a30: 2020 6271 5f6b 6d73 5f6b 6579 5f6e 616d    bq_kms_key_nam
-00001a40: 653d 7365 6c66 2e5f 6271 5f6b 6d73 5f6b  e=self._bq_kms_k
-00001a50: 6579 5f6e 616d 652c 0a20 2020 2020 2020  ey_name,.       
-00001a60: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00001a70: 7365 6c66 2e5f 6372 6561 7465 5f62 715f  self._create_bq_
-00001a80: 6461 7461 7365 7473 2829 0a0a 2020 2020  datasets()..    
-00001a90: 2020 2020 2320 544f 444f 2873 686f 6273      # TODO(shobs
-00001aa0: 293a 2052 656d 6f76 6520 7468 6973 206c  ): Remove this l
-00001ab0: 6f67 6963 2061 6674 6572 2068 7474 7073  ogic after https
-00001ac0: 3a2f 2f67 6974 6875 622e 636f 6d2f 6962  ://github.com/ib
-00001ad0: 6973 2d70 726f 6a65 6374 2f69 6269 732f  is-project/ibis/
-00001ae0: 6973 7375 6573 2f38 3439 340a 2020 2020  issues/8494.    
-00001af0: 2020 2020 2320 6861 7320 6265 656e 2066      # has been f
-00001b00: 6978 6564 2e20 5468 6520 6962 6973 2063  ixed. The ibis c
-00001b10: 6c69 656e 7420 6368 616e 6765 7320 7468  lient changes th
-00001b20: 6520 6465 6661 756c 7420 7175 6572 7920  e default query 
-00001b30: 6a6f 6220 636f 6e66 6967 0a20 2020 2020  job config.     
-00001b40: 2020 2023 2073 6f20 7765 2061 7265 2067     # so we are g
-00001b50: 6f69 6e67 2074 6f20 7265 6d65 6d62 6572  oing to remember
-00001b60: 2074 6865 2063 7572 7265 6e74 2063 6f6e   the current con
-00001b70: 6669 6720 616e 6420 7265 7374 6f72 6520  fig and restore 
-00001b80: 6974 2061 6674 6572 0a20 2020 2020 2020  it after.       
-00001b90: 2023 2074 6865 2069 6269 7320 636c 6965   # the ibis clie
-00001ba0: 6e74 2068 6173 2062 6565 6e20 6372 6561  nt has been crea
-00001bb0: 7465 640a 2020 2020 2020 2020 6f72 6967  ted.        orig
-00001bc0: 696e 616c 5f64 6566 6175 6c74 5f71 7565  inal_default_que
-00001bd0: 7279 5f6a 6f62 5f63 6f6e 6669 6720 3d20  ry_job_config = 
-00001be0: 7365 6c66 2e62 7163 6c69 656e 742e 6465  self.bqclient.de
-00001bf0: 6661 756c 745f 7175 6572 795f 6a6f 625f  fault_query_job_
-00001c00: 636f 6e66 6967 0a0a 2020 2020 2020 2020  config..        
-00001c10: 7365 6c66 2e69 6269 735f 636c 6965 6e74  self.ibis_client
-00001c20: 203d 2074 7970 696e 672e 6361 7374 280a   = typing.cast(.
-00001c30: 2020 2020 2020 2020 2020 2020 6962 6973              ibis
-00001c40: 5f62 6967 7175 6572 792e 4261 636b 656e  _bigquery.Backen
-00001c50: 642c 0a20 2020 2020 2020 2020 2020 2069  d,.            i
-00001c60: 6269 732e 6269 6771 7565 7279 2e63 6f6e  bis.bigquery.con
-00001c70: 6e65 6374 280a 2020 2020 2020 2020 2020  nect(.          
-00001c80: 2020 2020 2020 7072 6f6a 6563 745f 6964        project_id
-00001c90: 3d63 6f6e 7465 7874 2e70 726f 6a65 6374  =context.project
-00001ca0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001cb0: 2020 636c 6965 6e74 3d73 656c 662e 6271    client=self.bq
-00001cc0: 636c 6965 6e74 2c0a 2020 2020 2020 2020  client,.        
-00001cd0: 2020 2020 2020 2020 7374 6f72 6167 655f          storage_
-00001ce0: 636c 6965 6e74 3d73 656c 662e 6271 7374  client=self.bqst
-00001cf0: 6f72 6167 6572 6561 6463 6c69 656e 742c  oragereadclient,
-00001d00: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00001d10: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00001d20: 2020 2073 656c 662e 6271 636c 6965 6e74     self.bqclient
-00001d30: 2e64 6566 6175 6c74 5f71 7565 7279 5f6a  .default_query_j
-00001d40: 6f62 5f63 6f6e 6669 6720 3d20 6f72 6967  ob_config = orig
-00001d50: 696e 616c 5f64 6566 6175 6c74 5f71 7565  inal_default_que
-00001d60: 7279 5f6a 6f62 5f63 6f6e 6669 670a 0a20  ry_job_config.. 
-00001d70: 2020 2020 2020 2023 2052 6573 6f6c 7665         # Resolve
-00001d80: 2074 6865 2042 5120 636f 6e6e 6563 7469   the BQ connecti
-00001d90: 6f6e 2066 6f72 2072 656d 6f74 6520 6675  on for remote fu
-00001da0: 6e63 7469 6f6e 2061 6e64 2056 6572 7465  nction and Verte
-00001db0: 7820 4149 2069 6e74 6567 7261 7469 6f6e  x AI integration
-00001dc0: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
-00001dd0: 715f 636f 6e6e 6563 7469 6f6e 203d 2063  q_connection = c
-00001de0: 6f6e 7465 7874 2e62 715f 636f 6e6e 6563  ontext.bq_connec
-00001df0: 7469 6f6e 206f 7220 5f42 4947 4652 414d  tion or _BIGFRAM
-00001e00: 4553 5f44 4546 4155 4c54 5f43 4f4e 4e45  ES_DEFAULT_CONNE
-00001e10: 4354 494f 4e5f 4944 0a20 2020 2020 2020  CTION_ID.       
-00001e20: 2073 656c 662e 5f73 6b69 705f 6271 5f63   self._skip_bq_c
-00001e30: 6f6e 6e65 6374 696f 6e5f 6368 6563 6b20  onnection_check 
-00001e40: 3d20 636f 6e74 6578 742e 5f73 6b69 705f  = context._skip_
-00001e50: 6271 5f63 6f6e 6e65 6374 696f 6e5f 6368  bq_connection_ch
-00001e60: 6563 6b0a 0a20 2020 2020 2020 2023 204e  eck..        # N
-00001e70: 6f77 2074 6861 7420 7765 2772 6520 7374  ow that we're st
-00001e80: 6172 7469 6e67 2074 6865 2073 6573 7369  arting the sessi
-00001e90: 6f6e 2c20 646f 6e27 7420 616c 6c6f 7720  on, don't allow 
-00001ea0: 7468 6520 6f70 7469 6f6e 7320 746f 2062  the options to b
-00001eb0: 650a 2020 2020 2020 2020 2320 6368 616e  e.        # chan
-00001ec0: 6765 642e 0a20 2020 2020 2020 2063 6f6e  ged..        con
-00001ed0: 7465 7874 2e5f 7365 7373 696f 6e5f 7374  text._session_st
-00001ee0: 6172 7465 6420 3d20 5472 7565 0a20 2020  arted = True.   
-00001ef0: 2020 2020 2073 656c 662e 5f64 665f 736e       self._df_sn
-00001f00: 6170 7368 6f74 3a20 4469 6374 5b62 6967  apshot: Dict[big
-00001f10: 7175 6572 792e 5461 626c 6552 6566 6572  query.TableRefer
-00001f20: 656e 6365 2c20 6461 7465 7469 6d65 2e64  ence, datetime.d
-00001f30: 6174 6574 696d 655d 203d 207b 7d0a 0a20  atetime] = {}.. 
-00001f40: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00001f50: 2064 6566 2062 7163 6c69 656e 7428 7365   def bqclient(se
-00001f60: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00001f70: 7572 6e20 7365 6c66 2e5f 636c 6965 6e74  urn self._client
-00001f80: 735f 7072 6f76 6964 6572 2e62 7163 6c69  s_provider.bqcli
-00001f90: 656e 740a 0a20 2020 2040 7072 6f70 6572  ent..    @proper
-00001fa0: 7479 0a20 2020 2064 6566 2062 7163 6f6e  ty.    def bqcon
-00001fb0: 6e65 6374 696f 6e63 6c69 656e 7428 7365  nectionclient(se
-00001fc0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00001fd0: 7572 6e20 7365 6c66 2e5f 636c 6965 6e74  urn self._client
-00001fe0: 735f 7072 6f76 6964 6572 2e62 7163 6f6e  s_provider.bqcon
-00001ff0: 6e65 6374 696f 6e63 6c69 656e 740a 0a20  nectionclient.. 
-00002000: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00002010: 2064 6566 2062 7173 746f 7261 6765 7265   def bqstoragere
-00002020: 6164 636c 6965 6e74 2873 656c 6629 3a0a  adclient(self):.
-00002030: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00002040: 656c 662e 5f63 6c69 656e 7473 5f70 726f  elf._clients_pro
-00002050: 7669 6465 722e 6271 7374 6f72 6167 6572  vider.bqstorager
-00002060: 6561 6463 6c69 656e 740a 0a20 2020 2040  eadclient..    @
-00002070: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00002080: 2063 6c6f 7564 6675 6e63 7469 6f6e 7363   cloudfunctionsc
-00002090: 6c69 656e 7428 7365 6c66 293a 0a20 2020  lient(self):.   
-000020a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000020b0: 2e5f 636c 6965 6e74 735f 7072 6f76 6964  ._clients_provid
-000020c0: 6572 2e63 6c6f 7564 6675 6e63 7469 6f6e  er.cloudfunction
-000020d0: 7363 6c69 656e 740a 0a20 2020 2040 7072  sclient..    @pr
-000020e0: 6f70 6572 7479 0a20 2020 2064 6566 2072  operty.    def r
-000020f0: 6573 6f75 7263 656d 616e 6167 6572 636c  esourcemanagercl
-00002100: 6965 6e74 2873 656c 6629 3a0a 2020 2020  ient(self):.    
-00002110: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00002120: 5f63 6c69 656e 7473 5f70 726f 7669 6465  _clients_provide
-00002130: 722e 7265 736f 7572 6365 6d61 6e61 6765  r.resourcemanage
-00002140: 7263 6c69 656e 740a 0a20 2020 205f 6271  rclient..    _bq
-00002150: 5f63 6f6e 6e65 6374 696f 6e5f 6d61 6e61  _connection_mana
-00002160: 6765 723a 204f 7074 696f 6e61 6c5b 6269  ger: Optional[bi
-00002170: 6766 7261 6d65 732e 636c 6965 6e74 732e  gframes.clients.
-00002180: 4271 436f 6e6e 6563 7469 6f6e 4d61 6e61  BqConnectionMana
-00002190: 6765 725d 203d 204e 6f6e 650a 0a20 2020  ger] = None..   
-000021a0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-000021b0: 6566 2062 7163 6f6e 6e65 6374 696f 6e6d  ef bqconnectionm
-000021c0: 616e 6167 6572 2873 656c 6629 3a0a 2020  anager(self):.  
-000021d0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-000021e0: 662e 5f73 6b69 705f 6271 5f63 6f6e 6e65  f._skip_bq_conne
-000021f0: 6374 696f 6e5f 6368 6563 6b20 616e 6420  ction_check and 
-00002200: 6e6f 7420 7365 6c66 2e5f 6271 5f63 6f6e  not self._bq_con
-00002210: 6e65 6374 696f 6e5f 6d61 6e61 6765 723a  nection_manager:
-00002220: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002230: 662e 5f62 715f 636f 6e6e 6563 7469 6f6e  f._bq_connection
-00002240: 5f6d 616e 6167 6572 203d 2062 6967 6672  _manager = bigfr
-00002250: 616d 6573 2e63 6c69 656e 7473 2e42 7143  ames.clients.BqC
-00002260: 6f6e 6e65 6374 696f 6e4d 616e 6167 6572  onnectionManager
-00002270: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002280: 2020 7365 6c66 2e62 7163 6f6e 6e65 6374    self.bqconnect
-00002290: 696f 6e63 6c69 656e 742c 2073 656c 662e  ionclient, self.
-000022a0: 7265 736f 7572 6365 6d61 6e61 6765 7263  resourcemanagerc
-000022b0: 6c69 656e 740a 2020 2020 2020 2020 2020  lient.          
-000022c0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-000022d0: 726e 2073 656c 662e 5f62 715f 636f 6e6e  rn self._bq_conn
-000022e0: 6563 7469 6f6e 5f6d 616e 6167 6572 0a0a  ection_manager..
-000022f0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00002300: 2020 6465 6620 5f70 726f 6a65 6374 2873    def _project(s
-00002310: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00002320: 7475 726e 2073 656c 662e 6271 636c 6965  turn self.bqclie
-00002330: 6e74 2e70 726f 6a65 6374 0a0a 2020 2020  nt.project..    
-00002340: 6465 6620 5f5f 6861 7368 5f5f 2873 656c  def __hash__(sel
-00002350: 6629 3a0a 2020 2020 2020 2020 2320 5374  f):.        # St
-00002360: 6162 6c65 2068 6173 6820 6e65 6564 6564  able hash needed
-00002370: 2074 6f20 7573 6520 696e 2065 7870 7265   to use in expre
-00002380: 7373 696f 6e20 7472 6565 0a20 2020 2020  ssion tree.     
-00002390: 2020 2072 6574 7572 6e20 6861 7368 2873     return hash(s
-000023a0: 7472 2873 656c 662e 5f61 6e6f 6e79 6d6f  tr(self._anonymo
-000023b0: 7573 5f64 6174 6173 6574 2929 0a0a 2020  us_dataset))..  
-000023c0: 2020 6465 6620 5f63 7265 6174 655f 6271    def _create_bq
-000023d0: 5f64 6174 6173 6574 7328 7365 6c66 293a  _datasets(self):
-000023e0: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
-000023f0: 7465 2061 6e64 2069 6465 6e74 6966 7920  te and identify 
-00002400: 6461 7461 7365 7428 7329 2066 6f72 2074  dataset(s) for t
-00002410: 656d 706f 7261 7279 2042 5120 7265 736f  emporary BQ reso
-00002420: 7572 6365 732e 2222 220a 2020 2020 2020  urces.""".      
-00002430: 2020 7175 6572 795f 6a6f 6220 3d20 7365    query_job = se
-00002440: 6c66 2e62 7163 6c69 656e 742e 7175 6572  lf.bqclient.quer
-00002450: 7928 2253 454c 4543 5420 3122 2c20 6c6f  y("SELECT 1", lo
-00002460: 6361 7469 6f6e 3d73 656c 662e 5f6c 6f63  cation=self._loc
-00002470: 6174 696f 6e29 0a20 2020 2020 2020 2071  ation).        q
-00002480: 7565 7279 5f6a 6f62 2e72 6573 756c 7428  uery_job.result(
-00002490: 2920 2023 2062 6c6f 636b 7320 756e 7469  )  # blocks unti
-000024a0: 6c20 6669 6e69 7368 6564 0a0a 2020 2020  l finished..    
-000024b0: 2020 2020 2320 5468 6520 616e 6f6e 796d      # The anonym
-000024c0: 6f75 7320 6461 7461 7365 7420 6973 2075  ous dataset is u
-000024d0: 7365 6420 6279 2042 6967 5175 6572 7920  sed by BigQuery 
-000024e0: 746f 2077 7269 7465 2071 7565 7279 2072  to write query r
-000024f0: 6573 756c 7473 2061 6e64 0a20 2020 2020  esults and.     
-00002500: 2020 2023 2073 6573 7369 6f6e 2074 6162     # session tab
-00002510: 6c65 732e 2042 6967 5175 6572 7920 4461  les. BigQuery Da
-00002520: 7461 4672 616d 6573 2061 6c73 6f20 7772  taFrames also wr
-00002530: 6974 6573 2074 656d 7020 7461 626c 6573  ites temp tables
-00002540: 2064 6972 6563 746c 790a 2020 2020 2020   directly.      
-00002550: 2020 2320 746f 2074 6865 2064 6174 6173    # to the datas
-00002560: 6574 2c20 6e6f 2042 6967 5175 6572 7920  et, no BigQuery 
-00002570: 5365 7373 696f 6e20 7265 7175 6972 6564  Session required
-00002580: 2e20 4e6f 7465 3a20 7468 6572 6520 6973  . Note: there is
-00002590: 2061 0a20 2020 2020 2020 2023 2064 6966   a.        # dif
-000025a0: 6665 7265 6e74 2061 6e6f 6e79 6d6f 7573  ferent anonymous
-000025b0: 2064 6174 6173 6574 2070 6572 206c 6f63   dataset per loc
-000025c0: 6174 696f 6e2e 2053 6565 3a0a 2020 2020  ation. See:.    
-000025d0: 2020 2020 2320 6874 7470 733a 2f2f 636c      # https://cl
-000025e0: 6f75 642e 676f 6f67 6c65 2e63 6f6d 2f62  oud.google.com/b
-000025f0: 6967 7175 6572 792f 646f 6373 2f63 6163  igquery/docs/cac
-00002600: 6865 642d 7265 7375 6c74 7323 686f 775f  hed-results#how_
-00002610: 6361 6368 6564 5f72 6573 756c 7473 5f61  cached_results_a
-00002620: 7265 5f73 746f 7265 640a 2020 2020 2020  re_stored.      
-00002630: 2020 7175 6572 795f 6465 7374 696e 6174    query_destinat
-00002640: 696f 6e20 3d20 7175 6572 795f 6a6f 622e  ion = query_job.
-00002650: 6465 7374 696e 6174 696f 6e0a 2020 2020  destination.    
-00002660: 2020 2020 7365 6c66 2e5f 616e 6f6e 796d      self._anonym
-00002670: 6f75 735f 6461 7461 7365 7420 3d20 6269  ous_dataset = bi
-00002680: 6771 7565 7279 2e44 6174 6173 6574 5265  gquery.DatasetRe
-00002690: 6665 7265 6e63 6528 0a20 2020 2020 2020  ference(.       
-000026a0: 2020 2020 2071 7565 7279 5f64 6573 7469       query_desti
-000026b0: 6e61 7469 6f6e 2e70 726f 6a65 6374 2c0a  nation.project,.
-000026c0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-000026d0: 795f 6465 7374 696e 6174 696f 6e2e 6461  y_destination.da
-000026e0: 7461 7365 745f 6964 2c0a 2020 2020 2020  taset_id,.      
-000026f0: 2020 290a 0a20 2020 2064 6566 2063 6c6f    )..    def clo
-00002700: 7365 2873 656c 6629 3a0a 2020 2020 2020  se(self):.      
-00002710: 2020 2222 224e 6f2d 6f70 2e20 5465 6d70    """No-op. Temp
-00002720: 6f72 6172 7920 7265 736f 7572 6365 7320  orary resources 
-00002730: 6172 6520 6465 6c65 7465 6420 6166 7465  are deleted afte
-00002740: 7220 3720 6461 7973 2e22 2222 0a0a 2020  r 7 days."""..  
-00002750: 2020 6465 6620 7265 6164 5f67 6271 280a    def read_gbq(.
-00002760: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00002770: 2020 2020 2020 7175 6572 795f 6f72 5f74        query_or_t
-00002780: 6162 6c65 3a20 7374 722c 0a20 2020 2020  able: str,.     
-00002790: 2020 202a 2c0a 2020 2020 2020 2020 696e     *,.        in
-000027a0: 6465 785f 636f 6c3a 2049 7465 7261 626c  dex_col: Iterabl
-000027b0: 655b 7374 725d 207c 2073 7472 203d 2028  e[str] | str = (
-000027c0: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
-000027d0: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
-000027e0: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
-000027f0: 636f 6e66 6967 7572 6174 696f 6e3a 204f  configuration: O
-00002800: 7074 696f 6e61 6c5b 4469 6374 5d20 3d20  ptional[Dict] = 
-00002810: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d61  None,.        ma
-00002820: 785f 7265 7375 6c74 733a 204f 7074 696f  x_results: Optio
-00002830: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-00002840: 0a20 2020 2020 2020 2066 696c 7465 7273  .        filters
-00002850: 3a20 7468 6972 645f 7061 7274 795f 7061  : third_party_pa
-00002860: 6e64 6173 5f67 6271 2e46 696c 7465 7273  ndas_gbq.Filters
-00002870: 5479 7065 203d 2028 292c 0a20 2020 2020  Type = (),.     
-00002880: 2020 2075 7365 5f63 6163 6865 3a20 4f70     use_cache: Op
-00002890: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 204e  tional[bool] = N
-000028a0: 6f6e 652c 0a20 2020 2020 2020 2063 6f6c  one,.        col
-000028b0: 5f6f 7264 6572 3a20 4974 6572 6162 6c65  _order: Iterable
-000028c0: 5b73 7472 5d20 3d20 2829 2c0a 2020 2020  [str] = (),.    
-000028d0: 2020 2020 2320 4164 6420 6120 7665 7269      # Add a veri
-000028e0: 6679 2069 6e64 6578 2061 7267 756d 656e  fy index argumen
-000028f0: 7420 7468 6174 2066 6169 6c73 2069 6620  t that fails if 
-00002900: 7468 6520 696e 6465 7820 6973 206e 6f74  the index is not
-00002910: 2075 6e69 7175 652e 0a20 2020 2029 202d   unique..    ) -
-00002920: 3e20 6461 7461 6672 616d 652e 4461 7461  > dataframe.Data
-00002930: 4672 616d 653a 0a20 2020 2020 2020 2023  Frame:.        #
-00002940: 2054 4f44 4f28 622f 3238 3135 3731 3231   TODO(b/28157121
-00002950: 3429 3a20 4765 6e65 7261 7465 2070 726f  4): Generate pro
-00002960: 6d70 7420 746f 2073 686f 7720 7468 6520  mpt to show the 
-00002970: 7072 6f67 7265 7373 206f 6620 7265 6164  progress of read
-00002980: 5f67 6271 2e0a 2020 2020 2020 2020 6966  _gbq..        if
-00002990: 2063 6f6c 756d 6e73 2061 6e64 2063 6f6c   columns and col
-000029a0: 5f6f 7264 6572 3a0a 2020 2020 2020 2020  _order:.        
-000029b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000029c0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000029d0: 2020 2020 2020 224d 7573 7420 7370 6563        "Must spec
-000029e0: 6966 7920 6569 7468 6572 2063 6f6c 756d  ify either colum
-000029f0: 6e73 2028 7072 6566 6572 7265 6429 206f  ns (preferred) o
-00002a00: 7220 636f 6c5f 6f72 6465 722c 206e 6f74  r col_order, not
-00002a10: 2062 6f74 6822 0a20 2020 2020 2020 2020   both".         
-00002a20: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00002a30: 6620 636f 6c5f 6f72 6465 723a 0a20 2020  f col_order:.   
-00002a40: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00002a50: 203d 2063 6f6c 5f6f 7264 6572 0a0a 2020   = col_order..  
-00002a60: 2020 2020 2020 6669 6c74 6572 7320 3d20        filters = 
-00002a70: 6c69 7374 2866 696c 7465 7273 290a 2020  list(filters).  
-00002a80: 2020 2020 2020 6966 206c 656e 2866 696c        if len(fil
-00002a90: 7465 7273 2920 213d 2030 206f 7220 5f69  ters) != 0 or _i
-00002aa0: 735f 7461 626c 655f 7769 7468 5f77 696c  s_table_with_wil
-00002ab0: 6463 6172 645f 7375 6666 6978 2871 7565  dcard_suffix(que
-00002ac0: 7279 5f6f 725f 7461 626c 6529 3a0a 2020  ry_or_table):.  
-00002ad0: 2020 2020 2020 2020 2020 7175 6572 795f            query_
-00002ae0: 6f72 5f74 6162 6c65 203d 2073 656c 662e  or_table = self.
-00002af0: 5f74 6f5f 7175 6572 7928 7175 6572 795f  _to_query(query_
-00002b00: 6f72 5f74 6162 6c65 2c20 636f 6c75 6d6e  or_table, column
-00002b10: 732c 2066 696c 7465 7273 290a 0a20 2020  s, filters)..   
-00002b20: 2020 2020 2069 6620 5f69 735f 7175 6572       if _is_quer
-00002b30: 7928 7175 6572 795f 6f72 5f74 6162 6c65  y(query_or_table
-00002b40: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00002b50: 6574 7572 6e20 7365 6c66 2e5f 7265 6164  eturn self._read
-00002b60: 5f67 6271 5f71 7565 7279 280a 2020 2020  _gbq_query(.    
-00002b70: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-00002b80: 795f 6f72 5f74 6162 6c65 2c0a 2020 2020  y_or_table,.    
-00002b90: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00002ba0: 785f 636f 6c3d 696e 6465 785f 636f 6c2c  x_col=index_col,
-00002bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002bc0: 2063 6f6c 756d 6e73 3d63 6f6c 756d 6e73   columns=columns
-00002bd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002be0: 2020 636f 6e66 6967 7572 6174 696f 6e3d    configuration=
-00002bf0: 636f 6e66 6967 7572 6174 696f 6e2c 0a20  configuration,. 
-00002c00: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00002c10: 6178 5f72 6573 756c 7473 3d6d 6178 5f72  ax_results=max_r
-00002c20: 6573 756c 7473 2c0a 2020 2020 2020 2020  esults,.        
-00002c30: 2020 2020 2020 2020 6170 695f 6e61 6d65          api_name
-00002c40: 3d22 7265 6164 5f67 6271 222c 0a20 2020  ="read_gbq",.   
-00002c50: 2020 2020 2020 2020 2020 2020 2075 7365               use
-00002c60: 5f63 6163 6865 3d75 7365 5f63 6163 6865  _cache=use_cache
-00002c70: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00002c80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00002c90: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
-00002ca0: 2873 7761 7374 293a 2051 7565 7279 2074  (swast): Query t
-00002cb0: 6865 2073 6e61 7073 686f 7420 7461 626c  he snapshot tabl
-00002cc0: 6520 6275 7420 6d61 726b 2069 7420 6173  e but mark it as
-00002cd0: 2061 0a20 2020 2020 2020 2020 2020 2023   a.            #
-00002ce0: 2064 6574 6572 6d69 6e69 7374 6963 2071   deterministic q
-00002cf0: 7565 7279 2073 6f20 7765 2063 616e 2061  uery so we can a
-00002d00: 766f 6964 2073 6572 6961 6c69 7a69 6e67  void serializing
-00002d10: 2069 6620 7765 2068 6176 6520 610a 2020   if we have a.  
-00002d20: 2020 2020 2020 2020 2020 2320 756e 6971            # uniq
-00002d30: 7565 2069 6e64 6578 2e0a 2020 2020 2020  ue index..      
-00002d40: 2020 2020 2020 6966 2063 6f6e 6669 6775        if configu
-00002d50: 7261 7469 6f6e 2069 7320 6e6f 7420 4e6f  ration is not No
-00002d60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00002d70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00002d80: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00002d90: 2020 2020 2020 2020 2020 2254 6865 2027            "The '
-00002da0: 636f 6e66 6967 7572 6174 696f 6e27 2061  configuration' a
-00002db0: 7267 756d 656e 7420 6973 206e 6f74 2061  rgument is not a
-00002dc0: 6c6c 6f77 6564 2077 6865 6e20 220a 2020  llowed when ".  
-00002dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002de0: 2020 2264 6972 6563 746c 7920 7265 6164    "directly read
-00002df0: 696e 6720 6672 6f6d 2061 2074 6162 6c65  ing from a table
-00002e00: 2e20 506c 6561 7365 2072 656d 6f76 6520  . Please remove 
-00002e10: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00002e20: 2020 2020 2020 2227 636f 6e66 6967 7572        "'configur
-00002e30: 6174 696f 6e27 206f 7220 7573 6520 6120  ation' or use a 
-00002e40: 7175 6572 792e 220a 2020 2020 2020 2020  query.".        
-00002e50: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00002e60: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00002e70: 6c66 2e5f 7265 6164 5f67 6271 5f74 6162  lf._read_gbq_tab
-00002e80: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00002e90: 2020 2020 7175 6572 795f 6f72 5f74 6162      query_or_tab
-00002ea0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00002eb0: 2020 2020 696e 6465 785f 636f 6c3d 696e      index_col=in
-00002ec0: 6465 785f 636f 6c2c 0a20 2020 2020 2020  dex_col,.       
-00002ed0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00002ee0: 3d63 6f6c 756d 6e73 2c0a 2020 2020 2020  =columns,.      
-00002ef0: 2020 2020 2020 2020 2020 6d61 785f 7265            max_re
-00002f00: 7375 6c74 733d 6d61 785f 7265 7375 6c74  sults=max_result
-00002f10: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00002f20: 2020 2061 7069 5f6e 616d 653d 2272 6561     api_name="rea
-00002f30: 645f 6762 7122 2c0a 2020 2020 2020 2020  d_gbq",.        
-00002f40: 2020 2020 2020 2020 7573 655f 6361 6368          use_cach
-00002f50: 653d 7573 655f 6361 6368 6520 6966 2075  e=use_cache if u
-00002f60: 7365 5f63 6163 6865 2069 7320 6e6f 7420  se_cache is not 
-00002f70: 4e6f 6e65 2065 6c73 6520 5472 7565 2c0a  None else True,.
-00002f80: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00002f90: 2020 2064 6566 205f 746f 5f71 7565 7279     def _to_query
-00002fa0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00002fb0: 2020 2020 2020 2020 7175 6572 795f 6f72          query_or
-00002fc0: 5f74 6162 6c65 3a20 7374 722c 0a20 2020  _table: str,.   
-00002fd0: 2020 2020 2063 6f6c 756d 6e73 3a20 4974       columns: It
-00002fe0: 6572 6162 6c65 5b73 7472 5d2c 0a20 2020  erable[str],.   
-00002ff0: 2020 2020 2066 696c 7465 7273 3a20 7468       filters: th
-00003000: 6972 645f 7061 7274 795f 7061 6e64 6173  ird_party_pandas
-00003010: 5f67 6271 2e46 696c 7465 7273 5479 7065  _gbq.FiltersType
-00003020: 2c0a 2020 2020 2920 2d3e 2073 7472 3a0a  ,.    ) -> str:.
-00003030: 2020 2020 2020 2020 2222 2243 6f6d 7069          """Compi
-00003040: 6c65 2071 7565 7279 5f6f 725f 7461 626c  le query_or_tabl
-00003050: 6520 7769 7468 2063 6f6e 6469 7469 6f6e  e with condition
-00003060: 7328 6669 6c74 6572 732c 2077 696c 6463  s(filters, wildc
-00003070: 6172 6473 2920 746f 2071 7565 7279 2e22  ards) to query."
-00003080: 2222 0a20 2020 2020 2020 2066 696c 7465  "".        filte
-00003090: 7273 203d 206c 6973 7428 6669 6c74 6572  rs = list(filter
-000030a0: 7329 0a20 2020 2020 2020 2073 7562 5f71  s).        sub_q
-000030b0: 7565 7279 203d 2028 0a20 2020 2020 2020  uery = (.       
-000030c0: 2020 2020 2066 2228 7b71 7565 7279 5f6f       f"({query_o
-000030d0: 725f 7461 626c 657d 2922 0a20 2020 2020  r_table})".     
-000030e0: 2020 2020 2020 2069 6620 5f69 735f 7175         if _is_qu
-000030f0: 6572 7928 7175 6572 795f 6f72 5f74 6162  ery(query_or_tab
-00003100: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00003110: 656c 7365 2066 2260 7b71 7565 7279 5f6f  else f"`{query_o
-00003120: 725f 7461 626c 657d 6022 0a20 2020 2020  r_table}`".     
-00003130: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-00003140: 6c65 6374 5f63 6c61 7573 6520 3d20 2253  lect_clause = "S
-00003150: 454c 4543 5420 2220 2b20 280a 2020 2020  ELECT " + (.    
-00003160: 2020 2020 2020 2020 222c 2022 2e6a 6f69          ", ".joi
-00003170: 6e28 6622 607b 636f 6c75 6d6e 7d60 2220  n(f"`{column}`" 
-00003180: 666f 7220 636f 6c75 6d6e 2069 6e20 636f  for column in co
-00003190: 6c75 6d6e 7329 2069 6620 636f 6c75 6d6e  lumns) if column
-000031a0: 7320 656c 7365 2022 2a22 0a20 2020 2020  s else "*".     
-000031b0: 2020 2029 0a0a 2020 2020 2020 2020 7768     )..        wh
-000031c0: 6572 655f 636c 6175 7365 203d 2022 220a  ere_clause = "".
-000031d0: 2020 2020 2020 2020 6966 2066 696c 7465          if filte
-000031e0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-000031f0: 7661 6c69 645f 6f70 6572 6174 6f72 733a  valid_operators:
-00003200: 204d 6170 7069 6e67 5b74 6869 7264 5f70   Mapping[third_p
-00003210: 6172 7479 5f70 616e 6461 735f 6762 712e  arty_pandas_gbq.
-00003220: 4669 6c74 6572 4f70 732c 2073 7472 5d20  FilterOps, str] 
-00003230: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00003240: 2020 2020 2269 6e22 3a20 2249 4e22 2c0a      "in": "IN",.
-00003250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003260: 226e 6f74 2069 6e22 3a20 224e 4f54 2049  "not in": "NOT I
-00003270: 4e22 2c0a 2020 2020 2020 2020 2020 2020  N",.            
-00003280: 2020 2020 224c 494b 4522 3a20 224c 494b      "LIKE": "LIK
-00003290: 4522 2c0a 2020 2020 2020 2020 2020 2020  E",.            
-000032a0: 2020 2020 223d 3d22 3a20 223d 222c 0a20      "==": "=",. 
-000032b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000032c0: 3e22 3a20 223e 222c 0a20 2020 2020 2020  >": ">",.       
-000032d0: 2020 2020 2020 2020 2022 3c22 3a20 223c           "<": "<
-000032e0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000032f0: 2020 2022 3e3d 223a 2022 3e3d 222c 0a20     ">=": ">=",. 
-00003300: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00003310: 3c3d 223a 2022 3c3d 222c 0a20 2020 2020  <=": "<=",.     
-00003320: 2020 2020 2020 2020 2020 2022 213d 223a             "!=":
-00003330: 2022 213d 222c 0a20 2020 2020 2020 2020   "!=",.         
-00003340: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
-00003350: 2020 2320 4966 2073 696e 676c 6520 6c61    # If single la
-00003360: 7965 7220 6669 6c74 6572 2c20 6164 6420  yer filter, add 
-00003370: 616e 6f74 6865 7220 7073 6575 646f 206c  another pseudo l
-00003380: 6179 6572 2e20 536f 2074 6865 2073 696e  ayer. So the sin
-00003390: 676c 6520 6c61 7965 7220 7265 7072 6573  gle layer repres
-000033a0: 656e 7473 2022 616e 6422 206c 6f67 6963  ents "and" logic
-000033b0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000033c0: 2069 7369 6e73 7461 6e63 6528 6669 6c74   isinstance(filt
-000033d0: 6572 735b 305d 2c20 7475 706c 6529 2061  ers[0], tuple) a
-000033e0: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
-000033f0: 2020 2020 206c 656e 2866 696c 7465 7273       len(filters
-00003400: 5b30 5d29 203d 3d20 3020 6f72 206e 6f74  [0]) == 0 or not
-00003410: 2069 7369 6e73 7461 6e63 6528 6c69 7374   isinstance(list
-00003420: 2866 696c 7465 7273 5b30 5d29 5b30 5d2c  (filters[0])[0],
-00003430: 2074 7570 6c65 290a 2020 2020 2020 2020   tuple).        
-00003440: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00003450: 2020 2020 2020 2066 696c 7465 7273 203d         filters =
-00003460: 2074 7970 696e 672e 6361 7374 2874 6869   typing.cast(thi
-00003470: 7264 5f70 6172 7479 5f70 616e 6461 735f  rd_party_pandas_
-00003480: 6762 712e 4669 6c74 6572 7354 7970 652c  gbq.FiltersType,
-00003490: 205b 6669 6c74 6572 735d 290a 0a20 2020   [filters])..   
-000034a0: 2020 2020 2020 2020 206f 725f 6578 7072           or_expr
-000034b0: 6573 7369 6f6e 7320 3d20 5b5d 0a20 2020  essions = [].   
-000034c0: 2020 2020 2020 2020 2066 6f72 2067 726f           for gro
-000034d0: 7570 2069 6e20 6669 6c74 6572 733a 0a20  up in filters:. 
-000034e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000034f0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00003500: 2867 726f 7570 2c20 4974 6572 6162 6c65  (group, Iterable
-00003510: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00003520: 2020 2020 2020 2067 726f 7570 203d 205b         group = [
-00003530: 6772 6f75 705d 0a0a 2020 2020 2020 2020  group]..        
-00003540: 2020 2020 2020 2020 616e 645f 6578 7072          and_expr
-00003550: 6573 7369 6f6e 7320 3d20 5b5d 0a20 2020  essions = [].   
-00003560: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00003570: 2066 696c 7465 725f 6974 656d 2069 6e20   filter_item in 
-00003580: 6772 6f75 703a 0a20 2020 2020 2020 2020  group:.         
-00003590: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000035a0: 7420 6973 696e 7374 616e 6365 2866 696c  t isinstance(fil
-000035b0: 7465 725f 6974 656d 2c20 7475 706c 6529  ter_item, tuple)
-000035c0: 206f 7220 286c 656e 2866 696c 7465 725f   or (len(filter_
-000035d0: 6974 656d 2920 213d 2033 293a 0a20 2020  item) != 3):.   
-000035e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035f0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00003600: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00003610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003620: 2020 2066 2246 696c 7465 7220 636f 6e64     f"Filter cond
-00003630: 6974 696f 6e20 7368 6f75 6c64 2062 6520  ition should be 
-00003640: 6120 7475 706c 6520 6f66 206c 656e 6774  a tuple of lengt
-00003650: 6820 332c 207b 6669 6c74 6572 5f69 7465  h 3, {filter_ite
-00003660: 6d7d 2069 7320 6e6f 7420 7661 6c69 642e  m} is not valid.
-00003670: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00003680: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00003690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036a0: 2063 6f6c 756d 6e2c 206f 7065 7261 746f   column, operato
-000036b0: 722c 2076 616c 7565 203d 2066 696c 7465  r, value = filte
-000036c0: 725f 6974 656d 0a0a 2020 2020 2020 2020  r_item..        
-000036d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000036e0: 6f74 2069 7369 6e73 7461 6e63 6528 636f  ot isinstance(co
-000036f0: 6c75 6d6e 2c20 7374 7229 3a0a 2020 2020  lumn, str):.    
-00003700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003710: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00003720: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00003730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003740: 2020 6622 436f 6c75 6d6e 206e 616d 6520    f"Column name 
-00003750: 7368 6f75 6c64 2062 6520 6120 7374 7269  should be a stri
-00003760: 6e67 2c20 6275 7420 7265 6365 6976 6564  ng, but received
-00003770: 2027 7b63 6f6c 756d 6e7d 2720 6f66 2074   '{column}' of t
-00003780: 7970 6520 7b74 7970 6528 636f 6c75 6d6e  ype {type(column
-00003790: 292e 5f5f 6e61 6d65 5f5f 7d2e 220a 2020  ).__name__}.".  
-000037a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000037c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000037d0: 6f70 6572 6174 6f72 206e 6f74 2069 6e20  operator not in 
-000037e0: 7661 6c69 645f 6f70 6572 6174 6f72 733a  valid_operators:
-000037f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003800: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00003810: 616c 7565 4572 726f 7228 6622 4f70 6572  alueError(f"Oper
-00003820: 6174 6f72 207b 6f70 6572 6174 6f72 7d20  ator {operator} 
-00003830: 6973 206e 6f74 2076 616c 6964 2e22 290a  is not valid.").
-00003840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003850: 2020 2020 206f 7065 7261 746f 725f 7374       operator_st
-00003860: 7220 3d20 7661 6c69 645f 6f70 6572 6174  r = valid_operat
-00003870: 6f72 735b 6f70 6572 6174 6f72 5d0a 0a20  ors[operator].. 
-00003880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003890: 2020 2069 6620 6f70 6572 6174 6f72 5f73     if operator_s
-000038a0: 7472 2069 6e20 5b22 494e 222c 2022 4e4f  tr in ["IN", "NO
-000038b0: 5420 494e 225d 3a0a 2020 2020 2020 2020  T IN"]:.        
-000038c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038d0: 7661 6c75 655f 6c69 7374 203d 2022 2c20  value_list = ", 
-000038e0: 222e 6a6f 696e 285b 7265 7072 2876 2920  ".join([repr(v) 
-000038f0: 666f 7220 7620 696e 2076 616c 7565 5d29  for v in value])
-00003900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003910: 2020 2020 2020 2020 2065 7870 7265 7373           express
-00003920: 696f 6e20 3d20 6622 607b 636f 6c75 6d6e  ion = f"`{column
-00003930: 7d60 207b 6f70 6572 6174 6f72 5f73 7472  }` {operator_str
-00003940: 7d20 287b 7661 6c75 655f 6c69 7374 7d29  } ({value_list})
-00003950: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00003960: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00003970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003980: 2020 2020 6578 7072 6573 7369 6f6e 203d      expression =
-00003990: 2066 2260 7b63 6f6c 756d 6e7d 6020 7b6f   f"`{column}` {o
-000039a0: 7065 7261 746f 725f 7374 727d 207b 7265  perator_str} {re
-000039b0: 7072 2876 616c 7565 297d 220a 2020 2020  pr(value)}".    
-000039c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039d0: 616e 645f 6578 7072 6573 7369 6f6e 732e  and_expressions.
-000039e0: 6170 7065 6e64 2865 7870 7265 7373 696f  append(expressio
-000039f0: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
-00003a00: 2020 2020 6f72 5f65 7870 7265 7373 696f      or_expressio
-00003a10: 6e73 2e61 7070 656e 6428 2220 414e 4420  ns.append(" AND 
-00003a20: 222e 6a6f 696e 2861 6e64 5f65 7870 7265  ".join(and_expre
-00003a30: 7373 696f 6e73 2929 0a0a 2020 2020 2020  ssions))..      
-00003a40: 2020 2020 2020 6966 206f 725f 6578 7072        if or_expr
-00003a50: 6573 7369 6f6e 733a 0a20 2020 2020 2020  essions:.       
-00003a60: 2020 2020 2020 2020 2077 6865 7265 5f63           where_c
-00003a70: 6c61 7573 6520 3d20 2220 5748 4552 4520  lause = " WHERE 
-00003a80: 2220 2b20 2220 4f52 2022 2e6a 6f69 6e28  " + " OR ".join(
-00003a90: 6f72 5f65 7870 7265 7373 696f 6e73 290a  or_expressions).
-00003aa0: 0a20 2020 2020 2020 2066 756c 6c5f 7175  .        full_qu
-00003ab0: 6572 7920 3d20 6622 7b73 656c 6563 745f  ery = f"{select_
-00003ac0: 636c 6175 7365 7d20 4652 4f4d 207b 7375  clause} FROM {su
-00003ad0: 625f 7175 6572 797d 2041 5320 7375 627b  b_query} AS sub{
-00003ae0: 7768 6572 655f 636c 6175 7365 7d22 0a20  where_clause}". 
-00003af0: 2020 2020 2020 2072 6574 7572 6e20 6675         return fu
-00003b00: 6c6c 5f71 7565 7279 0a0a 2020 2020 6465  ll_query..    de
-00003b10: 6620 5f71 7565 7279 5f74 6f5f 6465 7374  f _query_to_dest
-00003b20: 696e 6174 696f 6e28 0a20 2020 2020 2020  ination(.       
-00003b30: 2073 656c 662c 0a20 2020 2020 2020 2071   self,.        q
-00003b40: 7565 7279 3a20 7374 722c 0a20 2020 2020  uery: str,.     
-00003b50: 2020 2069 6e64 6578 5f63 6f6c 733a 204c     index_cols: L
-00003b60: 6973 745b 7374 725d 2c0a 2020 2020 2020  ist[str],.      
-00003b70: 2020 6170 695f 6e61 6d65 3a20 7374 722c    api_name: str,
-00003b80: 0a20 2020 2020 2020 2063 6f6e 6669 6775  .        configu
-00003b90: 7261 7469 6f6e 3a20 6469 6374 203d 207b  ration: dict = {
-00003ba0: 2271 7565 7279 223a 207b 2275 7365 5175  "query": {"useQu
-00003bb0: 6572 7943 6163 6865 223a 2054 7275 657d  eryCache": True}
-00003bc0: 7d2c 0a20 2020 2029 202d 3e20 5475 706c  },.    ) -> Tupl
-00003bd0: 655b 4f70 7469 6f6e 616c 5b62 6967 7175  e[Optional[bigqu
-00003be0: 6572 792e 5461 626c 6552 6566 6572 656e  ery.TableReferen
-00003bf0: 6365 5d2c 204f 7074 696f 6e61 6c5b 6269  ce], Optional[bi
-00003c00: 6771 7565 7279 2e51 7565 7279 4a6f 625d  gquery.QueryJob]
-00003c10: 5d3a 0a20 2020 2020 2020 2023 2049 6620  ]:.        # If 
-00003c20: 6120 6472 795f 7275 6e20 696e 6469 6361  a dry_run indica
-00003c30: 7465 7320 7468 6973 2069 7320 6e6f 7420  tes this is not 
-00003c40: 6120 7175 6572 7920 7479 7065 206a 6f62  a query type job
-00003c50: 2c20 7468 656e 2064 6f6e 2774 0a20 2020  , then don't.   
-00003c60: 2020 2020 2023 2062 6f74 6865 7220 7472       # bother tr
-00003c70: 7969 6e67 2074 6f20 646f 2061 2043 5245  ying to do a CRE
-00003c80: 4154 4520 5445 4d50 2054 4142 4c45 202e  ATE TEMP TABLE .
-00003c90: 2e2e 2041 5320 5345 4c45 4354 202e 2e2e  .. AS SELECT ...
-00003ca0: 2073 7461 7465 6d65 6e74 2e0a 2020 2020   statement..    
-00003cb0: 2020 2020 6472 795f 7275 6e5f 636f 6e66      dry_run_conf
-00003cc0: 6967 203d 2062 6967 7175 6572 792e 5175  ig = bigquery.Qu
-00003cd0: 6572 794a 6f62 436f 6e66 6967 2829 0a20  eryJobConfig(). 
-00003ce0: 2020 2020 2020 2064 7279 5f72 756e 5f63         dry_run_c
-00003cf0: 6f6e 6669 672e 6472 795f 7275 6e20 3d20  onfig.dry_run = 
-00003d00: 5472 7565 0a20 2020 2020 2020 205f 2c20  True.        _, 
-00003d10: 6472 795f 7275 6e5f 6a6f 6220 3d20 7365  dry_run_job = se
-00003d20: 6c66 2e5f 7374 6172 745f 7175 6572 7928  lf._start_query(
-00003d30: 7175 6572 792c 206a 6f62 5f63 6f6e 6669  query, job_confi
-00003d40: 673d 6472 795f 7275 6e5f 636f 6e66 6967  g=dry_run_config
-00003d50: 290a 2020 2020 2020 2020 6966 2064 7279  ).        if dry
-00003d60: 5f72 756e 5f6a 6f62 2e73 7461 7465 6d65  _run_job.stateme
-00003d70: 6e74 5f74 7970 6520 213d 2022 5345 4c45  nt_type != "SELE
-00003d80: 4354 223a 0a20 2020 2020 2020 2020 2020  CT":.           
-00003d90: 205f 2c20 7175 6572 795f 6a6f 6220 3d20   _, query_job = 
-00003da0: 7365 6c66 2e5f 7374 6172 745f 7175 6572  self._start_quer
-00003db0: 7928 7175 6572 7929 0a20 2020 2020 2020  y(query).       
-00003dc0: 2020 2020 2072 6574 7572 6e20 7175 6572       return quer
-00003dd0: 795f 6a6f 622e 6465 7374 696e 6174 696f  y_job.destinatio
-00003de0: 6e2c 2071 7565 7279 5f6a 6f62 0a0a 2020  n, query_job..  
-00003df0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-00003e00: 2074 6162 6c65 2074 6f20 776f 726b 6172   table to workar
-00003e10: 6f75 6e64 2042 6967 5175 6572 7920 3130  ound BigQuery 10
-00003e20: 2047 4220 7175 6572 7920 7265 7375 6c74   GB query result
-00003e30: 7320 6c69 6d69 742e 2053 6565 3a0a 2020  s limit. See:.  
-00003e40: 2020 2020 2020 2320 696e 7465 726e 616c        # internal
-00003e50: 2069 7373 7565 2033 3033 3035 3733 3336   issue 303057336
-00003e60: 2e0a 2020 2020 2020 2020 2320 5369 6e63  ..        # Sinc
-00003e70: 6520 7765 2068 6176 6520 6120 6073 7461  e we have a `sta
-00003e80: 7465 6d65 6e74 5f74 7970 6520 3d3d 2027  tement_type == '
-00003e90: 5345 4c45 4354 2760 2c20 7363 6865 6d61  SELECT'`, schema
-00003ea0: 2073 686f 756c 6420 6265 2070 6f70 756c   should be popul
-00003eb0: 6174 6564 2e0a 2020 2020 2020 2020 7363  ated..        sc
-00003ec0: 6865 6d61 203d 2074 7970 696e 672e 6361  hema = typing.ca
-00003ed0: 7374 2849 7465 7261 626c 655b 6269 6771  st(Iterable[bigq
-00003ee0: 7565 7279 2e53 6368 656d 6146 6965 6c64  uery.SchemaField
-00003ef0: 5d2c 2064 7279 5f72 756e 5f6a 6f62 2e73  ], dry_run_job.s
-00003f00: 6368 656d 6129 0a20 2020 2020 2020 2063  chema).        c
-00003f10: 6c75 7374 6572 5f63 6f6c 7320 3d20 5b0a  luster_cols = [.
-00003f20: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00003f30: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
-00003f40: 2020 666f 7220 6974 656d 2069 6e20 7363    for item in sc
-00003f50: 6865 6d61 0a20 2020 2020 2020 2020 2020  hema.           
-00003f60: 2069 6620 2869 7465 6d2e 6e61 6d65 2069   if (item.name i
-00003f70: 6e20 696e 6465 785f 636f 6c73 2920 616e  n index_cols) an
-00003f80: 6420 5f63 616e 5f63 6c75 7374 6572 5f62  d _can_cluster_b
-00003f90: 7128 6974 656d 290a 2020 2020 2020 2020  q(item).        
-00003fa0: 5d5b 3a5f 4d41 585f 434c 5553 5445 525f  ][:_MAX_CLUSTER_
-00003fb0: 434f 4c55 4d4e 535d 0a20 2020 2020 2020  COLUMNS].       
-00003fc0: 2074 656d 705f 7461 626c 6520 3d20 7365   temp_table = se
-00003fd0: 6c66 2e5f 6372 6561 7465 5f65 6d70 7479  lf._create_empty
-00003fe0: 5f74 656d 705f 7461 626c 6528 7363 6865  _temp_table(sche
-00003ff0: 6d61 2c20 636c 7573 7465 725f 636f 6c73  ma, cluster_cols
-00004000: 290a 0a20 2020 2020 2020 2074 696d 656f  )..        timeo
-00004010: 7574 5f6d 7320 3d20 636f 6e66 6967 7572  ut_ms = configur
-00004020: 6174 696f 6e2e 6765 7428 226a 6f62 5469  ation.get("jobTi
-00004030: 6d65 6f75 744d 7322 2920 6f72 2063 6f6e  meoutMs") or con
-00004040: 6669 6775 7261 7469 6f6e 5b22 7175 6572  figuration["quer
-00004050: 7922 5d2e 6765 7428 0a20 2020 2020 2020  y"].get(.       
-00004060: 2020 2020 2022 7469 6d65 6f75 744d 7322       "timeoutMs"
-00004070: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00004080: 2020 2020 2320 436f 6e76 6572 7420 7469      # Convert ti
-00004090: 6d65 6f75 745f 6d73 2074 6f20 7365 636f  meout_ms to seco
-000040a0: 6e64 732c 2065 6e73 7572 696e 6720 6120  nds, ensuring a 
-000040b0: 6d69 6e69 6d75 6d20 6f66 2030 2e31 2073  minimum of 0.1 s
-000040c0: 6563 6f6e 6473 2074 6f20 6176 6f69 640a  econds to avoid.
-000040d0: 2020 2020 2020 2020 2320 7468 6520 7072          # the pr
-000040e0: 6f67 7261 6d20 6765 7474 696e 6720 7374  ogram getting st
-000040f0: 7563 6b20 6f6e 2074 6f6f 2d73 686f 7274  uck on too-short
-00004100: 2074 696d 656f 7574 732e 0a20 2020 2020   timeouts..     
-00004110: 2020 2074 696d 656f 7574 203d 206d 6178     timeout = max
-00004120: 2869 6e74 2874 696d 656f 7574 5f6d 7329  (int(timeout_ms)
-00004130: 202a 2031 652d 332c 2030 2e31 2920 6966   * 1e-3, 0.1) if
-00004140: 2074 696d 656f 7574 5f6d 7320 656c 7365   timeout_ms else
-00004150: 204e 6f6e 650a 0a20 2020 2020 2020 206a   None..        j
-00004160: 6f62 5f63 6f6e 6669 6720 3d20 7479 7069  ob_config = typi
-00004170: 6e67 2e63 6173 7428 0a20 2020 2020 2020  ng.cast(.       
-00004180: 2020 2020 2062 6967 7175 6572 792e 5175       bigquery.Qu
-00004190: 6572 794a 6f62 436f 6e66 6967 2c0a 2020  eryJobConfig,.  
-000041a0: 2020 2020 2020 2020 2020 6269 6771 7565            bigque
-000041b0: 7279 2e51 7565 7279 4a6f 6243 6f6e 6669  ry.QueryJobConfi
-000041c0: 672e 6672 6f6d 5f61 7069 5f72 6570 7228  g.from_api_repr(
-000041d0: 636f 6e66 6967 7572 6174 696f 6e29 2c0a  configuration),.
-000041e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000041f0: 2020 6a6f 625f 636f 6e66 6967 2e6c 6162    job_config.lab
-00004200: 656c 735b 2262 6967 6672 616d 6573 2d61  els["bigframes-a
-00004210: 7069 225d 203d 2061 7069 5f6e 616d 650a  pi"] = api_name.
-00004220: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-00004230: 6967 2e64 6573 7469 6e61 7469 6f6e 203d  ig.destination =
-00004240: 2074 656d 705f 7461 626c 650a 0a20 2020   temp_table..   
-00004250: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00004260: 2020 2020 2020 2320 5772 6974 6520 746f        # Write to
-00004270: 2074 656d 7020 7461 626c 6520 746f 2077   temp table to w
-00004280: 6f72 6b61 726f 756e 6420 4269 6751 7565  orkaround BigQue
-00004290: 7279 2031 3020 4742 2071 7565 7279 2072  ry 10 GB query r
-000042a0: 6573 756c 7473 0a20 2020 2020 2020 2020  esults.         
-000042b0: 2020 2023 206c 696d 6974 2e20 5365 653a     # limit. See:
-000042c0: 2069 6e74 6572 6e61 6c20 6973 7375 6520   internal issue 
-000042d0: 3330 3330 3537 3333 362e 0a20 2020 2020  303057336..     
-000042e0: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
-000042f0: 672e 6c61 6265 6c73 5b22 6572 726f 725f  g.labels["error_
-00004300: 6361 7567 6874 225d 203d 2022 7472 7565  caught"] = "true
-00004310: 220a 2020 2020 2020 2020 2020 2020 5f2c  ".            _,
-00004320: 2071 7565 7279 5f6a 6f62 203d 2073 656c   query_job = sel
-00004330: 662e 5f73 7461 7274 5f71 7565 7279 280a  f._start_query(.
-00004340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004350: 7175 6572 792c 206a 6f62 5f63 6f6e 6669  query, job_confi
-00004360: 673d 6a6f 625f 636f 6e66 6967 2c20 7469  g=job_config, ti
-00004370: 6d65 6f75 743d 7469 6d65 6f75 740a 2020  meout=timeout.  
-00004380: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00004390: 2020 2020 2020 2020 7265 7475 726e 2071          return q
-000043a0: 7565 7279 5f6a 6f62 2e64 6573 7469 6e61  uery_job.destina
-000043b0: 7469 6f6e 2c20 7175 6572 795f 6a6f 620a  tion, query_job.
-000043c0: 2020 2020 2020 2020 6578 6365 7074 2067          except g
-000043d0: 6f6f 676c 652e 6170 695f 636f 7265 2e65  oogle.api_core.e
-000043e0: 7863 6570 7469 6f6e 732e 4261 6452 6571  xceptions.BadReq
-000043f0: 7565 7374 3a0a 2020 2020 2020 2020 2020  uest:.          
-00004400: 2020 2320 536f 6d65 2053 454c 4543 5420    # Some SELECT 
-00004410: 7374 6174 656d 656e 7473 2073 7469 6c6c  statements still
-00004420: 2061 7265 6e27 7420 636f 6d70 6174 6962   aren't compatib
-00004430: 6c65 2077 6974 6820 636c 7573 7465 720a  le with cluster.
-00004440: 2020 2020 2020 2020 2020 2020 2320 7461              # ta
-00004450: 626c 6573 2061 7320 7468 6520 6465 7374  bles as the dest
-00004460: 696e 6174 696f 6e2e 2046 6f72 2065 7861  ination. For exa
-00004470: 6d70 6c65 2c20 6966 2074 6865 2071 7565  mple, if the que
-00004480: 7279 2068 6173 2061 0a20 2020 2020 2020  ry has a.       
-00004490: 2020 2020 2023 2074 6f70 2d6c 6576 656c       # top-level
-000044a0: 204f 5244 4552 2042 592c 2074 6869 7320   ORDER BY, this 
-000044b0: 636f 6e66 6c69 6374 7320 7769 7468 206f  conflicts with o
-000044c0: 7572 2061 6269 6c69 7479 2074 6f20 636c  ur ability to cl
-000044d0: 7573 7465 720a 2020 2020 2020 2020 2020  uster.          
-000044e0: 2020 2320 7468 6520 7461 626c 6520 6279    # the table by
-000044f0: 2074 6865 2069 6e64 6578 2063 6f6c 756d   the index colum
-00004500: 6e28 7329 2e0a 2020 2020 2020 2020 2020  n(s)..          
-00004510: 2020 5f2c 2071 7565 7279 5f6a 6f62 203d    _, query_job =
-00004520: 2073 656c 662e 5f73 7461 7274 5f71 7565   self._start_que
-00004530: 7279 2871 7565 7279 2c20 7469 6d65 6f75  ry(query, timeou
-00004540: 743d 7469 6d65 6f75 7429 0a20 2020 2020  t=timeout).     
-00004550: 2020 2020 2020 2072 6574 7572 6e20 7175         return qu
-00004560: 6572 795f 6a6f 622e 6465 7374 696e 6174  ery_job.destinat
-00004570: 696f 6e2c 2071 7565 7279 5f6a 6f62 0a0a  ion, query_job..
-00004580: 2020 2020 6465 6620 7265 6164 5f67 6271      def read_gbq
-00004590: 5f71 7565 7279 280a 2020 2020 2020 2020  _query(.        
-000045a0: 7365 6c66 2c0a 2020 2020 2020 2020 7175  self,.        qu
-000045b0: 6572 793a 2073 7472 2c0a 2020 2020 2020  ery: str,.      
-000045c0: 2020 2a2c 0a20 2020 2020 2020 2069 6e64    *,.        ind
-000045d0: 6578 5f63 6f6c 3a20 4974 6572 6162 6c65  ex_col: Iterable
-000045e0: 5b73 7472 5d20 7c20 7374 7220 3d20 2829  [str] | str = ()
-000045f0: 2c0a 2020 2020 2020 2020 636f 6c75 6d6e  ,.        column
-00004600: 733a 2049 7465 7261 626c 655b 7374 725d  s: Iterable[str]
-00004610: 203d 2028 292c 0a20 2020 2020 2020 2063   = (),.        c
-00004620: 6f6e 6669 6775 7261 7469 6f6e 3a20 4f70  onfiguration: Op
-00004630: 7469 6f6e 616c 5b44 6963 745d 203d 204e  tional[Dict] = N
-00004640: 6f6e 652c 0a20 2020 2020 2020 206d 6178  one,.        max
-00004650: 5f72 6573 756c 7473 3a20 4f70 7469 6f6e  _results: Option
-00004660: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
-00004670: 2020 2020 2020 2020 7573 655f 6361 6368          use_cach
-00004680: 653a 204f 7074 696f 6e61 6c5b 626f 6f6c  e: Optional[bool
-00004690: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-000046a0: 2020 636f 6c5f 6f72 6465 723a 2049 7465    col_order: Ite
-000046b0: 7261 626c 655b 7374 725d 203d 2028 292c  rable[str] = (),
-000046c0: 0a20 2020 2029 202d 3e20 6461 7461 6672  .    ) -> datafr
-000046d0: 616d 652e 4461 7461 4672 616d 653a 0a20  ame.DataFrame:. 
-000046e0: 2020 2020 2020 2022 2222 5475 726e 2061         """Turn a
-000046f0: 2053 514c 2071 7565 7279 2069 6e74 6f20   SQL query into 
-00004700: 6120 4461 7461 4672 616d 652e 0a0a 2020  a DataFrame...  
-00004710: 2020 2020 2020 4e6f 7465 3a20 4265 6361        Note: Beca
-00004720: 7573 6520 7468 6520 7265 7375 6c74 7320  use the results 
-00004730: 6172 6520 7772 6974 7465 6e20 746f 2061  are written to a
-00004740: 2074 656d 706f 7261 7279 2074 6162 6c65   temporary table
-00004750: 2c20 6f72 6465 7269 6e67 2062 790a 2020  , ordering by.  
-00004760: 2020 2020 2020 6060 4f52 4445 5220 4259        ``ORDER BY
-00004770: 6060 2069 7320 6e6f 7420 7072 6573 6572  `` is not preser
-00004780: 7665 642e 2041 2075 6e69 7175 6520 6069  ved. A unique `i
-00004790: 6e64 6578 5f63 6f6c 6020 6973 2072 6563  ndex_col` is rec
-000047a0: 6f6d 6d65 6e64 6564 2e20 5573 650a 2020  ommended. Use.  
-000047b0: 2020 2020 2020 6060 726f 775f 6e75 6d62        ``row_numb
-000047c0: 6572 2829 206f 7665 7220 2829 6060 2069  er() over ()`` i
-000047d0: 6620 7468 6572 6520 6973 206e 6f20 6e61  f there is no na
-000047e0: 7475 7261 6c20 756e 6971 7565 2069 6e64  tural unique ind
-000047f0: 6578 206f 7220 796f 750a 2020 2020 2020  ex or you.      
-00004800: 2020 7761 6e74 2074 6f20 7072 6573 6572    want to preser
-00004810: 7665 206f 7264 6572 696e 672e 0a0a 2020  ve ordering...  
-00004820: 2020 2020 2020 2a2a 4578 616d 706c 6573        **Examples
-00004830: 3a2a 2a0a 0a20 2020 2020 2020 2020 2020  :**..           
-00004840: 203e 3e3e 2069 6d70 6f72 7420 6269 6766   >>> import bigf
-00004850: 7261 6d65 732e 7061 6e64 6173 2061 7320  rames.pandas as 
-00004860: 6270 640a 2020 2020 2020 2020 2020 2020  bpd.            
-00004870: 3e3e 3e20 6270 642e 6f70 7469 6f6e 732e  >>> bpd.options.
-00004880: 6469 7370 6c61 792e 7072 6f67 7265 7373  display.progress
-00004890: 5f62 6172 203d 204e 6f6e 650a 0a20 2020  _bar = None..   
-000048a0: 2020 2020 2053 696d 706c 6520 7175 6572       Simple quer
-000048b0: 7920 696e 7075 743a 0a0a 2020 2020 2020  y input:..      
-000048c0: 2020 2020 2020 3e3e 3e20 6466 203d 2062        >>> df = b
-000048d0: 7064 2e72 6561 645f 6762 715f 7175 6572  pd.read_gbq_quer
-000048e0: 7928 2727 270a 2020 2020 2020 2020 2020  y('''.          
-000048f0: 2020 2e2e 2e20 2020 2053 454c 4543 540a    ...    SELECT.
-00004900: 2020 2020 2020 2020 2020 2020 2e2e 2e20              ... 
-00004910: 2020 2020 2020 7069 7463 6865 7246 6972        pitcherFir
-00004920: 7374 4e61 6d65 2c0a 2020 2020 2020 2020  stName,.        
-00004930: 2020 2020 2e2e 2e20 2020 2020 2020 7069      ...       pi
-00004940: 7463 6865 724c 6173 744e 616d 652c 0a20  tcherLastName,. 
-00004950: 2020 2020 2020 2020 2020 202e 2e2e 2020             ...  
-00004960: 2020 2020 2070 6974 6368 5370 6565 642c       pitchSpeed,
-00004970: 0a20 2020 2020 2020 2020 2020 202e 2e2e  .            ...
-00004980: 2020 2020 4652 4f4d 2060 6269 6771 7565      FROM `bigque
-00004990: 7279 2d70 7562 6c69 632d 6461 7461 2e62  ry-public-data.b
-000049a0: 6173 6562 616c 6c2e 6761 6d65 735f 7769  aseball.games_wi
-000049b0: 6465 600a 2020 2020 2020 2020 2020 2020  de`.            
-000049c0: 2e2e 2e20 2727 2729 0a0a 2020 2020 2020  ... ''')..      
-000049d0: 2020 5072 6573 6572 7665 206f 7264 6572    Preserve order
-000049e0: 696e 6720 696e 2061 2071 7565 7279 2069  ing in a query i
-000049f0: 6e70 7574 2e0a 0a20 2020 2020 2020 2020  nput...         
-00004a00: 2020 203e 3e3e 2064 6620 3d20 6270 642e     >>> df = bpd.
-00004a10: 7265 6164 5f67 6271 5f71 7565 7279 2827  read_gbq_query('
-00004a20: 2727 0a20 2020 2020 2020 2020 2020 202e  ''.            .
-00004a30: 2e2e 2020 2020 5345 4c45 4354 0a20 2020  ..    SELECT.   
-00004a40: 2020 2020 2020 2020 202e 2e2e 2020 2020           ...    
-00004a50: 2020 202d 2d20 496e 7374 6561 6420 6f66     -- Instead of
-00004a60: 2061 6e20 4f52 4445 5220 4259 2063 6c61   an ORDER BY cla
-00004a70: 7573 6520 6f6e 2074 6865 2071 7565 7279  use on the query
-00004a80: 2c20 7573 650a 2020 2020 2020 2020 2020  , use.          
-00004a90: 2020 2e2e 2e20 2020 2020 2020 2d2d 2052    ...       -- R
-00004aa0: 4f57 5f4e 554d 4245 5228 2920 746f 2063  OW_NUMBER() to c
-00004ab0: 7265 6174 6520 616e 206f 7264 6572 6564  reate an ordered
-00004ac0: 2044 6174 6146 7261 6d65 2e0a 2020 2020   DataFrame..    
-00004ad0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00004ae0: 2020 524f 575f 4e55 4d42 4552 2829 204f    ROW_NUMBER() O
-00004af0: 5645 5220 284f 5244 4552 2042 5920 4156  VER (ORDER BY AV
-00004b00: 4728 7069 7463 6853 7065 6564 2920 4445  G(pitchSpeed) DE
-00004b10: 5343 290a 2020 2020 2020 2020 2020 2020  SC).            
-00004b20: 2e2e 2e20 2020 2020 2020 2020 4153 2072  ...         AS r
-00004b30: 6f77 696e 6465 782c 0a20 2020 2020 2020  owindex,.       
-00004b40: 2020 2020 202e 2e2e 0a20 2020 2020 2020       ....       
-00004b50: 2020 2020 202e 2e2e 2020 2020 2020 2070       ...       p
-00004b60: 6974 6368 6572 4669 7273 744e 616d 652c  itcherFirstName,
-00004b70: 0a20 2020 2020 2020 2020 2020 202e 2e2e  .            ...
-00004b80: 2020 2020 2020 2070 6974 6368 6572 4c61         pitcherLa
-00004b90: 7374 4e61 6d65 2c0a 2020 2020 2020 2020  stName,.        
-00004ba0: 2020 2020 2e2e 2e20 2020 2020 2020 4156      ...       AV
-00004bb0: 4728 7069 7463 6853 7065 6564 2920 4153  G(pitchSpeed) AS
-00004bc0: 2061 7665 7261 6765 5069 7463 6853 7065   averagePitchSpe
-00004bd0: 6564 0a20 2020 2020 2020 2020 2020 202e  ed.            .
-00004be0: 2e2e 2020 2020 2046 524f 4d20 6062 6967  ..     FROM `big
-00004bf0: 7175 6572 792d 7075 626c 6963 2d64 6174  query-public-dat
-00004c00: 612e 6261 7365 6261 6c6c 2e67 616d 6573  a.baseball.games
-00004c10: 5f77 6964 6560 0a20 2020 2020 2020 2020  _wide`.         
-00004c20: 2020 202e 2e2e 2020 2020 2057 4845 5245     ...     WHERE
-00004c30: 2079 6561 7220 3d20 3230 3136 0a20 2020   year = 2016.   
-00004c40: 2020 2020 2020 2020 202e 2e2e 2020 2020           ...    
-00004c50: 2047 524f 5550 2042 5920 7069 7463 6865   GROUP BY pitche
-00004c60: 7246 6972 7374 4e61 6d65 2c20 7069 7463  rFirstName, pitc
-00004c70: 6865 724c 6173 744e 616d 650a 2020 2020  herLastName.    
-00004c80: 2020 2020 2020 2020 2e2e 2e20 2727 272c          ... ''',
-00004c90: 2069 6e64 6578 5f63 6f6c 3d22 726f 7769   index_col="rowi
-00004ca0: 6e64 6578 2229 0a20 2020 2020 2020 2020  ndex").         
-00004cb0: 2020 203e 3e3e 2064 662e 6865 6164 2832     >>> df.head(2
-00004cc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004cd0: 2020 2020 2020 2070 6974 6368 6572 4669         pitcherFi
-00004ce0: 7273 744e 616d 6520 7069 7463 6865 724c  rstName pitcherL
-00004cf0: 6173 744e 616d 6520 2061 7665 7261 6765  astName  average
-00004d00: 5069 7463 6853 7065 6564 0a20 2020 2020  PitchSpeed.     
-00004d10: 2020 2020 2020 2072 6f77 696e 6465 780a         rowindex.
-00004d20: 2020 2020 2020 2020 2020 2020 3120 2020              1   
-00004d30: 2020 2020 2020 2020 2020 2020 2041 6c62               Alb
-00004d40: 6572 7469 6e20 2020 2020 2020 2020 4368  ertin         Ch
-00004d50: 6170 6d61 6e20 2020 2020 2020 2020 2039  apman          9
-00004d60: 362e 3531 3431 3133 0a20 2020 2020 2020  6.514113.       
-00004d70: 2020 2020 2032 2020 2020 2020 2020 2020       2          
-00004d80: 2020 2020 2020 205a 6163 6861 7279 2020         Zachary  
-00004d90: 2020 2020 2020 2042 7269 7474 6f6e 2020         Britton  
-00004da0: 2020 2020 2020 2020 3934 2e35 3931 3033          94.59103
-00004db0: 390a 2020 2020 2020 2020 2020 2020 3c42  9.            <B
-00004dc0: 4c41 4e4b 4c49 4e45 3e0a 2020 2020 2020  LANKLINE>.      
-00004dd0: 2020 2020 2020 5b32 2072 6f77 7320 7820        [2 rows x 
-00004de0: 3320 636f 6c75 6d6e 735d 0a0a 2020 2020  3 columns]..    
-00004df0: 2020 2020 5365 6520 616c 736f 3a20 3a6d      See also: :m
-00004e00: 6574 683a 6053 6573 7369 6f6e 2e72 6561  eth:`Session.rea
-00004e10: 645f 6762 7160 2e0a 2020 2020 2020 2020  d_gbq`..        
-00004e20: 2222 220a 2020 2020 2020 2020 2320 4e4f  """.        # NO
-00004e30: 5445 3a20 5468 6973 206d 6574 686f 6420  TE: This method 
-00004e40: 646f 6573 6e27 7420 2879 6574 2920 6578  doesn't (yet) ex
-00004e50: 6973 7420 696e 2070 616e 6461 7320 6f72  ist in pandas or
-00004e60: 2070 616e 6461 732d 6762 712c 2073 6f0a   pandas-gbq, so.
-00004e70: 2020 2020 2020 2020 2320 7468 6573 6520          # these 
-00004e80: 646f 6373 7472 696e 6773 2061 7265 2069  docstrings are i
-00004e90: 6e6c 696e 652e 0a20 2020 2020 2020 2069  nline..        i
-00004ea0: 6620 636f 6c75 6d6e 7320 616e 6420 636f  f columns and co
-00004eb0: 6c5f 6f72 6465 723a 0a20 2020 2020 2020  l_order:.       
-00004ec0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00004ed0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00004ee0: 2020 2020 2020 2022 4d75 7374 2073 7065         "Must spe
-00004ef0: 6369 6679 2065 6974 6865 7220 636f 6c75  cify either colu
-00004f00: 6d6e 7320 2870 7265 6665 7272 6564 2920  mns (preferred) 
-00004f10: 6f72 2063 6f6c 5f6f 7264 6572 2c20 6e6f  or col_order, no
-00004f20: 7420 626f 7468 220a 2020 2020 2020 2020  t both".        
-00004f30: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-00004f40: 6966 2063 6f6c 5f6f 7264 6572 3a0a 2020  if col_order:.  
-00004f50: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00004f60: 7320 3d20 636f 6c5f 6f72 6465 720a 0a20  s = col_order.. 
-00004f70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00004f80: 6c66 2e5f 7265 6164 5f67 6271 5f71 7565  lf._read_gbq_que
-00004f90: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
-00004fa0: 7175 6572 793d 7175 6572 792c 0a20 2020  query=query,.   
-00004fb0: 2020 2020 2020 2020 2069 6e64 6578 5f63           index_c
-00004fc0: 6f6c 3d69 6e64 6578 5f63 6f6c 2c0a 2020  ol=index_col,.  
-00004fd0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00004fe0: 733d 636f 6c75 6d6e 732c 0a20 2020 2020  s=columns,.     
-00004ff0: 2020 2020 2020 2063 6f6e 6669 6775 7261         configura
-00005000: 7469 6f6e 3d63 6f6e 6669 6775 7261 7469  tion=configurati
-00005010: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00005020: 6d61 785f 7265 7375 6c74 733d 6d61 785f  max_results=max_
-00005030: 7265 7375 6c74 732c 0a20 2020 2020 2020  results,.       
-00005040: 2020 2020 2061 7069 5f6e 616d 653d 2272       api_name="r
-00005050: 6561 645f 6762 715f 7175 6572 7922 2c0a  ead_gbq_query",.
-00005060: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-00005070: 6361 6368 653d 7573 655f 6361 6368 652c  cache=use_cache,
-00005080: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00005090: 6465 6620 5f72 6561 645f 6762 715f 7175  def _read_gbq_qu
-000050a0: 6572 7928 0a20 2020 2020 2020 2073 656c  ery(.        sel
-000050b0: 662c 0a20 2020 2020 2020 2071 7565 7279  f,.        query
-000050c0: 3a20 7374 722c 0a20 2020 2020 2020 202a  : str,.        *
-000050d0: 2c0a 2020 2020 2020 2020 696e 6465 785f  ,.        index_
-000050e0: 636f 6c3a 2049 7465 7261 626c 655b 7374  col: Iterable[st
-000050f0: 725d 207c 2073 7472 203d 2028 292c 0a20  r] | str = (),. 
-00005100: 2020 2020 2020 2063 6f6c 756d 6e73 3a20         columns: 
-00005110: 4974 6572 6162 6c65 5b73 7472 5d20 3d20  Iterable[str] = 
-00005120: 2829 2c0a 2020 2020 2020 2020 636f 6e66  (),.        conf
-00005130: 6967 7572 6174 696f 6e3a 204f 7074 696f  iguration: Optio
-00005140: 6e61 6c5b 4469 6374 5d20 3d20 4e6f 6e65  nal[Dict] = None
-00005150: 2c0a 2020 2020 2020 2020 6d61 785f 7265  ,.        max_re
-00005160: 7375 6c74 733a 204f 7074 696f 6e61 6c5b  sults: Optional[
-00005170: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-00005180: 2020 2020 2061 7069 5f6e 616d 653a 2073       api_name: s
-00005190: 7472 203d 2022 7265 6164 5f67 6271 5f71  tr = "read_gbq_q
-000051a0: 7565 7279 222c 0a20 2020 2020 2020 2075  uery",.        u
-000051b0: 7365 5f63 6163 6865 3a20 4f70 7469 6f6e  se_cache: Option
-000051c0: 616c 5b62 6f6f 6c5d 203d 204e 6f6e 652c  al[bool] = None,
-000051d0: 0a20 2020 2029 202d 3e20 6461 7461 6672  .    ) -> datafr
-000051e0: 616d 652e 4461 7461 4672 616d 653a 0a20  ame.DataFrame:. 
-000051f0: 2020 2020 2020 2069 6d70 6f72 7420 6269         import bi
-00005200: 6766 7261 6d65 732e 6461 7461 6672 616d  gframes.datafram
-00005210: 6520 6173 2064 6174 6166 7261 6d65 0a0a  e as dataframe..
-00005220: 2020 2020 2020 2020 636f 6e66 6967 7572          configur
-00005230: 6174 696f 6e20 3d20 5f74 7261 6e73 666f  ation = _transfo
-00005240: 726d 5f72 6561 645f 6762 715f 636f 6e66  rm_read_gbq_conf
-00005250: 6967 7572 6174 696f 6e28 636f 6e66 6967  iguration(config
-00005260: 7572 6174 696f 6e29 0a0a 2020 2020 2020  uration)..      
-00005270: 2020 6966 2022 7175 6572 7922 206e 6f74    if "query" not
-00005280: 2069 6e20 636f 6e66 6967 7572 6174 696f   in configuratio
-00005290: 6e3a 0a20 2020 2020 2020 2020 2020 2063  n:.            c
-000052a0: 6f6e 6669 6775 7261 7469 6f6e 5b22 7175  onfiguration["qu
-000052b0: 6572 7922 5d20 3d20 7b7d 0a0a 2020 2020  ery"] = {}..    
-000052c0: 2020 2020 6966 2022 7175 6572 7922 2069      if "query" i
-000052d0: 6e20 636f 6e66 6967 7572 6174 696f 6e5b  n configuration[
-000052e0: 2271 7565 7279 225d 3a0a 2020 2020 2020  "query"]:.      
-000052f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00005300: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00005310: 2020 2020 2020 2020 2254 6865 2071 7565          "The que
-00005320: 7279 2073 7461 7465 6d65 6e74 206d 7573  ry statement mus
-00005330: 7420 6e6f 7420 6265 2069 6e63 6c75 6465  t not be include
-00005340: 6420 696e 2074 6865 2022 2c0a 2020 2020  d in the ",.    
-00005350: 2020 2020 2020 2020 2020 2020 2227 636f              "'co
-00005360: 6e66 6967 7572 6174 696f 6e27 2062 6563  nfiguration' bec
-00005370: 6175 7365 2069 7420 6973 2061 6c72 6561  ause it is alrea
-00005380: 6479 2070 726f 7669 6465 6420 6173 222c  dy provided as",
-00005390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000053a0: 2022 2061 2073 6570 6172 6174 6520 7061   " a separate pa
-000053b0: 7261 6d65 7465 722e 222c 0a20 2020 2020  rameter.",.     
-000053c0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-000053d0: 2020 6966 2022 7573 6551 7565 7279 4361    if "useQueryCa
-000053e0: 6368 6522 2069 6e20 636f 6e66 6967 7572  che" in configur
-000053f0: 6174 696f 6e5b 2271 7565 7279 225d 3a0a  ation["query"]:.
-00005400: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-00005410: 7365 5f63 6163 6865 2069 7320 6e6f 7420  se_cache is not 
-00005420: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005430: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00005440: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00005450: 2020 2020 2020 2020 2020 2020 2227 7573              "'us
-00005460: 6551 7565 7279 4361 6368 6527 2069 6e20  eQueryCache' in 
-00005470: 2763 6f6e 6669 6775 7261 7469 6f6e 2720  'configuration' 
-00005480: 636f 6e66 6c69 6374 7320 7769 7468 220a  conflicts with".
-00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054a0: 2020 2020 2220 2775 7365 5f63 6163 6865      " 'use_cache
-000054b0: 2720 7061 7261 6d65 7465 722e 2050 6c65  ' parameter. Ple
-000054c0: 6173 6520 7370 6563 6966 7920 6f6e 6c79  ase specify only
-000054d0: 206f 6e65 2e22 0a20 2020 2020 2020 2020   one.".         
-000054e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000054f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00005500: 2020 2063 6f6e 6669 6775 7261 7469 6f6e     configuration
-00005510: 5b22 7175 6572 7922 5d5b 2275 7365 5175  ["query"]["useQu
-00005520: 6572 7943 6163 6865 225d 203d 2028 0a20  eryCache"] = (. 
-00005530: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00005540: 7275 6520 6966 2075 7365 5f63 6163 6865  rue if use_cache
-00005550: 2069 7320 4e6f 6e65 2065 6c73 6520 7573   is None else us
-00005560: 655f 6361 6368 650a 2020 2020 2020 2020  e_cache.        
-00005570: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-00005580: 6620 6973 696e 7374 616e 6365 2869 6e64  f isinstance(ind
-00005590: 6578 5f63 6f6c 2c20 7374 7229 3a0a 2020  ex_col, str):.  
-000055a0: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-000055b0: 636f 6c73 203d 205b 696e 6465 785f 636f  cols = [index_co
-000055c0: 6c5d 0a20 2020 2020 2020 2065 6c73 653a  l].        else:
-000055d0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-000055e0: 6578 5f63 6f6c 7320 3d20 6c69 7374 2869  ex_cols = list(i
-000055f0: 6e64 6578 5f63 6f6c 290a 0a20 2020 2020  ndex_col)..     
-00005600: 2020 2064 6573 7469 6e61 7469 6f6e 2c20     destination, 
-00005610: 7175 6572 795f 6a6f 6220 3d20 7365 6c66  query_job = self
-00005620: 2e5f 7175 6572 795f 746f 5f64 6573 7469  ._query_to_desti
-00005630: 6e61 7469 6f6e 280a 2020 2020 2020 2020  nation(.        
-00005640: 2020 2020 7175 6572 792c 0a20 2020 2020      query,.     
-00005650: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-00005660: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
-00005670: 7069 5f6e 616d 653d 6170 695f 6e61 6d65  pi_name=api_name
-00005680: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00005690: 6e66 6967 7572 6174 696f 6e3d 636f 6e66  nfiguration=conf
-000056a0: 6967 7572 6174 696f 6e2c 0a20 2020 2020  iguration,.     
-000056b0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-000056c0: 4966 2074 6865 7265 2077 6173 206e 6f20  If there was no 
-000056d0: 6465 7374 696e 6174 696f 6e20 7461 626c  destination tabl
-000056e0: 652c 2074 6861 7420 6d65 616e 7320 7468  e, that means th
-000056f0: 6520 7175 6572 7920 6d75 7374 2068 6176  e query must hav
-00005700: 650a 2020 2020 2020 2020 2320 6265 656e  e.        # been
-00005710: 2044 444c 206f 7220 444d 4c2e 2052 6574   DDL or DML. Ret
-00005720: 7572 6e20 736f 6d65 206a 6f62 206d 6574  urn some job met
-00005730: 6164 6174 612c 2069 6e73 7465 6164 2e0a  adata, instead..
-00005740: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00005750: 6573 7469 6e61 7469 6f6e 3a0a 2020 2020  estination:.    
-00005760: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00005770: 6174 6166 7261 6d65 2e44 6174 6146 7261  ataframe.DataFra
-00005780: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-00005790: 2020 2020 6461 7461 3d70 616e 6461 732e      data=pandas.
-000057a0: 4461 7461 4672 616d 6528 0a20 2020 2020  DataFrame(.     
-000057b0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-000057c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000057d0: 2020 2020 2020 2020 2022 7374 6174 656d           "statem
-000057e0: 656e 745f 7479 7065 223a 205b 0a20 2020  ent_type": [.   
-000057f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005800: 2020 2020 2020 2020 2071 7565 7279 5f6a           query_j
-00005810: 6f62 2e73 7461 7465 6d65 6e74 5f74 7970  ob.statement_typ
-00005820: 6520 6966 2071 7565 7279 5f6a 6f62 2065  e if query_job e
-00005830: 6c73 6520 2275 6e6b 6e6f 776e 220a 2020  lse "unknown".  
-00005840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005850: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
-00005860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005870: 2022 6a6f 625f 6964 223a 205b 7175 6572   "job_id": [quer
-00005880: 795f 6a6f 622e 6a6f 625f 6964 2069 6620  y_job.job_id if 
-00005890: 7175 6572 795f 6a6f 6220 656c 7365 2022  query_job else "
-000058a0: 756e 6b6e 6f77 6e22 5d2c 0a20 2020 2020  unknown"],.     
-000058b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058c0: 2020 2022 6c6f 6361 7469 6f6e 223a 205b     "location": [
-000058d0: 7175 6572 795f 6a6f 622e 6c6f 6361 7469  query_job.locati
-000058e0: 6f6e 2069 6620 7175 6572 795f 6a6f 6220  on if query_job 
-000058f0: 656c 7365 2022 756e 6b6e 6f77 6e22 5d2c  else "unknown"],
-00005900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005910: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00005920: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00005930: 2020 2020 2020 2020 2020 7365 7373 696f            sessio
-00005940: 6e3d 7365 6c66 2c0a 2020 2020 2020 2020  n=self,.        
-00005950: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
-00005960: 6574 7572 6e20 7365 6c66 2e72 6561 645f  eturn self.read_
-00005970: 6762 715f 7461 626c 6528 0a20 2020 2020  gbq_table(.     
-00005980: 2020 2020 2020 2066 227b 6465 7374 696e         f"{destin
-00005990: 6174 696f 6e2e 7072 6f6a 6563 747d 2e7b  ation.project}.{
-000059a0: 6465 7374 696e 6174 696f 6e2e 6461 7461  destination.data
-000059b0: 7365 745f 6964 7d2e 7b64 6573 7469 6e61  set_id}.{destina
-000059c0: 7469 6f6e 2e74 6162 6c65 5f69 647d 222c  tion.table_id}",
-000059d0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-000059e0: 6578 5f63 6f6c 3d69 6e64 6578 5f63 6f6c  ex_col=index_col
-000059f0: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
-00005a00: 6f6c 756d 6e73 3d63 6f6c 756d 6e73 2c0a  olumns=columns,.
-00005a10: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-00005a20: 7265 7375 6c74 733d 6d61 785f 7265 7375  results=max_resu
-00005a30: 6c74 732c 0a20 2020 2020 2020 2020 2020  lts,.           
-00005a40: 2075 7365 5f63 6163 6865 3d63 6f6e 6669   use_cache=confi
-00005a50: 6775 7261 7469 6f6e 5b22 7175 6572 7922  guration["query"
-00005a60: 5d5b 2275 7365 5175 6572 7943 6163 6865  ]["useQueryCache
-00005a70: 225d 2c0a 2020 2020 2020 2020 290a 0a20  "],.        ).. 
-00005a80: 2020 2064 6566 2072 6561 645f 6762 715f     def read_gbq_
-00005a90: 7461 626c 6528 0a20 2020 2020 2020 2073  table(.        s
-00005aa0: 656c 662c 0a20 2020 2020 2020 2071 7565  elf,.        que
-00005ab0: 7279 3a20 7374 722c 0a20 2020 2020 2020  ry: str,.       
-00005ac0: 202a 2c0a 2020 2020 2020 2020 696e 6465   *,.        inde
-00005ad0: 785f 636f 6c3a 2049 7465 7261 626c 655b  x_col: Iterable[
-00005ae0: 7374 725d 207c 2073 7472 203d 2028 292c  str] | str = (),
-00005af0: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
-00005b00: 3a20 4974 6572 6162 6c65 5b73 7472 5d20  : Iterable[str] 
-00005b10: 3d20 2829 2c0a 2020 2020 2020 2020 6d61  = (),.        ma
-00005b20: 785f 7265 7375 6c74 733a 204f 7074 696f  x_results: Optio
-00005b30: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-00005b40: 0a20 2020 2020 2020 2066 696c 7465 7273  .        filters
-00005b50: 3a20 7468 6972 645f 7061 7274 795f 7061  : third_party_pa
-00005b60: 6e64 6173 5f67 6271 2e46 696c 7465 7273  ndas_gbq.Filters
-00005b70: 5479 7065 203d 2028 292c 0a20 2020 2020  Type = (),.     
-00005b80: 2020 2075 7365 5f63 6163 6865 3a20 626f     use_cache: bo
-00005b90: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
-00005ba0: 2020 2063 6f6c 5f6f 7264 6572 3a20 4974     col_order: It
-00005bb0: 6572 6162 6c65 5b73 7472 5d20 3d20 2829  erable[str] = ()
-00005bc0: 2c0a 2020 2020 2920 2d3e 2064 6174 6166  ,.    ) -> dataf
-00005bd0: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
-00005be0: 2020 2020 2020 2020 2222 2254 7572 6e20          """Turn 
-00005bf0: 6120 4269 6751 7565 7279 2074 6162 6c65  a BigQuery table
-00005c00: 2069 6e74 6f20 6120 4461 7461 4672 616d   into a DataFram
-00005c10: 652e 0a0a 2020 2020 2020 2020 2a2a 4578  e...        **Ex
-00005c20: 616d 706c 6573 3a2a 2a0a 0a20 2020 2020  amples:**..     
-00005c30: 2020 2020 2020 203e 3e3e 2069 6d70 6f72         >>> impor
-00005c40: 7420 6269 6766 7261 6d65 732e 7061 6e64  t bigframes.pand
-00005c50: 6173 2061 7320 6270 640a 2020 2020 2020  as as bpd.      
-00005c60: 2020 2020 2020 3e3e 3e20 6270 642e 6f70        >>> bpd.op
-00005c70: 7469 6f6e 732e 6469 7370 6c61 792e 7072  tions.display.pr
-00005c80: 6f67 7265 7373 5f62 6172 203d 204e 6f6e  ogress_bar = Non
-00005c90: 650a 0a20 2020 2020 2020 2052 6561 6420  e..        Read 
-00005ca0: 6120 7768 6f6c 6520 7461 626c 652c 2077  a whole table, w
-00005cb0: 6974 6820 6172 6269 7472 6172 7920 6f72  ith arbitrary or
-00005cc0: 6465 7269 6e67 206f 7220 6f72 6465 7269  dering or orderi
-00005cd0: 6e67 2063 6f72 7265 7370 6f6e 6469 6e67  ng corresponding
-00005ce0: 2074 6f20 7468 6520 7072 696d 6172 7920   to the primary 
-00005cf0: 6b65 7928 7329 2e0a 0a20 2020 2020 2020  key(s)...       
-00005d00: 2020 2020 203e 3e3e 2064 6620 3d20 6270       >>> df = bp
-00005d10: 642e 7265 6164 5f67 6271 5f74 6162 6c65  d.read_gbq_table
-00005d20: 2822 6269 6771 7565 7279 2d70 7562 6c69  ("bigquery-publi
-00005d30: 632d 6461 7461 2e6d 6c5f 6461 7461 7365  c-data.ml_datase
-00005d40: 7473 2e70 656e 6775 696e 7322 290a 0a20  ts.penguins").. 
-00005d50: 2020 2020 2020 2053 6565 2061 6c73 6f3a         See also:
-00005d60: 203a 6d65 7468 3a60 5365 7373 696f 6e2e   :meth:`Session.
-00005d70: 7265 6164 5f67 6271 602e 0a20 2020 2020  read_gbq`..     
-00005d80: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-00005d90: 204e 4f54 453a 2054 6869 7320 6d65 7468   NOTE: This meth
-00005da0: 6f64 2064 6f65 736e 2774 2028 7965 7429  od doesn't (yet)
-00005db0: 2065 7869 7374 2069 6e20 7061 6e64 6173   exist in pandas
-00005dc0: 206f 7220 7061 6e64 6173 2d67 6271 2c20   or pandas-gbq, 
-00005dd0: 736f 0a20 2020 2020 2020 2023 2074 6865  so.        # the
-00005de0: 7365 2064 6f63 7374 7269 6e67 7320 6172  se docstrings ar
-00005df0: 6520 696e 6c69 6e65 2e0a 2020 2020 2020  e inline..      
-00005e00: 2020 6966 2063 6f6c 756d 6e73 2061 6e64    if columns and
-00005e10: 2063 6f6c 5f6f 7264 6572 3a0a 2020 2020   col_order:.    
-00005e20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00005e30: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00005e40: 2020 2020 2020 2020 2020 224d 7573 7420            "Must 
-00005e50: 7370 6563 6966 7920 6569 7468 6572 2063  specify either c
-00005e60: 6f6c 756d 6e73 2028 7072 6566 6572 7265  olumns (preferre
-00005e70: 6429 206f 7220 636f 6c5f 6f72 6465 722c  d) or col_order,
-00005e80: 206e 6f74 2062 6f74 6822 0a20 2020 2020   not both".     
-00005e90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00005ea0: 2065 6c69 6620 636f 6c5f 6f72 6465 723a   elif col_order:
-00005eb0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00005ec0: 756d 6e73 203d 2063 6f6c 5f6f 7264 6572  umns = col_order
-00005ed0: 0a0a 2020 2020 2020 2020 6669 6c74 6572  ..        filter
-00005ee0: 7320 3d20 6c69 7374 2866 696c 7465 7273  s = list(filters
-00005ef0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00005f00: 2866 696c 7465 7273 2920 213d 2030 206f  (filters) != 0 o
-00005f10: 7220 5f69 735f 7461 626c 655f 7769 7468  r _is_table_with
-00005f20: 5f77 696c 6463 6172 645f 7375 6666 6978  _wildcard_suffix
-00005f30: 2871 7565 7279 293a 0a20 2020 2020 2020  (query):.       
-00005f40: 2020 2020 2071 7565 7279 203d 2073 656c       query = sel
-00005f50: 662e 5f74 6f5f 7175 6572 7928 7175 6572  f._to_query(quer
-00005f60: 792c 2063 6f6c 756d 6e73 2c20 6669 6c74  y, columns, filt
-00005f70: 6572 7329 0a0a 2020 2020 2020 2020 2020  ers)..          
-00005f80: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00005f90: 6561 645f 6762 715f 7175 6572 7928 0a20  ead_gbq_query(. 
-00005fa0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-00005fb0: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
-00005fc0: 2020 2020 2020 696e 6465 785f 636f 6c3d        index_col=
-00005fd0: 696e 6465 785f 636f 6c2c 0a20 2020 2020  index_col,.     
-00005fe0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00005ff0: 6e73 3d63 6f6c 756d 6e73 2c0a 2020 2020  ns=columns,.    
-00006000: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-00006010: 7265 7375 6c74 733d 6d61 785f 7265 7375  results=max_resu
-00006020: 6c74 732c 0a20 2020 2020 2020 2020 2020  lts,.           
-00006030: 2020 2020 2061 7069 5f6e 616d 653d 2272       api_name="r
-00006040: 6561 645f 6762 715f 7461 626c 6522 2c0a  ead_gbq_table",.
-00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006060: 7573 655f 6361 6368 653d 7573 655f 6361  use_cache=use_ca
-00006070: 6368 652c 0a20 2020 2020 2020 2020 2020  che,.           
-00006080: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-00006090: 726e 2073 656c 662e 5f72 6561 645f 6762  rn self._read_gb
-000060a0: 715f 7461 626c 6528 0a20 2020 2020 2020  q_table(.       
-000060b0: 2020 2020 2071 7565 7279 3d71 7565 7279       query=query
-000060c0: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-000060d0: 6465 785f 636f 6c3d 696e 6465 785f 636f  dex_col=index_co
-000060e0: 6c2c 0a20 2020 2020 2020 2020 2020 2063  l,.            c
-000060f0: 6f6c 756d 6e73 3d63 6f6c 756d 6e73 2c0a  olumns=columns,.
-00006100: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-00006110: 7265 7375 6c74 733d 6d61 785f 7265 7375  results=max_resu
-00006120: 6c74 732c 0a20 2020 2020 2020 2020 2020  lts,.           
-00006130: 2061 7069 5f6e 616d 653d 2272 6561 645f   api_name="read_
-00006140: 6762 715f 7461 626c 6522 2c0a 2020 2020  gbq_table",.    
-00006150: 2020 2020 2020 2020 7573 655f 6361 6368          use_cach
-00006160: 653d 7573 655f 6361 6368 652c 0a20 2020  e=use_cache,.   
-00006170: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00006180: 5f67 6574 5f73 6e61 7073 686f 745f 7371  _get_snapshot_sq
-00006190: 6c5f 616e 645f 7072 696d 6172 795f 6b65  l_and_primary_ke
-000061a0: 7928 0a20 2020 2020 2020 2073 656c 662c  y(.        self,
-000061b0: 0a20 2020 2020 2020 2074 6162 6c65 5f72  .        table_r
-000061c0: 6566 3a20 6269 6771 7565 7279 2e74 6162  ef: bigquery.tab
-000061d0: 6c65 2e54 6162 6c65 5265 6665 7265 6e63  le.TableReferenc
-000061e0: 652c 0a20 2020 2020 2020 202a 2c0a 2020  e,.        *,.  
-000061f0: 2020 2020 2020 6170 695f 6e61 6d65 3a20        api_name: 
-00006200: 7374 722c 0a20 2020 2020 2020 2075 7365  str,.        use
-00006210: 5f63 6163 6865 3a20 626f 6f6c 203d 2054  _cache: bool = T
-00006220: 7275 652c 0a20 2020 2029 202d 3e20 5475  rue,.    ) -> Tu
-00006230: 706c 655b 6962 6973 5f74 7970 6573 2e54  ple[ibis_types.T
-00006240: 6162 6c65 2c20 4f70 7469 6f6e 616c 5b53  able, Optional[S
-00006250: 6571 7565 6e63 655b 7374 725d 5d5d 3a0a  equence[str]]]:.
-00006260: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
-00006270: 6520 6120 7265 6164 2d6f 6e6c 7920 4962  e a read-only Ib
-00006280: 6973 2074 6162 6c65 2065 7870 7265 7373  is table express
-00006290: 696f 6e20 7265 7072 6573 656e 7469 6e67  ion representing
-000062a0: 2061 2074 6162 6c65 2e0a 0a20 2020 2020   a table...     
-000062b0: 2020 2049 6620 7765 2063 616e 2067 6574     If we can get
-000062c0: 2061 2074 6f74 616c 206f 7264 6572 696e   a total orderin
-000062d0: 6720 6672 6f6d 2074 6865 2074 6162 6c65  g from the table
-000062e0: 2c20 7375 6368 2061 7320 7669 6120 7072  , such as via pr
-000062f0: 696d 6172 7920 6b65 790a 2020 2020 2020  imary key.      
-00006300: 2020 636f 6c75 6d6e 2873 292c 2074 6865    column(s), the
-00006310: 6e20 7265 7475 726e 2074 686f 7365 2074  n return those t
-00006320: 6f6f 2073 6f20 7468 6174 206f 7264 6572  oo so that order
-00006330: 696e 6720 6765 6e65 7261 7469 6f6e 2063  ing generation c
-00006340: 616e 2062 650a 2020 2020 2020 2020 6176  an be.        av
-00006350: 6f69 6465 642e 0a20 2020 2020 2020 2022  oided..        "
-00006360: 2222 0a20 2020 2020 2020 2023 2049 6620  "".        # If 
-00006370: 7468 6572 6520 6172 6520 7072 696d 6172  there are primar
-00006380: 7920 6b65 7973 2064 6566 696e 6564 2c20  y keys defined, 
-00006390: 7468 6520 7175 6572 7920 656e 6769 6e65  the query engine
-000063a0: 2061 7373 756d 6573 2074 6865 7365 0a20   assumes these. 
-000063b0: 2020 2020 2020 2023 2063 6f6c 756d 6e73         # columns
-000063c0: 2061 7265 2075 6e69 7175 652c 2065 7665   are unique, eve
-000063d0: 6e20 6966 2074 6865 2063 6f6e 7374 7261  n if the constra
-000063e0: 696e 7420 6973 206e 6f74 2065 6e66 6f72  int is not enfor
-000063f0: 6365 642e 2057 6520 6d61 6b65 0a20 2020  ced. We make.   
-00006400: 2020 2020 2023 2074 6865 2073 616d 6520       # the same 
-00006410: 6173 7375 6d70 7469 6f6e 2061 6e64 2075  assumption and u
-00006420: 7365 2074 6865 7365 2063 6f6c 756d 6e73  se these columns
-00006430: 2061 7320 7468 6520 746f 7461 6c20 6f72   as the total or
-00006440: 6465 7269 6e67 206b 6579 732e 0a20 2020  dering keys..   
-00006450: 2020 2020 2074 6162 6c65 203d 2073 656c       table = sel
-00006460: 662e 6271 636c 6965 6e74 2e67 6574 5f74  f.bqclient.get_t
-00006470: 6162 6c65 2874 6162 6c65 5f72 6566 290a  able(table_ref).
-00006480: 0a20 2020 2020 2020 2069 6620 7461 626c  .        if tabl
-00006490: 652e 6c6f 6361 7469 6f6e 2e63 6173 6566  e.location.casef
-000064a0: 6f6c 6428 2920 213d 2073 656c 662e 5f6c  old() != self._l
-000064b0: 6f63 6174 696f 6e2e 6361 7365 666f 6c64  ocation.casefold
-000064c0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000064d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000064e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000064f0: 2020 6622 4375 7272 656e 7420 7365 7373    f"Current sess
-00006500: 696f 6e20 6973 2069 6e20 7b73 656c 662e  ion is in {self.
-00006510: 5f6c 6f63 6174 696f 6e7d 2062 7574 2064  _location} but d
-00006520: 6174 6173 6574 2027 7b74 6162 6c65 2e70  ataset '{table.p
-00006530: 726f 6a65 6374 7d2e 7b74 6162 6c65 2e64  roject}.{table.d
-00006540: 6174 6173 6574 5f69 647d 2720 6973 206c  ataset_id}' is l
-00006550: 6f63 6174 6564 2069 6e20 7b74 6162 6c65  ocated in {table
-00006560: 2e6c 6f63 6174 696f 6e7d 220a 2020 2020  .location}".    
-00006570: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00006580: 2020 2023 2054 4f44 4f28 622f 3330 3532     # TODO(b/3052
-00006590: 3634 3135 3329 3a20 5573 6520 7075 626c  64153): Use publ
-000065a0: 6963 2070 726f 7065 7274 6965 7320 746f  ic properties to
-000065b0: 2066 6574 6368 2070 7269 6d61 7279 206b   fetch primary k
-000065c0: 6579 7320 6f6e 6365 0a20 2020 2020 2020  eys once.       
-000065d0: 2023 2061 6464 6564 2074 6f20 676f 6f67   # added to goog
-000065e0: 6c65 2d63 6c6f 7564 2d62 6967 7175 6572  le-cloud-bigquer
-000065f0: 792e 0a20 2020 2020 2020 2070 7269 6d61  y..        prima
-00006600: 7279 5f6b 6579 7320 3d20 280a 2020 2020  ry_keys = (.    
-00006610: 2020 2020 2020 2020 7461 626c 652e 5f70          table._p
-00006620: 726f 7065 7274 6965 732e 6765 7428 2274  roperties.get("t
-00006630: 6162 6c65 436f 6e73 7472 6169 6e74 7322  ableConstraints"
-00006640: 2c20 7b7d 290a 2020 2020 2020 2020 2020  , {}).          
-00006650: 2020 2e67 6574 2822 7072 696d 6172 794b    .get("primaryK
-00006660: 6579 222c 207b 7d29 0a20 2020 2020 2020  ey", {}).       
-00006670: 2020 2020 202e 6765 7428 2263 6f6c 756d       .get("colum
-00006680: 6e73 2229 0a20 2020 2020 2020 2029 0a0a  ns").        )..
-00006690: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-000066a0: 6967 203d 2062 6967 7175 6572 792e 5175  ig = bigquery.Qu
-000066b0: 6572 794a 6f62 436f 6e66 6967 2829 0a20  eryJobConfig(). 
-000066c0: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
-000066d0: 672e 6c61 6265 6c73 5b22 6269 6766 7261  g.labels["bigfra
-000066e0: 6d65 732d 6170 6922 5d20 3d20 6170 695f  mes-api"] = api_
-000066f0: 6e61 6d65 0a20 2020 2020 2020 2069 6620  name.        if 
-00006700: 7573 655f 6361 6368 6520 616e 6420 7461  use_cache and ta
-00006710: 626c 655f 7265 6620 696e 2073 656c 662e  ble_ref in self.
-00006720: 5f64 665f 736e 6170 7368 6f74 2e6b 6579  _df_snapshot.key
-00006730: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00006740: 2073 6e61 7073 686f 745f 7469 6d65 7374   snapshot_timest
-00006750: 616d 7020 3d20 7365 6c66 2e5f 6466 5f73  amp = self._df_s
-00006760: 6e61 7073 686f 745b 7461 626c 655f 7265  napshot[table_re
-00006770: 665d 0a0a 2020 2020 2020 2020 2020 2020  f]..            
-00006780: 2320 4361 6368 6520 6869 7420 636f 756c  # Cache hit coul
-00006790: 6420 6265 2075 6e65 7870 6563 7465 642e  d be unexpected.
-000067a0: 2053 6565 2069 6e74 6572 6e61 6c20 6973   See internal is
-000067b0: 7375 6520 3332 3935 3435 3830 352e 0a20  sue 329545805.. 
-000067c0: 2020 2020 2020 2020 2020 2023 2052 6169             # Rai
-000067d0: 7365 2061 2077 6172 6e69 6e67 2077 6974  se a warning wit
-000067e0: 6820 6d6f 7265 2069 6e66 6f72 6d61 7469  h more informati
-000067f0: 6f6e 2061 626f 7574 2068 6f77 2074 6f20  on about how to 
-00006800: 6176 6f69 6420 7468 650a 2020 2020 2020  avoid the.      
-00006810: 2020 2020 2020 2320 7072 6f62 6c65 6d73        # problems
-00006820: 2077 6974 6820 7468 6520 6361 6368 652e   with the cache.
-00006830: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-00006840: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
-00006850: 2020 2020 2020 2020 2020 2020 6622 5265              f"Re
-00006860: 6164 696e 6720 6361 6368 6564 2074 6162  ading cached tab
-00006870: 6c65 2066 726f 6d20 7b73 6e61 7073 686f  le from {snapsho
-00006880: 745f 7469 6d65 7374 616d 707d 2074 6f20  t_timestamp} to 
-00006890: 6176 6f69 6420 220a 2020 2020 2020 2020  avoid ".        
-000068a0: 2020 2020 2020 2020 2269 6e63 6f6d 7061          "incompa
-000068b0: 7469 6269 6c69 6573 2077 6974 6820 7072  tibilies with pr
-000068c0: 6576 696f 7573 2072 6561 6473 206f 6620  evious reads of 
-000068d0: 7468 6973 2074 6162 6c65 2e20 546f 2072  this table. To r
-000068e0: 6561 6420 220a 2020 2020 2020 2020 2020  ead ".          
-000068f0: 2020 2020 2020 2274 6865 206c 6174 6573        "the lates
-00006900: 7420 7665 7273 696f 6e2c 2073 6574 2060  t version, set `
-00006910: 7573 655f 6361 6368 653d 4661 6c73 6560  use_cache=False`
-00006920: 206f 7220 636c 6f73 6520 7468 6520 220a   or close the ".
-00006930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006940: 2263 7572 7265 6e74 2073 6573 7369 6f6e  "current session
-00006950: 2077 6974 6820 5365 7373 696f 6e2e 636c   with Session.cl
-00006960: 6f73 6528 2920 6f72 2022 0a20 2020 2020  ose() or ".     
-00006970: 2020 2020 2020 2020 2020 2022 6269 6766             "bigf
-00006980: 7261 6d65 732e 7061 6e64 6173 2e63 6c6f  rames.pandas.clo
-00006990: 7365 5f73 6573 7369 6f6e 2829 2e22 2c0a  se_session().",.
-000069a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000069b0: 2320 5468 6572 6520 6172 6520 6d61 6e79  # There are many
-000069c0: 206c 6179 6572 7320 6265 666f 7265 2077   layers before w
-000069d0: 6520 6765 7420 746f 2028 706f 7373 6962  e get to (possib
-000069e0: 6c79 2920 7468 6520 7573 6572 2773 2063  ly) the user's c
-000069f0: 6f64 653a 0a20 2020 2020 2020 2020 2020  ode:.           
-00006a00: 2020 2020 2023 2070 616e 6461 732e 7265       # pandas.re
-00006a10: 6164 5f67 6271 5f74 6162 6c65 0a20 2020  ad_gbq_table.   
-00006a20: 2020 2020 2020 2020 2020 2020 2023 202d               # -
-00006a30: 3e20 7769 7468 5f64 6566 6175 6c74 5f73  > with_default_s
-00006a40: 6573 7369 6f6e 0a20 2020 2020 2020 2020  ession.         
-00006a50: 2020 2020 2020 2023 202d 3e20 5365 7373         # -> Sess
-00006a60: 696f 6e2e 7265 6164 5f67 6271 5f74 6162  ion.read_gbq_tab
-00006a70: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-00006a80: 2020 2023 202d 3e20 5f72 6561 645f 6762     # -> _read_gb
-00006a90: 715f 7461 626c 650a 2020 2020 2020 2020  q_table.        
-00006aa0: 2020 2020 2020 2020 2320 2d3e 205f 6765          # -> _ge
-00006ab0: 745f 736e 6170 7368 6f74 5f73 716c 5f61  t_snapshot_sql_a
-00006ac0: 6e64 5f70 7269 6d61 7279 5f6b 6579 0a20  nd_primary_key. 
-00006ad0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006ae0: 7461 636b 6c65 7665 6c3d 362c 0a20 2020  tacklevel=6,.   
-00006af0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006b00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006b10: 2020 2020 2073 6e61 7073 686f 745f 7469       snapshot_ti
-00006b20: 6d65 7374 616d 7020 3d20 6c69 7374 280a  mestamp = list(.
-00006b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b40: 7365 6c66 2e62 7163 6c69 656e 742e 7175  self.bqclient.qu
-00006b50: 6572 7928 0a20 2020 2020 2020 2020 2020  ery(.           
-00006b60: 2020 2020 2020 2020 2022 5345 4c45 4354           "SELECT
-00006b70: 2043 5552 5245 4e54 5f54 494d 4553 5441   CURRENT_TIMESTA
-00006b80: 4d50 2829 2041 5320 6063 7572 7265 6e74  MP() AS `current
-00006b90: 5f74 696d 6573 7461 6d70 6022 2c0a 2020  _timestamp`",.  
-00006ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006bb0: 2020 6a6f 625f 636f 6e66 6967 3d6a 6f62    job_config=job
-00006bc0: 5f63 6f6e 6669 672c 0a20 2020 2020 2020  _config,.       
-00006bd0: 2020 2020 2020 2020 2029 2e72 6573 756c           ).resul
-00006be0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00006bf0: 295b 305d 5b30 5d0a 2020 2020 2020 2020  )[0][0].        
-00006c00: 2020 2020 7365 6c66 2e5f 6466 5f73 6e61      self._df_sna
-00006c10: 7073 686f 745b 7461 626c 655f 7265 665d  pshot[table_ref]
-00006c20: 203d 2073 6e61 7073 686f 745f 7469 6d65   = snapshot_time
-00006c30: 7374 616d 700a 0a20 2020 2020 2020 2074  stamp..        t
-00006c40: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00006c50: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
-00006c60: 203d 2073 656c 662e 6962 6973 5f63 6c69   = self.ibis_cli
-00006c70: 656e 742e 7371 6c28 0a20 2020 2020 2020  ent.sql(.       
-00006c80: 2020 2020 2020 2020 2062 6967 6672 616d           bigfram
-00006c90: 6573 5f69 6f2e 6372 6561 7465 5f73 6e61  es_io.create_sna
-00006ca0: 7073 686f 745f 7371 6c28 7461 626c 655f  pshot_sql(table_
-00006cb0: 7265 662c 2073 6e61 7073 686f 745f 7469  ref, snapshot_ti
-00006cc0: 6d65 7374 616d 7029 0a20 2020 2020 2020  mestamp).       
-00006cd0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00006ce0: 7863 6570 7420 676f 6f67 6c65 2e61 7069  xcept google.api
-00006cf0: 5f63 6f72 652e 6578 6365 7074 696f 6e73  _core.exceptions
-00006d00: 2e46 6f72 6269 6464 656e 2061 7320 6578  .Forbidden as ex
-00006d10: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00006d20: 2022 4472 6976 6520 6372 6564 656e 7469   "Drive credenti
-00006d30: 616c 7322 2069 6e20 6578 2e6d 6573 7361  als" in ex.messa
-00006d40: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
-00006d50: 2020 2020 6578 2e6d 6573 7361 6765 202b      ex.message +
-00006d60: 3d20 225c 6e43 6865 636b 2068 7474 7073  = "\nCheck https
-00006d70: 3a2f 2f63 6c6f 7564 2e67 6f6f 676c 652e  ://cloud.google.
-00006d80: 636f 6d2f 6269 6771 7565 7279 2f64 6f63  com/bigquery/doc
-00006d90: 732f 7175 6572 792d 6472 6976 652d 6461  s/query-drive-da
-00006da0: 7461 2347 6f6f 676c 655f 4472 6976 655f  ta#Google_Drive_
-00006db0: 7065 726d 6973 7369 6f6e 732e 220a 2020  permissions.".  
-00006dc0: 2020 2020 2020 2020 2020 7261 6973 650a            raise.
-00006dd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006de0: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
-00006df0: 2c20 7072 696d 6172 795f 6b65 7973 0a0a  , primary_keys..
-00006e00: 2020 2020 6465 6620 5f72 6561 645f 6762      def _read_gb
-00006e10: 715f 7461 626c 6528 0a20 2020 2020 2020  q_table(.       
-00006e20: 2073 656c 662c 0a20 2020 2020 2020 2071   self,.        q
-00006e30: 7565 7279 3a20 7374 722c 0a20 2020 2020  uery: str,.     
-00006e40: 2020 202a 2c0a 2020 2020 2020 2020 696e     *,.        in
-00006e50: 6465 785f 636f 6c3a 2049 7465 7261 626c  dex_col: Iterabl
-00006e60: 655b 7374 725d 207c 2073 7472 203d 2028  e[str] | str = (
-00006e70: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
-00006e80: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
-00006e90: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
-00006ea0: 6d61 785f 7265 7375 6c74 733a 204f 7074  max_results: Opt
-00006eb0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-00006ec0: 652c 0a20 2020 2020 2020 2061 7069 5f6e  e,.        api_n
-00006ed0: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
-00006ee0: 2020 7573 655f 6361 6368 653a 2062 6f6f    use_cache: boo
-00006ef0: 6c20 3d20 5472 7565 2c0a 2020 2020 2920  l = True,.    ) 
-00006f00: 2d3e 2064 6174 6166 7261 6d65 2e44 6174  -> dataframe.Dat
-00006f10: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
-00006f20: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
-00006f30: 2e64 6174 6166 7261 6d65 2061 7320 6461  .dataframe as da
-00006f40: 7461 6672 616d 650a 0a20 2020 2020 2020  taframe..       
-00006f50: 2069 6620 6d61 785f 7265 7375 6c74 7320   if max_results 
-00006f60: 616e 6420 6d61 785f 7265 7375 6c74 7320  and max_results 
-00006f70: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-00006f80: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00006f90: 6f72 2822 606d 6178 5f72 6573 756c 7473  or("`max_results
-00006fa0: 6020 7368 6f75 6c64 2062 6520 6120 706f  ` should be a po
-00006fb0: 7369 7469 7665 206e 756d 6265 722e 2229  sitive number.")
-00006fc0: 0a0a 2020 2020 2020 2020 7461 626c 655f  ..        table_
-00006fd0: 7265 6620 3d20 6269 6771 7565 7279 2e74  ref = bigquery.t
-00006fe0: 6162 6c65 2e54 6162 6c65 5265 6665 7265  able.TableRefere
-00006ff0: 6e63 652e 6672 6f6d 5f73 7472 696e 6728  nce.from_string(
-00007000: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
-00007010: 7279 2c20 6465 6661 756c 745f 7072 6f6a  ry, default_proj
-00007020: 6563 743d 7365 6c66 2e62 7163 6c69 656e  ect=self.bqclien
-00007030: 742e 7072 6f6a 6563 740a 2020 2020 2020  t.project.      
-00007040: 2020 290a 0a20 2020 2020 2020 2028 0a20    )..        (. 
-00007050: 2020 2020 2020 2020 2020 2074 6162 6c65             table
-00007060: 5f65 7870 7265 7373 696f 6e2c 0a20 2020  _expression,.   
-00007070: 2020 2020 2020 2020 2074 6f74 616c 5f6f           total_o
-00007080: 7264 6572 696e 675f 636f 6c73 2c0a 2020  rdering_cols,.  
-00007090: 2020 2020 2020 2920 3d20 7365 6c66 2e5f        ) = self._
-000070a0: 6765 745f 736e 6170 7368 6f74 5f73 716c  get_snapshot_sql
-000070b0: 5f61 6e64 5f70 7269 6d61 7279 5f6b 6579  _and_primary_key
-000070c0: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
-000070d0: 626c 655f 7265 662c 2061 7069 5f6e 616d  ble_ref, api_nam
-000070e0: 653d 6170 695f 6e61 6d65 2c20 7573 655f  e=api_name, use_
-000070f0: 6361 6368 653d 7573 655f 6361 6368 650a  cache=use_cache.
-00007100: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00007110: 2020 2066 6f72 206b 6579 2069 6e20 636f     for key in co
-00007120: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
-00007130: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
-00007140: 2074 6162 6c65 5f65 7870 7265 7373 696f   table_expressio
-00007150: 6e2e 636f 6c75 6d6e 733a 0a20 2020 2020  n.columns:.     
-00007160: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00007170: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00007180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007190: 2066 2243 6f6c 756d 6e20 277b 6b65 797d   f"Column '{key}
-000071a0: 2720 6f66 2060 636f 6c75 6d6e 7360 206e  ' of `columns` n
-000071b0: 6f74 2066 6f75 6e64 2069 6e20 7468 6973  ot found in this
-000071c0: 2074 6162 6c65 2e22 0a20 2020 2020 2020   table.".       
-000071d0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000071e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000071f0: 6528 696e 6465 785f 636f 6c2c 2073 7472  e(index_col, str
-00007200: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00007210: 6e64 6578 5f63 6f6c 733a 204c 6973 745b  ndex_cols: List[
-00007220: 7374 725d 203d 205b 696e 6465 785f 636f  str] = [index_co
-00007230: 6c5d 0a20 2020 2020 2020 2065 6c73 653a  l].        else:
-00007240: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00007250: 6578 5f63 6f6c 7320 3d20 6c69 7374 2869  ex_cols = list(i
-00007260: 6e64 6578 5f63 6f6c 290a 0a20 2020 2020  ndex_col)..     
-00007270: 2020 2066 6f72 206b 6579 2069 6e20 696e     for key in in
-00007280: 6465 785f 636f 6c73 3a0a 2020 2020 2020  dex_cols:.      
-00007290: 2020 2020 2020 6966 206b 6579 206e 6f74        if key not
-000072a0: 2069 6e20 7461 626c 655f 6578 7072 6573   in table_expres
-000072b0: 7369 6f6e 2e63 6f6c 756d 6e73 3a0a 2020  sion.columns:.  
-000072c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000072d0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-000072e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072f0: 2020 2020 6622 436f 6c75 6d6e 2060 7b6b      f"Column `{k
-00007300: 6579 7d60 206f 6620 6069 6e64 6578 5f63  ey}` of `index_c
-00007310: 6f6c 6020 6e6f 7420 666f 756e 6420 696e  ol` not found in
-00007320: 2074 6869 7320 7461 626c 652e 220a 2020   this table.".  
-00007330: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00007340: 0a20 2020 2020 2020 2069 6620 636f 6c75  .        if colu
-00007350: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
-00007360: 2074 6162 6c65 5f65 7870 7265 7373 696f   table_expressio
-00007370: 6e20 3d20 7461 626c 655f 6578 7072 6573  n = table_expres
-00007380: 7369 6f6e 2e73 656c 6563 7428 5b2a 696e  sion.select([*in
-00007390: 6465 785f 636f 6c73 2c20 2a63 6f6c 756d  dex_cols, *colum
-000073a0: 6e73 5d29 0a0a 2020 2020 2020 2020 2320  ns])..        # 
-000073b0: 4966 2074 6865 2069 6e64 6578 2069 7320  If the index is 
-000073c0: 756e 6971 7565 2061 6e64 2073 6f72 7461  unique and sorta
-000073d0: 626c 652c 2074 6865 6e20 7765 2064 6f6e  ble, then we don
-000073e0: 2774 206e 6565 6420 746f 2067 656e 6572  't need to gener
-000073f0: 6174 650a 2020 2020 2020 2020 2320 616e  ate.        # an
-00007400: 206f 7264 6572 696e 6720 636f 6c75 6d6e   ordering column
-00007410: 2e0a 2020 2020 2020 2020 6f72 6465 7269  ..        orderi
-00007420: 6e67 203d 204e 6f6e 650a 2020 2020 2020  ng = None.      
-00007430: 2020 6966 2074 6f74 616c 5f6f 7264 6572    if total_order
-00007440: 696e 675f 636f 6c73 2069 7320 6e6f 7420  ing_cols is not 
-00007450: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00007460: 2020 2320 4e6f 7465 3a20 6375 7272 656e    # Note: curren
-00007470: 746c 792c 2061 2074 6162 6c65 2068 6173  tly, a table has
-00007480: 2061 2074 6f74 616c 206f 7264 6572 696e   a total orderin
-00007490: 6720 6f6e 6c79 2077 6865 6e20 7468 650a  g only when the.
-000074a0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-000074b0: 696d 6172 7920 6b65 7928 7329 2061 7265  imary key(s) are
-000074c0: 2073 6574 206f 6e20 6120 7461 626c 652e   set on a table.
-000074d0: 2054 6865 2071 7565 7279 2065 6e67 696e   The query engin
-000074e0: 6520 6173 7375 6d65 7320 7375 6368 0a20  e assumes such. 
-000074f0: 2020 2020 2020 2020 2020 2023 2063 6f6c             # col
-00007500: 756d 6e73 2061 7265 2075 6e69 7175 652c  umns are unique,
-00007510: 2065 7665 6e20 6966 206e 6f74 2065 6e66   even if not enf
-00007520: 6f72 6365 642e 0a20 2020 2020 2020 2020  orced..         
-00007530: 2020 206f 7264 6572 696e 6720 3d20 6f72     ordering = or
-00007540: 6465 722e 4578 7072 6573 7369 6f6e 4f72  der.ExpressionOr
-00007550: 6465 7269 6e67 280a 2020 2020 2020 2020  dering(.        
-00007560: 2020 2020 2020 2020 6f72 6465 7269 6e67          ordering
-00007570: 5f76 616c 7565 5f63 6f6c 756d 6e73 3d74  _value_columns=t
-00007580: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
-00007590: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
-000075a0: 6173 6365 6e64 696e 675f 6f76 6572 2863  ascending_over(c
-000075b0: 6f6c 756d 6e5f 6964 2920 666f 7220 636f  olumn_id) for co
-000075c0: 6c75 6d6e 5f69 6420 696e 2074 6f74 616c  lumn_id in total
-000075d0: 5f6f 7264 6572 696e 675f 636f 6c73 0a20  _ordering_cols. 
-000075e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000075f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007600: 2020 746f 7461 6c5f 6f72 6465 7269 6e67    total_ordering
-00007610: 5f63 6f6c 756d 6e73 3d66 726f 7a65 6e73  _columns=frozens
-00007620: 6574 2874 6f74 616c 5f6f 7264 6572 696e  et(total_orderin
-00007630: 675f 636f 6c73 292c 0a20 2020 2020 2020  g_cols),.       
-00007640: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00007650: 2020 2063 6f6c 756d 6e5f 7661 6c75 6573     column_values
-00007660: 203d 205b 7461 626c 655f 6578 7072 6573   = [table_expres
-00007670: 7369 6f6e 5b63 6f6c 5d20 666f 7220 636f  sion[col] for co
-00007680: 6c20 696e 2074 6162 6c65 5f65 7870 7265  l in table_expre
-00007690: 7373 696f 6e2e 636f 6c75 6d6e 735d 0a20  ssion.columns]. 
-000076a0: 2020 2020 2020 2020 2020 2061 7272 6179             array
-000076b0: 5f76 616c 7565 203d 2063 6f72 652e 4172  _value = core.Ar
-000076c0: 7261 7956 616c 7565 2e66 726f 6d5f 6962  rayValue.from_ib
-000076d0: 6973 280a 2020 2020 2020 2020 2020 2020  is(.            
-000076e0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000076f0: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-00007700: 6578 7072 6573 7369 6f6e 2c0a 2020 2020  expression,.    
-00007710: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-00007720: 6d6e 733d 636f 6c75 6d6e 5f76 616c 7565  mns=column_value
-00007730: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00007740: 2020 2068 6964 6465 6e5f 6f72 6465 7269     hidden_orderi
-00007750: 6e67 5f63 6f6c 756d 6e73 3d5b 5d2c 0a20  ng_columns=[],. 
-00007760: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00007770: 7264 6572 696e 673d 6f72 6465 7269 6e67  rdering=ordering
-00007780: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00007790: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
-000077a0: 6e28 696e 6465 785f 636f 6c73 2920 213d  n(index_cols) !=
-000077b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000077c0: 2320 5765 2068 6176 6520 696e 6465 7820  # We have index 
-000077d0: 636f 6c75 6d6e 732c 206c 6574 7320 7365  columns, lets se
-000077e0: 6520 6966 2074 686f 7365 2061 7265 2061  e if those are a
-000077f0: 6374 7561 6c6c 7920 746f 7461 6c5f 6f72  ctually total_or
-00007800: 6465 725f 636f 6c75 6d6e 730a 2020 2020  der_columns.    
-00007810: 2020 2020 2020 2020 6f72 6465 7269 6e67          ordering
-00007820: 203d 206f 7264 6572 2e45 7870 7265 7373   = order.Express
-00007830: 696f 6e4f 7264 6572 696e 6728 0a20 2020  ionOrdering(.   
-00007840: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00007850: 6572 696e 675f 7661 6c75 655f 636f 6c75  ering_value_colu
-00007860: 6d6e 733d 7475 706c 6528 0a20 2020 2020  mns=tuple(.     
-00007870: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00007880: 6f72 6465 722e 6173 6365 6e64 696e 675f  order.ascending_
-00007890: 6f76 6572 2863 6f6c 756d 6e5f 6964 2920  over(column_id) 
-000078a0: 666f 7220 636f 6c75 6d6e 5f69 6420 696e  for column_id in
-000078b0: 2069 6e64 6578 5f63 6f6c 735d 0a20 2020   index_cols].   
-000078c0: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-000078d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078e0: 746f 7461 6c5f 6f72 6465 7269 6e67 5f63  total_ordering_c
-000078f0: 6f6c 756d 6e73 3d66 726f 7a65 6e73 6574  olumns=frozenset
-00007900: 2869 6e64 6578 5f63 6f6c 7329 2c0a 2020  (index_cols),.  
-00007910: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00007920: 2020 2020 2020 2020 6973 5f74 6f74 616c          is_total
-00007930: 5f6f 7264 6572 696e 6720 3d20 7365 6c66  _ordering = self
-00007940: 2e5f 6368 6563 6b5f 696e 6465 785f 756e  ._check_index_un
-00007950: 6971 7565 6e65 7373 280a 2020 2020 2020  iqueness(.      
-00007960: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-00007970: 6578 7072 6573 7369 6f6e 2c20 696e 6465  expression, inde
-00007980: 785f 636f 6c73 0a20 2020 2020 2020 2020  x_cols.         
-00007990: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000079a0: 2069 6620 6973 5f74 6f74 616c 5f6f 7264   if is_total_ord
-000079b0: 6572 696e 673a 0a20 2020 2020 2020 2020  ering:.         
-000079c0: 2020 2020 2020 2063 6f6c 756d 6e5f 7661         column_va
-000079d0: 6c75 6573 203d 205b 0a20 2020 2020 2020  lues = [.       
-000079e0: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-000079f0: 6c65 5f65 7870 7265 7373 696f 6e5b 636f  le_expression[co
-00007a00: 6c5d 2066 6f72 2063 6f6c 2069 6e20 7461  l] for col in ta
-00007a10: 626c 655f 6578 7072 6573 7369 6f6e 2e63  ble_expression.c
-00007a20: 6f6c 756d 6e73 0a20 2020 2020 2020 2020  olumns.         
-00007a30: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00007a40: 2020 2020 2020 2020 2061 7272 6179 5f76           array_v
-00007a50: 616c 7565 203d 2063 6f72 652e 4172 7261  alue = core.Arra
-00007a60: 7956 616c 7565 2e66 726f 6d5f 6962 6973  yValue.from_ibis
-00007a70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007a80: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00007a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007aa0: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
-00007ab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007ac0: 2020 2020 2020 636f 6c75 6d6e 733d 636f        columns=co
-00007ad0: 6c75 6d6e 5f76 616c 7565 732c 0a20 2020  lumn_values,.   
+000009d0: 7569 640a 696d 706f 7274 2062 6967 6672  uid.import bigfr
+000009e0: 616d 6573 2e63 6f72 652e 6e6f 6465 7320  ames.core.nodes 
+000009f0: 6173 206e 6f64 6573 0a66 726f 6d20 6269  as nodes.from bi
+00000a00: 6766 7261 6d65 732e 636f 7265 2e6f 7264  gframes.core.ord
+00000a10: 6572 696e 6720 696d 706f 7274 2049 6e74  ering import Int
+00000a20: 6567 6572 456e 636f 6469 6e67 0a69 6d70  egerEncoding.imp
+00000a30: 6f72 7420 6269 6766 7261 6d65 732e 636f  ort bigframes.co
+00000a40: 7265 2e6f 7264 6572 696e 6720 6173 206f  re.ordering as o
+00000a50: 7264 6572 0a69 6d70 6f72 7420 6269 6766  rder.import bigf
+00000a60: 7261 6d65 732e 636f 7265 2e74 7265 655f  rames.core.tree_
+00000a70: 7072 6f70 6572 7469 6573 2061 7320 7472  properties as tr
+00000a80: 6176 6572 7361 6c73 0a69 6d70 6f72 7420  aversals.import 
+00000a90: 6269 6766 7261 6d65 732e 636f 7265 2e74  bigframes.core.t
+00000aa0: 7265 655f 7072 6f70 6572 7469 6573 2061  ree_properties a
+00000ab0: 7320 7472 6565 5f70 726f 7065 7274 6965  s tree_propertie
+00000ac0: 730a 696d 706f 7274 2062 6967 6672 616d  s.import bigfram
+00000ad0: 6573 2e63 6f72 652e 7574 696c 7320 6173  es.core.utils as
+00000ae0: 2075 7469 6c73 0a69 6d70 6f72 7420 6269   utils.import bi
+00000af0: 6766 7261 6d65 732e 6474 7970 6573 0a69  gframes.dtypes.i
+00000b00: 6d70 6f72 7420 6269 6766 7261 6d65 732e  mport bigframes.
+00000b10: 666f 726d 6174 7469 6e67 5f68 656c 7065  formatting_helpe
+00000b20: 7273 2061 7320 666f 726d 6174 7469 6e67  rs as formatting
+00000b30: 5f68 656c 7065 7273 0a66 726f 6d20 6269  _helpers.from bi
+00000b40: 6766 7261 6d65 732e 6675 6e63 7469 6f6e  gframes.function
+00000b50: 732e 7265 6d6f 7465 5f66 756e 6374 696f  s.remote_functio
+00000b60: 6e20 696d 706f 7274 2072 6561 645f 6762  n import read_gb
+00000b70: 715f 6675 6e63 7469 6f6e 2061 7320 6269  q_function as bi
+00000b80: 6766 7261 6d65 735f 7267 660a 6672 6f6d  gframes_rgf.from
+00000b90: 2062 6967 6672 616d 6573 2e66 756e 6374   bigframes.funct
+00000ba0: 696f 6e73 2e72 656d 6f74 655f 6675 6e63  ions.remote_func
+00000bb0: 7469 6f6e 2069 6d70 6f72 7420 7265 6d6f  tion import remo
+00000bc0: 7465 5f66 756e 6374 696f 6e20 6173 2062  te_function as b
+00000bd0: 6967 6672 616d 6573 5f72 660a 696d 706f  igframes_rf.impo
+00000be0: 7274 2062 6967 6672 616d 6573 2e73 6573  rt bigframes.ses
+00000bf0: 7369 6f6e 2e5f 696f 2e62 6967 7175 6572  sion._io.bigquer
+00000c00: 7920 6173 2062 6967 6672 616d 6573 5f69  y as bigframes_i
+00000c10: 6f0a 696d 706f 7274 2062 6967 6672 616d  o.import bigfram
+00000c20: 6573 2e73 6573 7369 6f6e 2e63 6c69 656e  es.session.clien
+00000c30: 7473 0a69 6d70 6f72 7420 6269 6766 7261  ts.import bigfra
+00000c40: 6d65 732e 7665 7273 696f 6e0a 0a23 2041  mes.version..# A
+00000c50: 766f 6964 2063 6972 6375 6c61 7220 696d  void circular im
+00000c60: 706f 7274 732e 0a69 6620 7479 7069 6e67  ports..if typing
+00000c70: 2e54 5950 455f 4348 4543 4b49 4e47 3a0a  .TYPE_CHECKING:.
+00000c80: 2020 2020 696d 706f 7274 2062 6967 6672      import bigfr
+00000c90: 616d 6573 2e63 6f72 652e 696e 6465 7865  ames.core.indexe
+00000ca0: 730a 2020 2020 696d 706f 7274 2062 6967  s.    import big
+00000cb0: 6672 616d 6573 2e64 6174 6166 7261 6d65  frames.dataframe
+00000cc0: 2061 7320 6461 7461 6672 616d 650a 2020   as dataframe.  
+00000cd0: 2020 696d 706f 7274 2062 6967 6672 616d    import bigfram
+00000ce0: 6573 2e73 6572 6965 730a 0a5f 4249 4746  es.series.._BIGF
+00000cf0: 5241 4d45 535f 4445 4641 554c 545f 434f  RAMES_DEFAULT_CO
+00000d00: 4e4e 4543 5449 4f4e 5f49 4420 3d20 2262  NNECTION_ID = "b
+00000d10: 6967 6672 616d 6573 2d64 6566 6175 6c74  igframes-default
+00000d20: 2d63 6f6e 6e65 6374 696f 6e22 0a0a 5f4d  -connection".._M
+00000d30: 4158 5f43 4c55 5354 4552 5f43 4f4c 554d  AX_CLUSTER_COLUM
+00000d40: 4e53 203d 2034 0a0a 2320 544f 444f 2873  NS = 4..# TODO(s
+00000d50: 7761 7374 293a 204e 6565 6420 746f 2063  wast): Need to c
+00000d60: 6f6e 6e65 6374 2074 6f20 7265 6769 6f6e  onnect to region
+00000d70: 616c 2065 6e64 706f 696e 7473 2077 6865  al endpoints whe
+00000d80: 6e20 7065 7266 6f72 6d69 6e67 2072 656d  n performing rem
+00000d90: 6f74 650a 2320 6675 6e63 7469 6f6e 7320  ote.# functions 
+00000da0: 6f70 6572 6174 696f 6e73 2028 4251 2043  operations (BQ C
+00000db0: 6f6e 6e65 6374 696f 6e20 4941 4d2c 2043  onnection IAM, C
+00000dc0: 6c6f 7564 2052 756e 202f 2043 6c6f 7564  loud Run / Cloud
+00000dd0: 2046 756e 6374 696f 6e73 292e 0a23 2041   Functions)..# A
+00000de0: 6c73 6f20 7365 6520 6966 2072 6573 6f75  lso see if resou
+00000df0: 7263 6520 6d61 6e61 6765 7220 636c 6965  rce manager clie
+00000e00: 6e74 206c 6962 7261 7279 2073 7570 706f  nt library suppo
+00000e10: 7274 7320 7265 6769 6f6e 616c 2065 6e64  rts regional end
+00000e20: 706f 696e 7473 2e0a 0a5f 5641 4c49 445f  points..._VALID_
+00000e30: 454e 434f 4449 4e47 5320 3d20 7b0a 2020  ENCODINGS = {.  
+00000e40: 2020 2255 5446 2d38 222c 0a20 2020 2022    "UTF-8",.    "
+00000e50: 4953 4f2d 3838 3539 2d31 222c 0a20 2020  ISO-8859-1",.   
+00000e60: 2022 5554 462d 3136 4245 222c 0a20 2020   "UTF-16BE",.   
+00000e70: 2022 5554 462d 3136 4c45 222c 0a20 2020   "UTF-16LE",.   
+00000e80: 2022 5554 462d 3332 4245 222c 0a20 2020   "UTF-32BE",.   
+00000e90: 2022 5554 462d 3332 4c45 222c 0a7d 0a0a   "UTF-32LE",.}..
+00000ea0: 2320 4269 6751 7565 7279 2068 6173 2031  # BigQuery has 1
+00000eb0: 204d 4220 7175 6572 7920 7369 7a65 206c   MB query size l
+00000ec0: 696d 6974 2e20 446f 6e27 7420 7761 6e74  imit. Don't want
+00000ed0: 2074 6f20 7461 6b65 2075 7020 6d6f 7265   to take up more
+00000ee0: 2074 6861 6e20 6120 6665 7720 2520 6f66   than a few % of
+00000ef0: 2074 6861 7420 696e 6c69 6e69 6e67 2061   that inlining a
+00000f00: 2074 6162 6c65 2e0a 2320 416c 736f 206d   table..# Also m
+00000f10: 7573 7420 6173 7375 6d65 2074 6861 7420  ust assume that 
+00000f20: 7465 7874 2065 6e63 6f64 696e 6720 6173  text encoding as
+00000f30: 206c 6974 6572 616c 7320 6973 206d 7563   literals is muc
+00000f40: 6820 6c65 7373 2065 6666 6963 6965 6e74  h less efficient
+00000f50: 2074 6861 6e20 696e 2d6d 656d 6f72 7920   than in-memory 
+00000f60: 7265 7072 6573 656e 7461 7469 6f6e 2e0a  representation..
+00000f70: 4d41 585f 494e 4c49 4e45 5f44 465f 4259  MAX_INLINE_DF_BY
+00000f80: 5445 5320 3d20 3530 3030 0a0a 2320 4d61  TES = 5000..# Ma
+00000f90: 7820 636f 6d70 6c65 7869 7479 2074 6861  x complexity tha
+00000fa0: 7420 7368 6f75 6c64 2062 6520 6578 6563  t should be exec
+00000fb0: 7574 6564 2061 7320 6120 7369 6e67 6c65  uted as a single
+00000fc0: 2071 7565 7279 0a51 5545 5259 5f43 4f4d   query.QUERY_COM
+00000fd0: 504c 4558 4954 595f 4c49 4d49 5420 3d20  PLEXITY_LIMIT = 
+00000fe0: 3165 370a 2320 4e75 6d62 6572 206f 6620  1e7.# Number of 
+00000ff0: 7469 6d65 7320 746f 2066 6163 746f 7220  times to factor 
+00001000: 6f75 7420 7375 6271 7565 7269 6573 2062  out subqueries b
+00001010: 6566 6f72 6520 6769 7669 6e67 2075 702e  efore giving up.
+00001020: 0a4d 4158 5f53 5542 5452 4545 5f46 4143  .MAX_SUBTREE_FAC
+00001030: 544f 5249 4e47 5320 3d20 350a 0a6c 6f67  TORINGS = 5..log
+00001040: 6765 7220 3d20 6c6f 6767 696e 672e 6765  ger = logging.ge
+00001050: 744c 6f67 6765 7228 5f5f 6e61 6d65 5f5f  tLogger(__name__
+00001060: 290a 0a23 2045 7863 6c75 6465 7320 6765  )..# Excludes ge
+00001070: 6f67 7261 7068 792c 2062 7974 6573 2c20  ography, bytes, 
+00001080: 616e 6420 6e65 7374 6564 2028 6172 7261  and nested (arra
+00001090: 792c 2073 7472 7563 7429 2064 6174 6174  y, struct) datat
+000010a0: 7970 6573 0a49 4e4c 494e 4142 4c45 5f44  ypes.INLINABLE_D
+000010b0: 5459 5045 533a 2053 6571 7565 6e63 655b  TYPES: Sequence[
+000010c0: 6269 6766 7261 6d65 732e 6474 7970 6573  bigframes.dtypes
+000010d0: 2e44 7479 7065 5d20 3d20 280a 2020 2020  .Dtype] = (.    
+000010e0: 7061 6e64 6173 2e42 6f6f 6c65 616e 4474  pandas.BooleanDt
+000010f0: 7970 6528 292c 0a20 2020 2070 616e 6461  ype(),.    panda
+00001100: 732e 466c 6f61 7436 3444 7479 7065 2829  s.Float64Dtype()
+00001110: 2c0a 2020 2020 7061 6e64 6173 2e49 6e74  ,.    pandas.Int
+00001120: 3634 4474 7970 6528 292c 0a20 2020 2070  64Dtype(),.    p
+00001130: 616e 6461 732e 5374 7269 6e67 4474 7970  andas.StringDtyp
+00001140: 6528 7374 6f72 6167 653d 2270 7961 7272  e(storage="pyarr
+00001150: 6f77 2229 2c0a 2020 2020 7061 6e64 6173  ow"),.    pandas
+00001160: 2e41 7272 6f77 4474 7970 6528 7061 2e64  .ArrowDtype(pa.d
+00001170: 6174 6533 3228 2929 2c0a 2020 2020 7061  ate32()),.    pa
+00001180: 6e64 6173 2e41 7272 6f77 4474 7970 6528  ndas.ArrowDtype(
+00001190: 7061 2e74 696d 6536 3428 2275 7322 2929  pa.time64("us"))
+000011a0: 2c0a 2020 2020 7061 6e64 6173 2e41 7272  ,.    pandas.Arr
+000011b0: 6f77 4474 7970 6528 7061 2e74 696d 6573  owDtype(pa.times
+000011c0: 7461 6d70 2822 7573 2229 292c 0a20 2020  tamp("us")),.   
+000011d0: 2070 616e 6461 732e 4172 726f 7744 7479   pandas.ArrowDty
+000011e0: 7065 2870 612e 7469 6d65 7374 616d 7028  pe(pa.timestamp(
+000011f0: 2275 7322 2c20 747a 3d22 5554 4322 2929  "us", tz="UTC"))
+00001200: 2c0a 2020 2020 7061 6e64 6173 2e41 7272  ,.    pandas.Arr
+00001210: 6f77 4474 7970 6528 7061 2e64 6563 696d  owDtype(pa.decim
+00001220: 616c 3132 3828 3338 2c20 3929 292c 0a20  al128(38, 9)),. 
+00001230: 2020 2070 616e 6461 732e 4172 726f 7744     pandas.ArrowD
+00001240: 7479 7065 2870 612e 6465 6369 6d61 6c32  type(pa.decimal2
+00001250: 3536 2837 362c 2033 3829 292c 0a29 0a0a  56(76, 38)),.)..
+00001260: 0a64 6566 205f 6973 5f71 7565 7279 2871  .def _is_query(q
+00001270: 7565 7279 5f6f 725f 7461 626c 653a 2073  uery_or_table: s
+00001280: 7472 2920 2d3e 2062 6f6f 6c3a 0a20 2020  tr) -> bool:.   
+00001290: 2022 2222 4465 7465 726d 696e 6520 6966   """Determine if
+000012a0: 2060 7175 6572 795f 6f72 5f74 6162 6c65   `query_or_table
+000012b0: 6020 6973 2061 2074 6162 6c65 2049 4420  ` is a table ID 
+000012c0: 6f72 2061 2053 514c 2073 7472 696e 6722  or a SQL string"
+000012d0: 2222 0a20 2020 2072 6574 7572 6e20 7265  "".    return re
+000012e0: 2e73 6561 7263 6828 7222 5c73 222c 2071  .search(r"\s", q
+000012f0: 7565 7279 5f6f 725f 7461 626c 652e 7374  uery_or_table.st
+00001300: 7269 7028 292c 2072 652e 4d55 4c54 494c  rip(), re.MULTIL
+00001310: 494e 4529 2069 7320 6e6f 7420 4e6f 6e65  INE) is not None
+00001320: 0a0a 0a64 6566 205f 6973 5f74 6162 6c65  ...def _is_table
+00001330: 5f77 6974 685f 7769 6c64 6361 7264 5f73  _with_wildcard_s
+00001340: 7566 6669 7828 7175 6572 795f 6f72 5f74  uffix(query_or_t
+00001350: 6162 6c65 3a20 7374 7229 202d 3e20 626f  able: str) -> bo
+00001360: 6f6c 3a0a 2020 2020 2222 2244 6574 6572  ol:.    """Deter
+00001370: 6d69 6e65 2069 6620 6071 7565 7279 5f6f  mine if `query_o
+00001380: 725f 7461 626c 6560 2069 7320 6120 7461  r_table` is a ta
+00001390: 626c 6520 616e 6420 636f 6e74 6169 6e73  ble and contains
+000013a0: 2061 2077 696c 6463 6172 6420 7375 6666   a wildcard suff
+000013b0: 6978 2e22 2222 0a20 2020 2072 6574 7572  ix.""".    retur
+000013c0: 6e20 6e6f 7420 5f69 735f 7175 6572 7928  n not _is_query(
+000013d0: 7175 6572 795f 6f72 5f74 6162 6c65 2920  query_or_table) 
+000013e0: 616e 6420 7175 6572 795f 6f72 5f74 6162  and query_or_tab
+000013f0: 6c65 2e65 6e64 7377 6974 6828 222a 2229  le.endswith("*")
+00001400: 0a0a 0a63 6c61 7373 2053 6573 7369 6f6e  ...class Session
+00001410: 280a 2020 2020 7468 6972 645f 7061 7274  (.    third_part
+00001420: 795f 7061 6e64 6173 5f67 6271 2e47 4251  y_pandas_gbq.GBQ
+00001430: 494f 4d69 7869 6e2c 0a20 2020 2074 6869  IOMixin,.    thi
+00001440: 7264 5f70 6172 7479 5f70 616e 6461 735f  rd_party_pandas_
+00001450: 7061 7271 7565 742e 5061 7271 7565 7449  parquet.ParquetI
+00001460: 4f4d 6978 696e 2c0a 2020 2020 7468 6972  OMixin,.    thir
+00001470: 645f 7061 7274 795f 7061 6e64 6173 5f70  d_party_pandas_p
+00001480: 6963 6b6c 652e 5069 636b 6c65 494f 4d69  ickle.PickleIOMi
+00001490: 7869 6e2c 0a20 2020 2074 6869 7264 5f70  xin,.    third_p
+000014a0: 6172 7479 5f70 616e 6461 735f 7265 6164  arty_pandas_read
+000014b0: 6572 732e 5265 6164 6572 494f 4d69 7869  ers.ReaderIOMixi
+000014c0: 6e2c 0a29 3a0a 2020 2020 2222 2245 7374  n,.):.    """Est
+000014d0: 6162 6c69 7368 6573 2061 2042 6967 5175  ablishes a BigQu
+000014e0: 6572 7920 636f 6e6e 6563 7469 6f6e 2074  ery connection t
+000014f0: 6f20 6361 7074 7572 6520 6120 6772 6f75  o capture a grou
+00001500: 7020 6f66 206a 6f62 2061 6374 6976 6974  p of job activit
+00001510: 6965 7320 7265 6c61 7465 6420 746f 0a20  ies related to. 
+00001520: 2020 2044 6174 6146 7261 6d65 732e 0a0a     DataFrames...
+00001530: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00001540: 2020 636f 6e74 6578 7420 2862 6967 6672    context (bigfr
+00001550: 616d 6573 2e5f 636f 6e66 6967 2e62 6967  ames._config.big
+00001560: 7175 6572 795f 6f70 7469 6f6e 732e 4269  query_options.Bi
+00001570: 6751 7565 7279 4f70 7469 6f6e 7329 3a0a  gQueryOptions):.
+00001580: 2020 2020 2020 2020 2020 2020 436f 6e66              Conf
+00001590: 6967 7572 6174 696f 6e20 6164 6a75 7374  iguration adjust
+000015a0: 696e 6720 686f 7720 746f 2063 6f6e 6e65  ing how to conne
+000015b0: 6374 2074 6f20 4269 6751 7565 7279 2061  ct to BigQuery a
+000015c0: 6e64 2072 656c 6174 6564 0a20 2020 2020  nd related.     
+000015d0: 2020 2020 2020 2041 5049 732e 204e 6f74         APIs. Not
+000015e0: 6520 7468 6174 2073 6f6d 6520 6f70 7469  e that some opti
+000015f0: 6f6e 7320 6172 6520 6967 6e6f 7265 6420  ons are ignored 
+00001600: 6966 2060 6063 6c69 656e 7473 5f70 726f  if ``clients_pro
+00001610: 7669 6465 7260 6020 6973 0a20 2020 2020  vider`` is.     
+00001620: 2020 2020 2020 2073 6574 2e0a 2020 2020         set..    
+00001630: 2020 2020 636c 6965 6e74 735f 7072 6f76      clients_prov
+00001640: 6964 6572 2028 6269 6766 7261 6d65 732e  ider (bigframes.
+00001650: 7365 7373 696f 6e2e 636c 6965 6e74 732e  session.clients.
+00001660: 436c 6965 6e74 7350 726f 7669 6465 7229  ClientsProvider)
+00001670: 3a0a 2020 2020 2020 2020 2020 2020 416e  :.            An
+00001680: 206f 626a 6563 7420 7072 6f76 6964 696e   object providin
+00001690: 6720 636c 6965 6e74 206c 6962 7261 7279  g client library
+000016a0: 206f 626a 6563 7473 2e0a 2020 2020 2222   objects..    ""
+000016b0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+000016c0: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+000016d0: 662c 0a20 2020 2020 2020 2063 6f6e 7465  f,.        conte
+000016e0: 7874 3a20 4f70 7469 6f6e 616c 5b62 6967  xt: Optional[big
+000016f0: 7175 6572 795f 6f70 7469 6f6e 732e 4269  query_options.Bi
+00001700: 6751 7565 7279 4f70 7469 6f6e 735d 203d  gQueryOptions] =
+00001710: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
+00001720: 6c69 656e 7473 5f70 726f 7669 6465 723a  lients_provider:
+00001730: 204f 7074 696f 6e61 6c5b 6269 6766 7261   Optional[bigfra
+00001740: 6d65 732e 7365 7373 696f 6e2e 636c 6965  mes.session.clie
+00001750: 6e74 732e 436c 6965 6e74 7350 726f 7669  nts.ClientsProvi
+00001760: 6465 725d 203d 204e 6f6e 652c 0a20 2020  der] = None,.   
+00001770: 2029 3a0a 2020 2020 2020 2020 6966 2063   ):.        if c
+00001780: 6f6e 7465 7874 2069 7320 4e6f 6e65 3a0a  ontext is None:.
+00001790: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000017a0: 6578 7420 3d20 6269 6771 7565 7279 5f6f  ext = bigquery_o
+000017b0: 7074 696f 6e73 2e42 6967 5175 6572 794f  ptions.BigQueryO
+000017c0: 7074 696f 6e73 2829 0a0a 2020 2020 2020  ptions()..      
+000017d0: 2020 2320 544f 444f 2873 7761 7374 293a    # TODO(swast):
+000017e0: 2047 6574 206c 6f63 6174 696f 6e20 6672   Get location fr
+000017f0: 6f6d 2074 6865 2065 6e76 6972 6f6e 6d65  om the environme
+00001800: 6e74 2e0a 2020 2020 2020 2020 6966 2063  nt..        if c
+00001810: 6f6e 7465 7874 2e6c 6f63 6174 696f 6e20  ontext.location 
+00001820: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00001830: 2020 2020 2073 656c 662e 5f6c 6f63 6174       self._locat
+00001840: 696f 6e20 3d20 2255 5322 0a20 2020 2020  ion = "US".     
+00001850: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+00001860: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+00001870: 2020 2020 2020 6622 4e6f 2065 7870 6c69        f"No expli
+00001880: 6369 7420 6c6f 6361 7469 6f6e 2069 7320  cit location is 
+00001890: 7365 742c 2073 6f20 7573 696e 6720 6c6f  set, so using lo
+000018a0: 6361 7469 6f6e 207b 7365 6c66 2e5f 6c6f  cation {self._lo
+000018b0: 6361 7469 6f6e 7d20 666f 7220 7468 6520  cation} for the 
+000018c0: 7365 7373 696f 6e2e 222c 0a20 2020 2020  session.",.     
+000018d0: 2020 2020 2020 2020 2020 2073 7461 636b             stack
+000018e0: 6c65 7665 6c3d 322c 0a20 2020 2020 2020  level=2,.       
+000018f0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00001900: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00001910: 2073 656c 662e 5f6c 6f63 6174 696f 6e20   self._location 
+00001920: 3d20 636f 6e74 6578 742e 6c6f 6361 7469  = context.locati
+00001930: 6f6e 0a0a 2020 2020 2020 2020 7365 6c66  on..        self
+00001940: 2e5f 6271 5f6b 6d73 5f6b 6579 5f6e 616d  ._bq_kms_key_nam
+00001950: 6520 3d20 636f 6e74 6578 742e 6b6d 735f  e = context.kms_
+00001960: 6b65 795f 6e61 6d65 0a0a 2020 2020 2020  key_name..      
+00001970: 2020 2320 496e 7374 616e 7469 6174 6520    # Instantiate 
+00001980: 6120 636c 6965 6e74 7320 7072 6f76 6964  a clients provid
+00001990: 6572 2074 6f20 6865 6c70 2077 6974 6820  er to help with 
+000019a0: 636c 6f75 6420 636c 6965 6e74 7320 7468  cloud clients th
+000019b0: 6174 2077 696c 6c20 6265 0a20 2020 2020  at will be.     
+000019c0: 2020 2023 2075 7365 6420 696e 2074 6865     # used in the
+000019d0: 2066 7574 7572 6520 6f70 6572 6174 696f   future operatio
+000019e0: 6e73 2069 6e20 7468 6520 7365 7373 696f  ns in the sessio
+000019f0: 6e0a 2020 2020 2020 2020 6966 2063 6c69  n.        if cli
+00001a00: 656e 7473 5f70 726f 7669 6465 723a 0a20  ents_provider:. 
+00001a10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00001a20: 5f63 6c69 656e 7473 5f70 726f 7669 6465  _clients_provide
+00001a30: 7220 3d20 636c 6965 6e74 735f 7072 6f76  r = clients_prov
+00001a40: 6964 6572 0a20 2020 2020 2020 2065 6c73  ider.        els
+00001a50: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00001a60: 656c 662e 5f63 6c69 656e 7473 5f70 726f  elf._clients_pro
+00001a70: 7669 6465 7220 3d20 6269 6766 7261 6d65  vider = bigframe
+00001a80: 732e 7365 7373 696f 6e2e 636c 6965 6e74  s.session.client
+00001a90: 732e 436c 6965 6e74 7350 726f 7669 6465  s.ClientsProvide
+00001aa0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00001ab0: 2020 2070 726f 6a65 6374 3d63 6f6e 7465     project=conte
+00001ac0: 7874 2e70 726f 6a65 6374 2c0a 2020 2020  xt.project,.    
+00001ad0: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
+00001ae0: 7469 6f6e 3d73 656c 662e 5f6c 6f63 6174  tion=self._locat
+00001af0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00001b00: 2020 2020 2075 7365 5f72 6567 696f 6e61       use_regiona
+00001b10: 6c5f 656e 6470 6f69 6e74 733d 636f 6e74  l_endpoints=cont
+00001b20: 6578 742e 7573 655f 7265 6769 6f6e 616c  ext.use_regional
+00001b30: 5f65 6e64 706f 696e 7473 2c0a 2020 2020  _endpoints,.    
+00001b40: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+00001b50: 656e 7469 616c 733d 636f 6e74 6578 742e  entials=context.
+00001b60: 6372 6564 656e 7469 616c 732c 0a20 2020  credentials,.   
+00001b70: 2020 2020 2020 2020 2020 2020 2061 7070               app
+00001b80: 6c69 6361 7469 6f6e 5f6e 616d 653d 636f  lication_name=co
+00001b90: 6e74 6578 742e 6170 706c 6963 6174 696f  ntext.applicatio
+00001ba0: 6e5f 6e61 6d65 2c0a 2020 2020 2020 2020  n_name,.        
+00001bb0: 2020 2020 2020 2020 6271 5f6b 6d73 5f6b          bq_kms_k
+00001bc0: 6579 5f6e 616d 653d 7365 6c66 2e5f 6271  ey_name=self._bq
+00001bd0: 5f6b 6d73 5f6b 6579 5f6e 616d 652c 0a20  _kms_key_name,. 
+00001be0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00001bf0: 2020 2020 2020 7365 6c66 2e5f 6372 6561        self._crea
+00001c00: 7465 5f62 715f 6461 7461 7365 7473 2829  te_bq_datasets()
+00001c10: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+00001c20: 2873 686f 6273 293a 2052 656d 6f76 6520  (shobs): Remove 
+00001c30: 7468 6973 206c 6f67 6963 2061 6674 6572  this logic after
+00001c40: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+00001c50: 636f 6d2f 6962 6973 2d70 726f 6a65 6374  com/ibis-project
+00001c60: 2f69 6269 732f 6973 7375 6573 2f38 3439  /ibis/issues/849
+00001c70: 340a 2020 2020 2020 2020 2320 6861 7320  4.        # has 
+00001c80: 6265 656e 2066 6978 6564 2e20 5468 6520  been fixed. The 
+00001c90: 6962 6973 2063 6c69 656e 7420 6368 616e  ibis client chan
+00001ca0: 6765 7320 7468 6520 6465 6661 756c 7420  ges the default 
+00001cb0: 7175 6572 7920 6a6f 6220 636f 6e66 6967  query job config
+00001cc0: 0a20 2020 2020 2020 2023 2073 6f20 7765  .        # so we
+00001cd0: 2061 7265 2067 6f69 6e67 2074 6f20 7265   are going to re
+00001ce0: 6d65 6d62 6572 2074 6865 2063 7572 7265  member the curre
+00001cf0: 6e74 2063 6f6e 6669 6720 616e 6420 7265  nt config and re
+00001d00: 7374 6f72 6520 6974 2061 6674 6572 0a20  store it after. 
+00001d10: 2020 2020 2020 2023 2074 6865 2069 6269         # the ibi
+00001d20: 7320 636c 6965 6e74 2068 6173 2062 6565  s client has bee
+00001d30: 6e20 6372 6561 7465 640a 2020 2020 2020  n created.      
+00001d40: 2020 6f72 6967 696e 616c 5f64 6566 6175    original_defau
+00001d50: 6c74 5f71 7565 7279 5f6a 6f62 5f63 6f6e  lt_query_job_con
+00001d60: 6669 6720 3d20 7365 6c66 2e62 7163 6c69  fig = self.bqcli
+00001d70: 656e 742e 6465 6661 756c 745f 7175 6572  ent.default_quer
+00001d80: 795f 6a6f 625f 636f 6e66 6967 0a0a 2020  y_job_config..  
+00001d90: 2020 2020 2020 7365 6c66 2e69 6269 735f        self.ibis_
+00001da0: 636c 6965 6e74 203d 2074 7970 696e 672e  client = typing.
+00001db0: 6361 7374 280a 2020 2020 2020 2020 2020  cast(.          
+00001dc0: 2020 6962 6973 5f62 6967 7175 6572 792e    ibis_bigquery.
+00001dd0: 4261 636b 656e 642c 0a20 2020 2020 2020  Backend,.       
+00001de0: 2020 2020 2069 6269 732e 6269 6771 7565       ibis.bigque
+00001df0: 7279 2e63 6f6e 6e65 6374 280a 2020 2020  ry.connect(.    
+00001e00: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
+00001e10: 6563 745f 6964 3d63 6f6e 7465 7874 2e70  ect_id=context.p
+00001e20: 726f 6a65 6374 2c0a 2020 2020 2020 2020  roject,.        
+00001e30: 2020 2020 2020 2020 636c 6965 6e74 3d73          client=s
+00001e40: 656c 662e 6271 636c 6965 6e74 2c0a 2020  elf.bqclient,.  
+00001e50: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00001e60: 6f72 6167 655f 636c 6965 6e74 3d73 656c  orage_client=sel
+00001e70: 662e 6271 7374 6f72 6167 6572 6561 6463  f.bqstoragereadc
+00001e80: 6c69 656e 742c 0a20 2020 2020 2020 2020  lient,.         
+00001e90: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00001ea0: 0a20 2020 2020 2020 2073 656c 662e 6271  .        self.bq
+00001eb0: 636c 6965 6e74 2e64 6566 6175 6c74 5f71  client.default_q
+00001ec0: 7565 7279 5f6a 6f62 5f63 6f6e 6669 6720  uery_job_config 
+00001ed0: 3d20 6f72 6967 696e 616c 5f64 6566 6175  = original_defau
+00001ee0: 6c74 5f71 7565 7279 5f6a 6f62 5f63 6f6e  lt_query_job_con
+00001ef0: 6669 670a 0a20 2020 2020 2020 2023 2052  fig..        # R
+00001f00: 6573 6f6c 7665 2074 6865 2042 5120 636f  esolve the BQ co
+00001f10: 6e6e 6563 7469 6f6e 2066 6f72 2072 656d  nnection for rem
+00001f20: 6f74 6520 6675 6e63 7469 6f6e 2061 6e64  ote function and
+00001f30: 2056 6572 7465 7820 4149 2069 6e74 6567   Vertex AI integ
+00001f40: 7261 7469 6f6e 0a20 2020 2020 2020 2073  ration.        s
+00001f50: 656c 662e 5f62 715f 636f 6e6e 6563 7469  elf._bq_connecti
+00001f60: 6f6e 203d 2063 6f6e 7465 7874 2e62 715f  on = context.bq_
+00001f70: 636f 6e6e 6563 7469 6f6e 206f 7220 5f42  connection or _B
+00001f80: 4947 4652 414d 4553 5f44 4546 4155 4c54  IGFRAMES_DEFAULT
+00001f90: 5f43 4f4e 4e45 4354 494f 4e5f 4944 0a20  _CONNECTION_ID. 
+00001fa0: 2020 2020 2020 2073 656c 662e 5f73 6b69         self._ski
+00001fb0: 705f 6271 5f63 6f6e 6e65 6374 696f 6e5f  p_bq_connection_
+00001fc0: 6368 6563 6b20 3d20 636f 6e74 6578 742e  check = context.
+00001fd0: 5f73 6b69 705f 6271 5f63 6f6e 6e65 6374  _skip_bq_connect
+00001fe0: 696f 6e5f 6368 6563 6b0a 0a20 2020 2020  ion_check..     
+00001ff0: 2020 2023 204e 6f77 2074 6861 7420 7765     # Now that we
+00002000: 2772 6520 7374 6172 7469 6e67 2074 6865  're starting the
+00002010: 2073 6573 7369 6f6e 2c20 646f 6e27 7420   session, don't 
+00002020: 616c 6c6f 7720 7468 6520 6f70 7469 6f6e  allow the option
+00002030: 7320 746f 2062 650a 2020 2020 2020 2020  s to be.        
+00002040: 2320 6368 616e 6765 642e 0a20 2020 2020  # changed..     
+00002050: 2020 2063 6f6e 7465 7874 2e5f 7365 7373     context._sess
+00002060: 696f 6e5f 7374 6172 7465 6420 3d20 5472  ion_started = Tr
+00002070: 7565 0a20 2020 2020 2020 2073 656c 662e  ue.        self.
+00002080: 5f64 665f 736e 6170 7368 6f74 3a20 4469  _df_snapshot: Di
+00002090: 6374 5b62 6967 7175 6572 792e 5461 626c  ct[bigquery.Tabl
+000020a0: 6552 6566 6572 656e 6365 2c20 6461 7465  eReference, date
+000020b0: 7469 6d65 2e64 6174 6574 696d 655d 203d  time.datetime] =
+000020c0: 207b 7d0a 0a20 2020 2040 7072 6f70 6572   {}..    @proper
+000020d0: 7479 0a20 2020 2064 6566 2062 7163 6c69  ty.    def bqcli
+000020e0: 656e 7428 7365 6c66 293a 0a20 2020 2020  ent(self):.     
+000020f0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00002100: 636c 6965 6e74 735f 7072 6f76 6964 6572  clients_provider
+00002110: 2e62 7163 6c69 656e 740a 0a20 2020 2040  .bqclient..    @
+00002120: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00002130: 2062 7163 6f6e 6e65 6374 696f 6e63 6c69   bqconnectioncli
+00002140: 656e 7428 7365 6c66 293a 0a20 2020 2020  ent(self):.     
+00002150: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00002160: 636c 6965 6e74 735f 7072 6f76 6964 6572  clients_provider
+00002170: 2e62 7163 6f6e 6e65 6374 696f 6e63 6c69  .bqconnectioncli
+00002180: 656e 740a 0a20 2020 2040 7072 6f70 6572  ent..    @proper
+00002190: 7479 0a20 2020 2064 6566 2062 7173 746f  ty.    def bqsto
+000021a0: 7261 6765 7265 6164 636c 6965 6e74 2873  ragereadclient(s
+000021b0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+000021c0: 7475 726e 2073 656c 662e 5f63 6c69 656e  turn self._clien
+000021d0: 7473 5f70 726f 7669 6465 722e 6271 7374  ts_provider.bqst
+000021e0: 6f72 6167 6572 6561 6463 6c69 656e 740a  oragereadclient.
+000021f0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00002200: 2020 2064 6566 2063 6c6f 7564 6675 6e63     def cloudfunc
+00002210: 7469 6f6e 7363 6c69 656e 7428 7365 6c66  tionsclient(self
+00002220: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00002230: 6e20 7365 6c66 2e5f 636c 6965 6e74 735f  n self._clients_
+00002240: 7072 6f76 6964 6572 2e63 6c6f 7564 6675  provider.cloudfu
+00002250: 6e63 7469 6f6e 7363 6c69 656e 740a 0a20  nctionsclient.. 
+00002260: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00002270: 2064 6566 2072 6573 6f75 7263 656d 616e   def resourceman
+00002280: 6167 6572 636c 6965 6e74 2873 656c 6629  agerclient(self)
+00002290: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000022a0: 2073 656c 662e 5f63 6c69 656e 7473 5f70   self._clients_p
+000022b0: 726f 7669 6465 722e 7265 736f 7572 6365  rovider.resource
+000022c0: 6d61 6e61 6765 7263 6c69 656e 740a 0a20  managerclient.. 
+000022d0: 2020 205f 6271 5f63 6f6e 6e65 6374 696f     _bq_connectio
+000022e0: 6e5f 6d61 6e61 6765 723a 204f 7074 696f  n_manager: Optio
+000022f0: 6e61 6c5b 6269 6766 7261 6d65 732e 636c  nal[bigframes.cl
+00002300: 6965 6e74 732e 4271 436f 6e6e 6563 7469  ients.BqConnecti
+00002310: 6f6e 4d61 6e61 6765 725d 203d 204e 6f6e  onManager] = Non
+00002320: 650a 0a20 2020 2040 7072 6f70 6572 7479  e..    @property
+00002330: 0a20 2020 2064 6566 2062 7163 6f6e 6e65  .    def bqconne
+00002340: 6374 696f 6e6d 616e 6167 6572 2873 656c  ctionmanager(sel
+00002350: 6629 3a0a 2020 2020 2020 2020 6966 206e  f):.        if n
+00002360: 6f74 2073 656c 662e 5f73 6b69 705f 6271  ot self._skip_bq
+00002370: 5f63 6f6e 6e65 6374 696f 6e5f 6368 6563  _connection_chec
+00002380: 6b20 616e 6420 6e6f 7420 7365 6c66 2e5f  k and not self._
+00002390: 6271 5f63 6f6e 6e65 6374 696f 6e5f 6d61  bq_connection_ma
+000023a0: 6e61 6765 723a 0a20 2020 2020 2020 2020  nager:.         
+000023b0: 2020 2073 656c 662e 5f62 715f 636f 6e6e     self._bq_conn
+000023c0: 6563 7469 6f6e 5f6d 616e 6167 6572 203d  ection_manager =
+000023d0: 2062 6967 6672 616d 6573 2e63 6c69 656e   bigframes.clien
+000023e0: 7473 2e42 7143 6f6e 6e65 6374 696f 6e4d  ts.BqConnectionM
+000023f0: 616e 6167 6572 280a 2020 2020 2020 2020  anager(.        
+00002400: 2020 2020 2020 2020 7365 6c66 2e62 7163          self.bqc
+00002410: 6f6e 6e65 6374 696f 6e63 6c69 656e 742c  onnectionclient,
+00002420: 2073 656c 662e 7265 736f 7572 6365 6d61   self.resourcema
+00002430: 6e61 6765 7263 6c69 656e 740a 2020 2020  nagerclient.    
+00002440: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00002450: 2020 7265 7475 726e 2073 656c 662e 5f62    return self._b
+00002460: 715f 636f 6e6e 6563 7469 6f6e 5f6d 616e  q_connection_man
+00002470: 6167 6572 0a0a 2020 2020 4070 726f 7065  ager..    @prope
+00002480: 7274 790a 2020 2020 6465 6620 5f70 726f  rty.    def _pro
+00002490: 6a65 6374 2873 656c 6629 3a0a 2020 2020  ject(self):.    
+000024a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000024b0: 6271 636c 6965 6e74 2e70 726f 6a65 6374  bqclient.project
+000024c0: 0a0a 2020 2020 6465 6620 5f5f 6861 7368  ..    def __hash
+000024d0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+000024e0: 2020 2320 5374 6162 6c65 2068 6173 6820    # Stable hash 
+000024f0: 6e65 6564 6564 2074 6f20 7573 6520 696e  needed to use in
+00002500: 2065 7870 7265 7373 696f 6e20 7472 6565   expression tree
+00002510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002520: 6861 7368 2873 7472 2873 656c 662e 5f61  hash(str(self._a
+00002530: 6e6f 6e79 6d6f 7573 5f64 6174 6173 6574  nonymous_dataset
+00002540: 2929 0a0a 2020 2020 6465 6620 5f63 7265  ))..    def _cre
+00002550: 6174 655f 6271 5f64 6174 6173 6574 7328  ate_bq_datasets(
+00002560: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00002570: 2222 4372 6561 7465 2061 6e64 2069 6465  ""Create and ide
+00002580: 6e74 6966 7920 6461 7461 7365 7428 7329  ntify dataset(s)
+00002590: 2066 6f72 2074 656d 706f 7261 7279 2042   for temporary B
+000025a0: 5120 7265 736f 7572 6365 732e 2222 220a  Q resources.""".
+000025b0: 2020 2020 2020 2020 7175 6572 795f 6a6f          query_jo
+000025c0: 6220 3d20 7365 6c66 2e62 7163 6c69 656e  b = self.bqclien
+000025d0: 742e 7175 6572 7928 2253 454c 4543 5420  t.query("SELECT 
+000025e0: 3122 2c20 6c6f 6361 7469 6f6e 3d73 656c  1", location=sel
+000025f0: 662e 5f6c 6f63 6174 696f 6e29 0a20 2020  f._location).   
+00002600: 2020 2020 2071 7565 7279 5f6a 6f62 2e72       query_job.r
+00002610: 6573 756c 7428 2920 2023 2062 6c6f 636b  esult()  # block
+00002620: 7320 756e 7469 6c20 6669 6e69 7368 6564  s until finished
+00002630: 0a0a 2020 2020 2020 2020 2320 5468 6520  ..        # The 
+00002640: 616e 6f6e 796d 6f75 7320 6461 7461 7365  anonymous datase
+00002650: 7420 6973 2075 7365 6420 6279 2042 6967  t is used by Big
+00002660: 5175 6572 7920 746f 2077 7269 7465 2071  Query to write q
+00002670: 7565 7279 2072 6573 756c 7473 2061 6e64  uery results and
+00002680: 0a20 2020 2020 2020 2023 2073 6573 7369  .        # sessi
+00002690: 6f6e 2074 6162 6c65 732e 2042 6967 5175  on tables. BigQu
+000026a0: 6572 7920 4461 7461 4672 616d 6573 2061  ery DataFrames a
+000026b0: 6c73 6f20 7772 6974 6573 2074 656d 7020  lso writes temp 
+000026c0: 7461 626c 6573 2064 6972 6563 746c 790a  tables directly.
+000026d0: 2020 2020 2020 2020 2320 746f 2074 6865          # to the
+000026e0: 2064 6174 6173 6574 2c20 6e6f 2042 6967   dataset, no Big
+000026f0: 5175 6572 7920 5365 7373 696f 6e20 7265  Query Session re
+00002700: 7175 6972 6564 2e20 4e6f 7465 3a20 7468  quired. Note: th
+00002710: 6572 6520 6973 2061 0a20 2020 2020 2020  ere is a.       
+00002720: 2023 2064 6966 6665 7265 6e74 2061 6e6f   # different ano
+00002730: 6e79 6d6f 7573 2064 6174 6173 6574 2070  nymous dataset p
+00002740: 6572 206c 6f63 6174 696f 6e2e 2053 6565  er location. See
+00002750: 3a0a 2020 2020 2020 2020 2320 6874 7470  :.        # http
+00002760: 733a 2f2f 636c 6f75 642e 676f 6f67 6c65  s://cloud.google
+00002770: 2e63 6f6d 2f62 6967 7175 6572 792f 646f  .com/bigquery/do
+00002780: 6373 2f63 6163 6865 642d 7265 7375 6c74  cs/cached-result
+00002790: 7323 686f 775f 6361 6368 6564 5f72 6573  s#how_cached_res
+000027a0: 756c 7473 5f61 7265 5f73 746f 7265 640a  ults_are_stored.
+000027b0: 2020 2020 2020 2020 7175 6572 795f 6465          query_de
+000027c0: 7374 696e 6174 696f 6e20 3d20 7175 6572  stination = quer
+000027d0: 795f 6a6f 622e 6465 7374 696e 6174 696f  y_job.destinatio
+000027e0: 6e0a 2020 2020 2020 2020 7365 6c66 2e5f  n.        self._
+000027f0: 616e 6f6e 796d 6f75 735f 6461 7461 7365  anonymous_datase
+00002800: 7420 3d20 6269 6771 7565 7279 2e44 6174  t = bigquery.Dat
+00002810: 6173 6574 5265 6665 7265 6e63 6528 0a20  asetReference(. 
+00002820: 2020 2020 2020 2020 2020 2071 7565 7279             query
+00002830: 5f64 6573 7469 6e61 7469 6f6e 2e70 726f  _destination.pro
+00002840: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
+00002850: 2020 7175 6572 795f 6465 7374 696e 6174    query_destinat
+00002860: 696f 6e2e 6461 7461 7365 745f 6964 2c0a  ion.dataset_id,.
+00002870: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00002880: 6566 2063 6c6f 7365 2873 656c 6629 3a0a  ef close(self):.
+00002890: 2020 2020 2020 2020 2222 224e 6f2d 6f70          """No-op
+000028a0: 2e20 5465 6d70 6f72 6172 7920 7265 736f  . Temporary reso
+000028b0: 7572 6365 7320 6172 6520 6465 6c65 7465  urces are delete
+000028c0: 6420 6166 7465 7220 3720 6461 7973 2e22  d after 7 days."
+000028d0: 2222 0a0a 2020 2020 6465 6620 7265 6164  ""..    def read
+000028e0: 5f67 6271 280a 2020 2020 2020 2020 7365  _gbq(.        se
+000028f0: 6c66 2c0a 2020 2020 2020 2020 7175 6572  lf,.        quer
+00002900: 795f 6f72 5f74 6162 6c65 3a20 7374 722c  y_or_table: str,
+00002910: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
+00002920: 2020 2020 696e 6465 785f 636f 6c3a 2049      index_col: I
+00002930: 7465 7261 626c 655b 7374 725d 207c 2073  terable[str] | s
+00002940: 7472 203d 2028 292c 0a20 2020 2020 2020  tr = (),.       
+00002950: 2063 6f6c 756d 6e73 3a20 4974 6572 6162   columns: Iterab
+00002960: 6c65 5b73 7472 5d20 3d20 2829 2c0a 2020  le[str] = (),.  
+00002970: 2020 2020 2020 636f 6e66 6967 7572 6174        configurat
+00002980: 696f 6e3a 204f 7074 696f 6e61 6c5b 4469  ion: Optional[Di
+00002990: 6374 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ct] = None,.    
+000029a0: 2020 2020 6d61 785f 7265 7375 6c74 733a      max_results:
+000029b0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+000029c0: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+000029d0: 696c 7465 7273 3a20 7468 6972 645f 7061  ilters: third_pa
+000029e0: 7274 795f 7061 6e64 6173 5f67 6271 2e46  rty_pandas_gbq.F
+000029f0: 696c 7465 7273 5479 7065 203d 2028 292c  iltersType = (),
+00002a00: 0a20 2020 2020 2020 2075 7365 5f63 6163  .        use_cac
+00002a10: 6865 3a20 4f70 7469 6f6e 616c 5b62 6f6f  he: Optional[boo
+00002a20: 6c5d 203d 204e 6f6e 652c 0a20 2020 2020  l] = None,.     
+00002a30: 2020 2063 6f6c 5f6f 7264 6572 3a20 4974     col_order: It
+00002a40: 6572 6162 6c65 5b73 7472 5d20 3d20 2829  erable[str] = ()
+00002a50: 2c0a 2020 2020 2020 2020 2320 4164 6420  ,.        # Add 
+00002a60: 6120 7665 7269 6679 2069 6e64 6578 2061  a verify index a
+00002a70: 7267 756d 656e 7420 7468 6174 2066 6169  rgument that fai
+00002a80: 6c73 2069 6620 7468 6520 696e 6465 7820  ls if the index 
+00002a90: 6973 206e 6f74 2075 6e69 7175 652e 0a20  is not unique.. 
+00002aa0: 2020 2029 202d 3e20 6461 7461 6672 616d     ) -> datafram
+00002ab0: 652e 4461 7461 4672 616d 653a 0a20 2020  e.DataFrame:.   
+00002ac0: 2020 2020 2023 2054 4f44 4f28 622f 3238       # TODO(b/28
+00002ad0: 3135 3731 3231 3429 3a20 4765 6e65 7261  1571214): Genera
+00002ae0: 7465 2070 726f 6d70 7420 746f 2073 686f  te prompt to sho
+00002af0: 7720 7468 6520 7072 6f67 7265 7373 206f  w the progress o
+00002b00: 6620 7265 6164 5f67 6271 2e0a 2020 2020  f read_gbq..    
+00002b10: 2020 2020 6966 2063 6f6c 756d 6e73 2061      if columns a
+00002b20: 6e64 2063 6f6c 5f6f 7264 6572 3a0a 2020  nd col_order:.  
+00002b30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002b40: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00002b50: 2020 2020 2020 2020 2020 2020 224d 7573              "Mus
+00002b60: 7420 7370 6563 6966 7920 6569 7468 6572  t specify either
+00002b70: 2063 6f6c 756d 6e73 2028 7072 6566 6572   columns (prefer
+00002b80: 7265 6429 206f 7220 636f 6c5f 6f72 6465  red) or col_orde
+00002b90: 722c 206e 6f74 2062 6f74 6822 0a20 2020  r, not both".   
+00002ba0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00002bb0: 2020 2065 6c69 6620 636f 6c5f 6f72 6465     elif col_orde
+00002bc0: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
+00002bd0: 6f6c 756d 6e73 203d 2063 6f6c 5f6f 7264  olumns = col_ord
+00002be0: 6572 0a0a 2020 2020 2020 2020 6669 6c74  er..        filt
+00002bf0: 6572 7320 3d20 6c69 7374 2866 696c 7465  ers = list(filte
+00002c00: 7273 290a 2020 2020 2020 2020 6966 206c  rs).        if l
+00002c10: 656e 2866 696c 7465 7273 2920 213d 2030  en(filters) != 0
+00002c20: 206f 7220 5f69 735f 7461 626c 655f 7769   or _is_table_wi
+00002c30: 7468 5f77 696c 6463 6172 645f 7375 6666  th_wildcard_suff
+00002c40: 6978 2871 7565 7279 5f6f 725f 7461 626c  ix(query_or_tabl
+00002c50: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00002c60: 7175 6572 795f 6f72 5f74 6162 6c65 203d  query_or_table =
+00002c70: 2073 656c 662e 5f74 6f5f 7175 6572 7928   self._to_query(
+00002c80: 7175 6572 795f 6f72 5f74 6162 6c65 2c20  query_or_table, 
+00002c90: 636f 6c75 6d6e 732c 2066 696c 7465 7273  columns, filters
+00002ca0: 290a 0a20 2020 2020 2020 2069 6620 5f69  )..        if _i
+00002cb0: 735f 7175 6572 7928 7175 6572 795f 6f72  s_query(query_or
+00002cc0: 5f74 6162 6c65 293a 0a20 2020 2020 2020  _table):.       
+00002cd0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00002ce0: 2e5f 7265 6164 5f67 6271 5f71 7565 7279  ._read_gbq_query
+00002cf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002d00: 2020 7175 6572 795f 6f72 5f74 6162 6c65    query_or_table
+00002d10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002d20: 2020 696e 6465 785f 636f 6c3d 696e 6465    index_col=inde
+00002d30: 785f 636f 6c2c 0a20 2020 2020 2020 2020  x_col,.         
+00002d40: 2020 2020 2020 2063 6f6c 756d 6e73 3d63         columns=c
+00002d50: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+00002d60: 2020 2020 2020 2020 636f 6e66 6967 7572          configur
+00002d70: 6174 696f 6e3d 636f 6e66 6967 7572 6174  ation=configurat
+00002d80: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00002d90: 2020 2020 206d 6178 5f72 6573 756c 7473       max_results
+00002da0: 3d6d 6178 5f72 6573 756c 7473 2c0a 2020  =max_results,.  
+00002db0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+00002dc0: 695f 6e61 6d65 3d22 7265 6164 5f67 6271  i_name="read_gbq
+00002dd0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00002de0: 2020 2075 7365 5f63 6163 6865 3d75 7365     use_cache=use
+00002df0: 5f63 6163 6865 2c0a 2020 2020 2020 2020  _cache,.        
+00002e00: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+00002e10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00002e20: 2320 544f 444f 2873 7761 7374 293a 2051  # TODO(swast): Q
+00002e30: 7565 7279 2074 6865 2073 6e61 7073 686f  uery the snapsho
+00002e40: 7420 7461 626c 6520 6275 7420 6d61 726b  t table but mark
+00002e50: 2069 7420 6173 2061 0a20 2020 2020 2020   it as a.       
+00002e60: 2020 2020 2023 2064 6574 6572 6d69 6e69       # determini
+00002e70: 7374 6963 2071 7565 7279 2073 6f20 7765  stic query so we
+00002e80: 2063 616e 2061 766f 6964 2073 6572 6961   can avoid seria
+00002e90: 6c69 7a69 6e67 2069 6620 7765 2068 6176  lizing if we hav
+00002ea0: 6520 610a 2020 2020 2020 2020 2020 2020  e a.            
+00002eb0: 2320 756e 6971 7565 2069 6e64 6578 2e0a  # unique index..
+00002ec0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00002ed0: 6f6e 6669 6775 7261 7469 6f6e 2069 7320  onfiguration is 
+00002ee0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00002ef0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002f00: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00002f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f20: 2254 6865 2027 636f 6e66 6967 7572 6174  "The 'configurat
+00002f30: 696f 6e27 2061 7267 756d 656e 7420 6973  ion' argument is
+00002f40: 206e 6f74 2061 6c6c 6f77 6564 2077 6865   not allowed whe
+00002f50: 6e20 220a 2020 2020 2020 2020 2020 2020  n ".            
+00002f60: 2020 2020 2020 2020 2264 6972 6563 746c          "directl
+00002f70: 7920 7265 6164 696e 6720 6672 6f6d 2061  y reading from a
+00002f80: 2074 6162 6c65 2e20 506c 6561 7365 2072   table. Please r
+00002f90: 656d 6f76 6520 220a 2020 2020 2020 2020  emove ".        
+00002fa0: 2020 2020 2020 2020 2020 2020 2227 636f              "'co
+00002fb0: 6e66 6967 7572 6174 696f 6e27 206f 7220  nfiguration' or 
+00002fc0: 7573 6520 6120 7175 6572 792e 220a 2020  use a query.".  
+00002fd0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00002fe0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00002ff0: 7572 6e20 7365 6c66 2e5f 7265 6164 5f67  urn self._read_g
+00003000: 6271 5f74 6162 6c65 280a 2020 2020 2020  bq_table(.      
+00003010: 2020 2020 2020 2020 2020 7175 6572 795f            query_
+00003020: 6f72 5f74 6162 6c65 2c0a 2020 2020 2020  or_table,.      
+00003030: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+00003040: 636f 6c3d 696e 6465 785f 636f 6c2c 0a20  col=index_col,. 
+00003050: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00003060: 6f6c 756d 6e73 3d63 6f6c 756d 6e73 2c0a  olumns=columns,.
+00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003080: 6d61 785f 7265 7375 6c74 733d 6d61 785f  max_results=max_
+00003090: 7265 7375 6c74 732c 0a20 2020 2020 2020  results,.       
+000030a0: 2020 2020 2020 2020 2061 7069 5f6e 616d           api_nam
+000030b0: 653d 2272 6561 645f 6762 7122 2c0a 2020  e="read_gbq",.  
+000030c0: 2020 2020 2020 2020 2020 2020 2020 7573                us
+000030d0: 655f 6361 6368 653d 7573 655f 6361 6368  e_cache=use_cach
+000030e0: 6520 6966 2075 7365 5f63 6163 6865 2069  e if use_cache i
+000030f0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+00003100: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00003110: 2020 290a 0a20 2020 2064 6566 205f 746f    )..    def _to
+00003120: 5f71 7565 7279 280a 2020 2020 2020 2020  _query(.        
+00003130: 7365 6c66 2c0a 2020 2020 2020 2020 7175  self,.        qu
+00003140: 6572 795f 6f72 5f74 6162 6c65 3a20 7374  ery_or_table: st
+00003150: 722c 0a20 2020 2020 2020 2063 6f6c 756d  r,.        colum
+00003160: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
+00003170: 5d2c 0a20 2020 2020 2020 2066 696c 7465  ],.        filte
+00003180: 7273 3a20 7468 6972 645f 7061 7274 795f  rs: third_party_
+00003190: 7061 6e64 6173 5f67 6271 2e46 696c 7465  pandas_gbq.Filte
+000031a0: 7273 5479 7065 2c0a 2020 2020 2920 2d3e  rsType,.    ) ->
+000031b0: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
+000031c0: 2243 6f6d 7069 6c65 2071 7565 7279 5f6f  "Compile query_o
+000031d0: 725f 7461 626c 6520 7769 7468 2063 6f6e  r_table with con
+000031e0: 6469 7469 6f6e 7328 6669 6c74 6572 732c  ditions(filters,
+000031f0: 2077 696c 6463 6172 6473 2920 746f 2071   wildcards) to q
+00003200: 7565 7279 2e22 2222 0a20 2020 2020 2020  uery.""".       
+00003210: 2066 696c 7465 7273 203d 206c 6973 7428   filters = list(
+00003220: 6669 6c74 6572 7329 0a20 2020 2020 2020  filters).       
+00003230: 2073 7562 5f71 7565 7279 203d 2028 0a20   sub_query = (. 
+00003240: 2020 2020 2020 2020 2020 2066 2228 7b71             f"({q
+00003250: 7565 7279 5f6f 725f 7461 626c 657d 2922  uery_or_table})"
+00003260: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003270: 5f69 735f 7175 6572 7928 7175 6572 795f  _is_query(query_
+00003280: 6f72 5f74 6162 6c65 290a 2020 2020 2020  or_table).      
+00003290: 2020 2020 2020 656c 7365 2066 2260 7b71        else f"`{q
+000032a0: 7565 7279 5f6f 725f 7461 626c 657d 6022  uery_or_table}`"
+000032b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000032c0: 2020 2020 7365 6c65 6374 5f63 6c61 7573      select_claus
+000032d0: 6520 3d20 2253 454c 4543 5420 2220 2b20  e = "SELECT " + 
+000032e0: 280a 2020 2020 2020 2020 2020 2020 222c  (.            ",
+000032f0: 2022 2e6a 6f69 6e28 6622 607b 636f 6c75   ".join(f"`{colu
+00003300: 6d6e 7d60 2220 666f 7220 636f 6c75 6d6e  mn}`" for column
+00003310: 2069 6e20 636f 6c75 6d6e 7329 2069 6620   in columns) if 
+00003320: 636f 6c75 6d6e 7320 656c 7365 2022 2a22  columns else "*"
+00003330: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00003340: 2020 2020 7768 6572 655f 636c 6175 7365      where_clause
+00003350: 203d 2022 220a 2020 2020 2020 2020 6966   = "".        if
+00003360: 2066 696c 7465 7273 3a0a 2020 2020 2020   filters:.      
+00003370: 2020 2020 2020 7661 6c69 645f 6f70 6572        valid_oper
+00003380: 6174 6f72 733a 204d 6170 7069 6e67 5b74  ators: Mapping[t
+00003390: 6869 7264 5f70 6172 7479 5f70 616e 6461  hird_party_panda
+000033a0: 735f 6762 712e 4669 6c74 6572 4f70 732c  s_gbq.FilterOps,
+000033b0: 2073 7472 5d20 3d20 7b0a 2020 2020 2020   str] = {.      
+000033c0: 2020 2020 2020 2020 2020 2269 6e22 3a20            "in": 
+000033d0: 2249 4e22 2c0a 2020 2020 2020 2020 2020  "IN",.          
+000033e0: 2020 2020 2020 226e 6f74 2069 6e22 3a20        "not in": 
+000033f0: 224e 4f54 2049 4e22 2c0a 2020 2020 2020  "NOT IN",.      
+00003400: 2020 2020 2020 2020 2020 224c 494b 4522            "LIKE"
+00003410: 3a20 224c 494b 4522 2c0a 2020 2020 2020  : "LIKE",.      
+00003420: 2020 2020 2020 2020 2020 223d 3d22 3a20            "==": 
+00003430: 223d 222c 0a20 2020 2020 2020 2020 2020  "=",.           
+00003440: 2020 2020 2022 3e22 3a20 223e 222c 0a20       ">": ">",. 
+00003450: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00003460: 3c22 3a20 223c 222c 0a20 2020 2020 2020  <": "<",.       
+00003470: 2020 2020 2020 2020 2022 3e3d 223a 2022           ">=": "
+00003480: 3e3d 222c 0a20 2020 2020 2020 2020 2020  >=",.           
+00003490: 2020 2020 2022 3c3d 223a 2022 3c3d 222c       "<=": "<=",
+000034a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000034b0: 2022 213d 223a 2022 213d 222c 0a20 2020   "!=": "!=",.   
+000034c0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+000034d0: 2020 2020 2020 2020 2320 4966 2073 696e          # If sin
+000034e0: 676c 6520 6c61 7965 7220 6669 6c74 6572  gle layer filter
+000034f0: 2c20 6164 6420 616e 6f74 6865 7220 7073  , add another ps
+00003500: 6575 646f 206c 6179 6572 2e20 536f 2074  eudo layer. So t
+00003510: 6865 2073 696e 676c 6520 6c61 7965 7220  he single layer 
+00003520: 7265 7072 6573 656e 7473 2022 616e 6422  represents "and"
+00003530: 206c 6f67 6963 2e0a 2020 2020 2020 2020   logic..        
+00003540: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00003550: 6528 6669 6c74 6572 735b 305d 2c20 7475  e(filters[0], tu
+00003560: 706c 6529 2061 6e64 2028 0a20 2020 2020  ple) and (.     
+00003570: 2020 2020 2020 2020 2020 206c 656e 2866             len(f
+00003580: 696c 7465 7273 5b30 5d29 203d 3d20 3020  ilters[0]) == 0 
+00003590: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
+000035a0: 6528 6c69 7374 2866 696c 7465 7273 5b30  e(list(filters[0
+000035b0: 5d29 5b30 5d2c 2074 7570 6c65 290a 2020  ])[0], tuple).  
+000035c0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+000035d0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+000035e0: 7465 7273 203d 2074 7970 696e 672e 6361  ters = typing.ca
+000035f0: 7374 2874 6869 7264 5f70 6172 7479 5f70  st(third_party_p
+00003600: 616e 6461 735f 6762 712e 4669 6c74 6572  andas_gbq.Filter
+00003610: 7354 7970 652c 205b 6669 6c74 6572 735d  sType, [filters]
+00003620: 290a 0a20 2020 2020 2020 2020 2020 206f  )..            o
+00003630: 725f 6578 7072 6573 7369 6f6e 7320 3d20  r_expressions = 
+00003640: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+00003650: 6f72 2067 726f 7570 2069 6e20 6669 6c74  or group in filt
+00003660: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+00003670: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00003680: 7374 616e 6365 2867 726f 7570 2c20 4974  stance(group, It
+00003690: 6572 6162 6c65 293a 0a20 2020 2020 2020  erable):.       
+000036a0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+000036b0: 7570 203d 205b 6772 6f75 705d 0a0a 2020  up = [group]..  
+000036c0: 2020 2020 2020 2020 2020 2020 2020 616e                an
+000036d0: 645f 6578 7072 6573 7369 6f6e 7320 3d20  d_expressions = 
+000036e0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+000036f0: 2020 2066 6f72 2066 696c 7465 725f 6974     for filter_it
+00003700: 656d 2069 6e20 6772 6f75 703a 0a20 2020  em in group:.   
+00003710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003720: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00003730: 6365 2866 696c 7465 725f 6974 656d 2c20  ce(filter_item, 
+00003740: 7475 706c 6529 206f 7220 286c 656e 2866  tuple) or (len(f
+00003750: 696c 7465 725f 6974 656d 2920 213d 2033  ilter_item) != 3
+00003760: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00003770: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00003780: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037a0: 2020 2020 2020 2020 2066 2246 696c 7465           f"Filte
+000037b0: 7220 636f 6e64 6974 696f 6e20 7368 6f75  r condition shou
+000037c0: 6c64 2062 6520 6120 7475 706c 6520 6f66  ld be a tuple of
+000037d0: 206c 656e 6774 6820 332c 207b 6669 6c74   length 3, {filt
+000037e0: 6572 5f69 7465 6d7d 2069 7320 6e6f 7420  er_item} is not 
+000037f0: 7661 6c69 642e 220a 2020 2020 2020 2020  valid.".        
+00003800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003810: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00003820: 2020 2020 2020 2063 6f6c 756d 6e2c 206f         column, o
+00003830: 7065 7261 746f 722c 2076 616c 7565 203d  perator, value =
+00003840: 2066 696c 7465 725f 6974 656d 0a0a 2020   filter_item..  
+00003850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003860: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00003870: 6e63 6528 636f 6c75 6d6e 2c20 7374 7229  nce(column, str)
+00003880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003890: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000038a0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000038b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038c0: 2020 2020 2020 2020 6622 436f 6c75 6d6e          f"Column
+000038d0: 206e 616d 6520 7368 6f75 6c64 2062 6520   name should be 
+000038e0: 6120 7374 7269 6e67 2c20 6275 7420 7265  a string, but re
+000038f0: 6365 6976 6564 2027 7b63 6f6c 756d 6e7d  ceived '{column}
+00003900: 2720 6f66 2074 7970 6520 7b74 7970 6528  ' of type {type(
+00003910: 636f 6c75 6d6e 292e 5f5f 6e61 6d65 5f5f  column).__name__
+00003920: 7d2e 220a 2020 2020 2020 2020 2020 2020  }.".            
+00003930: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00003940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003950: 2020 2069 6620 6f70 6572 6174 6f72 206e     if operator n
+00003960: 6f74 2069 6e20 7661 6c69 645f 6f70 6572  ot in valid_oper
+00003970: 6174 6f72 733a 0a20 2020 2020 2020 2020  ators:.         
+00003980: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00003990: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000039a0: 6622 4f70 6572 6174 6f72 207b 6f70 6572  f"Operator {oper
+000039b0: 6174 6f72 7d20 6973 206e 6f74 2076 616c  ator} is not val
+000039c0: 6964 2e22 290a 0a20 2020 2020 2020 2020  id.")..         
+000039d0: 2020 2020 2020 2020 2020 206f 7065 7261             opera
+000039e0: 746f 725f 7374 7220 3d20 7661 6c69 645f  tor_str = valid_
+000039f0: 6f70 6572 6174 6f72 735b 6f70 6572 6174  operators[operat
+00003a00: 6f72 5d0a 0a20 2020 2020 2020 2020 2020  or]..           
+00003a10: 2020 2020 2020 2020 2069 6620 6f70 6572           if oper
+00003a20: 6174 6f72 5f73 7472 2069 6e20 5b22 494e  ator_str in ["IN
+00003a30: 222c 2022 4e4f 5420 494e 225d 3a0a 2020  ", "NOT IN"]:.  
+00003a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a50: 2020 2020 2020 7661 6c75 655f 6c69 7374        value_list
+00003a60: 203d 2022 2c20 222e 6a6f 696e 285b 7265   = ", ".join([re
+00003a70: 7072 2876 2920 666f 7220 7620 696e 2076  pr(v) for v in v
+00003a80: 616c 7565 5d29 0a20 2020 2020 2020 2020  alue]).         
+00003a90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003aa0: 7870 7265 7373 696f 6e20 3d20 6622 607b  xpression = f"`{
+00003ab0: 636f 6c75 6d6e 7d60 207b 6f70 6572 6174  column}` {operat
+00003ac0: 6f72 5f73 7472 7d20 287b 7661 6c75 655f  or_str} ({value_
+00003ad0: 6c69 7374 7d29 220a 2020 2020 2020 2020  list})".        
+00003ae0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00003af0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003b00: 2020 2020 2020 2020 2020 6578 7072 6573            expres
+00003b10: 7369 6f6e 203d 2066 2260 7b63 6f6c 756d  sion = f"`{colum
+00003b20: 6e7d 6020 7b6f 7065 7261 746f 725f 7374  n}` {operator_st
+00003b30: 727d 207b 7265 7072 2876 616c 7565 297d  r} {repr(value)}
+00003b40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00003b50: 2020 2020 2020 616e 645f 6578 7072 6573        and_expres
+00003b60: 7369 6f6e 732e 6170 7065 6e64 2865 7870  sions.append(exp
+00003b70: 7265 7373 696f 6e29 0a0a 2020 2020 2020  ression)..      
+00003b80: 2020 2020 2020 2020 2020 6f72 5f65 7870            or_exp
+00003b90: 7265 7373 696f 6e73 2e61 7070 656e 6428  ressions.append(
+00003ba0: 2220 414e 4420 222e 6a6f 696e 2861 6e64  " AND ".join(and
+00003bb0: 5f65 7870 7265 7373 696f 6e73 2929 0a0a  _expressions))..
+00003bc0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00003bd0: 725f 6578 7072 6573 7369 6f6e 733a 0a20  r_expressions:. 
+00003be0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00003bf0: 6865 7265 5f63 6c61 7573 6520 3d20 2220  here_clause = " 
+00003c00: 5748 4552 4520 2220 2b20 2220 4f52 2022  WHERE " + " OR "
+00003c10: 2e6a 6f69 6e28 6f72 5f65 7870 7265 7373  .join(or_express
+00003c20: 696f 6e73 290a 0a20 2020 2020 2020 2066  ions)..        f
+00003c30: 756c 6c5f 7175 6572 7920 3d20 6622 7b73  ull_query = f"{s
+00003c40: 656c 6563 745f 636c 6175 7365 7d20 4652  elect_clause} FR
+00003c50: 4f4d 207b 7375 625f 7175 6572 797d 2041  OM {sub_query} A
+00003c60: 5320 7375 627b 7768 6572 655f 636c 6175  S sub{where_clau
+00003c70: 7365 7d22 0a20 2020 2020 2020 2072 6574  se}".        ret
+00003c80: 7572 6e20 6675 6c6c 5f71 7565 7279 0a0a  urn full_query..
+00003c90: 2020 2020 6465 6620 5f71 7565 7279 5f74      def _query_t
+00003ca0: 6f5f 6465 7374 696e 6174 696f 6e28 0a20  o_destination(. 
+00003cb0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00003cc0: 2020 2020 2071 7565 7279 3a20 7374 722c       query: str,
+00003cd0: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
+00003ce0: 6f6c 733a 204c 6973 745b 7374 725d 2c0a  ols: List[str],.
+00003cf0: 2020 2020 2020 2020 6170 695f 6e61 6d65          api_name
+00003d00: 3a20 7374 722c 0a20 2020 2020 2020 2063  : str,.        c
+00003d10: 6f6e 6669 6775 7261 7469 6f6e 3a20 6469  onfiguration: di
+00003d20: 6374 203d 207b 2271 7565 7279 223a 207b  ct = {"query": {
+00003d30: 2275 7365 5175 6572 7943 6163 6865 223a  "useQueryCache":
+00003d40: 2054 7275 657d 7d2c 0a20 2020 2029 202d   True}},.    ) -
+00003d50: 3e20 5475 706c 655b 4f70 7469 6f6e 616c  > Tuple[Optional
+00003d60: 5b62 6967 7175 6572 792e 5461 626c 6552  [bigquery.TableR
+00003d70: 6566 6572 656e 6365 5d2c 204f 7074 696f  eference], Optio
+00003d80: 6e61 6c5b 6269 6771 7565 7279 2e51 7565  nal[bigquery.Que
+00003d90: 7279 4a6f 625d 5d3a 0a20 2020 2020 2020  ryJob]]:.       
+00003da0: 2023 2049 6620 6120 6472 795f 7275 6e20   # If a dry_run 
+00003db0: 696e 6469 6361 7465 7320 7468 6973 2069  indicates this i
+00003dc0: 7320 6e6f 7420 6120 7175 6572 7920 7479  s not a query ty
+00003dd0: 7065 206a 6f62 2c20 7468 656e 2064 6f6e  pe job, then don
+00003de0: 2774 0a20 2020 2020 2020 2023 2062 6f74  't.        # bot
+00003df0: 6865 7220 7472 7969 6e67 2074 6f20 646f  her trying to do
+00003e00: 2061 2043 5245 4154 4520 5445 4d50 2054   a CREATE TEMP T
+00003e10: 4142 4c45 202e 2e2e 2041 5320 5345 4c45  ABLE ... AS SELE
+00003e20: 4354 202e 2e2e 2073 7461 7465 6d65 6e74  CT ... statement
+00003e30: 2e0a 2020 2020 2020 2020 6472 795f 7275  ..        dry_ru
+00003e40: 6e5f 636f 6e66 6967 203d 2062 6967 7175  n_config = bigqu
+00003e50: 6572 792e 5175 6572 794a 6f62 436f 6e66  ery.QueryJobConf
+00003e60: 6967 2829 0a20 2020 2020 2020 2064 7279  ig().        dry
+00003e70: 5f72 756e 5f63 6f6e 6669 672e 6472 795f  _run_config.dry_
+00003e80: 7275 6e20 3d20 5472 7565 0a20 2020 2020  run = True.     
+00003e90: 2020 205f 2c20 6472 795f 7275 6e5f 6a6f     _, dry_run_jo
+00003ea0: 6220 3d20 7365 6c66 2e5f 7374 6172 745f  b = self._start_
+00003eb0: 7175 6572 7928 7175 6572 792c 206a 6f62  query(query, job
+00003ec0: 5f63 6f6e 6669 673d 6472 795f 7275 6e5f  _config=dry_run_
+00003ed0: 636f 6e66 6967 290a 2020 2020 2020 2020  config).        
+00003ee0: 6966 2064 7279 5f72 756e 5f6a 6f62 2e73  if dry_run_job.s
+00003ef0: 7461 7465 6d65 6e74 5f74 7970 6520 213d  tatement_type !=
+00003f00: 2022 5345 4c45 4354 223a 0a20 2020 2020   "SELECT":.     
+00003f10: 2020 2020 2020 205f 2c20 7175 6572 795f         _, query_
+00003f20: 6a6f 6220 3d20 7365 6c66 2e5f 7374 6172  job = self._star
+00003f30: 745f 7175 6572 7928 7175 6572 7929 0a20  t_query(query). 
+00003f40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003f50: 6e20 7175 6572 795f 6a6f 622e 6465 7374  n query_job.dest
+00003f60: 696e 6174 696f 6e2c 2071 7565 7279 5f6a  ination, query_j
+00003f70: 6f62 0a0a 2020 2020 2020 2020 2320 4372  ob..        # Cr
+00003f80: 6561 7465 2061 2074 6162 6c65 2074 6f20  eate a table to 
+00003f90: 776f 726b 6172 6f75 6e64 2042 6967 5175  workaround BigQu
+00003fa0: 6572 7920 3130 2047 4220 7175 6572 7920  ery 10 GB query 
+00003fb0: 7265 7375 6c74 7320 6c69 6d69 742e 2053  results limit. S
+00003fc0: 6565 3a0a 2020 2020 2020 2020 2320 696e  ee:.        # in
+00003fd0: 7465 726e 616c 2069 7373 7565 2033 3033  ternal issue 303
+00003fe0: 3035 3733 3336 2e0a 2020 2020 2020 2020  057336..        
+00003ff0: 2320 5369 6e63 6520 7765 2068 6176 6520  # Since we have 
+00004000: 6120 6073 7461 7465 6d65 6e74 5f74 7970  a `statement_typ
+00004010: 6520 3d3d 2027 5345 4c45 4354 2760 2c20  e == 'SELECT'`, 
+00004020: 7363 6865 6d61 2073 686f 756c 6420 6265  schema should be
+00004030: 2070 6f70 756c 6174 6564 2e0a 2020 2020   populated..    
+00004040: 2020 2020 7363 6865 6d61 203d 2074 7970      schema = typ
+00004050: 696e 672e 6361 7374 2849 7465 7261 626c  ing.cast(Iterabl
+00004060: 655b 6269 6771 7565 7279 2e53 6368 656d  e[bigquery.Schem
+00004070: 6146 6965 6c64 5d2c 2064 7279 5f72 756e  aField], dry_run
+00004080: 5f6a 6f62 2e73 6368 656d 6129 0a20 2020  _job.schema).   
+00004090: 2020 2020 2063 6c75 7374 6572 5f63 6f6c       cluster_col
+000040a0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+000040b0: 2020 6974 656d 2e6e 616d 650a 2020 2020    item.name.    
+000040c0: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+000040d0: 2069 6e20 7363 6865 6d61 0a20 2020 2020   in schema.     
+000040e0: 2020 2020 2020 2069 6620 2869 7465 6d2e         if (item.
+000040f0: 6e61 6d65 2069 6e20 696e 6465 785f 636f  name in index_co
+00004100: 6c73 2920 616e 6420 5f63 616e 5f63 6c75  ls) and _can_clu
+00004110: 7374 6572 5f62 7128 6974 656d 290a 2020  ster_bq(item).  
+00004120: 2020 2020 2020 5d5b 3a5f 4d41 585f 434c        ][:_MAX_CL
+00004130: 5553 5445 525f 434f 4c55 4d4e 535d 0a20  USTER_COLUMNS]. 
+00004140: 2020 2020 2020 2074 656d 705f 7461 626c         temp_tabl
+00004150: 6520 3d20 7365 6c66 2e5f 6372 6561 7465  e = self._create
+00004160: 5f65 6d70 7479 5f74 656d 705f 7461 626c  _empty_temp_tabl
+00004170: 6528 7363 6865 6d61 2c20 636c 7573 7465  e(schema, cluste
+00004180: 725f 636f 6c73 290a 0a20 2020 2020 2020  r_cols)..       
+00004190: 2074 696d 656f 7574 5f6d 7320 3d20 636f   timeout_ms = co
+000041a0: 6e66 6967 7572 6174 696f 6e2e 6765 7428  nfiguration.get(
+000041b0: 226a 6f62 5469 6d65 6f75 744d 7322 2920  "jobTimeoutMs") 
+000041c0: 6f72 2063 6f6e 6669 6775 7261 7469 6f6e  or configuration
+000041d0: 5b22 7175 6572 7922 5d2e 6765 7428 0a20  ["query"].get(. 
+000041e0: 2020 2020 2020 2020 2020 2022 7469 6d65             "time
+000041f0: 6f75 744d 7322 0a20 2020 2020 2020 2029  outMs".        )
+00004200: 0a0a 2020 2020 2020 2020 2320 436f 6e76  ..        # Conv
+00004210: 6572 7420 7469 6d65 6f75 745f 6d73 2074  ert timeout_ms t
+00004220: 6f20 7365 636f 6e64 732c 2065 6e73 7572  o seconds, ensur
+00004230: 696e 6720 6120 6d69 6e69 6d75 6d20 6f66  ing a minimum of
+00004240: 2030 2e31 2073 6563 6f6e 6473 2074 6f20   0.1 seconds to 
+00004250: 6176 6f69 640a 2020 2020 2020 2020 2320  avoid.        # 
+00004260: 7468 6520 7072 6f67 7261 6d20 6765 7474  the program gett
+00004270: 696e 6720 7374 7563 6b20 6f6e 2074 6f6f  ing stuck on too
+00004280: 2d73 686f 7274 2074 696d 656f 7574 732e  -short timeouts.
+00004290: 0a20 2020 2020 2020 2074 696d 656f 7574  .        timeout
+000042a0: 203d 206d 6178 2869 6e74 2874 696d 656f   = max(int(timeo
+000042b0: 7574 5f6d 7329 202a 2031 652d 332c 2030  ut_ms) * 1e-3, 0
+000042c0: 2e31 2920 6966 2074 696d 656f 7574 5f6d  .1) if timeout_m
+000042d0: 7320 656c 7365 204e 6f6e 650a 0a20 2020  s else None..   
+000042e0: 2020 2020 206a 6f62 5f63 6f6e 6669 6720       job_config 
+000042f0: 3d20 7479 7069 6e67 2e63 6173 7428 0a20  = typing.cast(. 
+00004300: 2020 2020 2020 2020 2020 2062 6967 7175             bigqu
+00004310: 6572 792e 5175 6572 794a 6f62 436f 6e66  ery.QueryJobConf
+00004320: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+00004330: 6269 6771 7565 7279 2e51 7565 7279 4a6f  bigquery.QueryJo
+00004340: 6243 6f6e 6669 672e 6672 6f6d 5f61 7069  bConfig.from_api
+00004350: 5f72 6570 7228 636f 6e66 6967 7572 6174  _repr(configurat
+00004360: 696f 6e29 2c0a 2020 2020 2020 2020 290a  ion),.        ).
+00004370: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00004380: 6967 2e6c 6162 656c 735b 2262 6967 6672  ig.labels["bigfr
+00004390: 616d 6573 2d61 7069 225d 203d 2061 7069  ames-api"] = api
+000043a0: 5f6e 616d 650a 2020 2020 2020 2020 6a6f  _name.        jo
+000043b0: 625f 636f 6e66 6967 2e64 6573 7469 6e61  b_config.destina
+000043c0: 7469 6f6e 203d 2074 656d 705f 7461 626c  tion = temp_tabl
+000043d0: 650a 0a20 2020 2020 2020 2074 7279 3a0a  e..        try:.
+000043e0: 2020 2020 2020 2020 2020 2020 2320 5772              # Wr
+000043f0: 6974 6520 746f 2074 656d 7020 7461 626c  ite to temp tabl
+00004400: 6520 746f 2077 6f72 6b61 726f 756e 6420  e to workaround 
+00004410: 4269 6751 7565 7279 2031 3020 4742 2071  BigQuery 10 GB q
+00004420: 7565 7279 2072 6573 756c 7473 0a20 2020  uery results.   
+00004430: 2020 2020 2020 2020 2023 206c 696d 6974           # limit
+00004440: 2e20 5365 653a 2069 6e74 6572 6e61 6c20  . See: internal 
+00004450: 6973 7375 6520 3330 3330 3537 3333 362e  issue 303057336.
+00004460: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
+00004470: 5f63 6f6e 6669 672e 6c61 6265 6c73 5b22  _config.labels["
+00004480: 6572 726f 725f 6361 7567 6874 225d 203d  error_caught"] =
+00004490: 2022 7472 7565 220a 2020 2020 2020 2020   "true".        
+000044a0: 2020 2020 5f2c 2071 7565 7279 5f6a 6f62      _, query_job
+000044b0: 203d 2073 656c 662e 5f73 7461 7274 5f71   = self._start_q
+000044c0: 7565 7279 280a 2020 2020 2020 2020 2020  uery(.          
+000044d0: 2020 2020 2020 7175 6572 792c 206a 6f62        query, job
+000044e0: 5f63 6f6e 6669 673d 6a6f 625f 636f 6e66  _config=job_conf
+000044f0: 6967 2c20 7469 6d65 6f75 743d 7469 6d65  ig, timeout=time
+00004500: 6f75 740a 2020 2020 2020 2020 2020 2020  out.            
+00004510: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00004520: 7475 726e 2071 7565 7279 5f6a 6f62 2e64  turn query_job.d
+00004530: 6573 7469 6e61 7469 6f6e 2c20 7175 6572  estination, quer
+00004540: 795f 6a6f 620a 2020 2020 2020 2020 6578  y_job.        ex
+00004550: 6365 7074 2067 6f6f 676c 652e 6170 695f  cept google.api_
+00004560: 636f 7265 2e65 7863 6570 7469 6f6e 732e  core.exceptions.
+00004570: 4261 6452 6571 7565 7374 3a0a 2020 2020  BadRequest:.    
+00004580: 2020 2020 2020 2020 2320 536f 6d65 2053          # Some S
+00004590: 454c 4543 5420 7374 6174 656d 656e 7473  ELECT statements
+000045a0: 2073 7469 6c6c 2061 7265 6e27 7420 636f   still aren't co
+000045b0: 6d70 6174 6962 6c65 2077 6974 6820 636c  mpatible with cl
+000045c0: 7573 7465 720a 2020 2020 2020 2020 2020  uster.          
+000045d0: 2020 2320 7461 626c 6573 2061 7320 7468    # tables as th
+000045e0: 6520 6465 7374 696e 6174 696f 6e2e 2046  e destination. F
+000045f0: 6f72 2065 7861 6d70 6c65 2c20 6966 2074  or example, if t
+00004600: 6865 2071 7565 7279 2068 6173 2061 0a20  he query has a. 
+00004610: 2020 2020 2020 2020 2020 2023 2074 6f70             # top
+00004620: 2d6c 6576 656c 204f 5244 4552 2042 592c  -level ORDER BY,
+00004630: 2074 6869 7320 636f 6e66 6c69 6374 7320   this conflicts 
+00004640: 7769 7468 206f 7572 2061 6269 6c69 7479  with our ability
+00004650: 2074 6f20 636c 7573 7465 720a 2020 2020   to cluster.    
+00004660: 2020 2020 2020 2020 2320 7468 6520 7461          # the ta
+00004670: 626c 6520 6279 2074 6865 2069 6e64 6578  ble by the index
+00004680: 2063 6f6c 756d 6e28 7329 2e0a 2020 2020   column(s)..    
+00004690: 2020 2020 2020 2020 5f2c 2071 7565 7279          _, query
+000046a0: 5f6a 6f62 203d 2073 656c 662e 5f73 7461  _job = self._sta
+000046b0: 7274 5f71 7565 7279 2871 7565 7279 2c20  rt_query(query, 
+000046c0: 7469 6d65 6f75 743d 7469 6d65 6f75 7429  timeout=timeout)
+000046d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000046e0: 7572 6e20 7175 6572 795f 6a6f 622e 6465  urn query_job.de
+000046f0: 7374 696e 6174 696f 6e2c 2071 7565 7279  stination, query
+00004700: 5f6a 6f62 0a0a 2020 2020 6465 6620 7265  _job..    def re
+00004710: 6164 5f67 6271 5f71 7565 7279 280a 2020  ad_gbq_query(.  
+00004720: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00004730: 2020 2020 7175 6572 793a 2073 7472 2c0a      query: str,.
+00004740: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+00004750: 2020 2069 6e64 6578 5f63 6f6c 3a20 4974     index_col: It
+00004760: 6572 6162 6c65 5b73 7472 5d20 7c20 7374  erable[str] | st
+00004770: 7220 3d20 2829 2c0a 2020 2020 2020 2020  r = (),.        
+00004780: 636f 6c75 6d6e 733a 2049 7465 7261 626c  columns: Iterabl
+00004790: 655b 7374 725d 203d 2028 292c 0a20 2020  e[str] = (),.   
+000047a0: 2020 2020 2063 6f6e 6669 6775 7261 7469       configurati
+000047b0: 6f6e 3a20 4f70 7469 6f6e 616c 5b44 6963  on: Optional[Dic
+000047c0: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
+000047d0: 2020 206d 6178 5f72 6573 756c 7473 3a20     max_results: 
+000047e0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+000047f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7573  None,.        us
+00004800: 655f 6361 6368 653a 204f 7074 696f 6e61  e_cache: Optiona
+00004810: 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65 2c0a  l[bool] = None,.
+00004820: 2020 2020 2020 2020 636f 6c5f 6f72 6465          col_orde
+00004830: 723a 2049 7465 7261 626c 655b 7374 725d  r: Iterable[str]
+00004840: 203d 2028 292c 0a20 2020 2029 202d 3e20   = (),.    ) -> 
+00004850: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
+00004860: 616d 653a 0a20 2020 2020 2020 2022 2222  ame:.        """
+00004870: 5475 726e 2061 2053 514c 2071 7565 7279  Turn a SQL query
+00004880: 2069 6e74 6f20 6120 4461 7461 4672 616d   into a DataFram
+00004890: 652e 0a0a 2020 2020 2020 2020 4e6f 7465  e...        Note
+000048a0: 3a20 4265 6361 7573 6520 7468 6520 7265  : Because the re
+000048b0: 7375 6c74 7320 6172 6520 7772 6974 7465  sults are writte
+000048c0: 6e20 746f 2061 2074 656d 706f 7261 7279  n to a temporary
+000048d0: 2074 6162 6c65 2c20 6f72 6465 7269 6e67   table, ordering
+000048e0: 2062 790a 2020 2020 2020 2020 6060 4f52   by.        ``OR
+000048f0: 4445 5220 4259 6060 2069 7320 6e6f 7420  DER BY`` is not 
+00004900: 7072 6573 6572 7665 642e 2041 2075 6e69  preserved. A uni
+00004910: 7175 6520 6069 6e64 6578 5f63 6f6c 6020  que `index_col` 
+00004920: 6973 2072 6563 6f6d 6d65 6e64 6564 2e20  is recommended. 
+00004930: 5573 650a 2020 2020 2020 2020 6060 726f  Use.        ``ro
+00004940: 775f 6e75 6d62 6572 2829 206f 7665 7220  w_number() over 
+00004950: 2829 6060 2069 6620 7468 6572 6520 6973  ()`` if there is
+00004960: 206e 6f20 6e61 7475 7261 6c20 756e 6971   no natural uniq
+00004970: 7565 2069 6e64 6578 206f 7220 796f 750a  ue index or you.
+00004980: 2020 2020 2020 2020 7761 6e74 2074 6f20          want to 
+00004990: 7072 6573 6572 7665 206f 7264 6572 696e  preserve orderin
+000049a0: 672e 0a0a 2020 2020 2020 2020 2a2a 4578  g...        **Ex
+000049b0: 616d 706c 6573 3a2a 2a0a 0a20 2020 2020  amples:**..     
+000049c0: 2020 2020 2020 203e 3e3e 2069 6d70 6f72         >>> impor
+000049d0: 7420 6269 6766 7261 6d65 732e 7061 6e64  t bigframes.pand
+000049e0: 6173 2061 7320 6270 640a 2020 2020 2020  as as bpd.      
+000049f0: 2020 2020 2020 3e3e 3e20 6270 642e 6f70        >>> bpd.op
+00004a00: 7469 6f6e 732e 6469 7370 6c61 792e 7072  tions.display.pr
+00004a10: 6f67 7265 7373 5f62 6172 203d 204e 6f6e  ogress_bar = Non
+00004a20: 650a 0a20 2020 2020 2020 2053 696d 706c  e..        Simpl
+00004a30: 6520 7175 6572 7920 696e 7075 743a 0a0a  e query input:..
+00004a40: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+00004a50: 6466 203d 2062 7064 2e72 6561 645f 6762  df = bpd.read_gb
+00004a60: 715f 7175 6572 7928 2727 270a 2020 2020  q_query('''.    
+00004a70: 2020 2020 2020 2020 2e2e 2e20 2020 2053          ...    S
+00004a80: 454c 4543 540a 2020 2020 2020 2020 2020  ELECT.          
+00004a90: 2020 2e2e 2e20 2020 2020 2020 7069 7463    ...       pitc
+00004aa0: 6865 7246 6972 7374 4e61 6d65 2c0a 2020  herFirstName,.  
+00004ab0: 2020 2020 2020 2020 2020 2e2e 2e20 2020            ...   
+00004ac0: 2020 2020 7069 7463 6865 724c 6173 744e      pitcherLastN
+00004ad0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00004ae0: 202e 2e2e 2020 2020 2020 2070 6974 6368   ...       pitch
+00004af0: 5370 6565 642c 0a20 2020 2020 2020 2020  Speed,.         
+00004b00: 2020 202e 2e2e 2020 2020 4652 4f4d 2060     ...    FROM `
+00004b10: 6269 6771 7565 7279 2d70 7562 6c69 632d  bigquery-public-
+00004b20: 6461 7461 2e62 6173 6562 616c 6c2e 6761  data.baseball.ga
+00004b30: 6d65 735f 7769 6465 600a 2020 2020 2020  mes_wide`.      
+00004b40: 2020 2020 2020 2e2e 2e20 2727 2729 0a0a        ... ''')..
+00004b50: 2020 2020 2020 2020 5072 6573 6572 7665          Preserve
+00004b60: 206f 7264 6572 696e 6720 696e 2061 2071   ordering in a q
+00004b70: 7565 7279 2069 6e70 7574 2e0a 0a20 2020  uery input...   
+00004b80: 2020 2020 2020 2020 203e 3e3e 2064 6620           >>> df 
+00004b90: 3d20 6270 642e 7265 6164 5f67 6271 5f71  = bpd.read_gbq_q
+00004ba0: 7565 7279 2827 2727 0a20 2020 2020 2020  uery('''.       
+00004bb0: 2020 2020 202e 2e2e 2020 2020 5345 4c45       ...    SELE
+00004bc0: 4354 0a20 2020 2020 2020 2020 2020 202e  CT.            .
+00004bd0: 2e2e 2020 2020 2020 202d 2d20 496e 7374  ..       -- Inst
+00004be0: 6561 6420 6f66 2061 6e20 4f52 4445 5220  ead of an ORDER 
+00004bf0: 4259 2063 6c61 7573 6520 6f6e 2074 6865  BY clause on the
+00004c00: 2071 7565 7279 2c20 7573 650a 2020 2020   query, use.    
+00004c10: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+00004c20: 2020 2d2d 2052 4f57 5f4e 554d 4245 5228    -- ROW_NUMBER(
+00004c30: 2920 746f 2063 7265 6174 6520 616e 206f  ) to create an o
+00004c40: 7264 6572 6564 2044 6174 6146 7261 6d65  rdered DataFrame
+00004c50: 2e0a 2020 2020 2020 2020 2020 2020 2e2e  ..            ..
+00004c60: 2e20 2020 2020 2020 524f 575f 4e55 4d42  .       ROW_NUMB
+00004c70: 4552 2829 204f 5645 5220 284f 5244 4552  ER() OVER (ORDER
+00004c80: 2042 5920 4156 4728 7069 7463 6853 7065   BY AVG(pitchSpe
+00004c90: 6564 2920 4445 5343 290a 2020 2020 2020  ed) DESC).      
+00004ca0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+00004cb0: 2020 4153 2072 6f77 696e 6465 782c 0a20    AS rowindex,. 
+00004cc0: 2020 2020 2020 2020 2020 202e 2e2e 0a20             .... 
+00004cd0: 2020 2020 2020 2020 2020 202e 2e2e 2020             ...  
+00004ce0: 2020 2020 2070 6974 6368 6572 4669 7273       pitcherFirs
+00004cf0: 744e 616d 652c 0a20 2020 2020 2020 2020  tName,.         
+00004d00: 2020 202e 2e2e 2020 2020 2020 2070 6974     ...       pit
+00004d10: 6368 6572 4c61 7374 4e61 6d65 2c0a 2020  cherLastName,.  
+00004d20: 2020 2020 2020 2020 2020 2e2e 2e20 2020            ...   
+00004d30: 2020 2020 4156 4728 7069 7463 6853 7065      AVG(pitchSpe
+00004d40: 6564 2920 4153 2061 7665 7261 6765 5069  ed) AS averagePi
+00004d50: 7463 6853 7065 6564 0a20 2020 2020 2020  tchSpeed.       
+00004d60: 2020 2020 202e 2e2e 2020 2020 2046 524f       ...     FRO
+00004d70: 4d20 6062 6967 7175 6572 792d 7075 626c  M `bigquery-publ
+00004d80: 6963 2d64 6174 612e 6261 7365 6261 6c6c  ic-data.baseball
+00004d90: 2e67 616d 6573 5f77 6964 6560 0a20 2020  .games_wide`.   
+00004da0: 2020 2020 2020 2020 202e 2e2e 2020 2020           ...    
+00004db0: 2057 4845 5245 2079 6561 7220 3d20 3230   WHERE year = 20
+00004dc0: 3136 0a20 2020 2020 2020 2020 2020 202e  16.            .
+00004dd0: 2e2e 2020 2020 2047 524f 5550 2042 5920  ..     GROUP BY 
+00004de0: 7069 7463 6865 7246 6972 7374 4e61 6d65  pitcherFirstName
+00004df0: 2c20 7069 7463 6865 724c 6173 744e 616d  , pitcherLastNam
+00004e00: 650a 2020 2020 2020 2020 2020 2020 2e2e  e.            ..
+00004e10: 2e20 2727 272c 2069 6e64 6578 5f63 6f6c  . ''', index_col
+00004e20: 3d22 726f 7769 6e64 6578 2229 0a20 2020  ="rowindex").   
+00004e30: 2020 2020 2020 2020 203e 3e3e 2064 662e           >>> df.
+00004e40: 6865 6164 2832 290a 2020 2020 2020 2020  head(2).        
+00004e50: 2020 2020 2020 2020 2020 2020 2070 6974               pit
+00004e60: 6368 6572 4669 7273 744e 616d 6520 7069  cherFirstName pi
+00004e70: 7463 6865 724c 6173 744e 616d 6520 2061  tcherLastName  a
+00004e80: 7665 7261 6765 5069 7463 6853 7065 6564  veragePitchSpeed
+00004e90: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
+00004ea0: 696e 6465 780a 2020 2020 2020 2020 2020  index.          
+00004eb0: 2020 3120 2020 2020 2020 2020 2020 2020    1             
+00004ec0: 2020 2041 6c62 6572 7469 6e20 2020 2020     Albertin     
+00004ed0: 2020 2020 4368 6170 6d61 6e20 2020 2020      Chapman     
+00004ee0: 2020 2020 2039 362e 3531 3431 3133 0a20       96.514113. 
+00004ef0: 2020 2020 2020 2020 2020 2032 2020 2020             2    
+00004f00: 2020 2020 2020 2020 2020 2020 205a 6163               Zac
+00004f10: 6861 7279 2020 2020 2020 2020 2042 7269  hary         Bri
+00004f20: 7474 6f6e 2020 2020 2020 2020 2020 3934  tton          94
+00004f30: 2e35 3931 3033 390a 2020 2020 2020 2020  .591039.        
+00004f40: 2020 2020 3c42 4c41 4e4b 4c49 4e45 3e0a      <BLANKLINE>.
+00004f50: 2020 2020 2020 2020 2020 2020 5b32 2072              [2 r
+00004f60: 6f77 7320 7820 3320 636f 6c75 6d6e 735d  ows x 3 columns]
+00004f70: 0a0a 2020 2020 2020 2020 5365 6520 616c  ..        See al
+00004f80: 736f 3a20 3a6d 6574 683a 6053 6573 7369  so: :meth:`Sessi
+00004f90: 6f6e 2e72 6561 645f 6762 7160 2e0a 2020  on.read_gbq`..  
+00004fa0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00004fb0: 2020 2320 4e4f 5445 3a20 5468 6973 206d    # NOTE: This m
+00004fc0: 6574 686f 6420 646f 6573 6e27 7420 2879  ethod doesn't (y
+00004fd0: 6574 2920 6578 6973 7420 696e 2070 616e  et) exist in pan
+00004fe0: 6461 7320 6f72 2070 616e 6461 732d 6762  das or pandas-gb
+00004ff0: 712c 2073 6f0a 2020 2020 2020 2020 2320  q, so.        # 
+00005000: 7468 6573 6520 646f 6373 7472 696e 6773  these docstrings
+00005010: 2061 7265 2069 6e6c 696e 652e 0a20 2020   are inline..   
+00005020: 2020 2020 2069 6620 636f 6c75 6d6e 7320       if columns 
+00005030: 616e 6420 636f 6c5f 6f72 6465 723a 0a20  and col_order:. 
+00005040: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00005050: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00005060: 2020 2020 2020 2020 2020 2020 2022 4d75               "Mu
+00005070: 7374 2073 7065 6369 6679 2065 6974 6865  st specify eithe
+00005080: 7220 636f 6c75 6d6e 7320 2870 7265 6665  r columns (prefe
+00005090: 7272 6564 2920 6f72 2063 6f6c 5f6f 7264  rred) or col_ord
+000050a0: 6572 2c20 6e6f 7420 626f 7468 220a 2020  er, not both".  
+000050b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000050c0: 2020 2020 656c 6966 2063 6f6c 5f6f 7264      elif col_ord
+000050d0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+000050e0: 636f 6c75 6d6e 7320 3d20 636f 6c5f 6f72  columns = col_or
+000050f0: 6465 720a 0a20 2020 2020 2020 2072 6574  der..        ret
+00005100: 7572 6e20 7365 6c66 2e5f 7265 6164 5f67  urn self._read_g
+00005110: 6271 5f71 7565 7279 280a 2020 2020 2020  bq_query(.      
+00005120: 2020 2020 2020 7175 6572 793d 7175 6572        query=quer
+00005130: 792c 0a20 2020 2020 2020 2020 2020 2069  y,.            i
+00005140: 6e64 6578 5f63 6f6c 3d69 6e64 6578 5f63  ndex_col=index_c
+00005150: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
+00005160: 636f 6c75 6d6e 733d 636f 6c75 6d6e 732c  columns=columns,
+00005170: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00005180: 6669 6775 7261 7469 6f6e 3d63 6f6e 6669  figuration=confi
+00005190: 6775 7261 7469 6f6e 2c0a 2020 2020 2020  guration,.      
+000051a0: 2020 2020 2020 6d61 785f 7265 7375 6c74        max_result
+000051b0: 733d 6d61 785f 7265 7375 6c74 732c 0a20  s=max_results,. 
+000051c0: 2020 2020 2020 2020 2020 2061 7069 5f6e             api_n
+000051d0: 616d 653d 2272 6561 645f 6762 715f 7175  ame="read_gbq_qu
+000051e0: 6572 7922 2c0a 2020 2020 2020 2020 2020  ery",.          
+000051f0: 2020 7573 655f 6361 6368 653d 7573 655f    use_cache=use_
+00005200: 6361 6368 652c 0a20 2020 2020 2020 2029  cache,.        )
+00005210: 0a0a 2020 2020 6465 6620 5f72 6561 645f  ..    def _read_
+00005220: 6762 715f 7175 6572 7928 0a20 2020 2020  gbq_query(.     
+00005230: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00005240: 2071 7565 7279 3a20 7374 722c 0a20 2020   query: str,.   
+00005250: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
+00005260: 696e 6465 785f 636f 6c3a 2049 7465 7261  index_col: Itera
+00005270: 626c 655b 7374 725d 207c 2073 7472 203d  ble[str] | str =
+00005280: 2028 292c 0a20 2020 2020 2020 2063 6f6c   (),.        col
+00005290: 756d 6e73 3a20 4974 6572 6162 6c65 5b73  umns: Iterable[s
+000052a0: 7472 5d20 3d20 2829 2c0a 2020 2020 2020  tr] = (),.      
+000052b0: 2020 636f 6e66 6967 7572 6174 696f 6e3a    configuration:
+000052c0: 204f 7074 696f 6e61 6c5b 4469 6374 5d20   Optional[Dict] 
+000052d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000052e0: 6d61 785f 7265 7375 6c74 733a 204f 7074  max_results: Opt
+000052f0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+00005300: 652c 0a20 2020 2020 2020 2061 7069 5f6e  e,.        api_n
+00005310: 616d 653a 2073 7472 203d 2022 7265 6164  ame: str = "read
+00005320: 5f67 6271 5f71 7565 7279 222c 0a20 2020  _gbq_query",.   
+00005330: 2020 2020 2075 7365 5f63 6163 6865 3a20       use_cache: 
+00005340: 4f70 7469 6f6e 616c 5b62 6f6f 6c5d 203d  Optional[bool] =
+00005350: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00005360: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
+00005370: 616d 653a 0a20 2020 2020 2020 2069 6d70  ame:.        imp
+00005380: 6f72 7420 6269 6766 7261 6d65 732e 6461  ort bigframes.da
+00005390: 7461 6672 616d 6520 6173 2064 6174 6166  taframe as dataf
+000053a0: 7261 6d65 0a0a 2020 2020 2020 2020 636f  rame..        co
+000053b0: 6e66 6967 7572 6174 696f 6e20 3d20 5f74  nfiguration = _t
+000053c0: 7261 6e73 666f 726d 5f72 6561 645f 6762  ransform_read_gb
+000053d0: 715f 636f 6e66 6967 7572 6174 696f 6e28  q_configuration(
+000053e0: 636f 6e66 6967 7572 6174 696f 6e29 0a0a  configuration)..
+000053f0: 2020 2020 2020 2020 6966 2022 7175 6572          if "quer
+00005400: 7922 206e 6f74 2069 6e20 636f 6e66 6967  y" not in config
+00005410: 7572 6174 696f 6e3a 0a20 2020 2020 2020  uration:.       
+00005420: 2020 2020 2063 6f6e 6669 6775 7261 7469       configurati
+00005430: 6f6e 5b22 7175 6572 7922 5d20 3d20 7b7d  on["query"] = {}
+00005440: 0a0a 2020 2020 2020 2020 6966 2022 7175  ..        if "qu
+00005450: 6572 7922 2069 6e20 636f 6e66 6967 7572  ery" in configur
+00005460: 6174 696f 6e5b 2271 7565 7279 225d 3a0a  ation["query"]:.
+00005470: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005480: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00005490: 2020 2020 2020 2020 2020 2020 2020 2254                "T
+000054a0: 6865 2071 7565 7279 2073 7461 7465 6d65  he query stateme
+000054b0: 6e74 206d 7573 7420 6e6f 7420 6265 2069  nt must not be i
+000054c0: 6e63 6c75 6465 6420 696e 2074 6865 2022  ncluded in the "
+000054d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000054e0: 2020 2227 636f 6e66 6967 7572 6174 696f    "'configuratio
+000054f0: 6e27 2062 6563 6175 7365 2069 7420 6973  n' because it is
+00005500: 2061 6c72 6561 6479 2070 726f 7669 6465   already provide
+00005510: 6420 6173 222c 0a20 2020 2020 2020 2020  d as",.         
+00005520: 2020 2020 2020 2022 2061 2073 6570 6172         " a separ
+00005530: 6174 6520 7061 7261 6d65 7465 722e 222c  ate parameter.",
+00005540: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00005550: 2020 2020 2020 2020 6966 2022 7573 6551          if "useQ
+00005560: 7565 7279 4361 6368 6522 2069 6e20 636f  ueryCache" in co
+00005570: 6e66 6967 7572 6174 696f 6e5b 2271 7565  nfiguration["que
+00005580: 7279 225d 3a0a 2020 2020 2020 2020 2020  ry"]:.          
+00005590: 2020 6966 2075 7365 5f63 6163 6865 2069    if use_cache i
+000055a0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000055b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000055c0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+000055d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055e0: 2020 2227 7573 6551 7565 7279 4361 6368    "'useQueryCach
+000055f0: 6527 2069 6e20 2763 6f6e 6669 6775 7261  e' in 'configura
+00005600: 7469 6f6e 2720 636f 6e66 6c69 6374 7320  tion' conflicts 
+00005610: 7769 7468 220a 2020 2020 2020 2020 2020  with".          
+00005620: 2020 2020 2020 2020 2020 2220 2775 7365            " 'use
+00005630: 5f63 6163 6865 2720 7061 7261 6d65 7465  _cache' paramete
+00005640: 722e 2050 6c65 6173 6520 7370 6563 6966  r. Please specif
+00005650: 7920 6f6e 6c79 206f 6e65 2e22 0a20 2020  y only one.".   
+00005660: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00005670: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00005680: 2020 2020 2020 2020 2063 6f6e 6669 6775           configu
+00005690: 7261 7469 6f6e 5b22 7175 6572 7922 5d5b  ration["query"][
+000056a0: 2275 7365 5175 6572 7943 6163 6865 225d  "useQueryCache"]
+000056b0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000056c0: 2020 2020 2054 7275 6520 6966 2075 7365       True if use
+000056d0: 5f63 6163 6865 2069 7320 4e6f 6e65 2065  _cache is None e
+000056e0: 6c73 6520 7573 655f 6361 6368 650a 2020  lse use_cache.  
+000056f0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00005700: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00005710: 6365 2869 6e64 6578 5f63 6f6c 2c20 7374  ce(index_col, st
+00005720: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00005730: 696e 6465 785f 636f 6c73 203d 205b 696e  index_cols = [in
+00005740: 6465 785f 636f 6c5d 0a20 2020 2020 2020  dex_col].       
+00005750: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005760: 2020 2069 6e64 6578 5f63 6f6c 7320 3d20     index_cols = 
+00005770: 6c69 7374 2869 6e64 6578 5f63 6f6c 290a  list(index_col).
+00005780: 0a20 2020 2020 2020 2064 6573 7469 6e61  .        destina
+00005790: 7469 6f6e 2c20 7175 6572 795f 6a6f 6220  tion, query_job 
+000057a0: 3d20 7365 6c66 2e5f 7175 6572 795f 746f  = self._query_to
+000057b0: 5f64 6573 7469 6e61 7469 6f6e 280a 2020  _destination(.  
+000057c0: 2020 2020 2020 2020 2020 7175 6572 792c            query,
+000057d0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+000057e0: 6578 5f63 6f6c 732c 0a20 2020 2020 2020  ex_cols,.       
+000057f0: 2020 2020 2061 7069 5f6e 616d 653d 6170       api_name=ap
+00005800: 695f 6e61 6d65 2c0a 2020 2020 2020 2020  i_name,.        
+00005810: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
+00005820: 6e3d 636f 6e66 6967 7572 6174 696f 6e2c  n=configuration,
+00005830: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00005840: 2020 2020 2320 4966 2074 6865 7265 2077      # If there w
+00005850: 6173 206e 6f20 6465 7374 696e 6174 696f  as no destinatio
+00005860: 6e20 7461 626c 652c 2074 6861 7420 6d65  n table, that me
+00005870: 616e 7320 7468 6520 7175 6572 7920 6d75  ans the query mu
+00005880: 7374 2068 6176 650a 2020 2020 2020 2020  st have.        
+00005890: 2320 6265 656e 2044 444c 206f 7220 444d  # been DDL or DM
+000058a0: 4c2e 2052 6574 7572 6e20 736f 6d65 206a  L. Return some j
+000058b0: 6f62 206d 6574 6164 6174 612c 2069 6e73  ob metadata, ins
+000058c0: 7465 6164 2e0a 2020 2020 2020 2020 6966  tead..        if
+000058d0: 206e 6f74 2064 6573 7469 6e61 7469 6f6e   not destination
+000058e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000058f0: 7475 726e 2064 6174 6166 7261 6d65 2e44  turn dataframe.D
+00005900: 6174 6146 7261 6d65 280a 2020 2020 2020  ataFrame(.      
+00005910: 2020 2020 2020 2020 2020 6461 7461 3d70            data=p
+00005920: 616e 6461 732e 4461 7461 4672 616d 6528  andas.DataFrame(
+00005930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005940: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00005950: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005960: 7374 6174 656d 656e 745f 7479 7065 223a  statement_type":
+00005970: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00005980: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+00005990: 7565 7279 5f6a 6f62 2e73 7461 7465 6d65  uery_job.stateme
+000059a0: 6e74 5f74 7970 6520 6966 2071 7565 7279  nt_type if query
+000059b0: 5f6a 6f62 2065 6c73 6520 2275 6e6b 6e6f  _job else "unkno
+000059c0: 776e 220a 2020 2020 2020 2020 2020 2020  wn".            
+000059d0: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+000059e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059f0: 2020 2020 2020 2022 6a6f 625f 6964 223a         "job_id":
+00005a00: 205b 7175 6572 795f 6a6f 622e 6a6f 625f   [query_job.job_
+00005a10: 6964 2069 6620 7175 6572 795f 6a6f 6220  id if query_job 
+00005a20: 656c 7365 2022 756e 6b6e 6f77 6e22 5d2c  else "unknown"],
+00005a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a40: 2020 2020 2020 2020 2022 6c6f 6361 7469           "locati
+00005a50: 6f6e 223a 205b 7175 6572 795f 6a6f 622e  on": [query_job.
+00005a60: 6c6f 6361 7469 6f6e 2069 6620 7175 6572  location if quer
+00005a70: 795f 6a6f 6220 656c 7365 2022 756e 6b6e  y_job else "unkn
+00005a80: 6f77 6e22 5d2c 0a20 2020 2020 2020 2020  own"],.         
+00005a90: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00005aa0: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+00005ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ac0: 7365 7373 696f 6e3d 7365 6c66 2c0a 2020  session=self,.  
+00005ad0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00005ae0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00005af0: 2e72 6561 645f 6762 715f 7461 626c 6528  .read_gbq_table(
+00005b00: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
+00005b10: 6465 7374 696e 6174 696f 6e2e 7072 6f6a  destination.proj
+00005b20: 6563 747d 2e7b 6465 7374 696e 6174 696f  ect}.{destinatio
+00005b30: 6e2e 6461 7461 7365 745f 6964 7d2e 7b64  n.dataset_id}.{d
+00005b40: 6573 7469 6e61 7469 6f6e 2e74 6162 6c65  estination.table
+00005b50: 5f69 647d 222c 0a20 2020 2020 2020 2020  _id}",.         
+00005b60: 2020 2069 6e64 6578 5f63 6f6c 3d69 6e64     index_col=ind
+00005b70: 6578 5f63 6f6c 732c 0a20 2020 2020 2020  ex_cols,.       
+00005b80: 2020 2020 2063 6f6c 756d 6e73 3d63 6f6c       columns=col
+00005b90: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
+00005ba0: 2020 6d61 785f 7265 7375 6c74 733d 6d61    max_results=ma
+00005bb0: 785f 7265 7375 6c74 732c 0a20 2020 2020  x_results,.     
+00005bc0: 2020 2020 2020 2075 7365 5f63 6163 6865         use_cache
+00005bd0: 3d63 6f6e 6669 6775 7261 7469 6f6e 5b22  =configuration["
+00005be0: 7175 6572 7922 5d5b 2275 7365 5175 6572  query"]["useQuer
+00005bf0: 7943 6163 6865 225d 2c0a 2020 2020 2020  yCache"],.      
+00005c00: 2020 290a 0a20 2020 2064 6566 2072 6561    )..    def rea
+00005c10: 645f 6762 715f 7461 626c 6528 0a20 2020  d_gbq_table(.   
+00005c20: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00005c30: 2020 2071 7565 7279 3a20 7374 722c 0a20     query: str,. 
+00005c40: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
+00005c50: 2020 696e 6465 785f 636f 6c3a 2049 7465    index_col: Ite
+00005c60: 7261 626c 655b 7374 725d 207c 2073 7472  rable[str] | str
+00005c70: 203d 2028 292c 0a20 2020 2020 2020 2063   = (),.        c
+00005c80: 6f6c 756d 6e73 3a20 4974 6572 6162 6c65  olumns: Iterable
+00005c90: 5b73 7472 5d20 3d20 2829 2c0a 2020 2020  [str] = (),.    
+00005ca0: 2020 2020 6d61 785f 7265 7375 6c74 733a      max_results:
+00005cb0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+00005cc0: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+00005cd0: 696c 7465 7273 3a20 7468 6972 645f 7061  ilters: third_pa
+00005ce0: 7274 795f 7061 6e64 6173 5f67 6271 2e46  rty_pandas_gbq.F
+00005cf0: 696c 7465 7273 5479 7065 203d 2028 292c  iltersType = (),
+00005d00: 0a20 2020 2020 2020 2075 7365 5f63 6163  .        use_cac
+00005d10: 6865 3a20 626f 6f6c 203d 2054 7275 652c  he: bool = True,
+00005d20: 0a20 2020 2020 2020 2063 6f6c 5f6f 7264  .        col_ord
+00005d30: 6572 3a20 4974 6572 6162 6c65 5b73 7472  er: Iterable[str
+00005d40: 5d20 3d20 2829 2c0a 2020 2020 2920 2d3e  ] = (),.    ) ->
+00005d50: 2064 6174 6166 7261 6d65 2e44 6174 6146   dataframe.DataF
+00005d60: 7261 6d65 3a0a 2020 2020 2020 2020 2222  rame:.        ""
+00005d70: 2254 7572 6e20 6120 4269 6751 7565 7279  "Turn a BigQuery
+00005d80: 2074 6162 6c65 2069 6e74 6f20 6120 4461   table into a Da
+00005d90: 7461 4672 616d 652e 0a0a 2020 2020 2020  taFrame...      
+00005da0: 2020 2a2a 4578 616d 706c 6573 3a2a 2a0a    **Examples:**.
+00005db0: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+00005dc0: 2069 6d70 6f72 7420 6269 6766 7261 6d65   import bigframe
+00005dd0: 732e 7061 6e64 6173 2061 7320 6270 640a  s.pandas as bpd.
+00005de0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+00005df0: 6270 642e 6f70 7469 6f6e 732e 6469 7370  bpd.options.disp
+00005e00: 6c61 792e 7072 6f67 7265 7373 5f62 6172  lay.progress_bar
+00005e10: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+00005e20: 2052 6561 6420 6120 7768 6f6c 6520 7461   Read a whole ta
+00005e30: 626c 652c 2077 6974 6820 6172 6269 7472  ble, with arbitr
+00005e40: 6172 7920 6f72 6465 7269 6e67 206f 7220  ary ordering or 
+00005e50: 6f72 6465 7269 6e67 2063 6f72 7265 7370  ordering corresp
+00005e60: 6f6e 6469 6e67 2074 6f20 7468 6520 7072  onding to the pr
+00005e70: 696d 6172 7920 6b65 7928 7329 2e0a 0a20  imary key(s)... 
+00005e80: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
+00005e90: 6620 3d20 6270 642e 7265 6164 5f67 6271  f = bpd.read_gbq
+00005ea0: 5f74 6162 6c65 2822 6269 6771 7565 7279  _table("bigquery
+00005eb0: 2d70 7562 6c69 632d 6461 7461 2e6d 6c5f  -public-data.ml_
+00005ec0: 6461 7461 7365 7473 2e70 656e 6775 696e  datasets.penguin
+00005ed0: 7322 290a 0a20 2020 2020 2020 2053 6565  s")..        See
+00005ee0: 2061 6c73 6f3a 203a 6d65 7468 3a60 5365   also: :meth:`Se
+00005ef0: 7373 696f 6e2e 7265 6164 5f67 6271 602e  ssion.read_gbq`.
+00005f00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00005f10: 2020 2020 2023 204e 4f54 453a 2054 6869       # NOTE: Thi
+00005f20: 7320 6d65 7468 6f64 2064 6f65 736e 2774  s method doesn't
+00005f30: 2028 7965 7429 2065 7869 7374 2069 6e20   (yet) exist in 
+00005f40: 7061 6e64 6173 206f 7220 7061 6e64 6173  pandas or pandas
+00005f50: 2d67 6271 2c20 736f 0a20 2020 2020 2020  -gbq, so.       
+00005f60: 2023 2074 6865 7365 2064 6f63 7374 7269   # these docstri
+00005f70: 6e67 7320 6172 6520 696e 6c69 6e65 2e0a  ngs are inline..
+00005f80: 2020 2020 2020 2020 6966 2063 6f6c 756d          if colum
+00005f90: 6e73 2061 6e64 2063 6f6c 5f6f 7264 6572  ns and col_order
+00005fa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00005fb0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fd0: 224d 7573 7420 7370 6563 6966 7920 6569  "Must specify ei
+00005fe0: 7468 6572 2063 6f6c 756d 6e73 2028 7072  ther columns (pr
+00005ff0: 6566 6572 7265 6429 206f 7220 636f 6c5f  eferred) or col_
+00006000: 6f72 6465 722c 206e 6f74 2062 6f74 6822  order, not both"
+00006010: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00006020: 2020 2020 2020 2065 6c69 6620 636f 6c5f         elif col_
+00006030: 6f72 6465 723a 0a20 2020 2020 2020 2020  order:.         
+00006040: 2020 2063 6f6c 756d 6e73 203d 2063 6f6c     columns = col
+00006050: 5f6f 7264 6572 0a0a 2020 2020 2020 2020  _order..        
+00006060: 6669 6c74 6572 7320 3d20 6c69 7374 2866  filters = list(f
+00006070: 696c 7465 7273 290a 2020 2020 2020 2020  ilters).        
+00006080: 6966 206c 656e 2866 696c 7465 7273 2920  if len(filters) 
+00006090: 213d 2030 206f 7220 5f69 735f 7461 626c  != 0 or _is_tabl
+000060a0: 655f 7769 7468 5f77 696c 6463 6172 645f  e_with_wildcard_
+000060b0: 7375 6666 6978 2871 7565 7279 293a 0a20  suffix(query):. 
+000060c0: 2020 2020 2020 2020 2020 2071 7565 7279             query
+000060d0: 203d 2073 656c 662e 5f74 6f5f 7175 6572   = self._to_quer
+000060e0: 7928 7175 6572 792c 2063 6f6c 756d 6e73  y(query, columns
+000060f0: 2c20 6669 6c74 6572 7329 0a0a 2020 2020  , filters)..    
+00006100: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00006110: 656c 662e 5f72 6561 645f 6762 715f 7175  elf._read_gbq_qu
+00006120: 6572 7928 0a20 2020 2020 2020 2020 2020  ery(.           
+00006130: 2020 2020 2071 7565 7279 2c0a 2020 2020       query,.    
+00006140: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00006150: 785f 636f 6c3d 696e 6465 785f 636f 6c2c  x_col=index_col,
+00006160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006170: 2063 6f6c 756d 6e73 3d63 6f6c 756d 6e73   columns=columns
+00006180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006190: 2020 6d61 785f 7265 7375 6c74 733d 6d61    max_results=ma
+000061a0: 785f 7265 7375 6c74 732c 0a20 2020 2020  x_results,.     
+000061b0: 2020 2020 2020 2020 2020 2061 7069 5f6e             api_n
+000061c0: 616d 653d 2272 6561 645f 6762 715f 7461  ame="read_gbq_ta
+000061d0: 626c 6522 2c0a 2020 2020 2020 2020 2020  ble",.          
+000061e0: 2020 2020 2020 7573 655f 6361 6368 653d        use_cache=
+000061f0: 7573 655f 6361 6368 652c 0a20 2020 2020  use_cache,.     
+00006200: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00006210: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00006220: 6561 645f 6762 715f 7461 626c 6528 0a20  ead_gbq_table(. 
+00006230: 2020 2020 2020 2020 2020 2071 7565 7279             query
+00006240: 3d71 7565 7279 2c0a 2020 2020 2020 2020  =query,.        
+00006250: 2020 2020 696e 6465 785f 636f 6c3d 696e      index_col=in
+00006260: 6465 785f 636f 6c2c 0a20 2020 2020 2020  dex_col,.       
+00006270: 2020 2020 2063 6f6c 756d 6e73 3d63 6f6c       columns=col
+00006280: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
+00006290: 2020 6d61 785f 7265 7375 6c74 733d 6d61    max_results=ma
+000062a0: 785f 7265 7375 6c74 732c 0a20 2020 2020  x_results,.     
+000062b0: 2020 2020 2020 2061 7069 5f6e 616d 653d         api_name=
+000062c0: 2272 6561 645f 6762 715f 7461 626c 6522  "read_gbq_table"
+000062d0: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
+000062e0: 655f 6361 6368 653d 7573 655f 6361 6368  e_cache=use_cach
+000062f0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+00006300: 2020 6465 6620 5f67 6574 5f73 6e61 7073    def _get_snaps
+00006310: 686f 745f 7371 6c5f 616e 645f 7072 696d  hot_sql_and_prim
+00006320: 6172 795f 6b65 7928 0a20 2020 2020 2020  ary_key(.       
+00006330: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
+00006340: 6162 6c65 5f72 6566 3a20 6269 6771 7565  able_ref: bigque
+00006350: 7279 2e74 6162 6c65 2e54 6162 6c65 5265  ry.table.TableRe
+00006360: 6665 7265 6e63 652c 0a20 2020 2020 2020  ference,.       
+00006370: 202a 2c0a 2020 2020 2020 2020 6170 695f   *,.        api_
+00006380: 6e61 6d65 3a20 7374 722c 0a20 2020 2020  name: str,.     
+00006390: 2020 2075 7365 5f63 6163 6865 3a20 626f     use_cache: bo
+000063a0: 6f6c 203d 2054 7275 652c 0a20 2020 2029  ol = True,.    )
+000063b0: 202d 3e20 5475 706c 655b 6962 6973 5f74   -> Tuple[ibis_t
+000063c0: 7970 6573 2e54 6162 6c65 2c20 4f70 7469  ypes.Table, Opti
+000063d0: 6f6e 616c 5b53 6571 7565 6e63 655b 7374  onal[Sequence[st
+000063e0: 725d 5d5d 3a0a 2020 2020 2020 2020 2222  r]]]:.        ""
+000063f0: 2243 7265 6174 6520 6120 7265 6164 2d6f  "Create a read-o
+00006400: 6e6c 7920 4962 6973 2074 6162 6c65 2065  nly Ibis table e
+00006410: 7870 7265 7373 696f 6e20 7265 7072 6573  xpression repres
+00006420: 656e 7469 6e67 2061 2074 6162 6c65 2e0a  enting a table..
+00006430: 0a20 2020 2020 2020 2049 6620 7765 2063  .        If we c
+00006440: 616e 2067 6574 2061 2074 6f74 616c 206f  an get a total o
+00006450: 7264 6572 696e 6720 6672 6f6d 2074 6865  rdering from the
+00006460: 2074 6162 6c65 2c20 7375 6368 2061 7320   table, such as 
+00006470: 7669 6120 7072 696d 6172 7920 6b65 790a  via primary key.
+00006480: 2020 2020 2020 2020 636f 6c75 6d6e 2873          column(s
+00006490: 292c 2074 6865 6e20 7265 7475 726e 2074  ), then return t
+000064a0: 686f 7365 2074 6f6f 2073 6f20 7468 6174  hose too so that
+000064b0: 206f 7264 6572 696e 6720 6765 6e65 7261   ordering genera
+000064c0: 7469 6f6e 2063 616e 2062 650a 2020 2020  tion can be.    
+000064d0: 2020 2020 6176 6f69 6465 642e 0a20 2020      avoided..   
+000064e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000064f0: 2023 2049 6620 7468 6572 6520 6172 6520   # If there are 
+00006500: 7072 696d 6172 7920 6b65 7973 2064 6566  primary keys def
+00006510: 696e 6564 2c20 7468 6520 7175 6572 7920  ined, the query 
+00006520: 656e 6769 6e65 2061 7373 756d 6573 2074  engine assumes t
+00006530: 6865 7365 0a20 2020 2020 2020 2023 2063  hese.        # c
+00006540: 6f6c 756d 6e73 2061 7265 2075 6e69 7175  olumns are uniqu
+00006550: 652c 2065 7665 6e20 6966 2074 6865 2063  e, even if the c
+00006560: 6f6e 7374 7261 696e 7420 6973 206e 6f74  onstraint is not
+00006570: 2065 6e66 6f72 6365 642e 2057 6520 6d61   enforced. We ma
+00006580: 6b65 0a20 2020 2020 2020 2023 2074 6865  ke.        # the
+00006590: 2073 616d 6520 6173 7375 6d70 7469 6f6e   same assumption
+000065a0: 2061 6e64 2075 7365 2074 6865 7365 2063   and use these c
+000065b0: 6f6c 756d 6e73 2061 7320 7468 6520 746f  olumns as the to
+000065c0: 7461 6c20 6f72 6465 7269 6e67 206b 6579  tal ordering key
+000065d0: 732e 0a20 2020 2020 2020 2074 6162 6c65  s..        table
+000065e0: 203d 2073 656c 662e 6271 636c 6965 6e74   = self.bqclient
+000065f0: 2e67 6574 5f74 6162 6c65 2874 6162 6c65  .get_table(table
+00006600: 5f72 6566 290a 0a20 2020 2020 2020 2069  _ref)..        i
+00006610: 6620 7461 626c 652e 6c6f 6361 7469 6f6e  f table.location
+00006620: 2e63 6173 6566 6f6c 6428 2920 213d 2073  .casefold() != s
+00006630: 656c 662e 5f6c 6f63 6174 696f 6e2e 6361  elf._location.ca
+00006640: 7365 666f 6c64 2829 3a0a 2020 2020 2020  sefold():.      
+00006650: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00006660: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00006670: 2020 2020 2020 2020 6622 4375 7272 656e          f"Curren
+00006680: 7420 7365 7373 696f 6e20 6973 2069 6e20  t session is in 
+00006690: 7b73 656c 662e 5f6c 6f63 6174 696f 6e7d  {self._location}
+000066a0: 2062 7574 2064 6174 6173 6574 2027 7b74   but dataset '{t
+000066b0: 6162 6c65 2e70 726f 6a65 6374 7d2e 7b74  able.project}.{t
+000066c0: 6162 6c65 2e64 6174 6173 6574 5f69 647d  able.dataset_id}
+000066d0: 2720 6973 206c 6f63 6174 6564 2069 6e20  ' is located in 
+000066e0: 7b74 6162 6c65 2e6c 6f63 6174 696f 6e7d  {table.location}
+000066f0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00006700: 0a20 2020 2020 2020 2023 2054 4f44 4f28  .        # TODO(
+00006710: 622f 3330 3532 3634 3135 3329 3a20 5573  b/305264153): Us
+00006720: 6520 7075 626c 6963 2070 726f 7065 7274  e public propert
+00006730: 6965 7320 746f 2066 6574 6368 2070 7269  ies to fetch pri
+00006740: 6d61 7279 206b 6579 7320 6f6e 6365 0a20  mary keys once. 
+00006750: 2020 2020 2020 2023 2061 6464 6564 2074         # added t
+00006760: 6f20 676f 6f67 6c65 2d63 6c6f 7564 2d62  o google-cloud-b
+00006770: 6967 7175 6572 792e 0a20 2020 2020 2020  igquery..       
+00006780: 2070 7269 6d61 7279 5f6b 6579 7320 3d20   primary_keys = 
+00006790: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
+000067a0: 626c 652e 5f70 726f 7065 7274 6965 732e  ble._properties.
+000067b0: 6765 7428 2274 6162 6c65 436f 6e73 7472  get("tableConstr
+000067c0: 6169 6e74 7322 2c20 7b7d 290a 2020 2020  aints", {}).    
+000067d0: 2020 2020 2020 2020 2e67 6574 2822 7072          .get("pr
+000067e0: 696d 6172 794b 6579 222c 207b 7d29 0a20  imaryKey", {}). 
+000067f0: 2020 2020 2020 2020 2020 202e 6765 7428             .get(
+00006800: 2263 6f6c 756d 6e73 2229 0a20 2020 2020  "columns").     
+00006810: 2020 2029 0a0a 2020 2020 2020 2020 6a6f     )..        jo
+00006820: 625f 636f 6e66 6967 203d 2062 6967 7175  b_config = bigqu
+00006830: 6572 792e 5175 6572 794a 6f62 436f 6e66  ery.QueryJobConf
+00006840: 6967 2829 0a20 2020 2020 2020 206a 6f62  ig().        job
+00006850: 5f63 6f6e 6669 672e 6c61 6265 6c73 5b22  _config.labels["
+00006860: 6269 6766 7261 6d65 732d 6170 6922 5d20  bigframes-api"] 
+00006870: 3d20 6170 695f 6e61 6d65 0a20 2020 2020  = api_name.     
+00006880: 2020 2069 6620 7573 655f 6361 6368 6520     if use_cache 
+00006890: 616e 6420 7461 626c 655f 7265 6620 696e  and table_ref in
+000068a0: 2073 656c 662e 5f64 665f 736e 6170 7368   self._df_snapsh
+000068b0: 6f74 2e6b 6579 7328 293a 0a20 2020 2020  ot.keys():.     
+000068c0: 2020 2020 2020 2073 6e61 7073 686f 745f         snapshot_
+000068d0: 7469 6d65 7374 616d 7020 3d20 7365 6c66  timestamp = self
+000068e0: 2e5f 6466 5f73 6e61 7073 686f 745b 7461  ._df_snapshot[ta
+000068f0: 626c 655f 7265 665d 0a0a 2020 2020 2020  ble_ref]..      
+00006900: 2020 2020 2020 2320 4361 6368 6520 6869        # Cache hi
+00006910: 7420 636f 756c 6420 6265 2075 6e65 7870  t could be unexp
+00006920: 6563 7465 642e 2053 6565 2069 6e74 6572  ected. See inter
+00006930: 6e61 6c20 6973 7375 6520 3332 3935 3435  nal issue 329545
+00006940: 3830 352e 0a20 2020 2020 2020 2020 2020  805..           
+00006950: 2023 2052 6169 7365 2061 2077 6172 6e69   # Raise a warni
+00006960: 6e67 2077 6974 6820 6d6f 7265 2069 6e66  ng with more inf
+00006970: 6f72 6d61 7469 6f6e 2061 626f 7574 2068  ormation about h
+00006980: 6f77 2074 6f20 6176 6f69 6420 7468 650a  ow to avoid the.
+00006990: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+000069a0: 6f62 6c65 6d73 2077 6974 6820 7468 6520  oblems with the 
+000069b0: 6361 6368 652e 0a20 2020 2020 2020 2020  cache..         
+000069c0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+000069d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000069e0: 2020 6622 5265 6164 696e 6720 6361 6368    f"Reading cach
+000069f0: 6564 2074 6162 6c65 2066 726f 6d20 7b73  ed table from {s
+00006a00: 6e61 7073 686f 745f 7469 6d65 7374 616d  napshot_timestam
+00006a10: 707d 2074 6f20 6176 6f69 6420 220a 2020  p} to avoid ".  
+00006a20: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+00006a30: 6e63 6f6d 7061 7469 6269 6c69 6573 2077  ncompatibilies w
+00006a40: 6974 6820 7072 6576 696f 7573 2072 6561  ith previous rea
+00006a50: 6473 206f 6620 7468 6973 2074 6162 6c65  ds of this table
+00006a60: 2e20 546f 2072 6561 6420 220a 2020 2020  . To read ".    
+00006a70: 2020 2020 2020 2020 2020 2020 2274 6865              "the
+00006a80: 206c 6174 6573 7420 7665 7273 696f 6e2c   latest version,
+00006a90: 2073 6574 2060 7573 655f 6361 6368 653d   set `use_cache=
+00006aa0: 4661 6c73 6560 206f 7220 636c 6f73 6520  False` or close 
+00006ab0: 7468 6520 220a 2020 2020 2020 2020 2020  the ".          
+00006ac0: 2020 2020 2020 2263 7572 7265 6e74 2073        "current s
+00006ad0: 6573 7369 6f6e 2077 6974 6820 5365 7373  ession with Sess
+00006ae0: 696f 6e2e 636c 6f73 6528 2920 6f72 2022  ion.close() or "
+00006af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006b00: 2022 6269 6766 7261 6d65 732e 7061 6e64   "bigframes.pand
+00006b10: 6173 2e63 6c6f 7365 5f73 6573 7369 6f6e  as.close_session
+00006b20: 2829 2e22 2c0a 2020 2020 2020 2020 2020  ().",.          
+00006b30: 2020 2020 2020 2320 5468 6572 6520 6172        # There ar
+00006b40: 6520 6d61 6e79 206c 6179 6572 7320 6265  e many layers be
+00006b50: 666f 7265 2077 6520 6765 7420 746f 2028  fore we get to (
+00006b60: 706f 7373 6962 6c79 2920 7468 6520 7573  possibly) the us
+00006b70: 6572 2773 2063 6f64 653a 0a20 2020 2020  er's code:.     
+00006b80: 2020 2020 2020 2020 2020 2023 2070 616e             # pan
+00006b90: 6461 732e 7265 6164 5f67 6271 5f74 6162  das.read_gbq_tab
+00006ba0: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+00006bb0: 2020 2023 202d 3e20 7769 7468 5f64 6566     # -> with_def
+00006bc0: 6175 6c74 5f73 6573 7369 6f6e 0a20 2020  ault_session.   
+00006bd0: 2020 2020 2020 2020 2020 2020 2023 202d               # -
+00006be0: 3e20 5365 7373 696f 6e2e 7265 6164 5f67  > Session.read_g
+00006bf0: 6271 5f74 6162 6c65 0a20 2020 2020 2020  bq_table.       
+00006c00: 2020 2020 2020 2020 2023 202d 3e20 5f72           # -> _r
+00006c10: 6561 645f 6762 715f 7461 626c 650a 2020  ead_gbq_table.  
+00006c20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00006c30: 2d3e 205f 6765 745f 736e 6170 7368 6f74  -> _get_snapshot
+00006c40: 5f73 716c 5f61 6e64 5f70 7269 6d61 7279  _sql_and_primary
+00006c50: 5f6b 6579 0a20 2020 2020 2020 2020 2020  _key.           
+00006c60: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
+00006c70: 362c 0a20 2020 2020 2020 2020 2020 2029  6,.            )
+00006c80: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00006c90: 2020 2020 2020 2020 2020 2073 6e61 7073             snaps
+00006ca0: 686f 745f 7469 6d65 7374 616d 7020 3d20  hot_timestamp = 
+00006cb0: 6c69 7374 280a 2020 2020 2020 2020 2020  list(.          
+00006cc0: 2020 2020 2020 7365 6c66 2e62 7163 6c69        self.bqcli
+00006cd0: 656e 742e 7175 6572 7928 0a20 2020 2020  ent.query(.     
+00006ce0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006cf0: 5345 4c45 4354 2043 5552 5245 4e54 5f54  SELECT CURRENT_T
+00006d00: 494d 4553 5441 4d50 2829 2041 5320 6063  IMESTAMP() AS `c
+00006d10: 7572 7265 6e74 5f74 696d 6573 7461 6d70  urrent_timestamp
+00006d20: 6022 2c0a 2020 2020 2020 2020 2020 2020  `",.            
+00006d30: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00006d40: 6967 3d6a 6f62 5f63 6f6e 6669 672c 0a20  ig=job_config,. 
+00006d50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00006d60: 2e72 6573 756c 7428 290a 2020 2020 2020  .result().      
+00006d70: 2020 2020 2020 295b 305d 5b30 5d0a 2020        )[0][0].  
+00006d80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00006d90: 6466 5f73 6e61 7073 686f 745b 7461 626c  df_snapshot[tabl
+00006da0: 655f 7265 665d 203d 2073 6e61 7073 686f  e_ref] = snapsho
+00006db0: 745f 7469 6d65 7374 616d 700a 0a20 2020  t_timestamp..   
+00006dc0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00006dd0: 2020 2020 2020 7461 626c 655f 6578 7072        table_expr
+00006de0: 6573 7369 6f6e 203d 2073 656c 662e 6962  ession = self.ib
+00006df0: 6973 5f63 6c69 656e 742e 7371 6c28 0a20  is_client.sql(. 
+00006e00: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00006e10: 6967 6672 616d 6573 5f69 6f2e 6372 6561  igframes_io.crea
+00006e20: 7465 5f73 6e61 7073 686f 745f 7371 6c28  te_snapshot_sql(
+00006e30: 7461 626c 655f 7265 662c 2073 6e61 7073  table_ref, snaps
+00006e40: 686f 745f 7469 6d65 7374 616d 7029 0a20  hot_timestamp). 
+00006e50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00006e60: 2020 2020 2065 7863 6570 7420 676f 6f67       except goog
+00006e70: 6c65 2e61 7069 5f63 6f72 652e 6578 6365  le.api_core.exce
+00006e80: 7074 696f 6e73 2e46 6f72 6269 6464 656e  ptions.Forbidden
+00006e90: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
+00006ea0: 2020 2020 6966 2022 4472 6976 6520 6372      if "Drive cr
+00006eb0: 6564 656e 7469 616c 7322 2069 6e20 6578  edentials" in ex
+00006ec0: 2e6d 6573 7361 6765 3a0a 2020 2020 2020  .message:.      
+00006ed0: 2020 2020 2020 2020 2020 6578 2e6d 6573            ex.mes
+00006ee0: 7361 6765 202b 3d20 225c 6e43 6865 636b  sage += "\nCheck
+00006ef0: 2068 7474 7073 3a2f 2f63 6c6f 7564 2e67   https://cloud.g
+00006f00: 6f6f 676c 652e 636f 6d2f 6269 6771 7565  oogle.com/bigque
+00006f10: 7279 2f64 6f63 732f 7175 6572 792d 6472  ry/docs/query-dr
+00006f20: 6976 652d 6461 7461 2347 6f6f 676c 655f  ive-data#Google_
+00006f30: 4472 6976 655f 7065 726d 6973 7369 6f6e  Drive_permission
+00006f40: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
+00006f50: 7261 6973 650a 0a20 2020 2020 2020 2072  raise..        r
+00006f60: 6574 7572 6e20 7461 626c 655f 6578 7072  eturn table_expr
+00006f70: 6573 7369 6f6e 2c20 7072 696d 6172 795f  ession, primary_
+00006f80: 6b65 7973 0a0a 2020 2020 6465 6620 5f72  keys..    def _r
+00006f90: 6561 645f 6762 715f 7461 626c 6528 0a20  ead_gbq_table(. 
+00006fa0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00006fb0: 2020 2020 2071 7565 7279 3a20 7374 722c       query: str,
+00006fc0: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
+00006fd0: 2020 2020 696e 6465 785f 636f 6c3a 2049      index_col: I
+00006fe0: 7465 7261 626c 655b 7374 725d 207c 2073  terable[str] | s
+00006ff0: 7472 203d 2028 292c 0a20 2020 2020 2020  tr = (),.       
+00007000: 2063 6f6c 756d 6e73 3a20 4974 6572 6162   columns: Iterab
+00007010: 6c65 5b73 7472 5d20 3d20 2829 2c0a 2020  le[str] = (),.  
+00007020: 2020 2020 2020 6d61 785f 7265 7375 6c74        max_result
+00007030: 733a 204f 7074 696f 6e61 6c5b 696e 745d  s: Optional[int]
+00007040: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00007050: 2061 7069 5f6e 616d 653a 2073 7472 2c0a   api_name: str,.
+00007060: 2020 2020 2020 2020 7573 655f 6361 6368          use_cach
+00007070: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
+00007080: 2020 2020 2920 2d3e 2064 6174 6166 7261      ) -> datafra
+00007090: 6d65 2e44 6174 6146 7261 6d65 3a0a 2020  me.DataFrame:.  
+000070a0: 2020 2020 2020 696d 706f 7274 2062 6967        import big
+000070b0: 6672 616d 6573 2e64 6174 6166 7261 6d65  frames.dataframe
+000070c0: 2061 7320 6461 7461 6672 616d 650a 0a20   as dataframe.. 
+000070d0: 2020 2020 2020 2069 6620 6d61 785f 7265         if max_re
+000070e0: 7375 6c74 7320 616e 6420 6d61 785f 7265  sults and max_re
+000070f0: 7375 6c74 7320 3c3d 2030 3a0a 2020 2020  sults <= 0:.    
+00007100: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00007110: 6c75 6545 7272 6f72 2822 606d 6178 5f72  lueError("`max_r
+00007120: 6573 756c 7473 6020 7368 6f75 6c64 2062  esults` should b
+00007130: 6520 6120 706f 7369 7469 7665 206e 756d  e a positive num
+00007140: 6265 722e 2229 0a0a 2020 2020 2020 2020  ber.")..        
+00007150: 7461 626c 655f 7265 6620 3d20 6269 6771  table_ref = bigq
+00007160: 7565 7279 2e74 6162 6c65 2e54 6162 6c65  uery.table.Table
+00007170: 5265 6665 7265 6e63 652e 6672 6f6d 5f73  Reference.from_s
+00007180: 7472 696e 6728 0a20 2020 2020 2020 2020  tring(.         
+00007190: 2020 2071 7565 7279 2c20 6465 6661 756c     query, defaul
+000071a0: 745f 7072 6f6a 6563 743d 7365 6c66 2e62  t_project=self.b
+000071b0: 7163 6c69 656e 742e 7072 6f6a 6563 740a  qclient.project.
+000071c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000071d0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+000071e0: 2074 6162 6c65 5f65 7870 7265 7373 696f   table_expressio
+000071f0: 6e2c 0a20 2020 2020 2020 2020 2020 2074  n,.            t
+00007200: 6f74 616c 5f6f 7264 6572 696e 675f 636f  otal_ordering_co
+00007210: 6c73 2c0a 2020 2020 2020 2020 2920 3d20  ls,.        ) = 
+00007220: 7365 6c66 2e5f 6765 745f 736e 6170 7368  self._get_snapsh
+00007230: 6f74 5f73 716c 5f61 6e64 5f70 7269 6d61  ot_sql_and_prima
+00007240: 7279 5f6b 6579 280a 2020 2020 2020 2020  ry_key(.        
+00007250: 2020 2020 7461 626c 655f 7265 662c 2061      table_ref, a
+00007260: 7069 5f6e 616d 653d 6170 695f 6e61 6d65  pi_name=api_name
+00007270: 2c20 7573 655f 6361 6368 653d 7573 655f  , use_cache=use_
+00007280: 6361 6368 650a 2020 2020 2020 2020 290a  cache.        ).
+00007290: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+000072a0: 2069 6e20 636f 6c75 6d6e 733a 0a20 2020   in columns:.   
+000072b0: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+000072c0: 6e6f 7420 696e 2074 6162 6c65 5f65 7870  not in table_exp
+000072d0: 7265 7373 696f 6e2e 636f 6c75 6d6e 733a  ression.columns:
+000072e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000072f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00007300: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00007310: 2020 2020 2020 2066 2243 6f6c 756d 6e20         f"Column 
+00007320: 277b 6b65 797d 2720 6f66 2060 636f 6c75  '{key}' of `colu
+00007330: 6d6e 7360 206e 6f74 2066 6f75 6e64 2069  mns` not found i
+00007340: 6e20 7468 6973 2074 6162 6c65 2e22 0a20  n this table.". 
+00007350: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00007360: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+00007370: 6e73 7461 6e63 6528 696e 6465 785f 636f  nstance(index_co
+00007380: 6c2c 2073 7472 293a 0a20 2020 2020 2020  l, str):.       
+00007390: 2020 2020 2069 6e64 6578 5f63 6f6c 733a       index_cols:
+000073a0: 204c 6973 745b 7374 725d 203d 205b 696e   List[str] = [in
+000073b0: 6465 785f 636f 6c5d 0a20 2020 2020 2020  dex_col].       
+000073c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000073d0: 2020 2069 6e64 6578 5f63 6f6c 7320 3d20     index_cols = 
+000073e0: 6c69 7374 2869 6e64 6578 5f63 6f6c 290a  list(index_col).
+000073f0: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+00007400: 2069 6e20 696e 6465 785f 636f 6c73 3a0a   in index_cols:.
+00007410: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00007420: 6579 206e 6f74 2069 6e20 7461 626c 655f  ey not in table_
+00007430: 6578 7072 6573 7369 6f6e 2e63 6f6c 756d  expression.colum
+00007440: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00007450: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00007460: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00007470: 2020 2020 2020 2020 2020 6622 436f 6c75            f"Colu
+00007480: 6d6e 2060 7b6b 6579 7d60 206f 6620 6069  mn `{key}` of `i
+00007490: 6e64 6578 5f63 6f6c 6020 6e6f 7420 666f  ndex_col` not fo
+000074a0: 756e 6420 696e 2074 6869 7320 7461 626c  und in this tabl
+000074b0: 652e 220a 2020 2020 2020 2020 2020 2020  e.".            
+000074c0: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
+000074d0: 6620 636f 6c75 6d6e 733a 0a20 2020 2020  f columns:.     
+000074e0: 2020 2020 2020 2074 6162 6c65 5f65 7870         table_exp
+000074f0: 7265 7373 696f 6e20 3d20 7461 626c 655f  ression = table_
+00007500: 6578 7072 6573 7369 6f6e 2e73 656c 6563  expression.selec
+00007510: 7428 5b2a 696e 6465 785f 636f 6c73 2c20  t([*index_cols, 
+00007520: 2a63 6f6c 756d 6e73 5d29 0a0a 2020 2020  *columns])..    
+00007530: 2020 2020 2320 4966 2074 6865 2069 6e64      # If the ind
+00007540: 6578 2069 7320 756e 6971 7565 2061 6e64  ex is unique and
+00007550: 2073 6f72 7461 626c 652c 2074 6865 6e20   sortable, then 
+00007560: 7765 2064 6f6e 2774 206e 6565 6420 746f  we don't need to
+00007570: 2067 656e 6572 6174 650a 2020 2020 2020   generate.      
+00007580: 2020 2320 616e 206f 7264 6572 696e 6720    # an ordering 
+00007590: 636f 6c75 6d6e 2e0a 2020 2020 2020 2020  column..        
+000075a0: 6f72 6465 7269 6e67 203d 204e 6f6e 650a  ordering = None.
+000075b0: 2020 2020 2020 2020 6966 2074 6f74 616c          if total
+000075c0: 5f6f 7264 6572 696e 675f 636f 6c73 2069  _ordering_cols i
+000075d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000075e0: 2020 2020 2020 2020 2320 4e6f 7465 3a20          # Note: 
+000075f0: 6375 7272 656e 746c 792c 2061 2074 6162  currently, a tab
+00007600: 6c65 2068 6173 2061 2074 6f74 616c 206f  le has a total o
+00007610: 7264 6572 696e 6720 6f6e 6c79 2077 6865  rdering only whe
+00007620: 6e20 7468 650a 2020 2020 2020 2020 2020  n the.          
+00007630: 2020 2320 7072 696d 6172 7920 6b65 7928    # primary key(
+00007640: 7329 2061 7265 2073 6574 206f 6e20 6120  s) are set on a 
+00007650: 7461 626c 652e 2054 6865 2071 7565 7279  table. The query
+00007660: 2065 6e67 696e 6520 6173 7375 6d65 7320   engine assumes 
+00007670: 7375 6368 0a20 2020 2020 2020 2020 2020  such.           
+00007680: 2023 2063 6f6c 756d 6e73 2061 7265 2075   # columns are u
+00007690: 6e69 7175 652c 2065 7665 6e20 6966 206e  nique, even if n
+000076a0: 6f74 2065 6e66 6f72 6365 642e 0a20 2020  ot enforced..   
+000076b0: 2020 2020 2020 2020 206f 7264 6572 696e           orderin
+000076c0: 6720 3d20 6f72 6465 722e 4578 7072 6573  g = order.Expres
+000076d0: 7369 6f6e 4f72 6465 7269 6e67 280a 2020  sionOrdering(.  
+000076e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000076f0: 6465 7269 6e67 5f76 616c 7565 5f63 6f6c  dering_value_col
+00007700: 756d 6e73 3d74 7570 6c65 280a 2020 2020  umns=tuple(.    
+00007710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007720: 6f72 6465 722e 6173 6365 6e64 696e 675f  order.ascending_
+00007730: 6f76 6572 2863 6f6c 756d 6e5f 6964 2920  over(column_id) 
+00007740: 666f 7220 636f 6c75 6d6e 5f69 6420 696e  for column_id in
+00007750: 2074 6f74 616c 5f6f 7264 6572 696e 675f   total_ordering_
+00007760: 636f 6c73 0a20 2020 2020 2020 2020 2020  cols.           
+00007770: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00007780: 2020 2020 2020 2020 746f 7461 6c5f 6f72          total_or
+00007790: 6465 7269 6e67 5f63 6f6c 756d 6e73 3d66  dering_columns=f
+000077a0: 726f 7a65 6e73 6574 2874 6f74 616c 5f6f  rozenset(total_o
+000077b0: 7264 6572 696e 675f 636f 6c73 292c 0a20  rdering_cols),. 
+000077c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000077d0: 2020 2020 2020 2020 2063 6f6c 756d 6e5f           column_
+000077e0: 7661 6c75 6573 203d 205b 7461 626c 655f  values = [table_
+000077f0: 6578 7072 6573 7369 6f6e 5b63 6f6c 5d20  expression[col] 
+00007800: 666f 7220 636f 6c20 696e 2074 6162 6c65  for col in table
+00007810: 5f65 7870 7265 7373 696f 6e2e 636f 6c75  _expression.colu
+00007820: 6d6e 735d 0a20 2020 2020 2020 2020 2020  mns].           
+00007830: 2061 7272 6179 5f76 616c 7565 203d 2063   array_value = c
+00007840: 6f72 652e 4172 7261 7956 616c 7565 2e66  ore.ArrayValue.f
+00007850: 726f 6d5f 6962 6973 280a 2020 2020 2020  rom_ibis(.      
+00007860: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00007870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007880: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
+00007890: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000078a0: 2020 636f 6c75 6d6e 733d 636f 6c75 6d6e    columns=column
+000078b0: 5f76 616c 7565 732c 0a20 2020 2020 2020  _values,.       
+000078c0: 2020 2020 2020 2020 2068 6964 6465 6e5f           hidden_
+000078d0: 6f72 6465 7269 6e67 5f63 6f6c 756d 6e73  ordering_columns
+000078e0: 3d5b 5d2c 0a20 2020 2020 2020 2020 2020  =[],.           
+000078f0: 2020 2020 206f 7264 6572 696e 673d 6f72       ordering=or
+00007900: 6465 7269 6e67 2c0a 2020 2020 2020 2020  dering,.        
+00007910: 2020 2020 290a 0a20 2020 2020 2020 2065      )..        e
+00007920: 6c69 6620 6c65 6e28 696e 6465 785f 636f  lif len(index_co
+00007930: 6c73 2920 213d 2030 3a0a 2020 2020 2020  ls) != 0:.      
+00007940: 2020 2020 2020 2320 5765 2068 6176 6520        # We have 
+00007950: 696e 6465 7820 636f 6c75 6d6e 732c 206c  index columns, l
+00007960: 6574 7320 7365 6520 6966 2074 686f 7365  ets see if those
+00007970: 2061 7265 2061 6374 7561 6c6c 7920 746f   are actually to
+00007980: 7461 6c5f 6f72 6465 725f 636f 6c75 6d6e  tal_order_column
+00007990: 730a 2020 2020 2020 2020 2020 2020 6f72  s.            or
+000079a0: 6465 7269 6e67 203d 206f 7264 6572 2e45  dering = order.E
+000079b0: 7870 7265 7373 696f 6e4f 7264 6572 696e  xpressionOrderin
+000079c0: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+000079d0: 2020 206f 7264 6572 696e 675f 7661 6c75     ordering_valu
+000079e0: 655f 636f 6c75 6d6e 733d 7475 706c 6528  e_columns=tuple(
+000079f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007a00: 2020 2020 205b 6f72 6465 722e 6173 6365       [order.asce
+00007a10: 6e64 696e 675f 6f76 6572 2863 6f6c 756d  nding_over(colum
+00007a20: 6e5f 6964 2920 666f 7220 636f 6c75 6d6e  n_id) for column
+00007a30: 5f69 6420 696e 2069 6e64 6578 5f63 6f6c  _id in index_col
+00007a40: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
+00007a50: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00007a60: 2020 2020 2020 746f 7461 6c5f 6f72 6465        total_orde
+00007a70: 7269 6e67 5f63 6f6c 756d 6e73 3d66 726f  ring_columns=fro
+00007a80: 7a65 6e73 6574 2869 6e64 6578 5f63 6f6c  zenset(index_col
+00007a90: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+00007aa0: 290a 2020 2020 2020 2020 2020 2020 6973  ).            is
+00007ab0: 5f74 6f74 616c 5f6f 7264 6572 696e 6720  _total_ordering 
+00007ac0: 3d20 7365 6c66 2e5f 6368 6563 6b5f 696e  = self._check_in
+00007ad0: 6465 785f 756e 6971 7565 6e65 7373 280a  dex_uniqueness(.
 00007ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007af0: 2068 6964 6465 6e5f 6f72 6465 7269 6e67   hidden_ordering
-00007b00: 5f63 6f6c 756d 6e73 3d5b 5d2c 0a20 2020  _columns=[],.   
-00007b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b20: 206f 7264 6572 696e 673d 6f72 6465 7269   ordering=orderi
-00007b30: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-00007b40: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00007b50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007b60: 2020 2020 2020 2020 6172 7261 795f 7661          array_va
-00007b70: 6c75 6520 3d20 7365 6c66 2e5f 6372 6561  lue = self._crea
-00007b80: 7465 5f74 6f74 616c 5f6f 7264 6572 696e  te_total_orderin
-00007b90: 6728 7461 626c 655f 6578 7072 6573 7369  g(table_expressi
-00007ba0: 6f6e 290a 2020 2020 2020 2020 656c 7365  on).        else
-00007bb0: 3a0a 2020 2020 2020 2020 2020 2020 6172  :.            ar
-00007bc0: 7261 795f 7661 6c75 6520 3d20 7365 6c66  ray_value = self
-00007bd0: 2e5f 6372 6561 7465 5f74 6f74 616c 5f6f  ._create_total_o
-00007be0: 7264 6572 696e 6728 7461 626c 655f 6578  rdering(table_ex
-00007bf0: 7072 6573 7369 6f6e 290a 0a20 2020 2020  pression)..     
-00007c00: 2020 2076 616c 7565 5f63 6f6c 756d 6e73     value_columns
-00007c10: 203d 205b 636f 6c20 666f 7220 636f 6c20   = [col for col 
-00007c20: 696e 2061 7272 6179 5f76 616c 7565 2e63  in array_value.c
-00007c30: 6f6c 756d 6e5f 6964 7320 6966 2063 6f6c  olumn_ids if col
-00007c40: 206e 6f74 2069 6e20 696e 6465 785f 636f   not in index_co
-00007c50: 6c73 5d0a 2020 2020 2020 2020 626c 6f63  ls].        bloc
-00007c60: 6b20 3d20 626c 6f63 6b73 2e42 6c6f 636b  k = blocks.Block
-00007c70: 280a 2020 2020 2020 2020 2020 2020 6172  (.            ar
-00007c80: 7261 795f 7661 6c75 652c 0a20 2020 2020  ray_value,.     
-00007c90: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-00007ca0: 756d 6e73 3d69 6e64 6578 5f63 6f6c 732c  umns=index_cols,
-00007cb0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00007cc0: 756d 6e5f 6c61 6265 6c73 3d76 616c 7565  umn_labels=value
-00007cd0: 5f63 6f6c 756d 6e73 2c0a 2020 2020 2020  _columns,.      
-00007ce0: 2020 2020 2020 696e 6465 785f 6c61 6265        index_labe
-00007cf0: 6c73 3d69 6e64 6578 5f63 6f6c 732c 0a20  ls=index_cols,. 
-00007d00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00007d10: 2069 6620 6d61 785f 7265 7375 6c74 733a   if max_results:
-00007d20: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
-00007d30: 636b 203d 2062 6c6f 636b 2e73 6c69 6365  ck = block.slice
-00007d40: 2873 746f 703d 6d61 785f 7265 7375 6c74  (stop=max_result
-00007d50: 7329 0a20 2020 2020 2020 2064 6620 3d20  s).        df = 
-00007d60: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
-00007d70: 616d 6528 626c 6f63 6b29 0a0a 2020 2020  ame(block)..    
-00007d80: 2020 2020 2320 4966 2075 7365 7220 7072      # If user pr
-00007d90: 6f76 6964 6564 2069 6e64 6578 2063 6f6c  ovided index col
-00007da0: 756d 6e73 2c20 7368 6f75 6c64 2073 6f72  umns, should sor
-00007db0: 7420 6f76 6572 2069 740a 2020 2020 2020  t over it.      
-00007dc0: 2020 6966 206c 656e 2869 6e64 6578 5f63    if len(index_c
-00007dd0: 6f6c 7329 203e 2030 3a0a 2020 2020 2020  ols) > 0:.      
-00007de0: 2020 2020 2020 6466 2e73 6f72 745f 696e        df.sort_in
-00007df0: 6465 7828 290a 2020 2020 2020 2020 7265  dex().        re
-00007e00: 7475 726e 2064 660a 0a20 2020 2064 6566  turn df..    def
-00007e10: 205f 6368 6563 6b5f 696e 6465 785f 756e   _check_index_un
-00007e20: 6971 7565 6e65 7373 280a 2020 2020 2020  iqueness(.      
-00007e30: 2020 7365 6c66 2c20 7461 626c 653a 2069    self, table: i
-00007e40: 6269 735f 7479 7065 732e 5461 626c 652c  bis_types.Table,
-00007e50: 2069 6e64 6578 5f63 6f6c 733a 204c 6973   index_cols: Lis
-00007e60: 745b 7374 725d 0a20 2020 2029 202d 3e20  t[str].    ) -> 
-00007e70: 626f 6f6c 3a0a 2020 2020 2020 2020 6469  bool:.        di
-00007e80: 7374 696e 6374 5f74 6162 6c65 203d 2074  stinct_table = t
-00007e90: 6162 6c65 2e73 656c 6563 7428 2a69 6e64  able.select(*ind
-00007ea0: 6578 5f63 6f6c 7329 2e64 6973 7469 6e63  ex_cols).distinc
-00007eb0: 7428 290a 2020 2020 2020 2020 6973 5f75  t().        is_u
-00007ec0: 6e69 7175 655f 7371 6c20 3d20 6622 2222  nique_sql = f"""
-00007ed0: 5749 5448 2066 756c 6c5f 7461 626c 6520  WITH full_table 
-00007ee0: 4153 2028 0a20 2020 2020 2020 2020 2020  AS (.           
-00007ef0: 207b 7365 6c66 2e69 6269 735f 636c 6965   {self.ibis_clie
-00007f00: 6e74 2e63 6f6d 7069 6c65 2874 6162 6c65  nt.compile(table
-00007f10: 297d 0a20 2020 2020 2020 2029 2c0a 2020  )}.        ),.  
-00007f20: 2020 2020 2020 6469 7374 696e 6374 5f74        distinct_t
-00007f30: 6162 6c65 2041 5320 280a 2020 2020 2020  able AS (.      
-00007f40: 2020 2020 2020 7b73 656c 662e 6962 6973        {self.ibis
-00007f50: 5f63 6c69 656e 742e 636f 6d70 696c 6528  _client.compile(
-00007f60: 6469 7374 696e 6374 5f74 6162 6c65 297d  distinct_table)}
-00007f70: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00007f80: 2020 2020 5345 4c45 4354 2028 5345 4c45      SELECT (SELE
-00007f90: 4354 2043 4f55 4e54 282a 2920 4652 4f4d  CT COUNT(*) FROM
-00007fa0: 2066 756c 6c5f 7461 626c 6529 2041 5320   full_table) AS 
-00007fb0: 6074 6f74 616c 5f63 6f75 6e74 602c 0a20  `total_count`,. 
-00007fc0: 2020 2020 2020 2028 5345 4c45 4354 2043         (SELECT C
-00007fd0: 4f55 4e54 282a 2920 4652 4f4d 2064 6973  OUNT(*) FROM dis
-00007fe0: 7469 6e63 745f 7461 626c 6529 2041 5320  tinct_table) AS 
-00007ff0: 6064 6973 7469 6e63 745f 636f 756e 7460  `distinct_count`
-00008000: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008010: 2020 2020 2072 6573 756c 7473 2c20 5f20       results, _ 
-00008020: 3d20 7365 6c66 2e5f 7374 6172 745f 7175  = self._start_qu
-00008030: 6572 7928 6973 5f75 6e69 7175 655f 7371  ery(is_unique_sq
-00008040: 6c29 0a20 2020 2020 2020 2072 6f77 203d  l).        row =
-00008050: 206e 6578 7428 6974 6572 2872 6573 756c   next(iter(resul
-00008060: 7473 2929 0a0a 2020 2020 2020 2020 746f  ts))..        to
-00008070: 7461 6c5f 636f 756e 7420 3d20 726f 775b  tal_count = row[
-00008080: 2274 6f74 616c 5f63 6f75 6e74 225d 0a20  "total_count"]. 
-00008090: 2020 2020 2020 2064 6973 7469 6e63 745f         distinct_
-000080a0: 636f 756e 7420 3d20 726f 775b 2264 6973  count = row["dis
-000080b0: 7469 6e63 745f 636f 756e 7422 5d0a 2020  tinct_count"].  
-000080c0: 2020 2020 2020 7265 7475 726e 2074 6f74        return tot
-000080d0: 616c 5f63 6f75 6e74 203d 3d20 6469 7374  al_count == dist
-000080e0: 696e 6374 5f63 6f75 6e74 0a0a 2020 2020  inct_count..    
-000080f0: 6465 6620 5f72 6561 645f 6269 6771 7565  def _read_bigque
-00008100: 7279 5f6c 6f61 645f 6a6f 6228 0a20 2020  ry_load_job(.   
-00008110: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00008120: 2020 2066 696c 6570 6174 685f 6f72 5f62     filepath_or_b
-00008130: 7566 6665 723a 2073 7472 207c 2049 4f5b  uffer: str | IO[
-00008140: 2262 7974 6573 225d 2c0a 2020 2020 2020  "bytes"],.      
-00008150: 2020 7461 626c 653a 2055 6e69 6f6e 5b62    table: Union[b
-00008160: 6967 7175 6572 792e 5461 626c 652c 2062  igquery.Table, b
-00008170: 6967 7175 6572 792e 5461 626c 6552 6566  igquery.TableRef
-00008180: 6572 656e 6365 5d2c 0a20 2020 2020 2020  erence],.       
-00008190: 202a 2c0a 2020 2020 2020 2020 6a6f 625f   *,.        job_
-000081a0: 636f 6e66 6967 3a20 6269 6771 7565 7279  config: bigquery
-000081b0: 2e4c 6f61 644a 6f62 436f 6e66 6967 2c0a  .LoadJobConfig,.
-000081c0: 2020 2020 2020 2020 696e 6465 785f 636f          index_co
-000081d0: 6c3a 2049 7465 7261 626c 655b 7374 725d  l: Iterable[str]
-000081e0: 207c 2073 7472 203d 2028 292c 0a20 2020   | str = (),.   
-000081f0: 2020 2020 2063 6f6c 756d 6e73 3a20 4974       columns: It
-00008200: 6572 6162 6c65 5b73 7472 5d20 3d20 2829  erable[str] = ()
-00008210: 2c0a 2020 2020 2920 2d3e 2064 6174 6166  ,.    ) -> dataf
-00008220: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
-00008230: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00008240: 7461 6e63 6528 696e 6465 785f 636f 6c2c  tance(index_col,
-00008250: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-00008260: 2020 2069 6e64 6578 5f63 6f6c 7320 3d20     index_cols = 
-00008270: 5b69 6e64 6578 5f63 6f6c 5d0a 2020 2020  [index_col].    
-00008280: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008290: 2020 2020 2020 696e 6465 785f 636f 6c73        index_cols
-000082a0: 203d 206c 6973 7428 696e 6465 785f 636f   = list(index_co
-000082b0: 6c29 0a0a 2020 2020 2020 2020 6966 206e  l)..        if n
-000082c0: 6f74 206a 6f62 5f63 6f6e 6669 672e 636c  ot job_config.cl
-000082d0: 7573 7465 7269 6e67 5f66 6965 6c64 7320  ustering_fields 
-000082e0: 616e 6420 696e 6465 785f 636f 6c73 3a0a  and index_cols:.
-000082f0: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
-00008300: 636f 6e66 6967 2e63 6c75 7374 6572 696e  config.clusterin
-00008310: 675f 6669 656c 6473 203d 2069 6e64 6578  g_fields = index
-00008320: 5f63 6f6c 735b 3a5f 4d41 585f 434c 5553  _cols[:_MAX_CLUS
-00008330: 5445 525f 434f 4c55 4d4e 535d 0a0a 2020  TER_COLUMNS]..  
-00008340: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00008350: 6e63 6528 6669 6c65 7061 7468 5f6f 725f  nce(filepath_or_
-00008360: 6275 6666 6572 2c20 7374 7229 3a0a 2020  buffer, str):.  
-00008370: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00008380: 6570 6174 685f 6f72 5f62 7566 6665 722e  epath_or_buffer.
-00008390: 7374 6172 7473 7769 7468 2822 6773 3a2f  startswith("gs:/
-000083a0: 2f22 293a 0a20 2020 2020 2020 2020 2020  /"):.           
-000083b0: 2020 2020 206c 6f61 645f 6a6f 6220 3d20       load_job = 
-000083c0: 7365 6c66 2e62 7163 6c69 656e 742e 6c6f  self.bqclient.lo
-000083d0: 6164 5f74 6162 6c65 5f66 726f 6d5f 7572  ad_table_from_ur
-000083e0: 6928 0a20 2020 2020 2020 2020 2020 2020  i(.             
-000083f0: 2020 2020 2020 2066 696c 6570 6174 685f         filepath_
-00008400: 6f72 5f62 7566 6665 722c 2074 6162 6c65  or_buffer, table
-00008410: 2c20 6a6f 625f 636f 6e66 6967 3d6a 6f62  , job_config=job
-00008420: 5f63 6f6e 6669 670a 2020 2020 2020 2020  _config.        
-00008430: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00008440: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008450: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00008460: 206f 7065 6e28 6669 6c65 7061 7468 5f6f   open(filepath_o
-00008470: 725f 6275 6666 6572 2c20 2272 6222 2920  r_buffer, "rb") 
-00008480: 6173 2073 6f75 7263 655f 6669 6c65 3a0a  as source_file:.
-00008490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084a0: 2020 2020 6c6f 6164 5f6a 6f62 203d 2073      load_job = s
-000084b0: 656c 662e 6271 636c 6965 6e74 2e6c 6f61  elf.bqclient.loa
-000084c0: 645f 7461 626c 655f 6672 6f6d 5f66 696c  d_table_from_fil
-000084d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000084e0: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-000084f0: 655f 6669 6c65 2c20 7461 626c 652c 206a  e_file, table, j
-00008500: 6f62 5f63 6f6e 6669 673d 6a6f 625f 636f  ob_config=job_co
-00008510: 6e66 6967 0a20 2020 2020 2020 2020 2020  nfig.           
-00008520: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00008530: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00008540: 2020 2020 206c 6f61 645f 6a6f 6220 3d20       load_job = 
-00008550: 7365 6c66 2e62 7163 6c69 656e 742e 6c6f  self.bqclient.lo
-00008560: 6164 5f74 6162 6c65 5f66 726f 6d5f 6669  ad_table_from_fi
-00008570: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00008580: 2020 2020 6669 6c65 7061 7468 5f6f 725f      filepath_or_
-00008590: 6275 6666 6572 2c20 7461 626c 652c 206a  buffer, table, j
-000085a0: 6f62 5f63 6f6e 6669 673d 6a6f 625f 636f  ob_config=job_co
-000085b0: 6e66 6967 0a20 2020 2020 2020 2020 2020  nfig.           
-000085c0: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-000085d0: 2e5f 7374 6172 745f 6765 6e65 7269 635f  ._start_generic_
-000085e0: 6a6f 6228 6c6f 6164 5f6a 6f62 290a 2020  job(load_job).  
-000085f0: 2020 2020 2020 7461 626c 655f 6964 203d        table_id =
-00008600: 2066 227b 7461 626c 652e 7072 6f6a 6563   f"{table.projec
-00008610: 747d 2e7b 7461 626c 652e 6461 7461 7365  t}.{table.datase
-00008620: 745f 6964 7d2e 7b74 6162 6c65 2e74 6162  t_id}.{table.tab
-00008630: 6c65 5f69 647d 220a 0a20 2020 2020 2020  le_id}"..       
-00008640: 2023 2055 7064 6174 6520 7468 6520 7461   # Update the ta
-00008650: 626c 6520 6578 7069 7261 7469 6f6e 2073  ble expiration s
-00008660: 6f20 7765 2061 7265 6e27 7420 6c69 6d69  o we aren't limi
-00008670: 7465 6420 746f 2074 6865 2064 6566 6175  ted to the defau
-00008680: 6c74 2032 340a 2020 2020 2020 2020 2320  lt 24.        # 
-00008690: 686f 7572 7320 6f66 2074 6865 2061 6e6f  hours of the ano
-000086a0: 6e79 6d6f 7573 2064 6174 6173 6574 2e0a  nymous dataset..
-000086b0: 2020 2020 2020 2020 7461 626c 655f 6578          table_ex
-000086c0: 7069 7261 7469 6f6e 203d 2062 6967 7175  piration = bigqu
-000086d0: 6572 792e 5461 626c 6528 7461 626c 655f  ery.Table(table_
-000086e0: 6964 290a 2020 2020 2020 2020 7461 626c  id).        tabl
-000086f0: 655f 6578 7069 7261 7469 6f6e 2e65 7870  e_expiration.exp
-00008700: 6972 6573 203d 2028 0a20 2020 2020 2020  ires = (.       
-00008710: 2020 2020 2064 6174 6574 696d 652e 6461       datetime.da
-00008720: 7465 7469 6d65 2e6e 6f77 2864 6174 6574  tetime.now(datet
-00008730: 696d 652e 7469 6d65 7a6f 6e65 2e75 7463  ime.timezone.utc
-00008740: 2920 2b20 636f 6e73 7461 6e74 732e 4445  ) + constants.DE
-00008750: 4641 554c 545f 4558 5049 5241 5449 4f4e  FAULT_EXPIRATION
-00008760: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00008770: 2020 2073 656c 662e 6271 636c 6965 6e74     self.bqclient
-00008780: 2e75 7064 6174 655f 7461 626c 6528 7461  .update_table(ta
-00008790: 626c 655f 6578 7069 7261 7469 6f6e 2c20  ble_expiration, 
-000087a0: 5b22 6578 7069 7265 7322 5d29 0a0a 2020  ["expires"])..  
-000087b0: 2020 2020 2020 2320 5468 6520 4269 6751        # The BigQ
-000087c0: 7565 7279 2052 4553 5420 4150 4920 666f  uery REST API fo
-000087d0: 7220 7461 626c 6573 2e67 6574 2064 6f65  r tables.get doe
-000087e0: 736e 2774 2074 616b 6520 6120 7365 7373  sn't take a sess
-000087f0: 696f 6e20 4944 2c20 736f 2077 650a 2020  ion ID, so we.  
-00008800: 2020 2020 2020 2320 6361 6e27 7420 6765        # can't ge
-00008810: 7420 7468 6520 7363 6865 6d61 2066 6f72  t the schema for
-00008820: 2061 2074 656d 7020 7461 626c 6520 7468   a temp table th
-00008830: 6174 2077 6179 2e0a 2020 2020 2020 2020  at way..        
-00008840: 7265 7475 726e 2073 656c 662e 7265 6164  return self.read
-00008850: 5f67 6271 5f74 6162 6c65 280a 2020 2020  _gbq_table(.    
-00008860: 2020 2020 2020 2020 7461 626c 655f 6964          table_id
-00008870: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-00008880: 6465 785f 636f 6c3d 696e 6465 785f 636f  dex_col=index_co
-00008890: 6c2c 0a20 2020 2020 2020 2020 2020 2063  l,.            c
-000088a0: 6f6c 756d 6e73 3d63 6f6c 756d 6e73 2c0a  olumns=columns,.
-000088b0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000088c0: 6566 2072 6561 645f 6762 715f 6d6f 6465  ef read_gbq_mode
-000088d0: 6c28 7365 6c66 2c20 6d6f 6465 6c5f 6e61  l(self, model_na
-000088e0: 6d65 3a20 7374 7229 3a0a 2020 2020 2020  me: str):.      
-000088f0: 2020 2222 224c 6f61 6473 2061 2042 6967    """Loads a Big
-00008900: 5175 6572 7920 4d4c 206d 6f64 656c 2066  Query ML model f
-00008910: 726f 6d20 4269 6751 7565 7279 2e0a 0a20  rom BigQuery... 
-00008920: 2020 2020 2020 202a 2a45 7861 6d70 6c65         **Example
-00008930: 733a 2a2a 0a0a 2020 2020 2020 2020 2020  s:**..          
-00008940: 2020 3e3e 3e20 696d 706f 7274 2062 6967    >>> import big
-00008950: 6672 616d 6573 2e70 616e 6461 7320 6173  frames.pandas as
-00008960: 2062 7064 0a20 2020 2020 2020 2020 2020   bpd.           
-00008970: 203e 3e3e 2062 7064 2e6f 7074 696f 6e73   >>> bpd.options
-00008980: 2e64 6973 706c 6179 2e70 726f 6772 6573  .display.progres
-00008990: 735f 6261 7220 3d20 4e6f 6e65 0a0a 2020  s_bar = None..  
-000089a0: 2020 2020 2020 5265 6164 2061 6e20 6578        Read an ex
-000089b0: 6973 7469 6e67 2042 6967 5175 6572 7920  isting BigQuery 
-000089c0: 4d4c 206d 6f64 656c 2e0a 0a20 2020 2020  ML model...     
-000089d0: 2020 2020 2020 203e 3e3e 206d 6f64 656c         >>> model
-000089e0: 5f6e 616d 6520 3d20 2262 6967 6672 616d  _name = "bigfram
-000089f0: 6573 2d64 6576 2e62 716d 6c5f 7475 746f  es-dev.bqml_tuto
-00008a00: 7269 616c 2e70 656e 6775 696e 735f 6d6f  rial.penguins_mo
-00008a10: 6465 6c22 0a20 2020 2020 2020 2020 2020  del".           
-00008a20: 203e 3e3e 206d 6f64 656c 203d 2062 7064   >>> model = bpd
-00008a30: 2e72 6561 645f 6762 715f 6d6f 6465 6c28  .read_gbq_model(
-00008a40: 6d6f 6465 6c5f 6e61 6d65 290a 0a20 2020  model_name)..   
-00008a50: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00008a60: 2020 2020 2020 206d 6f64 656c 5f6e 616d         model_nam
-00008a70: 6520 2873 7472 293a 0a20 2020 2020 2020  e (str):.       
-00008a80: 2020 2020 2020 2020 2074 6865 206d 6f64           the mod
-00008a90: 656c 2773 206e 616d 6520 696e 2042 6967  el's name in Big
-00008aa0: 5175 6572 7920 696e 2074 6865 2066 6f72  Query in the for
-00008ab0: 6d61 740a 2020 2020 2020 2020 2020 2020  mat.            
-00008ac0: 2020 2020 6070 726f 6a65 6374 5f69 642e      `project_id.
-00008ad0: 6461 7461 7365 745f 6964 2e6d 6f64 656c  dataset_id.model
-00008ae0: 5f69 6460 2c20 6f72 206a 7573 7420 6064  _id`, or just `d
-00008af0: 6174 6173 6574 5f69 642e 6d6f 6465 6c5f  ataset_id.model_
-00008b00: 6964 600a 2020 2020 2020 2020 2020 2020  id`.            
-00008b10: 2020 2020 746f 206c 6f61 6420 6672 6f6d      to load from
-00008b20: 2074 6865 2064 6566 6175 6c74 2070 726f   the default pro
-00008b30: 6a65 6374 2e0a 0a20 2020 2020 2020 2052  ject...        R
-00008b40: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00008b50: 2020 2020 4120 6269 6766 7261 6d65 732e      A bigframes.
-00008b60: 6d6c 204d 6f64 656c 2077 7261 7070 696e  ml Model wrappin
-00008b70: 6720 7468 6520 6d6f 6465 6c2e 0a20 2020  g the model..   
-00008b80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00008b90: 2069 6d70 6f72 7420 6269 6766 7261 6d65   import bigframe
-00008ba0: 732e 6d6c 2e6c 6f61 6465 720a 0a20 2020  s.ml.loader..   
-00008bb0: 2020 2020 206d 6f64 656c 5f72 6566 203d       model_ref =
-00008bc0: 2062 6967 7175 6572 792e 4d6f 6465 6c52   bigquery.ModelR
-00008bd0: 6566 6572 656e 6365 2e66 726f 6d5f 7374  eference.from_st
-00008be0: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
-00008bf0: 2020 6d6f 6465 6c5f 6e61 6d65 2c20 6465    model_name, de
-00008c00: 6661 756c 745f 7072 6f6a 6563 743d 7365  fault_project=se
-00008c10: 6c66 2e62 7163 6c69 656e 742e 7072 6f6a  lf.bqclient.proj
-00008c20: 6563 740a 2020 2020 2020 2020 290a 2020  ect.        ).  
-00008c30: 2020 2020 2020 6d6f 6465 6c20 3d20 7365        model = se
-00008c40: 6c66 2e62 7163 6c69 656e 742e 6765 745f  lf.bqclient.get_
-00008c50: 6d6f 6465 6c28 6d6f 6465 6c5f 7265 6629  model(model_ref)
-00008c60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00008c70: 6269 6766 7261 6d65 732e 6d6c 2e6c 6f61  bigframes.ml.loa
-00008c80: 6465 722e 6672 6f6d 5f62 7128 7365 6c66  der.from_bq(self
-00008c90: 2c20 6d6f 6465 6c29 0a0a 2020 2020 6465  , model)..    de
-00008ca0: 6620 7265 6164 5f70 616e 6461 7328 7365  f read_pandas(se
-00008cb0: 6c66 2c20 7061 6e64 6173 5f64 6174 6166  lf, pandas_dataf
-00008cc0: 7261 6d65 3a20 7061 6e64 6173 2e44 6174  rame: pandas.Dat
-00008cd0: 6146 7261 6d65 2920 2d3e 2064 6174 6166  aFrame) -> dataf
-00008ce0: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
-00008cf0: 2020 2020 2020 2020 2222 224c 6f61 6473          """Loads
-00008d00: 2044 6174 6146 7261 6d65 2066 726f 6d20   DataFrame from 
-00008d10: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
-00008d20: 6d65 2e0a 0a20 2020 2020 2020 2054 6865  me...        The
-00008d30: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-00008d40: 6520 7769 6c6c 2062 6520 7065 7273 6973  e will be persis
-00008d50: 7465 6420 6173 2061 2074 656d 706f 7261  ted as a tempora
-00008d60: 7279 2042 6967 5175 6572 7920 7461 626c  ry BigQuery tabl
-00008d70: 652c 2077 6869 6368 2063 616e 2062 650a  e, which can be.
-00008d80: 2020 2020 2020 2020 6175 746f 6d61 7469          automati
-00008d90: 6361 6c6c 7920 7265 6379 636c 6564 2061  cally recycled a
-00008da0: 6674 6572 2074 6865 2053 6573 7369 6f6e  fter the Session
-00008db0: 2069 7320 636c 6f73 6564 2e0a 0a20 2020   is closed...   
-00008dc0: 2020 2020 202a 2a45 7861 6d70 6c65 733a       **Examples:
-00008dd0: 2a2a 0a0a 2020 2020 2020 2020 2020 2020  **..            
-00008de0: 3e3e 3e20 696d 706f 7274 2062 6967 6672  >>> import bigfr
-00008df0: 616d 6573 2e70 616e 6461 7320 6173 2062  ames.pandas as b
-00008e00: 7064 0a20 2020 2020 2020 2020 2020 203e  pd.            >
-00008e10: 3e3e 2069 6d70 6f72 7420 7061 6e64 6173  >> import pandas
-00008e20: 2061 7320 7064 0a20 2020 2020 2020 2020   as pd.         
-00008e30: 2020 203e 3e3e 2062 7064 2e6f 7074 696f     >>> bpd.optio
-00008e40: 6e73 2e64 6973 706c 6179 2e70 726f 6772  ns.display.progr
-00008e50: 6573 735f 6261 7220 3d20 4e6f 6e65 0a0a  ess_bar = None..
-00008e60: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-00008e70: 6420 3d20 7b27 636f 6c31 273a 205b 312c  d = {'col1': [1,
-00008e80: 2032 5d2c 2027 636f 6c32 273a 205b 332c   2], 'col2': [3,
-00008e90: 2034 5d7d 0a20 2020 2020 2020 2020 2020   4]}.           
-00008ea0: 203e 3e3e 2070 616e 6461 735f 6466 203d   >>> pandas_df =
-00008eb0: 2070 642e 4461 7461 4672 616d 6528 6461   pd.DataFrame(da
-00008ec0: 7461 3d64 290a 2020 2020 2020 2020 2020  ta=d).          
-00008ed0: 2020 3e3e 3e20 6466 203d 2062 7064 2e72    >>> df = bpd.r
-00008ee0: 6561 645f 7061 6e64 6173 2870 616e 6461  ead_pandas(panda
-00008ef0: 735f 6466 290a 2020 2020 2020 2020 2020  s_df).          
-00008f00: 2020 3e3e 3e20 6466 0a20 2020 2020 2020    >>> df.       
-00008f10: 2020 2020 2020 2020 636f 6c31 2020 636f          col1  co
-00008f20: 6c32 0a20 2020 2020 2020 2020 2020 2030  l2.            0
-00008f30: 2020 2020 2031 2020 2020 2033 0a20 2020       1     3.   
-00008f40: 2020 2020 2020 2020 2031 2020 2020 2032           1     2
-00008f50: 2020 2020 2034 0a20 2020 2020 2020 2020       4.         
-00008f60: 2020 203c 424c 414e 4b4c 494e 453e 0a20     <BLANKLINE>. 
-00008f70: 2020 2020 2020 2020 2020 205b 3220 726f             [2 ro
-00008f80: 7773 2078 2032 2063 6f6c 756d 6e73 5d0a  ws x 2 columns].
-00008f90: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-00008fa0: 2020 2020 2020 2020 2020 2070 616e 6461             panda
-00008fb0: 735f 6461 7461 6672 616d 6520 2870 616e  s_dataframe (pan
-00008fc0: 6461 732e 4461 7461 4672 616d 6529 3a0a  das.DataFrame):.
-00008fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fe0: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
-00008ff0: 6d65 206f 626a 6563 7420 746f 2062 6520  me object to be 
-00009000: 6c6f 6164 6564 2e0a 0a20 2020 2020 2020  loaded...       
-00009010: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-00009020: 2020 2020 2020 6269 6766 7261 6d65 732e        bigframes.
-00009030: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
-00009040: 616d 653a 2054 6865 2042 6967 5175 6572  ame: The BigQuer
-00009050: 7920 4461 7461 4672 616d 652e 0a20 2020  y DataFrame..   
-00009060: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00009070: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-00009080: 6164 5f70 616e 6461 7328 7061 6e64 6173  ad_pandas(pandas
-00009090: 5f64 6174 6166 7261 6d65 2c20 2272 6561  _dataframe, "rea
-000090a0: 645f 7061 6e64 6173 2229 0a0a 2020 2020  d_pandas")..    
-000090b0: 6465 6620 5f72 6561 645f 7061 6e64 6173  def _read_pandas
-000090c0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-000090d0: 7061 6e64 6173 5f64 6174 6166 7261 6d65  pandas_dataframe
-000090e0: 3a20 7061 6e64 6173 2e44 6174 6146 7261  : pandas.DataFra
-000090f0: 6d65 2c20 6170 695f 6e61 6d65 3a20 7374  me, api_name: st
-00009100: 720a 2020 2020 2920 2d3e 2064 6174 6166  r.    ) -> dataf
-00009110: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
-00009120: 2020 2020 2020 2020 696d 706f 7274 2062          import b
-00009130: 6967 6672 616d 6573 2e64 6174 6166 7261  igframes.datafra
-00009140: 6d65 2061 7320 6461 7461 6672 616d 650a  me as dataframe.
-00009150: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00009160: 7374 616e 6365 2870 616e 6461 735f 6461  stance(pandas_da
-00009170: 7461 6672 616d 652c 2064 6174 6166 7261  taframe, datafra
-00009180: 6d65 2e44 6174 6146 7261 6d65 293a 0a20  me.DataFrame):. 
-00009190: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000091a0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-000091b0: 2020 2020 2020 2020 2020 2020 2022 7265               "re
-000091c0: 6164 5f70 616e 6461 7328 2920 6578 7065  ad_pandas() expe
-000091d0: 6374 7320 6120 7061 6e64 6173 2e44 6174  cts a pandas.Dat
-000091e0: 6146 7261 6d65 2c20 6275 7420 676f 7420  aFrame, but got 
-000091f0: 6120 220a 2020 2020 2020 2020 2020 2020  a ".            
-00009200: 2020 2020 2262 6967 6672 616d 6573 2e70      "bigframes.p
-00009210: 616e 6461 732e 4461 7461 4672 616d 652e  andas.DataFrame.
-00009220: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00009230: 0a20 2020 2020 2020 2069 6e6c 696e 655f  .        inline_
-00009240: 6466 203d 2073 656c 662e 5f72 6561 645f  df = self._read_
-00009250: 7061 6e64 6173 5f69 6e6c 696e 6528 7061  pandas_inline(pa
-00009260: 6e64 6173 5f64 6174 6166 7261 6d65 290a  ndas_dataframe).
-00009270: 2020 2020 2020 2020 6966 2069 6e6c 696e          if inlin
-00009280: 655f 6466 2069 7320 6e6f 7420 4e6f 6e65  e_df is not None
-00009290: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000092a0: 7475 726e 2069 6e6c 696e 655f 6466 0a20  turn inline_df. 
-000092b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000092c0: 6c66 2e5f 7265 6164 5f70 616e 6461 735f  lf._read_pandas_
-000092d0: 6c6f 6164 5f6a 6f62 2870 616e 6461 735f  load_job(pandas_
-000092e0: 6461 7461 6672 616d 652c 2061 7069 5f6e  dataframe, api_n
-000092f0: 616d 6529 0a0a 2020 2020 6465 6620 5f72  ame)..    def _r
-00009300: 6561 645f 7061 6e64 6173 5f69 6e6c 696e  ead_pandas_inlin
-00009310: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-00009320: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
-00009330: 653a 2070 616e 6461 732e 4461 7461 4672  e: pandas.DataFr
-00009340: 616d 650a 2020 2020 2920 2d3e 204f 7074  ame.    ) -> Opt
-00009350: 696f 6e61 6c5b 6461 7461 6672 616d 652e  ional[dataframe.
-00009360: 4461 7461 4672 616d 655d 3a0a 2020 2020  DataFrame]:.    
-00009370: 2020 2020 696d 706f 7274 2062 6967 6672      import bigfr
-00009380: 616d 6573 2e64 6174 6166 7261 6d65 2061  ames.dataframe a
-00009390: 7320 6461 7461 6672 616d 650a 0a20 2020  s dataframe..   
-000093a0: 2020 2020 2069 6620 7061 6e64 6173 5f64       if pandas_d
-000093b0: 6174 6166 7261 6d65 2e73 697a 6520 3e20  ataframe.size > 
-000093c0: 4d41 585f 494e 4c49 4e45 5f44 465f 5349  MAX_INLINE_DF_SI
-000093d0: 5a45 3a0a 2020 2020 2020 2020 2020 2020  ZE:.            
-000093e0: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-000093f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00009400: 2020 2020 2020 696e 6c69 6e65 5f64 6620        inline_df 
-00009410: 3d20 6461 7461 6672 616d 652e 4461 7461  = dataframe.Data
-00009420: 4672 616d 6528 0a20 2020 2020 2020 2020  Frame(.         
-00009430: 2020 2020 2020 2062 6c6f 636b 732e 426c         blocks.Bl
-00009440: 6f63 6b2e 6672 6f6d 5f6c 6f63 616c 2870  ock.from_local(p
-00009450: 616e 6461 735f 6461 7461 6672 616d 652c  andas_dataframe,
-00009460: 2073 656c 6629 0a20 2020 2020 2020 2020   self).         
-00009470: 2020 2029 0a20 2020 2020 2020 2065 7863     ).        exc
-00009480: 6570 7420 5661 6c75 6545 7272 6f72 3a20  ept ValueError: 
-00009490: 2023 2054 6872 6f77 6e20 6279 2069 6269   # Thrown by ibi
-000094a0: 7320 666f 7220 736f 6d65 2075 6e68 616e  s for some unhan
-000094b0: 646c 6564 2074 7970 6573 0a20 2020 2020  dled types.     
-000094c0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000094d0: 6e65 0a20 2020 2020 2020 2065 7863 6570  ne.        excep
-000094e0: 7420 7061 2e41 7272 6f77 5479 7065 4572  t pa.ArrowTypeEr
-000094f0: 726f 723a 2020 2320 5468 726f 776e 2062  ror:  # Thrown b
-00009500: 7920 6172 726f 7720 666f 7220 7479 7065  y arrow for type
-00009510: 7320 7769 7468 6f75 7420 6d61 7070 696e  s without mappin
-00009520: 6720 2867 656f 292e 0a20 2020 2020 2020  g (geo)..       
-00009530: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00009540: 0a0a 2020 2020 2020 2020 696e 6c69 6e65  ..        inline
-00009550: 5f74 7970 6573 203d 2069 6e6c 696e 655f  _types = inline_
-00009560: 6466 2e5f 626c 6f63 6b2e 6578 7072 2e73  df._block.expr.s
-00009570: 6368 656d 612e 6474 7970 6573 0a20 2020  chema.dtypes.   
-00009580: 2020 2020 2023 2049 6269 7320 6861 7320       # Ibis has 
-00009590: 7072 6f62 6c65 6d73 2065 7363 6170 696e  problems escapin
-000095a0: 6720 6279 7465 7320 6c69 7465 7261 6c73  g bytes literals
-000095b0: 2c20 7768 6963 6820 7769 6c6c 2063 6175  , which will cau
-000095c0: 7365 2073 796e 7461 7820 6572 726f 7273  se syntax errors
-000095d0: 2073 6572 7665 722d 7369 6465 2e0a 2020   server-side..  
-000095e0: 2020 2020 2020 6966 2061 6c6c 2864 7479        if all(dty
-000095f0: 7065 2069 6e20 494e 4c49 4e41 424c 455f  pe in INLINABLE_
-00009600: 4454 5950 4553 2066 6f72 2064 7479 7065  DTYPES for dtype
-00009610: 2069 6e20 696e 6c69 6e65 5f74 7970 6573   in inline_types
-00009620: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00009630: 6574 7572 6e20 696e 6c69 6e65 5f64 660a  eturn inline_df.
-00009640: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00009650: 6f6e 650a 0a20 2020 2064 6566 205f 7265  one..    def _re
-00009660: 6164 5f70 616e 6461 735f 6c6f 6164 5f6a  ad_pandas_load_j
-00009670: 6f62 280a 2020 2020 2020 2020 7365 6c66  ob(.        self
-00009680: 2c20 7061 6e64 6173 5f64 6174 6166 7261  , pandas_datafra
-00009690: 6d65 3a20 7061 6e64 6173 2e44 6174 6146  me: pandas.DataF
-000096a0: 7261 6d65 2c20 6170 695f 6e61 6d65 3a20  rame, api_name: 
-000096b0: 7374 720a 2020 2020 2920 2d3e 2064 6174  str.    ) -> dat
-000096c0: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
-000096d0: 3a0a 2020 2020 2020 2020 696d 706f 7274  :.        import
-000096e0: 2062 6967 6672 616d 6573 2e64 6174 6166   bigframes.dataf
-000096f0: 7261 6d65 2061 7320 6461 7461 6672 616d  rame as datafram
-00009700: 650a 0a20 2020 2020 2020 2063 6f6c 5f69  e..        col_i
-00009710: 6e64 6578 203d 2070 616e 6461 735f 6461  ndex = pandas_da
-00009720: 7461 6672 616d 652e 636f 6c75 6d6e 732e  taframe.columns.
-00009730: 636f 7079 2829 0a20 2020 2020 2020 2063  copy().        c
-00009740: 6f6c 5f6c 6162 656c 732c 2069 6478 5f6c  ol_labels, idx_l
-00009750: 6162 656c 7320 3d20 280a 2020 2020 2020  abels = (.      
-00009760: 2020 2020 2020 636f 6c5f 696e 6465 782e        col_index.
-00009770: 746f 5f6c 6973 7428 292c 0a20 2020 2020  to_list(),.     
-00009780: 2020 2020 2020 2070 616e 6461 735f 6461         pandas_da
-00009790: 7461 6672 616d 652e 696e 6465 782e 6e61  taframe.index.na
-000097a0: 6d65 732c 0a20 2020 2020 2020 2029 0a20  mes,.        ). 
-000097b0: 2020 2020 2020 206e 6577 5f63 6f6c 5f69         new_col_i
-000097c0: 6473 2c20 6e65 775f 6964 785f 6964 7320  ds, new_idx_ids 
-000097d0: 3d20 7574 696c 732e 6765 745f 7374 616e  = utils.get_stan
-000097e0: 6461 7264 697a 6564 5f69 6473 280a 2020  dardized_ids(.  
-000097f0: 2020 2020 2020 2020 2020 636f 6c5f 6c61            col_la
-00009800: 6265 6c73 2c0a 2020 2020 2020 2020 2020  bels,.          
-00009810: 2020 6964 785f 6c61 6265 6c73 2c0a 2020    idx_labels,.  
-00009820: 2020 2020 2020 2020 2020 2320 4c6f 6164            # Load
-00009830: 696e 6720 7061 7271 7565 7420 6669 6c65  ing parquet file
-00009840: 7320 696e 746f 2042 6967 5175 6572 7920  s into BigQuery 
-00009850: 7769 7468 2073 7065 6369 616c 2063 6f6c  with special col
-00009860: 756d 6e20 6e61 6d65 730a 2020 2020 2020  umn names.      
-00009870: 2020 2020 2020 2320 6973 206f 6e6c 7920        # is only 
-00009880: 7375 7070 6f72 7465 6420 756e 6465 7220  supported under 
-00009890: 616e 2061 6c6c 6f77 6c69 7374 2e0a 2020  an allowlist..  
-000098a0: 2020 2020 2020 2020 2020 7374 7269 6374            strict
-000098b0: 3d54 7275 652c 0a20 2020 2020 2020 2029  =True,.        )
-000098c0: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
-000098d0: 6f72 6465 7220 636f 6c75 6d6e 2074 6f20  order column to 
-000098e0: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
-000098f0: 2074 6f20 7072 6573 6572 7665 206f 7264   to preserve ord
-00009900: 6572 2069 6e20 4269 6751 7565 7279 0a20  er in BigQuery. 
-00009910: 2020 2020 2020 206f 7264 6572 696e 675f         ordering_
-00009920: 636f 6c20 3d20 2272 6f77 6964 220a 2020  col = "rowid".  
-00009930: 2020 2020 2020 636f 6c75 6d6e 7320 3d20        columns = 
-00009940: 6672 6f7a 656e 7365 7428 636f 6c5f 6c61  frozenset(col_la
-00009950: 6265 6c73 202b 2069 6478 5f6c 6162 656c  bels + idx_label
-00009960: 7329 0a20 2020 2020 2020 2073 7566 6669  s).        suffi
-00009970: 7820 3d20 320a 2020 2020 2020 2020 7768  x = 2.        wh
-00009980: 696c 6520 6f72 6465 7269 6e67 5f63 6f6c  ile ordering_col
-00009990: 2069 6e20 636f 6c75 6d6e 733a 0a20 2020   in columns:.   
-000099a0: 2020 2020 2020 2020 206f 7264 6572 696e           orderin
-000099b0: 675f 636f 6c20 3d20 6622 726f 7769 645f  g_col = f"rowid_
-000099c0: 7b73 7566 6669 787d 220a 2020 2020 2020  {suffix}".      
-000099d0: 2020 2020 2020 7375 6666 6978 202b 3d20        suffix += 
-000099e0: 310a 0a20 2020 2020 2020 2070 616e 6461  1..        panda
-000099f0: 735f 6461 7461 6672 616d 655f 636f 7079  s_dataframe_copy
-00009a00: 203d 2070 616e 6461 735f 6461 7461 6672   = pandas_datafr
-00009a10: 616d 652e 636f 7079 2829 0a20 2020 2020  ame.copy().     
-00009a20: 2020 2070 616e 6461 735f 6461 7461 6672     pandas_datafr
-00009a30: 616d 655f 636f 7079 2e69 6e64 6578 2e6e  ame_copy.index.n
-00009a40: 616d 6573 203d 206e 6577 5f69 6478 5f69  ames = new_idx_i
-00009a50: 6473 0a20 2020 2020 2020 2070 616e 6461  ds.        panda
-00009a60: 735f 6461 7461 6672 616d 655f 636f 7079  s_dataframe_copy
-00009a70: 2e63 6f6c 756d 6e73 203d 2070 616e 6461  .columns = panda
-00009a80: 732e 496e 6465 7828 6e65 775f 636f 6c5f  s.Index(new_col_
-00009a90: 6964 7329 0a20 2020 2020 2020 2070 616e  ids).        pan
-00009aa0: 6461 735f 6461 7461 6672 616d 655f 636f  das_dataframe_co
-00009ab0: 7079 5b6f 7264 6572 696e 675f 636f 6c5d  py[ordering_col]
-00009ac0: 203d 206e 702e 6172 616e 6765 2870 616e   = np.arange(pan
-00009ad0: 6461 735f 6461 7461 6672 616d 655f 636f  das_dataframe_co
-00009ae0: 7079 2e73 6861 7065 5b30 5d29 0a0a 2020  py.shape[0])..  
-00009af0: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-00009b00: 203d 2073 656c 662e 5f70 7265 7061 7265   = self._prepare
-00009b10: 5f6c 6f61 645f 6a6f 625f 636f 6e66 6967  _load_job_config
-00009b20: 2829 0a0a 2020 2020 2020 2020 2320 5370  ()..        # Sp
-00009b30: 6563 6966 7920 7468 6520 6461 7465 7469  ecify the dateti
-00009b40: 6d65 2064 7479 7065 732c 2077 6869 6368  me dtypes, which
-00009b50: 2069 7320 6175 746f 2d64 6574 6563 7465   is auto-detecte
-00009b60: 6420 6173 2074 696d 6573 7461 6d70 2074  d as timestamp t
-00009b70: 7970 6573 2e0a 2020 2020 2020 2020 7363  ypes..        sc
-00009b80: 6865 6d61 3a20 6c69 7374 5b62 6967 7175  hema: list[bigqu
-00009b90: 6572 792e 5363 6865 6d61 4669 656c 645d  ery.SchemaField]
-00009ba0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00009bb0: 7220 636f 6c75 6d6e 2c20 6474 7970 6520  r column, dtype 
-00009bc0: 696e 207a 6970 286e 6577 5f63 6f6c 5f69  in zip(new_col_i
-00009bd0: 6473 2c20 7061 6e64 6173 5f64 6174 6166  ds, pandas_dataf
-00009be0: 7261 6d65 2e64 7479 7065 7329 3a0a 2020  rame.dtypes):.  
-00009bf0: 2020 2020 2020 2020 2020 6966 2064 7479            if dty
-00009c00: 7065 203d 3d20 2274 696d 6573 7461 6d70  pe == "timestamp
-00009c10: 5b75 735d 5b70 7961 7272 6f77 5d22 3a0a  [us][pyarrow]":.
-00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c30: 7363 6865 6d61 2e61 7070 656e 6428 0a20  schema.append(. 
-00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2062 6967 7175 6572 792e 5363 6865     bigquery.Sche
-00009c60: 6d61 4669 656c 6428 636f 6c75 6d6e 2c20  maField(column, 
-00009c70: 6269 6771 7565 7279 2e65 6e75 6d73 2e53  bigquery.enums.S
-00009c80: 716c 5479 7065 4e61 6d65 732e 4441 5445  qlTypeNames.DATE
-00009c90: 5449 4d45 290a 2020 2020 2020 2020 2020  TIME).          
-00009ca0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00009cb0: 6a6f 625f 636f 6e66 6967 2e73 6368 656d  job_config.schem
-00009cc0: 6120 3d20 7363 6865 6d61 0a0a 2020 2020  a = schema..    
-00009cd0: 2020 2020 2320 436c 7573 7465 7269 6e67      # Clustering
-00009ce0: 2070 726f 6261 626c 7920 6e6f 7420 6e65   probably not ne
-00009cf0: 6564 6564 2061 6e79 7761 7973 2061 7320  eded anyways as 
-00009d00: 7061 6e64 6173 2074 6162 6c65 7320 6172  pandas tables ar
-00009d10: 6520 736d 616c 6c0a 2020 2020 2020 2020  e small.        
-00009d20: 636c 7573 7465 725f 636f 6c73 203d 205b  cluster_cols = [
-00009d30: 6f72 6465 7269 6e67 5f63 6f6c 5d0a 2020  ordering_col].  
-00009d40: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-00009d50: 2e63 6c75 7374 6572 696e 675f 6669 656c  .clustering_fiel
-00009d60: 6473 203d 2063 6c75 7374 6572 5f63 6f6c  ds = cluster_col
-00009d70: 730a 0a20 2020 2020 2020 206a 6f62 5f63  s..        job_c
-00009d80: 6f6e 6669 672e 6c61 6265 6c73 203d 207b  onfig.labels = {
-00009d90: 2262 6967 6672 616d 6573 2d61 7069 223a  "bigframes-api":
-00009da0: 2061 7069 5f6e 616d 657d 0a0a 2020 2020   api_name}..    
-00009db0: 2020 2020 6c6f 6164 5f74 6162 6c65 5f64      load_table_d
-00009dc0: 6573 7469 6e61 7469 6f6e 203d 2062 6967  estination = big
-00009dd0: 6672 616d 6573 5f69 6f2e 7261 6e64 6f6d  frames_io.random
-00009de0: 5f74 6162 6c65 2873 656c 662e 5f61 6e6f  _table(self._ano
-00009df0: 6e79 6d6f 7573 5f64 6174 6173 6574 290a  nymous_dataset).
-00009e00: 2020 2020 2020 2020 6c6f 6164 5f6a 6f62          load_job
-00009e10: 203d 2073 656c 662e 6271 636c 6965 6e74   = self.bqclient
-00009e20: 2e6c 6f61 645f 7461 626c 655f 6672 6f6d  .load_table_from
-00009e30: 5f64 6174 6166 7261 6d65 280a 2020 2020  _dataframe(.    
-00009e40: 2020 2020 2020 2020 7061 6e64 6173 5f64          pandas_d
-00009e50: 6174 6166 7261 6d65 5f63 6f70 792c 0a20  ataframe_copy,. 
-00009e60: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
-00009e70: 7461 626c 655f 6465 7374 696e 6174 696f  table_destinatio
-00009e80: 6e2c 0a20 2020 2020 2020 2020 2020 206a  n,.            j
-00009e90: 6f62 5f63 6f6e 6669 673d 6a6f 625f 636f  ob_config=job_co
-00009ea0: 6e66 6967 2c0a 2020 2020 2020 2020 290a  nfig,.        ).
-00009eb0: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-00009ec0: 6172 745f 6765 6e65 7269 635f 6a6f 6228  art_generic_job(
-00009ed0: 6c6f 6164 5f6a 6f62 290a 0a20 2020 2020  load_job)..     
-00009ee0: 2020 206f 7264 6572 696e 6720 3d20 6f72     ordering = or
-00009ef0: 6465 722e 4578 7072 6573 7369 6f6e 4f72  der.ExpressionOr
-00009f00: 6465 7269 6e67 280a 2020 2020 2020 2020  dering(.        
-00009f10: 2020 2020 6f72 6465 7269 6e67 5f76 616c      ordering_val
-00009f20: 7565 5f63 6f6c 756d 6e73 3d74 7570 6c65  ue_columns=tuple
-00009f30: 285b 6f72 6465 722e 6173 6365 6e64 696e  ([order.ascendin
-00009f40: 675f 6f76 6572 286f 7264 6572 696e 675f  g_over(ordering_
-00009f50: 636f 6c29 5d29 2c0a 2020 2020 2020 2020  col)]),.        
-00009f60: 2020 2020 746f 7461 6c5f 6f72 6465 7269      total_orderi
-00009f70: 6e67 5f63 6f6c 756d 6e73 3d66 726f 7a65  ng_columns=froze
-00009f80: 6e73 6574 285b 6f72 6465 7269 6e67 5f63  nset([ordering_c
-00009f90: 6f6c 5d29 2c0a 2020 2020 2020 2020 2020  ol]),.          
-00009fa0: 2020 696e 7465 6765 725f 656e 636f 6469    integer_encodi
-00009fb0: 6e67 3d49 6e74 6567 6572 456e 636f 6469  ng=IntegerEncodi
-00009fc0: 6e67 2854 7275 652c 2069 735f 7365 7175  ng(True, is_sequ
-00009fd0: 656e 7469 616c 3d54 7275 6529 2c0a 2020  ential=True),.  
-00009fe0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00009ff0: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
-0000a000: 203d 2073 656c 662e 6962 6973 5f63 6c69   = self.ibis_cli
-0000a010: 656e 742e 7461 626c 6528 2020 2320 7479  ent.table(  # ty
-0000a020: 7065 3a20 6967 6e6f 7265 0a20 2020 2020  pe: ignore.     
-0000a030: 2020 2020 2020 206c 6f61 645f 7461 626c         load_tabl
-0000a040: 655f 6465 7374 696e 6174 696f 6e2e 7461  e_destination.ta
-0000a050: 626c 655f 6964 2c0a 2020 2020 2020 2020  ble_id,.        
-0000a060: 2020 2020 7363 6865 6d61 3d6c 6f61 645f      schema=load_
-0000a070: 7461 626c 655f 6465 7374 696e 6174 696f  table_destinatio
-0000a080: 6e2e 6461 7461 7365 745f 6964 2c0a 2020  n.dataset_id,.  
-0000a090: 2020 2020 2020 2020 2020 6461 7461 6261            databa
-0000a0a0: 7365 3d6c 6f61 645f 7461 626c 655f 6465  se=load_table_de
-0000a0b0: 7374 696e 6174 696f 6e2e 7072 6f6a 6563  stination.projec
-0000a0c0: 742c 0a20 2020 2020 2020 2029 0a0a 2020  t,.        )..  
-0000a0d0: 2020 2020 2020 2320 622f 3239 3735 3930        # b/297590
-0000a0e0: 3137 3820 506f 7465 6e74 6961 6c6c 7920  178 Potentially 
-0000a0f0: 6120 6275 6720 696e 2062 7163 6c69 656e  a bug in bqclien
-0000a100: 742e 6c6f 6164 5f74 6162 6c65 5f66 726f  t.load_table_fro
-0000a110: 6d5f 6461 7461 6672 616d 6528 292c 2074  m_dataframe(), t
-0000a120: 6861 7420 6f6e 6c79 2077 6865 6e20 7468  hat only when th
-0000a130: 6520 4446 2069 7320 656d 7074 792c 2074  e DF is empty, t
-0000a140: 6865 2069 6e64 6578 2063 6f6c 756d 6e73  he index columns
-0000a150: 2064 6973 6170 7065 6172 2069 6e20 7461   disappear in ta
-0000a160: 626c 655f 6578 7072 6573 7369 6f6e 2e0a  ble_expression..
-0000a170: 2020 2020 2020 2020 6966 2061 6e79 280a          if any(.
-0000a180: 2020 2020 2020 2020 2020 2020 5b6e 6577              [new
-0000a190: 5f69 6478 5f69 6420 6e6f 7420 696e 2074  _idx_id not in t
-0000a1a0: 6162 6c65 5f65 7870 7265 7373 696f 6e2e  able_expression.
-0000a1b0: 636f 6c75 6d6e 7320 666f 7220 6e65 775f  columns for new_
-0000a1c0: 6964 785f 6964 2069 6e20 6e65 775f 6964  idx_id in new_id
-0000a1d0: 785f 6964 735d 0a20 2020 2020 2020 2029  x_ids].        )
-0000a1e0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
-0000a1f0: 775f 6964 785f 6964 732c 2069 6478 5f6c  w_idx_ids, idx_l
-0000a200: 6162 656c 7320 3d20 5b5d 2c20 5b5d 0a0a  abels = [], []..
-0000a210: 2020 2020 2020 2020 636f 6c75 6d6e 5f76          column_v
-0000a220: 616c 7565 7320 3d20 5b0a 2020 2020 2020  alues = [.      
-0000a230: 2020 2020 2020 7461 626c 655f 6578 7072        table_expr
-0000a240: 6573 7369 6f6e 5b63 6f6c 5d0a 2020 2020  ession[col].    
-0000a250: 2020 2020 2020 2020 666f 7220 636f 6c20          for col 
-0000a260: 696e 2074 6162 6c65 5f65 7870 7265 7373  in table_express
-0000a270: 696f 6e2e 636f 6c75 6d6e 730a 2020 2020  ion.columns.    
-0000a280: 2020 2020 2020 2020 6966 2063 6f6c 2021          if col !
-0000a290: 3d20 6f72 6465 7269 6e67 5f63 6f6c 0a20  = ordering_col. 
-0000a2a0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-0000a2b0: 2061 7272 6179 5f76 616c 7565 203d 2063   array_value = c
-0000a2c0: 6f72 652e 4172 7261 7956 616c 7565 2e66  ore.ArrayValue.f
-0000a2d0: 726f 6d5f 6962 6973 280a 2020 2020 2020  rom_ibis(.      
-0000a2e0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000a2f0: 2020 2020 2020 2020 7461 626c 655f 6578          table_ex
-0000a300: 7072 6573 7369 6f6e 2c0a 2020 2020 2020  pression,.      
-0000a310: 2020 2020 2020 636f 6c75 6d6e 733d 636f        columns=co
-0000a320: 6c75 6d6e 5f76 616c 7565 732c 0a20 2020  lumn_values,.   
-0000a330: 2020 2020 2020 2020 2068 6964 6465 6e5f           hidden_
-0000a340: 6f72 6465 7269 6e67 5f63 6f6c 756d 6e73  ordering_columns
-0000a350: 3d5b 7461 626c 655f 6578 7072 6573 7369  =[table_expressi
-0000a360: 6f6e 5b6f 7264 6572 696e 675f 636f 6c5d  on[ordering_col]
-0000a370: 5d2c 0a20 2020 2020 2020 2020 2020 206f  ],.            o
-0000a380: 7264 6572 696e 673d 6f72 6465 7269 6e67  rdering=ordering
-0000a390: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000a3a0: 2020 2020 2062 6c6f 636b 203d 2062 6c6f       block = blo
-0000a3b0: 636b 732e 426c 6f63 6b28 0a20 2020 2020  cks.Block(.     
-0000a3c0: 2020 2020 2020 2061 7272 6179 5f76 616c         array_val
-0000a3d0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0000a3e0: 696e 6465 785f 636f 6c75 6d6e 733d 6e65  index_columns=ne
-0000a3f0: 775f 6964 785f 6964 732c 0a20 2020 2020  w_idx_ids,.     
-0000a400: 2020 2020 2020 2063 6f6c 756d 6e5f 6c61         column_la
-0000a410: 6265 6c73 3d63 6f6c 5f69 6e64 6578 2c0a  bels=col_index,.
-0000a420: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0000a430: 785f 6c61 6265 6c73 3d69 6478 5f6c 6162  x_labels=idx_lab
-0000a440: 656c 732c 0a20 2020 2020 2020 2029 0a20  els,.        ). 
-0000a450: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-0000a460: 7461 6672 616d 652e 4461 7461 4672 616d  taframe.DataFram
-0000a470: 6528 626c 6f63 6b29 0a0a 2020 2020 6465  e(block)..    de
-0000a480: 6620 7265 6164 5f63 7376 280a 2020 2020  f read_csv(.    
-0000a490: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0000a4a0: 2020 6669 6c65 7061 7468 5f6f 725f 6275    filepath_or_bu
-0000a4b0: 6666 6572 3a20 7374 7220 7c20 494f 5b22  ffer: str | IO["
-0000a4c0: 6279 7465 7322 5d2c 0a20 2020 2020 2020  bytes"],.       
-0000a4d0: 202a 2c0a 2020 2020 2020 2020 7365 703a   *,.        sep:
-0000a4e0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0000a4f0: 2022 2c22 2c0a 2020 2020 2020 2020 6865   ",",.        he
-0000a500: 6164 6572 3a20 4f70 7469 6f6e 616c 5b69  ader: Optional[i
-0000a510: 6e74 5d20 3d20 302c 0a20 2020 2020 2020  nt] = 0,.       
-0000a520: 206e 616d 6573 3a20 4f70 7469 6f6e 616c   names: Optional
-0000a530: 5b0a 2020 2020 2020 2020 2020 2020 556e  [.            Un
-0000a540: 696f 6e5b 4d75 7461 626c 6553 6571 7565  ion[MutableSeque
-0000a550: 6e63 655b 416e 795d 2c20 6e70 2e6e 6461  nce[Any], np.nda
-0000a560: 7272 6179 5b41 6e79 2c20 416e 795d 2c20  rray[Any, Any], 
-0000a570: 5475 706c 655b 416e 792c 202e 2e2e 5d2c  Tuple[Any, ...],
-0000a580: 2072 616e 6765 5d0a 2020 2020 2020 2020   range].        
-0000a590: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000a5a0: 2020 696e 6465 785f 636f 6c3a 204f 7074    index_col: Opt
-0000a5b0: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
-0000a5c0: 2020 2055 6e69 6f6e 5b69 6e74 2c20 7374     Union[int, st
-0000a5d0: 722c 2053 6571 7565 6e63 655b 556e 696f  r, Sequence[Unio
-0000a5e0: 6e5b 7374 722c 2069 6e74 5d5d 2c20 4c69  n[str, int]], Li
-0000a5f0: 7465 7261 6c5b 4661 6c73 655d 5d0a 2020  teral[False]].  
-0000a600: 2020 2020 2020 5d20 3d20 4e6f 6e65 2c0a        ] = None,.
-0000a610: 2020 2020 2020 2020 7573 6563 6f6c 733a          usecols:
-0000a620: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-0000a630: 2020 2020 2020 2055 6e69 6f6e 5b0a 2020         Union[.  
-0000a640: 2020 2020 2020 2020 2020 2020 2020 4d75                Mu
-0000a650: 7461 626c 6553 6571 7565 6e63 655b 7374  tableSequence[st
-0000a660: 725d 2c0a 2020 2020 2020 2020 2020 2020  r],.            
-0000a670: 2020 2020 5475 706c 655b 7374 722c 202e      Tuple[str, .
-0000a680: 2e2e 5d2c 0a20 2020 2020 2020 2020 2020  ..],.           
-0000a690: 2020 2020 2053 6571 7565 6e63 655b 696e       Sequence[in
-0000a6a0: 745d 2c0a 2020 2020 2020 2020 2020 2020  t],.            
-0000a6b0: 2020 2020 7061 6e64 6173 2e53 6572 6965      pandas.Serie
-0000a6c0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0000a6d0: 2020 2070 616e 6461 732e 496e 6465 782c     pandas.Index,
-0000a6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a6f0: 206e 702e 6e64 6172 7261 795b 416e 792c   np.ndarray[Any,
-0000a700: 2041 6e79 5d2c 0a20 2020 2020 2020 2020   Any],.         
-0000a710: 2020 2020 2020 2043 616c 6c61 626c 655b         Callable[
-0000a720: 5b41 6e79 5d2c 2062 6f6f 6c5d 2c0a 2020  [Any], bool],.  
-0000a730: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-0000a740: 2020 2020 5d20 3d20 4e6f 6e65 2c0a 2020      ] = None,.  
-0000a750: 2020 2020 2020 6474 7970 653a 204f 7074        dtype: Opt
-0000a760: 696f 6e61 6c5b 4469 6374 5d20 3d20 4e6f  ional[Dict] = No
-0000a770: 6e65 2c0a 2020 2020 2020 2020 656e 6769  ne,.        engi
-0000a780: 6e65 3a20 4f70 7469 6f6e 616c 5b0a 2020  ne: Optional[.  
-0000a790: 2020 2020 2020 2020 2020 4c69 7465 7261            Litera
-0000a7a0: 6c5b 2263 222c 2022 7079 7468 6f6e 222c  l["c", "python",
-0000a7b0: 2022 7079 6172 726f 7722 2c20 2270 7974   "pyarrow", "pyt
-0000a7c0: 686f 6e2d 6677 6622 2c20 2262 6967 7175  hon-fwf", "bigqu
-0000a7d0: 6572 7922 5d0a 2020 2020 2020 2020 5d20  ery"].        ] 
-0000a7e0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000a7f0: 656e 636f 6469 6e67 3a20 4f70 7469 6f6e  encoding: Option
-0000a800: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0000a810: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-0000a820: 2c0a 2020 2020 2920 2d3e 2064 6174 6166  ,.    ) -> dataf
-0000a830: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
-0000a840: 2020 2020 2020 2020 7461 626c 6520 3d20          table = 
-0000a850: 6269 6766 7261 6d65 735f 696f 2e72 616e  bigframes_io.ran
-0000a860: 646f 6d5f 7461 626c 6528 7365 6c66 2e5f  dom_table(self._
-0000a870: 616e 6f6e 796d 6f75 735f 6461 7461 7365  anonymous_datase
-0000a880: 7429 0a0a 2020 2020 2020 2020 6966 2065  t)..        if e
-0000a890: 6e67 696e 6520 6973 206e 6f74 204e 6f6e  ngine is not Non
-0000a8a0: 6520 616e 6420 656e 6769 6e65 203d 3d20  e and engine == 
-0000a8b0: 2262 6967 7175 6572 7922 3a0a 2020 2020  "bigquery":.    
-0000a8c0: 2020 2020 2020 2020 6966 2061 6e79 2870          if any(p
-0000a8d0: 6172 616d 2069 7320 6e6f 7420 4e6f 6e65  aram is not None
-0000a8e0: 2066 6f72 2070 6172 616d 2069 6e20 2864   for param in (d
-0000a8f0: 7479 7065 2c20 6e61 6d65 7329 293a 0a20  type, names)):. 
-0000a900: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000a910: 6f74 5f73 7570 706f 7274 6564 203d 2028  ot_supported = (
-0000a920: 2264 7479 7065 222c 2022 6e61 6d65 7322  "dtype", "names"
-0000a930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a940: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0000a950: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
-0000a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a970: 2066 2242 6967 5175 6572 7920 656e 6769   f"BigQuery engi
-0000a980: 6e65 2064 6f65 7320 6e6f 7420 7375 7070  ne does not supp
-0000a990: 6f72 7420 7468 6573 6520 6172 6775 6d65  ort these argume
-0000a9a0: 6e74 733a 207b 6e6f 745f 7375 7070 6f72  nts: {not_suppor
-0000a9b0: 7465 647d 2e20 220a 2020 2020 2020 2020  ted}. ".        
-0000a9c0: 2020 2020 2020 2020 2020 2020 6622 7b63              f"{c
-0000a9d0: 6f6e 7374 616e 7473 2e46 4545 4442 4143  onstants.FEEDBAC
-0000a9e0: 4b5f 4c49 4e4b 7d22 0a20 2020 2020 2020  K_LINK}".       
-0000a9f0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000aa00: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
-0000aa10: 5f63 6f6c 2069 7320 6e6f 7420 4e6f 6e65  _col is not None
-0000aa20: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
-0000aa30: 2020 2020 2020 206e 6f74 2069 6e64 6578         not index
-0000aa40: 5f63 6f6c 206f 7220 6e6f 7420 6973 696e  _col or not isin
-0000aa50: 7374 616e 6365 2869 6e64 6578 5f63 6f6c  stance(index_col
-0000aa60: 2c20 7374 7229 0a20 2020 2020 2020 2020  , str).         
-0000aa70: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0000aa80: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
-0000aa90: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
-0000aaa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aab0: 2020 2020 2022 4269 6751 7565 7279 2065       "BigQuery e
-0000aac0: 6e67 696e 6520 6f6e 6c79 2073 7570 706f  ngine only suppo
-0000aad0: 7274 7320 6120 7369 6e67 6c65 2063 6f6c  rts a single col
-0000aae0: 756d 6e20 6e61 6d65 2066 6f72 2060 696e  umn name for `in
-0000aaf0: 6465 785f 636f 6c60 2e20 220a 2020 2020  dex_col`. ".    
-0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab10: 6622 7b63 6f6e 7374 616e 7473 2e46 4545  f"{constants.FEE
-0000ab20: 4442 4143 4b5f 4c49 4e4b 7d22 0a20 2020  DBACK_LINK}".   
-0000ab30: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0000ab40: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
-0000ab50: 6e65 2076 616c 7565 2066 6f72 2069 6e64  ne value for ind
-0000ab60: 6578 5f63 6f6c 2063 616e 6e6f 7420 6265  ex_col cannot be
-0000ab70: 2070 6173 7365 6420 746f 2072 6561 645f   passed to read_
-0000ab80: 6762 710a 2020 2020 2020 2020 2020 2020  gbq.            
-0000ab90: 6966 2069 6e64 6578 5f63 6f6c 2069 7320  if index_col is 
-0000aba0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000abb0: 2020 2020 2020 696e 6465 785f 636f 6c20        index_col 
-0000abc0: 3d20 2829 0a0a 2020 2020 2020 2020 2020  = ()..          
-0000abd0: 2020 2320 7573 6563 6f6c 7320 7368 6f75    # usecols shou
-0000abe0: 6c64 206f 6e6c 7920 6265 2061 6e20 6974  ld only be an it
-0000abf0: 6572 6162 6c65 206f 6620 7374 7269 6e67  erable of string
-0000ac00: 7320 2863 6f6c 756d 6e20 6e61 6d65 7329  s (column names)
-0000ac10: 2066 6f72 2075 7365 2061 7320 636f 6c75   for use as colu
-0000ac20: 6d6e 7320 696e 2072 6561 645f 6762 712e  mns in read_gbq.
-0000ac30: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-0000ac40: 756d 6e73 3a20 5475 706c 655b 416e 792c  umns: Tuple[Any,
-0000ac50: 202e 2e2e 5d20 3d20 7475 706c 6528 290a   ...] = tuple().
-0000ac60: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-0000ac70: 7365 636f 6c73 2069 7320 6e6f 7420 4e6f  secols is not No
-0000ac80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000ac90: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000aca0: 6528 7573 6563 6f6c 732c 2049 7465 7261  e(usecols, Itera
-0000acb0: 626c 6529 2061 6e64 2061 6c6c 280a 2020  ble) and all(.  
-0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acd0: 2020 6973 696e 7374 616e 6365 2863 6f6c    isinstance(col
-0000ace0: 2c20 7374 7229 2066 6f72 2063 6f6c 2069  , str) for col i
-0000acf0: 6e20 7573 6563 6f6c 730a 2020 2020 2020  n usecols.      
-0000ad00: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-0000ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad20: 2063 6f6c 756d 6e73 203d 2074 7570 6c65   columns = tuple
-0000ad30: 2863 6f6c 2066 6f72 2063 6f6c 2069 6e20  (col for col in 
-0000ad40: 7573 6563 6f6c 7329 0a20 2020 2020 2020  usecols).       
-0000ad50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad70: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000ad80: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
-0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ada0: 2020 2020 2020 2242 6967 5175 6572 7920        "BigQuery 
-0000adb0: 656e 6769 6e65 206f 6e6c 7920 7375 7070  engine only supp
-0000adc0: 6f72 7473 2061 6e20 6974 6572 6162 6c65  orts an iterable
-0000add0: 206f 6620 7374 7269 6e67 7320 666f 7220   of strings for 
-0000ade0: 6075 7365 636f 6c73 602e 2022 0a20 2020  `usecols`. ".   
-0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae00: 2020 2020 2066 227b 636f 6e73 7461 6e74       f"{constant
-0000ae10: 732e 4645 4544 4241 434b 5f4c 494e 4b7d  s.FEEDBACK_LINK}
-0000ae20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000ae30: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000ae40: 2020 2020 2069 6620 656e 636f 6469 6e67       if encoding
-0000ae50: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000ae60: 2065 6e63 6f64 696e 6720 6e6f 7420 696e   encoding not in
-0000ae70: 205f 5641 4c49 445f 454e 434f 4449 4e47   _VALID_ENCODING
-0000ae80: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
-0000ae90: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000aea0: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aec0: 2020 6622 4269 6751 7565 7279 2065 6e67    f"BigQuery eng
-0000aed0: 696e 6520 6f6e 6c79 2073 7570 706f 7274  ine only support
-0000aee0: 7320 7468 6520 666f 6c6c 6f77 696e 6720  s the following 
-0000aef0: 656e 636f 6469 6e67 733a 207b 5f56 414c  encodings: {_VAL
-0000af00: 4944 5f45 4e43 4f44 494e 4753 7d2e 2022  ID_ENCODINGS}. "
-0000af10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af20: 2020 2020 2066 227b 636f 6e73 7461 6e74       f"{constant
-0000af30: 732e 4645 4544 4241 434b 5f4c 494e 4b7d  s.FEEDBACK_LINK}
-0000af40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000af50: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-0000af60: 206a 6f62 5f63 6f6e 6669 6720 3d20 7365   job_config = se
-0000af70: 6c66 2e5f 7072 6570 6172 655f 6c6f 6164  lf._prepare_load
-0000af80: 5f6a 6f62 5f63 6f6e 6669 6728 290a 2020  _job_config().  
-0000af90: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
-0000afa0: 6e66 6967 2e63 7265 6174 655f 6469 7370  nfig.create_disp
-0000afb0: 6f73 6974 696f 6e20 3d20 6269 6771 7565  osition = bigque
-0000afc0: 7279 2e43 7265 6174 6544 6973 706f 7369  ry.CreateDisposi
-0000afd0: 7469 6f6e 2e43 5245 4154 455f 4946 5f4e  tion.CREATE_IF_N
-0000afe0: 4545 4445 440a 2020 2020 2020 2020 2020  EEDED.          
-0000aff0: 2020 6a6f 625f 636f 6e66 6967 2e73 6f75    job_config.sou
-0000b000: 7263 655f 666f 726d 6174 203d 2062 6967  rce_format = big
-0000b010: 7175 6572 792e 536f 7572 6365 466f 726d  query.SourceForm
-0000b020: 6174 2e43 5356 0a20 2020 2020 2020 2020  at.CSV.         
-0000b030: 2020 206a 6f62 5f63 6f6e 6669 672e 7772     job_config.wr
-0000b040: 6974 655f 6469 7370 6f73 6974 696f 6e20  ite_disposition 
-0000b050: 3d20 6269 6771 7565 7279 2e57 7269 7465  = bigquery.Write
-0000b060: 4469 7370 6f73 6974 696f 6e2e 5752 4954  Disposition.WRIT
-0000b070: 455f 454d 5054 590a 2020 2020 2020 2020  E_EMPTY.        
-0000b080: 2020 2020 6a6f 625f 636f 6e66 6967 2e61      job_config.a
-0000b090: 7574 6f64 6574 6563 7420 3d20 5472 7565  utodetect = True
-0000b0a0: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
-0000b0b0: 5f63 6f6e 6669 672e 6669 656c 645f 6465  _config.field_de
-0000b0c0: 6c69 6d69 7465 7220 3d20 7365 700a 2020  limiter = sep.  
-0000b0d0: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
-0000b0e0: 6e66 6967 2e65 6e63 6f64 696e 6720 3d20  nfig.encoding = 
-0000b0f0: 656e 636f 6469 6e67 0a20 2020 2020 2020  encoding.       
-0000b100: 2020 2020 206a 6f62 5f63 6f6e 6669 672e       job_config.
-0000b110: 6c61 6265 6c73 203d 207b 2262 6967 6672  labels = {"bigfr
-0000b120: 616d 6573 2d61 7069 223a 2022 7265 6164  ames-api": "read
-0000b130: 5f63 7376 227d 0a0a 2020 2020 2020 2020  _csv"}..        
-0000b140: 2020 2020 2320 5765 2077 616e 7420 746f      # We want to
-0000b150: 206d 6174 6368 2070 616e 6461 7320 6265   match pandas be
-0000b160: 6861 7669 6f72 2e20 4966 2068 6561 6465  havior. If heade
-0000b170: 7220 6973 2030 2c20 6e6f 2072 6f77 7320  r is 0, no rows 
-0000b180: 7368 6f75 6c64 2062 6520 736b 6970 7065  should be skippe
-0000b190: 642c 2073 6f20 7765 0a20 2020 2020 2020  d, so we.       
-0000b1a0: 2020 2020 2023 2064 6f20 6e6f 7420 6e65       # do not ne
-0000b1b0: 6564 2074 6f20 7365 7420 6073 6b69 705f  ed to set `skip_
-0000b1c0: 6c65 6164 696e 675f 726f 7773 602e 2049  leading_rows`. I
-0000b1d0: 6620 6865 6164 6572 2069 7320 4e6f 6e65  f header is None
-0000b1e0: 2c20 7468 656e 2074 6865 7265 2069 7320  , then there is 
-0000b1f0: 6e6f 2068 6561 6465 722e 0a20 2020 2020  no header..     
-0000b200: 2020 2020 2020 2023 2053 6574 7469 6e67         # Setting
-0000b210: 2073 6b69 705f 6c65 6164 696e 675f 726f   skip_leading_ro
-0000b220: 7773 2074 6f20 3020 646f 6573 2074 6861  ws to 0 does tha
-0000b230: 742e 2049 6620 6865 6164 6572 3d4e 2061  t. If header=N a
-0000b240: 6e64 204e 3e30 2c20 7765 2077 616e 7420  nd N>0, we want 
-0000b250: 746f 2073 6b69 7020 4e20 726f 7773 2e0a  to skip N rows..
-0000b260: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0000b270: 6561 6465 7220 6973 204e 6f6e 653a 0a20  eader is None:. 
-0000b280: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-0000b290: 6f62 5f63 6f6e 6669 672e 736b 6970 5f6c  ob_config.skip_l
-0000b2a0: 6561 6469 6e67 5f72 6f77 7320 3d20 300a  eading_rows = 0.
-0000b2b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000b2c0: 2068 6561 6465 7220 3e20 303a 0a20 2020   header > 0:.   
-0000b2d0: 2020 2020 2020 2020 2020 2020 206a 6f62               job
-0000b2e0: 5f63 6f6e 6669 672e 736b 6970 5f6c 6561  _config.skip_lea
-0000b2f0: 6469 6e67 5f72 6f77 7320 3d20 6865 6164  ding_rows = head
-0000b300: 6572 0a0a 2020 2020 2020 2020 2020 2020  er..            
-0000b310: 7265 7475 726e 2073 656c 662e 5f72 6561  return self._rea
-0000b320: 645f 6269 6771 7565 7279 5f6c 6f61 645f  d_bigquery_load_
-0000b330: 6a6f 6228 0a20 2020 2020 2020 2020 2020  job(.           
-0000b340: 2020 2020 2066 696c 6570 6174 685f 6f72       filepath_or
-0000b350: 5f62 7566 6665 722c 0a20 2020 2020 2020  _buffer,.       
-0000b360: 2020 2020 2020 2020 2074 6162 6c65 2c0a           table,.
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b380: 6a6f 625f 636f 6e66 6967 3d6a 6f62 5f63  job_config=job_c
-0000b390: 6f6e 6669 672c 0a20 2020 2020 2020 2020  onfig,.         
-0000b3a0: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-0000b3b0: 3d69 6e64 6578 5f63 6f6c 2c0a 2020 2020  =index_col,.    
-0000b3c0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0000b3d0: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
-0000b3e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000b3f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000b400: 2020 2020 2069 6620 616e 7928 6172 6720       if any(arg 
-0000b410: 696e 206b 7761 7267 7320 666f 7220 6172  in kwargs for ar
-0000b420: 6720 696e 2028 2263 6875 6e6b 7369 7a65  g in ("chunksize
-0000b430: 222c 2022 6974 6572 6174 6f72 2229 293a  ", "iterator")):
-0000b440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b450: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-0000b460: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
-0000b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b480: 2227 6368 756e 6b73 697a 6527 2061 6e64  "'chunksize' and
-0000b490: 2027 6974 6572 6174 6f72 2720 6172 6775   'iterator' argu
-0000b4a0: 6d65 6e74 7320 6172 6520 6e6f 7420 7375  ments are not su
-0000b4b0: 7070 6f72 7465 642e 2022 0a20 2020 2020  pported. ".     
-0000b4c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b4d0: 227b 636f 6e73 7461 6e74 732e 4645 4544  "{constants.FEED
-0000b4e0: 4241 434b 5f4c 494e 4b7d 220a 2020 2020  BACK_LINK}".    
-0000b4f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000b500: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0000b510: 696e 7374 616e 6365 2866 696c 6570 6174  instance(filepat
-0000b520: 685f 6f72 5f62 7566 6665 722c 2073 7472  h_or_buffer, str
-0000b530: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b540: 2020 2073 656c 662e 5f63 6865 636b 5f66     self._check_f
-0000b550: 696c 655f 7369 7a65 2866 696c 6570 6174  ile_size(filepat
-0000b560: 685f 6f72 5f62 7566 6665 7229 0a20 2020  h_or_buffer).   
-0000b570: 2020 2020 2020 2020 2070 616e 6461 735f           pandas_
-0000b580: 6466 203d 2070 616e 6461 732e 7265 6164  df = pandas.read
-0000b590: 5f63 7376 280a 2020 2020 2020 2020 2020  _csv(.          
-0000b5a0: 2020 2020 2020 6669 6c65 7061 7468 5f6f        filepath_o
-0000b5b0: 725f 6275 6666 6572 2c0a 2020 2020 2020  r_buffer,.      
-0000b5c0: 2020 2020 2020 2020 2020 7365 703d 7365            sep=se
-0000b5d0: 702c 0a20 2020 2020 2020 2020 2020 2020  p,.             
-0000b5e0: 2020 2068 6561 6465 723d 6865 6164 6572     header=header
-0000b5f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b600: 2020 6e61 6d65 733d 6e61 6d65 732c 0a20    names=names,. 
-0000b610: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000b620: 6e64 6578 5f63 6f6c 3d69 6e64 6578 5f63  ndex_col=index_c
-0000b630: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
-0000b640: 2020 2020 7573 6563 6f6c 733d 7573 6563      usecols=usec
-0000b650: 6f6c 732c 2020 2320 7479 7065 3a20 6967  ols,  # type: ig
-0000b660: 6e6f 7265 0a20 2020 2020 2020 2020 2020  nore.           
-0000b670: 2020 2020 2064 7479 7065 3d64 7479 7065       dtype=dtype
-0000b680: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b690: 2020 656e 6769 6e65 3d65 6e67 696e 652c    engine=engine,
-0000b6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b6b0: 2065 6e63 6f64 696e 673d 656e 636f 6469   encoding=encodi
-0000b6c0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-0000b6d0: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
-0000b6e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000b6f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000b700: 656c 662e 5f72 6561 645f 7061 6e64 6173  elf._read_pandas
-0000b710: 2870 616e 6461 735f 6466 2c20 2272 6561  (pandas_df, "rea
-0000b720: 645f 6373 7622 2920 2023 2074 7970 653a  d_csv")  # type:
-0000b730: 2069 676e 6f72 650a 0a20 2020 2064 6566   ignore..    def
-0000b740: 2072 6561 645f 7069 636b 6c65 280a 2020   read_pickle(.  
-0000b750: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000b760: 2020 2020 6669 6c65 7061 7468 5f6f 725f      filepath_or_
-0000b770: 6275 6666 6572 3a20 4669 6c65 5061 7468  buffer: FilePath
-0000b780: 207c 2052 6561 6450 6963 6b6c 6542 7566   | ReadPickleBuf
-0000b790: 6665 722c 0a20 2020 2020 2020 2063 6f6d  fer,.        com
-0000b7a0: 7072 6573 7369 6f6e 3a20 436f 6d70 7265  pression: Compre
-0000b7b0: 7373 696f 6e4f 7074 696f 6e73 203d 2022  ssionOptions = "
-0000b7c0: 696e 6665 7222 2c0a 2020 2020 2020 2020  infer",.        
-0000b7d0: 7374 6f72 6167 655f 6f70 7469 6f6e 733a  storage_options:
-0000b7e0: 2053 746f 7261 6765 4f70 7469 6f6e 7320   StorageOptions 
-0000b7f0: 3d20 4e6f 6e65 2c0a 2020 2020 293a 0a20  = None,.    ):. 
-0000b800: 2020 2020 2020 2070 616e 6461 735f 6f62         pandas_ob
-0000b810: 6a20 3d20 7061 6e64 6173 2e72 6561 645f  j = pandas.read_
-0000b820: 7069 636b 6c65 280a 2020 2020 2020 2020  pickle(.        
-0000b830: 2020 2020 6669 6c65 7061 7468 5f6f 725f      filepath_or_
-0000b840: 6275 6666 6572 2c0a 2020 2020 2020 2020  buffer,.        
-0000b850: 2020 2020 636f 6d70 7265 7373 696f 6e3d      compression=
-0000b860: 636f 6d70 7265 7373 696f 6e2c 0a20 2020  compression,.   
-0000b870: 2020 2020 2020 2020 2073 746f 7261 6765           storage
-0000b880: 5f6f 7074 696f 6e73 3d73 746f 7261 6765  _options=storage
-0000b890: 5f6f 7074 696f 6e73 2c0a 2020 2020 2020  _options,.      
-0000b8a0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000b8b0: 6973 696e 7374 616e 6365 2870 616e 6461  isinstance(panda
-0000b8c0: 735f 6f62 6a2c 2070 616e 6461 732e 5365  s_obj, pandas.Se
-0000b8d0: 7269 6573 293a 0a20 2020 2020 2020 2020  ries):.         
-0000b8e0: 2020 2069 6620 7061 6e64 6173 5f6f 626a     if pandas_obj
-0000b8f0: 2e6e 616d 6520 6973 204e 6f6e 653a 0a20  .name is None:. 
-0000b900: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000b910: 616e 6461 735f 6f62 6a2e 6e61 6d65 203d  andas_obj.name =
-0000b920: 2022 3022 0a20 2020 2020 2020 2020 2020   "0".           
-0000b930: 2062 6967 6672 616d 6573 5f64 6620 3d20   bigframes_df = 
-0000b940: 7365 6c66 2e5f 7265 6164 5f70 616e 6461  self._read_panda
-0000b950: 7328 7061 6e64 6173 5f6f 626a 2e74 6f5f  s(pandas_obj.to_
-0000b960: 6672 616d 6528 292c 2022 7265 6164 5f70  frame(), "read_p
-0000b970: 6963 6b6c 6522 290a 2020 2020 2020 2020  ickle").        
-0000b980: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-0000b990: 616d 6573 5f64 665b 6269 6766 7261 6d65  ames_df[bigframe
-0000b9a0: 735f 6466 2e63 6f6c 756d 6e73 5b30 5d5d  s_df.columns[0]]
-0000b9b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000b9c0: 7365 6c66 2e5f 7265 6164 5f70 616e 6461  self._read_panda
-0000b9d0: 7328 7061 6e64 6173 5f6f 626a 2c20 2272  s(pandas_obj, "r
-0000b9e0: 6561 645f 7069 636b 6c65 2229 0a0a 2020  ead_pickle")..  
-0000b9f0: 2020 6465 6620 7265 6164 5f70 6172 7175    def read_parqu
-0000ba00: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
-0000ba10: 2c0a 2020 2020 2020 2020 7061 7468 3a20  ,.        path: 
-0000ba20: 7374 7220 7c20 494f 5b22 6279 7465 7322  str | IO["bytes"
-0000ba30: 5d2c 0a20 2020 2020 2020 202a 2c0a 2020  ],.        *,.  
-0000ba40: 2020 2020 2020 656e 6769 6e65 3a20 7374        engine: st
-0000ba50: 7220 3d20 2261 7574 6f22 2c0a 2020 2020  r = "auto",.    
-0000ba60: 2920 2d3e 2064 6174 6166 7261 6d65 2e44  ) -> dataframe.D
-0000ba70: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
-0000ba80: 2020 7461 626c 6520 3d20 6269 6766 7261    table = bigfra
-0000ba90: 6d65 735f 696f 2e72 616e 646f 6d5f 7461  mes_io.random_ta
-0000baa0: 626c 6528 7365 6c66 2e5f 616e 6f6e 796d  ble(self._anonym
-0000bab0: 6f75 735f 6461 7461 7365 7429 0a0a 2020  ous_dataset)..  
-0000bac0: 2020 2020 2020 6966 2065 6e67 696e 6520        if engine 
-0000bad0: 3d3d 2022 6269 6771 7565 7279 223a 0a20  == "bigquery":. 
-0000bae0: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
-0000baf0: 6f6e 6669 6720 3d20 7365 6c66 2e5f 7072  onfig = self._pr
-0000bb00: 6570 6172 655f 6c6f 6164 5f6a 6f62 5f63  epare_load_job_c
-0000bb10: 6f6e 6669 6728 290a 2020 2020 2020 2020  onfig().        
-0000bb20: 2020 2020 6a6f 625f 636f 6e66 6967 2e63      job_config.c
-0000bb30: 7265 6174 655f 6469 7370 6f73 6974 696f  reate_dispositio
-0000bb40: 6e20 3d20 6269 6771 7565 7279 2e43 7265  n = bigquery.Cre
-0000bb50: 6174 6544 6973 706f 7369 7469 6f6e 2e43  ateDisposition.C
-0000bb60: 5245 4154 455f 4946 5f4e 4545 4445 440a  REATE_IF_NEEDED.
-0000bb70: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
-0000bb80: 636f 6e66 6967 2e73 6f75 7263 655f 666f  config.source_fo
-0000bb90: 726d 6174 203d 2062 6967 7175 6572 792e  rmat = bigquery.
-0000bba0: 536f 7572 6365 466f 726d 6174 2e50 4152  SourceFormat.PAR
-0000bbb0: 5155 4554 0a20 2020 2020 2020 2020 2020  QUET.           
-0000bbc0: 206a 6f62 5f63 6f6e 6669 672e 7772 6974   job_config.writ
-0000bbd0: 655f 6469 7370 6f73 6974 696f 6e20 3d20  e_disposition = 
-0000bbe0: 6269 6771 7565 7279 2e57 7269 7465 4469  bigquery.WriteDi
-0000bbf0: 7370 6f73 6974 696f 6e2e 5752 4954 455f  sposition.WRITE_
-0000bc00: 454d 5054 590a 2020 2020 2020 2020 2020  EMPTY.          
-0000bc10: 2020 6a6f 625f 636f 6e66 6967 2e6c 6162    job_config.lab
-0000bc20: 656c 7320 3d20 7b22 6269 6766 7261 6d65  els = {"bigframe
-0000bc30: 732d 6170 6922 3a20 2272 6561 645f 7061  s-api": "read_pa
-0000bc40: 7271 7565 7422 7d0a 0a20 2020 2020 2020  rquet"}..       
-0000bc50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000bc60: 2e5f 7265 6164 5f62 6967 7175 6572 795f  ._read_bigquery_
-0000bc70: 6c6f 6164 5f6a 6f62 2870 6174 682c 2074  load_job(path, t
-0000bc80: 6162 6c65 2c20 6a6f 625f 636f 6e66 6967  able, job_config
-0000bc90: 3d6a 6f62 5f63 6f6e 6669 6729 0a20 2020  =job_config).   
-0000bca0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000bcb0: 2020 2020 2020 2072 6561 645f 7061 7271         read_parq
-0000bcc0: 7565 745f 6b77 6172 6773 3a20 4469 6374  uet_kwargs: Dict
-0000bcd0: 5b73 7472 2c20 416e 795d 203d 207b 7d0a  [str, Any] = {}.
-0000bce0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0000bcf0: 616e 6461 732e 5f5f 7665 7273 696f 6e5f  andas.__version_
-0000bd00: 5f2e 7374 6172 7473 7769 7468 2822 312e  _.startswith("1.
-0000bd10: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-0000bd20: 2020 2020 7265 6164 5f70 6172 7175 6574      read_parquet
-0000bd30: 5f6b 7761 7267 735b 2275 7365 5f6e 756c  _kwargs["use_nul
-0000bd40: 6c61 626c 655f 6474 7970 6573 225d 203d  lable_dtypes"] =
-0000bd50: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0000bd60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000bd70: 2020 2020 2020 2020 7265 6164 5f70 6172          read_par
-0000bd80: 7175 6574 5f6b 7761 7267 735b 2264 7479  quet_kwargs["dty
-0000bd90: 7065 5f62 6163 6b65 6e64 225d 203d 2022  pe_backend"] = "
-0000bda0: 7079 6172 726f 7722 0a0a 2020 2020 2020  pyarrow"..      
-0000bdb0: 2020 2020 2020 7061 6e64 6173 5f6f 626a        pandas_obj
-0000bdc0: 203d 2070 616e 6461 732e 7265 6164 5f70   = pandas.read_p
-0000bdd0: 6172 7175 6574 280a 2020 2020 2020 2020  arquet(.        
-0000bde0: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-0000bdf0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0000be00: 6769 6e65 3d65 6e67 696e 652c 2020 2320  gine=engine,  # 
-0000be10: 7479 7065 3a20 6967 6e6f 7265 0a20 2020  type: ignore.   
-0000be20: 2020 2020 2020 2020 2020 2020 202a 2a72               **r
-0000be30: 6561 645f 7061 7271 7565 745f 6b77 6172  ead_parquet_kwar
-0000be40: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
-0000be50: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000be60: 7475 726e 2073 656c 662e 5f72 6561 645f  turn self._read_
-0000be70: 7061 6e64 6173 2870 616e 6461 735f 6f62  pandas(pandas_ob
-0000be80: 6a2c 2022 7265 6164 5f70 6172 7175 6574  j, "read_parquet
-0000be90: 2229 0a0a 2020 2020 6465 6620 7265 6164  ")..    def read
-0000bea0: 5f6a 736f 6e28 0a20 2020 2020 2020 2073  _json(.        s
-0000beb0: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
-0000bec0: 685f 6f72 5f62 7566 3a20 7374 7220 7c20  h_or_buf: str | 
-0000bed0: 494f 5b22 6279 7465 7322 5d2c 0a20 2020  IO["bytes"],.   
-0000bee0: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
-0000bef0: 6f72 6965 6e74 3a20 4c69 7465 7261 6c5b  orient: Literal[
-0000bf00: 0a20 2020 2020 2020 2020 2020 2022 7370  .            "sp
-0000bf10: 6c69 7422 2c20 2272 6563 6f72 6473 222c  lit", "records",
-0000bf20: 2022 696e 6465 7822 2c20 2263 6f6c 756d   "index", "colum
-0000bf30: 6e73 222c 2022 7661 6c75 6573 222c 2022  ns", "values", "
-0000bf40: 7461 626c 6522 0a20 2020 2020 2020 205d  table".        ]
-0000bf50: 203d 2022 636f 6c75 6d6e 7322 2c0a 2020   = "columns",.  
-0000bf60: 2020 2020 2020 6474 7970 653a 204f 7074        dtype: Opt
-0000bf70: 696f 6e61 6c5b 4469 6374 5d20 3d20 4e6f  ional[Dict] = No
-0000bf80: 6e65 2c0a 2020 2020 2020 2020 656e 636f  ne,.        enco
-0000bf90: 6469 6e67 3a20 4f70 7469 6f6e 616c 5b73  ding: Optional[s
-0000bfa0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-0000bfb0: 2020 2020 6c69 6e65 733a 2062 6f6f 6c20      lines: bool 
-0000bfc0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0000bfd0: 2065 6e67 696e 653a 204c 6974 6572 616c   engine: Literal
-0000bfe0: 5b22 756a 736f 6e22 2c20 2270 7961 7272  ["ujson", "pyarr
-0000bff0: 6f77 222c 2022 6269 6771 7565 7279 225d  ow", "bigquery"]
-0000c000: 203d 2022 756a 736f 6e22 2c0a 2020 2020   = "ujson",.    
-0000c010: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
-0000c020: 2020 2920 2d3e 2064 6174 6166 7261 6d65    ) -> dataframe
-0000c030: 2e44 6174 6146 7261 6d65 3a0a 2020 2020  .DataFrame:.    
-0000c040: 2020 2020 7461 626c 6520 3d20 6269 6766      table = bigf
-0000c050: 7261 6d65 735f 696f 2e72 616e 646f 6d5f  rames_io.random_
-0000c060: 7461 626c 6528 7365 6c66 2e5f 616e 6f6e  table(self._anon
-0000c070: 796d 6f75 735f 6461 7461 7365 7429 0a0a  ymous_dataset)..
-0000c080: 2020 2020 2020 2020 6966 2065 6e67 696e          if engin
-0000c090: 6520 3d3d 2022 6269 6771 7565 7279 223a  e == "bigquery":
-0000c0a0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000c0b0: 2064 7479 7065 2069 7320 6e6f 7420 4e6f   dtype is not No
-0000c0c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000c0d0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-0000c0e0: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
-0000c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c100: 2020 2022 4269 6751 7565 7279 2065 6e67     "BigQuery eng
-0000c110: 696e 6520 646f 6573 206e 6f74 2073 7570  ine does not sup
-0000c120: 706f 7274 2074 6865 2064 7479 7065 2061  port the dtype a
-0000c130: 7267 756d 656e 7473 2e22 0a20 2020 2020  rguments.".     
-0000c140: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000c150: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000c160: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
-0000c170: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-0000c180: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-0000c190: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000c1a0: 2020 2020 2020 2022 4f6e 6c79 206e 6577         "Only new
-0000c1b0: 6c69 6e65 2064 656c 696d 6974 6564 204a  line delimited J
-0000c1c0: 534f 4e20 666f 726d 6174 2069 7320 7375  SON format is su
-0000c1d0: 7070 6f72 7465 642e 220a 2020 2020 2020  pported.".      
-0000c1e0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000c1f0: 2020 2020 2020 2020 2069 6620 656e 636f           if enco
-0000c200: 6469 6e67 2069 7320 6e6f 7420 4e6f 6e65  ding is not None
-0000c210: 2061 6e64 2065 6e63 6f64 696e 6720 6e6f   and encoding no
-0000c220: 7420 696e 205f 5641 4c49 445f 454e 434f  t in _VALID_ENCO
-0000c230: 4449 4e47 533a 0a20 2020 2020 2020 2020  DINGS:.         
-0000c240: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-0000c250: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-0000c260: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c270: 2020 2020 2020 6622 4269 6751 7565 7279        f"BigQuery
-0000c280: 2065 6e67 696e 6520 6f6e 6c79 2073 7570   engine only sup
-0000c290: 706f 7274 7320 7468 6520 666f 6c6c 6f77  ports the follow
-0000c2a0: 696e 6720 656e 636f 6469 6e67 733a 207b  ing encodings: {
-0000c2b0: 5f56 414c 4944 5f45 4e43 4f44 494e 4753  _VALID_ENCODINGS
-0000c2c0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0000c2d0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0000c2e0: 2020 6966 206c 696e 6573 2061 6e64 206f    if lines and o
-0000c2f0: 7269 656e 7420 213d 2022 7265 636f 7264  rient != "record
-0000c300: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-0000c310: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000c320: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000c330: 2020 2020 2020 2020 2020 2227 6c69 6e65            "'line
-0000c340: 7327 206b 6579 776f 7264 2069 7320 6f6e  s' keyword is on
-0000c350: 6c79 2076 616c 6964 2077 6865 6e20 276f  ly valid when 'o
-0000c360: 7269 656e 7427 2069 7320 2772 6563 6f72  rient' is 'recor
-0000c370: 6473 272e 220a 2020 2020 2020 2020 2020  ds'.".          
-0000c380: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000c390: 2020 2020 206a 6f62 5f63 6f6e 6669 6720       job_config 
-0000c3a0: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
-0000c3b0: 6c6f 6164 5f6a 6f62 5f63 6f6e 6669 6728  load_job_config(
-0000c3c0: 290a 2020 2020 2020 2020 2020 2020 6a6f  ).            jo
-0000c3d0: 625f 636f 6e66 6967 2e63 7265 6174 655f  b_config.create_
-0000c3e0: 6469 7370 6f73 6974 696f 6e20 3d20 6269  disposition = bi
-0000c3f0: 6771 7565 7279 2e43 7265 6174 6544 6973  gquery.CreateDis
-0000c400: 706f 7369 7469 6f6e 2e43 5245 4154 455f  position.CREATE_
-0000c410: 4946 5f4e 4545 4445 440a 2020 2020 2020  IF_NEEDED.      
-0000c420: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-0000c430: 2e73 6f75 7263 655f 666f 726d 6174 203d  .source_format =
-0000c440: 2062 6967 7175 6572 792e 536f 7572 6365   bigquery.Source
-0000c450: 466f 726d 6174 2e4e 4557 4c49 4e45 5f44  Format.NEWLINE_D
-0000c460: 454c 494d 4954 4544 5f4a 534f 4e0a 2020  ELIMITED_JSON.  
-0000c470: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
-0000c480: 6e66 6967 2e77 7269 7465 5f64 6973 706f  nfig.write_dispo
-0000c490: 7369 7469 6f6e 203d 2062 6967 7175 6572  sition = bigquer
-0000c4a0: 792e 5772 6974 6544 6973 706f 7369 7469  y.WriteDispositi
-0000c4b0: 6f6e 2e57 5249 5445 5f45 4d50 5459 0a20  on.WRITE_EMPTY. 
-0000c4c0: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
-0000c4d0: 6f6e 6669 672e 6175 746f 6465 7465 6374  onfig.autodetect
-0000c4e0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0000c4f0: 2020 2020 6a6f 625f 636f 6e66 6967 2e65      job_config.e
-0000c500: 6e63 6f64 696e 6720 3d20 656e 636f 6469  ncoding = encodi
-0000c510: 6e67 0a20 2020 2020 2020 2020 2020 206a  ng.            j
-0000c520: 6f62 5f63 6f6e 6669 672e 6c61 6265 6c73  ob_config.labels
-0000c530: 203d 207b 2262 6967 6672 616d 6573 2d61   = {"bigframes-a
-0000c540: 7069 223a 2022 7265 6164 5f6a 736f 6e22  pi": "read_json"
-0000c550: 7d0a 0a20 2020 2020 2020 2020 2020 2072  }..            r
-0000c560: 6574 7572 6e20 7365 6c66 2e5f 7265 6164  eturn self._read
-0000c570: 5f62 6967 7175 6572 795f 6c6f 6164 5f6a  _bigquery_load_j
-0000c580: 6f62 280a 2020 2020 2020 2020 2020 2020  ob(.            
-0000c590: 2020 2020 7061 7468 5f6f 725f 6275 662c      path_or_buf,
-0000c5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c5b0: 2074 6162 6c65 2c0a 2020 2020 2020 2020   table,.        
-0000c5c0: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-0000c5d0: 6967 3d6a 6f62 5f63 6f6e 6669 672c 0a20  ig=job_config,. 
-0000c5e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000c5f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c600: 2020 2020 2020 2069 6620 616e 7928 6172         if any(ar
-0000c610: 6720 696e 206b 7761 7267 7320 666f 7220  g in kwargs for 
-0000c620: 6172 6720 696e 2028 2263 6875 6e6b 7369  arg in ("chunksi
-0000c630: 7a65 222c 2022 6974 6572 6174 6f72 2229  ze", "iterator")
-0000c640: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000c650: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000c660: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
-0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c680: 2020 2227 6368 756e 6b73 697a 6527 2061    "'chunksize' a
-0000c690: 6e64 2027 6974 6572 6174 6f72 2720 6172  nd 'iterator' ar
-0000c6a0: 6775 6d65 6e74 7320 6172 6520 6e6f 7420  guments are not 
-0000c6b0: 7375 7070 6f72 7465 642e 220a 2020 2020  supported.".    
-0000c6c0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000c6d0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0000c6e0: 696e 7374 616e 6365 2870 6174 685f 6f72  instance(path_or
-0000c6f0: 5f62 7566 2c20 7374 7229 3a0a 2020 2020  _buf, str):.    
-0000c700: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c710: 2e5f 6368 6563 6b5f 6669 6c65 5f73 697a  ._check_file_siz
-0000c720: 6528 7061 7468 5f6f 725f 6275 6629 0a0a  e(path_or_buf)..
-0000c730: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0000c740: 6e67 696e 6520 3d3d 2022 756a 736f 6e22  ngine == "ujson"
-0000c750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c760: 2020 7061 6e64 6173 5f64 6620 3d20 7061    pandas_df = pa
-0000c770: 6e64 6173 2e72 6561 645f 6a73 6f6e 2820  ndas.read_json( 
-0000c780: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
-0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7a0: 2020 2020 7061 7468 5f6f 725f 6275 662c      path_or_buf,
-0000c7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c7c0: 2020 2020 206f 7269 656e 743d 6f72 6965       orient=orie
-0000c7d0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-0000c7e0: 2020 2020 2020 2020 6474 7970 653d 6474          dtype=dt
-0000c7f0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-0000c800: 2020 2020 2020 2020 2065 6e63 6f64 696e           encodin
-0000c810: 673d 656e 636f 6469 6e67 2c0a 2020 2020  g=encoding,.    
-0000c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c830: 6c69 6e65 733d 6c69 6e65 732c 0a20 2020  lines=lines,.   
-0000c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c850: 202a 2a6b 7761 7267 732c 0a20 2020 2020   **kwargs,.     
-0000c860: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000c870: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c890: 7061 6e64 6173 5f64 6620 3d20 7061 6e64  pandas_df = pand
-0000c8a0: 6173 2e72 6561 645f 6a73 6f6e 2820 2023  as.read_json(  #
-0000c8b0: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
-0000c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8d0: 2020 7061 7468 5f6f 725f 6275 662c 0a20    path_or_buf,. 
-0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8f0: 2020 206f 7269 656e 743d 6f72 6965 6e74     orient=orient
-0000c900: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c910: 2020 2020 2020 6474 7970 653d 6474 7970        dtype=dtyp
-0000c920: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000c930: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
-0000c940: 656e 636f 6469 6e67 2c0a 2020 2020 2020  encoding,.      
-0000c950: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0000c960: 6e65 733d 6c69 6e65 732c 0a20 2020 2020  nes=lines,.     
-0000c970: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c980: 6e67 696e 653d 656e 6769 6e65 2c0a 2020  ngine=engine,.  
-0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9a0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-0000c9b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000c9c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000c9d0: 2073 656c 662e 5f72 6561 645f 7061 6e64   self._read_pand
-0000c9e0: 6173 2870 616e 6461 735f 6466 2c20 2272  as(pandas_df, "r
-0000c9f0: 6561 645f 6a73 6f6e 2229 0a0a 2020 2020  ead_json")..    
-0000ca00: 6465 6620 5f63 6865 636b 5f66 696c 655f  def _check_file_
-0000ca10: 7369 7a65 2873 656c 662c 2066 696c 6570  size(self, filep
-0000ca20: 6174 683a 2073 7472 293a 0a20 2020 2020  ath: str):.     
-0000ca30: 2020 206d 6178 5f73 697a 6520 3d20 3130     max_size = 10
-0000ca40: 3234 202a 2031 3032 3420 2a20 3130 3234  24 * 1024 * 1024
-0000ca50: 2020 2320 3120 4742 2069 6e20 6279 7465    # 1 GB in byte
-0000ca60: 730a 2020 2020 2020 2020 6966 2066 696c  s.        if fil
-0000ca70: 6570 6174 682e 7374 6172 7473 7769 7468  epath.startswith
-0000ca80: 2822 6773 3a2f 2f22 293a 2020 2320 4743  ("gs://"):  # GC
-0000ca90: 5320 6669 6c65 2070 6174 680a 2020 2020  S file path.    
-0000caa0: 2020 2020 2020 2020 636c 6965 6e74 203d          client =
-0000cab0: 2073 746f 7261 6765 2e43 6c69 656e 7428   storage.Client(
-0000cac0: 290a 2020 2020 2020 2020 2020 2020 6275  ).            bu
-0000cad0: 636b 6574 5f6e 616d 652c 2062 6c6f 625f  cket_name, blob_
-0000cae0: 6e61 6d65 203d 2066 696c 6570 6174 682e  name = filepath.
-0000caf0: 7370 6c69 7428 222f 222c 2033 295b 323a  split("/", 3)[2:
-0000cb00: 5d0a 2020 2020 2020 2020 2020 2020 6275  ].            bu
-0000cb10: 636b 6574 203d 2063 6c69 656e 742e 6275  cket = client.bu
-0000cb20: 636b 6574 2862 7563 6b65 745f 6e61 6d65  cket(bucket_name
-0000cb30: 290a 2020 2020 2020 2020 2020 2020 626c  ).            bl
-0000cb40: 6f62 203d 2062 7563 6b65 742e 626c 6f62  ob = bucket.blob
-0000cb50: 2862 6c6f 625f 6e61 6d65 290a 2020 2020  (blob_name).    
-0000cb60: 2020 2020 2020 2020 626c 6f62 2e72 656c          blob.rel
-0000cb70: 6f61 6428 290a 2020 2020 2020 2020 2020  oad().          
-0000cb80: 2020 6669 6c65 5f73 697a 6520 3d20 626c    file_size = bl
-0000cb90: 6f62 2e73 697a 650a 2020 2020 2020 2020  ob.size.        
-0000cba0: 656c 7365 3a20 2023 206c 6f63 616c 2066  else:  # local f
-0000cbb0: 696c 6520 7061 7468 0a20 2020 2020 2020  ile path.       
-0000cbc0: 2020 2020 2066 696c 655f 7369 7a65 203d       file_size =
-0000cbd0: 206f 732e 7061 7468 2e67 6574 7369 7a65   os.path.getsize
-0000cbe0: 2866 696c 6570 6174 6829 0a0a 2020 2020  (filepath)..    
-0000cbf0: 2020 2020 6966 2066 696c 655f 7369 7a65      if file_size
-0000cc00: 203e 206d 6178 5f73 697a 653a 0a20 2020   > max_size:.   
-0000cc10: 2020 2020 2020 2020 2023 2043 6f6e 7665           # Conve
-0000cc20: 7274 2074 6f20 4742 0a20 2020 2020 2020  rt to GB.       
-0000cc30: 2020 2020 2066 696c 655f 7369 7a65 203d       file_size =
-0000cc40: 2072 6f75 6e64 2866 696c 655f 7369 7a65   round(file_size
-0000cc50: 202f 2028 3130 3234 2a2a 3329 2c20 3129   / (1024**3), 1)
-0000cc60: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-0000cc70: 5f73 697a 6520 3d20 696e 7428 6d61 785f  _size = int(max_
-0000cc80: 7369 7a65 202f 2031 3032 342a 2a33 290a  size / 1024**3).
-0000cc90: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000cca0: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
-0000ccb0: 2020 2020 2020 2020 2020 2020 6622 4669              f"Fi
-0000ccc0: 6c65 2073 697a 6520 7b66 696c 655f 7369  le size {file_si
-0000ccd0: 7a65 7d47 4220 6578 6365 6564 7320 7b6d  ze}GB exceeds {m
-0000cce0: 6178 5f73 697a 657d 4742 2e20 220a 2020  ax_size}GB. ".  
-0000ccf0: 2020 2020 2020 2020 2020 2020 2020 2249                "I
-0000cd00: 7420 6973 2072 6563 6f6d 6d65 6e64 6564  t is recommended
-0000cd10: 2074 6f20 7573 6520 656e 6769 6e65 3d27   to use engine='
-0000cd20: 6269 6771 7565 7279 2720 220a 2020 2020  bigquery' ".    
-0000cd30: 2020 2020 2020 2020 2020 2020 2266 6f72              "for
-0000cd40: 206c 6172 6765 2066 696c 6573 2074 6f20   large files to 
-0000cd50: 6176 6f69 6420 6c6f 6164 696e 6720 7468  avoid loading th
-0000cd60: 6520 6669 6c65 2069 6e74 6f20 6c6f 6361  e file into loca
-0000cd70: 6c20 6d65 6d6f 7279 2e22 0a20 2020 2020  l memory.".     
-0000cd80: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000cd90: 6620 5f63 7265 6174 655f 656d 7074 795f  f _create_empty_
-0000cda0: 7465 6d70 5f74 6162 6c65 280a 2020 2020  temp_table(.    
-0000cdb0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0000cdc0: 2020 7363 6865 6d61 3a20 4974 6572 6162    schema: Iterab
-0000cdd0: 6c65 5b62 6967 7175 6572 792e 5363 6865  le[bigquery.Sche
-0000cde0: 6d61 4669 656c 645d 2c0a 2020 2020 2020  maField],.      
-0000cdf0: 2020 636c 7573 7465 725f 636f 6c73 3a20    cluster_cols: 
-0000ce00: 4c69 7374 5b73 7472 5d2c 0a20 2020 2029  List[str],.    )
-0000ce10: 202d 3e20 6269 6771 7565 7279 2e54 6162   -> bigquery.Tab
-0000ce20: 6c65 5265 6665 7265 6e63 653a 0a20 2020  leReference:.   
-0000ce30: 2020 2020 2023 2043 616e 2774 2073 6574       # Can't set
-0000ce40: 2061 2074 6162 6c65 2069 6e20 5f53 4553   a table in _SES
-0000ce50: 5349 4f4e 2061 7320 6465 7374 696e 6174  SION as destinat
-0000ce60: 696f 6e20 7669 6120 7175 6572 7920 6a6f  ion via query jo
-0000ce70: 6220 4150 492c 2073 6f20 7765 0a20 2020  b API, so we.   
-0000ce80: 2020 2020 2023 2072 756e 2044 444c 2c20       # run DDL, 
-0000ce90: 696e 7374 6561 642e 0a20 2020 2020 2020  instead..       
-0000cea0: 2064 6174 6173 6574 203d 2073 656c 662e   dataset = self.
-0000ceb0: 5f61 6e6f 6e79 6d6f 7573 5f64 6174 6173  _anonymous_datas
-0000cec0: 6574 0a20 2020 2020 2020 2065 7870 6972  et.        expir
-0000ced0: 6174 696f 6e20 3d20 280a 2020 2020 2020  ation = (.      
-0000cee0: 2020 2020 2020 6461 7465 7469 6d65 2e64        datetime.d
-0000cef0: 6174 6574 696d 652e 6e6f 7728 6461 7465  atetime.now(date
-0000cf00: 7469 6d65 2e74 696d 657a 6f6e 652e 7574  time.timezone.ut
-0000cf10: 6329 202b 2063 6f6e 7374 616e 7473 2e44  c) + constants.D
-0000cf20: 4546 4155 4c54 5f45 5850 4952 4154 494f  EFAULT_EXPIRATIO
-0000cf30: 4e0a 2020 2020 2020 2020 290a 0a20 2020  N.        )..   
-0000cf40: 2020 2020 2074 6162 6c65 203d 2062 6967       table = big
-0000cf50: 6672 616d 6573 5f69 6f2e 6372 6561 7465  frames_io.create
-0000cf60: 5f74 656d 705f 7461 626c 6528 0a20 2020  _temp_table(.   
-0000cf70: 2020 2020 2020 2020 2073 656c 662e 6271           self.bq
-0000cf80: 636c 6965 6e74 2c0a 2020 2020 2020 2020  client,.        
-0000cf90: 2020 2020 6461 7461 7365 742c 0a20 2020      dataset,.   
-0000cfa0: 2020 2020 2020 2020 2065 7870 6972 6174           expirat
-0000cfb0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000cfc0: 2073 6368 656d 613d 7363 6865 6d61 2c0a   schema=schema,.
-0000cfd0: 2020 2020 2020 2020 2020 2020 636c 7573              clus
-0000cfe0: 7465 725f 636f 6c75 6d6e 733d 636c 7573  ter_columns=clus
-0000cff0: 7465 725f 636f 6c73 2c0a 2020 2020 2020  ter_cols,.      
-0000d000: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0000d010: 726e 2062 6967 7175 6572 792e 5461 626c  rn bigquery.Tabl
-0000d020: 6552 6566 6572 656e 6365 2e66 726f 6d5f  eReference.from_
-0000d030: 7374 7269 6e67 2874 6162 6c65 290a 0a20  string(table).. 
-0000d040: 2020 2064 6566 205f 6372 6561 7465 5f74     def _create_t
-0000d050: 6f74 616c 5f6f 7264 6572 696e 6728 0a20  otal_ordering(. 
-0000d060: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000d070: 2020 2020 2074 6162 6c65 3a20 6962 6973       table: ibis
-0000d080: 5f74 7970 6573 2e54 6162 6c65 2c0a 2020  _types.Table,.  
-0000d090: 2020 2920 2d3e 2063 6f72 652e 4172 7261    ) -> core.Arra
-0000d0a0: 7956 616c 7565 3a0a 2020 2020 2020 2020  yValue:.        
-0000d0b0: 2320 5369 6e63 6520 7468 6973 206d 6967  # Since this mig
-0000d0c0: 6874 2061 6c73 6f20 6265 2075 7365 6420  ht also be used 
-0000d0d0: 6173 2074 6865 2069 6e64 6578 2c20 646f  as the index, do
-0000d0e0: 6e27 7420 7573 6520 7468 6520 6465 6661  n't use the defa
-0000d0f0: 756c 740a 2020 2020 2020 2020 2320 226f  ult.        # "o
-0000d100: 7264 6572 696e 6720 4944 2220 6e61 6d65  rdering ID" name
-0000d110: 2e0a 2020 2020 2020 2020 6f72 6465 7269  ..        orderi
-0000d120: 6e67 5f68 6173 685f 7061 7274 203d 2067  ng_hash_part = g
-0000d130: 7569 642e 6765 6e65 7261 7465 5f67 7569  uid.generate_gui
-0000d140: 6428 2262 6967 6672 616d 6573 5f6f 7264  d("bigframes_ord
-0000d150: 6572 696e 675f 2229 0a20 2020 2020 2020  ering_").       
-0000d160: 206f 7264 6572 696e 675f 7261 6e64 5f70   ordering_rand_p
-0000d170: 6172 7420 3d20 6775 6964 2e67 656e 6572  art = guid.gener
-0000d180: 6174 655f 6775 6964 2822 6269 6766 7261  ate_guid("bigfra
-0000d190: 6d65 735f 6f72 6465 7269 6e67 5f22 290a  mes_ordering_").
-0000d1a0: 0a20 2020 2020 2020 2023 2041 6c6c 2069  .        # All i
-0000d1b0: 6e70 7574 7320 696e 746f 2068 6173 6820  nputs into hash 
-0000d1c0: 6d75 7374 2062 6520 6e6f 6e2d 6e75 6c6c  must be non-null
-0000d1d0: 206f 7220 7265 7375 6c74 696e 6720 6861   or resulting ha
-0000d1e0: 7368 2077 696c 6c20 6265 206e 756c 6c0a  sh will be null.
-0000d1f0: 2020 2020 2020 2020 7374 725f 7661 6c75          str_valu
-0000d200: 6573 203d 206c 6973 7428 0a20 2020 2020  es = list(.     
-0000d210: 2020 2020 2020 206d 6170 286c 616d 6264         map(lambd
-0000d220: 6120 636f 6c3a 205f 636f 6e76 6572 745f  a col: _convert_
-0000d230: 746f 5f6e 6f6e 6e75 6c6c 5f73 7472 696e  to_nonnull_strin
-0000d240: 6728 7461 626c 655b 636f 6c5d 292c 2074  g(table[col]), t
-0000d250: 6162 6c65 2e63 6f6c 756d 6e73 290a 2020  able.columns).  
-0000d260: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d270: 6675 6c6c 5f72 6f77 5f73 7472 203d 2028  full_row_str = (
-0000d280: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0000d290: 5f76 616c 7565 735b 305d 2e63 6f6e 6361  _values[0].conca
-0000d2a0: 7428 2a73 7472 5f76 616c 7565 735b 313a  t(*str_values[1:
-0000d2b0: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-0000d2c0: 6620 6c65 6e28 7374 725f 7661 6c75 6573  f len(str_values
-0000d2d0: 2920 3e20 310a 2020 2020 2020 2020 2020  ) > 1.          
-0000d2e0: 2020 656c 7365 2073 7472 5f76 616c 7565    else str_value
-0000d2f0: 735b 305d 0a20 2020 2020 2020 2029 0a20  s[0].        ). 
-0000d300: 2020 2020 2020 2066 756c 6c5f 726f 775f         full_row_
-0000d310: 6861 7368 203d 2066 756c 6c5f 726f 775f  hash = full_row_
-0000d320: 7374 722e 6861 7368 2829 2e6e 616d 6528  str.hash().name(
-0000d330: 6f72 6465 7269 6e67 5f68 6173 685f 7061  ordering_hash_pa
-0000d340: 7274 290a 2020 2020 2020 2020 2320 5573  rt).        # Us
-0000d350: 6564 2074 6f20 6469 7361 6d62 6967 7561  ed to disambigua
-0000d360: 7465 2062 6574 7765 656e 2069 6465 6e74  te between ident
-0000d370: 6963 616c 2072 6f77 7320 2877 6869 6368  ical rows (which
-0000d380: 2077 696c 6c20 6861 7665 2069 6465 6e74   will have ident
-0000d390: 6963 616c 2068 6173 6829 0a20 2020 2020  ical hash).     
-0000d3a0: 2020 2072 616e 646f 6d5f 7661 6c75 6520     random_value 
-0000d3b0: 3d20 6962 6973 2e72 616e 646f 6d28 292e  = ibis.random().
-0000d3c0: 6e61 6d65 286f 7264 6572 696e 675f 7261  name(ordering_ra
-0000d3d0: 6e64 5f70 6172 7429 0a0a 2020 2020 2020  nd_part)..      
-0000d3e0: 2020 6f72 6967 696e 616c 5f63 6f6c 756d    original_colum
-0000d3f0: 6e5f 6964 7320 3d20 7461 626c 652e 636f  n_ids = table.co
-0000d400: 6c75 6d6e 730a 2020 2020 2020 2020 7461  lumns.        ta
-0000d410: 626c 655f 7769 7468 5f6f 7264 6572 696e  ble_with_orderin
-0000d420: 6720 3d20 7461 626c 652e 7365 6c65 6374  g = table.select
-0000d430: 280a 2020 2020 2020 2020 2020 2020 6974  (.            it
-0000d440: 6572 746f 6f6c 732e 6368 6169 6e28 6f72  ertools.chain(or
-0000d450: 6967 696e 616c 5f63 6f6c 756d 6e5f 6964  iginal_column_id
-0000d460: 732c 205b 6675 6c6c 5f72 6f77 5f68 6173  s, [full_row_has
-0000d470: 682c 2072 616e 646f 6d5f 7661 6c75 655d  h, random_value]
-0000d480: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-0000d490: 2020 2020 206f 7264 6572 696e 675f 7265       ordering_re
-0000d4a0: 6631 203d 206f 7264 6572 2e61 7363 656e  f1 = order.ascen
-0000d4b0: 6469 6e67 5f6f 7665 7228 6f72 6465 7269  ding_over(orderi
-0000d4c0: 6e67 5f68 6173 685f 7061 7274 290a 2020  ng_hash_part).  
-0000d4d0: 2020 2020 2020 6f72 6465 7269 6e67 5f72        ordering_r
-0000d4e0: 6566 3220 3d20 6f72 6465 722e 6173 6365  ef2 = order.asce
-0000d4f0: 6e64 696e 675f 6f76 6572 286f 7264 6572  nding_over(order
-0000d500: 696e 675f 7261 6e64 5f70 6172 7429 0a20  ing_rand_part). 
-0000d510: 2020 2020 2020 206f 7264 6572 696e 6720         ordering 
-0000d520: 3d20 6f72 6465 722e 4578 7072 6573 7369  = order.Expressi
-0000d530: 6f6e 4f72 6465 7269 6e67 280a 2020 2020  onOrdering(.    
-0000d540: 2020 2020 2020 2020 6f72 6465 7269 6e67          ordering
-0000d550: 5f76 616c 7565 5f63 6f6c 756d 6e73 3d28  _value_columns=(
-0000d560: 6f72 6465 7269 6e67 5f72 6566 312c 206f  ordering_ref1, o
-0000d570: 7264 6572 696e 675f 7265 6632 292c 0a20  rdering_ref2),. 
-0000d580: 2020 2020 2020 2020 2020 2074 6f74 616c             total
-0000d590: 5f6f 7264 6572 696e 675f 636f 6c75 6d6e  _ordering_column
-0000d5a0: 733d 6672 6f7a 656e 7365 7428 5b6f 7264  s=frozenset([ord
-0000d5b0: 6572 696e 675f 6861 7368 5f70 6172 742c  ering_hash_part,
-0000d5c0: 206f 7264 6572 696e 675f 7261 6e64 5f70   ordering_rand_p
-0000d5d0: 6172 745d 292c 0a20 2020 2020 2020 2029  art]),.        )
-0000d5e0: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
-0000d5f0: 203d 205b 7461 626c 655f 7769 7468 5f6f   = [table_with_o
-0000d600: 7264 6572 696e 675b 636f 6c5d 2066 6f72  rdering[col] for
-0000d610: 2063 6f6c 2069 6e20 6f72 6967 696e 616c   col in original
-0000d620: 5f63 6f6c 756d 6e5f 6964 735d 0a20 2020  _column_ids].   
-0000d630: 2020 2020 2068 6964 6465 6e5f 636f 6c75       hidden_colu
-0000d640: 6d6e 7320 3d20 5b0a 2020 2020 2020 2020  mns = [.        
-0000d650: 2020 2020 7461 626c 655f 7769 7468 5f6f      table_with_o
-0000d660: 7264 6572 696e 675b 6f72 6465 7269 6e67  rdering[ordering
-0000d670: 5f68 6173 685f 7061 7274 5d2c 0a20 2020  _hash_part],.   
-0000d680: 2020 2020 2020 2020 2074 6162 6c65 5f77           table_w
-0000d690: 6974 685f 6f72 6465 7269 6e67 5b6f 7264  ith_ordering[ord
-0000d6a0: 6572 696e 675f 7261 6e64 5f70 6172 745d  ering_rand_part]
-0000d6b0: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
-0000d6c0: 2020 2020 7265 7475 726e 2063 6f72 652e      return core.
-0000d6d0: 4172 7261 7956 616c 7565 2e66 726f 6d5f  ArrayValue.from_
-0000d6e0: 6962 6973 280a 2020 2020 2020 2020 2020  ibis(.          
-0000d6f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000d700: 2020 2020 7461 626c 655f 7769 7468 5f6f      table_with_o
-0000d710: 7264 6572 696e 672c 0a20 2020 2020 2020  rdering,.       
-0000d720: 2020 2020 2063 6f6c 756d 6e73 2c0a 2020       columns,.  
-0000d730: 2020 2020 2020 2020 2020 6869 6464 656e            hidden
-0000d740: 5f6f 7264 6572 696e 675f 636f 6c75 6d6e  _ordering_column
-0000d750: 733d 6869 6464 656e 5f63 6f6c 756d 6e73  s=hidden_columns
-0000d760: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
-0000d770: 6465 7269 6e67 3d6f 7264 6572 696e 672c  dering=ordering,
-0000d780: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000d790: 6465 6620 5f69 6269 735f 746f 5f74 656d  def _ibis_to_tem
-0000d7a0: 705f 7461 626c 6528 0a20 2020 2020 2020  p_table(.       
-0000d7b0: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
-0000d7c0: 6162 6c65 3a20 6962 6973 5f74 7970 6573  able: ibis_types
-0000d7d0: 2e54 6162 6c65 2c0a 2020 2020 2020 2020  .Table,.        
-0000d7e0: 636c 7573 7465 725f 636f 6c73 3a20 4974  cluster_cols: It
-0000d7f0: 6572 6162 6c65 5b73 7472 5d2c 0a20 2020  erable[str],.   
-0000d800: 2020 2020 2061 7069 5f6e 616d 653a 2073       api_name: s
-0000d810: 7472 2c0a 2020 2020 2920 2d3e 2062 6967  tr,.    ) -> big
-0000d820: 7175 6572 792e 5461 626c 6552 6566 6572  query.TableRefer
-0000d830: 656e 6365 3a0a 2020 2020 2020 2020 6465  ence:.        de
-0000d840: 7374 696e 6174 696f 6e2c 205f 203d 2073  stination, _ = s
-0000d850: 656c 662e 5f71 7565 7279 5f74 6f5f 6465  elf._query_to_de
-0000d860: 7374 696e 6174 696f 6e28 0a20 2020 2020  stination(.     
-0000d870: 2020 2020 2020 2073 656c 662e 6962 6973         self.ibis
-0000d880: 5f63 6c69 656e 742e 636f 6d70 696c 6528  _client.compile(
-0000d890: 7461 626c 6529 2c0a 2020 2020 2020 2020  table),.        
-0000d8a0: 2020 2020 696e 6465 785f 636f 6c73 3d6c      index_cols=l
-0000d8b0: 6973 7428 636c 7573 7465 725f 636f 6c73  ist(cluster_cols
-0000d8c0: 292c 0a20 2020 2020 2020 2020 2020 2061  ),.            a
-0000d8d0: 7069 5f6e 616d 653d 6170 695f 6e61 6d65  pi_name=api_name
-0000d8e0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-0000d8f0: 2020 2020 2320 5468 6572 6520 7368 6f75      # There shou
-0000d900: 6c64 2061 6c77 6179 7320 6265 2061 2064  ld always be a d
-0000d910: 6573 7469 6e61 7469 6f6e 2074 6162 6c65  estination table
-0000d920: 2066 6f72 2074 6869 7320 7175 6572 7920   for this query 
-0000d930: 7479 7065 2e0a 2020 2020 2020 2020 7265  type..        re
-0000d940: 7475 726e 2074 7970 696e 672e 6361 7374  turn typing.cast
-0000d950: 2862 6967 7175 6572 792e 5461 626c 6552  (bigquery.TableR
-0000d960: 6566 6572 656e 6365 2c20 6465 7374 696e  eference, destin
-0000d970: 6174 696f 6e29 0a0a 2020 2020 6465 6620  ation)..    def 
-0000d980: 7265 6d6f 7465 5f66 756e 6374 696f 6e28  remote_function(
-0000d990: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0000d9a0: 2020 2020 2020 2069 6e70 7574 5f74 7970         input_typ
-0000d9b0: 6573 3a20 4c69 7374 5b74 7970 655d 2c0a  es: List[type],.
-0000d9c0: 2020 2020 2020 2020 6f75 7470 7574 5f74          output_t
-0000d9d0: 7970 653a 2074 7970 652c 0a20 2020 2020  ype: type,.     
-0000d9e0: 2020 2064 6174 6173 6574 3a20 4f70 7469     dataset: Opti
-0000d9f0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0000da00: 2c0a 2020 2020 2020 2020 6269 6771 7565  ,.        bigque
-0000da10: 7279 5f63 6f6e 6e65 6374 696f 6e3a 204f  ry_connection: O
-0000da20: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000da30: 6f6e 652c 0a20 2020 2020 2020 2072 6575  one,.        reu
-0000da40: 7365 3a20 626f 6f6c 203d 2054 7275 652c  se: bool = True,
-0000da50: 0a20 2020 2020 2020 206e 616d 653a 204f  .        name: O
-0000da60: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000da70: 6f6e 652c 0a20 2020 2020 2020 2070 6163  one,.        pac
-0000da80: 6b61 6765 733a 204f 7074 696f 6e61 6c5b  kages: Optional[
-0000da90: 5365 7175 656e 6365 5b73 7472 5d5d 203d  Sequence[str]] =
-0000daa0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-0000dab0: 6c6f 7564 5f66 756e 6374 696f 6e5f 7365  loud_function_se
-0000dac0: 7276 6963 655f 6163 636f 756e 743a 204f  rvice_account: O
-0000dad0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000dae0: 6f6e 652c 0a20 2020 2020 2020 2063 6c6f  one,.        clo
-0000daf0: 7564 5f66 756e 6374 696f 6e5f 6b6d 735f  ud_function_kms_
-0000db00: 6b65 795f 6e61 6d65 3a20 4f70 7469 6f6e  key_name: Option
-0000db10: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0000db20: 2020 2020 2020 2020 636c 6f75 645f 6675          cloud_fu
-0000db30: 6e63 7469 6f6e 5f64 6f63 6b65 725f 7265  nction_docker_re
-0000db40: 706f 7369 746f 7279 3a20 4f70 7469 6f6e  pository: Option
-0000db50: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0000db60: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0000db70: 2222 4465 636f 7261 746f 7220 746f 2074  ""Decorator to t
-0000db80: 7572 6e20 6120 7573 6572 2064 6566 696e  urn a user defin
-0000db90: 6564 2066 756e 6374 696f 6e20 696e 746f  ed function into
-0000dba0: 2061 2042 6967 5175 6572 7920 7265 6d6f   a BigQuery remo
-0000dbb0: 7465 2066 756e 6374 696f 6e2e 2043 6865  te function. Che
-0000dbc0: 636b 206f 7574 0a20 2020 2020 2020 2074  ck out.        t
-0000dbd0: 6865 2063 6f64 6520 7361 6d70 6c65 7320  he code samples 
-0000dbe0: 6174 3a20 6874 7470 733a 2f2f 636c 6f75  at: https://clou
-0000dbf0: 642e 676f 6f67 6c65 2e63 6f6d 2f62 6967  d.google.com/big
-0000dc00: 7175 6572 792f 646f 6373 2f72 656d 6f74  query/docs/remot
-0000dc10: 652d 6675 6e63 7469 6f6e 7323 6269 6771  e-functions#bigq
-0000dc20: 7565 7279 2d64 6174 6166 7261 6d65 732e  uery-dataframes.
-0000dc30: 0a0a 2020 2020 2020 2020 2e2e 206e 6f74  ..        .. not
-0000dc40: 653a 3a0a 2020 2020 2020 2020 2020 2020  e::.            
-0000dc50: 506c 6561 7365 206d 616b 6520 7375 7265  Please make sure
-0000dc60: 2066 6f6c 6c6f 7769 6e67 2069 7320 7365   following is se
-0000dc70: 7475 7020 6265 666f 7265 2075 7369 6e67  tup before using
-0000dc80: 2074 6869 7320 4150 493a 0a0a 2020 2020   this API:..    
-0000dc90: 2020 2020 312e 2048 6176 6520 7468 6520      1. Have the 
-0000dca0: 6265 6c6f 7720 4150 4973 2065 6e61 626c  below APIs enabl
-0000dcb0: 6564 2066 6f72 2079 6f75 7220 7072 6f6a  ed for your proj
-0000dcc0: 6563 743a 0a0a 2020 2020 2020 2020 2020  ect:..          
-0000dcd0: 2020 2a20 4269 6751 7565 7279 2043 6f6e    * BigQuery Con
-0000dce0: 6e65 6374 696f 6e20 4150 490a 2020 2020  nection API.    
-0000dcf0: 2020 2020 2020 2020 2a20 436c 6f75 6420          * Cloud 
-0000dd00: 4675 6e63 7469 6f6e 7320 4150 490a 2020  Functions API.  
-0000dd10: 2020 2020 2020 2020 2020 2a20 436c 6f75            * Clou
-0000dd20: 6420 5275 6e20 4150 490a 2020 2020 2020  d Run API.      
-0000dd30: 2020 2020 2020 2a20 436c 6f75 6420 4275        * Cloud Bu
-0000dd40: 696c 6420 4150 490a 2020 2020 2020 2020  ild API.        
-0000dd50: 2020 2020 2a20 4172 7469 6661 6374 2052      * Artifact R
-0000dd60: 6567 6973 7472 7920 4150 490a 2020 2020  egistry API.    
-0000dd70: 2020 2020 2020 2020 2a20 436c 6f75 6420          * Cloud 
-0000dd80: 5265 736f 7572 6365 204d 616e 6167 6572  Resource Manager
-0000dd90: 2041 5049 0a0a 2020 2020 2020 2020 2020   API..          
-0000dda0: 2054 6869 7320 6361 6e20 6265 2064 6f6e   This can be don
-0000ddb0: 6520 6672 6f6d 2074 6865 2063 6c6f 7564  e from the cloud
-0000ddc0: 2063 6f6e 736f 6c65 2028 6368 616e 6765   console (change
-0000ddd0: 2060 5052 4f4a 4543 545f 4944 6020 746f   `PROJECT_ID` to
-0000dde0: 2079 6f75 7273 293a 0a20 2020 2020 2020   yours):.       
-0000ddf0: 2020 2020 6874 7470 733a 2f2f 636f 6e73      https://cons
-0000de00: 6f6c 652e 636c 6f75 642e 676f 6f67 6c65  ole.cloud.google
-0000de10: 2e63 6f6d 2f61 7069 732f 656e 6162 6c65  .com/apis/enable
-0000de20: 666c 6f77 3f61 7069 6964 3d62 6967 7175  flow?apiid=bigqu
-0000de30: 6572 7963 6f6e 6e65 6374 696f 6e2e 676f  eryconnection.go
-0000de40: 6f67 6c65 6170 6973 2e63 6f6d 2c63 6c6f  ogleapis.com,clo
-0000de50: 7564 6675 6e63 7469 6f6e 732e 676f 6f67  udfunctions.goog
-0000de60: 6c65 6170 6973 2e63 6f6d 2c72 756e 2e67  leapis.com,run.g
-0000de70: 6f6f 676c 6561 7069 732e 636f 6d2c 636c  oogleapis.com,cl
-0000de80: 6f75 6462 7569 6c64 2e67 6f6f 676c 6561  oudbuild.googlea
-0000de90: 7069 732e 636f 6d2c 6172 7469 6661 6374  pis.com,artifact
-0000dea0: 7265 6769 7374 7279 2e67 6f6f 676c 6561  registry.googlea
-0000deb0: 7069 732e 636f 6d2c 636c 6f75 6472 6573  pis.com,cloudres
-0000dec0: 6f75 7263 656d 616e 6167 6572 2e67 6f6f  ourcemanager.goo
-0000ded0: 676c 6561 7069 732e 636f 6d26 7072 6f6a  gleapis.com&proj
-0000dee0: 6563 743d 5052 4f4a 4543 545f 4944 0a0a  ect=PROJECT_ID..
-0000def0: 2020 2020 2020 2020 2020 204f 7220 6672             Or fr
-0000df00: 6f6d 2074 6865 2067 636c 6f75 6420 434c  om the gcloud CL
-0000df10: 493a 0a0a 2020 2020 2020 2020 2020 2060  I:..           `
-0000df20: 2420 6763 6c6f 7564 2073 6572 7669 6365  $ gcloud service
-0000df30: 7320 656e 6162 6c65 2062 6967 7175 6572  s enable bigquer
-0000df40: 7963 6f6e 6e65 6374 696f 6e2e 676f 6f67  yconnection.goog
-0000df50: 6c65 6170 6973 2e63 6f6d 2063 6c6f 7564  leapis.com cloud
-0000df60: 6675 6e63 7469 6f6e 732e 676f 6f67 6c65  functions.google
-0000df70: 6170 6973 2e63 6f6d 2072 756e 2e67 6f6f  apis.com run.goo
-0000df80: 676c 6561 7069 732e 636f 6d20 636c 6f75  gleapis.com clou
-0000df90: 6462 7569 6c64 2e67 6f6f 676c 6561 7069  dbuild.googleapi
-0000dfa0: 732e 636f 6d20 6172 7469 6661 6374 7265  s.com artifactre
-0000dfb0: 6769 7374 7279 2e67 6f6f 676c 6561 7069  gistry.googleapi
-0000dfc0: 732e 636f 6d20 636c 6f75 6472 6573 6f75  s.com cloudresou
-0000dfd0: 7263 656d 616e 6167 6572 2e67 6f6f 676c  rcemanager.googl
-0000dfe0: 6561 7069 732e 636f 6d60 0a0a 2020 2020  eapis.com`..    
-0000dff0: 2020 2020 322e 2048 6176 6520 666f 6c6c      2. Have foll
-0000e000: 6f77 696e 6720 4941 4d20 726f 6c65 7320  owing IAM roles 
-0000e010: 656e 6162 6c65 6420 666f 7220 796f 753a  enabled for you:
-0000e020: 0a0a 2020 2020 2020 2020 2020 2020 2a20  ..            * 
-0000e030: 4269 6751 7565 7279 2044 6174 6120 4564  BigQuery Data Ed
-0000e040: 6974 6f72 2028 726f 6c65 732f 6269 6771  itor (roles/bigq
-0000e050: 7565 7279 2e64 6174 6145 6469 746f 7229  uery.dataEditor)
-0000e060: 0a20 2020 2020 2020 2020 2020 202a 2042  .            * B
-0000e070: 6967 5175 6572 7920 436f 6e6e 6563 7469  igQuery Connecti
-0000e080: 6f6e 2041 646d 696e 2028 726f 6c65 732f  on Admin (roles/
-0000e090: 6269 6771 7565 7279 2e63 6f6e 6e65 6374  bigquery.connect
-0000e0a0: 696f 6e41 646d 696e 290a 2020 2020 2020  ionAdmin).      
-0000e0b0: 2020 2020 2020 2a20 436c 6f75 6420 4675        * Cloud Fu
-0000e0c0: 6e63 7469 6f6e 7320 4465 7665 6c6f 7065  nctions Develope
-0000e0d0: 7220 2872 6f6c 6573 2f63 6c6f 7564 6675  r (roles/cloudfu
-0000e0e0: 6e63 7469 6f6e 732e 6465 7665 6c6f 7065  nctions.develope
-0000e0f0: 7229 0a20 2020 2020 2020 2020 2020 202a  r).            *
-0000e100: 2053 6572 7669 6365 2041 6363 6f75 6e74   Service Account
-0000e110: 2055 7365 7220 2872 6f6c 6573 2f69 616d   User (roles/iam
-0000e120: 2e73 6572 7669 6365 4163 636f 756e 7455  .serviceAccountU
-0000e130: 7365 7229 206f 6e20 7468 6520 7365 7276  ser) on the serv
-0000e140: 6963 6520 6163 636f 756e 7420 6050 524f  ice account `PRO
-0000e150: 4a45 4354 5f4e 554d 4245 522d 636f 6d70  JECT_NUMBER-comp
-0000e160: 7574 6540 6465 7665 6c6f 7065 722e 6773  ute@developer.gs
-0000e170: 6572 7669 6365 6163 636f 756e 742e 636f  erviceaccount.co
-0000e180: 6d60 0a20 2020 2020 2020 2020 2020 202a  m`.            *
-0000e190: 2053 746f 7261 6765 204f 626a 6563 7420   Storage Object 
-0000e1a0: 5669 6577 6572 2028 726f 6c65 732f 7374  Viewer (roles/st
-0000e1b0: 6f72 6167 652e 6f62 6a65 6374 5669 6577  orage.objectView
-0000e1c0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0000e1d0: 2a20 5072 6f6a 6563 7420 4941 4d20 4164  * Project IAM Ad
-0000e1e0: 6d69 6e20 2872 6f6c 6573 2f72 6573 6f75  min (roles/resou
-0000e1f0: 7263 656d 616e 6167 6572 2e70 726f 6a65  rcemanager.proje
-0000e200: 6374 4961 6d41 646d 696e 2920 284f 6e6c  ctIamAdmin) (Onl
-0000e210: 7920 7265 7175 6972 6564 2069 6620 7468  y required if th
-0000e220: 6520 6269 6771 7565 7279 2063 6f6e 6e65  e bigquery conne
-0000e230: 6374 696f 6e20 6265 696e 6720 7573 6564  ction being used
-0000e240: 2069 7320 6e6f 7420 7072 652d 6372 6561   is not pre-crea
-0000e250: 7465 6420 616e 6420 6973 2063 7265 6174  ted and is creat
-0000e260: 6564 2064 796e 616d 6963 616c 6c79 2077  ed dynamically w
-0000e270: 6974 6820 7573 6572 2063 7265 6465 6e74  ith user credent
-0000e280: 6961 6c73 2e29 0a0a 2020 2020 2020 2020  ials.)..        
-0000e290: 332e 2045 6974 6865 7220 7468 6520 7573  3. Either the us
-0000e2a0: 6572 2068 6173 2073 6574 4961 6d50 6f6c  er has setIamPol
-0000e2b0: 6963 7920 7072 6976 696c 6567 6520 6f6e  icy privilege on
-0000e2c0: 2074 6865 2070 726f 6a65 6374 2c20 6f72   the project, or
-0000e2d0: 2061 2042 6967 5175 6572 7920 636f 6e6e   a BigQuery conn
-0000e2e0: 6563 7469 6f6e 2069 7320 7072 652d 6372  ection is pre-cr
-0000e2f0: 6561 7465 6420 7769 7468 206e 6563 6573  eated with neces
-0000e300: 7361 7279 2049 414d 2072 6f6c 6520 7365  sary IAM role se
-0000e310: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
-0000e320: 312e 2054 6f20 6372 6561 7465 2061 2063  1. To create a c
-0000e330: 6f6e 6e65 6374 696f 6e2c 2066 6f6c 6c6f  onnection, follo
-0000e340: 7720 6874 7470 733a 2f2f 636c 6f75 642e  w https://cloud.
-0000e350: 676f 6f67 6c65 2e63 6f6d 2f62 6967 7175  google.com/bigqu
-0000e360: 6572 792f 646f 6373 2f72 6566 6572 656e  ery/docs/referen
-0000e370: 6365 2f73 7461 6e64 6172 642d 7371 6c2f  ce/standard-sql/
-0000e380: 7265 6d6f 7465 2d66 756e 6374 696f 6e73  remote-functions
-0000e390: 2363 7265 6174 655f 615f 636f 6e6e 6563  #create_a_connec
-0000e3a0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0000e3b0: 2032 2e20 546f 2073 6574 2075 7020 4941   2. To set up IA
-0000e3c0: 4d2c 2066 6f6c 6c6f 7720 6874 7470 733a  M, follow https:
-0000e3d0: 2f2f 636c 6f75 642e 676f 6f67 6c65 2e63  //cloud.google.c
-0000e3e0: 6f6d 2f62 6967 7175 6572 792f 646f 6373  om/bigquery/docs
-0000e3f0: 2f72 6566 6572 656e 6365 2f73 7461 6e64  /reference/stand
-0000e400: 6172 642d 7371 6c2f 7265 6d6f 7465 2d66  ard-sql/remote-f
-0000e410: 756e 6374 696f 6e73 2367 7261 6e74 5f70  unctions#grant_p
-0000e420: 6572 6d69 7373 696f 6e5f 6f6e 5f66 756e  ermission_on_fun
-0000e430: 6374 696f 6e0a 0a20 2020 2020 2020 2020  ction..         
-0000e440: 2020 2020 2020 416c 7465 726e 6174 6976        Alternativ
-0000e450: 656c 792c 2074 6865 2049 414d 2063 6f75  ely, the IAM cou
-0000e460: 6c64 2061 6c73 6f20 6265 2073 6574 7570  ld also be setup
-0000e470: 2076 6961 2074 6865 2067 636c 6f75 6420   via the gcloud 
-0000e480: 434c 493a 0a0a 2020 2020 2020 2020 2020  CLI:..          
-0000e490: 2020 2020 2060 2420 6763 6c6f 7564 2070       `$ gcloud p
-0000e4a0: 726f 6a65 6374 7320 6164 642d 6961 6d2d  rojects add-iam-
-0000e4b0: 706f 6c69 6379 2d62 696e 6469 6e67 2050  policy-binding P
-0000e4c0: 524f 4a45 4354 5f49 4420 2d2d 6d65 6d62  ROJECT_ID --memb
-0000e4d0: 6572 3d22 7365 7276 6963 6541 6363 6f75  er="serviceAccou
-0000e4e0: 6e74 3a43 4f4e 4e45 4354 494f 4e5f 5345  nt:CONNECTION_SE
-0000e4f0: 5256 4943 455f 4143 434f 554e 545f 4944  RVICE_ACCOUNT_ID
-0000e500: 2220 2d2d 726f 6c65 3d22 726f 6c65 732f  " --role="roles/
-0000e510: 7275 6e2e 696e 766f 6b65 7222 602e 0a0a  run.invoker"`...
-0000e520: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000e530: 2020 2020 2020 2020 2020 696e 7075 745f            input_
-0000e540: 7479 7065 7320 286c 6973 7428 7479 7065  types (list(type
-0000e550: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000e560: 2020 2020 4c69 7374 206f 6620 696e 7075      List of inpu
-0000e570: 7420 6461 7461 2074 7970 6573 2069 6e20  t data types in 
-0000e580: 7468 6520 7573 6572 2064 6566 696e 6564  the user defined
-0000e590: 2066 756e 6374 696f 6e2e 0a20 2020 2020   function..     
-0000e5a0: 2020 2020 2020 206f 7574 7075 745f 7479         output_ty
-0000e5b0: 7065 2028 7479 7065 293a 0a20 2020 2020  pe (type):.     
-0000e5c0: 2020 2020 2020 2020 2020 2044 6174 6120             Data 
-0000e5d0: 7479 7065 206f 6620 7468 6520 6f75 7470  type of the outp
-0000e5e0: 7574 2069 6e20 7468 6520 7573 6572 2064  ut in the user d
-0000e5f0: 6566 696e 6564 2066 756e 6374 696f 6e2e  efined function.
-0000e600: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-0000e610: 6173 6574 2028 7374 722c 204f 7074 696f  aset (str, Optio
-0000e620: 6e61 6c29 3a0a 2020 2020 2020 2020 2020  nal):.          
-0000e630: 2020 2020 2020 4461 7461 7365 7420 696e        Dataset in
-0000e640: 2077 6869 6368 2074 6f20 6372 6561 7465   which to create
-0000e650: 2061 2042 6967 5175 6572 7920 7265 6d6f   a BigQuery remo
-0000e660: 7465 2066 756e 6374 696f 6e2e 2049 7420  te function. It 
-0000e670: 7368 6f75 6c64 2062 6520 696e 0a20 2020  should be in.   
-0000e680: 2020 2020 2020 2020 2020 2020 2060 3c70               `<p
-0000e690: 726f 6a65 6374 5f69 643e 2e3c 6461 7461  roject_id>.<data
-0000e6a0: 7365 745f 6e61 6d65 3e60 206f 7220 603c  set_name>` or `<
-0000e6b0: 6461 7461 7365 745f 6e61 6d65 3e60 2066  dataset_name>` f
-0000e6c0: 6f72 6d61 742e 2049 6620 7468 6973 0a20  ormat. If this. 
-0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000e6e0: 6172 616d 6574 6572 2069 7320 6e6f 7420  arameter is not 
-0000e6f0: 7072 6f76 6964 6564 2074 6865 6e20 7365  provided then se
-0000e700: 7373 696f 6e20 6461 7461 7365 7420 6964  ssion dataset id
-0000e710: 2069 7320 7573 6564 2e0a 2020 2020 2020   is used..      
-0000e720: 2020 2020 2020 6269 6771 7565 7279 5f63        bigquery_c
-0000e730: 6f6e 6e65 6374 696f 6e20 2873 7472 2c20  onnection (str, 
-0000e740: 4f70 7469 6f6e 616c 293a 0a20 2020 2020  Optional):.     
-0000e750: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
-0000e760: 6f66 2074 6865 2042 6967 5175 6572 7920  of the BigQuery 
-0000e770: 636f 6e6e 6563 7469 6f6e 2e20 596f 7520  connection. You 
-0000e780: 7368 6f75 6c64 2065 6974 6865 7220 6861  should either ha
-0000e790: 7665 2074 6865 0a20 2020 2020 2020 2020  ve the.         
-0000e7a0: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
-0000e7b0: 6e20 616c 7265 6164 7920 6372 6561 7465  n already create
-0000e7c0: 6420 696e 2074 6865 2060 6c6f 6361 7469  d in the `locati
-0000e7d0: 6f6e 6020 796f 7520 6861 7665 2063 686f  on` you have cho
-0000e7e0: 7365 6e2c 206f 720a 2020 2020 2020 2020  sen, or.        
-0000e7f0: 2020 2020 2020 2020 796f 7520 7368 6f75          you shou
-0000e800: 6c64 2068 6176 6520 7468 6520 5072 6f6a  ld have the Proj
-0000e810: 6563 7420 4941 4d20 4164 6d69 6e20 726f  ect IAM Admin ro
-0000e820: 6c65 2074 6f20 656e 6162 6c65 2074 6865  le to enable the
-0000e830: 2073 6572 7669 6365 0a20 2020 2020 2020   service.       
-0000e840: 2020 2020 2020 2020 2074 6f20 6372 6561           to crea
-0000e850: 7465 2074 6865 2063 6f6e 6e65 6374 696f  te the connectio
-0000e860: 6e20 666f 7220 796f 7520 6966 2079 6f75  n for you if you
-0000e870: 206e 6565 6420 6974 2e20 4966 2074 6869   need it. If thi
-0000e880: 7320 7061 7261 6d65 7465 7220 6973 0a20  s parameter is. 
-0000e890: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000e8a0: 6f74 2070 726f 7669 6465 6420 7468 656e  ot provided then
-0000e8b0: 2074 6865 2042 6967 5175 6572 7920 636f   the BigQuery co
-0000e8c0: 6e6e 6563 7469 6f6e 2066 726f 6d20 7468  nnection from th
-0000e8d0: 6520 7365 7373 696f 6e20 6973 2075 7365  e session is use
-0000e8e0: 642e 0a20 2020 2020 2020 2020 2020 2072  d..            r
-0000e8f0: 6575 7365 2028 626f 6f6c 2c20 4f70 7469  euse (bool, Opti
-0000e900: 6f6e 616c 293a 0a20 2020 2020 2020 2020  onal):.         
-0000e910: 2020 2020 2020 2052 6575 7365 2074 6865         Reuse the
-0000e920: 2072 656d 6f74 6520 6675 6e63 7469 6f6e   remote function
-0000e930: 2069 6620 616c 7265 6164 7920 6578 6973   if already exis
-0000e940: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
-0000e950: 2020 2020 6054 7275 6560 2062 7920 6465      `True` by de
-0000e960: 6661 756c 742c 2077 6869 6368 2077 696c  fault, which wil
-0000e970: 6c20 7265 7375 6c74 2069 6e20 7265 7573  l result in reus
-0000e980: 696e 6720 616e 2065 7869 7374 696e 6720  ing an existing 
-0000e990: 7265 6d6f 7465 0a20 2020 2020 2020 2020  remote.         
-0000e9a0: 2020 2020 2020 2066 756e 6374 696f 6e20         function 
-0000e9b0: 616e 6420 636f 7272 6573 706f 6e64 696e  and correspondin
-0000e9c0: 6720 636c 6f75 6420 6675 6e63 7469 6f6e  g cloud function
-0000e9d0: 2028 6966 2061 6e79 2920 7468 6174 2077   (if any) that w
-0000e9e0: 6173 0a20 2020 2020 2020 2020 2020 2020  as.             
-0000e9f0: 2020 2070 7265 7669 6f75 736c 7920 6372     previously cr
-0000ea00: 6561 7465 6420 666f 7220 7468 6520 7361  eated for the sa
-0000ea10: 6d65 2075 6466 2e0a 2020 2020 2020 2020  me udf..        
-0000ea20: 2020 2020 2020 2020 5365 7474 696e 6720          Setting 
-0000ea30: 6974 2074 6f20 6046 616c 7365 6020 776f  it to `False` wo
-0000ea40: 756c 6420 666f 7263 6520 6372 6561 7469  uld force creati
-0000ea50: 6e67 2061 2075 6e69 7175 6520 7265 6d6f  ng a unique remo
-0000ea60: 7465 2066 756e 6374 696f 6e2e 0a20 2020  te function..   
-0000ea70: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-0000ea80: 7468 6520 7265 7175 6972 6564 2072 656d  the required rem
-0000ea90: 6f74 6520 6675 6e63 7469 6f6e 2064 6f65  ote function doe
-0000eaa0: 7320 6e6f 7420 6578 6973 7420 7468 656e  s not exist then
-0000eab0: 2069 7420 776f 756c 6420 6265 0a20 2020   it would be.   
-0000eac0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-0000ead0: 6174 6564 2069 7272 6573 7065 6374 6976  ated irrespectiv
-0000eae0: 6520 6f66 2074 6869 7320 7061 7261 6d2e  e of this param.
-0000eaf0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-0000eb00: 6520 2873 7472 2c20 4f70 7469 6f6e 616c  e (str, Optional
-0000eb10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000eb20: 2020 2045 7870 6c69 6369 7420 6e61 6d65     Explicit name
-0000eb30: 206f 6620 7468 6520 7065 7273 6973 7465   of the persiste
-0000eb40: 6420 4269 6751 7565 7279 2072 656d 6f74  d BigQuery remot
-0000eb50: 6520 6675 6e63 7469 6f6e 2e20 5573 6520  e function. Use 
-0000eb60: 6974 2077 6974 680a 2020 2020 2020 2020  it with.        
-0000eb70: 2020 2020 2020 2020 6361 7574 696f 6e2c          caution,
-0000eb80: 2062 6563 6175 7365 2074 776f 2075 7365   because two use
-0000eb90: 7273 2077 6f72 6b69 6e67 2069 6e20 7468  rs working in th
-0000eba0: 6520 7361 6d65 2070 726f 6a65 6374 2061  e same project a
-0000ebb0: 6e64 2064 6174 6173 6574 0a20 2020 2020  nd dataset.     
-0000ebc0: 2020 2020 2020 2020 2020 2063 6f75 6c64             could
-0000ebd0: 206f 7665 7277 7269 7465 2065 6163 6820   overwrite each 
-0000ebe0: 6f74 6865 7227 7320 7265 6d6f 7465 2066  other's remote f
-0000ebf0: 756e 6374 696f 6e73 2069 6620 7468 6579  unctions if they
-0000ec00: 2075 7365 2074 6865 2073 616d 650a 2020   use the same.  
-0000ec10: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-0000ec20: 7273 6973 7465 6e74 206e 616d 652e 0a20  rsistent name.. 
-0000ec30: 2020 2020 2020 2020 2020 2070 6163 6b61             packa
-0000ec40: 6765 7320 2873 7472 5b5d 2c20 4f70 7469  ges (str[], Opti
-0000ec50: 6f6e 616c 293a 0a20 2020 2020 2020 2020  onal):.         
-0000ec60: 2020 2020 2020 2045 7870 6c69 6369 7420         Explicit 
-0000ec70: 6e61 6d65 206f 6620 7468 6520 6578 7465  name of the exte
-0000ec80: 726e 616c 2070 6163 6b61 6765 2064 6570  rnal package dep
-0000ec90: 656e 6465 6e63 6965 732e 2045 6163 6820  endencies. Each 
-0000eca0: 6465 7065 6e64 656e 6379 0a20 2020 2020  dependency.     
-0000ecb0: 2020 2020 2020 2020 2020 2069 7320 6164             is ad
-0000ecc0: 6465 6420 746f 2074 6865 2060 7265 7175  ded to the `requ
-0000ecd0: 6972 656d 656e 7473 2e74 7874 6020 6173  irements.txt` as
-0000ece0: 2069 732c 2061 6e64 2063 616e 2062 6520   is, and can be 
-0000ecf0: 6f66 2074 6865 2066 6f72 6d0a 2020 2020  of the form.    
-0000ed00: 2020 2020 2020 2020 2020 2020 7375 7070              supp
-0000ed10: 6f72 7465 6420 696e 2068 7474 7073 3a2f  orted in https:/
-0000ed20: 2f70 6970 2e70 7970 612e 696f 2f65 6e2f  /pip.pypa.io/en/
-0000ed30: 7374 6162 6c65 2f72 6566 6572 656e 6365  stable/reference
-0000ed40: 2f72 6571 7569 7265 6d65 6e74 732d 6669  /requirements-fi
-0000ed50: 6c65 2d66 6f72 6d61 742f 2e0a 2020 2020  le-format/..    
-0000ed60: 2020 2020 2020 2020 636c 6f75 645f 6675          cloud_fu
-0000ed70: 6e63 7469 6f6e 5f73 6572 7669 6365 5f61  nction_service_a
-0000ed80: 6363 6f75 6e74 2028 7374 722c 204f 7074  ccount (str, Opt
-0000ed90: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
-0000eda0: 2020 2020 2020 2020 5365 7276 6963 6520          Service 
-0000edb0: 6163 636f 756e 7420 746f 2075 7365 2066  account to use f
-0000edc0: 6f72 2074 6865 2063 6c6f 7564 2066 756e  or the cloud fun
-0000edd0: 6374 696f 6e73 2e20 4966 206e 6f74 2070  ctions. If not p
-0000ede0: 726f 7669 6465 640a 2020 2020 2020 2020  rovided.        
-0000edf0: 2020 2020 2020 2020 7468 656e 2074 6865          then the
-0000ee00: 2064 6566 6175 6c74 2073 6572 7669 6365   default service
-0000ee10: 2061 6363 6f75 6e74 2077 6f75 6c64 2062   account would b
-0000ee20: 6520 7573 6564 2e20 5365 650a 2020 2020  e used. See.    
-0000ee30: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0000ee40: 733a 2f2f 636c 6f75 642e 676f 6f67 6c65  s://cloud.google
-0000ee50: 2e63 6f6d 2f66 756e 6374 696f 6e73 2f64  .com/functions/d
-0000ee60: 6f63 732f 7365 6375 7269 6e67 2f66 756e  ocs/securing/fun
-0000ee70: 6374 696f 6e2d 6964 656e 7469 7479 0a20  ction-identity. 
-0000ee80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000ee90: 6f72 206d 6f72 6520 6465 7461 696c 732e  or more details.
-0000eea0: 2050 6c65 6173 6520 6d61 6b65 2073 7572   Please make sur
-0000eeb0: 6520 7468 6520 7365 7276 6963 6520 6163  e the service ac
-0000eec0: 636f 756e 7420 6861 7320 7468 650a 2020  count has the.  
-0000eed0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0000eee0: 6365 7373 6172 7920 4941 4d20 7065 726d  cessary IAM perm
-0000eef0: 6973 7369 6f6e 7320 636f 6e66 6967 7572  issions configur
-0000ef00: 6564 2061 7320 6465 7363 7269 6265 6420  ed as described 
-0000ef10: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
-0000ef20: 2020 2068 7474 7073 3a2f 2f63 6c6f 7564     https://cloud
-0000ef30: 2e67 6f6f 676c 652e 636f 6d2f 6675 6e63  .google.com/func
-0000ef40: 7469 6f6e 732f 646f 6373 2f72 6566 6572  tions/docs/refer
-0000ef50: 656e 6365 2f69 616d 2f72 6f6c 6573 2361  ence/iam/roles#a
-0000ef60: 6464 6974 696f 6e61 6c2d 636f 6e66 6967  dditional-config
-0000ef70: 7572 6174 696f 6e2e 0a20 2020 2020 2020  uration..       
-0000ef80: 2020 2020 2063 6c6f 7564 5f66 756e 6374       cloud_funct
-0000ef90: 696f 6e5f 6b6d 735f 6b65 795f 6e61 6d65  ion_kms_key_name
-0000efa0: 2028 7374 722c 204f 7074 696f 6e61 6c29   (str, Optional)
-0000efb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000efc0: 2020 4375 7374 6f6d 6572 206d 616e 6167    Customer manag
-0000efd0: 6564 2065 6e63 7279 7074 696f 6e20 6b65  ed encryption ke
-0000efe0: 7920 746f 2070 726f 7465 6374 2063 6c6f  y to protect clo
-0000eff0: 7564 2066 756e 6374 696f 6e73 2061 6e64  ud functions and
-0000f000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f010: 2072 656c 6174 6564 2064 6174 6120 6174   related data at
-0000f020: 2072 6573 742e 2054 6869 7320 6973 206f   rest. This is o
-0000f030: 6620 7468 6520 666f 726d 6174 0a20 2020  f the format.   
-0000f040: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0000f050: 6a65 6374 732f 5052 4f4a 4543 545f 4944  jects/PROJECT_ID
-0000f060: 2f6c 6f63 6174 696f 6e73 2f4c 4f43 4154  /locations/LOCAT
-0000f070: 494f 4e2f 6b65 7952 696e 6773 2f4b 4559  ION/keyRings/KEY
-0000f080: 5249 4e47 2f63 7279 7074 6f4b 6579 732f  RING/cryptoKeys/
-0000f090: 4b45 592e 0a20 2020 2020 2020 2020 2020  KEY..           
-0000f0a0: 2020 2020 2052 6561 6420 6874 7470 733a       Read https:
-0000f0b0: 2f2f 636c 6f75 642e 676f 6f67 6c65 2e63  //cloud.google.c
-0000f0c0: 6f6d 2f66 756e 6374 696f 6e73 2f64 6f63  om/functions/doc
-0000f0d0: 732f 7365 6375 7269 6e67 2f63 6d65 6b20  s/securing/cmek 
-0000f0e0: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-0000f0f0: 2020 2020 6d6f 7265 2064 6574 6169 6c73      more details
-0000f100: 2069 6e63 6c75 6469 6e67 2067 7261 6e74   including grant
-0000f110: 696e 6720 6e65 6365 7373 6172 7920 7365  ing necessary se
-0000f120: 7276 6963 6520 6163 636f 756e 7473 0a20  rvice accounts. 
-0000f130: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000f140: 6363 6573 7320 746f 2074 6865 206b 6579  ccess to the key
-0000f150: 2e0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
-0000f160: 6f75 645f 6675 6e63 7469 6f6e 5f64 6f63  oud_function_doc
-0000f170: 6b65 725f 7265 706f 7369 746f 7279 2028  ker_repository (
-0000f180: 7374 722c 204f 7074 696f 6e61 6c29 3a0a  str, Optional):.
-0000f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1a0: 446f 636b 6572 2072 6570 6f73 6974 6f72  Docker repositor
-0000f1b0: 7920 6372 6561 7465 6420 7769 7468 2074  y created with t
-0000f1c0: 6865 2073 616d 6520 656e 6372 7970 7469  he same encrypti
-0000f1d0: 6f6e 206b 6579 2061 730a 2020 2020 2020  on key as.      
-0000f1e0: 2020 2020 2020 2020 2020 6063 6c6f 7564            `cloud
-0000f1f0: 5f66 756e 6374 696f 6e5f 6b6d 735f 6b65  _function_kms_ke
-0000f200: 795f 6e61 6d65 6020 746f 2073 746f 7265  y_name` to store
-0000f210: 2065 6e63 7279 7074 6564 2061 7274 6966   encrypted artif
-0000f220: 6163 7473 0a20 2020 2020 2020 2020 2020  acts.           
-0000f230: 2020 2020 2063 7265 6174 6564 2074 6f20       created to 
-0000f240: 7375 7070 6f72 7420 7468 6520 636c 6f75  support the clou
-0000f250: 6420 6675 6e63 7469 6f6e 2e20 5468 6973  d function. This
-0000f260: 2069 7320 6f66 2074 6865 2066 6f72 6d61   is of the forma
-0000f270: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000f280: 2020 7072 6f6a 6563 7473 2f50 524f 4a45    projects/PROJE
-0000f290: 4354 5f49 442f 6c6f 6361 7469 6f6e 732f  CT_ID/locations/
-0000f2a0: 4c4f 4341 5449 4f4e 2f72 6570 6f73 6974  LOCATION/reposit
-0000f2b0: 6f72 6965 732f 5245 504f 5349 544f 5259  ories/REPOSITORY
-0000f2c0: 5f4e 414d 452e 0a20 2020 2020 2020 2020  _NAME..         
-0000f2d0: 2020 2020 2020 2046 6f72 206d 6f72 6520         For more 
-0000f2e0: 6465 7461 696c 7320 7365 650a 2020 2020  details see.    
-0000f2f0: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0000f300: 733a 2f2f 636c 6f75 642e 676f 6f67 6c65  s://cloud.google
-0000f310: 2e63 6f6d 2f66 756e 6374 696f 6e73 2f64  .com/functions/d
-0000f320: 6f63 732f 7365 6375 7269 6e67 2f63 6d65  ocs/securing/cme
-0000f330: 6b23 6265 666f 7265 5f79 6f75 5f62 6567  k#before_you_beg
-0000f340: 696e 2e0a 2020 2020 2020 2020 5265 7475  in..        Retu
-0000f350: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
-0000f360: 2063 616c 6c61 626c 653a 2041 2072 656d   callable: A rem
-0000f370: 6f74 6520 6675 6e63 7469 6f6e 206f 626a  ote function obj
-0000f380: 6563 7420 706f 696e 7469 6e67 2074 6f20  ect pointing to 
-0000f390: 7468 6520 636c 6f75 6420 6173 7365 7473  the cloud assets
-0000f3a0: 2063 7265 6174 6564 0a20 2020 2020 2020   created.       
-0000f3b0: 2020 2020 2069 6e20 7468 6520 6261 636b       in the back
-0000f3c0: 6772 6f75 6e64 2074 6f20 7375 7070 6f72  ground to suppor
-0000f3d0: 7420 7468 6520 7265 6d6f 7465 2065 7865  t the remote exe
-0000f3e0: 6375 7469 6f6e 2e20 5468 6520 636c 6f75  cution. The clou
-0000f3f0: 6420 6173 7365 7473 2063 616e 2062 650a  d assets can be.
-0000f400: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
-0000f410: 7465 6420 7468 726f 7567 6820 7468 6520  ted through the 
-0000f420: 666f 6c6c 6f77 696e 6720 7072 6f70 6572  following proper
-0000f430: 7469 6573 2073 6574 2069 6e20 7468 6520  ties set in the 
-0000f440: 6f62 6a65 6374 3a0a 0a20 2020 2020 2020  object:..       
-0000f450: 2020 2020 2060 6269 6766 7261 6d65 735f       `bigframes_
-0000f460: 636c 6f75 645f 6675 6e63 7469 6f6e 6020  cloud_function` 
-0000f470: 2d20 5468 6520 676f 6f67 6c65 2063 6c6f  - The google clo
-0000f480: 7564 2066 756e 6374 696f 6e20 6465 706c  ud function depl
-0000f490: 6f79 6564 2066 6f72 2074 6865 2075 7365  oyed for the use
-0000f4a0: 7220 6465 6669 6e65 6420 636f 6465 2e0a  r defined code..
-0000f4b0: 0a20 2020 2020 2020 2020 2020 2060 6269  .            `bi
-0000f4c0: 6766 7261 6d65 735f 7265 6d6f 7465 5f66  gframes_remote_f
-0000f4d0: 756e 6374 696f 6e60 202d 2054 6865 2062  unction` - The b
-0000f4e0: 6967 7175 6572 7920 7265 6d6f 7465 2066  igquery remote f
-0000f4f0: 756e 6374 696f 6e20 6361 7061 626c 6520  unction capable 
-0000f500: 6f66 2063 616c 6c69 6e67 2069 6e74 6f20  of calling into 
-0000f510: 6062 6967 6672 616d 6573 5f63 6c6f 7564  `bigframes_cloud
-0000f520: 5f66 756e 6374 696f 6e60 2e0a 2020 2020  _function`..    
-0000f530: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000f540: 7265 7475 726e 2062 6967 6672 616d 6573  return bigframes
-0000f550: 5f72 6628 0a20 2020 2020 2020 2020 2020  _rf(.           
-0000f560: 2069 6e70 7574 5f74 7970 6573 2c0a 2020   input_types,.  
-0000f570: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000f580: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
-0000f590: 2020 2073 6573 7369 6f6e 3d73 656c 662c     session=self,
-0000f5a0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-0000f5b0: 6173 6574 3d64 6174 6173 6574 2c0a 2020  aset=dataset,.  
-0000f5c0: 2020 2020 2020 2020 2020 6269 6771 7565            bigque
-0000f5d0: 7279 5f63 6f6e 6e65 6374 696f 6e3d 6269  ry_connection=bi
-0000f5e0: 6771 7565 7279 5f63 6f6e 6e65 6374 696f  gquery_connectio
-0000f5f0: 6e2c 0a20 2020 2020 2020 2020 2020 2072  n,.            r
-0000f600: 6575 7365 3d72 6575 7365 2c0a 2020 2020  euse=reuse,.    
-0000f610: 2020 2020 2020 2020 6e61 6d65 3d6e 616d          name=nam
-0000f620: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
-0000f630: 6163 6b61 6765 733d 7061 636b 6167 6573  ackages=packages
-0000f640: 2c0a 2020 2020 2020 2020 2020 2020 636c  ,.            cl
-0000f650: 6f75 645f 6675 6e63 7469 6f6e 5f73 6572  oud_function_ser
-0000f660: 7669 6365 5f61 6363 6f75 6e74 3d63 6c6f  vice_account=clo
-0000f670: 7564 5f66 756e 6374 696f 6e5f 7365 7276  ud_function_serv
-0000f680: 6963 655f 6163 636f 756e 742c 0a20 2020  ice_account,.   
-0000f690: 2020 2020 2020 2020 2063 6c6f 7564 5f66           cloud_f
-0000f6a0: 756e 6374 696f 6e5f 6b6d 735f 6b65 795f  unction_kms_key_
-0000f6b0: 6e61 6d65 3d63 6c6f 7564 5f66 756e 6374  name=cloud_funct
-0000f6c0: 696f 6e5f 6b6d 735f 6b65 795f 6e61 6d65  ion_kms_key_name
-0000f6d0: 2c0a 2020 2020 2020 2020 2020 2020 636c  ,.            cl
-0000f6e0: 6f75 645f 6675 6e63 7469 6f6e 5f64 6f63  oud_function_doc
-0000f6f0: 6b65 725f 7265 706f 7369 746f 7279 3d63  ker_repository=c
-0000f700: 6c6f 7564 5f66 756e 6374 696f 6e5f 646f  loud_function_do
-0000f710: 636b 6572 5f72 6570 6f73 6974 6f72 792c  cker_repository,
-0000f720: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000f730: 6465 6620 7265 6164 5f67 6271 5f66 756e  def read_gbq_fun
-0000f740: 6374 696f 6e28 0a20 2020 2020 2020 2073  ction(.        s
-0000f750: 656c 662c 0a20 2020 2020 2020 2066 756e  elf,.        fun
-0000f760: 6374 696f 6e5f 6e61 6d65 3a20 7374 722c  ction_name: str,
-0000f770: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0000f780: 2222 224c 6f61 6473 2061 2042 6967 5175  """Loads a BigQu
-0000f790: 6572 7920 6675 6e63 7469 6f6e 2066 726f  ery function fro
-0000f7a0: 6d20 4269 6751 7565 7279 2e0a 0a20 2020  m BigQuery...   
-0000f7b0: 2020 2020 2054 6865 6e20 6974 2063 616e       Then it can
-0000f7c0: 2062 6520 6170 706c 6965 6420 746f 2061   be applied to a
-0000f7d0: 2044 6174 6146 7261 6d65 206f 7220 5365   DataFrame or Se
-0000f7e0: 7269 6573 2e0a 0a20 2020 2020 2020 202e  ries...        .
-0000f7f0: 2e20 6e6f 7465 3a3a 0a20 2020 2020 2020  . note::.       
-0000f800: 2020 2020 2054 6865 2072 6574 7572 6e20       The return 
-0000f810: 7479 7065 206f 6620 7468 6520 6675 6e63  type of the func
-0000f820: 7469 6f6e 206d 7573 7420 6265 2065 7870  tion must be exp
-0000f830: 6c69 6369 746c 7920 7370 6563 6966 6965  licitly specifie
-0000f840: 6420 696e 2074 6865 0a20 2020 2020 2020  d in the.       
-0000f850: 2020 2020 2066 756e 6374 696f 6e27 7320       function's 
-0000f860: 6f72 6967 696e 616c 2064 6566 696e 6974  original definit
-0000f870: 696f 6e20 6576 656e 2069 6620 6e6f 7420  ion even if not 
-0000f880: 6f74 6865 7277 6973 6520 7265 7175 6972  otherwise requir
-0000f890: 6564 2e0a 0a20 2020 2020 2020 2042 6967  ed...        Big
-0000f8a0: 5175 6572 7920 5574 696c 7320 7072 6f76  Query Utils prov
-0000f8b0: 6964 6573 206d 616e 7920 7075 626c 6963  ides many public
-0000f8c0: 2066 756e 6374 696f 6e73 2075 6e64 6572   functions under
-0000f8d0: 2074 6865 2060 6062 7175 7469 6c60 6020   the ``bqutil`` 
-0000f8e0: 7072 6f6a 6563 7420 6f6e 2047 6f6f 676c  project on Googl
-0000f8f0: 6520 436c 6f75 6420 506c 6174 666f 726d  e Cloud Platform
-0000f900: 2070 726f 6a65 6374 0a20 2020 2020 2020   project.       
-0000f910: 2028 5365 653a 2068 7474 7073 3a2f 2f67   (See: https://g
-0000f920: 6974 6875 622e 636f 6d2f 476f 6f67 6c65  ithub.com/Google
-0000f930: 436c 6f75 6450 6c61 7466 6f72 6d2f 6269  CloudPlatform/bi
-0000f940: 6771 7565 7279 2d75 7469 6c73 2f74 7265  gquery-utils/tre
-0000f950: 652f 6d61 7374 6572 2f75 6466 7323 7573  e/master/udfs#us
-0000f960: 696e 672d 7468 652d 7564 6673 292e 0a20  ing-the-udfs).. 
-0000f970: 2020 2020 2020 2059 6f75 2063 616e 2063         You can c
-0000f980: 6865 636b 6f75 7420 436f 6d6d 756e 6974  heckout Communit
-0000f990: 7920 5544 4673 2074 6f20 7573 6520 636f  y UDFs to use co
-0000f9a0: 6d6d 756e 6974 792d 636f 6e74 7269 6275  mmunity-contribu
-0000f9b0: 7465 6420 6675 6e63 7469 6f6e 732e 0a20  ted functions.. 
-0000f9c0: 2020 2020 2020 2028 5365 653a 2068 7474         (See: htt
-0000f9d0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-0000f9e0: 476f 6f67 6c65 436c 6f75 6450 6c61 7466  GoogleCloudPlatf
-0000f9f0: 6f72 6d2f 6269 6771 7565 7279 2d75 7469  orm/bigquery-uti
-0000fa00: 6c73 2f74 7265 652f 6d61 7374 6572 2f75  ls/tree/master/u
-0000fa10: 6466 732f 636f 6d6d 756e 6974 7923 636f  dfs/community#co
-0000fa20: 6d6d 756e 6974 792d 7564 6673 292e 0a0a  mmunity-udfs)...
-0000fa30: 2020 2020 2020 2020 2a2a 4578 616d 706c          **Exampl
-0000fa40: 6573 3a2a 2a0a 0a20 2020 2020 2020 2055  es:**..        U
-0000fa50: 7365 2074 6865 2060 6063 775f 6c6f 7765  se the ``cw_lowe
-0000fa60: 725f 6361 7365 5f61 7363 6969 5f6f 6e6c  r_case_ascii_onl
-0000fa70: 7960 6020 6675 6e63 7469 6f6e 2066 726f  y`` function fro
-0000fa80: 6d20 436f 6d6d 756e 6974 7920 5544 4673  m Community UDFs
-0000fa90: 2e0a 2020 2020 2020 2020 2868 7474 7073  ..        (https
-0000faa0: 3a2f 2f67 6974 6875 622e 636f 6d2f 476f  ://github.com/Go
-0000fab0: 6f67 6c65 436c 6f75 6450 6c61 7466 6f72  ogleCloudPlatfor
-0000fac0: 6d2f 6269 6771 7565 7279 2d75 7469 6c73  m/bigquery-utils
-0000fad0: 2f62 6c6f 622f 6d61 7374 6572 2f75 6466  /blob/master/udf
-0000fae0: 732f 636f 6d6d 756e 6974 792f 6377 5f6c  s/community/cw_l
-0000faf0: 6f77 6572 5f63 6173 655f 6173 6369 695f  ower_case_ascii_
-0000fb00: 6f6e 6c79 2e73 716c 7829 0a0a 2020 2020  only.sqlx)..    
-0000fb10: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
-0000fb20: 7274 2062 6967 6672 616d 6573 2e70 616e  rt bigframes.pan
-0000fb30: 6461 7320 6173 2062 7064 0a20 2020 2020  das as bpd.     
-0000fb40: 2020 2020 2020 203e 3e3e 2062 7064 2e6f         >>> bpd.o
-0000fb50: 7074 696f 6e73 2e64 6973 706c 6179 2e70  ptions.display.p
-0000fb60: 726f 6772 6573 735f 6261 7220 3d20 4e6f  rogress_bar = No
-0000fb70: 6e65 0a0a 2020 2020 2020 2020 2020 2020  ne..            
-0000fb80: 3e3e 3e20 6466 203d 2062 7064 2e44 6174  >>> df = bpd.Dat
-0000fb90: 6146 7261 6d65 287b 2769 6427 3a20 5b31  aFrame({'id': [1
-0000fba0: 2c20 322c 2033 5d2c 2027 6e61 6d65 273a  , 2, 3], 'name':
-0000fbb0: 205b 2741 5552 c389 4c49 4527 2c20 2743   ['AUR..LIE', 'C
-0000fbc0: c389 4c45 5354 494e 4527 2c20 2744 4150  ..LESTINE', 'DAP
-0000fbd0: 484e c389 275d 7d29 0a20 2020 2020 2020  HN..']}).       
-0000fbe0: 2020 2020 203e 3e3e 2064 660a 2020 2020       >>> df.    
-0000fbf0: 2020 2020 2020 2020 2020 2069 6420 2020             id   
-0000fc00: 2020 2020 6e61 6d65 0a20 2020 2020 2020      name.       
-0000fc10: 2020 2020 2030 2020 2031 2020 2020 4155       0   1    AU
-0000fc20: 52c3 894c 4945 0a20 2020 2020 2020 2020  R..LIE.         
-0000fc30: 2020 2031 2020 2032 2020 43c3 894c 4553     1   2  C..LES
-0000fc40: 5449 4e45 0a20 2020 2020 2020 2020 2020  TINE.           
-0000fc50: 2032 2020 2033 2020 2020 2044 4150 484e   2   3     DAPHN
-0000fc60: c389 0a20 2020 2020 2020 2020 2020 203c  ...            <
-0000fc70: 424c 414e 4b4c 494e 453e 0a20 2020 2020  BLANKLINE>.     
-0000fc80: 2020 2020 2020 205b 3320 726f 7773 2078         [3 rows x
-0000fc90: 2032 2063 6f6c 756d 6e73 5d0a 0a20 2020   2 columns]..   
-0000fca0: 2020 2020 2020 2020 203e 3e3e 2066 756e           >>> fun
-0000fcb0: 6320 3d20 6270 642e 7265 6164 5f67 6271  c = bpd.read_gbq
-0000fcc0: 5f66 756e 6374 696f 6e28 2262 7175 7469  _function("bquti
-0000fcd0: 6c2e 666e 2e63 775f 6c6f 7765 725f 6361  l.fn.cw_lower_ca
-0000fce0: 7365 5f61 7363 6969 5f6f 6e6c 7922 290a  se_ascii_only").
-0000fcf0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-0000fd00: 6466 3120 3d20 6466 2e61 7373 6967 6e28  df1 = df.assign(
-0000fd10: 6e65 775f 6e61 6d65 3d64 665b 276e 616d  new_name=df['nam
-0000fd20: 6527 5d2e 6170 706c 7928 6675 6e63 2929  e'].apply(func))
-0000fd30: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
-0000fd40: 2064 6631 0a20 2020 2020 2020 2020 2020   df1.           
-0000fd50: 2020 2020 6964 2020 2020 2020 206e 616d      id       nam
-0000fd60: 6520 2020 6e65 775f 6e61 6d65 0a20 2020  e   new_name.   
-0000fd70: 2020 2020 2020 2020 2030 2020 2031 2020           0   1  
-0000fd80: 2020 4155 52c3 894c 4945 2020 2020 6175    AUR..LIE    au
-0000fd90: 72c3 896c 6965 0a20 2020 2020 2020 2020  r..lie.         
-0000fda0: 2020 2031 2020 2032 2020 43c3 894c 4553     1   2  C..LES
-0000fdb0: 5449 4e45 2020 63c3 896c 6573 7469 6e65  TINE  c..lestine
-0000fdc0: 0a20 2020 2020 2020 2020 2020 2032 2020  .            2  
-0000fdd0: 2033 2020 2020 2044 4150 484e c389 2020   3     DAPHN..  
-0000fde0: 2020 2064 6170 686e c389 0a20 2020 2020     daphn...     
-0000fdf0: 2020 2020 2020 203c 424c 414e 4b4c 494e         <BLANKLIN
-0000fe00: 453e 0a20 2020 2020 2020 2020 2020 205b  E>.            [
-0000fe10: 3320 726f 7773 2078 2033 2063 6f6c 756d  3 rows x 3 colum
-0000fe20: 6e73 5d0a 0a20 2020 2020 2020 2041 7267  ns]..        Arg
-0000fe30: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-0000fe40: 756e 6374 696f 6e5f 6e61 6d65 2028 7374  unction_name (st
-0000fe50: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0000fe60: 2020 2020 7468 6520 6675 6e63 7469 6f6e      the function
-0000fe70: 2773 206e 616d 6520 696e 2042 6967 5175  's name in BigQu
-0000fe80: 6572 7920 696e 2074 6865 2066 6f72 6d61  ery in the forma
-0000fe90: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000fea0: 2020 6070 726f 6a65 6374 5f69 642e 6461    `project_id.da
-0000feb0: 7461 7365 745f 6964 2e66 756e 6374 696f  taset_id.functio
-0000fec0: 6e5f 6e61 6d65 602c 206f 720a 2020 2020  n_name`, or.    
-0000fed0: 2020 2020 2020 2020 2020 2020 6064 6174              `dat
-0000fee0: 6173 6574 5f69 642e 6675 6e63 7469 6f6e  aset_id.function
-0000fef0: 5f6e 616d 6560 2074 6f20 6c6f 6164 2066  _name` to load f
-0000ff00: 726f 6d20 7468 6520 6465 6661 756c 7420  rom the default 
-0000ff10: 7072 6f6a 6563 742c 206f 720a 2020 2020  project, or.    
-0000ff20: 2020 2020 2020 2020 2020 2020 6066 756e              `fun
-0000ff30: 6374 696f 6e5f 6e61 6d65 6020 746f 206c  ction_name` to l
-0000ff40: 6f61 6420 6672 6f6d 2074 6865 2064 6566  oad from the def
-0000ff50: 6175 6c74 2070 726f 6a65 6374 2061 6e64  ault project and
-0000ff60: 2074 6865 2064 6174 6173 6574 0a20 2020   the dataset.   
-0000ff70: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-0000ff80: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
-0000ff90: 2063 7572 7265 6e74 2073 6573 7369 6f6e   current session
-0000ffa0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000ffb0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000ffc0: 6361 6c6c 6162 6c65 3a20 4120 6675 6e63  callable: A func
-0000ffd0: 7469 6f6e 206f 626a 6563 7420 706f 696e  tion object poin
-0000ffe0: 7469 6e67 2074 6f20 7468 6520 4269 6751  ting to the BigQ
-0000fff0: 7565 7279 2066 756e 6374 696f 6e20 7265  uery function re
-00010000: 6164 0a20 2020 2020 2020 2020 2020 2066  ad.            f
-00010010: 726f 6d20 4269 6751 7565 7279 2e0a 0a20  rom BigQuery... 
-00010020: 2020 2020 2020 2020 2020 2054 6865 206f             The o
-00010030: 626a 6563 7420 6973 2073 696d 696c 6172  bject is similar
-00010040: 2074 6f20 7468 6520 6f6e 6520 6372 6561   to the one crea
-00010050: 7465 6420 6279 2074 6865 2060 7265 6d6f  ted by the `remo
-00010060: 7465 5f66 756e 6374 696f 6e60 0a20 2020  te_function`.   
-00010070: 2020 2020 2020 2020 2064 6563 6f72 6174           decorat
-00010080: 6f72 2c20 696e 636c 7564 696e 6720 7468  or, including th
-00010090: 6520 6062 6967 6672 616d 6573 5f72 656d  e `bigframes_rem
-000100a0: 6f74 655f 6675 6e63 7469 6f6e 6020 7072  ote_function` pr
-000100b0: 6f70 6572 7479 2c20 6275 740a 2020 2020  operty, but.    
-000100c0: 2020 2020 2020 2020 6e6f 7420 696e 636c          not incl
-000100d0: 7564 696e 6720 7468 6520 6062 6967 6672  uding the `bigfr
-000100e0: 616d 6573 5f63 6c6f 7564 5f66 756e 6374  ames_cloud_funct
-000100f0: 696f 6e60 2070 726f 7065 7274 792e 0a20  ion` property.. 
-00010100: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00010110: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-00010120: 616d 6573 5f72 6766 280a 2020 2020 2020  ames_rgf(.      
-00010130: 2020 2020 2020 6675 6e63 7469 6f6e 5f6e        function_n
-00010140: 616d 653d 6675 6e63 7469 6f6e 5f6e 616d  ame=function_nam
-00010150: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00010160: 6573 7369 6f6e 3d73 656c 662c 0a20 2020  ession=self,.   
-00010170: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00010180: 5f70 7265 7061 7265 5f71 7565 7279 5f6a  _prepare_query_j
-00010190: 6f62 5f63 6f6e 6669 6728 0a20 2020 2020  ob_config(.     
-000101a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000101b0: 206a 6f62 5f63 6f6e 6669 673a 204f 7074   job_config: Opt
-000101c0: 696f 6e61 6c5b 6269 6771 7565 7279 2e51  ional[bigquery.Q
-000101d0: 7565 7279 4a6f 6243 6f6e 6669 675d 203d  ueryJobConfig] =
-000101e0: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-000101f0: 6269 6771 7565 7279 2e51 7565 7279 4a6f  bigquery.QueryJo
-00010200: 6243 6f6e 6669 673a 0a20 2020 2020 2020  bConfig:.       
-00010210: 2069 6620 6a6f 625f 636f 6e66 6967 2069   if job_config i
-00010220: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00010230: 2020 2020 6a6f 625f 636f 6e66 6967 203d      job_config =
-00010240: 2062 6967 7175 6572 792e 5175 6572 794a   bigquery.QueryJ
-00010250: 6f62 436f 6e66 6967 2829 0a20 2020 2020  obConfig().     
-00010260: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00010270: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
-00010280: 636f 7079 2073 6f20 7468 6174 2077 6520  copy so that we 
-00010290: 646f 6e27 7420 6d75 7461 7465 2074 6865  don't mutate the
-000102a0: 206f 7269 6769 6e61 6c20 636f 6e66 6967   original config
-000102b0: 2070 6173 7365 640a 2020 2020 2020 2020   passed.        
-000102c0: 2020 2020 6a6f 625f 636f 6e66 6967 203d      job_config =
-000102d0: 2074 7970 696e 672e 6361 7374 280a 2020   typing.cast(.  
-000102e0: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-000102f0: 6771 7565 7279 2e51 7565 7279 4a6f 6243  gquery.QueryJobC
-00010300: 6f6e 6669 672c 0a20 2020 2020 2020 2020  onfig,.         
-00010310: 2020 2020 2020 2062 6967 7175 6572 792e         bigquery.
-00010320: 5175 6572 794a 6f62 436f 6e66 6967 2e66  QueryJobConfig.f
-00010330: 726f 6d5f 6170 695f 7265 7072 286a 6f62  rom_api_repr(job
-00010340: 5f63 6f6e 6669 672e 746f 5f61 7069 5f72  _config.to_api_r
-00010350: 6570 7228 2929 2c0a 2020 2020 2020 2020  epr()),.        
-00010360: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-00010370: 6620 6269 6766 7261 6d65 732e 6f70 7469  f bigframes.opti
-00010380: 6f6e 732e 636f 6d70 7574 652e 6d61 7869  ons.compute.maxi
-00010390: 6d75 6d5f 6279 7465 735f 6269 6c6c 6564  mum_bytes_billed
-000103a0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000103b0: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
-000103c0: 6e66 6967 2e6d 6178 696d 756d 5f62 7974  nfig.maximum_byt
-000103d0: 6573 5f62 696c 6c65 6420 3d20 280a 2020  es_billed = (.  
-000103e0: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-000103f0: 6766 7261 6d65 732e 6f70 7469 6f6e 732e  gframes.options.
-00010400: 636f 6d70 7574 652e 6d61 7869 6d75 6d5f  compute.maximum_
-00010410: 6279 7465 735f 6269 6c6c 6564 0a20 2020  bytes_billed.   
-00010420: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00010430: 2020 2020 6966 2073 656c 662e 5f62 715f      if self._bq_
-00010440: 6b6d 735f 6b65 795f 6e61 6d65 3a0a 2020  kms_key_name:.  
-00010450: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
-00010460: 6e66 6967 2e64 6573 7469 6e61 7469 6f6e  nfig.destination
-00010470: 5f65 6e63 7279 7074 696f 6e5f 636f 6e66  _encryption_conf
-00010480: 6967 7572 6174 696f 6e20 3d20 280a 2020  iguration = (.  
-00010490: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-000104a0: 6771 7565 7279 2e45 6e63 7279 7074 696f  gquery.Encryptio
-000104b0: 6e43 6f6e 6669 6775 7261 7469 6f6e 286b  nConfiguration(k
-000104c0: 6d73 5f6b 6579 5f6e 616d 653d 7365 6c66  ms_key_name=self
-000104d0: 2e5f 6271 5f6b 6d73 5f6b 6579 5f6e 616d  ._bq_kms_key_nam
-000104e0: 6529 0a20 2020 2020 2020 2020 2020 2029  e).            )
-000104f0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00010500: 206a 6f62 5f63 6f6e 6669 670a 0a20 2020   job_config..   
-00010510: 2064 6566 205f 7072 6570 6172 655f 6c6f   def _prepare_lo
-00010520: 6164 5f6a 6f62 5f63 6f6e 6669 6728 7365  ad_job_config(se
-00010530: 6c66 2920 2d3e 2062 6967 7175 6572 792e  lf) -> bigquery.
-00010540: 4c6f 6164 4a6f 6243 6f6e 6669 673a 0a20  LoadJobConfig:. 
-00010550: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00010560: 6120 636f 7079 2073 6f20 7468 6174 2077  a copy so that w
-00010570: 6520 646f 6e27 7420 6d75 7461 7465 2074  e don't mutate t
-00010580: 6865 206f 7269 6769 6e61 6c20 636f 6e66  he original conf
-00010590: 6967 2070 6173 7365 640a 2020 2020 2020  ig passed.      
-000105a0: 2020 6a6f 625f 636f 6e66 6967 203d 2062    job_config = b
-000105b0: 6967 7175 6572 792e 4c6f 6164 4a6f 6243  igquery.LoadJobC
-000105c0: 6f6e 6669 6728 290a 0a20 2020 2020 2020  onfig()..       
-000105d0: 2069 6620 7365 6c66 2e5f 6271 5f6b 6d73   if self._bq_kms
-000105e0: 5f6b 6579 5f6e 616d 653a 0a20 2020 2020  _key_name:.     
-000105f0: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
-00010600: 672e 6465 7374 696e 6174 696f 6e5f 656e  g.destination_en
-00010610: 6372 7970 7469 6f6e 5f63 6f6e 6669 6775  cryption_configu
-00010620: 7261 7469 6f6e 203d 2028 0a20 2020 2020  ration = (.     
-00010630: 2020 2020 2020 2020 2020 2062 6967 7175             bigqu
-00010640: 6572 792e 456e 6372 7970 7469 6f6e 436f  ery.EncryptionCo
-00010650: 6e66 6967 7572 6174 696f 6e28 6b6d 735f  nfiguration(kms_
-00010660: 6b65 795f 6e61 6d65 3d73 656c 662e 5f62  key_name=self._b
-00010670: 715f 6b6d 735f 6b65 795f 6e61 6d65 290a  q_kms_key_name).
-00010680: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00010690: 2020 2020 2020 2072 6574 7572 6e20 6a6f         return jo
-000106a0: 625f 636f 6e66 6967 0a0a 2020 2020 6465  b_config..    de
-000106b0: 6620 5f70 7265 7061 7265 5f63 6f70 795f  f _prepare_copy_
-000106c0: 6a6f 625f 636f 6e66 6967 2873 656c 6629  job_config(self)
-000106d0: 202d 3e20 6269 6771 7565 7279 2e43 6f70   -> bigquery.Cop
-000106e0: 794a 6f62 436f 6e66 6967 3a0a 2020 2020  yJobConfig:.    
-000106f0: 2020 2020 2320 4372 6561 7465 2061 2063      # Create a c
-00010700: 6f70 7920 736f 2074 6861 7420 7765 2064  opy so that we d
-00010710: 6f6e 2774 206d 7574 6174 6520 7468 6520  on't mutate the 
-00010720: 6f72 6967 696e 616c 2063 6f6e 6669 6720  original config 
-00010730: 7061 7373 6564 0a20 2020 2020 2020 206a  passed.        j
-00010740: 6f62 5f63 6f6e 6669 6720 3d20 6269 6771  ob_config = bigq
-00010750: 7565 7279 2e43 6f70 794a 6f62 436f 6e66  uery.CopyJobConf
-00010760: 6967 2829 0a0a 2020 2020 2020 2020 6966  ig()..        if
-00010770: 2073 656c 662e 5f62 715f 6b6d 735f 6b65   self._bq_kms_ke
-00010780: 795f 6e61 6d65 3a0a 2020 2020 2020 2020  y_name:.        
-00010790: 2020 2020 6a6f 625f 636f 6e66 6967 2e64      job_config.d
-000107a0: 6573 7469 6e61 7469 6f6e 5f65 6e63 7279  estination_encry
-000107b0: 7074 696f 6e5f 636f 6e66 6967 7572 6174  ption_configurat
-000107c0: 696f 6e20 3d20 280a 2020 2020 2020 2020  ion = (.        
-000107d0: 2020 2020 2020 2020 6269 6771 7565 7279          bigquery
-000107e0: 2e45 6e63 7279 7074 696f 6e43 6f6e 6669  .EncryptionConfi
-000107f0: 6775 7261 7469 6f6e 286b 6d73 5f6b 6579  guration(kms_key
-00010800: 5f6e 616d 653d 7365 6c66 2e5f 6271 5f6b  _name=self._bq_k
-00010810: 6d73 5f6b 6579 5f6e 616d 6529 0a20 2020  ms_key_name).   
-00010820: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00010830: 2020 2020 7265 7475 726e 206a 6f62 5f63      return job_c
-00010840: 6f6e 6669 670a 0a20 2020 2064 6566 205f  onfig..    def _
-00010850: 7374 6172 745f 7175 6572 7928 0a20 2020  start_query(.   
-00010860: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00010870: 2020 2073 716c 3a20 7374 722c 0a20 2020     sql: str,.   
-00010880: 2020 2020 206a 6f62 5f63 6f6e 6669 673a       job_config:
-00010890: 204f 7074 696f 6e61 6c5b 6269 6771 7565   Optional[bigque
-000108a0: 7279 2e6a 6f62 2e51 7565 7279 4a6f 6243  ry.job.QueryJobC
-000108b0: 6f6e 6669 675d 203d 204e 6f6e 652c 0a20  onfig] = None,. 
-000108c0: 2020 2020 2020 206d 6178 5f72 6573 756c         max_resul
-000108d0: 7473 3a20 4f70 7469 6f6e 616c 5b69 6e74  ts: Optional[int
-000108e0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-000108f0: 2020 7469 6d65 6f75 743a 204f 7074 696f    timeout: Optio
-00010900: 6e61 6c5b 666c 6f61 745d 203d 204e 6f6e  nal[float] = Non
-00010910: 652c 0a20 2020 2029 202d 3e20 5475 706c  e,.    ) -> Tupl
-00010920: 655b 6269 6771 7565 7279 2e74 6162 6c65  e[bigquery.table
-00010930: 2e52 6f77 4974 6572 6174 6f72 2c20 6269  .RowIterator, bi
-00010940: 6771 7565 7279 2e51 7565 7279 4a6f 625d  gquery.QueryJob]
-00010950: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010960: 2020 2020 2020 5374 6172 7473 2042 6967        Starts Big
-00010970: 5175 6572 7920 7175 6572 7920 6a6f 6220  Query query job 
-00010980: 616e 6420 7761 6974 7320 666f 7220 7265  and waits for re
-00010990: 7375 6c74 732e 0a20 2020 2020 2020 2022  sults..        "
-000109a0: 2222 0a20 2020 2020 2020 206a 6f62 5f63  "".        job_c
-000109b0: 6f6e 6669 6720 3d20 7365 6c66 2e5f 7072  onfig = self._pr
-000109c0: 6570 6172 655f 7175 6572 795f 6a6f 625f  epare_query_job_
-000109d0: 636f 6e66 6967 286a 6f62 5f63 6f6e 6669  config(job_confi
-000109e0: 6729 0a20 2020 2020 2020 2072 6574 7572  g).        retur
-000109f0: 6e20 6269 6766 7261 6d65 732e 7365 7373  n bigframes.sess
-00010a00: 696f 6e2e 5f69 6f2e 6269 6771 7565 7279  ion._io.bigquery
-00010a10: 2e73 7461 7274 5f71 7565 7279 5f77 6974  .start_query_wit
-00010a20: 685f 636c 6965 6e74 280a 2020 2020 2020  h_client(.      
-00010a30: 2020 2020 2020 7365 6c66 2e62 7163 6c69        self.bqcli
-00010a40: 656e 742c 2073 716c 2c20 6a6f 625f 636f  ent, sql, job_co
-00010a50: 6e66 6967 2c20 6d61 785f 7265 7375 6c74  nfig, max_result
-00010a60: 732c 2074 696d 656f 7574 0a20 2020 2020  s, timeout.     
-00010a70: 2020 2029 0a0a 2020 2020 6465 6620 5f73     )..    def _s
-00010a80: 7461 7274 5f71 7565 7279 5f6d 6c5f 6464  tart_query_ml_dd
-00010a90: 6c28 0a20 2020 2020 2020 2073 656c 662c  l(.        self,
-00010aa0: 0a20 2020 2020 2020 2073 716c 3a20 7374  .        sql: st
-00010ab0: 722c 0a20 2020 2029 202d 3e20 5475 706c  r,.    ) -> Tupl
-00010ac0: 655b 6269 6771 7565 7279 2e74 6162 6c65  e[bigquery.table
-00010ad0: 2e52 6f77 4974 6572 6174 6f72 2c20 6269  .RowIterator, bi
-00010ae0: 6771 7565 7279 2e51 7565 7279 4a6f 625d  gquery.QueryJob]
-00010af0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010b00: 2020 2020 2020 5374 6172 7473 2042 6967        Starts Big
-00010b10: 5175 6572 7920 4d4c 2044 444c 2071 7565  Query ML DDL que
-00010b20: 7279 206a 6f62 2028 4352 4541 5445 204d  ry job (CREATE M
-00010b30: 4f44 454c 2f41 4c54 4552 204d 4f44 454c  ODEL/ALTER MODEL
-00010b40: 2f2e 2e2e 2920 616e 640a 2020 2020 2020  /...) and.      
-00010b50: 2020 7761 6974 7320 666f 7220 7265 7375    waits for resu
-00010b60: 6c74 732e 0a20 2020 2020 2020 2022 2222  lts..        """
-00010b70: 0a20 2020 2020 2020 206a 6f62 5f63 6f6e  .        job_con
-00010b80: 6669 6720 3d20 7365 6c66 2e5f 7072 6570  fig = self._prep
-00010b90: 6172 655f 7175 6572 795f 6a6f 625f 636f  are_query_job_co
-00010ba0: 6e66 6967 2829 0a0a 2020 2020 2020 2020  nfig()..        
-00010bb0: 2320 4251 4d4c 2065 7870 6563 7473 206b  # BQML expects k
-00010bc0: 6d73 5f6b 6579 5f6e 616d 6520 7468 726f  ms_key_name thro
-00010bd0: 7567 6820 4f50 5449 4f4e 5320 616e 6420  ugh OPTIONS and 
-00010be0: 6e6f 7420 7468 726f 7567 6820 6a6f 6220  not through job 
-00010bf0: 636f 6e66 6967 2c0a 2020 2020 2020 2020  config,.        
-00010c00: 2320 736f 2077 6520 6d75 7374 2072 6573  # so we must res
-00010c10: 6574 2061 6e79 2065 6e63 7279 7074 696f  et any encryptio
-00010c20: 6e20 7365 7420 696e 2074 6865 206a 6f62  n set in the job
-00010c30: 2063 6f6e 6669 670a 2020 2020 2020 2020   config.        
-00010c40: 2320 6874 7470 733a 2f2f 636c 6f75 642e  # https://cloud.
-00010c50: 676f 6f67 6c65 2e63 6f6d 2f62 6967 7175  google.com/bigqu
-00010c60: 6572 792f 646f 6373 2f63 7573 746f 6d65  ery/docs/custome
-00010c70: 722d 6d61 6e61 6765 642d 656e 6372 7970  r-managed-encryp
-00010c80: 7469 6f6e 2365 6e63 7279 7074 2d6d 6f64  tion#encrypt-mod
-00010c90: 656c 0a20 2020 2020 2020 206a 6f62 5f63  el.        job_c
-00010ca0: 6f6e 6669 672e 6465 7374 696e 6174 696f  onfig.destinatio
-00010cb0: 6e5f 656e 6372 7970 7469 6f6e 5f63 6f6e  n_encryption_con
-00010cc0: 6669 6775 7261 7469 6f6e 203d 204e 6f6e  figuration = Non
-00010cd0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00010ce0: 6e20 6269 6766 7261 6d65 732e 7365 7373  n bigframes.sess
-00010cf0: 696f 6e2e 5f69 6f2e 6269 6771 7565 7279  ion._io.bigquery
-00010d00: 2e73 7461 7274 5f71 7565 7279 5f77 6974  .start_query_wit
-00010d10: 685f 636c 6965 6e74 280a 2020 2020 2020  h_client(.      
-00010d20: 2020 2020 2020 7365 6c66 2e62 7163 6c69        self.bqcli
-00010d30: 656e 742c 2073 716c 2c20 6a6f 625f 636f  ent, sql, job_co
-00010d40: 6e66 6967 0a20 2020 2020 2020 2029 0a0a  nfig.        )..
-00010d50: 2020 2020 6465 6620 5f63 6163 6865 5f77      def _cache_w
-00010d60: 6974 685f 636c 7573 7465 725f 636f 6c73  ith_cluster_cols
-00010d70: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-00010d80: 6172 7261 795f 7661 6c75 653a 2063 6f72  array_value: cor
-00010d90: 652e 4172 7261 7956 616c 7565 2c20 636c  e.ArrayValue, cl
-00010da0: 7573 7465 725f 636f 6c73 3a20 7479 7069  uster_cols: typi
-00010db0: 6e67 2e53 6571 7565 6e63 655b 7374 725d  ng.Sequence[str]
-00010dc0: 0a20 2020 2029 202d 3e20 636f 7265 2e41  .    ) -> core.A
-00010dd0: 7272 6179 5661 6c75 653a 0a20 2020 2020  rrayValue:.     
-00010de0: 2020 2022 2222 4578 6563 7574 6573 2074     """Executes t
-00010df0: 6865 2071 7565 7279 2061 6e64 2075 7365  he query and use
-00010e00: 7320 7468 6520 7265 7375 6c74 696e 6720  s the resulting 
-00010e10: 7461 626c 6520 746f 2072 6577 7269 7465  table to rewrite
-00010e20: 2066 7574 7572 6520 6578 6563 7574 696f   future executio
-00010e30: 6e73 2e22 2222 0a20 2020 2020 2020 2023  ns.""".        #
-00010e40: 2054 4f44 4f3a 2055 7365 2074 6869 7320   TODO: Use this 
-00010e50: 666f 7220 616c 6c20 6578 6563 7574 696f  for all executio
-00010e60: 6e73 3f20 5072 6f62 6c65 6d20 6973 2074  ns? Problem is t
-00010e70: 6861 7420 6361 6368 696e 6720 6d61 7465  hat caching mate
-00010e80: 7269 616c 697a 6573 2065 7874 7261 0a20  rializes extra. 
-00010e90: 2020 2020 2020 2023 206f 7264 6572 696e         # orderin
-00010ea0: 6720 636f 6c75 6d6e 730a 2020 2020 2020  g columns.      
-00010eb0: 2020 636f 6d70 696c 6564 5f76 616c 7565    compiled_value
-00010ec0: 203d 2073 656c 662e 5f63 6f6d 7069 6c65   = self._compile
-00010ed0: 5f6f 7264 6572 6564 2861 7272 6179 5f76  _ordered(array_v
-00010ee0: 616c 7565 290a 0a20 2020 2020 2020 2069  alue)..        i
-00010ef0: 6269 735f 6578 7072 203d 2063 6f6d 7069  bis_expr = compi
-00010f00: 6c65 645f 7661 6c75 652e 5f74 6f5f 6962  led_value._to_ib
-00010f10: 6973 5f65 7870 7228 0a20 2020 2020 2020  is_expr(.       
-00010f20: 2020 2020 206f 7264 6572 696e 675f 6d6f       ordering_mo
-00010f30: 6465 3d22 756e 6f72 6465 7265 6422 2c20  de="unordered", 
-00010f40: 6578 706f 7365 5f68 6964 6465 6e5f 636f  expose_hidden_co
-00010f50: 6c73 3d54 7275 650a 2020 2020 2020 2020  ls=True.        
-00010f60: 290a 2020 2020 2020 2020 746d 705f 7461  ).        tmp_ta
-00010f70: 626c 6520 3d20 7365 6c66 2e5f 6962 6973  ble = self._ibis
-00010f80: 5f74 6f5f 7465 6d70 5f74 6162 6c65 280a  _to_temp_table(.
-00010f90: 2020 2020 2020 2020 2020 2020 6962 6973              ibis
-00010fa0: 5f65 7870 722c 2063 6c75 7374 6572 5f63  _expr, cluster_c
-00010fb0: 6f6c 733d 636c 7573 7465 725f 636f 6c73  ols=cluster_cols
-00010fc0: 2c20 6170 695f 6e61 6d65 3d22 6361 6368  , api_name="cach
-00010fd0: 6564 220a 2020 2020 2020 2020 290a 2020  ed".        ).  
-00010fe0: 2020 2020 2020 7461 626c 655f 6578 7072        table_expr
-00010ff0: 6573 7369 6f6e 203d 2073 656c 662e 6962  ession = self.ib
-00011000: 6973 5f63 6c69 656e 742e 7461 626c 6528  is_client.table(
-00011010: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
-00011020: 5f74 6162 6c65 2e74 6162 6c65 5f69 642c  _table.table_id,
-00011030: 0a20 2020 2020 2020 2020 2020 2073 6368  .            sch
-00011040: 656d 613d 746d 705f 7461 626c 652e 6461  ema=tmp_table.da
-00011050: 7461 7365 745f 6964 2c0a 2020 2020 2020  taset_id,.      
-00011060: 2020 2020 2020 6461 7461 6261 7365 3d74        database=t
-00011070: 6d70 5f74 6162 6c65 2e70 726f 6a65 6374  mp_table.project
-00011080: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00011090: 2020 2020 6e65 775f 636f 6c75 6d6e 7320      new_columns 
-000110a0: 3d20 5b74 6162 6c65 5f65 7870 7265 7373  = [table_express
-000110b0: 696f 6e5b 636f 6c75 6d6e 5d20 666f 7220  ion[column] for 
-000110c0: 636f 6c75 6d6e 2069 6e20 636f 6d70 696c  column in compil
-000110d0: 6564 5f76 616c 7565 2e63 6f6c 756d 6e5f  ed_value.column_
-000110e0: 6964 735d 0a20 2020 2020 2020 206e 6577  ids].        new
-000110f0: 5f68 6964 6465 6e5f 636f 6c75 6d6e 7320  _hidden_columns 
-00011100: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-00011110: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
-00011120: 5b63 6f6c 756d 6e5d 0a20 2020 2020 2020  [column].       
-00011130: 2020 2020 2066 6f72 2063 6f6c 756d 6e20       for column 
-00011140: 696e 2063 6f6d 7069 6c65 645f 7661 6c75  in compiled_valu
-00011150: 652e 5f68 6964 6465 6e5f 6f72 6465 7269  e._hidden_orderi
-00011160: 6e67 5f63 6f6c 756d 6e5f 6e61 6d65 730a  ng_column_names.
-00011170: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00011180: 2020 2320 544f 444f 3a20 496e 7374 6561    # TODO: Instea
-00011190: 642c 206b 6565 7020 7365 7373 696f 6e2d  d, keep session-
-000111a0: 7769 6465 206d 6170 206f 6620 6361 6368  wide map of cach
-000111b0: 6564 2072 6573 756c 7473 2061 6e64 2061  ed results and a
-000111c0: 7574 6f6d 6174 6963 616c 6c79 2072 6575  utomatically reu
-000111d0: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
-000111e0: 6e20 636f 7265 2e41 7272 6179 5661 6c75  n core.ArrayValu
-000111f0: 652e 6672 6f6d 5f69 6269 7328 0a20 2020  e.from_ibis(.   
-00011200: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
-00011210: 2020 2020 2020 2020 2020 2074 6162 6c65             table
-00011220: 5f65 7870 7265 7373 696f 6e2c 0a20 2020  _expression,.   
-00011230: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00011240: 3d6e 6577 5f63 6f6c 756d 6e73 2c0a 2020  =new_columns,.  
-00011250: 2020 2020 2020 2020 2020 6869 6464 656e            hidden
-00011260: 5f6f 7264 6572 696e 675f 636f 6c75 6d6e  _ordering_column
-00011270: 733d 6e65 775f 6869 6464 656e 5f63 6f6c  s=new_hidden_col
-00011280: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
-00011290: 2020 6f72 6465 7269 6e67 3d63 6f6d 7069    ordering=compi
-000112a0: 6c65 645f 7661 6c75 652e 5f6f 7264 6572  led_value._order
-000112b0: 696e 672c 0a20 2020 2020 2020 2029 0a0a  ing,.        )..
-000112c0: 2020 2020 6465 6620 5f63 6163 6865 5f77      def _cache_w
-000112d0: 6974 685f 6f66 6673 6574 7328 7365 6c66  ith_offsets(self
-000112e0: 2c20 6172 7261 795f 7661 6c75 653a 2063  , array_value: c
-000112f0: 6f72 652e 4172 7261 7956 616c 7565 2920  ore.ArrayValue) 
-00011300: 2d3e 2063 6f72 652e 4172 7261 7956 616c  -> core.ArrayVal
-00011310: 7565 3a0a 2020 2020 2020 2020 2222 2245  ue:.        """E
-00011320: 7865 6375 7465 7320 7468 6520 7175 6572  xecutes the quer
-00011330: 7920 616e 6420 7573 6573 2074 6865 2072  y and uses the r
-00011340: 6573 756c 7469 6e67 2074 6162 6c65 2074  esulting table t
-00011350: 6f20 7265 7772 6974 6520 6675 7475 7265  o rewrite future
-00011360: 2065 7865 6375 7469 6f6e 732e 2222 220a   executions.""".
-00011370: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00011380: 5573 6520 7468 6973 2066 6f72 2061 6c6c  Use this for all
-00011390: 2065 7865 6375 7469 6f6e 733f 2050 726f   executions? Pro
-000113a0: 626c 656d 2069 7320 7468 6174 2063 6163  blem is that cac
-000113b0: 6869 6e67 206d 6174 6572 6961 6c69 7a65  hing materialize
-000113c0: 7320 6578 7472 610a 2020 2020 2020 2020  s extra.        
-000113d0: 2320 6f72 6465 7269 6e67 2063 6f6c 756d  # ordering colum
-000113e0: 6e73 0a20 2020 2020 2020 2063 6f6d 7069  ns.        compi
-000113f0: 6c65 645f 7661 6c75 6520 3d20 7365 6c66  led_value = self
-00011400: 2e5f 636f 6d70 696c 655f 6f72 6465 7265  ._compile_ordere
-00011410: 6428 6172 7261 795f 7661 6c75 6529 0a0a  d(array_value)..
-00011420: 2020 2020 2020 2020 6962 6973 5f65 7870          ibis_exp
-00011430: 7220 3d20 636f 6d70 696c 6564 5f76 616c  r = compiled_val
-00011440: 7565 2e5f 746f 5f69 6269 735f 6578 7072  ue._to_ibis_expr
-00011450: 280a 2020 2020 2020 2020 2020 2020 6f72  (.            or
-00011460: 6465 7269 6e67 5f6d 6f64 653d 226f 6666  dering_mode="off
-00011470: 7365 745f 636f 6c22 2c20 6f72 6465 725f  set_col", order_
-00011480: 636f 6c5f 6e61 6d65 3d22 6269 6766 7261  col_name="bigfra
-00011490: 6d65 735f 6f66 6673 6574 7322 0a20 2020  mes_offsets".   
-000114a0: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-000114b0: 6d70 5f74 6162 6c65 203d 2073 656c 662e  mp_table = self.
-000114c0: 5f69 6269 735f 746f 5f74 656d 705f 7461  _ibis_to_temp_ta
-000114d0: 626c 6528 0a20 2020 2020 2020 2020 2020  ble(.           
-000114e0: 2069 6269 735f 6578 7072 2c20 636c 7573   ibis_expr, clus
-000114f0: 7465 725f 636f 6c73 3d5b 2262 6967 6672  ter_cols=["bigfr
-00011500: 616d 6573 5f6f 6666 7365 7473 225d 2c20  ames_offsets"], 
-00011510: 6170 695f 6e61 6d65 3d22 6361 6368 6564  api_name="cached
-00011520: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00011530: 2020 2020 7461 626c 655f 6578 7072 6573      table_expres
-00011540: 7369 6f6e 203d 2073 656c 662e 6962 6973  sion = self.ibis
-00011550: 5f63 6c69 656e 742e 7461 626c 6528 0a20  _client.table(. 
-00011560: 2020 2020 2020 2020 2020 2074 6d70 5f74             tmp_t
-00011570: 6162 6c65 2e74 6162 6c65 5f69 642c 0a20  able.table_id,. 
-00011580: 2020 2020 2020 2020 2020 2073 6368 656d             schem
-00011590: 613d 746d 705f 7461 626c 652e 6461 7461  a=tmp_table.data
-000115a0: 7365 745f 6964 2c0a 2020 2020 2020 2020  set_id,.        
-000115b0: 2020 2020 6461 7461 6261 7365 3d74 6d70      database=tmp
-000115c0: 5f74 6162 6c65 2e70 726f 6a65 6374 2c0a  _table.project,.
-000115d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000115e0: 2020 6e65 775f 636f 6c75 6d6e 7320 3d20    new_columns = 
-000115f0: 5b74 6162 6c65 5f65 7870 7265 7373 696f  [table_expressio
-00011600: 6e5b 636f 6c75 6d6e 5d20 666f 7220 636f  n[column] for co
-00011610: 6c75 6d6e 2069 6e20 636f 6d70 696c 6564  lumn in compiled
-00011620: 5f76 616c 7565 2e63 6f6c 756d 6e5f 6964  _value.column_id
-00011630: 735d 0a20 2020 2020 2020 206e 6577 5f68  s].        new_h
-00011640: 6964 6465 6e5f 636f 6c75 6d6e 7320 3d20  idden_columns = 
-00011650: 5b74 6162 6c65 5f65 7870 7265 7373 696f  [table_expressio
-00011660: 6e5b 2262 6967 6672 616d 6573 5f6f 6666  n["bigframes_off
-00011670: 7365 7473 225d 5d0a 2020 2020 2020 2020  sets"]].        
-00011680: 2320 544f 444f 3a20 496e 7374 6561 642c  # TODO: Instead,
-00011690: 206b 6565 7020 7365 7373 696f 6e2d 7769   keep session-wi
-000116a0: 6465 206d 6170 206f 6620 6361 6368 6564  de map of cached
-000116b0: 2072 6573 756c 7473 2061 6e64 2061 7574   results and aut
-000116c0: 6f6d 6174 6963 616c 6c79 2072 6575 7365  omatically reuse
-000116d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000116e0: 636f 7265 2e41 7272 6179 5661 6c75 652e  core.ArrayValue.
-000116f0: 6672 6f6d 5f69 6269 7328 0a20 2020 2020  from_ibis(.     
-00011700: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00011710: 2020 2020 2020 2020 2074 6162 6c65 5f65           table_e
-00011720: 7870 7265 7373 696f 6e2c 0a20 2020 2020  xpression,.     
-00011730: 2020 2020 2020 2063 6f6c 756d 6e73 3d6e         columns=n
-00011740: 6577 5f63 6f6c 756d 6e73 2c0a 2020 2020  ew_columns,.    
-00011750: 2020 2020 2020 2020 6869 6464 656e 5f6f          hidden_o
-00011760: 7264 6572 696e 675f 636f 6c75 6d6e 733d  rdering_columns=
-00011770: 6e65 775f 6869 6464 656e 5f63 6f6c 756d  new_hidden_colum
-00011780: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-00011790: 6f72 6465 7269 6e67 3d6f 7264 6572 2e45  ordering=order.E
-000117a0: 7870 7265 7373 696f 6e4f 7264 6572 696e  xpressionOrderin
-000117b0: 672e 6672 6f6d 5f6f 6666 7365 745f 636f  g.from_offset_co
-000117c0: 6c28 2262 6967 6672 616d 6573 5f6f 6666  l("bigframes_off
-000117d0: 7365 7473 2229 2c0a 2020 2020 2020 2020  sets"),.        
-000117e0: 290a 0a20 2020 2064 6566 205f 6973 5f74  )..    def _is_t
-000117f0: 7269 7669 616c 6c79 5f65 7865 6375 7461  rivially_executa
-00011800: 626c 6528 7365 6c66 2c20 6172 7261 795f  ble(self, array_
-00011810: 7661 6c75 653a 2063 6f72 652e 4172 7261  value: core.Arra
-00011820: 7956 616c 7565 293a 0a20 2020 2020 2020  yValue):.       
-00011830: 2022 2222 0a20 2020 2020 2020 2043 616e   """.        Can
-00011840: 2074 6865 2062 6c6f 636b 2062 6520 6576   the block be ev
-00011850: 616c 7561 7465 6420 7665 7279 2063 6865  aluated very che
-00011860: 6170 6c79 3f0a 2020 2020 2020 2020 4966  aply?.        If
-00011870: 2054 7275 652c 2074 6865 2061 7272 6179   True, the array
-00011880: 5f76 616c 7565 2070 726f 6261 626c 7920  _value probably 
-00011890: 6973 206e 6f74 2077 6f72 7468 2063 6163  is not worth cac
-000118a0: 6869 6e67 2e0a 2020 2020 2020 2020 2222  hing..        ""
-000118b0: 220a 2020 2020 2020 2020 2320 4f6e 6365  ".        # Once
-000118c0: 2072 6577 7269 7469 6e67 2069 7320 6176   rewriting is av
-000118d0: 6169 6c61 626c 652c 2077 696c 6c20 7761  ailable, will wa
-000118e0: 6e74 2074 6f20 7265 7772 6974 6520 6265  nt to rewrite be
-000118f0: 666f 7265 0a20 2020 2020 2020 2023 2065  fore.        # e
-00011900: 7661 6c75 6174 696e 6720 6578 6563 7574  valuating execut
-00011910: 696f 6e20 636f 7374 2e0a 2020 2020 2020  ion cost..      
-00011920: 2020 7265 7475 726e 2074 7261 7665 7273    return travers
-00011930: 616c 732e 6973 5f74 7269 7669 616c 6c79  als.is_trivially
-00011940: 5f65 7865 6375 7461 626c 6528 6172 7261  _executable(arra
-00011950: 795f 7661 6c75 652e 6e6f 6465 290a 0a20  y_value.node).. 
-00011960: 2020 2064 6566 205f 6578 6563 7574 6528     def _execute(
-00011970: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00011980: 2020 2020 2020 2061 7272 6179 5f76 616c         array_val
-00011990: 7565 3a20 636f 7265 2e41 7272 6179 5661  ue: core.ArrayVa
-000119a0: 6c75 652c 0a20 2020 2020 2020 206a 6f62  lue,.        job
-000119b0: 5f63 6f6e 6669 673a 204f 7074 696f 6e61  _config: Optiona
-000119c0: 6c5b 6269 6771 7565 7279 2e6a 6f62 2e51  l[bigquery.job.Q
-000119d0: 7565 7279 4a6f 6243 6f6e 6669 675d 203d  ueryJobConfig] =
-000119e0: 204e 6f6e 652c 0a20 2020 2020 2020 202a   None,.        *
-000119f0: 2c0a 2020 2020 2020 2020 736f 7274 6564  ,.        sorted
-00011a00: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-00011a10: 2020 2020 2020 2064 7279 5f72 756e 3d46         dry_run=F
-00011a20: 616c 7365 2c0a 2020 2020 2020 2020 636f  alse,.        co
-00011a30: 6c5f 6964 5f6f 7665 7272 6964 6573 3a20  l_id_overrides: 
-00011a40: 4d61 7070 696e 675b 7374 722c 2073 7472  Mapping[str, str
-00011a50: 5d20 3d20 7b7d 2c0a 2020 2020 2920 2d3e  ] = {},.    ) ->
-00011a60: 2074 7570 6c65 5b62 6967 7175 6572 792e   tuple[bigquery.
-00011a70: 7461 626c 652e 526f 7749 7465 7261 746f  table.RowIterato
-00011a80: 722c 2062 6967 7175 6572 792e 5175 6572  r, bigquery.Quer
-00011a90: 794a 6f62 5d3a 0a20 2020 2020 2020 2073  yJob]:.        s
-00011aa0: 716c 203d 2073 656c 662e 5f74 6f5f 7371  ql = self._to_sq
-00011ab0: 6c28 0a20 2020 2020 2020 2020 2020 2061  l(.            a
-00011ac0: 7272 6179 5f76 616c 7565 2c20 736f 7274  rray_value, sort
-00011ad0: 6564 3d73 6f72 7465 642c 2063 6f6c 5f69  ed=sorted, col_i
-00011ae0: 645f 6f76 6572 7269 6465 733d 636f 6c5f  d_overrides=col_
-00011af0: 6964 5f6f 7665 7272 6964 6573 0a20 2020  id_overrides.   
-00011b00: 2020 2020 2029 2020 2320 7479 7065 3a69       )  # type:i
-00011b10: 676e 6f72 650a 2020 2020 2020 2020 6966  gnore.        if
-00011b20: 206a 6f62 5f63 6f6e 6669 6720 6973 204e   job_config is N
-00011b30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00011b40: 206a 6f62 5f63 6f6e 6669 6720 3d20 6269   job_config = bi
-00011b50: 6771 7565 7279 2e51 7565 7279 4a6f 6243  gquery.QueryJobC
-00011b60: 6f6e 6669 6728 6472 795f 7275 6e3d 6472  onfig(dry_run=dr
-00011b70: 795f 7275 6e29 0a20 2020 2020 2020 2065  y_run).        e
-00011b80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011b90: 206a 6f62 5f63 6f6e 6669 672e 6472 795f   job_config.dry_
-00011ba0: 7275 6e20 3d20 6472 795f 7275 6e0a 2020  run = dry_run.  
-00011bb0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00011bc0: 662e 5f73 7461 7274 5f71 7565 7279 280a  f._start_query(.
-00011bd0: 2020 2020 2020 2020 2020 2020 7371 6c3d              sql=
-00011be0: 7371 6c2c 0a20 2020 2020 2020 2020 2020  sql,.           
-00011bf0: 206a 6f62 5f63 6f6e 6669 673d 6a6f 625f   job_config=job_
-00011c00: 636f 6e66 6967 2c0a 2020 2020 2020 2020  config,.        
-00011c10: 290a 0a20 2020 2064 6566 205f 7065 656b  )..    def _peek
-00011c20: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-00011c30: 6172 7261 795f 7661 6c75 653a 2063 6f72  array_value: cor
-00011c40: 652e 4172 7261 7956 616c 7565 2c20 6e5f  e.ArrayValue, n_
-00011c50: 726f 7773 3a20 696e 740a 2020 2020 2920  rows: int.    ) 
-00011c60: 2d3e 2074 7570 6c65 5b62 6967 7175 6572  -> tuple[bigquer
-00011c70: 792e 7461 626c 652e 526f 7749 7465 7261  y.table.RowItera
-00011c80: 746f 722c 2062 6967 7175 6572 792e 5175  tor, bigquery.Qu
-00011c90: 6572 794a 6f62 5d3a 0a20 2020 2020 2020  eryJob]:.       
-00011ca0: 2022 2222 4120 2770 6565 6b27 2065 6666   """A 'peek' eff
-00011cb0: 6963 6965 6e74 6c79 2061 6363 6573 7365  iciently accesse
-00011cc0: 7320 6120 736d 616c 6c20 6e75 6d62 6572  s a small number
-00011cd0: 206f 6620 726f 7773 2069 6e20 7468 6520   of rows in the 
-00011ce0: 6461 7461 6672 616d 652e 2222 220a 2020  dataframe.""".  
-00011cf0: 2020 2020 2020 6966 206e 6f74 2061 7272        if not arr
-00011d00: 6179 5f76 616c 7565 2e6e 6f64 652e 7065  ay_value.node.pe
-00011d10: 656b 6162 6c65 3a0a 2020 2020 2020 2020  ekable:.        
-00011d20: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-00011d30: 6c65 6d65 6e74 6564 4572 726f 7228 2263  lementedError("c
-00011d40: 616e 6e6f 7420 6566 6669 6369 656e 7420  annot efficient 
-00011d50: 7065 656b 2074 6869 7320 6461 7461 6672  peek this datafr
-00011d60: 616d 6522 290a 2020 2020 2020 2020 7371  ame").        sq
-00011d70: 6c20 3d20 7365 6c66 2e5f 636f 6d70 696c  l = self._compil
-00011d80: 655f 756e 6f72 6465 7265 6428 6172 7261  e_unordered(arra
-00011d90: 795f 7661 6c75 6529 2e70 6565 6b5f 7371  y_value).peek_sq
-00011da0: 6c28 6e5f 726f 7773 290a 2020 2020 2020  l(n_rows).      
-00011db0: 2020 7265 7475 726e 2073 656c 662e 5f73    return self._s
-00011dc0: 7461 7274 5f71 7565 7279 280a 2020 2020  tart_query(.    
-00011dd0: 2020 2020 2020 2020 7371 6c3d 7371 6c2c          sql=sql,
-00011de0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00011df0: 6465 6620 5f74 6f5f 7371 6c28 0a20 2020  def _to_sql(.   
+00007af0: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
+00007b00: 2c20 696e 6465 785f 636f 6c73 0a20 2020  , index_cols.   
+00007b10: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00007b20: 2020 2020 2020 2069 6620 6973 5f74 6f74         if is_tot
+00007b30: 616c 5f6f 7264 6572 696e 673a 0a20 2020  al_ordering:.   
+00007b40: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00007b50: 756d 6e5f 7661 6c75 6573 203d 205b 0a20  umn_values = [. 
+00007b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b70: 2020 2074 6162 6c65 5f65 7870 7265 7373     table_express
+00007b80: 696f 6e5b 636f 6c5d 2066 6f72 2063 6f6c  ion[col] for col
+00007b90: 2069 6e20 7461 626c 655f 6578 7072 6573   in table_expres
+00007ba0: 7369 6f6e 2e63 6f6c 756d 6e73 0a20 2020  sion.columns.   
+00007bb0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+00007bc0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00007bd0: 7272 6179 5f76 616c 7565 203d 2063 6f72  rray_value = cor
+00007be0: 652e 4172 7261 7956 616c 7565 2e66 726f  e.ArrayValue.fro
+00007bf0: 6d5f 6962 6973 280a 2020 2020 2020 2020  m_ibis(.        
+00007c00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007c10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007c20: 2020 2020 2020 7461 626c 655f 6578 7072        table_expr
+00007c30: 6573 7369 6f6e 2c0a 2020 2020 2020 2020  ession,.        
+00007c40: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00007c50: 6d6e 733d 636f 6c75 6d6e 5f76 616c 7565  mns=column_value
+00007c60: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00007c70: 2020 2020 2020 2068 6964 6465 6e5f 6f72         hidden_or
+00007c80: 6465 7269 6e67 5f63 6f6c 756d 6e73 3d5b  dering_columns=[
+00007c90: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00007ca0: 2020 2020 2020 206f 7264 6572 696e 673d         ordering=
+00007cb0: 6f72 6465 7269 6e67 2c0a 2020 2020 2020  ordering,.      
+00007cc0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00007cd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00007ce0: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+00007cf0: 7261 795f 7661 6c75 6520 3d20 7365 6c66  ray_value = self
+00007d00: 2e5f 6372 6561 7465 5f74 6f74 616c 5f6f  ._create_total_o
+00007d10: 7264 6572 696e 6728 7461 626c 655f 6578  rdering(table_ex
+00007d20: 7072 6573 7369 6f6e 290a 2020 2020 2020  pression).      
+00007d30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00007d40: 2020 2020 6172 7261 795f 7661 6c75 6520      array_value 
+00007d50: 3d20 7365 6c66 2e5f 6372 6561 7465 5f74  = self._create_t
+00007d60: 6f74 616c 5f6f 7264 6572 696e 6728 7461  otal_ordering(ta
+00007d70: 626c 655f 6578 7072 6573 7369 6f6e 290a  ble_expression).
+00007d80: 0a20 2020 2020 2020 2076 616c 7565 5f63  .        value_c
+00007d90: 6f6c 756d 6e73 203d 205b 636f 6c20 666f  olumns = [col fo
+00007da0: 7220 636f 6c20 696e 2061 7272 6179 5f76  r col in array_v
+00007db0: 616c 7565 2e63 6f6c 756d 6e5f 6964 7320  alue.column_ids 
+00007dc0: 6966 2063 6f6c 206e 6f74 2069 6e20 696e  if col not in in
+00007dd0: 6465 785f 636f 6c73 5d0a 2020 2020 2020  dex_cols].      
+00007de0: 2020 626c 6f63 6b20 3d20 626c 6f63 6b73    block = blocks
+00007df0: 2e42 6c6f 636b 280a 2020 2020 2020 2020  .Block(.        
+00007e00: 2020 2020 6172 7261 795f 7661 6c75 652c      array_value,
+00007e10: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00007e20: 6578 5f63 6f6c 756d 6e73 3d69 6e64 6578  ex_columns=index
+00007e30: 5f63 6f6c 732c 0a20 2020 2020 2020 2020  _cols,.         
+00007e40: 2020 2063 6f6c 756d 6e5f 6c61 6265 6c73     column_labels
+00007e50: 3d76 616c 7565 5f63 6f6c 756d 6e73 2c0a  =value_columns,.
+00007e60: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00007e70: 785f 6c61 6265 6c73 3d69 6e64 6578 5f63  x_labels=index_c
+00007e80: 6f6c 732c 0a20 2020 2020 2020 2029 0a20  ols,.        ). 
+00007e90: 2020 2020 2020 2069 6620 6d61 785f 7265         if max_re
+00007ea0: 7375 6c74 733a 0a20 2020 2020 2020 2020  sults:.         
+00007eb0: 2020 2062 6c6f 636b 203d 2062 6c6f 636b     block = block
+00007ec0: 2e73 6c69 6365 2873 746f 703d 6d61 785f  .slice(stop=max_
+00007ed0: 7265 7375 6c74 7329 0a20 2020 2020 2020  results).       
+00007ee0: 2064 6620 3d20 6461 7461 6672 616d 652e   df = dataframe.
+00007ef0: 4461 7461 4672 616d 6528 626c 6f63 6b29  DataFrame(block)
+00007f00: 0a0a 2020 2020 2020 2020 2320 4966 2075  ..        # If u
+00007f10: 7365 7220 7072 6f76 6964 6564 2069 6e64  ser provided ind
+00007f20: 6578 2063 6f6c 756d 6e73 2c20 7368 6f75  ex columns, shou
+00007f30: 6c64 2073 6f72 7420 6f76 6572 2069 740a  ld sort over it.
+00007f40: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00007f50: 6e64 6578 5f63 6f6c 7329 203e 2030 3a0a  ndex_cols) > 0:.
+00007f60: 2020 2020 2020 2020 2020 2020 6466 2e73              df.s
+00007f70: 6f72 745f 696e 6465 7828 290a 2020 2020  ort_index().    
+00007f80: 2020 2020 7265 7475 726e 2064 660a 0a20      return df.. 
+00007f90: 2020 2064 6566 205f 6368 6563 6b5f 696e     def _check_in
+00007fa0: 6465 785f 756e 6971 7565 6e65 7373 280a  dex_uniqueness(.
+00007fb0: 2020 2020 2020 2020 7365 6c66 2c20 7461          self, ta
+00007fc0: 626c 653a 2069 6269 735f 7479 7065 732e  ble: ibis_types.
+00007fd0: 5461 626c 652c 2069 6e64 6578 5f63 6f6c  Table, index_col
+00007fe0: 733a 204c 6973 745b 7374 725d 0a20 2020  s: List[str].   
+00007ff0: 2029 202d 3e20 626f 6f6c 3a0a 2020 2020   ) -> bool:.    
+00008000: 2020 2020 6469 7374 696e 6374 5f74 6162      distinct_tab
+00008010: 6c65 203d 2074 6162 6c65 2e73 656c 6563  le = table.selec
+00008020: 7428 2a69 6e64 6578 5f63 6f6c 7329 2e64  t(*index_cols).d
+00008030: 6973 7469 6e63 7428 290a 2020 2020 2020  istinct().      
+00008040: 2020 6973 5f75 6e69 7175 655f 7371 6c20    is_unique_sql 
+00008050: 3d20 6622 2222 5749 5448 2066 756c 6c5f  = f"""WITH full_
+00008060: 7461 626c 6520 4153 2028 0a20 2020 2020  table AS (.     
+00008070: 2020 2020 2020 207b 7365 6c66 2e69 6269         {self.ibi
+00008080: 735f 636c 6965 6e74 2e63 6f6d 7069 6c65  s_client.compile
+00008090: 2874 6162 6c65 297d 0a20 2020 2020 2020  (table)}.       
+000080a0: 2029 2c0a 2020 2020 2020 2020 6469 7374   ),.        dist
+000080b0: 696e 6374 5f74 6162 6c65 2041 5320 280a  inct_table AS (.
+000080c0: 2020 2020 2020 2020 2020 2020 7b73 656c              {sel
+000080d0: 662e 6962 6973 5f63 6c69 656e 742e 636f  f.ibis_client.co
+000080e0: 6d70 696c 6528 6469 7374 696e 6374 5f74  mpile(distinct_t
+000080f0: 6162 6c65 297d 0a20 2020 2020 2020 2029  able)}.        )
+00008100: 0a0a 2020 2020 2020 2020 5345 4c45 4354  ..        SELECT
+00008110: 2028 5345 4c45 4354 2043 4f55 4e54 282a   (SELECT COUNT(*
+00008120: 2920 4652 4f4d 2066 756c 6c5f 7461 626c  ) FROM full_tabl
+00008130: 6529 2041 5320 6074 6f74 616c 5f63 6f75  e) AS `total_cou
+00008140: 6e74 602c 0a20 2020 2020 2020 2028 5345  nt`,.        (SE
+00008150: 4c45 4354 2043 4f55 4e54 282a 2920 4652  LECT COUNT(*) FR
+00008160: 4f4d 2064 6973 7469 6e63 745f 7461 626c  OM distinct_tabl
+00008170: 6529 2041 5320 6064 6973 7469 6e63 745f  e) AS `distinct_
+00008180: 636f 756e 7460 0a20 2020 2020 2020 2022  count`.        "
+00008190: 2222 0a20 2020 2020 2020 2072 6573 756c  "".        resul
+000081a0: 7473 2c20 5f20 3d20 7365 6c66 2e5f 7374  ts, _ = self._st
+000081b0: 6172 745f 7175 6572 7928 6973 5f75 6e69  art_query(is_uni
+000081c0: 7175 655f 7371 6c29 0a20 2020 2020 2020  que_sql).       
+000081d0: 2072 6f77 203d 206e 6578 7428 6974 6572   row = next(iter
+000081e0: 2872 6573 756c 7473 2929 0a0a 2020 2020  (results))..    
+000081f0: 2020 2020 746f 7461 6c5f 636f 756e 7420      total_count 
+00008200: 3d20 726f 775b 2274 6f74 616c 5f63 6f75  = row["total_cou
+00008210: 6e74 225d 0a20 2020 2020 2020 2064 6973  nt"].        dis
+00008220: 7469 6e63 745f 636f 756e 7420 3d20 726f  tinct_count = ro
+00008230: 775b 2264 6973 7469 6e63 745f 636f 756e  w["distinct_coun
+00008240: 7422 5d0a 2020 2020 2020 2020 7265 7475  t"].        retu
+00008250: 726e 2074 6f74 616c 5f63 6f75 6e74 203d  rn total_count =
+00008260: 3d20 6469 7374 696e 6374 5f63 6f75 6e74  = distinct_count
+00008270: 0a0a 2020 2020 6465 6620 5f72 6561 645f  ..    def _read_
+00008280: 6269 6771 7565 7279 5f6c 6f61 645f 6a6f  bigquery_load_jo
+00008290: 6228 0a20 2020 2020 2020 2073 656c 662c  b(.        self,
+000082a0: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
+000082b0: 685f 6f72 5f62 7566 6665 723a 2073 7472  h_or_buffer: str
+000082c0: 207c 2049 4f5b 2262 7974 6573 225d 2c0a   | IO["bytes"],.
+000082d0: 2020 2020 2020 2020 7461 626c 653a 2055          table: U
+000082e0: 6e69 6f6e 5b62 6967 7175 6572 792e 5461  nion[bigquery.Ta
+000082f0: 626c 652c 2062 6967 7175 6572 792e 5461  ble, bigquery.Ta
+00008300: 626c 6552 6566 6572 656e 6365 5d2c 0a20  bleReference],. 
+00008310: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
+00008320: 2020 6a6f 625f 636f 6e66 6967 3a20 6269    job_config: bi
+00008330: 6771 7565 7279 2e4c 6f61 644a 6f62 436f  gquery.LoadJobCo
+00008340: 6e66 6967 2c0a 2020 2020 2020 2020 696e  nfig,.        in
+00008350: 6465 785f 636f 6c3a 2049 7465 7261 626c  dex_col: Iterabl
+00008360: 655b 7374 725d 207c 2073 7472 203d 2028  e[str] | str = (
+00008370: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
+00008380: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
+00008390: 5d20 3d20 2829 2c0a 2020 2020 2920 2d3e  ] = (),.    ) ->
+000083a0: 2064 6174 6166 7261 6d65 2e44 6174 6146   dataframe.DataF
+000083b0: 7261 6d65 3a0a 2020 2020 2020 2020 6966  rame:.        if
+000083c0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
+000083d0: 785f 636f 6c2c 2073 7472 293a 0a20 2020  x_col, str):.   
+000083e0: 2020 2020 2020 2020 2069 6e64 6578 5f63           index_c
+000083f0: 6f6c 7320 3d20 5b69 6e64 6578 5f63 6f6c  ols = [index_col
+00008400: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+00008410: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00008420: 785f 636f 6c73 203d 206c 6973 7428 696e  x_cols = list(in
+00008430: 6465 785f 636f 6c29 0a0a 2020 2020 2020  dex_col)..      
+00008440: 2020 6966 206e 6f74 206a 6f62 5f63 6f6e    if not job_con
+00008450: 6669 672e 636c 7573 7465 7269 6e67 5f66  fig.clustering_f
+00008460: 6965 6c64 7320 616e 6420 696e 6465 785f  ields and index_
+00008470: 636f 6c73 3a0a 2020 2020 2020 2020 2020  cols:.          
+00008480: 2020 6a6f 625f 636f 6e66 6967 2e63 6c75    job_config.clu
+00008490: 7374 6572 696e 675f 6669 656c 6473 203d  stering_fields =
+000084a0: 2069 6e64 6578 5f63 6f6c 735b 3a5f 4d41   index_cols[:_MA
+000084b0: 585f 434c 5553 5445 525f 434f 4c55 4d4e  X_CLUSTER_COLUMN
+000084c0: 535d 0a0a 2020 2020 2020 2020 6966 2069  S]..        if i
+000084d0: 7369 6e73 7461 6e63 6528 6669 6c65 7061  sinstance(filepa
+000084e0: 7468 5f6f 725f 6275 6666 6572 2c20 7374  th_or_buffer, st
+000084f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00008500: 6966 2066 696c 6570 6174 685f 6f72 5f62  if filepath_or_b
+00008510: 7566 6665 722e 7374 6172 7473 7769 7468  uffer.startswith
+00008520: 2822 6773 3a2f 2f22 293a 0a20 2020 2020  ("gs://"):.     
+00008530: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
+00008540: 6a6f 6220 3d20 7365 6c66 2e62 7163 6c69  job = self.bqcli
+00008550: 656e 742e 6c6f 6164 5f74 6162 6c65 5f66  ent.load_table_f
+00008560: 726f 6d5f 7572 6928 0a20 2020 2020 2020  rom_uri(.       
+00008570: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00008580: 6570 6174 685f 6f72 5f62 7566 6665 722c  epath_or_buffer,
+00008590: 2074 6162 6c65 2c20 6a6f 625f 636f 6e66   table, job_conf
+000085a0: 6967 3d6a 6f62 5f63 6f6e 6669 670a 2020  ig=job_config.  
+000085b0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000085c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000085d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000085e0: 2020 7769 7468 206f 7065 6e28 6669 6c65    with open(file
+000085f0: 7061 7468 5f6f 725f 6275 6666 6572 2c20  path_or_buffer, 
+00008600: 2272 6222 2920 6173 2073 6f75 7263 655f  "rb") as source_
+00008610: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+00008620: 2020 2020 2020 2020 2020 6c6f 6164 5f6a            load_j
+00008630: 6f62 203d 2073 656c 662e 6271 636c 6965  ob = self.bqclie
+00008640: 6e74 2e6c 6f61 645f 7461 626c 655f 6672  nt.load_table_fr
+00008650: 6f6d 5f66 696c 6528 0a20 2020 2020 2020  om_file(.       
+00008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008670: 2073 6f75 7263 655f 6669 6c65 2c20 7461   source_file, ta
+00008680: 626c 652c 206a 6f62 5f63 6f6e 6669 673d  ble, job_config=
+00008690: 6a6f 625f 636f 6e66 6967 0a20 2020 2020  job_config.     
+000086a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000086b0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000086c0: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
+000086d0: 6a6f 6220 3d20 7365 6c66 2e62 7163 6c69  job = self.bqcli
+000086e0: 656e 742e 6c6f 6164 5f74 6162 6c65 5f66  ent.load_table_f
+000086f0: 726f 6d5f 6669 6c65 280a 2020 2020 2020  rom_file(.      
+00008700: 2020 2020 2020 2020 2020 6669 6c65 7061            filepa
+00008710: 7468 5f6f 725f 6275 6666 6572 2c20 7461  th_or_buffer, ta
+00008720: 626c 652c 206a 6f62 5f63 6f6e 6669 673d  ble, job_config=
+00008730: 6a6f 625f 636f 6e66 6967 0a20 2020 2020  job_config.     
+00008740: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00008750: 2020 7365 6c66 2e5f 7374 6172 745f 6765    self._start_ge
+00008760: 6e65 7269 635f 6a6f 6228 6c6f 6164 5f6a  neric_job(load_j
+00008770: 6f62 290a 2020 2020 2020 2020 7461 626c  ob).        tabl
+00008780: 655f 6964 203d 2066 227b 7461 626c 652e  e_id = f"{table.
+00008790: 7072 6f6a 6563 747d 2e7b 7461 626c 652e  project}.{table.
+000087a0: 6461 7461 7365 745f 6964 7d2e 7b74 6162  dataset_id}.{tab
+000087b0: 6c65 2e74 6162 6c65 5f69 647d 220a 0a20  le.table_id}".. 
+000087c0: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
+000087d0: 7468 6520 7461 626c 6520 6578 7069 7261  the table expira
+000087e0: 7469 6f6e 2073 6f20 7765 2061 7265 6e27  tion so we aren'
+000087f0: 7420 6c69 6d69 7465 6420 746f 2074 6865  t limited to the
+00008800: 2064 6566 6175 6c74 2032 340a 2020 2020   default 24.    
+00008810: 2020 2020 2320 686f 7572 7320 6f66 2074      # hours of t
+00008820: 6865 2061 6e6f 6e79 6d6f 7573 2064 6174  he anonymous dat
+00008830: 6173 6574 2e0a 2020 2020 2020 2020 7461  aset..        ta
+00008840: 626c 655f 6578 7069 7261 7469 6f6e 203d  ble_expiration =
+00008850: 2062 6967 7175 6572 792e 5461 626c 6528   bigquery.Table(
+00008860: 7461 626c 655f 6964 290a 2020 2020 2020  table_id).      
+00008870: 2020 7461 626c 655f 6578 7069 7261 7469    table_expirati
+00008880: 6f6e 2e65 7870 6972 6573 203d 2028 0a20  on.expires = (. 
+00008890: 2020 2020 2020 2020 2020 2064 6174 6574             datet
+000088a0: 696d 652e 6461 7465 7469 6d65 2e6e 6f77  ime.datetime.now
+000088b0: 2864 6174 6574 696d 652e 7469 6d65 7a6f  (datetime.timezo
+000088c0: 6e65 2e75 7463 2920 2b20 636f 6e73 7461  ne.utc) + consta
+000088d0: 6e74 732e 4445 4641 554c 545f 4558 5049  nts.DEFAULT_EXPI
+000088e0: 5241 5449 4f4e 0a20 2020 2020 2020 2029  RATION.        )
+000088f0: 0a20 2020 2020 2020 2073 656c 662e 6271  .        self.bq
+00008900: 636c 6965 6e74 2e75 7064 6174 655f 7461  client.update_ta
+00008910: 626c 6528 7461 626c 655f 6578 7069 7261  ble(table_expira
+00008920: 7469 6f6e 2c20 5b22 6578 7069 7265 7322  tion, ["expires"
+00008930: 5d29 0a0a 2020 2020 2020 2020 2320 5468  ])..        # Th
+00008940: 6520 4269 6751 7565 7279 2052 4553 5420  e BigQuery REST 
+00008950: 4150 4920 666f 7220 7461 626c 6573 2e67  API for tables.g
+00008960: 6574 2064 6f65 736e 2774 2074 616b 6520  et doesn't take 
+00008970: 6120 7365 7373 696f 6e20 4944 2c20 736f  a session ID, so
+00008980: 2077 650a 2020 2020 2020 2020 2320 6361   we.        # ca
+00008990: 6e27 7420 6765 7420 7468 6520 7363 6865  n't get the sche
+000089a0: 6d61 2066 6f72 2061 2074 656d 7020 7461  ma for a temp ta
+000089b0: 626c 6520 7468 6174 2077 6179 2e0a 2020  ble that way..  
+000089c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000089d0: 662e 7265 6164 5f67 6271 5f74 6162 6c65  f.read_gbq_table
+000089e0: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
+000089f0: 626c 655f 6964 2c0a 2020 2020 2020 2020  ble_id,.        
+00008a00: 2020 2020 696e 6465 785f 636f 6c3d 696e      index_col=in
+00008a10: 6465 785f 636f 6c2c 0a20 2020 2020 2020  dex_col,.       
+00008a20: 2020 2020 2063 6f6c 756d 6e73 3d63 6f6c       columns=col
+00008a30: 756d 6e73 2c0a 2020 2020 2020 2020 290a  umns,.        ).
+00008a40: 0a20 2020 2064 6566 2072 6561 645f 6762  .    def read_gb
+00008a50: 715f 6d6f 6465 6c28 7365 6c66 2c20 6d6f  q_model(self, mo
+00008a60: 6465 6c5f 6e61 6d65 3a20 7374 7229 3a0a  del_name: str):.
+00008a70: 2020 2020 2020 2020 2222 224c 6f61 6473          """Loads
+00008a80: 2061 2042 6967 5175 6572 7920 4d4c 206d   a BigQuery ML m
+00008a90: 6f64 656c 2066 726f 6d20 4269 6751 7565  odel from BigQue
+00008aa0: 7279 2e0a 0a20 2020 2020 2020 202a 2a45  ry...        **E
+00008ab0: 7861 6d70 6c65 733a 2a2a 0a0a 2020 2020  xamples:**..    
+00008ac0: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
+00008ad0: 7274 2062 6967 6672 616d 6573 2e70 616e  rt bigframes.pan
+00008ae0: 6461 7320 6173 2062 7064 0a20 2020 2020  das as bpd.     
+00008af0: 2020 2020 2020 203e 3e3e 2062 7064 2e6f         >>> bpd.o
+00008b00: 7074 696f 6e73 2e64 6973 706c 6179 2e70  ptions.display.p
+00008b10: 726f 6772 6573 735f 6261 7220 3d20 4e6f  rogress_bar = No
+00008b20: 6e65 0a0a 2020 2020 2020 2020 5265 6164  ne..        Read
+00008b30: 2061 6e20 6578 6973 7469 6e67 2042 6967   an existing Big
+00008b40: 5175 6572 7920 4d4c 206d 6f64 656c 2e0a  Query ML model..
+00008b50: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+00008b60: 206d 6f64 656c 5f6e 616d 6520 3d20 2262   model_name = "b
+00008b70: 6967 6672 616d 6573 2d64 6576 2e62 716d  igframes-dev.bqm
+00008b80: 6c5f 7475 746f 7269 616c 2e70 656e 6775  l_tutorial.pengu
+00008b90: 696e 735f 6d6f 6465 6c22 0a20 2020 2020  ins_model".     
+00008ba0: 2020 2020 2020 203e 3e3e 206d 6f64 656c         >>> model
+00008bb0: 203d 2062 7064 2e72 6561 645f 6762 715f   = bpd.read_gbq_
+00008bc0: 6d6f 6465 6c28 6d6f 6465 6c5f 6e61 6d65  model(model_name
+00008bd0: 290a 0a20 2020 2020 2020 2041 7267 733a  )..        Args:
+00008be0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+00008bf0: 656c 5f6e 616d 6520 2873 7472 293a 0a20  el_name (str):. 
+00008c00: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00008c10: 6865 206d 6f64 656c 2773 206e 616d 6520  he model's name 
+00008c20: 696e 2042 6967 5175 6572 7920 696e 2074  in BigQuery in t
+00008c30: 6865 2066 6f72 6d61 740a 2020 2020 2020  he format.      
+00008c40: 2020 2020 2020 2020 2020 6070 726f 6a65            `proje
+00008c50: 6374 5f69 642e 6461 7461 7365 745f 6964  ct_id.dataset_id
+00008c60: 2e6d 6f64 656c 5f69 6460 2c20 6f72 206a  .model_id`, or j
+00008c70: 7573 7420 6064 6174 6173 6574 5f69 642e  ust `dataset_id.
+00008c80: 6d6f 6465 6c5f 6964 600a 2020 2020 2020  model_id`.      
+00008c90: 2020 2020 2020 2020 2020 746f 206c 6f61            to loa
+00008ca0: 6420 6672 6f6d 2074 6865 2064 6566 6175  d from the defau
+00008cb0: 6c74 2070 726f 6a65 6374 2e0a 0a20 2020  lt project...   
+00008cc0: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+00008cd0: 2020 2020 2020 2020 2020 4120 6269 6766            A bigf
+00008ce0: 7261 6d65 732e 6d6c 204d 6f64 656c 2c20  rames.ml Model, 
+00008cf0: 5472 616e 7366 6f72 6d65 7220 6f72 2050  Transformer or P
+00008d00: 6970 656c 696e 6520 7772 6170 7069 6e67  ipeline wrapping
+00008d10: 2074 6865 206d 6f64 656c 2e0a 2020 2020   the model..    
+00008d20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008d30: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+00008d40: 2e6d 6c2e 6c6f 6164 6572 0a0a 2020 2020  .ml.loader..    
+00008d50: 2020 2020 6d6f 6465 6c5f 7265 6620 3d20      model_ref = 
+00008d60: 6269 6771 7565 7279 2e4d 6f64 656c 5265  bigquery.ModelRe
+00008d70: 6665 7265 6e63 652e 6672 6f6d 5f73 7472  ference.from_str
+00008d80: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+00008d90: 206d 6f64 656c 5f6e 616d 652c 2064 6566   model_name, def
+00008da0: 6175 6c74 5f70 726f 6a65 6374 3d73 656c  ault_project=sel
+00008db0: 662e 6271 636c 6965 6e74 2e70 726f 6a65  f.bqclient.proje
+00008dc0: 6374 0a20 2020 2020 2020 2029 0a20 2020  ct.        ).   
+00008dd0: 2020 2020 206d 6f64 656c 203d 2073 656c       model = sel
+00008de0: 662e 6271 636c 6965 6e74 2e67 6574 5f6d  f.bqclient.get_m
+00008df0: 6f64 656c 286d 6f64 656c 5f72 6566 290a  odel(model_ref).
+00008e00: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+00008e10: 6967 6672 616d 6573 2e6d 6c2e 6c6f 6164  igframes.ml.load
+00008e20: 6572 2e66 726f 6d5f 6271 2873 656c 662c  er.from_bq(self,
+00008e30: 206d 6f64 656c 290a 0a20 2020 2040 7479   model)..    @ty
+00008e40: 7069 6e67 2e6f 7665 726c 6f61 640a 2020  ping.overload.  
+00008e50: 2020 6465 6620 7265 6164 5f70 616e 6461    def read_panda
+00008e60: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00008e70: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+00008e80: 653a 2070 616e 6461 732e 496e 6465 780a  e: pandas.Index.
+00008e90: 2020 2020 2920 2d3e 2062 6967 6672 616d      ) -> bigfram
+00008ea0: 6573 2e63 6f72 652e 696e 6465 7865 732e  es.core.indexes.
+00008eb0: 496e 6465 783a 0a20 2020 2020 2020 202e  Index:.        .
+00008ec0: 2e2e 0a0a 2020 2020 4074 7970 696e 672e  ....    @typing.
+00008ed0: 6f76 6572 6c6f 6164 0a20 2020 2064 6566  overload.    def
+00008ee0: 2072 6561 645f 7061 6e64 6173 2873 656c   read_pandas(sel
+00008ef0: 662c 2070 616e 6461 735f 6461 7461 6672  f, pandas_datafr
+00008f00: 616d 653a 2070 616e 6461 732e 5365 7269  ame: pandas.Seri
+00008f10: 6573 2920 2d3e 2062 6967 6672 616d 6573  es) -> bigframes
+00008f20: 2e73 6572 6965 732e 5365 7269 6573 3a0a  .series.Series:.
+00008f30: 2020 2020 2020 2020 2e2e 2e0a 0a20 2020          .....   
+00008f40: 2040 7479 7069 6e67 2e6f 7665 726c 6f61   @typing.overloa
+00008f50: 640a 2020 2020 6465 6620 7265 6164 5f70  d.    def read_p
+00008f60: 616e 6461 7328 7365 6c66 2c20 7061 6e64  andas(self, pand
+00008f70: 6173 5f64 6174 6166 7261 6d65 3a20 7061  as_dataframe: pa
+00008f80: 6e64 6173 2e44 6174 6146 7261 6d65 2920  ndas.DataFrame) 
+00008f90: 2d3e 2064 6174 6166 7261 6d65 2e44 6174  -> dataframe.Dat
+00008fa0: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
+00008fb0: 2e2e 2e0a 0a20 2020 2064 6566 2072 6561  .....    def rea
+00008fc0: 645f 7061 6e64 6173 280a 2020 2020 2020  d_pandas(.      
+00008fd0: 2020 7365 6c66 2c20 7061 6e64 6173 5f64    self, pandas_d
+00008fe0: 6174 6166 7261 6d65 3a20 556e 696f 6e5b  ataframe: Union[
+00008ff0: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
+00009000: 2c20 7061 6e64 6173 2e53 6572 6965 732c  , pandas.Series,
+00009010: 2070 616e 6461 732e 496e 6465 785d 0a20   pandas.Index]. 
+00009020: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00009030: 224c 6f61 6473 2044 6174 6146 7261 6d65  "Loads DataFrame
+00009040: 2066 726f 6d20 6120 7061 6e64 6173 2044   from a pandas D
+00009050: 6174 6146 7261 6d65 2e0a 0a20 2020 2020  ataFrame...     
+00009060: 2020 2054 6865 2070 616e 6461 7320 4461     The pandas Da
+00009070: 7461 4672 616d 6520 7769 6c6c 2062 6520  taFrame will be 
+00009080: 7065 7273 6973 7465 6420 6173 2061 2074  persisted as a t
+00009090: 656d 706f 7261 7279 2042 6967 5175 6572  emporary BigQuer
+000090a0: 7920 7461 626c 652c 2077 6869 6368 2063  y table, which c
+000090b0: 616e 2062 650a 2020 2020 2020 2020 6175  an be.        au
+000090c0: 746f 6d61 7469 6361 6c6c 7920 7265 6379  tomatically recy
+000090d0: 636c 6564 2061 6674 6572 2074 6865 2053  cled after the S
+000090e0: 6573 7369 6f6e 2069 7320 636c 6f73 6564  ession is closed
+000090f0: 2e0a 0a20 2020 2020 2020 202a 2a45 7861  ...        **Exa
+00009100: 6d70 6c65 733a 2a2a 0a0a 2020 2020 2020  mples:**..      
+00009110: 2020 2020 2020 3e3e 3e20 696d 706f 7274        >>> import
+00009120: 2062 6967 6672 616d 6573 2e70 616e 6461   bigframes.panda
+00009130: 7320 6173 2062 7064 0a20 2020 2020 2020  s as bpd.       
+00009140: 2020 2020 203e 3e3e 2069 6d70 6f72 7420       >>> import 
+00009150: 7061 6e64 6173 2061 7320 7064 0a20 2020  pandas as pd.   
+00009160: 2020 2020 2020 2020 203e 3e3e 2062 7064           >>> bpd
+00009170: 2e6f 7074 696f 6e73 2e64 6973 706c 6179  .options.display
+00009180: 2e70 726f 6772 6573 735f 6261 7220 3d20  .progress_bar = 
+00009190: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
+000091a0: 2020 3e3e 3e20 6420 3d20 7b27 636f 6c31    >>> d = {'col1
+000091b0: 273a 205b 312c 2032 5d2c 2027 636f 6c32  ': [1, 2], 'col2
+000091c0: 273a 205b 332c 2034 5d7d 0a20 2020 2020  ': [3, 4]}.     
+000091d0: 2020 2020 2020 203e 3e3e 2070 616e 6461         >>> panda
+000091e0: 735f 6466 203d 2070 642e 4461 7461 4672  s_df = pd.DataFr
+000091f0: 616d 6528 6461 7461 3d64 290a 2020 2020  ame(data=d).    
+00009200: 2020 2020 2020 2020 3e3e 3e20 6466 203d          >>> df =
+00009210: 2062 7064 2e72 6561 645f 7061 6e64 6173   bpd.read_pandas
+00009220: 2870 616e 6461 735f 6466 290a 2020 2020  (pandas_df).    
+00009230: 2020 2020 2020 2020 3e3e 3e20 6466 0a20          >>> df. 
+00009240: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00009250: 6c31 2020 636f 6c32 0a20 2020 2020 2020  l1  col2.       
+00009260: 2020 2020 2030 2020 2020 2031 2020 2020       0     1    
+00009270: 2033 0a20 2020 2020 2020 2020 2020 2031   3.            1
+00009280: 2020 2020 2032 2020 2020 2034 0a20 2020       2     4.   
+00009290: 2020 2020 2020 2020 203c 424c 414e 4b4c           <BLANKL
+000092a0: 494e 453e 0a20 2020 2020 2020 2020 2020  INE>.           
+000092b0: 205b 3220 726f 7773 2078 2032 2063 6f6c   [2 rows x 2 col
+000092c0: 756d 6e73 5d0a 0a20 2020 2020 2020 2041  umns]..        A
+000092d0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000092e0: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+000092f0: 6520 2870 616e 6461 732e 4461 7461 4672  e (pandas.DataFr
+00009300: 616d 652c 2070 616e 6461 732e 5365 7269  ame, pandas.Seri
+00009310: 6573 2c20 6f72 2070 616e 6461 732e 496e  es, or pandas.In
+00009320: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
+00009330: 2020 2020 2020 6120 7061 6e64 6173 2044        a pandas D
+00009340: 6174 6146 7261 6d65 2f53 6572 6965 732f  ataFrame/Series/
+00009350: 496e 6465 7820 6f62 6a65 6374 2074 6f20  Index object to 
+00009360: 6265 206c 6f61 6465 642e 0a0a 2020 2020  be loaded...    
+00009370: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00009380: 2020 2020 2020 2020 2041 6e20 6571 7569           An equi
+00009390: 7661 6c65 6e74 2062 6967 6672 616d 6573  valent bigframes
+000093a0: 2e70 616e 6461 732e 2844 6174 6146 7261  .pandas.(DataFra
+000093b0: 6d65 2f53 6572 6965 732f 496e 6465 7829  me/Series/Index)
+000093c0: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+000093d0: 2222 220a 2020 2020 2020 2020 696d 706f  """.        impo
+000093e0: 7274 2062 6967 6672 616d 6573 2e73 6572  rt bigframes.ser
+000093f0: 6965 7320 6173 2073 6572 6965 730a 0a20  ies as series.. 
+00009400: 2020 2020 2020 2023 2054 7279 2074 6f20         # Try to 
+00009410: 6861 6e64 6c65 206e 6f6e 2d64 6174 6166  handle non-dataf
+00009420: 7261 6d65 2070 616e 6461 7320 6f62 6a65  rame pandas obje
+00009430: 6374 7320 6173 2077 656c 6c0a 2020 2020  cts as well.    
+00009440: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00009450: 6528 7061 6e64 6173 5f64 6174 6166 7261  e(pandas_datafra
+00009460: 6d65 2c20 7061 6e64 6173 2e53 6572 6965  me, pandas.Serie
+00009470: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00009480: 6266 5f64 6620 3d20 7365 6c66 2e5f 7265  bf_df = self._re
+00009490: 6164 5f70 616e 6461 7328 7061 6e64 6173  ad_pandas(pandas
+000094a0: 2e44 6174 6146 7261 6d65 2870 616e 6461  .DataFrame(panda
+000094b0: 735f 6461 7461 6672 616d 6529 2c20 2272  s_dataframe), "r
+000094c0: 6561 645f 7061 6e64 6173 2229 0a20 2020  ead_pandas").   
+000094d0: 2020 2020 2020 2020 2062 665f 7365 7269           bf_seri
+000094e0: 6573 203d 2074 7970 696e 672e 6361 7374  es = typing.cast
+000094f0: 2873 6572 6965 732e 5365 7269 6573 2c20  (series.Series, 
+00009500: 6266 5f64 665b 6266 5f64 662e 636f 6c75  bf_df[bf_df.colu
+00009510: 6d6e 735b 305d 5d29 0a20 2020 2020 2020  mns[0]]).       
+00009520: 2020 2020 2023 2077 7261 7070 696e 6720       # wrapping 
+00009530: 696e 746f 2064 6620 6361 6e20 7365 7420  into df can set 
+00009540: 6e61 6d65 2074 6f20 3020 736f 2072 6573  name to 0 so res
+00009550: 6574 2074 6f20 6f72 6967 696e 616c 206f  et to original o
+00009560: 626a 6563 7420 6e61 6d65 0a20 2020 2020  bject name.     
+00009570: 2020 2020 2020 2062 665f 7365 7269 6573         bf_series
+00009580: 2e6e 616d 6520 3d20 7061 6e64 6173 5f64  .name = pandas_d
+00009590: 6174 6166 7261 6d65 2e6e 616d 650a 2020  ataframe.name.  
+000095a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000095b0: 2062 665f 7365 7269 6573 0a20 2020 2020   bf_series.     
+000095c0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+000095d0: 2870 616e 6461 735f 6461 7461 6672 616d  (pandas_datafram
+000095e0: 652c 2070 616e 6461 732e 496e 6465 7829  e, pandas.Index)
+000095f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00009600: 7475 726e 2073 656c 662e 5f72 6561 645f  turn self._read_
+00009610: 7061 6e64 6173 280a 2020 2020 2020 2020  pandas(.        
+00009620: 2020 2020 2020 2020 7061 6e64 6173 2e44          pandas.D
+00009630: 6174 6146 7261 6d65 2869 6e64 6578 3d70  ataFrame(index=p
+00009640: 616e 6461 735f 6461 7461 6672 616d 6529  andas_dataframe)
+00009650: 2c20 2272 6561 645f 7061 6e64 6173 220a  , "read_pandas".
+00009660: 2020 2020 2020 2020 2020 2020 292e 696e              ).in
+00009670: 6465 780a 2020 2020 2020 2020 6966 2069  dex.        if i
+00009680: 7369 6e73 7461 6e63 6528 7061 6e64 6173  sinstance(pandas
+00009690: 5f64 6174 6166 7261 6d65 2c20 7061 6e64  _dataframe, pand
+000096a0: 6173 2e44 6174 6146 7261 6d65 293a 0a20  as.DataFrame):. 
+000096b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000096c0: 6e20 7365 6c66 2e5f 7265 6164 5f70 616e  n self._read_pan
+000096d0: 6461 7328 7061 6e64 6173 5f64 6174 6166  das(pandas_dataf
+000096e0: 7261 6d65 2c20 2272 6561 645f 7061 6e64  rame, "read_pand
+000096f0: 6173 2229 0a20 2020 2020 2020 2065 6c73  as").        els
+00009700: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00009710: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00009720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009730: 2066 2272 6561 645f 7061 6e64 6173 2829   f"read_pandas()
+00009740: 2065 7870 6563 7473 2061 2070 616e 6461   expects a panda
+00009750: 732e 4461 7461 4672 616d 652c 2062 7574  s.DataFrame, but
+00009760: 2067 6f74 2061 207b 7479 7065 2870 616e   got a {type(pan
+00009770: 6461 735f 6461 7461 6672 616d 6529 7d22  das_dataframe)}"
+00009780: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00009790: 2020 2020 6465 6620 5f72 6561 645f 7061      def _read_pa
+000097a0: 6e64 6173 280a 2020 2020 2020 2020 7365  ndas(.        se
+000097b0: 6c66 2c20 7061 6e64 6173 5f64 6174 6166  lf, pandas_dataf
+000097c0: 7261 6d65 3a20 7061 6e64 6173 2e44 6174  rame: pandas.Dat
+000097d0: 6146 7261 6d65 2c20 6170 695f 6e61 6d65  aFrame, api_name
+000097e0: 3a20 7374 720a 2020 2020 2920 2d3e 2064  : str.    ) -> d
+000097f0: 6174 6166 7261 6d65 2e44 6174 6146 7261  ataframe.DataFra
+00009800: 6d65 3a0a 2020 2020 2020 2020 696d 706f  me:.        impo
+00009810: 7274 2062 6967 6672 616d 6573 2e64 6174  rt bigframes.dat
+00009820: 6166 7261 6d65 2061 7320 6461 7461 6672  aframe as datafr
+00009830: 616d 650a 0a20 2020 2020 2020 2069 6620  ame..        if 
+00009840: 6973 696e 7374 616e 6365 2870 616e 6461  isinstance(panda
+00009850: 735f 6461 7461 6672 616d 652c 2064 6174  s_dataframe, dat
+00009860: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
+00009870: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00009880: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00009890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000098a0: 2022 7265 6164 5f70 616e 6461 7328 2920   "read_pandas() 
+000098b0: 6578 7065 6374 7320 6120 7061 6e64 6173  expects a pandas
+000098c0: 2e44 6174 6146 7261 6d65 2c20 6275 7420  .DataFrame, but 
+000098d0: 676f 7420 6120 220a 2020 2020 2020 2020  got a ".        
+000098e0: 2020 2020 2020 2020 2262 6967 6672 616d          "bigfram
+000098f0: 6573 2e70 616e 6461 732e 4461 7461 4672  es.pandas.DataFr
+00009900: 616d 652e 220a 2020 2020 2020 2020 2020  ame.".          
+00009910: 2020 290a 0a20 2020 2020 2020 2069 6e6c    )..        inl
+00009920: 696e 655f 6466 203d 2073 656c 662e 5f72  ine_df = self._r
+00009930: 6561 645f 7061 6e64 6173 5f69 6e6c 696e  ead_pandas_inlin
+00009940: 6528 7061 6e64 6173 5f64 6174 6166 7261  e(pandas_datafra
+00009950: 6d65 290a 2020 2020 2020 2020 6966 2069  me).        if i
+00009960: 6e6c 696e 655f 6466 2069 7320 6e6f 7420  nline_df is not 
+00009970: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00009980: 2020 7265 7475 726e 2069 6e6c 696e 655f    return inline_
+00009990: 6466 0a20 2020 2020 2020 2072 6574 7572  df.        retur
+000099a0: 6e20 7365 6c66 2e5f 7265 6164 5f70 616e  n self._read_pan
+000099b0: 6461 735f 6c6f 6164 5f6a 6f62 2870 616e  das_load_job(pan
+000099c0: 6461 735f 6461 7461 6672 616d 652c 2061  das_dataframe, a
+000099d0: 7069 5f6e 616d 6529 0a0a 2020 2020 6465  pi_name)..    de
+000099e0: 6620 5f72 6561 645f 7061 6e64 6173 5f69  f _read_pandas_i
+000099f0: 6e6c 696e 6528 0a20 2020 2020 2020 2073  nline(.        s
+00009a00: 656c 662c 2070 616e 6461 735f 6461 7461  elf, pandas_data
+00009a10: 6672 616d 653a 2070 616e 6461 732e 4461  frame: pandas.Da
+00009a20: 7461 4672 616d 650a 2020 2020 2920 2d3e  taFrame.    ) ->
+00009a30: 204f 7074 696f 6e61 6c5b 6461 7461 6672   Optional[datafr
+00009a40: 616d 652e 4461 7461 4672 616d 655d 3a0a  ame.DataFrame]:.
+00009a50: 2020 2020 2020 2020 696d 706f 7274 2062          import b
+00009a60: 6967 6672 616d 6573 2e64 6174 6166 7261  igframes.datafra
+00009a70: 6d65 2061 7320 6461 7461 6672 616d 650a  me as dataframe.
+00009a80: 0a20 2020 2020 2020 2069 6620 7061 6e64  .        if pand
+00009a90: 6173 5f64 6174 6166 7261 6d65 2e6d 656d  as_dataframe.mem
+00009aa0: 6f72 795f 7573 6167 6528 6465 6570 3d54  ory_usage(deep=T
+00009ab0: 7275 6529 2e73 756d 2829 203e 204d 4158  rue).sum() > MAX
+00009ac0: 5f49 4e4c 494e 455f 4446 5f42 5954 4553  _INLINE_DF_BYTES
+00009ad0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00009ae0: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
+00009af0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00009b00: 2020 2020 696e 6c69 6e65 5f64 6620 3d20      inline_df = 
+00009b10: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
+00009b20: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
+00009b30: 2020 2020 2062 6c6f 636b 732e 426c 6f63       blocks.Bloc
+00009b40: 6b2e 6672 6f6d 5f6c 6f63 616c 2870 616e  k.from_local(pan
+00009b50: 6461 735f 6461 7461 6672 616d 652c 2073  das_dataframe, s
+00009b60: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
+00009b70: 2029 0a20 2020 2020 2020 2065 7863 6570   ).        excep
+00009b80: 7420 5661 6c75 6545 7272 6f72 3a20 2023  t ValueError:  #
+00009b90: 2054 6872 6f77 6e20 6279 2069 6269 7320   Thrown by ibis 
+00009ba0: 666f 7220 736f 6d65 2075 6e68 616e 646c  for some unhandl
+00009bb0: 6564 2074 7970 6573 0a20 2020 2020 2020  ed types.       
+00009bc0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00009bd0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00009be0: 7061 2e41 7272 6f77 5479 7065 4572 726f  pa.ArrowTypeErro
+00009bf0: 723a 2020 2320 5468 726f 776e 2062 7920  r:  # Thrown by 
+00009c00: 6172 726f 7720 666f 7220 7479 7065 7320  arrow for types 
+00009c10: 7769 7468 6f75 7420 6d61 7070 696e 6720  without mapping 
+00009c20: 2867 656f 292e 0a20 2020 2020 2020 2020  (geo)..         
+00009c30: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+00009c40: 2020 2020 2020 2020 696e 6c69 6e65 5f74          inline_t
+00009c50: 7970 6573 203d 2069 6e6c 696e 655f 6466  ypes = inline_df
+00009c60: 2e5f 626c 6f63 6b2e 6578 7072 2e73 6368  ._block.expr.sch
+00009c70: 656d 612e 6474 7970 6573 0a20 2020 2020  ema.dtypes.     
+00009c80: 2020 2023 2049 6269 7320 6861 7320 7072     # Ibis has pr
+00009c90: 6f62 6c65 6d73 2065 7363 6170 696e 6720  oblems escaping 
+00009ca0: 6279 7465 7320 6c69 7465 7261 6c73 2c20  bytes literals, 
+00009cb0: 7768 6963 6820 7769 6c6c 2063 6175 7365  which will cause
+00009cc0: 2073 796e 7461 7820 6572 726f 7273 2073   syntax errors s
+00009cd0: 6572 7665 722d 7369 6465 2e0a 2020 2020  erver-side..    
+00009ce0: 2020 2020 6966 2061 6c6c 2864 7479 7065      if all(dtype
+00009cf0: 2069 6e20 494e 4c49 4e41 424c 455f 4454   in INLINABLE_DT
+00009d00: 5950 4553 2066 6f72 2064 7479 7065 2069  YPES for dtype i
+00009d10: 6e20 696e 6c69 6e65 5f74 7970 6573 293a  n inline_types):
+00009d20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00009d30: 7572 6e20 696e 6c69 6e65 5f64 660a 2020  urn inline_df.  
+00009d40: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00009d50: 650a 0a20 2020 2064 6566 205f 7265 6164  e..    def _read
+00009d60: 5f70 616e 6461 735f 6c6f 6164 5f6a 6f62  _pandas_load_job
+00009d70: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00009d80: 7061 6e64 6173 5f64 6174 6166 7261 6d65  pandas_dataframe
+00009d90: 3a20 7061 6e64 6173 2e44 6174 6146 7261  : pandas.DataFra
+00009da0: 6d65 2c20 6170 695f 6e61 6d65 3a20 7374  me, api_name: st
+00009db0: 720a 2020 2020 2920 2d3e 2064 6174 6166  r.    ) -> dataf
+00009dc0: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
+00009dd0: 2020 2020 2020 2020 696d 706f 7274 2062          import b
+00009de0: 6967 6672 616d 6573 2e64 6174 6166 7261  igframes.datafra
+00009df0: 6d65 2061 7320 6461 7461 6672 616d 650a  me as dataframe.
+00009e00: 0a20 2020 2020 2020 2063 6f6c 5f69 6e64  .        col_ind
+00009e10: 6578 203d 2070 616e 6461 735f 6461 7461  ex = pandas_data
+00009e20: 6672 616d 652e 636f 6c75 6d6e 732e 636f  frame.columns.co
+00009e30: 7079 2829 0a20 2020 2020 2020 2063 6f6c  py().        col
+00009e40: 5f6c 6162 656c 732c 2069 6478 5f6c 6162  _labels, idx_lab
+00009e50: 656c 7320 3d20 280a 2020 2020 2020 2020  els = (.        
+00009e60: 2020 2020 636f 6c5f 696e 6465 782e 746f      col_index.to
+00009e70: 5f6c 6973 7428 292c 0a20 2020 2020 2020  _list(),.       
+00009e80: 2020 2020 2070 616e 6461 735f 6461 7461       pandas_data
+00009e90: 6672 616d 652e 696e 6465 782e 6e61 6d65  frame.index.name
+00009ea0: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
+00009eb0: 2020 2020 206e 6577 5f63 6f6c 5f69 6473       new_col_ids
+00009ec0: 2c20 6e65 775f 6964 785f 6964 7320 3d20  , new_idx_ids = 
+00009ed0: 7574 696c 732e 6765 745f 7374 616e 6461  utils.get_standa
+00009ee0: 7264 697a 6564 5f69 6473 280a 2020 2020  rdized_ids(.    
+00009ef0: 2020 2020 2020 2020 636f 6c5f 6c61 6265          col_labe
+00009f00: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00009f10: 6964 785f 6c61 6265 6c73 2c0a 2020 2020  idx_labels,.    
+00009f20: 2020 2020 2020 2020 2320 4c6f 6164 696e          # Loadin
+00009f30: 6720 7061 7271 7565 7420 6669 6c65 7320  g parquet files 
+00009f40: 696e 746f 2042 6967 5175 6572 7920 7769  into BigQuery wi
+00009f50: 7468 2073 7065 6369 616c 2063 6f6c 756d  th special colum
+00009f60: 6e20 6e61 6d65 730a 2020 2020 2020 2020  n names.        
+00009f70: 2020 2020 2320 6973 206f 6e6c 7920 7375      # is only su
+00009f80: 7070 6f72 7465 6420 756e 6465 7220 616e  pported under an
+00009f90: 2061 6c6c 6f77 6c69 7374 2e0a 2020 2020   allowlist..    
+00009fa0: 2020 2020 2020 2020 7374 7269 6374 3d54          strict=T
+00009fb0: 7275 652c 0a20 2020 2020 2020 2029 0a0a  rue,.        )..
+00009fc0: 2020 2020 2020 2020 2320 4164 6420 6f72          # Add or
+00009fd0: 6465 7220 636f 6c75 6d6e 2074 6f20 7061  der column to pa
+00009fe0: 6e64 6173 2044 6174 6146 7261 6d65 2074  ndas DataFrame t
+00009ff0: 6f20 7072 6573 6572 7665 206f 7264 6572  o preserve order
+0000a000: 2069 6e20 4269 6751 7565 7279 0a20 2020   in BigQuery.   
+0000a010: 2020 2020 206f 7264 6572 696e 675f 636f       ordering_co
+0000a020: 6c20 3d20 2272 6f77 6964 220a 2020 2020  l = "rowid".    
+0000a030: 2020 2020 636f 6c75 6d6e 7320 3d20 6672      columns = fr
+0000a040: 6f7a 656e 7365 7428 636f 6c5f 6c61 6265  ozenset(col_labe
+0000a050: 6c73 202b 2069 6478 5f6c 6162 656c 7329  ls + idx_labels)
+0000a060: 0a20 2020 2020 2020 2073 7566 6669 7820  .        suffix 
+0000a070: 3d20 320a 2020 2020 2020 2020 7768 696c  = 2.        whil
+0000a080: 6520 6f72 6465 7269 6e67 5f63 6f6c 2069  e ordering_col i
+0000a090: 6e20 636f 6c75 6d6e 733a 0a20 2020 2020  n columns:.     
+0000a0a0: 2020 2020 2020 206f 7264 6572 696e 675f         ordering_
+0000a0b0: 636f 6c20 3d20 6622 726f 7769 645f 7b73  col = f"rowid_{s
+0000a0c0: 7566 6669 787d 220a 2020 2020 2020 2020  uffix}".        
+0000a0d0: 2020 2020 7375 6666 6978 202b 3d20 310a      suffix += 1.
+0000a0e0: 0a20 2020 2020 2020 2070 616e 6461 735f  .        pandas_
+0000a0f0: 6461 7461 6672 616d 655f 636f 7079 203d  dataframe_copy =
+0000a100: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+0000a110: 652e 636f 7079 2829 0a20 2020 2020 2020  e.copy().       
+0000a120: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+0000a130: 655f 636f 7079 2e69 6e64 6578 2e6e 616d  e_copy.index.nam
+0000a140: 6573 203d 206e 6577 5f69 6478 5f69 6473  es = new_idx_ids
+0000a150: 0a20 2020 2020 2020 2070 616e 6461 735f  .        pandas_
+0000a160: 6461 7461 6672 616d 655f 636f 7079 2e63  dataframe_copy.c
+0000a170: 6f6c 756d 6e73 203d 2070 616e 6461 732e  olumns = pandas.
+0000a180: 496e 6465 7828 6e65 775f 636f 6c5f 6964  Index(new_col_id
+0000a190: 7329 0a20 2020 2020 2020 2070 616e 6461  s).        panda
+0000a1a0: 735f 6461 7461 6672 616d 655f 636f 7079  s_dataframe_copy
+0000a1b0: 5b6f 7264 6572 696e 675f 636f 6c5d 203d  [ordering_col] =
+0000a1c0: 206e 702e 6172 616e 6765 2870 616e 6461   np.arange(panda
+0000a1d0: 735f 6461 7461 6672 616d 655f 636f 7079  s_dataframe_copy
+0000a1e0: 2e73 6861 7065 5b30 5d29 0a0a 2020 2020  .shape[0])..    
+0000a1f0: 2020 2020 6a6f 625f 636f 6e66 6967 203d      job_config =
+0000a200: 2073 656c 662e 5f70 7265 7061 7265 5f6c   self._prepare_l
+0000a210: 6f61 645f 6a6f 625f 636f 6e66 6967 2829  oad_job_config()
+0000a220: 0a0a 2020 2020 2020 2020 2320 5370 6563  ..        # Spec
+0000a230: 6966 7920 7468 6520 6461 7465 7469 6d65  ify the datetime
+0000a240: 2064 7479 7065 732c 2077 6869 6368 2069   dtypes, which i
+0000a250: 7320 6175 746f 2d64 6574 6563 7465 6420  s auto-detected 
+0000a260: 6173 2074 696d 6573 7461 6d70 2074 7970  as timestamp typ
+0000a270: 6573 2e0a 2020 2020 2020 2020 7363 6865  es..        sche
+0000a280: 6d61 3a20 6c69 7374 5b62 6967 7175 6572  ma: list[bigquer
+0000a290: 792e 5363 6865 6d61 4669 656c 645d 203d  y.SchemaField] =
+0000a2a0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+0000a2b0: 636f 6c75 6d6e 2c20 6474 7970 6520 696e  column, dtype in
+0000a2c0: 207a 6970 286e 6577 5f63 6f6c 5f69 6473   zip(new_col_ids
+0000a2d0: 2c20 7061 6e64 6173 5f64 6174 6166 7261  , pandas_datafra
+0000a2e0: 6d65 2e64 7479 7065 7329 3a0a 2020 2020  me.dtypes):.    
+0000a2f0: 2020 2020 2020 2020 6966 2064 7479 7065          if dtype
+0000a300: 203d 3d20 2274 696d 6573 7461 6d70 5b75   == "timestamp[u
+0000a310: 735d 5b70 7961 7272 6f77 5d22 3a0a 2020  s][pyarrow]":.  
+0000a320: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0000a330: 6865 6d61 2e61 7070 656e 6428 0a20 2020  hema.append(.   
+0000a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a350: 2062 6967 7175 6572 792e 5363 6865 6d61   bigquery.Schema
+0000a360: 4669 656c 6428 636f 6c75 6d6e 2c20 6269  Field(column, bi
+0000a370: 6771 7565 7279 2e65 6e75 6d73 2e53 716c  gquery.enums.Sql
+0000a380: 5479 7065 4e61 6d65 732e 4441 5445 5449  TypeNames.DATETI
+0000a390: 4d45 290a 2020 2020 2020 2020 2020 2020  ME).            
+0000a3a0: 2020 2020 290a 2020 2020 2020 2020 6a6f      ).        jo
+0000a3b0: 625f 636f 6e66 6967 2e73 6368 656d 6120  b_config.schema 
+0000a3c0: 3d20 7363 6865 6d61 0a0a 2020 2020 2020  = schema..      
+0000a3d0: 2020 2320 436c 7573 7465 7269 6e67 2070    # Clustering p
+0000a3e0: 726f 6261 626c 7920 6e6f 7420 6e65 6564  robably not need
+0000a3f0: 6564 2061 6e79 7761 7973 2061 7320 7061  ed anyways as pa
+0000a400: 6e64 6173 2074 6162 6c65 7320 6172 6520  ndas tables are 
+0000a410: 736d 616c 6c0a 2020 2020 2020 2020 636c  small.        cl
+0000a420: 7573 7465 725f 636f 6c73 203d 205b 6f72  uster_cols = [or
+0000a430: 6465 7269 6e67 5f63 6f6c 5d0a 2020 2020  dering_col].    
+0000a440: 2020 2020 6a6f 625f 636f 6e66 6967 2e63      job_config.c
+0000a450: 6c75 7374 6572 696e 675f 6669 656c 6473  lustering_fields
+0000a460: 203d 2063 6c75 7374 6572 5f63 6f6c 730a   = cluster_cols.
+0000a470: 0a20 2020 2020 2020 206a 6f62 5f63 6f6e  .        job_con
+0000a480: 6669 672e 6c61 6265 6c73 203d 207b 2262  fig.labels = {"b
+0000a490: 6967 6672 616d 6573 2d61 7069 223a 2061  igframes-api": a
+0000a4a0: 7069 5f6e 616d 657d 0a0a 2020 2020 2020  pi_name}..      
+0000a4b0: 2020 6c6f 6164 5f74 6162 6c65 5f64 6573    load_table_des
+0000a4c0: 7469 6e61 7469 6f6e 203d 2062 6967 6672  tination = bigfr
+0000a4d0: 616d 6573 5f69 6f2e 7261 6e64 6f6d 5f74  ames_io.random_t
+0000a4e0: 6162 6c65 2873 656c 662e 5f61 6e6f 6e79  able(self._anony
+0000a4f0: 6d6f 7573 5f64 6174 6173 6574 290a 2020  mous_dataset).  
+0000a500: 2020 2020 2020 6c6f 6164 5f6a 6f62 203d        load_job =
+0000a510: 2073 656c 662e 6271 636c 6965 6e74 2e6c   self.bqclient.l
+0000a520: 6f61 645f 7461 626c 655f 6672 6f6d 5f64  oad_table_from_d
+0000a530: 6174 6166 7261 6d65 280a 2020 2020 2020  ataframe(.      
+0000a540: 2020 2020 2020 7061 6e64 6173 5f64 6174        pandas_dat
+0000a550: 6166 7261 6d65 5f63 6f70 792c 0a20 2020  aframe_copy,.   
+0000a560: 2020 2020 2020 2020 206c 6f61 645f 7461           load_ta
+0000a570: 626c 655f 6465 7374 696e 6174 696f 6e2c  ble_destination,
+0000a580: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
+0000a590: 5f63 6f6e 6669 673d 6a6f 625f 636f 6e66  _config=job_conf
+0000a5a0: 6967 2c0a 2020 2020 2020 2020 290a 2020  ig,.        ).  
+0000a5b0: 2020 2020 2020 7365 6c66 2e5f 7374 6172        self._star
+0000a5c0: 745f 6765 6e65 7269 635f 6a6f 6228 6c6f  t_generic_job(lo
+0000a5d0: 6164 5f6a 6f62 290a 0a20 2020 2020 2020  ad_job)..       
+0000a5e0: 206f 7264 6572 696e 6720 3d20 6f72 6465   ordering = orde
+0000a5f0: 722e 4578 7072 6573 7369 6f6e 4f72 6465  r.ExpressionOrde
+0000a600: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
+0000a610: 2020 6f72 6465 7269 6e67 5f76 616c 7565    ordering_value
+0000a620: 5f63 6f6c 756d 6e73 3d74 7570 6c65 285b  _columns=tuple([
+0000a630: 6f72 6465 722e 6173 6365 6e64 696e 675f  order.ascending_
+0000a640: 6f76 6572 286f 7264 6572 696e 675f 636f  over(ordering_co
+0000a650: 6c29 5d29 2c0a 2020 2020 2020 2020 2020  l)]),.          
+0000a660: 2020 746f 7461 6c5f 6f72 6465 7269 6e67    total_ordering
+0000a670: 5f63 6f6c 756d 6e73 3d66 726f 7a65 6e73  _columns=frozens
+0000a680: 6574 285b 6f72 6465 7269 6e67 5f63 6f6c  et([ordering_col
+0000a690: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+0000a6a0: 696e 7465 6765 725f 656e 636f 6469 6e67  integer_encoding
+0000a6b0: 3d49 6e74 6567 6572 456e 636f 6469 6e67  =IntegerEncoding
+0000a6c0: 2854 7275 652c 2069 735f 7365 7175 656e  (True, is_sequen
+0000a6d0: 7469 616c 3d54 7275 6529 2c0a 2020 2020  tial=True),.    
+0000a6e0: 2020 2020 290a 2020 2020 2020 2020 7461      ).        ta
+0000a6f0: 626c 655f 6578 7072 6573 7369 6f6e 203d  ble_expression =
+0000a700: 2073 656c 662e 6962 6973 5f63 6c69 656e   self.ibis_clien
+0000a710: 742e 7461 626c 6528 2020 2320 7479 7065  t.table(  # type
+0000a720: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
+0000a730: 2020 2020 206c 6f61 645f 7461 626c 655f       load_table_
+0000a740: 6465 7374 696e 6174 696f 6e2e 7461 626c  destination.tabl
+0000a750: 655f 6964 2c0a 2020 2020 2020 2020 2020  e_id,.          
+0000a760: 2020 7363 6865 6d61 3d6c 6f61 645f 7461    schema=load_ta
+0000a770: 626c 655f 6465 7374 696e 6174 696f 6e2e  ble_destination.
+0000a780: 6461 7461 7365 745f 6964 2c0a 2020 2020  dataset_id,.    
+0000a790: 2020 2020 2020 2020 6461 7461 6261 7365          database
+0000a7a0: 3d6c 6f61 645f 7461 626c 655f 6465 7374  =load_table_dest
+0000a7b0: 696e 6174 696f 6e2e 7072 6f6a 6563 742c  ination.project,
+0000a7c0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000a7d0: 2020 2020 2320 622f 3239 3735 3930 3137      # b/29759017
+0000a7e0: 3820 506f 7465 6e74 6961 6c6c 7920 6120  8 Potentially a 
+0000a7f0: 6275 6720 696e 2062 7163 6c69 656e 742e  bug in bqclient.
+0000a800: 6c6f 6164 5f74 6162 6c65 5f66 726f 6d5f  load_table_from_
+0000a810: 6461 7461 6672 616d 6528 292c 2074 6861  dataframe(), tha
+0000a820: 7420 6f6e 6c79 2077 6865 6e20 7468 6520  t only when the 
+0000a830: 4446 2069 7320 656d 7074 792c 2074 6865  DF is empty, the
+0000a840: 2069 6e64 6578 2063 6f6c 756d 6e73 2064   index columns d
+0000a850: 6973 6170 7065 6172 2069 6e20 7461 626c  isappear in tabl
+0000a860: 655f 6578 7072 6573 7369 6f6e 2e0a 2020  e_expression..  
+0000a870: 2020 2020 2020 6966 2061 6e79 280a 2020        if any(.  
+0000a880: 2020 2020 2020 2020 2020 5b6e 6577 5f69            [new_i
+0000a890: 6478 5f69 6420 6e6f 7420 696e 2074 6162  dx_id not in tab
+0000a8a0: 6c65 5f65 7870 7265 7373 696f 6e2e 636f  le_expression.co
+0000a8b0: 6c75 6d6e 7320 666f 7220 6e65 775f 6964  lumns for new_id
+0000a8c0: 785f 6964 2069 6e20 6e65 775f 6964 785f  x_id in new_idx_
+0000a8d0: 6964 735d 0a20 2020 2020 2020 2029 3a0a  ids].        ):.
+0000a8e0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000a8f0: 6964 785f 6964 732c 2069 6478 5f6c 6162  idx_ids, idx_lab
+0000a900: 656c 7320 3d20 5b5d 2c20 5b5d 0a0a 2020  els = [], []..  
+0000a910: 2020 2020 2020 636f 6c75 6d6e 5f76 616c        column_val
+0000a920: 7565 7320 3d20 5b0a 2020 2020 2020 2020  ues = [.        
+0000a930: 2020 2020 7461 626c 655f 6578 7072 6573      table_expres
+0000a940: 7369 6f6e 5b63 6f6c 5d0a 2020 2020 2020  sion[col].      
+0000a950: 2020 2020 2020 666f 7220 636f 6c20 696e        for col in
+0000a960: 2074 6162 6c65 5f65 7870 7265 7373 696f   table_expressio
+0000a970: 6e2e 636f 6c75 6d6e 730a 2020 2020 2020  n.columns.      
+0000a980: 2020 2020 2020 6966 2063 6f6c 2021 3d20        if col != 
+0000a990: 6f72 6465 7269 6e67 5f63 6f6c 0a20 2020  ordering_col.   
+0000a9a0: 2020 2020 205d 0a20 2020 2020 2020 2061       ].        a
+0000a9b0: 7272 6179 5f76 616c 7565 203d 2063 6f72  rray_value = cor
+0000a9c0: 652e 4172 7261 7956 616c 7565 2e66 726f  e.ArrayValue.fro
+0000a9d0: 6d5f 6962 6973 280a 2020 2020 2020 2020  m_ibis(.        
+0000a9e0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000a9f0: 2020 2020 2020 7461 626c 655f 6578 7072        table_expr
+0000aa00: 6573 7369 6f6e 2c0a 2020 2020 2020 2020  ession,.        
+0000aa10: 2020 2020 636f 6c75 6d6e 733d 636f 6c75      columns=colu
+0000aa20: 6d6e 5f76 616c 7565 732c 0a20 2020 2020  mn_values,.     
+0000aa30: 2020 2020 2020 2068 6964 6465 6e5f 6f72         hidden_or
+0000aa40: 6465 7269 6e67 5f63 6f6c 756d 6e73 3d5b  dering_columns=[
+0000aa50: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
+0000aa60: 5b6f 7264 6572 696e 675f 636f 6c5d 5d2c  [ordering_col]],
+0000aa70: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0000aa80: 6572 696e 673d 6f72 6465 7269 6e67 2c0a  ering=ordering,.
+0000aa90: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000aaa0: 2020 2062 6c6f 636b 203d 2062 6c6f 636b     block = block
+0000aab0: 732e 426c 6f63 6b28 0a20 2020 2020 2020  s.Block(.       
+0000aac0: 2020 2020 2061 7272 6179 5f76 616c 7565       array_value
+0000aad0: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+0000aae0: 6465 785f 636f 6c75 6d6e 733d 6e65 775f  dex_columns=new_
+0000aaf0: 6964 785f 6964 732c 0a20 2020 2020 2020  idx_ids,.       
+0000ab00: 2020 2020 2063 6f6c 756d 6e5f 6c61 6265       column_labe
+0000ab10: 6c73 3d63 6f6c 5f69 6e64 6578 2c0a 2020  ls=col_index,.  
+0000ab20: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+0000ab30: 6c61 6265 6c73 3d69 6478 5f6c 6162 656c  labels=idx_label
+0000ab40: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
+0000ab50: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+0000ab60: 6672 616d 652e 4461 7461 4672 616d 6528  frame.DataFrame(
+0000ab70: 626c 6f63 6b29 0a0a 2020 2020 6465 6620  block)..    def 
+0000ab80: 7265 6164 5f63 7376 280a 2020 2020 2020  read_csv(.      
+0000ab90: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000aba0: 6669 6c65 7061 7468 5f6f 725f 6275 6666  filepath_or_buff
+0000abb0: 6572 3a20 7374 7220 7c20 494f 5b22 6279  er: str | IO["by
+0000abc0: 7465 7322 5d2c 0a20 2020 2020 2020 202a  tes"],.        *
+0000abd0: 2c0a 2020 2020 2020 2020 7365 703a 204f  ,.        sep: O
+0000abe0: 7074 696f 6e61 6c5b 7374 725d 203d 2022  ptional[str] = "
+0000abf0: 2c22 2c0a 2020 2020 2020 2020 6865 6164  ,",.        head
+0000ac00: 6572 3a20 4f70 7469 6f6e 616c 5b69 6e74  er: Optional[int
+0000ac10: 5d20 3d20 302c 0a20 2020 2020 2020 206e  ] = 0,.        n
+0000ac20: 616d 6573 3a20 4f70 7469 6f6e 616c 5b0a  ames: Optional[.
+0000ac30: 2020 2020 2020 2020 2020 2020 556e 696f              Unio
+0000ac40: 6e5b 4d75 7461 626c 6553 6571 7565 6e63  n[MutableSequenc
+0000ac50: 655b 416e 795d 2c20 6e70 2e6e 6461 7272  e[Any], np.ndarr
+0000ac60: 6179 5b41 6e79 2c20 416e 795d 2c20 5475  ay[Any, Any], Tu
+0000ac70: 706c 655b 416e 792c 202e 2e2e 5d2c 2072  ple[Any, ...], r
+0000ac80: 616e 6765 5d0a 2020 2020 2020 2020 5d20  ange].        ] 
+0000ac90: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000aca0: 696e 6465 785f 636f 6c3a 204f 7074 696f  index_col: Optio
+0000acb0: 6e61 6c5b 0a20 2020 2020 2020 2020 2020  nal[.           
+0000acc0: 2055 6e69 6f6e 5b69 6e74 2c20 7374 722c   Union[int, str,
+0000acd0: 2053 6571 7565 6e63 655b 556e 696f 6e5b   Sequence[Union[
+0000ace0: 7374 722c 2069 6e74 5d5d 2c20 4c69 7465  str, int]], Lite
+0000acf0: 7261 6c5b 4661 6c73 655d 5d0a 2020 2020  ral[False]].    
+0000ad00: 2020 2020 5d20 3d20 4e6f 6e65 2c0a 2020      ] = None,.  
+0000ad10: 2020 2020 2020 7573 6563 6f6c 733a 204f        usecols: O
+0000ad20: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+0000ad30: 2020 2020 2055 6e69 6f6e 5b0a 2020 2020       Union[.    
+0000ad40: 2020 2020 2020 2020 2020 2020 4d75 7461              Muta
+0000ad50: 626c 6553 6571 7565 6e63 655b 7374 725d  bleSequence[str]
+0000ad60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ad70: 2020 5475 706c 655b 7374 722c 202e 2e2e    Tuple[str, ...
+0000ad80: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000ad90: 2020 2053 6571 7565 6e63 655b 696e 745d     Sequence[int]
+0000ada0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000adb0: 2020 7061 6e64 6173 2e53 6572 6965 732c    pandas.Series,
+0000adc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000add0: 2070 616e 6461 732e 496e 6465 782c 0a20   pandas.Index,. 
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000adf0: 702e 6e64 6172 7261 795b 416e 792c 2041  p.ndarray[Any, A
+0000ae00: 6e79 5d2c 0a20 2020 2020 2020 2020 2020  ny],.           
+0000ae10: 2020 2020 2043 616c 6c61 626c 655b 5b41       Callable[[A
+0000ae20: 6e79 5d2c 2062 6f6f 6c5d 2c0a 2020 2020  ny], bool],.    
+0000ae30: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0000ae40: 2020 5d20 3d20 4e6f 6e65 2c0a 2020 2020    ] = None,.    
+0000ae50: 2020 2020 6474 7970 653a 204f 7074 696f      dtype: Optio
+0000ae60: 6e61 6c5b 4469 6374 5d20 3d20 4e6f 6e65  nal[Dict] = None
+0000ae70: 2c0a 2020 2020 2020 2020 656e 6769 6e65  ,.        engine
+0000ae80: 3a20 4f70 7469 6f6e 616c 5b0a 2020 2020  : Optional[.    
+0000ae90: 2020 2020 2020 2020 4c69 7465 7261 6c5b          Literal[
+0000aea0: 2263 222c 2022 7079 7468 6f6e 222c 2022  "c", "python", "
+0000aeb0: 7079 6172 726f 7722 2c20 2270 7974 686f  pyarrow", "pytho
+0000aec0: 6e2d 6677 6622 2c20 2262 6967 7175 6572  n-fwf", "bigquer
+0000aed0: 7922 5d0a 2020 2020 2020 2020 5d20 3d20  y"].        ] = 
+0000aee0: 4e6f 6e65 2c0a 2020 2020 2020 2020 656e  None,.        en
+0000aef0: 636f 6469 6e67 3a20 4f70 7469 6f6e 616c  coding: Optional
+0000af00: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0000af10: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+0000af20: 2020 2020 2920 2d3e 2064 6174 6166 7261      ) -> datafra
+0000af30: 6d65 2e44 6174 6146 7261 6d65 3a0a 2020  me.DataFrame:.  
+0000af40: 2020 2020 2020 7461 626c 6520 3d20 6269        table = bi
+0000af50: 6766 7261 6d65 735f 696f 2e72 616e 646f  gframes_io.rando
+0000af60: 6d5f 7461 626c 6528 7365 6c66 2e5f 616e  m_table(self._an
+0000af70: 6f6e 796d 6f75 735f 6461 7461 7365 7429  onymous_dataset)
+0000af80: 0a0a 2020 2020 2020 2020 6966 2065 6e67  ..        if eng
+0000af90: 696e 6520 6973 206e 6f74 204e 6f6e 6520  ine is not None 
+0000afa0: 616e 6420 656e 6769 6e65 203d 3d20 2262  and engine == "b
+0000afb0: 6967 7175 6572 7922 3a0a 2020 2020 2020  igquery":.      
+0000afc0: 2020 2020 2020 6966 2061 6e79 2870 6172        if any(par
+0000afd0: 616d 2069 7320 6e6f 7420 4e6f 6e65 2066  am is not None f
+0000afe0: 6f72 2070 6172 616d 2069 6e20 2864 7479  or param in (dty
+0000aff0: 7065 2c20 6e61 6d65 7329 293a 0a20 2020  pe, names)):.   
+0000b000: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0000b010: 5f73 7570 706f 7274 6564 203d 2028 2264  _supported = ("d
+0000b020: 7479 7065 222c 2022 6e61 6d65 7322 290a  type", "names").
+0000b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b040: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+0000b050: 6e74 6564 4572 726f 7228 0a20 2020 2020  ntedError(.     
+0000b060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b070: 2242 6967 5175 6572 7920 656e 6769 6e65  "BigQuery engine
+0000b080: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+0000b090: 7420 7468 6573 6520 6172 6775 6d65 6e74  t these argument
+0000b0a0: 733a 207b 6e6f 745f 7375 7070 6f72 7465  s: {not_supporte
+0000b0b0: 647d 2e20 220a 2020 2020 2020 2020 2020  d}. ".          
+0000b0c0: 2020 2020 2020 2020 2020 6622 7b63 6f6e            f"{con
+0000b0d0: 7374 616e 7473 2e46 4545 4442 4143 4b5f  stants.FEEDBACK_
+0000b0e0: 4c49 4e4b 7d22 0a20 2020 2020 2020 2020  LINK}".         
+0000b0f0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000b100: 2020 2020 2020 6966 2069 6e64 6578 5f63        if index_c
+0000b110: 6f6c 2069 7320 6e6f 7420 4e6f 6e65 2061  ol is not None a
+0000b120: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+0000b130: 2020 2020 206e 6f74 2069 6e64 6578 5f63       not index_c
+0000b140: 6f6c 206f 7220 6e6f 7420 6973 696e 7374  ol or not isinst
+0000b150: 616e 6365 2869 6e64 6578 5f63 6f6c 2c20  ance(index_col, 
+0000b160: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
+0000b170: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0000b180: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+0000b190: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
+0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1b0: 2020 2022 4269 6751 7565 7279 2065 6e67     "BigQuery eng
+0000b1c0: 696e 6520 6f6e 6c79 2073 7570 706f 7274  ine only support
+0000b1d0: 7320 6120 7369 6e67 6c65 2063 6f6c 756d  s a single colum
+0000b1e0: 6e20 6e61 6d65 2066 6f72 2060 696e 6465  n name for `inde
+0000b1f0: 785f 636f 6c60 2e20 220a 2020 2020 2020  x_col`. ".      
+0000b200: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000b210: 7b63 6f6e 7374 616e 7473 2e46 4545 4442  {constants.FEEDB
+0000b220: 4143 4b5f 4c49 4e4b 7d22 0a20 2020 2020  ACK_LINK}".     
+0000b230: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000b240: 2020 2020 2020 2020 2020 2320 4e6f 6e65            # None
+0000b250: 2076 616c 7565 2066 6f72 2069 6e64 6578   value for index
+0000b260: 5f63 6f6c 2063 616e 6e6f 7420 6265 2070  _col cannot be p
+0000b270: 6173 7365 6420 746f 2072 6561 645f 6762  assed to read_gb
+0000b280: 710a 2020 2020 2020 2020 2020 2020 6966  q.            if
+0000b290: 2069 6e64 6578 5f63 6f6c 2069 7320 4e6f   index_col is No
+0000b2a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000b2b0: 2020 2020 696e 6465 785f 636f 6c20 3d20      index_col = 
+0000b2c0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0000b2d0: 2320 7573 6563 6f6c 7320 7368 6f75 6c64  # usecols should
+0000b2e0: 206f 6e6c 7920 6265 2061 6e20 6974 6572   only be an iter
+0000b2f0: 6162 6c65 206f 6620 7374 7269 6e67 7320  able of strings 
+0000b300: 2863 6f6c 756d 6e20 6e61 6d65 7329 2066  (column names) f
+0000b310: 6f72 2075 7365 2061 7320 636f 6c75 6d6e  or use as column
+0000b320: 7320 696e 2072 6561 645f 6762 712e 0a20  s in read_gbq.. 
+0000b330: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+0000b340: 6e73 3a20 5475 706c 655b 416e 792c 202e  ns: Tuple[Any, .
+0000b350: 2e2e 5d20 3d20 7475 706c 6528 290a 2020  ..] = tuple().  
+0000b360: 2020 2020 2020 2020 2020 6966 2075 7365            if use
+0000b370: 636f 6c73 2069 7320 6e6f 7420 4e6f 6e65  cols is not None
+0000b380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b390: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000b3a0: 7573 6563 6f6c 732c 2049 7465 7261 626c  usecols, Iterabl
+0000b3b0: 6529 2061 6e64 2061 6c6c 280a 2020 2020  e) and all(.    
+0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3d0: 6973 696e 7374 616e 6365 2863 6f6c 2c20  isinstance(col, 
+0000b3e0: 7374 7229 2066 6f72 2063 6f6c 2069 6e20  str) for col in 
+0000b3f0: 7573 6563 6f6c 730a 2020 2020 2020 2020  usecols.        
+0000b400: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0000b410: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000b420: 6f6c 756d 6e73 203d 2074 7570 6c65 2863  olumns = tuple(c
+0000b430: 6f6c 2066 6f72 2063 6f6c 2069 6e20 7573  ol for col in us
+0000b440: 6563 6f6c 7329 0a20 2020 2020 2020 2020  ecols).         
+0000b450: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b470: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
+0000b480: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
+0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4a0: 2020 2020 2242 6967 5175 6572 7920 656e      "BigQuery en
+0000b4b0: 6769 6e65 206f 6e6c 7920 7375 7070 6f72  gine only suppor
+0000b4c0: 7473 2061 6e20 6974 6572 6162 6c65 206f  ts an iterable o
+0000b4d0: 6620 7374 7269 6e67 7320 666f 7220 6075  f strings for `u
+0000b4e0: 7365 636f 6c73 602e 2022 0a20 2020 2020  secols`. ".     
+0000b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b500: 2020 2066 227b 636f 6e73 7461 6e74 732e     f"{constants.
+0000b510: 4645 4544 4241 434b 5f4c 494e 4b7d 220a  FEEDBACK_LINK}".
+0000b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b530: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0000b540: 2020 2069 6620 656e 636f 6469 6e67 2069     if encoding i
+0000b550: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2065  s not None and e
+0000b560: 6e63 6f64 696e 6720 6e6f 7420 696e 205f  ncoding not in _
+0000b570: 5641 4c49 445f 454e 434f 4449 4e47 533a  VALID_ENCODINGS:
+0000b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b590: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
+0000b5a0: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
+0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5c0: 6622 4269 6751 7565 7279 2065 6e67 696e  f"BigQuery engin
+0000b5d0: 6520 6f6e 6c79 2073 7570 706f 7274 7320  e only supports 
+0000b5e0: 7468 6520 666f 6c6c 6f77 696e 6720 656e  the following en
+0000b5f0: 636f 6469 6e67 733a 207b 5f56 414c 4944  codings: {_VALID
+0000b600: 5f45 4e43 4f44 494e 4753 7d2e 2022 0a20  _ENCODINGS}. ". 
+0000b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b620: 2020 2066 227b 636f 6e73 7461 6e74 732e     f"{constants.
+0000b630: 4645 4544 4241 434b 5f4c 494e 4b7d 220a  FEEDBACK_LINK}".
+0000b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b650: 290a 0a20 2020 2020 2020 2020 2020 206a  )..            j
+0000b660: 6f62 5f63 6f6e 6669 6720 3d20 7365 6c66  ob_config = self
+0000b670: 2e5f 7072 6570 6172 655f 6c6f 6164 5f6a  ._prepare_load_j
+0000b680: 6f62 5f63 6f6e 6669 6728 290a 2020 2020  ob_config().    
+0000b690: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+0000b6a0: 6967 2e63 7265 6174 655f 6469 7370 6f73  ig.create_dispos
+0000b6b0: 6974 696f 6e20 3d20 6269 6771 7565 7279  ition = bigquery
+0000b6c0: 2e43 7265 6174 6544 6973 706f 7369 7469  .CreateDispositi
+0000b6d0: 6f6e 2e43 5245 4154 455f 4946 5f4e 4545  on.CREATE_IF_NEE
+0000b6e0: 4445 440a 2020 2020 2020 2020 2020 2020  DED.            
+0000b6f0: 6a6f 625f 636f 6e66 6967 2e73 6f75 7263  job_config.sourc
+0000b700: 655f 666f 726d 6174 203d 2062 6967 7175  e_format = bigqu
+0000b710: 6572 792e 536f 7572 6365 466f 726d 6174  ery.SourceFormat
+0000b720: 2e43 5356 0a20 2020 2020 2020 2020 2020  .CSV.           
+0000b730: 206a 6f62 5f63 6f6e 6669 672e 7772 6974   job_config.writ
+0000b740: 655f 6469 7370 6f73 6974 696f 6e20 3d20  e_disposition = 
+0000b750: 6269 6771 7565 7279 2e57 7269 7465 4469  bigquery.WriteDi
+0000b760: 7370 6f73 6974 696f 6e2e 5752 4954 455f  sposition.WRITE_
+0000b770: 454d 5054 590a 2020 2020 2020 2020 2020  EMPTY.          
+0000b780: 2020 6a6f 625f 636f 6e66 6967 2e61 7574    job_config.aut
+0000b790: 6f64 6574 6563 7420 3d20 5472 7565 0a20  odetect = True. 
+0000b7a0: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
+0000b7b0: 6f6e 6669 672e 6669 656c 645f 6465 6c69  onfig.field_deli
+0000b7c0: 6d69 7465 7220 3d20 7365 700a 2020 2020  miter = sep.    
+0000b7d0: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+0000b7e0: 6967 2e65 6e63 6f64 696e 6720 3d20 656e  ig.encoding = en
+0000b7f0: 636f 6469 6e67 0a20 2020 2020 2020 2020  coding.         
+0000b800: 2020 206a 6f62 5f63 6f6e 6669 672e 6c61     job_config.la
+0000b810: 6265 6c73 203d 207b 2262 6967 6672 616d  bels = {"bigfram
+0000b820: 6573 2d61 7069 223a 2022 7265 6164 5f63  es-api": "read_c
+0000b830: 7376 227d 0a0a 2020 2020 2020 2020 2020  sv"}..          
+0000b840: 2020 2320 5765 2077 616e 7420 746f 206d    # We want to m
+0000b850: 6174 6368 2070 616e 6461 7320 6265 6861  atch pandas beha
+0000b860: 7669 6f72 2e20 4966 2068 6561 6465 7220  vior. If header 
+0000b870: 6973 2030 2c20 6e6f 2072 6f77 7320 7368  is 0, no rows sh
+0000b880: 6f75 6c64 2062 6520 736b 6970 7065 642c  ould be skipped,
+0000b890: 2073 6f20 7765 0a20 2020 2020 2020 2020   so we.         
+0000b8a0: 2020 2023 2064 6f20 6e6f 7420 6e65 6564     # do not need
+0000b8b0: 2074 6f20 7365 7420 6073 6b69 705f 6c65   to set `skip_le
+0000b8c0: 6164 696e 675f 726f 7773 602e 2049 6620  ading_rows`. If 
+0000b8d0: 6865 6164 6572 2069 7320 4e6f 6e65 2c20  header is None, 
+0000b8e0: 7468 656e 2074 6865 7265 2069 7320 6e6f  then there is no
+0000b8f0: 2068 6561 6465 722e 0a20 2020 2020 2020   header..       
+0000b900: 2020 2020 2023 2053 6574 7469 6e67 2073       # Setting s
+0000b910: 6b69 705f 6c65 6164 696e 675f 726f 7773  kip_leading_rows
+0000b920: 2074 6f20 3020 646f 6573 2074 6861 742e   to 0 does that.
+0000b930: 2049 6620 6865 6164 6572 3d4e 2061 6e64   If header=N and
+0000b940: 204e 3e30 2c20 7765 2077 616e 7420 746f   N>0, we want to
+0000b950: 2073 6b69 7020 4e20 726f 7773 2e0a 2020   skip N rows..  
+0000b960: 2020 2020 2020 2020 2020 6966 2068 6561            if hea
+0000b970: 6465 7220 6973 204e 6f6e 653a 0a20 2020  der is None:.   
+0000b980: 2020 2020 2020 2020 2020 2020 206a 6f62               job
+0000b990: 5f63 6f6e 6669 672e 736b 6970 5f6c 6561  _config.skip_lea
+0000b9a0: 6469 6e67 5f72 6f77 7320 3d20 300a 2020  ding_rows = 0.  
+0000b9b0: 2020 2020 2020 2020 2020 656c 6966 2068            elif h
+0000b9c0: 6561 6465 7220 3e20 303a 0a20 2020 2020  eader > 0:.     
+0000b9d0: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
+0000b9e0: 6f6e 6669 672e 736b 6970 5f6c 6561 6469  onfig.skip_leadi
+0000b9f0: 6e67 5f72 6f77 7320 3d20 6865 6164 6572  ng_rows = header
+0000ba00: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000ba10: 7475 726e 2073 656c 662e 5f72 6561 645f  turn self._read_
+0000ba20: 6269 6771 7565 7279 5f6c 6f61 645f 6a6f  bigquery_load_jo
+0000ba30: 6228 0a20 2020 2020 2020 2020 2020 2020  b(.             
+0000ba40: 2020 2066 696c 6570 6174 685f 6f72 5f62     filepath_or_b
+0000ba50: 7566 6665 722c 0a20 2020 2020 2020 2020  uffer,.         
+0000ba60: 2020 2020 2020 2074 6162 6c65 2c0a 2020         table,.  
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 6a6f                jo
+0000ba80: 625f 636f 6e66 6967 3d6a 6f62 5f63 6f6e  b_config=job_con
+0000ba90: 6669 672c 0a20 2020 2020 2020 2020 2020  fig,.           
+0000baa0: 2020 2020 2069 6e64 6578 5f63 6f6c 3d69       index_col=i
+0000bab0: 6e64 6578 5f63 6f6c 2c0a 2020 2020 2020  ndex_col,.      
+0000bac0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+0000bad0: 733d 636f 6c75 6d6e 732c 0a20 2020 2020  s=columns,.     
+0000bae0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000baf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000bb00: 2020 2069 6620 616e 7928 6172 6720 696e     if any(arg in
+0000bb10: 206b 7761 7267 7320 666f 7220 6172 6720   kwargs for arg 
+0000bb20: 696e 2028 2263 6875 6e6b 7369 7a65 222c  in ("chunksize",
+0000bb30: 2022 6974 6572 6174 6f72 2229 293a 0a20   "iterator")):. 
+0000bb40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000bb50: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
+0000bb60: 7465 6445 7272 6f72 280a 2020 2020 2020  tedError(.      
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 2227                "'
+0000bb80: 6368 756e 6b73 697a 6527 2061 6e64 2027  chunksize' and '
+0000bb90: 6974 6572 6174 6f72 2720 6172 6775 6d65  iterator' argume
+0000bba0: 6e74 7320 6172 6520 6e6f 7420 7375 7070  nts are not supp
+0000bbb0: 6f72 7465 642e 2022 0a20 2020 2020 2020  orted. ".       
+0000bbc0: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
+0000bbd0: 636f 6e73 7461 6e74 732e 4645 4544 4241  constants.FEEDBA
+0000bbe0: 434b 5f4c 494e 4b7d 220a 2020 2020 2020  CK_LINK}".      
+0000bbf0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000bc00: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000bc10: 7374 616e 6365 2866 696c 6570 6174 685f  stance(filepath_
+0000bc20: 6f72 5f62 7566 6665 722c 2073 7472 293a  or_buffer, str):
+0000bc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bc40: 2073 656c 662e 5f63 6865 636b 5f66 696c   self._check_fil
+0000bc50: 655f 7369 7a65 2866 696c 6570 6174 685f  e_size(filepath_
+0000bc60: 6f72 5f62 7566 6665 7229 0a20 2020 2020  or_buffer).     
+0000bc70: 2020 2020 2020 2070 616e 6461 735f 6466         pandas_df
+0000bc80: 203d 2070 616e 6461 732e 7265 6164 5f63   = pandas.read_c
+0000bc90: 7376 280a 2020 2020 2020 2020 2020 2020  sv(.            
+0000bca0: 2020 2020 6669 6c65 7061 7468 5f6f 725f      filepath_or_
+0000bcb0: 6275 6666 6572 2c0a 2020 2020 2020 2020  buffer,.        
+0000bcc0: 2020 2020 2020 2020 7365 703d 7365 702c          sep=sep,
+0000bcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bce0: 2068 6561 6465 723d 6865 6164 6572 2c0a   header=header,.
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd00: 6e61 6d65 733d 6e61 6d65 732c 0a20 2020  names=names,.   
+0000bd10: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+0000bd20: 6578 5f63 6f6c 3d69 6e64 6578 5f63 6f6c  ex_col=index_col
+0000bd30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000bd40: 2020 7573 6563 6f6c 733d 7573 6563 6f6c    usecols=usecol
+0000bd50: 732c 2020 2320 7479 7065 3a20 6967 6e6f  s,  # type: igno
+0000bd60: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
+0000bd70: 2020 2064 7479 7065 3d64 7479 7065 2c0a     dtype=dtype,.
+0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd90: 656e 6769 6e65 3d65 6e67 696e 652c 0a20  engine=engine,. 
+0000bda0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000bdb0: 6e63 6f64 696e 673d 656e 636f 6469 6e67  ncoding=encoding
+0000bdc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000bdd0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+0000bde0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000bdf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000be00: 662e 5f72 6561 645f 7061 6e64 6173 2870  f._read_pandas(p
+0000be10: 616e 6461 735f 6466 2c20 2272 6561 645f  andas_df, "read_
+0000be20: 6373 7622 2920 2023 2074 7970 653a 2069  csv")  # type: i
+0000be30: 676e 6f72 650a 0a20 2020 2064 6566 2072  gnore..    def r
+0000be40: 6561 645f 7069 636b 6c65 280a 2020 2020  ead_pickle(.    
+0000be50: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000be60: 2020 6669 6c65 7061 7468 5f6f 725f 6275    filepath_or_bu
+0000be70: 6666 6572 3a20 4669 6c65 5061 7468 207c  ffer: FilePath |
+0000be80: 2052 6561 6450 6963 6b6c 6542 7566 6665   ReadPickleBuffe
+0000be90: 722c 0a20 2020 2020 2020 2063 6f6d 7072  r,.        compr
+0000bea0: 6573 7369 6f6e 3a20 436f 6d70 7265 7373  ession: Compress
+0000beb0: 696f 6e4f 7074 696f 6e73 203d 2022 696e  ionOptions = "in
+0000bec0: 6665 7222 2c0a 2020 2020 2020 2020 7374  fer",.        st
+0000bed0: 6f72 6167 655f 6f70 7469 6f6e 733a 2053  orage_options: S
+0000bee0: 746f 7261 6765 4f70 7469 6f6e 7320 3d20  torageOptions = 
+0000bef0: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
+0000bf00: 2020 2020 2070 616e 6461 735f 6f62 6a20       pandas_obj 
+0000bf10: 3d20 7061 6e64 6173 2e72 6561 645f 7069  = pandas.read_pi
+0000bf20: 636b 6c65 280a 2020 2020 2020 2020 2020  ckle(.          
+0000bf30: 2020 6669 6c65 7061 7468 5f6f 725f 6275    filepath_or_bu
+0000bf40: 6666 6572 2c0a 2020 2020 2020 2020 2020  ffer,.          
+0000bf50: 2020 636f 6d70 7265 7373 696f 6e3d 636f    compression=co
+0000bf60: 6d70 7265 7373 696f 6e2c 0a20 2020 2020  mpression,.     
+0000bf70: 2020 2020 2020 2073 746f 7261 6765 5f6f         storage_o
+0000bf80: 7074 696f 6e73 3d73 746f 7261 6765 5f6f  ptions=storage_o
+0000bf90: 7074 696f 6e73 2c0a 2020 2020 2020 2020  ptions,.        
+0000bfa0: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+0000bfb0: 696e 7374 616e 6365 2870 616e 6461 735f  instance(pandas_
+0000bfc0: 6f62 6a2c 2070 616e 6461 732e 5365 7269  obj, pandas.Seri
+0000bfd0: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+0000bfe0: 2069 6620 7061 6e64 6173 5f6f 626a 2e6e   if pandas_obj.n
+0000bff0: 616d 6520 6973 204e 6f6e 653a 0a20 2020  ame is None:.   
+0000c000: 2020 2020 2020 2020 2020 2020 2070 616e               pan
+0000c010: 6461 735f 6f62 6a2e 6e61 6d65 203d 2022  das_obj.name = "
+0000c020: 3022 0a20 2020 2020 2020 2020 2020 2062  0".            b
+0000c030: 6967 6672 616d 6573 5f64 6620 3d20 7365  igframes_df = se
+0000c040: 6c66 2e5f 7265 6164 5f70 616e 6461 7328  lf._read_pandas(
+0000c050: 7061 6e64 6173 5f6f 626a 2e74 6f5f 6672  pandas_obj.to_fr
+0000c060: 616d 6528 292c 2022 7265 6164 5f70 6963  ame(), "read_pic
+0000c070: 6b6c 6522 290a 2020 2020 2020 2020 2020  kle").          
+0000c080: 2020 7265 7475 726e 2062 6967 6672 616d    return bigfram
+0000c090: 6573 5f64 665b 6269 6766 7261 6d65 735f  es_df[bigframes_
+0000c0a0: 6466 2e63 6f6c 756d 6e73 5b30 5d5d 0a20  df.columns[0]]. 
+0000c0b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000c0c0: 6c66 2e5f 7265 6164 5f70 616e 6461 7328  lf._read_pandas(
+0000c0d0: 7061 6e64 6173 5f6f 626a 2c20 2272 6561  pandas_obj, "rea
+0000c0e0: 645f 7069 636b 6c65 2229 0a0a 2020 2020  d_pickle")..    
+0000c0f0: 6465 6620 7265 6164 5f70 6172 7175 6574  def read_parquet
+0000c100: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000c110: 2020 2020 2020 2020 7061 7468 3a20 7374          path: st
+0000c120: 7220 7c20 494f 5b22 6279 7465 7322 5d2c  r | IO["bytes"],
+0000c130: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
+0000c140: 2020 2020 656e 6769 6e65 3a20 7374 7220      engine: str 
+0000c150: 3d20 2261 7574 6f22 2c0a 2020 2020 2920  = "auto",.    ) 
+0000c160: 2d3e 2064 6174 6166 7261 6d65 2e44 6174  -> dataframe.Dat
+0000c170: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
+0000c180: 7461 626c 6520 3d20 6269 6766 7261 6d65  table = bigframe
+0000c190: 735f 696f 2e72 616e 646f 6d5f 7461 626c  s_io.random_tabl
+0000c1a0: 6528 7365 6c66 2e5f 616e 6f6e 796d 6f75  e(self._anonymou
+0000c1b0: 735f 6461 7461 7365 7429 0a0a 2020 2020  s_dataset)..    
+0000c1c0: 2020 2020 6966 2065 6e67 696e 6520 3d3d      if engine ==
+0000c1d0: 2022 6269 6771 7565 7279 223a 0a20 2020   "bigquery":.   
+0000c1e0: 2020 2020 2020 2020 206a 6f62 5f63 6f6e           job_con
+0000c1f0: 6669 6720 3d20 7365 6c66 2e5f 7072 6570  fig = self._prep
+0000c200: 6172 655f 6c6f 6164 5f6a 6f62 5f63 6f6e  are_load_job_con
+0000c210: 6669 6728 290a 2020 2020 2020 2020 2020  fig().          
+0000c220: 2020 6a6f 625f 636f 6e66 6967 2e63 7265    job_config.cre
+0000c230: 6174 655f 6469 7370 6f73 6974 696f 6e20  ate_disposition 
+0000c240: 3d20 6269 6771 7565 7279 2e43 7265 6174  = bigquery.Creat
+0000c250: 6544 6973 706f 7369 7469 6f6e 2e43 5245  eDisposition.CRE
+0000c260: 4154 455f 4946 5f4e 4545 4445 440a 2020  ATE_IF_NEEDED.  
+0000c270: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+0000c280: 6e66 6967 2e73 6f75 7263 655f 666f 726d  nfig.source_form
+0000c290: 6174 203d 2062 6967 7175 6572 792e 536f  at = bigquery.So
+0000c2a0: 7572 6365 466f 726d 6174 2e50 4152 5155  urceFormat.PARQU
+0000c2b0: 4554 0a20 2020 2020 2020 2020 2020 206a  ET.            j
+0000c2c0: 6f62 5f63 6f6e 6669 672e 7772 6974 655f  ob_config.write_
+0000c2d0: 6469 7370 6f73 6974 696f 6e20 3d20 6269  disposition = bi
+0000c2e0: 6771 7565 7279 2e57 7269 7465 4469 7370  gquery.WriteDisp
+0000c2f0: 6f73 6974 696f 6e2e 5752 4954 455f 454d  osition.WRITE_EM
+0000c300: 5054 590a 2020 2020 2020 2020 2020 2020  PTY.            
+0000c310: 6a6f 625f 636f 6e66 6967 2e6c 6162 656c  job_config.label
+0000c320: 7320 3d20 7b22 6269 6766 7261 6d65 732d  s = {"bigframes-
+0000c330: 6170 6922 3a20 2272 6561 645f 7061 7271  api": "read_parq
+0000c340: 7565 7422 7d0a 0a20 2020 2020 2020 2020  uet"}..         
+0000c350: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000c360: 7265 6164 5f62 6967 7175 6572 795f 6c6f  read_bigquery_lo
+0000c370: 6164 5f6a 6f62 2870 6174 682c 2074 6162  ad_job(path, tab
+0000c380: 6c65 2c20 6a6f 625f 636f 6e66 6967 3d6a  le, job_config=j
+0000c390: 6f62 5f63 6f6e 6669 6729 0a20 2020 2020  ob_config).     
+0000c3a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000c3b0: 2020 2020 2072 6561 645f 7061 7271 7565       read_parque
+0000c3c0: 745f 6b77 6172 6773 3a20 4469 6374 5b73  t_kwargs: Dict[s
+0000c3d0: 7472 2c20 416e 795d 203d 207b 7d0a 2020  tr, Any] = {}.  
+0000c3e0: 2020 2020 2020 2020 2020 6966 2070 616e            if pan
+0000c3f0: 6461 732e 5f5f 7665 7273 696f 6e5f 5f2e  das.__version__.
+0000c400: 7374 6172 7473 7769 7468 2822 312e 2229  startswith("1.")
+0000c410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c420: 2020 7265 6164 5f70 6172 7175 6574 5f6b    read_parquet_k
+0000c430: 7761 7267 735b 2275 7365 5f6e 756c 6c61  wargs["use_nulla
+0000c440: 626c 655f 6474 7970 6573 225d 203d 2054  ble_dtypes"] = T
+0000c450: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0000c460: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000c470: 2020 2020 2020 7265 6164 5f70 6172 7175        read_parqu
+0000c480: 6574 5f6b 7761 7267 735b 2264 7479 7065  et_kwargs["dtype
+0000c490: 5f62 6163 6b65 6e64 225d 203d 2022 7079  _backend"] = "py
+0000c4a0: 6172 726f 7722 0a0a 2020 2020 2020 2020  arrow"..        
+0000c4b0: 2020 2020 7061 6e64 6173 5f6f 626a 203d      pandas_obj =
+0000c4c0: 2070 616e 6461 732e 7265 6164 5f70 6172   pandas.read_par
+0000c4d0: 7175 6574 280a 2020 2020 2020 2020 2020  quet(.          
+0000c4e0: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
+0000c4f0: 2020 2020 2020 2020 2020 2020 656e 6769              engi
+0000c500: 6e65 3d65 6e67 696e 652c 2020 2320 7479  ne=engine,  # ty
+0000c510: 7065 3a20 6967 6e6f 7265 0a20 2020 2020  pe: ignore.     
+0000c520: 2020 2020 2020 2020 2020 202a 2a72 6561             **rea
+0000c530: 645f 7061 7271 7565 745f 6b77 6172 6773  d_parquet_kwargs
+0000c540: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000c550: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000c560: 726e 2073 656c 662e 5f72 6561 645f 7061  rn self._read_pa
+0000c570: 6e64 6173 2870 616e 6461 735f 6f62 6a2c  ndas(pandas_obj,
+0000c580: 2022 7265 6164 5f70 6172 7175 6574 2229   "read_parquet")
+0000c590: 0a0a 2020 2020 6465 6620 7265 6164 5f6a  ..    def read_j
+0000c5a0: 736f 6e28 0a20 2020 2020 2020 2073 656c  son(.        sel
+0000c5b0: 662c 0a20 2020 2020 2020 2070 6174 685f  f,.        path_
+0000c5c0: 6f72 5f62 7566 3a20 7374 7220 7c20 494f  or_buf: str | IO
+0000c5d0: 5b22 6279 7465 7322 5d2c 0a20 2020 2020  ["bytes"],.     
+0000c5e0: 2020 202a 2c0a 2020 2020 2020 2020 6f72     *,.        or
+0000c5f0: 6965 6e74 3a20 4c69 7465 7261 6c5b 0a20  ient: Literal[. 
+0000c600: 2020 2020 2020 2020 2020 2022 7370 6c69             "spli
+0000c610: 7422 2c20 2272 6563 6f72 6473 222c 2022  t", "records", "
+0000c620: 696e 6465 7822 2c20 2263 6f6c 756d 6e73  index", "columns
+0000c630: 222c 2022 7661 6c75 6573 222c 2022 7461  ", "values", "ta
+0000c640: 626c 6522 0a20 2020 2020 2020 205d 203d  ble".        ] =
+0000c650: 2022 636f 6c75 6d6e 7322 2c0a 2020 2020   "columns",.    
+0000c660: 2020 2020 6474 7970 653a 204f 7074 696f      dtype: Optio
+0000c670: 6e61 6c5b 4469 6374 5d20 3d20 4e6f 6e65  nal[Dict] = None
+0000c680: 2c0a 2020 2020 2020 2020 656e 636f 6469  ,.        encodi
+0000c690: 6e67 3a20 4f70 7469 6f6e 616c 5b73 7472  ng: Optional[str
+0000c6a0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0000c6b0: 2020 6c69 6e65 733a 2062 6f6f 6c20 3d20    lines: bool = 
+0000c6c0: 4661 6c73 652c 0a20 2020 2020 2020 2065  False,.        e
+0000c6d0: 6e67 696e 653a 204c 6974 6572 616c 5b22  ngine: Literal["
+0000c6e0: 756a 736f 6e22 2c20 2270 7961 7272 6f77  ujson", "pyarrow
+0000c6f0: 222c 2022 6269 6771 7565 7279 225d 203d  ", "bigquery"] =
+0000c700: 2022 756a 736f 6e22 2c0a 2020 2020 2020   "ujson",.      
+0000c710: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+0000c720: 2920 2d3e 2064 6174 6166 7261 6d65 2e44  ) -> dataframe.D
+0000c730: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
+0000c740: 2020 7461 626c 6520 3d20 6269 6766 7261    table = bigfra
+0000c750: 6d65 735f 696f 2e72 616e 646f 6d5f 7461  mes_io.random_ta
+0000c760: 626c 6528 7365 6c66 2e5f 616e 6f6e 796d  ble(self._anonym
+0000c770: 6f75 735f 6461 7461 7365 7429 0a0a 2020  ous_dataset)..  
+0000c780: 2020 2020 2020 6966 2065 6e67 696e 6520        if engine 
+0000c790: 3d3d 2022 6269 6771 7565 7279 223a 0a0a  == "bigquery":..
+0000c7a0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0000c7b0: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
+0000c7c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c7d0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+0000c7e0: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
+0000c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c800: 2022 4269 6751 7565 7279 2065 6e67 696e   "BigQuery engin
+0000c810: 6520 646f 6573 206e 6f74 2073 7570 706f  e does not suppo
+0000c820: 7274 2074 6865 2064 7479 7065 2061 7267  rt the dtype arg
+0000c830: 756d 656e 7473 2e22 0a20 2020 2020 2020  uments.".       
+0000c840: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000c850: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
+0000c860: 696e 6573 3a0a 2020 2020 2020 2020 2020  ines:.          
+0000c870: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+0000c880: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+0000c890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c8a0: 2020 2020 2022 4f6e 6c79 206e 6577 6c69       "Only newli
+0000c8b0: 6e65 2064 656c 696d 6974 6564 204a 534f  ne delimited JSO
+0000c8c0: 4e20 666f 726d 6174 2069 7320 7375 7070  N format is supp
+0000c8d0: 6f72 7465 642e 220a 2020 2020 2020 2020  orted.".        
+0000c8e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000c8f0: 2020 2020 2020 2069 6620 656e 636f 6469         if encodi
+0000c900: 6e67 2069 7320 6e6f 7420 4e6f 6e65 2061  ng is not None a
+0000c910: 6e64 2065 6e63 6f64 696e 6720 6e6f 7420  nd encoding not 
+0000c920: 696e 205f 5641 4c49 445f 454e 434f 4449  in _VALID_ENCODI
+0000c930: 4e47 533a 0a20 2020 2020 2020 2020 2020  NGS:.           
+0000c940: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+0000c950: 706c 656d 656e 7465 6445 7272 6f72 280a  plementedError(.
+0000c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c970: 2020 2020 6622 4269 6751 7565 7279 2065      f"BigQuery e
+0000c980: 6e67 696e 6520 6f6e 6c79 2073 7570 706f  ngine only suppo
+0000c990: 7274 7320 7468 6520 666f 6c6c 6f77 696e  rts the followin
+0000c9a0: 6720 656e 636f 6469 6e67 733a 207b 5f56  g encodings: {_V
+0000c9b0: 414c 4944 5f45 4e43 4f44 494e 4753 7d22  ALID_ENCODINGS}"
+0000c9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9d0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+0000c9e0: 6966 206c 696e 6573 2061 6e64 206f 7269  if lines and ori
+0000c9f0: 656e 7420 213d 2022 7265 636f 7264 7322  ent != "records"
+0000ca00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ca10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000ca20: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000ca30: 2020 2020 2020 2020 2227 6c69 6e65 7327          "'lines'
+0000ca40: 206b 6579 776f 7264 2069 7320 6f6e 6c79   keyword is only
+0000ca50: 2076 616c 6964 2077 6865 6e20 276f 7269   valid when 'ori
+0000ca60: 656e 7427 2069 7320 2772 6563 6f72 6473  ent' is 'records
+0000ca70: 272e 220a 2020 2020 2020 2020 2020 2020  '.".            
+0000ca80: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0000ca90: 2020 206a 6f62 5f63 6f6e 6669 6720 3d20     job_config = 
+0000caa0: 7365 6c66 2e5f 7072 6570 6172 655f 6c6f  self._prepare_lo
+0000cab0: 6164 5f6a 6f62 5f63 6f6e 6669 6728 290a  ad_job_config().
+0000cac0: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
+0000cad0: 636f 6e66 6967 2e63 7265 6174 655f 6469  config.create_di
+0000cae0: 7370 6f73 6974 696f 6e20 3d20 6269 6771  sposition = bigq
+0000caf0: 7565 7279 2e43 7265 6174 6544 6973 706f  uery.CreateDispo
+0000cb00: 7369 7469 6f6e 2e43 5245 4154 455f 4946  sition.CREATE_IF
+0000cb10: 5f4e 4545 4445 440a 2020 2020 2020 2020  _NEEDED.        
+0000cb20: 2020 2020 6a6f 625f 636f 6e66 6967 2e73      job_config.s
+0000cb30: 6f75 7263 655f 666f 726d 6174 203d 2062  ource_format = b
+0000cb40: 6967 7175 6572 792e 536f 7572 6365 466f  igquery.SourceFo
+0000cb50: 726d 6174 2e4e 4557 4c49 4e45 5f44 454c  rmat.NEWLINE_DEL
+0000cb60: 494d 4954 4544 5f4a 534f 4e0a 2020 2020  IMITED_JSON.    
+0000cb70: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+0000cb80: 6967 2e77 7269 7465 5f64 6973 706f 7369  ig.write_disposi
+0000cb90: 7469 6f6e 203d 2062 6967 7175 6572 792e  tion = bigquery.
+0000cba0: 5772 6974 6544 6973 706f 7369 7469 6f6e  WriteDisposition
+0000cbb0: 2e57 5249 5445 5f45 4d50 5459 0a20 2020  .WRITE_EMPTY.   
+0000cbc0: 2020 2020 2020 2020 206a 6f62 5f63 6f6e           job_con
+0000cbd0: 6669 672e 6175 746f 6465 7465 6374 203d  fig.autodetect =
+0000cbe0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0000cbf0: 2020 6a6f 625f 636f 6e66 6967 2e65 6e63    job_config.enc
+0000cc00: 6f64 696e 6720 3d20 656e 636f 6469 6e67  oding = encoding
+0000cc10: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
+0000cc20: 5f63 6f6e 6669 672e 6c61 6265 6c73 203d  _config.labels =
+0000cc30: 207b 2262 6967 6672 616d 6573 2d61 7069   {"bigframes-api
+0000cc40: 223a 2022 7265 6164 5f6a 736f 6e22 7d0a  ": "read_json"}.
+0000cc50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000cc60: 7572 6e20 7365 6c66 2e5f 7265 6164 5f62  urn self._read_b
+0000cc70: 6967 7175 6572 795f 6c6f 6164 5f6a 6f62  igquery_load_job
+0000cc80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000cc90: 2020 7061 7468 5f6f 725f 6275 662c 0a20    path_or_buf,. 
+0000cca0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000ccb0: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
+0000ccc0: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+0000ccd0: 3d6a 6f62 5f63 6f6e 6669 672c 0a20 2020  =job_config,.   
+0000cce0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000ccf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000cd00: 2020 2020 2069 6620 616e 7928 6172 6720       if any(arg 
+0000cd10: 696e 206b 7761 7267 7320 666f 7220 6172  in kwargs for ar
+0000cd20: 6720 696e 2028 2263 6875 6e6b 7369 7a65  g in ("chunksize
+0000cd30: 222c 2022 6974 6572 6174 6f72 2229 293a  ", "iterator")):
+0000cd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cd50: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
+0000cd60: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
+0000cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd80: 2227 6368 756e 6b73 697a 6527 2061 6e64  "'chunksize' and
+0000cd90: 2027 6974 6572 6174 6f72 2720 6172 6775   'iterator' argu
+0000cda0: 6d65 6e74 7320 6172 6520 6e6f 7420 7375  ments are not su
+0000cdb0: 7070 6f72 7465 642e 220a 2020 2020 2020  pported.".      
+0000cdc0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000cdd0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000cde0: 7374 616e 6365 2870 6174 685f 6f72 5f62  stance(path_or_b
+0000cdf0: 7566 2c20 7374 7229 3a0a 2020 2020 2020  uf, str):.      
+0000ce00: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000ce10: 6368 6563 6b5f 6669 6c65 5f73 697a 6528  check_file_size(
+0000ce20: 7061 7468 5f6f 725f 6275 6629 0a0a 2020  path_or_buf)..  
+0000ce30: 2020 2020 2020 2020 2020 6966 2065 6e67            if eng
+0000ce40: 696e 6520 3d3d 2022 756a 736f 6e22 3a0a  ine == "ujson":.
+0000ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce60: 7061 6e64 6173 5f64 6620 3d20 7061 6e64  pandas_df = pand
+0000ce70: 6173 2e72 6561 645f 6a73 6f6e 2820 2023  as.read_json(  #
+0000ce80: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
+0000ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cea0: 2020 7061 7468 5f6f 725f 6275 662c 0a20    path_or_buf,. 
+0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cec0: 2020 206f 7269 656e 743d 6f72 6965 6e74     orient=orient
+0000ced0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cee0: 2020 2020 2020 6474 7970 653d 6474 7970        dtype=dtyp
+0000cef0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000cf00: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+0000cf10: 656e 636f 6469 6e67 2c0a 2020 2020 2020  encoding,.      
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000cf30: 6e65 733d 6c69 6e65 732c 0a20 2020 2020  nes=lines,.     
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0000cf50: 2a6b 7761 7267 732c 0a20 2020 2020 2020  *kwargs,.       
+0000cf60: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000cf70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000cf80: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000cf90: 6e64 6173 5f64 6620 3d20 7061 6e64 6173  ndas_df = pandas
+0000cfa0: 2e72 6561 645f 6a73 6f6e 2820 2023 2074  .read_json(  # t
+0000cfb0: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfd0: 7061 7468 5f6f 725f 6275 662c 0a20 2020  path_or_buf,.   
+0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cff0: 206f 7269 656e 743d 6f72 6965 6e74 2c0a   orient=orient,.
+0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d010: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
+0000d020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d030: 2020 2020 2065 6e63 6f64 696e 673d 656e       encoding=en
+0000d040: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
+0000d050: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0000d060: 733d 6c69 6e65 732c 0a20 2020 2020 2020  s=lines,.       
+0000d070: 2020 2020 2020 2020 2020 2020 2065 6e67               eng
+0000d080: 696e 653d 656e 6769 6e65 2c0a 2020 2020  ine=engine,.    
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0a0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
+0000d0b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d0c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000d0d0: 656c 662e 5f72 6561 645f 7061 6e64 6173  elf._read_pandas
+0000d0e0: 2870 616e 6461 735f 6466 2c20 2272 6561  (pandas_df, "rea
+0000d0f0: 645f 6a73 6f6e 2229 0a0a 2020 2020 6465  d_json")..    de
+0000d100: 6620 5f63 6865 636b 5f66 696c 655f 7369  f _check_file_si
+0000d110: 7a65 2873 656c 662c 2066 696c 6570 6174  ze(self, filepat
+0000d120: 683a 2073 7472 293a 0a20 2020 2020 2020  h: str):.       
+0000d130: 206d 6178 5f73 697a 6520 3d20 3130 3234   max_size = 1024
+0000d140: 202a 2031 3032 3420 2a20 3130 3234 2020   * 1024 * 1024  
+0000d150: 2320 3120 4742 2069 6e20 6279 7465 730a  # 1 GB in bytes.
+0000d160: 2020 2020 2020 2020 6966 2066 696c 6570          if filep
+0000d170: 6174 682e 7374 6172 7473 7769 7468 2822  ath.startswith("
+0000d180: 6773 3a2f 2f22 293a 2020 2320 4743 5320  gs://"):  # GCS 
+0000d190: 6669 6c65 2070 6174 680a 2020 2020 2020  file path.      
+0000d1a0: 2020 2020 2020 636c 6965 6e74 203d 2073        client = s
+0000d1b0: 746f 7261 6765 2e43 6c69 656e 7428 290a  torage.Client().
+0000d1c0: 2020 2020 2020 2020 2020 2020 6275 636b              buck
+0000d1d0: 6574 5f6e 616d 652c 2062 6c6f 625f 6e61  et_name, blob_na
+0000d1e0: 6d65 203d 2066 696c 6570 6174 682e 7370  me = filepath.sp
+0000d1f0: 6c69 7428 222f 222c 2033 295b 323a 5d0a  lit("/", 3)[2:].
+0000d200: 2020 2020 2020 2020 2020 2020 6275 636b              buck
+0000d210: 6574 203d 2063 6c69 656e 742e 6275 636b  et = client.buck
+0000d220: 6574 2862 7563 6b65 745f 6e61 6d65 290a  et(bucket_name).
+0000d230: 2020 2020 2020 2020 2020 2020 626c 6f62              blob
+0000d240: 203d 2062 7563 6b65 742e 626c 6f62 2862   = bucket.blob(b
+0000d250: 6c6f 625f 6e61 6d65 290a 2020 2020 2020  lob_name).      
+0000d260: 2020 2020 2020 626c 6f62 2e72 656c 6f61        blob.reloa
+0000d270: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
+0000d280: 6669 6c65 5f73 697a 6520 3d20 626c 6f62  file_size = blob
+0000d290: 2e73 697a 650a 2020 2020 2020 2020 656c  .size.        el
+0000d2a0: 7365 3a20 2023 206c 6f63 616c 2066 696c  se:  # local fil
+0000d2b0: 6520 7061 7468 0a20 2020 2020 2020 2020  e path.         
+0000d2c0: 2020 2066 696c 655f 7369 7a65 203d 206f     file_size = o
+0000d2d0: 732e 7061 7468 2e67 6574 7369 7a65 2866  s.path.getsize(f
+0000d2e0: 696c 6570 6174 6829 0a0a 2020 2020 2020  ilepath)..      
+0000d2f0: 2020 6966 2066 696c 655f 7369 7a65 203e    if file_size >
+0000d300: 206d 6178 5f73 697a 653a 0a20 2020 2020   max_size:.     
+0000d310: 2020 2020 2020 2023 2043 6f6e 7665 7274         # Convert
+0000d320: 2074 6f20 4742 0a20 2020 2020 2020 2020   to GB.         
+0000d330: 2020 2066 696c 655f 7369 7a65 203d 2072     file_size = r
+0000d340: 6f75 6e64 2866 696c 655f 7369 7a65 202f  ound(file_size /
+0000d350: 2028 3130 3234 2a2a 3329 2c20 3129 0a20   (1024**3), 1). 
+0000d360: 2020 2020 2020 2020 2020 206d 6178 5f73             max_s
+0000d370: 697a 6520 3d20 696e 7428 6d61 785f 7369  ize = int(max_si
+0000d380: 7a65 202f 2031 3032 342a 2a33 290a 2020  ze / 1024**3).  
+0000d390: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0000d3a0: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0000d3b0: 2020 2020 2020 2020 2020 6622 4669 6c65            f"File
+0000d3c0: 2073 697a 6520 7b66 696c 655f 7369 7a65   size {file_size
+0000d3d0: 7d47 4220 6578 6365 6564 7320 7b6d 6178  }GB exceeds {max
+0000d3e0: 5f73 697a 657d 4742 2e20 220a 2020 2020  _size}GB. ".    
+0000d3f0: 2020 2020 2020 2020 2020 2020 2249 7420              "It 
+0000d400: 6973 2072 6563 6f6d 6d65 6e64 6564 2074  is recommended t
+0000d410: 6f20 7573 6520 656e 6769 6e65 3d27 6269  o use engine='bi
+0000d420: 6771 7565 7279 2720 220a 2020 2020 2020  gquery' ".      
+0000d430: 2020 2020 2020 2020 2020 2266 6f72 206c            "for l
+0000d440: 6172 6765 2066 696c 6573 2074 6f20 6176  arge files to av
+0000d450: 6f69 6420 6c6f 6164 696e 6720 7468 6520  oid loading the 
+0000d460: 6669 6c65 2069 6e74 6f20 6c6f 6361 6c20  file into local 
+0000d470: 6d65 6d6f 7279 2e22 0a20 2020 2020 2020  memory.".       
+0000d480: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0000d490: 5f63 7265 6174 655f 656d 7074 795f 7465  _create_empty_te
+0000d4a0: 6d70 5f74 6162 6c65 280a 2020 2020 2020  mp_table(.      
+0000d4b0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000d4c0: 7363 6865 6d61 3a20 4974 6572 6162 6c65  schema: Iterable
+0000d4d0: 5b62 6967 7175 6572 792e 5363 6865 6d61  [bigquery.Schema
+0000d4e0: 4669 656c 645d 2c0a 2020 2020 2020 2020  Field],.        
+0000d4f0: 636c 7573 7465 725f 636f 6c73 3a20 4c69  cluster_cols: Li
+0000d500: 7374 5b73 7472 5d2c 0a20 2020 2029 202d  st[str],.    ) -
+0000d510: 3e20 6269 6771 7565 7279 2e54 6162 6c65  > bigquery.Table
+0000d520: 5265 6665 7265 6e63 653a 0a20 2020 2020  Reference:.     
+0000d530: 2020 2023 2043 616e 2774 2073 6574 2061     # Can't set a
+0000d540: 2074 6162 6c65 2069 6e20 5f53 4553 5349   table in _SESSI
+0000d550: 4f4e 2061 7320 6465 7374 696e 6174 696f  ON as destinatio
+0000d560: 6e20 7669 6120 7175 6572 7920 6a6f 6220  n via query job 
+0000d570: 4150 492c 2073 6f20 7765 0a20 2020 2020  API, so we.     
+0000d580: 2020 2023 2072 756e 2044 444c 2c20 696e     # run DDL, in
+0000d590: 7374 6561 642e 0a20 2020 2020 2020 2064  stead..        d
+0000d5a0: 6174 6173 6574 203d 2073 656c 662e 5f61  ataset = self._a
+0000d5b0: 6e6f 6e79 6d6f 7573 5f64 6174 6173 6574  nonymous_dataset
+0000d5c0: 0a20 2020 2020 2020 2065 7870 6972 6174  .        expirat
+0000d5d0: 696f 6e20 3d20 280a 2020 2020 2020 2020  ion = (.        
+0000d5e0: 2020 2020 6461 7465 7469 6d65 2e64 6174      datetime.dat
+0000d5f0: 6574 696d 652e 6e6f 7728 6461 7465 7469  etime.now(dateti
+0000d600: 6d65 2e74 696d 657a 6f6e 652e 7574 6329  me.timezone.utc)
+0000d610: 202b 2063 6f6e 7374 616e 7473 2e44 4546   + constants.DEF
+0000d620: 4155 4c54 5f45 5850 4952 4154 494f 4e0a  AULT_EXPIRATION.
+0000d630: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000d640: 2020 2074 6162 6c65 203d 2062 6967 6672     table = bigfr
+0000d650: 616d 6573 5f69 6f2e 6372 6561 7465 5f74  ames_io.create_t
+0000d660: 656d 705f 7461 626c 6528 0a20 2020 2020  emp_table(.     
+0000d670: 2020 2020 2020 2073 656c 662e 6271 636c         self.bqcl
+0000d680: 6965 6e74 2c0a 2020 2020 2020 2020 2020  ient,.          
+0000d690: 2020 6461 7461 7365 742c 0a20 2020 2020    dataset,.     
+0000d6a0: 2020 2020 2020 2065 7870 6972 6174 696f         expiratio
+0000d6b0: 6e2c 0a20 2020 2020 2020 2020 2020 2073  n,.            s
+0000d6c0: 6368 656d 613d 7363 6865 6d61 2c0a 2020  chema=schema,.  
+0000d6d0: 2020 2020 2020 2020 2020 636c 7573 7465            cluste
+0000d6e0: 725f 636f 6c75 6d6e 733d 636c 7573 7465  r_columns=cluste
+0000d6f0: 725f 636f 6c73 2c0a 2020 2020 2020 2020  r_cols,.        
+0000d700: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000d710: 2062 6967 7175 6572 792e 5461 626c 6552   bigquery.TableR
+0000d720: 6566 6572 656e 6365 2e66 726f 6d5f 7374  eference.from_st
+0000d730: 7269 6e67 2874 6162 6c65 290a 0a20 2020  ring(table)..   
+0000d740: 2064 6566 205f 6372 6561 7465 5f74 6f74   def _create_tot
+0000d750: 616c 5f6f 7264 6572 696e 6728 0a20 2020  al_ordering(.   
+0000d760: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000d770: 2020 2074 6162 6c65 3a20 6962 6973 5f74     table: ibis_t
+0000d780: 7970 6573 2e54 6162 6c65 2c0a 2020 2020  ypes.Table,.    
+0000d790: 2920 2d3e 2063 6f72 652e 4172 7261 7956  ) -> core.ArrayV
+0000d7a0: 616c 7565 3a0a 2020 2020 2020 2020 2320  alue:.        # 
+0000d7b0: 5369 6e63 6520 7468 6973 206d 6967 6874  Since this might
+0000d7c0: 2061 6c73 6f20 6265 2075 7365 6420 6173   also be used as
+0000d7d0: 2074 6865 2069 6e64 6578 2c20 646f 6e27   the index, don'
+0000d7e0: 7420 7573 6520 7468 6520 6465 6661 756c  t use the defaul
+0000d7f0: 740a 2020 2020 2020 2020 2320 226f 7264  t.        # "ord
+0000d800: 6572 696e 6720 4944 2220 6e61 6d65 2e0a  ering ID" name..
+0000d810: 2020 2020 2020 2020 6f72 6465 7269 6e67          ordering
+0000d820: 5f68 6173 685f 7061 7274 203d 2067 7569  _hash_part = gui
+0000d830: 642e 6765 6e65 7261 7465 5f67 7569 6428  d.generate_guid(
+0000d840: 2262 6967 6672 616d 6573 5f6f 7264 6572  "bigframes_order
+0000d850: 696e 675f 2229 0a20 2020 2020 2020 206f  ing_").        o
+0000d860: 7264 6572 696e 675f 7261 6e64 5f70 6172  rdering_rand_par
+0000d870: 7420 3d20 6775 6964 2e67 656e 6572 6174  t = guid.generat
+0000d880: 655f 6775 6964 2822 6269 6766 7261 6d65  e_guid("bigframe
+0000d890: 735f 6f72 6465 7269 6e67 5f22 290a 0a20  s_ordering_").. 
+0000d8a0: 2020 2020 2020 2023 2041 6c6c 2069 6e70         # All inp
+0000d8b0: 7574 7320 696e 746f 2068 6173 6820 6d75  uts into hash mu
+0000d8c0: 7374 2062 6520 6e6f 6e2d 6e75 6c6c 206f  st be non-null o
+0000d8d0: 7220 7265 7375 6c74 696e 6720 6861 7368  r resulting hash
+0000d8e0: 2077 696c 6c20 6265 206e 756c 6c0a 2020   will be null.  
+0000d8f0: 2020 2020 2020 7374 725f 7661 6c75 6573        str_values
+0000d900: 203d 206c 6973 7428 0a20 2020 2020 2020   = list(.       
+0000d910: 2020 2020 206d 6170 286c 616d 6264 6120       map(lambda 
+0000d920: 636f 6c3a 205f 636f 6e76 6572 745f 746f  col: _convert_to
+0000d930: 5f6e 6f6e 6e75 6c6c 5f73 7472 696e 6728  _nonnull_string(
+0000d940: 7461 626c 655b 636f 6c5d 292c 2074 6162  table[col]), tab
+0000d950: 6c65 2e63 6f6c 756d 6e73 290a 2020 2020  le.columns).    
+0000d960: 2020 2020 290a 2020 2020 2020 2020 6675      ).        fu
+0000d970: 6c6c 5f72 6f77 5f73 7472 203d 2028 0a20  ll_row_str = (. 
+0000d980: 2020 2020 2020 2020 2020 2073 7472 5f76             str_v
+0000d990: 616c 7565 735b 305d 2e63 6f6e 6361 7428  alues[0].concat(
+0000d9a0: 2a73 7472 5f76 616c 7565 735b 313a 5d29  *str_values[1:])
+0000d9b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d9c0: 6c65 6e28 7374 725f 7661 6c75 6573 2920  len(str_values) 
+0000d9d0: 3e20 310a 2020 2020 2020 2020 2020 2020  > 1.            
+0000d9e0: 656c 7365 2073 7472 5f76 616c 7565 735b  else str_values[
+0000d9f0: 305d 0a20 2020 2020 2020 2029 0a20 2020  0].        ).   
+0000da00: 2020 2020 2066 756c 6c5f 726f 775f 6861       full_row_ha
+0000da10: 7368 203d 2066 756c 6c5f 726f 775f 7374  sh = full_row_st
+0000da20: 722e 6861 7368 2829 2e6e 616d 6528 6f72  r.hash().name(or
+0000da30: 6465 7269 6e67 5f68 6173 685f 7061 7274  dering_hash_part
+0000da40: 290a 2020 2020 2020 2020 2320 5573 6564  ).        # Used
+0000da50: 2074 6f20 6469 7361 6d62 6967 7561 7465   to disambiguate
+0000da60: 2062 6574 7765 656e 2069 6465 6e74 6963   between identic
+0000da70: 616c 2072 6f77 7320 2877 6869 6368 2077  al rows (which w
+0000da80: 696c 6c20 6861 7665 2069 6465 6e74 6963  ill have identic
+0000da90: 616c 2068 6173 6829 0a20 2020 2020 2020  al hash).       
+0000daa0: 2072 616e 646f 6d5f 7661 6c75 6520 3d20   random_value = 
+0000dab0: 6962 6973 2e72 616e 646f 6d28 292e 6e61  ibis.random().na
+0000dac0: 6d65 286f 7264 6572 696e 675f 7261 6e64  me(ordering_rand
+0000dad0: 5f70 6172 7429 0a0a 2020 2020 2020 2020  _part)..        
+0000dae0: 6f72 6967 696e 616c 5f63 6f6c 756d 6e5f  original_column_
+0000daf0: 6964 7320 3d20 7461 626c 652e 636f 6c75  ids = table.colu
+0000db00: 6d6e 730a 2020 2020 2020 2020 7461 626c  mns.        tabl
+0000db10: 655f 7769 7468 5f6f 7264 6572 696e 6720  e_with_ordering 
+0000db20: 3d20 7461 626c 652e 7365 6c65 6374 280a  = table.select(.
+0000db30: 2020 2020 2020 2020 2020 2020 6974 6572              iter
+0000db40: 746f 6f6c 732e 6368 6169 6e28 6f72 6967  tools.chain(orig
+0000db50: 696e 616c 5f63 6f6c 756d 6e5f 6964 732c  inal_column_ids,
+0000db60: 205b 6675 6c6c 5f72 6f77 5f68 6173 682c   [full_row_hash,
+0000db70: 2072 616e 646f 6d5f 7661 6c75 655d 290a   random_value]).
+0000db80: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000db90: 2020 206f 7264 6572 696e 675f 7265 6631     ordering_ref1
+0000dba0: 203d 206f 7264 6572 2e61 7363 656e 6469   = order.ascendi
+0000dbb0: 6e67 5f6f 7665 7228 6f72 6465 7269 6e67  ng_over(ordering
+0000dbc0: 5f68 6173 685f 7061 7274 290a 2020 2020  _hash_part).    
+0000dbd0: 2020 2020 6f72 6465 7269 6e67 5f72 6566      ordering_ref
+0000dbe0: 3220 3d20 6f72 6465 722e 6173 6365 6e64  2 = order.ascend
+0000dbf0: 696e 675f 6f76 6572 286f 7264 6572 696e  ing_over(orderin
+0000dc00: 675f 7261 6e64 5f70 6172 7429 0a20 2020  g_rand_part).   
+0000dc10: 2020 2020 206f 7264 6572 696e 6720 3d20       ordering = 
+0000dc20: 6f72 6465 722e 4578 7072 6573 7369 6f6e  order.Expression
+0000dc30: 4f72 6465 7269 6e67 280a 2020 2020 2020  Ordering(.      
+0000dc40: 2020 2020 2020 6f72 6465 7269 6e67 5f76        ordering_v
+0000dc50: 616c 7565 5f63 6f6c 756d 6e73 3d28 6f72  alue_columns=(or
+0000dc60: 6465 7269 6e67 5f72 6566 312c 206f 7264  dering_ref1, ord
+0000dc70: 6572 696e 675f 7265 6632 292c 0a20 2020  ering_ref2),.   
+0000dc80: 2020 2020 2020 2020 2074 6f74 616c 5f6f           total_o
+0000dc90: 7264 6572 696e 675f 636f 6c75 6d6e 733d  rdering_columns=
+0000dca0: 6672 6f7a 656e 7365 7428 5b6f 7264 6572  frozenset([order
+0000dcb0: 696e 675f 6861 7368 5f70 6172 742c 206f  ing_hash_part, o
+0000dcc0: 7264 6572 696e 675f 7261 6e64 5f70 6172  rdering_rand_par
+0000dcd0: 745d 292c 0a20 2020 2020 2020 2029 0a20  t]),.        ). 
+0000dce0: 2020 2020 2020 2063 6f6c 756d 6e73 203d         columns =
+0000dcf0: 205b 7461 626c 655f 7769 7468 5f6f 7264   [table_with_ord
+0000dd00: 6572 696e 675b 636f 6c5d 2066 6f72 2063  ering[col] for c
+0000dd10: 6f6c 2069 6e20 6f72 6967 696e 616c 5f63  ol in original_c
+0000dd20: 6f6c 756d 6e5f 6964 735d 0a20 2020 2020  olumn_ids].     
+0000dd30: 2020 2068 6964 6465 6e5f 636f 6c75 6d6e     hidden_column
+0000dd40: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+0000dd50: 2020 7461 626c 655f 7769 7468 5f6f 7264    table_with_ord
+0000dd60: 6572 696e 675b 6f72 6465 7269 6e67 5f68  ering[ordering_h
+0000dd70: 6173 685f 7061 7274 5d2c 0a20 2020 2020  ash_part],.     
+0000dd80: 2020 2020 2020 2074 6162 6c65 5f77 6974         table_wit
+0000dd90: 685f 6f72 6465 7269 6e67 5b6f 7264 6572  h_ordering[order
+0000dda0: 696e 675f 7261 6e64 5f70 6172 745d 2c0a  ing_rand_part],.
+0000ddb0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0000ddc0: 2020 7265 7475 726e 2063 6f72 652e 4172    return core.Ar
+0000ddd0: 7261 7956 616c 7565 2e66 726f 6d5f 6962  rayValue.from_ib
+0000dde0: 6973 280a 2020 2020 2020 2020 2020 2020  is(.            
+0000ddf0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+0000de00: 2020 7461 626c 655f 7769 7468 5f6f 7264    table_with_ord
+0000de10: 6572 696e 672c 0a20 2020 2020 2020 2020  ering,.         
+0000de20: 2020 2063 6f6c 756d 6e73 2c0a 2020 2020     columns,.    
+0000de30: 2020 2020 2020 2020 6869 6464 656e 5f6f          hidden_o
+0000de40: 7264 6572 696e 675f 636f 6c75 6d6e 733d  rdering_columns=
+0000de50: 6869 6464 656e 5f63 6f6c 756d 6e73 2c0a  hidden_columns,.
+0000de60: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000de70: 7269 6e67 3d6f 7264 6572 696e 672c 0a20  ring=ordering,. 
+0000de80: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000de90: 6620 5f69 6269 735f 746f 5f74 656d 705f  f _ibis_to_temp_
+0000dea0: 7461 626c 6528 0a20 2020 2020 2020 2073  table(.        s
+0000deb0: 656c 662c 0a20 2020 2020 2020 2074 6162  elf,.        tab
+0000dec0: 6c65 3a20 6962 6973 5f74 7970 6573 2e54  le: ibis_types.T
+0000ded0: 6162 6c65 2c0a 2020 2020 2020 2020 636c  able,.        cl
+0000dee0: 7573 7465 725f 636f 6c73 3a20 4974 6572  uster_cols: Iter
+0000def0: 6162 6c65 5b73 7472 5d2c 0a20 2020 2020  able[str],.     
+0000df00: 2020 2061 7069 5f6e 616d 653a 2073 7472     api_name: str
+0000df10: 2c0a 2020 2020 2920 2d3e 2062 6967 7175  ,.    ) -> bigqu
+0000df20: 6572 792e 5461 626c 6552 6566 6572 656e  ery.TableReferen
+0000df30: 6365 3a0a 2020 2020 2020 2020 6465 7374  ce:.        dest
+0000df40: 696e 6174 696f 6e2c 205f 203d 2073 656c  ination, _ = sel
+0000df50: 662e 5f71 7565 7279 5f74 6f5f 6465 7374  f._query_to_dest
+0000df60: 696e 6174 696f 6e28 0a20 2020 2020 2020  ination(.       
+0000df70: 2020 2020 2073 656c 662e 6962 6973 5f63       self.ibis_c
+0000df80: 6c69 656e 742e 636f 6d70 696c 6528 7461  lient.compile(ta
+0000df90: 626c 6529 2c0a 2020 2020 2020 2020 2020  ble),.          
+0000dfa0: 2020 696e 6465 785f 636f 6c73 3d6c 6973    index_cols=lis
+0000dfb0: 7428 636c 7573 7465 725f 636f 6c73 292c  t(cluster_cols),
+0000dfc0: 0a20 2020 2020 2020 2020 2020 2061 7069  .            api
+0000dfd0: 5f6e 616d 653d 6170 695f 6e61 6d65 2c0a  _name=api_name,.
+0000dfe0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000dff0: 2020 2320 5468 6572 6520 7368 6f75 6c64    # There should
+0000e000: 2061 6c77 6179 7320 6265 2061 2064 6573   always be a des
+0000e010: 7469 6e61 7469 6f6e 2074 6162 6c65 2066  tination table f
+0000e020: 6f72 2074 6869 7320 7175 6572 7920 7479  or this query ty
+0000e030: 7065 2e0a 2020 2020 2020 2020 7265 7475  pe..        retu
+0000e040: 726e 2074 7970 696e 672e 6361 7374 2862  rn typing.cast(b
+0000e050: 6967 7175 6572 792e 5461 626c 6552 6566  igquery.TableRef
+0000e060: 6572 656e 6365 2c20 6465 7374 696e 6174  erence, destinat
+0000e070: 696f 6e29 0a0a 2020 2020 6465 6620 7265  ion)..    def re
+0000e080: 6d6f 7465 5f66 756e 6374 696f 6e28 0a20  mote_function(. 
+0000e090: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000e0a0: 2020 2020 2069 6e70 7574 5f74 7970 6573       input_types
+0000e0b0: 3a20 4c69 7374 5b74 7970 655d 2c0a 2020  : List[type],.  
+0000e0c0: 2020 2020 2020 6f75 7470 7574 5f74 7970        output_typ
+0000e0d0: 653a 2074 7970 652c 0a20 2020 2020 2020  e: type,.       
+0000e0e0: 2064 6174 6173 6574 3a20 4f70 7469 6f6e   dataset: Option
+0000e0f0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+0000e100: 2020 2020 2020 2020 6269 6771 7565 7279          bigquery
+0000e110: 5f63 6f6e 6e65 6374 696f 6e3a 204f 7074  _connection: Opt
+0000e120: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000e130: 652c 0a20 2020 2020 2020 2072 6575 7365  e,.        reuse
+0000e140: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+0000e150: 2020 2020 2020 206e 616d 653a 204f 7074         name: Opt
+0000e160: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000e170: 652c 0a20 2020 2020 2020 2070 6163 6b61  e,.        packa
+0000e180: 6765 733a 204f 7074 696f 6e61 6c5b 5365  ges: Optional[Se
+0000e190: 7175 656e 6365 5b73 7472 5d5d 203d 204e  quence[str]] = N
+0000e1a0: 6f6e 652c 0a20 2020 2020 2020 2063 6c6f  one,.        clo
+0000e1b0: 7564 5f66 756e 6374 696f 6e5f 7365 7276  ud_function_serv
+0000e1c0: 6963 655f 6163 636f 756e 743a 204f 7074  ice_account: Opt
+0000e1d0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000e1e0: 652c 0a20 2020 2020 2020 2063 6c6f 7564  e,.        cloud
+0000e1f0: 5f66 756e 6374 696f 6e5f 6b6d 735f 6b65  _function_kms_ke
+0000e200: 795f 6e61 6d65 3a20 4f70 7469 6f6e 616c  y_name: Optional
+0000e210: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0000e220: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
+0000e230: 7469 6f6e 5f64 6f63 6b65 725f 7265 706f  tion_docker_repo
+0000e240: 7369 746f 7279 3a20 4f70 7469 6f6e 616c  sitory: Optional
+0000e250: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0000e260: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000e270: 4465 636f 7261 746f 7220 746f 2074 7572  Decorator to tur
+0000e280: 6e20 6120 7573 6572 2064 6566 696e 6564  n a user defined
+0000e290: 2066 756e 6374 696f 6e20 696e 746f 2061   function into a
+0000e2a0: 2042 6967 5175 6572 7920 7265 6d6f 7465   BigQuery remote
+0000e2b0: 2066 756e 6374 696f 6e2e 2043 6865 636b   function. Check
+0000e2c0: 206f 7574 0a20 2020 2020 2020 2074 6865   out.        the
+0000e2d0: 2063 6f64 6520 7361 6d70 6c65 7320 6174   code samples at
+0000e2e0: 3a20 6874 7470 733a 2f2f 636c 6f75 642e  : https://cloud.
+0000e2f0: 676f 6f67 6c65 2e63 6f6d 2f62 6967 7175  google.com/bigqu
+0000e300: 6572 792f 646f 6373 2f72 656d 6f74 652d  ery/docs/remote-
+0000e310: 6675 6e63 7469 6f6e 7323 6269 6771 7565  functions#bigque
+0000e320: 7279 2d64 6174 6166 7261 6d65 732e 0a0a  ry-dataframes...
+0000e330: 2020 2020 2020 2020 2e2e 206e 6f74 653a          .. note:
+0000e340: 3a0a 2020 2020 2020 2020 2020 2020 506c  :.            Pl
+0000e350: 6561 7365 206d 616b 6520 7375 7265 2066  ease make sure f
+0000e360: 6f6c 6c6f 7769 6e67 2069 7320 7365 7475  ollowing is setu
+0000e370: 7020 6265 666f 7265 2075 7369 6e67 2074  p before using t
+0000e380: 6869 7320 4150 493a 0a0a 2020 2020 2020  his API:..      
+0000e390: 2020 312e 2048 6176 6520 7468 6520 6265    1. Have the be
+0000e3a0: 6c6f 7720 4150 4973 2065 6e61 626c 6564  low APIs enabled
+0000e3b0: 2066 6f72 2079 6f75 7220 7072 6f6a 6563   for your projec
+0000e3c0: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
+0000e3d0: 2a20 4269 6751 7565 7279 2043 6f6e 6e65  * BigQuery Conne
+0000e3e0: 6374 696f 6e20 4150 490a 2020 2020 2020  ction API.      
+0000e3f0: 2020 2020 2020 2a20 436c 6f75 6420 4675        * Cloud Fu
+0000e400: 6e63 7469 6f6e 7320 4150 490a 2020 2020  nctions API.    
+0000e410: 2020 2020 2020 2020 2a20 436c 6f75 6420          * Cloud 
+0000e420: 5275 6e20 4150 490a 2020 2020 2020 2020  Run API.        
+0000e430: 2020 2020 2a20 436c 6f75 6420 4275 696c      * Cloud Buil
+0000e440: 6420 4150 490a 2020 2020 2020 2020 2020  d API.          
+0000e450: 2020 2a20 4172 7469 6661 6374 2052 6567    * Artifact Reg
+0000e460: 6973 7472 7920 4150 490a 2020 2020 2020  istry API.      
+0000e470: 2020 2020 2020 2a20 436c 6f75 6420 5265        * Cloud Re
+0000e480: 736f 7572 6365 204d 616e 6167 6572 2041  source Manager A
+0000e490: 5049 0a0a 2020 2020 2020 2020 2020 2054  PI..           T
+0000e4a0: 6869 7320 6361 6e20 6265 2064 6f6e 6520  his can be done 
+0000e4b0: 6672 6f6d 2074 6865 2063 6c6f 7564 2063  from the cloud c
+0000e4c0: 6f6e 736f 6c65 2028 6368 616e 6765 2060  onsole (change `
+0000e4d0: 5052 4f4a 4543 545f 4944 6020 746f 2079  PROJECT_ID` to y
+0000e4e0: 6f75 7273 293a 0a20 2020 2020 2020 2020  ours):.         
+0000e4f0: 2020 6874 7470 733a 2f2f 636f 6e73 6f6c    https://consol
+0000e500: 652e 636c 6f75 642e 676f 6f67 6c65 2e63  e.cloud.google.c
+0000e510: 6f6d 2f61 7069 732f 656e 6162 6c65 666c  om/apis/enablefl
+0000e520: 6f77 3f61 7069 6964 3d62 6967 7175 6572  ow?apiid=bigquer
+0000e530: 7963 6f6e 6e65 6374 696f 6e2e 676f 6f67  yconnection.goog
+0000e540: 6c65 6170 6973 2e63 6f6d 2c63 6c6f 7564  leapis.com,cloud
+0000e550: 6675 6e63 7469 6f6e 732e 676f 6f67 6c65  functions.google
+0000e560: 6170 6973 2e63 6f6d 2c72 756e 2e67 6f6f  apis.com,run.goo
+0000e570: 676c 6561 7069 732e 636f 6d2c 636c 6f75  gleapis.com,clou
+0000e580: 6462 7569 6c64 2e67 6f6f 676c 6561 7069  dbuild.googleapi
+0000e590: 732e 636f 6d2c 6172 7469 6661 6374 7265  s.com,artifactre
+0000e5a0: 6769 7374 7279 2e67 6f6f 676c 6561 7069  gistry.googleapi
+0000e5b0: 732e 636f 6d2c 636c 6f75 6472 6573 6f75  s.com,cloudresou
+0000e5c0: 7263 656d 616e 6167 6572 2e67 6f6f 676c  rcemanager.googl
+0000e5d0: 6561 7069 732e 636f 6d26 7072 6f6a 6563  eapis.com&projec
+0000e5e0: 743d 5052 4f4a 4543 545f 4944 0a0a 2020  t=PROJECT_ID..  
+0000e5f0: 2020 2020 2020 2020 204f 7220 6672 6f6d           Or from
+0000e600: 2074 6865 2067 636c 6f75 6420 434c 493a   the gcloud CLI:
+0000e610: 0a0a 2020 2020 2020 2020 2020 2060 2420  ..           `$ 
+0000e620: 6763 6c6f 7564 2073 6572 7669 6365 7320  gcloud services 
+0000e630: 656e 6162 6c65 2062 6967 7175 6572 7963  enable bigqueryc
+0000e640: 6f6e 6e65 6374 696f 6e2e 676f 6f67 6c65  onnection.google
+0000e650: 6170 6973 2e63 6f6d 2063 6c6f 7564 6675  apis.com cloudfu
+0000e660: 6e63 7469 6f6e 732e 676f 6f67 6c65 6170  nctions.googleap
+0000e670: 6973 2e63 6f6d 2072 756e 2e67 6f6f 676c  is.com run.googl
+0000e680: 6561 7069 732e 636f 6d20 636c 6f75 6462  eapis.com cloudb
+0000e690: 7569 6c64 2e67 6f6f 676c 6561 7069 732e  uild.googleapis.
+0000e6a0: 636f 6d20 6172 7469 6661 6374 7265 6769  com artifactregi
+0000e6b0: 7374 7279 2e67 6f6f 676c 6561 7069 732e  stry.googleapis.
+0000e6c0: 636f 6d20 636c 6f75 6472 6573 6f75 7263  com cloudresourc
+0000e6d0: 656d 616e 6167 6572 2e67 6f6f 676c 6561  emanager.googlea
+0000e6e0: 7069 732e 636f 6d60 0a0a 2020 2020 2020  pis.com`..      
+0000e6f0: 2020 322e 2048 6176 6520 666f 6c6c 6f77    2. Have follow
+0000e700: 696e 6720 4941 4d20 726f 6c65 7320 656e  ing IAM roles en
+0000e710: 6162 6c65 6420 666f 7220 796f 753a 0a0a  abled for you:..
+0000e720: 2020 2020 2020 2020 2020 2020 2a20 4269              * Bi
+0000e730: 6751 7565 7279 2044 6174 6120 4564 6974  gQuery Data Edit
+0000e740: 6f72 2028 726f 6c65 732f 6269 6771 7565  or (roles/bigque
+0000e750: 7279 2e64 6174 6145 6469 746f 7229 0a20  ry.dataEditor). 
+0000e760: 2020 2020 2020 2020 2020 202a 2042 6967             * Big
+0000e770: 5175 6572 7920 436f 6e6e 6563 7469 6f6e  Query Connection
+0000e780: 2041 646d 696e 2028 726f 6c65 732f 6269   Admin (roles/bi
+0000e790: 6771 7565 7279 2e63 6f6e 6e65 6374 696f  gquery.connectio
+0000e7a0: 6e41 646d 696e 290a 2020 2020 2020 2020  nAdmin).        
+0000e7b0: 2020 2020 2a20 436c 6f75 6420 4675 6e63      * Cloud Func
+0000e7c0: 7469 6f6e 7320 4465 7665 6c6f 7065 7220  tions Developer 
+0000e7d0: 2872 6f6c 6573 2f63 6c6f 7564 6675 6e63  (roles/cloudfunc
+0000e7e0: 7469 6f6e 732e 6465 7665 6c6f 7065 7229  tions.developer)
+0000e7f0: 0a20 2020 2020 2020 2020 2020 202a 2053  .            * S
+0000e800: 6572 7669 6365 2041 6363 6f75 6e74 2055  ervice Account U
+0000e810: 7365 7220 2872 6f6c 6573 2f69 616d 2e73  ser (roles/iam.s
+0000e820: 6572 7669 6365 4163 636f 756e 7455 7365  erviceAccountUse
+0000e830: 7229 206f 6e20 7468 6520 7365 7276 6963  r) on the servic
+0000e840: 6520 6163 636f 756e 7420 6050 524f 4a45  e account `PROJE
+0000e850: 4354 5f4e 554d 4245 522d 636f 6d70 7574  CT_NUMBER-comput
+0000e860: 6540 6465 7665 6c6f 7065 722e 6773 6572  e@developer.gser
+0000e870: 7669 6365 6163 636f 756e 742e 636f 6d60  viceaccount.com`
+0000e880: 0a20 2020 2020 2020 2020 2020 202a 2053  .            * S
+0000e890: 746f 7261 6765 204f 626a 6563 7420 5669  torage Object Vi
+0000e8a0: 6577 6572 2028 726f 6c65 732f 7374 6f72  ewer (roles/stor
+0000e8b0: 6167 652e 6f62 6a65 6374 5669 6577 6572  age.objectViewer
+0000e8c0: 290a 2020 2020 2020 2020 2020 2020 2a20  ).            * 
+0000e8d0: 5072 6f6a 6563 7420 4941 4d20 4164 6d69  Project IAM Admi
+0000e8e0: 6e20 2872 6f6c 6573 2f72 6573 6f75 7263  n (roles/resourc
+0000e8f0: 656d 616e 6167 6572 2e70 726f 6a65 6374  emanager.project
+0000e900: 4961 6d41 646d 696e 2920 284f 6e6c 7920  IamAdmin) (Only 
+0000e910: 7265 7175 6972 6564 2069 6620 7468 6520  required if the 
+0000e920: 6269 6771 7565 7279 2063 6f6e 6e65 6374  bigquery connect
+0000e930: 696f 6e20 6265 696e 6720 7573 6564 2069  ion being used i
+0000e940: 7320 6e6f 7420 7072 652d 6372 6561 7465  s not pre-create
+0000e950: 6420 616e 6420 6973 2063 7265 6174 6564  d and is created
+0000e960: 2064 796e 616d 6963 616c 6c79 2077 6974   dynamically wit
+0000e970: 6820 7573 6572 2063 7265 6465 6e74 6961  h user credentia
+0000e980: 6c73 2e29 0a0a 2020 2020 2020 2020 332e  ls.)..        3.
+0000e990: 2045 6974 6865 7220 7468 6520 7573 6572   Either the user
+0000e9a0: 2068 6173 2073 6574 4961 6d50 6f6c 6963   has setIamPolic
+0000e9b0: 7920 7072 6976 696c 6567 6520 6f6e 2074  y privilege on t
+0000e9c0: 6865 2070 726f 6a65 6374 2c20 6f72 2061  he project, or a
+0000e9d0: 2042 6967 5175 6572 7920 636f 6e6e 6563   BigQuery connec
+0000e9e0: 7469 6f6e 2069 7320 7072 652d 6372 6561  tion is pre-crea
+0000e9f0: 7465 6420 7769 7468 206e 6563 6573 7361  ted with necessa
+0000ea00: 7279 2049 414d 2072 6f6c 6520 7365 743a  ry IAM role set:
+0000ea10: 0a0a 2020 2020 2020 2020 2020 2020 312e  ..            1.
+0000ea20: 2054 6f20 6372 6561 7465 2061 2063 6f6e   To create a con
+0000ea30: 6e65 6374 696f 6e2c 2066 6f6c 6c6f 7720  nection, follow 
+0000ea40: 6874 7470 733a 2f2f 636c 6f75 642e 676f  https://cloud.go
+0000ea50: 6f67 6c65 2e63 6f6d 2f62 6967 7175 6572  ogle.com/bigquer
+0000ea60: 792f 646f 6373 2f72 6566 6572 656e 6365  y/docs/reference
+0000ea70: 2f73 7461 6e64 6172 642d 7371 6c2f 7265  /standard-sql/re
+0000ea80: 6d6f 7465 2d66 756e 6374 696f 6e73 2363  mote-functions#c
+0000ea90: 7265 6174 655f 615f 636f 6e6e 6563 7469  reate_a_connecti
+0000eaa0: 6f6e 0a20 2020 2020 2020 2020 2020 2032  on.            2
+0000eab0: 2e20 546f 2073 6574 2075 7020 4941 4d2c  . To set up IAM,
+0000eac0: 2066 6f6c 6c6f 7720 6874 7470 733a 2f2f   follow https://
+0000ead0: 636c 6f75 642e 676f 6f67 6c65 2e63 6f6d  cloud.google.com
+0000eae0: 2f62 6967 7175 6572 792f 646f 6373 2f72  /bigquery/docs/r
+0000eaf0: 6566 6572 656e 6365 2f73 7461 6e64 6172  eference/standar
+0000eb00: 642d 7371 6c2f 7265 6d6f 7465 2d66 756e  d-sql/remote-fun
+0000eb10: 6374 696f 6e73 2367 7261 6e74 5f70 6572  ctions#grant_per
+0000eb20: 6d69 7373 696f 6e5f 6f6e 5f66 756e 6374  mission_on_funct
+0000eb30: 696f 6e0a 0a20 2020 2020 2020 2020 2020  ion..           
+0000eb40: 2020 2020 416c 7465 726e 6174 6976 656c      Alternativel
+0000eb50: 792c 2074 6865 2049 414d 2063 6f75 6c64  y, the IAM could
+0000eb60: 2061 6c73 6f20 6265 2073 6574 7570 2076   also be setup v
+0000eb70: 6961 2074 6865 2067 636c 6f75 6420 434c  ia the gcloud CL
+0000eb80: 493a 0a0a 2020 2020 2020 2020 2020 2020  I:..            
+0000eb90: 2020 2060 2420 6763 6c6f 7564 2070 726f     `$ gcloud pro
+0000eba0: 6a65 6374 7320 6164 642d 6961 6d2d 706f  jects add-iam-po
+0000ebb0: 6c69 6379 2d62 696e 6469 6e67 2050 524f  licy-binding PRO
+0000ebc0: 4a45 4354 5f49 4420 2d2d 6d65 6d62 6572  JECT_ID --member
+0000ebd0: 3d22 7365 7276 6963 6541 6363 6f75 6e74  ="serviceAccount
+0000ebe0: 3a43 4f4e 4e45 4354 494f 4e5f 5345 5256  :CONNECTION_SERV
+0000ebf0: 4943 455f 4143 434f 554e 545f 4944 2220  ICE_ACCOUNT_ID" 
+0000ec00: 2d2d 726f 6c65 3d22 726f 6c65 732f 7275  --role="roles/ru
+0000ec10: 6e2e 696e 766f 6b65 7222 602e 0a0a 2020  n.invoker"`...  
+0000ec20: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0000ec30: 2020 2020 2020 2020 696e 7075 745f 7479          input_ty
+0000ec40: 7065 7320 286c 6973 7428 7479 7065 2929  pes (list(type))
+0000ec50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ec60: 2020 4c69 7374 206f 6620 696e 7075 7420    List of input 
+0000ec70: 6461 7461 2074 7970 6573 2069 6e20 7468  data types in th
+0000ec80: 6520 7573 6572 2064 6566 696e 6564 2066  e user defined f
+0000ec90: 756e 6374 696f 6e2e 0a20 2020 2020 2020  unction..       
+0000eca0: 2020 2020 206f 7574 7075 745f 7479 7065       output_type
+0000ecb0: 2028 7479 7065 293a 0a20 2020 2020 2020   (type):.       
+0000ecc0: 2020 2020 2020 2020 2044 6174 6120 7479           Data ty
+0000ecd0: 7065 206f 6620 7468 6520 6f75 7470 7574  pe of the output
+0000ece0: 2069 6e20 7468 6520 7573 6572 2064 6566   in the user def
+0000ecf0: 696e 6564 2066 756e 6374 696f 6e2e 0a20  ined function.. 
+0000ed00: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+0000ed10: 6574 2028 7374 722c 204f 7074 696f 6e61  et (str, Optiona
+0000ed20: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
+0000ed30: 2020 2020 4461 7461 7365 7420 696e 2077      Dataset in w
+0000ed40: 6869 6368 2074 6f20 6372 6561 7465 2061  hich to create a
+0000ed50: 2042 6967 5175 6572 7920 7265 6d6f 7465   BigQuery remote
+0000ed60: 2066 756e 6374 696f 6e2e 2049 7420 7368   function. It sh
+0000ed70: 6f75 6c64 2062 6520 696e 0a20 2020 2020  ould be in.     
+0000ed80: 2020 2020 2020 2020 2020 2060 3c70 726f             `<pro
+0000ed90: 6a65 6374 5f69 643e 2e3c 6461 7461 7365  ject_id>.<datase
+0000eda0: 745f 6e61 6d65 3e60 206f 7220 603c 6461  t_name>` or `<da
+0000edb0: 7461 7365 745f 6e61 6d65 3e60 2066 6f72  taset_name>` for
+0000edc0: 6d61 742e 2049 6620 7468 6973 0a20 2020  mat. If this.   
+0000edd0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000ede0: 616d 6574 6572 2069 7320 6e6f 7420 7072  ameter is not pr
+0000edf0: 6f76 6964 6564 2074 6865 6e20 7365 7373  ovided then sess
+0000ee00: 696f 6e20 6461 7461 7365 7420 6964 2069  ion dataset id i
+0000ee10: 7320 7573 6564 2e0a 2020 2020 2020 2020  s used..        
+0000ee20: 2020 2020 6269 6771 7565 7279 5f63 6f6e      bigquery_con
+0000ee30: 6e65 6374 696f 6e20 2873 7472 2c20 4f70  nection (str, Op
+0000ee40: 7469 6f6e 616c 293a 0a20 2020 2020 2020  tional):.       
+0000ee50: 2020 2020 2020 2020 204e 616d 6520 6f66           Name of
+0000ee60: 2074 6865 2042 6967 5175 6572 7920 636f   the BigQuery co
+0000ee70: 6e6e 6563 7469 6f6e 2e20 596f 7520 7368  nnection. You sh
+0000ee80: 6f75 6c64 2065 6974 6865 7220 6861 7665  ould either have
+0000ee90: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0000eea0: 2020 2020 2063 6f6e 6e65 6374 696f 6e20       connection 
+0000eeb0: 616c 7265 6164 7920 6372 6561 7465 6420  already created 
+0000eec0: 696e 2074 6865 2060 6c6f 6361 7469 6f6e  in the `location
+0000eed0: 6020 796f 7520 6861 7665 2063 686f 7365  ` you have chose
+0000eee0: 6e2c 206f 720a 2020 2020 2020 2020 2020  n, or.          
+0000eef0: 2020 2020 2020 796f 7520 7368 6f75 6c64        you should
+0000ef00: 2068 6176 6520 7468 6520 5072 6f6a 6563   have the Projec
+0000ef10: 7420 4941 4d20 4164 6d69 6e20 726f 6c65  t IAM Admin role
+0000ef20: 2074 6f20 656e 6162 6c65 2074 6865 2073   to enable the s
+0000ef30: 6572 7669 6365 0a20 2020 2020 2020 2020  ervice.         
+0000ef40: 2020 2020 2020 2074 6f20 6372 6561 7465         to create
+0000ef50: 2074 6865 2063 6f6e 6e65 6374 696f 6e20   the connection 
+0000ef60: 666f 7220 796f 7520 6966 2079 6f75 206e  for you if you n
+0000ef70: 6565 6420 6974 2e20 4966 2074 6869 7320  eed it. If this 
+0000ef80: 7061 7261 6d65 7465 7220 6973 0a20 2020  parameter is.   
+0000ef90: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0000efa0: 2070 726f 7669 6465 6420 7468 656e 2074   provided then t
+0000efb0: 6865 2042 6967 5175 6572 7920 636f 6e6e  he BigQuery conn
+0000efc0: 6563 7469 6f6e 2066 726f 6d20 7468 6520  ection from the 
+0000efd0: 7365 7373 696f 6e20 6973 2075 7365 642e  session is used.
+0000efe0: 0a20 2020 2020 2020 2020 2020 2072 6575  .            reu
+0000eff0: 7365 2028 626f 6f6c 2c20 4f70 7469 6f6e  se (bool, Option
+0000f000: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
+0000f010: 2020 2020 2052 6575 7365 2074 6865 2072       Reuse the r
+0000f020: 656d 6f74 6520 6675 6e63 7469 6f6e 2069  emote function i
+0000f030: 6620 616c 7265 6164 7920 6578 6973 7473  f already exists
+0000f040: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f050: 2020 6054 7275 6560 2062 7920 6465 6661    `True` by defa
+0000f060: 756c 742c 2077 6869 6368 2077 696c 6c20  ult, which will 
+0000f070: 7265 7375 6c74 2069 6e20 7265 7573 696e  result in reusin
+0000f080: 6720 616e 2065 7869 7374 696e 6720 7265  g an existing re
+0000f090: 6d6f 7465 0a20 2020 2020 2020 2020 2020  mote.           
+0000f0a0: 2020 2020 2066 756e 6374 696f 6e20 616e       function an
+0000f0b0: 6420 636f 7272 6573 706f 6e64 696e 6720  d corresponding 
+0000f0c0: 636c 6f75 6420 6675 6e63 7469 6f6e 2028  cloud function (
+0000f0d0: 6966 2061 6e79 2920 7468 6174 2077 6173  if any) that was
+0000f0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f0f0: 2070 7265 7669 6f75 736c 7920 6372 6561   previously crea
+0000f100: 7465 6420 666f 7220 7468 6520 7361 6d65  ted for the same
+0000f110: 2075 6466 2e0a 2020 2020 2020 2020 2020   udf..          
+0000f120: 2020 2020 2020 5365 7474 696e 6720 6974        Setting it
+0000f130: 2074 6f20 6046 616c 7365 6020 776f 756c   to `False` woul
+0000f140: 6420 666f 7263 6520 6372 6561 7469 6e67  d force creating
+0000f150: 2061 2075 6e69 7175 6520 7265 6d6f 7465   a unique remote
+0000f160: 2066 756e 6374 696f 6e2e 0a20 2020 2020   function..     
+0000f170: 2020 2020 2020 2020 2020 2049 6620 7468             If th
+0000f180: 6520 7265 7175 6972 6564 2072 656d 6f74  e required remot
+0000f190: 6520 6675 6e63 7469 6f6e 2064 6f65 7320  e function does 
+0000f1a0: 6e6f 7420 6578 6973 7420 7468 656e 2069  not exist then i
+0000f1b0: 7420 776f 756c 6420 6265 0a20 2020 2020  t would be.     
+0000f1c0: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+0000f1d0: 6564 2069 7272 6573 7065 6374 6976 6520  ed irrespective 
+0000f1e0: 6f66 2074 6869 7320 7061 7261 6d2e 0a20  of this param.. 
+0000f1f0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0000f200: 2873 7472 2c20 4f70 7469 6f6e 616c 293a  (str, Optional):
+0000f210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f220: 2045 7870 6c69 6369 7420 6e61 6d65 206f   Explicit name o
+0000f230: 6620 7468 6520 7065 7273 6973 7465 6420  f the persisted 
+0000f240: 4269 6751 7565 7279 2072 656d 6f74 6520  BigQuery remote 
+0000f250: 6675 6e63 7469 6f6e 2e20 5573 6520 6974  function. Use it
+0000f260: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
+0000f270: 2020 2020 2020 6361 7574 696f 6e2c 2062        caution, b
+0000f280: 6563 6175 7365 2074 776f 2075 7365 7273  ecause two users
+0000f290: 2077 6f72 6b69 6e67 2069 6e20 7468 6520   working in the 
+0000f2a0: 7361 6d65 2070 726f 6a65 6374 2061 6e64  same project and
+0000f2b0: 2064 6174 6173 6574 0a20 2020 2020 2020   dataset.       
+0000f2c0: 2020 2020 2020 2020 2063 6f75 6c64 206f           could o
+0000f2d0: 7665 7277 7269 7465 2065 6163 6820 6f74  verwrite each ot
+0000f2e0: 6865 7227 7320 7265 6d6f 7465 2066 756e  her's remote fun
+0000f2f0: 6374 696f 6e73 2069 6620 7468 6579 2075  ctions if they u
+0000f300: 7365 2074 6865 2073 616d 650a 2020 2020  se the same.    
+0000f310: 2020 2020 2020 2020 2020 2020 7065 7273              pers
+0000f320: 6973 7465 6e74 206e 616d 652e 0a20 2020  istent name..   
+0000f330: 2020 2020 2020 2020 2070 6163 6b61 6765           package
+0000f340: 7320 2873 7472 5b5d 2c20 4f70 7469 6f6e  s (str[], Option
+0000f350: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
+0000f360: 2020 2020 2045 7870 6c69 6369 7420 6e61       Explicit na
+0000f370: 6d65 206f 6620 7468 6520 6578 7465 726e  me of the extern
+0000f380: 616c 2070 6163 6b61 6765 2064 6570 656e  al package depen
+0000f390: 6465 6e63 6965 732e 2045 6163 6820 6465  dencies. Each de
+0000f3a0: 7065 6e64 656e 6379 0a20 2020 2020 2020  pendency.       
+0000f3b0: 2020 2020 2020 2020 2069 7320 6164 6465           is adde
+0000f3c0: 6420 746f 2074 6865 2060 7265 7175 6972  d to the `requir
+0000f3d0: 656d 656e 7473 2e74 7874 6020 6173 2069  ements.txt` as i
+0000f3e0: 732c 2061 6e64 2063 616e 2062 6520 6f66  s, and can be of
+0000f3f0: 2074 6865 2066 6f72 6d0a 2020 2020 2020   the form.      
+0000f400: 2020 2020 2020 2020 2020 7375 7070 6f72            suppor
+0000f410: 7465 6420 696e 2068 7474 7073 3a2f 2f70  ted in https://p
+0000f420: 6970 2e70 7970 612e 696f 2f65 6e2f 7374  ip.pypa.io/en/st
+0000f430: 6162 6c65 2f72 6566 6572 656e 6365 2f72  able/reference/r
+0000f440: 6571 7569 7265 6d65 6e74 732d 6669 6c65  equirements-file
+0000f450: 2d66 6f72 6d61 742f 2e0a 2020 2020 2020  -format/..      
+0000f460: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
+0000f470: 7469 6f6e 5f73 6572 7669 6365 5f61 6363  tion_service_acc
+0000f480: 6f75 6e74 2028 7374 722c 204f 7074 696f  ount (str, Optio
+0000f490: 6e61 6c29 3a0a 2020 2020 2020 2020 2020  nal):.          
+0000f4a0: 2020 2020 2020 5365 7276 6963 6520 6163        Service ac
+0000f4b0: 636f 756e 7420 746f 2075 7365 2066 6f72  count to use for
+0000f4c0: 2074 6865 2063 6c6f 7564 2066 756e 6374   the cloud funct
+0000f4d0: 696f 6e73 2e20 4966 206e 6f74 2070 726f  ions. If not pro
+0000f4e0: 7669 6465 640a 2020 2020 2020 2020 2020  vided.          
+0000f4f0: 2020 2020 2020 7468 656e 2074 6865 2064        then the d
+0000f500: 6566 6175 6c74 2073 6572 7669 6365 2061  efault service a
+0000f510: 6363 6f75 6e74 2077 6f75 6c64 2062 6520  ccount would be 
+0000f520: 7573 6564 2e20 5365 650a 2020 2020 2020  used. See.      
+0000f530: 2020 2020 2020 2020 2020 6874 7470 733a            https:
+0000f540: 2f2f 636c 6f75 642e 676f 6f67 6c65 2e63  //cloud.google.c
+0000f550: 6f6d 2f66 756e 6374 696f 6e73 2f64 6f63  om/functions/doc
+0000f560: 732f 7365 6375 7269 6e67 2f66 756e 6374  s/securing/funct
+0000f570: 696f 6e2d 6964 656e 7469 7479 0a20 2020  ion-identity.   
+0000f580: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000f590: 206d 6f72 6520 6465 7461 696c 732e 2050   more details. P
+0000f5a0: 6c65 6173 6520 6d61 6b65 2073 7572 6520  lease make sure 
+0000f5b0: 7468 6520 7365 7276 6963 6520 6163 636f  the service acco
+0000f5c0: 756e 7420 6861 7320 7468 650a 2020 2020  unt has the.    
+0000f5d0: 2020 2020 2020 2020 2020 2020 6e65 6365              nece
+0000f5e0: 7373 6172 7920 4941 4d20 7065 726d 6973  ssary IAM permis
+0000f5f0: 7369 6f6e 7320 636f 6e66 6967 7572 6564  sions configured
+0000f600: 2061 7320 6465 7363 7269 6265 6420 696e   as described in
+0000f610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f620: 2068 7474 7073 3a2f 2f63 6c6f 7564 2e67   https://cloud.g
+0000f630: 6f6f 676c 652e 636f 6d2f 6675 6e63 7469  oogle.com/functi
+0000f640: 6f6e 732f 646f 6373 2f72 6566 6572 656e  ons/docs/referen
+0000f650: 6365 2f69 616d 2f72 6f6c 6573 2361 6464  ce/iam/roles#add
+0000f660: 6974 696f 6e61 6c2d 636f 6e66 6967 7572  itional-configur
+0000f670: 6174 696f 6e2e 0a20 2020 2020 2020 2020  ation..         
+0000f680: 2020 2063 6c6f 7564 5f66 756e 6374 696f     cloud_functio
+0000f690: 6e5f 6b6d 735f 6b65 795f 6e61 6d65 2028  n_kms_key_name (
+0000f6a0: 7374 722c 204f 7074 696f 6e61 6c29 3a0a  str, Optional):.
+0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6c0: 4375 7374 6f6d 6572 206d 616e 6167 6564  Customer managed
+0000f6d0: 2065 6e63 7279 7074 696f 6e20 6b65 7920   encryption key 
+0000f6e0: 746f 2070 726f 7465 6374 2063 6c6f 7564  to protect cloud
+0000f6f0: 2066 756e 6374 696f 6e73 2061 6e64 0a20   functions and. 
+0000f700: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000f710: 656c 6174 6564 2064 6174 6120 6174 2072  elated data at r
+0000f720: 6573 742e 2054 6869 7320 6973 206f 6620  est. This is of 
+0000f730: 7468 6520 666f 726d 6174 0a20 2020 2020  the format.     
+0000f740: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+0000f750: 6374 732f 5052 4f4a 4543 545f 4944 2f6c  cts/PROJECT_ID/l
+0000f760: 6f63 6174 696f 6e73 2f4c 4f43 4154 494f  ocations/LOCATIO
+0000f770: 4e2f 6b65 7952 696e 6773 2f4b 4559 5249  N/keyRings/KEYRI
+0000f780: 4e47 2f63 7279 7074 6f4b 6579 732f 4b45  NG/cryptoKeys/KE
+0000f790: 592e 0a20 2020 2020 2020 2020 2020 2020  Y..             
+0000f7a0: 2020 2052 6561 6420 6874 7470 733a 2f2f     Read https://
+0000f7b0: 636c 6f75 642e 676f 6f67 6c65 2e63 6f6d  cloud.google.com
+0000f7c0: 2f66 756e 6374 696f 6e73 2f64 6f63 732f  /functions/docs/
+0000f7d0: 7365 6375 7269 6e67 2f63 6d65 6b20 666f  securing/cmek fo
+0000f7e0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0000f7f0: 2020 6d6f 7265 2064 6574 6169 6c73 2069    more details i
+0000f800: 6e63 6c75 6469 6e67 2067 7261 6e74 696e  ncluding grantin
+0000f810: 6720 6e65 6365 7373 6172 7920 7365 7276  g necessary serv
+0000f820: 6963 6520 6163 636f 756e 7473 0a20 2020  ice accounts.   
+0000f830: 2020 2020 2020 2020 2020 2020 2061 6363               acc
+0000f840: 6573 7320 746f 2074 6865 206b 6579 2e0a  ess to the key..
+0000f850: 2020 2020 2020 2020 2020 2020 636c 6f75              clou
+0000f860: 645f 6675 6e63 7469 6f6e 5f64 6f63 6b65  d_function_docke
+0000f870: 725f 7265 706f 7369 746f 7279 2028 7374  r_repository (st
+0000f880: 722c 204f 7074 696f 6e61 6c29 3a0a 2020  r, Optional):.  
+0000f890: 2020 2020 2020 2020 2020 2020 2020 446f                Do
+0000f8a0: 636b 6572 2072 6570 6f73 6974 6f72 7920  cker repository 
+0000f8b0: 6372 6561 7465 6420 7769 7468 2074 6865  created with the
+0000f8c0: 2073 616d 6520 656e 6372 7970 7469 6f6e   same encryption
+0000f8d0: 206b 6579 2061 730a 2020 2020 2020 2020   key as.        
+0000f8e0: 2020 2020 2020 2020 6063 6c6f 7564 5f66          `cloud_f
+0000f8f0: 756e 6374 696f 6e5f 6b6d 735f 6b65 795f  unction_kms_key_
+0000f900: 6e61 6d65 6020 746f 2073 746f 7265 2065  name` to store e
+0000f910: 6e63 7279 7074 6564 2061 7274 6966 6163  ncrypted artifac
+0000f920: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+0000f930: 2020 2063 7265 6174 6564 2074 6f20 7375     created to su
+0000f940: 7070 6f72 7420 7468 6520 636c 6f75 6420  pport the cloud 
+0000f950: 6675 6e63 7469 6f6e 2e20 5468 6973 2069  function. This i
+0000f960: 7320 6f66 2074 6865 2066 6f72 6d61 740a  s of the format.
+0000f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f980: 7072 6f6a 6563 7473 2f50 524f 4a45 4354  projects/PROJECT
+0000f990: 5f49 442f 6c6f 6361 7469 6f6e 732f 4c4f  _ID/locations/LO
+0000f9a0: 4341 5449 4f4e 2f72 6570 6f73 6974 6f72  CATION/repositor
+0000f9b0: 6965 732f 5245 504f 5349 544f 5259 5f4e  ies/REPOSITORY_N
+0000f9c0: 414d 452e 0a20 2020 2020 2020 2020 2020  AME..           
+0000f9d0: 2020 2020 2046 6f72 206d 6f72 6520 6465       For more de
+0000f9e0: 7461 696c 7320 7365 650a 2020 2020 2020  tails see.      
+0000f9f0: 2020 2020 2020 2020 2020 6874 7470 733a            https:
+0000fa00: 2f2f 636c 6f75 642e 676f 6f67 6c65 2e63  //cloud.google.c
+0000fa10: 6f6d 2f66 756e 6374 696f 6e73 2f64 6f63  om/functions/doc
+0000fa20: 732f 7365 6375 7269 6e67 2f63 6d65 6b23  s/securing/cmek#
+0000fa30: 6265 666f 7265 5f79 6f75 5f62 6567 696e  before_you_begin
+0000fa40: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0000fa50: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+0000fa60: 616c 6c61 626c 653a 2041 2072 656d 6f74  allable: A remot
+0000fa70: 6520 6675 6e63 7469 6f6e 206f 626a 6563  e function objec
+0000fa80: 7420 706f 696e 7469 6e67 2074 6f20 7468  t pointing to th
+0000fa90: 6520 636c 6f75 6420 6173 7365 7473 2063  e cloud assets c
+0000faa0: 7265 6174 6564 0a20 2020 2020 2020 2020  reated.         
+0000fab0: 2020 2069 6e20 7468 6520 6261 636b 6772     in the backgr
+0000fac0: 6f75 6e64 2074 6f20 7375 7070 6f72 7420  ound to support 
+0000fad0: 7468 6520 7265 6d6f 7465 2065 7865 6375  the remote execu
+0000fae0: 7469 6f6e 2e20 5468 6520 636c 6f75 6420  tion. The cloud 
+0000faf0: 6173 7365 7473 2063 616e 2062 650a 2020  assets can be.  
+0000fb00: 2020 2020 2020 2020 2020 6c6f 6361 7465            locate
+0000fb10: 6420 7468 726f 7567 6820 7468 6520 666f  d through the fo
+0000fb20: 6c6c 6f77 696e 6720 7072 6f70 6572 7469  llowing properti
+0000fb30: 6573 2073 6574 2069 6e20 7468 6520 6f62  es set in the ob
+0000fb40: 6a65 6374 3a0a 0a20 2020 2020 2020 2020  ject:..         
+0000fb50: 2020 2060 6269 6766 7261 6d65 735f 636c     `bigframes_cl
+0000fb60: 6f75 645f 6675 6e63 7469 6f6e 6020 2d20  oud_function` - 
+0000fb70: 5468 6520 676f 6f67 6c65 2063 6c6f 7564  The google cloud
+0000fb80: 2066 756e 6374 696f 6e20 6465 706c 6f79   function deploy
+0000fb90: 6564 2066 6f72 2074 6865 2075 7365 7220  ed for the user 
+0000fba0: 6465 6669 6e65 6420 636f 6465 2e0a 0a20  defined code... 
+0000fbb0: 2020 2020 2020 2020 2020 2060 6269 6766             `bigf
+0000fbc0: 7261 6d65 735f 7265 6d6f 7465 5f66 756e  rames_remote_fun
+0000fbd0: 6374 696f 6e60 202d 2054 6865 2062 6967  ction` - The big
+0000fbe0: 7175 6572 7920 7265 6d6f 7465 2066 756e  query remote fun
+0000fbf0: 6374 696f 6e20 6361 7061 626c 6520 6f66  ction capable of
+0000fc00: 2063 616c 6c69 6e67 2069 6e74 6f20 6062   calling into `b
+0000fc10: 6967 6672 616d 6573 5f63 6c6f 7564 5f66  igframes_cloud_f
+0000fc20: 756e 6374 696f 6e60 2e0a 2020 2020 2020  unction`..      
+0000fc30: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000fc40: 7475 726e 2062 6967 6672 616d 6573 5f72  turn bigframes_r
+0000fc50: 6628 0a20 2020 2020 2020 2020 2020 2069  f(.            i
+0000fc60: 6e70 7574 5f74 7970 6573 2c0a 2020 2020  nput_types,.    
+0000fc70: 2020 2020 2020 2020 6f75 7470 7574 5f74          output_t
+0000fc80: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000fc90: 2073 6573 7369 6f6e 3d73 656c 662c 0a20   session=self,. 
+0000fca0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+0000fcb0: 6574 3d64 6174 6173 6574 2c0a 2020 2020  et=dataset,.    
+0000fcc0: 2020 2020 2020 2020 6269 6771 7565 7279          bigquery
+0000fcd0: 5f63 6f6e 6e65 6374 696f 6e3d 6269 6771  _connection=bigq
+0000fce0: 7565 7279 5f63 6f6e 6e65 6374 696f 6e2c  uery_connection,
+0000fcf0: 0a20 2020 2020 2020 2020 2020 2072 6575  .            reu
+0000fd00: 7365 3d72 6575 7365 2c0a 2020 2020 2020  se=reuse,.      
+0000fd10: 2020 2020 2020 6e61 6d65 3d6e 616d 652c        name=name,
+0000fd20: 0a20 2020 2020 2020 2020 2020 2070 6163  .            pac
+0000fd30: 6b61 6765 733d 7061 636b 6167 6573 2c0a  kages=packages,.
+0000fd40: 2020 2020 2020 2020 2020 2020 636c 6f75              clou
+0000fd50: 645f 6675 6e63 7469 6f6e 5f73 6572 7669  d_function_servi
+0000fd60: 6365 5f61 6363 6f75 6e74 3d63 6c6f 7564  ce_account=cloud
+0000fd70: 5f66 756e 6374 696f 6e5f 7365 7276 6963  _function_servic
+0000fd80: 655f 6163 636f 756e 742c 0a20 2020 2020  e_account,.     
+0000fd90: 2020 2020 2020 2063 6c6f 7564 5f66 756e         cloud_fun
+0000fda0: 6374 696f 6e5f 6b6d 735f 6b65 795f 6e61  ction_kms_key_na
+0000fdb0: 6d65 3d63 6c6f 7564 5f66 756e 6374 696f  me=cloud_functio
+0000fdc0: 6e5f 6b6d 735f 6b65 795f 6e61 6d65 2c0a  n_kms_key_name,.
+0000fdd0: 2020 2020 2020 2020 2020 2020 636c 6f75              clou
+0000fde0: 645f 6675 6e63 7469 6f6e 5f64 6f63 6b65  d_function_docke
+0000fdf0: 725f 7265 706f 7369 746f 7279 3d63 6c6f  r_repository=clo
+0000fe00: 7564 5f66 756e 6374 696f 6e5f 646f 636b  ud_function_dock
+0000fe10: 6572 5f72 6570 6f73 6974 6f72 792c 0a20  er_repository,. 
+0000fe20: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000fe30: 6620 7265 6164 5f67 6271 5f66 756e 6374  f read_gbq_funct
+0000fe40: 696f 6e28 0a20 2020 2020 2020 2073 656c  ion(.        sel
+0000fe50: 662c 0a20 2020 2020 2020 2066 756e 6374  f,.        funct
+0000fe60: 696f 6e5f 6e61 6d65 3a20 7374 722c 0a20  ion_name: str,. 
+0000fe70: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0000fe80: 224c 6f61 6473 2061 2042 6967 5175 6572  "Loads a BigQuer
+0000fe90: 7920 6675 6e63 7469 6f6e 2066 726f 6d20  y function from 
+0000fea0: 4269 6751 7565 7279 2e0a 0a20 2020 2020  BigQuery...     
+0000feb0: 2020 2054 6865 6e20 6974 2063 616e 2062     Then it can b
+0000fec0: 6520 6170 706c 6965 6420 746f 2061 2044  e applied to a D
+0000fed0: 6174 6146 7261 6d65 206f 7220 5365 7269  ataFrame or Seri
+0000fee0: 6573 2e0a 0a20 2020 2020 2020 202e 2e20  es...        .. 
+0000fef0: 6e6f 7465 3a3a 0a20 2020 2020 2020 2020  note::.         
+0000ff00: 2020 2054 6865 2072 6574 7572 6e20 7479     The return ty
+0000ff10: 7065 206f 6620 7468 6520 6675 6e63 7469  pe of the functi
+0000ff20: 6f6e 206d 7573 7420 6265 2065 7870 6c69  on must be expli
+0000ff30: 6369 746c 7920 7370 6563 6966 6965 6420  citly specified 
+0000ff40: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
+0000ff50: 2020 2066 756e 6374 696f 6e27 7320 6f72     function's or
+0000ff60: 6967 696e 616c 2064 6566 696e 6974 696f  iginal definitio
+0000ff70: 6e20 6576 656e 2069 6620 6e6f 7420 6f74  n even if not ot
+0000ff80: 6865 7277 6973 6520 7265 7175 6972 6564  herwise required
+0000ff90: 2e0a 0a20 2020 2020 2020 2042 6967 5175  ...        BigQu
+0000ffa0: 6572 7920 5574 696c 7320 7072 6f76 6964  ery Utils provid
+0000ffb0: 6573 206d 616e 7920 7075 626c 6963 2066  es many public f
+0000ffc0: 756e 6374 696f 6e73 2075 6e64 6572 2074  unctions under t
+0000ffd0: 6865 2060 6062 7175 7469 6c60 6020 7072  he ``bqutil`` pr
+0000ffe0: 6f6a 6563 7420 6f6e 2047 6f6f 676c 6520  oject on Google 
+0000fff0: 436c 6f75 6420 506c 6174 666f 726d 2070  Cloud Platform p
+00010000: 726f 6a65 6374 0a20 2020 2020 2020 2028  roject.        (
+00010010: 5365 653a 2068 7474 7073 3a2f 2f67 6974  See: https://git
+00010020: 6875 622e 636f 6d2f 476f 6f67 6c65 436c  hub.com/GoogleCl
+00010030: 6f75 6450 6c61 7466 6f72 6d2f 6269 6771  oudPlatform/bigq
+00010040: 7565 7279 2d75 7469 6c73 2f74 7265 652f  uery-utils/tree/
+00010050: 6d61 7374 6572 2f75 6466 7323 7573 696e  master/udfs#usin
+00010060: 672d 7468 652d 7564 6673 292e 0a20 2020  g-the-udfs)..   
+00010070: 2020 2020 2059 6f75 2063 616e 2063 6865       You can che
+00010080: 636b 6f75 7420 436f 6d6d 756e 6974 7920  ckout Community 
+00010090: 5544 4673 2074 6f20 7573 6520 636f 6d6d  UDFs to use comm
+000100a0: 756e 6974 792d 636f 6e74 7269 6275 7465  unity-contribute
+000100b0: 6420 6675 6e63 7469 6f6e 732e 0a20 2020  d functions..   
+000100c0: 2020 2020 2028 5365 653a 2068 7474 7073       (See: https
+000100d0: 3a2f 2f67 6974 6875 622e 636f 6d2f 476f  ://github.com/Go
+000100e0: 6f67 6c65 436c 6f75 6450 6c61 7466 6f72  ogleCloudPlatfor
+000100f0: 6d2f 6269 6771 7565 7279 2d75 7469 6c73  m/bigquery-utils
+00010100: 2f74 7265 652f 6d61 7374 6572 2f75 6466  /tree/master/udf
+00010110: 732f 636f 6d6d 756e 6974 7923 636f 6d6d  s/community#comm
+00010120: 756e 6974 792d 7564 6673 292e 0a0a 2020  unity-udfs)...  
+00010130: 2020 2020 2020 2a2a 4578 616d 706c 6573        **Examples
+00010140: 3a2a 2a0a 0a20 2020 2020 2020 2055 7365  :**..        Use
+00010150: 2074 6865 2060 6063 775f 6c6f 7765 725f   the ``cw_lower_
+00010160: 6361 7365 5f61 7363 6969 5f6f 6e6c 7960  case_ascii_only`
+00010170: 6020 6675 6e63 7469 6f6e 2066 726f 6d20  ` function from 
+00010180: 436f 6d6d 756e 6974 7920 5544 4673 2e0a  Community UDFs..
+00010190: 2020 2020 2020 2020 2868 7474 7073 3a2f          (https:/
+000101a0: 2f67 6974 6875 622e 636f 6d2f 476f 6f67  /github.com/Goog
+000101b0: 6c65 436c 6f75 6450 6c61 7466 6f72 6d2f  leCloudPlatform/
+000101c0: 6269 6771 7565 7279 2d75 7469 6c73 2f62  bigquery-utils/b
+000101d0: 6c6f 622f 6d61 7374 6572 2f75 6466 732f  lob/master/udfs/
+000101e0: 636f 6d6d 756e 6974 792f 6377 5f6c 6f77  community/cw_low
+000101f0: 6572 5f63 6173 655f 6173 6369 695f 6f6e  er_case_ascii_on
+00010200: 6c79 2e73 716c 7829 0a0a 2020 2020 2020  ly.sqlx)..      
+00010210: 2020 2020 2020 3e3e 3e20 696d 706f 7274        >>> import
+00010220: 2062 6967 6672 616d 6573 2e70 616e 6461   bigframes.panda
+00010230: 7320 6173 2062 7064 0a20 2020 2020 2020  s as bpd.       
+00010240: 2020 2020 203e 3e3e 2062 7064 2e6f 7074       >>> bpd.opt
+00010250: 696f 6e73 2e64 6973 706c 6179 2e70 726f  ions.display.pro
+00010260: 6772 6573 735f 6261 7220 3d20 4e6f 6e65  gress_bar = None
+00010270: 0a0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
+00010280: 3e20 6466 203d 2062 7064 2e44 6174 6146  > df = bpd.DataF
+00010290: 7261 6d65 287b 2769 6427 3a20 5b31 2c20  rame({'id': [1, 
+000102a0: 322c 2033 5d2c 2027 6e61 6d65 273a 205b  2, 3], 'name': [
+000102b0: 2741 5552 c389 4c49 4527 2c20 2743 c389  'AUR..LIE', 'C..
+000102c0: 4c45 5354 494e 4527 2c20 2744 4150 484e  LESTINE', 'DAPHN
+000102d0: c389 275d 7d29 0a20 2020 2020 2020 2020  ..']}).         
+000102e0: 2020 203e 3e3e 2064 660a 2020 2020 2020     >>> df.      
+000102f0: 2020 2020 2020 2020 2069 6420 2020 2020           id     
+00010300: 2020 6e61 6d65 0a20 2020 2020 2020 2020    name.         
+00010310: 2020 2030 2020 2031 2020 2020 4155 52c3     0   1    AUR.
+00010320: 894c 4945 0a20 2020 2020 2020 2020 2020  .LIE.           
+00010330: 2031 2020 2032 2020 43c3 894c 4553 5449   1   2  C..LESTI
+00010340: 4e45 0a20 2020 2020 2020 2020 2020 2032  NE.            2
+00010350: 2020 2033 2020 2020 2044 4150 484e c389     3     DAPHN..
+00010360: 0a20 2020 2020 2020 2020 2020 203c 424c  .            <BL
+00010370: 414e 4b4c 494e 453e 0a20 2020 2020 2020  ANKLINE>.       
+00010380: 2020 2020 205b 3320 726f 7773 2078 2032       [3 rows x 2
+00010390: 2063 6f6c 756d 6e73 5d0a 0a20 2020 2020   columns]..     
+000103a0: 2020 2020 2020 203e 3e3e 2066 756e 6320         >>> func 
+000103b0: 3d20 6270 642e 7265 6164 5f67 6271 5f66  = bpd.read_gbq_f
+000103c0: 756e 6374 696f 6e28 2262 7175 7469 6c2e  unction("bqutil.
+000103d0: 666e 2e63 775f 6c6f 7765 725f 6361 7365  fn.cw_lower_case
+000103e0: 5f61 7363 6969 5f6f 6e6c 7922 290a 2020  _ascii_only").  
+000103f0: 2020 2020 2020 2020 2020 3e3e 3e20 6466            >>> df
+00010400: 3120 3d20 6466 2e61 7373 6967 6e28 6e65  1 = df.assign(ne
+00010410: 775f 6e61 6d65 3d64 665b 276e 616d 6527  w_name=df['name'
+00010420: 5d2e 6170 706c 7928 6675 6e63 2929 0a20  ].apply(func)). 
+00010430: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
+00010440: 6631 0a20 2020 2020 2020 2020 2020 2020  f1.             
+00010450: 2020 6964 2020 2020 2020 206e 616d 6520    id       name 
+00010460: 2020 6e65 775f 6e61 6d65 0a20 2020 2020    new_name.     
+00010470: 2020 2020 2020 2030 2020 2031 2020 2020         0   1    
+00010480: 4155 52c3 894c 4945 2020 2020 6175 72c3  AUR..LIE    aur.
+00010490: 896c 6965 0a20 2020 2020 2020 2020 2020  .lie.           
+000104a0: 2031 2020 2032 2020 43c3 894c 4553 5449   1   2  C..LESTI
+000104b0: 4e45 2020 63c3 896c 6573 7469 6e65 0a20  NE  c..lestine. 
+000104c0: 2020 2020 2020 2020 2020 2032 2020 2033             2   3
+000104d0: 2020 2020 2044 4150 484e c389 2020 2020       DAPHN..    
+000104e0: 2064 6170 686e c389 0a20 2020 2020 2020   daphn...       
+000104f0: 2020 2020 203c 424c 414e 4b4c 494e 453e       <BLANKLINE>
+00010500: 0a20 2020 2020 2020 2020 2020 205b 3320  .            [3 
+00010510: 726f 7773 2078 2033 2063 6f6c 756d 6e73  rows x 3 columns
+00010520: 5d0a 0a20 2020 2020 2020 2041 7267 733a  ]..        Args:
+00010530: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+00010540: 6374 696f 6e5f 6e61 6d65 2028 7374 7229  ction_name (str)
+00010550: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010560: 2020 7468 6520 6675 6e63 7469 6f6e 2773    the function's
+00010570: 206e 616d 6520 696e 2042 6967 5175 6572   name in BigQuer
+00010580: 7920 696e 2074 6865 2066 6f72 6d61 740a  y in the format.
+00010590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105a0: 6070 726f 6a65 6374 5f69 642e 6461 7461  `project_id.data
+000105b0: 7365 745f 6964 2e66 756e 6374 696f 6e5f  set_id.function_
+000105c0: 6e61 6d65 602c 206f 720a 2020 2020 2020  name`, or.      
+000105d0: 2020 2020 2020 2020 2020 6064 6174 6173            `datas
+000105e0: 6574 5f69 642e 6675 6e63 7469 6f6e 5f6e  et_id.function_n
+000105f0: 616d 6560 2074 6f20 6c6f 6164 2066 726f  ame` to load fro
+00010600: 6d20 7468 6520 6465 6661 756c 7420 7072  m the default pr
+00010610: 6f6a 6563 742c 206f 720a 2020 2020 2020  oject, or.      
+00010620: 2020 2020 2020 2020 2020 6066 756e 6374            `funct
+00010630: 696f 6e5f 6e61 6d65 6020 746f 206c 6f61  ion_name` to loa
+00010640: 6420 6672 6f6d 2074 6865 2064 6566 6175  d from the defau
+00010650: 6c74 2070 726f 6a65 6374 2061 6e64 2074  lt project and t
+00010660: 6865 2064 6174 6173 6574 0a20 2020 2020  he dataset.     
+00010670: 2020 2020 2020 2020 2020 2061 7373 6f63             assoc
+00010680: 6961 7465 6420 7769 7468 2074 6865 2063  iated with the c
+00010690: 7572 7265 6e74 2073 6573 7369 6f6e 2e0a  urrent session..
+000106a0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000106b0: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
+000106c0: 6c6c 6162 6c65 3a20 4120 6675 6e63 7469  llable: A functi
+000106d0: 6f6e 206f 626a 6563 7420 706f 696e 7469  on object pointi
+000106e0: 6e67 2074 6f20 7468 6520 4269 6751 7565  ng to the BigQue
+000106f0: 7279 2066 756e 6374 696f 6e20 7265 6164  ry function read
+00010700: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+00010710: 6d20 4269 6751 7565 7279 2e0a 0a20 2020  m BigQuery...   
+00010720: 2020 2020 2020 2020 2054 6865 206f 626a           The obj
+00010730: 6563 7420 6973 2073 696d 696c 6172 2074  ect is similar t
+00010740: 6f20 7468 6520 6f6e 6520 6372 6561 7465  o the one create
+00010750: 6420 6279 2074 6865 2060 7265 6d6f 7465  d by the `remote
+00010760: 5f66 756e 6374 696f 6e60 0a20 2020 2020  _function`.     
+00010770: 2020 2020 2020 2064 6563 6f72 6174 6f72         decorator
+00010780: 2c20 696e 636c 7564 696e 6720 7468 6520  , including the 
+00010790: 6062 6967 6672 616d 6573 5f72 656d 6f74  `bigframes_remot
+000107a0: 655f 6675 6e63 7469 6f6e 6020 7072 6f70  e_function` prop
+000107b0: 6572 7479 2c20 6275 740a 2020 2020 2020  erty, but.      
+000107c0: 2020 2020 2020 6e6f 7420 696e 636c 7564        not includ
+000107d0: 696e 6720 7468 6520 6062 6967 6672 616d  ing the `bigfram
+000107e0: 6573 5f63 6c6f 7564 5f66 756e 6374 696f  es_cloud_functio
+000107f0: 6e60 2070 726f 7065 7274 792e 0a20 2020  n` property..   
+00010800: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00010810: 2020 7265 7475 726e 2062 6967 6672 616d    return bigfram
+00010820: 6573 5f72 6766 280a 2020 2020 2020 2020  es_rgf(.        
+00010830: 2020 2020 6675 6e63 7469 6f6e 5f6e 616d      function_nam
+00010840: 653d 6675 6e63 7469 6f6e 5f6e 616d 652c  e=function_name,
+00010850: 0a20 2020 2020 2020 2020 2020 2073 6573  .            ses
+00010860: 7369 6f6e 3d73 656c 662c 0a20 2020 2020  sion=self,.     
+00010870: 2020 2029 0a0a 2020 2020 6465 6620 5f70     )..    def _p
+00010880: 7265 7061 7265 5f71 7565 7279 5f6a 6f62  repare_query_job
+00010890: 5f63 6f6e 6669 6728 0a20 2020 2020 2020  _config(.       
+000108a0: 2073 656c 662c 0a20 2020 2020 2020 206a   self,.        j
+000108b0: 6f62 5f63 6f6e 6669 673a 204f 7074 696f  ob_config: Optio
+000108c0: 6e61 6c5b 6269 6771 7565 7279 2e51 7565  nal[bigquery.Que
+000108d0: 7279 4a6f 6243 6f6e 6669 675d 203d 204e  ryJobConfig] = N
+000108e0: 6f6e 652c 0a20 2020 2029 202d 3e20 6269  one,.    ) -> bi
+000108f0: 6771 7565 7279 2e51 7565 7279 4a6f 6243  gquery.QueryJobC
+00010900: 6f6e 6669 673a 0a20 2020 2020 2020 2069  onfig:.        i
+00010910: 6620 6a6f 625f 636f 6e66 6967 2069 7320  f job_config is 
+00010920: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00010930: 2020 6a6f 625f 636f 6e66 6967 203d 2062    job_config = b
+00010940: 6967 7175 6572 792e 5175 6572 794a 6f62  igquery.QueryJob
+00010950: 436f 6e66 6967 2829 0a20 2020 2020 2020  Config().       
+00010960: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00010970: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
+00010980: 7079 2073 6f20 7468 6174 2077 6520 646f  py so that we do
+00010990: 6e27 7420 6d75 7461 7465 2074 6865 206f  n't mutate the o
+000109a0: 7269 6769 6e61 6c20 636f 6e66 6967 2070  riginal config p
+000109b0: 6173 7365 640a 2020 2020 2020 2020 2020  assed.          
+000109c0: 2020 6a6f 625f 636f 6e66 6967 203d 2074    job_config = t
+000109d0: 7970 696e 672e 6361 7374 280a 2020 2020  yping.cast(.    
+000109e0: 2020 2020 2020 2020 2020 2020 6269 6771              bigq
+000109f0: 7565 7279 2e51 7565 7279 4a6f 6243 6f6e  uery.QueryJobCon
+00010a00: 6669 672c 0a20 2020 2020 2020 2020 2020  fig,.           
+00010a10: 2020 2020 2062 6967 7175 6572 792e 5175       bigquery.Qu
+00010a20: 6572 794a 6f62 436f 6e66 6967 2e66 726f  eryJobConfig.fro
+00010a30: 6d5f 6170 695f 7265 7072 286a 6f62 5f63  m_api_repr(job_c
+00010a40: 6f6e 6669 672e 746f 5f61 7069 5f72 6570  onfig.to_api_rep
+00010a50: 7228 2929 2c0a 2020 2020 2020 2020 2020  r()),.          
+00010a60: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+00010a70: 6269 6766 7261 6d65 732e 6f70 7469 6f6e  bigframes.option
+00010a80: 732e 636f 6d70 7574 652e 6d61 7869 6d75  s.compute.maximu
+00010a90: 6d5f 6279 7465 735f 6269 6c6c 6564 2069  m_bytes_billed i
+00010aa0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00010ab0: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00010ac0: 6967 2e6d 6178 696d 756d 5f62 7974 6573  ig.maximum_bytes
+00010ad0: 5f62 696c 6c65 6420 3d20 280a 2020 2020  _billed = (.    
+00010ae0: 2020 2020 2020 2020 2020 2020 6269 6766              bigf
+00010af0: 7261 6d65 732e 6f70 7469 6f6e 732e 636f  rames.options.co
+00010b00: 6d70 7574 652e 6d61 7869 6d75 6d5f 6279  mpute.maximum_by
+00010b10: 7465 735f 6269 6c6c 6564 0a20 2020 2020  tes_billed.     
+00010b20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00010b30: 2020 6966 2073 656c 662e 5f62 715f 6b6d    if self._bq_km
+00010b40: 735f 6b65 795f 6e61 6d65 3a0a 2020 2020  s_key_name:.    
+00010b50: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00010b60: 6967 2e64 6573 7469 6e61 7469 6f6e 5f65  ig.destination_e
+00010b70: 6e63 7279 7074 696f 6e5f 636f 6e66 6967  ncryption_config
+00010b80: 7572 6174 696f 6e20 3d20 280a 2020 2020  uration = (.    
+00010b90: 2020 2020 2020 2020 2020 2020 6269 6771              bigq
+00010ba0: 7565 7279 2e45 6e63 7279 7074 696f 6e43  uery.EncryptionC
+00010bb0: 6f6e 6669 6775 7261 7469 6f6e 286b 6d73  onfiguration(kms
+00010bc0: 5f6b 6579 5f6e 616d 653d 7365 6c66 2e5f  _key_name=self._
+00010bd0: 6271 5f6b 6d73 5f6b 6579 5f6e 616d 6529  bq_kms_key_name)
+00010be0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00010bf0: 2020 2020 2020 2020 7265 7475 726e 206a          return j
+00010c00: 6f62 5f63 6f6e 6669 670a 0a20 2020 2064  ob_config..    d
+00010c10: 6566 205f 7072 6570 6172 655f 6c6f 6164  ef _prepare_load
+00010c20: 5f6a 6f62 5f63 6f6e 6669 6728 7365 6c66  _job_config(self
+00010c30: 2920 2d3e 2062 6967 7175 6572 792e 4c6f  ) -> bigquery.Lo
+00010c40: 6164 4a6f 6243 6f6e 6669 673a 0a20 2020  adJobConfig:.   
+00010c50: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
+00010c60: 636f 7079 2073 6f20 7468 6174 2077 6520  copy so that we 
+00010c70: 646f 6e27 7420 6d75 7461 7465 2074 6865  don't mutate the
+00010c80: 206f 7269 6769 6e61 6c20 636f 6e66 6967   original config
+00010c90: 2070 6173 7365 640a 2020 2020 2020 2020   passed.        
+00010ca0: 6a6f 625f 636f 6e66 6967 203d 2062 6967  job_config = big
+00010cb0: 7175 6572 792e 4c6f 6164 4a6f 6243 6f6e  query.LoadJobCon
+00010cc0: 6669 6728 290a 0a20 2020 2020 2020 2069  fig()..        i
+00010cd0: 6620 7365 6c66 2e5f 6271 5f6b 6d73 5f6b  f self._bq_kms_k
+00010ce0: 6579 5f6e 616d 653a 0a20 2020 2020 2020  ey_name:.       
+00010cf0: 2020 2020 206a 6f62 5f63 6f6e 6669 672e       job_config.
+00010d00: 6465 7374 696e 6174 696f 6e5f 656e 6372  destination_encr
+00010d10: 7970 7469 6f6e 5f63 6f6e 6669 6775 7261  yption_configura
+00010d20: 7469 6f6e 203d 2028 0a20 2020 2020 2020  tion = (.       
+00010d30: 2020 2020 2020 2020 2062 6967 7175 6572           bigquer
+00010d40: 792e 456e 6372 7970 7469 6f6e 436f 6e66  y.EncryptionConf
+00010d50: 6967 7572 6174 696f 6e28 6b6d 735f 6b65  iguration(kms_ke
+00010d60: 795f 6e61 6d65 3d73 656c 662e 5f62 715f  y_name=self._bq_
+00010d70: 6b6d 735f 6b65 795f 6e61 6d65 290a 2020  kms_key_name).  
+00010d80: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00010d90: 2020 2020 2072 6574 7572 6e20 6a6f 625f       return job_
+00010da0: 636f 6e66 6967 0a0a 2020 2020 6465 6620  config..    def 
+00010db0: 5f70 7265 7061 7265 5f63 6f70 795f 6a6f  _prepare_copy_jo
+00010dc0: 625f 636f 6e66 6967 2873 656c 6629 202d  b_config(self) -
+00010dd0: 3e20 6269 6771 7565 7279 2e43 6f70 794a  > bigquery.CopyJ
+00010de0: 6f62 436f 6e66 6967 3a0a 2020 2020 2020  obConfig:.      
+00010df0: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
+00010e00: 7920 736f 2074 6861 7420 7765 2064 6f6e  y so that we don
+00010e10: 2774 206d 7574 6174 6520 7468 6520 6f72  't mutate the or
+00010e20: 6967 696e 616c 2063 6f6e 6669 6720 7061  iginal config pa
+00010e30: 7373 6564 0a20 2020 2020 2020 206a 6f62  ssed.        job
+00010e40: 5f63 6f6e 6669 6720 3d20 6269 6771 7565  _config = bigque
+00010e50: 7279 2e43 6f70 794a 6f62 436f 6e66 6967  ry.CopyJobConfig
+00010e60: 2829 0a0a 2020 2020 2020 2020 6966 2073  ()..        if s
+00010e70: 656c 662e 5f62 715f 6b6d 735f 6b65 795f  elf._bq_kms_key_
+00010e80: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+00010e90: 2020 6a6f 625f 636f 6e66 6967 2e64 6573    job_config.des
+00010ea0: 7469 6e61 7469 6f6e 5f65 6e63 7279 7074  tination_encrypt
+00010eb0: 696f 6e5f 636f 6e66 6967 7572 6174 696f  ion_configuratio
+00010ec0: 6e20 3d20 280a 2020 2020 2020 2020 2020  n = (.          
+00010ed0: 2020 2020 2020 6269 6771 7565 7279 2e45        bigquery.E
+00010ee0: 6e63 7279 7074 696f 6e43 6f6e 6669 6775  ncryptionConfigu
+00010ef0: 7261 7469 6f6e 286b 6d73 5f6b 6579 5f6e  ration(kms_key_n
+00010f00: 616d 653d 7365 6c66 2e5f 6271 5f6b 6d73  ame=self._bq_kms
+00010f10: 5f6b 6579 5f6e 616d 6529 0a20 2020 2020  _key_name).     
+00010f20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00010f30: 2020 7265 7475 726e 206a 6f62 5f63 6f6e    return job_con
+00010f40: 6669 670a 0a20 2020 2064 6566 205f 7374  fig..    def _st
+00010f50: 6172 745f 7175 6572 7928 0a20 2020 2020  art_query(.     
+00010f60: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00010f70: 2073 716c 3a20 7374 722c 0a20 2020 2020   sql: str,.     
+00010f80: 2020 206a 6f62 5f63 6f6e 6669 673a 204f     job_config: O
+00010f90: 7074 696f 6e61 6c5b 6269 6771 7565 7279  ptional[bigquery
+00010fa0: 2e6a 6f62 2e51 7565 7279 4a6f 6243 6f6e  .job.QueryJobCon
+00010fb0: 6669 675d 203d 204e 6f6e 652c 0a20 2020  fig] = None,.   
+00010fc0: 2020 2020 206d 6178 5f72 6573 756c 7473       max_results
+00010fd0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00010fe0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00010ff0: 7469 6d65 6f75 743a 204f 7074 696f 6e61  timeout: Optiona
+00011000: 6c5b 666c 6f61 745d 203d 204e 6f6e 652c  l[float] = None,
+00011010: 0a20 2020 2029 202d 3e20 5475 706c 655b  .    ) -> Tuple[
+00011020: 6269 6771 7565 7279 2e74 6162 6c65 2e52  bigquery.table.R
+00011030: 6f77 4974 6572 6174 6f72 2c20 6269 6771  owIterator, bigq
+00011040: 7565 7279 2e51 7565 7279 4a6f 625d 3a0a  uery.QueryJob]:.
+00011050: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011060: 2020 2020 5374 6172 7473 2042 6967 5175      Starts BigQu
+00011070: 6572 7920 7175 6572 7920 6a6f 6220 616e  ery query job an
+00011080: 6420 7761 6974 7320 666f 7220 7265 7375  d waits for resu
+00011090: 6c74 732e 0a20 2020 2020 2020 2022 2222  lts..        """
+000110a0: 0a20 2020 2020 2020 206a 6f62 5f63 6f6e  .        job_con
+000110b0: 6669 6720 3d20 7365 6c66 2e5f 7072 6570  fig = self._prep
+000110c0: 6172 655f 7175 6572 795f 6a6f 625f 636f  are_query_job_co
+000110d0: 6e66 6967 286a 6f62 5f63 6f6e 6669 6729  nfig(job_config)
+000110e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000110f0: 6269 6766 7261 6d65 732e 7365 7373 696f  bigframes.sessio
+00011100: 6e2e 5f69 6f2e 6269 6771 7565 7279 2e73  n._io.bigquery.s
+00011110: 7461 7274 5f71 7565 7279 5f77 6974 685f  tart_query_with_
+00011120: 636c 6965 6e74 280a 2020 2020 2020 2020  client(.        
+00011130: 2020 2020 7365 6c66 2e62 7163 6c69 656e      self.bqclien
+00011140: 742c 2073 716c 2c20 6a6f 625f 636f 6e66  t, sql, job_conf
+00011150: 6967 2c20 6d61 785f 7265 7375 6c74 732c  ig, max_results,
+00011160: 2074 696d 656f 7574 0a20 2020 2020 2020   timeout.       
+00011170: 2029 0a0a 2020 2020 6465 6620 5f73 7461   )..    def _sta
+00011180: 7274 5f71 7565 7279 5f6d 6c5f 6464 6c28  rt_query_ml_ddl(
+00011190: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000111a0: 2020 2020 2020 2073 716c 3a20 7374 722c         sql: str,
+000111b0: 0a20 2020 2029 202d 3e20 5475 706c 655b  .    ) -> Tuple[
+000111c0: 6269 6771 7565 7279 2e74 6162 6c65 2e52  bigquery.table.R
+000111d0: 6f77 4974 6572 6174 6f72 2c20 6269 6771  owIterator, bigq
+000111e0: 7565 7279 2e51 7565 7279 4a6f 625d 3a0a  uery.QueryJob]:.
+000111f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011200: 2020 2020 5374 6172 7473 2042 6967 5175      Starts BigQu
+00011210: 6572 7920 4d4c 2044 444c 2071 7565 7279  ery ML DDL query
+00011220: 206a 6f62 2028 4352 4541 5445 204d 4f44   job (CREATE MOD
+00011230: 454c 2f41 4c54 4552 204d 4f44 454c 2f2e  EL/ALTER MODEL/.
+00011240: 2e2e 2920 616e 640a 2020 2020 2020 2020  ..) and.        
+00011250: 7761 6974 7320 666f 7220 7265 7375 6c74  waits for result
+00011260: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00011270: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
+00011280: 6720 3d20 7365 6c66 2e5f 7072 6570 6172  g = self._prepar
+00011290: 655f 7175 6572 795f 6a6f 625f 636f 6e66  e_query_job_conf
+000112a0: 6967 2829 0a0a 2020 2020 2020 2020 2320  ig()..        # 
+000112b0: 4251 4d4c 2065 7870 6563 7473 206b 6d73  BQML expects kms
+000112c0: 5f6b 6579 5f6e 616d 6520 7468 726f 7567  _key_name throug
+000112d0: 6820 4f50 5449 4f4e 5320 616e 6420 6e6f  h OPTIONS and no
+000112e0: 7420 7468 726f 7567 6820 6a6f 6220 636f  t through job co
+000112f0: 6e66 6967 2c0a 2020 2020 2020 2020 2320  nfig,.        # 
+00011300: 736f 2077 6520 6d75 7374 2072 6573 6574  so we must reset
+00011310: 2061 6e79 2065 6e63 7279 7074 696f 6e20   any encryption 
+00011320: 7365 7420 696e 2074 6865 206a 6f62 2063  set in the job c
+00011330: 6f6e 6669 670a 2020 2020 2020 2020 2320  onfig.        # 
+00011340: 6874 7470 733a 2f2f 636c 6f75 642e 676f  https://cloud.go
+00011350: 6f67 6c65 2e63 6f6d 2f62 6967 7175 6572  ogle.com/bigquer
+00011360: 792f 646f 6373 2f63 7573 746f 6d65 722d  y/docs/customer-
+00011370: 6d61 6e61 6765 642d 656e 6372 7970 7469  managed-encrypti
+00011380: 6f6e 2365 6e63 7279 7074 2d6d 6f64 656c  on#encrypt-model
+00011390: 0a20 2020 2020 2020 206a 6f62 5f63 6f6e  .        job_con
+000113a0: 6669 672e 6465 7374 696e 6174 696f 6e5f  fig.destination_
+000113b0: 656e 6372 7970 7469 6f6e 5f63 6f6e 6669  encryption_confi
+000113c0: 6775 7261 7469 6f6e 203d 204e 6f6e 650a  guration = None.
+000113d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000113e0: 6269 6766 7261 6d65 732e 7365 7373 696f  bigframes.sessio
+000113f0: 6e2e 5f69 6f2e 6269 6771 7565 7279 2e73  n._io.bigquery.s
+00011400: 7461 7274 5f71 7565 7279 5f77 6974 685f  tart_query_with_
+00011410: 636c 6965 6e74 280a 2020 2020 2020 2020  client(.        
+00011420: 2020 2020 7365 6c66 2e62 7163 6c69 656e      self.bqclien
+00011430: 742c 2073 716c 2c20 6a6f 625f 636f 6e66  t, sql, job_conf
+00011440: 6967 0a20 2020 2020 2020 2029 0a0a 2020  ig.        )..  
+00011450: 2020 6465 6620 5f63 6163 6865 5f77 6974    def _cache_wit
+00011460: 685f 636c 7573 7465 725f 636f 6c73 280a  h_cluster_cols(.
+00011470: 2020 2020 2020 2020 7365 6c66 2c20 6172          self, ar
+00011480: 7261 795f 7661 6c75 653a 2063 6f72 652e  ray_value: core.
+00011490: 4172 7261 7956 616c 7565 2c20 636c 7573  ArrayValue, clus
+000114a0: 7465 725f 636f 6c73 3a20 7479 7069 6e67  ter_cols: typing
+000114b0: 2e53 6571 7565 6e63 655b 7374 725d 0a20  .Sequence[str]. 
+000114c0: 2020 2029 202d 3e20 636f 7265 2e41 7272     ) -> core.Arr
+000114d0: 6179 5661 6c75 653a 0a20 2020 2020 2020  ayValue:.       
+000114e0: 2022 2222 4578 6563 7574 6573 2074 6865   """Executes the
+000114f0: 2071 7565 7279 2061 6e64 2075 7365 7320   query and uses 
+00011500: 7468 6520 7265 7375 6c74 696e 6720 7461  the resulting ta
+00011510: 626c 6520 746f 2072 6577 7269 7465 2066  ble to rewrite f
+00011520: 7574 7572 6520 6578 6563 7574 696f 6e73  uture executions
+00011530: 2e22 2222 0a20 2020 2020 2020 2023 2054  .""".        # T
+00011540: 4f44 4f3a 2055 7365 2074 6869 7320 666f  ODO: Use this fo
+00011550: 7220 616c 6c20 6578 6563 7574 696f 6e73  r all executions
+00011560: 3f20 5072 6f62 6c65 6d20 6973 2074 6861  ? Problem is tha
+00011570: 7420 6361 6368 696e 6720 6d61 7465 7269  t caching materi
+00011580: 616c 697a 6573 2065 7874 7261 0a20 2020  alizes extra.   
+00011590: 2020 2020 2023 206f 7264 6572 696e 6720       # ordering 
+000115a0: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
+000115b0: 636f 6d70 696c 6564 5f76 616c 7565 203d  compiled_value =
+000115c0: 2073 656c 662e 5f63 6f6d 7069 6c65 5f6f   self._compile_o
+000115d0: 7264 6572 6564 2861 7272 6179 5f76 616c  rdered(array_val
+000115e0: 7565 290a 0a20 2020 2020 2020 2069 6269  ue)..        ibi
+000115f0: 735f 6578 7072 203d 2063 6f6d 7069 6c65  s_expr = compile
+00011600: 645f 7661 6c75 652e 5f74 6f5f 6962 6973  d_value._to_ibis
+00011610: 5f65 7870 7228 0a20 2020 2020 2020 2020  _expr(.         
+00011620: 2020 206f 7264 6572 696e 675f 6d6f 6465     ordering_mode
+00011630: 3d22 756e 6f72 6465 7265 6422 2c20 6578  ="unordered", ex
+00011640: 706f 7365 5f68 6964 6465 6e5f 636f 6c73  pose_hidden_cols
+00011650: 3d54 7275 650a 2020 2020 2020 2020 290a  =True.        ).
+00011660: 2020 2020 2020 2020 746d 705f 7461 626c          tmp_tabl
+00011670: 6520 3d20 7365 6c66 2e5f 6962 6973 5f74  e = self._ibis_t
+00011680: 6f5f 7465 6d70 5f74 6162 6c65 280a 2020  o_temp_table(.  
+00011690: 2020 2020 2020 2020 2020 6962 6973 5f65            ibis_e
+000116a0: 7870 722c 2063 6c75 7374 6572 5f63 6f6c  xpr, cluster_col
+000116b0: 733d 636c 7573 7465 725f 636f 6c73 2c20  s=cluster_cols, 
+000116c0: 6170 695f 6e61 6d65 3d22 6361 6368 6564  api_name="cached
+000116d0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+000116e0: 2020 2020 7461 626c 655f 6578 7072 6573      table_expres
+000116f0: 7369 6f6e 203d 2073 656c 662e 6962 6973  sion = self.ibis
+00011700: 5f63 6c69 656e 742e 7461 626c 6528 0a20  _client.table(. 
+00011710: 2020 2020 2020 2020 2020 2074 6d70 5f74             tmp_t
+00011720: 6162 6c65 2e74 6162 6c65 5f69 642c 0a20  able.table_id,. 
+00011730: 2020 2020 2020 2020 2020 2073 6368 656d             schem
+00011740: 613d 746d 705f 7461 626c 652e 6461 7461  a=tmp_table.data
+00011750: 7365 745f 6964 2c0a 2020 2020 2020 2020  set_id,.        
+00011760: 2020 2020 6461 7461 6261 7365 3d74 6d70      database=tmp
+00011770: 5f74 6162 6c65 2e70 726f 6a65 6374 2c0a  _table.project,.
+00011780: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011790: 2020 6e65 775f 636f 6c75 6d6e 7320 3d20    new_columns = 
+000117a0: 5b74 6162 6c65 5f65 7870 7265 7373 696f  [table_expressio
+000117b0: 6e5b 636f 6c75 6d6e 5d20 666f 7220 636f  n[column] for co
+000117c0: 6c75 6d6e 2069 6e20 636f 6d70 696c 6564  lumn in compiled
+000117d0: 5f76 616c 7565 2e63 6f6c 756d 6e5f 6964  _value.column_id
+000117e0: 735d 0a20 2020 2020 2020 206e 6577 5f68  s].        new_h
+000117f0: 6964 6465 6e5f 636f 6c75 6d6e 7320 3d20  idden_columns = 
+00011800: 5b0a 2020 2020 2020 2020 2020 2020 7461  [.            ta
+00011810: 626c 655f 6578 7072 6573 7369 6f6e 5b63  ble_expression[c
+00011820: 6f6c 756d 6e5d 0a20 2020 2020 2020 2020  olumn].         
+00011830: 2020 2066 6f72 2063 6f6c 756d 6e20 696e     for column in
+00011840: 2063 6f6d 7069 6c65 645f 7661 6c75 652e   compiled_value.
+00011850: 5f68 6964 6465 6e5f 6f72 6465 7269 6e67  _hidden_ordering
+00011860: 5f63 6f6c 756d 6e5f 6e61 6d65 730a 2020  _column_names.  
+00011870: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00011880: 2320 544f 444f 3a20 496e 7374 6561 642c  # TODO: Instead,
+00011890: 206b 6565 7020 7365 7373 696f 6e2d 7769   keep session-wi
+000118a0: 6465 206d 6170 206f 6620 6361 6368 6564  de map of cached
+000118b0: 2072 6573 756c 7473 2061 6e64 2061 7574   results and aut
+000118c0: 6f6d 6174 6963 616c 6c79 2072 6575 7365  omatically reuse
+000118d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000118e0: 636f 7265 2e41 7272 6179 5661 6c75 652e  core.ArrayValue.
+000118f0: 6672 6f6d 5f69 6269 7328 0a20 2020 2020  from_ibis(.     
+00011900: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00011910: 2020 2020 2020 2020 2074 6162 6c65 5f65           table_e
+00011920: 7870 7265 7373 696f 6e2c 0a20 2020 2020  xpression,.     
+00011930: 2020 2020 2020 2063 6f6c 756d 6e73 3d6e         columns=n
+00011940: 6577 5f63 6f6c 756d 6e73 2c0a 2020 2020  ew_columns,.    
+00011950: 2020 2020 2020 2020 6869 6464 656e 5f6f          hidden_o
+00011960: 7264 6572 696e 675f 636f 6c75 6d6e 733d  rdering_columns=
+00011970: 6e65 775f 6869 6464 656e 5f63 6f6c 756d  new_hidden_colum
+00011980: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+00011990: 6f72 6465 7269 6e67 3d63 6f6d 7069 6c65  ordering=compile
+000119a0: 645f 7661 6c75 652e 5f6f 7264 6572 696e  d_value._orderin
+000119b0: 672c 0a20 2020 2020 2020 2029 0a0a 2020  g,.        )..  
+000119c0: 2020 6465 6620 5f63 6163 6865 5f77 6974    def _cache_wit
+000119d0: 685f 6f66 6673 6574 7328 7365 6c66 2c20  h_offsets(self, 
+000119e0: 6172 7261 795f 7661 6c75 653a 2063 6f72  array_value: cor
+000119f0: 652e 4172 7261 7956 616c 7565 2920 2d3e  e.ArrayValue) ->
+00011a00: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
+00011a10: 3a0a 2020 2020 2020 2020 2222 2245 7865  :.        """Exe
+00011a20: 6375 7465 7320 7468 6520 7175 6572 7920  cutes the query 
+00011a30: 616e 6420 7573 6573 2074 6865 2072 6573  and uses the res
+00011a40: 756c 7469 6e67 2074 6162 6c65 2074 6f20  ulting table to 
+00011a50: 7265 7772 6974 6520 6675 7475 7265 2065  rewrite future e
+00011a60: 7865 6375 7469 6f6e 732e 2222 220a 2020  xecutions.""".  
+00011a70: 2020 2020 2020 2320 544f 444f 3a20 5573        # TODO: Us
+00011a80: 6520 7468 6973 2066 6f72 2061 6c6c 2065  e this for all e
+00011a90: 7865 6375 7469 6f6e 733f 2050 726f 626c  xecutions? Probl
+00011aa0: 656d 2069 7320 7468 6174 2063 6163 6869  em is that cachi
+00011ab0: 6e67 206d 6174 6572 6961 6c69 7a65 7320  ng materializes 
+00011ac0: 6578 7472 610a 2020 2020 2020 2020 2320  extra.        # 
+00011ad0: 6f72 6465 7269 6e67 2063 6f6c 756d 6e73  ordering columns
+00011ae0: 0a20 2020 2020 2020 2063 6f6d 7069 6c65  .        compile
+00011af0: 645f 7661 6c75 6520 3d20 7365 6c66 2e5f  d_value = self._
+00011b00: 636f 6d70 696c 655f 6f72 6465 7265 6428  compile_ordered(
+00011b10: 6172 7261 795f 7661 6c75 6529 0a0a 2020  array_value)..  
+00011b20: 2020 2020 2020 6962 6973 5f65 7870 7220        ibis_expr 
+00011b30: 3d20 636f 6d70 696c 6564 5f76 616c 7565  = compiled_value
+00011b40: 2e5f 746f 5f69 6269 735f 6578 7072 280a  ._to_ibis_expr(.
+00011b50: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+00011b60: 7269 6e67 5f6d 6f64 653d 226f 6666 7365  ring_mode="offse
+00011b70: 745f 636f 6c22 2c20 6f72 6465 725f 636f  t_col", order_co
+00011b80: 6c5f 6e61 6d65 3d22 6269 6766 7261 6d65  l_name="bigframe
+00011b90: 735f 6f66 6673 6574 7322 0a20 2020 2020  s_offsets".     
+00011ba0: 2020 2029 0a20 2020 2020 2020 2074 6d70     ).        tmp
+00011bb0: 5f74 6162 6c65 203d 2073 656c 662e 5f69  _table = self._i
+00011bc0: 6269 735f 746f 5f74 656d 705f 7461 626c  bis_to_temp_tabl
+00011bd0: 6528 0a20 2020 2020 2020 2020 2020 2069  e(.            i
+00011be0: 6269 735f 6578 7072 2c20 636c 7573 7465  bis_expr, cluste
+00011bf0: 725f 636f 6c73 3d5b 2262 6967 6672 616d  r_cols=["bigfram
+00011c00: 6573 5f6f 6666 7365 7473 225d 2c20 6170  es_offsets"], ap
+00011c10: 695f 6e61 6d65 3d22 6361 6368 6564 220a  i_name="cached".
+00011c20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011c30: 2020 7461 626c 655f 6578 7072 6573 7369    table_expressi
+00011c40: 6f6e 203d 2073 656c 662e 6962 6973 5f63  on = self.ibis_c
+00011c50: 6c69 656e 742e 7461 626c 6528 0a20 2020  lient.table(.   
+00011c60: 2020 2020 2020 2020 2074 6d70 5f74 6162           tmp_tab
+00011c70: 6c65 2e74 6162 6c65 5f69 642c 0a20 2020  le.table_id,.   
+00011c80: 2020 2020 2020 2020 2073 6368 656d 613d           schema=
+00011c90: 746d 705f 7461 626c 652e 6461 7461 7365  tmp_table.datase
+00011ca0: 745f 6964 2c0a 2020 2020 2020 2020 2020  t_id,.          
+00011cb0: 2020 6461 7461 6261 7365 3d74 6d70 5f74    database=tmp_t
+00011cc0: 6162 6c65 2e70 726f 6a65 6374 2c0a 2020  able.project,.  
+00011cd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011ce0: 6e65 775f 636f 6c75 6d6e 7320 3d20 5b74  new_columns = [t
+00011cf0: 6162 6c65 5f65 7870 7265 7373 696f 6e5b  able_expression[
+00011d00: 636f 6c75 6d6e 5d20 666f 7220 636f 6c75  column] for colu
+00011d10: 6d6e 2069 6e20 636f 6d70 696c 6564 5f76  mn in compiled_v
+00011d20: 616c 7565 2e63 6f6c 756d 6e5f 6964 735d  alue.column_ids]
+00011d30: 0a20 2020 2020 2020 206e 6577 5f68 6964  .        new_hid
+00011d40: 6465 6e5f 636f 6c75 6d6e 7320 3d20 5b74  den_columns = [t
+00011d50: 6162 6c65 5f65 7870 7265 7373 696f 6e5b  able_expression[
+00011d60: 2262 6967 6672 616d 6573 5f6f 6666 7365  "bigframes_offse
+00011d70: 7473 225d 5d0a 2020 2020 2020 2020 2320  ts"]].        # 
+00011d80: 544f 444f 3a20 496e 7374 6561 642c 206b  TODO: Instead, k
+00011d90: 6565 7020 7365 7373 696f 6e2d 7769 6465  eep session-wide
+00011da0: 206d 6170 206f 6620 6361 6368 6564 2072   map of cached r
+00011db0: 6573 756c 7473 2061 6e64 2061 7574 6f6d  esults and autom
+00011dc0: 6174 6963 616c 6c79 2072 6575 7365 0a20  atically reuse. 
+00011dd0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00011de0: 7265 2e41 7272 6179 5661 6c75 652e 6672  re.ArrayValue.fr
+00011df0: 6f6d 5f69 6269 7328 0a20 2020 2020 2020  om_ibis(.       
 00011e00: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00011e10: 2020 2061 7272 6179 5f76 616c 7565 3a20     array_value: 
-00011e20: 636f 7265 2e41 7272 6179 5661 6c75 652c  core.ArrayValue,
-00011e30: 0a20 2020 2020 2020 206f 6666 7365 745f  .        offset_
-00011e40: 636f 6c75 6d6e 3a20 7479 7069 6e67 2e4f  column: typing.O
-00011e50: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00011e60: 6f6e 652c 0a20 2020 2020 2020 2063 6f6c  one,.        col
-00011e70: 5f69 645f 6f76 6572 7269 6465 733a 2074  _id_overrides: t
-00011e80: 7970 696e 672e 4d61 7070 696e 675b 7374  yping.Mapping[st
-00011e90: 722c 2073 7472 5d20 3d20 7b7d 2c0a 2020  r, str] = {},.  
-00011ea0: 2020 2020 2020 736f 7274 6564 3a20 626f        sorted: bo
-00011eb0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00011ec0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-00011ed0: 2020 6966 206f 6666 7365 745f 636f 6c75    if offset_colu
-00011ee0: 6d6e 3a0a 2020 2020 2020 2020 2020 2020  mn:.            
-00011ef0: 6172 7261 795f 7661 6c75 6520 3d20 6172  array_value = ar
-00011f00: 7261 795f 7661 6c75 652e 7072 6f6d 6f74  ray_value.promot
-00011f10: 655f 6f66 6673 6574 7328 6f66 6673 6574  e_offsets(offset
-00011f20: 5f63 6f6c 756d 6e29 0a20 2020 2020 2020  _column).       
-00011f30: 2069 6620 736f 7274 6564 3a0a 2020 2020   if sorted:.    
-00011f40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00011f50: 656c 662e 5f63 6f6d 7069 6c65 5f6f 7264  elf._compile_ord
-00011f60: 6572 6564 2861 7272 6179 5f76 616c 7565  ered(array_value
-00011f70: 292e 746f 5f73 716c 280a 2020 2020 2020  ).to_sql(.      
-00011f80: 2020 2020 2020 2020 2020 636f 6c5f 6964            col_id
-00011f90: 5f6f 7665 7272 6964 6573 3d63 6f6c 5f69  _overrides=col_i
-00011fa0: 645f 6f76 6572 7269 6465 732c 2073 6f72  d_overrides, sor
-00011fb0: 7465 643d 5472 7565 0a20 2020 2020 2020  ted=True.       
-00011fc0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-00011fd0: 6574 7572 6e20 7365 6c66 2e5f 636f 6d70  eturn self._comp
-00011fe0: 696c 655f 756e 6f72 6465 7265 6428 6172  ile_unordered(ar
-00011ff0: 7261 795f 7661 6c75 6529 2e74 6f5f 7371  ray_value).to_sq
-00012000: 6c28 0a20 2020 2020 2020 2020 2020 2063  l(.            c
-00012010: 6f6c 5f69 645f 6f76 6572 7269 6465 733d  ol_id_overrides=
-00012020: 636f 6c5f 6964 5f6f 7665 7272 6964 6573  col_id_overrides
-00012030: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00012040: 6465 6620 5f63 6f6d 7069 6c65 5f6f 7264  def _compile_ord
-00012050: 6572 6564 280a 2020 2020 2020 2020 7365  ered(.        se
-00012060: 6c66 2c20 6172 7261 795f 7661 6c75 653a  lf, array_value:
-00012070: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
-00012080: 0a20 2020 2029 202d 3e20 6269 6766 7261  .    ) -> bigfra
-00012090: 6d65 732e 636f 7265 2e63 6f6d 7069 6c65  mes.core.compile
-000120a0: 2e4f 7264 6572 6564 4952 3a0a 2020 2020  .OrderedIR:.    
-000120b0: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-000120c0: 616d 6573 2e63 6f72 652e 636f 6d70 696c  ames.core.compil
-000120d0: 652e 636f 6d70 696c 655f 6f72 6465 7265  e.compile_ordere
-000120e0: 645f 6972 2861 7272 6179 5f76 616c 7565  d_ir(array_value
-000120f0: 2e6e 6f64 6529 0a0a 2020 2020 6465 6620  .node)..    def 
-00012100: 5f63 6f6d 7069 6c65 5f75 6e6f 7264 6572  _compile_unorder
-00012110: 6564 280a 2020 2020 2020 2020 7365 6c66  ed(.        self
-00012120: 2c20 6172 7261 795f 7661 6c75 653a 2063  , array_value: c
-00012130: 6f72 652e 4172 7261 7956 616c 7565 0a20  ore.ArrayValue. 
-00012140: 2020 2029 202d 3e20 6269 6766 7261 6d65     ) -> bigframe
-00012150: 732e 636f 7265 2e63 6f6d 7069 6c65 2e55  s.core.compile.U
-00012160: 6e6f 7264 6572 6564 4952 3a0a 2020 2020  norderedIR:.    
-00012170: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-00012180: 616d 6573 2e63 6f72 652e 636f 6d70 696c  ames.core.compil
-00012190: 652e 636f 6d70 696c 655f 756e 6f72 6465  e.compile_unorde
-000121a0: 7265 645f 6972 2861 7272 6179 5f76 616c  red_ir(array_val
-000121b0: 7565 2e6e 6f64 6529 0a0a 2020 2020 6465  ue.node)..    de
-000121c0: 6620 5f67 6574 5f74 6162 6c65 5f73 697a  f _get_table_siz
-000121d0: 6528 7365 6c66 2c20 6465 7374 696e 6174  e(self, destinat
-000121e0: 696f 6e5f 7461 626c 6529 3a0a 2020 2020  ion_table):.    
-000121f0: 2020 2020 7461 626c 6520 3d20 7365 6c66      table = self
-00012200: 2e62 7163 6c69 656e 742e 6765 745f 7461  .bqclient.get_ta
-00012210: 626c 6528 6465 7374 696e 6174 696f 6e5f  ble(destination_
-00012220: 7461 626c 6529 0a20 2020 2020 2020 2072  table).        r
-00012230: 6574 7572 6e20 7461 626c 652e 6e75 6d5f  eturn table.num_
-00012240: 6279 7465 730a 0a20 2020 2064 6566 205f  bytes..    def _
-00012250: 726f 7773 5f74 6f5f 6461 7461 6672 616d  rows_to_datafram
-00012260: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-00012270: 2072 6f77 5f69 7465 7261 746f 723a 2062   row_iterator: b
-00012280: 6967 7175 6572 792e 7461 626c 652e 526f  igquery.table.Ro
-00012290: 7749 7465 7261 746f 722c 2064 7479 7065  wIterator, dtype
-000122a0: 733a 2044 6963 740a 2020 2020 2920 2d3e  s: Dict.    ) ->
-000122b0: 2070 616e 6461 732e 4461 7461 4672 616d   pandas.DataFram
-000122c0: 653a 0a20 2020 2020 2020 2023 2043 616e  e:.        # Can
-000122d0: 2069 676e 6f72 6520 696e 6665 7272 6564   ignore inferred
-000122e0: 2064 6174 6174 7970 6520 756e 7469 6c20   datatype until 
-000122f0: 6474 7970 6520 656d 756c 6174 696f 6e20  dtype emulation 
-00012300: 6272 6561 6b73 2031 3a31 206d 6170 7069  breaks 1:1 mappi
-00012310: 6e67 2062 6574 7765 656e 2042 5120 7479  ng between BQ ty
-00012320: 7065 7320 616e 6420 6269 6766 7261 6d65  pes and bigframe
-00012330: 7320 7479 7065 730a 2020 2020 2020 2020  s types.        
-00012340: 6474 7970 6573 5f66 726f 6d5f 6271 203d  dtypes_from_bq =
-00012350: 2062 6967 6672 616d 6573 2e64 7479 7065   bigframes.dtype
-00012360: 732e 6266 5f74 7970 655f 6672 6f6d 5f74  s.bf_type_from_t
-00012370: 7970 655f 6b69 6e64 2872 6f77 5f69 7465  ype_kind(row_ite
-00012380: 7261 746f 722e 7363 6865 6d61 290a 2020  rator.schema).  
-00012390: 2020 2020 2020 6172 726f 775f 7461 626c        arrow_tabl
-000123a0: 6520 3d20 726f 775f 6974 6572 6174 6f72  e = row_iterator
-000123b0: 2e74 6f5f 6172 726f 7728 290a 2020 2020  .to_arrow().    
-000123c0: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-000123d0: 616d 6573 2e73 6573 7369 6f6e 2e5f 696f  ames.session._io
-000123e0: 2e70 616e 6461 732e 6172 726f 775f 746f  .pandas.arrow_to
-000123f0: 5f70 616e 6461 7328 6172 726f 775f 7461  _pandas(arrow_ta
-00012400: 626c 652c 2064 7479 7065 735f 6672 6f6d  ble, dtypes_from
-00012410: 5f62 7129 0a0a 2020 2020 6465 6620 5f73  _bq)..    def _s
-00012420: 7461 7274 5f67 656e 6572 6963 5f6a 6f62  tart_generic_job
-00012430: 2873 656c 662c 206a 6f62 3a20 666f 726d  (self, job: form
-00012440: 6174 7469 6e67 5f68 656c 7065 7273 2e47  atting_helpers.G
-00012450: 656e 6572 6963 4a6f 6229 3a0a 2020 2020  enericJob):.    
-00012460: 2020 2020 6966 2062 6967 6672 616d 6573      if bigframes
-00012470: 2e6f 7074 696f 6e73 2e64 6973 706c 6179  .options.display
-00012480: 2e70 726f 6772 6573 735f 6261 7220 6973  .progress_bar is
-00012490: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000124a0: 2020 2020 2020 2066 6f72 6d61 7474 696e         formattin
-000124b0: 675f 6865 6c70 6572 732e 7761 6974 5f66  g_helpers.wait_f
-000124c0: 6f72 5f6a 6f62 280a 2020 2020 2020 2020  or_job(.        
-000124d0: 2020 2020 2020 2020 6a6f 622c 2062 6967          job, big
-000124e0: 6672 616d 6573 2e6f 7074 696f 6e73 2e64  frames.options.d
-000124f0: 6973 706c 6179 2e70 726f 6772 6573 735f  isplay.progress_
-00012500: 6261 720a 2020 2020 2020 2020 2020 2020  bar.            
-00012510: 2920 2023 2057 6169 7420 666f 7220 7468  )  # Wait for th
-00012520: 6520 6a6f 6220 746f 2063 6f6d 706c 6574  e job to complet
-00012530: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-00012540: 2020 2020 2020 2020 2020 2020 6a6f 622e              job.
-00012550: 7265 7375 6c74 2829 0a0a 0a64 6566 2063  result()...def c
-00012560: 6f6e 6e65 6374 2863 6f6e 7465 7874 3a20  onnect(context: 
-00012570: 4f70 7469 6f6e 616c 5b62 6967 7175 6572  Optional[bigquer
-00012580: 795f 6f70 7469 6f6e 732e 4269 6751 7565  y_options.BigQue
-00012590: 7279 4f70 7469 6f6e 735d 203d 204e 6f6e  ryOptions] = Non
-000125a0: 6529 202d 3e20 5365 7373 696f 6e3a 0a20  e) -> Session:. 
-000125b0: 2020 2072 6574 7572 6e20 5365 7373 696f     return Sessio
-000125c0: 6e28 636f 6e74 6578 7429 0a0a 0a64 6566  n(context)...def
-000125d0: 205f 6361 6e5f 636c 7573 7465 725f 6271   _can_cluster_bq
-000125e0: 2866 6965 6c64 3a20 6269 6771 7565 7279  (field: bigquery
-000125f0: 2e53 6368 656d 6146 6965 6c64 293a 0a20  .SchemaField):. 
-00012600: 2020 2023 2068 7474 7073 3a2f 2f63 6c6f     # https://clo
-00012610: 7564 2e67 6f6f 676c 652e 636f 6d2f 6269  ud.google.com/bi
-00012620: 6771 7565 7279 2f64 6f63 732f 636c 7573  gquery/docs/clus
-00012630: 7465 7265 642d 7461 626c 6573 0a20 2020  tered-tables.   
-00012640: 2023 204e 6f74 6162 6c79 2c20 666c 6f61   # Notably, floa
-00012650: 7420 6973 2065 7863 6c75 6465 640a 2020  t is excluded.  
-00012660: 2020 7479 7065 5f20 3d20 6669 656c 642e    type_ = field.
-00012670: 6669 656c 645f 7479 7065 0a20 2020 2072  field_type.    r
-00012680: 6574 7572 6e20 7479 7065 5f20 696e 2028  eturn type_ in (
-00012690: 0a20 2020 2020 2020 2022 494e 5445 4745  .        "INTEGE
-000126a0: 5222 2c0a 2020 2020 2020 2020 2249 4e54  R",.        "INT
-000126b0: 3634 222c 0a20 2020 2020 2020 2022 5354  64",.        "ST
-000126c0: 5249 4e47 222c 0a20 2020 2020 2020 2022  RING",.        "
-000126d0: 4e55 4d45 5249 4322 2c0a 2020 2020 2020  NUMERIC",.      
-000126e0: 2020 2244 4543 494d 414c 222c 0a20 2020    "DECIMAL",.   
-000126f0: 2020 2020 2022 4249 474e 554d 4552 4943       "BIGNUMERIC
-00012700: 222c 0a20 2020 2020 2020 2022 4249 4744  ",.        "BIGD
-00012710: 4543 494d 414c 222c 0a20 2020 2020 2020  ECIMAL",.       
-00012720: 2022 4441 5445 222c 0a20 2020 2020 2020   "DATE",.       
-00012730: 2022 4441 5445 5449 4d45 222c 0a20 2020   "DATETIME",.   
-00012740: 2020 2020 2022 5449 4d45 5354 414d 5022       "TIMESTAMP"
-00012750: 2c0a 2020 2020 2020 2020 2242 4f4f 4c22  ,.        "BOOL"
-00012760: 2c0a 2020 2020 2020 2020 2242 4f4f 4c45  ,.        "BOOLE
-00012770: 414e 222c 0a20 2020 2029 0a0a 0a64 6566  AN",.    )...def
-00012780: 205f 636f 6e76 6572 745f 746f 5f6e 6f6e   _convert_to_non
-00012790: 6e75 6c6c 5f73 7472 696e 6728 636f 6c75  null_string(colu
-000127a0: 6d6e 3a20 6962 6973 5f74 7970 6573 2e43  mn: ibis_types.C
-000127b0: 6f6c 756d 6e29 202d 3e20 6962 6973 5f74  olumn) -> ibis_t
-000127c0: 7970 6573 2e53 7472 696e 6756 616c 7565  ypes.StringValue
-000127d0: 3a0a 2020 2020 636f 6c5f 7479 7065 203d  :.    col_type =
-000127e0: 2063 6f6c 756d 6e2e 7479 7065 2829 0a20   column.type(). 
-000127f0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00012800: 636f 6c5f 7479 7065 2e69 735f 6e75 6d65  col_type.is_nume
-00012810: 7269 6328 290a 2020 2020 2020 2020 6f72  ric().        or
-00012820: 2063 6f6c 5f74 7970 652e 6973 5f62 6f6f   col_type.is_boo
-00012830: 6c65 616e 2829 0a20 2020 2020 2020 206f  lean().        o
-00012840: 7220 636f 6c5f 7479 7065 2e69 735f 6269  r col_type.is_bi
-00012850: 6e61 7279 2829 0a20 2020 2020 2020 206f  nary().        o
-00012860: 7220 636f 6c5f 7479 7065 2e69 735f 7465  r col_type.is_te
-00012870: 6d70 6f72 616c 2829 0a20 2020 2029 3a0a  mporal().    ):.
-00012880: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00012890: 2063 6f6c 756d 6e2e 6361 7374 2869 6269   column.cast(ibi
-000128a0: 735f 6474 7970 6573 2e53 7472 696e 6728  s_dtypes.String(
-000128b0: 6e75 6c6c 6162 6c65 3d54 7275 6529 290a  nullable=True)).
-000128c0: 2020 2020 656c 6966 2063 6f6c 5f74 7970      elif col_typ
-000128d0: 652e 6973 5f67 656f 7370 6174 6961 6c28  e.is_geospatial(
-000128e0: 293a 0a20 2020 2020 2020 2072 6573 756c  ):.        resul
-000128f0: 7420 3d20 7479 7069 6e67 2e63 6173 7428  t = typing.cast(
-00012900: 6962 6973 5f74 7970 6573 2e47 656f 5370  ibis_types.GeoSp
-00012910: 6174 6961 6c43 6f6c 756d 6e2c 2063 6f6c  atialColumn, col
-00012920: 756d 6e29 2e61 735f 7465 7874 2829 0a20  umn).as_text(). 
-00012930: 2020 2065 6c69 6620 636f 6c5f 7479 7065     elif col_type
-00012940: 2e69 735f 7374 7269 6e67 2829 3a0a 2020  .is_string():.  
-00012950: 2020 2020 2020 7265 7375 6c74 203d 2063        result = c
-00012960: 6f6c 756d 6e0a 2020 2020 656c 7365 3a0a  olumn.    else:.
-00012970: 2020 2020 2020 2020 2320 544f 5f4a 534f          # TO_JSO
-00012980: 4e5f 5354 5249 4e47 2077 6f72 6b73 2077  N_STRING works w
-00012990: 6974 6820 616c 6c20 6461 7461 2074 7970  ith all data typ
-000129a0: 6573 2c20 6275 7420 6973 6e27 7420 7468  es, but isn't th
-000129b0: 6520 6d6f 7374 2065 6666 6963 6965 6e74  e most efficient
-000129c0: 0a20 2020 2020 2020 2023 204e 6565 6465  .        # Neede
-000129d0: 6420 666f 7220 4a53 4f4e 2c20 5354 5255  d for JSON, STRU
-000129e0: 4354 2061 6e64 2041 5252 4159 2064 6174  CT and ARRAY dat
-000129f0: 6174 7970 6573 0a20 2020 2020 2020 2072  atypes.        r
-00012a00: 6573 756c 7420 3d20 7665 6e64 6f72 6564  esult = vendored
-00012a10: 5f69 6269 735f 6f70 732e 546f 4a73 6f6e  _ibis_ops.ToJson
-00012a20: 5374 7269 6e67 2863 6f6c 756d 6e29 2e74  String(column).t
-00012a30: 6f5f 6578 7072 2829 2020 2320 7479 7065  o_expr()  # type
-00012a40: 3a20 6967 6e6f 7265 0a20 2020 2023 2045  : ignore.    # E
-00012a50: 7363 6170 6520 6261 636b 736c 6173 6865  scape backslashe
-00012a60: 7320 616e 6420 7573 6520 6261 636b 736c  s and use backsl
-00012a70: 6173 6820 6173 2064 656c 696e 6561 746f  ash as delineato
-00012a80: 720a 2020 2020 6573 6361 7065 6420 3d20  r.    escaped = 
-00012a90: 7479 7069 6e67 2e63 6173 7428 6962 6973  typing.cast(ibis
-00012aa0: 5f74 7970 6573 2e53 7472 696e 6743 6f6c  _types.StringCol
-00012ab0: 756d 6e2c 2072 6573 756c 742e 6669 6c6c  umn, result.fill
-00012ac0: 6e61 2822 2229 292e 7265 706c 6163 6528  na("")).replace(
-00012ad0: 225c 5c22 2c20 225c 5c5c 5c22 2920 2023  "\\", "\\\\")  #
-00012ae0: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
-00012af0: 2020 7265 7475 726e 2074 7970 696e 672e    return typing.
-00012b00: 6361 7374 2869 6269 735f 7479 7065 732e  cast(ibis_types.
-00012b10: 5374 7269 6e67 436f 6c75 6d6e 2c20 6962  StringColumn, ib
-00012b20: 6973 2e6c 6974 6572 616c 2822 5c5c 2229  is.literal("\\")
-00012b30: 292e 636f 6e63 6174 2865 7363 6170 6564  ).concat(escaped
-00012b40: 290a 0a0a 6465 6620 5f74 7261 6e73 666f  )...def _transfo
-00012b50: 726d 5f72 6561 645f 6762 715f 636f 6e66  rm_read_gbq_conf
-00012b60: 6967 7572 6174 696f 6e28 636f 6e66 6967  iguration(config
-00012b70: 7572 6174 696f 6e3a 204f 7074 696f 6e61  uration: Optiona
-00012b80: 6c5b 6469 6374 5d29 202d 3e20 6469 6374  l[dict]) -> dict
-00012b90: 3a0a 2020 2020 2222 220a 2020 2020 466f  :.    """.    Fo
-00012ba0: 7220 6261 636b 7761 7264 732d 636f 6d70  r backwards-comp
-00012bb0: 6174 6962 696c 6974 792c 2063 6f6e 7665  atibility, conve
-00012bc0: 7274 2061 6e79 2070 7265 7669 6f75 736c  rt any previousl
-00012bd0: 7920 636c 6965 6e74 2d73 6964 6520 6f6e  y client-side on
-00012be0: 6c79 0a20 2020 2070 6172 616d 6574 6572  ly.    parameter
-00012bf0: 7320 7375 6368 2061 7320 7469 6d65 6f75  s such as timeou
-00012c00: 744d 7320 746f 2074 6865 2070 726f 7065  tMs to the prope
-00012c10: 7274 7920 6e61 6d65 2065 7870 6563 7465  rty name expecte
-00012c20: 6420 6279 2074 6865 2052 4553 5420 4150  d by the REST AP
-00012c30: 492e 0a0a 2020 2020 4d61 6b65 7320 6120  I...    Makes a 
-00012c40: 636f 7079 206f 6620 636f 6e66 6967 7572  copy of configur
-00012c50: 6174 696f 6e20 6966 2063 6861 6e67 6573  ation if changes
-00012c60: 2061 7265 206e 6565 6465 642e 0a20 2020   are needed..   
-00012c70: 2022 2222 0a0a 2020 2020 6966 2063 6f6e   """..    if con
-00012c80: 6669 6775 7261 7469 6f6e 2069 7320 4e6f  figuration is No
-00012c90: 6e65 3a0a 2020 2020 2020 2020 7265 7475  ne:.        retu
-00012ca0: 726e 207b 7d0a 0a20 2020 2074 696d 656f  rn {}..    timeo
-00012cb0: 7574 5f6d 7320 3d20 636f 6e66 6967 7572  ut_ms = configur
-00012cc0: 6174 696f 6e2e 6765 7428 2271 7565 7279  ation.get("query
-00012cd0: 222c 207b 7d29 2e67 6574 2822 7469 6d65  ", {}).get("time
-00012ce0: 6f75 744d 7322 290a 2020 2020 6966 2074  outMs").    if t
-00012cf0: 696d 656f 7574 5f6d 7320 6973 206e 6f74  imeout_ms is not
-00012d00: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
-00012d10: 2054 7261 6e73 666f 726d 2074 696d 656f   Transform timeo
-00012d20: 7574 4d73 2074 6f20 616e 2061 6374 7561  utMs to an actua
-00012d30: 6c20 7365 7276 6572 2d73 6964 6520 636f  l server-side co
-00012d40: 6e66 6967 7572 6174 696f 6e2e 0a20 2020  nfiguration..   
-00012d50: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
-00012d60: 6974 6875 622e 636f 6d2f 676f 6f67 6c65  ithub.com/google
-00012d70: 6170 6973 2f70 7974 686f 6e2d 6269 6771  apis/python-bigq
-00012d80: 7565 7279 2d70 616e 6461 732f 6973 7375  uery-pandas/issu
-00012d90: 6573 2f34 3739 0a20 2020 2020 2020 2063  es/479.        c
-00012da0: 6f6e 6669 6775 7261 7469 6f6e 203d 2063  onfiguration = c
-00012db0: 6f70 792e 6465 6570 636f 7079 2863 6f6e  opy.deepcopy(con
-00012dc0: 6669 6775 7261 7469 6f6e 290a 2020 2020  figuration).    
-00012dd0: 2020 2020 6465 6c20 636f 6e66 6967 7572      del configur
-00012de0: 6174 696f 6e5b 2271 7565 7279 225d 5b22  ation["query"]["
-00012df0: 7469 6d65 6f75 744d 7322 5d0a 2020 2020  timeoutMs"].    
-00012e00: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
-00012e10: 6e5b 226a 6f62 5469 6d65 6f75 744d 7322  n["jobTimeoutMs"
-00012e20: 5d20 3d20 7469 6d65 6f75 745f 6d73 0a0a  ] = timeout_ms..
-00012e30: 2020 2020 7265 7475 726e 2063 6f6e 6669      return confi
-00012e40: 6775 7261 7469 6f6e 0a                   guration.
+00011e10: 2020 2020 2020 2074 6162 6c65 5f65 7870         table_exp
+00011e20: 7265 7373 696f 6e2c 0a20 2020 2020 2020  ression,.       
+00011e30: 2020 2020 2063 6f6c 756d 6e73 3d6e 6577       columns=new
+00011e40: 5f63 6f6c 756d 6e73 2c0a 2020 2020 2020  _columns,.      
+00011e50: 2020 2020 2020 6869 6464 656e 5f6f 7264        hidden_ord
+00011e60: 6572 696e 675f 636f 6c75 6d6e 733d 6e65  ering_columns=ne
+00011e70: 775f 6869 6464 656e 5f63 6f6c 756d 6e73  w_hidden_columns
+00011e80: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
+00011e90: 6465 7269 6e67 3d6f 7264 6572 2e45 7870  dering=order.Exp
+00011ea0: 7265 7373 696f 6e4f 7264 6572 696e 672e  ressionOrdering.
+00011eb0: 6672 6f6d 5f6f 6666 7365 745f 636f 6c28  from_offset_col(
+00011ec0: 2262 6967 6672 616d 6573 5f6f 6666 7365  "bigframes_offse
+00011ed0: 7473 2229 2c0a 2020 2020 2020 2020 290a  ts"),.        ).
+00011ee0: 0a20 2020 2064 6566 205f 7369 6d70 6c69  .    def _simpli
+00011ef0: 6679 5f77 6974 685f 6361 6368 696e 6728  fy_with_caching(
+00011f00: 7365 6c66 2c20 6172 7261 795f 7661 6c75  self, array_valu
+00011f10: 653a 2063 6f72 652e 4172 7261 7956 616c  e: core.ArrayVal
+00011f20: 7565 2920 2d3e 2063 6f72 652e 4172 7261  ue) -> core.Arra
+00011f30: 7956 616c 7565 3a0a 2020 2020 2020 2020  yValue:.        
+00011f40: 2222 2241 7474 656d 7074 7320 746f 2068  """Attempts to h
+00011f50: 616e 646c 6520 7468 6520 636f 6d70 6c65  andle the comple
+00011f60: 7869 7479 2062 7920 6361 6368 696e 6720  xity by caching 
+00011f70: 6475 706c 6963 6174 6564 2073 7562 7472  duplicated subtr
+00011f80: 6565 7320 616e 6420 6272 6561 6b69 6e67  ees and breaking
+00011f90: 2074 6865 2071 7565 7279 2069 6e74 6f20   the query into 
+00011fa0: 7069 6563 6573 2e22 2222 0a20 2020 2020  pieces.""".     
+00011fb0: 2020 2069 6620 6e6f 7420 6269 6766 7261     if not bigfra
+00011fc0: 6d65 732e 6f70 7469 6f6e 732e 636f 6d70  mes.options.comp
+00011fd0: 7574 652e 656e 6162 6c65 5f6d 756c 7469  ute.enable_multi
+00011fe0: 5f71 7565 7279 5f65 7865 6375 7469 6f6e  _query_execution
+00011ff0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012000: 7475 726e 2061 7272 6179 5f76 616c 7565  turn array_value
+00012010: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00012020: 6172 7261 795f 7661 6c75 652e 6e6f 6465  array_value.node
+00012030: 0a20 2020 2020 2020 2069 6620 6e6f 6465  .        if node
+00012040: 2e70 6c61 6e6e 696e 675f 636f 6d70 6c65  .planning_comple
+00012050: 7869 7479 203c 2051 5545 5259 5f43 4f4d  xity < QUERY_COM
+00012060: 504c 4558 4954 595f 4c49 4d49 543a 0a20  PLEXITY_LIMIT:. 
+00012070: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00012080: 6e20 6172 7261 795f 7661 6c75 650a 0a20  n array_value.. 
+00012090: 2020 2020 2020 2066 6f72 205f 2069 6e20         for _ in 
+000120a0: 7261 6e67 6528 4d41 585f 5355 4254 5245  range(MAX_SUBTRE
+000120b0: 455f 4641 4354 4f52 494e 4753 293a 0a20  E_FACTORINGS):. 
+000120c0: 2020 2020 2020 2020 2020 2075 7064 6174             updat
+000120d0: 6564 203d 2073 656c 662e 5f63 6163 6865  ed = self._cache
+000120e0: 5f6d 6f73 745f 636f 6d70 6c65 785f 7375  _most_complex_su
+000120f0: 6274 7265 6528 6e6f 6465 290a 2020 2020  btree(node).    
+00012100: 2020 2020 2020 2020 6966 2075 7064 6174          if updat
+00012110: 6564 2069 7320 4e6f 6e65 3a0a 2020 2020  ed is None:.    
+00012120: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012130: 726e 2063 6f72 652e 4172 7261 7956 616c  rn core.ArrayVal
+00012140: 7565 286e 6f64 6529 0a20 2020 2020 2020  ue(node).       
+00012150: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00012160: 2020 2020 2020 2020 2020 206e 6f64 6520             node 
+00012170: 3d20 7570 6461 7465 640a 0a20 2020 2020  = updated..     
+00012180: 2020 2072 6574 7572 6e20 636f 7265 2e41     return core.A
+00012190: 7272 6179 5661 6c75 6528 6e6f 6465 290a  rrayValue(node).
+000121a0: 0a20 2020 2064 6566 205f 6361 6368 655f  .    def _cache_
+000121b0: 6d6f 7374 5f63 6f6d 706c 6578 5f73 7562  most_complex_sub
+000121c0: 7472 6565 280a 2020 2020 2020 2020 7365  tree(.        se
+000121d0: 6c66 2c20 6e6f 6465 3a20 6e6f 6465 732e  lf, node: nodes.
+000121e0: 4269 6746 7261 6d65 4e6f 6465 0a20 2020  BigFrameNode.   
+000121f0: 2029 202d 3e20 4f70 7469 6f6e 616c 5b6e   ) -> Optional[n
+00012200: 6f64 6573 2e42 6967 4672 616d 654e 6f64  odes.BigFrameNod
+00012210: 655d 3a0a 2020 2020 2020 2020 2320 544f  e]:.        # TO
+00012220: 444f 3a20 4966 2071 7565 7279 2066 6169  DO: If query fai
+00012230: 6c73 2c20 7265 7472 7920 7769 7468 206c  ls, retry with l
+00012240: 6f77 6572 2063 6f6d 706c 6578 6974 7920  ower complexity 
+00012250: 6c69 6d69 740a 2020 2020 2020 2020 7661  limit.        va
+00012260: 6c69 645f 6361 6e64 6964 6174 6573 203d  lid_candidates =
+00012270: 2074 7261 7665 7273 616c 732e 636f 756e   traversals.coun
+00012280: 745f 636f 6d70 6c65 785f 6e6f 6465 7328  t_complex_nodes(
+00012290: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+000122a0: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+000122b0: 696e 5f63 6f6d 706c 6578 6974 793d 2851  in_complexity=(Q
+000122c0: 5545 5259 5f43 4f4d 504c 4558 4954 595f  UERY_COMPLEXITY_
+000122d0: 4c49 4d49 5420 2f20 3530 3029 2c0a 2020  LIMIT / 500),.  
+000122e0: 2020 2020 2020 2020 2020 6d61 785f 636f            max_co
+000122f0: 6d70 6c65 7869 7479 3d51 5545 5259 5f43  mplexity=QUERY_C
+00012300: 4f4d 504c 4558 4954 595f 4c49 4d49 542c  OMPLEXITY_LIMIT,
+00012310: 0a20 2020 2020 2020 2029 2e69 7465 6d73  .        ).items
+00012320: 2829 0a20 2020 2020 2020 2023 2048 6575  ().        # Heu
+00012330: 7269 7374 6963 3a20 7375 6274 7265 655f  ristic: subtree_
+00012340: 636f 6d70 6c65 6978 7479 202a 2028 636f  compleixty * (co
+00012350: 7069 6573 206f 6620 7375 6274 7265 6529  pies of subtree)
+00012360: 5e32 0a20 2020 2020 2020 2062 6573 745f  ^2.        best_
+00012370: 6361 6e64 6964 6174 6520 3d20 6d61 7828  candidate = max(
+00012380: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00012390: 6964 5f63 616e 6469 6461 7465 732c 0a20  id_candidates,. 
+000123a0: 2020 2020 2020 2020 2020 206b 6579 3d6c             key=l
+000123b0: 616d 6264 6120 693a 2069 5b30 5d2e 706c  ambda i: i[0].pl
+000123c0: 616e 6e69 6e67 5f63 6f6d 706c 6578 6974  anning_complexit
+000123d0: 7920 2b20 2869 5b31 5d20 2a2a 2032 292c  y + (i[1] ** 2),
+000123e0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000123f0: 6175 6c74 3d4e 6f6e 652c 0a20 2020 2020  ault=None,.     
+00012400: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
+00012410: 2062 6573 745f 6361 6e64 6964 6174 6520   best_candidate 
+00012420: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00012430: 2020 2020 2023 204e 6f20 676f 6f64 2073       # No good s
+00012440: 7562 7472 6565 7320 746f 2063 6163 6865  ubtrees to cache
+00012450: 2c20 6a75 7374 2072 6574 7572 6e20 6f72  , just return or
+00012460: 6967 696e 616c 2074 7265 650a 2020 2020  iginal tree.    
+00012470: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00012480: 6f6e 650a 0a20 2020 2020 2020 2023 2054  one..        # T
+00012490: 4f44 4f3a 2041 6464 2063 6c75 7374 6572  ODO: Add cluster
+000124a0: 696e 6720 636f 6c75 6d6e 7320 6261 7365  ing columns base
+000124b0: 6420 6f6e 2061 6363 6573 7320 7061 7474  d on access patt
+000124c0: 6572 6e73 0a20 2020 2020 2020 206d 6174  erns.        mat
+000124d0: 6572 6961 6c69 7a65 6420 3d20 7365 6c66  erialized = self
+000124e0: 2e5f 6361 6368 655f 7769 7468 5f63 6c75  ._cache_with_clu
+000124f0: 7374 6572 5f63 6f6c 7328 0a20 2020 2020  ster_cols(.     
+00012500: 2020 2020 2020 2063 6f72 652e 4172 7261         core.Arra
+00012510: 7956 616c 7565 2862 6573 745f 6361 6e64  yValue(best_cand
+00012520: 6964 6174 655b 305d 292c 205b 5d0a 2020  idate[0]), [].  
+00012530: 2020 2020 2020 292e 6e6f 6465 0a0a 2020        ).node..  
+00012540: 2020 2020 2020 7265 7475 726e 2074 7261        return tra
+00012550: 7665 7273 616c 732e 7265 706c 6163 655f  versals.replace_
+00012560: 6e6f 6465 7328 0a20 2020 2020 2020 2020  nodes(.         
+00012570: 2020 206e 6f64 652c 2074 6f5f 7265 706c     node, to_repl
+00012580: 6163 653d 6265 7374 5f63 616e 6469 6461  ace=best_candida
+00012590: 7465 5b30 5d2c 2072 6570 6c61 6365 6d65  te[0], replaceme
+000125a0: 6e65 743d 6d61 7465 7269 616c 697a 6564  net=materialized
+000125b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000125c0: 6465 6620 5f69 735f 7472 6976 6961 6c6c  def _is_triviall
+000125d0: 795f 6578 6563 7574 6162 6c65 2873 656c  y_executable(sel
+000125e0: 662c 2061 7272 6179 5f76 616c 7565 3a20  f, array_value: 
+000125f0: 636f 7265 2e41 7272 6179 5661 6c75 6529  core.ArrayValue)
+00012600: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00012610: 2020 2020 2020 4361 6e20 7468 6520 626c        Can the bl
+00012620: 6f63 6b20 6265 2065 7661 6c75 6174 6564  ock be evaluated
+00012630: 2076 6572 7920 6368 6561 706c 793f 0a20   very cheaply?. 
+00012640: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00012650: 7468 6520 6172 7261 795f 7661 6c75 6520  the array_value 
+00012660: 7072 6f62 6162 6c79 2069 7320 6e6f 7420  probably is not 
+00012670: 776f 7274 6820 6361 6368 696e 672e 0a20  worth caching.. 
+00012680: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00012690: 2020 2023 204f 6e63 6520 7265 7772 6974     # Once rewrit
+000126a0: 696e 6720 6973 2061 7661 696c 6162 6c65  ing is available
+000126b0: 2c20 7769 6c6c 2077 616e 7420 746f 2072  , will want to r
+000126c0: 6577 7269 7465 2062 6566 6f72 650a 2020  ewrite before.  
+000126d0: 2020 2020 2020 2320 6576 616c 7561 7469        # evaluati
+000126e0: 6e67 2065 7865 6375 7469 6f6e 2063 6f73  ng execution cos
+000126f0: 742e 0a20 2020 2020 2020 2072 6574 7572  t..        retur
+00012700: 6e20 7472 6176 6572 7361 6c73 2e69 735f  n traversals.is_
+00012710: 7472 6976 6961 6c6c 795f 6578 6563 7574  trivially_execut
+00012720: 6162 6c65 2861 7272 6179 5f76 616c 7565  able(array_value
+00012730: 2e6e 6f64 6529 0a0a 2020 2020 6465 6620  .node)..    def 
+00012740: 5f65 7865 6375 7465 280a 2020 2020 2020  _execute(.      
+00012750: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00012760: 6172 7261 795f 7661 6c75 653a 2063 6f72  array_value: cor
+00012770: 652e 4172 7261 7956 616c 7565 2c0a 2020  e.ArrayValue,.  
+00012780: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+00012790: 3a20 4f70 7469 6f6e 616c 5b62 6967 7175  : Optional[bigqu
+000127a0: 6572 792e 6a6f 622e 5175 6572 794a 6f62  ery.job.QueryJob
+000127b0: 436f 6e66 6967 5d20 3d20 4e6f 6e65 2c0a  Config] = None,.
+000127c0: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+000127d0: 2020 2073 6f72 7465 643a 2062 6f6f 6c20     sorted: bool 
+000127e0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+000127f0: 6472 795f 7275 6e3d 4661 6c73 652c 0a20  dry_run=False,. 
+00012800: 2020 2020 2020 2063 6f6c 5f69 645f 6f76         col_id_ov
+00012810: 6572 7269 6465 733a 204d 6170 7069 6e67  errides: Mapping
+00012820: 5b73 7472 2c20 7374 725d 203d 207b 7d2c  [str, str] = {},
+00012830: 0a20 2020 2029 202d 3e20 7475 706c 655b  .    ) -> tuple[
+00012840: 6269 6771 7565 7279 2e74 6162 6c65 2e52  bigquery.table.R
+00012850: 6f77 4974 6572 6174 6f72 2c20 6269 6771  owIterator, bigq
+00012860: 7565 7279 2e51 7565 7279 4a6f 625d 3a0a  uery.QueryJob]:.
+00012870: 2020 2020 2020 2020 7371 6c20 3d20 7365          sql = se
+00012880: 6c66 2e5f 746f 5f73 716c 280a 2020 2020  lf._to_sql(.    
+00012890: 2020 2020 2020 2020 6172 7261 795f 7661          array_va
+000128a0: 6c75 652c 2073 6f72 7465 643d 736f 7274  lue, sorted=sort
+000128b0: 6564 2c20 636f 6c5f 6964 5f6f 7665 7272  ed, col_id_overr
+000128c0: 6964 6573 3d63 6f6c 5f69 645f 6f76 6572  ides=col_id_over
+000128d0: 7269 6465 730a 2020 2020 2020 2020 2920  rides.        ) 
+000128e0: 2023 2074 7970 653a 6967 6e6f 7265 0a20   # type:ignore. 
+000128f0: 2020 2020 2020 2069 6620 6a6f 625f 636f         if job_co
+00012900: 6e66 6967 2069 7320 4e6f 6e65 3a0a 2020  nfig is None:.  
+00012910: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+00012920: 6e66 6967 203d 2062 6967 7175 6572 792e  nfig = bigquery.
+00012930: 5175 6572 794a 6f62 436f 6e66 6967 2864  QueryJobConfig(d
+00012940: 7279 5f72 756e 3d64 7279 5f72 756e 290a  ry_run=dry_run).
+00012950: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00012960: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+00012970: 6e66 6967 2e64 7279 5f72 756e 203d 2064  nfig.dry_run = d
+00012980: 7279 5f72 756e 0a20 2020 2020 2020 2072  ry_run.        r
+00012990: 6574 7572 6e20 7365 6c66 2e5f 7374 6172  eturn self._star
+000129a0: 745f 7175 6572 7928 0a20 2020 2020 2020  t_query(.       
+000129b0: 2020 2020 2073 716c 3d73 716c 2c0a 2020       sql=sql,.  
+000129c0: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+000129d0: 6e66 6967 3d6a 6f62 5f63 6f6e 6669 672c  nfig=job_config,
+000129e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000129f0: 6465 6620 5f70 6565 6b28 0a20 2020 2020  def _peek(.     
+00012a00: 2020 2073 656c 662c 2061 7272 6179 5f76     self, array_v
+00012a10: 616c 7565 3a20 636f 7265 2e41 7272 6179  alue: core.Array
+00012a20: 5661 6c75 652c 206e 5f72 6f77 733a 2069  Value, n_rows: i
+00012a30: 6e74 0a20 2020 2029 202d 3e20 7475 706c  nt.    ) -> tupl
+00012a40: 655b 6269 6771 7565 7279 2e74 6162 6c65  e[bigquery.table
+00012a50: 2e52 6f77 4974 6572 6174 6f72 2c20 6269  .RowIterator, bi
+00012a60: 6771 7565 7279 2e51 7565 7279 4a6f 625d  gquery.QueryJob]
+00012a70: 3a0a 2020 2020 2020 2020 2222 2241 2027  :.        """A '
+00012a80: 7065 656b 2720 6566 6669 6369 656e 746c  peek' efficientl
+00012a90: 7920 6163 6365 7373 6573 2061 2073 6d61  y accesses a sma
+00012aa0: 6c6c 206e 756d 6265 7220 6f66 2072 6f77  ll number of row
+00012ab0: 7320 696e 2074 6865 2064 6174 6166 7261  s in the datafra
+00012ac0: 6d65 2e22 2222 0a20 2020 2020 2020 2069  me.""".        i
+00012ad0: 6620 6e6f 7420 7472 6565 5f70 726f 7065  f not tree_prope
+00012ae0: 7274 6965 732e 7065 656b 6162 6c65 2861  rties.peekable(a
+00012af0: 7272 6179 5f76 616c 7565 2e6e 6f64 6529  rray_value.node)
+00012b00: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+00012b10: 726e 696e 6773 2e77 6172 6e28 2250 6565  rnings.warn("Pee
+00012b20: 6b69 6e67 2074 6869 7320 7661 6c75 6520  king this value 
+00012b30: 6361 6e6e 6f74 2062 6520 646f 6e65 2065  cannot be done e
+00012b40: 6666 6963 6965 6e74 6c79 2e22 290a 2020  fficiently.").  
+00012b50: 2020 2020 2020 7371 6c20 3d20 7365 6c66        sql = self
+00012b60: 2e5f 636f 6d70 696c 655f 756e 6f72 6465  ._compile_unorde
+00012b70: 7265 6428 6172 7261 795f 7661 6c75 6529  red(array_value)
+00012b80: 2e70 6565 6b5f 7371 6c28 6e5f 726f 7773  .peek_sql(n_rows
+00012b90: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00012ba0: 2073 656c 662e 5f73 7461 7274 5f71 7565   self._start_que
+00012bb0: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
+00012bc0: 7371 6c3d 7371 6c2c 0a20 2020 2020 2020  sql=sql,.       
+00012bd0: 2029 0a0a 2020 2020 6465 6620 5f74 6f5f   )..    def _to_
+00012be0: 7371 6c28 0a20 2020 2020 2020 2073 656c  sql(.        sel
+00012bf0: 662c 0a20 2020 2020 2020 2061 7272 6179  f,.        array
+00012c00: 5f76 616c 7565 3a20 636f 7265 2e41 7272  _value: core.Arr
+00012c10: 6179 5661 6c75 652c 0a20 2020 2020 2020  ayValue,.       
+00012c20: 206f 6666 7365 745f 636f 6c75 6d6e 3a20   offset_column: 
+00012c30: 7479 7069 6e67 2e4f 7074 696f 6e61 6c5b  typing.Optional[
+00012c40: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00012c50: 2020 2020 2063 6f6c 5f69 645f 6f76 6572       col_id_over
+00012c60: 7269 6465 733a 2074 7970 696e 672e 4d61  rides: typing.Ma
+00012c70: 7070 696e 675b 7374 722c 2073 7472 5d20  pping[str, str] 
+00012c80: 3d20 7b7d 2c0a 2020 2020 2020 2020 736f  = {},.        so
+00012c90: 7274 6564 3a20 626f 6f6c 203d 2046 616c  rted: bool = Fal
+00012ca0: 7365 2c0a 2020 2020 2920 2d3e 2073 7472  se,.    ) -> str
+00012cb0: 3a0a 2020 2020 2020 2020 6966 206f 6666  :.        if off
+00012cc0: 7365 745f 636f 6c75 6d6e 3a0a 2020 2020  set_column:.    
+00012cd0: 2020 2020 2020 2020 6172 7261 795f 7661          array_va
+00012ce0: 6c75 6520 3d20 6172 7261 795f 7661 6c75  lue = array_valu
+00012cf0: 652e 7072 6f6d 6f74 655f 6f66 6673 6574  e.promote_offset
+00012d00: 7328 6f66 6673 6574 5f63 6f6c 756d 6e29  s(offset_column)
+00012d10: 0a20 2020 2020 2020 2069 6620 736f 7274  .        if sort
+00012d20: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00012d30: 7265 7475 726e 2073 656c 662e 5f63 6f6d  return self._com
+00012d40: 7069 6c65 5f6f 7264 6572 6564 2861 7272  pile_ordered(arr
+00012d50: 6179 5f76 616c 7565 292e 746f 5f73 716c  ay_value).to_sql
+00012d60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00012d70: 2020 636f 6c5f 6964 5f6f 7665 7272 6964    col_id_overrid
+00012d80: 6573 3d63 6f6c 5f69 645f 6f76 6572 7269  es=col_id_overri
+00012d90: 6465 732c 2073 6f72 7465 643d 5472 7565  des, sorted=True
+00012da0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00012db0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00012dc0: 6c66 2e5f 636f 6d70 696c 655f 756e 6f72  lf._compile_unor
+00012dd0: 6465 7265 6428 6172 7261 795f 7661 6c75  dered(array_valu
+00012de0: 6529 2e74 6f5f 7371 6c28 0a20 2020 2020  e).to_sql(.     
+00012df0: 2020 2020 2020 2063 6f6c 5f69 645f 6f76         col_id_ov
+00012e00: 6572 7269 6465 733d 636f 6c5f 6964 5f6f  errides=col_id_o
+00012e10: 7665 7272 6964 6573 0a20 2020 2020 2020  verrides.       
+00012e20: 2029 0a0a 2020 2020 6465 6620 5f63 6f6d   )..    def _com
+00012e30: 7069 6c65 5f6f 7264 6572 6564 280a 2020  pile_ordered(.  
+00012e40: 2020 2020 2020 7365 6c66 2c20 6172 7261        self, arra
+00012e50: 795f 7661 6c75 653a 2063 6f72 652e 4172  y_value: core.Ar
+00012e60: 7261 7956 616c 7565 0a20 2020 2029 202d  rayValue.    ) -
+00012e70: 3e20 6269 6766 7261 6d65 732e 636f 7265  > bigframes.core
+00012e80: 2e63 6f6d 7069 6c65 2e4f 7264 6572 6564  .compile.Ordered
+00012e90: 4952 3a0a 2020 2020 2020 2020 7265 7475  IR:.        retu
+00012ea0: 726e 2062 6967 6672 616d 6573 2e63 6f72  rn bigframes.cor
+00012eb0: 652e 636f 6d70 696c 652e 636f 6d70 696c  e.compile.compil
+00012ec0: 655f 6f72 6465 7265 645f 6972 2861 7272  e_ordered_ir(arr
+00012ed0: 6179 5f76 616c 7565 2e6e 6f64 6529 0a0a  ay_value.node)..
+00012ee0: 2020 2020 6465 6620 5f63 6f6d 7069 6c65      def _compile
+00012ef0: 5f75 6e6f 7264 6572 6564 280a 2020 2020  _unordered(.    
+00012f00: 2020 2020 7365 6c66 2c20 6172 7261 795f      self, array_
+00012f10: 7661 6c75 653a 2063 6f72 652e 4172 7261  value: core.Arra
+00012f20: 7956 616c 7565 0a20 2020 2029 202d 3e20  yValue.    ) -> 
+00012f30: 6269 6766 7261 6d65 732e 636f 7265 2e63  bigframes.core.c
+00012f40: 6f6d 7069 6c65 2e55 6e6f 7264 6572 6564  ompile.Unordered
+00012f50: 4952 3a0a 2020 2020 2020 2020 7265 7475  IR:.        retu
+00012f60: 726e 2062 6967 6672 616d 6573 2e63 6f72  rn bigframes.cor
+00012f70: 652e 636f 6d70 696c 652e 636f 6d70 696c  e.compile.compil
+00012f80: 655f 756e 6f72 6465 7265 645f 6972 2861  e_unordered_ir(a
+00012f90: 7272 6179 5f76 616c 7565 2e6e 6f64 6529  rray_value.node)
+00012fa0: 0a0a 2020 2020 6465 6620 5f67 6574 5f74  ..    def _get_t
+00012fb0: 6162 6c65 5f73 697a 6528 7365 6c66 2c20  able_size(self, 
+00012fc0: 6465 7374 696e 6174 696f 6e5f 7461 626c  destination_tabl
+00012fd0: 6529 3a0a 2020 2020 2020 2020 7461 626c  e):.        tabl
+00012fe0: 6520 3d20 7365 6c66 2e62 7163 6c69 656e  e = self.bqclien
+00012ff0: 742e 6765 745f 7461 626c 6528 6465 7374  t.get_table(dest
+00013000: 696e 6174 696f 6e5f 7461 626c 6529 0a20  ination_table). 
+00013010: 2020 2020 2020 2072 6574 7572 6e20 7461         return ta
+00013020: 626c 652e 6e75 6d5f 6279 7465 730a 0a20  ble.num_bytes.. 
+00013030: 2020 2064 6566 205f 726f 7773 5f74 6f5f     def _rows_to_
+00013040: 6461 7461 6672 616d 6528 0a20 2020 2020  dataframe(.     
+00013050: 2020 2073 656c 662c 2072 6f77 5f69 7465     self, row_ite
+00013060: 7261 746f 723a 2062 6967 7175 6572 792e  rator: bigquery.
+00013070: 7461 626c 652e 526f 7749 7465 7261 746f  table.RowIterato
+00013080: 722c 2064 7479 7065 733a 2044 6963 740a  r, dtypes: Dict.
+00013090: 2020 2020 2920 2d3e 2070 616e 6461 732e      ) -> pandas.
+000130a0: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
+000130b0: 2020 2023 2043 616e 2069 676e 6f72 6520     # Can ignore 
+000130c0: 696e 6665 7272 6564 2064 6174 6174 7970  inferred datatyp
+000130d0: 6520 756e 7469 6c20 6474 7970 6520 656d  e until dtype em
+000130e0: 756c 6174 696f 6e20 6272 6561 6b73 2031  ulation breaks 1
+000130f0: 3a31 206d 6170 7069 6e67 2062 6574 7765  :1 mapping betwe
+00013100: 656e 2042 5120 7479 7065 7320 616e 6420  en BQ types and 
+00013110: 6269 6766 7261 6d65 7320 7479 7065 730a  bigframes types.
+00013120: 2020 2020 2020 2020 6474 7970 6573 5f66          dtypes_f
+00013130: 726f 6d5f 6271 203d 2062 6967 6672 616d  rom_bq = bigfram
+00013140: 6573 2e64 7479 7065 732e 6266 5f74 7970  es.dtypes.bf_typ
+00013150: 655f 6672 6f6d 5f74 7970 655f 6b69 6e64  e_from_type_kind
+00013160: 2872 6f77 5f69 7465 7261 746f 722e 7363  (row_iterator.sc
+00013170: 6865 6d61 290a 2020 2020 2020 2020 6172  hema).        ar
+00013180: 726f 775f 7461 626c 6520 3d20 726f 775f  row_table = row_
+00013190: 6974 6572 6174 6f72 2e74 6f5f 6172 726f  iterator.to_arro
+000131a0: 7728 290a 2020 2020 2020 2020 7265 7475  w().        retu
+000131b0: 726e 2062 6967 6672 616d 6573 2e73 6573  rn bigframes.ses
+000131c0: 7369 6f6e 2e5f 696f 2e70 616e 6461 732e  sion._io.pandas.
+000131d0: 6172 726f 775f 746f 5f70 616e 6461 7328  arrow_to_pandas(
+000131e0: 6172 726f 775f 7461 626c 652c 2064 7479  arrow_table, dty
+000131f0: 7065 735f 6672 6f6d 5f62 7129 0a0a 2020  pes_from_bq)..  
+00013200: 2020 6465 6620 5f73 7461 7274 5f67 656e    def _start_gen
+00013210: 6572 6963 5f6a 6f62 2873 656c 662c 206a  eric_job(self, j
+00013220: 6f62 3a20 666f 726d 6174 7469 6e67 5f68  ob: formatting_h
+00013230: 656c 7065 7273 2e47 656e 6572 6963 4a6f  elpers.GenericJo
+00013240: 6229 3a0a 2020 2020 2020 2020 6966 2062  b):.        if b
+00013250: 6967 6672 616d 6573 2e6f 7074 696f 6e73  igframes.options
+00013260: 2e64 6973 706c 6179 2e70 726f 6772 6573  .display.progres
+00013270: 735f 6261 7220 6973 206e 6f74 204e 6f6e  s_bar is not Non
+00013280: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+00013290: 6f72 6d61 7474 696e 675f 6865 6c70 6572  ormatting_helper
+000132a0: 732e 7761 6974 5f66 6f72 5f6a 6f62 280a  s.wait_for_job(.
+000132b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132c0: 6a6f 622c 2062 6967 6672 616d 6573 2e6f  job, bigframes.o
+000132d0: 7074 696f 6e73 2e64 6973 706c 6179 2e70  ptions.display.p
+000132e0: 726f 6772 6573 735f 6261 720a 2020 2020  rogress_bar.    
+000132f0: 2020 2020 2020 2020 2920 2023 2057 6169          )  # Wai
+00013300: 7420 666f 7220 7468 6520 6a6f 6220 746f  t for the job to
+00013310: 2063 6f6d 706c 6574 650a 2020 2020 2020   complete.      
+00013320: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013330: 2020 2020 6a6f 622e 7265 7375 6c74 2829      job.result()
+00013340: 0a0a 0a64 6566 2063 6f6e 6e65 6374 2863  ...def connect(c
+00013350: 6f6e 7465 7874 3a20 4f70 7469 6f6e 616c  ontext: Optional
+00013360: 5b62 6967 7175 6572 795f 6f70 7469 6f6e  [bigquery_option
+00013370: 732e 4269 6751 7565 7279 4f70 7469 6f6e  s.BigQueryOption
+00013380: 735d 203d 204e 6f6e 6529 202d 3e20 5365  s] = None) -> Se
+00013390: 7373 696f 6e3a 0a20 2020 2072 6574 7572  ssion:.    retur
+000133a0: 6e20 5365 7373 696f 6e28 636f 6e74 6578  n Session(contex
+000133b0: 7429 0a0a 0a64 6566 205f 6361 6e5f 636c  t)...def _can_cl
+000133c0: 7573 7465 725f 6271 2866 6965 6c64 3a20  uster_bq(field: 
+000133d0: 6269 6771 7565 7279 2e53 6368 656d 6146  bigquery.SchemaF
+000133e0: 6965 6c64 293a 0a20 2020 2023 2068 7474  ield):.    # htt
+000133f0: 7073 3a2f 2f63 6c6f 7564 2e67 6f6f 676c  ps://cloud.googl
+00013400: 652e 636f 6d2f 6269 6771 7565 7279 2f64  e.com/bigquery/d
+00013410: 6f63 732f 636c 7573 7465 7265 642d 7461  ocs/clustered-ta
+00013420: 626c 6573 0a20 2020 2023 204e 6f74 6162  bles.    # Notab
+00013430: 6c79 2c20 666c 6f61 7420 6973 2065 7863  ly, float is exc
+00013440: 6c75 6465 640a 2020 2020 7479 7065 5f20  luded.    type_ 
+00013450: 3d20 6669 656c 642e 6669 656c 645f 7479  = field.field_ty
+00013460: 7065 0a20 2020 2072 6574 7572 6e20 7479  pe.    return ty
+00013470: 7065 5f20 696e 2028 0a20 2020 2020 2020  pe_ in (.       
+00013480: 2022 494e 5445 4745 5222 2c0a 2020 2020   "INTEGER",.    
+00013490: 2020 2020 2249 4e54 3634 222c 0a20 2020      "INT64",.   
+000134a0: 2020 2020 2022 5354 5249 4e47 222c 0a20       "STRING",. 
+000134b0: 2020 2020 2020 2022 4e55 4d45 5249 4322         "NUMERIC"
+000134c0: 2c0a 2020 2020 2020 2020 2244 4543 494d  ,.        "DECIM
+000134d0: 414c 222c 0a20 2020 2020 2020 2022 4249  AL",.        "BI
+000134e0: 474e 554d 4552 4943 222c 0a20 2020 2020  GNUMERIC",.     
+000134f0: 2020 2022 4249 4744 4543 494d 414c 222c     "BIGDECIMAL",
+00013500: 0a20 2020 2020 2020 2022 4441 5445 222c  .        "DATE",
+00013510: 0a20 2020 2020 2020 2022 4441 5445 5449  .        "DATETI
+00013520: 4d45 222c 0a20 2020 2020 2020 2022 5449  ME",.        "TI
+00013530: 4d45 5354 414d 5022 2c0a 2020 2020 2020  MESTAMP",.      
+00013540: 2020 2242 4f4f 4c22 2c0a 2020 2020 2020    "BOOL",.      
+00013550: 2020 2242 4f4f 4c45 414e 222c 0a20 2020    "BOOLEAN",.   
+00013560: 2029 0a0a 0a64 6566 205f 636f 6e76 6572   )...def _conver
+00013570: 745f 746f 5f6e 6f6e 6e75 6c6c 5f73 7472  t_to_nonnull_str
+00013580: 696e 6728 636f 6c75 6d6e 3a20 6962 6973  ing(column: ibis
+00013590: 5f74 7970 6573 2e43 6f6c 756d 6e29 202d  _types.Column) -
+000135a0: 3e20 6962 6973 5f74 7970 6573 2e53 7472  > ibis_types.Str
+000135b0: 696e 6756 616c 7565 3a0a 2020 2020 636f  ingValue:.    co
+000135c0: 6c5f 7479 7065 203d 2063 6f6c 756d 6e2e  l_type = column.
+000135d0: 7479 7065 2829 0a20 2020 2069 6620 280a  type().    if (.
+000135e0: 2020 2020 2020 2020 636f 6c5f 7479 7065          col_type
+000135f0: 2e69 735f 6e75 6d65 7269 6328 290a 2020  .is_numeric().  
+00013600: 2020 2020 2020 6f72 2063 6f6c 5f74 7970        or col_typ
+00013610: 652e 6973 5f62 6f6f 6c65 616e 2829 0a20  e.is_boolean(). 
+00013620: 2020 2020 2020 206f 7220 636f 6c5f 7479         or col_ty
+00013630: 7065 2e69 735f 6269 6e61 7279 2829 0a20  pe.is_binary(). 
+00013640: 2020 2020 2020 206f 7220 636f 6c5f 7479         or col_ty
+00013650: 7065 2e69 735f 7465 6d70 6f72 616c 2829  pe.is_temporal()
+00013660: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+00013670: 7265 7375 6c74 203d 2063 6f6c 756d 6e2e  result = column.
+00013680: 6361 7374 2869 6269 735f 6474 7970 6573  cast(ibis_dtypes
+00013690: 2e53 7472 696e 6728 6e75 6c6c 6162 6c65  .String(nullable
+000136a0: 3d54 7275 6529 290a 2020 2020 656c 6966  =True)).    elif
+000136b0: 2063 6f6c 5f74 7970 652e 6973 5f67 656f   col_type.is_geo
+000136c0: 7370 6174 6961 6c28 293a 0a20 2020 2020  spatial():.     
+000136d0: 2020 2072 6573 756c 7420 3d20 7479 7069     result = typi
+000136e0: 6e67 2e63 6173 7428 6962 6973 5f74 7970  ng.cast(ibis_typ
+000136f0: 6573 2e47 656f 5370 6174 6961 6c43 6f6c  es.GeoSpatialCol
+00013700: 756d 6e2c 2063 6f6c 756d 6e29 2e61 735f  umn, column).as_
+00013710: 7465 7874 2829 0a20 2020 2065 6c69 6620  text().    elif 
+00013720: 636f 6c5f 7479 7065 2e69 735f 7374 7269  col_type.is_stri
+00013730: 6e67 2829 3a0a 2020 2020 2020 2020 7265  ng():.        re
+00013740: 7375 6c74 203d 2063 6f6c 756d 6e0a 2020  sult = column.  
+00013750: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013760: 2320 544f 5f4a 534f 4e5f 5354 5249 4e47  # TO_JSON_STRING
+00013770: 2077 6f72 6b73 2077 6974 6820 616c 6c20   works with all 
+00013780: 6461 7461 2074 7970 6573 2c20 6275 7420  data types, but 
+00013790: 6973 6e27 7420 7468 6520 6d6f 7374 2065  isn't the most e
+000137a0: 6666 6963 6965 6e74 0a20 2020 2020 2020  fficient.       
+000137b0: 2023 204e 6565 6465 6420 666f 7220 4a53   # Needed for JS
+000137c0: 4f4e 2c20 5354 5255 4354 2061 6e64 2041  ON, STRUCT and A
+000137d0: 5252 4159 2064 6174 6174 7970 6573 0a20  RRAY datatypes. 
+000137e0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+000137f0: 7665 6e64 6f72 6564 5f69 6269 735f 6f70  vendored_ibis_op
+00013800: 732e 546f 4a73 6f6e 5374 7269 6e67 2863  s.ToJsonString(c
+00013810: 6f6c 756d 6e29 2e74 6f5f 6578 7072 2829  olumn).to_expr()
+00013820: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
+00013830: 0a20 2020 2023 2045 7363 6170 6520 6261  .    # Escape ba
+00013840: 636b 736c 6173 6865 7320 616e 6420 7573  ckslashes and us
+00013850: 6520 6261 636b 736c 6173 6820 6173 2064  e backslash as d
+00013860: 656c 696e 6561 746f 720a 2020 2020 6573  elineator.    es
+00013870: 6361 7065 6420 3d20 7479 7069 6e67 2e63  caped = typing.c
+00013880: 6173 7428 6962 6973 5f74 7970 6573 2e53  ast(ibis_types.S
+00013890: 7472 696e 6743 6f6c 756d 6e2c 2072 6573  tringColumn, res
+000138a0: 756c 742e 6669 6c6c 6e61 2822 2229 292e  ult.fillna("")).
+000138b0: 7265 706c 6163 6528 225c 5c22 2c20 225c  replace("\\", "\
+000138c0: 5c5c 5c22 2920 2023 2074 7970 653a 2069  \\\")  # type: i
+000138d0: 676e 6f72 650a 2020 2020 7265 7475 726e  gnore.    return
+000138e0: 2074 7970 696e 672e 6361 7374 2869 6269   typing.cast(ibi
+000138f0: 735f 7479 7065 732e 5374 7269 6e67 436f  s_types.StringCo
+00013900: 6c75 6d6e 2c20 6962 6973 2e6c 6974 6572  lumn, ibis.liter
+00013910: 616c 2822 5c5c 2229 292e 636f 6e63 6174  al("\\")).concat
+00013920: 2865 7363 6170 6564 290a 0a0a 6465 6620  (escaped)...def 
+00013930: 5f74 7261 6e73 666f 726d 5f72 6561 645f  _transform_read_
+00013940: 6762 715f 636f 6e66 6967 7572 6174 696f  gbq_configuratio
+00013950: 6e28 636f 6e66 6967 7572 6174 696f 6e3a  n(configuration:
+00013960: 204f 7074 696f 6e61 6c5b 6469 6374 5d29   Optional[dict])
+00013970: 202d 3e20 6469 6374 3a0a 2020 2020 2222   -> dict:.    ""
+00013980: 220a 2020 2020 466f 7220 6261 636b 7761  ".    For backwa
+00013990: 7264 732d 636f 6d70 6174 6962 696c 6974  rds-compatibilit
+000139a0: 792c 2063 6f6e 7665 7274 2061 6e79 2070  y, convert any p
+000139b0: 7265 7669 6f75 736c 7920 636c 6965 6e74  reviously client
+000139c0: 2d73 6964 6520 6f6e 6c79 0a20 2020 2070  -side only.    p
+000139d0: 6172 616d 6574 6572 7320 7375 6368 2061  arameters such a
+000139e0: 7320 7469 6d65 6f75 744d 7320 746f 2074  s timeoutMs to t
+000139f0: 6865 2070 726f 7065 7274 7920 6e61 6d65  he property name
+00013a00: 2065 7870 6563 7465 6420 6279 2074 6865   expected by the
+00013a10: 2052 4553 5420 4150 492e 0a0a 2020 2020   REST API...    
+00013a20: 4d61 6b65 7320 6120 636f 7079 206f 6620  Makes a copy of 
+00013a30: 636f 6e66 6967 7572 6174 696f 6e20 6966  configuration if
+00013a40: 2063 6861 6e67 6573 2061 7265 206e 6565   changes are nee
+00013a50: 6465 642e 0a20 2020 2022 2222 0a0a 2020  ded..    """..  
+00013a60: 2020 6966 2063 6f6e 6669 6775 7261 7469    if configurati
+00013a70: 6f6e 2069 7320 4e6f 6e65 3a0a 2020 2020  on is None:.    
+00013a80: 2020 2020 7265 7475 726e 207b 7d0a 0a20      return {}.. 
+00013a90: 2020 2074 696d 656f 7574 5f6d 7320 3d20     timeout_ms = 
+00013aa0: 636f 6e66 6967 7572 6174 696f 6e2e 6765  configuration.ge
+00013ab0: 7428 2271 7565 7279 222c 207b 7d29 2e67  t("query", {}).g
+00013ac0: 6574 2822 7469 6d65 6f75 744d 7322 290a  et("timeoutMs").
+00013ad0: 2020 2020 6966 2074 696d 656f 7574 5f6d      if timeout_m
+00013ae0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00013af0: 2020 2020 2020 2023 2054 7261 6e73 666f         # Transfo
+00013b00: 726d 2074 696d 656f 7574 4d73 2074 6f20  rm timeoutMs to 
+00013b10: 616e 2061 6374 7561 6c20 7365 7276 6572  an actual server
+00013b20: 2d73 6964 6520 636f 6e66 6967 7572 6174  -side configurat
+00013b30: 696f 6e2e 0a20 2020 2020 2020 2023 2068  ion..        # h
+00013b40: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+00013b50: 6d2f 676f 6f67 6c65 6170 6973 2f70 7974  m/googleapis/pyt
+00013b60: 686f 6e2d 6269 6771 7565 7279 2d70 616e  hon-bigquery-pan
+00013b70: 6461 732f 6973 7375 6573 2f34 3739 0a20  das/issues/479. 
+00013b80: 2020 2020 2020 2063 6f6e 6669 6775 7261         configura
+00013b90: 7469 6f6e 203d 2063 6f70 792e 6465 6570  tion = copy.deep
+00013ba0: 636f 7079 2863 6f6e 6669 6775 7261 7469  copy(configurati
+00013bb0: 6f6e 290a 2020 2020 2020 2020 6465 6c20  on).        del 
+00013bc0: 636f 6e66 6967 7572 6174 696f 6e5b 2271  configuration["q
+00013bd0: 7565 7279 225d 5b22 7469 6d65 6f75 744d  uery"]["timeoutM
+00013be0: 7322 5d0a 2020 2020 2020 2020 636f 6e66  s"].        conf
+00013bf0: 6967 7572 6174 696f 6e5b 226a 6f62 5469  iguration["jobTi
+00013c00: 6d65 6f75 744d 7322 5d20 3d20 7469 6d65  meoutMs"] = time
+00013c10: 6f75 745f 6d73 0a0a 2020 2020 7265 7475  out_ms..    retu
+00013c20: 726e 2063 6f6e 6669 6775 7261 7469 6f6e  rn configuration
+00013c30: 0a                                       .
```

### Comparing `bigframes-1.0.0/bigframes/session/_io/__init__.py` & `bigframes-1.1.0/bigframes/session/_io/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/session/_io/bigquery.py` & `bigframes-1.1.0/bigframes/session/_io/bigquery.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/session/_io/pandas.py` & `bigframes-1.1.0/bigframes/session/_io/pandas.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/bigframes/session/clients.py` & `bigframes-1.1.0/bigframes/session/clients.py`

 * *Files 2% similar despite different names*

```diff
@@ -65,20 +65,20 @@
 
 
 class ClientsProvider:
     """Provides client instances necessary to perform cloud operations."""
 
     def __init__(
         self,
-        project: Optional[str],
-        location: Optional[str],
-        use_regional_endpoints: Optional[bool],
-        credentials: Optional[google.auth.credentials.Credentials],
-        application_name: Optional[str],
-        bq_kms_key_name: Optional[str],
+        project: Optional[str] = None,
+        location: Optional[str] = None,
+        use_regional_endpoints: Optional[bool] = None,
+        credentials: Optional[google.auth.credentials.Credentials] = None,
+        application_name: Optional[str] = None,
+        bq_kms_key_name: Optional[str] = None,
     ):
         credentials_project = None
         if credentials is None:
             credentials, credentials_project = _get_default_credentials_with_project()
 
         # Prefer the project in this order:
         # 1. Project explicitly specified by the user
```

### Comparing `bigframes-1.0.0/bigframes/version.py` & `bigframes-1.1.0/bigframes/version.py`

 * *Files 1% similar despite different names*

```diff
@@ -8,8 +8,8 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-__version__ = "1.0.0"
+__version__ = "1.1.0"
```

### Comparing `bigframes-1.0.0/bigframes.egg-info/SOURCES.txt` & `bigframes-1.1.0/bigframes.egg-info/SOURCES.txt`

 * *Files 11% similar despite different names*

```diff
@@ -9,14 +9,15 @@
 bigframes/constants.py
 bigframes/dataframe.py
 bigframes/dtypes.py
 bigframes/features.py
 bigframes/formatting_helpers.py
 bigframes/py.typed
 bigframes/series.py
+bigframes/typing.py
 bigframes/version.py
 bigframes.egg-info/PKG-INFO
 bigframes.egg-info/SOURCES.txt
 bigframes.egg-info/dependency_links.txt
 bigframes.egg-info/not-zip-safe
 bigframes.egg-info/requires.txt
 bigframes.egg-info/top_level.txt
@@ -24,39 +25,41 @@
 bigframes/_config/bigquery_options.py
 bigframes/_config/compute_options.py
 bigframes/_config/display_options.py
 bigframes/_config/sampling_options.py
 bigframes/core/__init__.py
 bigframes/core/block_transforms.py
 bigframes/core/blocks.py
+bigframes/core/convert.py
+bigframes/core/eval.py
 bigframes/core/expression.py
 bigframes/core/global_session.py
 bigframes/core/guid.py
 bigframes/core/indexers.py
 bigframes/core/join_def.py
 bigframes/core/local_data.py
 bigframes/core/log_adapter.py
 bigframes/core/nodes.py
 bigframes/core/ordering.py
 bigframes/core/rewrite.py
 bigframes/core/scalar.py
 bigframes/core/schema.py
-bigframes/core/traversal.py
+bigframes/core/tree_properties.py
 bigframes/core/utils.py
 bigframes/core/window_spec.py
 bigframes/core/compile/__init__.py
 bigframes/core/compile/aggregate_compiler.py
 bigframes/core/compile/compiled.py
 bigframes/core/compile/compiler.py
 bigframes/core/compile/concat.py
 bigframes/core/compile/scalar_op_compiler.py
 bigframes/core/compile/single_column.py
 bigframes/core/groupby/__init__.py
 bigframes/core/indexes/__init__.py
-bigframes/core/indexes/index.py
+bigframes/core/indexes/base.py
 bigframes/core/joins/__init__.py
 bigframes/core/joins/merge.py
 bigframes/core/joins/name_resolution.py
 bigframes/core/reshape/__init__.py
 bigframes/core/tools/__init__.py
 bigframes/core/tools/datetimes.py
 bigframes/core/window/__init__.py
@@ -98,14 +101,15 @@
 bigframes/pandas/__init__.py
 bigframes/session/__init__.py
 bigframes/session/clients.py
 bigframes/session/_io/__init__.py
 bigframes/session/_io/bigquery.py
 bigframes/session/_io/pandas.py
 tests/__init__.py
+tests/config.py
 tests/data/hockey_players.json
 tests/data/hockey_players.jsonl
 tests/data/matrix_2by3.json
 tests/data/matrix_2by3.jsonl
 tests/data/matrix_3by4.json
 tests/data/matrix_3by4.jsonl
 tests/data/nested.jsonl
@@ -116,14 +120,15 @@
 tests/data/scalars_schema.json
 tests/data/time_series.jsonl
 tests/data/time_series_schema.json
 tests/system/__init__.py
 tests/system/conftest.py
 tests/system/utils.py
 tests/system/large/__init__.py
+tests/system/large/test_location.py
 tests/system/large/test_remote_function.py
 tests/system/large/test_session.py
 tests/system/large/ml/test_cluster.py
 tests/system/large/ml/test_compose.py
 tests/system/large/ml/test_core.py
 tests/system/large/ml/test_decomposition.py
 tests/system/large/ml/test_ensemble.py
@@ -218,14 +223,15 @@
 third_party/bigframes_vendored/ibis/backends/bigquery/__init__.py
 third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py
 third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py
 third_party/bigframes_vendored/ibis/backends/bigquery/registry.py
 third_party/bigframes_vendored/ibis/expr/__init__.py
 third_party/bigframes_vendored/ibis/expr/operations/__init__.py
 third_party/bigframes_vendored/ibis/expr/operations/analytic.py
+third_party/bigframes_vendored/ibis/expr/operations/generic.py
 third_party/bigframes_vendored/ibis/expr/operations/json.py
 third_party/bigframes_vendored/ibis/expr/operations/reductions.py
 third_party/bigframes_vendored/pandas/AUTHORS.md
 third_party/bigframes_vendored/pandas/LICENSE
 third_party/bigframes_vendored/pandas/README.md
 third_party/bigframes_vendored/pandas/__init__.py
 third_party/bigframes_vendored/pandas/_config/config.py
@@ -235,14 +241,23 @@
 third_party/bigframes_vendored/pandas/core/generic.py
 third_party/bigframes_vendored/pandas/core/indexing.py
 third_party/bigframes_vendored/pandas/core/series.py
 third_party/bigframes_vendored/pandas/core/arrays/__init__.py
 third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py
 third_party/bigframes_vendored/pandas/core/arrays/arrow/__init__.py
 third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py
+third_party/bigframes_vendored/pandas/core/computation/align.py
+third_party/bigframes_vendored/pandas/core/computation/common.py
+third_party/bigframes_vendored/pandas/core/computation/engines.py
+third_party/bigframes_vendored/pandas/core/computation/eval.py
+third_party/bigframes_vendored/pandas/core/computation/expr.py
+third_party/bigframes_vendored/pandas/core/computation/ops.py
+third_party/bigframes_vendored/pandas/core/computation/parsing.py
+third_party/bigframes_vendored/pandas/core/computation/scope.py
+third_party/bigframes_vendored/pandas/core/dtypes/inference.py
 third_party/bigframes_vendored/pandas/core/groupby/__init__.py
 third_party/bigframes_vendored/pandas/core/indexes/__init__.py
 third_party/bigframes_vendored/pandas/core/indexes/accessor.py
 third_party/bigframes_vendored/pandas/core/indexes/base.py
 third_party/bigframes_vendored/pandas/core/reshape/__init__.py
 third_party/bigframes_vendored/pandas/core/reshape/concat.py
 third_party/bigframes_vendored/pandas/core/reshape/encoding.py
@@ -258,14 +273,16 @@
 third_party/bigframes_vendored/pandas/io/gbq.py
 third_party/bigframes_vendored/pandas/io/parquet.py
 third_party/bigframes_vendored/pandas/io/pickle.py
 third_party/bigframes_vendored/pandas/io/parsers/__init__.py
 third_party/bigframes_vendored/pandas/io/parsers/readers.py
 third_party/bigframes_vendored/pandas/pandas/_typing.py
 third_party/bigframes_vendored/pandas/plotting/_core.py
+third_party/bigframes_vendored/pandas/util/_exceptions.py
+third_party/bigframes_vendored/pandas/util/_validators.py
 third_party/bigframes_vendored/sklearn/COPYING
 third_party/bigframes_vendored/sklearn/__init__.py
 third_party/bigframes_vendored/sklearn/base.py
 third_party/bigframes_vendored/sklearn/pipeline.py
 third_party/bigframes_vendored/sklearn/cluster/_kmeans.py
 third_party/bigframes_vendored/sklearn/compose/_column_transformer.py
 third_party/bigframes_vendored/sklearn/decomposition/_pca.py
```

### Comparing `bigframes-1.0.0/bigframes.egg-info/requires.txt` & `bigframes-1.1.0/bigframes.egg-info/requires.txt`

 * *Files 15% similar despite different names*

```diff
@@ -7,14 +7,15 @@
 google-cloud-functions>=1.12.0
 google-cloud-bigquery-connection>=1.12.0
 google-cloud-iam>=2.12.1
 google-cloud-resource-manager>=1.10.3
 google-cloud-storage>=2.0.0
 ibis-framework[bigquery]<9.0.0dev,>=8.0.0
 pandas>=1.5.0
+pyarrow>=8.0.0
 pydata-google-auth>=1.8.2
 requests>=2.27.1
 scikit-learn>=1.2.2
 sqlalchemy<3.0dev,>=1.4
 sqlglot<=20.11,>=20.8.0
 tabulate>=0.9
 ipywidgets>=7.7.1
```

### Comparing `bigframes-1.0.0/setup.py` & `bigframes-1.1.0/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -26,15 +26,15 @@
     "BigQuery DataFrames -- scalable analytics and machine learning with BigQuery"
 )
 
 # Should be one of:
 # 'Development Status :: 3 - Alpha'
 # 'Development Status :: 4 - Beta'
 # 'Development Status :: 5 - Production/Stable'
-release_status = "Development Status :: 3 - Alpha"
+release_status = "Development Status :: 5 - Production/Stable"
 dependencies = [
     # please keep these in sync with the minimum versions in testing/constraints-3.9.txt
     "cloudpickle >= 2.0.0",
     "fsspec >=2023.3.0",
     "gcsfs >=2023.3.0",
     "geopandas >=0.12.2",
     "google-auth >=2.15.0,<3.0dev",
@@ -43,14 +43,15 @@
     "google-cloud-bigquery-connection >=1.12.0",
     "google-cloud-iam >=2.12.1",
     "google-cloud-resource-manager >=1.10.3",
     "google-cloud-storage >=2.0.0",
     "ibis-framework[bigquery] >=8.0.0,<9.0.0dev",
     # TODO: Relax upper bound once we have fixed `system_prerelease` tests.
     "pandas >=1.5.0",
+    "pyarrow >=8.0.0",
     "pydata-google-auth >=1.8.2",
     "requests >=2.27.1",
     "scikit-learn >=1.2.2",
     "sqlalchemy >=1.4,<3.0dev",
     # Keep sqlglot versions in sync with ibis-framework. This avoids problems
     # where the incorrect version of sqlglot is installed, such as
     # https://github.com/googleapis/python-bigquery-dataframes/issues/315
```

### Comparing `bigframes-1.0.0/tests/__init__.py` & `bigframes-1.1.0/tests/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/hockey_players.json` & `bigframes-1.1.0/tests/data/hockey_players.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/hockey_players.jsonl` & `bigframes-1.1.0/tests/data/hockey_players.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/nested.jsonl` & `bigframes-1.1.0/tests/data/nested.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/nested_schema.json` & `bigframes-1.1.0/tests/data/nested_schema.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/penguins.jsonl` & `bigframes-1.1.0/tests/data/penguins.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/penguins_schema.json` & `bigframes-1.1.0/tests/data/penguins_schema.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/scalars.jsonl` & `bigframes-1.1.0/tests/data/scalars.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/scalars_schema.json` & `bigframes-1.1.0/tests/data/scalars_schema.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/data/time_series.jsonl` & `bigframes-1.1.0/tests/data/time_series.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/__init__.py` & `bigframes-1.1.0/tests/system/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/conftest.py` & `bigframes-1.1.0/tests/system/conftest.py`

 * *Files 2% similar despite different names*

```diff
@@ -950,14 +950,22 @@
     max_download_size = bigframes.options.sampling.max_download_size
     yield
     bigframes.options.sampling.enable_downsampling = enable_downsampling
     bigframes.options.sampling.max_download_size = max_download_size
 
 
 @pytest.fixture()
+def with_multiquery_execution():
+    original_setting = bigframes.options.compute.enable_multi_query_execution
+    bigframes.options.compute.enable_multi_query_execution = True
+    yield
+    bigframes.options.compute.enable_multi_query_execution = original_setting
+
+
+@pytest.fixture()
 def weird_strings_pd():
     df = pd.DataFrame(
         {
             "string_col": [
                 "٠١٢٣٤٥٦٧٨٩",
                 "",
                 "0",
```

### Comparing `bigframes-1.0.0/tests/system/large/__init__.py` & `bigframes-1.1.0/tests/system/large/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_cluster.py` & `bigframes-1.1.0/tests/system/large/ml/test_cluster.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_core.py` & `bigframes-1.1.0/tests/system/large/ml/test_core.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_decomposition.py` & `bigframes-1.1.0/tests/system/large/ml/test_decomposition.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_ensemble.py` & `bigframes-1.1.0/tests/system/large/ml/test_ensemble.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_forecasting.py` & `bigframes-1.1.0/tests/system/large/ml/test_forecasting.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_linear_model.py` & `bigframes-1.1.0/tests/system/large/ml/test_linear_model.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/ml/test_pipeline.py` & `bigframes-1.1.0/tests/system/large/ml/test_pipeline.py`

 * *Files 1% similar despite different names*

```diff
@@ -218,15 +218,15 @@
     )
     pd.testing.assert_frame_equal(
         predictions[["predicted_sex"]],
         expected,
     )
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_pipeline_xgbregressor_fit_score_predict(session, penguins_df_default_index):
     """Test a supervised model with a minimal preprocessing step"""
     pl = pipeline.Pipeline(
         [
             ("scale", preprocessing.StandardScaler()),
             ("xgbreg", ensemble.XGBRegressor()),
         ]
@@ -293,15 +293,15 @@
         index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
     )
     pd.testing.assert_frame_equal(
         predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
     )
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_pipeline_random_forest_classifier_fit_score_predict(
     session, penguins_df_default_index
 ):
     """Test a supervised model with a minimal preprocessing step"""
     pl = pipeline.Pipeline(
         [
             ("scale", preprocessing.StandardScaler()),
@@ -441,15 +441,15 @@
         ],
         expected,
         check_exact=False,
         rtol=0.1,
     )
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_pipeline_standard_scaler_kmeans_fit_score_predict(
     session, penguins_pandas_df_default_index
 ):
     """Test an unsupervised model with a non-BQML implementation of StandardScaler"""
     pl = pipeline.Pipeline(
         [
             ("scale", preprocessing.StandardScaler()),
@@ -642,15 +642,15 @@
     pl = pipeline.Pipeline(
         [
             (
                 "transform",
                 compose.ColumnTransformer(
                     [
                         (
-                            "ont_hot_encoder",
+                            "one_hot_encoder",
                             preprocessing.OneHotEncoder(
                                 drop="most_frequent",
                                 min_frequency=5,
                                 max_categories=100,
                             ),
                             "species",
                         ),
@@ -695,15 +695,15 @@
         f"{dataset_id}.test_penguins_pipeline_col_transformer", replace=True
     )
 
     assert isinstance(pl_loaded._transform, compose.ColumnTransformer)
     transformers = pl_loaded._transform.transformers_
     expected = [
         (
-            "ont_hot_encoder",
+            "one_hot_encoder",
             preprocessing.OneHotEncoder(
                 drop="most_frequent", max_categories=100, min_frequency=5
             ),
             "species",
         ),
         (
             "label_encoder",
```

### Comparing `bigframes-1.0.0/tests/system/large/test_remote_function.py` & `bigframes-1.1.0/tests/system/large/test_remote_function.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/large/test_session.py` & `bigframes-1.1.0/tests/system/large/test_session.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/load/test_large_tables.py` & `bigframes-1.1.0/tests/system/load/test_large_tables.py`

 * *Files 11% similar despite different names*

```diff
@@ -70,21 +70,17 @@
 
 def test_index_repr_large_table():
     df = bpd.read_gbq("load_testing.scalars_1tb")
     actual = repr(df.index)
     assert actual is not None
 
 
-# FAILED
-# tests/system/load/test_large_tables.py::test_to_pandas_batches_large_table
-# google.api_core.exceptions.Forbidden: 403 Response too large to return.
-# Consider specifying a destination table in your job...
-@pytest.mark.xfail
 def test_to_pandas_batches_large_table():
-    df = bpd.read_gbq("load_testing.scalars_100gb")
+    df = bpd.read_gbq("load_testing.scalars_10gb")
+    # df will be downloaded locally
     expected_row_count, expected_column_count = df.shape
 
     row_count = 0
     for df in df.to_pandas_batches():
         batch_row_count, batch_column_count = df.shape
         assert batch_column_count == expected_column_count
         row_count += batch_row_count
```

### Comparing `bigframes-1.0.0/tests/system/small/__init__.py` & `bigframes-1.1.0/tests/system/small/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/__init__.py` & `bigframes-1.1.0/tests/system/small/ml/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/conftest.py` & `bigframes-1.1.0/tests/system/small/ml/conftest.py`

 * *Files 2% similar despite different names*

```diff
@@ -43,20 +43,19 @@
 def penguins_bqml_linear_model(session, penguins_linear_model_name) -> core.BqmlModel:
     model = session.bqclient.get_model(penguins_linear_model_name)
     return core.BqmlModel(session, model)
 
 
 @pytest.fixture(scope="function")
 def ephemera_penguins_bqml_linear_model(
-    penguins_bqml_linear_model,
+    session: bigframes.Session,
+    penguins_bqml_linear_model: core.BqmlModel,
 ) -> core.BqmlModel:
     model = penguins_bqml_linear_model
-    return model.copy(
-        f"{model._model.project}.{model._model.dataset_id}.{uuid.uuid4().hex}"
-    )
+    return model.copy(f"{session._anonymous_dataset}.{uuid.uuid4().hex}")
 
 
 @pytest.fixture(scope="session")
 def penguins_bqml_kmeans_model(
     session: bigframes.Session, penguins_kmeans_model_name: str
 ) -> core.BqmlModel:
     model = session.bqclient.get_model(penguins_kmeans_model_name)
```

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_cluster.py` & `bigframes-1.1.0/tests/system/small/ml/test_cluster.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_core.py` & `bigframes-1.1.0/tests/system/small/ml/test_core.py`

 * *Files 1% similar despite different names*

```diff
@@ -329,15 +329,15 @@
         predictions[["predicted_body_mass_g"]].sort_index(),
         expected,
         check_exact=False,
         rtol=0.1,
     )
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_model_generate_text(
     bqml_palm2_text_generator_model: core.BqmlModel, llm_text_df
 ):
     options = {
         "temperature": 0.5,
         "max_output_tokens": 100,
         "top_k": 20,
```

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_decomposition.py` & `bigframes-1.1.0/tests/system/small/ml/test_decomposition.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_ensemble.py` & `bigframes-1.1.0/tests/system/small/ml/test_ensemble.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_forecasting.py` & `bigframes-1.1.0/tests/system/small/ml/test_forecasting.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_imported.py` & `bigframes-1.1.0/tests/system/small/ml/test_imported.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_linear_model.py` & `bigframes-1.1.0/tests/system/small/ml/test_linear_model.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_llm.py` & `bigframes-1.1.0/tests/system/small/ml/test_llm.py`

 * *Files 6% similar despite different names*

```diff
@@ -45,15 +45,15 @@
         f"{dataset_id}.temp_text_model", replace=True
     )
     assert f"{dataset_id}.temp_text_model" == reloaded_model._bqml_model.model_name
     assert reloaded_model.model_name == "text-bison-32k"
     assert reloaded_model.connection_name == bq_connection
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_create_text_generator_model_default_session(
     bq_connection, llm_text_pandas_df, bigquery_client
 ):
     import bigframes.pandas as bpd
 
     bpd.close_session()
     bpd.options.bigquery.bq_connection = bq_connection
@@ -72,15 +72,15 @@
     df = model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_create_text_generator_32k_model_default_session(
     bq_connection, llm_text_pandas_df, bigquery_client
 ):
     import bigframes.pandas as bpd
 
     bpd.close_session()
     bpd.options.bigquery.bq_connection = bq_connection
@@ -99,15 +99,15 @@
     df = model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_create_text_generator_model_default_connection(
     llm_text_pandas_df, bigquery_client
 ):
     from bigframes import _config
     import bigframes.pandas as bpd
 
     bpd.close_session()
@@ -127,49 +127,49 @@
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
 # Marked as flaky only because BQML LLM is in preview, the service only has limited capacity, not stable enough.
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_text_generator_predict_default_params_success(
     palm2_text_generator_model, llm_text_df
 ):
     df = palm2_text_generator_model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_text_generator_predict_series_default_params_success(
     palm2_text_generator_model, llm_text_df
 ):
     df = palm2_text_generator_model.predict(llm_text_df["prompt"]).to_pandas()
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_text_generator_predict_arbitrary_col_label_success(
     palm2_text_generator_model, llm_text_df
 ):
     llm_text_df = llm_text_df.rename(columns={"prompt": "arbitrary"})
     df = palm2_text_generator_model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_text_generator_predict_with_params_success(
     palm2_text_generator_model, llm_text_df
 ):
     df = palm2_text_generator_model.predict(
         llm_text_df, temperature=0.5, max_output_tokens=100, top_k=20, top_p=0.5
     ).to_pandas()
     assert df.shape == (3, 4)
@@ -251,39 +251,39 @@
     model = llm.PaLM2TextEmbeddingGenerator(
         model_name="textembedding-gecko-multilingual"
     )
     assert model is not None
     assert model._bqml_model is not None
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_embedding_generator_predict_success(
     palm2_embedding_generator_model, llm_text_df
 ):
     df = palm2_embedding_generator_model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "text_embedding" in df.columns
     series = df["text_embedding"]
     value = series[0]
     assert len(value) == 768
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_embedding_generator_multilingual_predict_success(
     palm2_embedding_generator_multilingual_model, llm_text_df
 ):
     df = palm2_embedding_generator_multilingual_model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "text_embedding" in df.columns
     series = df["text_embedding"]
     value = series[0]
     assert len(value) == 768
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_embedding_generator_predict_series_success(
     palm2_embedding_generator_model, llm_text_df
 ):
     df = palm2_embedding_generator_model.predict(llm_text_df["prompt"]).to_pandas()
     assert df.shape == (3, 4)
     assert "text_embedding" in df.columns
     series = df["text_embedding"]
@@ -302,26 +302,26 @@
     reloaded_model = gemini_text_generator_model.to_gbq(
         f"{dataset_id}.temp_text_model", replace=True
     )
     assert f"{dataset_id}.temp_text_model" == reloaded_model._bqml_model.model_name
     assert reloaded_model.connection_name == bq_connection
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_gemini_text_generator_predict_default_params_success(
     gemini_text_generator_model, llm_text_df
 ):
     df = gemini_text_generator_model.predict(llm_text_df).to_pandas()
     assert df.shape == (3, 4)
     assert "ml_generate_text_llm_result" in df.columns
     series = df["ml_generate_text_llm_result"]
     assert all(series.str.len() > 20)
 
 
-@pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2)
 def test_gemini_text_generator_predict_with_params_success(
     gemini_text_generator_model, llm_text_df
 ):
     df = gemini_text_generator_model.predict(
         llm_text_df, temperature=0.5, max_output_tokens=100, top_k=20, top_p=0.5
     ).to_pandas()
     assert df.shape == (3, 4)
```

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_metrics.py` & `bigframes-1.1.0/tests/system/small/ml/test_metrics.py`

 * *Files 4% similar despite different names*

```diff
@@ -15,131 +15,123 @@
 import math
 
 import numpy as np
 import pandas as pd
 import pytest
 import sklearn.metrics as sklearn_metrics  # type: ignore
 
-import bigframes.ml.metrics
+import bigframes
+from bigframes.ml import metrics
 
 
 def test_r2_score_perfect_fit(session):
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [1, 7, 3, 2, 5],
             "y_pred_arbitrary_name": [1, 7, 3, 2, 5],
         }
     )
 
     df = session.read_pandas(pd_df)
     assert (
-        bigframes.ml.metrics.r2_score(
-            df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]]
-        )
+        metrics.r2_score(df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]])
         == 1.0
     )
 
 
 def test_r2_score_bad_fit(session):
     pd_df = pd.DataFrame({"y_true": [1, 2, 3, 4, 5], "y_pred": [5, 4, 3, 2, 1]})
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.r2_score(df[["y_true"]], df[["y_pred"]]) == -3.0
+    assert metrics.r2_score(df[["y_true"]], df[["y_pred"]]) == -3.0
 
 
 def test_r2_score_force_finite(session):
     pd_df = pd.DataFrame(
         {
             "y_true": [1, 1, 1, 1, 1],
             "y_pred_1": [5, 4, 3, 2, 1],
             "y_pred_2": [1, 1, 1, 1, 1],
         }
     )
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.r2_score(
+    assert metrics.r2_score(
         df[["y_true"]], df[["y_pred_1"]], force_finite=False
     ) == float("-inf")
-    assert bigframes.ml.metrics.r2_score(df[["y_true"]], df[["y_pred_1"]]) == 0.0
+    assert metrics.r2_score(df[["y_true"]], df[["y_pred_1"]]) == 0.0
     assert math.isnan(
-        bigframes.ml.metrics.r2_score(
-            df[["y_true"]], df[["y_pred_2"]], force_finite=False
-        )
+        metrics.r2_score(df[["y_true"]], df[["y_pred_2"]], force_finite=False)
     )
-    assert bigframes.ml.metrics.r2_score(df[["y_true"]], df[["y_pred_2"]]) == 1.0
+    assert metrics.r2_score(df[["y_true"]], df[["y_pred_2"]]) == 1.0
 
 
 def test_r2_score_ok_fit_matches_sklearn(session):
     pd_df = pd.DataFrame({"y_true": [1, 2, 3, 4, 5], "y_pred": [2, 3, 4, 3, 6]})
 
     df = session.read_pandas(pd_df)
-    bf_result = bigframes.ml.metrics.r2_score(df[["y_true"]], df[["y_pred"]])
+    bf_result = metrics.r2_score(df[["y_true"]], df[["y_pred"]])
     sklearn_result = sklearn_metrics.r2_score(pd_df[["y_true"]], pd_df[["y_pred"]])
     assert math.isclose(bf_result, sklearn_result)
 
 
 def test_r2_score_series(session):
     pd_df = pd.DataFrame({"y_true": [1, 7, 3, 2, 5], "y_pred": [1, 7, 3, 2, 5]})
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.r2_score(df["y_true"], df["y_pred"]) == 1.0
+    assert metrics.r2_score(df["y_true"], df["y_pred"]) == 1.0
 
 
 def test_accuracy_score_perfect_fit(session):
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [1, 7, 3, 2, 5],
             "y_pred_arbitrary_name": [1, 7, 3, 2, 5],
         }
     )
 
     df = session.read_pandas(pd_df)
     assert (
-        bigframes.ml.metrics.accuracy_score(
+        metrics.accuracy_score(
             df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]]
         )
         == 1.0
     )
 
 
 def test_accuracy_score_bad_fit(session):
     pd_df = pd.DataFrame({"y_true": [0, 2, 1, 3, 4], "y_pred": [0, 1, 2, 3, 4]})
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.accuracy_score(df[["y_true"]], df[["y_pred"]]) == 0.6
+    assert metrics.accuracy_score(df[["y_true"]], df[["y_pred"]]) == 0.6
 
 
 def test_accuracy_score_not_normailze(session):
     pd_df = pd.DataFrame({"y_true": [0, 2, 1, 3, 4], "y_pred": [0, 1, 2, 3, 4]})
 
     df = session.read_pandas(pd_df)
-    assert (
-        bigframes.ml.metrics.accuracy_score(
-            df[["y_true"]], df[["y_pred"]], normalize=False
-        )
-        == 3
-    )
+    assert metrics.accuracy_score(df[["y_true"]], df[["y_pred"]], normalize=False) == 3
 
 
 def test_accuracy_score_fit_matches_sklearn(session):
     pd_df = pd.DataFrame({"y_true": [1, 2, 3, 4, 5], "y_pred": [2, 3, 4, 3, 6]})
 
     df = session.read_pandas(pd_df)
-    bf_result = bigframes.ml.metrics.accuracy_score(df[["y_true"]], df[["y_pred"]])
+    bf_result = metrics.accuracy_score(df[["y_true"]], df[["y_pred"]])
     sklearn_result = sklearn_metrics.accuracy_score(
         pd_df[["y_true"]], pd_df[["y_pred"]]
     )
     assert math.isclose(bf_result, sklearn_result)
 
 
 def test_accuracy_score_series(session):
     pd_df = pd.DataFrame({"y_true": [1, 7, 3, 2, 5], "y_pred": [1, 7, 3, 2, 5]})
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.accuracy_score(df["y_true"], df["y_pred"]) == 1.0
+    assert metrics.accuracy_score(df["y_true"], df["y_pred"]) == 1.0
 
 
 def test_roc_curve_binary_classification_prediction_returns_expected(session):
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score_arbitrary_name": [
@@ -154,15 +146,15 @@
                 0.6,
                 0.45,
             ],
         }
     )
 
     df = session.read_pandas(pd_df)
-    fpr, tpr, thresholds = bigframes.ml.metrics.roc_curve(
+    fpr, tpr, thresholds = metrics.roc_curve(
         df[["y_true_arbitrary_name"]],
         df[["y_score_arbitrary_name"]],
         drop_intermediate=False,
     )
 
     pd_fpr = fpr.to_pandas()
     pd_tpr = tpr.to_pandas()
@@ -215,15 +207,15 @@
         {
             "y_true": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score": [0.1, 0.4, 0.35, 0.8, 0.65, 0.9, 0.5, 0.3, 0.6, 0.45],
         }
     )
 
     df = session.read_pandas(pd_df)
-    fpr, tpr, thresholds = bigframes.ml.metrics.roc_curve(
+    fpr, tpr, thresholds = metrics.roc_curve(
         df[["y_true"]], df[["y_score"]], drop_intermediate=False
     )
     expected_fpr, expected_tpr, expected_thresholds = sklearn_metrics.roc_curve(
         pd_df[["y_true"]], pd_df[["y_score"]], drop_intermediate=False
     )
 
     # sklearn returns float64 np arrays
@@ -255,15 +247,15 @@
         {
             "y_true": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score": decisions_70pct,
         }
     )
 
     df = session.read_pandas(pd_df)
-    fpr, tpr, thresholds = bigframes.ml.metrics.roc_curve(
+    fpr, tpr, thresholds = metrics.roc_curve(
         df[["y_true"]], df[["y_score"]], drop_intermediate=False
     )
 
     pd_fpr = fpr.to_pandas()
     pd_tpr = tpr.to_pandas()
     pd_thresholds = thresholds.to_pandas()
 
@@ -310,15 +302,15 @@
         {
             "y_true": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score": decisions_70pct,
         }
     )
 
     df = session.read_pandas(pd_df)
-    fpr, tpr, thresholds = bigframes.ml.metrics.roc_curve(
+    fpr, tpr, thresholds = metrics.roc_curve(
         df[["y_true"]], df[["y_score"]], drop_intermediate=False
     )
     expected_fpr, expected_tpr, expected_thresholds = sklearn_metrics.roc_curve(
         pd_df[["y_true"]], pd_df[["y_score"]], drop_intermediate=False
     )
 
     # sklearn returns float64 np arrays
@@ -346,15 +338,15 @@
         {
             "y_true": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score": [0.1, 0.4, 0.35, 0.8, 0.65, 0.9, 0.5, 0.3, 0.6, 0.45],
         }
     )
 
     df = session.read_pandas(pd_df)
-    fpr, tpr, thresholds = bigframes.ml.metrics.roc_curve(
+    fpr, tpr, thresholds = metrics.roc_curve(
         df["y_true"], df["y_score"], drop_intermediate=False
     )
 
     pd_fpr = fpr.to_pandas()
     pd_tpr = tpr.to_pandas()
     pd_thresholds = thresholds.to_pandas()
 
@@ -416,15 +408,15 @@
                 0.6,
                 0.45,
             ],
         }
     )
 
     df = session.read_pandas(pd_df)
-    score = bigframes.ml.metrics.roc_auc_score(
+    score = metrics.roc_auc_score(
         df[["y_true_arbitrary_name"]], df[["y_score_arbitrary_name"]]
     )
 
     assert score == 0.625
 
 
 def test_roc_auc_score_returns_matches_sklearn(session):
@@ -432,15 +424,15 @@
         {
             "y_true": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score": [0.1, 0.4, 0.35, 0.8, 0.65, 0.9, 0.5, 0.3, 0.6, 0.45],
         }
     )
 
     df = session.read_pandas(pd_df)
-    score = bigframes.ml.metrics.roc_auc_score(df[["y_true"]], df[["y_score"]])
+    score = metrics.roc_auc_score(df[["y_true"]], df[["y_score"]])
     expected_score = sklearn_metrics.roc_auc_score(
         pd_df[["y_true"]], pd_df[["y_score"]]
     )
 
     assert score == expected_score
 
 
@@ -449,61 +441,61 @@
         {
             "y_true": [0, 0, 1, 1, 0, 1, 0, 1, 1, 1],
             "y_score": [0.1, 0.4, 0.35, 0.8, 0.65, 0.9, 0.5, 0.3, 0.6, 0.45],
         }
     )
 
     df = session.read_pandas(pd_df)
-    score = bigframes.ml.metrics.roc_auc_score(df["y_true"], df["y_score"])
+    score = metrics.roc_auc_score(df["y_true"], df["y_score"])
 
     assert score == 0.625
 
 
 def test_auc_invalid_x_size(session):
     pd_df = pd.DataFrame({"x_arbitrary_name": [0], "y_arbitrary_name": [0]})
     df = session.read_pandas(pd_df)
     with pytest.raises(ValueError):
-        bigframes.ml.metrics.auc(df[["x_arbitrary_name"]], df[["y_arbitrary_name"]])
+        metrics.auc(df[["x_arbitrary_name"]], df[["y_arbitrary_name"]])
 
 
 def test_auc_nondecreasing_x(session):
     pd_df = pd.DataFrame({"x": [0, 0, 0.5, 0.5, 1], "y": [0, 0.5, 0.5, 1, 1]})
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.auc(df[["x"]], df[["y"]]) == 0.75
+    assert metrics.auc(df[["x"]], df[["y"]]) == 0.75
 
 
 def test_auc_nonincreasing_x(session):
     pd_df = pd.DataFrame({"x": [0, 0, -0.5, -0.5, -1], "y": [0, 0.5, 0.5, 1, 1]})
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.auc(df[["x"]], df[["y"]]) == 0.75
+    assert metrics.auc(df[["x"]], df[["y"]]) == 0.75
 
 
 def test_auc_nonincreasing_x_negative(session):
     pd_df = pd.DataFrame({"x": [0, 0, -0.5, -0.5, -1], "y": [0, -0.5, -0.5, -1, -1]})
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.auc(df[["x"]], df[["y"]]) == -0.75
+    assert metrics.auc(df[["x"]], df[["y"]]) == -0.75
 
 
 def test_auc_series(session):
     pd_df = pd.DataFrame({"x": [0, 0, 0.5, 0.5, 1], "y": [0, 0.5, 0.5, 1, 1]})
 
     df = session.read_pandas(pd_df)
-    assert bigframes.ml.metrics.auc(df["x"], df["y"]) == 0.75
+    assert metrics.auc(df["x"], df["y"]) == 0.75
 
 
 def test_confusion_matrix(session):
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    confusion_matrix = bigframes.ml.metrics.confusion_matrix(
+    confusion_matrix = metrics.confusion_matrix(
         df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]]
     )
     expected_pd_df = pd.DataFrame(
         {
             0: [2, 0, 1],
             1: [0, 0, 0],
             2: [0, 1, 2],
@@ -518,17 +510,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 3, 3, 3, 4, 1],
             "y_pred": [4, 1, 2, 2, 4, 1],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    confusion_matrix = bigframes.ml.metrics.confusion_matrix(
-        df[["y_true"]], df[["y_pred"]]
-    )
+    confusion_matrix = metrics.confusion_matrix(df[["y_true"]], df[["y_pred"]])
     expected_pd_df = (
         pd.DataFrame(
             {1: [1, 0, 1, 0], 2: [0, 0, 2, 0], 3: [0, 0, 0, 0], 4: [0, 1, 0, 1]}
         )
         .astype("int64")
         .set_index([pd.Index([1, 2, 3, 4])])
     )
@@ -541,17 +531,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 3, 3, 3, 4, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    confusion_matrix = bigframes.ml.metrics.confusion_matrix(
-        df[["y_true"]], df[["y_pred"]]
-    )
+    confusion_matrix = metrics.confusion_matrix(df[["y_true"]], df[["y_pred"]])
     expected_confusion_matrix = sklearn_metrics.confusion_matrix(
         pd_df[["y_true"]], pd_df[["y_pred"]]
     )
     expected_pd_df = pd.DataFrame(expected_confusion_matrix)
     pd.testing.assert_frame_equal(
         confusion_matrix, expected_pd_df, check_index_type=False
     )
@@ -561,17 +549,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
-    confusion_matrix = bigframes.ml.metrics.confusion_matrix(
-        df[["y_true"]], df[["y_pred"]]
-    )
+    confusion_matrix = metrics.confusion_matrix(df[["y_true"]], df[["y_pred"]])
     expected_confusion_matrix = sklearn_metrics.confusion_matrix(
         pd_df[["y_true"]], pd_df[["y_pred"]]
     )
     expected_pd_df = pd.DataFrame(expected_confusion_matrix).set_index(
         [pd.Index(["ant", "bird", "cat"])]
     )
     expected_pd_df.columns = pd.Index(["ant", "bird", "cat"])
@@ -584,15 +570,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    confusion_matrix = bigframes.ml.metrics.confusion_matrix(df["y_true"], df["y_pred"])
+    confusion_matrix = metrics.confusion_matrix(df["y_true"], df["y_pred"])
     expected_pd_df = pd.DataFrame(
         {
             0: [2, 0, 1],
             1: [0, 0, 0],
             2: [0, 1, 2],
         }
     ).astype("int64")
@@ -605,15 +591,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    recall = bigframes.ml.metrics.recall_score(
+    recall = metrics.recall_score(
         df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None
     )
     expected_values = [1.000000, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_recall = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
@@ -623,17 +609,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    recall = bigframes.ml.metrics.recall_score(
-        df[["y_true"]], df[["y_pred"]], average=None
-    )
+    recall = metrics.recall_score(df[["y_true"]], df[["y_pred"]], average=None)
     expected_values = sklearn_metrics.recall_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = [0, 1, 2]
     expected_recall = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
@@ -642,17 +626,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
-    recall = bigframes.ml.metrics.recall_score(
-        df[["y_true"]], df[["y_pred"]], average=None
-    )
+    recall = metrics.recall_score(df[["y_true"]], df[["y_pred"]], average=None)
     expected_values = sklearn_metrics.recall_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = ["ant", "bird", "cat"]
     expected_recall = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
@@ -661,15 +643,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    recall = bigframes.ml.metrics.recall_score(df["y_true"], df["y_pred"], average=None)
+    recall = metrics.recall_score(df["y_true"], df["y_pred"], average=None)
     expected_values = [1.000000, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_recall = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
 
@@ -677,15 +659,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    precision_score = bigframes.ml.metrics.precision_score(
+    precision_score = metrics.precision_score(
         df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None
     )
     expected_values = [0.666667, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_precision = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(
@@ -697,15 +679,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    precision_score = bigframes.ml.metrics.precision_score(
+    precision_score = metrics.precision_score(
         df[["y_true"]], df[["y_pred"]], average=None
     )
     expected_values = sklearn_metrics.precision_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = [0, 1, 2]
     expected_precision = pd.Series(expected_values, index=expected_index)
@@ -718,15 +700,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
-    precision_score = bigframes.ml.metrics.precision_score(
+    precision_score = metrics.precision_score(
         df[["y_true"]], df[["y_pred"]], average=None
     )
     expected_values = sklearn_metrics.precision_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = ["ant", "bird", "cat"]
     expected_precision = pd.Series(expected_values, index=expected_index)
@@ -739,17 +721,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    precision_score = bigframes.ml.metrics.precision_score(
-        df["y_true"], df["y_pred"], average=None
-    )
+    precision_score = metrics.precision_score(df["y_true"], df["y_pred"], average=None)
     expected_values = [0.666667, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_precision = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(
         precision_score, expected_precision, check_index_type=False
     )
@@ -759,15 +739,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    f1_score = bigframes.ml.metrics.f1_score(
+    f1_score = metrics.f1_score(
         df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None
     )
     expected_values = [0.8, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_f1 = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
@@ -777,17 +757,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    f1_score = bigframes.ml.metrics.f1_score(
-        df[["y_true"]], df[["y_pred"]], average=None
-    )
+    f1_score = metrics.f1_score(df[["y_true"]], df[["y_pred"]], average=None)
     expected_values = sklearn_metrics.f1_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = [0, 1, 2]
     expected_f1 = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
 
@@ -796,17 +774,15 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
-    f1_score = bigframes.ml.metrics.f1_score(
-        df[["y_true"]], df[["y_pred"]], average=None
-    )
+    f1_score = metrics.f1_score(df[["y_true"]], df[["y_pred"]], average=None)
     expected_values = sklearn_metrics.f1_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = ["ant", "bird", "cat"]
     expected_f1 = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
 
@@ -815,13 +791,20 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    f1_score = bigframes.ml.metrics.f1_score(df["y_true"], df["y_pred"], average=None)
+    f1_score = metrics.f1_score(df["y_true"], df["y_pred"], average=None)
     expected_values = [0.8, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_f1 = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
+
+
+def test_mean_squared_error(session: bigframes.Session):
+    pd_df = pd.DataFrame({"y_true": [3, -0.5, 2, 7], "y_pred": [2.5, 0.0, 2, 8]})
+    df = session.read_pandas(pd_df)
+    mse = metrics.mean_squared_error(df["y_true"], df["y_pred"])
+    assert mse == 0.375
```

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_metrics_pairwise.py` & `bigframes-1.1.0/tests/system/small/ml/test_metrics_pairwise.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_model_selection.py` & `bigframes-1.1.0/tests/system/small/ml/test_model_selection.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_register.py` & `bigframes-1.1.0/tests/system/small/ml/test_register.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/ml/test_remote.py` & `bigframes-1.1.0/tests/system/small/ml/test_remote.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/operations/__init__.py` & `bigframes-1.1.0/tests/system/small/operations/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/operations/test_datetimes.py` & `bigframes-1.1.0/tests/system/small/operations/test_datetimes.py`

 * *Files 10% similar despite different names*

```diff
@@ -8,14 +8,16 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+import datetime
+
 import pandas as pd
 import pytest
 
 import bigframes.series
 from tests.system.utils import assert_series_equal, skip_legacy_pandas
 
 DATETIME_COL_NAMES = [("datetime_col",), ("timestamp_col",)]
@@ -299,7 +301,69 @@
     bf_result = scalars_df[col_name].dt.floor(freq).to_pandas()
     pd_result = scalars_pandas_df[col_name].dt.floor(freq)
 
     assert_series_equal(
         pd_result.astype(scalars_df[col_name].dtype),  # floor preserves type
         bf_result,
     )
+
+
+def test_dt_compare_coerce_str_datetime(scalars_dfs):
+    scalars_df, scalars_pandas_df = scalars_dfs
+    bf_series: bigframes.series.Series = scalars_df["datetime_col"]
+    bf_result = (bf_series >= "2024-01-01").to_pandas()
+
+    pd_result = scalars_pandas_df["datetime_col"] >= pd.to_datetime("2024-01-01")
+
+    # pandas produces pyarrow bool dtype
+    assert_series_equal(pd_result, bf_result, check_dtype=False)
+
+
+def test_dt_clip_datetime_literals(scalars_dfs):
+    scalars_df, scalars_pandas_df = scalars_dfs
+    bf_series: bigframes.series.Series = scalars_df["date_col"]
+    bf_result = bf_series.clip(
+        datetime.date(2020, 1, 1), datetime.date(2024, 1, 1)
+    ).to_pandas()
+
+    pd_result = scalars_pandas_df["date_col"].clip(
+        datetime.date(2020, 1, 1), datetime.date(2024, 1, 1)
+    )
+
+    assert_series_equal(
+        pd_result,
+        bf_result,
+    )
+
+
+def test_dt_clip_coerce_str_date(scalars_dfs):
+    scalars_df, scalars_pandas_df = scalars_dfs
+    bf_series: bigframes.series.Series = scalars_df["date_col"]
+    bf_result = bf_series.clip("2020-01-01", "2024-01-01").to_pandas()
+
+    # Pandas can't coerce with pyarrow types so convert first
+    pd_result = scalars_pandas_df["date_col"].clip(
+        datetime.date(2020, 1, 1), datetime.date(2024, 1, 1)
+    )
+
+    assert_series_equal(
+        pd_result,
+        bf_result,
+    )
+
+
+def test_dt_clip_coerce_str_timestamp(scalars_dfs):
+    scalars_df, scalars_pandas_df = scalars_dfs
+    bf_series: bigframes.series.Series = scalars_df["timestamp_col"]
+    bf_result = bf_series.clip(
+        "2020-01-01T20:03:50Z", "2024-01-01T20:03:50Z"
+    ).to_pandas()
+
+    pd_result = scalars_pandas_df["timestamp_col"].clip(
+        pd.to_datetime("2020-01-01T20:03:50Z", utc=True),
+        pd.to_datetime("2024-01-01T20:03:50Z", utc=True),
+    )
+
+    assert_series_equal(
+        pd_result,
+        bf_result,
+    )
```

### Comparing `bigframes-1.0.0/tests/system/small/operations/test_plotting.py` & `bigframes-1.1.0/tests/system/small/operations/test_plotting.py`

 * *Files 3% similar despite different names*

```diff
@@ -236,14 +236,56 @@
     for idx in range(len(ax.collections[0].get_facecolor())):
         tm.assert_numpy_array_equal(
             ax.collections[0].get_facecolor()[idx],
             pd_ax.collections[0].get_facecolor()[idx],
         )
 
 
+@pytest.mark.parametrize(
+    ("s"),
+    [
+        pytest.param([10, 34, 50], id="int"),
+        pytest.param([1.0, 3.4, 5.0], id="float"),
+        pytest.param(
+            [True, True, False], id="bool", marks=pytest.mark.xfail(raises=ValueError)
+        ),
+    ],
+)
+def test_scatter_args_s(s):
+    data = {
+        "a": [1, 2, 3],
+        "b": [1, 2, 3],
+    }
+    data["s"] = s
+    df = bpd.DataFrame(data)
+    pd_df = pd.DataFrame(data)
+
+    ax = df.plot.scatter(x="a", y="b", s="s")
+    pd_ax = pd_df.plot.scatter(x="a", y="b", s="s")
+    tm.assert_numpy_array_equal(
+        ax.collections[0].get_sizes(), pd_ax.collections[0].get_sizes()
+    )
+
+
+@pytest.mark.parametrize(
+    ("arg_name"),
+    [
+        pytest.param("c", marks=pytest.mark.xfail(raises=NotImplementedError)),
+        pytest.param("s", marks=pytest.mark.xfail(raises=NotImplementedError)),
+    ],
+)
+def test_scatter_sequence_arg(arg_name):
+    data = {
+        "a": [1, 2, 3],
+        "b": [1, 2, 3],
+    }
+    arg_value = [3, 3, 1]
+    bpd.DataFrame(data).plot.scatter(x="a", y="b", **{arg_name: arg_value})
+
+
 def test_sampling_plot_args_n():
     df = bpd.DataFrame(np.arange(bf_mpl.DEFAULT_SAMPLING_N * 10), columns=["one"])
     ax = df.plot.line()
     assert len(ax.lines) == 1
     assert len(ax.lines[0].get_data()[1]) == bf_mpl.DEFAULT_SAMPLING_N
 
     ax = df.plot.line(sampling_n=2)
```

### Comparing `bigframes-1.0.0/tests/system/small/operations/test_strings.py` & `bigframes-1.1.0/tests/system/small/operations/test_strings.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/regression/test_issue355_merge_after_filter.py` & `bigframes-1.1.0/tests/system/small/regression/test_issue355_merge_after_filter.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_dataframe.py` & `bigframes-1.1.0/tests/system/small/test_dataframe.py`

 * *Files 2% similar despite different names*

```diff
@@ -16,22 +16,25 @@
 import operator
 import sys
 import tempfile
 import typing
 from typing import Tuple
 
 import geopandas as gpd  # type: ignore
+import numpy as np
 import pandas as pd
 import pandas.testing
 import pyarrow as pa  # type: ignore
 import pytest
 
 import bigframes
 import bigframes._config.display_options as display_options
+import bigframes.core.indexes as bf_indexes
 import bigframes.dataframe as dataframe
+import bigframes.pandas as bpd
 import bigframes.series as series
 from tests.system.utils import (
     assert_pandas_df_equal,
     assert_series_equal,
     skip_legacy_pandas,
 )
 
@@ -61,14 +64,21 @@
     ]
     _, scalars_pandas_df = scalars_dfs
     bf_result = dataframe.DataFrame(scalars_pandas_df, columns=columns).to_pandas()
     pd_result = pd.DataFrame(scalars_pandas_df, columns=columns)
     pandas.testing.assert_frame_equal(bf_result, pd_result)
 
 
+def test_df_construct_large_strings():
+    data = [["hello", "w" + "o" * 50000 + "rld"]]
+    bf_result = dataframe.DataFrame(data).to_pandas()
+    pd_result = pd.DataFrame(data, dtype=pd.StringDtype(storage="pyarrow"))
+    pandas.testing.assert_frame_equal(bf_result, pd_result, check_index_type=False)
+
+
 def test_df_construct_pandas_load_job(scalars_dfs):
     # This should trigger the inlined codepath
     columns = [
         "int64_too",
         "int64_col",
         "float64_col",
         "bool_col",
@@ -490,14 +500,25 @@
     peek_result = scalars_df[["int64_col", "int64_too"]].cumsum().peek(n=3)
     pd.testing.assert_index_equal(
         scalars_pandas_df[["int64_col", "int64_too"]].columns, peek_result.columns
     )
     assert len(peek_result) == 3
 
 
+def test_df_peek_reset_index(scalars_dfs):
+    scalars_df, scalars_pandas_df = scalars_dfs
+    peek_result = (
+        scalars_df[["int64_col", "int64_too"]].reset_index(drop=True).peek(n=3)
+    )
+    pd.testing.assert_index_equal(
+        scalars_pandas_df[["int64_col", "int64_too"]].columns, peek_result.columns
+    )
+    assert len(peek_result) == 3
+
+
 def test_repr_w_all_rows(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
 
     # Remove columns with flaky formatting, like NUMERIC columns (which use the
     # object dtype). Also makes a copy so that mutating the index name doesn't
     # break other tests.
     scalars_df = scalars_df.drop(columns=["numeric_col"])
@@ -601,25 +622,32 @@
 
     # Convert default pandas dtypes `int64` to match BigQuery DataFrames dtypes.
     pd_result["new_col"] = pd_result["new_col"].astype("Int64")
 
     pd.testing.assert_frame_equal(bf_result, pd_result)
 
 
-def test_assign_new_column_w_setitem(scalars_dfs):
+@pytest.mark.parametrize(
+    ("scalar",),
+    [
+        (2.1,),
+        (None,),
+    ],
+)
+def test_assign_new_column_w_setitem(scalars_dfs, scalar):
     scalars_df, scalars_pandas_df = scalars_dfs
     bf_df = scalars_df.copy()
     pd_df = scalars_pandas_df.copy()
-    bf_df["new_col"] = 2
-    pd_df["new_col"] = 2
+    bf_df["new_col"] = scalar
+    pd_df["new_col"] = scalar
     bf_result = bf_df.to_pandas()
     pd_result = pd_df
 
-    # Convert default pandas dtypes `int64` to match BigQuery DataFrames dtypes.
-    pd_result["new_col"] = pd_result["new_col"].astype("Int64")
+    # Convert default pandas dtypes `float64` to match BigQuery DataFrames dtypes.
+    pd_result["new_col"] = pd_result["new_col"].astype("Float64")
 
     pd.testing.assert_frame_equal(bf_result, pd_result)
 
 
 def test_assign_new_column_w_setitem_dataframe(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
     bf_df = scalars_df.copy()
@@ -1999,15 +2027,15 @@
 
     assert_pandas_df_equal(bf_result, pd_result)
 
 
 def test_scalar_binop_str_exception(scalars_dfs):
     scalars_df, _ = scalars_dfs
     columns = ["string_col"]
-    with pytest.raises(Exception):
+    with pytest.raises(TypeError, match="Cannot add dtypes"):
         (scalars_df[columns] + 1).to_pandas()
 
 
 @pytest.mark.parametrize(
     ("op"),
     [
         (lambda x, y: x.add(y, axis="index")),
@@ -2052,14 +2080,45 @@
 
     bf_result = op(scalars_df[df_columns], scalars_df[series_column]).to_pandas()
     pd_result = op(scalars_pandas_df[df_columns], scalars_pandas_df[series_column])
 
     assert_pandas_df_equal(bf_result, pd_result)
 
 
+@skip_legacy_pandas
+@pytest.mark.parametrize(
+    ("input"),
+    [
+        ((1000, 2000, 3000)),
+        (pd.Index([1000, 2000, 3000])),
+        (bf_indexes.Index([1000, 2000, 3000])),
+        (pd.Series((1000, 2000), index=["int64_too", "float64_col"])),
+        (series.Series((1000, 2000), index=["int64_too", "float64_col"])),
+    ],
+    ids=[
+        "tuple",
+        "pd_index",
+        "bf_index",
+        "pd_series",
+        "bf_series",
+    ],
+)
+def test_listlike_binop_axis_1(scalars_dfs, input):
+    scalars_df, scalars_pandas_df = scalars_dfs
+
+    df_columns = ["int64_col", "float64_col", "int64_too"]
+
+    bf_result = scalars_df[df_columns].add(input, axis=1).to_pandas()
+    if hasattr(input, "to_pandas"):
+        input = input.to_pandas()
+    pd_result = scalars_pandas_df[df_columns].add(input, axis=1)
+
+    assert_pandas_df_equal(bf_result, pd_result, check_dtype=False)
+
+
 @pytest.mark.parametrize(
     ("left_labels", "right_labels"),
     [
         (["a", "a", "b"], ["c", "c", "d"]),
         (["a", "b", "c"], ["c", "a", "b"]),
         (["a", "c", "c"], ["c", "a", "c"]),
         (["a", "b", "c"], ["a", "b", "c"]),
@@ -3818,14 +3877,52 @@
     )
     bf_result = bf_result_file.read()
     pd_result = bf_result_file.read()
 
     assert bf_result == pd_result
 
 
+@skip_legacy_pandas
+@pytest.mark.parametrize(
+    ("expr",),
+    [
+        ("new_col = int64_col + int64_too",),
+        ("new_col = (rowindex > 3) | bool_col",),
+        ("int64_too = bool_col\nnew_col2 = rowindex",),
+    ],
+)
+def test_df_eval(scalars_dfs, expr):
+    scalars_df, scalars_pandas_df = scalars_dfs
+
+    bf_result = scalars_df.eval(expr).to_pandas()
+    pd_result = scalars_pandas_df.eval(expr)
+
+    pd.testing.assert_frame_equal(bf_result, pd_result)
+
+
+@skip_legacy_pandas
+@pytest.mark.parametrize(
+    ("expr",),
+    [
+        ("int64_col > int64_too",),
+        ("bool_col",),
+        ("((int64_col - int64_too) % @local_var) == 0",),
+    ],
+)
+def test_df_query(scalars_dfs, expr):
+    # local_var is referenced in expressions
+    local_var = 3  # NOQA
+    scalars_df, scalars_pandas_df = scalars_dfs
+
+    bf_result = scalars_df.query(expr).to_pandas()
+    pd_result = scalars_pandas_df.query(expr)
+
+    pd.testing.assert_frame_equal(bf_result, pd_result)
+
+
 @pytest.mark.parametrize(
     ("subset", "normalize", "ascending", "dropna"),
     [
         (None, False, False, False),
         (None, True, True, True),
         ("bool_col", True, False, True),
     ],
@@ -4044,14 +4141,64 @@
 def test_recursion_limit(scalars_df_index):
     scalars_df_index = scalars_df_index[["int64_too", "int64_col", "float64_col"]]
     for i in range(400):
         scalars_df_index = scalars_df_index + 4
     scalars_df_index.to_pandas()
 
 
+def test_query_complexity_repeated_joins(
+    scalars_df_index, scalars_pandas_df_index, with_multiquery_execution
+):
+    pd_df = scalars_pandas_df_index
+    bf_df = scalars_df_index
+    for _ in range(6):
+        # recursively join, resuling in 2^6 - 1 = 63 joins
+        pd_df = pd_df.merge(pd_df, on="int64_col").head(30)
+        pd_df = pd_df[pd_df.columns[:20]]
+        bf_df = bf_df.merge(bf_df, on="int64_col").head(30)
+        bf_df = bf_df[bf_df.columns[:20]]
+
+    bf_result = bf_df.to_pandas()
+    pd_result = pd_df
+    assert_pandas_df_equal(bf_result, pd_result, check_index_type=False)
+
+
+def test_query_complexity_repeated_subtrees(
+    scalars_df_index, scalars_pandas_df_index, with_multiquery_execution
+):
+    # Recursively union the data, if fully inlined has 10^5 identical root tables.
+    pd_df = scalars_pandas_df_index
+    bf_df = scalars_df_index
+    for _ in range(5):
+        pd_df = pd.concat(10 * [pd_df]).head(5)
+        bf_df = bigframes.pandas.concat(10 * [bf_df]).head(5)
+    bf_result = bf_df.to_pandas()
+    pd_result = pd_df
+    assert_pandas_df_equal(bf_result, pd_result)
+
+
+@pytest.mark.skipif(
+    sys.version_info >= (3, 12),
+    # See: https://github.com/python/cpython/issues/112282
+    reason="setrecursionlimit has no effect on the Python C stack since Python 3.12.",
+)
+def test_query_complexity_repeated_analytic(
+    scalars_df_index, scalars_pandas_df_index, with_multiquery_execution
+):
+    bf_df = scalars_df_index[["int64_col", "int64_too"]]
+    pd_df = scalars_pandas_df_index[["int64_col", "int64_too"]]
+    # Uses LAG analytic operator, each in a new SELECT
+    for _ in range(50):
+        bf_df = bf_df.diff()
+        pd_df = pd_df.diff()
+    bf_result = bf_df.to_pandas()
+    pd_result = pd_df
+    assert_pandas_df_equal(bf_result, pd_result)
+
+
 def test_to_pandas_downsampling_option_override(session):
     df = session.read_gbq("bigframes-dev.bigframes_tests_sys.batting")
     download_size = 1
 
     df = df.to_pandas(max_download_size=download_size, sampling_method="head")
 
     total_memory_bytes = df.memory_usage(deep=True).sum()
@@ -4068,7 +4215,76 @@
         result_table == destination_table
         if destination_table
         else result_table is not None
     )
 
     loaded_scalars_df_index = session.read_gbq(result_table)
     assert not loaded_scalars_df_index.empty
+
+
+@pytest.mark.parametrize(
+    ("col_names", "ignore_index"),
+    [
+        pytest.param(["A"], False, id="one_array_false"),
+        pytest.param(["A"], True, id="one_array_true"),
+        pytest.param(["B"], False, id="one_float_false"),
+        pytest.param(["B"], True, id="one_float_true"),
+        pytest.param(["A", "C"], False, id="two_arrays_false"),
+        pytest.param(["A", "C"], True, id="two_arrays_true"),
+    ],
+)
+def test_dataframe_explode(col_names, ignore_index):
+    data = {
+        "A": [[0, 1, 2], [], [3, 4]],
+        "B": 3,
+        "C": [["a", "b", "c"], np.nan, ["d", "e"]],
+    }
+    df = bpd.DataFrame(data)
+    pd_df = df.to_pandas()
+    pd.testing.assert_frame_equal(
+        df.explode(col_names, ignore_index=ignore_index).to_pandas(),
+        pd_df.explode(col_names, ignore_index=ignore_index),
+        check_index_type=False,
+        check_dtype=False,
+    )
+
+
+@pytest.mark.parametrize(
+    ("ignore_index", "ordered"),
+    [
+        pytest.param(True, True, id="include_index_ordered"),
+        pytest.param(True, False, id="include_index_unordered"),
+        pytest.param(False, True, id="ignore_index_ordered"),
+    ],
+)
+def test_dataframe_explode_reserve_order(ignore_index, ordered):
+    data = {
+        "a": [np.random.randint(0, 10, 10) for _ in range(10)],
+        "b": [np.random.randint(0, 10, 10) for _ in range(10)],
+    }
+    df = bpd.DataFrame(data)
+    pd_df = pd.DataFrame(data)
+
+    res = df.explode(["a", "b"], ignore_index=ignore_index).to_pandas(ordered=ordered)
+    pd_res = pd_df.explode(["a", "b"], ignore_index=ignore_index).astype(
+        pd.Int64Dtype()
+    )
+    pd.testing.assert_frame_equal(
+        res if ordered else res.sort_index(),
+        pd_res,
+        check_index_type=False,
+    )
+
+
+@pytest.mark.parametrize(
+    ("col_names"),
+    [
+        pytest.param([], id="empty", marks=pytest.mark.xfail(raises=ValueError)),
+        pytest.param(
+            ["A", "A"], id="duplicate", marks=pytest.mark.xfail(raises=ValueError)
+        ),
+        pytest.param("unknown", id="unknown", marks=pytest.mark.xfail(raises=KeyError)),
+    ],
+)
+def test_dataframe_explode_xfail(col_names):
+    df = bpd.DataFrame({"A": [[0, 1, 2], [], [3, 4]]})
+    df.explode(col_names)
```

### Comparing `bigframes-1.0.0/tests/system/small/test_dataframe_io.py` & `bigframes-1.1.0/tests/system/small/test_dataframe_io.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_encryption.py` & `bigframes-1.1.0/tests/system/small/test_encryption.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_groupby.py` & `bigframes-1.1.0/tests/system/small/test_groupby.py`

 * *Files 0% similar despite different names*

```diff
@@ -224,16 +224,15 @@
 
 @pytest.mark.parametrize(
     ("operator"),
     [
         (lambda x: x.cumsum(numeric_only=True)),
         (lambda x: x.cummax(numeric_only=True)),
         (lambda x: x.cummin(numeric_only=True)),
-        # pandas 2.2 uses floating point for cumulative product even for
-        # integer inputs.
+        # Pre-pandas 2.2 doesn't always proeduce float.
         (lambda x: x.cumprod().astype("Float64")),
         (lambda x: x.shift(periods=2)),
     ],
     ids=[
         "cumsum",
         "cummax",
         "cummin",
```

### Comparing `bigframes-1.0.0/tests/system/small/test_ibis.py` & `bigframes-1.1.0/tests/system/small/test_ibis.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_index.py` & `bigframes-1.1.0/tests/system/small/test_index.py`

 * *Files 4% similar despite different names*

```diff
@@ -366,7 +366,46 @@
         [2, 55555, 4]
     )
     pd.testing.assert_index_equal(
         pd.Index(pd_result_array),
         bf_series,
         check_names=False,
     )
+
+
+def test_multiindex_name_is_none(session):
+    df = pd.DataFrame(
+        {
+            "A": [0, 0, 0, 1, 1, 1],
+            "B": ["x", "y", "z", "x", "y", "z"],
+            "C": [123, 345, 789, -123, -345, -789],
+            "D": ["a", "b", "c", "d", "e", "f"],
+        },
+    )
+    index = session.read_pandas(df).set_index(["A", "B"]).index
+    assert index.name is None
+
+
+def test_multiindex_names_not_none(session):
+    df = pd.DataFrame(
+        {
+            "A": [0, 0, 0, 1, 1, 1],
+            "B": ["x", "y", "z", "x", "y", "z"],
+            "C": [123, 345, 789, -123, -345, -789],
+            "D": ["a", "b", "c", "d", "e", "f"],
+        },
+    )
+    index = session.read_pandas(df).set_index(["A", "B"]).index
+    assert tuple(index.names) == ("A", "B")
+
+
+def test_multiindex_repr_includes_all_names(session):
+    df = pd.DataFrame(
+        {
+            "A": [0, 0, 0, 1, 1, 1],
+            "B": ["x", "y", "z", "x", "y", "z"],
+            "C": [123, 345, 789, -123, -345, -789],
+            "D": ["a", "b", "c", "d", "e", "f"],
+        },
+    )
+    index = session.read_pandas(df).set_index(["A", "B"]).index
+    assert "names=['A', 'B']" in repr(index)
```

### Comparing `bigframes-1.0.0/tests/system/small/test_ipython.py` & `bigframes-1.1.0/tests/system/small/test_ipython.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_multiindex.py` & `bigframes-1.1.0/tests/system/small/test_multiindex.py`

 * *Files 0% similar despite different names*

```diff
@@ -8,14 +8,15 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+import numpy as np
 import pandas
 import pytest
 
 import bigframes.pandas as bpd
 from tests.system.utils import assert_pandas_df_equal, skip_legacy_pandas
 
 
@@ -1164,7 +1165,23 @@
     ):
         bf1.dot(bf2)
 
     with pytest.raises(
         NotImplementedError, match="Multi-level column input is not supported"
     ):
         bf1 @ bf2
+
+
+def test_explode_w_multi_index():
+    data = [[[1, 1], np.nan, [3, 3]], [[2], [5], []]]
+    multi_level_columns = pandas.MultiIndex.from_arrays(
+        [["col0", "col0", "col1"], ["col00", "col01", "col11"]]
+    )
+
+    df = bpd.DataFrame(data, columns=multi_level_columns)
+    pd_df = df.to_pandas()
+    pandas.testing.assert_frame_equal(
+        df["col0"].explode("col00").to_pandas(),
+        pd_df["col0"].explode("col00"),
+        check_dtype=False,
+        check_index_type=False,
+    )
```

### Comparing `bigframes-1.0.0/tests/system/small/test_numpy.py` & `bigframes-1.1.0/tests/system/small/test_numpy.py`

 * *Files 8% similar despite different names*

```diff
@@ -52,14 +52,18 @@
         ("sin",),
         ("cos",),
         ("tan",),
         ("log",),
         ("log10",),
         ("sqrt",),
         ("abs",),
+        ("floor",),
+        ("ceil",),
+        ("expm1",),
+        ("log1p",),
     ],
 )
 def test_df_ufuncs(scalars_dfs, opname):
     scalars_df, scalars_pandas_df = scalars_dfs
 
     bf_result = getattr(np, opname)(
         scalars_df[["float64_col", "int64_col"]]
@@ -73,14 +77,15 @@
     ("opname",),
     [
         ("add",),
         ("subtract",),
         ("multiply",),
         ("divide",),
         ("power",),
+        ("arctan2",),
     ],
 )
 def test_series_binary_ufuncs(floats_product_pd, floats_product_bf, opname):
     bf_result = getattr(np, opname)(
         floats_product_bf.float64_col_x, floats_product_bf.float64_col_y
     ).to_pandas()
     pd_result = getattr(np, opname)(
@@ -108,14 +113,31 @@
     pd_result = getattr(np, opname)(
         scalars_pandas_df[["float64_col", "int64_col"]], 5.1
     )
 
     pd.testing.assert_frame_equal(bf_result, pd_result)
 
 
+@pytest.mark.parametrize(
+    ("x", "y"),
+    [
+        ("int64_col", "int64_col"),
+        ("float64_col", "int64_col"),
+    ],
+)
+def test_series_atan2(scalars_dfs, x, y):
+    # Test atan2 separately as pandas errors when passing entire df as input, so pass only series
+    scalars_df, scalars_pandas_df = scalars_dfs
+
+    bf_result = np.arctan2(scalars_df[x], scalars_df[y]).to_pandas()
+    pd_result = np.arctan2(scalars_pandas_df[x], scalars_pandas_df[y])
+
+    pd.testing.assert_series_equal(bf_result, pd_result)
+
+
 def test_series_binary_ufuncs_reverse(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
 
     # Could be any non-symmetric binary op
     bf_result = np.subtract(5.1, scalars_df["int64_col"]).to_pandas()
     pd_result = np.subtract(5.1, scalars_pandas_df["int64_col"])
```

### Comparing `bigframes-1.0.0/tests/system/small/test_pandas.py` & `bigframes-1.1.0/tests/system/small/test_pandas.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_pandas_options.py` & `bigframes-1.1.0/tests/system/small/test_pandas_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_progress_bar.py` & `bigframes-1.1.0/tests/system/small/test_progress_bar.py`

 * *Files 1% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 import tempfile
 
 import numpy as np
 import pandas as pd
 
 import bigframes as bf
 import bigframes.formatting_helpers as formatting_helpers
-from bigframes.session import MAX_INLINE_DF_SIZE
+from bigframes.session import MAX_INLINE_DF_BYTES
 
 job_load_message_regex = r"\w+ job [\w-]+ is \w+\."
 
 
 def test_progress_bar_dataframe(
     penguins_df_default_index: bf.dataframe.DataFrame, capsys
 ):
@@ -66,15 +66,15 @@
 
 
 def test_progress_bar_load_jobs(
     session: bf.Session, penguins_pandas_df_default_index: pd.DataFrame, capsys
 ):
     # repeat the DF to be big enough to trigger the load job.
     df = penguins_pandas_df_default_index
-    while len(df) < MAX_INLINE_DF_SIZE:
+    while len(df) < MAX_INLINE_DF_BYTES:
         df = pd.DataFrame(np.repeat(df.values, 2, axis=0))
 
     bf.options.display.progress_bar = "terminal"
     with tempfile.TemporaryDirectory() as dir:
         path = dir + "/test_read_csv_progress_bar*.csv"
         df.to_csv(path, index=False)
         capsys.readouterr()  # clear output
```

### Comparing `bigframes-1.0.0/tests/system/small/test_remote_function.py` & `bigframes-1.1.0/tests/system/small/test_remote_function.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_scalar.py` & `bigframes-1.1.0/tests/system/small/test_scalar.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/small/test_series.py` & `bigframes-1.1.0/tests/system/small/test_series.py`

 * *Files 7% similar despite different names*

```diff
@@ -1477,15 +1477,15 @@
 
 def test_groupby_prod(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
     col_name = "int64_too"
     bf_series = scalars_df[col_name].groupby(scalars_df["int64_col"]).prod()
     pd_series = (
         scalars_pandas_df[col_name].groupby(scalars_pandas_df["int64_col"]).prod()
-    )
+    ).astype(pd.Float64Dtype())
     # TODO(swast): Update groupby to use index based on group by key(s).
     bf_result = bf_series.to_pandas()
     assert_series_equal(
         pd_series,
         bf_result,
     )
 
@@ -1525,18 +1525,24 @@
     ).astype(bf_series.dtype)
     pd.testing.assert_series_equal(
         pd_series,
         bf_series,
     )
 
 
-def test_drop_label(scalars_df_index, scalars_pandas_df_index):
-    col_name = "int64_col"
-    bf_series = scalars_df_index[col_name].drop(1).to_pandas()
-    pd_series = scalars_pandas_df_index[col_name].drop(1)
+@pytest.mark.parametrize(
+    ("label", "col_name"),
+    [
+        (0, "bool_col"),
+        (1, "int64_col"),
+    ],
+)
+def test_drop_label(scalars_df_index, scalars_pandas_df_index, label, col_name):
+    bf_series = scalars_df_index[col_name].drop(label).to_pandas()
+    pd_series = scalars_pandas_df_index[col_name].drop(label)
     pd.testing.assert_series_equal(
         pd_series,
         bf_series,
     )
 
 
 def test_drop_label_list(scalars_df_index, scalars_pandas_df_index):
@@ -2779,14 +2785,20 @@
     pd_result = pd_series.astype("Float64")
     bf_result = bf_series.astype("Float64").to_pandas()
 
     pd.testing.assert_series_equal(bf_result, pd_result, check_index_type=False)
 
 
 def test_string_astype_date():
+    if int(pa.__version__.split(".")[0]) < 15:
+        pytest.skip(
+            "Avoid pyarrow.lib.ArrowNotImplementedError: "
+            "Unsupported cast from string to date32 using function cast_date32."
+        )
+
     pd_series = pd.Series(["2014-08-15", "2215-08-15", "2016-02-29"]).astype(
         pd.ArrowDtype(pa.string())
     )
 
     bf_series = series.Series(pd_series)
 
     pd_result = pd_series.astype("date32[day][pyarrow]")
@@ -3406,7 +3418,108 @@
     pd_result = (
         scalars_pandas_df_index[column]
         .pipe((foo, "df"), x=7, y=9)
         .pipe(lambda x: x**2)
     )
 
     assert_series_equal(bf_result, pd_result)
+
+
+@pytest.mark.parametrize(
+    ("data"),
+    [
+        pytest.param([1, 2, 3], id="int"),
+        pytest.param([[1, 2, 3], [], numpy.nan, [3, 4]], id="int_array"),
+        pytest.param(
+            [["A", "AA", "AAA"], ["BB", "B"], numpy.nan, [], ["C"]], id="string_array"
+        ),
+        pytest.param(
+            [
+                {"A": {"x": 1.0}, "B": "b"},
+                {"A": {"y": 2.0}, "B": "bb"},
+                {"A": {"z": 4.0}},
+                {},
+                numpy.nan,
+            ],
+            id="struct_array",
+        ),
+    ],
+)
+def test_series_explode(data):
+    data = [[1, 2, 3], [], numpy.nan, [3, 4]]
+    s = bigframes.pandas.Series(data)
+    pd_s = pd.Series(data)
+    pd.testing.assert_series_equal(
+        s.explode().to_pandas(),
+        pd_s.explode(),
+        check_index_type=False,
+        check_dtype=False,
+    )
+
+
+@pytest.mark.parametrize(
+    ("index", "ignore_index"),
+    [
+        pytest.param(None, True, id="default_index"),
+        pytest.param(None, False, id="ignore_default_index"),
+        pytest.param([5, 1, 3, 2], True, id="unordered_index"),
+        pytest.param([5, 1, 3, 2], False, id="ignore_unordered_index"),
+        pytest.param(["z", "x", "a", "b"], True, id="str_index"),
+        pytest.param(["z", "x", "a", "b"], False, id="ignore_str_index"),
+    ],
+)
+def test_series_explode_w_index(index, ignore_index):
+    data = [[], [200.0, 23.12], [4.5, -9.0], [1.0]]
+    s = bigframes.pandas.Series(data, index=index)
+    pd_s = pd.Series(data, index=index)
+    pd.testing.assert_series_equal(
+        s.explode(ignore_index=ignore_index).to_pandas(),
+        pd_s.explode(ignore_index=ignore_index).astype(pd.Float64Dtype()),
+        check_index_type=False,
+    )
+
+
+@pytest.mark.parametrize(
+    ("ignore_index", "ordered"),
+    [
+        pytest.param(True, True, id="include_index_ordered"),
+        pytest.param(True, False, id="include_index_unordered"),
+        pytest.param(False, True, id="ignore_index_ordered"),
+    ],
+)
+def test_series_explode_reserve_order(ignore_index, ordered):
+    data = [numpy.random.randint(0, 10, 10) for _ in range(10)]
+    s = bigframes.pandas.Series(data)
+    pd_s = pd.Series(data)
+
+    res = s.explode(ignore_index=ignore_index).to_pandas(ordered=ordered)
+    pd_res = pd_s.explode(ignore_index=ignore_index).astype(pd.Int64Dtype())
+    pd.testing.assert_series_equal(
+        res if ordered else res.sort_index(),
+        pd_res,
+        check_index_type=False,
+    )
+
+
+def test_series_explode_w_aggregate():
+    data = [[1, 2, 3], [], numpy.nan, [3, 4]]
+    s = bigframes.pandas.Series(data)
+    pd_s = pd.Series(data)
+    assert s.explode().sum() == pd_s.explode().sum()
+
+
+@pytest.mark.parametrize(
+    ("data"),
+    [
+        pytest.param(numpy.nan, id="null"),
+        pytest.param([numpy.nan], id="null_array"),
+        pytest.param([[]], id="empty_array"),
+        pytest.param([numpy.nan, []], id="null_and_empty_array"),
+    ],
+)
+def test_series_explode_null(data):
+    s = bigframes.pandas.Series(data)
+    pd.testing.assert_series_equal(
+        s.explode().to_pandas(),
+        s.to_pandas().explode(),
+        check_dtype=False,
+    )
```

### Comparing `bigframes-1.0.0/tests/system/small/test_session.py` & `bigframes-1.1.0/tests/system/small/test_session.py`

 * *Files 0% similar despite different names*

```diff
@@ -23,15 +23,15 @@
 import google
 import google.cloud.bigquery as bigquery
 import numpy as np
 import pandas as pd
 import pytest
 
 import bigframes
-import bigframes.core.indexes.index
+import bigframes.core.indexes.base
 import bigframes.dataframe
 import bigframes.dtypes
 import bigframes.ml.linear_model
 from tests.system import utils
 
 
 def test_read_gbq_tokyo(
@@ -417,14 +417,29 @@
 
     result = df.to_pandas()
     expected = scalars_pandas_df
 
     pd.testing.assert_frame_equal(result, expected)
 
 
+def test_read_pandas_series(session):
+    idx = pd.Index([2, 7, 1, 2, 8], dtype=pd.Int64Dtype())
+    pd_series = pd.Series([3, 1, 4, 1, 5], dtype=pd.Int64Dtype(), index=idx)
+    bf_series = session.read_pandas(pd_series)
+
+    pd.testing.assert_series_equal(bf_series.to_pandas(), pd_series)
+
+
+def test_read_pandas_index(session):
+    pd_idx = pd.Index([2, 7, 1, 2, 8], dtype=pd.Int64Dtype())
+    bf_idx = session.read_pandas(pd_idx)
+
+    pd.testing.assert_index_equal(bf_idx.to_pandas(), pd_idx)
+
+
 def test_read_pandas_inline_respects_location():
     options = bigframes.BigQueryOptions(location="europe-west1")
     session = bigframes.Session(options)
 
     df = session.read_pandas(pd.DataFrame([[1, 2, 3], [4, 5, 6]]))
     repr(df)
```

### Comparing `bigframes-1.0.0/tests/system/small/test_window.py` & `bigframes-1.1.0/tests/system/small/test_window.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/system/utils.py` & `bigframes-1.1.0/tests/system/utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/__init__.py` & `bigframes-1.1.0/tests/unit/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/_config/__init__.py` & `bigframes-1.1.0/tests/unit/_config/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/_config/test_bigquery_options.py` & `bigframes-1.1.0/tests/unit/_config/test_bigquery_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/core/__init__.py` & `bigframes-1.1.0/tests/unit/core/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/core/test_bf_utils.py` & `bigframes-1.1.0/tests/unit/core/test_bf_utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/core/test_blocks.py` & `bigframes-1.1.0/tests/unit/core/test_blocks.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/core/test_expression.py` & `bigframes-1.1.0/tests/unit/core/test_expression.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/core/test_log_adapter.py` & `bigframes-1.1.0/tests/unit/core/test_log_adapter.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/ml/__init__.py` & `bigframes-1.1.0/tests/unit/ml/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/ml/test_api_primitives.py` & `bigframes-1.1.0/tests/unit/ml/test_api_primitives.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/ml/test_compose.py` & `bigframes-1.1.0/tests/unit/ml/test_compose.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/ml/test_golden_sql.py` & `bigframes-1.1.0/tests/unit/ml/test_golden_sql.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/ml/test_pipeline.py` & `bigframes-1.1.0/tests/unit/ml/test_pipeline.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/ml/test_sql.py` & `bigframes-1.1.0/tests/unit/ml/test_sql.py`

 * *Files 0% similar despite different names*

```diff
@@ -369,25 +369,25 @@
         == """SELECT * FROM ML.GENERATE_TEXT(MODEL `my_project_id.my_dataset_id.my_model_id`,
   (input_X_sql), STRUCT(
   1 AS option_key1,
   2.2 AS option_key2))"""
     )
 
 
-def test_ml_generate_text_embedding_correct(
+def test_ml_generate_embedding_correct(
     model_manipulation_sql_generator: ml_sql.ModelManipulationSqlGenerator,
     mock_df: bpd.DataFrame,
 ):
-    sql = model_manipulation_sql_generator.ml_generate_text_embedding(
+    sql = model_manipulation_sql_generator.ml_generate_embedding(
         source_df=mock_df,
         struct_options={"option_key1": 1, "option_key2": 2.2},
     )
     assert (
         sql
-        == """SELECT * FROM ML.GENERATE_TEXT_EMBEDDING(MODEL `my_project_id.my_dataset_id.my_model_id`,
+        == """SELECT * FROM ML.GENERATE_EMBEDDING(MODEL `my_project_id.my_dataset_id.my_model_id`,
   (input_X_sql), STRUCT(
   1 AS option_key1,
   2.2 AS option_key2))"""
     )
 
 
 def test_ml_detect_anomalies_correct_sql(
```

### Comparing `bigframes-1.0.0/tests/unit/resources.py` & `bigframes-1.1.0/tests/unit/resources.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/session/__init__.py` & `bigframes-1.1.0/tests/unit/session/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/session/test_clients.py` & `bigframes-1.1.0/tests/unit/session/test_clients.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/session/test_io_bigquery.py` & `bigframes-1.1.0/tests/unit/session/test_io_bigquery.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/session/test_io_pandas.py` & `bigframes-1.1.0/tests/unit/session/test_io_pandas.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/session/test_session.py` & `bigframes-1.1.0/tests/unit/session/test_session.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_clients.py` & `bigframes-1.1.0/tests/unit/test_clients.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_compute_options.py` & `bigframes-1.1.0/tests/unit/test_compute_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_core.py` & `bigframes-1.1.0/tests/unit/test_core.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_dataframe.py` & `bigframes-1.1.0/tests/unit/test_dataframe.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_dtypes.py` & `bigframes-1.1.0/tests/unit/test_dtypes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_features.py` & `bigframes-1.1.0/tests/unit/test_features.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_formatting_helper.py` & `bigframes-1.1.0/tests/unit/test_formatting_helper.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_formatting_helpers.py` & `bigframes-1.1.0/tests/unit/test_formatting_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_pandas.py` & `bigframes-1.1.0/tests/unit/test_pandas.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/tests/unit/test_remote_function.py` & `bigframes-1.1.0/tests/unit/test_remote_function.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/cpython/LICENSE` & `bigframes-1.1.0/third_party/bigframes_vendored/cpython/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/cpython/_pprint.py` & `bigframes-1.1.0/third_party/bigframes_vendored/cpython/_pprint.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE` & `bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py` & `bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py` & `bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py` & `bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py` & `bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py` & `bigframes-1.1.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/LICENSE.txt` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/README.md` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/README.md`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py`

 * *Files 12% similar despite different names*

```diff
@@ -22,15 +22,21 @@
 
 
 def _to_json_string(translator, op: vendored_ibis_ops.ToJsonString):
     arg = translator.translate(op.arg)
     return f"TO_JSON_STRING({arg})"
 
 
+def _generate_array(translator, op: vendored_ibis_ops.GenerateArray):
+    arg = translator.translate(op.arg)
+    return f"GENERATE_ARRAY(0, {arg})"
+
+
 patched_ops = {
     vendored_ibis_ops.ApproximateMultiQuantile: _approx_quantiles,  # type:ignore
     vendored_ibis_ops.FirstNonNullValue: _first_non_null_value,  # type:ignore
     vendored_ibis_ops.LastNonNullValue: _last_non_null_value,  # type:ignore
     vendored_ibis_ops.ToJsonString: _to_json_string,  # type:ignore
+    vendored_ibis_ops.GenerateArray: _generate_array,  # type:ignore
 }
 
 OPERATION_REGISTRY.update(patched_ops)
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py` & `bigframes-1.1.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/AUTHORS.md` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/AUTHORS.md`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/LICENSE` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/README.md` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/README.md`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/_config/config.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/_config/config.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,15 +22,15 @@
             ...     utc=True
             ... ).astype("timestamp[us, tz=UTC][pyarrow]")
 
             >>> s.dt.strftime("%B %d, %Y, %r")
             0      August 15, 2014, 08:15:12 AM
             1    February 29, 2012, 02:15:12 AM
             2      August 15, 2015, 03:15:12 AM
-            Name: 0, dtype: string
+            dtype: string
 
         Args:
             date_format (str):
                 Date format string (e.g. "%Y-%m-%d").
 
         Returns:
             bigframes.series.Series: Series of formatted strings.
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/common.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/common.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,12 +1,14 @@
 # Contains code from https://github.com/pandas-dev/pandas/blob/main/pandas/core/common.py
 from __future__ import annotations
 
 from typing import Callable, TYPE_CHECKING
 
+from bigframes_vendored.pandas.core.dtypes.inference import iterable_not_string
+
 if TYPE_CHECKING:
     from bigframes_vendored.pandas.pandas._typing import T
 
 
 def pipe(
     obj, func: Callable[..., T] | tuple[Callable[..., T], str], *args, **kwargs
 ) -> T:
@@ -36,7 +38,31 @@
         if target in kwargs:
             msg = f"{target} is both the pipe target and a keyword argument"
             raise ValueError(msg)
         kwargs[target] = obj
         return func(*args, **kwargs)
     else:
         return func(obj, *args, **kwargs)
+
+
+def flatten(line):
+    """
+    Flatten an arbitrarily nested sequence.
+
+    Parameters
+    ----------
+    line : sequence
+        The non string sequence to flatten
+
+    Notes
+    -----
+    This doesn't consider strings sequences.
+
+    Returns
+    -------
+    flattened : generator
+    """
+    for element in line:
+        if iterable_not_string(element):
+            yield from flatten(element)
+        else:
+            yield element
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/config_init.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/config_init.py`

 * *Files 6% similar despite different names*

```diff
@@ -28,41 +28,53 @@
 Users can also get a dry run of the job by accessing the query_job property before they've run the job. This will return a dry run instance of the job they can inspect.
     >>> df.query_job.total_bytes_processed
     28947
 
 User can execute the job by calling .to_pandas()
     >>> # df.to_pandas()
 
-Reset option
+Reset repr_mode option
     >>> bpd.options.display.repr_mode = "head"
 
+Can also set the progress_bar option to see the progress bar in terminal,
+    >>> bpd.options.display.progress_bar = "terminal"
+
+notebook,
+    >>> bpd.options.display.progress_bar = "notebook"
+
+or just remove it.
+    >>> bpd.options.display.progress_bar = None
+
+Setting to default value "auto" will detect and show progress bar automatically.
+    >>> bpd.options.display.progress_bar = "auto"
+
 Attributes:
     max_columns (int, default 20):
         If `max_columns` is exceeded, switch to truncate view.
     max_rows (int, default 25):
         If `max_rows` is exceeded, switch to truncate view.
     progress_bar (Optional(str), default "auto"):
         Determines if progress bars are shown during job runs.
         Valid values are `auto`, `notebook`, and `terminal`. Set
         to `None` to remove progress bars.
     repr_mode (Literal[`head`, `deferred`]):
         `head`:
             Execute, download, and display results (limited to head) from
-            dataframe and series objects during repr.
+            Dataframe and Series objects during repr.
         `deferred`:
-            Prevent executions from repr statements in dataframe and series objects.
-            Instead estimated bytes processed will be shown. Dataframe and Series
+            Prevent executions from repr statements in DataFrame and Series objects.
+            Instead, estimated bytes processed will be shown. DataFrame and Series
             objects can still be computed with methods that explicitly execute and
             download results.
     max_info_columns (int):
         max_info_columns is used in DataFrame.info method to decide if
-        per column information will be printed.
+        information in each column will be printed.
     max_info_rows (int or None):
         df.info() will usually show null-counts for each column.
-        For large frames this can be quite slow. max_info_rows and max_info_cols
+        For large frames, this can be quite slow. max_info_rows and max_info_cols
         limit this null check only to frames with smaller dimensions than
         specified.
     memory_usage (bool):
         This specifies if the memory usage of a DataFrame should be displayed when
         df.info() is called. Valid values True,False,
 """
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/frame.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/frame.py`

 * *Files 2% similar despite different names*

```diff
@@ -2800,14 +2800,65 @@
                 Provided DataFrame to use to fill null values.
 
         Returns:
             DataFrame: The result of combining the provided DataFrame with the other object.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
+    def explode(
+        self, column: Union[str, Sequence[str]], *, ignore_index: Optional[bool] = False
+    ) -> DataFrame:
+        """
+        Transform each element of an array to a row, replicating index values.
+
+        **Examples:**
+
+            >>> import bigframes.pandas as bpd
+            >>> bpd.options.display.progress_bar = None
+
+            >>> df = bpd.DataFrame({'A': [[0, 1, 2], [], [], [3, 4]],
+            ...                     'B': 1,
+            ...                     'C': [['a', 'b', 'c'], np.nan, [], ['d', 'e']]})
+            >>> df.explode('A')
+                A  B              C
+            0     0  1  ['a' 'b' 'c']
+            0     1  1  ['a' 'b' 'c']
+            0     2  1  ['a' 'b' 'c']
+            1  <NA>  1             []
+            2  <NA>  1             []
+            3     3  1      ['d' 'e']
+            3     4  1      ['d' 'e']
+            <BLANKLINE>
+            [7 rows x 3 columns]
+            >>> df.explode(list('AC'))
+                A  B     C
+            0     0  1     a
+            0     1  1     b
+            0     2  1     c
+            1  <NA>  1  <NA>
+            2  <NA>  1  <NA>
+            3     3  1     d
+            3     4  1     e
+            <BLANKLINE>
+            [7 rows x 3 columns]
+
+        Args:
+            column (str, Sequence[str]):
+                Column(s) to explode. For multiple columns, specify a non-empty list
+                with each element be str or tuple, and all specified columns their
+                list-like data on same row of the frame must have matching length.
+            ignore_index (bool, default False):
+                If True, the resulting index will be labeled 0, 1, …, n - 1.
+
+        Returns:
+            bigframes.series.DataFrame: Exploded lists to rows of the subset columns;
+                index will be duplicated for these rows.
+        """
+        raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
+
     def corr(self, method, min_periods, numeric_only) -> DataFrame:
         """
         Compute pairwise correlation of columns, excluding NA/null values.
 
         **Examples:**
 
             >>> import bigframes.pandas as bpd
@@ -2861,14 +2912,15 @@
         Args:
             numeric_only(bool, default False):
                 Include only float, int, boolean, decimal data.
 
         Returns:
             DataFrame: The covariance matrix of the series of the DataFrame.
         """
+        raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
     def update(
         self, other, join: str = "left", overwrite: bool = True, filter_func=None
     ) -> DataFrame:
         """
         Modify in place using non-NA values from another DataFrame.
 
@@ -4411,18 +4463,18 @@
             0	3	1
             1	1	2
             2	2	3
             <BLANKLINE>
             [3 rows x 2 columns]
 
             >>> df.cumprod()
-                A	B
-            0	3	1
-            1	3	2
-            2	6	6
+                 A    B
+            0  3.0  1.0
+            1  3.0  2.0
+            2  6.0  6.0
             <BLANKLINE>
             [3 rows x 2 columns]
 
         Returns:
             bigframes.dataframe.DataFrame: Return cumulative product of DataFrame.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
@@ -4792,15 +4844,15 @@
             Aritra Kona       35
             <BLANKLINE>
             [3 rows x 1 columns]
             >>> df1.index # doctest: +ELLIPSIS
             MultiIndex([( 'Alice',  'Seattle'),
                 (   'Bob', 'New York'),
                 ('Aritra',     'Kona')],
-               name='Name')
+               names=['Name', 'Location'])
             >>> df1.index.values
             array([('Alice', 'Seattle'), ('Bob', 'New York'), ('Aritra', 'Kona')],
                 dtype=object)
 
         Returns:
             Index: The index object of the DataFrame.
         """
@@ -4927,14 +4979,166 @@
                 Don’t include counts of rows that contain NA values.
 
         Returns:
             Series: Series containing counts of unique rows in the DataFrame
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
+    def eval(self, expr: str) -> DataFrame:
+        """
+        Evaluate a string describing operations on DataFrame columns.
+
+        Operates on columns only, not specific rows or elements.  This allows
+        `eval` to run arbitrary code, which can make you vulnerable to code
+        injection if you pass user input to this function.
+
+        **Examples:**
+            >>> import bigframes.pandas as bpd
+            >>> bpd.options.display.progress_bar = None
+
+            >>> df = bpd.DataFrame({'A': range(1, 6), 'B': range(10, 0, -2)})
+            >>> df
+            A   B
+            0  1  10
+            1  2   8
+            2  3   6
+            3  4   4
+            4  5   2
+            <BLANKLINE>
+            [5 rows x 2 columns]
+            >>> df.eval('A + B')
+            0    11
+            1    10
+            2     9
+            3     8
+            4     7
+            dtype: Int64
+
+            Assignment is allowed though by default the original DataFrame is not
+            modified.
+
+            >>> df.eval('C = A + B')
+            A   B   C
+            0  1  10  11
+            1  2   8  10
+            2  3   6   9
+            3  4   4   8
+            4  5   2   7
+            <BLANKLINE>
+            [5 rows x 3 columns]
+            >>> df
+            A   B
+            0  1  10
+            1  2   8
+            2  3   6
+            3  4   4
+            4  5   2
+            <BLANKLINE>
+            [5 rows x 2 columns]
+
+            Multiple columns can be assigned to using multi-line expressions:
+
+            >>> df.eval(
+            ...     '''
+            ... C = A + B
+            ... D = A - B
+            ... '''
+            ... )
+            A   B   C  D
+            0  1  10  11 -9
+            1  2   8  10 -6
+            2  3   6   9 -3
+            3  4   4   8  0
+            4  5   2   7  3
+            <BLANKLINE>
+            [5 rows x 4 columns]
+
+
+        Args:
+            expr (str):
+                The expression string to evaluate.
+
+        Returns:
+            DataFrame
+        """
+        raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
+
+    def query(self, expr: str) -> DataFrame | None:
+        """
+        Query the columns of a DataFrame with a boolean expression.
+
+        **Examples:**
+            >>> import bigframes.pandas as bpd
+            >>> bpd.options.display.progress_bar = None
+
+            >>> df = bpd.DataFrame({'A': range(1, 6),
+            ...                    'B': range(10, 0, -2),
+            ...                    'C C': range(10, 5, -1)})
+            >>> df
+            A   B  C C
+            0  1  10   10
+            1  2   8    9
+            2  3   6    8
+            3  4   4    7
+            4  5   2    6
+            <BLANKLINE>
+            [5 rows x 3 columns]
+            >>> df.query('A > B')
+            A  B  C C
+            4  5  2    6
+            <BLANKLINE>
+            [1 rows x 3 columns]
+
+            The previous expression is equivalent to
+
+            >>> df[df.A > df.B]
+            A  B  C C
+            4  5  2    6
+            <BLANKLINE>
+            [1 rows x 3 columns]
+
+            For columns with spaces in their name, you can use backtick quoting.
+
+            >>> df.query('B == `C C`')
+            A   B  C C
+            0  1  10   10
+            <BLANKLINE>
+            [1 rows x 3 columns]
+
+            The previous expression is equivalent to
+
+            >>> df[df.B == df['C C']]
+            A   B  C C
+            0  1  10   10
+            <BLANKLINE>
+            [1 rows x 3 columns]
+
+        Args:
+            expr (str):
+                The query string to evaluate.
+
+                You can refer to variables
+                in the environment by prefixing them with an '@' character like
+                ``@a + b``.
+
+                You can refer to column names that are not valid Python variable names
+                by surrounding them in backticks. Thus, column names containing spaces
+                or punctuations (besides underscores) or starting with digits must be
+                surrounded by backticks. (For example, a column named "Area (cm^2)" would
+                be referenced as ```Area (cm^2)```). Column names which are Python keywords
+                (like "list", "for", "import", etc) cannot be used.
+
+                For example, if one of your columns is called ``a a`` and you want
+                to sum it with ``b``, your query should be ```a a` + b``.
+
+        Returns:
+            DataFrame
+        """
+        raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
+
     def interpolate(self, method: str = "linear"):
         """
         Fill NaN values using an interpolation method.
 
         **Examples:**
 
             >>> import bigframes.pandas as bpd
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/generic.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/generic.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py`

 * *Files 4% similar despite different names*

```diff
@@ -74,15 +74,15 @@
         Compute median of groups, excluding missing values.
 
         Args:
             numeric_only (bool, default False):
                 Include only float, int, boolean columns.
             exact (bool, default False):
                 Calculate the exact median instead of an approximation. Note:
-                    ``exact=True`` not yet supported.
+                    ``exact=True`` is not supported.
 
         Returns:
             pandas.Series or pandas.DataFrame: Median of groups.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
     def std(
@@ -174,15 +174,15 @@
         Compute sum of group values.
 
         Args:
             numeric_only (bool, default False):
                 Include only float, int, boolean columns.
             min_count (int, default 0):
                 The required number of valid values to perform the operation. If fewer
-                than ``min_count`` non-NA values are present the result will be NA.
+                than ``min_count`` and non-NA values are present, the result will be NA.
 
         Returns:
             Series or DataFrame: Computed sum of values within each group.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
     def prod(self, numeric_only: bool = False, min_count: int = 0):
@@ -190,15 +190,15 @@
         Compute prod of group values.
 
         Args:
             numeric_only (bool, default False):
                 Include only float, int, boolean columns.
             min_count (int, default 0):
                 The required number of valid values to perform the operation. If fewer
-                than ``min_count`` non-NA values are present the result will be NA.
+                than ``min_count`` and non-NA values are present, the result will be NA.
 
         Returns:
             Series or DataFrame: Computed prod of values within each group.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
     def min(
@@ -210,15 +210,15 @@
         Compute min of group values.
 
         Args:
             numeric_only (bool, default False):
                 Include only float, int, boolean columns.
             min_count (int, default 0):
                 The required number of valid values to perform the operation. If fewer
-                than ``min_count`` non-NA values are present the result will be NA.
+                than ``min_count`` and non-NA values are present, the result will be NA.
 
         Returns:
             Series or DataFrame: Computed min of values within each group.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
     def max(
@@ -230,15 +230,15 @@
         Compute max of group values.
 
         Args:
             numeric_only (bool, default False):
                 Include only float, int, boolean columns.
             min_count (int, default 0):
                 The required number of valid values to perform the operation. If fewer
-                than ``min_count`` non-NA values are present the result will be NA.
+                than ``min_count`` and non-NA values are present, the result will be NA.
 
         Returns:
             Series or DataFrame: Computed max of values within each group.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
     def cumcount(self, ascending: bool = True):
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexes/base.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexes/base.py`

 * *Files 3% similar despite different names*

```diff
@@ -4,14 +4,26 @@
 from bigframes import constants
 
 
 class Index:
     """Immutable sequence used for indexing and alignment.
 
     The basic object storing axis labels for all objects.
+
+    Args:
+        data (pandas.Series | pandas.Index | bigframes.series.Series | bigframes.core.indexes.base.Index):
+            Labels (1-dimensional).
+        dtype:
+            Data type for the output Index. If not specified, this will be
+            inferred from `data`.
+        name:
+            Name to be stored in the index.
+        session (Optional[bigframes.session.Session]):
+            BigQuery DataFrames session where queries are run. If not set,
+            a default session is used.
     """
 
     @property
     def name(self):
         """Returns Index name."""
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/indexing.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/indexing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/series.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/series.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 """
 Data structure for 1-dimensional cross-sectional and time series data
 """
 from __future__ import annotations
 
-from typing import Hashable, IO, Literal, Mapping, Sequence, TYPE_CHECKING
+from typing import Hashable, IO, Literal, Mapping, Optional, Sequence, TYPE_CHECKING
 
 from bigframes_vendored.pandas.core.generic import NDFrame
 import numpy as np
 from pandas._libs import lib
 from pandas._typing import Axis, FilePath, NaPosition, WriteBuffer
 
 from bigframes import constants
@@ -83,15 +83,15 @@
             Bob     New York    30
             Aritra  Kona        35
             Name: Age, dtype: Int64
             >>> s1.index # doctest: +ELLIPSIS
             MultiIndex([( 'Alice',  'Seattle'),
                 (   'Bob', 'New York'),
                 ('Aritra',     'Kona')],
-               name='Name')
+               names=['Name', 'Location'])
             >>> s1.index.values
             array([('Alice', 'Seattle'), ('Bob', 'New York'), ('Aritra', 'Kona')],
                 dtype=object)
 
         Returns:
             Index: The index object of the Series.
         """
@@ -747,14 +747,42 @@
                 it specifies the number of positions to the left of the decimal point.
 
         Returns:
             bigframes.series.Series: Rounded values of the Series.
         """
         raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
 
+    def explode(self, *, ignore_index: Optional[bool] = False) -> Series:
+        """
+        Transform each element of a list-like to a row.
+
+        **Examples:**
+
+            >>> import bigframes.pandas as bpd
+            >>> bpd.options.display.progress_bar = None
+
+            >>> s = bpd.Series([[1, 2, 3], [], [3, 4]])
+            >>> s.explode()
+            0       1
+            0       2
+            0       3
+            1    <NA>
+            2       3
+            2       4
+            dtype: Int64
+
+        Args:
+            ignore_index (bool, default False):
+                If True, the resulting index will be labeled 0, 1, …, n - 1.
+
+        Returns:
+            bigframes.series.Series: Exploded lists to rows; index will be duplicated for these rows.
+        """
+        raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
+
     def corr(self, other, method="pearson", min_periods=None) -> float:
         """
         Compute the correlation with the other Series.  Non-number values are ignored in the
         computation.
 
         Uses the "Pearson" method of correlation.  Numbers are converted to float before
         calculation, so the result may be unstable.
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/core/window/rolling.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/core/window/rolling.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/common.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/common.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/gbq.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/gbq.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/parquet.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/parquet.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/io/pickle.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/io/pickle.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/pandas/_typing.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/pandas/_typing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/pandas/plotting/_core.py` & `bigframes-1.1.0/third_party/bigframes_vendored/pandas/plotting/_core.py`

 * *Files 2% similar despite different names*

```diff
@@ -253,17 +253,14 @@
                 The column name or column position to be used as vertical
                 coordinates for each point.
             s (str, scalar or array-like, optional):
                 The size of each point. Possible values are:
 
                 - A string with the name of the column to be used for marker's size.
                 - A single scalar so all points have the same size.
-                - A sequence of scalars, which will be used for each point's size
-                  recursively. For instance, when passing [2,14] all points size
-                  will be either 2 or 14, alternatively.
 
             c (str, int or array-like, optional):
                 The color of each point. Possible values are:
 
                 - A single color string referred to by name, RGB or RGBA code,
                   for instance 'red' or '#a98d19'.
                 - A column name or position whose values will be used to color the
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/COPYING` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/COPYING`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/base.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py`

 * *Files 0% similar despite different names*

```diff
@@ -15,17 +15,17 @@
     """Handles parameter management for classifiers composed of named estimators."""
 
 
 class ColumnTransformer(_BaseComposition):
     """Applies transformers to columns of BigQuery DataFrames.
 
     This estimator allows different columns or column subsets of the input
-    to be transformed separately and the features generated by each transformer
+    to be transformed separately, and the features generated by each transformer
     will be concatenated to form a single feature space.
-    This is useful for heterogeneous or columnar data, to combine several
+    This is useful for heterogeneous or columnar data to combine several
     feature extraction mechanisms or transformations into a single transformer.
 
     Args:
         transformers:
             List of (name, transformer, columns) tuples specifying the transformer
             objects to be applied to subsets of the data.
     """
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py`

 * *Files 0% similar despite different names*

```diff
@@ -18,16 +18,16 @@
 
 
 class PCA(BaseEstimator, metaclass=ABCMeta):
     """Principal component analysis (PCA).
 
     Args:
         n_components (int, float or None, default None):
-            Number of components to keep.
-            If n_components is not set all components are kept. n_components = min(n_samples, n_features).
+            Number of components to keep. If n_components is not set all
+            components are kept, n_components = min(n_samples, n_features).
             If 0 < n_components < 1, select the number of components such that the amount of variance that needs to be explained is greater than the percentage specified by n_components.
         svd_solver ("full", "randomized" or "auto", default "auto"):
             The solver to use to calculate the principal components. Details: https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-create-pca#pca_solver.
 
     """
 
     def fit(self, X, y=None):
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py`

 * *Files 1% similar despite different names*

```diff
@@ -34,15 +34,15 @@
         class_weight (dict or 'balanced', default None):
             Default None. Weights associated with classes in the form
             ``{class_label: weight}``.If not given, all classes are supposed
             to have weight one. The "balanced" mode uses the values of y to
             automatically adjust weights inversely proportional to class
             frequencies in the input data as
             ``n_samples / (n_classes * np.bincount(y))``. Dict isn't
-            supported now.
+            supported.
         l1_reg (float or None, default None):
             The amount of L1 regularization applied. Default to None. Can't be set in "normal_equation" mode. If unset, value 0 is used.
         l2_reg (float, default 0.0):
             The amount of L2 regularization applied. Default to 0.
         max_iterations (int, default 20):
             The maximum number of training iterations or steps. Default to 20.
         warm_start (bool, default False):
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py`

 * *Files 22% similar despite different names*

```diff
@@ -60,7 +60,34 @@
         y_pred (Series or DataFrame of shape (n_samples,)):
             Estimated target values.
 
     Returns:
         float: The :math:`R^2` score.
     """
     raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
+
+
+def mean_squared_error(y_true, y_pred) -> float:
+    """Mean squared error regression loss.
+
+    **Examples:**
+
+        >>> import bigframes.pandas as bpd
+        >>> import bigframes.ml.metrics
+        >>> bpd.options.display.progress_bar = None
+
+        >>> y_true = bpd.DataFrame([3, -0.5, 2, 7])
+        >>> y_pred = bpd.DataFrame([2.5, 0.0, 2, 8])
+        >>> mse = bigframes.ml.metrics.mean_squared_error(y_true, y_pred)
+        >>> mse
+        0.375
+
+    Args:
+        y_true (Series or DataFrame of shape (n_samples,)):
+            Ground truth (correct) target values.
+        y_pred (Series or DataFrame of shape (n_samples,)):
+            Estimated target values.
+
+    Returns:
+        float: Mean squared error.
+    """
+    raise NotImplementedError(constants.ABSTRACT_METHOD_ERROR_MESSAGE)
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/pipeline.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/pipeline.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py`

 * *Files 2% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 
     Args:
         n_bins (int, default 5):
             The number of bins to produce. Raises ValueError if ``n_bins < 2``.
         strategy ({'uniform', 'quantile'}, default='quantile'):
             Strategy used to define the widths of the bins. 'uniform': All bins
             in each feature have identical widths. 'quantile': All bins in each
-            feature have the same number of points. Only `uniform` is supported now.
+            feature have the same number of points. Only `uniform` is supported.
     """
 
     def fit(self, X, y=None):
         """Fit the estimator.
 
         Args:
             X (bigframes.dataframe.DataFrame or bigframes.series.Series):
```

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py` & `bigframes-1.1.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/xgboost/LICENSE` & `bigframes-1.1.0/third_party/bigframes_vendored/xgboost/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.0.0/third_party/bigframes_vendored/xgboost/sklearn.py` & `bigframes-1.1.0/third_party/bigframes_vendored/xgboost/sklearn.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-"""Scikit-Learn Wrapper interface for XGBoost."""
+"""scikit-learn Wrapper interface for XGBoost."""
 
 from typing import Any
 
 from bigframes import constants
 
 from ..sklearn.base import BaseEstimator as XGBModelBase
 from ..sklearn.base import ClassifierMixin as XGBClassifierBase
```

